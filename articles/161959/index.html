<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Framework in Marmalade (part 3)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today we will continue the description of the development of the Marmalade Framework , begun in part 1 of the articles in this series, improving the w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Framework in Marmalade (part 3)</h1><div class="post__text post__text-html js-mediator-article">  Today we will continue the description of the development of the <a href="https://github.com/GlukKazan/mf">Marmalade Framework</a> , begun in <a href="http://habrahabr.ru/post/161681/">part 1 of the</a> articles in this series, improving the work with graphic resources, as well as adding work with sound and groups of images, with the help of which we will ensure application localization. <br><a name="habracut"></a><br>  First of all, take a closer look at how we load graphic resources into Sprite.cpp: <br><br><div class="spoiler">  <b class="spoiler_title">Sprite.cpp</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Sprite::addImage(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*res, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> state) { img = Iw2DCreateImage(res); }</code> </pre> <br></div></div><br>  Obviously, if the same image is used repeatedly, we will load it into memory as many times as we create sprites.  Working in this way, we will quickly exhaust the meager amount of RAM that is available to us on mobile platforms.  We need a resource manager that allows you to use once loaded resources multiple times. <br><br><div class="spoiler">  <b class="spoiler_title">ResourceManager.h</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> _RESOURCEMANAGER_H_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _RESOURCEMANAGER_H_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;map&gt; #include &lt;string&gt; #include "s3e.h" #include "IwResManager.h" #include "IwSound.h" #include "ResourceHolder.h" using namespace std; class ResourceManager { private: map&lt;string, ResourceHolder*&gt; res; public: ResourceManager(): res() {} void init(); void release(); ResourceHolder* load(const char* name, int loc); typedef map&lt;string, ResourceHolder*&gt;::iterator RIter; typedef pair&lt;string, ResourceHolder*&gt; RPair; }; extern ResourceManager rm; #endif // _RESOURCEMANAGER_H_</span></span></span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">ResourceManager.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ResourceManager.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Locale.h"</span></span></span><span class="hljs-meta"> ResourceManager rm; void ResourceManager::init() { IwResManagerInit(); } void ResourceManager::release() { for (RIter p = res.begin(); p != res.end(); ++p) { delete p-&gt;second; } res.clear(); IwResManagerTerminate(); } ResourceHolder* ResourceManager::load(const char* name, int loc) { ResourceHolder* r = NULL; string nm(name); RIter p = res.find(nm); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (p == res.end()) { r = new ResourceHolder(name, loc); res.insert(RPair(nm, r)); } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { r = p-&gt;second; } return r; }</span></span></code> </pre><br></div></div><br>  Please note that we must clear all dynamically allocated memory, otherwise, we will get an error when the application terminates.  A pointer to the downloaded graphic resource will be stored in the ResourceHolder. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">ResourceHolder.h</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> _RESOURCEHOLDER_H_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _RESOURCEHOLDER_H_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;string&gt; #include "s3e.h" #include "Iw2D.h" #include "IwResManager.h" using namespace std; class ResourceHolder { private: string name; int loc; CIw2DImage* data; public: ResourceHolder(const char* name, int loc); ~ResourceHolder() {unload();} void load(); void unload(); CIw2DImage* getData(); }; #endif // _RESOURCEHOLDER_H_ &lt;/spoiler&gt; &lt;spoiler title="ResourceHolder.cpp"&gt; &lt;source lang="cpp"&gt; #include "ResourceHolder.h" #include "Locale.h" ResourceHolder::ResourceHolder(const char* name, int loc): name(name) , loc(loc) , data(NULL) { } void ResourceHolder::load() { if (data == NULL) { CIwResGroup* resGroup; const char* groupName = Locale::getGroupName(loc); if (groupName != NULL) { resGroup = IwGetResManager()-&gt;GetGroupNamed(groupName); IwGetResManager()-&gt;SetCurrentGroup(resGroup); data = Iw2DCreateImageResource(name.c_str()); } else { data = Iw2DCreateImage(name.c_str()); } } } void ResourceHolder::unload() { if (data != NULL) { delete data; data = NULL; } } CIw2DImage* ResourceHolder::getData() { load(); return data; }</span></span></span></span></code> </pre><br></div></div><br>  In the ResourceHolder :: load method, you can see that when we get the name, we first try by loading some group (depending on the value obtained in loc) to find the resource in it and, if that failed, use the name to load the file.  The fact is that Marmalade allows you to place images (and other resources) into so-called groups in order to upload them as a whole. <br><br>  We use this fact to provide application localization.  Depending on the value of the loc parameter, we will upload a group of images related to the language settings, but the names of the resources themselves, inside the groups, will be the same (the files will be placed in different directories).  In order to define a group, you must create a text file with the group name and the extension group.  Below is an example of defining such a file for a group of images. <br><br><div class="spoiler">  <b class="spoiler_title">locale_ru.group</b> <div class="spoiler_text"><pre> <code class="cpp hljs">CIwResGroup { name <span class="hljs-string"><span class="hljs-string">"locale_ru"</span></span> <span class="hljs-string"><span class="hljs-string">"./locale_ru/play.png"</span></span> <span class="hljs-string"><span class="hljs-string">"./locale_ru/setup.png"</span></span> <span class="hljs-string"><span class="hljs-string">"./locale_ru/musicoff.png"</span></span> <span class="hljs-string"><span class="hljs-string">"./locale_ru/musicon.png"</span></span> <span class="hljs-string"><span class="hljs-string">"./locale_ru/soundoff.png"</span></span> <span class="hljs-string"><span class="hljs-string">"./locale_ru/soundon.png"</span></span> }</code> </pre><br></div></div><br>  Speaking of groups, two important recommendations should be made: <br><br><ul><li>  Do not forget that when uploading a file, the name should be specified with the extension, and to load an image from a group, you should use the resource of the same name without the extension </li><li>  Images should not be placed in groups unnecessarily (especially large images), since within the group they are stored in an unpacked state and take up much more space than when using packaged graphic formats (such as PNG), which will directly affect the size of the distribution </li></ul><br>  We can define the current locale on the device cross-platform using the following code. <br><br><div class="spoiler">  <b class="spoiler_title">Locale.h</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> _LOCALE_H_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _LOCALE_H_ enum ELocale { elNothing = 0x0, elImage = 0x1, elSound = 0x2, elEnImage = 0x5, elRuImage = 0x9, elEnSound = 0x6, elRuSound = 0xA }; class Locale { public: static int getCurrentImageLocale(); static int getCurrentSoundLocale(); static int getCommonImageLocale() {return elImage;} static int getCommonSoundLocale() {return elSound;} static const char* getGroupName(int locale); }; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// _LOCALE_H_</span></span></span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Locale.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Locale.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"s3e.h"</span></span></span><span class="hljs-meta"> const char* Locale::getGroupName(int locale) { switch (locale) { case elImage: return </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"images"</span></span></span><span class="hljs-meta">; case elEnSound: case elRuSound: case elSound: return </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sounds"</span></span></span><span class="hljs-meta">; case elEnImage: return </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"locale_en"</span></span></span><span class="hljs-meta">; case elRuImage: return </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"locale_ru"</span></span></span><span class="hljs-meta">; default: return NULL; } } int Locale::getCurrentImageLocale() { int32 lang = s3eDeviceGetInt(S3E_DEVICE_LANGUAGE); switch (lang) { case S3E_DEVICE_LANGUAGE_RUSSIAN: return elRuImage; default: return elEnImage; } } int Locale::getCurrentSoundLocale() { int32 lang = s3eDeviceGetInt(S3E_DEVICE_LANGUAGE); switch (lang) { case S3E_DEVICE_LANGUAGE_RUSSIAN: return elRuSound; default: return elEnSound; } }</span></span></code> </pre><br></div></div><br>  It remains to add to our project support for working with sound.  We will use two subsystems: <br><br><ul><li>  S3E Audio - for playing background music (supports a range of codecs and stereo) </li><li>  S3E Sound - to play sound effects (supports the ability to simultaneously play multiple sounds) </li></ul><br>  The principles of working with these subsystems are well described in this <a href="http://www.drmop.com/index.php/2011/10/07/quick-and-easy-audio-and-music-using-s3eaudio-and-iwsound/">article</a> and I will not dwell on them in detail.  I will describe only the changes that need to be made to the project. <br><br>  In the application settings file, we add a parameter that controls the number of simultaneously played sounds. <br><br><div class="spoiler">  <b class="spoiler_title">app.icf</b> <div class="spoiler_text"><pre> <code class="cpp hljs">[SOUND] MaxChannels=<span class="hljs-number"><span class="hljs-number">16</span></span></code> </pre><br></div></div><br>  The following descriptions are added to the project file. <br><br><div class="spoiler">  <b class="spoiler_title">mf.mkb</b> <div class="spoiler_text"><pre> <code class="cpp hljs">#!/usr/bin/env mkb options { module_path=<span class="hljs-string"><span class="hljs-string">"$MARMALADE_ROOT/examples"</span></span> } subprojects { iw2d iwresmanager SoundEngine } ... files { ... [Data] (data) locale_en.group locale_ru.group sounds.group } assets { (data) background.png sprite.png music.mp3 (data-ram/data-gles1, data) locale_en.group.bin locale_ru.group.bin sounds.group.bin }</code> </pre><br></div></div><br>  The description of the audio resource group will be as follows. <br><br><div class="spoiler">  <b class="spoiler_title">sounds.group</b> <div class="spoiler_text"><pre> <code class="cpp hljs">CIwResGroup { name <span class="hljs-string"><span class="hljs-string">"sounds"</span></span> <span class="hljs-string"><span class="hljs-string">"./sounds/menubutton.wav"</span></span> <span class="hljs-string"><span class="hljs-string">"./sounds/sound.wav"</span></span> CIwSoundSpec { name <span class="hljs-string"><span class="hljs-string">"menubutton"</span></span> data <span class="hljs-string"><span class="hljs-string">"menubutton"</span></span> vol <span class="hljs-number"><span class="hljs-number">0.9</span></span> loop <span class="hljs-literal"><span class="hljs-literal">false</span></span> } CIwSoundSpec { name <span class="hljs-string"><span class="hljs-string">"sound"</span></span> data <span class="hljs-string"><span class="hljs-string">"sound"</span></span> vol <span class="hljs-number"><span class="hljs-number">0.9</span></span> loop <span class="hljs-literal"><span class="hljs-literal">false</span></span> } CIwSoundGroup { name <span class="hljs-string"><span class="hljs-string">"sound_effects"</span></span> maxPolyphony <span class="hljs-number"><span class="hljs-number">8</span></span> killOldest <span class="hljs-literal"><span class="hljs-literal">true</span></span> addSpec <span class="hljs-string"><span class="hljs-string">"menubutton"</span></span> addSpec <span class="hljs-string"><span class="hljs-string">"sound"</span></span> } }</code> </pre><br></div></div><br>  Two sound effects are defined here and we can control their settings (for example, the volume of vol).  In the resource manager, we add initialization and completion of the audio subsystem. <br><br><div class="spoiler">  <b class="spoiler_title">ResourceManager.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> ResourceManager::init() { IwResManagerInit(); <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> IW_BUILD_RESOURCES IwGetResManager()-&gt;AddHandler(new CIwResHandlerWAV); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> IwGetResManager()-&gt;LoadGroup(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sounds.group"</span></span></span><span class="hljs-meta">); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (Locale::getCurrentImageLocale() == elEnImage) { IwGetResManager()-&gt;LoadGroup(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"locale_en.group"</span></span></span><span class="hljs-meta">); } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (Locale::getCurrentImageLocale() == elRuImage) { IwGetResManager()-&gt;LoadGroup(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"locale_ru.group"</span></span></span><span class="hljs-meta">); } } void ResourceManager::release() { for (RIter p = res.begin(); p != res.end(); ++p) { delete p-&gt;second; } res.clear(); IwResManagerTerminate(); IwSoundTerminate(); }</span></span></code> </pre><br></div></div><br>  In Main.cpp, do not forget to add a call to the update method for the audio subsystem: <br><br><div class="spoiler">  <b class="spoiler_title">Main.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Main.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"s3e.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Iw2D.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"IwGx.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"IwSound.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ResourceManager.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"TouchPad.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Desktop.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Scene.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Background.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Sprite.h"</span></span></span><span class="hljs-meta"> void init() { </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// Initialise Mamrlade graphics system and Iw2D module IwGxInit(); Iw2DInit(); // Init IwSound IwSoundInit(); // Set the default background clear colour IwGxSetColClear(0x0, 0x0, 0x0, 0); // Initialise the resource manager rm.init(); touchPad.init(); desktop.init(); } void release() { desktop.release(); touchPad.release(); // Shut down the resource manager rm.release(); Iw2DTerminate(); IwGxTerminate(); } int main() { init(); { Scene scene; new Background(&amp;scene, "background.png", 1, elNothing); new Sprite(&amp;scene, "sprite.png", 122, 100, 2, elNothing); desktop.setScene(&amp;scene); int32 duration = 1000 / 25; // Main Game Loop while (!desktop.isQuitMessageReceived()) { // Update keyboard system s3eKeyboardUpdate(); // Update Iw Sound Manager IwGetSoundManager()-&gt;Update(); // Update touchPad.update(); uint64 timestamp = s3eTimerGetMs(); desktop.update(timestamp); // Clear the screen IwGxClear(IW_GX_COLOUR_BUFFER_F | IW_GX_DEPTH_BUFFER_F); touchPad.clear(); // Refresh desktop.refresh(); // Show the surface Iw2DSurfaceShow(); // Yield to the opearting system s3eDeviceYield(duration); } } release(); return 0; }</span></span></span></span></code> </pre><br></div></div><br>  Resource groups are compiled from the description when the LoadGroup method is executed under the debugger.  If we did something wrong, we get an error message: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e24/ddf/6d5/e24ddf6d57031298b3c0d0f010fdb1a5.png" alt="image"><br><br>  As a result of the compilation, the data-ram / data-gles1 directory appears, containing the binary representation of the loaded groups.  Working under the debugger, we can delete the contents of this directory (it will be recreated), but when building for a mobile platform (iOS or Android) it should be present.  Otherwise, the build will fail. <br><br>  Concluding the conversation about resources, we should mention another interesting point.  We can easily ensure persistence with the following setting: <br><br><div class="spoiler">  <b class="spoiler_title">app.icf</b> <div class="spoiler_text"><pre> <code class="cpp hljs">[S3E] DataDirIsRAM=<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br></div></div><br>  As a result, the data directory, which previously contains read-only resource files, becomes writable.  This feature is cross-platform and we can create files to store application settings, both on iOS and on Android.  I will not give implementation of the manager of the stored data as it is trivial.  Anyone can see it <a href="https://github.com/GlukKazan/mf">here</a> . <br><br>  It should be noted that after setting the DataDirIsRAM flag, Marmalade moves the data-gles1 directory containing the compiled group resources from data-ram to data.  This does not affect the work under the debugger, since the directory is created automatically when groups are loaded, but it can lead to the fact that the distribution kit for a mobile device (Android or iPhone) can be mistakenly built with irrelevant resources.  To prevent this from happening, you need to make a simple change to the project's mkb file: <br><br><pre> <code class="diff hljs"> ... - (data-ram/data-gles1, data) + (data-ram/data-gles1, data/data-gles1) locale_en.group.bin locale_ru.group.bin sounds.group.bin</code> </pre><br>  I want to thank <a href="http://habrahabr.ru/users/mezomish/" class="user_link">Mezomish for</a> pointing out this defect. <br><br>  In the next <a href="http://habrahabr.ru/post/162511/">article</a> we will complete the development of the Framework and build a small demo application. <br><br>  The following <a href="http://www.drmop.com/index.php/marmalade-sdk-tutorials/">materials were</a> used in developing the Marmalade Framework <a href="http://www.drmop.com/index.php/marmalade-sdk-tutorials/">.</a> <br></div><p>Source: <a href="https://habr.com/ru/post/161959/">https://habr.com/ru/post/161959/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../161949/index.html">Achievement system (achievements) in Linderdaum Puzzle</a></li>
<li><a href="../161951/index.html">Ping-Pong on AVR</a></li>
<li><a href="../161953/index.html">Apple and Google will buy Kodak patents together</a></li>
<li><a href="../161955/index.html">Individually undertaking? In the cashier!</a></li>
<li><a href="../161957/index.html">Logic - weekly selection of gaming and IT industry news ‚Ññ4</a></li>
<li><a href="../161961/index.html">The dependence of transparency on the orientation of the surface</a></li>
<li><a href="../161965/index.html">Parts prices 10 years ago</a></li>
<li><a href="../161967/index.html">The study of the attitude of popular programming languages ‚Äã‚Äãto random errors</a></li>
<li><a href="../161969/index.html">Inventarium.mobi - we pumped your feedback forms!</a></li>
<li><a href="../161971/index.html">Instant removal of special offers with kindle paperwhite</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>