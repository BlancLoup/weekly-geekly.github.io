<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>C # 4.0 and Variation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Variation has always been too difficult a topic for me to understand. I recently gave a talk about new features of C # 4.0 and the variation was one o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>C # 4.0 and Variation</h1><div class="post__text post__text-html js-mediator-article">  Variation has always been too difficult a topic for me to understand.  I recently gave a <a href="http://joeseymour.blogspot.com/2009/07/san-diego-code-camp-part-2-c-40.html">talk</a> about new features of C # 4.0 and the variation was one of the topics covered by me.  I would like to start with a common script that I have always found hard to understand.  Take this code snippet: <br><br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">IList&lt; <font color="#0000ff">object</font> &gt; stuff = <font color="#0000ff">new</font> <font color="#2B91AF">List</font> &lt; <font color="#0000ff">string</font> &gt;();</font> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <ol><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> IList&lt; <font color="#0000ff">object</font> &gt; stuff = <font color="#0000ff">new</font> <font color="#2B91AF">List</font> &lt; <font color="#0000ff">string</font> &gt;(); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> </ol> <code><font color="gray"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">IList&lt; <font color="#0000ff">object</font> &gt; stuff = <font color="#0000ff">new</font> <font color="#2B91AF">List</font> &lt; <font color="#0000ff">string</font> &gt;();</font> * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  This will not compile in any of the existing versions of the .NET Framework.  I have always tried to understand why this does not work.  The System.String type, of course, satisfies all the requirements of the System.Object.  So why is this not working?  A generalization of a List is a reference type, which means that every time someone refers to an object of this type in code, he will receive a pointer to some place on the heap.  And no matter how many times you use a List, you always get the same link because  This is a reference type.  So, let's develop our previous example: <br><a name="habracut"></a><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  IList &lt; <font color="#0000ff">object</font> &gt; stuff = <font color="#0000ff">new</font> <font color="#2B91AF">List</font> &lt; <font color="#0000ff">string</font> &gt; (); </li><li>  stuff.Add ( <font color="#A31515">"Joe is awesome"</font> ); </li><li>  stuff.Add (9); </li><li>  stuff.Add ( <font color="#0000ff">false</font> ); </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  Here is the problem!  The variable stuff is IList &lt;object&gt;.  So we can add any object to it, including int or bool.  But turn back to what we just arranged - the .NET Framework stores a link to the main type declaration, i.e.  actually on List &lt;string&gt;.  We cannot add int or bool to the list of this type, since these are not string types.  This clarifies something that has interested me for so long.  Let's examine now this code: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#2B91AF">IEnumerable</font> &lt; <font color="#0000ff">object</font> &gt; stuff = <font color="#0000ff">new</font> <font color="#2B91AF">List</font> &lt; <font color="#0000ff">string</font> &gt; (); </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  Currently, as explained earlier, .NET does not allow us to do this.  Wait, do you think this code should work?  Yes, I have to agree.  This code should work because IEnumerable is a special type.  The fact is that this type does not accept modifications.  The only thing IEnumerable is responsible for is returning objects, i.e.  it returns objects (objects coming out).  This sows some doubts about our previous findings.  Here we have an absolutely correct scenario, when you should be able to perform assignments because we will not make any internal modifications and can, therefore, avoid any such typing problems found in the previous example. <br>  Here, IEnumerable &lt;string&gt; can definitely play the role of IEnumerable &lt;object&gt;, because string is the heir from object, which means object is a more general type.  In other words, the type of string is covariant to the type of object.  The only problem is .NET 3.5 and earlier versions do not have a way to resolve this situation.  Switch to .NET 4.0.  Here are a few interface definitions: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li></li><li>  <font color="#0000ff">public</font> <font color="#0000ff">interface</font> <font color="#2B91AF">IEnumerable</font> &lt; <font color="#0000ff">out</font> T&gt;: <font color="#2B91AF">IEnumerable</font> </li><li>  { </li><li>  IEnumerator &lt;T&gt; GetEnumerator (); </li><li>  } </li><li></li><li>  <font color="#0000ff">public</font> <font color="#0000ff">interface</font> IEnumerator &lt; <font color="#0000ff">out</font> T&gt;: IEnumerator </li><li>  { </li><li>  <font color="#0000ff">bool</font> MoveNext (); </li><li>  T Current { <font color="#0000ff">get</font> ;  } </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  The new keyword you see, ‚Äúout‚Äù, determines that we only allow T to be returned from our interface.  This will allow our previous attempts to assign IEnumerable &lt;string&gt; to an IEnumerable &lt;object&gt; because we simply tell the compiler that T will never be passed to our interface. <br><br>  Of course, there is a reverse script when the type is only transferred to your interface.  It is better to demonstrate by looking at the following class: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">class</font> program </li><li>  { </li><li>  <font color="#0000ff">void</font> Manipulate ( <font color="#0000ff">object</font> obj) </li><li>  { </li><li>  } </li><li>  <font color="#0000ff">void</font> ContravariantGoodness () </li><li>  { </li><li>  Action &lt; <font color="#0000ff">object</font> &gt; manipulateObject = Manipulate; </li><li>  Action &lt; <font color="#0000ff">string</font> &gt; manipulateString = Manipulate; </li><li>  manipulateString = manipulateObject; </li><li>  } </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  The only thing that you don‚Äôt see here is that the Action type in C # 4.0 contains the ‚Äúin‚Äù keyword for a generic parameter.  As stated earlier, this will not work in .NET 3.5 or earlier versions.  In this example, the object type is contravariant to the string type because object refers to string as a more general class to a more specific one.  Since in this case the variable is passed as object, we can actually pass anything (almost) into .NET that satisfies this contract, including the type string.  Very cool lotion. <br>  It is necessary to remember the main thing that all this is based on reference types.  Something like this will never work in any of the scenarios: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">public</font> <font color="#0000ff">struct</font> Parent &lt;T&gt; </li><li>  { </li><li>  <font color="#0000ff">public</font> T GetT () </li><li>  { </li><li>  ... </li><li>  } </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  I really see it in .NET 4.0 and I personally think that this is the best new feature added.  Now go and check it out. <br></div><p>Source: <a href="https://habr.com/ru/post/66624/">https://habr.com/ru/post/66624/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../66616/index.html">Entertaining geography</a></li>
<li><a href="../66617/index.html">Bitter experience with smscoin.com</a></li>
<li><a href="../66618/index.html">The history of the development of Pocket FALLOUT</a></li>
<li><a href="../66622/index.html">Insanity in the management of projects</a></li>
<li><a href="../66623/index.html">Script for quick review of information about hard drives</a></li>
<li><a href="../66625/index.html">Story with i-Stor iS607</a></li>
<li><a href="../66627/index.html">Static libraries in the iPhone SDK</a></li>
<li><a href="../66628/index.html">We return to the Opera something for which we love her so much (or once again about the Internet accelerator;)</a></li>
<li><a href="../66629/index.html">Megaphone is not a customer-oriented company or down O'Light</a></li>
<li><a href="../66631/index.html">Small bug: disabling the ability to put the topic pluses \ minuses</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>