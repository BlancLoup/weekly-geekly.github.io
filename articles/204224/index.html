<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Yandex.Tank and load testing automation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="During testing of some products from Positive Technologies, it became necessary to conduct quick stress tests of a single web service. These tests had...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Yandex.Tank and load testing automation</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://habrahabr.ru/company/pt/blog/204224/"><img src="https://habrastorage.org/getpro/habr/post_images/5eb/250/89c/5eb25089cbec595ec3b4106362ca82f5.png" align="left"></a>  During testing of some products from Positive Technologies, it became necessary to conduct quick stress tests of a single web service.  These tests had to be simple and fast in development, undemanding to hardware resources and at the same time give a significant load of the same type HTTP requests, as well as provide statistical data for analyzing the system under load. <br><br>  To implement them, we researched and tested a number of tools, among which were <b>Apache JMeter</b> and the Python script LogSniper, which we wrote in Python, which performed replays of previously prepared server logs with HTTP requests for the target. <a name="habracut"></a><br><br>  It was decided to abandon the use of JMeter due to the considerable complexity of preparing and conducting tests, the high performance requirements of the load stand and the relatively low load capacities, although these disadvantages were compensated for by the high information content of the statistics collected.  LogSniper was rejected due to the low power of the generated load, and here even the simplicity of preparing HTTP load packets could not outweigh.  Other well-known tools, for one reason or another, also did not fit us. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As a result, we stopped at the <b>Yandex.Tank</b> tool, which we learned about, having visited the YAC-2013 conference and talked to Yandex specialists.  This tool fully met all our requirements for ease of preparation of the test and for the generated load. <br><br><h4>  What is it </h4><br>  Yandex.Tank is a load testing tool developed by Yandex and distributed under the LGPL license.  The tool is based on a high-performance asynchronous phantom load generator: it was converted from a web server of the same name, which was ‚Äútaught‚Äù to work in client mode.  With the help of <b>phantom</b> you can generate tens and hundreds of thousands of HTTP requests per second (http-requests per second, <b>http-rps</b> ). <br><br>  In the course of its work, the Tank saves the obtained results in ordinary text logs, grouped in directories for individual tests.  During the test, a special module organizes the output of results to the console interface in the form of tables.  At the same time, a local web server is started, allowing you to see the same results on informative graphs.  At the end of the test, it is possible to automatically save the results on <a href="http://loadosophia.org/">Loadosophia.org</a> .  There is also a module for uploading results to the <a href="http://www.aosabook.org/en/graphite.html">Graphite</a> repository. <br><br>  Some useful links: <br><br><ul><li>  <a href="https://github.com/yandex-load/yandex-tank">project code on GitHub</a> ; </li><li>  <a href="http://yandextank.readthedocs.org/en/latest/">official documentation</a> on setting up and using the tool; </li><li>  <a href="https://github.com/yandex-load/yandex-tank/wiki/%25D0%259C%25D0%25BE%25D0%25B4%25D1%2583%25D0%25BB%25D0%25B8">information about</a> Tank <a href="https://github.com/yandex-load/yandex-tank/wiki/%25D0%259C%25D0%25BE%25D0%25B4%25D1%2583%25D0%25BB%25D0%25B8">modules</a> in the developers wiki; </li><li>  <a href="http://tech.yandex.ru/events/yasubbotnik/msk-jul-2012/talks/296/">presentation</a> on the history of the instrument; </li><li>  <a href="http://habrahabr.ru/company/yandex/blog/202020/">the history of the load testing service</a> in Yandex and the development of Tank; </li><li>  Yandex club dedicated <a href="http://clubs.ya.ru/yandex-tank/">to the use of the tool</a> . </li></ul><br>  Today, we will not dwell on the installation and configuration of the Tank, since this information is easy to find on the network, but we‚Äôll go straight to describing our experience in using it. <br><br><h4>  Performance comparison of two similar web services </h4><br>  In the course of work, we needed to compare the characteristics of two web services, whose work can be roughly described as ‚Äútransparent HTTP proxies that redirect incoming requests to the backend application‚Äù. <br><br>  The general scheme of work can be represented as follows: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/826/9f7/927/8269f7927f92d4c7e53e3802a58fe5fb.png" alt="image"><br><br>  At the stand with the Tank, the phantom load generator was used with the performance monitor turned on. <br><br>  As a web proxy stand, two test web services were used on the scheme, from which performance indicators were taken with the help of the Tank agent.  Let's call them <b>Reference Web service</b> and <b>Test web service</b> .  We needed to understand whether the performance of the test web service corresponds to the reference one. <br><br>  For backend, we used a small web application running under Nginx and returning one simple HTML page. <br><br><h4>  Revealed limitations </h4><br>  Before starting work, we collected information on the limitations of virtual stands on which the entire test infrastructure was built. <br><br>  Backend application stand features: <br><br><ul><li>  8 vCPU, 4 GB, 10 Gb / s, </li><li>  nginx web server. </li></ul><br>  The maximum return of the server, which was achieved, was ~ 25,000 http-rps, but even with a load above 25k http-rps, the work of the stand was not disrupted. <br><br>  The stand of the Tank with the characteristics of 16 vCPU, 8 GB, 10 Gb / s allowed to realize the load up to 300 000 http-rps. <br><br>  The throughput of the ESXi virtual environment, determined using Iperf, was 8 Gb / s in one direction, 4 Gb / s with a two-way load between two virtual machines. <br><br><h4>  Metrics and comparison criteria </h4><br>  Before starting work, we determined the following metrics for each load profile for further measurement: <br><br><ul><li>  <b>http_rps_out</b> - the http-rps value sent from Tank to the web application, </li><li>  <b>http_rps_in</b> - the http-rps value received on Tank by the web application, </li><li>  <b>http_request_size</b> - http request size in bytes, </li><li>  <b>send_requests</b> - the number of sent HTTP requests, </li><li>  <b>bs_out - bytes per seconds</b> , bytes per second - the parameter determines the speed of sending data from the Tank, </li><li>  <b>bs_in</b> - bs value sent from the web application to Tank, </li><li>  <b>test_time</b> - test time in seconds </li><li>  <b>response_time_med</b> is the average time at which 90% of all responses fit. </li></ul><br>  Knowing the number of HTTP requests and their size, we find that <b>bs</b> and <b>http-rps</b> are related by the formula: <b>bs = http_rps * http_request_size</b> . <br><br>  In this case, we decided to choose the following criteria for comparing the performance of web services under load: <br><br><ol><li>  For the entire time of the test, the value of the parameter ‚Äútime within which 90% of responses fit in‚Äù for a web service under test should be no more than that of the reference web service. </li><li>  On the segment of increasing load on the next 1000 http-rps, the value of the parameter ‚Äútime in which 90% of responses fit‚Äù in the tested web service should be no more than that of the reference web service. </li><li>  For the entire test time, the total number of correctly processed requests for the tested web service should be no less than that of the reference web service. </li></ol><br>  Similarly, you can define other criteria load tests for any projects. <br><br><h4>  Test HTTP requests </h4><br>  For one of the stress test profiles, we needed to create mixed HTTP traffic from GET and POST requests with a linear increase in load up to 10k http-rps within 10 minutes. <br><br><div class="spoiler">  <b class="spoiler_title">HTTP requests included in the cartridge of Yandex.Tank</b> <div class="spoiler_text"><pre><code class="perl hljs">GET /loadtest/index.php?id=<span class="hljs-number"><span class="hljs-number">1</span></span>&amp;login=user&amp;pwd=password HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> X-Sniffer-Forwarded-For: yandex-tank-example-domain.ptsecurity.ru Host: backend-example-domain.ptsecurity.ru User-Agent: Mozilla/<span class="hljs-number"><span class="hljs-number">5.0</span></span> (compatible; Googlebot/<span class="hljs-number"><span class="hljs-number">2.1</span></span>; +http:<span class="hljs-regexp"><span class="hljs-regexp">//www</span></span>.google.com/bot.html) POST /loadtest/index.php HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> X-Sniffer-Forwarded-For: yandex-tank-example-domain.ptsecurity.ru Host: backend-example-domain.ptsecurity.ru User-Agent: Mozilla/<span class="hljs-number"><span class="hljs-number">5.0</span></span> (compatible; Googlebot/<span class="hljs-number"><span class="hljs-number">2.1</span></span>; +http:<span class="hljs-regexp"><span class="hljs-regexp">//www</span></span>.google.com/bot.html) Content-Length: <span class="hljs-number"><span class="hljs-number">32</span></span> id=<span class="hljs-number"><span class="hljs-number">1</span></span>&amp;login=user&amp;pwd=password POST /loadtest/index.php HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> X-Sniffer-Forwarded-For: yandex-tank-example-domain.ptsecurity.ru Content-Type: multipart/form-data; boundary=validFile Host: backend-example-domain.ptsecurity.ru User-Agent: Mozilla/<span class="hljs-number"><span class="hljs-number">5.0</span></span> (compatible; Googlebot/<span class="hljs-number"><span class="hljs-number">2.1</span></span>; +http:<span class="hljs-regexp"><span class="hljs-regexp">//www</span></span>.google.com/bot.html) Content-Length: <span class="hljs-number"><span class="hljs-number">150</span></span> --validFile Content-Disposition: form-data; name=<span class="hljs-string"><span class="hljs-string">"login"</span></span>; filename=<span class="hljs-string"><span class="hljs-string">"validFile.txt"</span></span> Content-Type: text/plain Valid file content --validFile--</code> </pre> </div></div><br>  To simplify the preparation of the patron for such a mixed traffic, we have made scripts similar to the <a href="">perl scripts</a> offered on the forum. <br><br><h4>  Data collection and analysis of results </h4><br>  After preparing the requests, we simply launched the Tank in the standard way and performed a load test with mixed traffic for both tested web services. <br><br><h5>  Results for reference web service </h5><br>  Tank's web monitor information: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6c7/d7b/e58/6c7d7be58cc2585e3f99444ffe06bffa.jpg" alt="image"><br><br>  Tank console information: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/698/503/d5e/698503d5efae1a33e778231e1cb96974.jpg" alt="image"><br><br><h5>  Results for the tested web service </h5><br>  Tank's web monitor information: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eda/3c9/950/eda3c9950fe58e19a69d4bfe691eaeb1.jpg" alt="image"><br><br>  Tank console information: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/91f/cd4/8d2/91fcd48d2918d95089ecebabf3913b74.jpg" alt="image"><br><br>  Even judging by the graphs, the test service showed results no worse than the reference one.  Having checked all three criteria formally defined above, we were convinced of this. <br><br><ol><li>  The tested service satisfies the first criterion, since for 90% of requests the average response time for the tested service did not exceed the same indicator for the reference service. </li><li>  The requirement of the second criterion was met for each stage of the load. </li><li>  Judging by the analysis of the status codes of the responses recorded in the Tank journals, the web service subject received and correctly processed the requests more than the reference web service. </li></ol><br><h4>  findings </h4><br>  According to the results of working with Yandex.Tank, you can declare with full responsibility that this tool is excellent in cases where you need to quickly conduct load testing of web applications without their complicated preparation and at the same time get a lot of useful statistical data for performance analysis. <br><br>  In addition, it is well embedded in existing automation systems.  For example, to simplify the work with the Tank booth - control, launch, preparation of cartridges for tapes, control over the testing process and collection of results - we effortlessly wrote a class-binding in Python that connects to the stand via SSH and performs all of the above actions.  This class was then built into our existing auto-testing system. <br><br>  Additionally, you can see how to <a href="http://tech.yandex.ru/events/yac/2013/talks/1122/">connect and use the</a> high-performance Graphit system for analyzing a large number of graphs (described in one of the presentations at the YAC-2013 conference).  It can also be adapted for the needs of load testing using Yandex.Tank. <br><br>  I express my gratitude to my colleague Oleg Kashtanov for technical support. <br><br>  <b>Author</b> : Timur Gilmullin ( <a href="http://forworktests.blogspot.ru/">blog</a> ). </div><p>Source: <a href="https://habr.com/ru/post/204224/">https://habr.com/ru/post/204224/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../204208/index.html">Friday cheat</a></li>
<li><a href="../204214/index.html">05 Collector: links for designers and developers</a></li>
<li><a href="../204216/index.html">RAD Studio XE5 for effective programming training</a></li>
<li><a href="../204218/index.html">MNP - what do we have today?</a></li>
<li><a href="../204220/index.html">Computer design of new materials</a></li>
<li><a href="../204226/index.html">Nokia: Connecting Planets</a></li>
<li><a href="../204228/index.html">Simple publication of geodata on your own map based on 2GIS</a></li>
<li><a href="../204230/index.html">Winners of WEB READY 2013</a></li>
<li><a href="../204234/index.html">Is it worth optimizing image processing in C ++ using SIMD?</a></li>
<li><a href="../204236/index.html">OpenVX: computer vision standard</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>