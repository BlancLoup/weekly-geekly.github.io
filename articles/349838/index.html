<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The story of the internet in Germany and the undocumented features of Juniper SRX</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 While the idea of ‚Äã‚Äãthe second part of the article about moving to Germany gradually acquires clear outlines, I decided to tell a little abo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The story of the internet in Germany and the undocumented features of Juniper SRX</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br><br>  While the idea of ‚Äã‚Äãthe second part of the <a href="https://habrahabr.ru/post/343914/">article about moving to Germany</a> gradually acquires clear outlines, I decided to tell a little about how I set up the home Internet here for my specific IT needs. <br><br>  Internet in Germany is a thing in itself.  There is no Ethernet, and even more so PON, in apartments here in 99% of cases is not carried out.  Optics, at least to the basement, are also rare luxury.  The market here is divided between providers offering the Internet on various xDSL technologies, and cable TV operators, distributing the Internet via DOCSIS.  The lines, as a rule, are in good condition, and the speed can be obtained quite comparable with the "traditional" methods of connection. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      All this is good and quite enough for most home users, but as soon as you want to connect your own router, problems begin.  If you also use IP-telephony, VPN and other similar things, everything becomes completely sad.  What is for DSL, that for DOCSIS, the choice of routers is extremely limited here, and when connected, providers issue the most widely used ‚Äúsoap dishes‚Äù, many of which simply do not know how to work in bridge mode.  That is, you have to either additionally buy an expensive modem, or set up your router for NAT, or abandon the idea altogether.  <a href="https://www.juniper.net/documentation/en_US/release-independent/junos/topics/concept/services-gateway-srx100-description.html">After tormenting</a> some time in trying to ‚Äúmake friends‚Äù with your <a href="https://www.juniper.net/documentation/en_US/release-independent/junos/topics/concept/services-gateway-srx100-description.html">Juniper SRX100</a> and provider <a href="https://avm.de/produkte/fritzbox/fritzbox-7590/">Fritz! Box 7590</a> , I did some research and at a very good price I bought <a href="https://www.juniper.net/us/en/products-services/security/srx-series/srx220/">Juniper SRX220H</a> on eBay, and MPIM - VDSL2 modem module, <a href="https://www.juniper.net/documentation/en_US/release-independent/junos/topics/concept/mini-pim-vdsl2-srx-series-overview.html">SRX-MP-1VDSL2-A</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pb/nb/ow/pbnbowcvg5lofznjgqe1uehtwvo.jpeg"></div><br>  But then begin the tricks. <br><a name="habracut"></a><br>  As follows from the description, this module supports VDSL2 Annex A (that is, VDSL over POTS), while in Germany, VDSL2 Annex B (VDSL over ISDN) is widely used.  There are no modules for Annex B for Juniper SRX in nature; support for this standard is stated only for Juniper SRX110 embedded interfaces.  Moreover, the Juniper technical documentation <a href="https://kb.juniper.net/InfoCenter/index%3Fpage%3Dcontent%26id%3DKB31818%26actp%3DRSS">clearly and clearly states</a> that VDSL Vectoring (cable interference suppression mode) actively used in Germany is not supported for VDSL2 Annex B, even in SRX110.  Dead end?  Not at all.  A familiar networker from D√ºsseldorf, having a little less than dofig Juniper certificates, explained to me that the chips on which these modules are built support VDSL2-B by themselves.  But, since these solutions were ‚Äúsharpened‚Äù for the most part under the US market, where Annex A is commonly used, they were not tested on European networks since Annex B.  Following the Juniper logic, ‚Äúnot tested‚Äù means ‚Äúnot supported.‚Äù <br><br>  Another feature is that VDSL Vectoring is supported only in the latest modem firmware, version 2.16, my module came with firmware version 2.10.  Not having found the firmware in open access, I <a href="https://forums.juniper.net/t5/SRX-Services-Gateway/SRX220-SRX-MP-1VDSL2-A-and-VDSL-Vectoring/m-p/318962">wrote to the Juniper forum</a> , and on the same day, the tech support sent me the desired firmware - absolutely free.  Manual for updating the firmware is <a href="https://www.juniper.net/documentation/en_US/junos/topics/task/configuration/vdsl-pic-firmware-upgrade-procedure.html">here</a> , it is quite trivial. <br><br>  Okay, enough of the lyrics.  Below is an example of setting up the SRX-MP-1VDSL2-A on the SRX220H router for the Vodafone provider.  In principle, this will work for any provider that uses PPP through VDSL2 Annex B, only the credentials will need to be substituted.  Go: <br><br>  1. Check the firmware version of the VDSL modem: <br><br> <code>vlad@fra&gt; show system firmware <br> Part Type Tag Current Available Status <br> version version <br> FPC 2 <br> PIC 0 VDSLBCM 10 <b><u>2.16.0</u></b> OK <br> Routing Engine 0 RE BIOS 0 2.8 2.8 OK <br> Routing Engine 0 RE BIOS Backup 1 2.8 2.8 OK</code> <br> <br>  2. Configure the VDSL interface.  It's all very simple.  The Vlan number used in Germany by the overwhelming majority of providers is 7: <br><br><pre> <code class="hljs pgsql">pt<span class="hljs-number"><span class="hljs-number">-2</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> { vlan-tagging; vdsl-<span class="hljs-keyword"><span class="hljs-keyword">options</span></span> { vdsl-profile auto; } unit <span class="hljs-number"><span class="hljs-number">0</span></span> { encapsulation ppp-<span class="hljs-keyword"><span class="hljs-keyword">over</span></span>-ether; vlan-id <span class="hljs-number"><span class="hljs-number">7</span></span>; } }</code> </pre> <br>  <u><b>Important:</b></u> do not specify the VDSL profile, leave the auto!  If you specify it explicitly, for example, 17a for a speed of 100 Mbps, the modem will rise to Annex A, and synchronization with the DSLAM will not work. <br><br>  3. Configure the PPPoE interface: <br><br><pre> <code class="hljs pgsql">pp0 { unit <span class="hljs-number"><span class="hljs-number">0</span></span> { ppp-<span class="hljs-keyword"><span class="hljs-keyword">options</span></span> { chap { <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-chap-secret "$SuperSecretPassword"; ## SECRET-DATA <span class="hljs-keyword"><span class="hljs-keyword">local</span></span>-<span class="hljs-type"><span class="hljs-type">name</span></span> vodafone-vdsl.komplett/ab12345678; passive; } } pppoe-<span class="hljs-keyword"><span class="hljs-keyword">options</span></span> { underlying-interface pt<span class="hljs-number"><span class="hljs-number">-2</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0.0</span></span>; idle-timeout <span class="hljs-number"><span class="hljs-number">0</span></span>; auto-reconnect <span class="hljs-number"><span class="hljs-number">5</span></span>; client; } <span class="hljs-keyword"><span class="hljs-keyword">family</span></span> <span class="hljs-type"><span class="hljs-type">inet</span></span> { mtu <span class="hljs-number"><span class="hljs-number">1400</span></span>; negotiate-address; } } }</code> </pre> <br>  Here, too, has its own nuances.  For each provider, they are different, but specifically for Vodafone - in the paper with the credentials that you receive when you connect, the login for PPPoE is given in the form ab12345678.  This is enough for local ‚Äúshared‚Äù routers, because when they are configured, the provider must be selected, and depending on it, the router itself forms the configuration.  But with fully manual configuration on non-standard equipment, as in our case, the correct login string will be like this: "vodafone-vdsl.komplett / ab12345678". <br><br>  4. That's all.  Register security zones, commit, and check: <br><br> <code>vlad@fra&gt; show interfaces pt-2/0/0 media <br> Physical interface: pt-2/0/0, Enabled, Physical link is Up <br> Interface index: 148, SNMP ifIndex: 533 <br> Type: PTM, Link-level type: Ethernet, MTU: 1518, VDSL mode, Speed: VDSL2 <br> Device flags : Present Running <br> CoS queues : 8 supported, 8 maximum usable queues <br> Current address: 48:a0:52:b9:62:51 <br> Last flapped : 2018-02-23 00:36:23 CET (17:11:57 ago) <br> Input rate : 0 bps (0 pps) <br> Output rate : 376 bps (0 pps) <br> VDSL alarms : None <br> VDSL defects : None <br> VDSL status: <br> Modem status : <u><b>Showtime (Profile-17a)</b></u> <br> VDSL profile : <u><b>Auto Annex B</b></u> <br> Last fail code: None <br> Subfunction : 0x00 <br> Seconds in showtime : 61918 <br> <br> vlad@fra&gt; show pppoe interfaces <br> pp0.0 Index 95 <br> State: Session up, Session ID: 111, <br> Service name: None, <br> Session AC name: BGEJ00, Configured AC name: None, <br> Remote MAC address: a0:4d:2c:54:92:d6, <br> Session uptime: 17:12:02 ago, <br> Auto-reconnect timeout: 5 seconds, Idle timeout: Never, <br> Underlying interface: pt-2/0/0.0 Index 94</code> <br> <br>  5. Profit.  Now we have a direct connection of the router to the provider, with an external IP on the interface, without any intermediate devices and additional NATs.  At the same time, Juniper keeps the connection much more stable than the Fritz! Box - that once every two or three days there was a synchronization failure, and after installing the SRX220 such problems are no longer observed. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tu/2x/3a/tu2x3azasmeidopyjgcndx7flrq.jpeg" width="800"></div><br>  PS Alarm is on because I changed the circuit for turning on the coolers and powered them through a separate controller to reduce noise.  In JunOS there is a trigger for low revolutions of the coolers, it actually works.  The temperature at the same time remains within the normal range. <br><br>  PPS Owl on the router - the work of my sister.  We have a lot of owls in the apartment :) </div><p>Source: <a href="https://habr.com/ru/post/349838/">https://habr.com/ru/post/349838/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../349824/index.html">Drop Stack Overflow: What Happened</a></li>
<li><a href="../349826/index.html">Sleight of hand and no fraud: practical tips on accelerated design training for developers</a></li>
<li><a href="../349830/index.html">Personal experience: a selection of materials about the virtual infrastructure, information security and trends in the IaaS market</a></li>
<li><a href="../349832/index.html">Alternative to paid off ads in the free Android application</a></li>
<li><a href="../349836/index.html">Understanding Dependencies</a></li>
<li><a href="../349840/index.html">iPaaS - cloud ESB ... or not?</a></li>
<li><a href="../349842/index.html">Check Point Technical Support (TAC). Quick Start Guide</a></li>
<li><a href="../349844/index.html">Microsatellites for Earth Remote Sensing</a></li>
<li><a href="../349852/index.html">Extension methods for .NET standard library types</a></li>
<li><a href="../349854/index.html">Migrate API and what it eat. On the example of the migration of the forum Drupal 7. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>