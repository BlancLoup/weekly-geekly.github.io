<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Software creation of a type library</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Software creation of a type library 


 The TLB type library can store information about the capabilities of COM components: classes, interfaces, meth...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Software creation of a type library</h1><div class="post__text post__text-html js-mediator-article"><h1 id="programmnoe-sozdanie-biblioteki-tipov">  Software creation of a type library </h1><br><p> The TLB type library can store information about the capabilities of COM components: classes, interfaces, methods, parameter types, and return values.  In practical programming guides, COM components usually tell you how to create a type library manually using the midl.exe <code>midl.exe</code> , but today we will look at how to do this programmatically through the <code>ICreateTypeLib2</code> and <code>ICreateTypeInfo2</code> . </p><br><p>  FreeBASIC will be the ‚Äúprogramming language‚Äù. </p><a name="habracut"></a><br><h2 id="interfeysy">  Interfaces </h2><br><p>  In fribysika, there is no <code>Interface</code> keyword for declaring interfaces, but we will cope with this task with our bare hands.  To demonstrate the seriousness of intentions, we will build a natural fraction interface and look at all the stages of building interfaces from scratch. </p><br><p>  Simplify the concept of the interface to a set of functions that should be implemented. </p><br><h3 id="interfeys-kak-tip-dannyh">  Interface as a data type </h3><br><p>  Define the class of natural fraction.  Such a class must have properties that specify the numerator and denominator, and we will also add the addition of fractions there.  Since we will later need to have access from the inherited object to the implemented functions, this means that such a set should consist of pointers to our future functions.  Wrap them in the structure: </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> IRational Dim GetNumerator <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span>()<span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-type"><span class="hljs-type">Integer</span></span> Dim SetNumerator <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> Sub(ByVal Numerator <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-type"><span class="hljs-type">Integer</span></span>) Dim GetDenominator <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span>()<span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-type"><span class="hljs-type">Integer</span></span> Dim SetDenominator <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> Sub(ByVal Denominator <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-type"><span class="hljs-type">Integer</span></span>) Dim AddRational <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> Sub(ByVal pRational <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> IRational Ptr) <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span></code> </pre> <br><h3 id="dobavlenie-konteksta-vyzova">  Add call context </h3><br><p>  So that the functions of the interface know which object calls them, we add the first parameter to the pointer to the object that implements our interface: </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> IRational Dim GetNumerator <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span>(ByVal this <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> IRational Ptr)<span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-type"><span class="hljs-type">Integer</span></span> Dim SetNumerator <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> Sub(ByVal this <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> IRational Ptr, ByVal Numerator <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-type"><span class="hljs-type">Integer</span></span>) Dim GetDenominator <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span>(ByVal this <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> IRational Ptr)<span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-type"><span class="hljs-type">Integer</span></span> Dim SetDenominator <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> Sub(ByVal this <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> IRational Ptr, ByVal Denominator <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-type"><span class="hljs-type">Integer</span></span>) Dim AddRational <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> Sub(ByVal this <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> IRational Ptr, ByVal pRational <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> IRational Ptr) <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span></code> </pre> <br><h3 id="tablica-virtualnyh-metodov">  Virtual method table </h3><br><p>  In practice, the set of interface functions is separated into a separate structure, which is now called a virtual method table, and in the interface itself, a link to it is left.  The name VirtualTable is often shortened to Vtable or even Vtbl: </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> IRationalVirtualTable Dim GetNumerator <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span>(ByVal this <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> IRational Ptr)<span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-type"><span class="hljs-type">Integer</span></span> Dim SetNumerator <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> Sub(ByVal this <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> IRational Ptr, ByVal Numerator <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-type"><span class="hljs-type">Integer</span></span>) Dim GetDenominator <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span>(ByVal this <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> IRational Ptr)<span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-type"><span class="hljs-type">Integer</span></span> Dim SetDenominator <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> Sub(ByVal this <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> IRational Ptr, ByVal Denominator <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-type"><span class="hljs-type">Integer</span></span>) Dim AddRational <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> Sub(ByVal this <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> IRational Ptr, ByVal pRational <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> IRational Ptr) <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> IRational Dim lpVtbl <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> IRationalVirtualTable Ptr <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span></code> </pre> <br><h3 id="razreshenie-ciklicheskih-ssylok">  Allow circular references </h3><br><p>  We are trying to compile everything, but for some reason the compiler resists such code.  The fact is that the virtual table <code>IRationalVirtualTable</code> refers to the <code>IRational</code> interface declared later, and the <code>IRational</code> interface refers to the virtual table <code>IRationalVirtualTable</code> , and as they do not change places, they do not stop referencing each other.  The additional name for our interface entered by the <code>Type</code> operator will help to get out of the situation, and add the underscore to the name of the original interface: </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> IRational <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> IRational_ <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> IRationalVirtualTable Dim GetNumerator <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span>(ByVal this <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> IRational Ptr)<span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-type"><span class="hljs-type">Integer</span></span> Dim SetNumerator <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> Sub(ByVal this <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> IRational Ptr, ByVal Numerator <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-type"><span class="hljs-type">Integer</span></span>) Dim GetDenominator <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span>(ByVal this <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> IRational Ptr)<span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-type"><span class="hljs-type">Integer</span></span> Dim SetDenominator <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> Sub(ByVal this <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> IRational Ptr, ByVal Denominator <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-type"><span class="hljs-type">Integer</span></span>) Dim AddRational <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> Sub(ByVal this <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> IRational Ptr, ByVal pRational <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> IRational Ptr) <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> IRational_ Dim lpVtbl <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> IRationalVirtualTable Ptr <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span></code> </pre> <br><p>  Well, now, the definition of our interface is ready. </p><br><h2 id="cominterfeysy">  COM interfaces </h2><br><p>  All COM technology is built on interfaces.  All COM interfaces are built according to the principle described above, but with additional restrictions: </p><br><ul><li>  all COM interfaces are directly or indirectly inherited from the <code>IUnknown</code> interface; </li><li>  with the exception of the <code>AddRef</code> and <code>Release</code> methods, all procedures and functions must return the <code>HRESULT</code> data type; </li><li>  The ‚Äúreal‚Äù return value is entered by the function into the pointer passed to it by the last parameter. </li></ul><br><p>  In order for our interface to be manipulated not only through the virtual functions table, but also by function names from script programming languages, it is recommended to inherit interfaces not directly from <code>IUnknown</code> , but from <code>IDispatch</code> .  Interfaces that support function calls through the table and <code>IDispatch</code> simultaneously are called dual.  We also change the type of the operands of the functions from <code>Integer</code> to <code>Long</code> to match the types of automation. </p><br><h3 id="guid">  GUID </h3><br><p>  Each interface and implementing class must have unique identifiers.  To do this, use 128-bit numbers calculated by a special algorithm that guarantees uniqueness.  Such numbers are called <code>GUID</code> .  In the header file, the <code>GUID</code> defined as a structure of the same name with the additional names <code>IID</code> (interface identifier) ‚Äã‚Äãand <code>CLSID</code> (class identifier).  You can get the <code>GUID</code> through the <code>guidgen.exe</code> utility or through the <code>CoCreateGuid</code> function.  The <code>GUID</code> program for interfaces and classes are written as follows: </p><br><pre> <code class="hljs pgsql"><span class="hljs-string"><span class="hljs-string">'   IRational '</span></span> {<span class="hljs-number"><span class="hljs-number">4116</span></span>B36A<span class="hljs-number"><span class="hljs-number">-0</span></span>B0D<span class="hljs-number"><span class="hljs-number">-48</span></span>FD<span class="hljs-number"><span class="hljs-number">-8</span></span>DB6-B9867F2A1A37} Dim Shared IID_IRational <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> IID = <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>(&amp;h4116b36a, &amp;hb0d, &amp;h48fd, _ {&amp;h8d, &amp;hb6, &amp;hb9, &amp;h86, &amp;h7f, &amp;h2a, &amp;h1a, &amp;h37}) <span class="hljs-string"><span class="hljs-string">'   Rational,  IRational '</span></span> {DD6C5B70<span class="hljs-number"><span class="hljs-number">-592</span></span>D<span class="hljs-number"><span class="hljs-number">-41</span></span>C1-A391-BCB8C7F7639A} Dim Shared CLSID_Rational <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> CLSID = <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>(&amp;hdd6c5b70, &amp;h592d, &amp;h41c1, _ {&amp;ha3, &amp;h91, &amp;hbc, &amp;hb8, &amp;hc7, &amp;hf7, &amp;h63, &amp;h9a})</code> </pre> <br><h3 id="peredelyvanie-interfeysa-irational-v-comsovmestimyy">  Conversion of the IRational interface to COM-compatible </h3><br><p>  We will change our interface in accordance with these requirements by adding header files and guards from re-enabling the code.  Here is the final <code>IRational.bi</code> header file: </p><br><pre> <code class="hljs smalltalk"><span class="hljs-symbol"><span class="hljs-symbol">#ifndef</span></span> <span class="hljs-type"><span class="hljs-type">IRATIONAL_BI</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#define</span></span> <span class="hljs-type"><span class="hljs-type">IRATIONAL_BI</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#ifndef</span></span> unicode <span class="hljs-symbol"><span class="hljs-symbol">#define</span></span> unicode <span class="hljs-symbol"><span class="hljs-symbol">#endif</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> once <span class="hljs-comment"><span class="hljs-comment">"windows.bi"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> once <span class="hljs-comment"><span class="hljs-comment">"win\ole2.bi"</span></span> <span class="hljs-string"><span class="hljs-string">' {4116B36A-0B0D-48FD-8DB6-B9867F2A1A37} Dim Shared IID_IRational As IID = Type(&amp;h4116b36a, &amp;hb0d, &amp;h48fd, _ {&amp;h8d, &amp;hb6, &amp;hb9, &amp;h86, &amp;h7f, &amp;h2a, &amp;h1a, &amp;h37}) '</span></span> {<span class="hljs-type"><span class="hljs-type">DD6C5B70</span></span><span class="hljs-number"><span class="hljs-number">-592</span></span>D<span class="hljs-number"><span class="hljs-number">-41</span></span>C1-<span class="hljs-type"><span class="hljs-type">A391</span></span>-<span class="hljs-type"><span class="hljs-type">BCB8C7F7639A</span></span>} <span class="hljs-type"><span class="hljs-type">Const</span></span> <span class="hljs-type"><span class="hljs-type">CLSIDS_Rational</span></span> = <span class="hljs-comment"><span class="hljs-comment">"{DD6C5B70-592D-41C1-A391-BCB8C7F7639A}"</span></span> <span class="hljs-type"><span class="hljs-type">Dim</span></span> <span class="hljs-type"><span class="hljs-type">Shared</span></span> <span class="hljs-type"><span class="hljs-type">CLSID_Rational</span></span> <span class="hljs-type"><span class="hljs-type">As</span></span> <span class="hljs-type"><span class="hljs-type">CLSID</span></span> = <span class="hljs-type"><span class="hljs-type">Type</span></span>(&amp;hdd6c5b70, &amp;h592d, &amp;h41c1, _ {&amp;ha3, &amp;h91, &amp;hbc, &amp;hb8, &amp;hc7, &amp;hf7, &amp;h63, &amp;h9a}) <span class="hljs-type"><span class="hljs-type">Type</span></span> <span class="hljs-type"><span class="hljs-type">IRational</span></span> <span class="hljs-type"><span class="hljs-type">As</span></span> <span class="hljs-type"><span class="hljs-type">IRational_</span></span> <span class="hljs-type"><span class="hljs-type">Type</span></span> <span class="hljs-type"><span class="hljs-type">IRationalVirtualTable</span></span> <span class="hljs-string"><span class="hljs-string">'   IDispatch Dim VirtualTable As IDispatchVtbl Dim GetNumerator As Function(ByVal this As IRational Ptr, ByVal pResult As Long Ptr)As HRESULT Dim SetNumerator As Function(ByVal this As IRational Ptr, ByVal Numerator As Long)As HRESULT Dim GetDenominator As Function(ByVal this As IRational Ptr, ByVal pResult As Long Ptr)As HRESULT Dim SetDenominator As Function(ByVal this As IRational Ptr, ByVal Denominator As Long)As HRESULT Dim AddRational As Function(ByVal this As IRational Ptr, ByVal pRational As IRational Ptr)As HRESULT End Type Type IRational_ Dim lpVtbl As IRationalVirtualTable Ptr End Type #endif</span></span></code> </pre> <br><h2 id="biblioteka-tipov">  Type library </h2><br><p>  Our type library will consist of the definition of an <code>IRational</code> interface and the <code>Rational</code> class that implements it. </p><br><h3 id="podgotovitelnyy-etap">  Preparatory stage </h3><br><p>  For the COM environment to work, it must be initialized by calling <code>CoInitialize(0)</code> .  When it is no longer needed, call the appropriate <code>CoUnInitialize()</code> . </p><br><p>  Define the ID of the future library: </p><br><pre> <code class="hljs dos">' {<span class="hljs-number"><span class="hljs-number">23</span></span>F94DA0-<span class="hljs-number"><span class="hljs-number">5</span></span>C11-<span class="hljs-number"><span class="hljs-number">46</span></span>C1-<span class="hljs-number"><span class="hljs-number">9</span></span>F27-<span class="hljs-number"><span class="hljs-number">6</span></span>A3FE27985CF} Dim Shared LIBID_Rational As GUID = <span class="hljs-built_in"><span class="hljs-built_in">Type</span></span>(&amp;h23f94da0, &amp;h5c11, &amp;h46c1, _ {&amp;h9f, &amp;h27, &amp;h6a, &amp;h3f, &amp;he2, &amp;h79, &amp;h85, &amp;hcf})</code> </pre> <br><p>  Since <code>IRational</code> inherited from <code>IDispatch</code> , we need to load the <code>stdole32.tlb</code> library, where <code>ITypeInfo</code> from <code>IDispatch</code> is stored, in order to add a link to it: </p><br><pre> <code class="hljs pgsql">CoInitialize(<span class="hljs-number"><span class="hljs-number">0</span></span>) Dim pIDispatchTypeInfo <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> ITypeInfo Ptr = <span class="hljs-keyword"><span class="hljs-keyword">Any</span></span> Dim pStdOleTypeLib <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> ITypeLib Ptr = <span class="hljs-keyword"><span class="hljs-keyword">Any</span></span> LoadTypeLib("stdole32.tlb", @pStdOleTypeLib) pStdOleTypeLib-&gt;lpVtbl-&gt;GetTypeInfoOfGuid(pStdOleTypeLib, @IID_IDispatch, @pIDispatchTypeInfo) <span class="hljs-string"><span class="hljs-string">' stdole32.tlb    pStdOleTypeLib-&gt;lpVtbl-&gt;Release(pStdOleTypeLib)</span></span></code> </pre> <br><h3 id="sozdanie-biblioteki">  Creating a library </h3><br><p>  You can get the <code>ICreateTypeLib2</code> interface for creating a library using the <code>CreateTypeLib2</code> function.  It takes three parameters: the system type ( <code>SYS_MAC</code> , <code>SYS_WIN16</code> , <code>SYS_WIN32</code> or <code>SYS_WIN64</code> ), the name of the library file, and a pointer to the interface. </p><br><pre> <code class="hljs haskell"><span class="hljs-type"><span class="hljs-type">Dim</span></span> pCreateTypeLib <span class="hljs-type"><span class="hljs-type">As</span></span> <span class="hljs-type"><span class="hljs-type">ICreateTypeLib2</span></span> <span class="hljs-type"><span class="hljs-type">Ptr</span></span> = <span class="hljs-type"><span class="hljs-type">Any</span></span> <span class="hljs-type"><span class="hljs-type">CreateTypeLib2</span></span>(<span class="hljs-type"><span class="hljs-type">SYS_WIN32</span></span>, <span class="hljs-string"><span class="hljs-string">"Rational.tlb"</span></span>, @pCreateTypeLib) '   , <span class="hljs-type"><span class="hljs-type">GUID</span></span>, ,    pCreateTypeLib-&gt;lpVtbl-&gt;<span class="hljs-type"><span class="hljs-type">SetName</span></span>(pCreateTypeLib, <span class="hljs-string"><span class="hljs-string">"Rational"</span></span>) pCreateTypeLib-&gt;lpVtbl-&gt;<span class="hljs-type"><span class="hljs-type">SetGuid</span></span>(pCreateTypeLib, @<span class="hljs-type"><span class="hljs-type">LIBID_Rational</span></span>) pCreateTypeLib-&gt;lpVtbl-&gt;<span class="hljs-type"><span class="hljs-type">SetVersion</span></span>(pCreateTypeLib, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) pCreateTypeLib-&gt;lpVtbl-&gt;<span class="hljs-type"><span class="hljs-type">SetLcid</span></span>(pCreateTypeLib, <span class="hljs-number"><span class="hljs-number">1049</span></span>) '   pCreateTypeLib-&gt;lpVtbl-&gt;<span class="hljs-type"><span class="hljs-type">SetDocString</span></span>(pCreateTypeLib, <span class="hljs-string"><span class="hljs-string">"  "</span></span>)</code> </pre> <br><h3 id="dobavlenie-interfeysa-irational-v-biblioteku">  Adding the IRational Interface to the Library </h3><br><p>  <code>CreateTypeInfo</code> method allows you to add interfaces, classes, modules with functions, enumerations, structures, unions, and aliases to the library.  To do this, it needs to pass one of the values ‚Äã‚Äãof the <code>TYPEKIND</code> enumeration. </p><br><table><thead><tr><th>  Entity Type, TYPEKIND </th><th>  Description </th></tr></thead><tbody><tr><td>  TKIND_ALIAS </td><td>  A type that is an alias for another type. </td></tr><tr><td>  TKIND_INTERFACE </td><td>  Interface with pure virtual functions, that is, those that have no implementation. </td></tr><tr><td>  TKIND_COCLASS </td><td>  Class inherited from interfaces. </td></tr><tr><td>  TKIND_DISPATCH </td><td>  A set of methods and properties available through <code>IDispatch.Invoke</code> .  By default, dual interfaces return <code>TKIND_DISPATCH</code> . </td></tr><tr><td>  TKIND_ENUM </td><td>  Enumeration </td></tr><tr><td>  TKIND_MAX </td><td>  Label ending listing. </td></tr><tr><td>  TKIND_MODULE </td><td>  A module that can contain only static functions and data (for example, a DLL). </td></tr><tr><td>  TKIND_RECORD </td><td>  Structure without methods. </td></tr><tr><td>  TKIND_UNION </td><td>  Combining variables with zero offset. </td></tr></tbody></table><br><p>  We will consider adding only classes and interfaces.  The return value is <code>ICreateTypeInfo</code> to configure the resulting entity. </p><br><pre> <code class="hljs haskell"><span class="hljs-type"><span class="hljs-type">Dim</span></span> pCreateTypeInfoIRational <span class="hljs-type"><span class="hljs-type">As</span></span> <span class="hljs-type"><span class="hljs-type">ICreateTypeInfo</span></span> <span class="hljs-type"><span class="hljs-type">Ptr</span></span> = <span class="hljs-type"><span class="hljs-type">Any</span></span> pCreateTypeLib-&gt;lpVtbl-&gt;<span class="hljs-type"><span class="hljs-type">CreateTypeInfo</span></span>(pCreateTypeLib, @<span class="hljs-type"><span class="hljs-type">IRationalInterfaceName</span></span>, <span class="hljs-type"><span class="hljs-type">TKIND_INTERFACE</span></span>, @pCreateTypeInfoIRational) '  <span class="hljs-type"><span class="hljs-type">IID</span></span>    pCreateTypeInfoIRational-&gt;lpVtbl-&gt;<span class="hljs-type"><span class="hljs-type">SetGuid</span></span>(pCreateTypeInfoIRational, @<span class="hljs-type"><span class="hljs-type">IID_IRational</span></span>) pCreateTypeInfoIRational-&gt;lpVtbl-&gt;<span class="hljs-type"><span class="hljs-type">SetDocString</span></span>(pCreateTypeInfoIRational, @<span class="hljs-string"><span class="hljs-string">"    "</span></span>) '       pCreateTypeInfoIRational-&gt;lpVtbl-&gt;<span class="hljs-type"><span class="hljs-type">SetTypeFlags</span></span>(pCreateTypeInfoIRational, <span class="hljs-type"><span class="hljs-type">TYPEFLAG_FDUAL</span></span> <span class="hljs-type"><span class="hljs-type">Or</span></span> <span class="hljs-type"><span class="hljs-type">TYPEFLAG_FOLEAUTOMATION</span></span>)</code> </pre> <br><p>  For inheritance, you must create a link to the interface ‚Äë father.  A small stick in the wheel: you have to independently monitor the indexes of added links to all fathers. </p><br><pre> <code class="hljs haskell">'   <span class="hljs-type"><span class="hljs-type">IDispatch</span></span> <span class="hljs-type"><span class="hljs-type">Dim</span></span> <span class="hljs-type"><span class="hljs-type">RefType</span></span> <span class="hljs-type"><span class="hljs-type">As</span></span> <span class="hljs-type"><span class="hljs-type">HREFTYPE</span></span> = <span class="hljs-type"><span class="hljs-type">Any</span></span> hr = pCreateTypeInfoIRational-&gt;lpVtbl-&gt;<span class="hljs-type"><span class="hljs-type">AddRefTypeInfo</span></span>(pCreateTypeInfoIRational, pIDispatchTypeInfo, @<span class="hljs-type"><span class="hljs-type">RefType</span></span>) ' <span class="hljs-number"><span class="hljs-number">0</span></span> ‚Äî    hr = pCreateTypeInfoIRational-&gt;lpVtbl-&gt;<span class="hljs-type"><span class="hljs-type">AddImplType</span></span>(pCreateTypeInfoIRational, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-type"><span class="hljs-type">RefType</span></span>) ' <span class="hljs-type"><span class="hljs-type">IDispatchTypeInfo</span></span>    pIDispatchTypeInfo-&gt;lpVtbl-&gt;<span class="hljs-type"><span class="hljs-type">Release</span></span>(pIDispatchTypeInfo)</code> </pre> <br><h3 id="dobavlenie-funkciy-v-interfeys-irational">  Adding features to the IRational interface </h3><br><p>  Functions have parameters and a return value.  Functions are represented by the <code>FUNCDESC</code> structure, and parameters by an array of <code>ELEMDESC</code> structures.  Since all interface functions return <code>HRESULT</code> , you can create a return value for all functions in advance: </p><br><pre> <code class="hljs pgsql">Dim HresultReturnedValue <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> ELEMDESC <span class="hljs-keyword"><span class="hljs-keyword">With</span></span> HresultReturnedValue .tdesc.vt = VT_HRESULT .idldesc.wIDLFlags = IDLFLAG_NONE <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">With</span></span></code> </pre> <br><p>  Here <code>vt</code> specifies one of the <code>VARENUM</code> enumeration <code>VARENUM</code> , and <code>IDLFLAG_NONE</code> indicates that no flags are assigned.  Flags can take a combination of the following values: </p><br><table><thead><tr><th>  Parameter Flags and Return Values </th><th>  Description </th></tr></thead><tbody><tr><td>  IDLFLAG_FIN </td><td>  Incoming parameter. </td></tr><tr><td>  IDLFLAG_FOUT </td><td>  Outgoing parameter, returns information from the called object to the calling object, usually a pointer. </td></tr><tr><td>  IDLFLAG_FRETVAL </td><td>  The ‚Äúreal‚Äù return value of a function is usually combined with the <code>IDLFLAG_FOUT</code> flag. </td></tr><tr><td>  IDLFLAG_NONE </td><td>  Not installed. </td></tr></tbody></table><br><p>  In some cases, an object may have properties.  From the side, the property looks like a variable, but from the inside it is provided with the help of set functions and return values.  Functions can be described by one of the following values: </p><br><table><thead><tr><th>  Kinds of Behavior Functions, INVOKEKIND </th><th>  Description </th></tr></thead><tbody><tr><td>  INVOKE_FUNC </td><td>  Normal function. </td></tr><tr><td>  INVOKE_PROPERTYGET </td><td>  Property returning value. </td></tr><tr><td>  INVOKE_PROPERTYPUT </td><td>  The property that sets the value. </td></tr><tr><td>  INVOKE_PROPERTYPUTREF </td><td>  Property setting value by reference. </td></tr></tbody></table><br><p>  More functions are categorized by implementation: </p><br><table><thead><tr><th>  Kinds of functions for implementation, FUNCKIND </th><th>  Description </th></tr></thead><tbody><tr><td>  FUNC_STATIC </td><td>  Static function with implementation, without call context.  Such functions usually live in a DLL. </td></tr><tr><td>  FUNC_NONVIRTUAL </td><td>  A static member function class with an implementation that internally accepts an implicit call context. </td></tr><tr><td>  FUNC_VIRTUAL </td><td>  A virtual function-member of a class with an implementation that internally accepts an implicit call context. </td></tr><tr><td>  FUNC_PUREVIRTUAL </td><td>  A pure virtual function, internally accepts an implicit call context. </td></tr><tr><td>  FUNC_DISPATCH </td><td>  This feature is available only through <code>IDispatch.Invoke</code> . </td></tr></tbody></table><br><h4 id="funkciya-getnumerator">  GetNumerator function </h4><br><p>  In high-level programming languages, function call contexts (pointer to an object), as well as virtual function tables, are hidden from the programmer and are not taken into account in interfaces, therefore we will not specify them when setting parameters.  We introduce the description of the parameters of the <code>GetNumerator</code> function: </p><br><pre> <code class="hljs pgsql">Const MaxArgumentGetNumeratorNamesLength <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> UINT = <span class="hljs-number"><span class="hljs-number">2</span></span> Const MaxArgumentGetNumeratorLength <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> SHORT = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-string"><span class="hljs-string">'       '</span></span>      ,        <span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>. Dim GetNumeratorArgumentNames(MaxArgumentGetNumeratorNamesLength - <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> WString Ptr = <span class="hljs-keyword"><span class="hljs-keyword">Any</span></span> GetNumeratorArgumentNames(<span class="hljs-number"><span class="hljs-number">0</span></span>) = @"Numerator" GetNumeratorArgumentNames(<span class="hljs-number"><span class="hljs-number">1</span></span>) = @"pResult" <span class="hljs-string"><span class="hljs-string">'   ‚Äî ¬´¬ª   Dim GetNumeratorArguments(MaxArgumentGetNumeratorLength - 1) As ELEMDESC Dim RetvalGetNumerator As TYPEDESC With RetvalGetNumerator .vt = VT_I4 '</span></span>   Long <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">With</span></span> <span class="hljs-keyword"><span class="hljs-keyword">With</span></span> GetNumeratorArguments(<span class="hljs-number"><span class="hljs-number">0</span></span>) .tdesc.vt = VT_PTR <span class="hljs-string"><span class="hljs-string">'  .tdesc.lptdesc = @RetvalGetNumerator '</span></span>    .idldesc.wIDLFlags = IDLFLAG_FOUT <span class="hljs-keyword"><span class="hljs-keyword">Or</span></span> IDLFLAG_FRETVAL <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">With</span></span></code> </pre> <br><p>  Filling in the <code>FUNCDESC</code> structure for the <code>GetNumerator</code> function: </p><br><pre> <code class="hljs pgsql">Dim GetNumeratorDefinition <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> FUNCDESC = <span class="hljs-keyword"><span class="hljs-keyword">Any</span></span> <span class="hljs-keyword"><span class="hljs-keyword">With</span></span> GetNumeratorDefinition .memid = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">'      IDispatch.Invoke,   ‚Äê     .lprgscode = 0 '</span></span>     HRESULT .cScodes = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">'     .lprgelemdescParam = @GetNumeratorArguments(0) '</span></span>      .cParams = MaxArgumentGetNumeratorLength <span class="hljs-string"><span class="hljs-string">'   .cParamsOpt = 0 '</span></span>    .elemdescFunc = HresultReturnedValue <span class="hljs-string"><span class="hljs-string">'   HRESULT .funckind = FUNC_PUREVIRTUAL '</span></span>    .invkind = INVOKE_PROPERTYGET <span class="hljs-string"><span class="hljs-string">'    .callconv = CC_STDCALL '</span></span>    STDCALL .oVft = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">'     ,    FUNC_VIRTUAL .wFuncFlags = 0 End With</span></span></code> </pre> <br><p>  Now the function can be put on the interface.  Here again you have to keep track of the index of the function being added, in our case it is 0: </p><br><pre> <code class="hljs haskell">'    pCreateTypeInfoIRational-&gt;lpVtbl-&gt;<span class="hljs-type"><span class="hljs-type">AddFuncDesc</span></span>(pCreateTypeInfoIRational, <span class="hljs-number"><span class="hljs-number">0</span></span>, @<span class="hljs-type"><span class="hljs-type">GetNumeratorDefinition</span></span>) '     pCreateTypeInfoIRational-&gt;lpVtbl-&gt;<span class="hljs-type"><span class="hljs-type">SetFuncAndParamNames</span></span>(pCreateTypeInfoIRational, <span class="hljs-number"><span class="hljs-number">0</span></span>, @<span class="hljs-type"><span class="hljs-type">GetNumeratorArgumentNames</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-type"><span class="hljs-type">MaxArgumentGetNumeratorNamesLength</span></span>) '    pCreateTypeInfoIRational-&gt;lpVtbl-&gt;<span class="hljs-type"><span class="hljs-type">SetFuncDocString</span></span>(pCreateTypeInfoIRational, <span class="hljs-number"><span class="hljs-number">0</span></span>, @<span class="hljs-string"><span class="hljs-string">" "</span></span>)</code> </pre> <br><h4 id="funkciya-setnumerator">  SetNumerator function </h4><br><p>  Similarly, we define the second part of the <code>Numerator</code> property: </p><br><pre> <code class="hljs pgsql">Const MaxArgumentSetNumeratorNamesLength <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> UINT = <span class="hljs-number"><span class="hljs-number">2</span></span> Const MaxArgumentSetNumeratorLength <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> SHORT = <span class="hljs-number"><span class="hljs-number">1</span></span> Dim SetNumeratorArgumentNames(MaxArgumentSetNumeratorNamesLength - <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> WString Ptr = <span class="hljs-keyword"><span class="hljs-keyword">Any</span></span> SetNumeratorArgumentNames(<span class="hljs-number"><span class="hljs-number">0</span></span>) = @"Numerator" SetNumeratorArgumentNames(<span class="hljs-number"><span class="hljs-number">1</span></span>) = @"Numerator" <span class="hljs-string"><span class="hljs-string">'     Dim SetNumeratorArguments(MaxArgumentSetNumeratorLength - 1) As ELEMDESC With SetNumeratorArguments(0) .tdesc.vt = VT_I4 '</span></span> Long .idldesc.wIDLFlags = IDLFLAG_FIN <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">With</span></span> Dim SetNumeratorDefinition <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> FUNCDESC = <span class="hljs-keyword"><span class="hljs-keyword">Any</span></span> <span class="hljs-keyword"><span class="hljs-keyword">With</span></span> SetNumeratorDefinition .memid = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">'       GetNumerator .lprgscode = 0 .cScodes = 0 .lprgelemdescParam = @SetNumeratorArguments(0) '</span></span>    .cParams = MaxArgumentSetNumeratorLength <span class="hljs-string"><span class="hljs-string">'   .cParamsOpt = 0 .elemdescFunc = HresultReturnedValue .funckind = FUNC_PUREVIRTUAL .invkind = INVOKE_PROPERTYPUT '</span></span>   .callconv = CC_STDCALL .oVft = <span class="hljs-number"><span class="hljs-number">0</span></span> .wFuncFlags = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">With</span></span></code> </pre> <br><p>  To add a function to the interface, you will again have to monitor the indexes manually.  However, in the <code>SetFuncAndParamNames</code> method, <code>SetFuncAndParamNames</code> must specify the index of the previous <code>GetNumerator</code> function, since it is a pair for the property. </p><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">pCreateTypeInfoIRational</span></span>-&gt;lpVtbl-&gt;<span class="hljs-type"><span class="hljs-type">AddFuncDesc</span></span>(pCreateTypeInfoIRational, <span class="hljs-number"><span class="hljs-number">1</span></span>, @<span class="hljs-type"><span class="hljs-type">SetNumeratorDefinition</span></span>) '    <span class="hljs-number"><span class="hljs-number">0</span></span> ‚Äî     pCreateTypeInfoIRational-&gt;lpVtbl-&gt;<span class="hljs-type"><span class="hljs-type">SetFuncAndParamNames</span></span>(pCreateTypeInfoIRational, <span class="hljs-number"><span class="hljs-number">0</span></span>, @<span class="hljs-type"><span class="hljs-type">SetNumeratorArgumentNames</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-type"><span class="hljs-type">MaxArgumentSetNumeratorNamesLength</span></span>) pCreateTypeInfoIRational-&gt;lpVtbl-&gt;<span class="hljs-type"><span class="hljs-type">SetFuncDocString</span></span>(pCreateTypeInfoIRational, <span class="hljs-number"><span class="hljs-number">1</span></span>, @<span class="hljs-string"><span class="hljs-string">" "</span></span>)</code> </pre> <br><p>  Similarly, functions are added to return and set the denominator, with indices 2 and 3. </p><br><h4 id="funkciya-addrational">  AddRational function </h4><br><p>  The <code>AddRational</code> function accepts a parameter of type pointer to <code>IRational</code> .  But there is no such data type in automation, so we replace it with <code>IDispatch</code> : </p><br><pre> <code class="hljs delphi"><span class="hljs-keyword"><span class="hljs-keyword">Const</span></span> MaxArgumentAddRationalLength <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> SHORT = <span class="hljs-number"><span class="hljs-number">1</span></span> Dim AddRationalArguments(MaxArgumentAddRationalLength - <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> ELEMDESC Dim RetvalAddRational <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> TYPEDESC <span class="hljs-keyword"><span class="hljs-keyword">With</span></span> RetvalAddRational .vt = VT_DISPATCH <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">With</span></span> <span class="hljs-keyword"><span class="hljs-keyword">With</span></span> AddRationalArguments(<span class="hljs-number"><span class="hljs-number">0</span></span>) .tdesc.lptdesc = @RetvalAddRational .tdesc.vt = VT_PTR <span class="hljs-string"><span class="hljs-string">' IDispatch Ptr .idldesc.wIDLFlags = IDLFLAG_FIN End With</span></span></code> </pre> <br><p>  In the object browser, the parameter will be visible as <code>Object</code> , and its transmission will follow the link <code>ByRef</code> . </p><br><p>  The definition of the <code>AddRational</code> function <code>AddRational</code> filled in the same way as the previous ones, it only remains to change the type of the function to <code>INVOKE_FUNC</code> , and when putting the function on the interface, specify the index by one more than the previous entity being added, in our case it is 4. You can create a separate variable for the indices and increase it after adding the new an item. </p><br><h3 id="zakrytie-interfeysa-irational">  Closing the IRational Interface </h3><br><p>  We will <code>IRational</code> <code>ITypeInfo</code> interface from <code>IRational</code> so that our future <code>Rational</code> class can be inherited from it: </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">Dim</span></span> pIRationalTypeInfo As ITypeInfo Ptr = Any pCreateTypeInfoIRational-&gt;lpVtbl-&gt;QueryInterface(pCreateTypeInfoIRational, <span class="hljs-variable"><span class="hljs-variable">@IID_ITypeInfo</span></span>, <span class="hljs-variable"><span class="hljs-variable">@pIRationalTypeInfo</span></span>)</code> </pre> <br><p>  After setting up the content of <code>IRational</code> it is necessary to seal all its contents and destroy: </p><br><pre> <code class="hljs lisp">pCreateTypeInfoIRational-&gt;lpVtbl-&gt;LayOut(<span class="hljs-name"><span class="hljs-name">pCreateTypeInfoIRational</span></span>) pCreateTypeInfoIRational-&gt;lpVtbl-&gt;Release(<span class="hljs-name"><span class="hljs-name">pCreateTypeInfoIRational</span></span>)</code> </pre> <br><h3 id="dobavlenie-klassa-rational-v-biblioteku">  Adding a Rational class to a library </h3><br><p>  Adding classes is much faster than interfaces with functions, because here you only need to add to the interface class √† dads: </p><br><pre> <code class="hljs haskell">'   <span class="hljs-type"><span class="hljs-type">Dim</span></span> pCreateTypeInfoRational <span class="hljs-type"><span class="hljs-type">As</span></span> <span class="hljs-type"><span class="hljs-type">ICreateTypeInfo</span></span> <span class="hljs-type"><span class="hljs-type">Ptr</span></span> = <span class="hljs-type"><span class="hljs-type">Any</span></span> pCreateTypeLib-&gt;lpVtbl-&gt;<span class="hljs-type"><span class="hljs-type">CreateTypeInfo</span></span>(pCreateTypeLib, @<span class="hljs-string"><span class="hljs-string">"Rational"</span></span>, <span class="hljs-type"><span class="hljs-type">TKIND_COCLASS</span></span>, @pCreateTypeInfoRational) '  <span class="hljs-type"><span class="hljs-type">GUID</span></span>    pCreateTypeInfoRational-&gt;lpVtbl-&gt;<span class="hljs-type"><span class="hljs-type">SetGuid</span></span>(pCreateTypeInfoRational, @<span class="hljs-type"><span class="hljs-type">CLSID_Rational</span></span>) pCreateTypeInfoRational-&gt;lpVtbl-&gt;<span class="hljs-type"><span class="hljs-type">SetDocString</span></span>(pCreateTypeInfoRational, @<span class="hljs-string"><span class="hljs-string">" "</span></span>) '   <span class="hljs-type"><span class="hljs-type">IRational</span></span> <span class="hljs-type"><span class="hljs-type">Dim</span></span> <span class="hljs-type"><span class="hljs-type">RefType</span></span> <span class="hljs-type"><span class="hljs-type">As</span></span> <span class="hljs-type"><span class="hljs-type">HREFTYPE</span></span> = <span class="hljs-type"><span class="hljs-type">Any</span></span> pCreateTypeInfoRational-&gt;lpVtbl-&gt;<span class="hljs-type"><span class="hljs-type">AddRefTypeInfo</span></span>(pCreateTypeInfoRational, pIRationalTypeInfo, @<span class="hljs-type"><span class="hljs-type">RefType</span></span>) pCreateTypeInfoRational-&gt;lpVtbl-&gt;<span class="hljs-type"><span class="hljs-type">AddImplType</span></span>(pCreateTypeInfoRational, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-type"><span class="hljs-type">RefType</span></span>) pIRationalTypeInfo-&gt;lpVtbl-&gt;<span class="hljs-type"><span class="hljs-type">Release</span></span>(pIRationalTypeInfo) '      pCreateTypeInfoRational-&gt;lpVtbl-&gt;<span class="hljs-type"><span class="hljs-type">LayOut</span></span>(pCreateTypeInfoRational) pCreateTypeInfoRational-&gt;lpVtbl-&gt;<span class="hljs-type"><span class="hljs-type">Release</span></span>(pCreateTypeInfoRational)</code> </pre> <br><h3 id="sohranenie-biblioteki">  Saving Library </h3><br><p>  It's time to save the results to disk: </p><br><pre> <code class="hljs lisp">pCreateTypeLib-&gt;lpVtbl-&gt;SaveAllChanges(<span class="hljs-name"><span class="hljs-name">pCreateTypeLib</span></span>) pCreateTypeLib-&gt;lpVtbl-&gt;Release(<span class="hljs-name"><span class="hljs-name">pCreateTypeLib</span></span>) CoUnInitialize()</code> </pre> <br><h2 id="vyvody">  findings </h2><br><p>  This example shows that you can create type libraries programmatically without knowing the IDL interface definition language and the <code>midl.exe</code> compiler, despite the cumbersome code. </p><br><p>  Using <code>ICreateTypeLib2</code> and <code>ICreateTypeInfo2</code> you can create not only the description of COM interfaces and classes, but also the usual functions from a DLL.  This approach is used in Visual Basic 6 to bind to a DLL through an import table. </p><br><p>  To simplify the code, error checking has been removed.  In serious programs, you should always check the <code>HRESULT</code> return value and take action when something went wrong. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/354648/">https://habr.com/ru/post/354648/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../354636/index.html">Visualization in CAD: why we wrote another 3D engine and how it works</a></li>
<li><a href="../354638/index.html">FIDO2 - Passwords must die</a></li>
<li><a href="../354640/index.html">The history of moving the system administrator in Germany. Part Two: Moving and First Steps</a></li>
<li><a href="../354642/index.html">Conclusion of the Telegram channel on your website</a></li>
<li><a href="../354646/index.html">On the topic of the day: a cross-platform client for Telegram on .NET Core and Avalonia</a></li>
<li><a href="../354650/index.html">Snake layout and "quantum" particles in Android applications (Part 2)</a></li>
<li><a href="../354652/index.html">Developing mobile games is no longer a Padawan, not yet a master</a></li>
<li><a href="../354654/index.html">Positive Hack Days CTF 2018 task seekers: mnogorock, sincity, wowsuchchain, event0</a></li>
<li><a href="../354662/index.html">Management of machine learning projects with high cost of error. Lecture in Yandex</a></li>
<li><a href="../354664/index.html">The digest of interesting materials for the mobile developer # 251 (April 23 - April 29)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>