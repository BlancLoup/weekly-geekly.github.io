<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Girlish joys in the interior - not a pink shelf with Internet radio and RGB lighting</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It remains a couple of weeks before March 8, and if you believe the saying, the shoemaker usually remains without shoes. Similarly, Nadia, a textile d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Girlish joys in the interior - not a pink shelf with Internet radio and RGB lighting</h1><div class="post__text post__text-html js-mediator-article">  It remains a couple of weeks before March 8, and if you believe the saying, the shoemaker usually remains without shoes.  Similarly, Nadia, a textile designer in the interior, lived without comfortable furniture.  Many people know how difficult it is to find in a compact space of a Russian apartment a shelf or bedside table that fits perfectly in size. <br><br><img src="https://habrastorage.org/webt/dx/tj/id/dxtjidvc7axoyohan79wtl-fmug.jpeg"><br><br>  When we went around almost all the shops, it became clear that the easiest way to make such furniture was ourselves.  You can make an individual, not only in size, but also shelf functions and save space in the room. <br><a name="habracut"></a><br>  After discussing what we would do, Nadin and I split up: she armed herself with an electric jigsaw, a screwdriver, paint, and took the remnants of plywood from the loggia.  And I sat down a little later for setting up Raspberry PI and programming. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Who is interested in learning only about setting up Internet radio and software development, I‚Äôll tell you about the secret <a href="https://habr.com/ru/post/349488/">of bcm2835‚Äôs</a> stable <a href="https://habr.com/ru/post/349488/">work with the music daemon</a> , <a href="https://habr.com/ru/post/349488/">Apache Camel and the development of the MPD component</a> for it. <br><br>  Nadine did the most difficult and painstaking part - carpentry, soldering, installation.  I recommend watching the tutorial, which lasts about an hour!  In reality, work for 3-4 hours. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/moxKyWoyYH0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  It all starts with a model or a sketch, a square sheet of plywood 52x52cm is mapped to 2 rectangles 18x52cm.  The rest ~ 15x52cm was also useful on the third shelf. <br><br><div class="spoiler">  <b class="spoiler_title">Cutting is quite simple when there is a jigsaw.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/k3/4k/sm/k34ksmgundlrxoabwi40vkrxtyc.jpeg"><br></div></div><br>  Of course, a circular saw and a linear guide would help cut the plywood faster and smoother, but this is possible only in the workshop. <br><br>  Again, in the winter there are not many options for choosing the type of paint.  It is difficult in the living room to air in the cold, so better odorless water-soluble paint. <br><br>  Nadin tinted the paint, by eye, stirring emerald paint in a white water-emulsion base.  In order not to turn into Peppa and not to splash furniture and walls, it is better to paint a foam sponge at home.  If you paint with a roller or spray, then all the furniture, walls and clothing will be in paint. <br><br><img src="https://habrastorage.org/webt/-4/7e/kq/-47ekqjg8e7qsibbsami04e0dva.jpeg"><br><br>  Soldering LED strip is not difficult if you use a liquid flux based on rosin and apply it to the contacts before tinning with POS-61 solder.  In order for the backlight to work, it is important not to confuse the polarity of the GND power supply wires, + 5V between the tapes.  The contact D (IN) of the tape is supplied with a control signal from the output on the controller SP002E, labeled D. A simpler version without soldering is if you find clamping terminals for the LED tape, but you did not find it on sale in the city of 3x. <br><br>  To power the backlight and speakers, Nadia used a USB speaker wire, soldering the controller to it.  USB powered speakers retail at around 400r.  To isolate the conductors, the heat shrinkable tube and electrical tape also went into action. <br><br><img src="https://habrastorage.org/webt/cn/ax/d-/cnaxd-wdjuloil_dafbxuwflype.jpeg"><br><br>  For assembling the shelves, Nadin used two options of fasteners - wood screws for fixing the corners, Raspberry and glue gun to fix the profile with the LED tape and the speakers on the shelves.  When trying to hang on the wall, the corners were replaced by more durable. <br><br><h2>  LED lighting and Smart pixel RGB (WS2812B) </h2><br>  LED strip with RGB LED chips WS2812B for 500r retail, it took a meter. <br>  Soldering is not difficult: only three wires are used, without a clock signal.  Note that this tape will not work without a controller.  For power, you need any 5V 1A power supply with a USB connector.  By the way, for the control signal on the tape that I had, 3.3V was enough, so it is possible to connect to the GPIO ARM controllers without a level converter. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ze/vz/ye/zevzyezl1yik5tcelbxobfrjnzy.jpeg"></div><br>  You can control the LED strip WS2812B using the <a href="https://github.com/jgarff/rpi_ws281x">Raspberry PI GPIO</a> but there will be problems with playing music through the built-in audio output as the same PWM SoC generator is used as for the audio port.  Therefore, the option was immediately discarded, as not working for Internet radio. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ux/z1/mq/uxz1mq4ic6wfp-dxxlsmstgiiwy.jpeg"></div><br>  It is easier to control this ribbon with the LED controller SP002E with the MK STM8 on board - for 270r in Russian retail.  It will be interesting to try to assemble a controller for this tape on from STM32 stocks with USB connection to transfer pixel values.  Found several library projects on github.  There is an idea to make a light music - I will write it down in my TODO list. <br><a name="mpd"></a><br><h2>  Install and configure Internet radio </h2><br>  You can consider several options for remote music playback: <br><br><ol><li>  Bluetooth A2DP - this is what is implemented in Bluetooth speakers, where audio compression occurs with losses.  This option did not fit, as the Raspberry PI will simply turn into a ‚Äúremote‚Äù speaker, and the music must be ‚Äústreamed‚Äù from <a href="https://www.raspberrypi.org/forums/viewtopic.php%3Ft%3D161944">another device</a> . </li><li>  PulseAudio over the network - the approach is similar to A2DP, but it also requires configuring the <a href="https://wiki.archlinux.org/index.php/PulseAudio/Examples_(%25D0%25A0%25D1%2583%25D1%2581%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9)">module-native-protocol-tcp</a> and the client. </li><li>  Music Player Daemon (MPD) - ideal for offline playback of Internet radio or playlist from a local disk / NAS. </li></ol><br>  Since you need autonomous Internet radio, the choice is MPD!  You can change tracks in MPD, manage playlists and volume from Android clients, such as MPD Control, as well as using desktop applications or a web interface. <br><br>  As I already spoke about bcm2835 and its conflicts with GPIO functions and PWM controller - this is quite a noisy and problematic sound device.  The only advantage is that it is built-in and you do not need to buy USB Audio, which is comparable in cost to Raspberry. <br><br>  You must have configured mixer_type, mixer_device, mixer_control, mixer_index.  Before this was done, the daemon vis when attempting to switch the track and had to restart the process. <br><br>  Installation made on Raspbian under the superuser: <br><br><img src="https://habrastorage.org/webt/1_/km/uy/1_kmuyjs86b8amopx7ptpa-yy5o.png"><br><br>  Run the command: <br><br><pre><code class="bash hljs">apt-get install mpd</code> </pre> <br>  For Raspberry PI 3 embedded audio to work, you need to add parameters to the /etc/mpd.conf configuration: <br><br><pre> <code class="hljs swift">audio_output { type <span class="hljs-string"><span class="hljs-string">"alsa"</span></span> name <span class="hljs-string"><span class="hljs-string">"My ALSA Device"</span></span> device <span class="hljs-string"><span class="hljs-string">"hw:0,0"</span></span> # <span class="hljs-keyword"><span class="hljs-keyword">optional</span></span> mixer_type <span class="hljs-string"><span class="hljs-string">"software"</span></span> # <span class="hljs-keyword"><span class="hljs-keyword">optional</span></span> mixer_device <span class="hljs-string"><span class="hljs-string">"default"</span></span> # <span class="hljs-keyword"><span class="hljs-keyword">optional</span></span> mixer_control <span class="hljs-string"><span class="hljs-string">"PCM"</span></span> # <span class="hljs-keyword"><span class="hljs-keyword">optional</span></span> mixer_index <span class="hljs-string"><span class="hljs-string">"0"</span></span> # <span class="hljs-keyword"><span class="hljs-keyword">optional</span></span> } bind_to_address <span class="hljs-string"><span class="hljs-string">"192.168.1.68"</span></span> port <span class="hljs-string"><span class="hljs-string">"6600"</span></span> auto_update <span class="hljs-string"><span class="hljs-string">"yes"</span></span></code> </pre> <br>  Where "192.168.1.68" is the Raspbery address on the local network. <br><br><img src="https://habrastorage.org/webt/j_/y0/t_/j_y0t_sccpyvtz7my06zcremdso.png"><br><a name="camel"></a><br><h2>  Controlling music from camel-mpd: developing a component for Apache Camel </h2><br>  Java and JVM are quite common automation platforms "Internet of things" on IoT gateways.  Therefore, the development of MPD component for Camel will allow you to integrate music management into existing automation software.  And of course into my favorite <a href="https://habrahabr.ru/post/314898/">alarm for the fridge</a> ! <br><br><div class="spoiler">  <b class="spoiler_title">For those interested in what Apache Camel can do and where ...</b> <div class="spoiler_text"><ul><li>  Apache Camel works great with <a href="https://livebook.manning.com/">Eclipse SmartHome and Kura</a> </li><li>  <a href="https://www.openhab.org/">OpenHub2</a> runs on the Eclipse SmartHome runtime. </li><li>  "How to develop an application for automation <a href="https://habrahabr.ru/post/310784/">almost not knowing how to program</a> ."  This is more about software development for IoT gateways. <br></li></ul><br></div></div><br>  The component code is available in the github repository <a href="https://github.com/igor-suhorukov/camel-mpd">camel-mpd</a> and as an artifact com.github.igor-suhorukov: <a href="">camel-mpd</a> : 1.0 in the central maven repository.  To work with the Music Player Daemon protocol, I chose the net.thejavashop library: <a href="https://github.com/finnyb/javampd">javampd</a> : 6.0.0.  Judging by the committees, this library is maintained, with excellent code quality, judging by the static analysis metrics!  My part of the work is the creation of a camel component, endpoint, as well as the heirs of the producer and consumer. <br><br><h3>  A few words about Camel architecture </h3><br>  The component is an Endpoint factory, the component has an associated protocol / scheme.  Almost everything at Camel - Universal Resource Identifier.  Examples: http, hdfs, smtps, irc, webcam.  Now <b>mpd</b> ! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7y/y1/pr/7yy1prjul3morzjlm4ew2hp_cl8.png"></div><br>  Components are combined into routes (Route) data transformation.  Route is written in one of the available domain-specific language (DSL): java, scala, groovy, spring / blueprint xml <br><br>  Route can be visualized, for example using <br><br><div class="spoiler">  <b class="spoiler_title">hawt.io console.</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/3i/xo/uv/3ixouvgcwd4m8bnaiwfmy8wwfbs.png"></div><br></div></div><br>  A DSL consumer is a ‚Äúfrom‚Äù construction at the beginning of a route. <br>  Producer in DSL is ‚Äúto‚Äù construction <br>  Exchange is the message that is created and processed by the route.  Contains the message body (body) and headers (headers). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dt/g0/ut/dtg0utvvor3kixtei2mqedegrkw.png"></div><br>  You can create an apache camel component using maven: <br><br><pre> <code class="bash hljs">mvn archetype:generate \ -DarchetypeGroupId=org.apache.camel.archetypes \ -DarchetypeArtifactId=camel-archetype-component \ -DarchetypeVersion=2.20.2 \ -DgroupId=myGroupId \ -DartifactId=myArtifactId</code> </pre> <br>  In order for the Apache Camel context to find the component by its protocol, the component class must be specified in the src / main / resources / META-INF / services / org / apache / camel / component / mpd file <br>  class = com.github.igorsuhorukov.mpd.MpdClientComponent <br><br>  The MpdClientComponent class is a factory ‚Äî it creates and initializes instances of the com.github.igorsuhorukov.mpd.MpdEndpoint class.  MpdEndpoint, when requested from route, creates an instance of <b>Consumer</b> , and its messages are passed by the component to Route.  Consumer gives the route values: <br><br><ul><li>  volume - the current value of the volume, in the interval [0,100]. </li><li>  current returns information about the current song. </li><li>  playlist returns a playlist as a list. </li><li>  total - the total duration of the music from the playlist. </li><li>  elapsed - how much time was heard. </li><li>  error message, the last error that occurred. </li></ul><br>  Producer - ends Route in the context of Camel and allows you to give MPD commands: <br><br><ul><li>  play - start playback. </li><li>  stop - stop playback. </li><li>  next - select the next song. </li><li>  previous - start of the previous song. </li><li>  randomize - activates the transition to the next song in random order. </li><li>  unrandomize - enables sequential playback of the playlist. </li><li>  volume - sets the playback volume in the range from 0 to 100 </li><li>  song - allows you to add one or a list of songs to the playlist.  And this is either the path in the file system, or Internet radio via the http protocol.  The message body for this function is either a string or an org.bff.javampd.song.MPDSong object.  Another option is a list of strings or a list of MPDSong objects. </li></ul><br>  You can work with this component through integration with <a href="https://habrahabr.ru/post/276719/">java.net.URL</a> from the <a href="https://github.com/igor-suhorukov/camel-url-handler">camel-url-handler</a> project. <br><br>  While I programmed camel-mpd and edited the video, Nadine was unstoppable and made herself another chair-nightstand. <br><br><div class="spoiler">  <b class="spoiler_title">A photo</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/e7/0z/zx/e70zzx8hqf7curtl2lfqtwesmv0.jpeg"></div><br></div></div><br>  Joking that it would be good to make an analogue of a robot vacuum cleaner out of it.  A new bedside table remains only to wrap with a cloth, which is in her house in prosperity and work with textiles is her strong point. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1-/pv/si/1-pvsi3m8zhl3ymranibgfjlujc.jpeg"></div><br><br><h2>  Almost happy end </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vy/qw/uz/vyqwuz_xnmnzsgar721b5lpdnvw.jpeg"></div><br>  An illuminated shelf was installed in the gap between the window sill and the floor, next to the radiator.  Internet radio works in the background, the backlight sparkles and the cat is happy - there is more room for running on the table.  Things from the table are now located on the shelf.  And I still haven't thought up a gift for March 8, Nadine did almost everything herself ... </div><p>Source: <a href="https://habr.com/ru/post/349488/">https://habr.com/ru/post/349488/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../349476/index.html">‚ÄúWhen I became an Android developer, there was still no place to look for examples‚Äù: interview with David Gonzalez</a></li>
<li><a href="../349478/index.html">[Yekaterinburg, Announcement] Botters of the Galaxy CodingHub in the Contour office</a></li>
<li><a href="../349480/index.html">Why computer chips become faster to "grow old" and what to do about it</a></li>
<li><a href="../349482/index.html">Why Python is so good at scientific computing.</a></li>
<li><a href="../349484/index.html">Media queries in responsive design 2018</a></li>
<li><a href="../349490/index.html">Auto-clean and reload print server print service</a></li>
<li><a href="../349492/index.html">Immer: a new approach to immunity in JavaScript</a></li>
<li><a href="../349494/index.html">Ask the creator of Vue.js a question</a></li>
<li><a href="../349496/index.html">Conduit - lightweight service mesh for Kubernetes</a></li>
<li><a href="../349500/index.html">How many developers and how few programmers ...</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>