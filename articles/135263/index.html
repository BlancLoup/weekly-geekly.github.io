<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>My variant MultipleInput + Autocomplete</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="First of all, I would like to congratulate you on the upcoming holidays! 

 And now to the essence of my story. 

 A few weeks ago I needed to make dr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>My variant MultipleInput + Autocomplete</h1><div class="post__text post__text-html js-mediator-article">  First of all, I would like to congratulate you on the upcoming holidays! <br><br>  And now to the essence of my story. <br><br>  A few weeks ago I needed to make drop-down lists in django.  Values ‚Äã‚Äãshould be loaded automatically as you type, and the user should be able to both choose a value from the list and add his own. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      First, let's see what result we are pursuing: <br><br><img src="https://habrastorage.org/storage2/704/38b/d10/70438bd103de904435400ad20dc5106e.png"><br><a name="habracut"></a><br>  So, the file with the models.  For example, I just created two models and linked them using ManyToManyField. <br><br><h5>  models.py </h5><br><pre><code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">from</span></span> django.db <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> models class City(<span class="hljs-title"><span class="hljs-title">models</span></span>.<span class="hljs-type"><span class="hljs-type">Model</span></span>): name = models.CharField(<span class="hljs-title"><span class="hljs-title">max_length</span></span>=150, <span class="hljs-title"><span class="hljs-title">unique</span></span>=<span class="hljs-type"><span class="hljs-type">True</span></span>) class Country(<span class="hljs-title"><span class="hljs-title">models</span></span>.<span class="hljs-type"><span class="hljs-type">Model</span></span>): name = models.CharField(<span class="hljs-title"><span class="hljs-title">max_length</span></span>=100) cities = models.ManyToManyField(<span class="hljs-type"><span class="hljs-type">City</span></span>, <span class="hljs-title"><span class="hljs-title">blank</span></span>=<span class="hljs-type"><span class="hljs-type">True</span></span>)</code> </pre> <br>  Then I got to learn standard widgets.  <a href="https://code.djangoproject.com/browser/django/trunk/django/forms/widgets.py">MultipleHiddenInput</a> turned out to be the most suitable, but it inherits from HiddenInput and so far has not had the autocomplex function.  File&gt; New let's go. <br><br><h5>  widget.py </h5><br><pre> <code class="hljs python"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.forms.util <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> flatatt <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.utils.datastructures <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> MultiValueDict, MergeDict <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.utils.encoding <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> force_unicode <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MultipleInput</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Input)</span></span></span><span class="hljs-class">:</span></span> input_type = <span class="hljs-string"><span class="hljs-string">'text'</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, attrs=None, choices=</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> super(MultipleInput, self).__init__(attrs) self.choices = choices <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">render</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, name, value, attrs=None, choices=</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> value <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: value = [] final_attrs = self.build_attrs(attrs, type=self.input_type, name=name) id_ = final_attrs.get(<span class="hljs-string"><span class="hljs-string">'id'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>) inputs = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i, v <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumerate(value): input_attrs = dict(value=force_unicode(v), **final_attrs) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> id_: input_attrs[<span class="hljs-string"><span class="hljs-string">'id'</span></span>] = <span class="hljs-string"><span class="hljs-string">'%s_%s'</span></span> % (id_, i) inputs.append(<span class="hljs-string"><span class="hljs-string">u'&lt;p&gt;&lt;input%s /&gt;&lt;a href="#" id="remove_%s"&gt;Remove&lt;/a&gt;&lt;/p&gt;'</span></span> % (flatatt(input_attrs), id_)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mark_safe(<span class="hljs-string"><span class="hljs-string">u'\n'</span></span>.join(inputs)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">value_from_datadict</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, data, files, name)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(data, (MultiValueDict, MergeDict)): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data.getlist(name) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data.get(name, <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>)</code> </pre><br>  What I've done?  I took the standard MultipleHiddenInput, inherited it from Input and changed inputs.append.  As you can see, almost nothing has changed.  In inputs.append is the html code needed to delete the records on the user side.  For what it is necessary you can understand below, when I will describe the forms.py file. <br><br>  Now form.  For the cities field, set the previously written MultipleInput widget.  Also, the widget can notice the attribute 'class' with the value 'autocompleteCity'.  Already by the name it is clear that this is necessary for the future autocomplex. <br>  In view of the changing behavior of the ManyToManyField bundle, it became necessary to redefine __init__ in the form.  Here we check for duplicates and delete them, keeping the order of the elements. <br>  If the form was submitted with errors, it is at this point that __init__ helps us, it saves all the values ‚Äã‚Äãfor cities and sends them back to the user. <br><br><h5>  forms.py </h5><br><pre> <code class="hljs python"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> forms <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> myapp.widget <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> MultipleInput <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CreateCountryForm</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(forms.Form)</span></span></span><span class="hljs-class">:</span></span> name = forms.CharField(widget=forms.TextInput(), required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) cities = forms.CharField(widget=MultipleInput(attrs={<span class="hljs-string"><span class="hljs-string">'class'</span></span> : <span class="hljs-string"><span class="hljs-string">'autocompleteCity'</span></span>}), required=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, *args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> super(CreateCountryForm, self).__init__(*args, **kwargs) s = kwargs.get(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> s: cities = s.getlist(<span class="hljs-string"><span class="hljs-string">'cities'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(len(cities)<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cities.count(cities[i]) != <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">del</span></span> cities[i]</code> </pre><br>  It remains to write a mapping in order to properly save our models.  As well as the second mapping to accept ajax requests for autodog. <br><br><h5>  views.py </h5><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.shortcuts <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> render_to_response <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.http <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HttpResponseRedirect <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.<span class="hljs-keyword"><span class="hljs-keyword">template</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> RequestContext <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> myapp.forms <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> CreateCountryForm <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> myapp.models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> City def create_country(request, form_class=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, template_name=<span class="hljs-string"><span class="hljs-string">'create_country.html'</span></span>): form_class = CreateCountryForm <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> request.<span class="hljs-keyword"><span class="hljs-keyword">method</span></span> == <span class="hljs-string"><span class="hljs-string">'POST'</span></span>: form = form_class(data=request.POST, files=request.FILES) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> form.is_valid(): obj = form.save(<span class="hljs-keyword"><span class="hljs-keyword">commit</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) obj.save() cities = request.POST.getlist(<span class="hljs-string"><span class="hljs-string">'cities'</span></span>) obj.cities.clear() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> cities: city, created = City.objects.get_or_create(c) obj.cities.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(city) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HttpResponseRedirect(<span class="hljs-string"><span class="hljs-string">'index'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: form = form_class() context = { <span class="hljs-string"><span class="hljs-string">'form'</span></span>: form, } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> render_to_response(template_name, context, context_instance=RequestContext(request)) def city_autocomplete(request): try: cities = City.objects.<span class="hljs-keyword"><span class="hljs-keyword">filter</span></span>(name__icontains=request.<span class="hljs-keyword"><span class="hljs-keyword">GET</span></span>[<span class="hljs-string"><span class="hljs-string">'q'</span></span>]).values_list(<span class="hljs-string"><span class="hljs-string">'name'</span></span>, flat=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> MultiValueDictKeyError: pass <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HttpResponse(<span class="hljs-string"><span class="hljs-string">'\n'</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">join</span></span>(cities), mimetype=<span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>)</code> </pre><br>  Well, of course, the url configuration. <br><br><h5>  urls.py </h5><br><pre> <code class="hljs python"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.conf.urls.defaults <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> myapp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> views urlpatterns = patterns(<span class="hljs-string"><span class="hljs-string">''</span></span> url(<span class="hljs-string"><span class="hljs-string">r'^city_autocomplete/$'</span></span>, views.city_autocomplete, name=<span class="hljs-string"><span class="hljs-string">'city_autocomplete'</span></span>), url(<span class="hljs-string"><span class="hljs-string">r'^create_country/$'</span></span>, views.create_stream, name=<span class="hljs-string"><span class="hljs-string">'stream_create_stream'</span></span>), )</code> </pre><br>  We overcame all the most difficult, we proceed to writing a template.  I specifically wrote one template without various kinds of inheritances, just to display the essence.  The example uses <a href="https://github.com/agarzola/jQueryAutocompletePlugin">jQueryAutocompletePlugin</a> for autocomplete. <br><br><h5>  create_country.html </h5><br><pre> <code class="hljs django"><span class="xml"><span class="hljs-meta"><span class="xml"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"ru"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">head</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"https://github.com/agarzola/jQueryAutocompletePlugin/blob/master/jquery.autocomplete.css"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">media</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"all"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"https://github.com/agarzola/jQueryAutocompletePlugin/blob/master/jquery.autocomplete.js"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ MEDIA_URL }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">js/add_and_remove.js"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">head</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">form</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">enctype</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"multipart/form-data"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">""</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">csrf_token</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">label</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"id_name"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">label</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ form.name }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">br</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"#"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"addCity"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"p_cities"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ form.cities }}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="actionscript"><span class="xml"><span class="actionscript"> jQuery().ready(</span></span><span class="hljs-function"><span class="hljs-keyword"><span class="xml"><span class="actionscript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span></span><span class="hljs-params"><span class="xml"><span class="actionscript"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></span><span class="xml"><span class="actionscript"><span class="hljs-function"> </span></span></span></span><span class="xml"><span class="actionscript">{ jQuery(</span></span><span class="hljs-string"><span class="xml"><span class="actionscript"><span class="hljs-string">".autocompleteCity"</span></span></span></span><span class="xml"><span class="actionscript">).autocomplete(</span></span><span class="hljs-string"><span class="xml"><span class="actionscript"><span class="hljs-string">"/city_autocomplete/"</span></span></span></span><span class="xml"><span class="actionscript">, { multiple: </span></span><span class="hljs-literal"><span class="xml"><span class="actionscript"><span class="hljs-literal">false</span></span></span></span><span class="xml"><span class="actionscript"> }); }); </span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">""</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">form</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br>  And for completeness, here is an example of the file add_and_remove.js. <br><br><h5>  add_and_remove.js </h5><br><pre> <code class="hljs javascript">$(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> CitiesDiv = $(<span class="hljs-string"><span class="hljs-string">'#p_cities'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = $(<span class="hljs-string"><span class="hljs-string">'#p_cities p'</span></span>).size(); $(<span class="hljs-string"><span class="hljs-string">'#addCity'</span></span>).live(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'&lt;p&gt;&lt;input class="autocompleteCity ac_input" type="text" id="id_cities_'</span></span> + i +<span class="hljs-string"><span class="hljs-string">'" size="20" name="cities" placeholder="Input Value" autocomplete="off" /&gt;&lt;a href="#" id="remove_id_cities"&gt;Remove&lt;/a&gt;&lt;/p&gt;'</span></span>).appendTo(CitiesDiv); $(<span class="hljs-string"><span class="hljs-string">'#id_cities_'</span></span> + i).focus(); i++; jQuery(<span class="hljs-string"><span class="hljs-string">".autocompleteCity"</span></span>).autocomplete(<span class="hljs-string"><span class="hljs-string">"/city_autocomplete/"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">multiple</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }); $(<span class="hljs-string"><span class="hljs-string">'#remove_id_cities'</span></span>).live(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( i &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) { $(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).parents(<span class="hljs-string"><span class="hljs-string">'p'</span></span>).remove(); i--; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }); });</code> </pre><br>  <b>PS</b> This is just my solution to the problem I encountered, and he does not claim to be the best.  Model names are taken randomly, an example may also be suitable for implementing tags on the site.  I would be very grateful for comments and suggestions, for I have only been in love with django and python for 4 months. </div><p>Source: <a href="https://habr.com/ru/post/135263/">https://habr.com/ru/post/135263/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../135256/index.html">PHP 5.4 RC4 released</a></li>
<li><a href="../135257/index.html">CSS3 exit panel with iframe inside</a></li>
<li><a href="../135258/index.html">We transfer Redmine from VPS to Heroku or how to get a free project-management tool</a></li>
<li><a href="../135259/index.html">NETCONF. Start</a></li>
<li><a href="../135262/index.html">Sort Numbers by Brainfuck</a></li>
<li><a href="../135265/index.html">Is email easy?</a></li>
<li><a href="../135266/index.html">Chic pictures in Microsoft Excel</a></li>
<li><a href="../135267/index.html">Making a controlled sunset with CSS3 and javascript</a></li>
<li><a href="../135268/index.html">GoDaddy director refuses to revoke signature in support of SOPA</a></li>
<li><a href="../135271/index.html">Three favorite bug</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>