<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Worm apples [WITHOUT JailBreak]</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nobody can be surprised today with stories about malware for the Android OS, except about rootkit technologies or about new concepts, sharpened for a ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Worm apples [WITHOUT JailBreak]</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/e8b/a1f/27a/e8ba1f27a13449ceb6b53f4377c1534d.jpg"><br><br>  Nobody can be surprised today with stories about malware for the Android OS, except about rootkit technologies or about new concepts, sharpened for a new runtime environment ART.  With malware for iOS, the opposite is <a href="https://blog.lookout.com/blog/2015/03/05/the-state-of-ios-security/">true</a> : if anyone has heard of it, it is usually only <a href="https://blog.fortinet.com/post/ios-malware-does-exist">in the context of the jailbreak</a> .  In 2014 there was a general boom of such programs (AdThief, Unflod, Mekie, AppBuyer, Xsser).  But in this article we will talk about malware and its capabilities for iOS without jailbreak ... <br><a name="habracut"></a><br>  Let's immediately agree on the initial conditions regarding our Apple device: <br><ul><li>  IOS device on board; </li><li>  IOS latest version; </li><li>  Device without jailbreak. </li></ul><br>  Such rigid initial conditions are specified (so that life does not seem like honey).  Simply, if the device already has a jailbreak or the attacker can easily install it from public sources, then it is uninteresting and immediately game over: the user himself is angry Pinocchio.  The operating system security model is completely broken, and writing malicious code for such an Apple device will not differ in general from writing malicious code for Android, Windows or Mac. <br><br>  The main protective measures due to which the malicious code does not fall in large quantities (does not fall into it) on Apple devices: <br><ul><li>  Strict verification of applications upon receipt in the AppStore; </li><li>  The inability to dynamically load code from external sources; </li><li>  Only the code signed by Apple can be executed on the device. </li></ul><br>  But let's get everything in order.  First, let's look at what code and so you can generally run on non-jailbroken devices. <br>  First, you can install applications from the AppStore: they are signed by the distribution-certificate and can be run on an unlimited number of devices, but can only be distributed via the AppStore after a thorough check. <br>  Secondly, through the <a href="https://developer.apple.com/testflight/index.html">TestFlight</a> application (from the AppStore) to test beta versions of applications.  This version of the application is signed by a distribution-certificate with a beta entitlement, available for 1000 users (binding by Apple ID, so there may be more devices) and passing the Beta App Review (takes less time, so is it as thorough as for the AppStore, unclear...). <br>  Thirdly, of course, on devices you can run code signed by a developer-certificate issued to an Apple developer for a specific device (no more than 100 pre-specified devices ‚Äî knowledge of the UUID is required) for testing on real devices (Ad Hoc distribution).  The same rules are played and services HockeyApp, Ubertesters, Fabric (Crashlytics).  At the same time, as you understand, there is no verification code from Apple;) <br>  Fourth, applications signed by the enterprise certificate.  Such applications can be distributed from anywhere (in-house-distribution) and run on an unlimited number of devices (ProvisionsAllDevices = true).  And Apple‚Äôs code review is also missing! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      What does it mean to distribute the application from anywhere?  This means that you can put the application on a web portal (internal or on the Internet) and when accessing it, simply install it on the device.  In the pictures for the user installation of the application looks like this: <br><br><img src="https://habrastorage.org/files/bf4/07d/867/bf407d867c134a0bbae0153851659d81.png" alt="image"><br><br>  You can find such applications on the Internet by keyword: <pre><code class="html hljs xml">itms-services://?action=downloadmanifest</code> </pre>  - Internet crawler to help you. <br><br>  As I think you have already guessed, the essence of the problem is in the complete trust in applications signed by a developer or enterprise certificate.  In general, the entire Apple security model is based on trust in certificates ... <br>  It is clear that an attacker can somehow get these certificates: to create a fake company or a one-day company or just steal certificates - this is a matter of technology and a question of preparing for an attack.  Apple has the ability to revoke enterprise and developer certificates (uses OSCP), but there are a number of tricks that counteract this process.  And in the case of developer certificates, this is generally not an easy task for Apple. <br><br>  Let's consider which attack vectors now open up to the attacker (aware means protected) and in general there are for non-jailbroken devices. <br>  1) A malicious present.  They simply give a person a device with a preinstalled set (they don‚Äôt look a gift horse in the mouth) ‚Äúuseful‚Äù programs from safe messengers to picture editors.  To do this, as a rule, any well-known program from the AppStore is taken, unpacked and decrypted, additional functionality is added to it, signed with the appropriate certificate and installed on the device.  At the same time, as you understand, the application continues to function normally and perform its original functions.  No matter how ridiculous and primitive this method is, we already know of cases when such devices were presented to a certain circle of people in Russia. <br>  2) Through the infected computer.  The device connects to the infected computer that it trusts (with which pairing is installed), and the malicious code on the system installs the malicious application already on the mobile device (for example, using the <a href="http://www.libimobiledevice.org/">libimobiledevice</a> library). <br>  3) A couple of seconds in the wrong hands.  Lending a phone to an attacker / foe / jealous girl for a couple of seconds will also be enough to install a malicious program on the phone.  The attacker pre-places his application somewhere on the Internet and, while the phone is in his hands, via Safari, follows the link and installs it, and you don‚Äôt need to know any passwords! <br>  4) Himself Pinocchio.  You yourself can put yourself an application from some third-party source, for example, in an effort to save on buying a game in the AppStore.  As far as I know, for example, in China (Tongbu) they like to buy, break games and then distribute them for free (or cheaper), having oversubscribed them with their certificate. <br>  5) Hacked developer.  Malicious code can get into the project and quietly spread to the devices through the same HockeyApp, Ubertesters, Fabric (Crashlytics), if they are, of course, used.  Well, or the attacker simply steals the certificates he needs from the developer. <br>  6) Insider.  This item is relevant only for the companies themselves, which have internal development and distribution of corporate applications.  The problem is that the developer in such a situation is free to use not only Apple-enabled features ... but more on that later. <br>  7) Through application vulnerability.  The most beautiful and most complex attack vector at the same time with a minimum of suspicion.  At the same time, the application can even be distributed via the AppStore.  A similar concept has already been described in ‚Äú <a href="http://www.cc.gatech.edu/~klu38/publications/security13.pdf">Jekyll on iOS: When Benign Apps Become Evil</a> ‚Äù. <br>  8) Due to the vulnerability in iOS.  This was already previously <a href="http://www.forbes.com/sites/andygreenberg/2011/11/07/iphone-security-bug-lets-innocent-looking-apps-go-bad/">found</a> , for example, by the Charlie Miller researcher and allowed him to dynamically load and execute unsigned code on the device. <br><br>  A reader familiar with iOS security mechanisms may note that after an application hits an iOS device, it works in its own limited, separated from all sandbox ... <br>  In principle, it is really so, BUT it is worth considering that the malicious file downloaded by the attacker by Apple‚Äôs policy has not been verified in any way and in fact can use more functionality than any application from the AppStore.  And all thanks to the private API!  Apple itself programs with such functionality will not miss, and then no one asks. <br>  So, an application that was installed not from the AppStore, from a security point of view, can have the following differences: <br><ul><li>  Can use private API - additional functionality; </li><li>  Can communicate with surrounding services (such as mach-ports); </li><li>  Receives an increased attack surface for jailbreak on the device. </li></ul><br>  So, how can a private API be useful to an attacker?  Right off the bat: <br><table><tbody><tr><th>  Call </th><th>  Description </th></tr><tr><td><pre> <code class="objectivec hljs">[[<span class="hljs-built_in"><span class="hljs-built_in">CTMessageCenter</span></span> sharedMessageCenter] incomingMessageWithId: result]</code> </pre></td><td>  Get the text of the incoming SMS message </td></tr><tr><td><pre> <code class="objectivec hljs"><span class="hljs-built_in"><span class="hljs-built_in">CTTelephonyCenterAddObserver</span></span>()</code> </pre></td><td>  Register handler for incoming SMS-messages and calls </td></tr><tr><td><pre> <code class="objectivec hljs">MobileInstallationLookup()</code> </pre></td><td>  Get plist-information about installed applications </td></tr><tr><td><pre> <code class="objectivec hljs"><span class="hljs-built_in"><span class="hljs-built_in">CFUserNotificationCreate</span></span>()</code> </pre></td><td>  Pop-up dialog on top of all screens. </td></tr><tr><td><pre> <code class="objectivec hljs"><span class="hljs-built_in"><span class="hljs-built_in">CFUserNotificationReceiveResponse</span></span>()</code> </pre></td><td>  Get user input from dialog box </td></tr><tr><td><pre> <code class="objectivec hljs">allApplications()</code> </pre></td><td>  Get a list of bundle ID of installed applications </td></tr><tr><td><pre> <code class="objectivec hljs">SBSCopyLocalizedApplicationNameForDisplayIdentifier()</code> </pre></td><td>  Get program name by bundle ID </td></tr></tbody></table>  It is immediately obvious that even from sandbox, the application, thanks to the private API, can do a lot of bad things.  And this is not a complete list of useful methods for an attacker.  It‚Äôs unclear how many more of them ... At the same time, I think, they will soon appear (already in demand) or there are already iOS developers specializing in private API. <br>  For a general understanding of how much is hidden and not allowed to ordinary developers under iOS, see the project <a href="https://github.com/nst/iOS-Runtime-Headers">iOS-Runtime-Headers</a> , which is a header file for iOS generated at runtime.  Or the project <a href="https://github.com/nst/RuntimeBrowser/">RuntimeBrowser</a> , which, in principle, is used to generate such header files, but allows you to immediately work with calls.  It should be noted that private API is both in the private frameworks and in the public frameworks.  And also, in addition to private Objective-C-classes and methods, there are also very interesting C-functions that the RuntimeBrowser does not find. <br><br>  Very indicative picture: <br><br><img src="https://habrastorage.org/files/dde/388/260/dde388260fad462cb2ffe6eb34fd6bed.png"><br><img src="https://habrastorage.org/files/932/57f/bec/93257fbec3734a59bfce7c4568fba63a.png" alt="image"><br><br>  All this one way or another can <a href="http://www.andreas-kurtz.de/2014/09/malicious-apps-ios8.html">use</a> an attacker.  At the same time, his hands are also free to apply various techniques of dynamic code loading through NSBundle and dlopen (). <br><br>  If you think that all of the above is just ideas and concepts, then I hurry to upset you ... This has already happened in a combat environment - for example, malicious <a href="https://www.paloaltonetworks.com/content/dam/paloaltonetworks-com/en_US/assets/pdf/reports/Unit_42/unit42-wirelurker.pdf">Wirelurker</a> , who among other things conducted the so-called <a href="https://www.fireeye.com/blog/threat-research/2014/11/masque-attack-all-your-ios-apps-belong-to-us.html">Masque Attack</a> .  The meaning of Masque Attack (CVE-2014-4493 and <a href="https://www.fireeye.com/blog/threat-research/2015/02/ios_masque_attackre.html">CVE-2014-4494</a> ) was that the malicious application was placed on top of the original (messenger, mail, client bank, etc., except for the pre-installed iOS applications) and accessed his data. <br><br>  Safety recommendations: <br><ul><li>  Do not install applications from third-party sources; </li><li>  Update the OS; </li><li>  Control profiles on the device (Settings -&gt; General -&gt; Profiles); </li><li>  Keep your certificates safe (for developers); </li><li>  Control the code that is written for in-house distribution (for customers). </li></ul><br>  PS For people interested in malware samples for iOS, I advise you to contact this resource: <a href="http://contagiominidump.blogspot.ru/search%3Fq%3DiOS">contagiominidump.blogspot.ru/search?q=iOS</a> . <br><br>  Useful materials on the topic: <br><ul><li>  <a href="http://www3.nccu.edu.tw/~yuf/appblack3.pdf">Private API</a> </li><li>  <a href="http://www.liaiqin.com/hanjin/papers/ACNS2013Han.pdf">Launching Generic Attacks on iOS with Approved Third-Party Applications</a> </li><li>  <a href="https://www.virusbtn.com/pdf/conference/vb2014/VB2014-WeiZhengXueSong.pdf">Apple Without a Shell - iOS under Targeted Attack</a> </li><li>  <a href="http://www.cs.cuhk.hk/~cslui/PUBLICATION/ASIACCS15.pdf">Enpublic Apps: Security Threats</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/256407/">https://habr.com/ru/post/256407/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../256393/index.html">How to make Xamarin Studio a little better?</a></li>
<li><a href="../256397/index.html">Transferring a project from iOS designers to developers</a></li>
<li><a href="../256401/index.html">Compare Visual Studio Community 2013 with Visual Studio 2013 Express. Features of the license agreement</a></li>
<li><a href="../256403/index.html">We unify the behavior of LINQ to IEnumerable and LINQ to IQueriable in terms of working with null values. Part two. Its implementation of IQueryProvider</a></li>
<li><a href="../256405/index.html">Interview with Serge</a></li>
<li><a href="../256409/index.html">New graphics mode: CGA in 1024 colors</a></li>
<li><a href="../256411/index.html">Interference: as a tram, radar detector and poorly crimped cable can affect the satellite channel</a></li>
<li><a href="../256413/index.html">Analysis of weather station data based on Arduino</a></li>
<li><a href="../256415/index.html">Overview of Wireframesketcher features on the example of creating a site layout</a></li>
<li><a href="../256417/index.html">How it all works: the development of interactive online courses</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>