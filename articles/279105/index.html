<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Containers: The quest for the "magic framework" and why it became Kubernetes</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We at Latera are creating billing for telecom operators . In a blog on Habr√©, we not only talk about the features of our system and the details of its...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Containers: The quest for the "magic framework" and why it became Kubernetes</h1><div class="post__text post__text-html js-mediator-article"> <a href="https://habrahabr.ru/company/latera/blog/279105/"><img src="https://habrastorage.org/files/47b/b11/f5e/47bb11f5e40d4f0aa40b02a670042b1f.png"></a> <br><br>  We at Latera are creating <a href="http://www.hydra-billing.ru/">billing for telecom operators</a> .  In a blog on Habr√©, we not only talk about the features of our system and the details of its development (for example, <a href="http://habrahabr.ru/company/latera/blog/267083/">ensuring fault tolerance</a> ), but also publish materials about working with the infrastructure as a whole.  The project engineer Haleby.se wrote a <a href="http://code.haleby.se/2016/02/12/why-we-chose-kubernetes/">material</a> in a blog about the reasons for choosing Kubernetes technology as the orchestration tool of the Docker containers.  We present to you the main thoughts of this article. <a name="habracut"></a><br><br><h4>  Prehistory </h4><br>  The project engineering team initially used the Jenkins continuous delivery methodology for each service.  This made it possible to run integration tests for each commit, generate an artifact and a Docker image, and then deploy it on a test server.  With a single click, any image could be deployed on a ‚Äúcombat‚Äù server.  The scheme looked like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/fda/b5c/0fc/fdab5c0fcd424e66885f12426675501d.png"><br><br>  Cells called John and Doe contain sets of Docker containers deployed on a specific node.  In addition, <a href="https://www.ansible.com/">Ansible</a> is used for provisioning.  As a result, you can create a new cloud server and install the correct version of Docker / Docker-Compose on it, configure the firewall rules and perform other settings using one command.  For each service running in the Docker-container, there are guard scripts that ‚Äúpick up‚Äù it in the event of a crash.  But in this configuration, there may be problems. <br><br><img src="https://habrastorage.org/files/5fc/485/285/5fc4852854554dcc83da54818bf38657.png"><br><br>  If the Doe server ‚Äúburns out‚Äù one night (or just a short-term serious failure occurs on it), the technical project team will have to rise in the middle of the night to return the system to a healthy state.  The services installed on Doe do not automatically move to another server ‚Äî for example, John, so the system would stop working for a while. <br><br>  There are other difficulties - the location of the maximum number of containers on a single node, network discovery (service discovery), the "fill" of updates, the aggregation of log data.  It was necessary to somehow cope with all this. <br><br><img src="https://habrastorage.org/files/0ae/a11/10d/0aea1110d93e41418fff1c795edaf289.png"><br><br>  We needed a kind of magic orchestration framework (orchestration framework), with which it would be possible to distribute the containers on the cluster nodes.  It was necessary to ensure that one could work with a multitude of nodes as with a single node.  It was necessary for this magical framework to be able to say "unwrap 3 instances of such a Docker container somewhere in the cluster and make sure that everything works."  Great plan!  The case remained for the small - to find such a framework. <br><br><h4>  the wish list </h4><br>  Technologies are developing very fast, so even to meet very moderate standards, it is still necessary to choose the tools so that they are alive and maintained for some time.  Haleby engineers would like their ‚Äúdream framework‚Äù to use something like the <a href="https://docs.docker.com/compose/">docker-compose</a> they had already used ‚Äî this would eliminate the need for a large amount of reconfiguration and tuning work. <br><br>  In addition, a plus would be the simplicity of the framework and the absence in it of too many magical features that are difficult to control.  Any modular solution would be perfect, which would leave the possibility of replacing some parts if necessary.  An open license would also be a plus - in this case it would be easy to monitor the progress of the project and make sure that it has an active community. <br><br>  In addition, members of the Haleby team would like the selected tool to have support for working with containers in several clouds at the same time, as well as the presence of network detection functionality.  Also, engineers did not want to spend a lot of time setting up, so the preferred option would be to use the framework as service model. <br><br><h4>  Choosing a framework </h4><br>  Analysis of existing options on the market allowed us to identify several candidate frameworks.  Among them: <br><br><ul><li>  <a href="http://docs.aws.amazon.com/AmazonECS/latest/developerguide/Welcome.html">AWS ECS</a> </li><li>  <a href="https://docs.docker.com/swarm/">Docker swarm</a> </li><li>  <a href="https://mesosphere.com/product/">Mesosphere DCOS</a> </li><li>  <a href="https://www.tutum.co/">Tutum</a> </li><li>  <a href="http://kubernetes.io/">Kubernetes</a> </li></ul><br><h4>  AWS ECS </h4><br>  AWS ECS Container Service is a highly scalable and fast container management tool with which you can start, stop and work with Docker containers in a cluster of Amazon EC2 instances.  If a project is already working in this cloud, then it is just strange to not consider this option.  However, Haleby did not work at Amazon, so the move seemed to the company's engineers not the best solution. <br><br>  In addition, it turned out that the system does not have built-in network detection functionality, which was one of the key requirements.  In addition, in the case of AWS ECS, it would not have been possible to launch multiple containers using a single port on a single node. <br><br><h4>  Docker swarm </h4><br>  Docker Swarm is a native clustering tool for Docker.  Since Swarm uses the Docker API, any tool that can work with the Docker daemon can be scaled with its help.  Since Haleby uses docker-compose, the last option sounded very tempting.  In addition, the use of a familiar technology familiar tool meant that the team would not have to learn something new. <br><br>  However, not everything was so rosy.  Despite the fact that Swarm supports several engines for network detection, it is not an easy task to set up a workable integration.  In addition, Swarm is not a managed service, so it would be necessary to configure and maintain its work independently, which was not originally included in the plans of the project team. <br><br>  Moreover, the renewal of containers would also have been impossible in automatic mode.  For this, it would be necessary, for example, to configure Nginx as a load balancer for various groups of containers.  Also, many engineers on the Internet expressed doubts about the performance of Swarm - among them, for example, <a href="http://stackoverflow.com/a/29017596/398441">Google employees</a> . <br><br><h4>  Mesosphere DCOS </h4><br><img src="https://habrastorage.org/files/853/93d/414/85393d414a3d4c63957dd9eac8fc509e.png"><br><br>  After setting up DCOS (data center operating system) on AWS and starting work, the Mesosphere seems like a good option.  Using the convenient interface, you can get all the information about the cluster, including running services, CPU usage and memory consumption.  DCOS can work in any cloud and with several clouds at once.  <a href="http://mesos.apache.org/">Mesos</a> is a tool proven to work in large clusters.  Also DCOS allows you to run not only containers, but also individual applications, like Ruby, and you can install important services using the simple dcos install command (this is like apt-get for a data center). <br><br>  Moreover, using this tool, you can work with several clusters at the same time - you can run Marathon, Kubernetes, Docker and Swarm within the same system. <br><br>  However, along with the advantages, this option had its drawbacks.  For example, support for working with multiple clouds is present only in the Enterprise version of the Mesosphere DCOS, but the price of this version is not listed on the site, and no one has responded to requests. <br><br>  Also in the documentation at that time (October / November 2015) there was no information on how to move to a new cluster without the need to interrupt the system - it is important to understand that this is also not a managed service, so problems may arise during the move . <br><br><h4>  Tutum </h4><br>  The project team describes it as a ‚ÄúDocker platform for Dev and Ops‚Äù, and the slogan sounds like ‚Äúbuild, deploy and manage your applications in any cloud‚Äù.  The interface looks like this: <br><br><img src="https://habrastorage.org/files/78f/593/eb1/78f593eb15c643b0a3e8be435fbf01e5.png"><br><br>  It may not seem as impressive to someone as DCOS, but nevertheless, the system allows you to perform most of the necessary manipulations with simple mouse clicks, although Tutum also has good command line support.  To start working with the system, you need to install a Tutum agent on each node of the cluster, after which the node starts to appear in the administrative panel.  An interesting point is that Tutum uses the ad stack format from several services or containers, which is similar to docker-compose - so it will be even easier for professionals familiar with Docker to get started. <br><br>  In addition, Tutum supports volumes using cluster integration in <a href="https://clusterhq.com/">Flocker</a> .  Tests in which certain containers were ‚Äúkilled‚Äù were passed successfully - they were recreated in the same state (sometimes on different nodes).  Another advantage was the function of creating links between containers - it can be used to link certain containers in a group. <br><br>  HAProxy, which supports virtual hosts, is used for load balancing, so that several services can be placed behind a single instance of HAProxy.  Deploying services can also be done in different ways, and to update Docker in the whole cluster, just a couple of clicks are enough.  In the future, Docker bought the Tutum service, so that in the future it will be fully integrated into the ecosystem. <br><br>  However, at the time of searching for the best framework, Tutum was in beta testing.  And yet, the main argument against this option was the incident, when during the test, the engineers deliberately made the node completely unavailable - the CPU utilization of 100% did not even allow connecting to the machine via SSH, the containers from it were not transferred to another node.  Technical support Tutum said that he was familiar with this problem, but it has not yet been eliminated.  It was necessary to look further. <br><br><h4>  Kubernetes </h4><br><img src="https://habrastorage.org/files/eb9/818/544/eb981854400a4374a1f905c893a7d403.png"><br><br>  The Kubernetes team describes the project as a tool for "managing a cluster of Linux containers as a single system to speed up Dev and simplify Ops."  This is an open source <a href="https://github.com/kubernetes/">project</a> that supports Google. A number of other companies are also involved in its development, including Red Hat, Microsoft, SaltStack, Docker, CoreOS, Mesosphere, IBM. <br><br>  What is really good about Kubernetes is that it combines Google‚Äôs ten-year experience in building and working with clusters - all for free!  You can run Kubernetes on your hardware or at the facilities of cloud providers like AWS for which there are even special formation patterns. <br><br>  In addition, Google offers a managed version of Kubernetes called the <a href="https://cloud.google.com/container-engine/">Google Container Engine</a> .  Due to the drawbacks of the interface, it is not as easy to start working with it as, for example, with Tutum, but after the user manages to understand the system, it becomes easy to work with it. <br><br>  A team of engineers conducted many tests during which nodes were ‚Äúkilled‚Äù in the process of uploading updates, containers were accidentally destroyed, their number increased above the stated maximum bar, etc.  Not always everything went smoothly, but in each case, after certain searches, it was possible to find a way to remedy the situation. <br><br>  Another significant advantage of Kubernetes was the ability to update the entire cluster without interrupting work.  Also, the tests confirmed the operability of network discovery ‚Äî all you need to do is type the name of the required <a href="http://kubernetes.io/v1.1/docs/user-guide/services.html">service</a> ( <code>http://my-service</code> ) into the address bar, and Kubernetes create a connection to the required container.  Kubernetes is a modular system whose components can be combined. <br><br>  The framework has its drawbacks - when working with the Google Container Engine, the system is limited to one data center.  If anything happens to him, nothing good will happen.  You can get out of any situation, for example, by organizing several clusters with the help of a load balancer, but there is no ‚Äúout of the box‚Äù solution.  However, support for working with several data centers is planned in new versions of the lighter version of the <a href="">Ubernetes</a> framework.  In addition, Kubernetes uses its yaml format, which leads to the need to convert docker-compose files.  In addition, the project is not as developed as Mesos, which allows working with a large number of nodes. <br><br><h4>  Conclusion </h4><br>  After exploring the options available on the market, the Haleby team focused on Kubernetes, which seemed to engineers to be the most appropriate tool for solving their problems.  At the same time, other reviewed services also showed themselves from the good side, however they had their drawbacks, which in this particular case turned out to be unacceptable. </div><p>Source: <a href="https://habr.com/ru/post/279105/">https://habr.com/ru/post/279105/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../279095/index.html">Learning from machine learning (saturday, philosophical)</a></li>
<li><a href="../279097/index.html">Calculating the value of a polynomial. Is everything trivial in this question?</a></li>
<li><a href="../279099/index.html">Forecasts for the gaming market: figures from 7 analytical agencies</a></li>
<li><a href="../279101/index.html">Say a word about poor XWiki - 2</a></li>
<li><a href="../279103/index.html">Easy to deploy Meteor applications to your own server</a></li>
<li><a href="../279107/index.html">1.3 SFML and Linux</a></li>
<li><a href="../279109/index.html">KTV. Rake on the way to marshaling</a></li>
<li><a href="../279111/index.html">C ++ exception handling under the hood or how exceptions work in C ++</a></li>
<li><a href="../279113/index.html">Observation of internationalized domain names and the letter K</a></li>
<li><a href="../279117/index.html">Linear models: simple regression</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>