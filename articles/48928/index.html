<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ruby and C. Part 1.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ruby integrates very easily with the C programming language. You can create extensions for Ruby. Or we can make a wrapper for the C library, and use i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ruby and C. Part 1.</h1><div class="post__text post__text-html js-mediator-article">  Ruby integrates very easily with the C programming language. You can create extensions for Ruby.  Or we can make a wrapper for the C library, and use it as a regular Ruby library.  You can also implement critical C calculations right in Ruby code!  Another integration option is to use Ruby in C / C ++ programs as a scripting language.  For example, as done in Google SketchUp. <br><br>  Let's see what features Ruby provides for integration with C. <br><br><a name="habracut"></a><br>  Suppose there is a bottleneck in our program, some sort of calculation that, for example, is performed in a loop.  These calculations greatly reduce application performance. <br>  The solution is to rewrite a critical piece in C, since  compiled languages ‚Äã‚Äãare known to be faster interpreted. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Here we have two options, either create an extension for Ruby, or use C code directly from Ruby. <br>  To begin with, we will choose the second option, and in this the RubyInline library will come to our aid. <br>  Suppose we have a method for decomposing a number into prime dividers.  Let's follow the simplest path and implement this method using the brute force algorithm: <br><pre>     class factor
         #num - input number, show - whether to display the result on the screen
         def factorization num, show = false 
             num1 = num
             n = 2 # start searching for divisors from 2
             while n * n &lt;= num1
                 if num% n == 0 # if the current number is a divisor, output it
                     num = num / n 
                     puts n if show
                 else # otherwise we increase the current number
                     n + = 1
                 end
             end
         end
     end </pre><br>  But we are not satisfied with the speed of this method, so let's rewrite it in C, using the RubyInline library. <br>  First, install it: <br> <code>gem install RubyInline</code> <br>  RubyInline requires a POSIX system, i.e. either * nix or Cygwin on Windows. <br>  And also a C / C ++ compiler. <br><br>  A simple example of use: <br><pre>     require 'rubygems'
     require 'inline' # connect RubyInline

     class Test
         # embedded code handler
         inline do | builder |  # an object of class Inline :: C is passed to the block
             builder.c '
                 static char * test () {
                     return "Hi from C! :)";
                 }
             '        
         end
     end
    
     puts Test.new.test # prints "Hi from C! :)" </pre><br><br>  In the sample code, we made a small C method that returns a greeting string. <br>  Method <code>c</code> performs the following actions: <br>  - performs conversion of argument types and return values ‚Äã‚Äãfrom C to Ruby <br>  - compiles a string with the method code <br>  - adds test method to class Test <br>  After that, we can use <code>test</code> as a normal Ruby method. <br><br>  Let's return to factoring.  Rewrite the factorization method using RubyInline. <br><pre>     require 'rubygems'
     require 'inline'
    
     class FastFactor
         inline do | builder |
             builder.c '
                 static void factorization (int num, int show) {
                     int i = 0;
                     int num1 = num;
                     int n = 2;
                     while (n * n &lt;= num1) {
                         if (num% n == 0) {
                             num = num / n;
                             if (show)
                                 printf ("% d \ n", n);
                             i ++;
                         } else {
                             n ++;
                         }
                     }
                 }
             '        
         end
     end </pre><br><br>  And now, the most interesting.  Performance tests <br>  Ruby implementation test: <br><pre>     f = Factor.new
     1000.times {f.factorization 999999}
</pre><br>  Result: <br><pre> $ time ruby ‚Äã‚Äãfactor.rb
     real 0m1.034s
     user 0m1.028s
     sys 0m0.004s
</pre><br>  And similar to C: <br><pre>     f = FastFactor.new
     1000.times {f.factorization 999999, false}
</pre><br>  And the result: <br><pre> time ruby ‚Äã‚Äãfactorfast.rb
     real 0m0.116s
     user 0m0.092s
     sys 0m0.024s
</pre><br><br>  As can be seen from the test, RubyInline allows you to speed up critical pieces of code almost 10 times! <br>  Test code: <a href="http://pastie.org/358680">factor.rb</a> , <a href="http://pastie.org/358683">factorfast.rb</a> . <br>  Summarizing, we can say that if our application cannot cope with the workloads, then we can always speed it up by implementing critical moments in C. Fortunately, Ruby provides us with powerful and convenient means for this. <br><br>  In the next part, I‚Äôll talk about creating C extensions for Ruby. <br><br>  Related Links: <br>  RubyInline: <a href="http://rubyforge.org/projects/rubyinline/">http://rubyforge.org/projects/rubyinline/</a> <br>  Documentation: <a href="http://rubyinline.rubyforge.org/RubyInline/">http://rubyinline.rubyforge.org/RubyInline/</a> <br></div><p>Source: <a href="https://habr.com/ru/post/48928/">https://habr.com/ru/post/48928/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../48918/index.html">Would you like some MobileMe?</a></li>
<li><a href="../48919/index.html">Education in IT, the growing importance of self-education and specialist self-esteem</a></li>
<li><a href="../48924/index.html">Anthem "Karaoke"</a></li>
<li><a href="../48925/index.html">Livejournal employees fired without severance pay</a></li>
<li><a href="../48926/index.html">Silverlight course from MIT</a></li>
<li><a href="../48932/index.html">Comparison of the share of secondary search engines in Russia</a></li>
<li><a href="../48937/index.html">Great free photos can now be used for personal gain</a></li>
<li><a href="../48942/index.html">Identify the author of the post in the comments</a></li>
<li><a href="../48943/index.html">Abandoned tab</a></li>
<li><a href="../48945/index.html">Calculation of expressions on Nemerle and Mono.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>