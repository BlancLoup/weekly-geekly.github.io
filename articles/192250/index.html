<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We fasten SMS to cacti</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For monitoring servers, I use cacti with thold plugin. The plugin is wonderful, it allows you to monitor both the availability of the entire server an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We fasten SMS to cacti</h1><div class="post__text post__text-html js-mediator-article">  For monitoring servers, I use <a href="http://www.cacti.net/">cacti</a> with <a href="http://docs.cacti.net/plugin:thold">thold</a> plugin.  The plugin is wonderful, it allows you to monitor both the availability of the entire server and the output of any parameter outside the specified limits.  When an event occurs, an e-mail is sent.  But I want to receive not only e-mail, but also sms messages.  There are several ways to do this: <br><ol><li>  e-mail2sms gateway provided by the mobile operator.  The method is not very reliable and not all operators have this service. </li><li>  Use an iron phone bolted to the monitoring server.  The most reliable and sophisticated way. </li><li>  Teach thold to send messages via SMS service. </li></ol><br><br>  I chose the third method.  There are several reasons for this.  First, the monitoring server is ‚Äúfar away‚Äù and there is no physical ability to connect a hardware phone.  Secondly, one of the areas of my business is SMS service.  Therefore, it is interesting to expand the service and to work with <b>cacti</b> .  I must say that this method is not suitable for those who need 100% performance.  It is clear that if the monitoring server lost access to the Internet, then you will not receive any messages.  But for those who are satisfied and 99% is a good method.  So let's get started. <br><a name="habracut"></a><br>  First, we need to install and configure the <b>cacti</b> itself and the <b>thold</b> module.  Configuring <b>cacti is</b> not the topic of this article, so we believe that everything is set up and working.  Go to the settings of cacti <b>Console-&gt; Settings-&gt; Thresholds</b> and put the checkmark <b>Send Alerts as Text</b> , we do not need the HTML code in the messages. <br><img src="https://habrastorage.org/getpro/habr/post_images/13f/a4c/fdd/13fa4cfdd96070e8949f65c81cfd9ce9.png" alt="image"><br>  Next you must have a working account on the SMS service <a href="http://client.vesms.ru/">vesms.ru</a> .  If not, register.  After downloading the <a href="">PHP class</a> to work with the service.  Unpack and put the <b>VESMS.class.php</b> file into the folder with the <b>thold</b> module, usually <b>/ usr / local / share / cacti / plugins / thold</b> . <br><br>  Next, edit the code of the file <b>/ usr / local / share / cacti / plugins / thold /thold_functions.php</b> .  Looking for the line <b>function thold_mail ($ to, $ from, $ subject, $ message, $ filename, $ headers = '') {</b> <br>  We need to add to the code of this function work with SMS.  Initially, the code looks like this. <br><pre><code class="php hljs">... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">thold_mail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($to, $from, $subject, $message, $filename, $headers = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> $config; thold_debug(<span class="hljs-string"><span class="hljs-string">'Preparing to send email'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">include_once</span></span>($config[<span class="hljs-string"><span class="hljs-string">'base_path'</span></span>] . <span class="hljs-string"><span class="hljs-string">'/plugins/settings/include/mailer.php'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">include_once</span></span>($config[<span class="hljs-string"><span class="hljs-string">'base_path'</span></span>] . <span class="hljs-string"><span class="hljs-string">'/plugins/thold/setup.php'</span></span>); $subject = trim($subject); $message = str_replace(<span class="hljs-string"><span class="hljs-string">'&lt;SUBJECT&gt;'</span></span>, $subject, $message); ...</code> </pre> <br>  Change to <br><pre> <code class="php hljs">... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">thold_mail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($to, $from, $subject, $message, $filename, $headers = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> $config; thold_debug(<span class="hljs-string"><span class="hljs-string">'Preparing to send email'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">include_once</span></span>($config[<span class="hljs-string"><span class="hljs-string">'base_path'</span></span>] . <span class="hljs-string"><span class="hljs-string">'/plugins/settings/include/mailer.php'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">include_once</span></span>($config[<span class="hljs-string"><span class="hljs-string">'base_path'</span></span>] . <span class="hljs-string"><span class="hljs-string">'/plugins/thold/setup.php'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span>($config[<span class="hljs-string"><span class="hljs-string">'base_path'</span></span>] . <span class="hljs-string"><span class="hljs-string">'/plugins/thold/VESMS.class.php'</span></span>); $subject = trim($subject); $message = str_replace(<span class="hljs-string"><span class="hljs-string">'&lt;SUBJECT&gt;'</span></span>, $subject, $message); $user = <span class="hljs-string"><span class="hljs-string">'USERNAME'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//API       (    ) $key = 'APIKEY'; //API ,    http://client.vesms.ru/settings/api $sms = new VESMS($user, $key); $recipients='NUMBER'; //     $sender='cacti'; //  ,    ,             $sms-&gt;messageSend($recipients, $subject, $sender); ...</span></span></code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      That's all.  In this configuration, all e-mail messages will be duplicated SMS.  Only the subject of an e-mail without the body of the letter comes to sms.  This is more than enough, all the necessary information is contained there. <br>  Ideally, of course, I want a separate module for SMS with more flexible settings.  Maybe this will reach hands.  But in the current version, everything works fine and allows you to quickly respond to abnormal situations. </div><p>Source: <a href="https://habr.com/ru/post/192250/">https://habr.com/ru/post/192250/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../192228/index.html">Multilingual support in web projects - basic implementation options</a></li>
<li><a href="../192238/index.html">SimpleMembership Guide to ASP.NET MVC 4</a></li>
<li><a href="../192242/index.html">Terminal access to the Cach√© DBMS - now in the browser</a></li>
<li><a href="../192244/index.html">Amazon opened the delivery of electronics in Russia</a></li>
<li><a href="../192248/index.html">Summer alarm: we are looking for cloud CRM</a></li>
<li><a href="../192252/index.html">How to connect to Hyperboria</a></li>
<li><a href="../192254/index.html">Mini-study, improvement and bot for the game Shadow Worlds</a></li>
<li><a href="../192256/index.html">Building a full MVC website on ExpressJS</a></li>
<li><a href="../192258/index.html">Connecting the accelerometer to the Raspberry Pi using the Pi4J library</a></li>
<li><a href="../192262/index.html">GWT-Platform basics of working with presenters</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>