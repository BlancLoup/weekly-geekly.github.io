<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Functional TypeScript</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When functional programming is discussed, it often talks about the mechanism, and not about the basic principles. Functional programming is not about ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Functional TypeScript</h1><div class="post__text post__text-html js-mediator-article"><p>  When functional programming is discussed, it often talks about the mechanism, and not about the basic principles.  Functional programming is not about monads or monoids, it is primarily about writing programs using generalized functions.  <strong>This article is about applying functional thinking in TypeScript code refactoring.</strong> </p><br><p>  <em>Note from the translator: for convenience, I designed all the code in the <a href="https://github.com/ilyachenko/Functional-TypeScript">repository</a> .</em> </p><br><p>  For this we will use three techniques: </p><br><ul><li>  functions instead of primitives </li><li>  data transformation through pipeline </li><li>  selection of generic functions </li></ul><br><p>  Let's start now! </p><a name="habracut"></a><br><p>  So, we have two classes: </p><br><p>  <em>Employee</em> </p><br><pre><code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Employee</span></span></span><span class="hljs-class"> {</span></span> constructor(<span class="hljs-keyword"><span class="hljs-keyword">public</span></span> name: <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> salary: number) {} }</code> </pre> <br><p>  <em>Department</em> </p><br><pre> <code class="hljs kotlin"> export <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Department</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">public</span></span> employees: Employee[]) {} works(employee: Employee): boolean { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.employees.indexOf(employee) &gt; -<span class="hljs-number"><span class="hljs-number">1</span></span>; } }</code> </pre> <br><p>  Employees have names and wages, and a department is just an ordinary list of employees. </p><br><p>  The averageSalary function is exactly what we will refactor: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">averageSalary</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">employees: Employee[], minSalary: number, department?: Department</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">number</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> total = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> count = <span class="hljs-number"><span class="hljs-number">0</span></span>; employees.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(minSalary &lt;= e.salary &amp;&amp; (department === <span class="hljs-literal"><span class="hljs-literal">undefined</span></span> || department.works(e))){ total += e.salary; count += <span class="hljs-number"><span class="hljs-number">1</span></span>; } }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> total === <span class="hljs-number"><span class="hljs-number">0</span></span> ? <span class="hljs-number"><span class="hljs-number">0</span></span> : total / count; }</code> </pre> <br><p>  The function takes the list of employees, the minimum wage and optionally the department.  If it is set, it will calculate the average wage in this department, if not, the average for all departments. </p><br><pre> <code class="javascript hljs"> describe(<span class="hljs-string"><span class="hljs-string">"average salary"</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> empls = [ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Employee(<span class="hljs-string"><span class="hljs-string">"Jim"</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Employee(<span class="hljs-string"><span class="hljs-string">"John"</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Employee(<span class="hljs-string"><span class="hljs-string">"Liz"</span></span>, <span class="hljs-number"><span class="hljs-number">120</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Employee(<span class="hljs-string"><span class="hljs-string">"Penny"</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>) ]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> sales = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Department([empls[<span class="hljs-number"><span class="hljs-number">0</span></span>], empls[<span class="hljs-number"><span class="hljs-number">1</span></span>]]); it(<span class="hljs-string"><span class="hljs-string">"calculates the average salary"</span></span>, () =&gt; { expect(averageSalary(empls, <span class="hljs-number"><span class="hljs-number">50</span></span>, sales)).to.equal(<span class="hljs-number"><span class="hljs-number">150</span></span>); expect(averageSalary(empls, <span class="hljs-number"><span class="hljs-number">50</span></span>)).to.equal(<span class="hljs-number"><span class="hljs-number">140</span></span>); }); });</code> </pre> <br><p>  Despite the rather clear conditions, the code was a bit confusing and difficult to expand.  If I add another condition, the function signature (and thus its public interface) can change, and if else constructs can turn the code into a real monster. </p><br><p>  Let's use some of the functional programming techniques to refactor this function. </p><br><h2 id="funkcii-vmesto-primitivov">  Functions instead of primitives </h2><br><p>  <strong>Using functions instead of primitives may initially seem like an illogical step, but in reality it is a very powerful technique for generalizing code.</strong>  In our case, this means replacing the minSalary and department parameters with two functions with condition checking. </p><br><p>  <em>Step 1</em> <em>(Predicate is an expression that returns true or false)</em> </p><br><pre> <code class="javascript hljs">type Predicate = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e: Employee</span></span></span><span class="hljs-function">) =&gt;</span></span> boolean; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">averageSalary</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">employees: Employee[], salaryCondition: Predicate, departmentCondition?: Predicate</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">number</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> total = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> count = <span class="hljs-number"><span class="hljs-number">0</span></span>; employees.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(salaryCondition(e) &amp;&amp; <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">departmentCondition === </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">undefined</span></span></span></span><span class="hljs-function"><span class="hljs-params"> || departmentCondition(e</span></span></span><span class="hljs-function">))){ </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">total</span></span></span><span class="hljs-function"> += </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">salary</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">count</span></span></span><span class="hljs-function"> += 1; } }); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">return</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">total</span></span></span><span class="hljs-function"> === 0 ? 0 : </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">total</span></span></span><span class="hljs-function"> / </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">count</span></span></span><span class="hljs-function">; } // ... </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">expect</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">averageSalary(empls, (e</span></span></span><span class="hljs-function">) =&gt;</span></span> e.salary &gt; <span class="hljs-number"><span class="hljs-number">50</span></span>, (e) =&gt; sales.works(e))).toEqual(<span class="hljs-number"><span class="hljs-number">150</span></span>);</code> </pre> <br><p>  <em>We have unified the interfaces of the salary and department sampling conditions.</em>  This unification will allow to transfer all conditions in the form of an array. </p><br><p>  <em>Step 2</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">averageSalary</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">employees: Employee[], conditions: Predicate[]</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">number</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> total = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> count = <span class="hljs-number"><span class="hljs-number">0</span></span>; employees.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(conditions.every(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">c</span></span></span><span class="hljs-function"> =&gt;</span></span> c(e))){ total += e.salary; count += <span class="hljs-number"><span class="hljs-number">1</span></span>; } }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">count === </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function">) ? 0 : </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">total</span></span></span><span class="hljs-function"> / </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">count</span></span></span><span class="hljs-function">; } //... </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">expect</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">averageSalary(empls, [(e</span></span></span><span class="hljs-function">) =&gt;</span></span> e.salary &gt; <span class="hljs-number"><span class="hljs-number">50</span></span>, (e) =&gt; sales.works(e)])).toEqual(<span class="hljs-number"><span class="hljs-number">150</span></span>);</code> </pre> <br><p>  Now the array of conditions is a composition of conditions that we can make more readable. </p><br><p>  <em>Step 3</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">predicates: Predicate[]</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Predicate</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) =&gt;</span></span> predicates.every(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">p</span></span></span><span class="hljs-function"> =&gt;</span></span> p(e)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">averageSalary</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">employees: Employee[], conditions: Predicate[]</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">number</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> total = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> count = <span class="hljs-number"><span class="hljs-number">0</span></span>; employees.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(and(conditions)(e)){ total += e.salary; count += <span class="hljs-number"><span class="hljs-number">1</span></span>; } }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (count == <span class="hljs-number"><span class="hljs-number">0</span></span>) ? <span class="hljs-number"><span class="hljs-number">0</span></span> : total / count; }</code> </pre> <br><p>  It is worth noting that the "and" function is common, and should be moved to a separate library with a view to its further reuse. </p><br><h3 id="promezhutochnyy-rezultat">  Intermediate result </h3><br><p>  Function averageSalary has become more reliable.  <strong>New conditions can be added without changing the interface of the function and without changing its implementation.</strong> </p><br><h2 id="transformaciya-dannyh-cherez-pipeline">  Transformation of data through the pipeline </h2><br><p>  Another useful practice in functional programming is to simulate all data changes as a stream.  In our case, this means extracting the filter from the loop. </p><br><p>  <em>Step 4</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">averageSalary</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">employees: Employee[], conditions: Predicate[]</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">number</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filtered = employees.filter(and(conditions)); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> total = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> count = <span class="hljs-number"><span class="hljs-number">0</span></span> filtered.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) =&gt;</span></span> { total += e.salary; count += <span class="hljs-number"><span class="hljs-number">1</span></span>; }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (count == <span class="hljs-number"><span class="hljs-number">0</span></span>) ? <span class="hljs-number"><span class="hljs-number">0</span></span> : total / count; }</code> </pre> <br><p>  This change makes the counter useless. </p><br><p>  <em>Step 5</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">averageSalary</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">employees: Employee[], conditions: Predicate[]</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">number</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filtered = employees.filter(and(conditions)); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> total = <span class="hljs-number"><span class="hljs-number">0</span></span> filtered.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) =&gt;</span></span> { total += e.salary; }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (filtered.length == <span class="hljs-number"><span class="hljs-number">0</span></span>) ? <span class="hljs-number"><span class="hljs-number">0</span></span> : total / filtered.length; }</code> </pre> <br><p>  Further, if we separate salaries separately, then we can use normal reduce to sum up. </p><br><p>  <em>Step 6</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">averageSalary</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">employees: Employee[], conditions: Predicate[]</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">number</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filtered = employees.filter(and(conditions)); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> salaries = filtered.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function"> =&gt;</span></span> e.salary); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> total = salaries.reduce(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a,b</span></span></span><span class="hljs-function">) =&gt;</span></span> a + b, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (salaries.length == <span class="hljs-number"><span class="hljs-number">0</span></span>) ? <span class="hljs-number"><span class="hljs-number">0</span></span> : total / salaries.length; }</code> </pre> <br><h3 id="vydelenie-obobschyonnyh-generic-funkciy">  Selecting generic functions </h3><br><p>  Next, we note that the last two lines of code do not contain any information about employees or departments.  In fact, this is just a function to calculate the average value.  So it can be generalized. </p><br><p>  <em>Step 7</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">average</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">nums: number[]</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">number</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> total = nums.reduce(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a,b</span></span></span><span class="hljs-function">) =&gt;</span></span> a + b, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (nums.length == <span class="hljs-number"><span class="hljs-number">0</span></span>) ? <span class="hljs-number"><span class="hljs-number">0</span></span> : total / nums.length; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">averageSalary</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">employees: Employee[], conditions: Predicate[]</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">number</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filtered = employees.filter(and(conditions)); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> salaries = filtered.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function"> =&gt;</span></span> e.salary); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> average(salaries); }</code> </pre> <br><p>  Thus, the extracted function is now generic. </p><br><p>  After we have divided the logic of computing and filtering wages, let's proceed to the final step. </p><br><p>  <em>Step 8</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">employeeSalaries</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">employees: Employee[], conditions: Predicate[]</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">number</span></span></span><span class="hljs-function">[] </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filtered = employees.filter(and(conditions)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> filtered.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function"> =&gt;</span></span> e.salary); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">averageSalary</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">employees: Employee[], conditions: Predicate[]</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">number</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> average(employeeSalaries(employees, conditions)); }</code> </pre> <br><p>  Comparing the final decision, I can say that it is better than the previous one.  First, the code is more generalized (we can add a new condition without breaking the interface of the function).  Secondly, we got an immutable state and the code became more readable and more understandable. </p><br><h3 id="kogda-zhe-stoit-ostanovitsya">  When is it worth staying </h3><br><p>  The functional programming style is writing small functions that take collections of values ‚Äã‚Äãand return new collections.  These functions can be reused or merged in different places.  The only drawback of this style is that although the code may become more abstract, but at the same time it may become more difficult to understand the role of all these functions. </p><br><p>  I like to use Lego-analogy: Lego cubes can be combined in different ways - they are easily combined with each other.  But not all cubes are the same size.  Therefore, when you refactor using the techniques described in this article, do not try to create functions that take <code>Array&lt;T&gt;</code> for example, but return <code>Array&lt;U&gt;</code> .  Of course, in some rare cases, the data can be mixed, but such an approach will make it much more difficult to understand the logical chain of code. </p><br><h3 id="podvedyom-itogi">  Let's sum up </h3><br><p>  In this article, I showed how to apply functional thinking when refactoring TypeScript code.  I did this by applying simple transformation functions, following the rules: </p><br><ul><li>  functions instead of primitives </li><li>  data transformation through pipeline </li><li>  selection of generic functions </li></ul><br><h3 id="chto-pochitat">  What to read </h3><br><p>  <a href="https://leanpub.com/javascript-allonge">‚ÄúJavaScript Allonge‚Äù by Reginald Braithwaite</a> <br>  <a href="http://shop.oreilly.com/product/0636920028857.do">‚ÄúFunctional JavaScript‚Äù by Michael Fogus</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/315204/">https://habr.com/ru/post/315204/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../315192/index.html">Release Rust 1.13</a></li>
<li><a href="../315194/index.html">SMART TV - the future of television</a></li>
<li><a href="../315196/index.html">CSS Gateway Math</a></li>
<li><a href="../315200/index.html">Interprocess messaging performance in node.js</a></li>
<li><a href="../315202/index.html">Step to the ‚Äúbright SSD-future‚Äù</a></li>
<li><a href="../315206/index.html">7 arcade games that have already become classics, but still can teach something</a></li>
<li><a href="../315208/index.html">Conversion tracking after successfully sending an AJAX application form via Google Tag Manager (GTM)</a></li>
<li><a href="../315210/index.html">How IT professionals work. Alexey Rybak, head of Badoo development</a></li>
<li><a href="../315212/index.html">A database (400 million accounts) of Friend Finder Networks sites hit the network.</a></li>
<li><a href="../315216/index.html">CSS Lace Ornaments</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>