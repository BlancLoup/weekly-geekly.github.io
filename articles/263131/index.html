<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Clojure web application. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, dear users and visitors of Habr. In the first article, Clojure Web Applications reviewed the basic tools and libraries for building Clojure web...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Clojure web application. Part 2</h1><div class="post__text post__text-html js-mediator-article">  Hello, dear users and visitors of Habr.  In the first article, <a href="http://habrahabr.ru/post/263115/">Clojure Web Applications</a> reviewed the basic tools and libraries for building Clojure web projects.  Namely Leiningen, Ring, Compojure, Monger, Buddy and Selmer.  Here we will discuss their practical application. <br><a name="habracut"></a><br>  <i>For those who are set to self-development, through the comprehension of the code to bypass the reading of the article - I ask at the bottom of the page for a project reference to Github.</i> <br><br><h5>  Introduction </h5><br>  And so let's start in order.  To make it more interesting for you, I decided to choose a more or less applied focus of the article.  Today we will create a simple Clojure web application that will manage notes.  I assume that you already have Leiningen, Clojure and MongoDB installed (do not forget to enable it).  The lion's share of the content is directly in the comments in the code, which for your convenience is hidden in the spoilers. <br><hr><br><br><h5>  IDE </h5><br>  For Clojure there are a lot of different editors and IDE, in this article I will not give their pros and cons, more generally I will not once.  Everyone has different preferences, what to use is up to you.  I use LightTable which is written in ClojureScript and is completely satisfied with it, there are a large number of modules for it, out of the box it has everything you need to start developing on Clojure and ClojureScript, it contains the ParEdit module.  You do not have to configure anything to connect to the project remotely or locally via repl.  Interaction with repl in LightTable is very peculiar, in my subjective opinion it is very convenient - you can call functions and view their results in a separate window in live mode (such as in Emacs and in all other IDEs) or do the same directly in the code, it‚Äôs enough to translate the cursor on the first or last bracket of the expression and press cmd + enter (MacOS), then LightTable will create the repl connection and compile this expression, you need to enter the name of the compiled function or a variable below the line and view its result directly in the code  . <br><hr>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Back-end </h4><br><h5>  Project </h5><br>  First of all, create our project: <i>$ lein new compojure notes</i> <br><br>  Now we have a directory with the preparation of our application.  Let's go into it and open the project.clj file in the editor.  You need to add to it depending on the libraries we use: <br><br><div class="spoiler">  <b class="spoiler_title">project.clj</b> <div class="spoiler_text"><pre><code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defproject</span></span> notes <span class="hljs-string"><span class="hljs-string">"0.1.0-SNAPSHOT"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:description</span></span> <span class="hljs-string"><span class="hljs-string">" "</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:min-lein-version</span></span> <span class="hljs-string"><span class="hljs-string">"2.0.0"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:dependencies</span></span> [<span class="hljs-comment"><span class="hljs-comment">; -,  Clojure   ;   [org.clojure/clojure "1.6.0"] ;   GET  POST  [compojure "1.3.1"] ;  (middleware)   ;  [ring/ring-defaults "0.1.5"] ;  [selmer "0.8.2"] ;  Monger [com.novemberain/monger "2.0.1"] ;    [clojure.joda-time "0.6.0"]] ;  -     ;  ,     ; Ring'     - Jetty :plugins [[lein-ring "0.8.13"]] ;    Ring  ;   app  ;        :ring {:handler notes.handler/app} :profiles {:dev {:dependencies [[javax.servlet/servlet-api "2.5"] [ring-mock "0.1.5"]]}})</span></span></code> </pre> <br></div></div><br><br>  When you start a project, Leiningen will install all the specified dependencies automatically, all you need to do is specify them in project.clj and be connected to the Internet.  Next, let's move on to creating the server part of our application.  It is more logical to place the functions of mapping, working with the database, handlers and routes on separate files so that there are no conflicts of names and <s>brain-fucking'a</s> inconvenience, but it is as you like. <br><hr><br><br><h5>  Handler (main processor) </h5><br>  Let's start with handler.clj, Lein has already taken care of its creation and it is located in the <i>/ src / notes</i> directory (it also contains all of our Clojure code).  This is an important part of our application. It contains the <b>app</b> variable, which includes the routes of our application and basic middleware (a wrapper for requests and responses) for HTTP.  Add the routes of our application to the namespace, we get the following code: <br><br><div class="spoiler">  <b class="spoiler_title">handler.clj</b> <div class="spoiler_text"><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">ns</span></span> notes.handler (<span class="hljs-symbol"><span class="hljs-symbol">:require</span></span> <span class="hljs-comment"><span class="hljs-comment">;   [notes.routes :refer [notes-routes]] ;   middleware [ring.middleware.defaults :refer [wrap-defaults site-defaults]])) ;    middleware (def app (wrap-defaults notes-routes site-defaults))</span></span></code> </pre><br></div></div><br><hr><br><br><h5>  Routes </h5><br>  Now we will create the routes.clj file, we will place our routes in it - which, when requested using the GET and POST methods using the specified URI, will call the function of form handlers, and page mappings.  In this part of the application, we use the Compojure API.  I immediately apologize for the huge chunks of code for those who are embarrassed by them, but I added a lot of comments in them to make it easier for you to understand the logic of their work: <br><br><div class="spoiler">  <b class="spoiler_title">routes.clj</b> <div class="spoiler_text"><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">ns</span></span> notes.routes (<span class="hljs-symbol"><span class="hljs-symbol">:require</span></span> <span class="hljs-comment"><span class="hljs-comment">;    [compojure.core :refer [defroutes GET POST]] [compojure.route :as route] ;   [notes.controllers :as c] ;   [notes.views :as v] ;      [notes.db :as db])) ;   (defroutes notes-routes ;    (GET "/note/:id" [id] ;      ObjectId ;      (let [note (db/get-note id)] (v/note note))) ;      ObjectId (GET "/delete/:id" [id] (c/delete id)) ;    (POST "/edit/:id" request (-&gt; c/edit)) ;    ;  ,   ; ObjectId    ;  ,    ;  . (GET "/edit/:id" [id] ;      ObjectId ;      (let [note (db/get-note id)] (v/edit note))) ;    (POST "/create" ;      ;   [title text],    ; request    ;      request ;     ; : (create-controller request) (-&gt; c/create)) ;    (GET "/create" [] (v/create)) ;    (GET "/" [] ;     ;    fn  (let [notes (db/get-notes)] (v/index notes))) ;  404 (route/not-found "  "))</span></span></code> </pre><br></div></div><br><hr><br><br><h5>  Controllers (form processing) </h5><br>  To handle POST, sometimes GET requests, in the routes above we use the so-called functions ‚Äúcontrollers‚Äù (handlers), put them into a separate file.  Here I deliberately omit the full validation of the validity of the input data as it deserves a separate article.  Name this file controllers.clj, its contents are as follows: <br><br><div class="spoiler">  <b class="spoiler_title">controllers.clj</b> <div class="spoiler_text"><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">ns</span></span> notes.controllers (<span class="hljs-symbol"><span class="hljs-symbol">:require</span></span> <span class="hljs-comment"><span class="hljs-comment">;   [ring.util.response :refer [redirect]] ;      [notes.db :as db])) (defn delete "  " [id] (do (db/remove-note id) (redirect "/"))) (defn edit "  " [request] ;     (let [note-id (get-in request [:form-params "id"]) note {:title (get-in request [:form-params "title"]) :text (get-in request [:form-params "text"])}] ;   (if (and (not-empty (:title note)) (not-empty (:text note))) ;    ;     ;   ;    (do (db/update-note note-id note) (redirect "/")) ;      "   "))) (defn create "  " [request] ;     ;     ;    hash-map ; ( ) (let [note {:title (get-in request [:form-params "title"]) :text (get-in request [:form-params "text"])}] ;   (if (and (not-empty (:title note)) (not-empty (:text note))) ;    ;     ;   ;    (do (db/create-note note) (redirect "/")) ;      "   ")))</span></span></code> </pre><br></div></div><br><hr><br><br><h5>  DB (MongoDB interaction) </h5><br>  A very interesting part of the application, the Monger library will help us in its construction.  Create a file db.clj, it will contain functions for interacting with MongoDB.  Of course, we can call Monger functions directly in routes and controllers, but for this we will receive retribution in debugging, expansion along with a bunch of duplicate code, thereby multiplying the final number of lines of code.  Monger also allows you to make queries to MongoDB via DSL queries (for relational databases, there is an excellent sqlcorma library), this is very convenient for complex queries, but in this article I will not describe them.  Let's add functions to db.clj: <br><br><div class="spoiler">  <b class="spoiler_title">db.clj</b> <div class="spoiler_text"><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">ns</span></span> notes.db (<span class="hljs-symbol"><span class="hljs-symbol">:require</span></span> <span class="hljs-comment"><span class="hljs-comment">;  Monger monger.joda-time ;      [monger.core :as mg] [monger.collection :as m] [monger.operators :refer :all] ;    [joda-time :as t]) ;    Java  (:import org.bson.types.ObjectId org.joda.time.DateTimeZone)) ;        (DateTimeZone/setDefault DateTimeZone/UTC) ;      (defonce db (let [uri "mongodb://127.0.0.1/notes_db" {:keys [db]} (mg/connect-via-uri uri)] db)) ;        (defn- date-time "   " [] (t/date-time)) (defn remove-note "    ObjectId" [id] ;    ObjectId (let [id (ObjectId. id)] (m/remove-by-id db "notes" id))) (defn update-note "    ObjectId" [id note] ;    ObjectId (let [id (ObjectId. id)] ;     $set ;        ;       ;      ;   hash-map +    ;       ;     . ; -    ;   ObjectId   ;  update-by-id, ;      ;    (m/update db "notes" {:id id} ;    ;    {$set (assoc note :created (date-time))}))) (defn get-note "    ObjectId" [id] ;      :_id ;      ;     ObjectId ;   ,  ;     ObjectId (let [id (ObjectId. id)] ;    hash-map   (m/find-map-by-id db "notes" id))) (defn get-notes "  " [] ; Find-maps    ;     hash-map (m/find-maps db "notes")) (defn create-note "   " ;      ;    hash-map c : ; {:title "" :text ""} [note] ; Monger    ObjectId ;     ;     (let [object-id (ObjectId.)] ;     hash-map ;   ,  ;     ObjectId ;       (m/insert db "notes" (assoc note :_id object-id :created (date-time)))))</span></span></code> </pre><br></div></div><br><hr><br><br><h5>  Views (HTML template presentation) </h5><br>  In the views.clj file, we will place functions that display HTML templates and pass data to them.  The Selmer library, inspired by the data presentation system in Django templates, will help us.  Selmer also allows you to add filters (functions) for processing data in the template itself, tags, and provides flexible settings for yourself.  Let's write the page display functions: <br><br><div class="spoiler">  <b class="spoiler_title">views.clj</b> <div class="spoiler_text"><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">ns</span></span> notes.views (<span class="hljs-symbol"><span class="hljs-symbol">:require</span></span> <span class="hljs-comment"><span class="hljs-comment">; "" [selmer.parser :as parser] [selmer.filters :as filters] ;    [joda-time :as t] ;  HTTP  [ring.util.response :refer [content-type response]] ;  CSRF  [ring.util.anti-forgery :refer [anti-forgery-field]])) ;  Selmer     (parser/set-resource-path! (clojure.java.io/resource "templates")) ;     -  (defn format-date-and-time "   " [date] (let [formatter (t/formatter "yyyy-MM-dd  H:m:s" :date-time)] (when date (t/print formatter date)))) ;       (filters/add-filter! :format-datetime (fn [content] [:safe (format-date-and-time content)])) ;           ;     anti-forgery  (parser/add-tag! :csrf-field (fn [_ _] (anti-forgery-field))) (defn render [template &amp; [params]] "     html      " (-&gt; template (parser/render-file ;      ;      ;    (assoc params :title " " :page (str template))) ;     HTTP  response (content-type "text/html; charset=utf-8"))) (defn note "  " [note] (render "note.html" ;     {:note note})) (defn edit "  " [note] (render "edit.html" ;     {:note note})) (defn create "  " [] (render "create.html")) (defn index "  .  " [notes] (render "index.html" ;     ;  notes   false {:notes (if (not-empty notes) notes false)}))</span></span></code> </pre><br></div></div><br><hr><br><br><h4>  Front-end </h4><br><h5>  HTML templates </h5><br>  Our application is almost ready, it remains to create HTML files in which data will be displayed.  The <i>/ resources</i> directory is required to host static files, i.e.  even after compiling the application in a .jar or .war file, we can replace the files in it.  In the <i>public</i> in the next article we will add CSS tables.  In the meantime, create a <b>templates</b> directory where we place the HTML files. <br><br><hr><br><br>  First of all, we will create a base file for all templates, it will contain the main markup for all pages and the content block in which the markup of the remaining sections will be placed.  Let's start: <br><br><div class="spoiler">  <b class="spoiler_title">base.html</b> <div class="spoiler_text"><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">META</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Content-Type"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/html; charset=UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>{{title}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> {% ifequal page "index.html" %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">strong</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">strong</span></span></span><span class="hljs-tag">&gt;</span></span> {% else %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> {% endifequal %} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> {% ifequal page "create.html" %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">strong</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">strong</span></span></span><span class="hljs-tag">&gt;</span></span> {% else %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/create"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> {% endifequal %} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> {% block content %} {% endblock %} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br><hr><br><br>  Now we will impose a template with a form for creating a note.  In it, as in all forms of our application, you need to add the tag {% csrf-field%}, which we created in view.clj, otherwise when you send the form we get an error Invalid anti-forgery token.  Let's start: <br><br><div class="spoiler">  <b class="spoiler_title">create.html</b> <div class="spoiler_text"><pre> <code class="html hljs xml">{% extends "base.html" %} {% block content %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"POST"</span></span></span><span class="hljs-tag">&gt;</span></span> {% csrf-field %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"title"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">textarea</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">textarea</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> {% endblock %}</code> </pre><br></div></div><br><hr><br><br>  We already have a route, a view and a handler for editing a note, let's create a template with a form for all of this: <br><br><div class="spoiler">  <b class="spoiler_title">edit.html</b> <div class="spoiler_text"><pre> <code class="html hljs xml">{% extends "base.html" %} {% block content %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"POST"</span></span></span><span class="hljs-tag">&gt;</span></span> {% csrf-field %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"id"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{note._id}}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"title"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{note.title}}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">textarea</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag">&gt;</span></span>{{note.text}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">textarea</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> {% endblock %}</code> </pre><br></div></div><br><hr><br><br>  Next, we will impose a template for viewing the note, in which the attentive reader in the small tag will see a strange data view, this is something else like our filter created in view.clj.  To call filters in Selmer, it is customary to write: {{variable | filter}}.  Now the code itself: <br><br><div class="spoiler">  <b class="spoiler_title">note.html</b> <div class="spoiler_text"><pre> <code class="html hljs xml">{% extends "base.html" %} {% block content %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>{{note.title}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">small</span></span></span><span class="hljs-tag">&gt;</span></span>{{note.created|format-datetime}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">small</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>{{note.text}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> {% endblock %}</code> </pre><br></div></div><br><hr><br><br>  And finally, our main page, where the list of notes will be displayed: <br><br><div class="spoiler">  <b class="spoiler_title">note.html</b> <div class="spoiler_text"><pre> <code class="html hljs xml">{% extends "base.html" %} {% block content %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> {% if notes %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> {% for note in notes %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h4</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/note/{{note._id}}"</span></span></span><span class="hljs-tag">&gt;</span></span>{{note.title}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h4</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">small</span></span></span><span class="hljs-tag">&gt;</span></span>{{note.created|format-datetime}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">small</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/edit/{{note._id}}"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> | <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/delete/{{note._id}}"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> {% endfor %} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> {% else %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">strong</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">strong</span></span></span><span class="hljs-tag">&gt;</span></span> {% endif %} {% endblock %}</code> </pre><br></div></div><br><hr><br><br><h5>  Conclusion </h5><br>  Now our application is ready, of course we missed a very important step - testing the functions in the repl and viewing their results, but in the next article we will focus on it in detail. <br><br>  Let's run: <i>$ lein ring server</i> <br><br>  This command, like lein run, installs all dependencies, runs our application on Ring's basic Jetty web server at localhost: 3000.  I note that while we can not compile our application in a .jar or .war file or run it through lein run. <br><hr><br><br><h6>  Additional links </h6><br><ul><li>  <a href="https://github.com/clojurehunter/clojure-test-app-notes">Application code on Github</a> </li><li>  <a href="http://lighttable.com/">IDE LightTable</a> </li></ul><br><br>  In the next article we will add the immutant web server to our web application, and implement auto-update code ‚Äúon the fly‚Äù i.e.  as files are saved in the editor, our server will automatically update them and we will be able to see the results of the code change after reloading the page and not the server as it is now.  At the moment, on the fly, we can only change HTML files.  And we‚Äôll also add classes to our HTML Bootstrap, since the layout looks really not fun, despite the fact that the essence of the articles is not in a beautiful design, I think you shouldn‚Äôt go back to WEB 1.0. <br><br>  Despite the close check before publishing the article, I will be grateful if you notice inaccuracies in the description or grammar errors and let me know about it in the messages.  I would also like to thank the people who showed interest in my first article, I‚Äôm still happy to tell you about Clojure web development.  I say goodbye to this and wish you all the best! </div><p>Source: <a href="https://habr.com/ru/post/263131/">https://habr.com/ru/post/263131/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../263115/index.html">Clojure Web Applications</a></li>
<li><a href="../263117/index.html">10 years "on the knee" and forced evolution - note for young</a></li>
<li><a href="../263121/index.html">We continue to get acquainted with Intel Xeon Phi: "native" code</a></li>
<li><a href="../263125/index.html">International Mathematical Olympiad for Schoolchildren 2015. Am I? If I want to? Will I decide?</a></li>
<li><a href="../263129/index.html">Microsoft has released an unscheduled security update for Windows MS15-078</a></li>
<li><a href="../263139/index.html">Pussy: Refactoring. Part two or addiction treatment</a></li>
<li><a href="../263143/index.html">Geek online vacations of a modern child</a></li>
<li><a href="../263147/index.html">Hacked site AshleyMadison.com</a></li>
<li><a href="../263149/index.html">We get acquainted with Vorlon.js - debugging of web applications</a></li>
<li><a href="../263151/index.html">Google vs. Microsoft: Whose Clouds Are Better?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>