<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automate routine in Microsoft Excel using VBA</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings to all. 

 In this post I will tell you what VBA is and how to work with it in Microsoft Excel 2007/2010 (for older versions, only the inter...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automate routine in Microsoft Excel using VBA</h1><div class="post__text post__text-html js-mediator-article">  Greetings to all. <br><br>  In this post I will tell you what VBA is and how to work with it in Microsoft Excel 2007/2010 (for older versions, only the interface changes - the code is likely to be the same) to automate a different routine. <br><br><img src="https://habrastorage.org/storage/habraeffect/a7/62/a762f9d01ef454c166b85e0794cbd8e4.jpg" width="320" height="240">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  VBA (Visual Basic for Applications) is a simplified version of Visual Basic built into many Microsoft Office line products.  It allows you to write programs directly in the file of a specific document.  You do not need to install various IDEs - everything, including the debugger, is already in Excel. <br><br>  Even with Visual Studio Tools for Office, you can write macros in C # and also embed them.  Thank you, <a href="https://geektimes.ru/users/firestorm/" class="user_link">FireStorm</a> . <br><br>  I‚Äôll say right away - it is also possible to write in other languages ‚Äã‚Äã(C ++ / Delphi / PHP), but you need to learn how to read, change and write office files - you will not be able to embed them in documents.  And Microsoft interfaces work through <a href="http://ru.wikipedia.org/wiki/Component_Object_Model">COM</a> .  So that you understand all the horror, here is <a href="http://ru.wikipedia.org/wiki/Hello_world">Hello World</a> using COM. <br><br>  Therefore, alas, we will learn Visual Basic. <br><br><h1>  A little bit of preparation and task setting </h1><br>  So let's go.  Open Excel. <br><br>  First, let's add the Developer panel to the Ribbon.  It contains buttons, text fields and other elements for constructing forms. <br><br><img src="https://habrastorage.org/storage/habraeffect/17/af/17af7e3900e865d609ad8a5bf447961b.png" width="429" height="476"><img src="https://habrastorage.org/storage/habraeffect/9c/32/9c323b29db211531c30270faeda01bb2.png"><br><br>  Appeared tab. <br><br><img src="https://habrastorage.org/storage/habraeffect/33/1c/331c0e5a5d4f045b3fa0276fdbafd286.png" width="320" height="143"><br><br>  Now let's think about what example we will study VBA.  Recently, I needed to make a beautifully priced list that looked like a table.  We go to Google, dial the "price list" and download any that is designed like this (do not consider advertising, please): <br><br><img src="https://habrastorage.org/storage/habraeffect/23/80/238076ae9c942a8354fdbcf55697ba2b.png" width="939" height="383"><br><br>  That is, it is required that there be at least two groups according to which goods can be combined (in our case it will be <em>Type</em> and <em>Manufacturer</em> - in that order).  In order for the algorithm proposed by me to work correctly, sort the goods so that the products from one group stand in a row (first by <em>Type</em> , then by <em>Manufacturer</em> ). <br><br>  The result we want to achieve looks like this: <br><br><img src="https://habrastorage.org/storage/habraeffect/89/36/8936669c7ec9986885ffcbb328d1d911.png" width="518" height="484"><br><br>  Of course, if you look at the price only on a computer, you can add filters and it will be much more convenient to look for the right product.  However, we want to learn how to code and the task is quite suitable, is not it? <br><br><h1>  Code </h1><br>  First you need to create a button, when clicked, our program will be called.  The buttons are located in the ‚ÄúDeveloper‚Äù panel and appear by the ‚ÄúInsert‚Äù button.  You need a button form component.  Clicked, put on any place in the sheet.  Further, if the macro assignment window does not appear, you must right-click and select the ‚ÄúAssign Macro‚Äù item.  Let's call it FormatPrice.  It is important that before the macro name there is nothing - otherwise it will be created in a separate module, and not in the namespace of the book.  In this case, you will not be available quick access to the selected sheet.  Press the "New" button. <br><br><img src="https://habrastorage.org/storage/habraeffect/b9/7f/b97fe4668ef011e35d9e6c86c42368d7.png" width="167" height="207"><img src="https://habrastorage.org/storage/habraeffect/58/0b/580b44242f9276bce7f22f86a921b934.png" width="399" height="130"><br><br>  And here we are in the VB development environment.  You can also call it from the context menu using the Source / View code command. <br><br><img src="https://habrastorage.org/storage/habraeffect/bd/2c/bd2c8922ec72a11e9b856ce5f770b779.png"> <a href=""><img src="https://habrastorage.org/storage/habraeffect/5a/19/5a19d43c9de5dd8f2ae2b47531982d14.png" width="640" height="345"></a> <br><br>  Here is a window with a procedure stub.  You can deploy it.  The code should look something like this: <br><br> <code><font color="#E56717">Sub</font> FormatPrice() <br> <br> <font color="#8D38C9">End</font> <font color="#E56717">Sub</font></code> <br> <br>  Let's write Hello World: <br><br> <code><font color="#E56717">Sub</font> FormatPrice() <br> MsgBox <font color="#800000">"Hello World!"</font> <br> <font color="#8D38C9">End</font> <font color="#E56717">Sub</font></code> <br> <br>  And run either by clicking on the button (after removing the selection from it), or by pressing F5 directly from the editor. <br><br>  Here, perhaps, should be distracted by a small educational program about the syntax of VB.  Who knows - you can safely skip this section to the end.  The main difference between Visual Basic and Pascal / C / Java is that the commands are not separated <em>;</em>  , and a line break or a colon ( <em>:)</em> , if you really want to write several commands in one line.  To understand the basic rules of syntax, I will give an abstract code. <br><br><h5>  Syntax examples </h5><br> <code><font color="#008000">' .    <br></font> <font color="#008000">'   VBA  <br></font> <font color="#E56717">Sub</font> foo(a <font color="#151B8D">As</font> <font color="#F660AB">String</font> , b <font color="#151B8D">As</font> <font color="#F660AB">String</font> ) <br> <font color="#008000">' Exit Sub '   "  " <br></font> MsgBox a + <font color="#800000">";"</font> + b <br> <font color="#8D38C9">End</font> <font color="#E56717">Sub</font> <br> <br> <font color="#008000">' .  Integer <br></font> <font color="#E56717">Function</font> LengthSqr(x <font color="#151B8D">As</font> <font color="#F660AB">Integer</font> , y <font color="#151B8D">As</font> <font color="#F660AB">Integer</font> ) <font color="#151B8D">As</font> <font color="#F660AB">Integer</font> <br> <font color="#008000">' Exit Function <br></font> LengthSqr = x * x + y * y <br> <font color="#8D38C9">End</font> <font color="#E56717">Function</font> <br> <br> <font color="#E56717">Sub</font> FormatPrice() <br> <font color="#151B8D">Dim</font> s1 <font color="#151B8D">As</font> <font color="#F660AB">String</font> , s2 <font color="#151B8D">As</font> <font color="#F660AB">String</font> <br> s1 = <font color="#800000">"str1"</font> <br> s2 = <font color="#800000">"str2"</font> <br> <font color="#8D38C9">If</font> s1 &lt;&gt; s2 <font color="#8D38C9">Then</font> <br> foo <font color="#800000">"123"</font> , <font color="#800000">"456"</font> <font color="#008000">'      <br></font> <font color="#8D38C9">End</font> <font color="#8D38C9">If</font> <br> <br> <font color="#151B8D">Dim</font> res <font color="#151B8D">As</font> <font color="#F660AB">sTRING</font> <font color="#008000">'   VB  . ,    <br></font> <font color="#151B8D">Dim</font> i <font color="#151B8D">As</font> <font color="#F660AB">Integer</font> <br> <font color="#008000">'       <br></font> <font color="#8D38C9">For</font> i = 1 <font color="#8D38C9">To</font> 10 <br> res = res + CStr(i) <font color="#008000">'     String <br></font> <font color="#8D38C9">If</font> i = 5 <font color="#8D38C9">Then</font> <font color="#E56717">Exit</font> <font color="#8D38C9">For</font> <br> <font color="#8D38C9">Next</font> i <br> <br> <font color="#151B8D">Dim</font> x <font color="#151B8D">As</font> <font color="#F660AB">Double</font> <br> x = Val( <font color="#800000">"1.234"</font> ) <font color="#008000">'   <br></font> x = x + 10 <br> MsgBox x <br> <br> <font color="#151B8D">On</font> <font color="#151B8D">Error</font> <font color="#151B8D">Resume</font> <font color="#8D38C9">Next</font> <font color="#008000">'   -    <br></font> x = 5 / 0 <br> MsgBox x <br> <br> <font color="#151B8D">On</font> <font color="#151B8D">Error</font> <font color="#8D38C9">GoTo</font> Err <font color="#008000">'      Err <br></font> x = 5 / 0 <br> MsgBox <font color="#800000">"OK!"</font> <br> <font color="#8D38C9">GoTo</font> ne <br> <br> Err: <br> MsgBox <font color="#800000">"Err!"</font> <br> <br> ne: <br> <font color="#151B8D">On</font> <font color="#151B8D">Error</font> <font color="#8D38C9">GoTo</font> 0 <font color="#008000">'    <br></font> <br> <font color="#008000">'  ,   <br></font> <font color="#8D38C9">Do</font> <font color="#8D38C9">While</font> <font color="#00C2FF">True</font> <br> <font color="#E56717">Exit</font> <font color="#8D38C9">Do</font> <br> <br> <font color="#8D38C9">Loop</font> <font color="#008000">'While True <br></font> <font color="#8D38C9">Do</font> <font color="#008000">'Until False <br></font> <font color="#E56717">Exit</font> <font color="#8D38C9">Do</font> <br> <font color="#8D38C9">Loop</font> <font color="#8D38C9">Until</font> <font color="#00C2FF">False</font> <br> <font color="#008000">'     ,     ,  . <br></font> <font color="#008000">' Val    Integer <br></font> <font color="#8D38C9">Select</font> <font color="#8D38C9">Case</font> LengthSqr(Len( <font color="#800000">"abc"</font> ), Val( <font color="#800000">"4"</font> )) <br> <font color="#8D38C9">Case</font> 24 <br> MsgBox <font color="#800000">"0"</font> <br> <font color="#8D38C9">Case</font> 25 <br> MsgBox <font color="#800000">"1"</font> <br> <font color="#8D38C9">Case</font> 26 <br> MsgBox <font color="#800000">"2"</font> <br> <font color="#8D38C9">End</font> <font color="#8D38C9">Select</font> <br> <br> <font color="#008000">'  . <br></font> <font color="#008000">'      ReDim (Preserve) - . google <br></font> <font color="#151B8D">Dim</font> arr(1 <font color="#8D38C9">to</font> 10, 5 <font color="#8D38C9">to</font> 6) <font color="#151B8D">As</font> <font color="#F660AB">Integer</font> <br> arr(1, 6) = 8 <br> <br> <font color="#151B8D">Dim</font> coll <font color="#151B8D">As</font> <font color="#E56717">New</font> Collection <br> <font color="#151B8D">Dim</font> coll2 <font color="#151B8D">As</font> Collection <br> coll.Add <font color="#800000">"item"</font> , <font color="#800000">"key"</font> <br> <font color="#151B8D">Set</font> coll2 = coll <font color="#008000">'       Set <br></font> MsgBox coll2( <font color="#800000">"key"</font> ) <br> <font color="#151B8D">Set</font> coll2 = <font color="#E56717">New</font> Collection <br> MsgBox coll2.Count <br> <font color="#8D38C9">End</font> <font color="#E56717">Sub</font></code> <br> <br>  <strong>Rake-1.</strong>  When copying code from IDE (in English Excel), the entire text is converted to <em>1252 Latin-1</em> .  Therefore, if you want to save Russian comments, you must save the crocodiles as <em>Latin-1</em> , and then open them in 1251. <br><br>  <strong>Rake-2.</strong>  Because  VB allows you to use undeclared variables, I always at the beginning of the code (before all procedures) put the line <em>Option Explicit</em> .  This directive forbids the interpreter to set variables on its own. <br><br>  <strong>Rake-3.</strong>  Global variables can only be declared before the first function / procedure.  Local - anywhere in the procedure / function. <br><br>  Some more additional features that may come in handy: <em>InPos</em> , <em>Mid</em> , <em>Trim</em> , <em>LBound</em> , <em>UBound</em> .  Also, answers to all questions regarding the operation of functions / their parameters can be obtained in MSDN. <br><br>  I hope that this will be enough for you not to be afraid of the code and write some homework on computer science yourself.  In the course of the post, I will unobtrusively acquaint you with new designs. <br><br><h1>  Code a lot and under Excel </h1><br>  In this part we will begin to code something that can work with our sheets in Excel.  To begin with, we will create a separate sheet with the name <em>result</em> (the sheet with the data is called <em>data</em> ).  Now, probably, you need to clear this sheet of what is on it.  We also ‚Äúselect‚Äù a data sheet in order not to write a long call to an array with sheets each time. <br><br> <code><font color="#E56717">Sub</font> FormatPrice() <br> Sheets( <font color="#800000">"result"</font> ).Cells.Clear <br> Sheets( <font color="#800000">"data"</font> ).Activate <br> <font color="#8D38C9">End</font> <font color="#E56717">Sub</font></code> <br> <br><h2>  Work with cell ranges </h2><br>  All work in Excel VBA is done with a range of cells.  They are created by the <em>Range</em> function and return an object of type <em>Range</em> .  He has everything you need to work with data and / or design.  By the way, the <em>Cells</em> sheet property is also <em>Range</em> . <br><br><h5>  Examples of working with <em>Range</em> </h5><br> <code>Sheets( <font color="#800000">"result"</font> ).Activate <br> <font color="#151B8D">Dim</font> r <font color="#151B8D">As</font> Range <br> <font color="#151B8D">Set</font> r = Range( <font color="#800000">"A1"</font> ) <br> r.Value = <font color="#800000">"123"</font> <br> <font color="#151B8D">Set</font> r = Range( <font color="#800000">"A3,A5"</font> ) <br> r.Font.Color = vbRed <br> r.Value = <font color="#800000">"456"</font> <br> <font color="#151B8D">Set</font> r = Range( <font color="#800000">"A6:A7"</font> ) <br> r.Value = <font color="#800000">"=A1+A3"</font></code> <br> <br>  Now let's understand the algorithm of our code.  So, each line of the <em>data</em> sheet, starting from the second, has some data that we are not interested in ( <em>ID</em> , <em>name</em> and <em>price</em> ) and there are two nested groups to which it belongs ( <em>type</em> and <em>manufacturer</em> ).  Moreover, these lines are sorted.  While we forget about the passes before the start of the new group, it will be easier.  I suggest this algorithm: <br><br><ol><li>  Considered groups from the next line. </li><li>  Run across all groups in order of priority (larger ones first) <br><ol><li>  If the current group does not match, we call the procedure <em>AddGroup (i, name)</em> , where <em>i</em> is the group number (from the current number to the maximum), <em>name</em> is its name.  Several calls are needed to create not only our header, but smaller ones as well. </li></ol></li><li>  After drawing all the necessary headers, we make another line and fill it with data. </li></ol><br><br>  To simplify the work, I recommend defining the following abbreviations: <br><br> <code><font color="#E56717">Function</font> GetCol(Col <font color="#151B8D">As</font> <font color="#F660AB">Integer</font> ) <font color="#151B8D">As</font> <font color="#F660AB">String</font> <br> GetCol = Chr(Asc( <font color="#800000">"A"</font> ) + Col) <br> <font color="#8D38C9">End</font> <font color="#E56717">Function</font> <br> <br> <font color="#E56717">Function</font> GetCellS(Sheet <font color="#151B8D">As</font> <font color="#F660AB">String</font> , Col <font color="#151B8D">As</font> <font color="#F660AB">Integer</font> , Row <font color="#151B8D">As</font> <font color="#F660AB">Integer</font> ) <font color="#151B8D">As</font> Range <br> <font color="#151B8D">Set</font> GetCellS = Sheets(Sheet).Range(GetCol(Col) + CStr(Row)) <br> <font color="#8D38C9">End</font> <font color="#E56717">Function</font> <br> <br> <font color="#E56717">Function</font> GetCell(Col <font color="#151B8D">As</font> <font color="#F660AB">Integer</font> , Row <font color="#151B8D">As</font> <font color="#F660AB">Integer</font> ) <font color="#151B8D">As</font> Range <br> <font color="#151B8D">Set</font> GetCell = Range(GetCol(Col) + CStr(Row)) <br> <font color="#8D38C9">End</font> <font color="#E56717">Function</font></code> <br> <br>  Next, we define the global variable ‚Äúcurrent line‚Äù: <em>Dim CurRow As Integer</em> .  At the beginning of the procedure, it should be made equal to one.  We also need the variable ‚Äúcurrent line in <em>data</em> ‚Äù, an array with the group names of the current previous lines.  Then you can write the cycle ‚Äúuntil the first cell in the row is non-empty‚Äù. <br><br><h5>  Global variables </h5><br> <code><font color="#E56717">Option</font> <font color="#E56717">Explicit</font> <font color="#008000">'       <br></font> <font color="#151B8D">Dim</font> CurRow <font color="#151B8D">As</font> <font color="#F660AB">Integer</font> <br> Const GroupsCount <font color="#151B8D">As</font> <font color="#F660AB">Integer</font> = 2 <br> Const DataCount <font color="#151B8D">As</font> <font color="#F660AB">Integer</font> = 3</code> <br> <br><h5>  FormatPrice </h5><br> <code><font color="#E56717">Sub</font> FormatPrice() <br> <font color="#151B8D">Dim</font> I <font color="#151B8D">As</font> <font color="#F660AB">Integer</font> <font color="#008000">'   data <br></font> CurRow = 1 <br> <font color="#151B8D">Dim</font> Groups(1 <font color="#8D38C9">To</font> GroupsCount) <font color="#151B8D">As</font> <font color="#F660AB">String</font> <br> <font color="#151B8D">Dim</font> PrGroups(1 <font color="#8D38C9">To</font> GroupsCount) <font color="#151B8D">As</font> <font color="#F660AB">String</font> <br> <br> Sheets( <font color="#800000">"data"</font> ).Activate <br> I = 2 <br> <font color="#8D38C9">Do</font> <font color="#8D38C9">While</font> <font color="#00C2FF">True</font> <br> <font color="#8D38C9">If</font> GetCell(0, I).Value = <font color="#800000">""</font> <font color="#8D38C9">Then</font> <font color="#E56717">Exit</font> <font color="#8D38C9">Do</font> <br> <font color="#008000">' ... <br></font> I = I + 1 <br> <font color="#8D38C9">Loop</font> <br> <font color="#8D38C9">End</font> <font color="#E56717">Sub</font></code> <br> <br>  Now you need to fill in the <em>Groups</em> array: <br><br><h5>  In place of the dot </h5><br> <code><font color="#151B8D">Dim</font> I2 <font color="#151B8D">As</font> <font color="#F660AB">Integer</font> <br> <font color="#8D38C9">For</font> I2 = 1 <font color="#8D38C9">To</font> GroupsCount <br> Groups(I2) = GetCell(I2, I) <br> <font color="#8D38C9">Next</font> I2 <br> <font color="#008000">' ... <br></font> <font color="#8D38C9">For</font> I2 = 1 <font color="#8D38C9">To</font> GroupsCount <font color="#008000">' VB     <br></font> PrGroups(I2) = Groups(I2) <br> <font color="#8D38C9">Next</font> I2 <br> I =  I + 1</code> <br> <br>  And create headlines: <br><br><h5>  On the dot in the previous piece </h5><br> <code><font color="#8D38C9">For</font> I2 = 1 <font color="#8D38C9">To</font> GroupsCount <br> <font color="#8D38C9">If</font> Groups(I2) &lt;&gt; PrGroups(I2) <font color="#8D38C9">Then</font> <br> <font color="#151B8D">Dim</font> I3 <font color="#151B8D">As</font> <font color="#F660AB">Integer</font> <br> <font color="#8D38C9">For</font> I3 = I2 <font color="#8D38C9">To</font> GroupsCount <br> AddHeader I3, Groups(I3) <br> <font color="#8D38C9">Next</font> I3 <br> <font color="#E56717">Exit</font> <font color="#8D38C9">For</font> <br> <font color="#8D38C9">End</font> <font color="#8D38C9">If</font> <br> <font color="#8D38C9">Next</font> I2</code> <br> <br>  Let's not forget about the <em>AddHeader</em> procedure: <br><br><h5>  Before <em>Format</em> Price </h5><br> <code><font color="#E56717">Sub</font> AddHeader(Ty <font color="#151B8D">As</font> <font color="#F660AB">Integer</font> , Name <font color="#151B8D">As</font> <font color="#F660AB">String</font> ) <br> GetCellS( <font color="#800000">"result"</font> , 1, CurRow).Value = Name <br> CurRow = CurRow + 1 <br> <font color="#8D38C9">End</font> <font color="#E56717">Sub</font></code> <br> <br>  Now you need to transfer any information to <em>result.</em> <br><br> <code><font color="#8D38C9">For</font> I2 = 0 <font color="#8D38C9">To</font> DataCount - 1 <br> GetCellS( <font color="#800000">"result"</font> , I2, CurRow).Value = GetCell(I2, I) <br> <font color="#8D38C9">Next</font> I2</code> <br> <br>  Fit the columns to the width and select the <em>result</em> sheet to display the result. <br><br><h5>  After the loop at the end of <em>FormatPrice</em> </h5><br> <code>Sheets( <font color="#800000">"Result"</font> ).Activate <br> Columns.AutoFit</code> <br> <br>  Everything.  You can admire the first version. <br><br><img src="https://habrastorage.org/storage/habraeffect/28/a7/28a7a89d52499b6a865993ac81a883dc.png" width="518" height="234"><br><br>  Ugly, but similar.  Let's deal with formatting.  First, change the procedure <em>AddHeader</em> : <br><br> <code><font color="#E56717">Sub</font> AddHeader(Ty <font color="#151B8D">As</font> <font color="#F660AB">Integer</font> , Name <font color="#151B8D">As</font> <font color="#F660AB">String</font> ) <br> Sheets( <font color="#800000">"result"</font> ).Range( <font color="#800000">"A"</font> + CStr(CurRow) + <font color="#800000">":C"</font> + CStr(CurRow)).Merge <br> <font color="#008000">'            <br></font> <font color="#008000">'    With <br></font> <font color="#8D38C9">With</font> GetCellS( <font color="#800000">"result"</font> , 0, CurRow) <br> .Value = Name <br> .Font.Italic = <font color="#00C2FF">True</font> <br> .Font.Name = <font color="#800000">"Cambria"</font> <br> <font color="#8D38C9">Select</font> <font color="#8D38C9">Case</font> Ty <br> <font color="#8D38C9">Case</font> 1 <font color="#008000">'  <br></font> .Font.Bold = <font color="#00C2FF">True</font> <br> .Font.Size = 16 <br> <font color="#8D38C9">Case</font> 2 <font color="#008000">'  <br></font> .Font.Size = 12 <br> <font color="#8D38C9">End</font> <font color="#8D38C9">Select</font> <br> .HorizontalAlignment = xlCenter <br> <font color="#8D38C9">End</font> <font color="#8D38C9">With</font> <br> CurRow = CurRow + 1 <br> <font color="#8D38C9">End</font> <font color="#E56717">Sub</font></code> <br> <br>  Already better: <br><br><img src="https://habrastorage.org/storage/habraeffect/88/05/8805063bd924b908fe6d475ecd2d40cf.png" width="534" height="275"><br><br>  It remains only to make the border.  Here we need to work with all the merged cells, otherwise there will be only one border: <br><br><img src="https://habrastorage.org/storage/habraeffect/42/d0/42d0a65c401d03271f56aaf7eabd3266.png" width="334" height="87"><br><br>  Therefore, we slightly change the code with the addition of border style: <br><br> <code><font color="#E56717">Sub</font> AddHeader(Ty <font color="#151B8D">As</font> <font color="#F660AB">Integer</font> , Name <font color="#151B8D">As</font> <font color="#F660AB">String</font> ) <br> <font color="#8D38C9">With</font> Sheets( <font color="#800000">"result"</font> ).Range( <font color="#800000">"A"</font> + CStr(CurRow) + <font color="#800000">":C"</font> + CStr(CurRow)) <br> .Merge <br> .Value = Name <br> .Font.Italic = <font color="#00C2FF">True</font> <br> .Font.Name = <font color="#800000">"Cambria"</font> <br> .HorizontalAlignment = xlCenter <br> <br> <font color="#8D38C9">Select</font> <font color="#8D38C9">Case</font> Ty <br> <font color="#8D38C9">Case</font> 1 <font color="#008000">'  <br></font> .Font.Bold = <font color="#00C2FF">True</font> <br> .Font.Size = 16 <br> .Borders(xlTop).Weight = xlThick <br> <font color="#8D38C9">Case</font> 2 <font color="#008000">'  <br></font> .Font.Size = 12 <br> .Borders(xlTop).Weight = xlMedium <br> <font color="#8D38C9">End</font> <font color="#8D38C9">Select</font> <br> .Borders(xlBottom).Weight = xlMedium <font color="#008000">'  : xlThick, xlMedium, xlThin, xlHairline <br></font> <font color="#8D38C9">End</font> <font color="#8D38C9">With</font> <br> CurRow = CurRow + 1 <br> <font color="#8D38C9">End</font> <font color="#E56717">Sub</font></code> <br> <br><img src="https://habrastorage.org/storage/habraeffect/53/bf/53bfa46bf1e5f6aa251a86e2508b3107.png" width="559" height="321"><br><br>  It remains only to achieve gaps before the start of the new group.  It is easy: <br><br><h5>  At the beginning of <em>FormatPrice</em> </h5><br> <code><font color="#151B8D">Dim</font> I <font color="#151B8D">As</font> <font color="#F660AB">Integer</font> <font color="#008000">'    data <br></font> CurRow = 0 <font color="#008000">'        <br></font> <font color="#151B8D">Dim</font> Groups(1 <font color="#8D38C9">To</font> GroupsCount) <font color="#151B8D">As</font> <font color="#F660AB">String</font></code> <br> <br><h5>  In the header placement loop </h5><br> <code><font color="#8D38C9">If</font> Groups(I2) &lt;&gt; PrGroups(I2) <font color="#8D38C9">Then</font> <br> CurRow = CurRow + 1 <br> <font color="#151B8D">Dim</font> I3 <font color="#151B8D">As</font> <font color="#F660AB">Integer</font></code> <br> <br><img src="https://habrastorage.org/storage/habraeffect/96/dd/96ddc98d13ee026ae82cb335c92d8ef4.png" width="516" height="603"><br><br>  Exactly what they wanted. <br><br>  I hope that this article has helped you get a little comfortable with Excel programming in VBA.  Homework - add the headings " <em>ID, Title, Price</em> " to the result.  Hint: <font><s><em>CurRow = 0</em></s></font> <em>CurRow = 1</em> . <br><br>  The file can be downloaded <a href="http://min.us/mvhof">here</a> (min.us) or <a href="http://dl.dropbox.com/u/19006605/sample.xlsm">here</a> (Dropbox).  Do not forget to allow the execution of macros.  <s>If someone tells human file hosting, I'll upload it there.</s> <br><br>  Thanks for attention. <br>  I will be glad to constructive criticism in the comments. <br>  <b>UPD:</b> Perezalil example on Dropbox and min.us. <br>  <b>UPD2:</b> In fact, when calling a procedure with a <i>single</i> parameter, brackets can be supplied.  Or use the <i>Call Foo</i> construction <i>(‚Äúbar‚Äù, 1, 2, 3)</i> - here brackets are needed all the time. </div><p>Source: <a href="https://habr.com/ru/post/112080/">https://habr.com/ru/post/112080/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../112073/index.html">Nekto.me - anonymous comment service</a></li>
<li><a href="../112074/index.html">3D without glasses</a></li>
<li><a href="../112077/index.html">Cookies inside the iframe - a problem when creating the application VKontakte / Facebook</a></li>
<li><a href="../112078/index.html">Results of CES 2011 from Samsung</a></li>
<li><a href="../112079/index.html">Otsu object detection</a></li>
<li><a href="../112081/index.html">Vogue-Tec News # 1</a></li>
<li><a href="../112083/index.html">Modern web forms: some more subtleties</a></li>
<li><a href="../112084/index.html">W3C introduced the HTML5 logo</a></li>
<li><a href="../112088/index.html">rospil.info and ruleaks.net underwent a DOS attack</a></li>
<li><a href="../112089/index.html">Logitech G9 -> G9x. Another history of equipment replacement service Logitech</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>