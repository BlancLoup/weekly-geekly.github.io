<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cline and creating an interactive command line application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Regardless of how great your love for the command line is, agree that the simple and convenient console interface, history support, auto addition, sim...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cline and creating an interactive command line application</h1><div class="post__text post__text-html js-mediator-article">  Regardless of how great your love for the command line is, agree that the simple and convenient console interface, history support, auto addition, simple commands are quite impressive.  Without going into discussions about the advantages and disadvantages of the ‚Äúdarkness‚Äù, I want to submit to the Habra community a small craft from the world of Node.js, whose main task is to improve the life of the developer who decided to write a console utility. <br><br><h2>  Cline Overview </h2><br>  Cline is a small library based on the <a href="http://nodejs.org/api/readline.html">readline</a> nodovsky module, so we have history support, auto addition, user interrogation and, with my light hand, additions in the form of a password input mask, the ability to listen to user input as separate commands described as simple or regular expressions, help output, simplified work with history, interactive mode. <br><br>  With all this, creating an application that, once launched, will wait for commands from the user to be entered at times easier. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Example </h2><br>  For those who have enough code to understand the library‚Äôs capabilities, here‚Äôs an example: <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cli = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'cline'</span></span>)(); cli.command(<span class="hljs-string"><span class="hljs-string">'start'</span></span>, <span class="hljs-string"><span class="hljs-string">'starts program'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ cli.password(<span class="hljs-string"><span class="hljs-string">'Password:'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">str</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(str); }) }); cli.command(<span class="hljs-string"><span class="hljs-string">'stop'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ cli.confirm(<span class="hljs-string"><span class="hljs-string">'Sure?'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ok</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ok) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'done'</span></span>); } }) }); cli.command(<span class="hljs-string"><span class="hljs-string">'{string}'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, {<span class="hljs-attr"><span class="hljs-attr">string</span></span>: <span class="hljs-string"><span class="hljs-string">'[A-Za-z]+'</span></span>}); cli.command(<span class="hljs-string"><span class="hljs-string">'{number}'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, {<span class="hljs-attr"><span class="hljs-attr">number</span></span>: <span class="hljs-string"><span class="hljs-string">'\\d+'</span></span>}); cli.on(<span class="hljs-string"><span class="hljs-string">'command'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">input, cmd</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">'start'</span></span> !== cmd &amp;&amp; <span class="hljs-string"><span class="hljs-string">'stop'</span></span> != cmd) { cli.prompt(<span class="hljs-string"><span class="hljs-string">'More details on '</span></span> + cmd + <span class="hljs-string"><span class="hljs-string">':'</span></span>); } }); cli.history([<span class="hljs-string"><span class="hljs-string">'start'</span></span>, <span class="hljs-string"><span class="hljs-string">'stop'</span></span>]); cli.interact(<span class="hljs-string"><span class="hljs-string">'&gt;'</span></span>); cli.on(<span class="hljs-string"><span class="hljs-string">'history'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'New history item '</span></span> + item); }); cli.on(<span class="hljs-string"><span class="hljs-string">'close'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'History:'</span></span> + cli.history()); process.exit(); });</code> </pre> <br></div></div><br><br><h2>  Using </h2><br>  Cline uses <a href="http://nodejs.org/api/readline.html">Interface</a> or something similar to it in its work, if you have your own implementation of Interface, you can pass it as a parameter (testing support): <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cli = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'cline'</span></span>)(myInterface);</code> </pre> <br>  The central cline feature is the addition of commands. <br><pre> <code class="javascript hljs">cli.command(expression, description, parameters, callback);</code> </pre> <br>  <i>expression</i> is an expression that we expect from the user, can contain dynamic parameters, for example, kill {id}, here id is the name of the dynamic parameter, I will remind about it later. <br><br>  <i>description</i> - additional explanation for the command, used to generate help. <br><br>  <i>parameters</i> - an object containing the names of dynamic parameters referred to in expressions, as keys, and regular expressions, as values.  For example, {id: '\\ d +'} - id would mean any number. <br><br>  <i>callback</i> is the function that will be called when the user enters the string corresponding to expression.  It is called with two arguments: a string from the user and an object with the values ‚Äã‚Äãof dynamic parameters. <br><pre> <code class="javascript hljs">cli.command(<span class="hljs-string"><span class="hljs-string">'kill {id}'</span></span>, <span class="hljs-string"><span class="hljs-string">'kill task by id'</span></span>, {<span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-string"><span class="hljs-string">'\\d{1,3}'</span></span>}, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">input, args</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(input) <span class="hljs-comment"><span class="hljs-comment">// kill 12 console.log(args.id) // 12 });</span></span></code> </pre><br>  All cli.command parameters, except for expression, are optional, with which you can skip as you please. <br><pre> <code class="javascript hljs">cli.command(expression, description, callback); cli.command(expression, parameters, callback); cli.command(expression, description); cli.command(expression, parameters);</code> </pre><br>  All these options are absolutely valid. <br><br><h2>  User interaction </h2><br>  You can expect 3 things from the user: <br><br>  1. Input <br><pre> <code class="javascript hljs">cli.prompt(<span class="hljs-string"><span class="hljs-string">'Your turn:'</span></span>);</code> </pre> <br>  2. Confirmation <br><pre> <code class="javascript hljs">cli.confirm(<span class="hljs-string"><span class="hljs-string">'Sure?'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ok</span></span></span><span class="hljs-function">) </span></span>{});</code> </pre> <br>  3. Password <br><pre> <code class="javascript hljs">cli.password(<span class="hljs-string"><span class="hljs-string">'Password:'</span></span>, <span class="hljs-string"><span class="hljs-string">'*'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pass</span></span></span><span class="hljs-function">) </span></span>{});</code> </pre> <br><br>  And also you can just go online <br><pre> <code class="javascript hljs">cli.interact(<span class="hljs-string"><span class="hljs-string">'&gt;'</span></span>);</code> </pre> <br>  In this mode, the library waits for input from the user and tries to interpret each line as a command, looking for matches in the list of described commands, and after executing the listener function on the command, again waits for input.  Recalling the interactive mode will simply change the prompt. <br><br><h2>  System commands, history and events </h2><br>  Without any additional manipulations when using cline, 3 commands are immediately available: <br>  <i>clear</i> or <i>\ c</i> - clears the screen <br><br>  <i>help</i> or <i>\?</i>  - displays help <br><br>  <i>exit</i> or <i>\ q</i> - exit <br><br>  Everything is simple with history, no files or streams, just fill in the history like this: <br><pre> <code class="javascript hljs">cli.history([<span class="hljs-string"><span class="hljs-string">'start'</span></span>, <span class="hljs-string"><span class="hljs-string">'stop'</span></span>]);</code> </pre> <br>  the order of the elements corresponds to the age; the first element in the list will be the oldest. <br>  Well, you can read the story like this: <br><pre> <code class="javascript hljs">cli.history();</code> </pre> <br>  get the list.  You can also subscribe to the event of adding an item to the history.  Well, then you decide how to save this list. <br><br>  Since the cline inherits from EventEmitter, the event model is widely used here, you can subscribe to such events: <br>  <i>close</i> - the user called an exit command or stopped the process using Ctrl + C <br><br>  <i>history</i> - when a new item is added to the history, the new item is passed to the listener as a parameter. <br><br>  <i>command</i> - the user's input coincided from one of the commands (except system), the string from the user and the command expression are passed as a parameter to the listener. <br><br><h2>  At last </h2><br>  If you do not want to be silent silently when the user enters something other than the commands that you described, do this: <br><pre> <code class="javascript hljs">cli.command(<span class="hljs-string"><span class="hljs-string">'*'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">input</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(input + <span class="hljs-string"><span class="hljs-string">' is not correct'</span></span>); cli.usage(); });</code> </pre> <br>  Thank you very much for your attention, I hope you find cline useful, or maybe even inspire you to write your console utility, or at least a fork in a <a href="https://github.com/kucoe/cline">githaba</a> . <br><br>  PS Special thanks to UFO for an invite. </div><p>Source: <a href="https://habr.com/ru/post/196380/">https://habr.com/ru/post/196380/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../196370/index.html">We write a simple analogue of the Yandex.Disk client under Linux (and Windows)</a></li>
<li><a href="../196372/index.html">Features of embedding in key mechanisms of Linux kernel using LSM</a></li>
<li><a href="../196374/index.html">Simple words about Fourier transform</a></li>
<li><a href="../196376/index.html">How to make a module 1C-Bitrix</a></li>
<li><a href="../196378/index.html">One Platform Foundation: AppDF and OpenIAB Overview</a></li>
<li><a href="../196382/index.html">Some Python features you may not have known about</a></li>
<li><a href="../196384/index.html">The epic of the WD My Book Live, or "device-sweetie" with "cookies"</a></li>
<li><a href="../196388/index.html">How Mail.Ru Group Kills AAA-Class MMO Games</a></li>
<li><a href="../196390/index.html">Generalization task</a></li>
<li><a href="../196394/index.html">Mistress of the present - integrated graphics (Intel GPU) 2013 or "mylophone with me!"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>