<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Adapt nooLite to work with Apple HomeKit</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I have long been fascinated by the topic of technology in general and home automation in particular. A couple of years ago, this passion developed int...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Adapt nooLite to work with Apple HomeKit</h1><div class="post__text post__text-html js-mediator-article"><p>  I have long been fascinated by the topic of technology in general and home automation in particular.  A couple of years ago, this passion developed into a professional activity that I still do today.  My company specializes in installing and configuring the Convenient Home systems (well, it doesn‚Äôt allow me to call my conscience a smart home what can be done for adequate money). </p><br><p>  Work with the object can be divided into 3 stages: </p><br><ol><li>  Communication with the customer, obtaining information about the expected functions of the system and their priorities </li><li>  Installation and Setup </li><li>  Communication with the customer, receiving feedback on the system, missing functions, functions that remained unclaimed. </li></ol><br><p>  As practice shows, in the first stage, absolutely all clients believe that controlling the light from the phone is the main function of the system, which they will use constantly <del>  especially in the toilet </del>  .  But after some time after use, it turns out that a minority uses this option.  Since, basically, the users of the system are the owners of the iPhone, to control the house, you must unlock the phone, open the application, select the desired room and then turn on the light.  It turns out that it is much easier for a person to reach the nearest switch. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/f07/1e8/424/f071e8424b3a40f7803272945e43b423.png"></div><br><p>  I understood that this process can be somehow simplified, but I did not seriously deal with this.  But recently, two interesting updates came to the market, which pushed us with <a href="https://geektimes.ru/users/RagimovRV/">@RagimovRV</a> to try to add some ingenuity to my and Convenient Homes clients. </p><br><a name="habracut"></a><br><h1 id="umnyy-dom-noolite-teper-esche-umnee">  "Smart Home" nooLite is now even smarter </h1><br><p>  Almost under each article on Habrahabr and Geektimes, in which the noolight equipment is mentioned, there is a comment with the question: "When will the feedback appear?".  More than a year ago, at an exhibition in St. Petersburg, Igor Chavlytko, director of Nootech‚Äôs company, said that they were going to start working on blocks with feedback and encryption, which might be working on a different frequency.  All summer we talked about the expected blocks and discussed possible functions. </p><br><p>  Finally, in mid-October, the first test devices came to us to detect errors, test new features and obtain information about missing features.  The test kit consists of two power units and one usb / uart transceiver.  The blocks are marked with the SLF-200 marking, from which it follows that we have a non-dimmable block (sl) with a capacity of 200 watts (what the number means) and the new letter F now indicates the use of the new protocol, described below.  The transceiver can be connected to a computer via USB port or disassembled and connected via UART to Arduino, Raspberry Pi and similar devices. </p><br><p>  Externally, the adapter and the unit do not differ from their predecessors, but it is worth noting that there are places for soldering wires on the power unit board of the test sample, to which a switch or button can be connected (the operating mode is configured by a special service command from the adapter, the default is a switching switch) . </p><br><h2 id="o-protokole">  About the protocol: </h2><br><p>  To control the module, you need to send a packet of 17 bytes through the UART.  In case of successful reception of the control packet, the module will transmit a response, which will contain information on the status of the adapter and additional information from the blocks. </p><br><p>  Data transfer to adapter: </p><br><table><thead><tr><th>  ST </th><th>  MODE </th><th>  CTR </th><th>  Res </th><th>  CH </th><th>  Cmd </th><th>  FMT </th><th>  DATA </th><th>  ID </th><th>  CRC </th><th>  SP </th></tr></thead><tbody><tr><td>  one </td><td>  one </td><td>  one </td><td>  one </td><td>  one </td><td>  one </td><td>  one </td><td>  four </td><td>  four </td><td>  one </td><td>  one </td></tr><tr><td>  171 </td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>  172 </td></tr></tbody></table><br><p>  Adapter response (read data from adapter): </p><br><table><thead><tr><th>  ST </th><th>  MODE </th><th>  CTR </th><th>  TOGL </th><th>  CH </th><th>  Cmd </th><th>  FMT </th><th>  DATA </th><th>  ID </th><th>  CRC </th><th>  SP </th></tr></thead><tbody><tr><td>  one </td><td>  one </td><td>  one </td><td>  one </td><td>  one </td><td>  one </td><td>  one </td><td>  four </td><td>  four </td><td>  one </td><td>  one </td></tr><tr><td>  173 </td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>  174 </td></tr></tbody></table><br><p>  Perhaps it is worth decipher the following abbreviations: </p><br><blockquote>  ST - Starting Byte <br>  MODE - Adapter operation mode (receiver / transmitter, nooLite / nooLite F, service mode) <br>  CTR - Adapter Management <br>  RES - Reserved, not used. <br>  TOGL - The number of remaining responses from the adapter <br>  CH - Channel Address, cells to bind <br>  CMD - Team <br>  FMT - Format (The amount of data transmitted with the command) <br>  DATA - 4 bytes of data <br>  ID - Block identifier (Device address in the nooLite-F system) <br>  CRC - Checksum <br>  SP - Stop Byte </blockquote><p>  Commands that have been added to the new version of the blocks: </p><br><table><thead><tr><th>  Code </th><th>  Team </th><th>  Description </th></tr></thead><tbody><tr><td>  128 </td><td>  Status Request CMD_Read_State </td><td>  Request to get block status.  The FMT contains information about the field with the data that is requested.  Answer - CMD_SEND_STATE </td></tr><tr><td>  129 </td><td>  Device Configuration CMD_Write_State </td><td>  Configure the device.  The FMT contains the address of the field to be configured.  D0 ... D3 correspond in the specified field.  Answer - CMD_SEND_STATE </td></tr><tr><td>  130 </td><td>  Transmit CMD_Send_State </td><td>  FMT value = type of data requested or error code;  0 - General Information </td></tr></tbody></table><br><p>  I will not provide a table of state setting data register values, but I will indicate which parameters are available for setting. </p><br><p>  Stored in long-term memory: </p><br><ul><li>  Remember the state of the block before the loss of electricity: yes / no </li><li>  Block operation mode: on + off / on + off + brightness </li><li>  Forbid reception of commands from the system nooLite 1.0: yes / no </li><li>  The mode of operation of the auxiliary input: switch / button / switch switch / not used </li></ul><br><p>  Not stored in long-term memory: </p><br><ul><li>  Forbidding the temporary enable command </li><li>  Prohibition of receiving commands from the nooLite 1.0 system (i.e., it can be disabled only until the unit is rebooted) </li></ul><br><h2 id="kruto-no-chto-delat-s-etoy-informaciey">  Cool!  But what to do with this information? </h2><br><p>  At the moment, together with <a href="https://habrahabr.ru/users/AlekseevAV/">@AlekseevAV</a> , we <a href="https://habrahabr.ru/users/AlekseevAV/">have</a> implemented support for almost all adapter capabilities (except for receiving information from consoles and sensors), in a small python adapter that transforms the UART API into a HTTP API compatible with the nooLite Gateway API.  The code, documentation and installation instructions are available in <a href="http-api-server">the Bitbucket repository</a> , which will be actively updated after the publication of the article. </p><br><p>  Now, using HTTP GET request to port 8080 of the computer on which the adapter is running, you can perform any actions available on the noolight system. </p><br><p>  Examples of using: </p><br><pre><code class="hljs ruby"><span class="hljs-symbol"><span class="hljs-symbol">http:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/192.168.2.18:8080/api</span></span>.htm?ch=<span class="hljs-number"><span class="hljs-number">1</span></span>&amp;cmd=<span class="hljs-number"><span class="hljs-number">2</span></span>&amp;mode=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment">#    nooLite 1.0,   1  http://192.168.2.18:8080/api.htm?ch=8&amp;cmd=0&amp;mode=0 #    nooLite 1.0,   8  http://192.168.2.18:8080/api.htm?ch=1&amp;cmd=2&amp;mode=2 #    nooLite 2.0 (F),   1  http://192.168.2.18:8080/api.htm?ch=0&amp;cmd=8&amp;mode=2 #      nooLite 2.0 (F),   0 </span></span></code> </pre> <br><p>  For more information on the adapter API, please visit the <a href="http-api-server/wiki/Home">official wiki</a> . </p><br><p>  A nice bonus: the MTRF-32 adapter, as the name implies, supports 32 channels, it is compatible with old and new blocks, but the addressing of old and new blocks is different.  Thus, you can bind 32 old and 32 new blocks at the same time.  Or 32 new units in normal mode and 32 in backward compatibility mode. </p><br><h1 id="yabloki-sozreli">  Apples ripened </h1><br><p>  The second pleasant event is the appearance of the icon for the Home application on all Apple mobile devices updated to the latest (10) version of the operating system.  The HomeKit platform was introduced on June 2 at the WWDC'2014 conference, but that it was not an understanding, but now it would simply be wrong to not know what is behind this icon. </p><br><p>  After reading the <a href="http://www.apple.com/ru/ios/home/">official documentation on the Apple website,</a> it became clear that this application would help to unite devices of different companies in one place with the minimum amount of effort and settings, if each of these companies made timely efforts to this.  Indeed, the site shown looked very interesting, and I climbed to look at the list of compatible devices.  He was very small and it made us think that there should be a way to deceive Apple and connect their devices as official ones. </p><br><p>  Indeed, there is such a method, and it is called <a href="https://github.com/nfarina/homebridge">Homebridge</a> .  This is a software product written in node.js that allows you to provide the apple technology with information about devices for which there is a plugin and interaction parameters specified.  Everything is clear, let's do.  You can try to find the plugin that supports your hardware <a href="https://www.npmjs.com/search%3Fq%3Dhomebridge-plugin">here.</a> </p><br><p>  <strong>Idea</strong> : Imagine that there is an apartment equipped with nooLite devices for the most popular tasks: </p><br><ul><li>  Lighting </li><li>  Sockets </li><li>  Curtains </li></ul><br><p>  Some blocks are SU (dimmable lighting zones), the rest are SLF. </p><br><p>  <strong>Objective: To</strong> begin to manage this equipment through the application "Home" and voice - through Siri.  Use Raspberry PI 3 as a controller with a USB / UART nooLite transceiver. </p><br><p>  First of all, you need to install HomeBridge on the Raspberry Pi (complete and understandable instructions are in the wiki of the official repository, that is, <a href="https://github.com/nfarina/homebridge/wiki/Running-HomeBridge-on-a-Raspberry-Pi">here</a> ). </p><br><p>  After that, we need to write plug-ins describing the actions needed to control the accessory in one way or another (on / off / change other parameters) and to obtain information about the state of the device (for different devices - different characteristics of the state). </p><br><p>  We decided that the best interaction between the plug-in for Homebridge and noolight devices would be to perform HTTP requests to the localhost or ip of the Ethernet gateway according to the API of the gateway or the almost identical API of the software adapter in Python, which I described in the first part of the article. </p><br><p>  To control the devices listed in the "idea" section, we wrote three plug-ins, each of which I will discuss in order: </p><br><p>  <strong>The</strong> Somfy motorized roller <strong>blind</strong> , connected via the noolight SR unit, is controlled using the scenario buttons, the up / down / stop commands are available.  The blind plug-in <a href="https://www.npmjs.com/package/homebridge-blinds">that was in npm</a> allows you to send a command to move the shutter up or down, but does not support stopping in the middle of the path.  We redesigned this plugin so that the "open N% blinds" command worked correctly.  At the same time, after the command for fully opening or closing the blinds is calibrated, and if previously its state was not changed via HomeBridge, the next command to open the curtains to the specified level will be executed correctly.  <a href="http-blinds">Link</a> to npm package.  With a properly configured HomeBridge, installation is performed with a single command. </p><br><pre> <code class="hljs sql">sudo npm <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> -g homebridge-noolite-<span class="hljs-keyword"><span class="hljs-keyword">http</span></span>-blinds</code> </pre> <br><p>  For the accessory to work, you need to describe it in the config.json file located in the ~ / .homebridge / config.json folder.  An example of the description of the curtains, which is tied to my adapter.  Three channels are used for control, each of which is responsible for translating the curtains into a specific state: </p><br><ol><li>  Movement down - channel 10 </li><li>  Stop - 11 channel </li><li>  Movement up - channel 12 </li></ol><br><p>  In addition, you need to set the parameter "motion time" - the time of movement of the curtain in milliseconds, which is necessary to go from fully open to fully closed state or vice versa. </p><br><pre> <code class="hljs json"> { <span class="hljs-attr"><span class="hljs-attr">"accessory"</span></span>: <span class="hljs-string"><span class="hljs-string">"NooLite-HTTP-Blinds"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"up_url"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://192.168.2.18:8080/api.htm?ch=12&amp;cmd=7&amp;mode=0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"down_url"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://192.168.2.18:8080/api.htm?ch=10&amp;cmd=7&amp;mode=0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"stop_url"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://192.168.2.18:8080/api.htm?ch=11&amp;cmd=7&amp;mode=0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"http_method"</span></span>: <span class="hljs-string"><span class="hljs-string">"GET"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"motion_time"</span></span>: <span class="hljs-string"><span class="hljs-string">"31000"</span></span> }</code> </pre> <br><p>  <strong>The outlet</strong> that turns off the audio system with a capacity of 100 watts, so that it does not make noise at night.  The socket can only be in two states: on or off, and in addition to this state, we cannot display any additional information in HomeKit.  After completing the plugin for curtains, this plugin was very easy for us, and now you can install it too.  <a href="http-outlet">Link</a> to npm package. </p><br><pre> <code class="hljs sql">sudo npm <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> -g homebridge-noolite-<span class="hljs-keyword"><span class="hljs-keyword">http</span></span>-outlet</code> </pre> <br><p>  An example of the description of the outlet tied to the 3rd channel of the transmitter when using a new SLF unit. </p><br><pre> <code class="hljs json"> { <span class="hljs-attr"><span class="hljs-attr">"accessory"</span></span>: <span class="hljs-string"><span class="hljs-string">"NooLite-HTTP-Outlet"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"on_url"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://192.168.2.18:8080/api.htm?ch=3&amp;cmd=2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"off_url"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://192.168.2.18:8080/api.htm?ch=3&amp;cmd=2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"status_url"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://192.168.2.18:8080/api.htm?ch=3&amp;cmd=128"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"http_method"</span></span>: <span class="hljs-string"><span class="hljs-string">"GET"</span></span> }</code> </pre> <br><p>  <strong>Light control</strong> is the largest, most complex and interesting plugin.  It supports on / off / setting the brightness for conventional lamps and color settings for LED strips connected via an SD unit.  <a href="http-rgb">Link</a> to npm package. </p><br><pre> <code class="hljs sql">sudo npm <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> -g homebridge-noolite-<span class="hljs-keyword"><span class="hljs-keyword">http</span></span>-rgb</code> </pre> <br><p>  An example of the description of the lamp, tied to the 3rd channel of the transmitter, when using the old SD unit. </p><br><pre> <code class="hljs json"> { <span class="hljs-attr"><span class="hljs-attr">"accessory"</span></span>: <span class="hljs-string"><span class="hljs-string">"NooLite-HTTP-RGB"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"RGB LED strip"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"switch"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"powerOn"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://192.168.2.18:8080/api.htm?ch=3&amp;cmd=2&amp;mode=0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"powerOff"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://192.168.2.18:8080/api.htm?ch=3&amp;cmd=0&amp;mode=0"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"brightness"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://192.168.2.18:8080/api.htm?ch=3&amp;cmd=6&amp;br=%s&amp;mode=0"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"color"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://192.168.2.18:8080/api.htm?ch=3&amp;cmd=6&amp;fmt=3&amp;d0=%s1&amp;d1=%s2&amp;d2=%s3&amp;mode=0"</span></span> } }</code> </pre> <br><p>  Important note: to control dimmable lamps you need to set the parameter "brightness", and to control tapes - "color", both parameters are not immediately specified, because when setting the parameter "color", "brightness" is ignored.  At the moment, getting the state of the block is not implemented, this feature will be added in future versions. </p><br><p>  <strong>Cherry on the cake</strong> - camera support <br>  If you look at the list of possible Siri commands for the "Home" application, you will notice a very interesting command "show the camera in the living room", which suggests that HomeKit does not just support cameras for displaying on one of the room screens, but also allows you to quickly open it from the locked screen of the phone.  We figured out how to add a camera using HomeBridge. </p><br><p>  There is something called <a href="https://www.npmjs.com/package/homebridge-camera-ffmpeg">"camera-ffmpeg"</a> in the list of plugins.  Judging by the instructions, the developer of this plug-in used it only on a poppy, and performance on other platforms, in our case raspberry, is not guaranteed.  We decided to try and install this plugin, as well as the "ffmpeg" it needs.  For the initial test, we found an RTSP stream with cartoons on the Internet and added it to the configuration file.  We launched HomeBridge, added a virtual camera through the application, and it started working, the cartoon was successfully played on one of the screens of the Home application, the only nuance was a shutdown approximately every 30 seconds. </p><br><p>  But the goal was not to watch cartoons, but images from real cameras, and we moved on to more vital tests.  The task was to connect the camera manufacturer RVI.  In the web interface, the request format was given to get the rtsp stream, which we copied to the config file and expected to see the image from the camera.  But it was not so easy.  When trying to open the camera, we saw only a rotating ring on the screen, notifying of an attempt to load an image, but the picture did not appear. </p><br><p>  In order for everything to work, we had to rebuild ffmpeg.  This process took a whole day, but as a reward for patience, the necessary function became available.  It also turned out to take a video stream from the Giraffe and Hikvision cameras.  The format of the RTSP request for a video stream from a camera or a DVR channel from most manufacturers can be found on <a href="https://www.ispyconnect.com/sources.aspx">this site</a> </p><br><p>  In order for you to earn a similar configuration, you can not repeat the actions performed from the very beginning.  We have posted the ready-to-build FFMPEG package, as well as the fixed ffmpeg.js on the <a href="https://yadi.sk/d/eXOwWpeYxwdZp">Yandex disk</a> .  Below I offer a brief installation guide: </p><br><ol><li>  Download the contents of the folder from the link above to your home directory. </li><li>  Go to the folder with ffmpeg_omx.tgz </li><li>  Unzip ffmpeg_omx.tgz: tar -xvf ffmpeg_omx.tgz </li><li>  Go to the ffmpeg folder and do make install (takes 80+ minutes) </li></ol><br><p>  You also need to install the camera-ffmpeg plugin, for this we run the following command: </p><br><pre> <code class="hljs sql">sudo npm <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> -g homebridge-camera-ffmpeg</code> </pre> <br><p>  It turned out that the camera turns off after about 30 seconds of viewing due to the fact that ffmpeg tries to output data to the console, and the plugin does not process this output.  To prevent the camera from turning off, we modify the plugin so that the ffmpeg output falls into "/ dev / null".  This fix is ‚Äã‚Äãadded to the file that we downloaded in the first step, so simply replace the file "ffmpeg.js" in the plugin folder and install the package that allows the plugins to write to "dev / null". </p><br><ol><li>  cp /home/alarm/ffmpeg.js / usr / lib / node_modules / homebridge-camera-ffmpeg / </li><li>  npm install -g dev-null </li></ol><br><p>  And we set the parameters for the camera in the config.json file </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"platform"</span></span>: <span class="hljs-string"><span class="hljs-string">"Camera-ffmpeg"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"cameras"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Camera Name"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"videoConfig"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"source"</span></span>: <span class="hljs-string"><span class="hljs-string">"-re -i rtsp://myfancy_rtsp_stream"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"maxStreams"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">"maxWidth"</span></span>: <span class="hljs-number"><span class="hljs-number">1280</span></span>, <span class="hljs-attr"><span class="hljs-attr">"maxHeight"</span></span>: <span class="hljs-number"><span class="hljs-number">720</span></span>, <span class="hljs-attr"><span class="hljs-attr">"maxFPS"</span></span>: <span class="hljs-number"><span class="hljs-number">30</span></span> } } ] }</code> </pre> <br><p>  Where "rtsp: // myfancy_rtsp_stream" is the path to the rtsp stream of your camera. </p><br><p>  Now you can move the camera to the correct room, and it will show the image, updated every second.  When you click on this image, a live broadcast will open, and Siri will understand what to do if you tell her "show the camera in &lt;room name&gt;". </p><br><h2 id="nastroyka-na-ios">  IOS setup </h2><br><p>  To connect HomeBridge to the phone, you need to go to the "Home" application, click the "Add accessory" button, a bridge with the name specified in the settings will appear in the list of offered accessories.  Click on it and consistently add all the proposed accessories, while you can immediately arrange them in the rooms to which they belong.  An example of the "config.json" file for connecting lights, blinds and sockets can be downloaded from the <a href="https://yadi.sk/d/Jmo4DH-HxwsEU">link</a> . </p><br><p>  Thanks for attention!  I hope the article was interesting and useful for you. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/372811/">https://habr.com/ru/post/372811/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../372799/index.html">Millennial features cards</a></li>
<li><a href="../372801/index.html">An increase in muscle strength correlates with an increase in mental ability.</a></li>
<li><a href="../372803/index.html">Why Bitcoin is more similar to the monetary system of the ancient Sumerians, rather than the Fed</a></li>
<li><a href="../372805/index.html">Bitcoin's economic future: increasing the number of coins or switching to other currencies</a></li>
<li><a href="../372809/index.html">Apple Special Event, October 2016 [text archive]</a></li>
<li><a href="../372813/index.html">How did the new MacBook Pro</a></li>
<li><a href="../372815/index.html">The history of world epidemics, part 1</a></li>
<li><a href="../372817/index.html">Third-party developers add ‚Äúsilly‚Äù features to the Mirai source code.</a></li>
<li><a href="../372819/index.html">Survey: strong AI as a human surveillance system</a></li>
<li><a href="../372821/index.html">Professional social network Viadeo liquidated its Russian office</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>