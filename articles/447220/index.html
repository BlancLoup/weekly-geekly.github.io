<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Basics of JavaScript engines: common forms and inline caching. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! The course ‚ÄúSecurity of Information Systems‚Äù starts in 2 weeks, so today we want to publish the second part of the article, the publication of ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Basics of JavaScript engines: common forms and inline caching. Part 2</h1><div class="post__text post__text-html js-mediator-article"> Hello!  The course <a href="https://otus.pw/XXEL/">‚ÄúSecurity of Information Systems‚Äù</a> starts in 2 weeks, so today we want to publish the second part of the article, the publication of which is dedicated to its launch.  Read the first part <a href="https://habr.com/ru/company/otus/blog/446446/">here</a> .  So, let's begin. <br><br>  <b>Inline Caches (ICs)</b> <br><br>  The basic idea behind the forms is the concept of inline caches or ICs.  They are a key component of fast javascript!  JavaScript engines use ICs to remember information about where to find properties of objects in order to reduce the amount of costly searches. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/fc/3g/jh/fc3gjhnvdedkse5o_5ql2fhous0.png"><br><a name="habracut"></a><br>  We have a <code>getX</code> function that accepts an object as input and loads the <code>x</code> property from it: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getX</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">o</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ox; }</code> </pre> <br>  If we run this function in the JSC, we get the following bytecode: <br><br><img src="https://habrastorage.org/webt/jw/_j/on/jw_jongrfbf3joq7vhvn_cv9g9e.png"><br><br>  The first <code>get_by_id</code> instruction loads the <code>'x'</code> property from the first argument <code>(arg1)</code> and stores the result in <code>loc0</code> .  The following statement returns what we stored in <code>loc0</code> . <br>  The JSC also embeds <i>inline cache</i> into the <code>get_by_id</code> instruction, which consists of two uninitialized slots. <br><br><img src="https://habrastorage.org/webt/do/cx/b7/docxb7bxpqo3qo7fj064nhjwtjq.png"><br><br>  Now let's assume that we call <code>getX</code> along with the object <code>{ x: 'a' }</code> .  We already know that this object has the <code>'x'</code> property, and its form stores the offset and attributes of the <code></code> property.  When you execute a function for the first time, the <code>get_by_id</code> instruction <code>get_by_id</code> for the <code>'x'</code> property and finds that its value is stored at offset 0. <br><br><img src="https://habrastorage.org/webt/kt/4m/9p/kt4m9pi42jd6rqkwuoenfoddd5k.png"><br><br>  The IC embedded in the <code>get_by_id</code> instruction remembers the form and offset where the property was found. <br><br><img src="https://habrastorage.org/webt/ra/25/4s/ra254sb_0qyueyxvvxdtefyug7u.png"><br><br>  For subsequent launches, IC only needs to compare the form, and if it is the same as before, simply load the value from the memorized offset.  In particular, if the JavaScript engine sees objects with a form that it recorded earlier, it no longer needs to ask for information about these properties at all - instead, you can completely skip the expensive search for information about properties.  This is much faster than spending time searching for properties each time. <br><br>  <b>Efficient storage of arrays</b> <br><br>  For arrays, it is common practice to store array indices.  The values ‚Äã‚Äãof such properties are called array elements.  It would be wasteful to store property attributes for each element of an array in a separate array.  Instead, JavaScript engines rely on the fact that properties indexed in an array are writable (writable), enumerable and default settings (configurable), and also store the elements of the array separately from other named properties. <br><br>  Consider the given array: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> array = [ <span class="hljs-string"><span class="hljs-string">'#jsconfeu'</span></span>, ];</code> </pre> <br>  The engine stores an array of unit length and points to a form that contains an offset and attributes for the <code>'length'</code> property. <br><br><img src="https://habrastorage.org/webt/xo/iw/r5/xoiwr5gtt9bdfqahukpjmrjbazq.png"><br><br>  This is similar to what we have seen before ... But where are the values ‚Äã‚Äãof the elements of the array stored? <br><br><img src="https://habrastorage.org/webt/ee/an/vf/eeanvffuyp5vc44l4v826c0tucg.png"><br><br>  Each array has a separate storage of backup elements (elements backing store), which contains all the values ‚Äã‚Äãof the properties indexed by the array.  The JavaScript engine does not need to store any property attributes for array elements, since they are usually available for writing (writable), enumerating (enumerable) and customizing (configurable). <br><br>  And what will happen if they suddenly turn out to be inaccessible for configuration?  What if you change the attributes of an array element property? <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Please don't ever do this! const array = Object.defineProperty( [], '0', { value: 'Oh noes!!1', writable: false, enumerable: false, configurable: false, } );</span></span></code> </pre> <br>  The code snippet at the top defines a property called <code>'0'</code> (it turns out to be the array index), it changes the attribute values ‚Äã‚Äãto non-fixed ones. <br><br>  In such extreme cases, the JavaScript engine represents all of the backup element storage as a dictionary that matches array indices with property attributes. <br><br><img src="https://habrastorage.org/webt/ad/h4/yj/adh4yjto8mgxrjjy7bzdlontb0i.png"><br><br>  Even if only one element of the array has non-default attributes, all the backup item storage goes into a slow and inefficient mode of operation.  Avoid <code>Object.defineProperty</code> in array indices!  (I don‚Äôt even know why you should use it in principle. It seems strange and irrational.) <br><br>  <b>findings</b> <br><br>  We learned how JavaScript engines store objects and arrays, and how forms and inline caches help optimize various operations.  Also in this article we want to give some practical tips for javascript that can help increase the performance of your code: <br><br><ul><li>  Always initialize your objects in the same way so that they do not have different shapes; </li><li>  Do not mess with the attributes of the properties of the elements of the array, give them the opportunity to safely store and work efficiently. </li></ul><br>  Now the article can be considered complete.  According to the established tradition, we are waiting for your comments and invite you to sign up for <a href="https://otus.pw/mpEp/">an open webinar</a> on the course ‚ÄúSecurity of Information Systems‚Äù, which already today will be conducted by a well-known virus analyst and part-time teacher - <a href="https://otus.pw/6MAn/">Alexander Kolesnikov</a> . <br><br>  <a href="https://habr.com/ru/company/otus/blog/446446/">Read the first part.</a> </div><p>Source: <a href="https://habr.com/ru/post/447220/">https://habr.com/ru/post/447220/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../447204/index.html">April 17: Open lecture "Path of the game developer: from idea to launch" and the game library at VSBI</a></li>
<li><a href="../447208/index.html">SQA Days EU Conference Review</a></li>
<li><a href="../447210/index.html">Selection @pythonetc, March 2019</a></li>
<li><a href="../447214/index.html">How to improve game design with optimal strategies</a></li>
<li><a href="../447218/index.html">Parsing JPoint 2019 tasks</a></li>
<li><a href="../447222/index.html">Linux Quest. Congratulations to the winners and tell about solutions</a></li>
<li><a href="../447226/index.html">Interview with the popularizer of science, the head of the only private school of astronomy in Russia, Pavel Skripnichenko</a></li>
<li><a href="../447232/index.html">Personal experience. How we connected international telephony: comparison of 6 virtual PBXs</a></li>
<li><a href="../447234/index.html">How to write polymorphic programs with Arrow</a></li>
<li><a href="../447236/index.html">Creating a farm of Android devices using Open STF</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>