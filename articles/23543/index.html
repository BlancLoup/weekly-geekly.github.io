<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>fast creation of web applications in perl: introductory</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Now there is such a situation that the Perl language is undeservedly forgotten. I want to slightly raise the authority of this wonderful language with...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>fast creation of web applications in perl: introductory</h1><div class="post__text post__text-html js-mediator-article">  Now there is such a situation that the Perl language is undeservedly forgotten.  I want to slightly raise the authority of this wonderful language with my notes. <br>  This macro note is aimed at Perl learners, connoisseurs of this language, as well as those who just want to learn more about Perl.  In a note I just want to share my experience. <a name="habracut"></a><br><br>  I would like to consider a simple situation, which in my opinion, often takes place when developing small and medium-sized projects.  And the situation is this: you need to create a small (medium) site, and the decision is made to abandon the CMS, as the engine needs a small, no frills in the admin panel, the complexity is about 16-24 people / hours.  For example, a small site is required, which will contain articles of a certain type (regular text articles) and news.  Plus a small admin to add articles and news.  We agree that we have a ‚Äúbig‚Äù difference between these two types of content in this article. <br><br><h1>  Problem </h1><br>  In such situations, it is often the decision to write your bike, that is, the engine.  Consider just such a situation, on the example of which we will consider the charms of Perl and <a href="http://cpan.org/">CPAN</a> . <br>  I don‚Äôt offer a full MVC implementation, it‚Äôs too much for our small project.  For Perl, a wagon and a little framework framework are written (both MVC and not so), such as the excellent <a href="http://catalyst.perl.org/">Catalyst</a> , which is very, very similar to RubyOnRails (or vice versa, I am not aware of chronology).  There are also many smaller ones, for the curious, it‚Äôs worth a look <a href="http://cpan.uwinnipeg.ca/search%3Fquery%3DFramework%26mode%3Dmodule">here</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We, for simplicity, implement a similar mechanism, but simpler.  So, let's look at the components of our engine ( <a href="http://ru.wikipedia.org/wiki/LAMP">LAMP</a> is as default) in the form of modules: <br>  1. Data - DBIx :: Class <br>  2. Display - Template Toolkit <br>  3. Management - do it yourself <br>  A small digression.  I have long disliked the cgi-bin folder and try to avoid it in every possible way, almost on all hostings (and especially at home) .htaccess files are allowed.  Create such a file in the root folder of the project and write there: <br> <code>Options +ExecCGI <br> AddHandler cgi-script pl <br> DirectoryIndex index.pl <br></code> <br>  Now you can execute scripts with the .pl extension right in the current directory.  In addition, the default page will be our script index.pl. <br>  Next, I advise you to always create a config.  There are many variations, everyone likes it in different ways, my minimum is as follows: <br> <code>package Conf; <br> use warnings; <br> use strict; <br> <br> BEGIN <br> { <br> use Exporter; <br> our (@ISA, @EXPORT); <br> @ISA = qw(Exporter); <br> @EXPORT = qw( <br> $DB_Host $DB_Port $DB_Name $DB_User $DB_Pass <br> ); <br> } <br> <br> our $DB_Host = "host"; <br> our $DB_Port = 3306; <br> our $DB_Name = "our_db"; <br> our $DB_User = "our_table"; <br> our $DB_Pass = "our_password"; <br> 1; <br></code> <br><br>  Nothing military, the global parameters of the project are entered here and exported. <br><br><h1>  Data </h1><br><h2>  DB structure </h2><br>  Let's go back to the engine.  The first point is working with data, we will have the DBIx :: Class package for it, which includes several modules.  First we will create a simple database with which we will work.  It is not necessary to be critical of the structure of the base, it is as simple as possible, just the syntax without everything superfluous, minimizing costs. <br> <code>create table users ( <br> id smallint not null primary key auto_increment, <br> name varchar(32) not null, <br> pass varchar(32) not null); <br> <br> create table categories ( <br> id int not null primary key auto_increment, <br> name varchar(128) not null) charset cp1251; <br> <br> create table articles ( <br> id int not null primary key auto_increment, <br> category_id int not null, <br> title varchar(255) not null, <br> content text not null, <br> author varchar(128) not null comment 'Author of article', <br> added_at timestamp not null, <br> added_by smallint not null comment 'Admin user ID') charset cp1251; <br> <br> create table news ( <br> id int not null primary key auto_increment, <br> added_at timestamp not null, <br> title varchar(255) not null, <br> content text not null, <br> is_put_on_main bool not null default 0 comment 'Show on main page?', <br> added_by smallint not null) charset cp1251; <br></code> <br>  The user table contains the most basic data (we still do not care about visiting records and others), the <em>categories</em> table contains sections of articles, for example, ‚Äúauto‚Äù, ‚Äúsports‚Äù, ‚Äúcooking‚Äù, etc., the <em>articles</em> table contains the articles itself, and the <em>news</em> table - news.  In the latter there is a field <em>is_put_on_main</em> , which is responsible for displaying news on the main one.  Also, in almost every table I set the encoding - it is a habit, who are sure - do not do it. <br><br><h2>  Mapping to code </h2><br>  Well, we have the tables, now we need to display them in the code.  The DBIx :: Class module allows you to completely withdraw from writing SQL-code and communicate with tables as with objects.  You can work with this module in two ways: either manually describe the structures of each table, or use automation.  Consider both ways in order. <br><br><h3>  Manual method </h3><br>  We look into the code, then there will be explanations.  Let's create a folder in the root of our project with the name <strong>DB</strong> and create four files in it: User.pm, Category.pm, Article.pm, News.pm, here are the contents of these files. <br> <code># file User.pm <br> package DB::User; <br> <br> use base qw/DBIx::Class/; <br> <br> __PACKAGE__-&gt;load_components(qw/PK::Auto Core/); <br> __PACKAGE__-&gt;table('users'); <br> __PACKAGE__-&gt;add_columns(qw/id name pass/); <br> __PACKAGE__-&gt;set_primary_key('id'); <br> <br> __PACKAGE__-&gt;has_many('articles' =&gt; 'DB::Article', <br> { 'foreign.added_by' =&gt; 'self.id' }); <br> __PACKAGE__-&gt;has_many('news' =&gt; 'DB::News', <br> { 'foreign.added_by' =&gt; 'self.id' }); <br> <br> 1; <br> <br> # file Category.pm <br> package DB::Category; <br> <br> use base qw/DBIx::Class/; <br> <br> __PACKAGE__-&gt;load_components(qw/PK::Auto Core/); <br> __PACKAGE__-&gt;table('categories'); <br> __PACKAGE__-&gt;add_columns(qw/id name/); <br> __PACKAGE__-&gt;set_primary_key('id'); <br> <br> __PACKAGE__-&gt;has_many('articles' =&gt; 'DB::Article', <br> { 'foreign.category_id' =&gt; 'self.id' }); <br> <br> 1; <br> <br> # file Article.pm <br> package DB::Article; <br> <br> use base qw/DBIx::Class/; <br> <br> __PACKAGE__-&gt;load_components(qw/InflateColumn::DateTime PK::Auto Core/); <br> __PACKAGE__-&gt;table('articles'); <br> __PACKAGE__-&gt;add_columns(qw/id category_id title content added_by author/); <br> __PACKAGE__-&gt;add_columns('added_at' =&gt; { data_type =&gt; 'timestamp' }); <br> __PACKAGE__-&gt;set_primary_key('id'); <br> <br> __PACKAGE__-&gt;belongs_to('category' =&gt; 'DB::Category', <br> { 'foreign.id' =&gt; 'self.category_id' }); <br> __PACKAGE__-&gt;belongs_to('user' =&gt; 'DB::User', <br> { 'foreign.id' =&gt; 'self.added_by' }); <br> <br> 1; <br> <br> # file News.pm <br> package DB::News; <br> <br> use base qw/DBIx::Class/; <br> <br> __PACKAGE__-&gt;load_components(qw/InflateColumn::DateTime PK::Auto Core/); <br> __PACKAGE__-&gt;table('news'); <br> __PACKAGE__-&gt;add_columns(qw/id title content is_put_on_main added_by/); <br> __PACKAGE__-&gt;add_columns('added_at' =&gt; { data_type =&gt; 'timestamp' }); <br> __PACKAGE__-&gt;set_primary_key('id'); <br> <br> __PACKAGE__-&gt;belongs_to('user' =&gt; 'DB::User', <br> { 'foreign.id' =&gt; 'self.added_by' }); <br> <br> 1; <br></code> <br>  So, a little explanation.  We have four very similar files, first we declare the base module DBIx :: Class, then using the __PACKAGE__ mechanism we call its methods, namely: <em>load_components</em> - we load the components for our module (PK :: Auto for working with autoincreased primary_key, Core is the main set for working with links, rows and columns).  Next, specify the table, and then add the column names.  To work with columns such as datetime, date, and timestamp, use the small module <em>InflateColumn :: DateTime</em> .  With it, the fields of the specified types can be used in the program as objects of the <a href="http://cpan.uwinnipeg.ca/htdocs/DateTime/DateTime.html">DateTime</a> type, with all the attendant conveniences.  Then we specify the primary key (if it is composite, then we specify several fields <em>set_primary_key (qw / name1 name2 /);.</em> <br>  Next are familiar to those who know RubyOnRails methods has_many (), belongs_to () and others.  These methods are designed to create relationships between tables. <br>  <a href="http://cpan.uwinnipeg.ca/htdocs/DBIx-Class/">Documentation</a> on the wonderful DBIx :: Class module, where everything is described in detail, including the tutorial and the cookbook. <br><br>  Now we need to use this miracle, for this we need the module <em>DBIx :: Class :: Shema</em> , which is an abstraction of the data schema.  In the root folder of the project we create a file with the name identical to the name of the folder with the classes describing the tables, in our case it will be <em>DB.pm.</em> This is how it looks from me. <br> <code>package SDB; <br> <br> use base qw/DBIx::Class::Schema/; <br> use Conf; <br> <br> __PACKAGE__-&gt;load_classes(); <br> <br> sub GetSchema() <br> { <br> my $dsn = "dbi:mysql:$DB_Name:$DB_Host"; <br> my $sch = __PACKAGE__-&gt;connect($dsn, $DB_User, $DB_Pass); <br> <br> return $sch; <br> } <br> <br> 1; <br></code> <br>  In general, <em>DBIx :: Class :: Schema</em> can be used without the <em>GetShema ()</em> function <em>; the load_classes ()</em> method automatically loads all files found in the folder of the same name.  I added a small function that would be more convenient to get the scheme.  Without this function, the connection in the code would look like this: <br> <code>my $dsn = "dbi:mysql:$DB_Name:$DB_Host"; <br> my $sch = DB-&gt;connect($dsn, $DB_User, $DB_Pass); <br></code> <br>  In the case of the function, you can write them a little or in different ways configure the connection with different types of databases. <br><br><h3>  Automatic method </h3><br>  In the ‚Äúmanual‚Äù example, we manually set all the relationships between the tables.  There is a <em>DBIx :: Class :: Shema :: Loader</em> module <em>that</em> automatically loads and creates classes.  To do this, add a description of foreign keys to the database structure.  Using their loader will automatically create the necessary connections.  Here's what it looks like: <br> <code>package DB; <br> use base qw/DBIx::Class::Schema::Loader/; <br> <br> __PACKAGE__-&gt;loader_options( <br> inflect_singular =&gt; 1, <br> components =&gt; qw/InflateColumn::DateTime/ <br> ); <br> <br> 1; <br> <br> #  <br> <br> use DB; <br> my $sch = DB-&gt;connect( $dsn, $user, $password, $attrs); <br></code> <br>  You can also add the above function <em>GetShema ()</em> (see above) and use it.  In this case, the DB folder and four files in it become unnecessary and we have one file description of the scheme.  The loader supports many <a href="http://cpan.uwinnipeg.ca/htdocs/DBIx-Class-Schema-Loader/DBIx/Class/Schema/Loader/Base.html">options</a> that define the namespace for the classes to be created, parameters for generating class names, and others. <br><br><h3>  Use schema </h3><br>  Now let's see how this all together is used directly in the code. <br> <code>use DB; <br> <br> my $sch = DB-&gt;GetShema(); <br> #    id <br> my $user = $sch-&gt;resultset('User')-&gt;find({ id =&gt; $id }); <br> <br> #   <br> my $new_id = $sch-&gt;resultset('Category')-&gt;populate( <br> [ <br> [qw/title content is_put_on_main added_by/], <br> [$ntitle, $ncontent, 0, $user_id] <br> ]); <br> <br> #   <br> $sch-&gt;resultset('Article')-&gt;find({ id =&gt; $aid })-&gt;delete; <br></code> <br>  Next, we show our data. <br><br><h1>  Display </h1><br>  I use the <a href="http://template-toolkit.org/">Template Toolkit</a> template system.  There are several other systems, such as <a href="http://www.masonhq.com/">Mason</a> , but historically, my choice fell on the Template Toolkit. <br>  The Template Toolkit is a template processing system.  Let's see its use at once on an example.  To begin with, we will create a <em>tmpl</em> folder in the project root and create the <em>site</em> folder in it.  In the <em>tmpl / site</em> folder, create a <em>site</em> file with the following contents: <br> <code>Portal <br> <br> <br> [% PROCESS $content %] <br> <br> <br></code> <br><br><br>  Next, we will do the same start_page file: <br> <code>News and articles <br></code> <br>  Here is such a simple file with one line.  This will be the preparation of our start page.  Let's tie it all together and get something like our <em>index.pl</em> script <em>code</em> : <br> <code>#!/usr/bin/perl -w <br> <br> use strict; <br> <br> use CGI; <br> use Template; <br> <br> use Conf; <br> use DB; <br> <br> #  CGI <br> my $q = CGI-&gt;new; <br> my %p = $q-&gt;Vars; <br> <br> # ... <br> my $tmpl = Template-&gt;new( <br> { <br> INCLUDE_PATH =&gt; 'tmpl/site', <br> INTERPOLATE =&gt; 1, <br> EVAL_PERL =&gt; 1 <br> }) || die "$Template::ERROR\n"; <br> <br> # ... <br> my $sch = DB-&gt;GetShema(); <br> <br> #      <br> my $tmpl_vars = {}; <br> $tmpl_vars-&gt;{content} = 'start_page'; <br> <br> print $q-&gt;header(-type =&gt; 'text/html', -charset =&gt; 'windows-1251'); <br> $tmpl-&gt;process('site', $tmpl_vars) || die $tmpl-&gt;error(), "\n"; <br></code> <br>  I think everyone understands two lines about CGI, then comes the creation of a <em>Template</em> object, the main parameter of which is <em>INCLUDE_PATH</em> - let it be to templates.  Below we create the data schema and connect to the database.  Next, we create a hash into which we will add all the variables that need to be passed to the template.  In our case, we pass only one <em>content</em> variable, this variable is used in the <em>PROCESS</em> directive in the <em>site</em> template.  Below, we start processing the template and specify the starting template - <em>site</em> , as well as passing a hash of variables. <br><br>  The <em>site</em> template uses the <em>PROCESS</em> directive, it starts the nested processing of another template whose name is passed by the parameter, but as we have the name is stored in a variable, then we specify this directly - <em>[% PROCESS $ content%]</em> .  Thus, the content of the <em>start_page</em> template is <em>inserted</em> into the <em>site</em> template <em>body</em> .  Add a little variety.  On the main page we have to display articles and news, but not all, but, say, the last ten.  Besides news only those that are marked with the appropriate flag in the table.  Before processing the template, add a few lines to our script: <br> <code>my $articles = [$sch-&gt;resultset('Article')-&gt;search(undef, <br> { <br> order_by =&gt; 'added_at desc', <br> rows =&gt; 10, <br> page =&gt; 1 <br> })]; <br> my $news = [$sch-&gt;resultset('News')-&gt;search( <br> { <br> is_put_on_main =&gt; 1 <br> }, <br> { <br> order_by =&gt; 'added_at desc', <br> rows =&gt; 10, <br> page =&gt; 1 <br> })]; <br> $tmpl_vars-&gt;{articles} = $articles; <br> $tmpl_vars-&gt;{news} = $news; <br></code> <br>  It should be noted that we used [] to create a list context, otherwise in a scalar context, the <em>search ()</em> function returns an object of type <em>ResultSet</em> , and we just need an array of data. <br><br>  So, it does not make sense to describe in detail, since everything is quite obvious.  The only thing is the use of the <em>rows / page</em> parameters.  They are needed to create the so-called pager-s, with which it is convenient to organize pagination, as well as used for simple selection of records, which is a special case.  Also the number of articles and news can be put in the config. <br><br>  Next, change the <em>start_page</em> template: <br><h1> <code> <br> [% FOREACH n = news %] <br> [% n.added_at.dmy('.') %] [% n.title %] <br> <br> [% n.content FILTER html %] <br> <br> [% END %] <br>  <br> [% FOREACH a = articles %] <br> [% a.added_at.dmy('.') %] [% a.title %] <br> <br> : [% a.category.name %] <br> [% a.content FILTER html %] <br> <br> [% END %] <br></code> </h1> <code> <br> [% FOREACH n = news %] <br> [% n.added_at.dmy('.') %] [% n.title %] <br> <br> [% n.content FILTER html %] <br> <br> [% END %] <br>  <br> [% FOREACH a = articles %] <br> [% a.added_at.dmy('.') %] [% a.title %] <br> <br> : [% a.category.name %] <br> [% a.content FILTER html %] <br> <br> [% END %] <br></code> <h1> <code> <br> [% FOREACH n = news %] <br> [% n.added_at.dmy('.') %] [% n.title %] <br> <br> [% n.content FILTER html %] <br> <br> [% END %] <br>  <br> [% FOREACH a = articles %] <br> [% a.added_at.dmy('.') %] [% a.title %] <br> <br> : [% a.category.name %] <br> [% a.content FILTER html %] <br> <br> [% END %] <br></code> </h1> <code> <br> [% FOREACH n = news %] <br> [% n.added_at.dmy('.') %] [% n.title %] <br> <br> [% n.content FILTER html %] <br> <br> [% END %] <br>  <br> [% FOREACH a = articles %] <br> [% a.added_at.dmy('.') %] [% a.title %] <br> <br> : [% a.category.name %] <br> [% a.content FILTER html %] <br> <br> [% END %] <br></code> <br>  I will note the use of the <em>added_at</em> field as an object.  For it, the <em>dmy ()</em> method is <em>called</em> , which formats the date in DD-MM-YYYY format with the passed separator, in our case, a period.  The <em>DateTime</em> object supports locales and correctly displays the date depending on the current (or selected) locale.  It also contains many methods for formatting and working with dates. <br><br>  I haven't intentionally added valid links yet, I'll do it later. <br>  In general, we see two similar blocks that should be placed in a hotel file.  Create a <em>short_note</em> file in the <em>tmpl / site</em> folder: <br> <code>[% text = node.content; <br> IF text.length &gt; 512; <br> text = text.substr(0, 512); <br> END %] <br> [% note.added_at.dmy('.') %] [% note.title %] <br> <br> [% IF note.category %] <br> : [% note.category.name %] <br> [% END %] <br> [% text FILTER html %] <br> <br></code> <br>  Now our <em>start_page</em> template will look like this: <br><h1> <code> <br> [% FOREACH n = news %] <br> [% PROCESS short_note note = n %] <br> [% END %] <br>  <br> [% FOREACH a = articles %] <br> [% PROCESS short_note note = a %] <br> [% END %] <br></code> </h1> <code> <br> [% FOREACH n = news %] <br> [% PROCESS short_note note = n %] <br> [% END %] <br>  <br> [% FOREACH a = articles %] <br> [% PROCESS short_note note = a %] <br> [% END %] <br></code> <h1> <code> <br> [% FOREACH n = news %] <br> [% PROCESS short_note note = n %] <br> [% END %] <br>  <br> [% FOREACH a = articles %] <br> [% PROCESS short_note note = a %] <br> [% END %] <br></code> </h1> <code> <br> [% FOREACH n = news %] <br> [% PROCESS short_note note = n %] <br> [% END %] <br>  <br> [% FOREACH a = articles %] <br> [% PROCESS short_note note = a %] <br> [% END %] <br></code> <br>  Now we call the processing of the <em>short_note</em> template and pass the current news or article as a <em>note</em> parameter. <br><br>  The template checks for the presence of the <em>category</em> field, which will be a sign of the article, in this case we display the section name. <br><br>  Our portal also requires templates for displaying the full article or news, displaying a list of article categories, a search form and search results.  In general, a few more templates will be added, which will differ little from the above in terms of complexity. <br><br><h1>  Control </h1><br>  Above, we agreed not to use all kinds of frameworks, we will try to do a minimum with our own hands.  To do this, we make the following simple structure (lamer, yes): <br> <code>my $act = $p{'a'} || 'start'; <br> <br> if ($act eq 'start') <br> { <br> } <br> elsif ($act eq 'article') <br> { <br> } <br> elsif ($act eq 'news') <br> { <br> } <br> # .... <br> else <br> { <br> } <br></code> <br>  So, each link in the script will be accompanied by the parameter a - <em>action</em> .  It will set the current context.  Thus, the links above in the templates can be changed to the following: <br> <code><code><br> ,    .      <em>id</em> ,        .         : <br> $p{'id'} =~ s/\D//g if ($p{'id'}); <br></code> <br>  ,     - ,   ,   ,      -.    . <br> <br>      . <br> <code>if ($act eq 'start') <br> { <br> $tmpl_vars-&gt;{content} = 'start_page'; <br> my $articles = [$sch-&gt;resultset('Article')-&gt;search(undef, <br> { <br> order_by =&gt; 'added_at desc', <br> rows =&gt; 10, <br> page =&gt; 1 <br> })]; <br> my $news = [$sch-&gt;resultset('News')-&gt;search( <br> { <br> is_put_on_main =&gt; 1 <br> }, <br> { <br> order_by =&gt; 'added_at desc', <br> rows =&gt; 10, <br> page =&gt; 1 <br> })]; <br> $tmpl_vars-&gt;{articles} = $articles; <br> $tmpl_vars-&gt;{news} = $news; <br> } <br> elsif ($act eq 'article') <br> { <br> $tmpl_vars-&gt;{content} = 'full_article'; <br> $tmpl_vars-&gt;{article} = $sch-&gt;resultset('Article')-&gt;find({ id =&gt; $p{'id'} }); <br> } <br> elsif ($act eq 'category') <br> { <br> $tmpl_vars-&gt;{content} = 'category'; <br> $tmpl_vars-&gt;{category} = $sch-&gt;resultset('Category')-&gt;find({ id =&gt; $p{'id'} }); <br> } <br> elsif ($act eq 'news') <br> { <br> $tmpl_vars-&gt;{content} = 'full_article'; <br> $tmpl_vars-&gt;{article} = $sch-&gt;resultset('News')-&gt;find({ id =&gt; $p{'id'} }); <br> } <br> else <br> { <br> # .  <br> } <br></code> <br>    ,   ,               .    ,   Perl        ,   ,  <a href="http://cpan.uwinnipeg.ca/dist/HTML-CheckArgs">HTML-CheckArgs</a>  <a href="http://cpan.uwinnipeg.ca/dist/HTML-QuickCheck">HTML-QuickCheck</a> .    ,  <a href="http://cpan.uwinnipeg.ca/dist/HTML-Widget">HTML-Widget</a>  <a href="http://cpan.uwinnipeg.ca/dist/HTML-Tag">HTML-Tag</a> .           .    ,       .        . <br> <br>      :  ,    .      (    ,  <em>error_action</em> ,     ),       : <br> <code>print $q-&gt;header(-location =&gt; '?a=start'); <br> exit; <br></code> <br>      ,  .  ,       ,     (  ): <br> <code>my %action = ( <br> 'start' =&gt; 'Main page', <br> 'news' =&gt; 'News page', <br> 'article' =&gt; 'Full article', <br> # .... <br> ); <br> my $act = ( $p{'act'} &amp;&amp; defined( $actions{$p{'act'}} )) ? $p{'act'} : 'start'; <br></code> <br>  ,         ‚Äî  ,   'start'.         - <em>defined(...)</em> . <br> <br>  <br>      .            ,      .      ,  <em>tmpl/admin</em> . <br>      : <a href="http://cpan.uwinnipeg.ca/module/Digest::SHA1">Digest::SHA1</a>  <a href="http://cpan.uwinnipeg.ca/module/CGI::Session">CGI::Session</a> .   ,  ‚Äî . <br> ,       .     . <br> <br> : <br> <code>[%#  login %] <br> [% IF err %] <br> Wrong login <br> [% END %] <br> /&gt; <br> Login: /&gt; <br> Password: /&gt; <br> /&gt; <br> <br></code> <br> <br>          ,    : <br> <code>use CGI::Session; <br> use Digest::SHA1 qw(sha1_hex); <br> <br> # ...  CGI   <br> my $s = CGI::Session-&gt;load(undef, undef, { Directory =&gt; 'ssss' } ); <br> <br> # ...    <br> if ($s-&gt;empty &amp;&amp; $act !~ /login(_form)?|logout/) <br> { <br> print $q-&gt;header(-location =&gt; '?a=login_form'); <br> exit; <br> } <br> else <br> { <br> my $user = $sch-&gt;resultset('User')-&gt;find({ id =&gt; $s-&gt;param('uid') }); <br> $tmpl_vars-&gt;{user} = $user; <br> } <br> <br> if ($act eq 'login_form') <br> { <br> $tmpl_vars-&gt;{content} = 'login_form'; <br> } <br> elsif ($act eq 'login') <br> { <br> unless (my $u = &amp;login($p{'login'}, $p{'pass'})) <br> { <br> $tmpl_vars-&gt;{content} = 'login'; <br> $tmpl_vars-&gt;{err} = 1; <br> } <br> else <br> { <br> $s = $s-&gt;new; <br> $s-&gt;param('uid', $u-&gt;id); <br> <br> print $s-&gt;header(-location =&gt; '?a=start'); <br> exit; <br> } <br> } <br> elsif ($act eq 'logout') <br> { <br> $s-&gt;delete; <br> print $q-&gt;header(-location =&gt; '?a=login'); <br> exit; <br> } <br> <br> #    <br> sub login <br> { <br> my ($u, $p) = @_; <br> <br> my $pp = sha1_hex($p); <br> my $res = $sch-&gt;resultset('User')-&gt;search({ <br> name =&gt; $u, <br> pass =&gt; $pp <br> }); <br> <br> my $user = $res-&gt;next; <br> return $user; <br> } <br></code> <br> <br>   ,    ,   . <br>  <em>CGI::Session</em>      ,    .       ‚Äî expired.         <em>ssss</em> . <br>  <em>Digest::SHA1</em> -   MD5. <br> <br>        . -,     CRUD- (CReate, Update, Delete).  , ,   <a href="http://cpan.uwinnipeg.ca/module/DBIx::Class::WebForm">DBIx::Class::WebForm</a> .     CRUD  CPAN      . <br> -,        .    <a href="http://www.fckeditor.net/">FCKeditor</a> ,    .               . <br> -,       . ,  <a href="http://cpan.uwinnipeg.ca/module/DBIx::Class::Validation">DBIx::Class::Validation</a>      ,        ,       ,  <a href="http://cpan.uwinnipeg.ca/module/CGI::FormBuilder">CGI::FormBuilder</a> , <a href="http://cpan.uwinnipeg.ca/module/CGI::QuickForm">CGI::QuickForm</a>  ..   "Form", "Validate"  "Widget"       . <br> <br>  <br>   ""           .    , , , .           ,          ,    .         ,        SQL-. <br> <br> <a href=""></a>  ,  <a href="http://knell.spb.ru/port/"></a> -  .      . <br> <br> -NOT_FOR_HOLYWARS-</code> <h1> <code><code><br> ,    .      <em>id</em> ,        .         : <br> $p{'id'} =~ s/\D//g if ($p{'id'}); <br></code> <br>  ,     - ,   ,   ,      -.    . <br> <br>      . <br> <code>if ($act eq 'start') <br> { <br> $tmpl_vars-&gt;{content} = 'start_page'; <br> my $articles = [$sch-&gt;resultset('Article')-&gt;search(undef, <br> { <br> order_by =&gt; 'added_at desc', <br> rows =&gt; 10, <br> page =&gt; 1 <br> })]; <br> my $news = [$sch-&gt;resultset('News')-&gt;search( <br> { <br> is_put_on_main =&gt; 1 <br> }, <br> { <br> order_by =&gt; 'added_at desc', <br> rows =&gt; 10, <br> page =&gt; 1 <br> })]; <br> $tmpl_vars-&gt;{articles} = $articles; <br> $tmpl_vars-&gt;{news} = $news; <br> } <br> elsif ($act eq 'article') <br> { <br> $tmpl_vars-&gt;{content} = 'full_article'; <br> $tmpl_vars-&gt;{article} = $sch-&gt;resultset('Article')-&gt;find({ id =&gt; $p{'id'} }); <br> } <br> elsif ($act eq 'category') <br> { <br> $tmpl_vars-&gt;{content} = 'category'; <br> $tmpl_vars-&gt;{category} = $sch-&gt;resultset('Category')-&gt;find({ id =&gt; $p{'id'} }); <br> } <br> elsif ($act eq 'news') <br> { <br> $tmpl_vars-&gt;{content} = 'full_article'; <br> $tmpl_vars-&gt;{article} = $sch-&gt;resultset('News')-&gt;find({ id =&gt; $p{'id'} }); <br> } <br> else <br> { <br> # .  <br> } <br></code> <br>    ,   ,               .    ,   Perl        ,   ,  <a href="http://cpan.uwinnipeg.ca/dist/HTML-CheckArgs">HTML-CheckArgs</a>  <a href="http://cpan.uwinnipeg.ca/dist/HTML-QuickCheck">HTML-QuickCheck</a> .    ,  <a href="http://cpan.uwinnipeg.ca/dist/HTML-Widget">HTML-Widget</a>  <a href="http://cpan.uwinnipeg.ca/dist/HTML-Tag">HTML-Tag</a> .           .    ,       .        . <br> <br>      :  ,    .      (    ,  <em>error_action</em> ,     ),       : <br> <code>print $q-&gt;header(-location =&gt; '?a=start'); <br> exit; <br></code> <br>      ,  .  ,       ,     (  ): <br> <code>my %action = ( <br> 'start' =&gt; 'Main page', <br> 'news' =&gt; 'News page', <br> 'article' =&gt; 'Full article', <br> # .... <br> ); <br> my $act = ( $p{'act'} &amp;&amp; defined( $actions{$p{'act'}} )) ? $p{'act'} : 'start'; <br></code> <br>  ,         ‚Äî  ,   'start'.         - <em>defined(...)</em> . <br> <br>  <br>      .            ,      .      ,  <em>tmpl/admin</em> . <br>      : <a href="http://cpan.uwinnipeg.ca/module/Digest::SHA1">Digest::SHA1</a>  <a href="http://cpan.uwinnipeg.ca/module/CGI::Session">CGI::Session</a> .   ,  ‚Äî . <br> ,       .     . <br> <br> : <br> <code>[%#  login %] <br> [% IF err %] <br> Wrong login <br> [% END %] <br> /&gt; <br> Login: /&gt; <br> Password: /&gt; <br> /&gt; <br> <br></code> <br> <br>          ,    : <br> <code>use CGI::Session; <br> use Digest::SHA1 qw(sha1_hex); <br> <br> # ...  CGI   <br> my $s = CGI::Session-&gt;load(undef, undef, { Directory =&gt; 'ssss' } ); <br> <br> # ...    <br> if ($s-&gt;empty &amp;&amp; $act !~ /login(_form)?|logout/) <br> { <br> print $q-&gt;header(-location =&gt; '?a=login_form'); <br> exit; <br> } <br> else <br> { <br> my $user = $sch-&gt;resultset('User')-&gt;find({ id =&gt; $s-&gt;param('uid') }); <br> $tmpl_vars-&gt;{user} = $user; <br> } <br> <br> if ($act eq 'login_form') <br> { <br> $tmpl_vars-&gt;{content} = 'login_form'; <br> } <br> elsif ($act eq 'login') <br> { <br> unless (my $u = &amp;login($p{'login'}, $p{'pass'})) <br> { <br> $tmpl_vars-&gt;{content} = 'login'; <br> $tmpl_vars-&gt;{err} = 1; <br> } <br> else <br> { <br> $s = $s-&gt;new; <br> $s-&gt;param('uid', $u-&gt;id); <br> <br> print $s-&gt;header(-location =&gt; '?a=start'); <br> exit; <br> } <br> } <br> elsif ($act eq 'logout') <br> { <br> $s-&gt;delete; <br> print $q-&gt;header(-location =&gt; '?a=login'); <br> exit; <br> } <br> <br> #    <br> sub login <br> { <br> my ($u, $p) = @_; <br> <br> my $pp = sha1_hex($p); <br> my $res = $sch-&gt;resultset('User')-&gt;search({ <br> name =&gt; $u, <br> pass =&gt; $pp <br> }); <br> <br> my $user = $res-&gt;next; <br> return $user; <br> } <br></code> <br> <br>   ,    ,   . <br>  <em>CGI::Session</em>      ,    .       ‚Äî expired.         <em>ssss</em> . <br>  <em>Digest::SHA1</em> -   MD5. <br> <br>        . -,     CRUD- (CReate, Update, Delete).  , ,   <a href="http://cpan.uwinnipeg.ca/module/DBIx::Class::WebForm">DBIx::Class::WebForm</a> .     CRUD  CPAN      . <br> -,        .    <a href="http://www.fckeditor.net/">FCKeditor</a> ,    .               . <br> -,       . ,  <a href="http://cpan.uwinnipeg.ca/module/DBIx::Class::Validation">DBIx::Class::Validation</a>      ,        ,       ,  <a href="http://cpan.uwinnipeg.ca/module/CGI::FormBuilder">CGI::FormBuilder</a> , <a href="http://cpan.uwinnipeg.ca/module/CGI::QuickForm">CGI::QuickForm</a>  ..   "Form", "Validate"  "Widget"       . <br> <br>  <br>   ""           .    , , , .           ,          ,    .         ,        SQL-. <br> <br> <a href=""></a>  ,  <a href="http://knell.spb.ru/port/"></a> -  .      . <br> <br> -NOT_FOR_HOLYWARS-</code> </h1> <code><code><br> ,    .      <em>id</em> ,        .         : <br> $p{'id'} =~ s/\D//g if ($p{'id'}); <br></code> <br>  ,     - ,   ,   ,      -.    . <br> <br>      . <br> <code>if ($act eq 'start') <br> { <br> $tmpl_vars-&gt;{content} = 'start_page'; <br> my $articles = [$sch-&gt;resultset('Article')-&gt;search(undef, <br> { <br> order_by =&gt; 'added_at desc', <br> rows =&gt; 10, <br> page =&gt; 1 <br> })]; <br> my $news = [$sch-&gt;resultset('News')-&gt;search( <br> { <br> is_put_on_main =&gt; 1 <br> }, <br> { <br> order_by =&gt; 'added_at desc', <br> rows =&gt; 10, <br> page =&gt; 1 <br> })]; <br> $tmpl_vars-&gt;{articles} = $articles; <br> $tmpl_vars-&gt;{news} = $news; <br> } <br> elsif ($act eq 'article') <br> { <br> $tmpl_vars-&gt;{content} = 'full_article'; <br> $tmpl_vars-&gt;{article} = $sch-&gt;resultset('Article')-&gt;find({ id =&gt; $p{'id'} }); <br> } <br> elsif ($act eq 'category') <br> { <br> $tmpl_vars-&gt;{content} = 'category'; <br> $tmpl_vars-&gt;{category} = $sch-&gt;resultset('Category')-&gt;find({ id =&gt; $p{'id'} }); <br> } <br> elsif ($act eq 'news') <br> { <br> $tmpl_vars-&gt;{content} = 'full_article'; <br> $tmpl_vars-&gt;{article} = $sch-&gt;resultset('News')-&gt;find({ id =&gt; $p{'id'} }); <br> } <br> else <br> { <br> # .  <br> } <br></code> <br>    ,   ,               .    ,   Perl        ,   ,  <a href="http://cpan.uwinnipeg.ca/dist/HTML-CheckArgs">HTML-CheckArgs</a>  <a href="http://cpan.uwinnipeg.ca/dist/HTML-QuickCheck">HTML-QuickCheck</a> .    ,  <a href="http://cpan.uwinnipeg.ca/dist/HTML-Widget">HTML-Widget</a>  <a href="http://cpan.uwinnipeg.ca/dist/HTML-Tag">HTML-Tag</a> .           .    ,       .        . <br> <br>      :  ,    .      (    ,  <em>error_action</em> ,     ),       : <br> <code>print $q-&gt;header(-location =&gt; '?a=start'); <br> exit; <br></code> <br>      ,  .  ,       ,     (  ): <br> <code>my %action = ( <br> 'start' =&gt; 'Main page', <br> 'news' =&gt; 'News page', <br> 'article' =&gt; 'Full article', <br> # .... <br> ); <br> my $act = ( $p{'act'} &amp;&amp; defined( $actions{$p{'act'}} )) ? $p{'act'} : 'start'; <br></code> <br>  ,         ‚Äî  ,   'start'.         - <em>defined(...)</em> . <br> <br>  <br>      .            ,      .      ,  <em>tmpl/admin</em> . <br>      : <a href="http://cpan.uwinnipeg.ca/module/Digest::SHA1">Digest::SHA1</a>  <a href="http://cpan.uwinnipeg.ca/module/CGI::Session">CGI::Session</a> .   ,  ‚Äî . <br> ,       .     . <br> <br> : <br> <code>[%#  login %] <br> [% IF err %] <br> Wrong login <br> [% END %] <br> /&gt; <br> Login: /&gt; <br> Password: /&gt; <br> /&gt; <br> <br></code> <br> <br>          ,    : <br> <code>use CGI::Session; <br> use Digest::SHA1 qw(sha1_hex); <br> <br> # ...  CGI   <br> my $s = CGI::Session-&gt;load(undef, undef, { Directory =&gt; 'ssss' } ); <br> <br> # ...    <br> if ($s-&gt;empty &amp;&amp; $act !~ /login(_form)?|logout/) <br> { <br> print $q-&gt;header(-location =&gt; '?a=login_form'); <br> exit; <br> } <br> else <br> { <br> my $user = $sch-&gt;resultset('User')-&gt;find({ id =&gt; $s-&gt;param('uid') }); <br> $tmpl_vars-&gt;{user} = $user; <br> } <br> <br> if ($act eq 'login_form') <br> { <br> $tmpl_vars-&gt;{content} = 'login_form'; <br> } <br> elsif ($act eq 'login') <br> { <br> unless (my $u = &amp;login($p{'login'}, $p{'pass'})) <br> { <br> $tmpl_vars-&gt;{content} = 'login'; <br> $tmpl_vars-&gt;{err} = 1; <br> } <br> else <br> { <br> $s = $s-&gt;new; <br> $s-&gt;param('uid', $u-&gt;id); <br> <br> print $s-&gt;header(-location =&gt; '?a=start'); <br> exit; <br> } <br> } <br> elsif ($act eq 'logout') <br> { <br> $s-&gt;delete; <br> print $q-&gt;header(-location =&gt; '?a=login'); <br> exit; <br> } <br> <br> #    <br> sub login <br> { <br> my ($u, $p) = @_; <br> <br> my $pp = sha1_hex($p); <br> my $res = $sch-&gt;resultset('User')-&gt;search({ <br> name =&gt; $u, <br> pass =&gt; $pp <br> }); <br> <br> my $user = $res-&gt;next; <br> return $user; <br> } <br></code> <br> <br>   ,    ,   . <br>  <em>CGI::Session</em>      ,    .       ‚Äî expired.         <em>ssss</em> . <br>  <em>Digest::SHA1</em> -   MD5. <br> <br>        . -,     CRUD- (CReate, Update, Delete).  , ,   <a href="http://cpan.uwinnipeg.ca/module/DBIx::Class::WebForm">DBIx::Class::WebForm</a> .     CRUD  CPAN      . <br> -,        .    <a href="http://www.fckeditor.net/">FCKeditor</a> ,    .               . <br> -,       . ,  <a href="http://cpan.uwinnipeg.ca/module/DBIx::Class::Validation">DBIx::Class::Validation</a>      ,        ,       ,  <a href="http://cpan.uwinnipeg.ca/module/CGI::FormBuilder">CGI::FormBuilder</a> , <a href="http://cpan.uwinnipeg.ca/module/CGI::QuickForm">CGI::QuickForm</a>  ..   "Form", "Validate"  "Widget"       . <br> <br>  <br>   ""           .    , , , .           ,          ,    .         ,        SQL-. <br> <br> <a href=""></a>  ,  <a href="http://knell.spb.ru/port/"></a> -  .      . <br> <br> -NOT_FOR_HOLYWARS-</code> <h1> <code><code><br> ,    .      <em>id</em> ,        .         : <br> $p{'id'} =~ s/\D//g if ($p{'id'}); <br></code> <br>  ,     - ,   ,   ,      -.    . <br> <br>      . <br> <code>if ($act eq 'start') <br> { <br> $tmpl_vars-&gt;{content} = 'start_page'; <br> my $articles = [$sch-&gt;resultset('Article')-&gt;search(undef, <br> { <br> order_by =&gt; 'added_at desc', <br> rows =&gt; 10, <br> page =&gt; 1 <br> })]; <br> my $news = [$sch-&gt;resultset('News')-&gt;search( <br> { <br> is_put_on_main =&gt; 1 <br> }, <br> { <br> order_by =&gt; 'added_at desc', <br> rows =&gt; 10, <br> page =&gt; 1 <br> })]; <br> $tmpl_vars-&gt;{articles} = $articles; <br> $tmpl_vars-&gt;{news} = $news; <br> } <br> elsif ($act eq 'article') <br> { <br> $tmpl_vars-&gt;{content} = 'full_article'; <br> $tmpl_vars-&gt;{article} = $sch-&gt;resultset('Article')-&gt;find({ id =&gt; $p{'id'} }); <br> } <br> elsif ($act eq 'category') <br> { <br> $tmpl_vars-&gt;{content} = 'category'; <br> $tmpl_vars-&gt;{category} = $sch-&gt;resultset('Category')-&gt;find({ id =&gt; $p{'id'} }); <br> } <br> elsif ($act eq 'news') <br> { <br> $tmpl_vars-&gt;{content} = 'full_article'; <br> $tmpl_vars-&gt;{article} = $sch-&gt;resultset('News')-&gt;find({ id =&gt; $p{'id'} }); <br> } <br> else <br> { <br> # .  <br> } <br></code> <br>    ,   ,               .    ,   Perl        ,   ,  <a href="http://cpan.uwinnipeg.ca/dist/HTML-CheckArgs">HTML-CheckArgs</a>  <a href="http://cpan.uwinnipeg.ca/dist/HTML-QuickCheck">HTML-QuickCheck</a> .    ,  <a href="http://cpan.uwinnipeg.ca/dist/HTML-Widget">HTML-Widget</a>  <a href="http://cpan.uwinnipeg.ca/dist/HTML-Tag">HTML-Tag</a> .           .    ,       .        . <br> <br>      :  ,    .      (    ,  <em>error_action</em> ,     ),       : <br> <code>print $q-&gt;header(-location =&gt; '?a=start'); <br> exit; <br></code> <br>      ,  .  ,       ,     (  ): <br> <code>my %action = ( <br> 'start' =&gt; 'Main page', <br> 'news' =&gt; 'News page', <br> 'article' =&gt; 'Full article', <br> # .... <br> ); <br> my $act = ( $p{'act'} &amp;&amp; defined( $actions{$p{'act'}} )) ? $p{'act'} : 'start'; <br></code> <br>  ,         ‚Äî  ,   'start'.         - <em>defined(...)</em> . <br> <br>  <br>      .            ,      .      ,  <em>tmpl/admin</em> . <br>      : <a href="http://cpan.uwinnipeg.ca/module/Digest::SHA1">Digest::SHA1</a>  <a href="http://cpan.uwinnipeg.ca/module/CGI::Session">CGI::Session</a> .   ,  ‚Äî . <br> ,       .     . <br> <br> : <br> <code>[%#  login %] <br> [% IF err %] <br> Wrong login <br> [% END %] <br> /&gt; <br> Login: /&gt; <br> Password: /&gt; <br> /&gt; <br> <br></code> <br> <br>          ,    : <br> <code>use CGI::Session; <br> use Digest::SHA1 qw(sha1_hex); <br> <br> # ...  CGI   <br> my $s = CGI::Session-&gt;load(undef, undef, { Directory =&gt; 'ssss' } ); <br> <br> # ...    <br> if ($s-&gt;empty &amp;&amp; $act !~ /login(_form)?|logout/) <br> { <br> print $q-&gt;header(-location =&gt; '?a=login_form'); <br> exit; <br> } <br> else <br> { <br> my $user = $sch-&gt;resultset('User')-&gt;find({ id =&gt; $s-&gt;param('uid') }); <br> $tmpl_vars-&gt;{user} = $user; <br> } <br> <br> if ($act eq 'login_form') <br> { <br> $tmpl_vars-&gt;{content} = 'login_form'; <br> } <br> elsif ($act eq 'login') <br> { <br> unless (my $u = &amp;login($p{'login'}, $p{'pass'})) <br> { <br> $tmpl_vars-&gt;{content} = 'login'; <br> $tmpl_vars-&gt;{err} = 1; <br> } <br> else <br> { <br> $s = $s-&gt;new; <br> $s-&gt;param('uid', $u-&gt;id); <br> <br> print $s-&gt;header(-location =&gt; '?a=start'); <br> exit; <br> } <br> } <br> elsif ($act eq 'logout') <br> { <br> $s-&gt;delete; <br> print $q-&gt;header(-location =&gt; '?a=login'); <br> exit; <br> } <br> <br> #    <br> sub login <br> { <br> my ($u, $p) = @_; <br> <br> my $pp = sha1_hex($p); <br> my $res = $sch-&gt;resultset('User')-&gt;search({ <br> name =&gt; $u, <br> pass =&gt; $pp <br> }); <br> <br> my $user = $res-&gt;next; <br> return $user; <br> } <br></code> <br> <br>   ,    ,   . <br>  <em>CGI::Session</em>      ,    .       ‚Äî expired.         <em>ssss</em> . <br>  <em>Digest::SHA1</em> -   MD5. <br> <br>        . -,     CRUD- (CReate, Update, Delete).  , ,   <a href="http://cpan.uwinnipeg.ca/module/DBIx::Class::WebForm">DBIx::Class::WebForm</a> .     CRUD  CPAN      . <br> -,        .    <a href="http://www.fckeditor.net/">FCKeditor</a> ,    .               . <br> -,       . ,  <a href="http://cpan.uwinnipeg.ca/module/DBIx::Class::Validation">DBIx::Class::Validation</a>      ,        ,       ,  <a href="http://cpan.uwinnipeg.ca/module/CGI::FormBuilder">CGI::FormBuilder</a> , <a href="http://cpan.uwinnipeg.ca/module/CGI::QuickForm">CGI::QuickForm</a>  ..   "Form", "Validate"  "Widget"       . <br> <br>  <br>   ""           .    , , , .           ,          ,    .         ,        SQL-. <br> <br> <a href=""></a>  ,  <a href="http://knell.spb.ru/port/"></a> -  .      . <br> <br> -NOT_FOR_HOLYWARS-</code> </h1> <code><code><br> ,    .      <em>id</em> ,        .         : <br> $p{'id'} =~ s/\D//g if ($p{'id'}); <br></code> <br>  ,     - ,   ,   ,      -.    . <br> <br>      . <br> <code>if ($act eq 'start') <br> { <br> $tmpl_vars-&gt;{content} = 'start_page'; <br> my $articles = [$sch-&gt;resultset('Article')-&gt;search(undef, <br> { <br> order_by =&gt; 'added_at desc', <br> rows =&gt; 10, <br> page =&gt; 1 <br> })]; <br> my $news = [$sch-&gt;resultset('News')-&gt;search( <br> { <br> is_put_on_main =&gt; 1 <br> }, <br> { <br> order_by =&gt; 'added_at desc', <br> rows =&gt; 10, <br> page =&gt; 1 <br> })]; <br> $tmpl_vars-&gt;{articles} = $articles; <br> $tmpl_vars-&gt;{news} = $news; <br> } <br> elsif ($act eq 'article') <br> { <br> $tmpl_vars-&gt;{content} = 'full_article'; <br> $tmpl_vars-&gt;{article} = $sch-&gt;resultset('Article')-&gt;find({ id =&gt; $p{'id'} }); <br> } <br> elsif ($act eq 'category') <br> { <br> $tmpl_vars-&gt;{content} = 'category'; <br> $tmpl_vars-&gt;{category} = $sch-&gt;resultset('Category')-&gt;find({ id =&gt; $p{'id'} }); <br> } <br> elsif ($act eq 'news') <br> { <br> $tmpl_vars-&gt;{content} = 'full_article'; <br> $tmpl_vars-&gt;{article} = $sch-&gt;resultset('News')-&gt;find({ id =&gt; $p{'id'} }); <br> } <br> else <br> { <br> # .  <br> } <br></code> <br>    ,   ,               .    ,   Perl        ,   ,  <a href="http://cpan.uwinnipeg.ca/dist/HTML-CheckArgs">HTML-CheckArgs</a>  <a href="http://cpan.uwinnipeg.ca/dist/HTML-QuickCheck">HTML-QuickCheck</a> .    ,  <a href="http://cpan.uwinnipeg.ca/dist/HTML-Widget">HTML-Widget</a>  <a href="http://cpan.uwinnipeg.ca/dist/HTML-Tag">HTML-Tag</a> .           .    ,       .        . <br> <br>      :  ,    .      (    ,  <em>error_action</em> ,     ),       : <br> <code>print $q-&gt;header(-location =&gt; '?a=start'); <br> exit; <br></code> <br>      ,  .  ,       ,     (  ): <br> <code>my %action = ( <br> 'start' =&gt; 'Main page', <br> 'news' =&gt; 'News page', <br> 'article' =&gt; 'Full article', <br> # .... <br> ); <br> my $act = ( $p{'act'} &amp;&amp; defined( $actions{$p{'act'}} )) ? $p{'act'} : 'start'; <br></code> <br>  ,         ‚Äî  ,   'start'.         - <em>defined(...)</em> . <br> <br>  <br>      .            ,      .      ,  <em>tmpl/admin</em> . <br>      : <a href="http://cpan.uwinnipeg.ca/module/Digest::SHA1">Digest::SHA1</a>  <a href="http://cpan.uwinnipeg.ca/module/CGI::Session">CGI::Session</a> .   ,  ‚Äî . <br> ,       .     . <br> <br> : <br> <code>[%#  login %] <br> [% IF err %] <br> Wrong login <br> [% END %] <br> /&gt; <br> Login: /&gt; <br> Password: /&gt; <br> /&gt; <br> <br></code> <br> <br>          ,    : <br> <code>use CGI::Session; <br> use Digest::SHA1 qw(sha1_hex); <br> <br> # ...  CGI   <br> my $s = CGI::Session-&gt;load(undef, undef, { Directory =&gt; 'ssss' } ); <br> <br> # ...    <br> if ($s-&gt;empty &amp;&amp; $act !~ /login(_form)?|logout/) <br> { <br> print $q-&gt;header(-location =&gt; '?a=login_form'); <br> exit; <br> } <br> else <br> { <br> my $user = $sch-&gt;resultset('User')-&gt;find({ id =&gt; $s-&gt;param('uid') }); <br> $tmpl_vars-&gt;{user} = $user; <br> } <br> <br> if ($act eq 'login_form') <br> { <br> $tmpl_vars-&gt;{content} = 'login_form'; <br> } <br> elsif ($act eq 'login') <br> { <br> unless (my $u = &amp;login($p{'login'}, $p{'pass'})) <br> { <br> $tmpl_vars-&gt;{content} = 'login'; <br> $tmpl_vars-&gt;{err} = 1; <br> } <br> else <br> { <br> $s = $s-&gt;new; <br> $s-&gt;param('uid', $u-&gt;id); <br> <br> print $s-&gt;header(-location =&gt; '?a=start'); <br> exit; <br> } <br> } <br> elsif ($act eq 'logout') <br> { <br> $s-&gt;delete; <br> print $q-&gt;header(-location =&gt; '?a=login'); <br> exit; <br> } <br> <br> #    <br> sub login <br> { <br> my ($u, $p) = @_; <br> <br> my $pp = sha1_hex($p); <br> my $res = $sch-&gt;resultset('User')-&gt;search({ <br> name =&gt; $u, <br> pass =&gt; $pp <br> }); <br> <br> my $user = $res-&gt;next; <br> return $user; <br> } <br></code> <br> <br>   ,    ,   . <br>  <em>CGI::Session</em>      ,    .       ‚Äî expired.         <em>ssss</em> . <br>  <em>Digest::SHA1</em> -   MD5. <br> <br>        . -,     CRUD- (CReate, Update, Delete).  , ,   <a href="http://cpan.uwinnipeg.ca/module/DBIx::Class::WebForm">DBIx::Class::WebForm</a> .     CRUD  CPAN      . <br> -,        .    <a href="http://www.fckeditor.net/">FCKeditor</a> ,    .               . <br> -,       . ,  <a href="http://cpan.uwinnipeg.ca/module/DBIx::Class::Validation">DBIx::Class::Validation</a>      ,        ,       ,  <a href="http://cpan.uwinnipeg.ca/module/CGI::FormBuilder">CGI::FormBuilder</a> , <a href="http://cpan.uwinnipeg.ca/module/CGI::QuickForm">CGI::QuickForm</a>  ..   "Form", "Validate"  "Widget"       . <br> <br>  <br>   ""           .    , , , .           ,          ,    .         ,        SQL-. <br> <br> <a href=""></a>  ,  <a href="http://knell.spb.ru/port/"></a> -  .      . <br> <br> -NOT_FOR_HOLYWARS-</code> </div><p>Source: <a href="https://habr.com/ru/post/23543/">https://habr.com/ru/post/23543/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../235417/index.html">How Docker helped us achieve the (almost) impossible</a></li>
<li><a href="../235419/index.html">Django 1.7</a></li>
<li><a href="../235421/index.html">The court banned the work of Uber in Germany</a></li>
<li><a href="../235425/index.html">How we created the service of private freight. Prehistory</a></li>
<li><a href="../235427/index.html">"Contact center as a service": convince the financial director that this is the best investment</a></li>
<li><a href="../235431/index.html">VPS Search - Autumn Update</a></li>
<li><a href="../235433/index.html">Welcome to the Russian Map Maker community</a></li>
<li><a href="../235437/index.html">The eighth issue of the magazine TsODy.RF</a></li>
<li><a href="../235439/index.html">MOTA SmartRing: smart ring instead of smart watches</a></li>
<li><a href="../23544/index.html">Rambler hackfest '08 ended</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>