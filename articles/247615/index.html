<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Packaging, Compression and Assembly Protection</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="latest article is available on makeloft.xyz 

 The materials of this article describe the mechanisms of composition, compression, dynamic loading, as ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Packaging, Compression and Assembly Protection</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://makeloft.xyz/ru/knowledges/c-sharp/assemblies">latest article is available on makeloft.xyz</a> <br><br>  The materials of this article describe the mechanisms of composition, compression, dynamic loading, as well as the paths of elementary protection of <i>.NET</i> assemblies using standard tools of the <i>Visual Studio</i> development environment.  However, it is possible that the following will be true to some extent for other software platforms. <br><br>  For such purposes, many utilities have been created, including paid ones, but they often work as black boxes and the developer is only slightly able to control the process.  Sometimes, after the layout, the applications refuse to start at all, and the reason is quite difficult to identify. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But, having certain knowledge, you can perform the whole process yourself with full control at each step and the ability to debug already packed assemblies ... <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3a6/198/81d/3a619881df4fd5827e53758739dba2da.jpg" alt="image"><br><a name="habracut"></a><br>  First of all, it is worth looking at an example of an application where these mechanisms are applied, besides protection, this is a text editor <a href="http://poet.of.by/ru/"><i>Poet</i></a> .  Externally, the program is a single <i>exe</i> file of a small size, although in fact it consists of several libraries. <br><br>  Immediately it should be noted that in the packaging of assemblies there are many advantages in the absence of obvious minuses: <br>  ‚Ä¢ Many assemblies can be glued together into one and even include everything in the executable file.  The application becomes monolithic and stable, because none of its parts will be lost anywhere. <br>  ‚Ä¢ the same assemblies are easy to compress (zip), after which the files will take up much less space. <br>  ‚Ä¢ significantly speed up the launch of the application!  Subjectively, <i>Poet</i> began to start 2-4 times faster on different machines, after compiling all the files into one. <br>  ‚Ä¢ a primitive protection from prying eyes will appear, that is, by disassembling the file, the outsider will not see the whole code.  He will need to extract the assembly, which requires some skills. <br>  ‚Ä¢ there are convenient opportunities for more serious protection ... <br>  ‚Ä¢ packaging of assemblies does not exclude the simultaneous use of unpacked versions, if it is necessary for something. <br>  ‚Ä¢ it is possible to debug the assembly! <br><br>  <b>1. Dynamic loading of assemblies in the application domain</b> <br><br>  If assembly files are added to a separate resource file, for example, <i>Assemblies.resx</i> , then they will be just an array of bytes.  Downloading them to the application domain is very simple using the small <i>AssemblyLoader</i> class just below.  It is enough at the right time, usually when you start the application, to call <br><br><pre><code class="cs hljs">AssemblyLoader.ResolveAssemblies&lt;Assemblies&gt;(AppDomain.CurrentDomain);</code> </pre> <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Reflection; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Loader</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AssemblyLoader</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ResolveAssembly</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> AppDomain domain, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> assemblyFullName</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { domain.CreateInstance(assemblyFullName, <span class="hljs-string"><span class="hljs-string">"AnyType"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception exception) { Console.WriteLine(exception.Message); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> ResolveAssemblies&lt;TResource&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> AppDomain domain, Func&lt;<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[], <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[]&gt; converter = <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> assemblies = ResolveAssembliesFromStaticResource&lt;TResource&gt;(converter); ResolveAssemblies(domain, assemblies); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ResolveAssemblies</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> AppDomain domain, List&lt;Assembly&gt; assemblies</span></span></span><span class="hljs-function">)</span></span> { ResolveEventHandler handler = (sender, args) =&gt; assemblies.Find(a =&gt; a.FullName == args.Name); domain.AssemblyResolve += handler; assemblies.ForEach(a =&gt; ResolveAssembly(domain, a.FullName)); domain.AssemblyResolve -= handler; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ResolveAssembly</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> AppDomain domain, Assembly assembly</span></span></span><span class="hljs-function">)</span></span> { ResolveEventHandler handler = (sender, args) =&gt; assembly; domain.AssemblyResolve += handler; ResolveAssembly(domain, assembly.FullName); domain.AssemblyResolve -= handler; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> List&lt;Assembly&gt; ResolveAssembliesFromStaticResource&lt;TResource&gt;(Func&lt;<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[], <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[]&gt; converter = <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> assemblyDatyType = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[]); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> assemblyDataItems = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> (TResource) .GetProperties(BindingFlags.Static | BindingFlags.Public | BindingFlags.NonPublic) .Where(p =&gt; p.PropertyType == assemblyDatyType) .Select(p =&gt; p.GetValue(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>)) .Cast&lt;<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[]&gt;() .ToList(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> assemblies = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Assembly&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> assemblyData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> assemblyDataItems) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rawAssembly = converter == <span class="hljs-literal"><span class="hljs-literal">null</span></span> ? assemblyData : converter(assemblyData); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> assembly = Assembly.Load(rawAssembly); assemblies.Add(assembly); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception exception) { Console.WriteLine(exception.Message); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> assemblies; } } }</code> </pre><br>  The author of the article for a long time could not understand how to initiate the process of loading the assembly into the domain.  When trying to create an unknown type instead of calling the <i>domain</i> event. <i>AssemblyResolve + = handler;</i>  they simply fell, but the event itself was not caused.  And the main magic, as it turned out, is in one line <i>domain.CreateInstance (assemblyFullName, "AnyType");</i>  In its time, it took several days spent hugging <i>MSDN</i> to find an example on the backside that revealed this secret. <br><br>  <b>2. At the same time, no one forbids compressing or encrypting arrays of bytes.</b> <br><br>  For compression, a very simple class <i>Compressor</i> may be useful.  Only now it is necessary to initiate loading of assemblies a little differently. <br><pre> <code class="cs hljs">AssemblyLoader.ResolveAssemblies&lt;Resources&gt;( AppDomain.CurrentDomain, bytes =&gt; Foundation.Compressor.ConvertBytes(bytes));</code> </pre><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.IO; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.IO.Compression; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Foundation</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Compressor</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConvertFile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> inputFileName, CompressionMode compressionMode, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> outputFileName = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span> { outputFileName = outputFileName ?? (compressionMode == CompressionMode.Compress ? inputFileName + <span class="hljs-string"><span class="hljs-string">".compressed"</span></span> : inputFileName.Replace(<span class="hljs-string"><span class="hljs-string">".compressed"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inputFileBytes = File.ReadAllBytes(inputFileName); ConvertBytesToFile(inputFileBytes, outputFileName, compressionMode); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConvertBytesToFile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] inputFileBytes, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> outputFileName, CompressionMode compressionMode = CompressionMode.Decompress</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bytes = ConvertBytes(inputFileBytes, compressionMode); File.WriteAllBytes(outputFileName, bytes); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">byte</span></span></span><span class="hljs-function">[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConvertBytes</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] inputFileBytes, CompressionMode mode = CompressionMode.Decompress</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inputStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MemoryStream(inputFileBytes)) <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> outputStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MemoryStream()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mode == CompressionMode.Compress) <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> convertStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GZipStream(outputStream, CompressionMode.Compress)) inputStream.CopyTo(convertStream); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mode == CompressionMode.Decompress) <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> convertStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GZipStream(inputStream, CompressionMode.Decompress)) convertStream.CopyTo(outputStream); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bytes = outputStream.ToArray(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bytes; } } } }</code> </pre><br>  We also need an elementary console utility for archiving. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.IO.Compression; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Foundation; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">FileCompressor</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { args.Where(n =&gt; !n.ToLower().Contains(<span class="hljs-string"><span class="hljs-string">".compressed"</span></span>)) .ToList() .ForEach(n =&gt; Compressor.ConvertFile(n, CompressionMode.Compress)); args.Where(n =&gt; n.ToLower().Contains(<span class="hljs-string"><span class="hljs-string">".compressed"</span></span>)) .ToList() .ForEach(n =&gt; Compressor.ConvertFile(n, CompressionMode.Decompress)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception exception) { Console.WriteLine(exception.Message); Console.ReadKey(); } } } }</code> </pre><br>  <i>Visual Studio</i> allows you to execute an arbitrary command line before compiling a project and after.  This is configured in the project properties.  That is, we can configure everything so that after the library is assembled, its file is compressed if necessary (for example, by our archiver) and automatically copied to the right place (hit the resources).  With proper configuration, everything will be fine, because the version loaded into the domain corresponds to the compiled version.  This is important because if the application stops running after building or other problems arise, you can easily identify the cause and fix it using debugging. <br><br>  This entire configuration process, no matter how difficult it may seem, is enough to do once, and then everything will be updated automatically when recompiling without the participation of the developer. <br><br>  Ideally, for desktop applications, it is convenient to use the following scheme: all assemblies without compression should be included in the main executable file, and then a loader application should be created, in which this main executable file is already compressed.  Compress multiple glued files more efficiently than each separately. <br><br>  All keys are given in the article, you only need to figure out and apply knowledge in their projects.  But if difficulties arise, it is possible <a href="http://makeloft.by/ru/works">to buy the source code of the <i>Poet</i> editor</a> .  In addition to these examples, they contain a number of other unique and useful solutions.  It may be more cost effective for someone to spy on something there than a few days or weeks to search for and develop solutions on their own. <br><br>  <b>3. Now we have a smooth approach to the protection capabilities.</b> <br><br>  Assemblies are simply arrays of bytes with which you can do anything ... And if you complicate the decryption algorithm as much as possible, then it will not be so easy for an outsider to pull out the decoded assemblies.  The decryption itself can be rendered into native C ++ code, or for web applications it is possible to obtain decryption keys from the server.  Two problems remain - operating system processes can be debugged or a memory dump can be removed from them. <br><br>  It is not difficult to defend against a debugger <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AntiDebugger</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Fails { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> DateTime TimeStamp { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { TimeStamp = DateTime.Now; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Thread(ProtectThread).Start(); <span class="hljs-comment"><span class="hljs-comment">//new Thread(ProtectThread).Start(); } private static void ProtectThread() { while (true) { var now = DateTime.Now; if (TimeStamp.AddSeconds(5) &lt; now) Fails++; else { TimeStamp = now; Fails = 0; } // One fail may attend when pc wake up from the sleep mode if (Fails &gt;= 2) InitProtection(); Thread.Sleep(TimeSpan.FromSeconds(3)); } } private static void InitProtection() { Fails = 0; Console.WriteLine("Debugger detected!"); //Process.GetCurrentProcess().Kill(); //Process.GetCurrentProcess().PriorityClass = ProcessPriorityClass.High; //for (var i = 0; i &lt; 100; i++) //{ // new Thread(() =&gt; { while (true) ; }) {Priority = ThreadPriority.Highest}.Start(); //} } }</span></span></code> </pre><br>  One or a couple of threads at a specified interval check and update the value of the TimeStamp variable.  If the TimeStamp contains an old value, it indicates that the computer has come out of sleep mode, the clock has been reset, or there is an attempt to debug it.  If the error is repeated two or more times, the last option is most likely, so you need to enable protection.  You can simply crash your process or even cause the operating system to hang, simply by running a thousand or more threads with an infinite loop and high priority.  This trick disrupts the system even on powerful multi-core computers, so you need to provide options for false positives and be careful. <br><br>  You can try to use this technique to protect against memory dumping, since this is not an instant operation.  Only here, instead of flows, it is necessary to use at least two processes that follow each other and when one of them stops, they immediately perform protective actions. <br><br>  <b>Results</b> <br><br>  I hope that the article will be useful for developers.  Once again, all the key points are described in it well, it remains only to apply them in action.  If any difficulties arise, you can always purchase the full source code of the <i>Poet</i> editor from the site <a href="http://makeloft.by/ru/">makeloft.by</a> . <br><br>  PS <a href="http://poet.of.by/ru/download">Information</a> for donations and thanks. <br><br>  PPS Preview version of the free <a href="http://makeloft.by/ru/tools">Foundation Framework</a> library. </div><p>Source: <a href="https://habr.com/ru/post/247615/">https://habr.com/ru/post/247615/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../247599/index.html">Play to win: how to win games and what you need to know about professional players in GameDev [part 1]</a></li>
<li><a href="../247601/index.html">KolibriOS games contest - we play and choose winners</a></li>
<li><a href="../247605/index.html">PHP Digest number 54 - interesting news, materials and tools (December 22, 2014 - January 11, 2015)</a></li>
<li><a href="../247607/index.html">Chart Wars: Charts Strike Back</a></li>
<li><a href="../247609/index.html">5 trends in data analysis and processing in 2015</a></li>
<li><a href="../247617/index.html">Is life possible without a template engine?</a></li>
<li><a href="../247619/index.html">Programming Philosophy 3 - Chichikov and Programmer</a></li>
<li><a href="../247621/index.html">Heartbleed and his friends in 2015: how an advertising network endangers site visitors</a></li>
<li><a href="../247625/index.html">Practical safety: trends and forecasts-2015</a></li>
<li><a href="../247629/index.html">Get to know Docker containers for a Django developer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>