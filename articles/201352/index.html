<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Development of cross-platform mobile applications in Delphi # 3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Part 1 
 Part 2 

 Setting up the environment and creating a new mobile application. 

 In the previous part of the cycle, we decided on the task and ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Development of cross-platform mobile applications in Delphi # 3</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/ef8/b1f/eb3/ef8b1feb335d10aa4e15283684ee751b.png" alt="Development of cross-platform mobile applications in Delphi" align="left">  <a href="http://habrahabr.ru/company/delphi/blog/199026/">Part 1</a> <br>  <a href="http://habrahabr.ru/company/delphi/blog/200490/">Part 2</a> <br><br><h5>  Setting up the environment and creating a new mobile application. </h5><br><br>  In the previous part of the cycle, we decided on the task and created the simplest FM application that displays a list of recipes.  At the same time, we used the <b>FireDAC</b> data access library and <b>LiveBinding</b> object binding technology.  We also agreed that, as part of the task, two applications will be created using a single code base.  And now, the time has come for perhaps the most interesting part - <i>creating the first Android application</i> . <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      First of all, you need to configure the environment.  If you didn‚Äôt install Android development tools (JDK / SDK / NDK) when installing <b>RAD Studio</b> , you should do it manually.  You also need to install a USB driver for the Android device with which the application will be developed.  It is worth noting that not all Android devices can find a USB driver.  In this case, you can take advantage of the debugging via Wi-Fi. <br><br>  When creating a new project, we are invited to use one of several mobile application templates.  Select the template Header / Footer, which is a mobile form with two toolbars (Toolbar).  After selecting a template, you must save the project.  It is most convenient to create a new project using Project Manafer (right top panel of the IDE), as shown in the figure.  Thus, we will be able to work simultaneously with two projects in the group. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/17e/589/694/17e58969492ea89c4d8f7951151a6cc7.png" alt="Project manager Delphi"><br><br>  The main form of the application for the template we have chosen is by default adapted to the Google Nexus 4 device. Using the drop-down list in the upper right part of the form designer, you can select another device.  For our application, we will choose one of the most popular tablet devices, Google Nexus 7. Immediately change the title text on the main form (Text property of the HeaderLabel component). <br><br><h5>  First launch of the application </h5><br><br>  As you already understood, we will use a physical device connected via USB to debug the application.  Although other options are possible (connecting via Wi-Fi or using an emulator).  If you connected your tablet or phone in accordance with the instructions and activated the developer mode, then the name of your ‚Äúdevice‚Äù will appear in the list of target devices (Targets).  Activate it. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/50e/4ec/9b0/50e4ec9b0e741f7a777e29da38eca3cd.png" alt="List of target devices Delphi XE5"><br><br>  Once again, make sure that the Android SDK is configured for your device, and so on.  ‚ÄúDeveloper Mode‚Äù is activated.  The entire process of setting up an environment for developing an Android application is <a href="http://docwiki.embarcadero.com/RADStudio/XE5/en/Running_Your_Android_Application_on_an_Android_Device">described here</a> . <br><br>  It starts the mobile application in the same way as the usual "desktop" (by pressing F9).  If you did everything correctly, then after compiling you will see the main form of the application on your tablet. <br><br>  Now we will try to implement the same functionality that we implemented in the previous part.  To do this, add to the current project an existing data module from the previous project (menu <b>Project</b> | <b>Add to Project ...</b> ).  As in the first project, the module should be included in the Uses section of the main form. <br><br><pre><code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">implementation</span></span> <span class="hljs-meta"><span class="hljs-meta">{$R *.fmx}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> uDM;</code> </pre> <br><br>  Actually, now nothing prevents us from using the same connection setup procedure that we used in the ‚Äúdesktop‚Äù application: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TDM</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConnectToDB</span></span></span><span class="hljs-function">:</span></span> Boolean; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> FDConnection1.Connected := True; FDTRecipe.Open; <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; Result:= FDConnection1.Connected; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TDM</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DataModuleCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> DM.ConnectToDB; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br><br>  Thus, we have eliminated the need to re-write the connection code. <br><br><h5>  Main application form </h5><br><br>  In principle, the development of the user interface of a mobile application is a separate, very extensive topic.  Often, it is an incorrectly designed GUI that can cause failure.  And sometimes programmers try to transfer their experience in creating interfaces for desktop applications to mobile development.  This is not entirely correct.  Before you start writing a mobile application, you should carefully study the <a href="http://developer.android.com/design/get-started/principles.html">basic principles of interface design</a> .  And, of course, it is worth exploring the interfaces of popular programs. <br><br>  In our case, we can easily organize the interface of the main form of the mobile application in the image of the ‚Äúdesktop‚Äù (in fact, we built the Windows interface of the application taking into account the fact that we will have to make a mobile application).  Place the components TPanel, TSplitter and TCalloutPanel on the form.  In Object Inspector, we change their properties as follows: <br><br><pre> <code class="delphi hljs">Panel1: TPanel Align = alLeft Splitter1: TSplitter Align = alLeft Width = <span class="hljs-number"><span class="hljs-number">16</span></span> CalloutPanel1: TCalloutPanel Align = alClient Width = <span class="hljs-number"><span class="hljs-number">630</span></span> TabOrder = <span class="hljs-number"><span class="hljs-number">4</span></span> CalloutPosition = cpLeft</code> </pre><br><br>  To display a list of recipes, we also use <b>TListBox</b> and <b>TBindNavigator</b> , which we will place on the left panel.  <b>Place TTabControl</b> on the <b>TCalloutPanel</b> component and configure the Align property for each component. <br><br>  Like last time, we use the <b>LiveBinding</b> mechanism to connect a dataset.  This procedure is completely similar to the one we did in the previous section, creating a ‚Äúdesktop application‚Äù. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4a0/c16/54a/4a0c1654a15e3c2972e27c3e43f5a776.png" alt="the main form of the mobile application. Delphi XE5"><br><br>  Like last time, we need to create a tool to enter the name of the recipe.  If in the desktop application we could use the modal form, then the concept of mobile applications in most cases offers another solution that regulates the user‚Äôs action more gently.  However, here we use the ‚Äúdialogue‚Äù, which in fact can be regarded as a kind of modal form. <br><br>  Create a new mobile form.  We will place a panel on it, and on the panel we will place those controls that we placed on the recipe addition form last time (TEdit and two buttons).  The value of the Align property is alCenter.  For buttons, set the value of the ModalResult property (mrOk and mrCancel). <br><img src="https://habrastorage.org/getpro/habr/post_images/5b0/be2/4a1/5b0be24a13f4a6fc608b961479526c1a.png" alt="image"><br>  For the form class, create the following class method: <br><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfAddRecipe</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShowDialog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DataSet: TDataSet)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> fAddRecipe.ShowModal( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ModalResult: TModalResult)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">begin</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ModalResult</span></span></span><span class="hljs-function">= </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mrOk</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">then</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">begin</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DataSet</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">State</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">in</span></span></span><span class="hljs-function"> [</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dsInsert</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dsEdit</span></span></span><span class="hljs-function">] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">then</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DataSet</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Post</span></span></span><span class="hljs-function">;</span></span> fAddRecipe.Close; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> DataSet.State <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [dsInsert, dsEdit] <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> DataSet.Cancel; fAddRecipe.Close; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br><br>  When an application is launched, we will assign this method as an AfterInsert event handler for the only data set in the program. <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">THeaderFooterForm</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FormShow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> DM.FDTRecipe.AfterInsert:= TfAddRecipe.ShowDialog; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br><br>  This form will be called whenever you add an entry to the FDTRecipe data set. <br><br><blockquote>  Naturally, such code needs optimization.  Creating an instance of a form when launching an application is not a good idea.  Especially for mobile apps.  But this is a topic for a separate discussion, but for now, for reasons of clarity, let's leave everything as it is. </blockquote><br><br><h5>  Deploying (deploying) Android applications </h5><br><br>  Before you start an application running from the database on Android, you need to make certain settings that allow you to transfer the database to a mobile device, and allow the application to "see" the database.  To do this, use the Deployment Manager (menu Project | Deployment). <br><br>  Make sure the debug configuration for the Android platform is selected.  In the drop-down list on the top toolbar, the <b>Debug configuration</b> value should be selected - <b>Android platform</b> . <br><br>  In order to transfer the database to the device when deploying the application, you should use the ‚ÄúAdd files‚Äù button and select a database file. <br><br>  Enter <b>assets \</b> as the Remote Path field value, and set the Platform field value to Android.  The assets directory is a special directory <a href="http://developer.android.com/tools/projects/index.html">for storing application support resources</a> .  In the Platform field, select <b>Android</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/741/7f6/cb2/7417f6cb2e59f72d8f62f801ddcc63d9.png" alt="Delphi XE5. Deployment manager"><br><br>  You can click the Deploy button to test the application deployment process. <br><br>  And finally, in order for the application to work, another important step should be taken - to define the event of the FDConnection1 component as follows: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TDM</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FDConnection1BeforeConnect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-meta"><span class="hljs-meta">{$IFDEF ANDROID}</span></span> FDConnection1.Params.Values[<span class="hljs-string"><span class="hljs-string">'Database'</span></span>] := <span class="hljs-string"><span class="hljs-string">'$(DOC)/db.s3db'</span></span>; <span class="hljs-meta"><span class="hljs-meta">{$ENDIF}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br><br>  The compiler directive {$ IFDEF ANDROID} is transmitted to ensure that this code is executed only on Android devices.  Thus, we indicate to the application the relative path to the database. <br><br>  We start the application, and on the device screen we get an almost complete analogue of the Windows application that we created in the previous part. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b5f/dd7/d73/b5fdd7d73393a724a18a55bdd0b43ab2.png"><br><br>  In this part, we built the first mobile application and figured out how the process of creating mobile applications in Delphi is similar and how much it differs from the process of creating a ‚Äúnormal‚Äù desktop application.  Naturally, while we implemented only the basic functionality.  This applies to both the program logic and its interface.  But everything has its time.  In the next part, we will continue working on the Windows application and learn more about the possibilities and principles of the <b>LiveBinding</b> mechanism. <br><br>  Stay with us. </div><p>Source: <a href="https://habr.com/ru/post/201352/">https://habr.com/ru/post/201352/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../201340/index.html">Today at 10:00 (MSK), see the online broadcast "Developing applications with common code for the Windows platform"</a></li>
<li><a href="../201344/index.html">Infrastructure of the Russian securities market (brief educational program)</a></li>
<li><a href="../201346/index.html">ART is replacing Dalvik</a></li>
<li><a href="../201348/index.html">We drove you to tea</a></li>
<li><a href="../201350/index.html">New version of DevExtreme with Tizen platform support</a></li>
<li><a href="../201354/index.html">Developing Titanium module for iOS</a></li>
<li><a href="../201358/index.html">IE11: Compatibility List vs. X-UA-Compatible</a></li>
<li><a href="../201360/index.html">Visual effects for Skyforge. Art and technology</a></li>
<li><a href="../201364/index.html">Additional features of Aastra Mobile Client</a></li>
<li><a href="../201366/index.html">Radio modem for $ 7</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>