<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What is behind the cleanliness in your apartment, or Qlean preparation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr. Many have heard about our service, someone used it, and now we are ripe to tell you about our internal IT-kitchen. In 2014, we started with ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What is behind the cleanliness in your apartment, or Qlean preparation</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/gq/bw/8y/gqbw8ybjmbdssdfsawgosyarrnc.jpeg" alt="image"><br><br>  Hi, Habr.  Many have heard about our service, someone used it, and now we are ripe to tell you about our internal IT-kitchen.  In 2014, we started with an office apartment on Arbat (with a meeting in the kitchen), 300 clients and organizing everything with our own hands.  All information was recorded in Excel, and the development did not smell.  Over time, the number of customers increased, automation was required, and today Qlean is a mature company in which the development department has more than 25 people.  Today, through our service, an average of about 1,000 cleanings per day is done by the forces of 3,000 connected performers.  We are third in the world after Handy and Helpling abroad in terms of harvesting, and we work in Moscow, St. Petersburg and Yekaterinburg.  In this post we will conduct an excursion on the systems of our service and will announce further blog topics. <br><a name="habracut"></a><br><h2>  Technologies and how we implement them </h2><br><img src="https://habrastorage.org/webt/rz/w0/qi/rzw0qiizsobsrpqeusruijxzfiw.png" alt="image"><br><br>  We do not dwell on some programming language, but historically it was that the service was built on Ruby on Rails with coffeescript and other wonders.  Now all that remains is api, and from the rails, ActiveRecord and a set of standard gems.  We do not really care about fashionable now TrailBlazer and so on, as we try to write simple and clear code that is easy to maintain.  In addition to the main application, we have microservices on pure Ruby, for example, for CRM, and a system for hiring artists, several services on Go and a couple on Clojure.  We try to divide services according to DDD principles, that is, each service is responsible for some business process: hiring, paying for an order, appointing a contractor, etc.  We choose the language based on the specific task and requirements.  We have all the frontend on React + Redux, and mobile applications have recently been completely rewritten on React.Native, which allows us to write less code and makes it possible to implement the same functionality on different platforms (both the website and mobile applications) by the same developers.  We will tell you about the profit and difficulties of translating native applications to React.Native. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In total, we have about 30 different services that live on more than 70 virtual machines, so the code layout is not the most trivial: we use Ansible, Docker and Nomad as an orchestrator.  When laying out, a huge number of tests are run (both unit and integration tests), plus we check everything with QA engineers, use canary deploy for complex tasks, so we are not afraid to lay out a lot and often.  We have an average of 15 releases a week. <br><br><h2>  And more? </h2><br><img src="https://habrastorage.org/webt/ck/to/tz/cktotzsmos8hucgbmvmlw5_oqui.png" alt="image"><br>  The system consists of 3 large functional parts: work with clients, performers and distribution of orders among performers. <br><br><h3>  Customer service </h3><br>  To communicate with customers, we have a website and a mobile application.  Here, in principle, everything is approximately standard: marketing, marketing, and again marketing.  Behind one big nuance: we are turned on analytics, therefore we trace and we analyze all actions that the user makes.  From all devices, events are sent to microservice on Go, which processes and adds the information to the database.  Since we love to measure everything, we have a strongly developed culture of experiments and A / B tests.  We first check any hypothesis, and the mechanics of the same functionality can simultaneously have up to 5 different implementations, starting from some small things like a credit card data entry form and ending with penalties and subscriptions models.  Each experiment has its own dashboards in the analytics system (we use Periscope) and the metrics by which we compare.  There is always a control group and we make sure that the experiment is ‚Äúclean‚Äù, that is, the user groups are as identical as possible.  We will tell about analytics and A / B tests separately. <br><br><h3>  Work with klinerami </h3><br>  Any service is based on the performers.  In our case, performers come to the apartments of clients, so their quality and professionalism are very important.  Before becoming our clinic, a person must undergo several procedures: an interview, a security check, a briefing and a test of knowledge of regulations, and an inventory issue.  Until recently, all these procedures took place completely offline, which imposed its limitations on the launch of the service in other regions: we need a warehouse, we need an office, we need a separate call center.  Now we are experimenting with a fully automated system of hiring and supplying the contractor.  And if there were no problems with hiring, then there is still a long way to go with the supply: we are not yet able to automatically control the inventory of the clinoer.  In any case, our main fears have not yet been justified: the system of remote hiring does not affect the quality of performers and service.  Therefore, we will develop in this direction further. <br><br>  Even after the clinic completes our ranks, all orders are not immediately available to him.  We carefully conduct it on orders, help and control the quality of work, and over time all orders become available to him.  To do this, we have an order visibility matrix, which essentially creates an individual list of available orders. <br><br><h3>  Distribution of orders </h3><br>  In general, with the distribution of orders is our main challenge.  The main motivations of the cliner to work through the system are stable earnings and a guaranteed flow of orders.  It seems that everything is simple: I appointed wipers to order and forward, let them wave a mop.  In fact, it turns out that someone is ready to clean only on Wednesdays after lunch, someone does not like cats and balconies, and someone wants to clean only the three of them in Butovo.  There are also preferences on the part of clients, but of a different nature: we should minimize the number of different wines, ideally for 10 orders a customer should have 2-3 wipers, as few people like that his bedding touches 50 strangers a year.  It turns out that the system must take into account all these preferences and select orders for the best match.  It would seem that the classical <a href="https://ru.wikipedia.org/wiki/%25D0%2597%25D0%25B0%25D0%25B4%25D0%25B0%25D1%2587%25D0%25B0_%25D0%25BE_%25D0%25BD%25D0%25B0%25D0%25B7%25D0%25BD%25D0%25B0%25D1%2587%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F%25D1%2585">assignment problem,</a> but since the executor can refuse the assigned order, which he did not like, the task becomes nontrivial.  And if we consider that the client may suddenly transfer or cancel the order altogether, then we get very strict requirements for the speed of the algorithm.  We use complex models that predict the likelihood of cancellation of the order, the likelihood of the client‚Äôs exit to a specific order and automatically select the order for the client for which she will most likely agree on the history of her previous orders.  Our next article just sheds light on this topic. <br><br>  In any case, after the appointment remains a number of unsorted orders, they are disassembled by the klinirami through the application.  Now we are testing a model with an auction and a dynamic price depending on the number of refusals from a particular order.  After a manual fence there is already a small amount of unsorted orders.  The day before the order, our call center manually calls the most suitable performers so that clients are not left without a cliner.  Sometimes it happens that we can‚Äôt pick a performer at all (mainly due to late transfers), but we are working on minimizing this parameter (now up to 5 orders per day are left without performers). <br><br>  In fact, there are many more details of the system: its own CRM, work with the warehouse, but for a short review article there is already so much information. <br><br>  We will be happy to answer your questions. <br><br><hr><br>  Promo code for the first cleaning for users of the habr: <b>habr</b> <br>  <a href="https://github.com/Qlean">Github</a> </div><p>Source: <a href="https://habr.com/ru/post/352758/">https://habr.com/ru/post/352758/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../352746/index.html">Data Center in Miniature</a></li>
<li><a href="../352748/index.html">We are looking for problems with website conversion to Google Spreadsheets</a></li>
<li><a href="../352750/index.html">Cretaceous lettering for dummies on the example of working on an art object</a></li>
<li><a href="../352752/index.html">Procedural worlds from simple tiles</a></li>
<li><a href="../352754/index.html">Introducing Google's S2 Geo-Library and Case Studies</a></li>
<li><a href="../352760/index.html">Compare Tarantool with Redis and Memcached</a></li>
<li><a href="../352762/index.html">Code Conventions: how we maintain the fast pace of developing a PHP project</a></li>
<li><a href="../352764/index.html">EGAIS 3.0 or how not to answer for the mistakes of others</a></li>
<li><a href="../352766/index.html">Intelligence networks</a></li>
<li><a href="../352770/index.html">Kubernetes meetup - presentation and webcast</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>