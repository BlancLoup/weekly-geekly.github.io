<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating shortcodes in WordPress CMS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What are shortcodes 
 Starting with version 2.5, WordPress developers have introduced the concept of "Shortcodes API". This functionality allows you t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating shortcodes in WordPress CMS</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/b8e/659/06f/b8e65906fa0548d6bd90d6a08ded5af0.png"><br><br><h5>  <b>What are shortcodes</b> </h5><br>  Starting with version 2.5, WordPress developers have introduced the concept of "Shortcodes API".  This functionality allows you to create and use macrocodes in website pages or blog entries.  For example, a simple and short recording will add a whole photo gallery on the page. <br><br>  You can read more about shortcodes and learn how to create simple shortcodes from the <a href="http://codex.wordpress.org/ru:Shortcode_API">WordPress documentation</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In this article I want to show how to create more complex shortcodes correctly and solve the most common problems when creating them: <br><ol><li>  Connect third-party scripts and run <b>only</b> if there is a shortcode on the page. </li><li>  Layered Shortcode. <br><ul><li>  Composite shortcode. </li><li>  Nesting shortcodes. </li></ul><br></li></ol><br><a name="habracut"></a><br><h5>  <b>Soil preparation</b> </h5><br>  Before you begin to create something, I suggest my own version of the file placement: <br><br><blockquote>  / <br>  / Includes / <br>  shortcodes.php <br>  ... <br>  functions.php </blockquote><br><br>  Virtually every guide suggests creating shortcodes right in the functions.php file.  I will say right away: I am an opponent of such an approach.  Instead, I strongly recommend putting all the shortcodes in a separate file (includes / shortcodes.php) and plugging it into functions.php in one line.  This will significantly unload functions.php and make the code more readable. <br><br>  <b><i>Note</i></b> : WordPress, of course, supports the connection of files through require, but it does not recommend to do this.  Instead, it is suggested to use <b>get_template_part ()</b> . <br><br><h5>  <b>Connecting scripts</b> </h5><br>  Many novice developers very often make this mistake - they include the scripts necessary for the work of one or another shortcode, immediately upon the announcement of the shortcode.  That is, the scripts are always loaded, even if this shortcode is not on the page. <br><br>  An example of such an implementation: <br><br><pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foobar_func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $atts )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"foo and bar"</span></span>; } add_shortcode( <span class="hljs-string"><span class="hljs-string">'foobar'</span></span>, <span class="hljs-string"><span class="hljs-string">'foobar_func'</span></span> ); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo_script</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ wp_register_script( <span class="hljs-string"><span class="hljs-string">'foo-js'</span></span>, get_template_directory_uri() . <span class="hljs-string"><span class="hljs-string">'/includes/js/foo.js'</span></span>); wp_enqueue_script( <span class="hljs-string"><span class="hljs-string">'foo-js'</span></span> ); } add_action( <span class="hljs-string"><span class="hljs-string">'wp_enqueue_scripts'</span></span>, <span class="hljs-string"><span class="hljs-string">'foo_script'</span></span>);</code> </pre> <br><br>  This is a fully working version, but the script will be loaded on each page, even if it is not needed there (i.e. there is no shortcode). <br><br>  In order to avoid such situations, I suggest using the following approach: <br><br><ol><li>  Define the shortcode as a separate class. </li><li>  Add a flag that determines whether this shortcode is on the page. </li><li>  Download the script only on the shortcode presence flag. </li></ol><br><br>  That's all‚Ä¶ <br><br>  An example of such an implementation: <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">foobar_shortcode</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $add_script; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ add_shortcode(<span class="hljs-string"><span class="hljs-string">'foobar'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">__CLASS__</span></span>, <span class="hljs-string"><span class="hljs-string">'foobar_func'</span></span>)); add_action(<span class="hljs-string"><span class="hljs-string">'init'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">__CLASS__</span></span>, <span class="hljs-string"><span class="hljs-string">'register_script'</span></span>)); add_action(<span class="hljs-string"><span class="hljs-string">'wp_footer'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">__CLASS__</span></span>, <span class="hljs-string"><span class="hljs-string">'print_script'</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foobar_func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $atts )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$add_script = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"foo and bar"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">register_script</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ wp_register_script( <span class="hljs-string"><span class="hljs-string">'foo-js'</span></span>, get_template_directory_uri() . <span class="hljs-string"><span class="hljs-string">'/includes/js/foo.js'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">print_script</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$add_script ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; wp_print_scripts(<span class="hljs-string"><span class="hljs-string">'foo-js'</span></span>); } } foobar_shortcode::init();</code> </pre><br><br>  Unlike the previous implementation, this shortcode is initialized, but all scripts are loaded only if there is a shortcode on the page. <br><br><h5>  <b>Nested shortcodes</b> </h5><br>  There are a couple of problems that novice developers may encounter: <br><br><ul><li>  Creating a multi-level shortcode (consisting of several). </li><li>  Using shortcode inside the same shortcode. </li></ul><br><br>  Now - in more detail. <br><br>  Creating a layered shortcode <br>  The problem is that such a shortcode consists of several smaller shortcodes and it is necessary to prevent them from being used as separate shortcodes (except when necessary). <br><br>  Take, for example, the shortcode that creates the pricing table.  To do this, it is necessary to prepare three separate schools <br><br><blockquote>  [price] <br>  - [plan title = 'Plan 1' price = '99 '] <br>  - [option] Option 1 [/ option] <br>  - [option] Option 2 [/ option] <br>  - [option] ... [/ option] <br>  - [/ plan] <br>  - [plan title = 'Plan 2' price = '499'] <br>  - [option] Option 1 [/ option] <br>  - [option] Option 2 [/ option] <br>  - [option] ... [/ option] <br>  - [/ plan] <br>  ... <br>  [/ price] </blockquote><br><br>  This example uses three shortcodes: [price] [plan] [option]. <br><br><blockquote>  add_shortcode ('price', 'price_code'); <br>  add_shortcode ('plan', 'plan_code'); <br>  add_shortcode ('option', 'option_code'); </blockquote><br><br>  To prevent the use of internal shortcodes as separate, the following scheme is proposed: <br><br>  Price -&gt; output code to page <br>  Plan -&gt; Data Acquisition <br>  Option -&gt; data retrieval <br><br>  That is, the output of the code to the page occurs only in the external shortcode, while the internal one simply returns the received data.  An example of such an implementation is given below. <br>  Description of the external shortcode function: <br><br><pre> <code class="php hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">price_code</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($atts, $content)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//       $GLOBALS['plan-count'] = 0; $GLOBALS['plans'] = array(); //       do_shortcode($content); //  HTML  $output = '&lt;div class="price"&gt;'; if(is_array($GLOBALS['plans'])) { foreach ($GLOBALS['plans'] as $plan) { $planContent = '&lt;div class="plan"&gt;'; $planContent .= $plan; $planContent .= '&lt;/div&gt;'; $output .= $planContent; } } $output .= '&lt;/div&gt;'; //  HTML  return $output; }</span></span></code> </pre><br><br>  Description of the functions of internal shortcodes: <br><br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">plan_code</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($atts, $content)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    extract(shortcode_atts(array( 'title' =&gt; '', // Plan title name 'price' =&gt; '0', // Plan price ), $atts)); //  HTML:   $plan_title = '&lt;div class="plan-title"&gt;'; $plan_title .= ' &lt;p&gt;'.$title.'&lt;/p&gt;'; $plan_title .= '&lt;/div&gt;'; //  HTML:  $f_price = round(floatval($price), 2); $f_price = ($f_Price &gt; 0) ? $f_Price : 0; $s_price = '$'.$f_Price; $price_plan = '&lt;div class="plan"&gt;'; $price_plan .= ' &lt;p class="price-sum"&gt;'.$s_price.'&lt;/p&gt;'; $price_plan .= ' &lt;small class="price-text"&gt;'.$text.'&lt;/small&gt;'; $price_plan .= '&lt;/div&gt;'; //      $GLOBALS['plan-options-count'] = 0; $GLOBALS['plan-options'] = array(); //       do_shortcode($content); //  HTML:  $plan_options = '&lt;div class="plan-options"&gt;'; if (is_array($GLOBALS['plan-options'])) { foreach ($GLOBALS['plan-options'] as $option) { $plan_options .= $option; } } $s_OptionsDiv.= '&lt;/div&gt;'; //  HTML:   $plan_div = $plan_title; $plan_div .= $price_plan; $plan_div .= $plan_options; //    $i = $GLOBALS['plan-count'] + 1; $GLOBALS['plans'][$i] = $plan_div; $GLOBALS['plan-count'] = $i; //    return true; } function option_code ($atts, $content) { //  HTML $plan_option = '&lt;div class="price-option"&gt;'; $plan_option .= ' &lt;p class="price-option-text"&gt;'.do_shortcode($content).'&lt;/p&gt;'; $plan_option .= '&lt;/div&gt;'; //    $i = $GLOBALS['plan-options-count'] + 1; $GLOBALS['plan-options'][$i] = $plan_option; $GLOBALS['plan-options-count'] = $i; //    return true; }</span></span></code> </pre><br><br>  With this approach, the shortcode will only work as an assembly, i.e., if used correctly, in other cases nothing will be displayed on the screen (accordingly, nothing will break). <br><br>  Of course, you can still optimize and improve this shortcode, but still, I think, I managed to demonstrate the main idea. <br><br><h5>  <b>Duplicate shortcodes</b> </h5><br>  The problem is this: you need to use the same shortcode inside the shortcode.  The most frequent example in my practice was the shortcode for creating a column.  Ie, for example, you need to implement the division of the page into 2 parts with the help of columns and in the first column to divide by 2 columns. <br><br><blockquote>  [column_half] <br>  [column_half] Content [/ column_half] <br>  [column_half] Content [/ column_half] <br>  [/ column_half] <br>  [column_half] Content [/ column_half] </blockquote><br><br>  Unfortunately, WordPress already has this kind of nesting power.  Layout scatter on the second content.  This happens because when you open a shortcode, WordPress immediately looks for the second (closing) part of this shortcode, i.e.  in this example, the first column will be closed at the first nested shortcode. <br><br>  To solve this problem, unfortunately, there are no other options than simply adding new shortcodes.  But, it makes no sense to rewrite the functions, you can simply initialize the shortcode to the existing functions: <br><br><pre> <code class="php hljs">add_shortcode( <span class="hljs-string"><span class="hljs-string">'column_half'</span></span>, <span class="hljs-string"><span class="hljs-string">'column_half_code'</span></span> ); add_shortcode( <span class="hljs-string"><span class="hljs-string">'column_half_inner'</span></span>, <span class="hljs-string"><span class="hljs-string">'column_half_code'</span></span> ); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">column_half_code</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $atts, $content )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;div class='col-lg-6'&gt;"</span></span>.do_shortcode($content).<span class="hljs-string"><span class="hljs-string">"&lt;/div&gt;"</span></span>; }      : [column_half] [column_half_inner] Content [/column_half_inner] [column_half_inner] Content [/column_half_inner] [/column_half] [column_half] Content [/column_half]</code> </pre><br><br><h5>  <b>Conclusion</b> </h5><br>  In this article, I looked at the most frequent problems that I myself have ever encountered.  If you have something to add, correct, or suggest your own solution to a particular problem, do not hesitate to write in the comments to this article. <br><br>  Author: Dmitry Kabakov, Senior Front-end Developer. </div><p>Source: <a href="https://habr.com/ru/post/265245/">https://habr.com/ru/post/265245/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../265231/index.html">Use the official docker image of NGINX in InfoboxCloud: part 1</a></li>
<li><a href="../265233/index.html">Study: Vulnerabilities of a cryptotransponder allow keyless entry of over 100 models of machines.</a></li>
<li><a href="../265235/index.html">Sony PlayStation 4 security analysis</a></li>
<li><a href="../265239/index.html">How to sue a captured domain if you are not a company</a></li>
<li><a href="../265243/index.html">Microconference UX-Environment ‚Ññ24: Long-reads and modern tools of publishing</a></li>
<li><a href="../265247/index.html">HTML5 game development for Android from scratch to release</a></li>
<li><a href="../265249/index.html">Pedestrian Routing - New Challenge for OpenStreetMap</a></li>
<li><a href="../265255/index.html">Police forced the Chinese developer to remove the code from GitHub</a></li>
<li><a href="../265257/index.html">Mmmm ... Marshmallow: what's new in the Android 6 and Android SDK</a></li>
<li><a href="../265259/index.html">Embed premium media content with HTML5</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>