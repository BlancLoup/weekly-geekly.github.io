<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>OpenGL ES 2.0 wrapper for Qt</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A long time ago, when I wrote the game under the adroid, I had to deal with OpenGL ES 1.1. It seems to be nothing complicated, 2D graphics, you just h...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>OpenGL ES 2.0 wrapper for Qt</h1><div class="post__text post__text-html js-mediator-article">  A long time ago, when I wrote the game under the adroid, I had to deal with OpenGL ES 1.1.  It seems to be nothing complicated, 2D graphics, you just had to draw PNG images, with the ability to scale, rotate, add transparency.  Then I spent about a week on it, and maybe even more, I don‚Äôt remember.  It was difficult, because I never had an affair with OpenGL.  The source code <a href="https://github.com/libgdx/libgdx">libgdx</a> helped a <a href="https://github.com/libgdx/libgdx">lot</a> , in which, by the way, all low-level OpenGL functions are hidden from the developer. <br>  Times change, instead of OpenGL ES 1.1 comes version 2.0, which is quite different.  You have to figure out what these <a href="http://en.wikipedia.org/wiki/Shader">shaders are</a> , and why there is no way without them.  It takes several days again.  It would seem to be easy, because 2D, everything is simple.  For example, if you use QML, it is done like this: <br><pre><code class="cpp hljs">Image { source: <span class="hljs-string"><span class="hljs-string">"brick.png"</span></span> opacity: <span class="hljs-number"><span class="hljs-number">0.8</span></span> rotation: <span class="hljs-number"><span class="hljs-number">90</span></span> }</code> </pre> <br>  And if you write everything in C ++, you get many, many lines of code that are difficult to understand if you are not familiar with OpenGL.  I tried to find some kind of library wrapper over OpenGL, like libgdx, only for Qt, but without success.  So I decided, after everything will work for me, I will write a small wrapper that hides all OpenGL calls and allows you to conveniently work with 2D graphics. <br><a name="habracut"></a><br>  <a href="https://github.com/beemaster/opengl-qt">Wrapper code on github</a> <br>  <a href="https://github.com/beemaster/opengl-qt-examples">GitHub usage example</a> <br><br>  In order to use the wrapper in your application, you need to add one line to the .pro file: <br><pre> <code class="cpp hljs">include (opengl-qt/opengl-qt.pri)</code> </pre><br>  Inherit the application window from OpenGLQt :: Widget: <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Widget</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> OpenGLQt::Widget { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Widget(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawSprites</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; };</code> </pre><br>  Pass the path to the file and the number of images in it in the constructor.  Start timer: <br><pre> <code class="cpp hljs">Widget::Widget() : OpenGLQt::Widget(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">"spritesheet.png"</span></span>) , m_counter(<span class="hljs-number"><span class="hljs-number">0</span></span>) { startTimer(); }</code> </pre><br>  Override the drawSprites () method: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Widget::drawSprites() { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Sprite apple = {<span class="hljs-number"><span class="hljs-number">86</span></span>, <span class="hljs-number"><span class="hljs-number">118</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>}; <span class="hljs-comment"><span class="hljs-comment">//  ,    static Color color = {1, 1, 1, 1}; //   static DrawSpriteArgs args; args.sprite = apple; args.color = color; args.x = 10; //      args.y = 15; //     args.angle = 3.14f / 2.0f; //   90    args.scaleX = 0.5f; //   50%    args.scaleY = -1.0f; //      drawSprite(args); }</span></span></code> </pre><br>  And that's all.  Pretty easy, right?  If you want to use this wrapper, you will need to fit all your graphics into one PNG file.  This can be done, for example, using the <a href="http://www.codeandweb.com/texturepacker">TexturePacker</a> .  The point of this is to increase the speed: the texture is loaded into the video memory once, at the start, and remains there until the end of the program.  When you want to draw an image, you need to specify its coordinates in this texture. <br><img src="https://habrastorage.org/storage2/6e5/92a/94d/6e592a94d0b557decde952cdc7125b67.jpg"><br><br>  Some OpenGL details.  Vertex shader: <br><pre> <code class="cpp hljs">uniform mat4 mvp_matrix; attribute vec4 a_position; attribute vec2 a_texcoord; attribute vec4 a_color; varying vec4 v_color; varying vec2 v_texcoord; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ gl_Position = mvp_matrix * a_position; v_texcoord = a_texcoord; v_color = a_color; }</code> </pre><br>  Fragment shader: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> GL_ES #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LOWP lowp precision mediump float; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LOWP #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> varying vec2 v_texcoord; varying LOWP vec4 v_color; uniform sampler2D texture; void main() { gl_FragColor = v_color * texture2D(texture, v_texcoord); }</span></span></code> </pre><br>  Most OpenGL functions are called once during program initialization.  After that, a timer starts, which causes the screen refresh 60 times per second: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Widget::startTimer() { m_timer.start(<span class="hljs-number"><span class="hljs-number">1000.0f</span></span> / <span class="hljs-number"><span class="hljs-number">60.0f</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Widget::timerEvent(QTimerEvent *) { updateGL(); } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Widget::paintGL() { beginDraw(); drawSprites(); endDraw(); } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Widget::beginDraw() { m_idx = <span class="hljs-number"><span class="hljs-number">0</span></span>; glClear(GL_COLOR_BUFFER_BIT); glClearColor(m_background.r, m_background.g, m_background.b, m_background.a); } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Widget::endDraw() { glDrawArrays(GL_TRIANGLES, <span class="hljs-number"><span class="hljs-number">0</span></span>, m_idx / <span class="hljs-number"><span class="hljs-number">2</span></span>); }</code> </pre><br>  All drawing occurs in the drawSprites () method, an example of which is shown above.  It consists in filling in the DrawSpriteArgs structure and calling the drawSprite method for each image that needs to be drawn.  If you want something non-standard, for example, to rotate the image not around the center, you can manually fill in arrays of coordinates, textures, and colors.  The maximum size of the arrays must be set when the program starts in the constructor, because the QVector can move to another memory location when zoomed in, and OpenGL will need to be notified about this: <br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> vertexLocation = m_program-&gt;attributeLocation(<span class="hljs-string"><span class="hljs-string">"a_position"</span></span>); m_program-&gt;enableAttributeArray(vertexLocation); glVertexAttribPointer(vertexLocation, <span class="hljs-number"><span class="hljs-number">2</span></span>, GL_FLOAT, GL_FALSE, <span class="hljs-number"><span class="hljs-number">0</span></span>, &amp;m_verts[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> texcoordLocation = m_program-&gt;attributeLocation(<span class="hljs-string"><span class="hljs-string">"a_texcoord"</span></span>); m_program-&gt;enableAttributeArray(texcoordLocation); glVertexAttribPointer(texcoordLocation, <span class="hljs-number"><span class="hljs-number">2</span></span>, GL_FLOAT, GL_FALSE, <span class="hljs-number"><span class="hljs-number">0</span></span>, &amp;m_texCoords[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> colorLocation = m_program-&gt;attributeLocation(<span class="hljs-string"><span class="hljs-string">"a_color"</span></span>); m_program-&gt;enableAttributeArray(colorLocation); glVertexAttribPointer(colorLocation, <span class="hljs-number"><span class="hljs-number">4</span></span>, GL_FLOAT, GL_FALSE, <span class="hljs-number"><span class="hljs-number">0</span></span>, &amp;m_colors[<span class="hljs-number"><span class="hljs-number">0</span></span>]);</code> </pre><br>  The projection matrix was taken <a href="http://www.songho.ca/opengl/gl_projectionmatrix.html">from here</a> .  It is set during window resizing: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Widget::resizeGL(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> w, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> h) { glViewport(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, w, h); <span class="hljs-function"><span class="hljs-function">QMatrix4x4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2.0f</span></span></span></span><span class="hljs-function"><span class="hljs-params">/w, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-1</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2.0f</span></span></span></span><span class="hljs-function"><span class="hljs-params">/h, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-1</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-1</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span></span>; m_program-&gt;setUniformValue(<span class="hljs-string"><span class="hljs-string">"mvp_matrix"</span></span>, mat); }</code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      That's probably all.  For those who really want to use a wrapper, I strongly advise you to compile an example and figure out how it works.  The code has been tested on Windows 7 (Qt 4.8 MinGW, MSVC 2008), Mac OS X 10.8 (Qt 5.1 Clang), Nokia N9 (Qt 4.7), BlackBerry 10 (Qt 4.8), and it runs correctly everywhere. <br><br><h3>  Conclusion </h3><br>  I think that not only did I have such problems, and I hope that this article will help someone, that this little wrapper will become a brick in some project and make life easier for someone.  Or maybe someone will just pick up something from the code - please.  Since I am not an OpenGL expert, it is possible that there are errors in the implementation.  If you have corrections or suggestions for improvement, feel free to write in the comments. </div><p>Source: <a href="https://habr.com/ru/post/178599/">https://habr.com/ru/post/178599/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../178583/index.html">Google maps engine</a></li>
<li><a href="../178585/index.html">The court acquitted the noble cybersquatter</a></li>
<li><a href="../178587/index.html">Useful projects for xna developers</a></li>
<li><a href="../178593/index.html">Create dynamic websites using PHP, MySQL, JavaScript and CSS. 2nd ed</a></li>
<li><a href="../178597/index.html">Hulk hovercraft part 2</a></li>
<li><a href="../178601/index.html">The Russian Indie Bundle # 1 launched</a></li>
<li><a href="../178603/index.html">Mozilla protests against spyware under the guise of Firefox</a></li>
<li><a href="../178605/index.html">The coolest and most terrifying bionic robots</a></li>
<li><a href="../178607/index.html">ProDesk3D: the world's first desktop color 3D printer</a></li>
<li><a href="../178609/index.html">In IBM Research created a cartoon using separate molecules</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>