<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Use a hash search, not an array search</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A rather frequent task is to check whether the string is the same as the other rows in the set. For example, you need to check every word in a forum m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Use a hash search, not an array search</h1><div class="post__text post__text-html js-mediator-article"> A rather frequent task is to check whether the string is the same as the other rows in the set.  For example, you need to check every word in a forum message to see if it is in the list of prohibited ones.  A common solution: create an array with a list of forbidden words, and then use the <code>in_array()</code> function to do a check.  There are ways to improve the performance of such an algorithm. <br><a name="habracut"></a><br><h4>  Array search </h4><br>  Usually the check happens like this: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $words = get_all_words_in_text($text); $badWords = [<span class="hljs-string"><span class="hljs-string">'$$$$'</span></span>, <span class="hljs-string"><span class="hljs-string">'@#$%'</span></span>, <span class="hljs-string"><span class="hljs-string">'crud'</span></span> <span class="hljs-comment"><span class="hljs-comment">/** ... */</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($words <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $word) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (in_array(strtolower($word), $badWords)) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'Found bad word: '</span></span> . $word . <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; } }</code> </pre><br><br>  This method solves the problem, but it is not the most effective.  Pass through the array of words in the message and check each for being in the list of prohibited by the function <code>in_array()</code> .  In PHP, the algorithm by which the function <code>in_array()</code> is implemented has linear complexity - O (n).  This means that with an increase in the list of bad words, the work time will increase proportionally.  We can come up with something better. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Search by hash </h4><br>  Since the list of bad words is known in advance, you can rework the way of comparison so that it will have a constant complexity that does not depend on the number of prohibited words in the list.  For this you can use associative arrays.  As in the case of hash tables, the speed of searching for a key in an array is O (1), except for <a href="http://stackoverflow.com/a/2484455/2816475">some cases</a> that will not arise in our situation. <br><br>  If we change the structure of an array of bad words so that its values ‚Äã‚Äãbecome keys, and the values ‚Äã‚Äãfor these keys become just <code>true</code> , we can use the <code>isset()</code> function and get a significant speed increase. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $words = get_all_words_in_text($text); $badWords = [ <span class="hljs-string"><span class="hljs-string">'$$$$'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'@#$%'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'crud'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> <span class="hljs-comment"><span class="hljs-comment">// ... ]; foreach ($words as $word) { if (isset($badWords[strtolower($word)])) { echo 'Found bad word: ' . $word . "\n"; } }</span></span></code> </pre><br><br><h4>  Performance test </h4><br>  Let's try to test a new way.  I wrote a simple test that will show the elapsed time on the same data set for the methods: ‚Äúarray search‚Äù and ‚Äúsearch by hash‚Äù. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $total = <span class="hljs-number"><span class="hljs-number">10000</span></span>; $paragraph = <span class="hljs-string"><span class="hljs-string">'this is a sentence. Crud! $$$$!'</span></span>; $words = explode(<span class="hljs-string"><span class="hljs-string">' '</span></span>, $paragraph); $badWordList = [<span class="hljs-string"><span class="hljs-string">'$$$$'</span></span>, <span class="hljs-string"><span class="hljs-string">'@#$%'</span></span>, <span class="hljs-string"><span class="hljs-string">'crud'</span></span>, <span class="hljs-string"><span class="hljs-string">'fud'</span></span>, <span class="hljs-string"><span class="hljs-string">'fudd'</span></span>, <span class="hljs-string"><span class="hljs-string">'dud'</span></span>]; $s = microtime(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($j = <span class="hljs-number"><span class="hljs-number">0</span></span>; $j &lt; $total; $j++) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($words <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $word) { in_array(strtolower($word), $badWordList); } } <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"in_array: "</span></span> . (microtime(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) - $s) . <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; $badWordHash = [ <span class="hljs-string"><span class="hljs-string">'$$$$'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'@#$%'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'crud'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'fud'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'fudd'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'dud'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> ]; $s = microtime(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($j = <span class="hljs-number"><span class="hljs-number">0</span></span>; $j &lt; $total; $j++) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($words <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $word) { <span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($badWordHash[strtolower($word)]); } } <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"hash: "</span></span> . (microtime(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) - $s) . <span class="hljs-string"><span class="hljs-string">"\n"</span></span>;</code> </pre><br><br>  As you can see from the listing, 10,000 repetitions are used in the test.  The result is: <br><br><pre> <code class="bash hljs">in_array: 0.033491134643555 <span class="hljs-built_in"><span class="hljs-built_in">hash</span></span>: 0.0069370269775391</code> </pre><br><br>  As you can see, the search by hash gave an increase of 480% compared with the search of the array. <br><br>  It is important to understand that as the number of forbidden words increases, the time required for searching an array with the <code>in_array()</code> function <code>in_array()</code> .  But <code>isset()</code> does not depend on the number of elements, and its operation time will remain constant.  Let me show you what I mean.  In the following example, the list of forbidden words will consist of 10,000 elements. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $total = <span class="hljs-number"><span class="hljs-number">10000</span></span>; $paragraph = <span class="hljs-string"><span class="hljs-string">'this is a sentence. Crud! $$$$!'</span></span>; $words = explode(<span class="hljs-string"><span class="hljs-string">' '</span></span>, $paragraph); <span class="hljs-comment"><span class="hljs-comment">//     $sequence = []; for ($j = 0; $j &lt; 10000; $j++) { $sequence[] = 'a' . $j; } $s = microtime(true); for ($j = 0; $j &lt; $total; $j++) { foreach ($words as $word) { in_array(strtolower($word), $sequence); } } echo "in_array: " . (microtime(true) - $s) . "\n"; //     $hash = array_fill_keys($sequence, true); $s = microtime(true); for ($j = 0; $j &lt; $total; $j++) { foreach ($words as $word) { isset($hash[strtolower($word)]); } } echo "hash: " . (microtime(true) - $s) . "\n";</span></span></code> </pre><br><br>  The difference in speed is much better visible.  A hash search is 3 162 percent faster than an array search. <br><br><pre> <code class="bash hljs">in_array: 20.464313983917 <span class="hljs-built_in"><span class="hljs-built_in">hash</span></span>: 0.0064699649810791</code> </pre><br><br><h4>  Generally, there is nothing new </h4><br>  This is not a new idea.  This is a fairly common approach in many languages.  I recently realized all of a sudden that I constantly use hash searching for such tasks while reading the book ‚Äú <a href="http://www.lua.org/pil/11.5.html">Programming on Lua</a> ‚Äù. <br><br>  The next time you use <code>in_array()</code> to check, think about whether the work will speed up if you use the <code>isset()</code> function on the keys of the associative array instead. </div><p>Source: <a href="https://habr.com/ru/post/216865/">https://habr.com/ru/post/216865/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../216845/index.html">Search for solutions for games with words. Boron application</a></li>
<li><a href="../216849/index.html">Setting up the development environment for OpenStack</a></li>
<li><a href="../216851/index.html">We control the machine via Bluetooth from a tablet or phone for Android</a></li>
<li><a href="../216853/index.html">Gateway between IRC and Google Hangouts</a></li>
<li><a href="../216857/index.html">Synchronization in Android applications. Part two</a></li>
<li><a href="../216869/index.html">Alternative GDC Arcade: Home-Made Freak Controllers Gallery</a></li>
<li><a href="../216871/index.html">Operation windigo</a></li>
<li><a href="../216875/index.html">Fighting the Apocalypse: technologies that will save humanity</a></li>
<li><a href="../216877/index.html">New LG monitors of Ultrawide line</a></li>
<li><a href="../216879/index.html">Mobile client for Yandex-Metrics</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>