<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automating code checking or some more about pre-commit hooks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I think there is no need to tell the habrew user what Git / GitHub is, pre-commit and how to put a hook to it on the right. Let's get right to the poi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automating code checking or some more about pre-commit hooks</h1><div class="post__text post__text-html js-mediator-article">  I think there is no need to tell the habrew user what Git / GitHub is, pre-commit and how to put a hook to it on the right.  Let's get right to the point. <br><br>  There are many examples of hooks in the network, most of them are on shells, but no author has paid attention to one important point - you have to drag a hook from project to project.  At first glance - do not worry.  But suddenly there is a need to make changes to the hook that already lives in 20 projects ... Or suddenly you need to transfer the development from Windows to Linux, and the hook to PowerShell ... What to do?  <s>???????</s>  <s>PROFIT</s> ... <br><br><h3>  ‚ÄúBetter like this: 8 pies and one candle!‚Äù </h3><br>  Examples, of course, are greatly exaggerated, but with their help, inconveniences have been revealed that I would like to avoid.  It would be desirable, that the hook was not required to be dragged on all projects, it was not necessary to ‚Äúfinish‚Äù often, but so that he could: <br><ul><li>  check the code sent to the repository for validity (for example: compliance with the PEP8 requirements, availability of documentation, etc.); </li><li>  perform a comprehensive check of the project (unit tests, etc.); </li><li>  interrupt the commit operation in case of errors and display a detailed log for debriefing. </li></ul><br>  And it looked like this: <br><pre><code class="bash hljs">python pre-commit.py --check pep8.py --<span class="hljs-built_in"><span class="hljs-built_in">test</span></span> tests.py</code> </pre> <br>  It is clear that the hook itself is just a starter, and the script that it launches performs all the <s>special street</s> magic.  Let's try to write such a script.  Interested - welcome under cat. <br><a name="habracut"></a><br><h3>  pre-commit.py </h3><br>  But before <s>downloading a ready-made example from the network to</s> start developing, consider the parameters that accept them.  At the same time on their example I will tell how everything works. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      These parameters will set the basic behavior of the script: <br><ul><li>  <b>-c</b> or <b>--check</b> <i>[script1 ... scriptN]</i> - launching validation scripts.  <i>The script</i> should be located in the same directory as <i>pre-commit.py</i> .  Otherwise, you need to specify the full path.  Each <i>script</i> will be ‚Äúfed‚Äù files from the current commit. </li><li>  <b>-t</b> or <b>--test</b> <i>[test1 ... testN]</i> - run unit tests and other scripts that do not require the current commit file.  <i>The test</i> should be located in the current project directory.  Otherwise, you need to specify the full path. </li></ul><br>  Both parameters will be optional (to be able to leave only one type of check), but if you do not specify any of them, <i>pre-commit.py</i> will exit with the code ‚Äú1‚Äù (error). <br><br>  And add auxiliary parameters (all optional): <br><ul><li>  <b>-e</b> or <b>--exec_interpreter_path</b> - the full path (with the file name) to the interpreter that will execute the scripts from <b>--check</b> and <b>--test</b> .  If the parameter is not specified, the interpreter used by <i>pre-commit.py</i> will be used. </li><li>  <b>-v</b> or <b>--verbose</b> - enables verbose logging.  If not specified, the console output of those scripts that have completed with an error code is written to the log. </li><li>  <b>-o</b> or <b>--openlog</b> <i>path_to_viewer</i> - the full path (with the file name) to the program with which we will view the log. </li><li>  <b>-f</b> or <b>--forcelog</b> - forced opening of the log.  If not specified, the log is opened only if errors are detected.  The parameter is applicable if <b>--openlog</b> is <b>specified</b> . </li></ul><br>  The logic is clear, now you can start writing the script itself. <br><br><h4>  Command line parameters </h4><br>  To begin, configure the command line parser.  Here we will use the <a href="https://docs.python.org/3/library/argparse.html">argparse</a> module (or ‚Äúon the fingers‚Äù is well explained <a href="https://habrahabr.ru/post/144416/">here</a> and <a href="https://habrahabr.ru/post/252333/">here</a> ), since it is included in the basic <i>Python</i> package. <br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># -*- coding: utf-8 -*- import sys import argparse #    parser = argparse.ArgumentParser() #   .   , #    :   1-N  parser.add_argument('-c', '--check', nargs='+') #   --check parser.add_argument('-t', '--test', nargs='+') #  -.  ,     # True.    - False parser.add_argument('-v', '--verbose', action='store_true') #     . #    - =default parser.add_argument('-e', '--exec', default=sys.executable) #     . #    - =None parser.add_argument('-o', '--openlog') #   --verbose parser.add_argument('-f', '--forcelog', action='store_true') #  1-  (  ),  #       dict params = vars(parser.parse_args(sys.argv[1:]))</span></span></code> </pre><br>  Run the script with the following parameters: <br><pre> <code class="bash hljs">c:\python34\python c:\dev\projects\pre-commit-tool\pre-commit.py --check c:\dev\projects\pre-commit-tool\pep8.py --<span class="hljs-built_in"><span class="hljs-built_in">test</span></span> tests.py</code> </pre><br>  And display the contents of <i>params</i> on the screen: <br><pre> <code class="bash hljs">{<span class="hljs-string"><span class="hljs-string">'exec'</span></span>: <span class="hljs-string"><span class="hljs-string">'c:\\python34\\python.exe'</span></span>, <span class="hljs-string"><span class="hljs-string">'forcelog'</span></span>: False, <span class="hljs-string"><span class="hljs-string">'test'</span></span>: [<span class="hljs-string"><span class="hljs-string">'tests.py'</span></span>], <span class="hljs-string"><span class="hljs-string">'check'</span></span>: [<span class="hljs-string"><span class="hljs-string">'c:\\dev\\projects\\pre-commit-tool\\pep8.py'</span></span>], <span class="hljs-string"><span class="hljs-string">'openlog'</span></span>: None, <span class="hljs-string"><span class="hljs-string">'verbose'</span></span>: False}</code> </pre><br>  Now the values ‚Äã‚Äãof all parameters are in the <i>params</i> dictionary and can be easily obtained by the key of the same name. <br>  Add a check for the presence of the main parameters: <br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#         if params.get('check') is None and params.get('test') is None: print('   ') exit(1)</span></span></code> </pre><br>  Everything is good, but you can simplify your life a little, without compromising flexibility.  We know that in 99% of cases, the validation script is one and it is called, for example, 'pep8.py', and the power unit script is the same for us every time (and often it will also be one).  Similarly, with the display of the log - we will always use the same program (let it be a ‚ÄúNotepad‚Äù).  Let's make changes to the configuration of the parser: <br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#       0-N  parser.add_argument('-c', '--check', nargs='*') parser.add_argument('-t', '--test', nargs='*') #     ,     const parser.add_argument('-o', '--openlog', nargs='?', const='notepad')</span></span></code> </pre><br>  And add the installation of default values: <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> params.get(<span class="hljs-string"><span class="hljs-string">'check'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> len(params.get(<span class="hljs-string"><span class="hljs-string">'check'</span></span>)) == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-comment"><span class="hljs-comment">#     ,   pre-commit.py params['check'] = [join(dirname(abspath(__file__)), 'pep8.py')] if params.get('test') is not None and len(params.get('test')) == 0: params['test'] = ['tests.py']</span></span></code> </pre><br>  After making changes, the parser configuration code should look like this: <br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># -*- coding: utf-8 -*- import sys import argparse from os.path import abspath, dirname, join parser = argparse.ArgumentParser() parser.add_argument('-c', '--check', nargs='*') parser.add_argument('-t', '--test', nargs='*') parser.add_argument('-v', '--verbose', action='store_true') parser.add_argument('-e', '--exec', default=sys.executable) parser.add_argument('-o', '--openlog', nargs='?', const='notepad') parser.add_argument('-f', '--forcelog', action='store_true') params = vars(parser.parse_args(sys.argv[1:])) if params.get('check') is None and params.get('test') is None: print('   ') exit(1) if params.get('check') is not None and len(params.get('check')) == 0: params['check'] = [join(dirname(abspath(__file__)), 'pep8.py')] if params.get('test') is not None and len(params.get('test')) == 0: params['test'] = ['tests.py']</span></span></code> </pre><br>  Now the script startup line is shorter: <br><pre> <code class="bash hljs">c:\python34\python c:\dev\projects\pre-commit-tool\pre-commit.py --check --<span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --openlog</code> </pre>  <i>params</i> content: <br><pre> <code class="python hljs">{<span class="hljs-string"><span class="hljs-string">'check'</span></span>: [<span class="hljs-string"><span class="hljs-string">'c:\\dev\\projects\\pre-commit-tool\\pep8.py'</span></span>], <span class="hljs-string"><span class="hljs-string">'openlog'</span></span>: <span class="hljs-string"><span class="hljs-string">'notepad'</span></span>, <span class="hljs-string"><span class="hljs-string">'test'</span></span>: [<span class="hljs-string"><span class="hljs-string">'tests.py'</span></span>], <span class="hljs-string"><span class="hljs-string">'verbose'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">'exec'</span></span>: <span class="hljs-string"><span class="hljs-string">'c:\\python34\\python.exe'</span></span>, <span class="hljs-string"><span class="hljs-string">'forcelog'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>}</code> </pre><br>  Parameters won, go further. <br><br><h4>  Log </h4><br>  Configure the log object.  The <i>'pre-commit.log'</i> log file will be created in the root of the current project.  For Git, the working directory is the project root, so the file path is not specified.  Also, we specify the mode for creating a new file for each operation (we do not need to store the previous logs) and set the log format - only the message: <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> logging log_filename = <span class="hljs-string"><span class="hljs-string">'pre-commit.log'</span></span> logging.basicConfig( filename=log_filename, filemode=<span class="hljs-string"><span class="hljs-string">'w'</span></span>, format=<span class="hljs-string"><span class="hljs-string">'%(message)s'</span></span>, level=logging.INFO) to_log = logging.info</code> </pre><br>  The last line of code will simplify your life a little more - we create an alias, which we will use further by code instead of <i>logging.info</i> . <br><br><h4>  Shell </h4><br>  We will need to repeatedly run child processes and read their output to the console.  To fulfill this need, we write the <i>shell_command</i> function.  Her responsibilities will include: <br><ul><li>  running a subprocess (using <a href="https://docs.python.org/3/library/subprocess.html">Popen</a> ); </li><li>  read data from the subprocess console and convert them; </li><li>  write the read data to the log if the subprocess is terminated with an error code. </li></ul><br>  The function will take arguments: <br><ul><li>  <i>command</i> is an argument for <i>Popen</i> .  Actually what will run in Shell.  But instead of a solid line (‚Äúpython main.py‚Äù), it is recommended to specify with a list (['python', 'main.py']); </li><li>  <i>force_report</i> - control output to the log.  Possible values: <i>True</i> - forced output to the log, <i>False</i> - output if an error code was received, <i>None</i> - disable output to the log. </li></ul><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> subprocess <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Popen, PIPE <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shell_command</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(command, force_report=None)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#   proc = Popen(command, stdout=PIPE, stderr=PIPE) #    proc.wait() #     # (  ,  "\r\n") transform = lambda x: ' '.join(x.decode('utf-8').split()) #  ( )  stdout report = [transform(x) for x in proc.stdout] #   stderr report.extend([transform(x) for x in proc.stderr]) #        force_report if force_report is True or (force_report is not None and proc.returncode &gt; 0): to_log('[ SHELL ] %s (code: %d):\n%s\n' % (' '.join(command), proc.returncode, '\n'.join(report))) #           return proc.returncode, report</span></span></code> </pre><br><h4>  Head revision </h4><br>  The current commit's file list is easily obtained using <a href="https://git-scm.com/docs/git-diff">the Git diff command</a> .  In our case, we will need modified or new files: <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> os.path <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> basename <span class="hljs-comment"><span class="hljs-comment">#     result_code = 0 #     commit' code, report = shell_command( ['git', 'diff', '--cached', '--name-only', '--diff-filter=ACM'], params.get('verbose')) if code != 0: result_code = code #     "py" targets = filter(lambda x: x.split('.')[-1] == "py", report) #     (  ) targets = [join(dirname(abspath(x)), basename(x)) for x in targets]</span></span></code> </pre><br>  As a result, <i>targets</i> will contain something like this: <br><pre> <code class="python hljs">[<span class="hljs-string"><span class="hljs-string">'C:\\dev\\projects\\example\\demo\\daemon_example.py'</span></span>, <span class="hljs-string"><span class="hljs-string">'C:\\dev\\projects\\example\\main.py'</span></span>, <span class="hljs-string"><span class="hljs-string">'C:\\dev\\projects\\example\\test.py'</span></span>, <span class="hljs-string"><span class="hljs-string">'C:\\dev\\projects\\example\\test2.py'</span></span>]</code> </pre><br>  The most painful stage is completed - it will be easier further. <br><br><h4>  Validation check </h4><br>  Everything is simple here - <i>let's go</i> through all the scripts specified in <i>--check</i> and run each with a list of <i>targets</i> : <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> params.get(<span class="hljs-string"><span class="hljs-string">'check'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> script <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> params.get(<span class="hljs-string"><span class="hljs-string">'check'</span></span>): code, report = shell_command( [params.get(<span class="hljs-string"><span class="hljs-string">'exec'</span></span>), script] + targets, params.get(<span class="hljs-string"><span class="hljs-string">'verbose'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> code != <span class="hljs-number"><span class="hljs-number">0</span></span>: result_code = code</code> </pre><br>  An example of the contents of the log on the code that did not pass the validation check: <br> <code>[ SHELL ] C:\python34\python.exe c:\dev\projects\pre-commit-tool\pep8.py C:\dev\projects\example\demo\daemon_example.py (code: 1): <br> C:\dev\projects\example\demo\daemon_example.py:8:80: E501 line too long (80 &gt; 79 characters) <br></code> <br><h4>  Running tests </h4><br>  We do the same with unit tests, but without <i>targets</i> : <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> params.get(<span class="hljs-string"><span class="hljs-string">'test'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> script <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> params.get(<span class="hljs-string"><span class="hljs-string">'test'</span></span>): code, report = shell_command( [params.get(<span class="hljs-string"><span class="hljs-string">'exec'</span></span>), script], params.get(<span class="hljs-string"><span class="hljs-string">'verbose'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> code != <span class="hljs-number"><span class="hljs-number">0</span></span>: result_code = code</code> </pre><br><h4>  [UPD] Display the log </h4><br>  Depending on the global result code and the <i>--openlog</i> and <i>--forcelog parameters</i> , we decide to display the log or not: <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> params.get(<span class="hljs-string"><span class="hljs-string">'openlog'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (result_code &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> params.get(<span class="hljs-string"><span class="hljs-string">'forcelog'</span></span>)): <span class="hljs-comment"><span class="hljs-comment">#    Popen([params.get('openlog'), log_filename], close_fds=True)</span></span></code> </pre><br>  <i>Note.</i>  <i>Works in versions of Python 2.6 (and above) and 3.x.</i>  <i>On versions lower than 2.6 - no tests were performed.</i> <br><br>  And at the end of the script, don't forget to return the result code to the <i>Git</i> shell: <br><pre> <code class="python hljs">exit(result_code)</code> </pre><br>  Everything.  The script is ready to use. <br><br><h3>  Root of evil </h3><br>  A hook is a file called ‚Äúpre-commit‚Äù (without an extension) that you need to create in the directory: &lt;project_dir&gt; /. Git / hooks / <br><br>  To run correctly on Windows, there are a couple of important points: <br>  <b>1.</b> The first line of the file should be: #! / Bin / sh <br>  Otherwise, we will see such an error: <br> <code>GitHub.IO.ProcessException: error: cannot spawn .git/hooks/pre-commit: No such file or directory <br></code> <br>  <b>2.</b> Using the standard delimiter when specifying the path leads to a similar error: <br> <code>GitHub.IO.ProcessException: C:\python34\python.exe: can't open file 'c:devprojectspre-commit-toolpre-commit.py': [Errno 2] No such file or directory <br></code> <br>  It is treated in three ways: use double backslash, or take all the way in double quotes, or use "/".  For example, Windows eats it and does not choke: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh c:/python34/python "c:\dev\projects\pre-commit-tool\pre-commit.py" -c -tc:\\dev\\projects\\example\\test.py</span></span></code> </pre><br>  Of course, it is not recommended to do this :) Use any method that you like, but <b>one</b> . <br><br><h3>  Acceptance Testing </h3><br>  We will train "on cats": <br><br><img src="https://habrastorage.org/files/39a/9ea/d6d/39a9ead6db724912b74f1589dda36569.png" alt="image"><br><br>  Test commit has new, renamed \ modified and deleted files.  Also included are files with no code;  The code itself contains design errors and does not pass one of the unit tests.  Create a hook with validation, tests and the opening of a detailed log: <br><pre> <code class="bash hljs">c:/python34/python c:/dev/projects/pre-commit-tool/pre-commit.py -c -t test.py test2.py -vfo</code> </pre><br>  And try to commit.  After thinking for a couple of seconds, the <i>Git desktop will</i> signal an error: <br><br><img src="https://habrastorage.org/files/f4d/bb7/52f/f4dbb752f43e4397a25dabe0ba058446.png" alt="image"><br><br>  And in the next window a notebook will display the following: <br><br> <code>[ SHELL ] git diff --cached --name-only --diff-filter=ACM (code: 0): <br> .gitattributes1 <br> demo/daemon_example.py <br> main.py <br> test.py <br> test2.py <br> <br> [ SHELL ] C:\python34\python.exe c:\dev\projects\pre-commit-tool\pep8.py C:\dev\projects\example\demo\daemon_example.py C:\dev\projects\example\main.py C:\dev\projects\example\test.py C:\dev\projects\example\test2.py (code: 1): <br> C:\dev\projects\example\demo\daemon_example.py:8:80: E501 line too long (80 &gt; 79 characters) <br> C:\dev\projects\example\demo\daemon_example.py:16:5: E303 too many blank lines (2) <br> C:\dev\projects\example\demo\daemon_example.py:37:5: E303 too many blank lines (2) <br> C:\dev\projects\example\demo\daemon_example.py:47:5: E303 too many blank lines (2) <br> C:\dev\projects\example\main.py:46:80: E501 line too long (90 &gt; 79 characters) <br> C:\dev\projects\example\main.py:59:80: E501 line too long (100 &gt; 79 characters) <br> C:\dev\projects\example\main.py:63:80: E501 line too long (115 &gt; 79 characters) <br> C:\dev\projects\example\main.py:69:80: E501 line too long (105 &gt; 79 characters) <br> C:\dev\projects\example\main.py:98:80: E501 line too long (99 &gt; 79 characters) <br> C:\dev\projects\example\main.py:115:80: E501 line too long (109 &gt; 79 characters) <br> C:\dev\projects\example\main.py:120:80: E501 line too long (102 &gt; 79 characters) <br> C:\dev\projects\example\main.py:123:80: E501 line too long (100 &gt; 79 characters) <br> <br> [ SHELL ] C:\python34\python.exe test.py (code: 1): <br> Test 1 - passed <br> Test 2 - passed <br> [!] Test 3 FAILED <br> <br> [ SHELL ] C:\python34\python.exe test2.py (code: 0): <br> Test 1 - passed <br> Test 2 - passed <br></code> <br>  Repeat the same commit, only without a detailed log: <br><pre> <code class="bash hljs">c:/python34/python c:/dev/projects/pre-commit-tool/pre-commit.py -c -t test.py test2.py -fo</code> </pre><br>  Result: <br><br> <code>[ SHELL ] C:\python34\python.exe c:\dev\projects\pre-commit-tool\pep8.py C:\dev\projects\example\demo\daemon_example.py C:\dev\projects\example\main.py C:\dev\projects\example\test.py C:\dev\projects\example\test2.py (code: 1): <br> C:\dev\projects\example\demo\daemon_example.py:8:80: E501 line too long (80 &gt; 79 characters) <br> C:\dev\projects\example\demo\daemon_example.py:16:5: E303 too many blank lines (2) <br> C:\dev\projects\example\demo\daemon_example.py:37:5: E303 too many blank lines (2) <br> C:\dev\projects\example\demo\daemon_example.py:47:5: E303 too many blank lines (2) <br> C:\dev\projects\example\main.py:46:80: E501 line too long (90 &gt; 79 characters) <br> C:\dev\projects\example\main.py:59:80: E501 line too long (100 &gt; 79 characters) <br> C:\dev\projects\example\main.py:63:80: E501 line too long (115 &gt; 79 characters) <br> C:\dev\projects\example\main.py:69:80: E501 line too long (105 &gt; 79 characters) <br> C:\dev\projects\example\main.py:98:80: E501 line too long (99 &gt; 79 characters) <br> C:\dev\projects\example\main.py:115:80: E501 line too long (109 &gt; 79 characters) <br> C:\dev\projects\example\main.py:120:80: E501 line too long (102 &gt; 79 characters) <br> C:\dev\projects\example\main.py:123:80: E501 line too long (100 &gt; 79 characters) <br> <br> [ SHELL ] C:\python34\python.exe test.py (code: 1): <br> Test 1 - passed <br> Test 2 - passed <br> [!] Test 3 FAILED <br></code> <br><br>  Correct the errors, repeat commit, and here it is, the long-awaited result: <i>Git desktop</i> does not swear, and the notebook shows an empty <i>pre-commit.log</i> .  PROFIT. <br><br>  You can <a href="https://gist.github.com/ophermit/63129b81585fb5cc432b25089ce40ad0">see the</a> finished example <a href="https://gist.github.com/ophermit/63129b81585fb5cc432b25089ce40ad0">here</a> . <br><br><h3>  [UPD] Instead of conclusion </h3><br>  Of course, this script is not a panacea.  It is useful when all necessary checks are limited to running test scripts locally.  In complex projects, the concept of <a href="https://ru.wikipedia.org/wiki/%25D0%259D%25D0%25B5%25D0%25BF%25D1%2580%25D0%25B5%25D1%2580%25D1%258B%25D0%25B2%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25B8%25D0%25BD%25D1%2582%25D0%25B5%25D0%25B3%25D1%2580%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F">Continuous Integration (or CI)</a> is usually used, and here come to the aid <a href="https://travis-ci.org/">Travis</a> (for Linux and OS X) and its counterpart <a href="http://www.appveyor.com/">AppVeyor</a> (for Windows). <br><br>  <b>[UPD]</b> Another alternative is <a href="https://github.com/brigade/overcommit">overcommit</a> .  A pretty functional tool for managing <i>Git</i> hooks.  But there are nuances - to work <i>overcommit,</i> you need to locally deploy the <i>Ruby</i> interpreter. <br><br>  All nice coding and correct commits. </div><p>Source: <a href="https://habr.com/ru/post/302932/">https://habr.com/ru/post/302932/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../302920/index.html">How to turn landing into profit?</a></li>
<li><a href="../302922/index.html">JS Programming Contest: Word qualifier (about testing)</a></li>
<li><a href="../302924/index.html">Preparing an arbitrary LTE modem for working with a SIM card for a Yota modem using the example of Huawei E3272</a></li>
<li><a href="../302926/index.html">Ways to generate a numeric sequence (data) in MySQL</a></li>
<li><a href="../302930/index.html">We analyze how successful employment and salary depend on the university, specialty and region</a></li>
<li><a href="../302936/index.html">The theory of graphs in the Game of Thrones</a></li>
<li><a href="../302942/index.html">PHP7 Guide</a></li>
<li><a href="../302944/index.html">CleverStyle Framework 4 Release</a></li>
<li><a href="../302946/index.html">Not a single iron: IBM Software Defined Storage</a></li>
<li><a href="../302950/index.html">C # client generation for Wargaming API</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>