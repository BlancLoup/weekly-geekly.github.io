<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We study Adversarial Tactics, Techniques & Common Knowledge (ATT @ CK). Enterprise Tactics. Part 4</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Privilege Escalation 
 Links to all parts: 
 Part 1. Getting Initial Access 
 Part 2. Execution 
 Part 3. Persistence 
 Part 4. Privilege Escalation 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We study Adversarial Tactics, Techniques & Common Knowledge (ATT @ CK). Enterprise Tactics. Part 4</h1><div class="post__text post__text-html js-mediator-article"><h1>  <a href="https://attack.mitre.org/tactics/TA0004/">Privilege Escalation</a> </h1><br>  <b>Links to all parts:</b> <br>  <a href="https://habr.com/post/423405/">Part 1. Getting Initial Access</a> <br>  <a href="https://habr.com/post/424027/">Part 2. Execution</a> <br>  <a href="https://habr.com/post/425177/">Part 3. Persistence</a> <br>  <a href="https://habr.com/post/428602/">Part 4. Privilege Escalation</a> <br>  <a href="https://habr.com/post/432624/">Part 5. Defense Evasion</a> <br>  <a href="https://habr.com/post/433566/">Part 6. Obtaining Credential Access</a> <br>  <a href="https://habr.com/ru/post/436350/">Part 7. Discovery</a> <br>  <a href="https://habr.com/ru/post/439026/">Part 8. Lateral Movement (Lateral Movement)</a> <br><br>  Privilege escalation is the result of actions that allow an attacker or malicious program to obtain a higher level of permissions in the attacked system or network.  Privilege escalation techniques describe the methods by which an adversary, having gained unprivileged access to the system under attack, using various "weaknesses" of the system, can gain local administrative, system or root rights.  The use of user accounts by attackers with access rights to specific systems or permissions to perform certain operations can also be considered an escalation of privileges. <br><a name="habracut"></a><br>  <i>The author is not responsible for the possible consequences of the application of the information contained in the article, and also apologizes for any inaccuracies in some formulations and terms.</i>  <i>The published information is a free recount of the content of <a href="https://attack.mitre.org/wiki/Main_Page">MITER ATT &amp; CK</a> .</i> <br><br>  It is important to cancel that some of the techniques described in the <a href="https://attack.mitre.org/">ATT @ CK</a> matrix are simultaneously included in several stages of the attack chain, for example, interception of a DLL search can be used both to secure access by unauthorized execution of a malicious DLL, and to increase privileges by running a DLL in the process running in the context of a more privileged user. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  <a href="https://attack.mitre.org/wiki/Technique/T1134">Access Token Manipulation Manipulations</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User, Administrator <br>  <i>Description:</i> Attackers can use access tokens (Access Token) to perform their actions in various user or system security contexts, thus avoiding the detection of malicious activity.  An adversary can use the Windows API functions to copy access tokens from existing processes (Token stealing), for this it must be in the context of a privileged user (for example, an administrator).  Theft of access tokens is typically used to elevate privileges from administrator level to System level.  An adversary can also use the account access token to authenticate the remote system if the account has the necessary permissions on the remote system. <br>  Consider several ways to abuse access tokens: <br><ul><li>  Theft and impersonation of tokens.  Token impersonation is the ability of the OS to start threads in a security context other than the context of the process to which this thread belongs.  In other words, impersonating tokens allows you to perform any actions on behalf of another user.  An adversary can create a duplicate access token using the <i>DuplicateTokenEX</i> function and use <i>ImpersonateLoggedOnUser</i> to call the stream in the context of the logged in user or use <i>SetThreadToken</i> to assign an access token to the stream. </li><li>  Creating a process using an access token.  An attacker can create an access token using the <i>DuplicateTokenEX</i> function and then use it with <i>CreateProcessWithTokenW</i> to create a new process running in the context of the impersonated user. </li><li>  Obtaining and impersonating access tokens.  An adversary, having a username and password, can create a login session using the <i>LogonUser</i> API function, which will return a copy of the session access token of a new session, and then use the <i>SetThreadToken function</i> to assign a token to the stream.  Metasploit Meterpreter and CobaltStrike have tools for manipulating access tokens to increase privileges. </li></ul><br>  <i>Protection recommendations:</i> In order to fully use the tactics described above, an attacker must have system administrator rights, so do not forget to limit the privileges of ordinary users.  Any user can trick access tokens if they have valid credentials.  Restrict the ability of users and groups to create access tokens: <br>  <i>GPO: Computer Configuration&gt; [Policies]&gt; Windows Settings&gt; Security Settings&gt; Local Policies&gt; User Rights Assignment: Create a token object</i> <br>  Also determine who can replace local or network service process tokens: <br>  <i>GPO: Computer Configuration&gt; [Policies]&gt; Windows Settings&gt; Security Settings&gt; Local Policies&gt; User Rights Assignment: Replace a process level token</i> <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1015">Modifying the executable files of applications "special features Windows" (Accessibility Features)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator <br>  <i>Description:</i> "special features" applications (screen magnifier, on-screen keyboard, etc.) can be launched using keyboard shortcuts before the user logs into the system.  An attacker can spoof the startup files of these programs or change the way they are launched and open the command console or get a backdoor without logging in. <br><ul><li>  <i>C: \ Windows \ System32 \ sethc.exe</i> - runs 5 times by pressing the Shift key; </li><li>  <i>C: \ Windows \ System32 \ utilman.exe</i> - launched by pressing the Win + U combination. </li></ul><br>  In WinXP and later versions, sethc.exe and utilman.exe can be replaced, for example, with cmd.exe, and later, when you press the necessary cmd.exe key combination, start up before entering Windows with System privileges. <br>  In Vista and later versions, you need to change the registry key that configures cmd.exe or another program as a debugger, for example, for ultiman.exe.  After editing the registry and pressing the desired key combination on the login screen or when connecting to the host via RDP, cmd.exe will execute with System privileges. <br>  There are also Windows programs that can be used when implementing this attack technique: <br><ul><li>  C: \ Windows \ System32 \ osk.exe; </li><li>  C: \ Windows \ System32 \ Magnify.exe; </li><li>  C: \ Windows \ System32 \ Narrator.exe; </li><li>  C: \ Windows \ System32 \ DisplaySwitch.exe; </li><li>  C: \ Windows \ System32 \ AtBroker.exe. </li></ul><br>  <i>Security Recommendations:</i> Configure the launch of the mandatory network authentication of remote users before creating an RDP session and displaying the login screen ( <i>enabled by default in Windows Vista and later versions</i> ).  Use Remote Desktop Gateway to manage connections and RDP security settings. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1182">Key modification AppCert DLLs</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator, System <br>  <i>Description:</i> The DLLs specified in the AppCertDLLs key value are loaded into each process that calls commonly used API functions: <i>CreateProcess, CreateProcessAsUser, CreateProcessWithLoginW, CreateProcessWithTokenW, WinExec</i> .  The value of the AppCertDLLs key can be abused by triggering the loading of a malicious DLL and running certain processes.  AppCertDLLs is stored in the following registry key: <br>  <i>HKEY_LOCAL_MACHINE \ System \ CurrentControlSet \ Control \ Session Manager</i> . <br><br>  <i>Security</i> Tips <i>:</i> Use all sorts of tools to block potentially dangerous software and download unknown DLLs, such as AppLocker and DeviceGuard. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1103">Key modification AppInit DLLs</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator, System <br>  <i>Description: The</i> DLLs specified in the AppInit_DLLs key value are loaded into each process that loads user32.dll.  In practice, this is almost every program. <br>  AppInit_DLLs is stored in the following registry keys: <br><ul><li>  <i>HKEY_LOCAL_MACHINE \ Software \ Microsoft \ Windows NT \ CurrentVersion \ Windows;</i> </li><li>  <i>HKEY_LOCAL_MACHINE \ Software \ Wow6432Node \ Microsoft \ Windows NT \ CurrentVersion \ Windows.</i> </li></ul><br>  The value of the AppInit_DLLs key can be abused to exceed privileges by loading malicious DLLs and running certain processes.  AppInit_DLLs functionality is disabled in Windows 8 and later versions when secure boot is activated. <br><br>  <i>Security Tips:</i> Consider using OS no earlier than Windows 8 and enabling secure boot.  Use all sorts of tools to block potentially dangerous software and download unknown DLL libraries, such as AppLocker and DeviceGuard. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1138">Abuse of Application Compatibility Subsystem (Application Shimming)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator <br>  <i>Description:</i> <i>Microsoft Windows Application Compatibility Infrastructure / Framework is</i> designed to ensure software compatibility with Windows updates and OS code changes.  The compatibility system uses the so-called shim (‚Äúshims‚Äù) - libraries that act as a buffer between the program and the OS.  Using the shim cache, the system determines whether it is necessary to use shim pads (stored in the form of a database of the .sdb type).  The .sdb files store various procedures for intercepting application code, processing it, and further redirecting to the OS.  The list of all shims installed by the installer (sdbinst.exe) is stored by default in: <br><ul><li>  <i>% WINDIR% \ AppPatch \ sysmain.sdb</i> ; </li><li>  <i>HKLM \ Software \ Microsoft \ Windows NT \ CurrentVersion \ AppCompatFlags \ InstalledSDB</i> . </li></ul><br>  Custom shim bases are stored in: <br><ul><li>  <i>% WINDIR% \ AppPatch [64] \ Custom;</i> </li><li>  <i>HKLM \ Software \ Microsoft \ Windows NT \ CurrentVersion \ AppCompatFlags \ Custom</i> . </li></ul><br>  To ensure protection in user mode, the possibility of changing the OS kernel using shim pads is excluded, and administrator rights are required to install them.  However, some shim pads can be used to bypass User Account Control (UAC), DLL injection, disable <a href="">Data Execution Prevention</a> and <a href="https://docs.microsoft.com/ru-ru/windows/desktop/Debug/structured-exception-handling">Srtucture Exception Handling</a> , as well as intercept memory addresses.  The use of shim-pads by an attacker allows you to elevate privileges, install backdoors, disable OS protection, such as Windows Defender. <br><br>  Security Tips <i>:</i> There are not many ways to prevent Application shiming.  Disabling application compatibility is not recommended to avoid OS stability issues.  Microsoft has released <a href="https://www.microsoft.com/ru-ru/download/details.aspx%3Fid%3D46804">KB3045645</a> , which will remove the "auto-elevate" flag in the sdbinst.exe file to prevent the use of a shim system to bypass UAC. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1088">Bypass User Account Control</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User, Administrator <br>  <i>Description:</i> There are many ways to circumvent UAC, the most common of which are implemented in the <a href="https://github.com/hfiref0x/UACME">UACMe</a> project.  New ways of circumventing UAC are regularly detected, similar to the abuse of the <a href="https://www.fortinet.com/blog/threat-research/malicious-macro-bypasses-uac-to-elevate-privilege-for-fareit-malware.html">eventvwr.exe</a> system application, which can execute a binary file or script with elevated privileges.  Malicious programs can also be embedded in trusted processes, with which UAC allows privilege escalation without prompting the user. <br>  To bypass UAC using eventvwr.exe in the Windows registry, the key is modified: <br>  <i>[HKEY_CURRENT_USER] \ Software \ Classes \ mscfile \ shell \ open \ command</i> . <br>  To bypass UAC using sdclt.exe, the keys in the Windows registry are modified: <br>  <i>[HKEY_CURRENT_USER] \ Software \ Microsoft \ Windows \ CurrentVersion \ App Paths \ control.exe;</i> <i><br></i>  <i>[HKEY_CURRENT_USER] \ Software \ Classes \ exefile \ shell \ runas \ command \ isolatedCommand.</i> <br><br>  <i>Security</i> Tips <i>:</i> Remove users from the local Administrators group on the protected systems.  If possible, enable the highest level of protection in the UAC settings. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1038">DLL search interception (DLL Search Order Hijacking)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User, Administrator, System <br>  <i>Description: The</i> technique is to exploit the vulnerabilities of the application's search algorithm for the DLL files they need to work ( <a href="https://technet.microsoft.com/ru-ru/library/security/2269637.aspx">MSA2269637</a> ).  Often, the DLL search directory is the working directory of the program, so attackers can replace the original DLL with a malicious one with the same file name. <br>  Remote attacks on DLL search can be carried out when the program installs its current directory in a remote directory, for example, a network share.  Also, attackers can directly change the way the DLL is searched and loaded by replacing the .manifest or .local files that describe the DLL search parameters.  If the attacked program works with high privileges, then the malicious DLL loaded by it will also be executed with high rights.  In this case, the technique can be used to elevate privileges from the user to the administrator or System. <br><br>  Security Tips: Disable remote boot DLL (enabled by default in Windows Server 2012+ and is available with updates for XP + and Server 2003+).  Enable the secure search mode of the DLL, which will limit the search directories to directories such as <i>% SYSTEMROOT%</i> before performing a DLL search in the current application directory. <br>  Enable Secure Search DLL: <br>  <i>Computer Configuration&gt; [Policies]&gt; Administrative Templates&gt; MSS (Legacy): MSS: (SafeDllSearchMode) Enable Safe DLL search mode.</i> <br>  Corresponding registry key: <br>  <i>HKLM \ SYSTEM \ CurrentControlSet \ Control \ Session Manager \ SafeDLLSearchMode.</i> <br><br>  Consider the feasibility of auditing the protected system to eliminate DLL weaknesses using tools such as the PowerUP module in PowerSploit.  Do not forget about blocking malicious and potentially dangerous software, as well as the implementation of <a href="https://docs.microsoft.com/ru-ru/windows/desktop/Dlls/dynamic-link-library-security">Microsoft recommendations</a> . <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1157">Dylib Hijacking interception</a> </h3><br>  <i>System:</i> macOS <br>  <i>Rights:</i> User <br>  Description: The technique is based on the <a href="https://s3.amazonaws.com/s3.synack.com/canSecW.pdf">vulnerabilities of dylib dynamic library search algorithms on macOS and OS X.</a>  The bottom line is the definition of dylib, which loads the attacked application and the subsequent placement of the malicious version of dylib with the same name in the working directory of the application.  This will cause the dylib application to load, which is located in the working directory of the program.  In this case, the malicious Dylib will be executed with the access rights of the attacked application. <br><br>  Security Tips <i>:</i> Prevent users from writing files to dylib search directories.  Vulnerability <a href="https://objective-see.com/products/dhs.html">auditing</a> with Objective-See <a href="https://objective-see.com/products/dhs.html">Dylib Hijacking Scanner</a> . <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1068">Exploitation for Privilege Escalation</a> </h3><br>  <i>System:</i> Windows, Linux, macOS <br>  <i>Rights:</i> User <br>  <i>Description:</i> Opponents can elevate privileges in the attacked system by exploiting software vulnerabilities. <br><br>  <i>Protection recommendations:</i> Regular software updates on all protected workstations, servers, network equipment and other devices connected to the protected network.  Analyze the types of threats, vulnerabilities, and exploits that can be used against the protected organization.  It is also recommended to use systems for protection against exploits, for example, <a href="https://docs.microsoft.com/ru-ru/windows/security/threat-protection/windows-defender-exploit-guard/windows-defender-exploit-guard">Windows Defender Exploit Guard (WDEG)</a> for Windows 10 or <a href="https://support.microsoft.com/ru-ru/help/2458544/the-enhanced-mitigation-experience-toolkit">Enhanced Mitigation Experience</a> <a href="https://docs.microsoft.com/ru-ru/windows/security/threat-protection/windows-defender-exploit-guard/windows-defender-exploit-guard">Tool Tool</a> <a href="https://support.microsoft.com/ru-ru/help/2458544/the-enhanced-mitigation-experience-toolkit">(EMET)</a> for earlier versions of Windows. <br><br>  h3 <a href="https://attack.mitre.org/wiki/Technique/T1181">EWM injection (Extra Window Memory Injection)</a> <br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator, System <br>  <i>Description: The</i> technique is the abuse of additional Windows memory, the so-called Extra Window Memory (EWM).  The EWM size is 40 bytes, suitable for storing a 32-bit pointer, and is often used to refer to procedures.  Malicious programs during the attack chain can place a pointer to malicious code in EWM, which will then be launched by the process of an infected application. <br><br>  <i>Protection recommendations:</i> Considering that EWM injection techniques are based on the misuse of OS development features, protection efforts should be directed at preventing the launch of malicious programs and malicious tools.  It is good practice to identify and block potentially dangerous software using AppLocker, organizing a white list of applications, or applying Software Restriction Policies software restriction policies. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1044">Lack of permissions at the file system level (File System Permissions Weakness)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User, Administrator <br>  <i>Description:</i> The essence of the technique lies in the substitution of executable files that are automatically launched by various processes (for example, when the OS boots up or at a certain time, if the rights to executable files are configured incorrectly).  After the substitution, the malicious file will be launched with the rights of the process, so if the process has a higher level of access, the attacker will be able to escalate the privileges.  As part of this technique, attackers may attempt to manipulate the binary files of Windows services. <br>  Another type of attack is associated with deficiencies in the algorithms of self-extracting installers.  During the installation process, installers often unpack various useful files, including .dll and .exe, into the% TEMP% directory, and they may not set the appropriate permissions to restrict access to the unpacked files, which allows attackers to swap files and as a result, increase privileges or bypass account control, because  Some installers are run with extended permissions. <br><br>  <i>Security Tips:</i> Restricting account rights so that only administrators can manage services and interact with the binary files used by the services.  Disabling elevation of privileges for standard users in UAC.  UAC settings are stored in the following registry key: <br><ul><li>  <i>[HKEY_LOCAL_MACHINE \ SOFTWARE \ Microsoft \ Windows \ CurrentVersion \ Policies \ System]</i> . </li></ul><br>  To automatically reject requests for elevation of privileges, you need to add a key: <br><ul><li>  <i>"ConsentPromptBehaviorUser" = dword: 00000000.</i> </li></ul><br>  To control the work of installers, you need to add a key: <br><ul><li>  <i>"EnableInstallerDetection" = dword: 00000001</i> , which will require you to enter a password to install programs. </li></ul><br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1179">Interception of Windows API function calls (Hooking)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator, System <br>  <i>Description:</i> Windows API functions are usually stored in DLLs.  The hooking technique is to redirect calls to API functions through: <br><ul><li>  Hook-procedures - built-in OS procedures that execute code when calling various events, for example, pressing keys or moving a mouse; </li><li>  Modifications of the address table (IAT), in which the pointers to the API functions are stored.  This will allow to ‚Äúdeceive‚Äù the attacked application by forcing it to launch the malicious function; </li><li>  Directly changing the function (splicing), during which the first 5 bytes of the function are changed, instead of which the transition to a malicious or other function defined by the attacker is inserted. </li></ul><br>  Like injections, attackers can use hooking to execute malicious code, disguise its execution, access the memory of the attacked process, and elevate privileges.  Attackers can capture API calls that include parameters containing authentication data.  Hooking is usually used by rootkits to hide malicious activity in the system. <br><br>  <i>Protection recommendations:</i> Interception of events in the OS is part of the normal operation of the system, so any restriction of this functionality may adversely affect the stability of legitimate applications, such as antivirus software.  Efforts to prevent interception techniques need to be focused on the earlier stages of the attack chain.  You can detect malicious hooking activity by monitoring calls to the SetWindowsHookEx and SetWinEventHook functions, using rootkit detectors, analyzing anomalous process behavior. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1183">IFEO injection (Image File Execution Options Injection)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator, System <br>  <i>Description:</i> The Image File Execution Options (IFEO) mechanism allows you to run, instead of a program, its debugger, previously specified by the developer in the registry: <br><ul><li>  <i>HKLM \ Software \ Microsoft \ Windows NT \ CurrentVersion \ Image File Execution Options / [executable]</i> </li><li>  <i>HKLM \ SOFTWARE \ Wow6432Node \ Microsoft \ Windows NT \ CurrentVersion \ Image File Execution Options \ [executable]</i> , where <i>[executable]</i> is the executable binary file of the debugger. </li></ul><br>  Like injections, the value of <i>[executable]</i> can be abused by running arbitrary code to elevate privileges or gain a foothold in the system.  Malicious programs can use IFEO to bypass protection by registering debuggers that redirect and reject various system and security applications. <br><br>  <i>Protection recommendations: The</i> described technique is based on the abuse of standard OS development tools, so any restrictions may cause instability in the operation of legitimate software, for example, security applications.  Efforts to prevent the use of IFEO injections need to be focused on earlier stages of the attack chain.  You can detect such an attack by monitoring processes with the flags <i>Debug_process</i> and <i>Debug_only_this_process</i> . <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1160">Launch Daemon</a> &gt; </h3><br>  <i>System:</i> macOS <br>  <i>Rights:</i> Administrator <br>  <i>Description: The</i> technique involves the attacker changing the parameters of the services of the system launch level - Launch Daemon, specified in the plist files.  When booting the system, the Launchd process loads the parameters of services (daemons) from plist files located in the following directories: <br><ul><li>  / System / Library / LaunchDeamons; </li><li>  / Library / LaunchDeamons. </li></ul><br>  Launch Daemon can be created with administrator privileges, but will run under the root account, so an attacker can implement privilege escalation.  The permissions of the plist files must be root: while, however, the script or program specified in it may have less strict permissions.  Therefore, an attacker can modify the executable files specified in the plist and, thus, modify the current system services to be fixed in the system or escalation of privileges. <br><br>  <i>Security</i> Tips <i>:</i> Limit user privileges so that only authorized administrators can create a Launch Daemon.  Consider monitoring the creation of plist files on your system using applications such as KnockKnock. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1050">New Services (New Service)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator, System <br>  <i>Description:</i> Name access to the system, attackers can create new services and configure their automatic start.  The service name can be masked using names specific to the operating system.  Services can be created with administrator privileges, but run as System.  Services can be created from the command line, using remote access tools with interaction functions with the Windows API or using standard Windows management tools and PowerShell. <br><br>  <i>Security</i> Tips <i>:</i> Restrict the rights of users to create new services so that only authorized administrators can do this.  Use AppLocker and <a href="https://technet.microsoft.com/en-us/library/2008.06.srp.aspx">Software Restriction Policy</a> . <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1034">Path Interception</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User, administrator, system <br>  <i>Description: The</i> technique of intercepting a path consists of placing the executable file in a directory from which the application will launch it instead of the target file.  The attacker can use the following methods: <br><ul><li>  Non-existent ways.  The paths to the service executable files are stored in registry keys and can have one or more spaces, for example, <i>C: \ Program Files \ service.exe</i> , if the attacker creates the file <i>C: \ Program.exe</i> in the system, then Windows will start it instead of processing the path target service file. </li><li>  Incorrect configuration of environment variables.  If in the PATH variable the path <i>C: \ example is</i> preceded by <i>c: \ Windows \ System32</i> and the file <i>C: \ example \ net.exe exists</i> , then when you call the net command, <i>C: \ example \ net.exe</i> will be executed, not <i>C: \ Windows \ System32 \ net.exe</i> . </li><li>  Search order hijacking.  When the full path to the executable file is not specified, Windows typically searches for a file with the specified name in the current directory, then searches the system directories.  For example, the file "example.exe" when executed runs cmd.exe with arguments to run the net use command.  The attacker can place the net.exe file in the location of the example.exe directory and it will be launched instead of the <i>c: \ Windows \ System32 \ net.exe utility</i> .  In addition, if the attacker places the net.com file in the directory with the net.exe file, Windows will execute net.com in accordance with the order of execution specified in the PATHEXT system variable. </li></ul><br>  <i>The interception of the file search order is also used to execute a DLL using the <a href="https://attack.mitre.org/wiki/Technique/T1038">Search Hijacking DLL</a> technique.</i> <br><br>  <i>Security Tips:</i> Highlight the paths specified in the configuration files, scripts, PATH variable, service settings and shortcuts.  Remember to search for executable files and use only full paths.  Clean up the old registry keys left over from the remote software so that there are no keys in the registry pointing to non-existent files.  Set a ban on users to write to the root directory of C: \ and Windows system directories, restrict write permissions to directories with executable files. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1150">Modifying Plist Files (Plist Modification)</a> </h3><br>  <i>System:</i> macOS <br>  <i>Rights:</i> User, Administrator <br>  <i>Description:</i> Criminals can modify plist files by specifying their own code in them to execute it in the context of another user.  The plist properties files located in <i>/ Library / Preferences</i> run with elevated privileges, and plist from <i>~ / Library / Preferences</i> run with user privileges. <br><br>  Security Tips <i>:</i> Prevent plist files from being modified by making them read-only. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1013">Port Monitors modification in Print Manager (Port Monitors)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator, System <br>  <i>Description: An</i> attacker can organize the execution of an arbitrary DLL on behalf of the System every time Windows boots up using the misuse of the Print Manager settings (Spoolsv.exe).  To interact with printing devices, Spoolsv.exe uses the so-called port monitors (port monitor), which are DLLs with which low-level commands are sent to printing devices via LAN, USB, LPT, or COM interfaces.  The above DLLs are stored in <i>C: \ windows \ system32</i> and are registered in the registry: <br>  <i>HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Control \ Print \ Monitors</i> . <br>  Port Monitor can be installed using the AddMonitor API function or directly by editing the above registry key. <br><br>  <i>Protection recommendations:</i> Arrange blocking of potentially dangerous software and use application launch control tools. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1055">Code Injection into Process (Process Injection),</a> <a href="https://www.endgame.com/blog/technical-blog/ten-process-injection-techniques-technical-survey-common-and-trending-process">Ten Process Injection Techniques</a> </h3><br>  <i>System:</i> Windows, Linux, macOS <br>  <i>Rights:</i> User, administrator, system, root <br>  <i>Description:</i> Process injection is a method for executing an arbitrary code in the address space of a separate living process.  Running code in the context of another process allows access to the memory of the injectable process, system / network resources, and possibly elevated privileges.  Process injections can also be used to avoid possible detection of malicious activity by security tools.  Techniques for implementing injections into processes are based on the abuse of various mechanisms that ensure the multithreading of program execution in the OS.  The following are some approaches to performing code injection into the process. <br><br>  <b>Windows</b> <br>  ‚Ä¢ DLL injection.  They are performed by recording the path to the malicious DLL inside the process with its subsequent execution by creating a remote thread (Remote thread is a thread that operates in the virtual address space of another process).  In other words, the malware writes the DLL to the disk, and then uses a function like CreateRemoteTread, with which the LoadLibrary function will be called in the injectable process. <br>  ‚Ä¢ PE injections (Portable executable injection) are based on the abuse of the execution features in memory of PE files, such as DLL or EXE.  Malicious code is written to the process without writing any files to disk, and then using its additional code or by creating a remote stream, its execution is called. <br>  ‚Ä¢ Thread execution hijacking includes injection of malicious code or a path to a DLL directly into the process stream.  Like the Process Hollowing technique, the flow must first be suspended. <br>  ‚Ä¢ Injections into asynchronous call procedures (Asynchronous Procedure Call (APC) injection) involve the attachment of malicious code to an APC Queue (APC Queue) process flow.  One of the APC injection methods, called ‚ÄúEarle Bird injection‚Äù, involves creating a suspended process in which malicious code can be recorded and launched to the process entry point via APC.  AtomBombing is another injection option that uses APC to invoke malicious code previously recorded in the Global atom table. <br>  ‚Ä¢ Injections into the local storage of the stream (Thread Local Storage (TLS) injection) involve manipulating the memory pointers inside the executable PE file to redirect the process to the malicious code. <br><br>  <b>Mac and Linux</b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Ä¢ The system variables LD_RPELOAD, LD_LIBRARY_PATH (Linux), DYLIB_INSERT_LIBRARIES (macOS X) or the dlfcn application programming interface (API) can be used to dynamically load a library (shared object) into a process, which in turn can be used to intercept API calls from running processes. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Ä¢ The Ptrace system call can be used to connect to a running process and change while it is running. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Ä¢ / proc / [pid] / mem provides access to the process memory and can be used to read / write arbitrary data, but this method is rarely used due to the complexity of its implementation.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Ä¢ Capturing a VDSO (Virtual dynamic shared object) allows you to inject code during the execution of ELF binaries by manipulating code plugs from linux-vdso.so. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Malicious programs typically use code injection into the process to access system resources, due to which an attacker can gain a foothold in the system and perform other changes in the attacked environment. More complex samples can perform multiple injections of processes to make their detection more difficult. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protection recommendations:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Methods of injecting code into processes are based on the abuse of regular functions of the OS, direct effects on which can lead to unstable operation of legitimate software and security products. </font><font style="vertical-align: inherit;">Efforts to prevent interception techniques need to be focused on the earlier stages of the attack chain. </font><font style="vertical-align: inherit;">Use tools to block potentially dangerous software, such as AppLocker. </font><font style="vertical-align: inherit;">Use Yama as a preventive measure against code injection in ptrace, limiting the use of ptrace to privileged users only. </font><font style="vertical-align: inherit;">Additional security measures may include the deployment of kernel security modules that provide advanced access control and process restriction. </font><font style="vertical-align: inherit;">These tools include SELinux, grsecurity, AppArmor.</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1178"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Injections in SID-history (SID-History Injection)</font></font></a> </h3><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Windows </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Permissions:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Administrator, system </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Whenever an object moves from one domain to another, a new SID is created, which becomes the primary objectSID. The previous SIDs continue to be stored in the sIDHistory property, thus ensuring the preservation of the rights that the object had before the inter-domain migration. Attackers, with administrative rights, can insert previously collected SIDs into SID-History to perform an action on behalf of more privileged access groups or accounts, such as domain administrators. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protection recommendations:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In Windows Server 2003 and later, SID Filtering is enabled by default, which involves deleting or filtering all SIDs other than the trusted domain, but this option can be intentionally disabled to allow cross-domain access. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The main methods of SID filtering are: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Ä¢ Disabling SIDHistory in the trust settings (trusts) between domain forests using the command: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netdom trust / domain: / EnableSIDHistory: no</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Ä¢ Apply </font></font><a href="https://msdn.microsoft.com/en-us/windows/desktop/cc755427"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SID Filter Quarantining</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . This ensures that an object containing a SID other than the trusted domain cannot authenticate to the trusting domain. SID Filter Quarantining is used for external trusts by running the command:</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netdom trust / domain: / quarantine: yes</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Using SID Filtering between domains of the same forest is not recommended. </font><font style="vertical-align: inherit;">If a domain in a forest is unreliable, then it should not be a member of the forest; in such a situation, you must first divide trusted and unreliable domains into separate forests, and then apply SID Filtering for trusts between forests.</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1053"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scheduled Task</font></font></a> </h3><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Windows </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Permissions:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> User, Administrator, System </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Utilities such as at, schtasks and Windows Task Scheduler can be used to schedule the launch of programs and scripts that will be executed at a specific date and time. The task can be scheduled on the remote system, provided that RPC is used for authentication, and printer and file sharing is enabled. Scheduling tasks on a remote system requires administrative rights. An attacker can use remote code execution to gain System privileges or to launch a process under a specific account. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protection recommendations:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Restriction of user privileges. </font><font style="vertical-align: inherit;">The use of tools, such as the PowerUP module in PowerSploit, which can be used to find weaknesses in the permissions of scheduled tasks. </font><font style="vertical-align: inherit;">Disable the ability to launch tasks on behalf of System, disable the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Allow server operators to schedule tasks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> option in the security policy </font><font style="vertical-align: inherit;">, and enable the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">User Rights Assignment: Increase scheduling priority</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> option </font><font style="vertical-align: inherit;">.</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1058"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Service Registry Permissions Weakness Weakness</font></font></a> </h3><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Windows </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Permissions:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Administrator, System </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> If user and group permissions allow you to change key values ‚Äã‚Äãin the Windows registry that store service settings, then attackers can directly modify the keys that store the paths to the service startup executable files or use various management tools services - sc.exe, PowerShell or Reg. Attackers can also change the parameters associated with the failure of services, for example, FailureCommand, indicating the command that will be executed in case of failure or deliberate damage to the service. Service settings are stored in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ services</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protection recommendations:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Make sure that the users of the protected system cannot change the registry keys that store the parameters of the system components. </font><font style="vertical-align: inherit;">Use various means of blocking potentially dangerous software, for example, Windows AppLocker.</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1166"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setuid and Setgid</font></font></a> </h3><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Linux, macOS </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Permissions:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> User </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setuid and Setgid are flags of access rights in Unix-systems that allow the user to run executable files with the rights of the owner or group of the executable file. If the application needs to be run as root, then instead of creating an entry in the sudo file, the user can specify the Setuid or Setgid flag. Opponents can abuse the Setuid and Setgid flags to execute shell escape (reception, when in an console mode any application uses a file opened in another application) or to take advantage of an application vulnerability with the Setuid and Setgid flags and execute code in the context of various users. When viewing file attributes with the ls -l command, the flags described above are indicated by the symbol ‚Äús‚Äù instead of ‚Äúx‚Äù. The chmod utility can set the Setuid and Setgid flags using the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chmod 4777 command [file]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chmod u + s [file]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protection recommendations:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Keep the number of programs with the Setuid and Setgid flags to a minimum.</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1165"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Startup Items</font></font></a> </h3><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> macOS </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Permissions:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Administrator </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description: An</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> attacker can use an outdated, but still working in macOS Sierra, application autorun engine using StartupItems to customize the launch of its code as root during the OS boot. </font><font style="vertical-align: inherit;">StartupItems is the directory in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ Library / Startupitems</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , the command script and the StartupParameters.plist properties file. </font><font style="vertical-align: inherit;">The script and the properties file should be at the top of the hierarchy: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ Library / Startupitems / [MyStartupItem]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Security</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tips </font><i><font style="vertical-align: inherit;">:</font></i><font style="vertical-align: inherit;"> Since the StartupItems mechanism is outdated, prohibiting entries in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ Library / Startupitems / directory</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> will prevent the creation of startup items.</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1169"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sudo</font></font></a> </h3><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Linux, macOS </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Privileges:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> User </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Opponents can use the sudo configuration flaws to execute commands on behalf of other users or spawn processes with higher privileges. Sudo settings are stored in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ etc / sudoers</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file, elevated privileges are required to edit this file. The sudoers file describes which commands users can run on behalf of other users or groups, this allows users to work most of the time with minimal privileges and only when necessary, increase privileges. However, in the sudoers file, you can specify users for whom a password will not be requested: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">username ALL = (ALL) NOPASSWD: ALL</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Security</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tips </font><i><font style="vertical-align: inherit;">:</font></i><font style="vertical-align: inherit;"> The sudoers file must be edited so that users always enter a password when running sudo. </font><font style="vertical-align: inherit;">Linux Auditd can generate a warning whenever a real and effective user ID does not match (this happens when the user uses sudo).</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1206"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sudo caching</font></font></a> </h3><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Linux, macOS </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Permissions:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> User </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Various malware, such as </font></font><a href="https://www.cybereason.com/blog/labs-proton-b-what-this-mac-malware-actually-does"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OCX Proton Malware</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , can abuse the sudo settings to execute code as root without entering a password. Since the sudo toolkit was created for system administration, it has some useful features such as </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">timestamp_timeout</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - this parameter stores the amount of time in minutes between running sudo during which the command will not prompt for the root password. Sudo has the ability to cache credentials for some time. The timestamp for the last sudo run is stored in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ var / db / sudo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and serves to determine the specified timeout. </font><font style="vertical-align: inherit;">In addition, there is the variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tty_tickets</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which processes each new terminal session in isolation, so a timeout in one console instance will not affect the timeout in another instance. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Security Tips:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Set the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">timestamp_timeout = 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parameter </font><font style="vertical-align: inherit;">so that the system requires the root password to be entered each time sudo is executed. </font><font style="vertical-align: inherit;">Enable the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tty_tickets</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parameter </font><font style="vertical-align: inherit;">to prevent the ability to </font><i><font style="vertical-align: inherit;">launch</font></i><font style="vertical-align: inherit;"> an attack through the command console sessions.</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1078"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valid accounts</font></font></a> </h3><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Attackers can steal credentials of a particular user or service account using access credentials technician, capture credentials in the process of exploration using social engineering. Compromised credentials can be used to bypass access control systems and gain access to remote systems and external services such as VPN, OWA, remote desktop, or gain elevated privileges in certain systems and network areas. If the script is successfully implemented, attackers can abandon malicious programs to make their detection more difficult. Also, attackers can create accounts using predefined names and passwords to save backup access in case of unsuccessful attempts to use other means.</font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Security Recommendations:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Apply password policy, follow recommendations for designing and administering a corporate network to limit the use of privileged accounts at all administrative levels. </font><font style="vertical-align: inherit;">Regular checks of domain and local accounts and their rights in order to identify those that may allow an attacker to gain broad access. </font><font style="vertical-align: inherit;">Monitoring account activity using SIEM systems.</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1100"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Web shell</font></font></a> </h3><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Windows, Linux, macOS </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description: The</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Web Shell can be used by an attacker as an access gateway to your network or redundant access to the system being attacked, as a backup mechanism of attachment in case of detection and blocking of the main access channels to the attacked environment. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protection recommendations:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Make sure that your external web servers are updated regularly and do not have known vulnerabilities that allow attackers to upload a file or script to the server and then execute it. </font><font style="vertical-align: inherit;">Check that the permissions of the accounts and groups with server management rights do not match the internal network accounts that can be used to log on to the web server, launch the web shell, or pin to the web server. </font><font style="vertical-align: inherit;">Web Shell is hard to detect because </font><font style="vertical-align: inherit;">they do not initiate connections and their server part may be small and harmless, for example, the PHP version of the China Chopper Web shell looks like a line: </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[? php </font></font><a href="https://habr.com/ru/users/eval/" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eval</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ($ _POST ['password']);]</font></font></i> </div><p>Source: <a href="https://habr.com/ru/post/428602/">https://habr.com/ru/post/428602/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../428590/index.html">Micro-interactions and micro-prompts in the interface</a></li>
<li><a href="../428592/index.html">Stop hiring "effective managers." They are not only useless, but also harmful</a></li>
<li><a href="../428596/index.html">Ilon Mask fired Starlink satellite Internet project managers due to non-compliance with deadlines</a></li>
<li><a href="../428598/index.html">Deep neural networks for automatic call evaluation</a></li>
<li><a href="../428600/index.html">SSD with special effects or something that was missing for modding - HyperX FURY RGB drive overview</a></li>
<li><a href="../428604/index.html">Online Data Science Championship</a></li>
<li><a href="../428606/index.html">‚ÄúUnderstanding how the system works allowed us to hack a lot‚Äù: Roy Beniosef about Android development</a></li>
<li><a href="../428608/index.html">Media holdings agreed with Yandex about the removal of pirated materials</a></li>
<li><a href="../428610/index.html">Timeout paradox, or why is my bus always late?</a></li>
<li><a href="../428612/index.html">Higher order functions in javascript: what is it?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>