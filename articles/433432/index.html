<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ten things you can do with GraalVM</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="From the translator: GraalVM is a new, interesting technology, but on Habr√© there are not many articles on it that could show examples of the features...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ten things you can do with GraalVM</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/7z/5d/ap/7z5dap05rvptsue50u6ajtsxsmw.png"><br>  <em>From the translator: GraalVM is a new, interesting technology, but on Habr√© there are not many articles on it that could show examples of the features of Graal.</em>  <em>The article below is not just a listing of what GraalVM can do, but also a small workshop similar to the one that Chris Seaton and Oleg Shelayev performed on Oracle CodeOne 2018. Following the author, I urge you - try to make examples from the article, this is really interesting.</em> </p><br><p>  <a href="https://www.graalvm.org/">GraalVM has a</a> lot of different things, and if you have heard this name before, or even seen reports, there are still a lot of things that you probably don‚Äôt know yet, but which GraalVM can do.  In this article we will look at the various possibilities that GraalVM provides and show what can be done with their help. </p><br><ol><li>  Fast java execution </li><li>  Reduced start time and memory consumption for Java </li><li>  Combining JavaScript, Java, Ruby and R </li><li>  Execution of programs written in platform-specific languages </li><li>  Common tools for all programming languages </li><li>  JVM application extension </li><li>  Platform-specific application add-on </li><li>  Java code as a platform-dependent library </li><li>  Support for multiple programming languages ‚Äã‚Äãin the database </li><li>  Creating programming languages ‚Äã‚Äãfor GraalVM </li></ol><a name="habracut"></a><br><p>  You can do everything that is shown in this article using GraalVM 1.0.0 RC1, which is available at the link <a href="http://graalvm.org/downloads">from the GraalVM website</a> .  I used the Enterprise Edition on MacOS, but the code that is written here will work on Linux and on GraalVM Community Edition. </p><br><p>  When you read the article, run the programs that are described in it!  The code can be downloaded from <a href="http://github.com/chrisseaton/graalvm-ten-things/">GitHub</a> . </p><br><h2 id="ustanovka">  Installation </h2><br><p> After downloading from <a href="http://graalvm.org/downloads">http://graalvm.org/downloads,</a> I added the path to the GraalVM executables in <code>$PATH</code> .  By default, this adds support for running Java and JavaScript. </p><br><pre> <code class="plaintext hljs">$ git clone https://github.com/chrisseaton/graalvm-ten-things.git $ cd foo $ tar -zxf graalvm-ee-1.0.0-rc1-macos-amd64.tar.gz # or graalvm-ee-1.0.0-rc1-linux-amd64.tar.gz on Linux $ export PATH=graalvm-1.0.0-rc1/Contents/Home/bin:$PATH # or PATH=graalvm-1.0.0-rc1/bin:$PATH on Linux</code> </pre> <br><p>  GraalVM comes with built-in support for JavaScript and contains a package manager called <code>gu</code> , which adds the ability to install support for languages ‚Äã‚Äãother than Java and JavaScript.  I additionally installed Ruby, Python and R, they are downloaded from GitHub. </p><br><pre> <code class="plaintext hljs">$ gu install -c org.graalvm.ruby $ gu install -c org.graalvm.python $ gu install -c org.graalvm.R</code> </pre> <br><p>  Now, if you run the <code>java</code> or <code>js</code> command, you will see the GraalVM versions of these engines. </p><br><pre> <code class="plaintext hljs">$ java -version java version "1.8.0_161" Java(TM) SE Runtime Environment (build 1.8.0_161-b12) GraalVM 1.0.0-rc1 (build 25.71-b01-internal-jvmci-0.42, mixed mode) $ js --version Graal JavaScript 1.0 (GraalVM 1.0.0-rc1)</code> </pre> <br><h2 id="1-bystroe-vypolnenie-java">  1. Fast java execution </h2><br><p>  ‚ÄúGraal‚Äù in GraalVM is the name of the compiler.  <a href="http://lafo.ssw.uni-linz.ac.at/papers/2013_Onward_OneVMToRuleThemAll.pdf">He alone is created to rule by all</a> !  This means that this is a single compiler implementation written in the form of a library that can be used for a large number of different things.  For example, we use Graal to compile both <em>ahead-of-time</em> and <em>just-in-time</em> to compile code written in various programming languages, including for different processor architectures. </p><br><p>  The first and easiest way to use Graal is to use it as a Java JIT compiler. </p><br><p>  As an example, we will use a program that gives out 10 of the most frequently encountered words in a document.  The program uses the capabilities of the modern Java language, such as Streams and collections. </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.IOException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.nio.file.Files; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.nio.file.Paths; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Arrays; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.function.Function; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.stream.Collectors; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.stream.Stream; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TopTen</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ Arrays.stream(args) .flatMap(TopTen::fileLines) .flatMap(line -&gt; Arrays.stream(line.split(<span class="hljs-string"><span class="hljs-string">"\\b"</span></span>))) .map(word -&gt; word.replaceAll(<span class="hljs-string"><span class="hljs-string">"[^a-zA-Z]"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)) .filter(word -&gt; word.length() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) .map(word -&gt; word.toLowerCase()) .collect(Collectors.groupingBy(Function.identity(), Collectors.counting())) .entrySet().stream() .sorted((a, b) -&gt; -a.getValue().compareTo(b.getValue())) .limit(<span class="hljs-number"><span class="hljs-number">10</span></span>) .forEach(e -&gt; System.out.format(<span class="hljs-string"><span class="hljs-string">"%s = %d%n"</span></span>, e.getKey(), e.getValue())); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Stream&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fileLines</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String path)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Files.lines(Paths.get(path)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(e); } } }</code> </pre> <br><p>  GraalVM includes the <code>javac</code> compiler, but for this demo there is no difference, use it or the standard compiler.  Therefore, you can use the standard <code>javac</code> compiler if you want. </p><br><pre> <code class="plaintext hljs">$ javac TopTen.java</code> </pre> <br><p>  If we run the <code>java</code> command, which is included in GraalVM, then the Graal JIT compiler will be used automatically - no need to take any additional steps.  I will use the <code>time</code> command in order to get real data about the time that was spent on executing the program from beginning to end, instead of deploying a complex microbenchmark.  There will also be used a large amount of input data so that there are no insinuations about the saved couple of seconds here or there.  File <code>large.txt</code> - 150 MB. </p><br><pre> <code class="plaintext hljs">$ make large.txt $ time java TopTen large.txt sed = 502701 ut = 392657 in = 377651 et = 352641 id = 317627 eu = 317627 eget = 302621 vel = 300120 a = 287615 sit = 282613 real 0m17.367s user 0m32.355s sys 0m1.456s</code> </pre> <br><p>  Graal is written in Java, not C ++, like most other JIT compilers for Java.  We think that this allows us to improve it faster than existing compilers, complementing new powerful optimizations (such as partial escape analysis, for example) that are not available in the standard JIT compiler for HotSpot. <br>  And it can make your java programs much faster. </p><br><p>  For comparison purposes, in order to run programs without the Graal JIT compiler, I will use the <code>-XX:-UseJVMCICompiler</code> .  JVMCI is the interface between Graal and JVM.  You can also run an example on a standard JVM and compare the results. </p><br><pre> <code class="plaintext hljs">$ time java -XX:-UseJVMCICompiler TopTen large.txt sed = 502701 ut = 392657 in = 377651 et = 352641 id = 317627 eu = 317627 eget = 302621 vel = 300120 a = 287615 sit = 282613 real 0m23.511s user 0m24.293s sys 0m0.579s</code> </pre> <br><p>  This test shows that Graal runs our Java program in about three-quarters of the time it takes to run it with a standard HotSpot compiler.  Where we believe that a few percent improvement in productivity is a significant achievement, 25% is a big deal. </p><br><p>  Twitter is the only company that <a href="https://www.youtube.com/watch%3Fv%3DOSyvidFXL7M">currently uses Graal on ‚Äúcombat‚Äù servers</a> , and they say that this is justified for them, in terms of saving real money.  Twitter uses Graal to execute applications written in Scala - Graal runs at the JVM bytecode level, i.e.  applicable to any JVM language. </p><br><p>  This is the first use of GraalVM ‚Äî simply replacing the JIT compiler with a better version for your existing Java applications. </p><br><h2 id="2-umenshenie-vremeni-starta-i-potrebleniya-pamyati-dlya-java">  2. Reduce start time and memory consumption for Java </h2><br><p>  The strengths of the Java platform are particularly evident when dealing with long-running processes and peak loads.  In contrast, short-lived processes suffer from a long start-up time and relatively large memory usage. </p><br><p>  For example, if we run the application from the previous section, submitting to it a much smaller amount of input data ‚Äî about 1 KB instead of 150 MB ‚Äî then it seems to take an unreasonably long time and quite a lot of memory ‚Äî about 60 MB, in order to process such a small file. .  Use the <code>-l</code> option to print out the amount of memory used in addition to the execution time. </p><br><pre> <code class="plaintext hljs">$ make small.txt $ /usr/bin/time -l java TopTen small.txt # -v on Linux instead of -l sed = 6 sit = 6 amet = 6 mauris = 3 volutpat = 3 vitae = 3 dolor = 3 libero = 3 tempor = 2 suscipit = 2 0.32 real 0.49 user 0.05 sys 59846656 maximum resident set size</code> </pre> <br><p>  GraalVM gives us a tool that solves this problem.  We said that Graal is a compiler library and it can be used in many different ways.  One of them is compiling <em>ahead-of-time</em> into a platform <em>-dependent</em> executable image, instead of <em>just-in-time</em> compiling at runtime.  This is similar to how a regular compiler works, such as <code>gcc</code> . </p><br><pre> <code class="plaintext hljs">$ native-image --no-server TopTen classlist: 1,513.82 ms (cap): 2,333.95 ms setup: 3,584.09 ms (typeflow): 4,642.13 ms (objects): 3,073.58 ms (features): 156.34 ms analysis: 8,059.94 ms universe: 353.02 ms (parse): 1,277.02 ms (inline): 1,412.08 ms (compile): 10,337.76 ms compile: 13,776.23 ms image: 2,526.63 ms write: 1,525.03 ms [total]: 31,439.47 ms</code> </pre> <br><p>  This command creates a platform- <code>topten</code> executable file called <code>topten</code> .  This file does not launch the JVM, it is not linked to the JVM and it generally does not include the JVM in any way.  The <code>native-image</code> command truly compiles your Java code and the Java libraries you use into fully-fledged machine code.  For runtime components, such as the garbage collector, we run our own new VM, called SubstrateVM, which, like Graal, is also written in Java. </p><br><p>  If you look at the dependencies that <code>topten</code> uses, you will see that these are only standard system libraries.  We can only transfer this one file to a system on which the JVM has never been installed and run it there to verify that it does not use the JVM or any other files.  <code>Topten</code> also quite small - the executable code takes up less than 6 MB. </p><br><pre> <code class="plaintext hljs">$ otool -L topten # ldd topten on Linux topten: .../CoreFoundation.framework ... .../libz.1.dylib ... .../libSystem.B.dylib ... $ du -h topten 5.7M topten</code> </pre> <br><p>  If we run this executable file, we will see that it runs about an order of magnitude faster and uses about an order of magnitude less memory than the same program running under the JVM.  The launch is so fast that you won't notice how long it took.  If you use the command line, you will not feel the pause that is usually present when you run a small, short-lived program under the JVM </p><br><pre> <code class="plaintext hljs">$ /usr/bin/time -l ./topten small.txt sed = 6 sit = 6 amet = 6 mauris = 3 volutpat = 3 vitae = 3 dolor = 3 libero = 3 tempor = 2 suscipit = 2 0.02 real 0.00 user 0.00 sys 4702208 maximum resident set size</code> </pre> <br><p>  There are some <a href="">limitations to</a> the <code>native-image</code> utility.  So, at compile time you should have all the classes, there are also limitations in using the Reflection API.  But there are some additional advantages over basic compilation, such as running static initializers at compile time.  In this way, the amount of work performed each time an application is loaded is reduced. </p><br><p>  This is the second application of GraalVM - the distribution and execution of existing Java programs, with a quick start and less memory consumption.  This method eliminates configuration problems such as finding the right jar at runtime, and also allows you to create smaller Docker images. </p><br><h2 id="3-kombinirovanie-javascript-java-ruby-i-r">  3. Combining JavaScript, Java, Ruby and R </h2><br><p>  Along with Java, GraalVM includes new implementations of JavaScript, Ruby, R, and Python engines.  They are written using a new framework called <em>Truffle</em> .  This framework makes it possible to create interpreters of languages ‚Äã‚Äãthat are both simple and high-performance.  When you write an interpreter of a language using Truffle, it will automatically use Graal to provide JIT compilation for your language.  Thus, Graal is not only a JIT compiler and an AOT compiler for Java, it can also be a JIT compiler for JavaScript, Ruby, R and Python. </p><br><p>  Support for third-party languages ‚Äã‚Äãin GraalVM aims to be a transparent replacement for existing engines of different languages.  For example, we can install the ‚Äúcolor‚Äù module for Node.js: </p><br><pre> <code class="plaintext hljs">$ npm install --global color ... + color@3.0.0 added 6 packages in 14.156s</code> </pre> <br><p>  Then write a program using this module to convert RGB HTML colors to HSL: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Color = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'color'</span></span>); process.argv.slice(<span class="hljs-number"><span class="hljs-number">2</span></span>).forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">val</span></span></span><span class="hljs-function">) </span></span>{ print(Color(val).hsl().string()); });</code> </pre> <br><p>  And run it in the usual way: </p><br><pre> <code class="plaintext hljs">$ node color.js '#42aaf4' hsl(204.89999999999998, 89%, 60.8%)</code> </pre> <br><p>  The performance engines of different languages ‚Äã‚Äãin GraalVM work together - there is an API that allows you to run code from one language in a program written in another language.  And it allows you to write multilingual programs - programs written in more than one programming language. </p><br><p>  This may be necessary if you write most of your program in one language, but would like to use a library written in another programming language.  For example, imagine that we need to write an application to convert the color name from CSS into its numeric representation in Node.js, but we want to use the Ruby color library instead of writing the conversion ourselves. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> app = express(); color_rgb = Polyglot.eval(<span class="hljs-string"><span class="hljs-string">'ruby'</span></span>, <span class="hljs-string"><span class="hljs-string">` require 'color' Color::RGB `</span></span>); app.get(<span class="hljs-string"><span class="hljs-string">'/css/:name'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{ color = color_rgb.by_name(req.params.name).html() res.send(<span class="hljs-string"><span class="hljs-string">'&lt;h1 style="color: '</span></span> + color + <span class="hljs-string"><span class="hljs-string">'" &gt;'</span></span> + color + <span class="hljs-string"><span class="hljs-string">'&lt;/h1&gt;'</span></span>); }); app.listen(<span class="hljs-number"><span class="hljs-number">8080</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'serving at http://localhost:8080'</span></span>) });</code> </pre> <br><p>  In this code, we wrote that we had to execute Ruby code as a string, but note that we didn‚Äôt do much here - we just connected the libraries and then returned the Ruby object.  In Ruby, we would use it like this: <code>Color::RGB.by_name (name).html</code> .  If you look at how <code>color_rgb</code> used further in JavaScript, you will see that we actually call the same methods from JavaScript, although these are Ruby objects and methods.  And we pass them as JavaScript strings and connect the result, which is a Ruby string, with a JavaScript string. </p><br><p>  Install both dependencies - Ruby and JavaScript. </p><br><pre> <code class="plaintext hljs">$ gem install color Fetching: color-1.8.gem (100%) Successfully installed color-1.8 1 gem installed $ npm install express + express@4.16.2 updated 1 package in 10.393s</code> </pre> <br><p>  Then you need to run <code>node</code> with a couple of additional options: <code>--polyglot</code> to say that we need access to other languages ‚Äã‚Äãand <code>--jvm</code> , because the executable <code>node</code> image by default does not include anything other than JavaScript. </p><br><pre> <code class="plaintext hljs">$ node --polyglot --jvm color-server.js serving at http://localhost:8080</code> </pre> <br><p>  And then go to the URL <a href="http://localhost:8080/css/orange">http: // localhost: 8080 / css / orange</a> (or some other color), as usual, in your browser. <br><img src="https://habrastorage.org/webt/_h/uz/e2/_huze29ugzgpz8ecll22rpv6s1w.png"><br>  Let's try to make a more serious example that uses more languages ‚Äã‚Äãand modules. </p><br><p>  JavaScript does not support very large integers.  I found several modules like <a href="https://www.npmjs.com/package/big-integer">big-integer</a> , but they are all ineffective, because  store the components of the number as javascript floating point numbers.  The <code>BigInteger</code> class in Java is more efficient; let's use it to do several arithmetic operations with large integers. </p><br><p>  There is also no built-in support for drawing graphs in JavaScript, while R perfectly draws graphics.  Let's use the <code>svg</code> module from R to draw a scatter plot of a trigonometric function in 3D space. </p><br><p>  In both cases, we will use the API to support multilingualism from GraalVM (hereinafter referred to as Polyglot API) and we can simply insert the results of executing programs in other languages ‚Äã‚Äãin JavaScript. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> app = express() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> BigInteger = Java.type(<span class="hljs-string"><span class="hljs-string">'java.math.BigInteger'</span></span>) app.get(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> text = <span class="hljs-string"><span class="hljs-string">'Hello World from Graal.js!&lt;br&gt; '</span></span> <span class="hljs-comment"><span class="hljs-comment">// Using Java standard library classes text += BigInteger.valueOf(10).pow(100) .add(BigInteger.valueOf(43)).toString() + '&lt;br&gt;' // Using R interoperability to create graphs text += Polyglot.eval('R', `svg(); require(lattice); x &lt;- 1:100 y &lt;- sin(x/10) z &lt;- cos(x^1.3/(runif(1)*5+10)) print(cloud(x~y*z, main="cloud plot")) grDevices:::svg.off() `); res.send(text) }) app.listen(3000, function () { console.log('Example app listening on port 3000!') })</span></span></code> </pre> <br><p>  Open <a href="http://localhost:3000/">http: // localhost: 3000 /</a> in your browser to see the result: <br><img src="https://habrastorage.org/webt/1o/so/fj/1osofjuimjcfd7pv1qhcikonupo.png"><br>  This is the third thing we can do with GraalVM ‚Äî run programs written in several languages ‚Äã‚Äãand use the modules from these languages ‚Äã‚Äãtogether in one program.  We present this as a way to unify runtime environments and libraries ‚Äî you can use the programming language that you think is best suited for solving the current problem and any library you want, regardless of what programming language it is written in. </p><br><h2 id="4-ispolnenie-programm-napisannyh-na-platformo-zavisimyh-yazykah">  4. Execution of programs written in platform-specific languages </h2><br><p>  Another language that GraalVM supports is C. GraalVM can execute C code in the same way that it executes programs written in JavaScript and Ruby. </p><br><p>  What GraalVM actually supports is the launch of code resulting from the execution of the LLVM utilities, i.e.  bitcode, not direct C support. This means that you can use existing tools for C and other languages ‚Äã‚Äãthat support LLVM, such as C ++, Fortran, and potentially more languages ‚Äã‚Äãin the future.  For ease of demonstration, I run a special version of <a href="http://people.csail.mit.edu/smcc/projects/single-file-programs/">gzip</a> , which is compiled into a single file (this version is supported by <a href="http://people.csail.mit.edu/smcc/">Stephen McCamant</a> ).  This is just the <code>gzip</code> source code and <code>autoconf</code> configuration combined into one file for simplicity.  I had to patch a couple of things to make it work on macOS and with clang, but I didn't do anything specifically to support GraalVM. </p><br><p>  We compile gzip using the standard <code>clang</code> (LLVM compiler for C) and want it to make us an LLVM bitcode, not a platform-specific build, because GraalVM will not launch it.  I am using <code>clang</code> 4.0.1. </p><br><pre> <code class="plaintext hljs">$ clang -c -emit-llvm gzip.c</code> </pre> <br><p>  And then run the result, directly using the lli command (interpreter of the LLVM bitcode) from GraalVM.  Let's try to compress the file using my gzip system archiver, and then unzip it using gzip running under GraalVM. </p><br><pre> <code class="plaintext hljs">$ cat small.txt Lorem ipsum dolor sit amet... $ gzip small.txt $ lli gzip.bc -d small.txt.gz $ cat small.txt Lorem ipsum dolor sit amet...</code> </pre> <br><p>  Implementations of Ruby and Python in GraalVM use the same technique to run extensions written in C for these languages.  This means that you can run these extensions inside a VM and this allows us to maintain high execution speed, even if we use outdated platform-specific extension interfaces. </p><br><p>  This is the fourth way to use GraalVM ‚Äî launch programs written in platform-specific languages, such as C or C ++, as well as launching extensions to languages ‚Äã‚Äãsuch as Python or Ruby that the JVM implementations of these languages, such as JRuby, are not able to do. </p><br><h2 id="5-obschie-instrumenty-dlya-vseh-yazykov-programmirovaniya">  5. Common tools for all programming languages </h2><br><p>  If you are programming in Java, then you probably use very high-quality tools such as IDE, debuggers, and profilers.  Not all languages ‚Äã‚Äãhave such a set of tools, but you can get such a set if you use languages ‚Äã‚Äãthat are supported by GraalVM. </p><br><p>  Support for all languages ‚Äã‚Äãin GraalVM (except Java, currently) is implemented using a common framework - Truffle.  This allows us to make functionality, for example, a debugger, once and use it for all languages. </p><br><p>  To try this, we will write the simplest program - <em>FizzBuzz</em> , because it is visual (prints something on the screen) and there are clear branches in it that are used only in some iterations.  Thus, it will be easier for us to set breakpoints.  Let's start with javascript implementation. </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fizzbuzz</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">n</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((n % <span class="hljs-number"><span class="hljs-number">3</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) &amp;&amp; (n % <span class="hljs-number"><span class="hljs-number">5</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'FizzBuzz'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n % <span class="hljs-number"><span class="hljs-number">3</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Fizz'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n % <span class="hljs-number"><span class="hljs-number">5</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Buzz'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n; } } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n = <span class="hljs-number"><span class="hljs-number">1</span></span>; n &lt;= <span class="hljs-number"><span class="hljs-number">20</span></span>; n++) { print(fizzbuzz(n)); }</code> </pre> <br><p>  Run the program as usual, using the <code>js</code> utility, under GraalVM. </p><br><pre> <code class="plaintext hljs">$ js fizzbuzz.js 1 2 Fizz 4 Buzz Fizz</code> </pre> <br><p>  We can also run a program with the - <code>--inspect</code> flag.  This will give us a link that you can open in Chrome and stop the program in the debugger. </p><br><pre> <code class="plaintext hljs">$ js --inspect fizzbuzz.js Debugger listening on port 9229. To start debugging, open the following URL in Chrome: chrome-devtools://devtools/bundled/inspector.html?ws=127.0.0.1:9229/6c478d4e-1350b196b409</code> </pre> <br><p>  You can put a breakpoint in the <em>FizzBuzz</em> code and then continue execution.  When the program interrupts execution, we will see the value of the variable <code>n</code> in the debugger and we can continue the execution of the program or study the debugger interface. <br><img src="https://habrastorage.org/webt/kn/nq/so/knnqsotzl0j-k8e4y83a1ziz97w.png"><br>  The Chrome debugger is usually used for JavaScript, but for GraalVM in JavaScript there is nothing different from other languages.  The <code>--inspect</code> flag <code>--inspect</code> also available and works in the implementation of Python, Ruby and R. I will not show you the source code of each program, but they run the same way and you get the same debugger in Chrome for each of them. </p><br><pre> <code class="plaintext hljs">$ graalpython --jvm --inspect fizzbuzz.py</code> </pre> <br><p><img src="https://habrastorage.org/webt/6t/fx/2m/6tfx2m4btthox9mxxkweqehwjgm.png"></p><br><pre> <code class="plaintext hljs">$ ruby --inspect fizzbuzz.rb</code> </pre> <br><p><img src="https://habrastorage.org/webt/2z/_z/ti/2z_ztia4yk9fqomzo_vxj9c7mb0.png"></p><br><pre> <code class="plaintext hljs">$ Rscript --inspect fizzbuzz.r</code> </pre> <br><p><img src="https://habrastorage.org/webt/rg/12/wn/rg12wnspfc176rtrz7uww4qymo0.png"><br>  Another tool that you probably know from Java is VisualVM.  It provides a user interface, using which you can join a running JVM on your local machine or via the network to inspect various aspects of program execution, such as memory usage or execution threads. </p><br><p>  GraalVM includes VisualVM as a standard <code>jvisualvm</code> utility. </p><br><pre> <code class="plaintext hljs">$ jvisualvm &amp;&gt; /dev/null &amp;</code> </pre> <br><p>  If we run VisualVM while Java is running <code>TopTen</code> Java, we can observe the memory usage or, for example, take a snapshot of the memory contents and see what types of objects we use memory on the heap. </p><br><pre> <code class="plaintext hljs">$ java TopTen large.txt</code> </pre> <br><p><img src="https://habrastorage.org/webt/gd/-5/ld/gd-5ldwlrn3y9szdaoqrmd_7res.png"><br>  I wrote this Ruby program to generate some garbage in memory at runtime. </p><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'erb'</span></span> x = <span class="hljs-number"><span class="hljs-number">42</span></span> template = ERB.new &lt;&lt;-EOF The value of x <span class="hljs-symbol"><span class="hljs-symbol">is:</span></span> &lt;%= x %&gt; EOF loop <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> puts template.result(binding) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  If you run the standard Ruby implementation on JVM - JRuby, then you will be disappointed with VisualVM, because you will see only internal Java objects instead of objects of your language. </p><br><p>  If you are using the version of Ruby for GraalVM, then VisualVM recognizes Ruby objects.  We need to use the - <code>--jvm</code> option to use VisualVM, since  it does not support native versions of Ruby. </p><br><pre> <code class="plaintext hljs">$ ruby --jvm render.rb</code> </pre> <br><p> ,  ,       Java ,    , ,   Summary,   Ruby Heap       Ruby . <br><img src="https://habrastorage.org/webt/ge/d4/xc/ged4xcxp5ylkaxjxyxd5b8v3kyo.png"><br>  Truffle ‚Äî  -  <a href="https://ru.wikipedia.org/wiki/%25D0%259D%25D0%25B5%25D0%25BA%25D1%2581%25D1%2583%25D1%2581">Nexus</a>  <a href="http://programming-journal.org/2018/2/14/">  </a> .         Truffle      ,  ,   API Truffle'  ,         ,   Truffle,         . </p><br><p> ,   GraalVM ‚Äî         ,       .   Truffle  GraalVM      ,       VisualVM. </p><br><h2 id="6-dopolnenie-jvm-prilozheniy"> 6.  JVM  </h2><br><p>   ,   ,   ,        Java .  API   <code>org.graalvm.polyglot</code>      ,         . </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.graalvm.polyglot.Context; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.graalvm.polyglot.Value; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExtendJava</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ String language = <span class="hljs-string"><span class="hljs-string">"js"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> (Context context = Context.newBuilder().allowNativeAccess(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>).build()) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (String arg: args) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (arg.startsWith(<span class="hljs-string"><span class="hljs-string">"-"</span></span>)) { language = arg.substring(<span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Value v = context.eval(language, arg); System.out.println(v); } } } } }</code> </pre> <br><p>    <code>javac</code>  <code>java</code>   GraalVM,   <code>org.graalvm.*</code>     <code>classpath</code> , ..          . </p><br><pre> <code class="plaintext hljs">$ javac ExtendJava.java $ java ExtendJava '14 + 2' 16 $ java ExtendJava -js 'Math.sqrt(14)' 3.7416573867739413 $ java ExtendJava -python '[2**n for n in range(0, 8)]' [1, 2, 4, 8, 16, 32, 64, 128] $ java ExtendJava -ruby '[4, 2, 3].sort' [2, 3, 4]</code> </pre> <br><p> ,        ‚Äî     ,      <code>node</code>  <code>ruby</code> ,  GraalVM. </p><br><p>     GraalVM ‚Äî             Java . Polyglot API     ‚Äú‚Äù      Java ,       . </p><br><h2 id="7-dopolnenie-platformo-zavisimyh-prilozheniy"> 7.  -  </h2><br><p>  GraalVM    ,  ,    ‚Äî  ,        ,  GraalVM,  - . ,  JavaScript ,  V8,  Python ‚Äî CPython     , ..          . GraalVM           ‚Äî      Polyglot . </p><br><p>    GraalVM,       ,         JavaScript.    Polyglot ,    ,  : </p><br><pre> <code class="plaintext hljs">$ graalvm-1.0.0-rc1/Contents/Home/jre/lib/svm/bin/rebuild-images libpolyglot</code> </pre> <br><p>     C,   ,    ,  GraalVM,     .       <code>ExtendJava</code>   ,    ,   . </p><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdlib.h&gt; #include &lt;stdio.h&gt; #include &lt;polyglot_api.h&gt; int main(int argc, char **argv) { graal_isolate_t *isolate = NULL; graal_isolatethread_t *thread = NULL; if (graal_create_isolate(NULL, &amp;isolate) != 0 || (thread = graal_current_thread(isolate)) == NULL) { fprintf(stderr, "initialization error\n"); return 1; } poly_context context = NULL; if (poly_create_context(thread, NULL, 0, &amp;context) != poly_ok) { fprintf(stderr, "initialization error\n"); return 1; } char* language = "js"; for (int n = 1; n &lt; argc; n++) { if (argv[n][0] == '-') { language = &amp;argv[n][1]; } else { poly_value result = NULL; if (poly_context_eval(thread, context, language, "unicalc", argv[n], &amp;result) != poly_ok) { fprintf(stderr, "eval error\n"); return 1; } char buffer[1024]; size_t length; if (poly_value_to_string_utf8(thread, result, buffer, sizeof(buffer), &amp;length) != poly_ok) { fprintf(stderr, "to string error\n"); return 1; } buffer[length] = '\0'; printf("%s\n", buffer); poly_destroy_handle(thread, result); } } return 0; }</span></span></span></span></code> </pre> </div></div><br><p>      ,       polyglot   GraalVM.  , ,    JVM. </p><br><pre> <code class="plaintext hljs">$ clang -Igraalvm-1.0.0-rc1/Contents/Home/jre/lib/polyglot / -rpath graalvm-1.0.0-rc1/Contents/Home / -Lgraalvm-1.0.0-rc1/Contents/Home/jre/lib/polyglot / -lpolyglot extendc.c -o extendc $ otool -L extendc extendc: .../libpolyglot.dylib ... .../libSystem.B.dylib ...</code> </pre> <br><pre> <code class="plaintext hljs">$ ./extendc '14 + 2' 16 $ ./extendc -js 'Math.sqrt(14)' 3.7416573867739413 $ ./extendc -python '[2**n for n in range(0, 8)]' [1, 2, 4, 8, 16, 32, 64, 128]</code> </pre> <br><p>   ,      GraalVM ‚Äî  -    ,    ,  GraalVM. </p><br><h2 id="8-kod-na-java-kak-platformo-zavisimaya-biblioteka"> 8.   Java  -  </h2><br><p>  Java        , , ,    ,  - ,      .     Java   - ,     JVM   ,         . </p><br><p> GraalVM    Java ,   ,      - ,          .      ,    ,    Java    JVM. </p><br><p>   ,     Apache SIS    ,     ( <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D1%2580%25D1%2582%25D0%25BE%25D0%25B4%25D1%2580%25D0%25BE%25D0%25BC%25D0%25B8%25D1%258F"></a> )     .   SIS 0.8,      <a href="http://sis.apache.org/">http://sis.apache.org/</a>     jar. </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.sis.distance.DistanceUtils; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Distance</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> aLat = Double.parseDouble(args[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> aLong = Double.parseDouble(args[<span class="hljs-number"><span class="hljs-number">1</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> bLat = Double.parseDouble(args[<span class="hljs-number"><span class="hljs-number">2</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> bLong = Double.parseDouble(args[<span class="hljs-number"><span class="hljs-number">3</span></span>]); System.out.printf(<span class="hljs-string"><span class="hljs-string">"%.2f km%n"</span></span>, DistanceUtils.getHaversineDistance(aLat, aLong, bLat, bLong)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IsolateThread thread, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> aLat, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> aLong, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bLat, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bLong)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DistanceUtils.getHaversineDistance(aLat, aLong, bLat, bLong); } }</code> </pre> <br><p>      ,       - </p><br><pre> <code class="plaintext hljs">$ javac -cp sis.jar -parameters Distance.java $ java -cp sis.jar:. Distance 51.507222 -0.1275 40.7127 -74.0059 5570.25 km</code> </pre> <br><p>       ,      <code>topten</code> . </p><br><pre> <code class="plaintext hljs">$ native-image --no-server -cp sis.jar:. Distance ... $ ./distance 51.507222 -0.1275 40.7127 -74.0059 5570.25 km</code> </pre> <br><p>      ,    .   ,        <code>@CEntryPoint</code> </p><br><pre> <code class="java hljs">... <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.graalvm.nativeimage.IsolateThread; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.graalvm.nativeimage.c.function.CEntryPoint; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Distance</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-meta"><span class="hljs-meta">@CEntryPoint</span></span>(name = <span class="hljs-string"><span class="hljs-string">"distance"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IsolateThread thread, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a_lat, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a_long, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b_lat, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b_long)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DistanceUtils.getHaversineDistance(a_lat, a_long, b_lat, b_long); } ... }</code> </pre> <br><p>      <code>javac</code> ,   GraalVM    API  <code>classpath</code> . C         . </p><br><pre> <code class="plaintext hljs">$ native-image --no-server -cp sis.jar:. -H:Kind=SHARED_LIBRARY \ -H:Name=libdistance $ otool -L libdistance.dylib # .so on Linux libdistance.dylib: .../libdistance.dylib ... .../CoreFoundation.framework ... .../libz.1.dylib ... .../libSystem.B.dylib ... $ du -h libdistance.dylib 4.8M libdistance.dylib</code> </pre> <br><p>      ,     .     ,    :   VM   ,      ,           . </p><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdlib.h&gt; #include &lt;stdio.h&gt; #include &lt;libdistance.h&gt; int main(int argc, char **argv) { graal_isolate_t *isolate = NULL; graal_isolatethread_t *thread = NULL; if (graal_create_isolate(NULL, &amp;isolate) != 0 || (thread = graal_current_thread(isolate)) == NULL) { fprintf(stderr, "initialization error\n"); return 1; } double a_lat = strtod(argv[1], NULL); double a_long = strtod(argv[2], NULL); double b_lat = strtod(argv[3], NULL); double b_long = strtod(argv[4], NULL); printf("%.2f km\n", distance(thread, a_lat, a_long, b_lat, b_long)); return 0; }</span></span></span></span></code> </pre> <br><p>       ,       (  <code>LD_LIBRARY_PARTH=.</code>  Linux) </p><br><pre> <code class="plaintext hljs">$ clang -I. -L. -ldistance distance.c -o distance $ otool -L distance distance: .../libdistance.dylib ... .../libSystem.B.dylib ... $ ./distance 51.507222 -0.1275 40.7127 -74.0059 5570.25 km</code> </pre> <br><p>     GraalVM ‚Äî   java  - ,         JVM </p><br><h2 id="9-podderzhka-neskolkih-yazykov-programmirovaniya-v-baze-dannyh"> 9.        </h2><br><p>     Polyglot  ‚Äî     Oracle.      Oracle Database Multilingual Engine (MLE),         GraalVM   SQL. </p><br><p> ,    front-end,    JavaScript     email ,  JavaScript  <code>validator</code> .     -       ,      SQL  PL/SQL.         ,    . </p><br><p>  MLE  Docker  : </p><br><p> <a href="https://oracle.github.io/oracle-db-mle/releases/0.2.7/docker/">https://oracle.github.io/oracle-db-mle/releases/0.2.7/docker/</a> </p><br><p>     Docker Daemon. </p><br><pre> <code class="plaintext hljs">$ docker load --input mle-docker-0.2.7.tar.gz</code> </pre> <br><p>  ,  Docker,  ,    (    ),  Bash   . </p><br><pre> <code class="plaintext hljs">$ docker run mle-docker-0.2.7 $ docker ps $ docker exec -ti &lt;container_id&gt; bash -li</code> </pre> <br><p>    <code>sqlplus</code> ( SQL ),   Bash,     ,   ,     . </p><br><pre> <code class="plaintext hljs">$ sqlplus scott/tiger@localhost:1521/ORCLCDB</code> </pre> <br><p>    ,    <code>sqlplus</code> . ,   Bash  Docker,         <code>dbjs</code> ,       .   <code>sqlplus</code> . </p><br><pre> <code class="plaintext hljs">$ npm install validator $ npm install @types/validator $ dbjs deploy -u scott -p tiger -c localhost:1521/ORCLCDB validator $ sqlplus scott/tiger@localhost:1521/ORCLCDB</code> </pre> <br><p>         <code>validator</code>   SQL . </p><br><pre> <code class="plaintext hljs">SQL&gt; select validator.isEmail('hello.world@oracle.com') from dual; VALIDATOR.ISEMAIL('HELLO.WORLD@ORACLE.COM') ------------------------------------------- 1 SQL&gt; select validator.isEmail('hello.world') from dual; VALIDATOR.ISEMAIL('HELLO.WORLD') -------------------------------- 0</code> </pre> <br><p>    ,     GraalVM ‚Äî  ,  GraalVM,   Oracle.  ,     front-end  back-end,    ,  ,           . </p><br><h2 id="10-sozdanie-yazykov-programmirovaniya-dlya-graalvm"> 10.     GraalVM </h2><br><p> Oracle Labs            JavaScript, R, Ruby, Python  C   ,      Truffle,       GraalVM. </p><br><p> Truffle ‚Äî  java ,     <em>  </em> (AST).  AST ‚Äî ,     ,                ,   , ,  .     ,    ,   Truffle  Graal   JIT  ,       AST . </p><br><p>    Truffle,    GraalVM    ,      ,  DSL.      Truffle  Graal   ,     ,  Truffle ‚Äî         GraalVM.        , , , , . ,         ,        . Oracle labs    Ruby ,    ,         . </p><br><p>       ,     ,   ,  <a href="https://github.com/graalvm/simplelanguage">SimpleLanguage</a> ‚Äî         Truffle,       JavaScript.  ,  ,   , , , <a href="">   if</a> . </p><br><p>  ,    Truffle   Oracle Labs,   <a href="https://github.com/SOM-st/TruffleSOM">SmallTalk</a> , <a href="https://github.com/smarr/SOMns">Newspeak</a>  <a href="https://github.com/cesquivias/mumbler">Lisp</a> .    Lisp  <a href="http://cesquivias.github.io/"></a> ,         . </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p> GraalVM        ‚Äî  ,         ,       .       ,  ,    ,      ,    . </p><br><p>   GraalVM,   <a href="https://www.graalvm.org/">http://www.graalvm.org/</a> .          ,  ,      . </p><br><p>    ,              ,    .     ,     GraalVM         <a href="https://twitter.com/ChrisGSeaton">@ChrisGSeaton</a>  <a href="https://twitter.com/shelajev">@shelajev</a> . </p><br><p> <em>:</em> <a href="https://medium.com/%40shelajev%3Fsource%3Dpost_page">Oleg ≈†elajev</a> , <a href="https://medium.com/%40olyahupalo%3Fsource%3Dpost_page">Olya Gupalo</a>  <a href="https://medium.com/%40doug.simon%3Fsource%3Dpost_page">Doug Simon</a> </p><cut></cut></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/433432/">https://habr.com/ru/post/433432/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../433414/index.html">PRTG Network Monitor testing and comparison with Zabbix</a></li>
<li><a href="../433420/index.html">Results ZeroNights 2018</a></li>
<li><a href="../433424/index.html">Is it possible to download an impassable level in Super Mario Maker?</a></li>
<li><a href="../433428/index.html">Where does creativity come from: analysis of alpha brain wave activity during RAT tests</a></li>
<li><a href="../433430/index.html">Android-box Mecool KM9 on the fresh SoC Amlogic S905X2 with 4 GB of RAM and Android TV 8.1 - understand and forgive</a></li>
<li><a href="../433434/index.html">‚ÄúPascal and even more so Basic is definitely not needed‚Äù: interviews with coaches in sports programming</a></li>
<li><a href="../433436/index.html">Introduction to Performance Research</a></li>
<li><a href="../433438/index.html">State Duma will limit crowdfunding</a></li>
<li><a href="../433442/index.html">Entity Framework Core 2.2 released. What's new? (3 of 3)</a></li>
<li><a href="../433446/index.html">Security Week 51: a bug in WordPress 5.0 and Logitech software, Facebook photo vulnerability</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>