<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>NodeMap, but not what you thought</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It is clear that the idea itself is worth nothing without practical implementation. 

 I have a cloud of ideas in my head, but most of them lack the t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>NodeMap, but not what you thought</h1><div class="post__text post__text-html js-mediator-article">  It is clear that the idea itself is worth nothing without practical implementation. <br><br>  I have a cloud of ideas in my head, but most of them lack the time, money or desire.  It doesn‚Äôt bother much, as I have something to do, but in the summer I came close enough to implement one of these ideas. <br><br> <a href=""><img src="https://habrastorage.org/files/abc/a51/e12/abca51e12c944b6a856a98aa36dd07e8.jpg" alt="image"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      By the end of July, after a month and a half of continuous work and daily commits, I had no free time and I didn‚Äôt bring the idea to a full-fledged launch.  During this time, a fully functional prototype of what I wanted to do was assembled.  Yesterday, <a href="http://habrahabr.ru/post/240681/">in the comments</a> to the topic with a similar idea, I was advised to publish an article and share my work so that the code does not lie on the <a href="https://github.com/Synopticum/nodemap">githaba as a</a> dead weight. <br><a name="habracut"></a><br><br><h4>  Water marks </h4><br><br>  In early June, I sat with my grandfather and grandmother in a small village on the very border of Tatarstan and Bashkiria, drank tea and watched old photos.  Grandfather in the 50-80s was fond of photography and there was something to see.  Basically there were ‚Äúbows‚Äù, photos of people on the premises or on vacation in nature, such photos can be taken now, so they were not very interesting for me. <br><br>  Nevertheless, I selected about fifty pieces that seemed interesting to me, because they depicted places familiar to all residents of the village, which now look completely different.  I scanned them and, satisfied, went to share in the ‚ÄúTypical% city%‚Äù vkontakte standard for any city.  I didn‚Äôt even suspect that the group was run by a young money donor who would fuck up with his dirty little hands on my, without a doubt, rare and ingenious finds. <br><br> <a href=""><img src="https://habrastorage.org/files/52d/633/db7/52d633db723941d0aa41e544b60331eb.jpg" alt="image"></a> <br><br>  The authorship of the pictures was not indicated, the comments in the group were mercilessly demolished, the minor degenerate refused to answer personal messages, and it was somehow inconvenient to beat him due to his minor age.  As you probably already guessed, a bunch of me from such a turn of events bombed very high quality, with a twinkle.  A plan was needed, and a plan appeared. <br><br><h4>  Plan </h4><br><br>  The idea was as simple as three kopecks: to print Google maps of the village with the necessary resolution, ask some freelancer to draw it more beautifully, take OpenStreetMap or leaflet.js scripts and it would turn out even better than in the VKontakte group - with reference to a specific place. <br><br>  To my great surprise for such work, freelancers charged some horse sums like "30 thousand rubles for a render and you will zoom as you like."  The offer is tempting, but I was sorry for 30 thousand rubles, and I limited myself to ordering the house sketching in one layer and highlighting the main areas on the map texture.  It only cost me 3,000 rubles, of course, such a map was absolutely unsuitable for use - at least street names were needed.  I remembered the proverb - if you want to do something well, do it yourself.  But the story is not about that, so I will limit myself to two pictures: <br><br> <a href=""><img src="https://habrastorage.org/files/afa/9cc/a1a/afa9cca1adb34b9e8b2145761a1118a1.png" alt="image"></a> <br><br> <a href=""><img src="https://habrastorage.org/files/ae8/06d/fa4/ae806dfa43ea46f8ae9ebd73135dfbfa.jpg" alt="image"></a> <br><br><h4>  Unable to refuse </h4><br><br>  Now I had an index.html file with the <a href="http://leafletjs.com/">leaflet.js</a> script <a href="http://leafletjs.com/">attached</a> and map tiles generated using the convenient but paid <a href="http://www.maptiler.org/">MapTiler</a> program.  I've been making up for a long time, and also know a little node.js, so for me it was not difficult to quickly wrap up simple pop-ups for adding <a href="https://www.iconfinder.com/search/%3Fq%3Dmarker%26minimum%3D32%26maximum%3D32%26price%3Dfree">markers</a> .  The data was chased back and forth by REST, at first I trained on JSON stubs, and then, when I wanted feedback, I changed them to mongo with a couple of simple tablets. <br><br> <a href=""><img src="https://habrastorage.org/files/87a/702/13f/87a70213f2f242e6a43e3114b1d85c2a.jpg" alt="image"></a> <br><br>  Everything worked, it was possible to fill, but at that moment I felt somehow sad.  Such a beautiful thing, and under the hood and a half script.  This is not Web 2.0, it is non-dynamic, you need to fasten something there too fast.  "Quick" lasted a month, during this time it was screwed: <br><br><ul><li>  Authorization <a href="">through</a> <a href="">VKontakte</a> ( <a href="http://passportjs.org/">passportjs</a> / oauth2) </li><li>  Functional "points" on the map.  The point has a <a href="">marker of a certain color, a title, a short description</a> , a <a href="">gallery of images,</a> and additional optional fields.  You can also attach a link to a music track to a point, and then <a href="">the Play / Pause button</a> (HTML5 Audio Api) <a href="">will be available</a> .  Thus, in addition to the gallery, each point can have its own track.  Points can be <a href="">commented</a> , you can attach one photo to the comments. </li><li>  Users can <a href="">view the map</a> , switch the map layers available to them, <a href="">add points</a> to the selected map layer.  The point goes to the pre-moderation to the admin, after the pre-moderation appears or does not appear on the map. <br>  They can also leave for pre-moderation in news, announcements, initiatives and complaints, in an anonymous section, anonymity is fair enough - you can find out who has commented only if you get into the database. <br>  It was planned to fasten <a href="">food delivery from the local pizzeria and view the time to the bus</a> leaving for the nearest major city (the most popular route), but these functions remained in the form of plugs. </li><li>  The admin, in addition to this, can <a href="">skip or not skip messages</a> or points and add them independently.  For graphomania who are bored with their messages, but generally harmless, you can set <a href="">the trusted mode</a> , after which moderation to add news, announcements and other things is removed.  But you can always return everything back. </li><li>  Actually, <a href="">news</a> , <a href="">announcements</a> , <a href="">initiatives</a> or <a href="">complaints</a> , as well as <a href="">an anonymous section</a> . </li></ul><br><br> <a href=""><img src="https://habrastorage.org/files/823/bbc/4c7/823bbc4c78ec41b981d0bc35aa9b7a41.jpg" alt="image"></a> <br><br><h4>  Technical details </h4><br><br>  The application framework is nodejs / express / mongoose on the server, leafletjs / backbone + underscore templates / fancybox on the client.  There is no routing on the client.  The server sends json, checks the authorization, presses the filled pictures and collects and minifies css / js grunt-om.  The client does the rest. <br><br>  Authorization is checked not only at the entrance, but for any user actions related to the interaction with the server - not all visitors have rights, and the admin views with a strong desire to run on the client (and poke various bad buttons) are still possible. <br><br>  Definitely there are bugs, at the end of July I left to work and left the project in its current form. <br><br><h4>  How to run (not for the faint of heart): </h4><br><br><ol><li>  Install stable <a href="http://nodejs.org/">node.js</a> and <a href="http://www.mongodb.org/">mongodb</a> . </li><li>  Install imagemagick: <br><pre><code class="bash hljs">npm i -g imagemagick</code> </pre> <br></li><li>  Clone your repository: <br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/Synopticum/nodemap.git</code> </pre><br></li><li>  Create a folder for the database / db in the project directory and <a href="">set the mongodb on it</a> : <br><pre> <code class="bash hljs">mongod --dbpath ~/nodemap/db</code> </pre></li><li>  Can be done at the root of the project <pre> <code class="bash hljs">npm install</code> </pre><br>  To update the modules, but I did not check, maybe something will fall off. <br></li><li>  Run admincreate.js in the project root to create an admin entry in the database.  When a record is created, specify the id of the newly created admin <a href="">in the</a> /config/env.js <a href="">config</a> . </li><li>  On the side of VKontakte, too, everything must be configured.  This is described in detail in other articles and in the vk api documentation, but in a nutshell - you need to add yourself an application to your VK account and fill in all the necessary settings.  <a href="">This screen</a> will help. </li><li>  <a href="">Run app.js</a> </li><li>  Login to <a href="http://localhost/">localhost</a> : 3000 / </li></ol><br><br>  In reality, everything is not as scary as in this list and all the procedures take about 15 minutes. I recommend starting and debugging the application not in the console, but in WebStorm. <br><br><h4>  Felina </h4><br><br>  So what about the original idea?  Old photos with reference to the terrain and all that?  <a href="">All in more than power</a> .  Although I got a job and my free time is absolutely over, the client part of the project will be rewritten again in the winter. <br><br>  And what you see is a prototype.  This was written for myself.  This is not for production.  I don‚Äôt even suggest that you use the source code in any way, there are a lot of scary and nasty things that have turned out to be unknowing and because of the lack of an initially understandable goal.  Do not carp too much and consider that this is just an idea or concept that someone might think about. <br><br>  In the process of work, it became clear why no one really sits on such services on Google or Yandex cards - because they are unified and soulless.  And things like this are manual work.  It would be interesting to complete at least one such project, but it would be even more interesting if there were several of them with some kind of common API for cross-site interaction, with the ability to navigate through such isolated but well-detailed pieces of maps united into a common network connected to the intergalactic the router ... <br><br>  Do you think robots will take over the world?) <br><br>  <a href="https://github.com/Synopticum/nodemap">NodeMap on GitHub</a> </div><p>Source: <a href="https://habr.com/ru/post/240807/">https://habr.com/ru/post/240807/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../240793/index.html">Multiboot, UEFI, NTFS or almost a recipe for happiness</a></li>
<li><a href="../240795/index.html">Evaluation of the competitiveness of search queries for variations in search results</a></li>
<li><a href="../240799/index.html">The story of one bug in the machine for video poker</a></li>
<li><a href="../240803/index.html">Free Cryptic Disk 4 with TrueCrypt support</a></li>
<li><a href="../240805/index.html">Strutext C ++ word processing library</a></li>
<li><a href="../240809/index.html">Package to create admin in projects on Laravel</a></li>
<li><a href="../240811/index.html">An old dog learns new tricks: Code Kata using QuickCheck</a></li>
<li><a href="../240813/index.html">Expressive JavaScript: Data Structures: Objects and Arrays</a></li>
<li><a href="../240815/index.html">"Purple" I2P - a window into the world of C ++ applications</a></li>
<li><a href="../240817/index.html">Using Accept Header for API Versioning</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>