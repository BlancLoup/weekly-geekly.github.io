<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hacking a site using another site. Trust but check</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The client addressed us to the company, the next mountain of developers. I can‚Äôt understand why this site doesn‚Äôt work. The hosting seemed to be paid ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Hacking a site using another site. Trust but check</h1><div class="post__text post__text-html js-mediator-article">  The client addressed us to the company, the next mountain of developers.  I can‚Äôt understand why this site doesn‚Äôt work.  The hosting seemed to be paid for, the domain is extended, and I don‚Äôt know what's wrong with the site <br><br>  After a more detailed conversation, it turned out: <br><br><ul><li>  The hosting account on which the site was located was previously blocked for spamming. </li><li>  According to the client, the problem was solved when he turned to the previous developers, they restored access and everything began to work as before. </li><li>  What kind of manipulations were carried out by the developers, he does not know, since the hosting was not registered to him, but to some of his friends, who advised him on these guys. </li><li>  The site does not work again, but it cannot contact any of those who fixed the problem last time, at the moment. </li></ul><br>  We wondered what was happening there with the site, that it was already failing for the second time.  We asked the client to contact his friend, on whom the hosting was registered, and to find out from him that he had access to the control panel, and we contacted the hosting technical support service to clarify the reasons for the site‚Äôs inoperability. <br><a name="habracut"></a><br>  <b>For those who went to read directly about hacking, you can safely <a href="https://habr.com/ru/post/344012/">zhmakat here</a> .</b>  <b>Well, for those who are interested in the whole story entirely, as everything was discovered, read in full.</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      After the response from the support service, it became clear that access to the control panel was blocked, as was the account itself, for distributing spam emails and accessing it is possible only by providing login data and the IP to which temporary access will be associated. <br>  <b>Yes, that's right, the same rake.</b>  The difference this time was only that, according to a friend who agreed to provide data from the hosting, the site on the account is no longer there and it will not be possible to recover.  So he said the very developers who are very " <i>effectively</i> " solved the problem last time. <br><br>  After a bit of speculation, we decided to try our luck and try to restore the site from the backups that were supposed to be kept by the hosting provider.  Provided all the necessary information and the IP address from which the entry will be made.  We went into the account and first decided to see the history of requests to the support service, on the previous case of blocking. <br><br>  The correspondence was small and we managed to find out that: <br><br><ol><li>  A password was chosen for the admin site. </li><li>  Through the plug-in installation module, a spam mailing script was embedded. </li><li>  The guys didn‚Äôt take any preventive work, but simply decided to restore the site from the backup, while not touching the database and without changing the password to it and the admin panel of the site. </li><li>  After some time, the account was again blocked, due to the fact that they did not eliminate the script. </li></ol><br><div class="spoiler">  <b class="spoiler_title">Screenshot chat</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/8o/_x/di/8o_xdirxnlxk_pn4-lrzfqqd6zi.jpeg"><br></div></div><br>  Checking the files in the root directory, we found that the site exists and no one deleted it, <u>as a friend of the client informed us earlier</u> .  Moreover, the last entry into the account was made just after the previous hacking incident.  Nobody logged in anymore. <br><br>  We created a new request for technical support, with a request to clarify in which files the malicious script was found, in order to have at least some idea what to look for. <br><br><a name="file_scripta"></a><br><h2>  How did hacking and mailing </h2><br>  Having received the answer from the support service, we found the necessary file and saw it there: <br><br><img src="https://habrastorage.org/webt/a4/gn/0y/a4gn0yogama4qlxgigthkkql7_q.jpeg"><br><br>  Walking through all the files on the site, the same content was found in another 74 template files.  After analyzing the code, checking all the ways, we realized that: <br><br><ol><li>  After hacking the site‚Äôs admin panel, a malicious script was installed using the plugin installation tool. </li><li>  Through the $ _POST variable, a request was sent to the address of the site containing an execution code that was executed in all the files that had this string, and in this case there were 74 such files. </li><li>  After the script was executed, spam emails were sent from the account, whose addresses were stored in the same site database, in a separate table, which the previous developers did not bother to check. </li><li>  Also, another unrelated table was found in the database, in which the encrypted base64 code was stored, which not only recovered deleted malicious strings in all files, but also did more interesting things (more <u>on this below</u> ). </li><li>  Woe to the geniuses who allegedly did the cleaning last time, apparently did not want to go into the problem and do the hard work of cleaning all the files manually in order to avoid re-infection.  Or they were directly related to this script ( <i>as cleaning the site from viruses, according to the price listed on their site, was worth a small amount</i> ). </li></ol><br>  We cleaned all the files, cleared the database, changed all access from the site and hosting, and also told technical support that the problem was fixed.  The account was unlocked and the site became available again. <br><br><h2>  About the script found in the hacked site database </h2><br>  The script, which was encrypted in base64 encoding and was stored in the database as text, not only performed the function of recovering all deleted lines of malicious code, but was also a bruteforce script. <br><br>  The main function that he performed was to send POST and GET requests to the addresses of admins of various sites, with logins and passwords, also stored in one of the database tables.  After a successful selection operation, he wrote down the correct pair of login: password in another table, access to which could be obtained by contacting the correct request to one of 74 infected files, right from the browser window. <br><br>  By such manipulations, the attackers not only accelerated the process of collecting passwords, but also increased the base of sites from which spam was sent and other passwords were picked. <br><br>  <b>Such a cycle can continue indefinitely.</b>  <b>If one of the site owners finds a virus and removes it, then this is a small loss for intruders, because they have a huge base of such loopholes at their disposal, which is increasing every day.</b> <br><br>  <i>PS: for those who want to see the script</i> .  Screenshots and examples of the malicious script were not uploaded due to the fact that there are always individuals who use the sample code as the basis for their offspring, and I don‚Äôt want to be the reason for creating and distributing the next malicious script. </div><p>Source: <a href="https://habr.com/ru/post/344012/">https://habr.com/ru/post/344012/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../344002/index.html">METRO IS</a></li>
<li><a href="../344004/index.html">Sean Barrett: How I Got into the Video Game Industry</a></li>
<li><a href="../344006/index.html">8 educational projects</a></li>
<li><a href="../344008/index.html">Convolution network in python. Part 1. Determination of the basic parameters of the model</a></li>
<li><a href="../344010/index.html">The beginning of a new era of cryptocurrency? CME Group exchanges issue bitcoin futures</a></li>
<li><a href="../344014/index.html">How we launched the router on Indiegogo or what opportunities are there in the communications market</a></li>
<li><a href="../344016/index.html">Multi-threaded programming in Android using RxJava 2</a></li>
<li><a href="../344018/index.html">Break open interviews: on algorithms, on architecture, behavioral, etc.</a></li>
<li><a href="../344020/index.html">Service Desk - quick start. 4 part. Asset accounting</a></li>
<li><a href="../344026/index.html">Pygest # 19. Releases, articles, interesting projects, packages and libraries from the world of Python [November 20, 2017 - December 5, 2017]</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>