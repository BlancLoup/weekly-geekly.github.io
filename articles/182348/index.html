<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Experience with AngularJS on the example of a game project</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚ÄúI will kill myself until the stat is working‚Äù 
 - Lead developer on the eve of the next update 

 Introduction 
 AngularJS continues to gain populari...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Experience with AngularJS on the example of a game project</h1><div class="post__text post__text-html js-mediator-article">  <i>‚ÄúI will kill myself until the stat is working‚Äù</i> <br>  - Lead developer on the eve of the next update <br><br><h4>  Introduction </h4><br>  AngularJS continues to gain popularity, and there are more and more articles and lessons that tell you how to work most effectively with this framework.  Unfortunately, they rarely give examples from real projects, and there is no description of the subtleties that one has to deal with in the process.  I want to devote this article to exactly such things, so if you are just going to work with ‚Äúangular‚Äù, some things may be difficult to understand. <br><br>  As is often the case, I began my acquaintance with AngularJS, finding a new job.  I was given the task to quickly explore the front-end.  And since the project is a game, a single-page application was required.  Therefore, in fact, "Angulyar".  I set to work. <br><a name="habracut"></a><br><h4>  ng-repeat in a rapidly changing world </h4><br>  I was interested in the list of players on the server during the match.  All code, of course, was packed into a controller, but inside it was a mess.  Comments, of course, was not.  The essence was approximately as follows: <br><ol><li>  create N list items </li><li>  add spans to them </li><li>  every 5 seconds proivzodit update </li></ol>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      All this was also bolted own scrollbar that I was somewhat surprised. <br><br>  Having a little rummaged in the dock, I decided to use ng-repeat instead of this heap of code.  I was pleased with the result: I got the same thing, but much clearer and more compact.  However, the triumph was short: it turned out that if this list was on the screen, there was a performance drop every 5 seconds.  It looks like I did something wrong after all. <br>  It turned out that every time I update the array, the framework redraws all 100,500 elements.  And since operations with DOM are traditionally heavy, the browser starts to hang.  It also turned out that the custom scrollbar was added, including for speed.  Those.  Not the whole array got to the page, but only a part of it.  The position of the scroll asked the number to retreat to.  And on the screen displayed the desired interval.  In addition, the elements were not completely redrawn, only the text value changed within them.  It became a little clearer to me what was really going on. <br>  I did not want to return everything back, so I decided to add a pagination, good, here it happens very simply: <br><ol><li>  Add the currentPage, pageSize and pageCount variables to scope. </li><li>  Add buttons to the template with the ng-click directive that change currentPage </li><li>  we add in the ng-repeat filter limitTo, equal to pageSize. </li></ol><br>  Voila.  The result began to look a little better.  The browser is no longer dying, but still small failures remain.  The main problem I still did not solve. <br><br>  And then it dawned on me.  Due to the fact that during the upgrade, I redefined the array with the list of players, ‚ÄúAngulyarka‚Äù believed that it receives new objects, even if the values ‚Äã‚Äãin their keys were completely identical.  This stupid mistake cost me more than one hour of digging into the docks and furious treys.  The only thing that was required of me was to change the values ‚Äã‚Äãinside the objects of the array. <br>  In the end, I decided to make a hybrid version: I returned the scroll, but I updated the elements at the mercy of the bindings, and finally got what I wanted: a fast and concise controller that could later be easily expanded. <br><br>  The final template looked like this: <br><br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"list-players"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-repeat</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"player in listPlayers"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-class-odd</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"'odd'"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{ 'highlighted': player.highlighted, 'obs': player.observing, 'empty': player.empty }"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ObservePlayer(player.nickname)"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"place"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-bind</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"player.place"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"nickname"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-bind</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"player.nickname"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"kills"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-bind</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"player.kills"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"deaths"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-bind</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"player.deaths"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  In the controller, too, everything is quite simple: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>, index, player, $li; i &lt; $scope.listSize; i++) { index = startIndex + i; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> $player = $scope.listPlayers[i]; $player.empty = !player; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$player.empty) { $player.highlighted = player.id == focusOnPlayer $player.observing = player.status == <span class="hljs-number"><span class="hljs-number">3</span></span>; $player.place = !$player.empty ? index + <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-string"><span class="hljs-string">''</span></span>; $player.nickname = player.nickname || <span class="hljs-string"><span class="hljs-string">''</span></span>; $player.deaths = player.deaths !== <span class="hljs-literal"><span class="hljs-literal">undefined</span></span> ? player.deaths : <span class="hljs-string"><span class="hljs-string">''</span></span>; $player.kills = player.kills !== <span class="hljs-literal"><span class="hljs-literal">undefined</span></span> ? player.kills : <span class="hljs-string"><span class="hljs-string">''</span></span>; } }</code> </pre><br><br><h4>  ng-class and ng-style against sprites </h4><br>  Having finished this small but rather tedious refactoring, I finally proceeded to the main thing: adding features.  My task was to display the rank icon next to the player‚Äôs nickname, and also the medals at the end of the round if he took the first three places.  With medals, everything is quite simple, I just added the value of medal to $ player: 0 - no medal, 1 - gold, etc., the following element was added to the template: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">i</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"medal-icon-small"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{ 'medal-gold': player.medal == 1, 'medal-silver': player.medal == 2, 'medal-bronze': player.medal == 3 }"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">i</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Those.  I just add a class depending on the value received.  There is no class - and instead of an icon only emptiness. <br>  But what to do if you need to choose not from three icons, but from ten.  And if out of a hundred or a thousand?  There are 14 ranks in the game, and creating a separate class for each rank is at least time consuming.  A string of classes will clutter up both the template and the controller if we transfer it to the function.  However, the function can be used, and here the ng-style came to the rescue: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">i</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"rank-icon-small"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"getRankStyle(player.rank)"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">i</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  In getRankStyle, the rank value is simply transferred, and it already returns the desired style: <br><br><pre> <code class="javascript hljs">$scope.getRankStyle = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">index</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-string"><span class="hljs-string">'background-position'</span></span>: <span class="hljs-string"><span class="hljs-string">'0px '</span></span> + -(index * <span class="hljs-number"><span class="hljs-number">16</span></span>) + <span class="hljs-string"><span class="hljs-string">'px'</span></span> }; }</code> </pre><br><br>  If desired, this feature can be made even more universal.  Instead of magic, pass the height to which you should retreat.  Or even the width of the sprite, if you want to group the icons in the form of a square.  If we use one big sprite for all graphics on the site, then we can set the initial indent.  Application is limited only by common sense and imagination of the developer. <br>  In the same way, by the way, I made a presentation of the character skins and visualization of the server status.  However, the first one came out even a little more difficult, because along with the background-position I also returned background-image, because the way to the picture from which preview sprites were taken had to come from the server. <br><br><h4>  Underwater rocks </h4><br>  For all its merits, AngularJS has a number of significant drawbacks, and ironically, they are not inside the framework itself, but inside the heads of its developers.  On the one hand, this is a complete lack of desire to bring the documentation to a readable form.  You can start acquaintance with it only after you have already understood the basic principles of the framework, and want to get a better understanding of the details.  On the other hand, there is too much difference between the stable and unstable versions, and even more: some features may simply not work in the compressed version provided on the official website. <br><br>  It should also be attentive to the work of binding.  In the first example, I made a rather stupid mistake by turning to an array, and not to its elements.  This applies to everything: instead of a large number of values ‚Äã‚Äãin the scope itself, it is better to group them into categories in separate objects (the same forms, for example). <br><br>  It would probably be worthwhile to talk about how to effectively organize the structure of the project, but this is already a topic for a separate article. <br><br>  <b>PS:</b> someone probably already guessed that the article deals with the <a href="http://bombermine.com/">Bombermine</a> project, in which, as I said, I have been working recently. </div><p>Source: <a href="https://habr.com/ru/post/182348/">https://habr.com/ru/post/182348/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../182338/index.html">Intel will introduce Tizen for developers at DevConf 2013 - June 14</a></li>
<li><a href="../182340/index.html">F * - new language with dependent types for .Net</a></li>
<li><a href="../182342/index.html">The evolution of altruism and P2P</a></li>
<li><a href="../182344/index.html">About proteins and complex networks</a></li>
<li><a href="../182346/index.html">Procedural texturing: cobblestone texture generation</a></li>
<li><a href="../182352/index.html">Pitfalls of using sessions in PHP</a></li>
<li><a href="../182354/index.html">Xamarin + PCL + MVVM - how to facilitate writing mobile applications for different platforms</a></li>
<li><a href="../182356/index.html">Optimization options in C and C ++ languages</a></li>
<li><a href="../182358/index.html">Speaker Cheat Sheet, or How I Gave My First Report</a></li>
<li><a href="../182360/index.html">Yandex supported Wikidata</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>