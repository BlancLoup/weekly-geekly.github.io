<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Lobby VR. Libraries for viewing panoramas 360 *</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! VR is now in trend, the topic is topical, various projects and ways to implement the display of three-dimensional images, it seems, will soon b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Lobby VR. Libraries for viewing panoramas 360 *</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/9b0/3fc/982/9b03fc982d6fdb74e8c6c3047da34e52.jpg"><br><br>  Hello!  VR is now in trend, the topic is topical, various projects and ways to implement the display of three-dimensional images, it seems, will soon be a million.  Today our guest is Mikhail Vaisman, the founder of the company for the development of mobile applications Trinity Digital.  He volunteered to tell you about working with libraries to display 360-degree panoramas, for which we express our gratitude to him.  Okay, you all came here for an interesting experience, and not for content before kat.  ;) <br><br><a name="habracut"></a><br><h2>  What's going on here? </h2><br><img src="https://habrastorage.org/files/e3b/e33/9b3/e3be339b3b2b4fd0a5c72e9f70ac1da4.png" align="right">  Hi, Habr!  They already managed to introduce me, but the rules are rules.  I am Mikhail Vaisman.  I gained experience working with VR while working at Trinity Digital on <a href="https://play.google.com/store/apps/details%3Fid%3Dru.trinitydigital.airpano">the Airpano Virtual Travel project</a> with the Doubble team.  Airpano is an application with the ability to view VR photos and video panoramas.  In the process of work, I ran into a problem: the VR theme is not the first year in the trend, but there are no ready-made libraries that allow high-quality display of VR content.  I had to choose between writing my own solution from scratch and applying what is already on the market.  We chose a compromise option - to take the open source solution on the market and refine our goals.  The latter option has its advantages, but you should not forget about the minuses.  We tried three libraries, and this is what came of it: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Krpano - WebView based library </h2><br>  We started working with the version implemented on the basis of WebView - from the <a href="http://krpano.com/">krpano</a> library.  The reason for choosing were: <br><br><ul><li>  Quick integration into the project; <br></li><li>  Declaration of support for all Android devices with a version not lower than 4.2; <br></li><li>  Versatility, reusability for different platforms. <br></li></ul><br><br>  In reality, with the krpano library, everything was not so rosy, because krpano has a browser engine.  You can start at least with the fact that not all devices have modern chrome engines that can most effectively implement the capabilities of this library.  Most of the not-so-high-end devices worked slowly with panoramas solely due to the use of webview, and the library did not work on some of them.  As a potential solution, we tried to integrate into the application engines from Chrome and Firefox (first one, then the other - for tests).  To some extent this helped.  This thing worked everywhere, that's just ... <br><br>  As a result, the application occupied more than 100 megabytes - and this is not our files or code, but a library, plus a browser engine in the project.  The most annoying thing is that even these perversions did not help to significantly optimize the quality and speed of work - they remained at an unacceptably low level.  The crucial disadvantage of krpano was the need to program at the level of xml configurations (such configuration takes a long time and increases the development price for each panorama). <br><br><h2>  PanoramaGL - library based on OpenGL </h2><br>  After a month of attempts (or torture) with krpano, after trying several types of libraries, we stopped at panoramagl - this library worked faster than others, and did not have those critical flaws that we found in krpano.  Plus Panoramagl was easier to implement and supported work on weak devices. <br><br>  But here it was not without flaws: for example, panorama gl was an implementation based only on activity.  We had to rewrite it, add support fragments. <br><br>  In addition to the lack of support for the fragments, panoramagl found many functions that require adaptation and rewriting - in order to support our tasks: for example, the stereo mode to support the cardboard in panoramagl is not implemented.  At the same time, it is impossible to integrate the Cardboard SDK into PanoramaGL - due to the fact that the latter uses OpenGL. <br><br>  But with the help of this, it is enough just to make a basic, not quite correct version of the stereo mode - the picture is simply duplicated on two parts of the screen, without shifting the left part relative to the right. <br><br>  <b>This is how a correctly implemented stereo mode looks like - the right picture is scrolled relative to the left:</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/48f/914/75e/48f91475e89fce916351b375685ff97e.jpg"><br><br>  <b>And this is what the stereo mode that we implemented on the basis in the PanoramaGL library looks like - the right picture is identical to the left one, there is no shift between the pictures:</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/446/0b9/176/4460b9176de67d0cfc9d534fea6e13b2.png"><br><br><h2>  Mindlight library Panframe </h2><br>  Even in the process of finalizing with the panoramagl file, we had the need to add video content to the application.  In panoramagl there is no such possibility, and we again faced a dilemma: write the library itself to display video content, or use a ready-made solution.  We stopped at the conditionally-paid library <a href="http://www.panframe.com/">Panframe</a> . <br><br>  We chose it for supporting video and photo panoramas ‚Äúout of the box‚Äù, as well as for good speed of video and photo panoramas.  Everything worked fine even on typical "average", not to mention the flagships.  Working with her is a pleasure. <br><br><h4>  Use the library to display the video </h4><br><br>  1. Specify permission: <br><br><pre><code class="java hljs">&lt;uses-permission android:name=<span class="hljs-string"><span class="hljs-string">"android.permission.INTERNET"</span></span>/&gt; &lt;uses-permission android:name=<span class="hljs-string"><span class="hljs-string">"android.permission.WRITE_EXTERNAL_STORAGE"</span></span>/&gt;</code> </pre> <br><br>  2. Initialize the view: <br><br><pre> <code class="java hljs">PFView vrView = PFObjectFactory.view(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   .     activity PFView vrView = PFObjectFactory.vr(this); //        .     activity.     PFAsset asset = PFObjectFactory.assetFromUri(this, Uri.parse(filename), this); //   : ,   ,  PFAssetObserver      vrView.displayAsset(asset); //    viewContainer.addView(vrView.getView(), 0); // view  layout. viewContainer ‚Äî ViewGroup  layout asset.play();//  </span></span></code> </pre><br><br>  <b>The argument list is simple:</b> <br><blockquote>  PFView - view object with 360 content; <br><br>  PFAssetObserver contains the signature of the onStatusMessage method with two parameters: <br><br>  PFAsset - content interface with control method signatures: <br><ul><li>  void play (); <br></li><li>  void stop (); <br></li><li>  void pause (); <br></li><li>  float getPlaybackTime (); <br></li><li>  void setPLaybackTime (float var1); <br></li><li>  float getDuration (); <br></li><li>  String getUrl (); <br></li><li>  PFAssetStatus getStatus (); <br></li><li>  int getDownloadProgress (); <br></li><li>  void release (); <br></li><li>  void setVolume (float var1); <br></li></ul><br><br>  There is also a PFAssetStatus - enum with a set of statuses: <br><ul><li>  LOADED; <br></li><li>  PLAYING; <br></li><li>  PAUSED; <br></li><li>  STOPPED; <br></li><li>  COMPLETE; <br></li><li>  DOWNLOADING; <br></li><li>  DOWNLOADED; <br></li><li>  DOWNLOADCANCELLED; <br></li><li>  ERROR; <br></li><li>  BUFFERING; <br></li><li>  BUFFERFULL. <br></li></ul><br></blockquote><br><br><h4>  Image display example </h4><br>  With panoramic photos, everything is also not bad, just instead of PFAsset, it is enough to use the injectImage (Bitmap image) or injectImageFromResource (int id) method <br>  Moreover, if you set setMode () with type 1, the data will not be displayed: <br><br><pre> <code class="java hljs">vrView = PFObjectFactory.view(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); vrView.injectImageFromResource(R.raw.geysers_1); container.addView(vrView.getView(), <span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><br><br>  The library also supports animated hotspot: <br><blockquote>  PFHotspot hp = vrView.createHotspot (BitmapFactory.decodeResource (getResources (), R.raw.hotspot));  //R.raw.hotspot - hotspot image id <br>  hp.setCoordinates (60, 40, 0); <br>  hp.setClickListener (this);  // as a parameter, an object is passed that implements the PFHotspotClickListener interface <br><br>  PFHotspot - interface with method signatures to manage <br>  void setEnabled (boolean var1); <br>  void setSize (float var1); <br>  void setCoordinates (float var1, float var2, float var3);  polar coordinates in degrees <br>  void setTag (int var1); <br>  int getTag (); <br>  void setClickListener (PFHotspotClickListener var1); <br>  void animate ();  // animates hotspot throttling animation <br><br>  PFHotspotClickListener - a simple interface with the onclick method with the PFHotspot parameter <br></blockquote><br><br><h4>  Something else </h4><br>  PFView has a setMode method with the following parameters: <br><blockquote>  mode: <br>  0 - spherical panorama; <br>  1 is a flat image; <br>  2 - for two cameras (for vr it is not necessary to specify separately). <br><br>  aspect: The aspect ratio of the content for a flat image. <br><br>  setFormat: <br>  0 - spherical panorama; <br>  1 - top-down formatted spherical panorama <br><br>  To specify the navigation method (gyroscope or touch), use the vrView.setNavigationMode method with the PFNavigationMode parameter: <br><br>  MOTION - Gyro Navigation <br>  TOUCH - navigation tachem <br></blockquote><br><br>  Of the obvious disadvantages: the source code of the library is obfuscated - it will be difficult to read and expand the functionality;  it is impossible to understand the text of errors.  In combination <br>  with slow answers from the library developer (We have been waiting for more than three months to answer the question: ‚ÄúHow to add cardboard mode‚Äù) - the solution of panframe as the main photo and video library in the application turned out to be difficult in terms of expansion for further operation and product improvement. <br><br><h2>  Google's VR View </h2><br>  The library for displaying VR content from Google was introduced in March 2016.  I followed the development of the library with interest, and at the Google I / O 2016 conference I paid special attention to lectures on the topic of VR, and also talked with Google developers about the library development plans.  You can integrate the library into your product as follows. <br><br>  Download Google VR from this link link: <br>  <a href="https://developers.google.com/vr/android/get-started">developers.google.com/vr/android/get-started#using_android_studio</a> <br>  And also pick up the Release notes of the latest library versions: <br>  <a href="https://developers.google.com/vr/android/release-notes">developers.google.com/vr/android/release-notes#cardboard_sdk_for_android_v070</a> <br><br>  The Google VR SDK contains several aar libraries: <br><ul><li>  audio <br></li><li>  base <br></li><li>  common <br></li><li>  commonwidget <br></li><li>  controller <br></li><li>  panowidget <br></li><li>  videowidget <br></li></ul><br><br>  and several sample projects: <br><ul><li>  controllerclient - an example for daydream controller <br></li><li>  simplepanowidget - an example of using 360 images of VrPanoramaView <br></li><li>  simplevideowidget - an example of using 360 VrVideoView video <br></li><li>  treasurehunt - an example of using GL scenes via GvrView <br></li></ul><br><br>  To use the VrPanoramaView in our project, perform the following steps: <br><ul><li>  Import libraries: common, commonwidget, panowidget; <br></li><li>  Add view (com.google.vr.sdk.widgets.pano.VrPanoramaView) to layout; <br></li><li>  Call the VrPanoramaView.loadImageFromBitmap method, taking as arguments: <br></li></ul><br><br>  Public class VrPanoramaView is inherited from VrWidgetView and contains VrPanoramaRenderer and VrPanoramaEventListener, public class VrWidgetView is inherited from FrameLayout and contains a GL-scene and control buttons. <br><br>  We also need these guys: <br><ul><li>  VrPanoramaEventListener, inherited from VrEventListener, is a simple class containing several methods; <br></li><li>  onLoadSuccessJni; <br></li><li>  onLoadErrorJni; <br></li><li>  onLoadSuccess - if the Bitmap was successfully loaded; otherwise, onLoadError; <br></li><li>  onClick; <br></li><li>  onDisplayModeChanged; <br></li></ul><br><br>  The VrPanoramaRenderer class with packet access is inherited from VrWidgetView and implements the Bitmap download, after which it calls the panowidget.aar panorenderer native arm library. <br><br>  Public abstract VrWidgetView implements the Renderer interface and calls native methods on Renderer events - the openGl interface with the signatures of the onSurfaceCreated, onSurfaceChanged, onDrawFrame methods. <br><br>  Thus, you can quickly (in three steps) deploy an application that supports displaying a simple bitmap image with the ability to view in MONO and STEREO mode with the Google interface.  However, if you need to implement dynamic content, for example, displaying markers on top of a Bitmap, reading a camera, subscribing to renderer events, then VrPanoramaView does not provide these capabilities, so in order to extend the functionality you will have to edit the panorenderer native library. <br><br>  For our project in GVR there was not enough support for the transition between panoramas through the labels set on one or another point of the panoramas.  VR View developers suggest sending feature requests for the features you need to the library repository on github.  The main intrigue is whether google will develop a library one level higher than the MVP and maintain functionality for complex projects.  We do not know the answer yet, but already now you can add well-working VR capabilities to your project in 10 minutes, a year ago it was hard to imagine. <br><br><h2>  findings </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/2ac/865/f6a/2ac865f6a926700b9eec43a7008fa5dd.jpg"><br><br>  The VR library market is not keeping up with demand, but the ice has already started, the team has set off and everything.  The process is unstoppable: the developers have become available the first good libraries for technical tasks in VR projects, ready to use out of the box.  Below is a brief summary of the pros and cons of these solutions: <br><br><table><tbody><tr><td>  Library <br></td><td>  pros <br></td><td>  Minuses <br></td></tr><tr><td>  KRpano <br></td><td>  Quick integration into the project; <br><br>  Cross platform <br></td><td>  Slow work on old devices; <br><br>  Complete failure of work on a number of devices. <br></td></tr><tr><td>  PanoramaGL <br></td><td>  Relatively fast integration into the project; <br><br>  Support not only the most basic functionality, but also, for example, the transition between panoramas; <br><br>  Not a bad speed of panoramas on slow devices. <br><br></td><td>  Long not supported (the last commit was two years ago); <br><br>  Incorrect stereo mode; <br><br>  No support for Cardboard SDK. <br></td></tr><tr><td>  Panframe <br></td><td>  Support 360-degree video panoramas; <br><br>  Good performance of panoramas on slow devices. <br></td><td>  The closeness of the source code; <br><br>  Conditionally-paid; <br><br>  Slow / missing support answers. <br></td></tr><tr><td>  VR View <br></td><td>  Fast integration capability; <br><br>  Basic MVP capabilities; <br><br>  Good speed of panoramas on slow devices <br><br>  Google support; <br><br>  The ability to leave the feature request to add the necessary features. <br></td><td>  The library does not yet support functions beyond MVP <br><br>  (for example, image overlay on top of a panorama, transition between panoramas). <br></td></tr></tbody></table><br><br>  Conclusions - if you need to quickly integrate VR into your application, whether it is a specific project sharpened for VR, or any other application where it would be interesting to add VR - you can use VR View from Google. <br><br>  If your project needs support for complex effects and advanced features (image overlay, transitions, etc.) - use the Panframe + Panoramagl configuration, but be prepared for the fact that you have to sweat a little and add these libraries to the needs of your project.  The alternative is to wait for the development of GVR.  Make the feature request of the functions you need - the likelihood is that they will be added either by Google itself in the next releases, or by third-party developers, Since the library is laid out as an open source project. <br><br>  That's all, thank you for your attention, if you have questions - ask, I will be happy to answer. <br><br></div><p>Source: <a href="https://habr.com/ru/post/306246/">https://habr.com/ru/post/306246/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../306236/index.html">How to set up an extensible system for regression testing on phones: the experience of mobile Mail.Ru Mail</a></li>
<li><a href="../306238/index.html">5 cool things in the processes of the American company</a></li>
<li><a href="../306240/index.html">Mobile Help: Aruba Mobile Engagement</a></li>
<li><a href="../306242/index.html">Machine Learning with TMVA (ROOT)</a></li>
<li><a href="../306244/index.html">Email advertising is a marvel of marketing from BazaarEmail</a></li>
<li><a href="../306248/index.html">Greedy download in Yii2, for those who want to understand what it is</a></li>
<li><a href="../306250/index.html">Who was Ramanujan?</a></li>
<li><a href="../306252/index.html">Efficient caching. From theory to practice</a></li>
<li><a href="../306254/index.html">Visit 4 data centers per day and do not regret the time spent</a></li>
<li><a href="../306256/index.html">Prospects for native advertising in Russia and the world</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>