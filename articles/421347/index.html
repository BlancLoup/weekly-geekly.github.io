<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>CORS, CSP, HTTPS, HSTS: About Web Security Technologies</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The author of the material, the translation of which we publish today, says that there are many reasons to study web security. For example, users of w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>CORS, CSP, HTTPS, HSTS: About Web Security Technologies</h1><div class="post__text post__text-html js-mediator-article">  The author of the material, the translation of which we publish today, says that there are many reasons to study web security.  For example, users of web sites who are concerned about the possibility of theft of their personal data are interested in security issues.  Security is concerned with web developers who strive to increase the level of protection for the projects they create.  The same can be said about novice programmers who are looking for work and preparing for interviews.  The purpose of this article is to explain some important web security technologies in an understandable language.  Before we start talking about these technologies, at the mention of which they usually operate on abbreviations like CORS, CSP and HSTS, consider a couple of basic security concepts. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e0d/7a4/609/e0d7a4609c250bdc7fa841769a475b32.jpg" alt="image"></div><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Two basic web security concepts</font> </h2><br><h3>  <font color="#3AC1EF">‚ñç100% protection is a myth</font> </h3><br>  In the security world, there is no such thing as ‚Äú100% protection against hacking‚Äù.  If anyone ever tells you about this level of protection, know that he is mistaken. <br><br><h3>  <font color="#3AC1EF">‚ñçA level of protection is not enough</font> </h3><br>  Suppose someone believes that by implementing CSP, he completely protected his project from XSS attacks.  It is possible that someone perceives that absolute protection does not exist as a given, but thoughts like the one described above can be visited by anyone.  If we talk about programmers who have decided to understand security issues, then perhaps the reason for the emergence of such thoughts is the fact that, when writing software code, they mainly operate with such concepts as "black" and "white", 1 and 0, "true" and "false."  But security is not so simple. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  <font color="#3AC1EF">Web Security Technologies</font> </h2><br>  Let's start a conversation about web security with technology, to which developers usually pay attention very early, say, at the very beginning of their professional path.  By the way, if you set a goal to bypass this protection method, on StackOverflow you can find a lot of information about how to do this.  This is about CORS. <br><br><h3>  <font color="#3AC1EF">‚ñçCORS</font> </h3><br>  Have you ever seen such an error: <br><br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">No</span></span> <span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Origin'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">header</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> present <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> the requested resource. Origin <span class="hljs-string"><span class="hljs-string">'null'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> therefore <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> allowed <span class="hljs-keyword"><span class="hljs-keyword">access</span></span>.</code> </pre> <br>  When you meet with a similar one, you think that you are certainly not the first with whom it happened.  Googling, you find out that, in order to solve this problem, it is enough to install some kind of extension.  Isn't it great?  However, the CORS (Cross-Origin Resource Sharing) technology, the sharing of resources between different sources, does not exist in order to prevent developers, but in order to protect their projects. <br><br>  In order to understand how CORS allows you to protect web projects, we first talk about cookies, in particular, cookies used to authenticate users.  Such cookies are used, when working with a certain web resource, to inform the server that the user is logged in.  They are automatically sent with requests made to the corresponding server. <br><br>  Suppose you are logged in to your Facebook account, with Facebook using authentication cookies.  While working on the Internet, you click on the bit.ly/r43nugi link, you are redirected to a malicious website, say, to something like <code>superevilwebsite.rocks</code> .  The script, loaded with the page of this site, performs a client request to <code>facebook.com</code> using your authentication cookie. <br><br>  In a world without CORS, a script with <code>superevilwebsite.rocks</code> could secretly make changes to your FB profile, could steal some information, with all the ensuing consequences.  In such a world, an ‚Äúepidemic superevilwebsite.rocks‚Äù could easily arise, when a script that seizes user account management publishes a link on its page, clicking on which friends of this user ‚Äúinfect‚Äù themselves, and through the links published on their pages, an epidemic As a result, covers the entire Facebook. <br><br>  However, in a world where there is CORS, Facebook would only allow requests to change account data from the source <code>facebook.com</code> .  In other words, the site administration would limit the sharing of resources between different sources. <br><br>  Here you may have the following question: ‚ÄúBut superevilwebsite.rocks can simply change the source title in its queries, and they will look like they are coming from facebook.com?‚Äù. <br><br>  A fraudulent site may try to do this, but it will not work, as the browser will ignore such a header and use real data. <br><br>  ‚ÄúWhat if superevilwebsite.rocks performs a similar request from the server?‚Äù, You ask. <br><br>  In such a situation, CORS can be bypassed, but there will be no sense from this, since, by executing a request from the server, it will not be possible to transfer the Facebook authentication cookie.  Therefore, the script, for the successful execution of such a request, must be executed on the client side and have access to the cookies stored on the client. <br><br><h3>  <font color="#3AC1EF">‚ñçCSP</font> </h3><br>  In order to understand what is CSP (Content Security Policy, content protection policy), you first need to talk about one of the most common web vulnerabilities.  This is XSS (cross-site scripting, crossite scripting). <br><br>  When performing an XSS attack, an attacker injects special JavaScript code into the client part of a certain site.  You might think: ‚ÄúSo what will this script do?  Change the colors of the page elements? <br><br>  Suppose that someone successfully implemented his JS script into the pages of the site you visited.  What dangerous can make such a script?  In fact, a lot of things: <br><br><ul><li>  It can perform HTTP requests to other sites, pretending to be you. </li><li>  It can redirect you to a site that looks exactly like the one you are logged in to, but designed, for example, to steal credentials. </li><li>  It is able to add <code>&lt;script&gt;</code> tags to pages that contain some JavaScript code or are designed to load some JS files. </li><li>  It can add an <code>&lt;iframe&gt;</code> element to the page, which will, for example, look exactly the same as the fields for entering the name and password to access the site.  At the same time, the real fields for entering such data will be hidden. </li></ul><br>  In fact, the possibilities offered to an attacker with a successful XSS attack are endless. <br><br>  The content protection policy attempts to prevent this by applying the following restrictions: <br><br><ul><li>  Restrictions on what can be opened in the <code>&lt;iframe&gt;</code> . </li><li>  Restrictions on which style sheets can be loaded. </li><li>  Restrictions on what queries can be performed. </li></ul><br>  How does the CSP work? <br><br>  When you click a link or enter a website URL in the address bar of your browser, the browser makes a GET request.  The request comes to the server, which sends the browser some HTML-code along with the HTTP headers.  If you are interested in looking at these headers, open the Network tab in the browser‚Äôs developer tools and visit several sites.  The response header might look something like this: <br><br><pre> <code class="hljs markdown">content-security-policy: default-src <span class="hljs-bullet"><span class="hljs-bullet">* data: blob:;script-src *</span></span>.facebook.com <span class="hljs-emphasis"><span class="hljs-emphasis">*.fbcdn.net *</span></span>.facebook.net <span class="hljs-emphasis"><span class="hljs-emphasis">*.google-analytics.com *</span></span>.virtualearth.net <span class="hljs-emphasis"><span class="hljs-emphasis">*.google.com 127.0.0.1:*</span></span> <span class="hljs-emphasis"><span class="hljs-emphasis">*.spotilocal.com:*</span></span> 'unsafe-inline' 'unsafe-eval' <span class="hljs-emphasis"><span class="hljs-emphasis">*.atlassolutions.com blob: data: 'self';style-src data: blob: 'unsafe-inline' *</span></span>;connect-src <span class="hljs-emphasis"><span class="hljs-emphasis">*.facebook.com facebook.com *</span></span>.fbcdn.net <span class="hljs-emphasis"><span class="hljs-emphasis">*.facebook.net *</span></span>.spotilocal.com:<span class="hljs-bullet"><span class="hljs-bullet">* wss://*</span></span>.facebook.com:<span class="hljs-bullet"><span class="hljs-bullet">* https://fb.scanandcleanlocal.com:*</span></span> <span class="hljs-emphasis"><span class="hljs-emphasis">*.atlassolutions.com attachment.fbsbx.com ws://localhost:*</span></span> blob: *.cdninstagram.com 'self' chrome-extension://boadgeojelhgndaghljhdicfkmllpafd chrome-extension://dliochdbjfkdbacpmhlcpmleaejidimm;</code> </pre> <br>  This is the <code>facebook.com</code> content security policy.  Let's transform it to a more readable form: <br><br><pre> <code class="hljs markdown">content-security-policy: default-src <span class="hljs-bullet"><span class="hljs-bullet">* data: blob:; script-src *</span></span>.facebook.com <span class="hljs-emphasis"><span class="hljs-emphasis">*.fbcdn.net *</span></span>.facebook.net <span class="hljs-emphasis"><span class="hljs-emphasis">*.google-analytics.com *</span></span>.virtualearth.net <span class="hljs-emphasis"><span class="hljs-emphasis">*.google.com 127.0.0.1:*</span></span> <span class="hljs-emphasis"><span class="hljs-emphasis">*.spotilocal.com:*</span></span> 'unsafe-inline' 'unsafe-eval' <span class="hljs-emphasis"><span class="hljs-emphasis">*.atlassolutions.com blob: data: 'self'; style-src data: blob: 'unsafe-inline' *</span></span>; connect-src <span class="hljs-emphasis"><span class="hljs-emphasis">*.facebook.com facebook.com *</span></span>.fbcdn.net <span class="hljs-emphasis"><span class="hljs-emphasis">*.facebook.net *</span></span>.spotilocal.com:<span class="hljs-bullet"><span class="hljs-bullet">* wss://*</span></span>.facebook.com:<span class="hljs-bullet"><span class="hljs-bullet">* https://fb.scanandcleanlocal.com:*</span></span> <span class="hljs-emphasis"><span class="hljs-emphasis">*.atlassolutions.com attachment.fbsbx.com ws://localhost:*</span></span> blob: *.cdninstagram.com 'self' chrome-extension://boadgeojelhgndaghljhdicfkmllpafd chrome-extension://dliochdbjfkdbacpmhlcpmleaejidimm;</code> </pre> <br>  Consider the CSP directives presented here: <br><br><ul><li>  <code>default-src</code> - prohibits everything that is not explicitly specified. </li><li>  <code>script-src</code> - imposes restrictions on downloadable scripts. </li><li>  <code>style-src</code> - imposes restrictions on loadable style sheets. </li><li>  <code>connect-src</code> - introduces restrictions on URLs from which resources can be loaded using script interfaces, such as <code>fetch</code> , <code>XHR</code> , <code>ajax</code> , and so on. </li></ul><br>  Note that, in fact, there are many such directives.  The browser reads the CSP header and applies the appropriate rules within the loaded HTML file.  Properly configured directives allow only those actions that are necessary for the correct operation of the page. <br><br>  If the page has no CSP header, then no restrictions are applied to it.  The * characters in the CSP header are wildcard characters.  Such a sign can be replaced by anything, and what happens will be allowed. <br><br><h3>  <font color="#3AC1EF">‚ñçHTTPS</font> </h3><br>  Surely you've heard about HTTPS (HTTP Secure).  Perhaps you have seen something like this: ‚ÄúWhy should I worry about HTTPS if I just play the game on the site?‚Äù.  Or perhaps you‚Äôve come across this idea: ‚ÄúIf you don‚Äôt have HTTPS, then this is just insane.  In the yard in 2018!  Do not believe anyone who says that you can do without HTTPS. ‚Äù <br><br>  You may have heard that Chrome now marks the site as insecure if it does not use HTTPS. <br><br>  The main difference between HTTPS and HTTP is that, when transmitting data over HTTPS, they are encrypted, but when transmitting over HTTP they are not. <br><br>  Why is it worth paying attention to when transferring valuable data?  The thing is that when organizing data exchange over an unprotected communication channel, there is the possibility of a MITM-attack (Man In The Middle, attack of the mediator, or attack "man in the middle"). <br><br>  If you are sitting in a cafe, go to the Internet through an open Wi-Fi access point, someone, quite simply, can pretend to be a router through which all your requests and responses go.  If your data is not encrypted, the mediator can do whatever he wants with them.  Let's say it can edit HTML, CSS, or JavaScript code before it arrives from the server to your browser.  Given what we already know about XSS attacks, you can imagine what the consequences could be. <br><br>  ‚ÄúHow is this possible: my computer and server know how to encrypt and decrypt the data we exchange, and the attacker-intermediary does not?‚Äù, You ask.  This is possible through the use of the SSL (Secure Sockets Layer) protocol and the more recent TLS (Transport Layer Security) protocol.  TLS replaced SSL in 1999 as the encryption technology used in HTTPS.  TLS features are beyond the scope of this material. <br><br><h3>  <font color="#3AC1EF">‚ñçHSTS</font> </h3><br>  The HSTS technology (HTTP Strict-Transport-Security, the mechanism for forcing a secure connection via the HTTPS protocol) is quite simple.  As an example, consider the corresponding Facebook header again: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">strict</span></span>-transport-<span class="hljs-keyword"><span class="hljs-keyword">security</span></span>: max-age=<span class="hljs-number"><span class="hljs-number">15552000</span></span>; preload</code> </pre> <br>  Let's analyze it: <br><br><ul><li>  <code>max-age</code> sets the time during which the browser must forcibly transfer the user to work with the website via HTTPS. </li><li>  <code>preload</code> - for our purposes it does not matter. </li></ul><br>  This header applies only if you access the site using HTTPS.  If you work with the site via HTTP, this header is ignored.  The reason for this is quite simple: HTTP data exchange is so weakly protected that such a header cannot be trusted. <br><br>  Again, let's use Facebook as an example to demonstrate the practical usefulness of the HSTS mechanism.  Suppose you log into facebook.com for the first time and at the same time know that HTTPS is safer than HTTP, so you use this link: <code>https://facebook.com</code> .  When your browser receives HTML, it also receives a header that tells the browser that it should force you to HTTPS when performing future requests.  A month later, someone sends you an HTTP link to Facebook, <code>http://facebook.com</code> , and you click on it.  Since the month is less than the time limit of 15552000 seconds, set by the <code>max-age</code> directive, the browser sends a request for HTTPS, preventing a potential MITM attack. <br><br><h2>  <font color="#3AC1EF">Results</font> </h2><br>  Today we discussed some technologies that are commonly used to ensure the security of web projects.  We believe that security issues are very important, as they concern absolutely everyone who is connected with the Internet.  The topic of web security is huge, so you can‚Äôt say that after reading a few articles, someone will become an expert in this field or at least find out enough to effectively protect your web project or your personal data.  But, as in any other field, knowledge in the field of security, if there is a desire to receive them, is accumulated and their quantity gradually turns into quality.  Hopefully this material has contributed to your knowledge of web security. <br><br>  <b>Dear readers!</b>  Have you encountered irresponsible safety concerns from web developers? <br><br> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div><p>Source: <a href="https://habr.com/ru/post/421347/">https://habr.com/ru/post/421347/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../421337/index.html">We display the status of the settlement account on the chart</a></li>
<li><a href="../421339/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ328 (August 20 - 26, 2018)</a></li>
<li><a href="../421341/index.html">Valve wants to run all Windows games on Linux</a></li>
<li><a href="../421343/index.html">Protecting Microsoft Office 365 Cloud Data with Veeam Solution</a></li>
<li><a href="../421345/index.html">Angular: unobvious directive selectors</a></li>
<li><a href="../421351/index.html">The theory of happiness. The curse of the director and damn printers</a></li>
<li><a href="../421353/index.html">3D-reconstruction of people on the photos and their animation using video. Lecture in Yandex</a></li>
<li><a href="../421355/index.html">Go 1.11 is released - WebAssembly and Native modules</a></li>
<li><a href="../421357/index.html">To the question of the impossible. Part 3</a></li>
<li><a href="../421359/index.html">Festival as a game. Taxonomy IT</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>