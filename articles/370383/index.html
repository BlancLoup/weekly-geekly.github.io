<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>New nooLite-F system with feedback and encryption</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The other day, the modules of the nooLite-F company Noeotechnica for testing and integration with the Arduino Mega Server arrived at the Hi-Lab.ru lab...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>New nooLite-F system with feedback and encryption</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/d63/bd2/900/d63bd290022743a0959bc8a21a8b491d.jpg" alt="nooLite-F"><br><br>  The other day, the modules of the <strong>nooLite-F</strong> company <a href="http://www.noo.com.by/">Noeotechnica</a> for testing and integration with the <a href="https://hi-lab.ru/arduino-mega-server">Arduino Mega Server</a> arrived at the Hi-Lab.ru laboratory and I offer you a small summary of the new system, your opinion about it and simple Arduino code examples for managing new devices . <br><br>  This article is one of the first signs on this system and I think that soon you will see many other reports about it, but for now the hottest and most up-to-date first-hand information. <br><a name="habracut"></a><br><h2>  What is nooLite? </h2><br>  For those who didn‚Äôt know or forgot, let me remind you that nooLite is a wireless control system for electrical equipment, such as lighting in your house or electrical appliances that can be turned on and off using wireless control panels.  The consoles have a lot of options, but mostly they look like ordinary lighting switches.  Control blocks that accept commands are small boxes with several wires, some of which are connected to the supply voltage, and some - to the load. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Simple and clear.  Thanks to this simplicity, the nooLite system has gained popularity and is sold in a large number of online and offline stores.  But there is one "but."  The nooLite system is good for everyone, but it has one (and even two) significant drawbacks.  The first is the lack of serious encryption of transmitted commands and data.  For most household applications, this is not very critical, but for many people it is unacceptable from the point of view of security - there is at least a small, but not zero, chance that you will be unlucky and someone of hooligan or criminal considerations decides to open your connection and control your equipment. <br><br>  The second drawback is the lack of feedback in the system (there is a true pseudo-feedback with the help of special blocks, but this is not very serious).  What does it mean?  This means that you, having given the command to turn on something, cannot be sure that this command is really carried out, and did not leave a trace on the world air. <br><br>  This is exactly the new version of the system called nooLite-F.  Talk of the need to release a new version has been going on for a long time, and finally, the first devices of the new series are on sale. <br><br><h2>  Few technical details </h2><br>  From a technical point of view, the nooLite system is a receiving-transmitting device operating at a frequency of 433 MHz and using amplitude modulation of the transmitted signal.  The choice of amplitude modulation is due to the fact that, according to the manufacturer of the system, this is a simple and poorly susceptible to interference method of transmitting commands over a short distance.  The system uses PIC controllers (12, 16, 18).  The power consumption of devices is small and the consoles and sensors of the system operate on batteries. <br><br>  In the new system nooLite-F, the operating frequency remains the same, 433 MHz, and more importantly, compatibility with the old version of the equipment has been preserved.  That is, you can work with conventional nooLite devices using nooLite-F control modules. <br><br>  In the new system, the modulation has changed to frequency, but, surprisingly, this does not prevent the new devices from working with old ones that use amplitude modulation.  How is this possible?  Engineers of the company had to slightly modify the transceiver of new modules to work simultaneously with both types of modulation. <br><br>  New transceivers have better sensitivity and, as a result, approximately 30% greater communication range. <br><br><h2>  Security and Encryption </h2><br>  The nooLite-F system uses strong encryption according to the AES standard, which should reliably secure the operation and use of this equipment.  In turn, work with encryption required an increase in computational power and made it necessary to switch to PIC 32 controllers. But this is still an energy efficient solution and the units and modules of the system can run on batteries for a long time. <br><br><h2>  Available equipment </h2><br>  At the moment, three devices of the new system are available for purchase: <br><br><ul><li>  Adapter MTRF-64-USB for control via USB interface from a computer </li><li>  MTRF-64 module for control using controllers with UART interface </li><li>  Wireless power unit SLF-1-300 </li></ul><br>  We will conduct our experiments with the power block SLF-1-300 and the module MTRF-64. <br><br>  Only three products are a temporary phenomenon - the company plans to release a whole line of nooLite-F system equipment, including DIN-rail devices. <br><br><img src="https://habrastorage.org/files/6d5/765/c00/6d5765c0055d457c9e0089bd0692c900.jpg" alt="SRF-10-1000"><br><br><h2>  Power block SLF-1-300 </h2><br>  Externally, the power units of the new system are no different from the usual nooLite units.  The same neat casing and the same multiple wires for connecting power and load. <br><br><img src="https://habrastorage.org/files/254/a40/ee5/254a40ee57e2431e963880ca0020e5c9.jpg" alt="Power block SLF-1-300"><br><br>  The block contents look a bit more interesting.  On the left in the picture you can see two microcircuits - one (smaller) is a transceiver microcircuit, exact marking: <br><br>  <strong>MRF49XA</strong> <strong><br></strong>  <strong>1637</strong> <strong><br></strong>  <strong>RG3</strong> <br><br>  and the second chip of the controller controlling the unit, precise marking <br><br>  <strong>STI E4 7B572</strong> <strong><br></strong>  <strong>32F030F4P6</strong> <strong><br></strong>  <strong>PHL 648 A</strong> <br><br><img src="https://habrastorage.org/files/2df/80a/8f4/2df80a8f4d8d40eaac4ead8c1600bfa0.jpg" alt="SLF-1-300 board"><br><br>  Everything is very compact and neat.  This is the long-awaited nooLite with encryption and feedback. <br><br>  The reverse side of the board is almost completely covered with a radiator. <br><br><img src="https://habrastorage.org/files/04a/fc4/0d4/04afc40d48964177bd4db6fb6c673139.jpg" alt="Reverse side of the SLF-1-300"><br><br>  What is under the radiator can be seen by looking at the power unit board on the side: a few volume parts that do not fit on the reverse side of the board.  That's all circuitry. <br><br><img src="https://habrastorage.org/files/0da/71c/0e7/0da71c0e75b74e999c0a671f45226d4d.jpg" alt="SLF-1-300 side view"><br><br><h2>  MTRF-64 module </h2><br>  As I have already said, we will consider the MTRF-64 module with a UART interface, we will not touch its fellow with a USB connection, they are almost identical, except for a few details which will be discussed below.  Photo control module: <br><br><img src="https://habrastorage.org/files/937/645/997/937645997f0e44f0a94008d5c8dc072a.jpg" alt="MTRF-64"><br><br>  As you can see, it is very similar to the power unit, the same chips, quartz and a few more details.  Here is the exact marking of the chips installed on the board.  Transceiver: <br><br>  <strong>MRF49XA</strong> <strong><br></strong>  <strong>1636</strong> <strong><br></strong>  <strong>M5H</strong> <br><br>  Microcontroller: <br><br>  <strong>STI E4 7B573</strong> <strong><br></strong>  <strong>32F042F6P6</strong> <strong><br></strong>  <strong>PHL 648 A</strong> <br><br>  The empty place for the missing chip is the place to install the FTDI USB-UART adapter.  The place for installing the USB connector is immediately visible - it is obvious that the same PCB is used for both devices. <br><br>  Now, a little about connecting the module to microcontrollers in general and to Arduino in particular: for the operation of the module it is enough to connect only four wires - RX, TX, VCC, GND.  Simply, as they say, nowhere. <br><br><img src="https://habrastorage.org/files/6e5/8f5/3a7/6e58f53a73c844b59cae6bb402d3b887.png" alt="Wiring diagram MTRF-64"><br><br>  For those who not only read articles, but do something with their own hands, I note that the module is powered strictly from 3.3 volts and its conclusions are not tolerant to 5-volt signals, so keep this in mind and be careful when connecting the module . <br><br>  A little about the functional module.  It has four main modes of operation: <br><br><ul><li>  Transmitter for "old" nooLite system devices.  This is an analogue of the functionality of the module nooLite <a href="https://geektimes.ru/post/269100/">MT1132</a> </li><li>  Receiver for ‚Äúold‚Äù nooLite system devices.  Analogue of the module nooLite <a href="https://geektimes.ru/post/274520/">MR1132</a> </li><li>  Transmitter for new equipment nooLite-F </li><li>  Receiver for new equipment nooLite-F </li></ul><br>  That is, this module is a universal solution for the interaction of microcontrollers with the nooLite system.  Plus, unlike its counterparts, it has the ability to work with 64 channels, instead of 32. <br><br><h2>  Arduino and nooLite-F </h2><br>  Now let's analyze a simple example that will give you an idea of ‚Äã‚Äãworking with this module in the Arduino environment.  By analogy, you can organize work with this module with any other system. <br><br>  The module interacts with the controlling controller via a serial interface (Serial) at a speed of 9600 bps.  Since the MTRF-64 only works with a voltage of 3.3 V, we will set aside our beloved Arduino Mega and take the Arduino Due from the shelf and connect the module to it.  Four wiring and everything is ready.  For communication with the module we will use Serial3. <br><br><ul><li>  The output of the RX module is connected to the Arduino Due TX3 (14). </li><li>  The output of the TX module is connected to the RX3 (15) Arduino Due. </li></ul><br>  Now you can write a test demo sketch.  Let's start with the setup () function. <br><br><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Serial.begin(<span class="hljs-number"><span class="hljs-number">115200</span></span>); Serial.println(); Serial.println(F(<span class="hljs-string"><span class="hljs-string">"NooLite-F test"</span></span>)); Serial3.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>); delay(<span class="hljs-number"><span class="hljs-number">1</span></span>); bootOut(); <span class="hljs-comment"><span class="hljs-comment">// Commands: // 0 - Off // 2 - On // 4 - Switch // 9 - Unbind //15 - Bind setCommand(0); setChannel(0); setChecksum(); Serial.print(F("CH: ")); Serial.println(TO_MTRF[4]); Serial.print(F("CMD: ")); Serial.println(TO_MTRF[5]); Serial.print(F("CHECKSUM: ")); Serial.println(TO_MTRF[15]); mtrfSend(); delay(100); }</span></span></code> </pre> <br>  We start Serial to display debugging messages and Serial3 to work with the MTRF-64 module.  At the start, the module enters the software update mode for 12 seconds and to interrupt this mode we enable the function <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bootOut</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt;= <span class="hljs-number"><span class="hljs-number">16</span></span>; i++) { Serial3.write(BOOT_OUT[i]); } }</code> </pre><br>  Which sends magic data to the module, taking it out of the software update mode. <br>  Next, we form the command: <br><br><pre> <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">// Commands: // 0 - Off // 2 - On // 4 - Switch // 9 - Unbind //15 - Bind</span></span></code> </pre><br>  In fact, there are much more teams; you can find a complete description of the protocol and the operation of the module in the <a href="http://www.noo.com.by/assets/files/PDF/MTRF-64.pdf">document</a> on the manufacturer‚Äôs website. <br><br>  Next, we display test messages about the channel, the command and the checksum of the package.  This completes the initial setup () procedure and the sketch enters the infinite loop loop (). <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//setBind(); //setUnbind(); //setOn(); //setOff(); setSwitch(); delay(1000); }</span></span></code> </pre><br>  Here are five lines that trigger the sending of a command to the MTRF-64 module.  You must select any one command and run the sketch (the other commands must be commented out).  You need to start with the command to bind the power block to the setBind () module. <br><br>  Binding procedure: <br><br><ul><li>  Press the button on the power unit - the LED starts blinking on it </li><li>  Run the sketch with the uncommented line setBind () </li><li>  Confirm the binding by pressing the button on the power unit again </li></ul><br>  Everything, now you comment on the line setBind () and uncomment, for example, the line setSwitch (), start the sketch and the test lamp connected to the power block, starts to flash once a second.  This is just a test case and based on this sketch, you can create any system of control of nooLite devices, arbitrarily complex. <br><br>  A little more about the work of the sketch.  The code forms the contents of the TO_MTRF array in accordance with the documentation for MTRF-64, the link to which I gave a little higher.  Next, the contents of this array are sent over the serial interface directly to the module. <br><br>  After that, the response of the module is expected and the FROM_MTRF array is filled with incoming data, then this array is analyzed and pre-programmed decisions are made. <br><br>  Here is the purpose of the other functions of the test sketch: <br><br>  <strong>setChannel (byte ch)</strong> - sets the desired channel number (0 - 63). <br>  <strong>setCommand (byte cmd)</strong> - sets the desired command. <br>  <strong>setChecksum ()</strong> - calculates the checksum of the <strong>package</strong> . <br>  <strong>mtrfSend ()</strong> - sending data. <br>  <strong>mtrfReceive ()</strong> - reception and parsing of module responses. <br><br>  Thus, you can tie and untie devices on any channel, turn on, turn off and switch the light using Arduino and MTRF-64.  Let me remind you once again that this is only a demonstration of work and an example for further development. <br><br><div class="spoiler">  <b class="spoiler_title">Full code of the test sketch control MTRF-64 using Arduino</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/* * NooLite-F * MTRF-64 test Sketch */</span></span> <span class="hljs-comment"><span class="hljs-comment">// 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 byte BOOT_OUT[17] = {171, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,175,172}; byte TO_MTRF[17] = {171, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,172}; byte FROM_MTRF[17]; //          void bootOut() { for (byte i = 0; i &lt;= 16; i++) { Serial3.write(BOOT_OUT[i]); } } void setChannel(byte ch) { TO_MTRF[4] = ch; } void setCommand(byte cmd) { TO_MTRF[5] = cmd; } void setChecksum() { TO_MTRF[15] = 0; //   for (byte i = 0; i &lt;= 14; i++) { TO_MTRF[15] += TO_MTRF[i]; } } void mtrfSend() { for (byte i = 0; i &lt;= 16; i++) { Serial3.write(TO_MTRF[i]); } delay(50); mtrfReceive(); } void setOff() { setCommand(0); setChecksum(); mtrfSend(); } void setOn() { setCommand(2); setChecksum(); mtrfSend(); } void setSwitch() { setCommand(4); setChecksum(); mtrfSend(); } void setBind() { setCommand(15); setChecksum(); mtrfSend(); } void setUnbind() { setCommand(9); setChecksum(); mtrfSend(); } void setup() { Serial.begin(115200); Serial.println(); Serial.println(F("NooLite-F test")); Serial3.begin(9600); delay(1); bootOut(); // Commands: // 0 - Off // 2 - On // 4 - Switch // 9 - Unbind //15 - Bind setCommand(0); setChannel(0); setChecksum(); Serial.print(F("CH: ")); Serial.println(TO_MTRF[4]); Serial.print(F("CMD: ")); Serial.println(TO_MTRF[5]); Serial.print(F("CHECKSUM: ")); Serial.println(TO_MTRF[15]); mtrfSend(); delay(100); } void loop() { //setBind(); //setUnbind(); //setOn(); //setOff(); setSwitch(); delay(1000); } void printFromMTRF() { Serial.println(); for(byte i = 0; i &lt; 17; i++) { Serial.print(FROM_MTRF[i]); Serial.print(" "); } Serial.println(); } void mtrfReceive() { if (Serial3.available() &gt; 0) { Serial3.readBytes(FROM_MTRF, 17); if (FROM_MTRF[0] == 173 &amp;&amp; FROM_MTRF[1] == 2 &amp;&amp; FROM_MTRF[16] == 174) { //printFromMTRF(); Serial.print(F("Receive: ")); if (FROM_MTRF[10] != 0 &amp;&amp; FROM_MTRF[2] == 0) {Serial.println(F("On!"));} if (FROM_MTRF[10] == 0 &amp;&amp; FROM_MTRF[2] == 0) {Serial.println(F("Off!"));} if (FROM_MTRF[2] == 1) {Serial.println(F("Error!"));} } else { Serial.println(F("Receive error or bind")); printFromMTRF(); } } }</span></span></code> </pre><br></div></div><br><h2>  Conclusion </h2><br>  This brief review did not include a story about many of the functions of the new system, for example, firmware over the air, remote attachment and many other features - everything cannot be covered in one review article, but I am sure that other nooLite-F articles from the set will appear soon fans and enthusiasts of automation. <br><br>  Now my opinion on the new system nooLite-F.  Definitely, this is a big step forward for the company Nootech.  The difference between the old system and the new one is big - encryption makes it secure, and the feedback allows you to be confident in the execution of the commands given.  And all this brings nooLite to a new level and allows you to build serious automation projects on this system. </div><p>Source: <a href="https://habr.com/ru/post/370383/">https://habr.com/ru/post/370383/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../370371/index.html">Made in USSR: Werther, Lunokhod, and other robots</a></li>
<li><a href="../370375/index.html">What do scientists think about Neuralink - the company of neural interfaces Ilona Mask</a></li>
<li><a href="../370377/index.html">The boom of music streaming services associated with shortening and accelerating tracks</a></li>
<li><a href="../370379/index.html">Drone telegram</a></li>
<li><a href="../370381/index.html">First</a></li>
<li><a href="../370385/index.html">China in 3D - 3D printers are made here.</a></li>
<li><a href="../370387/index.html">Moral panic: Facebook is accused of insufficiently effective censorship</a></li>
<li><a href="../370391/index.html">6 services that make life easier for freelancers</a></li>
<li><a href="../370393/index.html">Baidu creates an open platform for robots</a></li>
<li><a href="../370395/index.html">Ant Financial as one of the favorites of the global mobile payment race</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>