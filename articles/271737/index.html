<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Floating toolbar for text selection in Android Marshmallow: parsing innovations</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In Andriod, when you select text, a menu appears with actions that you can perform: Cut, Copy, Submit. Android Marshmallow (SDK 23) has the opportunit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Floating toolbar for text selection in Android Marshmallow: parsing innovations</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/bcd/17f/b80/bcd17fb800ad4e8e6972b999a875c2f0.gif" align="right"><br>  In Andriod, when you select text, a menu appears with actions that you can perform: Cut, Copy, Submit.  Android Marshmallow (SDK 23) has the opportunity to expand this menu and give the user easy access to additional features when working with the text: "Translate", "Comment", "Quote". <br><br>  In preparation for speaking at the <a href="http://habrahabr.ru/company/google/blog/270287/">GDG</a> conference <a href="http://habrahabr.ru/company/google/blog/270287/">in Nizhny Novgorod,</a> I discovered that this new feature is extremely poorly documented, the only available article is not <a href="http://habrahabr.ru/company/google/blog/270287/">entirely</a> true, and there are vanishingly few examples on the Internet of using this feature.  I had to figure it out myself.  The results of the study and I want to share.  This can save you a lot of time. <br><a name="habracut"></a><br>  Since various menus in Android appeared evolutionarily, it‚Äôs easiest to start the story ‚Äúfrom the stove‚Äù.  Developers with experience can boldly flip right through to the <a href="https://habr.com/ru/post/271737/">‚ÄúNew‚Äù</a> section without any risk of missing anything.  If that - then come back.  Younger developers can find useful examples in practice under spoilers. <br><br><h1>  Old </h1><br><h2>  The first.  Vulgaris menu </h2><br><div class="spoiler">  <b class="spoiler_title">The story about the oldest regular menu.</b>  <b class="spoiler_title">With examples and screenshots</b> <div class="spoiler_text">  The menus in Android are quite similar: they are described using <a href="http://developer.android.com/guide/topics/resources/menu-resource.html">XML</a> , then at the right time the corresponding objects are created in memory according to this description using <a href="http://developer.android.com/reference/android/view/MenuInflater.html">MenuInflater</a> , this menu is displayed, and information about clicking on the corresponding element comes to callback. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The usual menu, which at times was called by pressing the hardware key ‚ÄúMenu‚Äù, is described in the application resources as an XML file. <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">menu</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/action_foo"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:orderInCategory</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/word_foo"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/action_foobar"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:orderInCategory</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"101"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/word_bar"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/action_baz"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:orderInCategory</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"102"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/word_baz"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">menu</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Menu items will be sorted by field android: orderInCategory. <br><br>  The menu is created by invoking the inflater in the <a href="http://developer.android.com/reference/android/app/Activity.html">onCreateOptionsMenu ()</a> method. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateOptionsMenu</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Menu menu)</span></span></span><span class="hljs-function"> </span></span>{ MenuInflater inflater = getMenuInflater(); inflater.inflate(R.menu.my_menu, menu); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }</code> </pre><br>  Information on the selection of a menu item falls into the <a href="http://developer.android.com/reference/android/app/Activity.html">onOptionsItemSelected ()</a> method. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onOptionsItemSelected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MenuItem item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Handle item selection switch (item.getItemId()) { case R.id.action_foo: toast("foo"); return true; case R.id.action_foobar: toast("bar"); return true; case R.id.action_baz: toast("baz"); return true; default: return super.onOptionsItemSelected(item); } }</span></span></code> </pre><br>  Everything described above leads to the following menu: <br><br><img src="https://habrastorage.org/files/655/1e8/452/6551e84522c144349b10f9787aa5e35b.png"><br><br>  Everything is simple and familiar. <br></div></div><br><h2>  The second.  Context menu </h2><br><div class="spoiler">  <b class="spoiler_title">The story about the context menu.</b>  <b class="spoiler_title">With examples and screenshots</b> <div class="spoiler_text">  The context menu is a floating menu that appears when you long click on any element of the interface.  This element must be previously registered to work with the context menu. <br><br>  Context menus are most often used when working with lists.  But this story would be more about lists than about menus, so we leave it outside the article.  Examples will be without them. <br><br>  Consider a simple example. <br><br>  You can register an item, for example, in <a href="http://developer.android.com/reference/android/app/Activity.html">onCreate ()</a> : <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ ... registerForContextMenu(findViewById(R.id.text_view_one)); }</code> </pre><br>  Then everything is similar to the previous item, only inside other methods ( <a href="http://developer.android.com/reference/android/app/Activity.html">onCreateContextMenu ()</a> and <a href="http://developer.android.com/reference/android/app/Activity.html">onContextItemSelected ()</a> ): <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateContextMenu</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContextMenu menu, View v, ContextMenu.ContextMenuInfo menuInfo)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreateContextMenu(menu, v, menuInfo); MenuInflater inflater = getMenuInflater(); inflater.inflate(R.menu.my_menu, menu); }</code> </pre><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onContextItemSelected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MenuItem item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (item.getItemId()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> R.id.action_foo: toast(<span class="hljs-string"><span class="hljs-string">"foo"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> R.id.action_foobar: toast(<span class="hljs-string"><span class="hljs-string">"bar"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> R.id.action_baz: toast(<span class="hljs-string"><span class="hljs-string">"baz"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onContextItemSelected(item); } }</code> </pre><br>  With a long click on the element with the text context menu appears. <br><br><div class="spoiler">  <b class="spoiler_title">Screenshot</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/173/ee9/001/173ee9001be24a08ae91f7aad0f5431b.png"><br></div></div><br></div></div><br><h2>  Third.  Menu in AppBar and Toolbar </h2><br><div class="spoiler">  <b class="spoiler_title">The story about the menu with the Toolbar.</b>  <b class="spoiler_title">With examples and screenshots</b> <div class="spoiler_text">  Starting with Android Honeycomb (aka 3.0, it‚Äôs SDK 11, that is, also quite a long time ago), the hardware Menu button was abolished, and the menu was displayed in the ‚Äúaction bar‚Äù, which is also the ‚Äúapplication bar‚Äù.  It was possible to display some of the menu items in this line as icons, and leave some of them hidden before clicking on the menu icon to the right. <br><br>  Fields for describing icons and locations added XML with a description of the menu.  Otherwise, it remains the same menu with the known <a href="http://developer.android.com/reference/android/app/Activity.html">onCreateOptionsMenu ()</a> and <a href="http://developer.android.com/reference/android/app/Activity.html">onOptionsItemSelected ()</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Menu with icons and location.</b>  <b class="spoiler_title">Added android: icon and android: orderInCategory</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">menu</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:app</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/action_foo"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:icon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@android:drawable/ic_media_previous"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:orderInCategory</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/word_foo"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:showAsAction</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ifRoom"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/action_foobar"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:icon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@android:drawable/ic_media_next"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:orderInCategory</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"101"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/word_bar"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:showAsAction</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ifRoom"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/action_baz"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:icon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@android:drawable/ic_media_pause"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:orderInCategory</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"102"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/word_baz"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:showAsAction</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"never"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">menu</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br><table><tbody><tr><td><img src="https://habrastorage.org/files/7b2/51a/57e/7b251a57ea4c4cc0a9470149bc3f3fa1.png"><br>  Visible part of the menu <br></td><td><img src="https://habrastorage.org/files/fa2/756/066/fa2756066e284dd99dd1760099d5ff0c.png"><br>  Hidden part of the menu <br>  if you click on the "three points" <br></td></tr></tbody></table><br><br>  At this level, people usually know about the menu after the first newcomer book.  Thank you for having enough patience to read this far, it will be more interesting further. <br></div></div><br><a name="contextaction"></a><br><h2>  Fourth.  Contextual action mode </h2><br><div class="spoiler">  <b class="spoiler_title">Story about contextual action mode.</b>  <b class="spoiler_title">With examples and screenshots</b> <div class="spoiler_text">  The context action mode, also known as the ‚ÄúContextual action mode‚Äù, allows you to show the user a set of actions that can be performed on the selected item.  Like the context menu, this tool is convenient when working with lists, but we do not consider lists in this article. <br><br>  In order to consider the operation of this mode, we need an element that you can "choose."  Take for example <a href="http://developer.android.com/reference/android/widget/ToggleButton.html">ToggleButton</a> .  This mode the application activates itself, respectively, do it when the status of the ToggleButton changes: <br><br><pre> <code class="java hljs">checkedListener = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CompoundButton.OnCheckedChangeListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCheckedChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CompoundButton buttonView, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isChecked)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isChecked) { actionMode = startActionMode(actionModeCallback); actionMode.setTitle(<span class="hljs-string"><span class="hljs-string">"Action Mode"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (actionMode != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { actionMode.finish(); } } } }; toggleButton.setOnCheckedChangeListener(checkedListener);</code> </pre><br>  actionModeCallback is an instance of the <a href="http://developer.android.com/reference/android/view/ActionMode.Callback.html">ActionMode.Callback</a> class that contains callbacks for working with menus.  The menu remains the same, all with the same good old mechanics: <br><br><pre> <code class="java hljs">actionModeCallback = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ActionMode.Callback() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateActionMode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ActionMode mode, Menu menu)</span></span></span><span class="hljs-function"> </span></span>{ MenuInflater inflater = mode.getMenuInflater(); inflater.inflate(R.menu.my_menu_two, menu); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } ... <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDestroyActionMode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ActionMode mode)</span></span></span><span class="hljs-function"> </span></span>{ actionMode = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; toggleButton.setChecked(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); } };</code> </pre><br>  Notice the value that we store in the actionMode variable.  This is an instance of the <a href="http://developer.android.com/reference/android/view/ActionMode.html">ActionMode</a> class, we need it in order to be able to change the title ( <a href="http://developer.android.com/reference/android/view/ActionMode.html">actionMode.setTitle ()</a> ), the subtitle ( <a href="http://developer.android.com/reference/android/view/ActionMode.html">actionMode.setSubtitle ()</a> ), and also complete this mode ( <a href="http://developer.android.com/reference/android/view/ActionMode.html">actionMode.finish ()</a> ).  After the action is completed, the mode does not automatically end, and if we need to, we must complete it ourselves. <br><br>  The selection of the user is also processed in the usual way: <br><br><pre> <code class="java hljs">actionModeCallback = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ActionMode.Callback() { ... <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onActionItemClicked</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ActionMode mode, MenuItem item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (item.getItemId()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> R.id.action_compass: toast(<span class="hljs-string"><span class="hljs-string">"compass"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> R.id.action_camera: toast(<span class="hljs-string"><span class="hljs-string">"camera"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } } };</code> </pre><br>  The menu for contextual actions should obviously differ from the main one, so we will create another XML with a description. <br><br><div class="spoiler">  <b class="spoiler_title">XML with menu description.</b>  <b class="spoiler_title">Same in structure, but with other points</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">menu</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:app</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/action_camera"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:icon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@android:drawable/ic_menu_camera"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:orderInCategory</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/word_camera"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:showAsAction</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ifRoom"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/action_compass"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:icon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@android:drawable/ic_menu_compass"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:orderInCategory</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"101"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/word_compass"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:showAsAction</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ifRoom"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">menu</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  We get this behavior: <br><table><tbody><tr><td><img src="https://habrastorage.org/files/1ae/a4f/5d7/1aea4f5d7c53497793e268156c26a13e.png"><br></td><td><img src="https://habrastorage.org/files/152/e34/521/152e3452195c4cf8baccc662ecfb71e0.png"><br></td></tr></tbody></table><br>  Everything old, that is, known at least with the SDK 11 is now over, the unknown has begun. <br></div></div><br><a name="new"></a><br><h1>  New </h1><br>  In Android Marshmallow (aka 6.0, aka SDK 23), two innovations appeared in the menu.  Both of these innovations are not yet supported by the Support Library and only work on devices with SDK 23. Therefore, before calling the methods that appeared, you need to check the SDK number of the device on which the application is running. <br><br>  For the convenience of the story, we will get rid of these checks by specifying minSdkVersion 23. <br><br><h2>  The fifth.  Another context menu </h2><br>  The method for creating the <a href="https://habr.com/ru/post/271737/">‚ÄúContext Action Mode‚Äù</a> (described above) has been extended.  The second parameter <a href="http://developer.android.com/reference/android/app/Activity.html">startActionMode ()</a> can pass a constant that specifies the type of display. <br><br>  The value of <a href="http://developer.android.com/reference/android/view/ActionMode.html">ActionMode.TYPE_PRIMARY</a> corresponds to the old behavior.  That is, <a href="http://developer.android.com/reference/android/app/Activity.html">startActionMode (actionModeCallback)</a> and <a href="http://developer.android.com/reference/android/app/Activity.html">startActionMode (actionModeCallback, ActionMode.TYPE_PRIMARY)</a> are the same. <br><br>  If you specify the type <a href="http://developer.android.com/reference/android/view/ActionMode.html">ActionMode.TYPE_FLOATING</a> , the menu takes the following form: <br><br><img src="https://habrastorage.org/files/3df/573/0d0/3df5730d0aac4d1384aeff3e96de1e82.png"><br><br>  No icons.  Location - horizontal. <br><br>  If there are so many points that they do not fit in width, then the familiar ‚Äúthree points‚Äù will appear: <br><table><tbody><tr><td><img src="https://habrastorage.org/files/279/48b/4ee/27948b4eefc84563adcf0a7181ea336d.png"><br></td><td><img src="https://habrastorage.org/files/a99/53b/fd8/a9953bfd84384747864b39930989b873.png"><br></td></tr></tbody></table><br>  Everything else is exactly the same as in <a href="https://habr.com/ru/post/271737/">‚ÄúContextual action mode‚Äù</a> (see above). <br><br><h2>  The sixth.  Expansion of the menu when selecting text </h2><br>  And finally, what was promised in the <a href="http://developer.android.com/intl/ru/about/versions/marshmallow/android-6.0-changes.html">article on innovations in Android Marshmallow</a> .  Now you can add a menu to the menu that appears when you select text.  The animated picture of this miracle was at the very beginning of the article, but if you want, it is again under the spoiler. <br><br><div class="spoiler">  <b class="spoiler_title">Animated picture from the menu</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/cae/2cd/fcf/cae2cdfcf86141b5aadd709d13a38a33.gif"><br></div></div><br><h3>  Implementation </h3><br>  To achieve this effect, you first need to create a <a href="http://developer.android.com/reference/android/view/ActionMode.Callback.html">callback</a> inherited from ActionMode.Callback.  That is, it is completely analogous to what we created in the two sections above for the <a href="https://habr.com/ru/post/271737/">‚ÄúContextual action mode‚Äù</a> . <br><br>  Further, for all elements in which we want to expand the menu when editing, you need to specify this callback: <br><br><pre> <code class="java hljs">textView.setTextIsSelectable(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); textView.setCustomSelectionActionModeCallback(actionModeCallback); editText.setCustomSelectionActionModeCallback(actionModeCallback); editText.setCustomInsertionActionModeCallback(actionModeCallback);</code> </pre><br>  The <a href="http://developer.android.com/reference/android/widget/TextView.html">callback</a> specified in <a href="http://developer.android.com/reference/android/widget/TextView.html">setCustomSelectionActionModeCallback ()</a> will be used if there is selected text.  Specified in <a href="http://developer.android.com/reference/android/widget/TextView.html">setCustomInsertionActionModeCallback ()</a> - if there is no text.  Separated them because not all actions make sense when nothing is selected, and, accordingly, the contents of the appearing menu should be different. <br><table><tbody><tr><td><img src="https://habrastorage.org/files/4e6/16c/36b/4e616c36b1954b09bf89d5f05e804943.png"><br></td><td><img src="https://habrastorage.org/files/30e/ed7/51b/30eed751b8ba41df99affdc52ab45291.png"><br></td></tr></tbody></table><br>  On an empty EditText it looks like this: <br><table><tbody><tr><td><img src="https://habrastorage.org/files/57d/236/751/57d2367516824e2b8af5d3bb01a29f10.png"><br></td><td><img src="https://habrastorage.org/files/419/227/8b4/4192278b4f7f4298b391a210ca0d055c.png"><br></td></tr></tbody></table><br><br><h3>  Oh.  Where did my menu go? </h3><br>  Look at the screenshots below.  Any idea where all the added menu items are? <br><table><tbody><tr><td><img src="https://habrastorage.org/files/44d/5b8/589/44d5b8589ac549b2b41e2211d1797552.png"><br></td><td><img src="https://habrastorage.org/files/c6f/d69/c99/c6fd69c996374252be53855f7026037b.png"><br></td></tr></tbody></table><br>  A hint can be found here: <br><br><img src="https://habrastorage.org/files/aa7/268/934/aa72689341c0488fb39141330f9f7ef5.png"><br><br>  I will explain.  It is likely that the remaining items will not fit in the second, vertical part of the menu either.  And there will be a scroll.  In the screenshots above it happened. <br><br>  The problem is that the user doesn‚Äôt see any signs of scrolling: the scrolling icon disappears almost immediately, and the edge of the unclaimed item doesn‚Äôt look.  I got the bug, let's see what the creators of this feature say.  <a href="https://code.google.com/p/android/issues/detail%3Fid%3D195043">code.google.com/p/android/issues/detail?id=195043</a> <br><br><h3>  Where did my menu go again? </h3><br><img src="https://habrastorage.org/files/0d2/e0e/5ad/0d2e0e5adeee4be597c07900bb7838be.png"><br><br>  This time there is another problem: the menu does not expand with fullscreen input mode as described above.  I found only one workout: turn off fullscreen mode using android: imeOptions = "flagNoExtractUi". <br><br><h3>  How to place your item before the standard? </h3><br>  Native menu items have order parameters from 1 to 5. Therefore, using the android: orderInCategory in the menu description, you cannot set the position before the native items.  But you can change the order of items in the already formed menu, for example, like this: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPrepareActionMode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ActionMode mode, Menu menu)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    ""  1, //   ""  100 while (menu.getItem(0).getOrder() &lt; 100) { MenuItem item = menu.getItem(0); menu.removeItem(item.getItemId()); //    ""  200,   //    menu.add(item.getGroupId(), item.getItemId(), item.getOrder() + 200, item.getTitle()); } return true; }</span></span></code> </pre><br>  We get the result: <br><table><tbody><tr><td><img src="https://habrastorage.org/files/c77/54b/352/c7754b35275c4192a0e5f7de2a204dc0.png"><br></td><td><img src="https://habrastorage.org/files/c5d/f68/4fa/c5df684fa47248cfae4248273b825541.png"><br></td></tr></tbody></table><br><h3>  Oddities in the documentation </h3><br>  There is no normal documentation for expanding the menu when selecting text.  There is an <a href="http://developer.android.com/intl/ru/about/versions/marshmallow/android-6.0-changes.html">article</a> already mentioned, an <a href="http://developer.android.com/intl/ru/about/versions/marshmallow/android-6.0-changes.html">article about Android Marshmallow updates</a> . <br><br>  I reread this place several dozen times, but I could not relate what is written there to practice.  I tell in order. <br><br><img src="https://habrastorage.org/files/fe4/764/3bb/fe47643bb9ea4057a932ebc025632552.png"><br><br>  If you read this article or tried it yourself, you noticed that <a href="http://developer.android.com/reference/android/app/Activity.html">startActionMode (callback, ActionMode.TYPE_FLOATING)</a> does create a floating toolbar, but not at all for selection.  And for selection it creates <a href="http://developer.android.com/reference/android/widget/TextView.html">setCustomSelectionActionModeCallback ()</a> . <br><br><img src="https://habrastorage.org/files/990/5b5/6e9/9905b56e9eca41d9b7c37e8adce01a82.png"><br><br>  The second incomprehensible instruction.  The <a href="http://developer.android.com/reference/android/app/Activity.html">setCustomSelectionActionModeCallback ()</a> method of the <a href="http://developer.android.com/reference/android/widget/TextView.html">android.widget.TextView</a> class expects to receive an <a href="http://developer.android.com/reference/android/view/ActionMode.Callback.html">ActionMode.Callback</a> . <br><br><img src="https://habrastorage.org/files/da0/8d0/2d2/da08d02d251e483395913afeb99d457b.png"><br><br>  <a href="">android.googlesource.com/platform/frameworks/base/+/master/core/java/android/widget/TextView.java</a> <br><br>  If you look at <a href="">android.widget.Editor</a> , then the mCustomSelectionActionModeCallback field is also of type <a href="http://developer.android.com/reference/android/view/ActionMode.Callback.html">ActionMode.Callback</a> : <br><br><img src="https://habrastorage.org/files/63a/2ca/45d/63a2ca45d68f41f2a5c9869f78b8622e.png"><br><br>  And nowhere in this code is it expected that custom callback will be of type <a href="http://developer.android.com/reference/android/view/ActionMode.Callback2.html">ActionMode.Callback2</a> . <br>  <a href="">android.googlesource.com/platform/frameworks/base/+/master/core/java/android/widget/Editor.java</a> <br><br>  The article continues to talk hard about how to use <a href="http://developer.android.com/reference/android/view/ActionMode.Callback2.html">ActionMode.Callback2</a> : <br><br><img src="https://habrastorage.org/files/30b/305/001/30b305001022424e9e1bb668957d5db9.png"><br><br>  My guess is that a fragment of some internal documentation on <a href="http://developer.android.com/reference/android/view/ActionMode.Callback2.html">ActionMode.Callback2</a> got into the article due to an editor's oversight.  Do you have any other hypothesis, write about it. <br><br><h1>  Example </h1><br>  The entire code from this article can be found on <a href="https://github.com/JollyDroid/MenuExample">GitHub</a> . </div><p>Source: <a href="https://habr.com/ru/post/271737/">https://habr.com/ru/post/271737/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../271727/index.html">Draw, draw, draw: Inkscape 0.92 coming soon</a></li>
<li><a href="../271729/index.html">PythonDigest - issue number 100 and other great news</a></li>
<li><a href="../271731/index.html">OOP in 1C do it yourself. How to simulate your classes and objects, and why it is needed</a></li>
<li><a href="../271733/index.html">Why would a developer scoff at his own code</a></li>
<li><a href="../271735/index.html">Writing data to Teradata using DML</a></li>
<li><a href="../271739/index.html">PostCSS quick start</a></li>
<li><a href="../271741/index.html">Welcome to GDG DevFest Omsk 2015</a></li>
<li><a href="../271745/index.html">Successful implementation of SIEM. Part 1</a></li>
<li><a href="../271747/index.html">Asterisk: Prioritizing VoIP traffic and reserving Internet access from two providers on MikroTik</a></li>
<li><a href="../271749/index.html">DotNext - Conference on .NET-technologies, Moscow, December 11</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>