<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Python Testing with pytest. Configuration, CHAPTER 6</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Back Next 


 In this chapter, we will look at configuration files that affect pytest, discuss how pytest changes its behavior based on them, and make...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Python Testing with pytest. Configuration, CHAPTER 6</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://habr.com/ru/post/448794/">Back</a> <a href="https://habr.com/ru/post/448798/">Next</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p><br><p>  <em>In this chapter, we will look at configuration files that affect pytest, discuss how pytest changes its behavior based on them, and make some changes to the Tasks project configuration files.</em> </p><br><p><img src="https://habrastorage.org/webt/hd/--/9w/hd--9w134j0rxhmxftrflbbdopy.png"></p><a name="habracut"></a><br><p>  The examples in this book are written using Python 3.6 and pytest 3.2.  pytest 3.2 supports Python 2.6, 2.7 and Python 3.3+. </p><br><blockquote>  The source code for the Tasks project, as well as for all the tests shown in this book, is available via the <a href="https://pragprog.com/titles/bopytest/source_code" title="https://pragprog.com/titles/bopytest/source_code">link</a> on the book's web page at <a href="https://pragprog.com/titles/bopytest" title="https://pragprog.com/titles/bopytest">pragprog.com</a> .  You do not need to download the source code to understand the test code;  The test code is presented in a convenient form in the examples.  But to follow along with the project objectives, or to adapt test examples to test your own project (your hands are untied!), You should go to the book‚Äôs web page and download the work.  In the same place, on the book‚Äôs web page there is a link for <a href="https://pragprog.com/titles/bopytest/errata" title="https://pragprog.com/titles/bopytest/errata">errata</a> messages and a <a href="https://forums.pragprog.com/forums/438" title="https://forums.pragprog.com/forums/438">discussion forum</a> . </blockquote><p>  Under the spoiler is a list of articles in this series. </p><br><div class="spoiler">  <b class="spoiler_title">Table of contents</b> <div class="spoiler_text"><ul><li>  <a href="https://habr.com/ru/post/426699/"><strong>Introduction</strong></a> </li><li>  <a href="https://habr.com/ru/post/448782/"><strong>Chapter 1: Getting Started with pytest</strong></a> </li><li>  <a href="https://habr.com/ru/post/448788/"><strong>Chapter 2: Writing Test Functions</strong></a> </li><li>  <a href="https://habr.com/ru/post/448786/"><strong>Chapter 3: Pytest Fixtures</strong></a> </li><li>  <a href="https://habr.com/ru/post/448792/"><strong>Chapter 4: Builtin Fixtures</strong></a> </li><li>  <a href="https://habr.com/ru/post/448794/"><strong>Chapter 5: Plugins</strong></a> </li><li>  <a href="https://habr.com/ru/post/448796/"><strong>Chapter 6: Configuration</strong></a> (This article) </li><li>  <a href="https://habr.com/ru/post/448798/"><strong>Chapter 7: Using pytest with other tools</strong></a> </li></ul></div></div><br><h2 id="konfiguraciya">  Configuration </h2><br><p>  So far in this book, I've talked about various non-test files that affect pytest mainly in passing, with the exception of conftest.py, which I discussed in some detail in chapter 5, Plugins, on page 95. In this chapter, we will look at configuration files that affect pytest, discuss how pytest changes its behavior based on them, and make some changes to the Tasks project configuration files. </p><br><h2 id="ponimanie-faylov-konfiguracii-pytest">  Understanding pytest configuration files </h2><br><p>  Before I tell you how you can change the default behavior in pytest, let's go over all non-test files in pytest and, in particular, who should take care of them. </p><br><p>  You should know the following: </p><br><ul><li> <em>pytest.ini</em> : This is the main Pytest configuration file that allows you to change the default behavior.  Since you can make quite a few configuration changes, most of this chapter is about settings you can make in <code>pytest.ini</code> . </li><li>  <em>conftest.py</em> : This is a local plugin that allows hook functions and fixtures to be connected for the directory in which the <code>conftest.py</code> file <code>conftest.py</code> , and for all its subdirectories.  The <code>conftest.py</code> file <code>conftest.py</code> described in Chapter 5 ‚ÄúPlugins‚Äù on page 95. </li><li>  <em><code>__init__.py</code></em> : When placed in each test subdirectory, this file allows you to have identical test file names in several test directories.  We will look at an example of what goes wrong without <code>__init__.py</code> files in the test directories in the article ‚ÄúAvoiding File Name Collisions‚Äù on page 120. </li></ul><br><p>  If you use tox, you will be interested in: </p><br><ul><li>  <em>tox.ini</em> : This file is similar to <code>pytest.ini</code> , but for <code>tox</code> .  However, you can place your <code>pytest</code> configuration <code>pytest</code> instead of having both a <code>tox.ini</code> file and a <code>pytest.ini</code> file, saving you a single configuration file.  Tox is covered in Chapter 7, ‚ÄúUsing pytest with other tools,‚Äù on page 125. </li></ul><br><p>  If you want to distribute a Python package (for example, Tasks), this file will be interesting: </p><br><ul><li>  <em>setup.cfg</em> : This is also an INI file that affects the behavior of the <code>setup.py</code> .  You can add multiple lines to <code>setup.py</code> to run the <code>python setup.py test</code> and run all your pytest tests.  If you are distributing a package, you may already have a <code>setup.cfg</code> file, and you can use this file to store the Pytest configuration.  You will see how this is done in Appendix 4, ‚ÄúPackaging and Distributing Python Projects,‚Äù on page 175. </li></ul><br><p>  Regardless of which file you put your pytest configuration into, the format will be basically the same. </p><br><p>  For <code>pytest.ini</code> : </p><br><blockquote>  <strong>ch6 / format / pytest.ini</strong> </blockquote><br><pre> <code class="plaintext hljs">[pytest] addopts = -rsxX -l --tb=short --strict xfail_strict = true ... more options ...</code> </pre> <br><p>  For <code>tox.ini</code> : </p><br><blockquote>  <strong>ch6 / format / tox.ini</strong> </blockquote><br><pre> <code class="plaintext hljs">... tox specific stuff ... [pytest] addopts = -rsxX -l --tb=short --strict xfail_strict = true ... more options ...</code> </pre> <br><p>  For <code>setup.cfg</code> : </p><br><blockquote>  <strong>ch6 / format / setup.cfg</strong> </blockquote><br><pre> <code class="plaintext hljs">... packaging specific stuff ... [tool:pytest] addopts = -rsxX -l --tb=short --strict xfail_strict = true ... more options ...</code> </pre> <br><p>  The only difference is that the section header for setup.cfg is <code>[tool:pytest]</code> instead of <code>[pytest]</code> . </p><br><h3 id="list-the-valid-ini-file-options-with-pytest-help">  List the Valid ini-file Options with pytest ‚Äìhelp </h3><br><p>  You can get a list of all valid parameters for <code>pytest.ini</code> from <code>pytest --help</code> : </p><br><pre> <code class="plaintext hljs">$ pytest --help ... [pytest] ini-options in the first pytest.ini|tox.ini|setup.cfg file found: markers (linelist) markers for test functions empty_parameter_set_mark (string) default marker for empty parametersets norecursedirs (args) directory patterns to avoid for recursion testpaths (args) directories to search for tests when no files or directories are given in the command line. console_output_style (string) console output: classic or with additional progress information (classic|progress). usefixtures (args) list of default fixtures to be used with this project python_files (args) glob-style file patterns for Python test module discovery python_classes (args) prefixes or glob names for Python test class discovery python_functions (args) prefixes or glob names for Python test function and method discovery xfail_strict (bool) default for the strict parameter of xfail markers when not given explicitly (default: False) junit_suite_name (string) Test suite name for JUnit report junit_logging (string) Write captured log messages to JUnit report: one of no|system-out|system-err doctest_optionflags (args) option flags for doctests doctest_encoding (string) encoding used for doctest files cache_dir (string) cache directory path. filterwarnings (linelist) Each line specifies a pattern for warnings.filterwarnings. Processed after -W and --pythonwarnings. log_print (bool) default value for --no-print-logs log_level (string) default value for --log-level log_format (string) default value for --log-format log_date_format (string) default value for --log-date-format log_cli (bool) enable log display during test run (also known as "live logging"). log_cli_level (string) default value for --log-cli-level log_cli_format (string) default value for --log-cli-format log_cli_date_format (string) default value for --log-cli-date-format log_file (string) default value for --log-file log_file_level (string) default value for --log-file-level log_file_format (string) default value for --log-file-format log_file_date_format (string) default value for --log-file-date-format addopts (args) extra command line options minversion (string) minimally required pytest version xvfb_width (string) Width of the Xvfb display xvfb_height (string) Height of the Xvfb display xvfb_colordepth (string) Color depth of the Xvfb display xvfb_args (args) Additional arguments for Xvfb xvfb_xauth (bool) Generate an Xauthority token for Xvfb. Needs xauth. ...</code> </pre> <br><p>  You will see all of these settings in this chapter, with the exception of the <code>doctest_optionflags</code> , which is discussed in chapter 7, ‚ÄúUsing pytest with other tools‚Äù, on page 125. </p><br><h3 id="plaginy-mogut-dobavlyat-opcii-ini-faylov">  Plugins can add ini file options </h3><br><p>  The previous list of settings is not constant.  For plugins (and conftest.py files), it is possible to add ini file options.  Added options will also be added to the pytest command output --help. <br>  Now let's take a look at some of the configuration changes that we can make using the built-in INI file settings available in core pytest. </p><br><h3 id="izmenenie-parametrov-komandnoy-stroki-po-umolchaniyu">  Changing default command line parameters </h3><br><p>  You have already used some command line options for <em>pytest</em> , such as <code>-v/--verbose</code> for verbose output of <code>-l/--showlocals</code> to view local variables with stack trace for failed tests.  You may find that you always use some of these <code>options‚Äîor</code> and prefer to use <code>them‚Äîfor a project</code> .  If you install <code>addopts</code> in <code>pytest.ini</code> for the parameters you need, then you no longer have to enter them.  Here is a set that I like: </p><br><pre> <code class="plaintext hljs">[pytest] addopts = -rsxX -l --tb=short --strict</code> </pre> <br><p>  The <code>-rsxX</code> allows the pytest installation to report the causes of all <code>skipped</code> , <code>xfailed</code> or <code>xpassed</code> tests.  The <code>-l</code> switch will allow pytest to display the stack trace for local variables in the event of each failure.  <code>--tb=short</code> will remove most of the stack trace.  However, leave the file and line number.  The <code>--strict</code> disables the use of tokens if they are not registered in the configuration file.  You will see how to do this in the next section. </p><br><h3 id="registraciya-markerov-chtoby-izbezhat-opechatok-markera">  Registration of markers to avoid typographical errors </h3><br><p>  Custom markers, as described in ‚ÄúMarking Test Functions‚Äù on page 31, are great for allowing you to mark a subset of tests to run with a specific marker.  However, it is too easy to make a mistake in the marker and eventually some tests are marked <code>@pytest.mark.smoke</code> , and some are marked <code>@pytest.mark.somke</code> .  By default, this is not an error.  pytest just thinks you created two markers.  However, this can be fixed by registering the markers in pytest.ini, like this: </p><br><pre> <code class="plaintext hljs">[pytest] ... markers = smoke: Run the smoke test test functions get: Run the test functions that test tasks.get() ...</code> </pre> <br><p>  By registering these markers, you can now also see them using <code>pytest --markers</code> with their descriptions: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch6/b/tasks_proj/tests $ pytest --markers @pytest.mark.smoke: Run the smoke test test functions @pytest.mark.get: Run the test functions that test tasks.get() @pytest.mark.skip(reason=None): skip the ... ...</code> </pre> <br><p>  If markers are not registered, they will not be displayed in the <code>--markers</code> list.  When they are registered, they are displayed in the list, and if you use <code>--strict</code> , any markers with errors or unregistered are displayed as errors.  The only difference between <code>ch6/a/tasks_proj</code> and <code>ch6/b/tasks_proj</code> is the content of the pytest.ini file.  <code>ch6/a</code> empty.  Let's try running tests without registering any markers: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch6/a/tasks_proj/tests $ pytest --strict --tb=line ============================= test session starts ============================= collected 45 items / 2 errors =================================== ERRORS ==================================== ______________________ ERROR collecting func/test_add.py ______________________ 'smoke' not a registered marker ________________ ERROR collecting func/test_api_exceptions.py _________________ 'smoke' not a registered marker !!!!!!!!!!!!!!!!!!! Interrupted: 2 errors during collection !!!!!!!!!!!!!!!!!!! =========================== 2 error in 1.10 seconds ===========================</code> </pre> <br><p>  If you use your markers, then you can at it.  You'll thank me later.  Let's go ahead and add a pytest.ini file to the tasks project: </p><br><p>  If you use markers in <code>pytest.ini</code> to register your markers, you can also add <code>--strict</code> to your <code>addopts</code> .  You will thank me later.  Let's continue and add the pytest.ini file to the task project: </p><br><p>  If you use markers in <code>pytest.ini</code> to register markers, you can also add <code>--strict</code> to existing ones with <code>addopts</code> .  Cool?!  Postpone the thanks and add the <code>pytest.ini</code> file to the <code>tasks</code> project: </p><br><blockquote>  ch6 / b / tasks_proj / tests / pytest.ini </blockquote><br><pre> <code class="plaintext hljs">[pytest] addopts = -rsxX -l --tb=short --strict markers = smoke: Run the smoke test test functions get: Run the test functions that test tasks.get()</code> </pre> <br><p>  Here is the default combination of flags: </p><br><ul><li>  <code>-rsxX</code> to report which tests skipped, xfailed, or xpassed, </li><li>  <code>--tb = short</code> for shorter tracing upon failures, </li><li>  <code>--strict</code> to allow only declared markers. <br>  And a list of markers for the project. </li></ul><br><p>  This should allow us to conduct tests, including smoke tests: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch6/b/tasks_proj/tests $ pytest --strict -m smoke ===================== test session starts ====================== collected 57 items func/test_add.py . func/test_api_exceptions.py .. ===================== 54 tests deselected ====================== =========== 3 passed, 54 deselected in 0.06 seconds ============</code> </pre> <br><h3 id="trebovanie-minimalnoy-versii-pytest">  Require Pytest Minimum Version </h3><br><p>  The <code>minversion</code> allows <code>minversion</code> to specify the minimum version of pytest expected for tests.  For example, I decided to use <code>approx()</code> when testing floating-point numbers to determine ‚Äúfairly close‚Äù equality in tests.  But this feature was not introduced in pytest prior to version 3.0.  To avoid confusion, I add the following to projects that use <code>approx()</code> : </p><br><pre> <code class="plaintext hljs">[pytest] minversion = 3.0</code> </pre> <br><p>  Thus, if someone tries to run tests using an older version of pytest, an error message will appear. </p><br><h3 id="ostanovka-pytest-ot-poiska-v-nepravilnyh-mestah">  Stop pytest from searching in the wrong places. </h3><br><p>  Did you know that one of the definitions of ‚Äúrecurse‚Äù is to swear twice in your own code?  Well no.  In fact, this means accounting subdirectories.  pytest will turn on test detection by recursively examining a bunch of directories.  But there are some directories that you want to exclude from viewing pytest. </p><br><p>  The default value for <code>norecurse</code> is <code>'. * Build dist CVS _darcs {arch} and *.egg. Having '.*'</code> <code>'. * Build dist CVS _darcs {arch} and *.egg. Having '.*'</code>  <code>'. * Build dist CVS _darcs {arch} and *.egg. Having '.*'</code> Is a good reason to name your virtual environment '.venv', because all directories starting with a dot will not be visible. </p><br><p>  In the case of the Tasks project, it does not hurt to specify <code>src</code> , because searching in test files with pytest will be a waste of time. </p><br><pre> <code class="plaintext hljs">[pytest] norecursedirs = .* venv src *.egg dist build</code> </pre> <br><p>  When overriding a parameter that already has a useful value, such as this parameter, it is useful to know what the default values ‚Äã‚Äãare and return the ones you need, as I did in the previous code with <code>*.egg dist build</code> . <br>  <code>norecursedirs</code> is a kind of consequence for test paths, so let's look at it later. </p><br><h3 id="specifikaciya-dereva-testovogo-kataloga">  test directory tree specification </h3><br><p>  While <code>norecursedirs</code> tells the pytest to drop in, <code>testpaths</code> tells the pytest where to look.  <code>testspaths</code> is a list of directories relative to the root directory for finding tests.  It is used only if no directory, file, or <code>nodeid</code> is specified as an argument. </p><br><p>  Suppose that for the <code>Tasks</code> project we put <code>pytest.ini</code> in the <code>tasks_proj</code> directory instead of tests: </p><br><pre> <code class="plaintext hljs">\code\tasks_proj&gt;tree/f . ‚îÇ pytest.ini ‚îÇ ‚îú‚îÄ‚îÄ‚îÄsrc ‚îÇ ‚îî‚îÄ‚îÄ‚îÄtasks ‚îÇ api.py ‚îÇ ... ‚îÇ ‚îî‚îÄ‚îÄ‚îÄtests ‚îÇ conftest.py ‚îÇ pytest.ini ‚îÇ ‚îú‚îÄ‚îÄ‚îÄfunc ‚îÇ test_add.py ‚îÇ ... ‚îÇ ‚îú‚îÄ‚îÄ‚îÄunit ‚îÇ test_task.py ‚îÇ __init__.py ‚îÇ ...</code> </pre> <br><p>  Then it may make sense to put the tests in <code>testpaths</code> : </p><br><pre> <code class="plaintext hljs">[pytest] testpaths = tests</code> </pre> <br><p>  Now, if you run pytest from the <code>tasks_proj</code> directory, pytest will only search for <code>tasks_proj/tests</code> .  The problem here is that during the development and debugging of tests, I often iterate through the test directory, so I can easily test a subdirectory or file without pointing all the way.  Therefore, this parameter is of little help to me in interactive testing. </p><br><p>  However, it is great for tests running from a continuous integration server or tox.  In these cases, you know that the root directory will be fixed, and you can list the directories relative to that fixed root directory.  These are also cases where you really want to shorten the testing time, so getting rid of the search for tests is great. </p><br><p>  At first glance it may seem silly to use both test paths and <code>norecursedirs</code> .  However, as you have already seen, test paths are of little help in interactive testing from different parts of the file system.  In these cases, <code>norecursedirs</code> can help.  In addition, if you have test directories that do not contain tests, you can use <code>norecursedirs</code> to avoid them.  But in fact, what's the point of putting additional directories in tests that do not have tests? </p><br><h2 id="izmenenie-pravil-obnaruzheniya-testov">  Modifying Test Detection Rules </h2><br><p>  pytest finds tests to run based on certain test detection rules.  Standard test detection rules: </p><br><p>  ‚Ä¢ Start with one or more directories.  You can specify the names of files or directories on the command line.  If you did not specify anything, the current directory is used. <br>  ‚Ä¢ Search in the catalog and in all its subdirectories test modules. <br>  ‚Ä¢ A test module is a file with a name similar to <code>test_*.py</code> or <code>*_test.py</code> . <br>  ‚Ä¢ Look at test modules for functions that start with test <em>.</em> <em><br></em>  <em>‚Ä¢ Look for classes that start with Test.</em>  <em>Look for methods in those classes that start with `test</em> <code>,    </code> <strong>init`</strong> <code>,    </code> . </p><br><p>  These are standard detection rules;  However, you can change them. </p><br><h3 id="python_classes">  python_classes </h3><br><p>  The usual rule for detecting tests for pytest and classes is to consider a class as a potential test class if it starts with <code>Test*</code> .  A class also cannot have a <code>__init__()</code> method.  But what if we want to call our test classes as <code>&lt;something&gt;Test</code> or <code>&lt;something&gt;Suite</code> ?  This is where <code>python_classes</code> comes <code>python_classes</code> : </p><br><pre> <code class="plaintext hljs">[pytest] python_classes = *Test Test* *Suite</code> </pre> <br><p>  This allows us to call classes like this: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DeleteSuite</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">()</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_delete_1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_delete_2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> ... ....</code> </pre> <br><h3 id="python_files">  python_files </h3><br><p>  Like <code>pytest_classes</code> , <code>python_files</code> modifies the default test discovery rule, which is to search for files that start with <code>test_*</code> or have at the end of <code>*_test</code> . <br>  Suppose you have a custom test framework in which you named all your test files <code>check_&lt;something&gt;.py</code> .  It seems reasonable.  Instead of renaming all your files, just add a line to <code>pytest.ini</code> as follows: </p><br><pre> <code class="plaintext hljs">[pytest] python_files = test_* *_test check_*</code> </pre> <br><p>  Very simple.  Now you can gradually transfer the naming convention if you wish, or simply leave it as <code>check_*</code> . </p><br><h3 id="python_functions">  python_functions </h3><br><p>  <code>python_functions</code> acts like the two previous settings, but for test functions and method names.  The default is <code>test_*</code> .  And to add <code>check_*</code> guessed it ‚Äî do it: </p><br><pre> <code class="plaintext hljs">[pytest] python_functions = test_* check_*</code> </pre> <br><p>  <code>pytest</code> naming <code>pytest</code> don't seem so restrictive, do they?  So if you don‚Äôt like the default naming convention, just change it.  Nevertheless, I urge you to have a more compelling reason for such decisions.  Migrating hundreds of test files is definitely a good reason. </p><br><h2 id="zapret-xpass">  XPASS ban </h2><br><p>  Setting <code>xfail_strict = true</code> results in tests marked <code>@pytest.mark.xfail</code> not being recognized as causing an error.  I think this installation should always be.  For more information about the <code>xfail</code> token <code>xfail</code> see ‚ÄúMarking Tests for <code>xfail</code> Failure‚Äù on page 37. </p><br><h2 id="predotvraschenie-konfliktov-imen-faylov">  Prevent file name conflicts </h2><br><p>  The usefulness of having the <code>__init__.py</code> file in each test subdirectory of the project confused me for a long time.  However, the difference between having them or not having them is simple.  If you have <code>__init__.py</code> files in all of your test subdirectories, you can have the same test file name in several directories.  And if not, then so do not work. </p><br><p>  Here is an example.  The directory <code>a</code> and <code>b</code> both have a file <code>test_foo.py</code> .  It doesn't matter what the files contain, but for this example they look like this: </p><br><blockquote>  <strong>ch6 / dups / a / test_foo.py</strong> <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_a</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br><br>  <strong>ch6 / dups / b / test_foo.py</strong> <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_b</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br></blockquote><p>  With this directory structure: </p><br><pre> <code class="plaintext hljs">dups ‚îú‚îÄ‚îÄ a ‚îÇ ‚îî‚îÄ‚îÄ test_foo.py ‚îî‚îÄ‚îÄ b ‚îî‚îÄ‚îÄ test_foo.py</code> </pre> <br><p>  These files do not even have the same content, but the tests are corrupted.  It will be possible to run them separately, but there is no launch of <code>pytest</code> from the <code>dups</code> directory: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch6/dups $ pytest a ============================= test session starts ============================= collected 1 item a\test_foo.py . ========================== 1 passed in 0.05 seconds =========================== $ pytest b ============================= test session starts ============================= collected 1 item b\test_foo.py . ========================== 1 passed in 0.05 seconds =========================== $ pytest ============================= test session starts ============================= collected 1 item / 1 errors =================================== ERRORS ==================================== _______________________ ERROR collecting b/test_foo.py ________________________ import file mismatch: imported module 'test_foo' has this __file__ attribute: /path/to/code/ch6/dups/a/test_foo.py which is not the same as the test file we want to collect: /path/to/code/ch6/dups/b/test_foo.py HINT: remove __pycache__ / .pyc files and/or use a unique basename for your test file modules !!!!!!!!!!!!!!!!!!! Interrupted: 1 errors during collection !!!!!!!!!!!!!!!!!!! =========================== 1 error in 0.34 seconds ===========================</code> </pre> <br><p>  Nothing is clear! <br>  This error message does not tell what went wrong. </p><br><p>  To fix this test, simply add an empty <code>__init__.py</code> file to the subdirectories.  Here is an example of the <code>dups_fixed</code> directory with the same duplicate file names, but with <code>__init__.py</code> files added: </p><br><pre> <code class="plaintext hljs">dups_fixed/ ‚îú‚îÄ‚îÄ a ‚îÇ ‚îú‚îÄ‚îÄ __init__.py ‚îÇ ‚îî‚îÄ‚îÄ test_foo.py ‚îî‚îÄ‚îÄ b ‚îú‚îÄ‚îÄ __init__.py ‚îî‚îÄ‚îÄ test_foo.py</code> </pre> <br><p>  Now let's try again from the top level in <code>dups_fixed</code> : </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch6/ch6/dups_fixed/ $ pytest ============================= test session starts ============================= collected 2 items a\test_foo.py . b\test_foo.py . ========================== 2 passed in 0.15 seconds ===========================</code> </pre> <br><p>  So it will be better. </p><br><p>  Of course, you can convince yourself that you will never have duplicate file names, so it does not matter.  Everything, like, normal.  But projects grow and test directories grow, and you definitely want to wait for it to happen to you before taking care of it?  I say, just put these files in there.  Make it a habit and don't worry about it again. </p><br><h2 id="uprazhneniya">  Exercises </h2><br><p>  In Chapter 5, Plugins, on page 95, you have created a plugin called ‚Äînest command-line option.  Let's extend that to include a pytest.ini option called nice. </p><br><p>  In Chapter 5, "Plugins" on page 95, you created a plugin called <code>pytest-nice</code> that includes the command line <code>--nice</code> .  Let's extend this by turning on the <code>pytest.ini</code> option called <code>nice</code> . </p><br><ol><li>  Add the following line to the <code>pytest_addoption</code> <code>pytest_nice.py</code> hook function: <code>parser.addini('nice', type='bool', help='Turn failures into opportunities.')</code> </li><li>  Places in the plugin that use <code>getoption()</code> will also have to call <code>getini('nice')</code> .  Make these changes. </li><li>  Check it out manually by adding <code>nice</code> to the <code>pytest.ini</code> file. </li><li>  Don't forget about plugin tests.  Add a test to make sure that the <code>nice</code> parameter from <code>pytest.ini</code> works correctly. </li><li>  Add tests to the plugins directory.  You need to find some <a href="https://docs.pytest.org/en/latest/_modules/_pytest/pytester.html">additional Pytester features</a> . </li></ol><br><h2 id="chto-dalshe">  What's next </h2><br><p>  While pytest is extremely powerful in itself ‚Äî especially with plugins ‚Äî it also integrates well with other software development and software testing tools.  In the next chapter, we will look at using pytest in combination with other powerful testing tools. </p><br><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://habr.com/ru/post/448794/">Back</a> <a href="https://habr.com/ru/post/448798/">Next</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/448796/">https://habr.com/ru/post/448796/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448786/index.html">Python Testing with pytest. CHAPTER 3 pytest Fixtures</a></li>
<li><a href="../448788/index.html">Python Testing with pytest. Chapter 2, Writing Test Functions</a></li>
<li><a href="../448790/index.html">SpaceVIL - cross-platform GUI framework for development on .Net Core, .Net Standard and JVM</a></li>
<li><a href="../448792/index.html">Python Testing with pytest. Builtin Fixtures, Chapter 4</a></li>
<li><a href="../448794/index.html">Python Testing with pytest. Plugins, CHAPTER 5</a></li>
<li><a href="../448798/index.html">Python Testing with pytest. Using pytest with other tools, CHAPTER 7</a></li>
<li><a href="../448806/index.html">Creating an extension system on the Qt library</a></li>
<li><a href="../448810/index.html">How I caught a hacker</a></li>
<li><a href="../448812/index.html">Lunar mission ‚ÄúBereshit‚Äù - the search for the first lunar library started after the accident of its carrier</a></li>
<li><a href="../448814/index.html">Bosque language is a new programming language from Microsoft</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>