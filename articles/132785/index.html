<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>HTML5: Web Workers and AJAX</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="HTML5 is entering the development environment more and more. Its important advantage is the availability of such technology as web workers, which allo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>HTML5: Web Workers and AJAX</h1><div class="post__text post__text-html js-mediator-article">  HTML5 is entering the development environment more and more.  Its important advantage is the availability of such technology as web workers, which allows to some extent to ensure, if not multi-threading, then its similarity when executing scripts. <br><br>  The essence of the technology is simple - functions that support the functioning of AJAX, or functions that process large arrays of information that reduce the speed of page construction during operation, are put into separate files.  There may be as many such files as you need.  When the script is executed on the browser side, a special Worker object is created, which is responsible for calling the necessary functions.  Many modern browsers support this technology. <a name="habracut"></a><br><br>  Now about how to use workers. <br>  Let's check the browser support for the object: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!!<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.Worker) { <span class="hljs-comment"><span class="hljs-comment">//  }</span></span></code> </pre> <br>  Creating an object is very simple: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> worker = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Worker(    );</code> </pre><br>  The object we created has the following methods: <br><br>  postMessage ();  // key method initializing data exchange <br>  onmessage ();  // method executed upon receipt of a response from the called employee. <br>  onerror ();  // method called when errors occur <br><br>  Now let's make the worker file itself and name it worker.js.  Inside we place the following code: <br><pre> <code class="javascript hljs">onmessage = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ev</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> answ = ev.data; };</code> </pre><br>  We have an object and a file, now it remains only to call it; this is done like this: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> worker = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Worker(<span class="hljs-string"><span class="hljs-string">'worker.js'</span></span>); worker.postMessage(<span class="hljs-string"><span class="hljs-string">'Hello World'</span></span>);</code> </pre><br>  The ev variable will contain an object, in the data property, which will be what we pass to the function, in our case the string 'Hello World'.  You can transmit anything, including complex objects.  Now we will make our worker return something to us.  To do this, we add the following to the employee‚Äôs code in the last line: <br><pre> <code class="javascript hljs">postMessage(answ);</code> </pre><br>  And in the main script, we define a method that will be called when a message is received from an employee: <br><pre> <code class="javascript hljs">worker.onmessage = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ alert(event.data); };</code> </pre><br><br>  <b>UPD:</b> <br>  Addition from <a href="https://habrahabr.ru/users/demark/" class="user_link">demark</a> : <br><br>  You also need to add that HTML5 allows you to create a Web Worker without an external file using <br><br>  blobBuilder'a: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> worker = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Worker( <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.URL.createObjectURL( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BlobBuilder().append( <span class="hljs-string"><span class="hljs-string">"onmessage = function(e) { postMessage('hello habrahabr'); }"</span></span> ).getBlob() ) ); worker.postMessage();</code> </pre><br><br>  That's all!  The employee can also return us any data.  It is worth remembering a few important points, such as: <br>  1. The employee cannot access the DOM in any way.  No function that works with DOM that receives data about its state or modifies it is not available inside the employee.  Including alert (). <br>  2. The employee has access to: <br>  2.1 navigator <br>  2.2 location object (read only) <br>  2.3 importScripts () method (for accessing script files in the same domain) <br>  2.4 JavaScript objects like Object, Array, Date, Math, String <br>  2.5 XMLHttpRequest <br>  2.6 methods setTimeout () and setInterval () <br><br>  So what's the multi-threading itself?  And the fact that the objects of workers can be as many as they want and all of them can work at the same time, while the formation of the page will not be stopped, while waiting for a job to complete, a function. <br><br>  <b>And now about the important, about what is not in any article about workers: in order to get an adequate response when using the AJAX technology, you must send the SYNCHRONOUS requests using the POST method</b> .  The reason is simple: with an asynchronous request, the worker must finish the work without waiting for the server to respond.  I have never found a logical explanation for why it is not sent by the GET method.  You should not worry that everything will rise, since the worker is running in a separate thread, the main script will continue to work without stopping. <br><br>  When using technology workers to perform simple actions, the speed gain will be minimal.  However, with complex calculations, you can significantly speed up the system. <br><br>  I will give my implementation of this approach: <br>  one. <br>  object responsible for communication with the server: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AJAXprov</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xmlhttp; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> answServ; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.provXmlHttp = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xmlhttp; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { xmlhttp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ActiveXObject(<span class="hljs-string"><span class="hljs-string">'Msxml2.XMLHTTP'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { xmlhttp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ActiveXObject(<span class="hljs-string"><span class="hljs-string">'Microsoft.XMLHTTP'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (E) { xmlhttp = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!xmlhttp &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> XMLHttpRequest!=<span class="hljs-string"><span class="hljs-string">'undefined'</span></span>) { xmlhttp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> xmlhttp; } <span class="hljs-comment"><span class="hljs-comment">// -   false/true (/), // -   (POST/GET) // -    (,     , // -  ,    POST  this.sendAnsServ = function (modeWork, typeSend, adr, param, id, cb) { if(typeSend == 'G') { adr = adr + '?' + param; //alert(adr); httpP.open('GET', adr, modeWork); httpP.setRequestHeader('Cache-Control', 'no-cache, must-revalidate'); httpP.onreadystatechange = function() { if (httpP.readyState == 4) { if(httpP.status == 200) { if(cb) { return httpP.responseText; } } } } httpP.send(null); } if(typeSend == 'P') { httpP.open('POST', adr, modeWork); httpP.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded'); httpP.setRequestHeader('Cache-Control', 'post-check=0,pre-check=0, false'); httpP.setRequestHeader('Cache-Control', 'max-age=0, false'); httpP.setRequestHeader('Pragma', 'no-cache'); httpP.setRequestHeader('Cache-Control', 'no-cache, must-revalidate'); httpP.send(param); if(httpP.status == 200) { if(cb) { return httpP.responseText; } } } } }</span></span></code> </pre><br>  2 <br>  Worker <br><pre> <code class="javascript hljs">onmessage = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">obj</span></span></span><span class="hljs-function">) </span></span>{ importScripts(<span class="hljs-string"><span class="hljs-string">"/JS/classes/AjaxClass.js "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ajObj = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AJAXprov(); httpP = ajObj.provXmlHttp(); obj = obj.data; answ = ajObj.sendAnsServ(objEx.mode, objEx.type, objEx.adress, objEx.parametrs, objEx.ID); postMessage(answ); }</code> </pre><br>  call: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crWorkerAjax</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">param, id, cb</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> workerAjax = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Worker(<span class="hljs-string"><span class="hljs-string">"/JS/workers/ajaxWorker.js"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> objEx = { <span class="hljs-attr"><span class="hljs-attr">mode</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">type</span></span>:<span class="hljs-string"><span class="hljs-string">'P'</span></span>, <span class="hljs-attr"><span class="hljs-attr">adress</span></span>:<span class="hljs-string"><span class="hljs-string">'/router.php'</span></span>, <span class="hljs-attr"><span class="hljs-attr">parametrs</span></span>:param, <span class="hljs-attr"><span class="hljs-attr">ID</span></span>:id, }; workerAjax.onmessage = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">obj</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> res = <span class="hljs-built_in"><span class="hljs-built_in">eval</span></span>(obj[<span class="hljs-string"><span class="hljs-string">'data'</span></span>]); cb.call(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, res, id); } workerAjax.onerror = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class="hljs-function">) </span></span>{ alert(err.message); } workerAjax.postMessage(objEx); }</code> </pre><br><br>  UPD2: <br>  For <a href="https://habrahabr.ru/users/yui_room9/" class="user_link">urgent</a> requests from <a href="https://habrahabr.ru/users/yui_room9/" class="user_link">yui_room9, I</a> cite his alternative version <u><b>working in webkit browsers</b></u> <br><br>  For the main file: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!!<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.Worker){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> worker = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Worker(<span class="hljs-string"><span class="hljs-string">'worker.js'</span></span>); worker.postMessage(<span class="hljs-string"><span class="hljs-string">'Hellow World'</span></span>); worker.onmessage = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">)</span></span>{ alert(e.data); }; }  worker: onmessage = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">)</span></span>{ transport = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); transport.open(<span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-string"><span class="hljs-string">'data.txt'</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); transport.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(transport.readyState == <span class="hljs-number"><span class="hljs-number">4</span></span>){ postMessage(transport.response); } }; transport.send(); };</code> </pre><br><br>  Well, in data.txt we just shove text for a test, I shoved "testing123" <br><br>  All who read, thank you for your attention. </div><p>Source: <a href="https://habr.com/ru/post/132785/">https://habr.com/ru/post/132785/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../132779/index.html">Bash script for sparkles</a></li>
<li><a href="../132780/index.html">OPC DA 2 cheat sheet in .NET</a></li>
<li><a href="../132781/index.html">Release of the openSUSE 12.1 Linux distribution</a></li>
<li><a href="../132782/index.html">How to become Microsoft Certified Professional? And for what?</a></li>
<li><a href="../132784/index.html">FITS (Flexible Image Transport System) format in Octave</a></li>
<li><a href="../132786/index.html">What search engine do you use most often?</a></li>
<li><a href="../132787/index.html">Newspaper FOSS News ‚Ññ1 (24) 2011</a></li>
<li><a href="../132788/index.html">ASUS Eee Slider Review</a></li>
<li><a href="../132789/index.html">Contest entries in the LiveStreet CMS design competition</a></li>
<li><a href="../132790/index.html">What do you use for automated testing of iOS applications?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>