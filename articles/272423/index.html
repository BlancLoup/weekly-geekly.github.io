<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Experience of developing an arcade for Android in C ++ and Qt</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Space does not impose itself 

 Prerequisites 
 I, like many programmers, chose this profession because I used to play computer games and dreamed of d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Experience of developing an arcade for Android in C ++ and Qt</h1><div class="post__text post__text-html js-mediator-article"><img width="50%" height="50%" src="https://habrastorage.org/files/e7b/2e7/733/e7b2e7733b3d4401834f2d1a10eb49f9.jpg"><br>  <i>Space does not impose itself</i> <br><br><h4>  <b>Prerequisites</b> </h4><br>  I, like many programmers, chose this profession because I used to play computer games and dreamed of developing them.  As soon as I learned to write more or less code that could be compiled without syntax errors, I, of course, began to make all sorts of silly games that I showed to all my friends and acquaintances.  But time went on, and it made us engage in completely different things, work on projects that, to put it mildly, are more serious than games.  And so it went the last few years.  And the original desires did not disappear, only free time disappeared. <br><br>  I have long wanted to do any project for Android, and, as you know, the majority of projects are developed on the Android SDK and Java, and the NDK is recommended to be used only in ‚Äúcritical in speed‚Äù places and not to do everything in it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But who needs all these recommendations and rules when there is Qt?  I don‚Äôt know Java to the extent that I consider sufficient for the high-quality development of the game, and I didn‚Äôt want to study it, but I have in my knowledge C ++.  After several test projects on Qt for Android, I realized that it is possible to develop a full-fledged application on it, and even transfer it to other platforms.  Also, after watching the Shia LaBeouf video - Just Do it, it became clear that I was doomed to do it. <br><br>  So, I want to tell you about the experience of developing games for Android on Qt 5.5.1 and C ++. <br><a name="habracut"></a><br><br><h4>  <b>Idea</b> </h4><br>  Oddly enough, the idea of ‚Äã‚Äãthe game came pretty quickly and in a very unusual way.  We experimented with the sensors of the phone in an attempt to make a toy ‚Äúsnitch‚Äù (temporary name), the meaning of which was - the harder and more often you hit the phone, the more points you get.  To do this, it was necessary to distinguish the blow from the phone from the swing, and, fortunately, we did not succeed, but when drawing graphs on the screen, interesting pictures were drawn, which prompted us to the idea of ‚Äã‚Äãthe game, which will be discussed. <br><br>  Suddenly, I wanted to make a game about something falling into a cave, the contours of which change over time.  Originally intended to make a two-dimensional game with graphics in a drawing style.  In the future, all flowed into a three-dimensional game with a top view.  A cave generator was written that allowed the creation of layers with contours.  How to count the collisions with the walls of the cave and how to turn them into a three-dimensional model?  It was possible to think and invent something incredibly cool for a long time, but I took a detour and made a voxel geometry of the world.  The collision calculation and screen output have become noticeably simpler, but at the cost of the fact that the game has become similar to minecraft.  I was not taken aback and made her even more like him, adding a character model from him.  So the form and concept of the game was formed. <br><br><img width="50%" height="50%" src="https://habrastorage.org/files/f47/3e0/867/f473e08671f540f3bb625b1ebef05196.jpg"><br>  <i>The first version of the cave generator (archival photo)</i> <br><br>  Starting to develop the game, I did not set myself the goal to earn on it, like many, but I just wanted to start my project and bring it to the end.  Therefore, the game should be free (who will buy it from me?), But still with a minimal amount of advertising. <br><br><h4>  <b>Graphics</b> </h4><br><h5>  <i><b>Facilities</b></i> </h5><br>  In Qt, for three-dimensional graphics, OpenGL ES 2.0 can be used; the following classes can help us with this: <br><ul><li>  <a href="http://doc.qt.io/qt-4.8/qglwidget.html">QGLWidget</a> is an obsolete class, <a href="http://doc.qt.io/qt-4.8/qglwidget.html">derived from</a> QWidget.  Used before Qt 5.0 </li><li>  <a href="http://doc.qt.io/qt-5/qopenglwidget.html">QOpenGLWidget</a> is a new class that performs the same functions as QGLWidget, but in its implementation it uses an intermediate framebuffer. </li><li>  <a href="http://doc.qt.io/qt-5/qopenglwindow.html">QOpenGLWindow</a> - designed to display OpenGL graphics, is not a widget and does not pull dependencies on the widget module </li></ul><br><br>  Experimenting with these widgets, I made several conclusions: <br><ul><li>  QGLWidget runs much faster than QOpenGLWidget on weak smartphones. </li><li>  QOpenGLWidget does not change the size of the internal framebuffer when the window is resized, it is probably a bug or feature, or I‚Äôm just an idiot, but nevertheless, when using this widget, the window resolution did not match the size of the viewport, which resulted in either a stretched image or projection matrix.  With all this, the performance using this widget was extremely small </li><li>  QOpenGLWindow is the most suitable candidate.  It cannot be used as a viewport for a graphic scene and you cannot add child widgets, which makes it impossible to create a user interface using Qt.  But he is the most productive of all three </li></ul><br><br>  To implement the game, I chose QOpenGLWindow, and the user interface had to cycle by myself. <br><br>  The frame update was implemented by the frameSwapped () signal, which is generated after the swapBuffers.  Using this signal allows you to achieve a more smooth change of frames than when using timers. <br><br>  To calculate the animation I needed to calculate the frame time.  To do this, I first used <a href="http://doc.qt.io/qt-5/qtime.html">QTime</a> , which was a bad idea, since this class counts non-monotonous time, and on the mobile device time adjustments are often made, which lead to getting into the past or future, depending on the clock leaving on the device.  Also, the resolution of changing this class is limited to milliseconds, which is not enough for smooth animation with unstable FPS. <br><br>  After thinking about it and turning to the documentation, I decided to use the <a href="http://doc.qt.io/qt-5/qelapsedtimer.html">QElapsedTimer</a> class, which tries to use monotonous time and has a resolution of up to nanoseconds. <br><br><h5>  <i><b>Textures and Interface</b></i> </h5><br>  For the first versions and debugging, the textures were borrowed temporarily from minecraft, as well as some character's skin.  The first version of the interface was a gray square buttons and was made in the evening, and processing took a whole month. <br><br><div class="spoiler">  <b class="spoiler_title">The first screenshot of the game</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/9e7/893/58f/9e789358f0c54488bdd99a3a362fb988.jpg"><br></div></div><br>  My friend was chosen as a designer.  The advantage of this choice is that this designer can be trusted, and the downside is that he is not a designer - he is an auto mechanic. <br><br>  Later we drew the original textures for several levels and made the textures of the characters. <br>  The process of drawing a ‚Äúbeautiful‚Äù interface and characters was quite long.  While the designer was trying to squeeze a new character out of himself or a button, I had nothing to do but to continue to optimize the code. <br><br><div class="spoiler">  <b class="spoiler_title">Screenshot from the penultimate version</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/d79/45c/1e9/d7945c1e9cea401c8ff10ddc6a16bcc2.jpg"><br></div></div><br>  The level texture is a large atlas of all blocks and holds 32 cubes with a side of 16 pixels.  With this approach, when drawing layers, you do not need to constantly reinstall the current texture, but you can draw the entire level using vertex buffers in several calls. <br><br>  The problem occurred in the extreme pixels of the blocks that are adjacent to other blocks.  When rounding the texture coordinates, artifacts began to appear in the form of stripes at the edges of the blocks.  I solved this problem by adding a single pixel-wide border to each block that duplicates the pixel edge of the block.  Such a kind of CLAMP_TO_EDGE. <br><br>  Unfortunately, with this approach, I could not use mipmap for the level, since  The texture coordinates in the vertex buffer should take into account this offset by one pixel, and when creating a reduced detail texture, this offset becomes smaller, and I would have to use different level geometry depending on the level of detail.  I decided not to bother with this, because  the texture level itself is only 256x256 pixels, and bilinear filtering would not bring much performance gains, but only additional difficulties in implementation. <br><br>  I also wanted to note that although there were only 32 blocks, I set the level properties to set the blocks rotated 90, 180 and 270 degrees, as well as the animation of switching between the texture of the block, which allowed to diversify the visual component of the game.  Although, I applied the animation only on one of the levels to create the effect of rotating the fans. <br><br><h5>  <i><b>Shaders</b></i> </h5><br>  Qt has convenient classes for working with shaders.  I used <a href="http://doc.qt.io/qt-5/qopenglshaderprogram.html">QOpenGLShaderProgram</a> .  This class allows you to add vertex and fragment shaders, compile them, link, set uniform and attrubute.  By itself, a class is simply a wrapper over a set of OpenGL calls and, accordingly, is not a full-fledged object, in the sense that the work of a class can be broken by using GL calls directly between calls to this class. <br><br>  Conveniently, the class automatically adds define in such a way that the ES shader compiles fine on both the desktop and the mobile device.  This applies primarily to precision specifiers, which on the desktop turn into nothing. <br><br>  I had to write separate shaders for the game world, including lighting and animation of some blocks, a shader for the character and interface shaders. <br><br>  Interface shaders include <br><ul><li>  simple texture shader </li><li>  shader bar hp \ shield </li><li>  circle shader </li></ul><br>  In the first version, I implemented a progress bar with a set of rectangles that form the indicator flask and the indicator itself, hidden in the flask.  But when I saw the layout of the new bar, I had to abandon this method. <br><br><img src="https://habrastorage.org/files/cd5/2e8/6f7/cd52e86f76834a26bb3be83285904991.jpg"><br>  <i>Bar hp \ shield</i> <br><br>  I decided to implement this bar with a shader, at first it seemed to me a very strange idea, but in the end I accepted it as inevitable and implemented it this way: <br><div class="spoiler">  <b class="spoiler_title">Shader code</b> <div class="spoiler_text"><pre><code class="hljs mel">#ifdef GL_ES precision highp <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>; #endif varying highp vec4 v_position; varying highp vec2 v_dim; <span class="hljs-keyword"><span class="hljs-keyword">uniform</span></span> lowp vec4 u_color; <span class="hljs-keyword"><span class="hljs-keyword">uniform</span></span> highp <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> u_tg; <span class="hljs-keyword"><span class="hljs-keyword">uniform</span></span> highp <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> u_value_a; <span class="hljs-keyword"><span class="hljs-keyword">uniform</span></span> highp <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> u_value_b; <span class="hljs-keyword"><span class="hljs-keyword">uniform</span></span> highp <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> u_step; <span class="hljs-keyword"><span class="hljs-keyword">uniform</span></span> lowp vec3 u_pallete[<span class="hljs-number"><span class="hljs-number">3</span></span>]; void main() { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> hstep = u_step/<span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> w = <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(v_dim.x); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> h = <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(v_dim.y); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> wd = u_step*<span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pos_bl = <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(v_position.x - u_tg*v_position.y + v_dim.y); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pos_br = <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(v_position.x + u_tg*v_position.y); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pos_l = (pos_bl - wd*(pos_bl/wd))/u_step; lowp <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> b0 = <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(pos_l == <span class="hljs-number"><span class="hljs-number">0</span></span>) * <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(pos_bl &lt;= <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(u_value_a*v_dim.x)); lowp <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> b1 = <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(pos_l == <span class="hljs-number"><span class="hljs-number">1</span></span>) * <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(pos_bl &gt;= <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>((<span class="hljs-number"><span class="hljs-number">1.0</span></span>-u_value_b)*v_dim.x)); lowp <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> b2 = <span class="hljs-keyword"><span class="hljs-keyword">clamp</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(pos_l == <span class="hljs-number"><span class="hljs-number">2</span></span>) + <span class="hljs-number"><span class="hljs-number">1.0</span></span>-(b0+b1), <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>); highp <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> p = <span class="hljs-keyword"><span class="hljs-keyword">abs</span></span>(<span class="hljs-number"><span class="hljs-number">2.0</span></span>*(v_position.w - <span class="hljs-number"><span class="hljs-number">0.5</span></span>)); highp <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> out_p = (<span class="hljs-number"><span class="hljs-number">1.0</span></span> - <span class="hljs-number"><span class="hljs-number">0.25</span></span>*p); lowp <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> i = <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(v_position.y) &gt; hstep) * <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(v_position.y) &lt; h - hstep); lowp <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> o = (<span class="hljs-number"><span class="hljs-number">1.0</span></span>-i)*<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(pos_br &gt;= h) * <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(pos_bl &lt;=w); lowp <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> a = i*<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(pos_br &gt;= h+u_step) * <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(pos_bl &lt;=w - u_step); lowp <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> b = i*<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(pos_br &lt; h+u_step) * <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(pos_br &gt;= h); lowp <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> c = i*<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(pos_bl &gt; w - u_step) * <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(pos_bl &lt;= w); highp <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> pr = (<span class="hljs-number"><span class="hljs-number">1.0</span></span> - p)*a; gl_FragColor = vec4( u_pallete[<span class="hljs-number"><span class="hljs-number">0</span></span>]*pr*b0 + u_pallete[<span class="hljs-number"><span class="hljs-number">1</span></span>]*pr*b1 + u_pallete[<span class="hljs-number"><span class="hljs-number">2</span></span>]*pr*b2 + u_pallete[<span class="hljs-number"><span class="hljs-number">0</span></span>]*out_p * b + u_pallete[<span class="hljs-number"><span class="hljs-number">1</span></span>]*out_p * c + mix(u_pallete[<span class="hljs-number"><span class="hljs-number">0</span></span>], u_pallete[<span class="hljs-number"><span class="hljs-number">1</span></span>], v_position.z)*out_p*o, <span class="hljs-keyword"><span class="hljs-keyword">clamp</span></span>(a+b+c+o, <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>)*u_color.a); }</code> </pre> <br></div></div><br>  Separately, I would like to say about the variety of android devices and their graphics accelerators.  I ran into problems: <br><ul><li>  Shader code compiles without problems on one device, and errors occur on the other </li><li>  The shader compiles normally, but on some devices it does not work correctly.  For example, on PowerVR, if a local variable is named the same as a uniform or an attribute - this does not lead to errors, but the shader itself stops working correctly </li><li>  On some devices errors occur if the variable or function is called the same as the built-in function.  For example, the mix or clamp variable </li><li>  There were problems with float accuracy on some devices. </li></ul><br><br>  The result of all this - if you plan to use shaders in a mobile game, check them on the most common models of graphics accelerators.  If the shader compiles and runs on your computer, this does not mean that it will work on your neighbor's phone.  The new Vulkan API should solve the problem with various shader compilers and bring order to this crazy world, but this is a matter for the future, and today we have what we have. <br><br><h4>  <b>Sounds</b> </h4><br><h5>  <i><b>Search</b></i> </h5><br>  Sounds is generally a separate song.  You can record them yourself, which is quite laborious and requires a normal microphone and hearing (not our case).  And you can find the desired sounds on the Internet. <br>  Search for sounds, preferably with a Creative Commons 0 license, in order not to indicate authorship for each sound, of which there may be several dozen.  It may seem that finding a normal free sound is quite difficult, and it is.  The problem is not that there are few of them, on the contrary, there are a lot of them, most of which are terrible.  The search for sound is a process in which it is necessary to listen to very, very many sounds and choose the most suitable of them. <br><br><h5>  <i><b>Facilities</b></i> </h5><br>  In Qt, for the output of sounds, there are classes <a href="http://doc.qt.io/qt-4.8/qsound.html">QSound</a> , <a href="http://doc.qt.io/qt-5/qsoundeffect.html">QSoundEffect</a> , <a href="http://doc.qt.io/qt-5/QAudioOutput.html">QAudioOutput</a> and <a href="http://doc.qt.io/qt-5/QMediaPlayer.html">QMediaPlayer</a> .  In the first versions, I used QSoundEffect to output effects and QMediaPlayer to output sounds.  But as it turned out, they all do not fit. <br><br>  Only QMediaPlayer can work with compressed sound files, but this class, more precisely, its implementation for Android has some unpleasant moments. <br><ul><li>  Friezes when you start the sound.  When the music plays in a looped state, with repetition there is a noticeable delay of the entire application. </li><li>  When reading a media file from resources, it creates a temporary file in the folder with application data and does not always delete it behind itself, which leads to an increase in the size of the application.  It was discovered by chance and well that time. </li></ul><br>  QSound and QSoundEffect can work only with uncompressed wav files.  QSoundEffect is designed to output sounds without delay and can loop sounds itself, but when using it on Android, the message AUDIO_OUTPUT_FLAG_FAST denied by client often appears in the logs, which means that the format of the sound file cannot be output by the media server without delays.  This is due to an incorrect sampling rate, which is different on different devices.  Some devices swallow up 44KHz, some need 48KHz, and the object itself transmits sound as it is recorded in the wav file.  The size of the sound resources was a significant percentage of the size of the application. <br><br>  All these shortcomings have led to the fact that after adding sounds to the game, significant FPS subsidence has appeared when playing sounds and music. <br><br>  The solution was to reject these classes and use the <a href="http://www.sfml-dev.org/">SFML</a> library for sounds.  Very simple and lightweight library similar to SDL.  Convenient classes for working with graphics, sound, input devices.  This library does not know how to work with mp3 (license, all things), but it does much more.  I used the ogg format for effects and music. <br><br><h5>  <i><b>Sound output</b></i> </h5><br>  For use in an application where sounds are optional, Qt-shny native classes are suitable.  For game development, not at all.  Better and easier to use SFML. <br><br><h4>  <b>Advertising in the application</b> </h4><br>  For advertising, I used the ready-made implementation of AdMob under Qt - <a href="https://github.com/yevgeniy-logachev/QtAdMob">QtAdMob</a> . <br><br>  At first, only one small banner was added to the menu, but in the future an interscreen advertisement was formed. <br>  It is interesting that the inter-screen ad, even in the loaded state, appears with some delay.  That is, there is a need to block the user interface at the time of the appearance of advertising and restore after its closure.  At the same time, the library did not allow to catch the moments when the ad is shown and closed.  I finished this functionality of the library in the version for Android.  I have not yet touched the version for ios, for lack of the opportunity to test the performance. <br><br><h4>  <b>Analytics and statistics</b> </h4><br>  Laying out the first version on the Play Market, I hoped for statistics in the developer console.  But, as it turned out, the statistics of active users is tied to Google Analytics and does not work until you enable the analytics tracker in the application.  And the statistics that are available, comes with a delay of more than a day and is calculated according to Pacific time.  This situation does not allow you to understand how your actions affect the download.  Therefore, I supplemented the activity class from QtAdMob, which is inherited from QtActivity by analytics initialization functions and functions for sending game events.  I do not provide code examples, since  everything is perfectly described in the documentation. <br><br>  In the event I made a press of all the buttons of the interface, the occurrence of some game situations, opening and unlocking characters with levels. <br><br>  Thanks to the collection of all these statistics, I can sit at a laptop and watch in real time how in Brazil someone launched the game, could not complete the first mission, went out and probably deleted the game. <br><br>  Still, according to statistics, we are now champions in our game. <br><br><h4>  <b>About Google Play</b> </h4><br>  The developer console itself is quite a handy tool, but the functionality of statistics and advertising is tied to other accounts. <br><br>  In order to fully develop the application yourself, you must at least have AdWords, AdSense, AdMob, Google Analytics accounts.  In this connection is established between them.  All of these accounts are separate Google products and have different technical support and settings.  Also worth noting is that the AdMob account requires AdWords and AdSense accounts.  In this case, all these accounts can be tied in a single copy to the main Gmail account.  But, as practice has shown, in all this you can get confused from the very beginning, because you open one service, he offers you to create a new account in another, one in the third, and so on. <br><br>  I somehow magically so that the tech support employee could not explain what happened, created 2 AdWords accounts and tied them to one mail, while tying one account to the developer console and the other to AdMob (I did not know about this). <br><br>  On one account, I threw 500r to check the advertising campaign.  In an attempt to deal with this and following the advice of tech support, I transferred one of the accounts to the ‚Äúleft‚Äù mail and closed myself access to it.  All this led first to the inoperability of both accounts from my mail, then, with repeated disconnections and self-connections, the performance returned.  But as it turned out, AdMob stopped working.  Since AdMob was more important to me than those 500r, I had to spend the whole procedure all over again, at the same time praying that I would not lose access to everything at all, to get AdMob back.  And of course, those 500r remained hanging on a non-connected account. <br><br>  So, be careful with this. <br><br><h4>  <b>Transfer</b> </h4><br><h5>  <i><b>In Game</b></i> </h5><br>  The game menu we translated into 2 languages ‚Äã‚Äã- Russian and English.  The choice of the game language is carried out by the system locale.  If the system is Russian - then the games are in Russian, in all other cases - in English. <br><br>  To implement textual translations in Qt, there is a built-in mechanism implemented by the class <pre> <code class="cpp hljs"> QTranslator myTranslator; myTranslator.load(<span class="hljs-string"><span class="hljs-string">":/translations/neverfall_"</span></span> + QLocale::system().name()); a.installTranslator(&amp;myTranslator);</code> </pre><br>  All strings that need to be transferred are passed to the QObject :: tr () function, for classes that are not QObject's heirs, you can use the QApplication :: translate function and for strings declared in arrays the QT_TRANSLATE_NOOP, QT_TR_NOOP macros. <br><br>  But this is only half the battle.  You need to create the translations themselves, which is done by the lupdate and lrelease programs.  The first collects information from source code containing these functions and macros, and creates an Xml file with information for translation. <br>  The second one collects a qm binary file from the xml file, which is loaded directly into <a href="http://doc.qt.io/qt-5/qtranslator.html">QTranslator</a> . <br><br>  We used something like tags as translatable strings, which were then translated into English and Russian.  For example, ‚Äú#GameOverText‚Äù translates to ‚ÄúGame over‚Äù.  It was done so that there was no need to change the source code, to write something differently, and then also change all the translations, because  for lupdate this is another line. <br><br><h5>  <i><b>On the market</b></i> </h5><br>  On Google Play, we chose the easiest way: we wrote the text in Russian - we threw it into a Google translator - we translated it into English, corrected it.  And then the English text was translated into the most common languages ‚Äã‚Äãby the same Google translator.  It's funny that one of the description options contained the phrase ‚ÄúDip in a dungeon with a head‚Äù, which, having passed through all these translations in Chinese, meant ‚ÄúJumping in a cave on the head‚Äù.  We left it that way, because since they give us pearls on AliExpress, we will not be left behind. <br><br><h4>  <b>Conclusion and plans</b> </h4><br><div class="spoiler">  <b class="spoiler_title">Result Video</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/aTa24KG5nxg%3Ffeature%3Doembed&amp;xid=25657,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiYX_R8-zlWUkTB1_PUDo0XIshW1w" frameborder="0" allowfullscreen=""></iframe><br></div></div><br>  In conclusion, I want to say that the process of developing this game was and is one of the most interesting activities, which brought us great pleasure and experience, which I modestly share in this article.  Development was carried out in free time, after work and at night, since August of this year.  The money was spent only on the developer‚Äôs account and a couple of thousand on advertising, so I‚Äôm not upset if this game will bring us a little less than nothing. <br><br>  Further plans depend on how people will react to our creation.  Judging by the reviews, it is pretty good, but judging by the downloads and deletions, I want to go for the rope to the nearest household goods store.  Probably, the game was rather complicated, and we have a clear lack of promotional activities. <br><br>  We plan to move the game under ios, but this is hampered by the absence of apple technology and $ 100 a year, and the prospect of communication on the elven Objective C is also scary. <br><br>  I hope that this is not our last game, there are many new ideas that I will try to bring to life, given the experience.  This game - the first pancake, lumpy or not - is not for me to judge. <br><br>  I anticipate comments about the fact that it could be done easier and faster using ready-made engines, attracting designers and publishers.  The answer to this is that we wanted to go the way of the Jedi developers from the beginning to the end, on our own, in order to plunge into it with the head. </div><p>Source: <a href="https://habr.com/ru/post/272423/">https://habr.com/ru/post/272423/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../272411/index.html">PostgreSQL Document-Oriented API Design: Full-Text Search and Save Many Documents (Part 2)</a></li>
<li><a href="../272413/index.html">Security Week 49: Used certificates, data theft from children's toys, Microsoft blocks unwanted software</a></li>
<li><a href="../272417/index.html">How to cope with problems in an inherited project after 3 other teams</a></li>
<li><a href="../272419/index.html">Alloy Navigator: Co-pilot for IT Infrastructure</a></li>
<li><a href="../272421/index.html">Acquaintance with the programming language Deluge. Creating an arbitrary function in the Zoho CRM system</a></li>
<li><a href="../272425/index.html">Development of trading systems for FPGA: Pros, cons and analysis of the architecture of the existing library</a></li>
<li><a href="../272427/index.html">Dynamic lights and shadows in my 2d game</a></li>
<li><a href="../272429/index.html">Moore's Law and Storage Technology</a></li>
<li><a href="../272431/index.html">Mobile search inside apps ... which you don't have!</a></li>
<li><a href="../272433/index.html">Software overview and demonstration - HP ONE VIEW and HP Data Protector</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>