<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Work with JMS messages and MDB in JEE</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Working with messages involves the interaction between system components through message passing. JMS allows you to implement this interaction in a ja...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Work with JMS messages and MDB in JEE</h1><div class="post__text post__text-html js-mediator-article">  Working with messages involves the interaction between system components through message passing.  JMS allows you to implement this interaction in a java application, and MDB beans allow you to asynchronously process the received messages on the application server without additional asynchronous processing efforts. <br><br>  Below is a simple example of handling a JMS message using MDB. <br><a name="habracut"></a><br><br><h5>  Some theory </h5><br>  Auxiliary software, usually included in the application server package, is used to work with messages. <br>  System components can send messages (producer) and receive messages (consumer).  Message <br>  sends the producer to the destination, which is on the queue or topic server, after which the consumer can pick up a message from there <br>  Depending on what type the destination has, they separate the two message handling models. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h6>  The first model - Point-to-Point </h6><br>  If the destination server is of the queue type, the only consumer receives the message that the producer sent.  If there are several recipients subscribed to this message queue, then only one of them will receive the message. <br><br><h6>  The second model is Publish-subscribe </h6><br>  If the destination server has a type of topic, then one message can be read by an unlimited number of consumers subscribed to this destination. <br><br><h5>  JMS message structure </h5><br>  A message consists of a header, a property field and a body. <br>  The header stores the meta information of the message that is automatically filled. <br>  The properties field is similar to the title, but it is filled programmatically, and the recipient can later read this information. <br>  The body contains the message payload.  The type of load is determined when creating the message.  Specific types inherited from the <a href="http://docs.oracle.com/javaee/6/api/javax/jms/Message.html">javax.jms.Message</a> interface <br><br><h5>  Creating a queue on the server. </h5><br>  For example, create a topic on the server.  I will use glassfish 3.1. <br>  First, create a Connection Factory.  Several types are possible depending on what type of message queue will be used. <br><br><img src="https://habrastorage.org/storage2/b8a/69d/66e/b8a69d66e669fa2a212d83fc29aa62fc.jpg"><br><br>  Then create a destination with a type indication. <br><br><img src="https://habrastorage.org/storage2/f77/db5/455/f77db5455d9630331df2a18466c5f44b.jpg"><br><br><h5>  Creating a message sender </h5><br>  In this case, the producer will be on the application server.  If you need to send messages from a separate client, then you will need to get access to the objects in the standard way by their JNDI name from the context. <br><br><pre><code class="hljs pgsql">//      @Resource(<span class="hljs-type"><span class="hljs-type">name</span></span>="jms/TutorialPool") private ConnectionFactory connectionFactory; @Resource(<span class="hljs-type"><span class="hljs-type">name</span></span>="jms/TutorialTopic") private Destination destination; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> String getEnterString() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> enterString; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> sendString(String enterString) { try { //  <span class="hljs-keyword"><span class="hljs-keyword">Connection</span></span> <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span> = connectionFactory.createConnection(); <span class="hljs-keyword"><span class="hljs-keyword">Session</span></span> <span class="hljs-keyword"><span class="hljs-keyword">session</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>.createSession(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Session</span></span>.AUTO_ACKNOWLEDGE); MessageProducer producer = <span class="hljs-keyword"><span class="hljs-keyword">session</span></span>.createProducer(destination); TextMessage message = <span class="hljs-keyword"><span class="hljs-keyword">session</span></span>.createTextMessage(); //  JMS         message.setStringProperty("clientType", "web clien"); // payload   message.setText(enterString); //  producer.send(message); <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">out</span></span>.println("message sent"); //  <span class="hljs-keyword"><span class="hljs-keyword">session</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">close</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">close</span></span>(); } catch (JMSException ex) { <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.err.println("Sending message error"); ex.printStackTrace(); } }</code> </pre> <br><br><h5>  Message-driven bean </h5><br>  We will use MDB to process incoming messages on the server. <br><br>  Messages could be received and processed with the help of pojo acting as a consumer.  But using MDB will allow parallel processing of messages, without worrying about the complexity of asynchronous processing and additional code for subscribing to the message queue. <br>  Asynchronous processing is implemented through a pool of objects, from which the server will select objects for processing a message if necessary. <br><br>  To implement MBD, it suffices to inherit the bean from the javax.jms.MessageListener interface, implementing the onMessage () method, and annotate the class accordingly. <br><br>  Let's make an example of MDB, which displays information about the incoming message to the server console. <br><br><pre> <code class="hljs pgsql">@MessageDriven( // topic,     mappedName="jms/TutorialTopic", <span class="hljs-type"><span class="hljs-type">name</span></span> = "ExampleMDB") <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> MDBExample implements MessageListener{ //,      @Override <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> onMessage(Message msg) { try { TextMessage message = (TextMessage)msg; //    ,    consumer <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">out</span></span>.println("FROM MDB - client type IS " + message.getStringProperty("clientType")); //   <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">out</span></span>.println("FROM MDB - payload IS" + message.getText()); } catch (JMSException ex) { ex.printStackTrace(); } } }</code> </pre><br><br>  The required business logic is added to the onMessage method, depending on the type of message, its content, and so on. <br>  If necessary, you can create a handler for manual processing of messages. <br>  For example: <br><br><pre> <code class="hljs pgsql"> @Resource(<span class="hljs-type"><span class="hljs-type">name</span></span>="jms/TutorialPool") private ConnectionFactory connectionFactory; @Resource(<span class="hljs-type"><span class="hljs-type">name</span></span>="jms/TutorialTopic") private Destination destination; <span class="hljs-type"><span class="hljs-type">void</span></span> onMessage(){ try { <span class="hljs-keyword"><span class="hljs-keyword">Connection</span></span> <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span> = connectionFactory.createConnection(); <span class="hljs-keyword"><span class="hljs-keyword">Session</span></span> <span class="hljs-keyword"><span class="hljs-keyword">session</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>.createSession(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Session</span></span>.AUTO_ACKNOWLEDGE); MessageConsumer consumer = <span class="hljs-keyword"><span class="hljs-keyword">session</span></span>.createConsumer(destination); <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">start</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>){ Message msg = consumer.receive(); //  } // <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span> } catch (JMSException ex) { ex.printStackTrace(); } }</code> </pre><br><br>  For a more detailed study of JMS and EJB in general, I can recommend books: <br>  <a href="http://www.manning.com/panda/">EJB 3 in Action - Debu Panda, Reza Rahman, Derek Lane</a> <br>  <a href="http://press.adam-bien.com/">A couple of books from Adam Bien</a> </div><p>Source: <a href="https://habr.com/ru/post/162813/">https://habr.com/ru/post/162813/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../162801/index.html">Thoughts on the development process of the game REFLECT</a></li>
<li><a href="../162803/index.html">Do you buy movies in Russian iTunes?</a></li>
<li><a href="../162805/index.html">Do you buy movies in the Russian Google Play?</a></li>
<li><a href="../162807/index.html">Server Expert</a></li>
<li><a href="../162811/index.html">Critical vulnerability in Exynos-based smartphones</a></li>
<li><a href="../162815/index.html">What languages ‚Äã‚Äãdo you localize your programs in?</a></li>
<li><a href="../162817/index.html">The photo. Art of self-expression (B. Burnbaum)</a></li>
<li><a href="../162821/index.html">Museo Cyrillic</a></li>
<li><a href="../162825/index.html">Sending notifications of missed calls from Asterisk</a></li>
<li><a href="../162827/index.html">Twitter users can now download an archive of their messages.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>