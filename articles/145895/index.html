<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Profiling and debugging php applications using xhprof & FirePHP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="All web developers, especially in high-load projects, sooner or later have to deal with the profiling of their applications. Of course, we all know xd...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Profiling and debugging php applications using xhprof & FirePHP</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/storage2/8b2/24f/834/8b224f834190a1806ca34694783249d5.png"><br>  All web developers, especially in high-load projects, sooner or later have to deal with the profiling of their applications.  Of course, we all know xdebug, with which you can debug the server side.  However, in heavy RIA-applications, it is much more often necessary to be debugged in the frontend + backend bundle, all sorts of ajax-requests, the speed of working out specific scripts and all that jazz.  And for these tasks there is a rather not bad set of tools.  This is xhprof and firephp. <br><a name="habracut"></a><br><h4>  Quick reference </h4><br>  xhprof is a php extension from facebook.  This is a hierarchical profiler that allows you to collect such statistics as the execution time of each function, memory usage, waiting time, number of calls and more.  This extension is available from the PECL repository: <a href="http://pecl.php.net/package/xhprof">http://pecl.php.net/package/xhprof</a> .  You can read the documentation here: <a href="http://php.net/xhprof">http://php.net/xhprof</a> . <br><br>  FirePHP is an extension for firebug, which, in conjunction with its small php class, allows you to transmit data from php to the firebug console, for example, all sorts of var_dump and other debugging information.  The main advantage of this extension is that the entire translation of debug information occurs through the headers and does not litter the pages and generally does not break the logic of the application.  Official site: <a href="http://firephp.org/">http://firephp.org/</a> . <br><br><br><h4>  Main idea. </h4><br>  The general profiling algorithm is as follows: <br><ol><li>  At the top of the page, enable profiling with xhprof_enable () </li><li>  At the end of the page, turn off profiling with xhprof_disable () and save the collected data with save_run () </li><li>  Next, using the php-class firephp, we transfer the link to the profiling data to the client part </li><li>  In the firebug console, we open the information we need. </li><li>  We are happy :) </li></ol><br>  I also want to say that, of course, manually adding these functions to your php scripts is great.  But I want this information to be always at hand during development, and at the same time not to get to the combat servers.  We solve this problem as follows: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In our projects, in almost all the scripts in the beginning, the working file is connected with the class loader, the connection of functions and other necessary things.  Therefore, we included profiling into this file.  And in order to be able to turn on / off the debugging mode, they added a check for the configuration constant at will, plus they wrapped these checks into certain meta tags, which were automatically deleted when the project was built.  The same applies to turning off profiling and writing information to headers using firephp - these tasks are solved by one function, which is called at the end of each php script and is also wrapped in meta tags.  It looks like this: <br><br><blockquote><code><a href="http://php.net/manual/ru/xhprof.constants.php"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">//  -     </font> <br> <br> <font color="#008000">/**     * */</font> <br> define( <font color="#A31515">"APPLICATION_ENV"</font> , <font color="#A31515">"dev"</font> ); <font color="#008000">// dev -  | pro - </font> <br> <font color="#008000">/**    */</font> <br> define( <font color="#A31515">"XHPROF_ROOT"</font> , __DIR__ . <font color="#A31515">'/ExtProcs/debug/xhprof-0.9.2'</font> ); <br> <br> <font color="#008000">/***************************************************************************************</font> <br> <font color="#008000">*     ,        </font> <br> <font color="#008000">*   DEV_START  DEV_END -   -,       </font> <br> <font color="#008000">***************************************************************************************/</font> <br> <br> <font color="#008000">//-- DEV_START</font> <br> <font color="#008000">//--     debug </font> <br> <font color="#0000ff">if</font> (APPLICATION_ENV === <font color="#A31515">'dev'</font> ) { <br> <font color="#008000">//  firephp</font> <br> require_once(__DIR__ . <font color="#A31515">'/includes/ExtProcs/debug/firephp/FirePHP.class.php'</font> ); <br> <font color="#008000">//--  </font> <br> require_once (XHPROF_ROOT . <font color="#A31515">'/xhprof_lib/utils/xhprof_lib.php'</font> ); <br> require_once (XHPROF_ROOT . <font color="#A31515">'/xhprof_lib/utils/xhprof_runs.php'</font> ); <br> <font color="#008000">//     .   </font> <br> <font color="#008000">//    php.net/manual/ru/xhprof.constants.php</font> <br> xhprof_enable(XHPROF_FLAGS_CPU + XHPROF_FLAGS_MEMORY); <br> } <br> <font color="#008000">//-- DEV_END</font> <br> <br> <font color="#008000">//          </font> <br> <font color="#008000">//       DEV_START  DEV_END</font> <br> <br> <font color="#008000">/**</font> <br> <font color="#008000">*          </font> <br> <font color="#008000">*/</font> <br> <font color="#0000ff">function</font> dev_boot_Down() { <br> <font color="#0000ff">if</font> (APPLICATION_ENV === <font color="#A31515">'dev'</font> ) { <br> <font color="#008000">//   firephp</font> <br> $firephp = FirePHP::getInstance( <font color="#0000ff">true</font> ); <br> <font color="#008000">//     </font> <br> $xhprof_data = xhprof_disable(); <br> $xhprof_runs = <font color="#0000ff">new</font> XHProfRuns_Default(); <br> $run_id = $xhprof_runs-&gt;save_run($xhprof_data, <font color="#A31515">"xhprof_testing"</font> ); <br> <font color="#008000">//          </font> <br> $link = <font color="#A31515">"http://"</font> . $_SERVER[ <font color="#A31515">'HTTP_HOST'</font> ] . <font color="#A31515">"/includes/ExtProcs/debug/xhprof-0.9.2/xhprof_html/index.php?run={$run_id}&amp;source=xhprof_testing\n"</font> ; <br> $firephp-&gt;info($link, <font color="#A31515">'profiling data'</font> ); <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  I will not go into the details of installing these extensions, because everything is simple.  I can only say about some of the settings.  There is only one configuration variable in xhproof - xhprof.output_dir, which points to the folder where the profiling data will be saved.  Therefore, make sure that the user in the specified directory, from which the PHP scripts are executed, has write access.  So write something like this into your php.ini: <br><br> <code>[xhprof] <br> extension=xhprof.so <br> xhprof.output_dir="/var/tmp/xhprof" <br></code> <br><br>  It is also not bad to put something like dot or Graphviz for drawing call graphs.  I have Graphviz on MacOS X. <br><br><br>  Having done the above procedures, we were able at any time, right in the browser, to open and look at the profiling of any of our scripts. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage2/2cc/b90/830/2ccb908303ff418755305ed4cb7f250e.png"></div><br>  By copying and opening the link to the profiling data, you can see something similar to this.  The number of columns with values ‚Äã‚Äãdepends on the flags specified in xhprof_enable (). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage2/6be/f43/db1/6bef43db138d52f48e9aabe6bcee9289.png"></div><br>  And if you follow the link [View Full Callgraph], you will see the call graph of the functions of our script. <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/storage2/97a/2de/c30/97a2dec302efc879fdf95e67560b1265.png"></a> </div><br>  Well, on this, perhaps, that's all.  If someone has their own approaches to debugging and profiling web applications, I will gladly listen. <br><br>  PS I will only add that comrade <a href="https://habrahabr.ru/users/kryapolov/" class="user_link">kryapolov</a> was actively involved in all this disgrace <br><br>  UPD 1: For Pythonists there is such a project as <a href="http://code.google.com/p/firepy/wiki/Documentation">FirePy</a> , which, however difficult to guess, allows you to translate data from a python into a firebug. <br></div><p>Source: <a href="https://habr.com/ru/post/145895/">https://habr.com/ru/post/145895/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../145890/index.html">Deface of the official website of the Exam of St. Petersburg</a></li>
<li><a href="../145891/index.html">Apple patent: interchangeable lenses on smartphones</a></li>
<li><a href="../145892/index.html">Results of the week. Issue 9 - with Igor Belkin. Report from Los Angeles</a></li>
<li><a href="../145893/index.html">Results of the week. Issue 10 - with Viktor Zuev</a></li>
<li><a href="../145894/index.html">Teamlab Voices: First Webinar Experience</a></li>
<li><a href="../145896/index.html">New Minister about the future of communication in Russia</a></li>
<li><a href="../145897/index.html">Internet controlled race of tarantas</a></li>
<li><a href="../145899/index.html">Handling a large number of tasks using delayed_job</a></li>
<li><a href="../145900/index.html">Habr on tablet computers and usability</a></li>
<li><a href="../145901/index.html">Analysis of patterns in 1300 popular songs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>