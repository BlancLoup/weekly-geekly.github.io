<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Web application development on Golang</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I will discuss the development of a web application on Go. The material does not contain fundamentally new knowledge and is calculated...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Web application development on Golang</h1><div class="post__text post__text-html js-mediator-article">  In this article I will discuss the development of a web application on Go.  The material does not contain fundamentally new knowledge and is calculated rather for the same newly-fledged researchers of the language as I am.  Although, I hope, you will find some fresh ideas for yourself. <br><br>  Some readers may have questions about ‚Äúcycling‚Äù - this is all the fruits of curiosity and keen interest in learning the language of Golang. <br><a name="habracut"></a><br><h4>  <b>System administration and project development</b> </h4><br>  I will only briefly mark this point in order to have an idea of ‚Äã‚Äãa single system in pieces.  Ultimately, the CI server collects the project from the git repository and forms a complete rpm package for the desired architecture, which is installed into the system as a systemd service. <br><br><pre><code class="hljs pgsql">[Unit] Description=Description <span class="hljs-keyword"><span class="hljs-keyword">After</span></span>=network.target Requires=mysqld.service [Service] <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>=simple <span class="hljs-keyword"><span class="hljs-keyword">User</span></span>=nginx <span class="hljs-keyword"><span class="hljs-keyword">Group</span></span>=nginx WorkingDirectory=/usr/<span class="hljs-keyword"><span class="hljs-keyword">share</span></span>/project_name StandardOutput=journal StandardError=journal ExecStart=/usr/<span class="hljs-keyword"><span class="hljs-keyword">share</span></span>/project_name/project_name <span class="hljs-keyword"><span class="hljs-keyword">Restart</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">always</span></span> [Install] WantedBy=multi-<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.target</code> </pre> <br>  Systemd System Manager deals with: <ol><li>  Establishing dependencies of web service launch (as in the above example from mysqld); </li><li>  Respawn in case the application crashes; </li><li>  Thanks to the StandardOutput and StandardError options, logging the service.  To write to the system log from the application, just call: <pre> <code class="go hljs">log.Println(<span class="hljs-string"><span class="hljs-string">"Server is preparing to start"</span></span>)</code> </pre> </li></ol><br>  An http server is installed ahead of us to render statics, for example, nginx. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Installing, updating, and rolling back a web application falls entirely on the package manager of the linux system (yum / dnf / rpm), with the result that this sometimes non-trivial task becomes simple and reliable. <br><br><h4>  <b>Basic logic</b> </h4><br>  For some tasks, we will use the ready-made <a href="http://www.gorillatoolkit.org/">Gorilla toolkit toolkit</a> and, based on it, in essence, we will make our somewhat advanced toolkit. <br><br><h5>  <b>Application Initialization</b> </h5><br>  The application has objects that change only once at startup - these are configuration structures, routers, database access objects and templates.  To consolidate and conveniently apply them, let's create an Application structure: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> MapRoutes <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]Controller <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Application <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Doc AbstractPage Config Config DB SQL routes MapRoutes }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Application Methods</b> <div class="spoiler_text"><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// Routes       URL' func (app *Application) Routes(r MapRoutes) { app.routes = r } func (app *Application) Run() { r := mux.NewRouter() r.StrictSlash(true) for url, ctrl := range app.routes { r.HandleFunc(url, obs(ctrl)) } http.Handle("/", r) listen := fmt.Sprintf("%s:%d", app.Config.Net.Listen_host, app.Config.Net.Listen_port) log.Println("Server is started on", listen) if err := http.ListenAndServe(listen, nil); err != nil { log.Println(err) } }</span></span></code> </pre> <br></div></div><br>  The Application object in the application should of course be one: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> appInstance *Application <span class="hljs-comment"><span class="hljs-comment">// GetApplication   Application func GetApplication() *Application { if appInstance == nil { appInstance = new(Application) // Init code appInstance.Config = loadConfig("config.ini") appInstance.Doc = make(AbstractPage) appInstance.routes = make(MapRoutes) // ... } return appInstance }</span></span></code> </pre> <br>  Thus, using our Application will be quite simple: <br><br><div class="spoiler">  <b class="spoiler_title">main.go</b> <div class="spoiler_text"><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"interfaces/app"</span></span> <span class="hljs-string"><span class="hljs-string">"interfaces/handlers"</span></span> <span class="hljs-string"><span class="hljs-string">"log"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { log.SetFlags(log.LstdFlags | log.Lshortfile) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { log.Println(<span class="hljs-string"><span class="hljs-string">"Server is preparing to start"</span></span>) Application := app.GetApplication() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Application.Config.Site.Disabled { log.Println(<span class="hljs-string"><span class="hljs-string">"Site is disabled"</span></span>) Application.Routes(app.MapRoutes{<span class="hljs-string"><span class="hljs-string">"/"</span></span>: handlers.HandleDisabled{}}) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Application.Routes(app.MapRoutes{ <span class="hljs-string"><span class="hljs-string">"/"</span></span>: handlers.HandleHome{}, <span class="hljs-string"><span class="hljs-string">"/v1/ajax/"</span></span>: handlers.HandleAjax{}, <span class="hljs-comment"><span class="hljs-comment">//   "/{url:.*}": handlers.Handle404{}, }) } Application.Run() log.Println("Exit") }</span></span></code> </pre><br></div></div><br><h5>  <b>httpHandler with context * Context</b> </h5><br>  The most interesting thing here is the establishment of routers: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> url, ctrl := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> app.routes { r.HandleFunc(url, obs(ctrl)) }</code> </pre><br>  The fact is that in the Router from the Gorilla toolkit exactly as in the standard net / http library, the work of the handler (controller) is reduced to a function of the <u>func</u> type <u>(http.ResponseWriter, * http.Request)</u> .  We are also interested in another type of controller, so as not to duplicate the code from the controller to the controller with trivial operations: <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProductHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ctx *Context)</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre><br>  where * Context is a handy tool for working with cookies, session and other context-sensitive structures.  In more detail, we are interested not only in the context of the request in the controller, but also in access to the database, to the configuration, i.e.  and to the Application object.  To do this, we introduce the <u>obs (handler Controller)</u> wrapper function <u>func (http.ResponseWriter, * http.Request)</u> , which receives the controller type we need ‚Äî the Controller interface ‚Äî and returns the function type needed for <u>r.HandleFunc ()</u> and at the same time performs all Add-on actions before the controller is executed - creating * ContextApplication object. <br><br><div class="spoiler">  <b class="spoiler_title">Function obs (), Controller and HTTPController</b> <div class="spoiler_text"><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Controller <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { GET(app *ContextApplication) POST(app *ContextApplication) PUT(app *ContextApplication) DELETE(app *ContextApplication) PATCH(app *ContextApplication) OPTIONS(app *ContextApplication) HEAD(app *ContextApplication) TRACE(app *ContextApplication) CONNECT(app *ContextApplication) } <span class="hljs-comment"><span class="hljs-comment">// obs         func obs(handler Controller) func(http.ResponseWriter, *http.Request) { return func(w http.ResponseWriter, req *http.Request) { ctx := context.New(w, req) app := GetApplication() doc := app.Doc.Clone("") doc["Ctx"] = ctx doc["User"] = ctx.User() contextApp := &amp;ContextApplication{ctx, doc, app.Config, app.DB} switch ctx.Input.Method() { case "GET": handler.GET(contextApp); case "POST": handler.POST(contextApp); case "PUT": handler.PUT(contextApp); case "DELETE": handler.DELETE(contextApp); case "PATCH": handler.PATCH(contextApp); case "OPTIONS": handler.OPTIONS(contextApp); case "HEAD": handler.HEAD(contextApp); case "TRACE": handler.TRACE(contextApp); case "CONNECT": handler.CONNECT(contextApp); default: http.Error(ctx.Response(), "Method not allowed", http.StatusMethodNotAllowed) } } } // HTTPController     ,      //     . type HTTPController struct {} func (h HTTPController) GET(app *ContextApplication) { http.Error(app.Ctx.Response(), "Method not allowed", http.StatusMethodNotAllowed) } func (h HTTPController) POST(app *ContextApplication) { http.Error(app.Ctx.Response(), "Method not allowed", http.StatusMethodNotAllowed) } func (h HTTPController) PUT(app *ContextApplication) { http.Error(app.Ctx.Response(), "Method not allowed", http.StatusMethodNotAllowed) } func (h HTTPController) DELETE(app *ContextApplication) { http.Error(app.Ctx.Response(), "Method not allowed", http.StatusMethodNotAllowed) } func (h HTTPController) PATCH(app *ContextApplication) { http.Error(app.Ctx.Response(), "Method not allowed", http.StatusMethodNotAllowed) } func (h HTTPController) OPTIONS(app *ContextApplication) { http.Error(app.Ctx.Response(), "Method not allowed", http.StatusMethodNotAllowed) } func (h HTTPController) HEAD(app *ContextApplication) { http.Error(app.Ctx.Response(), "Method not allowed", http.StatusMethodNotAllowed) } func (h HTTPController) TRACE(app *ContextApplication) { http.Error(app.Ctx.Response(), "Method not allowed", http.StatusMethodNotAllowed) } func (h HTTPController) CONNECT(app *ContextApplication) { http.Error(app.Ctx.Response(), "Method not allowed", http.StatusMethodNotAllowed) }</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">* ContextApplication</b> <div class="spoiler_text"><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ContextApplication <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Ctx *context.Context Doc AbstractPage Config Config DB SQL }</code> </pre><br></div></div><br><h5>  <b>Creating a controller</b> </h5><br>  Now everything is ready to create a controller: <br><br><div class="spoiler">  <b class="spoiler_title">HandleCustom</b> <div class="spoiler_text"><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"interfaces/app"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> HandleCustom <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { app.HTTPController } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(h HandleCustom)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GET</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(app *app.ContextApplication)</span></span></span></span> { app.Ctx.SendHTML(<span class="hljs-string"><span class="hljs-string">"html data here"</span></span>) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(h HandleCustom)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">POST</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(app *app.ContextApplication)</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">// and so on... }</span></span></code> </pre><br></div></div><br>  The process of creating a new controller is to rewrite the methods of the embedded <u>app.HTTPController</u> object (GET, POST, etc.).  If you do not rewrite the method, the built-in method will be called up, which returns to the client ‚ÄúMethod not allowed‚Äù (this behavior can be changed to any other). <br><br><h5>  <b>Context</b> </h5><br>  Context essentially consists of a set of methods to simplify working with context-sensitive variables.  I will not write an implementation, briefly enumerate some methods so that it is clear what is at stake: <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c *Context)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NotFound</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NotFound</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sends</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">page</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-function"> 404 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">http</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">code</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">from</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">template</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tpls</span></span></span><span class="hljs-function">/404.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tpl</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c *Context)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Redirect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(url </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Redirect</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sends</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">http</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">redirect</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-function"> 301 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">code</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c *Context)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Redirect303</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(url </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Redirect303</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sends</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">http</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">redirect</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-function"> 303 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">code</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c *Context)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SendJSON</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SendJSON</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sends</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">json</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c *Context)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SendXML</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SendXML</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sends</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xml</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c *Context)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCookie</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCookie</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cookie</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">from</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">request</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">by</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">given</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">key</span></span></span><span class="hljs-function">. </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c *Context)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetCookie</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, value </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, others ...</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">interface</span></span></span></span><span class="hljs-function"><span class="hljs-params">{})</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetCookie</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cookie</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">response</span></span></span><span class="hljs-function">. </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c *Context)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckXsrfToken</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckXsrfToken</span></span></span><span class="hljs-function">  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">token</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c *Context)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">User</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">User</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">User</span></span></span><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c *Context)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Session</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*Session, error)</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Session</span></span></span><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(s *Session)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function">    //  ..</span></span></code> </pre><br><br><h5>  <b>Template engine</b> </h5><br>  As part of the standard library there is a wonderful package "html / template".  And we will use it, slightly expanding its functionality. <br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// loadTemplate load template from tpls/%s.tpl func loadTemplate(Name string) *html.Template { funcMap := html.FuncMap{ "html": func(val string) html.HTML { return html.HTML(val) }, "typo": func(val string) string { return typo.Typo(val) }, "mod": func(args ...interface{}) interface{} { if len(args) == 0 { return "" } name := args[0].(string) ctx := new(context.Context) if len(args) &gt; 1 { ctx = args[1].(*context.Context) } modules := reflect.ValueOf(modules.Get()) mod := modules.MethodByName(name) if (mod == reflect.Value{}) { return "" } inputs := make([]reflect.Value, 0) inputs = append(inputs, reflect.ValueOf(ctx)) ret := mod.Call(inputs) return ret[0].Interface() }, } return html.Must(html.New("*").Funcs(funcMap).Delims("{{%", "%}}").ParseFiles("tpls/" + Name + ".tpl")) }</span></span></code> </pre><br>  For compatibility with AngularJS, we change the delimiters from "{{}}" to "{{%%}}", although, I confess, it is not very convenient. <br>  In more detail about 3 above pipeline-functions: <br><ol><li>  <u>html</u> - changes the type of the input parameter to HTML, so that the template does not screen HTML lines.  Sometimes it is useful.  Example of use in the template: <pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>{{% .htmlString | html %}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </li><li>  <u>typo</u> - text processing according to some typographical rules.  Example of use in the template: <pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>{{% .title | typo %}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </li><li>  <u>mod</u> - launch modules directly from the template body.  Usage example: <pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>{{% mod "InformMenu" %}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </li></ol><br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> AbstractPage <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>{}</code> </pre> <br>  AbstractPage is a container of input data for use in templates.  I will give an example: <br><br><div class="spoiler">  <b class="spoiler_title">Filling values ‚Äã‚Äãin the code</b> <div class="spoiler_text"><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(h HandleCustom)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GET</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(app *app.ContextApplication)</span></span></span></span> { doc := app.Doc.Clone(<span class="hljs-string"><span class="hljs-string">"custom"</span></span>) <span class="hljs-comment"><span class="hljs-comment">//   AbstractPage,    custom.tpl doc["V1"] = "V1" doc["V2"] = 555 result := doc.Compile() app.Ctx.SendHTML(result) }</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">custom.tpl</b> <div class="spoiler_text"><pre> <code class="html hljs xml">{{%define "*"%}} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span>{{% .V1 %}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span>{{% .V2 %}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> {{%end%}}</code> </pre><br></div></div><br>  AbstractPage has 2 methods: <br><ol><li><div class="spoiler">  <b class="spoiler_title">Clone () method</b> <div class="spoiler_text"><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// Clone    AbstractPage c     func (page AbstractPage) Clone(tplName string) AbstractPage { doc := make(AbstractPage) for k, v := range page { doc[k] = v } doc["__tpl"] = tplName return doc }</span></span></code> </pre><br></div></div><br>  Creates a new AbstractPage container by copying all the values.  The meaning of this operation is the inheritance of values ‚Äã‚Äãfrom higher levels of AbstractPage. </li><li><div class="spoiler">  <b class="spoiler_title">Compile () method</b> <div class="spoiler_text"><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// Compile return page formatted with template from tpls/%d.tpl func (page AbstractPage) Compile() string { var data bytes.Buffer for k, v := range page { switch val := v.(type) { case AbstractPage: { page[k] = html.HTML(val.Compile()) } case func()string: { page[k] = val() } } } //     (ctx   doc["Ctx"]) getTpl(page["__tpl"].(string)).Execute(&amp;data, page) return data.String() }</span></span></code> </pre><br></div></div><br>  Runs the template and generates the resulting HTML code. </li></ol><br><br><h4>  Summary </h4><br>  In my opinion, it turned out flexible and quite simple.  The rest of the development is associated with the implementation of specific controllers and modules that are independent in nature. <br><br>  I would like to note that Go did not leave me indifferent, as well as many. <br><br><h4>  Links </h4><br>  1. <a href="https://github.com/dblokhin/typo">github.com/dblokhin/typo</a> - golang package for processing text according to some typographical rules. </div><p>Source: <a href="https://habr.com/ru/post/260539/">https://habr.com/ru/post/260539/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../260523/index.html">How our IaaS provider API works</a></li>
<li><a href="../260527/index.html">Kolab Groupware (Part 2 - Installation)</a></li>
<li><a href="../260531/index.html">Passing Parameters in Reporting Services Reports</a></li>
<li><a href="../260533/index.html">Search for quadrangle documents on mobile devices</a></li>
<li><a href="../260535/index.html">Vulnerability in Samsung phones allows eavesdropping</a></li>
<li><a href="../260541/index.html">Zabbix Moscow Meetup in Badoo</a></li>
<li><a href="../260543/index.html">How to pass "test free data recovery software" (part 1)</a></li>
<li><a href="../260545/index.html">The guys who make the talking robot for a smart home, distribute fees</a></li>
<li><a href="../260547/index.html">The best usability solutions for online shopping: we make the client happy</a></li>
<li><a href="../260549/index.html">4 scripts to handle the most complex Email from clients</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>