<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Forced Introduction to Configuration Management Systems</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Abstract : how to make yourself study any of the existing configuration systems and stop editing files on the server by hand. 


 The post is dedicate...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Forced Introduction to Configuration Management Systems</h1><div class="post__text post__text-html js-mediator-article"><p>  <em>Abstract</em> : how to make yourself study any of the existing configuration systems and stop editing files on the server by hand. </p><br><p>  The post is dedicated to the heartache that needs to be overcome.  Even in the post will be a bit of technical, but for the most part the post is devoted to the struggle with himself, the deferred reward and how much the motor memory controls you. </p><br><h1 id="vvedenie-dlya-otshelnikov-kotorye-ne-slyshali-chto-takoe-configuration-management-systems">  Introduction for hermits who have not heard what configuration management systems are </h1><br><p>  For many years (by the standards of IT, three generations of how), there have been programs that allow to automate the server configuration process.  All these programs are complex, they invade the holy of holy administrators and force them to do "everything is not the same as before."  Studying and internalizing them (admitting that "this is the right way and the right way") is an absolute must have in the career of any system administrator. </p><br><h1 id="glavnaya-bol-lyuboy-sistemy-upravleniya-konfiguraciyami">  The main pain of any configuration management system </h1><br><p>  The main pain is that the configuration management system breaks the familiar automation of the fingers.  Previously, you could raise a web server in 2 minutes almost without looking at the screen.  Now you are offered to spend on absolutely the same actions for 15-20 minutes (if you know the configuration management system well) or even several days (!!!!!), if you study it. </p><br><p>  This is a crime against personal effectiveness.  Reduce it ten (0xA) times - and they call this progress? </p><a name="habracut"></a><br><p>  Regardless of all other arguments, this thought will haunt you all the time.  Even years later.  You do not just press more buttons to do the same, but you have to do it more slowly, you have to wait for the computer (you never had to wait tens of seconds before the editor edits the file and restarts the web server).  Worse, at the moment when you write a primitive construction in the config, you will have to deal with the extra spaces in the DSL (a special bird's programming language that you need to learn);  think of any incredibly complex extraneous garbage;  make special services for robots.  Debugging will be worse and more disgusting - instead of a normal error message due to a typo in the config, you will receive a slurred oversharing sheet of output on two screens, which takes longer to read than to ‚Äúgo and do it manually‚Äù. </p><br><p>  Even worse: often these sheets will not concern your actions, but completely incoherent changes elsewhere in the project.  And you will be forced to deal with them.  Sometimes it will even be configuration management system bugs and you will fix / bypass the bugs instead of doing your direct work. </p><br><p>  Well, I "sold" you this technology?  Ready to fight back with all the forces of attempts to introduce it in the workplace? </p><br><p>  Before we continue to talk about configuration management systems, I want to show you a very illustrative example from the psychology of a <a href="https://ru.wikipedia.org/wiki/%25D0%2597%25D0%25B5%25D1%2584%25D0%25B8%25D1%2580%25D0%25BD%25D1%258B%25D0%25B9_%25D1%258D%25D0%25BA%25D1%2581%25D0%25BF%25D0%25B5%25D1%2580%25D0%25B8%25D0%25BC%25D0%25B5%25D0%25BD%25D1%2582">marshmallow experiment</a> .  For those who are lazy to read Wikipedia, retelling: children are given a marshmallow, and they say that if they don‚Äôt eat it in 15 minutes, they will be given a second (and both can be eaten).  The older the child, the more likely it is that it will last 15 minutes.  Kids can not restrain themselves and eat the marshmallow immediately, although then it becomes offensive.  This experiment tests the mechanism of "deferred pleasure." </p><br><p>  This is exactly what configuration management systems offer.  You spend half an hour on the operation, which you can do with your hands in 3 minutes, and then this operation can be performed again and again (when necessary) without the expense of three minutes.  And most importantly, without involving the head.  Most often, this procedure is delegated to the CI server (jenkins, buildbot, etc), and then it opens the door for the first step to the magic door called CI / CD. </p><br><h1 id="staging">  Staging </h1><br><p>  And this little step is called 'staging'.  A copy of your production that doesn‚Äôt do anything.  On which you can see the answer to the question "what will happen if I change the version of the server?"  and other funny experiments without breaking your production. </p><br><p>  Of course, staging can be done without configuration management systems.  But who will make sure staging looks like production?  Moreover, who will make sure that after your ridiculous experiment, staging is still similar to production?  If you make a ridiculous experiment on the result of a previous ridiculous experiment, then perhaps the result will be different from what you will get later on production. </p><br><p>  This question is "who will follow?"  actually with a tuck.  If you do not have a giant bloated state in which you can have a couple of people who are watching the staging, then the answer is no one.  No one is following.  What to do? </p><br><p>  The answer is: "we destroy to the ground," and re-create it from scratch.  If in this process more than a minute of time is required from a person, then, of course, no one will do it.  It‚Äôs too sad to do the same thing again and again to correct the ‚Äúridiculous experiment.‚Äù <br>  The usual thought "Yes, why re-raise it, I will now return everything back with my hands, so faster."  At the exit - a ridiculous experiment and the result of its correction, instead of a "copy of production". </p><br><p>  But if there is a robot that "goes and does everything himself," then yes, no problem.  Went and did. </p><br><h1 id="razmnozhenie-stagingov">  Staging propagation </h1><br><p>  If re-styling is so simple, then why not raise it in one more instance?  It may be simpler, it will not have any of the important complex heavy components, but the necessary piece, on which you are working right now - why not? </p><br><p>  And it can also be on a localhost, in a virtual machine or container.  What gives you almost zero latency when working (nice), support for offline mode (useful).  This will require a bit of work with the configuration management system, but far less than it might seem.  And then - tyk-tyk and you have a fresh piece of a copy of the production (or even something specific to your feature set from the gita). </p><br><h1 id="refaktoring">  Refactoring </h1><br><p>  After you have written the process of turning several servers into production and you can repeat it again and again (with little effort), you are free to start changing pieces of this process (to a more convenient / correct / trendy process) and see what you get. </p><br><p>  This requires the second part of the configuration management system ‚Äî server validation.  We'll talk about this a little later, but for now, focus on a simple idea: you can try changing something in the server configuration process and see what happens.  For free.  (From myself: when I'm not sure, I sometimes run 2-3 versions in parallel on different stagings to choose the best one). </p><br><h1 id="code-review">  code review </h1><br><p>  Refactoring and storing instructions for the configuration management system in the gita makes it possible to carry out code review (if you have more than one person in the team).  code review is awesome!  First, he disciplines not to leave curvature.  Secondly, you learn from each other how to do better.  Third, it increases mutual knowledge about the project and the changes occurring in it.  Developing the ci / cd line, with some effort, you can even see the results of the proposed change run on the temporary installation - and the robot can pull the pull request simply because it ‚Äúbreaks everything‚Äù - no human involved. </p><br><h1 id="testy">  Tests </h1><br><p>  If we have a set of instructions for a configuration management system, then we can check the result.  There are a lot of interesting solutions for this: testinfra, goss, inspec, serverspec, etc.  In fact, these tests allow you to verify the result of applying your configuration.  For example, ‚Äúon the 80th port are listening‚Äù, ‚Äú180 checks appeared in the monitoring‚Äù, ‚Äúuser X can log in to the server‚Äù, etc.  When you have such tests, you can play with the process for as long as you need - if the tests pass, then you did everything correctly.  Because of this, you can try new (impudent) and not be afraid of the unexpected (for example, "oh, I did not think that enabling SSL would break the whole monitoring"). </p><br><h1 id="job-security">  Job security </h1><br><p>  Configuration management systems directly threaten low-skilled system administrator jobs.  If earlier we needed 20 administrators, each of whom could manage 20 servers, now a team of three (slightly more qualified administrators) can perfectly cope with 400 servers.  In fact, one can also cope, but 2-3 give greater team competence, a smaller bass factor (concentration of knowledge from a single person) and improve the atmosphere in the team thanks to mutual responsibility for the quality of work.  And with job security, everything is simple.  Either you are on the list of these three administrators, or not. </p><br><p>  In fact, I‚Äôm a bit crafty and the reality usually looks like this: instead of 60 servers, three administrators have 400 (1000? 2000?) Servers on their hands, and the option "to hire 17 more administrators" is simply not worth it for budget reasons.  But these are features of a growing market and a shortage of qualified personnel, but the general argument still remains: configuration management systems increase labor efficiency, and people with higher labor efficiency are more in demand on the market. </p><br><h1 id="eschyo-odna-programma-kotoraya-trebuet-vnimaniya">  Another program that needs attention </h1><br><p> With all the positivity of the above, any configuration management system is just a program.  This means that there will be bugs.  Including offensive requiring to do uncomfortable and ugly just to get around the bug.  This means that the obvious architectural features will not be implemented simply because programmers have a different vision of the direction of the project.  This means that instead of part of the documentation there will be "Documentation" (which is located in the <code>src</code> directory).  Like any other program, it will require attention to its inner world, giving itself time, competence (and more time to study). </p><br><h1 id="i-eschyo-raz-o-smene-paradigmy">  And once again about the paradigm shift </h1><br><p>  All of this (including bugs and a deep inner world) will require adapting the thinking to a model dictated by the configuration management system.  Configuration management is an extremely invasive entity that wants to be central to everything, and many workflows will have to be tailored to the requirements of this program.  There will be many frontier moments when it becomes worse (earlier it was possible to make better and easier), there will be many times when there is a feeling of performing an absurd ritual instead of normal work. </p><br><p>  But at the same time there will be another feeling - that there is less button and more thought.  Instead of ‚Äúgo and change‚Äù there will be a moment of reflection ‚Äúis it right to change so?‚Äù, ‚ÄúAnd why should it be changed at all?‚Äù, There will be more arguments about the architecture (why on the server And we change one value and on the server B it‚Äôs different? Can we do we find something in common between these changes and describe this common as a new entity?) </p><br><h1 id="ontologiya-ili-2nd-hard-problem">  Ontology, or 2nd hard problem </h1><br><p>  Ontological problems will be in full growth.  Reflections on the "common to different changes" will constantly lead to the emergence of new things, and new things require names.  It is well known that inventing names is the second difficult problem in IT (the first is cache invalidation), and it is complicated because the invented name determines the properties and expectations of the object.  And you will have to painfully invent names every time.  Every mistake is a piece of curvature in architecture.  If before the changes were "because it is necessary to change", then now there will be changes, because "it is so necessary to implement the properties of sepule."  I tried to avoid anecdotal examples (from life), but I still give.  It took me three weeks in one project to come up with the name "system configuration" (to describe the part of the changes that affect server settings and require using ansible, as opposed to "software configuration", to describe the part that does not require intervention ansibla).  The idea turned out to be reasonable and helped to divide the impossible intertwined bundle of dependencies "should be changed on server A, but only after the user changes the interface B, but if the user changes B, then we need not touch A, and if the user changes E, then B changes and B, so we need to somehow change both the server configuration and the part that the ansiblom is not configurable. "  Phew ... Long-forgotten horror.  Which had to be felt, thought out and found a name for a separate entity within it. </p><br><h1 id="pereezd-s-frontira-v-bek-ofis">  Moving from the frontier to the back office </h1><br><p>  Since the buttons for changing the config on the server are pressed less and less, and thinking about the abstract more and more, life gradually creeps from <code>ssh user@server</code> to <code>git commit</code> . <br>  This means that after the configuration management system comes a lot from the life of programmers.  The structure of the code (code !!), tests, expressiveness and clarity, code review, readiness and stability of the code (code !!) to unexpected changes in the TK, the TK itself begins to appear in one way or another.  Appear issue, which is not ‚Äúto repair now‚Äù, but ‚Äúto figure out how to eliminate‚Äù, a technical debt appears (now they need to be rewritten), a backlog appears, well-known bugs appear.  Example: .., yes, yes, we know that now our configuration incorrectly sets the caching options for disks, but to make changes, we must first rewrite the piece responsible for the classification of block devices.  This is despite the fact that a normal admin would have done <code>hdparm -W 0 /dev/sda</code> on 400 servers in a long time ago.  Perhaps, to the 300 server, he would understand that sda sometimes is a virtual cd-rom and on each server it is necessary to check who the attribute is exposed to ... but this is another story. </p><br><p>  The life of the admin is becoming less and less like the life of the admin.  The profession is divided into those who write the configuration and those who accompany it (ie, remains on the frontier, alone with the server).  These are sometimes called SRE, and depending on the criticality of the project at any given time, this can be both a very cool and important profession, and an "upgraded support". </p><br><h1 id="s-chego-nachat">  Where to begin? </h1><br><p>  If I motivated you a little bit, but you don‚Äôt know where to start, then start by finding the configuration management system that you like.  These are Ansible, cfengine, Chef, Juju, Puppet, SaltStack, Quattor, etc.  Most likely, the list is not full.  None of these solutions is good (in my opinion), but this is the best that we have.  The choice of such a system must be partially based on known programming languages ‚Äã‚Äã(this is my IMHO), the feeling of the syntax and the viability of the project. </p><br><p>  After selecting the software, do not rush headlong.  Reading smart books on such a system is necessary, you can play too, to any level of complexity, but it‚Äôs worth implementing very limitedly, without losing control of the situation.  This means that you need to start with a simple automation of long actions (rewrite your favorite deployment script in the language of the configuration management system), try to write at least some of what you are doing with your hands. </p><br><h1 id="postscriptum">  postscriptum </h1><br><p>  One of the most interesting life hacking with configuration management systems, I consider a laboratory application.  When researching a new software, the configuration of this software by the configuration management system allows you to "try again" (if it is not clear whether the software makes side effects on the server). </p><br><p>  At the same time, the description for the robot "what to do" is great for the role of the preliminary draft implementation.  At one time I debugged corosync, which did not want to work on the network with a limit of unknown unicast / multicast.  During debugging, I had to re-cluster several dozen times.  When this was done by ansible, "a few dozen times" did not become a feat, but came to something of the "restart the laboratory" level. </p><br><p>  The daily use of configuration management systems requires a restructuring of the most basic instincts for working with servers, but instead of a very unpleasant learning curve, it offers not only a tool to increase work efficiency, but also a change in behavior and thinking patterns to a more effective one.  This is a very difficult step, but a step that must be done. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/343644/">https://habr.com/ru/post/343644/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../343634/index.html">Announcement of the meeting WordPress Meetup # 4 in Kharkov</a></li>
<li><a href="../343636/index.html">XML string constructor from PHP array</a></li>
<li><a href="../343638/index.html">How to make remote access more secure with a token?</a></li>
<li><a href="../343640/index.html">Greenplum 5: first steps in open source</a></li>
<li><a href="../343642/index.html">Mother's architect: how we collected mobile architectures and pleased our parents</a></li>
<li><a href="../343646/index.html">Overview of important legal requirements of the Facebook platform</a></li>
<li><a href="../343648/index.html">The battlefield is augmented reality. Part II: how to recognize the object and show the 3D model</a></li>
<li><a href="../343654/index.html">Why do Russian cybersecurity exhibitions die?</a></li>
<li><a href="../343656/index.html">Report from the Android Devs Meetup Meeting on September 22</a></li>
<li><a href="../343658/index.html">Dagger 2 for novice Android developers. The introduction of dependencies. Part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>