<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What to do on the weekend: remote control intercom, budgetary remapping Nextion, disassembly with Onlaym</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sometimes on Fridays here is considered permissible publication of fiction. Today, of course, not Friday, but this is not quite fiction, but rather th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What to do on the weekend: remote control intercom, budgetary remapping Nextion, disassembly with Onlaym</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/044/f5f/30d/044f5f30df86463087940fff4fc4ba92.png"><br><br>  Sometimes on Fridays here is considered permissible publication of fiction.  Today, of course, not Friday, but this is not quite fiction, but rather three mini-novels that have something to do with my life. <br><br>  A hurried reader may also wonder what, in fact, the relationship can generally intercom and Internet service provider.  And he will be right, because I, too, did not immediately come to this. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But about everything (Arduino, banal lifehacks, phone squabbles) in order. <br><br><a name="habracut"></a><br><br><h2>  Sim, open up! </h2><br>  To be honest, the remote control of the intercom according to my version is almost useless, and I was fully aware of this even before I started.  Therefore, to justify the venture, I had to use all the power of imagination to come up with a couple of cases, as they say. <br><br>  To begin with, I decided that I would allow guests to bask in the entrance in this way, if I did not even have time to reach the house myself.  Or, I won't bother too much, getting the keys in advance, because you can just set up the phone so that it issues a command to open the door when I come to the house. <br><br>  It sounds pretty crazy to ordinary people, but, as they say, per aspera ad astra. <br><br>  And I really wanted to somehow use a pair of relays that were idle in the central controller from the very beginning of its operation.  The situation is, in fact, ridiculous: at that time there was only a block for 4 relays, of which only two were needed.  And I didn‚Äôt want to wait for another month for the double-block, so I gathered it from what was at hand and immediately began to worry about redundancy. <br><br>  However, to the intercoms.  In general, automatic opening of the intercom is not an exclusive thing.  For example, here, on Geektimes, Comrade.  <a href="https://geektimes.ru/users/cluster/" class="user_link">Cluster</a> back in 2013 (when the dollar was 30) made not just a <a href="https://geektimes.ru/post/258054/">remote control, but also an answering machine for guests</a> . <br><br>  This is by far the coolest thing I've seen in this class. <br><br>  But much earlier, visitors to RadioKot and many other thematic forums had <a href="http://radiokot.ru/forum/viewtopic.php%3Ff%3D3%26t%3D39694">fun with ‚Äúopener‚Äù devices</a> - unlocking the intercom immediately after the call. <br><br>  Neither one nor the other, I was not going to repeat.  The first is because it is difficult, and because I already had a working controller, which I planned to empower with new powers.  The second is for more obvious reasons: too many details and too little sense, I apologize if I hurt the authors. <br><br>  Sense, of course, for me, and not at all.  That is, I absolutely do not like the scheme, which hospitably opens the door to anyone who dials the apartment number. <br><br>  Hence the basic requirements for my opener: <br><br>  1) Using the central controller to control via the Internet and by radio <br>  2) Minimal protection against unauthorized access <br>  3) Minimal interference in the interior <br><br><h3>  Start </h3><br><br>  I started by familiarizing myself with the principle of the intercom, which I borrowed <a href="http://forum.domofon.ru/lofiversion/index.php/t11186.html">here</a> : <br><br><blockquote>  The tube works very simply: when the tube is packed with a resistance of 50 Ohms, when the tube is removed, the resistance is approx.  400 ohms when the lock button is pressed, the resistance is measured in kilo-ohms ... When there is no call, there is no voltage in the line.  When there is a call and the tube is large, the voltage is low 5-7V, when the tube is absent and the resistance is infinite and the maximum voltage is approx.  15V, when the tube is removed, the voltage is approx 10V.  When the button is pressed, the maximum voltage is approx.  15V - pressing the button is equal to breaking the line. </blockquote><br><br>  In the case of Numeral, this is a bit wrong, since the documentation for the handset, and I had KM-2NO (by the way, I express my appreciation to Numeral for publishing the scheme) states: <br><br><blockquote>  1. The current consumption in the "Conversation" 18-22 mA <br>  2. Line voltage with a tube installed on the case of 1.5-2.5 V <br>  3. Voltage in the line with a lifted tube of 5.8‚Äì6.5 V <br></blockquote><br><br>  Therefore, I became more familiar with the concept of my tube: <br><br><img src="https://habrastorage.org/files/b76/591/c8f/b76591c8f87c4eaca7a8bfec1f652f39.png"><br><br>  And I found out that everything is exactly the same in terms of resistance, and, most likely, the rest of Digram‚Äôs logic is hardly different from a Visit. <br><br>  I draw attention to the fact that my modification without LED.  But this turned out to be just right, since this fact makes it very easy to transmit call information to the central controller. <br><br>  Namely: the call sounds, the LED lights up, the optocoupler turns on, on the controller pin we have the level change from high to low. <br><br>  So instead of the LED, I put the 4N35 optocoupler I already had, which I sent straight to the Arduino.  <a href="https://www.robotics.org.za/index.php%3Froute%3Dproduct/product%26product_id%3D104">According to the standard scheme</a> from the same Internet: <br><br><img src="https://habrastorage.org/files/a7f/c39/9f8/a7fc399f840e4931b225370b2f21c3cd.jpg"><br><br>  And since I wanted to get by with a minimum of parts and available controller resources, of which the digital pins were the most valuable (they were not enough for Uno), I used the Arduino built-in pull-up resistor instead of a 10K pull-up resistor. <br><br>  When connected to a digital pin, it looks like this: <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ringPin _ pinMode(ringPin, INPUT_PULLUP);</span></span></code> </pre> <br><br>  When connected to analog pinu: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ringPin _ pinMode(ringPin, INPUT); digitalWrite(ringPin, HIGH);</span></span></code> </pre><br><br>  I decided to place the optocoupler by the microcontroller.  I can not justify, but I thought that this is less the risk of false positives from possible interference.  It is possible that it is not right, but so far everything is normal with interferences, i.e.  they are not. <br><br>  As for the land in the above example, it should be understood: although the earth seems to be general in the diagram, this is not the case - the optoelectronic isolation actually exists.  Well, he is an example. <br><br><h3>  Get away from me! </h3><br>  The decision to completely get rid of the intercom chains did not come immediately, but inevitably.  I very incidentally recalled the case of six years ago, when I observed how an awkward moment with an electromagnetic lock formed during the installation of the ACS. <br><br>  I do not know how it happened, but it turned out that the castle worked somehow.  That "vpolnakala", then nothing at all, and the installers themselves already broke his head.  But in the end they assumed that an unexpected short-circuit (or something like that) happened somewhere in the control circuits.  Of course, they checked everything, of course, without much success, since they were clearly following the instructions. <br><br>  Fuel to the fire was added by the fact that the exact same lock of exactly the same configuration, but on the other floor worked just fine. <br><br>  How long, if short, decided that the matter is in the door itself, on which the lock is mounted.  In my opinion, it was assumed that when it was installed, they stuck into the armature, which, in turn, was grounded, which led to unexpected effects on the lock (which may have had a control circuit to the housing). <br><br>  In general, understood quite a long and tedious.  And I did not want a repetition of the same at home. <br><br>  Therefore, I did not save the wires and connected the relay contacts in the simplest way: <br><br>  1) Normally closed single relay - in series with the tube lift button SW1 (because this button is normally closed) <br>  2) Normally open another relay - in parallel with the door opener button SB1 (because this button is normally open) <br><br>  The control contacts of the relay, of course, connected to the free (hooray, they were still) digital pin microcontroller. <br><br>  In total, as is easy to imagine, it took six wires: two for the optocoupler and another four for the relay. <br><br>  I apologize for the primitivism of the illustration: <br><br><h4>  From the intercom </h4><br><img src="https://habrastorage.org/files/cfe/2f2/23c/cfe2f223cb2b4d49ad1b853482b3895a.png"><br><br><h4>  From the Arduino </h4><br><img src="https://habrastorage.org/files/c99/84f/e4b/c9984fe4be554b13b2ec17915ca86474.png"><br><br>  The relays here are extremely schematic.  Since, I repeat, I used ready-made relay modules with full stuffing - optocouplers, transistors, diodes, and so on.  I strongly recommend not connecting bare relays to Arduino. <br><br><h3>  ... and don't call me anymore! </h3><br>  Already at this stage, I was able to very easily open the intercom via the Internet or a local network from a computer or smartphone according to the following principle: <br><br>  1) At the time of the doorphone call, the controller for 40 seconds switches to the mode of opening the door.  The time is selected on the basis of the documentation on the Cipral doorphone, where it is indicated that the duration of the call signal is exactly 40 seconds. <br><br>  Those.  for a longer time conditionally open there is no point in remaining. <br><br>  2) When receiving an opening command via the Internet (HTTP POST), the controller sequentially switches the relay.  First - opens the relay tube, which imitates its rise.  Then, after a short pause, the relay of the opening button closes, thus imitating its pressing.  After - "releases" the button and "hangs up". <br><br>  The test bench was extremely primitive: <br><br><img src="https://habrastorage.org/files/3b5/44c/db1/3b544cdb17ab4f67953d7643d98e0156.jpg"><br><br>  One could stop at this if I, as the proud owner of <a href="https://geektimes.ru/post/258350/">KCDV-12-2, were</a> not aware of how inconvenient it is to run at the console or the phone each time when something needs to be turned on / off. <br><br>  And, in particular, if I had not recently completed a <a href="https://geektimes.ru/post/282816/">desktop weather station with a touch screen</a> and it seems that the potential is not fully revealed. <br><br><img src="https://habrastorage.org/files/90a/d36/f45/90ad36f45757421295f332c7425578fa.jpg"><br><br>  In short, I quickly (in fact, no) added to the weather station the most ordinary and vulgar 433 MHz transmitter with amplitude modulation, which sell tons on Aliexpress for ridiculous money. <br><br>  As a result, the weather station has become another point of control for the intercom, and therefore, if the bell rings and you sit next to it, then there is no sense in breaking the phone, because you can directly from the screen: <br><br>  1) Open the lock <br><br>  2) Pick up the phone and slowly (according to the documentation, the duration of the conversation is 1.5 minutes versus 40 seconds of the call) to reach the intercom, answer and decide whether to open or not <br><br>  3) ‚ÄúBeat off the bell‚Äù (the controller ‚Äúpicks up‚Äù and immediately ‚Äúhangs up‚Äù the handset) <br><br>  To do this, of course, I had to slightly modify the code and interface of the weather station, but on the way I found where there are annoying errors in displaying graphs (as it turned out, I‚Äôve got in DNA, but this is another story). <br><br>  A new interface, by the way, now does not look like HAL.  Now, everything is so colorful and jovial that you just laugh.  And you must understand: I didn‚Äôt drink a smoothie, the hipsters didn‚Äôt bite me, there were no lamberseks in the family, but I‚Äôm drawn to the material style like never before in my life: <br><br><img src="https://habrastorage.org/files/71a/154/0d4/71a1540d420441d3aa62d3ca673f3a43.png"><br><br>  This screen replaces the climate data when the intercom is ringing: at this moment the central controller issues a radio command, to which the meteodisplay responds. <br><br>  It may be a little illogical here, but the bell in the center primarily informs about the intercom call.  Clicking on it (here illogical) turns off the sound of the intercom in the most barbaric way - imitating the process of raising and lowering the tube. <br><br>  The castle on the left is the opening of the castle.  The tube on the right is a tube lift to simulate the beginning of a conversation. <br><br>  The screen changes to the main one after 40 seconds from the beginning of the call, and not immediately after pressing the icon button.  This allows you to press several times, if the controller suddenly did not ‚Äúhear‚Äù the command, which is not uncommon considering the type of radio channel used. <br><br><h2>  Algorithms </h2><br>  As I mentioned, at first I was modest and wanted only one thing: to open the intercom on command from the phone, and at the time of the call. <br><br>  But having played around for a couple of days, I realized that standing in front of an intercom and poking at the screen is a rather boring task, and it is much more interesting to allow a ‚Äúdelayed‚Äù opening when you approach the entrance.  Then it remains only to dial the apartment number on the panel of the intercom and voila, the door is open. <br><br>  Finally, I thought that in this situation, it would probably make sense to prohibit opening - in general. <br><br>  But then he took himself in hand, then let go of himself, picked up a more useful tool, popularly referred to as Occam's razor, and quickly got rid of unnecessary entities.  That is: once I did the remote control, it was not to turn it off.  Therefore - shutdown is generally not necessary. <br><br>  Secondly, due to sober (and not as usual) reflection, it turned out that there was no particular difference between opening at the command directly at the time of the call or at the command given in advance. <br><br>  Finally, returning to the ergonomics of management, I want to say that the more modes there are, the less ordinary people will use them.  Why, what a bore, but as I imagined that I had three modes for different occasions, I realized that I would still use one. <br><br>  Therefore, there is one mode and one command, and two handlers: <br><br>  1) If the intercom is ringing, the controller allows opening within 40 seconds from the beginning of the call <br><br>  2) If the opening command comes first, the controller allows opening and waits for a call within N minutes from the moment the command was received (this is to prepare the intercom for opening on the way to the house) <br><br>  There are two sources for the opening command too: <br><br>  1) HTTP POST request via a local network or the Internet (for example: <a href="http://myserver.com/%3Fsim-sim-openup">myserver.com/?sim-sim-openup</a> ), i.e.  you can open at least from Kuala Lumpur <br><br>  2) Radio command from panels or buttons at home (in my implementation, <a href="https://github.com/sui77/rc-switch">through the RC-Switch library</a> ) <br><br>  And since the whole structure is connected to the handset without affecting its operation, the intercom can continue to be used in the usual way (bell-hi-hi-button), i.e.  home, not able to assess the merits of technological progress, and do not have to delve into the details. <br><br><h3>  Sudden Bonuses </h3><br>  Even if you do not use the function of opening the door, now it turns out that the controller regularly notifies that someone is scratching at the door of the entrance by means of an intercom.  As a curious person, this information is not without interest - and now I receive it regularly. <br><br>  More importantly, this function continues to work even if you turn off the doorphone tube with its switch.  Potentially, this means that there is less chance of leaving the intercom disconnected if it suddenly took a while to eliminate the possibility of his calls. <br><br>  Unfortunately, the intercom system is such that when it is turned off, it becomes impossible to remotely control the lock (it seems that the central unit considers that in this case the handset is ‚Äúhung‚Äù, regardless of its actual position). <br><br><h3>  And landscape design </h3><br>  Since I was striving for minimal interference in the interior, I had to decide how to connect to the central controller, assuming that the controller and the intercom are on different sides of the door, and the controller has electricity, but the intercom tube does not. <br><br><img src="https://habrastorage.org/files/7b6/8e8/6c3/7b68e86c3aab453e8fcbc579149f4e2a.JPG"><br><br>  In the end, I decided that stretching the train behind the door frame and closing its fragments with decorative panels printed on a 3D printer would be better than occupying another outlet with a power supply unit, it is not clear how to pull its wire to the doorphone handset and fence the radio channel between the handset and the controller. <br><br><img src="https://habrastorage.org/files/e65/a91/84a/e65a9184ab9d4cb29e84e515689e607e.JPG"><br><br>  And I think that in my conditions this is the best option.  Yes, and the relay went into action, but with a radio channel, they would again remain in reserve. <br><br><h2>  Remapping Nextion </h2><br>  Speaking about the desktop weather display (weather station, if you will), I mentioned that in the process of finishing the case I managed to damage the main component - the Nextion touch screen itself. <br><br>  The breakdown did not affect the operation of its onboard microcontroller and the display of data, but the touch panel almost failed.  However, I found out experimentally that if you don‚Äôt even push the Nextion board in a particular place, you can restore the sensitivity of the left (approximately) half of the screen. <br><br>  This trick is unstable and not always working, but often enough so that I can come to terms with it, thinking about ordering a new screen. <br><br>  Of course, it made me happy and sad.  On the one hand, it was possible to achieve partial performance.  On the other hand, I would like to play a little more with the graphs.  And then I suddenly realized what a stupid trap I had got: for some reason, I was fixated on using the entire screen area, when I could freely transfer the ‚Äúnon-working‚Äù buttons to the work area. <br><br>  I understand that for many this is a really trite decision.  But I would like to share innocent joy with those who, like me, love to go to extremes. <br><br>  So, I figured in place, slightly changed the size of the buttons, drew a new virtual control scheme in my head and voila!  We have almost completely restored functionality of a partially killed display. <br><br>  It was: <br><br><img src="https://habrastorage.org/files/8cb/774/fc0/8cb774fc06b444ce994ad1470e7319d8.jpg"><br><br>  It became: <br><br><img src="https://habrastorage.org/files/202/2b8/82f/2022b882fd2245a79cc4fae8514ddde5.jpg"><br><br>  Along the way, however, I had to kill the perfectionist in myself and redo the original screen for controlling the intercom to the minimum working: <br><br><img src="https://habrastorage.org/files/bd2/bec/a58/bd2beca5810346c5a99099e1ac046288.png"><br><br><h4>  Live </h4><br><iframe width="560" height="315" src="https://www.youtube.com/embed/P6Iqh6SYVRU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br><h2>  When technical support is "not ale" </h2><br>  It would seem that all these ups and downs could have been completed if it were not for one detail: I suddenly discovered that the intercom (and after all the other automation) stopped being controlled by access from external networks. <br><br>  That is, all the teams worked flawlessly when connecting to the Internet via the home network and by external addresses (and not by the internal view 192.xxx.xxx.xxx), but just as flawlessly refused to be executed from the networks of other operators (I tried two). <br><br>  Here we must understand that the commands are transmitted via an HTTP request to a specific external port of the router, and from there they are already being redirected to the necessary internal IP and port. <br><br>  And this scheme has worked without any problems since its launch in 2013 until something has broken in the current one.  And I am still sure that it was not my fault.  But I do not know how to check. <br><br>  Actually, at first I wanted to swear with Beeline, because I initially thought that the problem was in the mobile Internet.  But then he took himself in hand, found another provider, tried it and found out that through him the same problem. <br><br>  Then I called Online and, as I could, explained the essence of the claims.  And in response, I was widely explained that: <br><br><blockquote>  For the purpose of preventing unauthorized access to subscriber equipment, the operator blocks the following ports in the incoming subscriber traffic: <br>  TCP / 25 - prevention of spam activity; <br>  TCP / 135-139, TCP / 445 and UDP / 135-139 - Securing systems running under MS Windows; <br>  TCP / 23, TCP / 161, UDP / 69 and UDP / 161 - Client protection. <br><br>  All other ports, including the named ones, are not blocked. </blockquote><br><br>  I, in turn, insisted that my port did not fall into this range, b) did not work, as it should be, and c) I did not change anything. <br><br>  How about a wall of peas. <br><br>  Well, what to do, then I politely explained that although I understand that my unfortunate 450 rubles a month will not make them, but I‚Äôm going to look for such pofigism, let it be the same pofigism, but at least working. <br><br>  In response, they muttered again that they give me IP, and then all my problems.  Well, mine, I decided, it means mine.  And with a strong-willed decision, I first checked the performance of the system on another port (shifted by one) - it works.  And then I made a flexible configuration of the port number in Tasker, through which, in fact, the steering wheel was automated. <br><br>  Actually, what I describe my sufferings for: I objectively really wanted to understand who is wrong in such a situation.  Because I feel like a complete idiot - and the router rebooted, and checked the settings (moreover, on my own initiative, and not at the prompt of "experts"), and still they sent me far away, hinting at my crooked hands. <br><br><h2>  Behind the scenes </h2><br>  In conclusion about what I used for the construction of the century: <br><br>  1) <a href="https://geektimes.ru/post/258350/">CCVDV-12-2</a> - 1 pc. <br>  2) Intercom handset Tsifral KM-2NO - 1 pc. <br>  3) Optocoupler 4N35 - 1 pc. <br>  4) Flat cable 10 lived (used six, but put everything - just in case) - 3 m. <br>  5) Cable connectors - 2 pcs.  dad and mom <br>  6) Homemade <a href="https://geektimes.ru/post/282816/">weather display with touch screen Nextion</a> - 1 pc. <br>  7) 433 MHz transmitter ( <a href="https://www.aliexpress.com/item/1set-Wireless-RF-receiver-module-Transmitter-Board-module-for-Arduino-Super-regeneration-433-MHz-DC5V-Launch/32737540123.html">from a package like this</a> ) to modify the meteodisplay - 1 pc. <br>  8) 1 kŒ© resistor for optocoupler - 1 pc. <br><br>  Options: <br><br>  <a href="https://yadi.sk/d/E-IT5xD239KyE6">Updated interface for Nextion</a> <br><br><div class="spoiler">  <b class="spoiler_title">Test code (before integration with CCVD-12-2 and a full bouquet of service functions, only for understanding the train of thought)</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;RCSwitch.h&gt; // http://code.google.com/p/rc-switch/ #define ringTimeOut 40000 //       2094 #define openTimeOut 300000 //    allowOpen         #define handsetPin A3 //    0 #define openPin A4 //    (1) #define ringPin 7 //   (3) #define ringCode 360500 //         #define doorBell 3395840 //        #define openCode 255899 //      #define openDelay 1500 //     #define handsetDelay 2500 //     #define txPin 8 unsigned long ringTime, openTime; //     boolean ring = false; boolean ringRepeat = false; //        boolean allowOpen = false; //      RCSwitch mySwitch = RCSwitch(); //   void openDoor() { digitalWrite(handsetPin, LOW); delay(handsetDelay); digitalWrite(openPin, LOW); delay(openDelay); digitalWrite(openPin, HIGH); digitalWrite(handsetPin, HIGH); ring = false; //    allowOpen = false; //       // sendMail(37); //       } void setup() { Serial.begin(9600); mySwitch.enableTransmit(txPin); //   mySwitch.enableReceive(0); //   pinMode(handsetPin, OUTPUT); //     pinMode(openPin, OUTPUT); pinMode(ringPin, INPUT_PULLUP ); digitalWrite(handsetPin, HIGH); //   digitalWrite(openPin, HIGH); Serial.println("Ready"); } void loop() { if (digitalRead(ringPin) == LOW &amp;&amp; ring == false) { //             ring = true; //     ringTime = millis(); // sendMail(36); //      mySwitch.send(ringCode, 24); Serial.println("Sent ringCode"); if (ringRepeat == true) { //       mySwitch.send(doorBell, 24); Serial.println("DoorBell repeat"); } Serial.println("Ring-ring!"); } if ((millis() - ringTime) &gt; ringTimeOut &amp;&amp; ring == true) { //   40  (   )     ring = false; //    Serial.println("Ring reset"); // sendMail(38); //      } //    if (ring == true &amp;&amp; allowOpen == true) { openDoor(); //   Serial.println("Door opened via net"); } if (ring == false &amp;&amp; allowOpen == true) { //  ""    if ((millis() - openTime) &gt; openTimeOut) { //       allowOpen = false; // sendMail(39); //      } } //    if (mySwitch.available()) { // int value = mySwitch.getReceivedValue(); if (value != 0) { Serial.println(mySwitch.getReceivedValue()); switch (mySwitch.getReceivedValue()) { case openCode: //    if (ring == true) { mySwitch.disableReceive(); openDoor(); //   Serial.println("Door opened via radio"); mySwitch.enableReceive(0); //   } break; } mySwitch.resetAvailable(); } //    } }</span></span></span></span></code> </pre><br></div></div><br><br>  Pictures for the interface took on the wonderful site <a href="https://pixabay.com/">Pixabay</a> . </div><p>Source: <a href="https://habr.com/ru/post/400367/">https://habr.com/ru/post/400367/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../400357/index.html">Google showed a sample of charity with a triple benefit</a></li>
<li><a href="../400359/index.html">Proprioception for non-specialists. Part 3. Dynamic sitting on a chair.</a></li>
<li><a href="../400361/index.html">Foreve Elon 2016/2017 (New Year's Eve online)</a></li>
<li><a href="../400363/index.html">We dive deep into: from CSS to the transistor</a></li>
<li><a href="../400365/index.html">What promise VKontakte users in 2017</a></li>
<li><a href="../400369/index.html">Rostelecom buys Microsoft software for 1.26 billion rubles</a></li>
<li><a href="../400371/index.html">2017 is not just a prime number ...</a></li>
<li><a href="../400377/index.html">Review of current 3D materials</a></li>
<li><a href="../400379/index.html">How we arranged the quest in the Telegram, and what came of it. UPD: we have summed up the competition</a></li>
<li><a href="../400381/index.html">Designing a switching power supply with active CMC. Episode I</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>