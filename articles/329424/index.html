<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What is hidden inside the car auction platform</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Services for the sale of used cars are usually built on one principle: "placed an ad, called, showed the car, sold." In such projects, high technology...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What is hidden inside the car auction platform</h1><div class="post__text post__text-html js-mediator-article">  Services for the sale of used cars are usually built on one principle: "placed an ad, called, showed the car, sold."  In such projects, high technology is concentrated mainly around the site itself.  But we are different.  We have created a <a href="https://www.carprice.ru/%3Futm_source%3Dhabr%26utm_medium%3Dtext%26utm_campaign%3Dfirst-article">platform</a> on which anyone can sell car dealers through the auction system their second-hand car (even an emergency one), with the technical condition checked by our specialists.  Behind the seeming simplicity of the description lies a complex ecosystem of self-written and third-party software products, which we want to talk about. <br><br><img src="https://habrastorage.org/web/174/63e/5db/17463e5dba20427fbb8214276a31d898.jpg" alt="image"><br><a name="habracut"></a><br>  Hello!  My name is Ilya Pyatin.  I am responsible for IT at CarPrice and today I want to tell you in general terms about the insides of our platform and what we are doing from it. <br><br>  Our story will follow this pattern, so from time to time we will repeat it so that you don‚Äôt have to return often to the beginning: <br><img src="https://habrastorage.org/web/6d1/185/841/6d11858416ce41d2af99d918fd4c7c4d.jpg" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Car reception </h2><br>  So, a man wants to sell his car.  He visits our public site (there are closed parts of the system, more about them later), fills out a short form and signs up for a meeting in one of our branches (there are more than 45 of them in 21 cities in Russia). <br><br><h4>  Technical Reference </h4><br><blockquote>  The Bitrix client site visible to all in the current microservice architecture is in fact one of the ‚Äúfronts‚Äù.  Information entered by car owners is transmitted to internal storages, analytics system, call center, marketing systems, and so on. </blockquote><br>  A <b>calculator</b> is also available on the public site, with which you can roughly estimate how much you can earn for a car at the CarPrice auction.  Prices are calculated using an analytical algorithm based on the sales statistics for specific brands, models, technical condition, demand in various regions of the country, and so on. <br><br>  After entering the data get into our call center.  You call up the owner of the car, clarify additional information and warn you what documents you need to take with you. <br><br><h4>  Technical Reference </h4><br><blockquote>  The call center is built on the <a href="https://oktell.ru/">Oktell</a> / MSSQL platform and operates in our private cloud.  It is integrated with CSI - an advanced user survey system, client CRM and various mailing and notification services.  It also records the primary information about the owner of the car, the legal status of the car, and so on. </blockquote><br>  When a person arrives at a selected branch, our employee, a specialist in car inspection, meets him there.  He checks documents using our internal system called AutoCheck.  Information from PTS, JTS and passports is entered there, and AutoCheck checks information on all available bases of state services and collects data on various bans, restrictions, fines and other legal problems that may arise when selling this car. <br><br>  If problems are found, we inform the owner of the car about them and explain how to solve them.  If we are talking only about unpaid fines, then we can pay them for it.  If everything is in order, then our colleague, the inspector, with the help of a mobile application developed by us, which we call the ‚ÄúInspector application‚Äù, enters into the database all the information about the car.  This is done according to a certain algorithm: he chooses the make, model, year of production, takes photos of the body, the passenger compartment, indicates damage, a complete set, and so on.  The inspection algorithm is the same for all cars. <br><br>  When the inspector finishes the inspection, he clicks the ‚ÄúOK‚Äù button in the application, and all the information goes online to our online platform. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/cc9/e05/80b/cc9e0580b319416bb790017197b597c8.png" alt="image"></div><br>  The main features of the application: <br><br><ul><li>  A universal script is loaded from the server, which affects the sequence of actions of the car inspector. </li><li>  When viewed, the application can work completely offline, because our employees work in very different conditions, sometimes on the client‚Äôs territory. </li><li>  Check restrictions on registration and other actions through the traffic police, FSSP, Autocode, etc. </li><li>  Integrated system for intelligent compression and multi-stream transfer of photos and videos to cloud storage. </li><li>  Own computer diagnostics through OBD-2 scanner. </li><li>  Work with mobile printers. </li><li>  Electronic car damage indicator. </li></ul><br><h4>  Technical Reference </h4><br><blockquote>  The application architecture is built on the <a href="https://ru.wikipedia.org/wiki/Model-View-ViewModel">MVVM</a> pattern using RxJava, <a href="http://square.github.io/dagger/">Dagger</a> , <a href="http://square.github.io/retrofit/">Retrofit 2</a> , <a href="https://realm.io/">Realm</a> , Amazon SDK, and so on. </blockquote><br><h2>  For sale </h2><br>  When the inspector has finished his work, the data collected by him is turned into a lot at auction: aggregated and displayed in a readable form.  And dealers who may be interested in this car are notified.  By the way, the neural network is partially responsible for notifying dealers, analyzing their behavior and past purchases. <br><br>  In fact, dealers do not see the car itself.  They are available only card in the auction system, with the result of the inspection and photographs taken by our inspector.  At this time, the car is in one of our offices. <br><br>  Another explanation: when the results of the inspection get into our system, in order not to dump the dealers hundreds of items, the data is aggregated and brought to the point system - the car receives the "stars".  Only four criteria, each of which can be up to 5 stars: <br><br><ul><li>  body </li><li>  technical condition </li><li>  salon </li><li>  concomitant factors </li></ul><br>  Why did we decide to introduce "stars"?  The fact is that the checklist of the inspection application consists of more than 1000 items.  Each item has its own weight.  In addition, the list is regularly reviewed: something is added, something is removed.  Therefore, the "stars" are vital, so that dealers can quickly get an idea of ‚Äã‚Äãthe condition of the car, as well as to formulate a warranty policy for this car. <br><br>  After the card enters the auction system, the owner of the car waits 30 minutes.  He can watch all the current trades in real time on a separate TV - dashboard, sees how dealers make bets on his car, from which cities they are, how much time is left until the end of the auction.  Most watch the auction with great excitement.  If the time is almost over and a new bid has arrived, the platform extends the auction for a while more.  And such extensions can occur several times so that the owner can sell their car more profitably if there is demand for it. <br><br><img src="https://habrastorage.org/web/f88/7f5/d02/f887f5d0213b442283f340f1d1c5dbfc.png" alt="image"><br><br><h4>  Technical Reference </h4><br><blockquote>  Dashboard is a SPA on <a href="https://ru.vuejs.org/">Vue.js</a> and push notifications.  In essence, this is a page that receives partial information about all bids and in a compact form displays data from current auctions for the branch in which the client is located. </blockquote><br>  The main part of the platform is written in PHP, but we did some of the most critical components for speed and load on Golang: accepting bids, robots bargaining for a dealer, and so on.  The system of sending notifications - one of the very important components for us - is implemented on <a href="https://github.com/stevegraham/slanger">Slanger</a> .  This is an open source protocol-based notification system from Pusher with an intermediate repository in Redis. <br><br>  From the auction platform, data is sent to the logistic, statistical and marketing systems (used, among other things, for A / B testing).  For the sales department created a separate interface on the guns to monitor the progress of auctions. <br><br><img src="https://habrastorage.org/web/6d1/185/841/6d11858416ce41d2af99d918fd4c7c4d.jpg" alt="image"><br><h2>  Dealers and auction </h2><br>  Dealers can enter the auction either through a browser or through a mobile application.  Many of them do not sit in the office, but constantly go to meetings, watch cars, so the application is more relevant for them.  If a company is large, then, on the contrary, it often allocates an individual employee who sits and deliberately buys cars on CarPrice that meet certain criteria voiced by him. <br><br><img src="https://habrastorage.org/web/4d2/1b5/88d/4d21b588d530485bba026146f1d3b344.png" alt="image"><br><br>  Choosing a car of interest to the car, the dealer can look through the photos, see the equipment, assess the damage: <br><br><img src="https://habrastorage.org/web/253/9be/f79/2539bef79e2b40e79796a2483ac5bd52.png" alt="image"><br><br>  A card made on the React + Redux bundle displays a timer showing how much is left until the end of trading on this lot, and you can make a bet.  If you participated in online auctions, for example, on eBay, then you can well imagine how in the last seconds the struggle between dealers for ‚Äútasty‚Äù cars has flared up. <br><br>  By the way, we implemented a service ‚Äúauto deliveries‚Äù for dealers on Go.  In fact, these are robots that can say: ‚ÄúBargain for this car up to such a sum,‚Äù and go watch other lots.  As soon as your bid is outbid, the bot will automatically place a higher bid. <br><br>  The dealer need not just win the auction, he needs to offer <b>a price for which the owner agrees to sell his car</b> .  After all, if one of the dealers wins the auction with the highest bid, but it does not suit the owner, he may simply refuse and leave.  By the way, for the owner of the car the whole procedure for evaluating the car and its auctioning is completely free, regardless of its final decision. <br><br>  But the dealer is also in an advantageous position: he has not paid anything yet, but at the same time he receives the goods with our technical expertise, with high-quality photos, no need to go somewhere and communicate with someone.  By the way, now we are implementing an algorithm that automatically determines the level of photo quality, which the inspector made when inspecting accepted cars, to inform him of the need to revise it if the picture turned out to be ‚Äúnot very‚Äù. <br><br><img src="https://habrastorage.org/web/e0e/f4e/13d/e0ef4e13d2eb4331b3bab5d3ef44c8bf.png" alt="image"><img src="https://habrastorage.org/web/788/3cc/788/7883cc78865f490db50dda05e0aa1681.png" alt="image"><br><br>  Main features of the dealer application: <br><br><ul><li>  Opportunity anywhere to bid. </li><li>  The list of expected auctions, allows you to plan the time of dealers. </li><li>  Internal and push notifications for new auctions. </li><li>  Integrated payment of participation. </li><li>  Displays all the damage that was indicated during the inspection of the car on an interactive map. </li></ul><br><h2>  Warehouses and logistics </h2><br>  Suppose someone from a dealer in a hot fight won, won the bid, and the proposed amount suited the car owner.  In this case, we immediately give him the full amount, draw up the documents, and happy, now the former owner is leaving to celebrate the deal. <br><br>  The car is temporarily with us - we have already paid for it and now we want to give it to the winner.  For example, at the moment we own more than 1000 cars.  Naturally, such a geographically distributed fleet with a constant ‚Äúturnover‚Äù requires strict accounting.  We did not find a suitable third-party solution and wrote our own warehouse system with which all branches work.  It also allows you to track all the cars moved between the branches, plan the freight of car carriers and so on. <br><br><img src="https://habrastorage.org/web/04b/fc6/957/04bfc69571ba48dcae9cd1080fed713d.png" alt="image"><br><br><h4>  Technical Reference </h4><br><blockquote>  This is a private service on Laravel / MySQL / Vue with a bunch of external integrations. </blockquote><br><img src="https://habrastorage.org/web/6d1/185/841/6d11858416ce41d2af99d918fd4c7c4d.jpg" alt="image"><br><br><h2>  QA </h2><br>  So, the dealer won the auction for some lot, and the car arrived at the warehouse of the respective city.  Here he passes the inspection procedure - QA, you all know the quality assurance.  Only in this case it is not about checking a new feature in the product, but about re-assessing the condition of the car.  Was the assessment sufficiently accurate at acceptance?  Are there any missed defects? <br><br>  QA employees also have their mobile app with a checklist, in which the results of the first acceptance inspection are uploaded.  Since the machines are not inspected in greenhouse conditions with Wi-Fi connection, but in warehouses, parking lots, and often ‚Äúfar from civilization‚Äù, we adapted the application to work in conditions of a low level of communication.  It is in cities with a million people good coverage of LTE or 4G, and even then not in all.  And in smaller cities, and even on the outskirts, and Edge may be rare.  Before the inspection, the employee loads in the office data on the cars that will be inspected - and this is up to 500 MB of data and photos for each car, and goes to the fields.  There he makes corrections to the information, and when a connection appears, an automatic synchronization with the platform is performed. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/277/34f/ead/27734fead8f7474e82245e71a7bb74ee.png" alt="image"></div><br>  The main features of QA applications: <br><br><ul><li>  Planning the day of the warehouse staff. </li><li>  The current list of dealers who want to pick up their cars. </li><li>  Current list of cars in stock. </li><li>  Inspection of the car on the previously loaded inspection report with the dealer. </li><li>  Fixing unreported damage. </li><li>  Running internal business processes. </li></ul><br><h4>  Technical Reference </h4><br><blockquote>  The application is made on MVP with Retrofit 2, EventBus, Realm, Amazon SDK, JobQuery and so on. </blockquote><br><h2>  Car delivery to dealers </h2><br>  Each dealer has a personal account with an online booking system.  In it you can sign up separately for inspection and for the issuance of cars. <br><br>  Why separately?  Dealers are businessmen.  Before you pay, they want to first see the product, make sure that it matches the description from the lot card.  After all, cars are not cheap thing, the risks are quite high.  The dealer examines the car with our employee, and the results of the inspection are recorded in the application QA.  If the dealer has no complaints, then the document management system bills him for payment.  After that, he pays it and can sign up for the issue in order to pick up his purchase. <br><br>  This concludes our main business chain. <br><br><img src="https://habrastorage.org/web/524/f4c/8d6/524f4c8d68eb45c3b8b526d24c76cbf6.png" alt="image"><br><br><h4>  Technical Reference </h4><br><blockquote>  The document management system is a separate module for 1C: Bitrix.  It generates packages of documents for each transaction, taking into account all sorts of conditions. </blockquote><br><h2>  Long auction </h2><br>  It so happens that a car arrived at the auction, which for some reason didn‚Äôt attract the attention of dealers for half an hour or the amount offered for it was too low, and we understand that the owner will not agree to it.  But at the same time, we know that there are those in our customer base who may be interested in the car, or who are ready to offer more for it, they just could not participate now.  In this case, we call our "internal dealer", we ask him to take risks and buy the car, offering the owner a larger amount than dealers.  After the paperwork, we put the car on the so-called long auction, which does not have a limit of 30 minutes.  By the way, many dealers prefer just such lots, because there is no need to rush, you can safely evaluate the car, come to the parking lot, look, think. <br><br>  How do we know how much to offer the owner?  Why do we think that the car will be bought back from us?  Our specialists are responsible for this, focusing on an analytical system that reviews the history of trading in similar vehicles, analyzes demand and the customer base and, based on many criteria, selects dealers who have not yet seen this lot, but may be interested in it.  Today there are about 30,000 dealers in our customer base, and not all of them use smartphones and computers: there are quite a few who still walk with push-button telephones.  Call them regularly, telling about interesting lots - there will not be enough call centers.  Nevertheless, these are successful businessmen who can regularly send digests with potentially interesting lots from a long auction. <br><br>  We also implemented an automatic recommendation system.  The neural network analyzes all lots, and not just those for which there are no bids or too little offered.  This allows you to target the auction to those dealers who are most interested in a particular car. <br><br><img src="https://habrastorage.org/web/526/60e/529/52660e52928e44e8aafc8913e0d73991.png" alt="image"><br><br><h4>  Technical Reference </h4><br><blockquote>  The neural network was first modeled in MATLAB, and then ported to Tensorflow, there are places on the <a href="http://www.numpy.org/">NumPy</a> .  All this works as a separate microservice that collects information about specific lots and selects from the database of dealers those who may be interested in these lots.  She analyzes the dealers' past behavior: who, when and what lots watched, for which cars was being traded, won or didn‚Äôt win, how many cars are bought, whether any bills are waiting for payment. </blockquote><br>  Based on many hundreds of criteria describing a car, a neural network identifies those cars that may be of interest to a particular dealer.  Moreover, based on the history of dealers' behavior, a neuronet can highlight preferences that the dealer has not formulated for itself.  For example, she may guess that the dealer is not interested in cars that have more than two owners of the TCP or salon is not made of leather.  And another dealer often looks at the right-hand drive Japanese cars, he needs to show them first. <br><br>  Summing up the above, long-term auctions help to offer the car owner a fair price, and then find a dealer who is willing to pay a decent amount for it. <br><br><h2>  Why all this dealers? </h2><br>  Perhaps you have long had a question, why should dealers buy used cars, competing with each other at an auction and raising the price?  Everything is very simple: we only carry out a technical assessment of cars, but do not carry out any technical work.  All these dealers do later: repair, replace, clean, paint, riht.  In general, they increase the value of a car and prepare it for it to acquire a new owner, and then sell it at a premium.  Thus, with our help, they save on the selection and purchase stage. <br><br><h2>  Other developments </h2><br>  Already released personal online account for car owners on React / Redux.  When a person decides to sell the car and registers with CarPrice, useful information appears in his personal account about what documents to prepare, how to check for unpaid fines, how best to prepare the car for sale, how to get to the nearest CarPrice office and much more. <br><br><img src="https://habrastorage.org/web/e3e/68f/e94/e3e68fe94a9c4e0ebff9f21cd3d24a32.png" alt="image"><br><br>  The results of all systems are aggregated into the BI system for subsequent in-depth analytics.  As the company grows, analytics begins to play an increasingly important role in a variety of business processes and decision making, so now we have a whole department dedicated to analyzing our own data. <br><br><h2>  Technology </h2><br>  The stack of core technologies used in CarPrice looks like this: <br><br><img src="https://habrastorage.org/web/ec4/bcf/494/ec4bcf494e124149acb0fa9edff8847b.jpg" alt="image"><br><br>  In addition to the above-mentioned applications and systems, we have created quite a few other IT products, and also integrated third-party solutions that help us develop faster: <a href="https://github.com/cantino/huginn">Huginn</a> , <a href="https://zapier.com/">Zapier</a> , <a href="https://exponea.com/">Exponea</a> . <br><br>  All data exchange between services and systems is performed directly through internal APIs protected by jwt-tokens.  All key services run on RabbitMQ queues. <br><br>  The load on the services is regulated by nginx-balancers, and, of course, all key systems are protected by an anti-DDoS-umbrella. <br><br>  We have a lot of interesting things, and we plan on quietly telling about the used solutions.  It will be cool if you mark in the comments what you should tell first of all. <br><br>  Thank! </div><p>Source: <a href="https://habr.com/ru/post/329424/">https://habr.com/ru/post/329424/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../329414/index.html">Google I / O 2017: Android developer notes</a></li>
<li><a href="../329416/index.html">Cloud Load Balancing</a></li>
<li><a href="../329418/index.html">Testing with –°odeception for dummies: 3 types of tests</a></li>
<li><a href="../329420/index.html">Proctoring in online exams: how does it work?</a></li>
<li><a href="../329422/index.html">Group chat as a daily chase</a></li>
<li><a href="../329426/index.html">So, the law on messengers: let's be surprised together ...</a></li>
<li><a href="../329428/index.html">Debugging subtleties or How to (not) kill half a day with debug</a></li>
<li><a href="../329430/index.html">Business: how to understand that it‚Äôs time to tie it up</a></li>
<li><a href="../329432/index.html">We make previews of WebRTC video stream in PNG images</a></li>
<li><a href="../329434/index.html">Wannacry - X-team, at the exit</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>