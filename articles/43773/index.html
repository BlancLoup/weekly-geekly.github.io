<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>New features in C # 4.0. Part 1: dynamic</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One of the most interesting features of the C # 4.0 language that was introduced at the PDC is the new keyword - dynamic. It allows the developer to d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>New features in C # 4.0. Part 1: dynamic</h1><div class="post__text post__text-html js-mediator-article">  One of the most interesting features of the C # 4.0 language that was introduced at the PDC is the new keyword - dynamic.  It allows the developer to declare an object, the binding to methods of which will be carried out at the stage of execution, not compilation.  It is noteworthy that the class that instantiates this object is declared in the standard way. <a name="habracut"></a><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> TestClass { <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestMethod1() { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"test method 1"</font> ); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestMethod2() { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"test method 2"</font> ); } }</font> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <ol><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">public</font> <font color="#0000ff">class</font> TestClass { <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestMethod1() { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"test method 1"</font> ); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestMethod2() { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"test method 2"</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">public</font> <font color="#0000ff">class</font> TestClass { <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestMethod1() { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"test method 1"</font> ); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestMethod2() { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"test method 2"</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">public</font> <font color="#0000ff">class</font> TestClass { <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestMethod1() { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"test method 1"</font> ); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestMethod2() { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"test method 2"</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">public</font> <font color="#0000ff">class</font> TestClass { <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestMethod1() { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"test method 1"</font> ); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestMethod2() { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"test method 2"</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">public</font> <font color="#0000ff">class</font> TestClass { <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestMethod1() { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"test method 1"</font> ); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestMethod2() { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"test method 2"</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">public</font> <font color="#0000ff">class</font> TestClass { <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestMethod1() { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"test method 1"</font> ); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestMethod2() { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"test method 2"</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">public</font> <font color="#0000ff">class</font> TestClass { <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestMethod1() { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"test method 1"</font> ); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestMethod2() { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"test method 2"</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">public</font> <font color="#0000ff">class</font> TestClass { <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestMethod1() { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"test method 1"</font> ); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestMethod2() { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"test method 2"</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">public</font> <font color="#0000ff">class</font> TestClass { <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestMethod1() { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"test method 1"</font> ); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestMethod2() { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"test method 2"</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">public</font> <font color="#0000ff">class</font> TestClass { <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestMethod1() { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"test method 1"</font> ); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestMethod2() { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"test method 2"</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">public</font> <font color="#0000ff">class</font> TestClass { <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestMethod1() { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"test method 1"</font> ); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestMethod2() { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"test method 2"</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> </ol> <code><font color="gray"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> TestClass { <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestMethod1() { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"test method 1"</font> ); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestMethod2() { <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"test method 2"</font> ); } }</font> * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote>  Now we can call its methods as usual: <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">var</font> test = <font color="#0000ff">new</font> TestClass (); </li><li>  test.TestMethod1 (); </li><li>  test.TestMethod2 (); </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote>  As we expected, everything compiled perfectly.  Now use the new <em>dynamic</em> keyword <em>:</em> <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  dynamic test = <font color="#0000ff">new</font> TestClass (); </li><li>  test.TestMethod1 (); </li><li>  test.TestMethod2 (); </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote>  Nothing changed?  By no means.  Everything is compiled the same way as before, but now the method calls will be bound at run time, not compilation.  Ie, if we write this: <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  dynamic test = <font color="#0000ff">new</font> TestClass (); </li><li>  test.TestMethod1 (); </li><li>  test.TestMethod2 (); </li><li>  test.TestMethod3 (); </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote>  The code will compile anyway, but after launch we will get this exception: <img src="http://www.codethinked.com/image.axd?picture=WindowsLiveWriter/C4.0NewFeaturesPart1dynamickeyword_8736/image_3.png"><br>  What happened here?  Here is what Reflector prompted us: <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> Main ( <font color="#0000ff">string</font> [] args) </li><li>  { </li><li>  <font color="#0000ff">object</font> test = <font color="#0000ff">new</font> TestClass (); </li><li>  <font color="#0000ff">if</font> (&lt;Main&gt; o__SiteContainer0. &lt;&gt; p__Site1 == <font color="#0000ff">null</font> ) </li><li>  { </li><li>  &lt;Main&gt; o__SiteContainer0. &lt;&gt; P__Site1 = CallSite &lt;Action &lt;CallSite, <font color="#0000ff">object</font> &gt;&gt;. Create ( <font color="#0000ff">new</font> CSharpCallPayload (Microsoft.CSharp.RuntimeBinder.RuntimeBinder.GetInstance (), <font color="#0000ff">false</font> , <font color="#0000ff">false</font> , <font color="#A31515">"TestMethod1"</font> , <font color="#0000ff">typeof</font> ( <font color="#0000ff">object</font> ), <font color="#0000ff">null</font> )) </li><li>  } </li><li>  &lt;Main&gt; o__SiteContainer0. &lt;&gt; P__Site1.Target (&lt;Main&gt; o__SiteContainer0. &lt;&gt; P__Site1, test); </li><li>  <font color="#0000ff">if</font> (&lt;Main&gt; o__SiteContainer0. &lt;&gt; p__Site2 == <font color="#0000ff">null</font> ) </li><li>  { </li><li>  &lt;Main&gt; o__SiteContainer0. &lt;&gt; P__Site2 = CallSite &lt;Action &lt;CallSite, <font color="#0000ff">object</font> &gt;&gt;. Create ( <font color="#0000ff">new</font> CSharpCallPayload (Microsoft.CSharp.RuntimeBinder.RuntimeBinder.GetInstance (), <font color="#0000ff">false</font> , <font color="#0000ff">false</font> , <font color="#A31515">"TestMethod2"</font> , <font color="#0000ff">typeof</font> ( <font color="#0000ff">object</font> ), <font color="#0000ff">null</font> )) </li><li>  } </li><li>  &lt;Main&gt; o__SiteContainer0. &lt;&gt; P__Site2.Target (&lt;Main&gt; o__SiteContainer0. &lt;&gt; P__Site2, test); </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote>  First, the compiler generated the <em>o__SiteContainer0</em> field to store information about the place of the call.  If you look at the <em>test</em> variable that contains our object, you will see that its type has become the type <em>object</em> .  So, in reality, this is not a dynamic type, but only an assistant from the compiler. <em>Next</em> comes the check of call sites ( <em>callsite)</em> to <em>null</em> and if they are equal to it, then <em>CallSite.Create is</em> used, to which the <em>CSharpCallPayload</em> object is <em>sent</em> , which contains all the information about the method we call.  As soon as the place of the call is specified, it is simply called on our <em>test</em> variable.  As you can see, the compiler did everything for us. <br><br>  In this example, what we do seems damn useless, but the power of this feature is manifested when we use a type whose methods we do not know at the compilation stage.  This can come from dynamic languages ‚Äã‚Äã(for example IronRuby), if it is a generated class, or anything else for which we use Reflection. <br><br>  <em>Remark: I made a decision to exclude the part about performance testing from translation, as in the article <a href="http://www.codethinked.com/post/2008/10/28/C-40-New-Features-Part-11-dynamic-keyword-second-look.aspx">C # 4.0 New Features Part 1.1 - dynamic keyword second look the</a> author conducted a new testing and it showed noticeably better results.</em> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <strong>Translation of article</strong> <a href="http://www.codethinked.com/post/2008/10/28/C-40-New-Features-Part-1-dynamic-keyword.aspx"><strong>C # 4.0 New Features Part 1 - dynamic keyword</strong></a> <br><br>  <strong>Crosspost from my</strong> <a href="http://netartdev.blogspot.com/"><strong>blog</strong></a> <br><br></div><p>Source: <a href="https://habr.com/ru/post/43773/">https://habr.com/ru/post/43773/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../43761/index.html">Anti-patterns Test Driven Development</a></li>
<li><a href="../43763/index.html">Vimeo.com has entered extended accounts</a></li>
<li><a href="../43764/index.html">Russian Internet Week (RIW): Transcript of the round table ‚ÄúRecommender Systems - New Runet Trend: Problems and Benefits‚Äù</a></li>
<li><a href="../43771/index.html">Internet Conference in Eastern and Central Europe. Presentations.</a></li>
<li><a href="../43772/index.html">Protection against automatic registrations</a></li>
<li><a href="../43776/index.html">The second global distribution of FPP-prizes</a></li>
<li><a href="../43778/index.html">IP aliasing - FreeBSD</a></li>
<li><a href="../43779/index.html">NarComStat: from home accounting to general statistics</a></li>
<li><a href="../43780/index.html">Real popularity or training alert?</a></li>
<li><a href="../43782/index.html">We expand Habr</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>