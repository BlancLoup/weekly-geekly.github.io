<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SIP <-> Telegram: sip.tg</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I'm sure many people wondered: here is Telegram, a year ago he got calls, he has an open API, but for some reason, so far no one has made a bundle wit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SIP <-> Telegram: sip.tg</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/tc/6j/si/tc6jsiam9awjksbpbgcitmdxii4.png" align="left" width="150" height="150">  I'm sure many people wondered: here is Telegram, a year ago he got calls, he has an open API, but for some reason, so far no one has made a bundle with the SIP protocol.  After all, it gives unlimited possibilities: from replacing SIP-dialers to organizing another channel of communication with users of your business.  Today I will tell the story of the appearance of the first such gateway, which is now accessible to absolutely everyone! <br><a name="habracut"></a><br>  Once upon a time I got to the resource Talk37 (now it is <a href="http://ruvoip.net/">ruVoIP.net</a> ) and I really liked it.  Despite the fact that lately he has gained notoriety due to the efforts of darknet lovers, the active community of the project is still people who support him with a soul.  I separately thank its creator Dmitry Serov for his responsiveness and hard work. <br><br>  ruVoIP.net is a free virtual PBX, and almost any commercial PBX would envy its functionality.  Each user registered in it receives at registration his own internal number, which can be reached in <a href="https://ruvoip.net/voip/">many ways</a> .  And so, on September 24, 2017, the first prototype of the gateway <a href="https://ruvoip.net/blog/2017/09/tg/">saw the light</a> : now it became possible to reach ruVoIP.net users via Telegrams!  Or rather ... what does it mean possible?  We created a separate user Telegram, who learned how to receive calls and greet callers with a request to enter an internal number.  But where to enter?  How to enter?  In general, something earned and caused all active participants great joy akin to launching a rocket into space.  It doesn‚Äôt matter that it fell often, there was no DTMF, and the sound was like an old HF receiver. <br><br>  As time went on, the gateway improved, and ruVoIP.net came out in the TOP of search engines for the ‚Äúsip telegram‚Äù request.  I started to receive requests from different people who want to make <i>the same gateway</i> ;  were including commercial offers.  Unfortunately, the prototype architecture did not allow its expansion and was too complicated for use by end users, so I had to refuse everyone with promises to do something.  I really wanted to otrelizit something for the new year, but I was not able to do it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      By February 12, 2018, the new version of the gateway finally reached the level when it was already possible to touch it - closed beta testing began.  I do this project for the first time for the first time, so not everything worked out in an orderly manner, but it did me good: in the end, I managed to fix about a couple of dozen other bugs in those cases that I hadn‚Äôt even thought about. <br><br><h1>  What happened </h1><br>  I can not say that I managed to fix absolutely all the bugs.  In the process of work, I actively communicated with those who wanted to make <i>the same gateway</i> and I had a picture of what users need.  On the other hand, each function very much depends on the capabilities of the Telegram itself.  Not everything could be done conveniently (and something could not be done at all) due to platform limitations. <br><br>  The result was two main modes: <b>Operators</b> and <b>Gateways</b> .  The settings of both modes are made via the <a href="http://t.me/siptg_bot">@siptg_bot</a> bot. <br><br><h2>  Operators </h2><br>  This is the SIP Softphone replacement mode with the Telegram messenger.  If you already have an account with some SIP provider, but you do not want to install (on the phone) the next Softphone, which takes up memory, consumes the battery, requires fine-tuning of codecs and poorly adjusts to the quality of the data channel, then this mode is for You.  It is allowed to create up to 20 independent connections to SIP-providers from one Telegram account (artificial restriction, maybe later will be corrected).  Calls for each provider work in both directions: both incoming and outgoing calls are possible.  Editing an account looks like this: <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/co/54/4r/co544r09xikcsjgkugwokwl9kgi.png" width="50%" height="50%"></div><br><br>  The buttons contain either the current value of the option or its name if the value is not set (the exception is the <b>Password</b> ).  On each settings page there is a help, which is invoked by clicking the <b>Help</b> button. <br><br><h3>  How to receive calls? </h3><br>  Since the bots in Telegram do not know how to call, the service has a separate account <a href="http://t.me/siptg">@siptg</a> , which performs this function.  With an incoming call, the number and name of the caller are taken from the SIP-headers and come in a separate message;  along with the message also comes the DTMF keyboard: <br><img src="https://habrastorage.org/webt/w5/sg/tr/w5sgtrlqlwspa4cinli8kkvxwag.png" width="40%" height="40%"><img src="https://habrastorage.org/webt/nf/i7/7v/nfi77voh-vxuvldf1kdo7t2d-d0.png" width="40%" height="40%"><br><br>  <i>Note: I understand that the current implementation looks strange and inconvenient, but this is a necessary measure: Telegram's API does not allow determining the name of the subscriber using the local address book;</i>  <i>for the same reason, it is not possible to place the information about the caller‚Äôs number on the call screen.</i> <br><br><h3>  How to call? </h3><br>  Here we are again confronted with the restrictions Telegrams: you can not dial an arbitrary phone number, you can only call another user.  Therefore, there are two ways to call any number: <br><ul><li>  send a phone number as a message; </li><li>  attach the contact containing the phone number to the message. </li></ul><br>  For convenience, both methods can be applied both to the bot (@siptg_bot) and to the account for calls (@siptg).  If several operator accounts are configured, you will be asked to select the operator for the call: <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3w/l4/hb/3wl4hbyq9dhstmhsuxnmzuxt5zo.png" width="50%" height="50%"></div><br>  Next comes the incoming call to Telegram and, after lifting the handset, the connection with the dialed number begins. <br><br>  <i>Note: for each operator, you can specify the transformation rules of the dialed number and limit its use for the numbers corresponding to the regular expression.</i>  <i>If the dialed number does not correspond to the regular expression of the restriction, the operator is excluded from the request to select the operator for the call.</i>  <i>In the case of non-alternative choice, the request does not appear.</i>  <i>More information is available at the time of editing the <b>Dialing Rules</b> .</i> <br><br><h2>  Gateways </h2><br>  The most interesting mode of operation is the <b>Gateways</b> mode.  This mode allows you to use Telegram account via SIP: receive calls and make calls from your Telegram account to other users.  For example, you can create a special Telegram account for your business, communicate it to your customers as a contact and receive calls, integrating them into a common virtual PBX queue.  And since calls are possible in both directions, your operators will also have the opportunity to call the customer back if necessary;  while the client sees the call on behalf of your company. <br><br><h3>  What is a separate Telegram session for? </h3><br>  Messenger Telegram allows the use of one account from different devices, and a separate session is created on each device.  Since when using sip.tg in gateway mode, integration with SIP is performed on behalf of your account, you need to create a new Telegram session.  Creating a session is available through the settings of the bot: in the <b>Gateways</b> section, click the <b>Login</b> button and follow the instructions. <br><br>  <i>Note.</i>  <i>The Telegram API does not allow you to get limited access to your account, in connection with which, by creating a new session, you give your consent to transfer full rights over your account to Telegram to the sip.tg service.</i>  <i>The administration of the service makes every effort to limit the use of your account to Telegrams by third parties, does not transfer information about your session to Telegrams to third parties and does not use your account to Telegrams for purposes other than those stated, but is not responsible for any damage that may occur as a result theft of this information by third parties by hacking or physical access to the service equipment.</i> <br><br><h3>  How to connect Telegrams to a virtual PBX? </h3><br>  After creating the session, you can configure your Telegram account to connect to a virtual PBX.  To do this, create a new SIP connection in the <b>Gateway</b> Settings section of the bot: <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/9u/j5/wd/9uj5wdudnoonpv-w-qwnuz4c1pq.png" width="50%" height="50%"></div><br>  There are two ways to connect: incoming ( <b>New In</b> button: you configure a virtual PBX to connect to sip.tg servers) and outgoing ( <b>New</b> outgoing button: sip.tg servers connect to a virtual PBX).  You can create several inbound and outbound connections and use them independently on different devices (in this case, the total number of connections should not exceed 20).  <b>DTMF</b> flags <b>in.</b>  and <b>DTMF ref.</b>  Allows you to control the display of the extension dialing keypad and the display of the caller's number during an incoming call. <br><br><h3>  How to make and receive calls? </h3><br>  Regardless of the chosen method of connecting to a virtual PBX, incoming and outgoing calls are made in the same way: when an incoming call to a virtual PBX is sent, the <i>number</i> and name of the calling user Telegrams are sent, and for an outgoing call, it is enough to dial <i>the</i> user <i>number</i> Telegrams.  You can use one of the following values ‚Äã‚Äãas a Telegram user <i>number</i> : <br><ul><li>  the real <b>phone number of the</b> user associated with his account; </li><li>  <b>username</b> ; </li><li>  <b>*</b> User <b>ID</b> . </li></ul><br>  Here I also note the following features: <br><ol><li>  For an incoming call, if only a part of the data is known about the user, the number of the available values ‚Äã‚Äãis specified as the number: phone number, username or ID.  That is, if the user's phone number is not known, but the user has specified username, then the username will be returned as the number.  If the user does not know the phone number or set the username, then the ID number will be specified as * ID. </li><li>  You can call a user by his ID only if you have previously had direct or indirect interaction with him: messaging, previous calls, etc. </li></ol><br><br><h1>  Something else </h1><br>  The account for calls <a href="http://t.me/siptg">@siptg is</a> registered to a real phone number.  Why not use it for something else?  The first thing that comes to mind is to organize an access gateway to Telegrams from the PSTN.  Yes, I already thought about it, but for now I didn‚Äôt do it.  And did the following. <br><br>  Sometimes when leaving for roaming, you need to stay in touch.  Since receiving calls to a Russian SIM card is very expensive, I thought it would be nice to receive incoming calls in Telegram!  All that is required is to set up call forwarding on the Russian number and buy a local SIM card for Internet access. <br><br>  To forward incoming calls to Telegrams, you need to make a USSD request <code>**21*+79581006789# <img src="https://habrastorage.org/webt/kx/do/fi/kxdofiqk6jwl1cnucvvpinsa6yw.png"></code> <code>**21*+79581006789# <img src="https://habrastorage.org/webt/kx/do/fi/kxdofiqk6jwl1cnucvvpinsa6yw.png"></code>  before the trip.  After the trip, run the command <code>##21# <img src="https://habrastorage.org/webt/kx/do/fi/kxdofiqk6jwl1cnucvvpinsa6yw.png"></code> <code>##21# <img src="https://habrastorage.org/webt/kx/do/fi/kxdofiqk6jwl1cnucvvpinsa6yw.png"></code>  to disable forwarding. <br><br>  <i>Notes:</i> <i><br></i> <ol><li>  <i>The cost of the call forwarding service is paid according to your tariff plan as a call to the mobile number of the city of Moscow.</i> </li><li>  <i>The telephone number to which the Telegram account is registered must match the telephone number on which the redirection is set.</i> </li><li>  <i>The correct operation of this function depends on your service provider.</i>  <i>In particular, work with non-Russian telecom operators is not guaranteed.</i> </li></ol><br><br><h1>  What will happen next? </h1><br>  Speaking frankly, the uncertainty regarding Telegrams in Russia both was and remains.  In addition, the fate of the project entirely depends on the Telegram team.  I do not know what will be the reaction of the team, because, having a bad experience of contacting technical support earlier, I did not contact again.  If approved, it will be possible to significantly improve the current implementation and I see absolute benefits for everyone from this: the project opens up new opportunities for Telegrams as platforms, which, ultimately, should attract a new audience. <br><br>  I also have a clear understanding of what needs to be done next, I know well the bottlenecks that need to be addressed.  I also understand that as a result of habraeffect, everything can break, because I didn‚Äôt pick out large capacities at the start, but I hope that the inherent possibility of scaling will reduce the recovery time.  However, if everything is really bad - come back in 2-3 days :). <br><br>  I have no specific plans for the commercialization of the project, at first all the functionality will be completely free.  However, if you expect a large load on your operator or gateway, please inform us in advance by contacting technical support: it is already possible to transfer your accounts to a separate server.  If there is a request for specific functionality - also contact: together we will think about how this can be solved most optimally. <br><br>  In conclusion I will leave links to all project resources: <br><ul><li> <a href="http://t.me/siptg"><img src="https://habrastorage.org/webt/54/cr/cj/54crcjxxlgwsbd-ltjlh9hpwi-a.png"></a>  <a href="http://t.me/siptg">siptg</a> - account for calls; </li><li> <a href="http://t.me/siptg_bot"><img src="https://habrastorage.org/webt/iw/r7/va/iwr7va3eiltfb88f0ingm6ashk0.png"></a>  <a href="http://t.me/siptg_bot">siptg_bot</a> - bot to configure; </li><li> <a href="http://t.me/siptg_news"><img src="https://habrastorage.org/webt/ij/cv/xs/ijcvxsljmtcltwbz2sz7dmibpta.png"></a>  <a href="http://t.me/siptg_news">siptg_news</a> - news channel; </li><li> <a href="http://t.me/siptg_public"><img src="https://habrastorage.org/webt/py/il/1s/pyil1sh3ep35tnyoulvugmt5z3k.png"></a>  <a href="http://t.me/siptg_public">siptg_public</a> - open user group sip.tg; </li><li> <a href="http://t.me/siptg_support"><img src="https://habrastorage.org/webt/7v/bu/xt/7vbuxtik7s1ezi9edbswtlqlrdm.png"></a>  <a href="http://t.me/siptg_support">siptg_support</a> technical support. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/350754/">https://habr.com/ru/post/350754/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../350744/index.html">SSO and Kibana: Kibana integration with integrated Windows authentication (Single Sign-On)</a></li>
<li><a href="../350746/index.html">Swift vs. Kotlin. Differences are important</a></li>
<li><a href="../350748/index.html">How not to become a Python-developer</a></li>
<li><a href="../350750/index.html">How to write a one-page application (SPA) using Vue.js</a></li>
<li><a href="../350752/index.html">FastTrack Training. "Network Basics". "The structure of routers, routing platforms from Cisco." Eddie Martin December 2012</a></li>
<li><a href="../350756/index.html">AI.Hack - a series of hackathons in Moscow and St. Petersburg</a></li>
<li><a href="../350758/index.html">For a beginner webmaster: make a one-page on Bootstrap 4 for half an hour</a></li>
<li><a href="../350760/index.html">Protection of ASP.NET applications from hacking</a></li>
<li><a href="../350762/index.html">Introducing "npm ci" for faster and more reliable builds.</a></li>
<li><a href="../350764/index.html">Expanding the capabilities of CleanTalk Anti-Spam</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>