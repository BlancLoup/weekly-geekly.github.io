<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A library that helps bridge the conceptual gap between OOP and DB during testing using ORM - LinqTestable</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As you know, there is a conceptual gap between the object-oriented and relational model, which even ORM cannot overcome. Basically, this gap affects t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A library that helps bridge the conceptual gap between OOP and DB during testing using ORM - LinqTestable</h1><div class="post__text post__text-html js-mediator-article">  As you know, there is a <a href="https://en.wikipedia.org/wiki/Object-relational_impedance_mismatch">conceptual gap</a> between the object-oriented and relational model, which even ORM cannot overcome.  Basically, this gap affects the fact that when using a relational database, we are forced to work on sets, rather than on specific objects.  But there is another factor: the behavior of NULL in a database is different from the behavior of NULL in object-oriented languages.  This can be a problem when you use the same query in two situations: 1) when requesting a database; 2) during unit testing, when an in-memory array is used instead of a database table.  Moreover, this can be a problem if you only apply to the database, but think about NULL in terms of OOP, not a relational database! <br><br><img src="https://habrastorage.org/files/38f/2b5/9c8/38f2b59c83844667813c00d4f2397825.jpg" alt="image"><br><a name="habracut"></a><br><h5>  Example 1 </h5><br>  There are three tables related by foreign key: car, door, door handle.  All foreign keys are not nullable, i.e.  at each door and at the handle it has to be specified on what exactly they fasten (the specific car or a door). <br><br><div class="spoiler">  <b class="spoiler_title">The source code for creating tables</b> <div class="spoiler_text">  (Oracle was used as DB, ORM - EntityFramework, language - C #.) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> CAR ( CAR_ID <span class="hljs-built_in"><span class="hljs-built_in">NUMBER</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> CAR <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constraint</span></span> CAR_PK primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span> (CAR_ID); <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> DOOR ( DOOR_ID <span class="hljs-built_in"><span class="hljs-built_in">NUMBER</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>, CAR_ID <span class="hljs-built_in"><span class="hljs-built_in">NUMBER</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> DOOR <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constraint</span></span> DOOR_PK primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span> (DOOR_ID); <span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> DOOR <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constraint</span></span> DOOR_CAR_FK <span class="hljs-keyword"><span class="hljs-keyword">foreign</span></span> <span class="hljs-keyword"><span class="hljs-keyword">key</span></span> (CAR_ID) <span class="hljs-keyword"><span class="hljs-keyword">references</span></span> CAR (CAR_ID); <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> DOOR_CAR_ID_I <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> DOOR (CAR_ID) <span class="hljs-keyword"><span class="hljs-keyword">tablespace</span></span> INDX_S; <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> DOOR_HANDLE ( DOOR_HANDLE_ID <span class="hljs-built_in"><span class="hljs-built_in">NUMBER</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>, DOOR_ID <span class="hljs-built_in"><span class="hljs-built_in">NUMBER</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>, COLOR <span class="hljs-keyword"><span class="hljs-keyword">NVARCHAR2</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>) <span class="hljs-literal"><span class="hljs-literal">null</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> DOOR_HANDLE <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constraint</span></span> DOOR_HANDLE_PK primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span> (DOOR_HANDLE_ID); <span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> DOOR_HANDLE <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constraint</span></span> DOOR_HANDLE_DOOR_FK <span class="hljs-keyword"><span class="hljs-keyword">foreign</span></span> <span class="hljs-keyword"><span class="hljs-keyword">key</span></span> (DOOR_ID) <span class="hljs-keyword"><span class="hljs-keyword">references</span></span> DOOR (DOOR_ID); <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> DOOR_HANDLE_DOOR_ID_I <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> DOOR_HANDLE (DOOR_ID) <span class="hljs-keyword"><span class="hljs-keyword">tablespace</span></span> INDX_S;</code> </pre> <br></div></div><br><br>  Create one machine in the database, the rest of the tables remain empty.  Then just make the left join between the machine and the doors using the ORM: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cars = (<span class="hljs-keyword"><span class="hljs-keyword">from</span></span> car <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> dataModel.CAR <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> door <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> dataModel.DOOR <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> car.CAR_ID <span class="hljs-keyword"><span class="hljs-keyword">equals</span></span> door.CAR_ID <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> joinedDoor <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> door <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> joinedDoor.DefaultIfEmpty() <span class="hljs-comment"><span class="hljs-comment">//left join select new { car.CAR_ID, door.DOOR_ID }).ToList();</span></span></code> </pre><br><br>  What do you think will return this request? <br><br>  That's right, ORM will throw an exception in you and send it to the forest.  Why?  Bd will return the string <br>  CAR_ID = 1, DOOR_ID = NULL, and ORM cannot process it, because both in the database and in the mapping it is indicated that door.DOOR_ID cannot be NULL.  NULL also appeared solely because of the left join.  Maybe the ‚Äúcurve‚Äù of the ORM is to blame?  No, the ORM behavior is quite correct: to replace null with 0 or return an empty string means to deceive the user.  Changing the mapping is also not an option: the code will say that the field can not be filled, and the business logic will require the opposite.  The solution is to change the request so that ORM can understand that the field can be null: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cars = (<span class="hljs-keyword"><span class="hljs-keyword">from</span></span> car <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> dataModel.CAR <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> door <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> dataModel.DOOR <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> car.CAR_ID <span class="hljs-keyword"><span class="hljs-keyword">equals</span></span> door.CAR_ID <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> joinedDoor <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> door <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> joinedDoor.DefaultIfEmpty() <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { car.CAR_ID, DOOR_ID = door != <span class="hljs-literal"><span class="hljs-literal">null</span></span> ? door.DOOR_ID : (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>?) <span class="hljs-literal"><span class="hljs-literal">null</span></span> }).ToList();</code> </pre><br>  You can change the request manually, or you can write code that will change all such requests automatically in runtime (but more on that later). <br><br><h5>  Example 2 </h5><br>  There is a request with two left join. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> carsWithoutRedHandle = (<span class="hljs-keyword"><span class="hljs-keyword">from</span></span> car <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> dataModel.CAR <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> door <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> dataModel.DOOR <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> car.CAR_ID <span class="hljs-keyword"><span class="hljs-keyword">equals</span></span> door.CAR_ID <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> joinedDoor <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> door <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> joinedDoor.DefaultIfEmpty() <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> doorHandle <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> dataModel.DOOR_HANDLE <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> door.DOOR_ID <span class="hljs-keyword"><span class="hljs-keyword">equals</span></span> doorHandle.DOOR_ID <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> joinedDoorHandle <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> doorHandle <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> joinedDoorHandle.DefaultIfEmpty() <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> doorHandle.Color != ‚ÄúRED‚Äù || doorHandle == <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> car).ToList();</code> </pre><br><br>  This request will be perfectly processed when you access the database.  But it is worth using it in the unit test, and you will get a NullReferenceException when you try to access the door.DOOR_ID in the second join if any of the machines do not need the doors because of the open top.  Well, it's time to change the query: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> carsWithoutRedHandle = (<span class="hljs-keyword"><span class="hljs-keyword">from</span></span> car <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> dataModel.CAR <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> door <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> dataModel.DOOR <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> car.CAR_ID <span class="hljs-keyword"><span class="hljs-keyword">equals</span></span> door.CAR_ID <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> joinedDoor <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> door <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> joinedDoor.DefaultIfEmpty() <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> doorHandle <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> dataModel.<span class="hljs-function"><span class="hljs-function">DOOR_HANDLE </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">door != </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ? door.DOOR_ID : (</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">?</span></span></span><span class="hljs-function">)</span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-literal">null</span></span></span><span class="hljs-function">) </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">equals</span></span></span><span class="hljs-function"> doorHandle.DOOR_ID </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">into</span></span></span><span class="hljs-function"> joinedDoorHandle </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">from</span></span></span><span class="hljs-function"> doorHandle </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">in</span></span></span><span class="hljs-function"> joinedDoorHandle.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DefaultIfEmpty</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">where</span></span></span><span class="hljs-function"> doorHandle.Color !</span></span>= ‚ÄúRED‚Äù || doorHandle == <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> car).ToList();</code> </pre><br><br>  However, there is one "but."  By changing the linq query, you can get a sql query with a much slower execution plan.  Let's look at such a case with an example. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq.Expressions; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> LinqKit; <span class="hljs-function"><span class="hljs-function">IEnumerable&lt;CAR&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCars</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IDataModel dataModel, Expression&lt;Func&lt;DOOR, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;&gt; doorSpecification = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Expression&lt;Func&lt;DOOR_HANDLE, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;&gt; doorHandleSpecification = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (doorSpecification == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) doorSpecification = door =&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (doorHandleSpecification == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) doorHandleSpecification = handle =&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cars = (<span class="hljs-keyword"><span class="hljs-keyword">from</span></span> car <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> dataModel.CAR.AsExpandable() <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> door <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> dataModel.DOOR <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> car.CAR_ID <span class="hljs-keyword"><span class="hljs-keyword">equals</span></span> door.CAR_ID <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> joinedDoor <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> door <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> joinedDoor.DefaultIfEmpty() <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> doorHandle <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> dataModel.DOOR_HANDLE <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-comment"><span class="hljs-comment">/*(door != null ? door.DOOR_ID : (int?)null)*/</span></span>door.DOOR_ID <span class="hljs-keyword"><span class="hljs-keyword">equals</span></span> doorHandle.DOOR_ID <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> joinedDoorHandle <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> doorHandle <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> joinedDoorHandle.DefaultIfEmpty() <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> doorSpecification.Invoke(door) &amp;&amp; doorHandleSpecification.Invoke(doorHandle) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> car); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cars; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> carsWithRedHandle = GetCars(dataModel, doorHandleSpecification: doorHandle =&gt; doorHandle.COLOR == <span class="hljs-string"><span class="hljs-string">"RED"</span></span>).ToList();</code> </pre><br>  Here is the sql query and its execution plan, when the join happens like this: door.DOOR_ID equals doorHandle.DOOR_ID <br><br><img src="https://habrastorage.org/files/d1f/d64/31c/d1fd6431c277402abc3898b3578cf764.png" alt="image"><br><br>  And here is the execution plan when (door! = Null? Door.DOOR_ID: (int?) Null) equals doorHandle.DOOR_ID <br><br><img src="https://habrastorage.org/files/068/d64/4af/068d644afe174d059a0021ed77052c98.png" alt="image"><br><br>  As you can see, the execution plan is completely different, and its Cost is one and a half times larger. <br>  To solve this problem, you can use #if DEBUG and run tests in debug, but, believe me, the readability and reliability of the code will not increase at all from this.  It is much better to deal with a problem in the bud - to make it so that when writing unit tests you don‚Äôt have to worry about this feature of left join.  To this end, I have written a library laid out on <a href="https://github.com/FiresShadow/LinqTestable">https://github.com/FiresShadow/LinqTestable</a> . <br>  In order to use the library, you need to download and connect the project, and change the MockObjectSet in your project, namely, to replace this piece: <br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> System.Linq.Expressions.Expression Expression { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _collection.AsQueryable&lt;T&gt;().Expression; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IQueryProvider Provider { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _collection.AsQueryable&lt;T&gt;().Provider; } }</code> </pre><br>  on: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> System.Linq.Expressions.Expression Expression { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _collection.AsQueryable&lt;T&gt;().ToTestable().Expression; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IQueryProvider Provider { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _collection.AsQueryable&lt;T&gt;().ToTestable().Provider; } }</code> </pre><br>  After that, the above problem in unit tests will disappear by itself. <br><br>  By the way, read how to write unit tests for the Entity Framework <a href="http://www.codeproject.com/Articles/447988/How-to-Mock-Test-an-Entity-Framework-Model-First-P">here</a> . <br><br>  The library is a bit damp and solves only one problem: NullReferenceException with two left join.  Solving this problem alone does not eliminate the conceptual gap, there are many other problems, for example: comparing null with null for equality gives different results in relational and object-oriented models.  But this problem is also solved. </div><p>Source: <a href="https://habr.com/ru/post/269917/">https://habr.com/ru/post/269917/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../269903/index.html">Create a REST service on Rust. Part 5: Handlers, Refactoring, and Macros</a></li>
<li><a href="../269905/index.html">How we lost and again found millions without testing A / B</a></li>
<li><a href="../269907/index.html">Unpacked types of unions in Scala based on the Curry-Howard isomorphism</a></li>
<li><a href="../269909/index.html">Errors are values</a></li>
<li><a href="../269915/index.html">Divide means multiply</a></li>
<li><a href="../269919/index.html">The digest of interesting materials for the mobile developer # 127 (October 26 - November 1)</a></li>
<li><a href="../269923/index.html">Immersion cooling reaches new heights: 250 kW per bitFury rack</a></li>
<li><a href="../269925/index.html">Altera + OpenCL: we open the core</a></li>
<li><a href="../269927/index.html">What we have learned by developing the backend</a></li>
<li><a href="../269931/index.html">How to draw curves graphics in the style of XKCD</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>