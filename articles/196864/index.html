<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Work with the touch screen on Arduino DUE</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the previous article ‚ÄúWorking with a TFT display on the ARDUINO DUE‚Äù we discussed in detail the commands of the UTFT base library for working with ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Work with the touch screen on Arduino DUE</h1><div class="post__text post__text-html js-mediator-article">  In the previous article <a href="http://habrahabr.ru/post/196600/">‚ÄúWorking with a TFT display on the ARDUINO DUE‚Äù</a> we discussed in detail the commands of the UTFT base library for working with TFT displays on the Arduino.  In this article, we will look at <b>Utouch</b> , an add-on to the base library that allows you to work with a touch screen. <br><div style="text-align:center;"><img src="https://habrastorage.org/storage3/08b/78d/471/08b78d47181015073615d407d03dd768.jpg"></div><br><a name="habracut"></a><h4>  1. General information </h4><br>  This add-on was developed by the same author as the base library.  You can download the latest version here: <br>  <a href="http://www.henningkarlsen.com/electronics/library.php%3Fid%3D55">http://www.henningkarlsen.com/electronics/library.php?id=55</a> <br>  This addition is not independent and requires the connection of the base library UTFT. <br><br>  So, let's take a closer look at the Utouch add-on, which is designed to work with a touch screen that most TFT displays are equipped with. <br><br><h4>  2. Getting started with the touch screen </h4><br>  To work with the Utouch add-on, you need to load it into your program and perform initialization.  Naturally, the UTFT base library should be loaded and initialized.  We remind you that for our display, which was discussed in the previous article, initialization is as follows: <br> <code>#include &lt;UTFT.h&gt;</code> <br> <code>UTFT myGLCD(CTE32HR,25,26,27,28);</code> <br> <br>  Now we load the add-on and create an object - a touch screen called myTouch.  As parameters, the pin numbers to which the TCLK, TCS, TDIN, TDOUT and IRQ signals are connected are transmitted to the initialization team.  These parameters should be obtained from the manufacturer of the display or nameplate, through which the display is connected to the controller. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In our model of the touch screen, the above-mentioned signals are connected, respectively, to pins 6, 5, 4, 3 and 2. We remind you that the nameplate with which the display is connected can be found here: <br>  <a href="">http://coldtears.lin3.siteonlinetest.com/files/CTE_DUE_shield.zip</a> <br>  and the diagram of the display module itself is here: <br>  <a href="">http://coldtears.lin3.siteonlinetest.com/files/3.2b.zip</a> <br><br>  So for our display we have to insert the following lines into the program: <br> <code>#include &lt;UTouch.h&gt;</code> <br> <code>UTouch myTouch(6,5,4,3,2);</code> <br> <br>  Next, you need to initialize the display and touch screen in the void setup () procedure: <br> <code>void setup() {</code> <br> <code>myGLCD.InitLCD();</code> <br> <code>myTouch.InitTouch();</code> <br> <code>}</code> <br> <br>  The InitTouch command, as well as the InitLCD command of the base library, sets the vertical or horizontal orientation of the display.  The default orientation is horizontal.  Everything, now it is possible to work with our touch screen.  Consider a very simple example, with the help of which we will be able to make sure that the touch screen is working.  Compile the following program and load it into the memory of the controller: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;UTFT.h&gt; UTFT myGLCD(CTE32HR,25,26,27,28); #include &lt;UTouch.h&gt; UTouch myTouch(6,5,4,3,2); void setup() { myGLCD.InitLCD(); myTouch.InitTouch(); myGLCD.clrScr(); myGLCD.fillScr(255,0,0); } void loop() { if (myTouch.dataAvailable()) { myGLCD.fillScr(0,255,0); }else {myGLCD.fillScr(255,0,0);} }</span></span></span></span></code> </pre><br>  When the program starts, the display is painted in red.  Now touch the screen at any point - and the display will turn green. <br><br><h4>  3. Touch Screen Calibration </h4><br>  Before continuing to work, you must perform another important procedure - the calibration of the touch screen.  In the examples of programs that come with the Utouch add-on there is one very important example called <b>UTouch_Calibration</b> . <br>  To perform the calibration, you need to open this example through the menu: <br>  "File-&gt; Examples-&gt; UTouch-&gt; Arduino-&gt; UTouch_Calibration". <br><br>  ATTENTION!  Before compiling, do not forget to replace the UTFT myGLCD (....) and UTouch myTouch (...) lines with those needed for our display. <br><br>  Also, when calibrating, you must correctly select the <b>TOUCH_ORIENTATION</b> parameter.  Information on the value of this parameter for the display model in use can be found in the UTouch_Supported_display_modules.pdf file that comes with the Utouch library and is located in its root folder.  For our display, for example, the value of PORTRAIT should be set, despite the fact that the display itself is oriented horizontally. <br><br>  ATTENTION!  This value should be set only when calibrating the touch screen; in the future, the orientation of the screen should coincide with the orientation of the display module. <br><br>  When you start the program displays an explanatory text and waits for a touch on the touch screen.  Then the display shows 8 cross marks along the edges of the display and a red window with the word PRESS in the center.  The developers' instruction informs that it is necessary to touch the highlighted cross and keep the touch until the backlight on it goes out, and the message ‚ÄúRELEASE‚Äù appears on the red field in the center.  This simple operation must be repeated for all the crosses in turn. <br>  By the way, the developers advise you to perform this operation with a stylus or a pointed wand, without using your fingers, this will improve the calibration accuracy.  At the end of the calibration, three numbers will be displayed in hexadecimal format.  For example, these are: <br><br> <code>CAL_X 0xBD95ECC8UL</code> <br> <code>CAL_Y 0x5EBC8000UL</code> <br> <code>CAL_S 0x0013F1DFUL</code> <br> <br>  These three values ‚Äã‚Äãmust be placed in the file UTouch_CD.h, located in the root folder of the UTouch add-on, instead of the values ‚Äã‚ÄãCAL_X, CAL_Y and CAL_S that were specified there initially.  After that, the display will work correctly. <br><br>  Now let's take a closer look at the UTouch add-on commands: <br><br>  <b>UTouch - creates the base class of the touch screen with the specified name, specifies the connection method as a parameter.</b> <br><br>  The command is as follows: <br> <code>Utouch _NAME_ (TCLK, TCS, TDIN, TDOUT, IRQ);</code> <br> <br>  where _NAME_ is an arbitrary name of the ‚Äútouch screen‚Äù object that will be used as a prefix for any access to it, and TCLK, TCS, TDIN, TDOUT and IRQ are pin numbers with which the corresponding touch display signals are connected. <br><br>  The string with this command is placed in the definition area and must precede any other UTouch commands.  The specified object name should be used as a prefix to all subsequent UTouch commands. <br><br>  <b>InitTouch - initializes the touch screen and sets the horizontal or vertical orientation.</b>  <b>The orientation identifier is specified as a parameter.</b> <br><br>  If in this command you specify PORTRAIT or 0, the vertical orientation will be selected, if you specify LANDSCAPE or 1 is horizontal.  Please note that the orientation of the touch screen must match the orientation of the display.  By default (without parameters) the command sets the horizontal orientation. <br><br>  <b>setPrecision - sets the accuracy of determining the coordinates of the point of touch on the touch screen.</b>  <b>The precision identifier is passed as a parameter.</b> <br><br>  A total of four levels of accuracy are defined, coded by numbers from 1 to 4: <br><br>  PREC_LOW - low accuracy; <br>  PREC_MEDIUM - medium accuracy; <br>  PREC_HI - high accuracy; <br>  PREC_EXTREME - very high accuracy. <br><br>  Naturally, the level of accuracy is inversely proportional to the time spent on determining the coordinates.  The optimal level for most tasks is PREC_MEDIUM.  Developers do not recommend using high and very high accuracy for operations that require quick response. <br><br>  The difference between the accuracy levels can be illustrated by an example of UTouch_QuickDraw, supplied with the UTouch library.  This program allows you to draw on the display using the touch screen: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;UTFT.h&gt; UTFT myGLCD(CTE32HR,25,26,27,28); #include &lt;UTouch.h&gt; UTouch myTouch(6,5,4,3,2); void setup() { myGLCD.InitLCD(); myGLCD.clrScr(); myTouch.InitTouch(PORTRAIT); myTouch.setPrecision(PREC_MEDIUM); } void loop() { long x, y; while (myTouch.dataAvailable() == true) { myTouch.read(); x = myTouch.getX(); y = myTouch.getY(); if ((x!=-1) and (y!=-1)) { myGLCD.drawPixel (x, y); } } }</span></span></span></span></code> </pre><br>  Try compiling this example with different parameter values ‚Äã‚Äãfor the setPrecision command and you will immediately notice the difference. <br><br>  <b>dataAvailable is a function that returns a logical value of true, if at the time of its call the touch of the touch screen is fixed.</b>  <b>The rest of the time, it returns false.</b> <br><br>  This function can be used to determine the moment of contact, and its duration.  In our first example, which we gave in section 2, the construction: <br> <code>if (myTouch.dataAvailable()) {</code> <br> <code>myGLCD.fillScr(0,255,0);</code> <br> <code>}else {myGLCD.fillScr(255,0,0);}</code> <br> <br>  contained a call to the function DataAvailable, which triggered a change in the color of the display, which remained for the entire duration of the touch.  Consider another example ‚Äî measuring touch time in milliseconds: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;UTFT.h&gt; UTFT myGLCD(CTE32HR,25,26,27,28); extern uint8_t BigFont[]; #include &lt;UTouch.h&gt; UTouch myTouch(6,5,4,3,2); void setup() { myGLCD.InitLCD(); myGLCD.setFont(BigFont); myTouch.InitTouch(); myGLCD.clrScr(); } void loop() { unsigned long timeOld; unsigned long timeNew; if (myTouch.dataAvailable() == true){ timeOld=millis(); while (myTouch.dataAvailable() == true) { timeNew=millis(); } myGLCD.clrScr(); myGLCD.printNumI(timeNew-timeOld, 100, 100); } }</span></span></span></span></code> </pre><br>  when you touch the touch screen, the program saves the current value of the millis function in the timeOld variable.  Further, as long as the touch is saved, the program constantly updates the current millis value in the timeNew variable.  As soon as the touch has stopped - the display shows the difference between these two variables, which will be equal to the touch time in milliseconds. <br><br>  So, now we are able to work with the ‚Äútouch screen‚Äù event, we can determine the moment of touch, its duration and the moment of release.  It remains quite a bit - to get the coordinates of the touch point.  The following commands are for this purpose: <br><br>  <b>read - starts the procedure for determining the coordinates of the touch point.</b> <br><br>  This command does not pass any parameters and returns no value.  It should be run when the dataAvailable function is true.  The coordinates obtained in ‚Äúraw‚Äù form are stored in the internal variables TP_X and TP_Y.  However, these data are not given to the size of the display and its resolution, so special functions getX and getY are used to obtain the coordinates of the touch point. <br><br>  <b>getX - returns the X-coordinate value of the touch point in pixels relative to the left edge of the display.</b> <br><br>  <b>getY - returns the Y-coordinate value of the touch point in pixels relative to the top edge of the display.</b> <br><br>  Provided the calibration is performed correctly and the touch screen is of sufficient accuracy, the coordinates of the touch point must coincide with the coordinates of the particular pixel.  The return type for these two functions is int. <br><br>  The following example when touching the touch screen displays the coordinates of the touch point in pixels and in the "raw" format: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;UTFT.h&gt; UTFT myGLCD(CTE32HR,25,26,27,28); extern uint8_t BigFont[]; #include &lt;UTouch.h&gt; UTouch myTouch(6,5,4,3,2); void setup() { myGLCD.InitLCD(); myGLCD.setFont(BigFont); myTouch.InitTouch(); myGLCD.clrScr(); } void loop() { int X_RAW; int Y_RAW; int X; int Y; if (myTouch.dataAvailable() == true){ myTouch.read(); X_RAW=myTouch.TP_X; Y_RAW=myTouch.TP_Y; X=myTouch.getX(); Y=myTouch.getY(); myGLCD.clrScr(); myGLCD.print("X", 100,80); myGLCD.print("Y", 200,80); myGLCD.print("PIX", 20,100); myGLCD.print("RAW", 20,120); myGLCD.printNumI(X, 100, 100); myGLCD.printNumI(Y, 200, 100); myGLCD.printNumI(X_RAW, 100, 120); myGLCD.printNumI(Y_RAW, 200, 120); } }</span></span></span></span></code> </pre><br>  Now, in order to process, for example, pressing the on-screen button, it is enough to make sure that the obtained coordinates of the touch point are inside the area occupied by the given button.  Here is another example: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;UTFT.h&gt; UTFT myGLCD(CTE32HR,25,26,27,28); extern uint8_t BigFont[]; #include &lt;UTouch.h&gt; UTouch myTouch(6,5,4,3,2); void setup() { myGLCD.InitLCD(); myGLCD.setFont(BigFont); myTouch.InitTouch(); myGLCD.clrScr(); } void loop() { int X; int Y; myGLCD.drawRect(100,100,150,150); if (myTouch.dataAvailable() == true){ myTouch.read(); X=myTouch.getX(); Y=myTouch.getY(); if (X&gt;100 &amp;&amp; X&lt;150 &amp;&amp; Y&gt;100 &amp;&amp; Y&lt;150) { myGLCD.print("PRESSED", 100,200); }else{myGLCD.print(" ",100,200);} } }</span></span></span></span></code> </pre> <br>  The program draws a rectangle button on the display.  When you touch the touch screen in the area of ‚Äã‚Äãthe button, the inscription ‚ÄúPRESSED‚Äù is displayed, when you touch the outside of the rectangle, the inscription goes out. <br><br>  Another interesting example.  This program draws a rectangular ‚Äúwindow‚Äù on the display and allows you to resize it by dragging the lower right corner.  Of course, this is not a full Drag &amp; Drop but very similar: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;UTFT.h&gt; UTFT myGLCD(CTE32HR,25,26,27,28); extern uint8_t BigFont[]; #include &lt;UTouch.h&gt; UTouch myTouch(6,5,4,3,2); int X=100; int Y=100; void setup() { myGLCD.InitLCD(); myGLCD.setFont(BigFont); myTouch.InitTouch(); myTouch.setPrecision(PREC_EXTREME); myGLCD.clrScr(); myGLCD.drawRect(0,0,X,Y); } void loop() { if (myTouch.dataAvailable() == true){ myGLCD.setColor(0,0,0); myGLCD.drawRect(0,0,X,Y); myTouch.read(); X=myTouch.getX(); Y=myTouch.getY(); myGLCD.setColor(255,255,255); myGLCD.drawRect(0,0,X,Y); } }</span></span></span></span></code> </pre> <br><h4>  4. Conclusion </h4><br>  So, now we are able to use the touch screen, we can determine the moment of touch and determine the coordinates of the touch point, work with simple controls displayed on the display.  In the next article, we plan to consider another addition to the UTFT library - UTFT_Buttons, which allows you to organize work with text and graphic screen buttons. </div><p>Source: <a href="https://habr.com/ru/post/196864/">https://habr.com/ru/post/196864/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../196852/index.html">Author Blackhole exploit kit arrested</a></li>
<li><a href="../196854/index.html">Misha ... no, Sergei ... no, Polina! Node-Polina!</a></li>
<li><a href="../196856/index.html">What is VPS and what it eats with - virtual server infographics</a></li>
<li><a href="../196860/index.html">Upsource: JetBrains New Platform</a></li>
<li><a href="../196862/index.html">Procedural generator of Khrushchev</a></li>
<li><a href="../196866/index.html">Google introduced the 11-inch chromebook from HP</a></li>
<li><a href="../196868/index.html">Click and Grow. Half a year - normal flight</a></li>
<li><a href="../196870/index.html">Algorithms in bioinformatics, online course</a></li>
<li><a href="../196872/index.html">HTML5 frequency noise generator</a></li>
<li><a href="../196874/index.html">New HP Chromebook 11 is available on Google Play</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>