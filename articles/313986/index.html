<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to fill a bunch of cones and release the game</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It all started back in 2013. Then there were a lot of toys on Android, but less so than now. And by releasing your game on the then-Android Market, yo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to fill a bunch of cones and release the game</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/a6f/968/4c9/a6f9684c96f84480b5e6d588c93ba5d3.png" align="left">  It all started back in 2013.  Then there were a lot of toys on Android, but less so than now.  And by releasing your game on the then-Android Market, you could get some kind of money.  And since I like to make games, there was no doubt - we are releasing the game.  We are a small team of programmer, artist, and tester / idea generator.  Looking ahead - we have collected enough cones and rakes.  Basically there will be a review of technical issues, so the article will be useful to anyone who is in any way connected with the development of games.  Do not repeat our mistakes. <br><a name="habracut"></a><br><h2>  Idea of ‚Äã‚Äãthe game </h2><br>  Of the games existing at that time, we liked the game where the ball rolls through the maze, dodging holes, and trying to get to the final pocket.  At that time there were already a few such games, but in terms of graphics they were not very good.  Therefore, we decided to make our own, with an emphasis on color.  I would like to mention the artist, he painted very, very cool.  Thanks to him, the game turned out like it is - beautiful. <br><br>  As an engine, it was decided to use libGDX.  I knew him well at that time, and I liked him, there were already completed projects on it.  I was sure that we would reach a victorious end.  As it turned out - reached. <br><br><h2>  Gameplay Features </h2><br>  In principle, the gameplay turned out to be standard for games of this type - we roll the ball with the help of an accelerometer.  An additional feature is that we have teleports, and the walls can be more than just boring rectangles.  But more about that further. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Of the features I want to mention the management.  We have long picked up the accelerometer settings for a comfortable game, but our tester constantly noted that something was wrong.  As a sample, he brought a similar game with the Android Market.  In the end, I downloaded this game, decompiled it (I was also surprised that it was not obfuscated), and looked at the moment with the controls.  I found that the code is identical to mine, only the coefficients differ.  I note that the decompiled game was also written in libGDX - that is, at that time, mass games were already written on it. <br><br><img src="https://habrastorage.org/files/312/4c8/ae0/3124c8ae0835429e8aa73fa01a311622.jpg"><br>  <i>We can customize the management</i> <br><br><h2>  Technical part </h2><br>  As I mentioned, the game is written in libGDX.  The game uses many resources - graphics, sounds, maps, fonts.  Let's go through each moment. <br><br>  <b>Graphics.</b>  The game has several hundred sprites.  For performance purposes, all the sprites were packed into textural atlases.  A separate atlas for the menu screen, a separate one for selecting levels, etc.  Standard technology that saves both video memory and performance draws.  Atlases were packed with the Texture Packer program (available for download on the libGDX website).  If I did it now - I would use the built-in class TexturePacker.  Packaging of the atlas looks like this - TexturePacker.pack (‚Äúfolder-with-sprite‚Äù, ‚Äúoutput-folder‚Äù, ‚Äúatlas-name‚Äù).  The advantage of this approach is that you do not need to switch from IDE to another program to repack atlases. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/6c9/84f/ca7/6c984fca7eb74797a2df2f3c5d634687.png"></div><br>  <i>This is what a reduced atlas with different balls looks like.</i>  <i>This is a small part, we have several such atlases.</i> <br><br>  Atlas format - 32 bits, png.  Some pictures, that without transparency, are packed in jpeg atlases.  If I did now - atlases without transparency, I would pack in ETC1.  LibGDX has native support for this format, and for Android, this is an economy of video memory. <br><br>  To control the graphics (loading / unloading atlases, getting the desired image), a self-made class Images was written.  I knew about the built-in AssetManager, but at that time I needed a more convenient solution.  For example, if I want to get some kind of background image, I want the previous requested background to be automatically unloaded.  My decision allowed me to do such things. <br><br>  Moving a little to the side - when I write a game, I often do my resource managers.  Often based on standard AssetManager.  The goal is easier access to resources.  In later stages of development, code readability plays a very important role.  A well written code, like a book.  It is easier to understand the line <b>images.createButton (‚Äúgreen-button‚Äù)</b> than <b>assetManager.get (TextureAtlas.class, ‚Äúdata / atlases / buttons‚Äù). FindRegion (‚Äúgreen-button‚Äù).</b>  From the minuses of this approach - when you return to the game after a long time, you need to remember the features of these managers.  Of the benefits - when you remember, to continue to edit something is already simple. <br><br>  <b>Sounds.</b>  All sounds in the game in .ogg format.  Why not mp3?  On some phone models at that time there were problems with playing several sounds in a row in .mp3 format.  I admit that these were my crooked hands, but there were no problems with .ogg.  The benefit of libGDX supports both formats, replacing .mp3 with .ogg was easy. <br><br>  In order to optimize the sounds were shaken to the minimum bitrate, the format is mono.  Development was conducted on linux, for conversion I used Sound Converter.  In my opinion, Sound Converter is a sample of an excellent utility that I still use today.  One small window with settings for the output format, and the "Convert" button.  An excellent answer to monstrous converters. <br><br>  <b>Fonts.</b>  The game uses two types of fonts. <br><br>  The first type is .ttf fonts and the gdx-freetype library.  It allows you to generate bitmap fonts from .ttf fonts at runtime.  The advantage of the library - you can set the desired font size right at the time of launching the program.  This ensures that the font will always be exactly the size you need.  Among the shortcomings, since the font is generated ‚Äúon the fly‚Äù into the texture, this means that it will be RAM.  And the larger the font size, the more it is needed, this very memory.  Another unobvious moment is that since the font is a separate texture, when drawing any lettering, there will be an additional draw call (except for the moment when we draw several labels in a row).  On this basis, the scope of .ttf was limited only by the ‚ÄúAbout‚Äù screen. <br><br>  The second type of fonts is <a href="https://github.com/libgdx/libgdx/wiki/Distance-field-fonts">distance field</a> fonts.  The idea is simple - using the Hiero program (available for download on the official libGDX website), a special font texture is generated.  In the texture for each letter highlighted its own area.  But this area is not drawn "as is".  Instead, a special shader is used, which specifically draws this region (of course, this also breaks the batching).  The advantage is that with a relatively small texture, you can draw a font with a very large size without losing quality.  Disadvantages - the font needs to be generated in advance, and no effects are available for the font (shadow, stroke, etc.).  Also, as I mentioned, it breaks the batching.  You can only set the font color during drawing.  This was enough for our needs, so Distance Field fonts are commonly used in the game. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a6b/2a1/c36/a6b2a1c36c3f444da1f26f9faa69d517.png"></div><br>  <i>This is how the Distance Field font looks.</i>  <i>The background should be transparent, I just made it black for clarity.</i> <br><br>  <b>Cards.</b>  One of the ‚Äútricks‚Äù of a good game is the amount of content.  You can generate it automatically, or you can prepare level sets.  We went the second way - we have more than a hundred levels.  Levels are divided into boxes - in a box of 15 levels.  It is clear that with so many levels the question arises of their convenient editing and storage.  Need some kind of map editor.  The matter is complicated by the fact that we have two types of cards - simple and ‚Äúoriginal‚Äù (during the development we called them that way). <br><br>  <b>Simple maps</b> are standard mazes for this type of games with rectangular obstacles.  To edit such maps, I wrote an editor ‚Äî a simple Java program using Swing as a graphical library.  Manually you can place obstacles, holes, etc.  Obstacles can be rotated, resized as you like - in this regard, the editor turned out to be quite convenient.  The tester complained that it was inconvenient, that it was impossible to undo actions - I understood him, and wrote cancellation / repetition of actions, having studied the pattern Command. <br><br><img src="https://habrastorage.org/files/83e/afd/057/83eafd0578304ce39eeb86bd8f156e02.jpg"><br>  <i>Map editor in action</i> <br><br><img src="https://habrastorage.org/files/df0/4da/eb9/df04daeb973d4d518bd6545b4df26193.jpg"><br>  <i>Simple banal card - nothing unusual</i> <br><br>  The chip is to quickly test the cards, the editor had the ability to switch to the game.  Immediately (in the same window) a game was launched where you could check the map.  In the role of the accelerometer mouse acted.  I can say that the writing of the editor is like that phrase, ‚Äúit‚Äôs better to lose a day, then fly in five minutes‚Äù. <br><br>  <b>Original cards.</b>  So we called the pictures manually drawn by the artist, where the individual elements of the picture are obstacles.  Below is an example of such a card. <br><br><img src="https://habrastorage.org/files/e2e/c56/c59/e2ec56c595f84fd4ad326cc6c04a68f2.jpg"><br>  <i>Football field is more interesting</i> <br><br>  It is clear that the standard map editor is not suitable in this case.  I thought, and solved the problem as follows - take the editor <a href="http://www.mapeditor.org/">tiled</a> .  In it we create two layers - one background, there will be a picture of the original level.  The second layer is the markup layer.  On it, primitives (circles, squares and polygons) mark the map.  For example, a hole is a circle with the name ‚Äúhole‚Äù (tiled allows each object to assign its own name).  At the output, we get an xml file in tiled format.  But this format does not suit us.  Therefore, I wrote an additional utility that takes the generated tiled xml and converts it into my level format.  At the same stage, it turned out that box2d does not support polygons that consist of more than 4 vertices ‚Äî in other words, quadrilaterals (at least the box2d port for libGDX). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/e64/8e7/4ea/e648e74ea6d14af9849b9f692b5085e9.png"></div><br>  <i>Mark up the original map</i> <br><br>  All of this "Frankenstein", though it looked awkward, but its task performed perfectly well.  Almost half of the game levels are ‚Äúoriginal‚Äù, and thanks to tiled, we did without writing another editor.  Conclusion - sometimes you don‚Äôt need to write your own something complicated and big, just look around and take a ready-made solution with minimal doping. <br><br><h2>  Ball animation </h2><br>  When the ball moves, it must somehow animate, create the illusion of movement.  Some games of this genre do not bother with this, and use a simple static image.  We decided to be confused. <br><br>  We have several ball skins ‚Äî glass, fire (lava), football, etc.  At that time I was not aware of the 3D capabilities in libGDX, and could not use the 3D model.  Therefore, we decided to do time-lapse animation.  A full turn of the ball took about 50 frames.  Depending on the speed of movement, I changed the frame rate, creating the illusion of faster or slower rotation.  And of course I changed the turn of these frames.  I can not say what happened perfectly, the 3d model would definitely give a more beautiful picture, but that is, that is. <br><br><h2>  Physics </h2><br>  The game uses the physics engine box2d (more precisely, its port under libGDX).  Of the benefits - it is fast, and he has a lot of opportunities.  Of the minuses - you need to know it :) The ball is a dynamic body, the obstacles are static bodies.  When the level is loaded, a physical model of the world is created, and, in fact, the game begins.  When paused, the simulation stops.  In principle, this is all that can be said about physics - there were no special problems with it. <br><br><h2>  Additional chips </h2><br>  Our menu screen is not easy.  It is also made as part of the game.  The ball rolls along it, obeying the accelerometer.  And when the ball hits the buttons, it bounces off.  And if the ball touches certain buttons in a certain order, the portal will open to the secret level :) <br><br><img src="https://habrastorage.org/files/f13/2d4/028/f132d40285ca43bf8ae57a17b759abce.jpg"><br>  <i>The ball rolls around and bounces off the buttons - like in a pinball</i> <br><br>  There are many achievements - for completing levels, for a certain amount of wins, for a certain time in the game, etc.  We did not use standard Android Google Play achievements, but made our own system of achievements. <br><br><img src="https://habrastorage.org/files/3cd/2b7/029/3cd2b7029c9741349b565dbe0dbd32e0.jpg"><br>  <i>A small part of the achievements</i> <br><br><h2>  Moments that I would have done differently. </h2><br>  It is clear that there are no ideal solutions, and with experience comes an understanding that this or that part is not optimal.  I will say that I would remake, do I play now. <br><br>  <b>The first point</b> is the choice of boxes.  If you open the game and look at the boxes, you will see that there are dots on each box.  Depending on the complexity, these points are larger or smaller.  So - for the arrangement of these points, I wrote a class that loads a json file, and puts dots on this config file.  The motivation for why I did it is to save space in texture atlases.  That is, we store the general picture-background of the box, one point, and the order of arrangement of these points for a particular box.  Why it is bad - the complexity of the modification.  If each box were a separate picture, it is enough to correct the picture - and now you need to go into the config files and figure out what and how.  It would be better to keep it just pictures. <br><br><img src="https://habrastorage.org/files/c20/a52/556/c20a525563c84701a0ed986f952f6612.jpg"><br>  <i>Each box is not just a picture.</i>  <i>This is a substrate + text file-config with the location of points.</i> <br><br>  <b>The second point</b> - I was very confused with optimization (the example above is a confirmation of this).  All screens (menu, box selection, game, etc.) I created in one copy, and just switched between them.  This eliminated the creation of the same screens every time we move to a different screen, but led to the problem of cleaning.  For example, a game screen stores many parameters for a particular level (for example, points, time, etc.).  When we load a new level, you must first reset the state of the game screen.  But as new chips were added, it was easy to forget to clear something.  This is ‚Äúate‚Äù a decent piece of time, debugging such problems.  When I make a game now, I do it differently.  If you need to change the screen - I save the necessary parameters for this screen in a class of settings, then create a new screen.  That new screen is created and reads the necessary data from the settings class.  At the same time, resources are spent more, but this time is unnoticed against the background of modern powerful phones. <br><br>  The given example about the screens is only one of.  Plus, this approach - the game does not lag even on the worst phones.  The minus of the approach is, how many of them, such bad phones, to spend so much time on optimization?  For myself, I solved the problem like this - when buying a new smartphone, I deliberately chose characteristics that were slightly below average.  If the game goes without brakes on it, I don‚Äôt bother with optimization - for most people the game will start and go fine. <br><br><h2>  Conclusion </h2><br>  There are no perfect games, just like there is no perfect development.  After a while, we brought the game to the end, and it was released on Google Play.  What can I say - despite all the bumps and rakes, it is interesting to develop games.  There are a lot of moments, some moments are not solvable, and you have to look for workarounds.  But solving these problems raises your level as a developer.  It was interesting for me to write this game, and I believe that it will be interesting to play in it. </div><p>Source: <a href="https://habr.com/ru/post/313986/">https://habr.com/ru/post/313986/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../313974/index.html">PHP Digest number 95 - interesting news, materials and tools (October 9 - 30, 2016)</a></li>
<li><a href="../313978/index.html">GPU animations: doing it right</a></li>
<li><a href="../313980/index.html">Integration of the external object system in Delphi on the example of IBM SOM</a></li>
<li><a href="../313982/index.html">"Pitfalls" of a simple electronic signature</a></li>
<li><a href="../313984/index.html">RAM memory for video surveillance</a></li>
<li><a href="../313988/index.html">Interview with Pavel R√§ikkonen, Executive Director of Nevosoft</a></li>
<li><a href="../313992/index.html">Happy Halloween! Hello ada</a></li>
<li><a href="../313996/index.html">Github for windows users</a></li>
<li><a href="../313998/index.html">The problem with intermittently long-running queries in MS SQL Server</a></li>
<li><a href="../314000/index.html">High availability cluster on postgresql 9.6 + repmgr + pgbouncer + haproxy + keepalived + control via telegram</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>