<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Serialization in Java. Not so simple</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Serialization is a process that translates an object into a sequence of bytes, which can then be completely restored. Why do you need it?  The fact is...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Serialization in Java. Not so simple</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/az/3t/pd/az3tpdhy1ajhximnq7nsjbxvsdy.png"><br><br>  <strong>Serialization</strong> is a process that translates an object into a sequence of bytes, which can then be completely restored.  Why do you need it? <a name="habracut"></a>  The fact is, with the usual program execution, the maximum lifetime of any object is known - from the launch of the program to its termination.  Serialization allows you to expand this framework and "give life" to the object between the program launches as well. <br><br>  An added bonus to everything is to save cross-platform.  No matter what your operating system is, serialization translates the object into a stream of bytes, which can be restored to any OS.  If you need to transfer an object over the network, you can serialize the object, save it to a file and transfer it over the network to the recipient.  He will be able to recover the resulting object.  Also, serialization allows remote calling of methods (Java RMI), which are located on different machines with possibly different operating systems, and work with them as if they are located on the machine of the calling java-process. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Implementing the serialization mechanism is quite simple.  It is necessary for your class to implement the <strong><em>Serializable</em></strong> interface.  This interface is an identifier that has no methods, but it indicates jvm that objects of this class can be serialized.  Since the serialization mechanism is associated with the basic input / output system and translates the object into a stream of bytes, to execute it, you must create an output <em>OutputStream</em> , package it in an <em>ObjectOutputStream</em> and call the <em>writeObject ()</em> method <em>.</em>  To restore an object, you need to package the <em>InputStream</em> into an <em>ObjectInputStream</em> and call the <em>readObject ()</em> method <em>.</em> <br><br>  In the process of serialization, its object graph is preserved along with the object being serialized.  Those.  all objects associated with this, objects from other classes will also be serialized with it. <br><br>  Consider an example of serializing an object of class Person. <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.*; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Home</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String home; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Home</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String home)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.home = home; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getHome</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> home; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> countOfNiva; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String fatherName; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Home home; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Person</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> countOfNiva, String fatherName, Home home)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name = name; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.countOfNiva = countOfNiva; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fatherName = fatherName; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.home = home; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Person{"</span></span> + <span class="hljs-string"><span class="hljs-string">"name='"</span></span> + name + <span class="hljs-string"><span class="hljs-string">'\''</span></span> + <span class="hljs-string"><span class="hljs-string">", countOfNiva="</span></span> + countOfNiva + <span class="hljs-string"><span class="hljs-string">", fatherName='"</span></span> + fatherName + <span class="hljs-string"><span class="hljs-string">'\''</span></span> + <span class="hljs-string"><span class="hljs-string">", home="</span></span> + home + <span class="hljs-string"><span class="hljs-string">'}'</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException, ClassNotFoundException </span></span>{ Home home = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Home(<span class="hljs-string"><span class="hljs-string">"Vishnevaia 1"</span></span>); Person igor = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Person(<span class="hljs-string"><span class="hljs-string">"Igor"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"Raphael"</span></span>, home); Person renat = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Person(<span class="hljs-string"><span class="hljs-string">"Renat"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"Raphael"</span></span>, home); <span class="hljs-comment"><span class="hljs-comment">//      ObjectOutputStream ObjectOutputStream objectOutputStream = new ObjectOutputStream( new FileOutputStream("person.out")); objectOutputStream.writeObject(igor); objectOutputStream.writeObject(renat); objectOutputStream.close(); //       ObjectInputStream ObjectInputStream objectInputStream = new ObjectInputStream( new FileInputStream("person.out")); Person igorRestored = (Person) objectInputStream.readObject(); Person renatRestored = (Person) objectInputStream.readObject(); objectInputStream.close(); //    ByteArrayOutputStream ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream2 = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream2.writeObject(igor); objectOutputStream2.writeObject(renat); objectOutputStream2.flush(); //    ByteArrayInputStream ObjectInputStream objectInputStream2 = new ObjectInputStream( new ByteArrayInputStream(byteArrayOutputStream.toByteArray())); Person igorRestoredFromByte = (Person) objectInputStream2.readObject(); Person renatRestoredFromByte = (Person) objectInputStream2.readObject(); objectInputStream2.close(); System.out.println("Before Serialize: " + "\n" + igor + "\n" + renat); System.out.println("After Restored From Byte: " + "\n" + igorRestoredFromByte + "\n" + renatRestoredFromByte); System.out.println("After Restored: " + "\n" + igorRestored + "\n" + renatRestored); } }</span></span></code> </pre> <br>  <strong>Conclusion:</strong> <br><br><pre> <code class="java hljs">Before Serialize: Person{name=<span class="hljs-string"><span class="hljs-string">'Igor'</span></span>, countOfNiva=<span class="hljs-number"><span class="hljs-number">2</span></span>, fatherName=<span class="hljs-string"><span class="hljs-string">'Raphael'</span></span>, home=Home@<span class="hljs-number"><span class="hljs-number">355</span></span>da254} Person{name=<span class="hljs-string"><span class="hljs-string">'Renat'</span></span>, countOfNiva=<span class="hljs-number"><span class="hljs-number">2</span></span>, fatherName=<span class="hljs-string"><span class="hljs-string">'Raphael'</span></span>, home=Home@<span class="hljs-number"><span class="hljs-number">355</span></span>da254} After Restored From Byte: Person{name=<span class="hljs-string"><span class="hljs-string">'Igor'</span></span>, countOfNiva=<span class="hljs-number"><span class="hljs-number">2</span></span>, fatherName=<span class="hljs-string"><span class="hljs-string">'Raphael'</span></span>, home=Home@<span class="hljs-number"><span class="hljs-number">27973e9</span></span>b} Person{name=<span class="hljs-string"><span class="hljs-string">'Renat'</span></span>, countOfNiva=<span class="hljs-number"><span class="hljs-number">2</span></span>, fatherName=<span class="hljs-string"><span class="hljs-string">'Raphael'</span></span>, home=Home@<span class="hljs-number"><span class="hljs-number">27973e9</span></span>b} After Restored: Person{name=<span class="hljs-string"><span class="hljs-string">'Igor'</span></span>, countOfNiva=<span class="hljs-number"><span class="hljs-number">2</span></span>, fatherName=<span class="hljs-string"><span class="hljs-string">'Raphael'</span></span>, home=Home@<span class="hljs-number"><span class="hljs-number">312</span></span>b1dae} Person{name=<span class="hljs-string"><span class="hljs-string">'Renat'</span></span>, countOfNiva=<span class="hljs-number"><span class="hljs-number">2</span></span>, fatherName=<span class="hljs-string"><span class="hljs-string">'Raphael'</span></span>, home=Home@<span class="hljs-number"><span class="hljs-number">312</span></span>b1dae}</code> </pre> <br>  In this example, the <em>Home</em> class was created to demonstrate that when the <em>Person</em> object is serialized, the graph of its objects is also serialized with it.  The <em>Home</em> class must also implement the <em>Serializable</em> interface, otherwise a <em>java.io.NotSerializableException</em> will occur.  The example also describes serialization using the <em>ByteArrayOutputStream</em> class. <br><br>  An interesting conclusion can be made from the results of the program execution: <em>when restoring objects that had a reference to the same object before serialization, this object will be restored only once</em> .  This can be seen from the same links in the objects after restoration: <br><br><pre> <code class="java hljs">After Restored From Byte: Person{name=<span class="hljs-string"><span class="hljs-string">'Igor'</span></span>, countOfNiva=<span class="hljs-number"><span class="hljs-number">2</span></span>, fatherName=<span class="hljs-string"><span class="hljs-string">'Raphael'</span></span>, home=Home@<span class="hljs-number"><span class="hljs-number">27973e9</span></span>b} Person{name=<span class="hljs-string"><span class="hljs-string">'Renat'</span></span>, countOfNiva=<span class="hljs-number"><span class="hljs-number">2</span></span>, fatherName=<span class="hljs-string"><span class="hljs-string">'Raphael'</span></span>, home=Home@<span class="hljs-number"><span class="hljs-number">27973e9</span></span>b} After Restored: Person{name=<span class="hljs-string"><span class="hljs-string">'Igor'</span></span>, countOfNiva=<span class="hljs-number"><span class="hljs-number">2</span></span>, fatherName=<span class="hljs-string"><span class="hljs-string">'Raphael'</span></span>, home=Home@<span class="hljs-number"><span class="hljs-number">312</span></span>b1dae} Person{name=<span class="hljs-string"><span class="hljs-string">'Renat'</span></span>, countOfNiva=<span class="hljs-number"><span class="hljs-number">2</span></span>, fatherName=<span class="hljs-string"><span class="hljs-string">'Raphael'</span></span>, home=Home@<span class="hljs-number"><span class="hljs-number">312</span></span>b1dae}</code> </pre> <br>  However, it is also clear that when recording is performed by two output streams (we have an <em>ObjectInputStream</em> and <em>ByteArrayOutputStream</em> ), the <em>home</em> object will be recreated, despite the fact that it has already been created before in one of the streams.  We see this at different addresses of <em>home</em> objects, received in two streams.  It turns out that if you serialize one output stream, then restore the object, then we have a guarantee to restore the full network of objects without unnecessary duplicates.  Of course, during the execution of a program, the state of objects may change, but this is on the programmer‚Äôs conscience. <br><br>  <strong>Problem</strong> <br><br>  It is also seen from the example that when the object is restored, a <em>ClassNotFoundException</em> exception may occur.  What is the reason?  The fact is that we can easily serialize an object of class <em>Person</em> into a file, transfer it over the network to our friend, who can restore the object to another application, in which <em>Person</em> simply does not have an object. <br><br>  <strong>Its serialization.</strong>  <strong>How to do?</strong> <br><br>  What if you want to manage the serialization yourself?  For example, your object stores the username and password of users.  You need to serialize it for further transmission over the network.  Passing the password in this case is extremely unreliable.  How to solve this problem?  There are two ways.  First, use the <strong><em>transient</em></strong> keyword.  The second, instead of implementing the <em>Serializable</em> interest, is to use its extension, the <em><strong>Externalizable</strong></em> interface.  Consider the examples of the first and second methods for comparing them. <br><br>  <strong>The first is Serialization using transient</strong> <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.*; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logon</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String login; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">transient</span></span> String password; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Logon</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String login, String password)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.login = login; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.password = password; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Logon{"</span></span> + <span class="hljs-string"><span class="hljs-string">"login='"</span></span> + login + <span class="hljs-string"><span class="hljs-string">'\''</span></span> + <span class="hljs-string"><span class="hljs-string">", password='"</span></span> + password + <span class="hljs-string"><span class="hljs-string">'\''</span></span> + <span class="hljs-string"><span class="hljs-string">'}'</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException, ClassNotFoundException </span></span>{ Logon igor = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Logon(<span class="hljs-string"><span class="hljs-string">"IgorIvanovich"</span></span>, <span class="hljs-string"><span class="hljs-string">"Khoziain"</span></span>); Logon renat = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Logon(<span class="hljs-string"><span class="hljs-string">"Renat"</span></span>, <span class="hljs-string"><span class="hljs-string">"2500RUB"</span></span>); System.out.println(<span class="hljs-string"><span class="hljs-string">"Before: \n"</span></span> + igor); System.out.println(renat); ObjectOutputStream out = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ObjectOutputStream(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileOutputStream(<span class="hljs-string"><span class="hljs-string">"Externals.out"</span></span>)); out.writeObject(igor); out.writeObject(renat); out.close(); ObjectInputStream in = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ObjectInputStream(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(<span class="hljs-string"><span class="hljs-string">"Externals.out"</span></span>)); igor = (Logon) in.readObject(); renat = (Logon) in.readObject(); System.out.println(<span class="hljs-string"><span class="hljs-string">"After: \n"</span></span> + igor); System.out.println(renat); } }</code> </pre> <br>  <strong>Conclusion:</strong> <br><br><pre> <code class="java hljs">Before: Logon{login=<span class="hljs-string"><span class="hljs-string">'IgorIvanovich'</span></span>, password=<span class="hljs-string"><span class="hljs-string">'Khoziain'</span></span>} Logon{login=<span class="hljs-string"><span class="hljs-string">'Renat'</span></span>, password=<span class="hljs-string"><span class="hljs-string">'2500RUB'</span></span>} After: Logon{login=<span class="hljs-string"><span class="hljs-string">'IgorIvanovich'</span></span>, password=<span class="hljs-string"><span class="hljs-string">'null'</span></span>} Logon{login=<span class="hljs-string"><span class="hljs-string">'Renat'</span></span>, password=<span class="hljs-string"><span class="hljs-string">'null'</span></span>}</code> </pre> <br>  <strong>The second way - Serialization with the implementation of the Externalizable interface</strong> <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.*; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logon</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Externalizable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String login; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String password; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Logon</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Logon</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String login, String password)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.login = login; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.password = password; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">writeExternal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ObjectOutput out)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ out.writeObject(login); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Logon{"</span></span> + <span class="hljs-string"><span class="hljs-string">"login='"</span></span> + login + <span class="hljs-string"><span class="hljs-string">'\''</span></span> + <span class="hljs-string"><span class="hljs-string">", password='"</span></span> + password + <span class="hljs-string"><span class="hljs-string">'\''</span></span> + <span class="hljs-string"><span class="hljs-string">'}'</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readExternal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ObjectInput in)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException, ClassNotFoundException </span></span>{ login = (String) in.readObject(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException, ClassNotFoundException </span></span>{ Logon igor = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Logon(<span class="hljs-string"><span class="hljs-string">"IgorIvanovich"</span></span>, <span class="hljs-string"><span class="hljs-string">"Khoziain"</span></span>); Logon renat = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Logon(<span class="hljs-string"><span class="hljs-string">"Renat"</span></span>, <span class="hljs-string"><span class="hljs-string">"2500RUB"</span></span>); System.out.println(<span class="hljs-string"><span class="hljs-string">"Before: \n"</span></span> + igor); System.out.println(renat); ObjectOutputStream out = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ObjectOutputStream(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileOutputStream(<span class="hljs-string"><span class="hljs-string">"Externals.out"</span></span>)); out.writeObject(igor); out.writeObject(renat); out.close(); ObjectInputStream in = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ObjectInputStream(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(<span class="hljs-string"><span class="hljs-string">"Externals.out"</span></span>)); igor = (Logon) in.readObject(); renat = (Logon) in.readObject(); System.out.println(<span class="hljs-string"><span class="hljs-string">"After: \n"</span></span> + igor); System.out.println(renat); } }</code> </pre> <br>  <strong>Conclusion:</strong> <br><br><pre> <code class="java hljs">Before: Logon{login=<span class="hljs-string"><span class="hljs-string">'IgorIvanovich'</span></span>, password=<span class="hljs-string"><span class="hljs-string">'Khoziain'</span></span>} Logon{login=<span class="hljs-string"><span class="hljs-string">'Renat'</span></span>, password=<span class="hljs-string"><span class="hljs-string">'2500RUB'</span></span>} After: Logon{login=<span class="hljs-string"><span class="hljs-string">'IgorIvanovich'</span></span>, password=<span class="hljs-string"><span class="hljs-string">'null'</span></span>} Logon{login=<span class="hljs-string"><span class="hljs-string">'Renat'</span></span>, password=<span class="hljs-string"><span class="hljs-string">'null'</span></span>}</code> </pre> <br>  The first difference between the two options that catches your eye is the size of the code.  When implementing the <em>Externalizable</em> interface, we need to override two methods: <em><strong>writeExternal ()</strong></em> and <strong><em>readExternal ()</em></strong> .  In the <em>writeExternal ()</em> method, we specify which fields will be serialized and how, in <em>readExternal (),</em> how to read them.  When using the word <em>transient,</em> we explicitly indicate which field or fields do not need to be serialized.  Also note that in the second method, we explicitly created a default constructor, and a public one.  Why is this done?  Let's try to run the code without this constructor.  And look at the conclusion: <br><br><pre> <code class="java hljs">Before: Logon{login=<span class="hljs-string"><span class="hljs-string">'IgorIvanovich'</span></span>, password=<span class="hljs-string"><span class="hljs-string">'Khoziain'</span></span>} Logon{login=<span class="hljs-string"><span class="hljs-string">'Renat'</span></span>, password=<span class="hljs-string"><span class="hljs-string">'2500RUB'</span></span>} Exception in thread <span class="hljs-string"><span class="hljs-string">"main"</span></span> java.io.InvalidClassException: Logon; no valid constructor at java.io.ObjectStreamClass$ExceptionInfo.newInvalidClassException(ObjectStreamClass.java:<span class="hljs-number"><span class="hljs-number">169</span></span>) at java.io.ObjectStreamClass.checkDeserialize(ObjectStreamClass.java:<span class="hljs-number"><span class="hljs-number">874</span></span>) at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:<span class="hljs-number"><span class="hljs-number">2043</span></span>) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:<span class="hljs-number"><span class="hljs-number">1573</span></span>) at java.io.ObjectInputStream.readObject(ObjectInputStream.java:<span class="hljs-number"><span class="hljs-number">431</span></span>) at Logon.main(Logon.java:<span class="hljs-number"><span class="hljs-number">45</span></span>)</code> </pre> <br>  We received an exception <em>java.io.InvalidClassException</em> .  What is the reason?  If you go through the stack trace, you can find out that the constructor of the <em>ObjectStreamClass</em> class has the lines: <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (externalizable) { cons = getExternalizableConstructor(cl); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { cons = getSerializableConstructor(cl);</code> </pre> <br>  For the <em>Externalizable</em> interface, we will <em>call the getExternalizableConstructor ()</em> method for getting the constructor <em>,</em> inside which we will use <em>Reflection</em> to get the default constructor of the class for which we restore the object.  If we are unable to find him, or he is not <em>public</em> , then we get an exception.  You can bypass this situation as follows: do not explicitly create any constructor in the class and fill in the fields with setters and get the value of the getters.  Then when the class is compiled, a default constructor will be created, which will be available for <em>getExternalizableConstructor ()</em> .  For <em>Serializable,</em> the <em>getSerializableConstructor ()</em> method receives the constructor of the <em>Object</em> class and searches for the required class from it. If it does not find it, we get the <em>ClassNotFoundException</em> exception.  It turns out that the key difference between <em>Serializable</em> and <em>Externalizable</em> is that the former does not need a constructor to create an object recovery.  It simply recovers completely from bytes.  For the second, during restoration, an object will first be created using a constructor at the declaration point, and then the values ‚Äã‚Äãof its fields from the bytes received during serialization will be written to it.  Personally, I prefer the first method, it is much easier.  Moreover, even if we still need to set the serialization behavior, we can not use <em>Externalizable</em> , as well as implement <em>Serializable</em> , by adding (without redefining) the <em>writeObject ()</em> and <em>readObject ()</em> methods into it.  But in order for them to "work" you need to accurately observe their signature. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.*; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Talda</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String description; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Talda</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name, String description)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name = name; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.description = description; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">writeObject</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ObjectOutputStream stream)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ stream.defaultWriteObject(); System.out.println(<span class="hljs-string"><span class="hljs-string">"Our writeObject"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readObject</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ObjectInputStream stream)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException, ClassNotFoundException </span></span>{ stream.defaultReadObject(); System.out.println(<span class="hljs-string"><span class="hljs-string">"Our readObject"</span></span>); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Talda{"</span></span> + <span class="hljs-string"><span class="hljs-string">"name='"</span></span> + name + <span class="hljs-string"><span class="hljs-string">'\''</span></span> + <span class="hljs-string"><span class="hljs-string">", description='"</span></span> + description + <span class="hljs-string"><span class="hljs-string">'\''</span></span> + <span class="hljs-string"><span class="hljs-string">'}'</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException, ClassNotFoundException </span></span>{ Talda partizanka = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Talda(<span class="hljs-string"><span class="hljs-string">"Partizanka"</span></span>, <span class="hljs-string"><span class="hljs-string">"Viiiski"</span></span>); System.out.println(<span class="hljs-string"><span class="hljs-string">"Before: \n"</span></span> + partizanka); ObjectOutputStream out = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ObjectOutputStream(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileOutputStream(<span class="hljs-string"><span class="hljs-string">"Talda.out"</span></span>)); out.writeObject(partizanka); out.close(); ObjectInputStream in = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ObjectInputStream(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(<span class="hljs-string"><span class="hljs-string">"Talda.out"</span></span>)); partizanka = (Talda) in.readObject(); System.out.println(<span class="hljs-string"><span class="hljs-string">"After: \n"</span></span> + partizanka); } }</code> </pre> <br>  <strong>Conclusion:</strong> <br><br><pre> <code class="java hljs">Before: Talda{name=<span class="hljs-string"><span class="hljs-string">'Partizanka'</span></span>, description=<span class="hljs-string"><span class="hljs-string">'Viiiski'</span></span>} Our writeObject Our readObject After: Talda{name=<span class="hljs-string"><span class="hljs-string">'Partizanka'</span></span>, description=<span class="hljs-string"><span class="hljs-string">'Viiiski'</span></span>}</code> </pre> <br>  Inside our added methods, we call <em>defaultWriteObject ()</em> and <em>defaultReadObject ()</em> .  They are responsible for the default serialization, as if it worked without the methods we added. <br><br>  In fact, this is only the tip of the iceberg, if we continue to delve into the serialization mechanism, then with a high probability we can find some more nuances, finding which we will say: "Serialization ... not everything is so simple." </div><p>Source: <a href="https://habr.com/ru/post/431524/">https://habr.com/ru/post/431524/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../431508/index.html">Efficient Spring Transaction Management</a></li>
<li><a href="../431514/index.html">Interview for interviewers</a></li>
<li><a href="../431516/index.html">One day in the life of a Financial Advisor</a></li>
<li><a href="../431518/index.html">Microsoft Connect (); Meetup in Moscow</a></li>
<li><a href="../431520/index.html">Predict user churn using the RFM method</a></li>
<li><a href="../431526/index.html">Pernicious influence: how the Stasi defended East Germany from video games</a></li>
<li><a href="../431528/index.html">Mysterious mathematical genius and writer are promoting the solution of the permutation problem.</a></li>
<li><a href="../431530/index.html">Open lesson "Android Material Design: review of updates"</a></li>
<li><a href="../431532/index.html">Memristors consisting of 2 nm thick parts</a></li>
<li><a href="../431534/index.html">Problem personalities among developers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>