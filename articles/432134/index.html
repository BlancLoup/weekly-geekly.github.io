<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Environment generation based on sound and music in Unity3D. Part 2. Creating 2D tracks from music</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="annotation 


 Hello. Relatively recently, I wrote an article Generating an environment based on sound and music in Unity3D , in which I gave several ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Environment generation based on sound and music in Unity3D. Part 2. Creating 2D tracks from music</h1><div class="post__text post__text-html js-mediator-article"><h2 id="annotaciya">  annotation </h2><br><p>  Hello.  Relatively recently, I wrote an article <a href="https://habr.com/company/everydaytools/blog/429872/">Generating an environment based on sound and music in Unity3D</a> , in which I gave several examples of games involving the mechanics of generating content based on music, and also told about the basic aspects of similar games.  There was practically no code in the article and I promised that there would be a continuation.  And here it is, in front of you.  This time we will try to create a track for a 2D race, in the style of Hill Climb, from your music.  Let's see what we can do .. </p><br><p><img src="https://habrastorage.org/webt/wp/6y/jk/wp6yjkpyoal7a3bzsg0ugeiuyvs.png"></p><a name="habracut"></a><br><h2 id="vvedenie">  Introduction </h2><br><p>  I remind you that this series of articles is intended for novice developers and for those who have just recently started working with sound.  If you are in your mind doing a quick Fourier transform, then you will probably be bored here. </p><br><p>  Here is our Road Map for today: </p><br><ol><li>  Consider what discretization is. </li><li>  Figure out what data we can get from Audio Clip Unity </li><li>  Understand how we can work with this data. </li><li>  Find out what we can generate from this data </li><li>  Learn how to make a game out of all this (well, or something like a game) </li></ol><br><p>  So let's go! </p><br><h2 id="diskretizaciya-analogovogo-singala">  Analog Sample Discretization </h2><br><p>  As many know, to use a signal in digital systems, we need to convert it.  One of the conversion steps is the discretization of the signal, in which the analog signal is divided into parts (temporary reports), after which each report is assigned the amplitude value that was at the selected moment. <br><img src="https://habrastorage.org/webt/k-/r4/_0/k-r4_0pvvu8sxhcdxaybjnpsn0q.png"></p><br><p>  The letter T is the sampling period.  The smaller the period, the more accurate the signal conversion will be.  But most often they talk about the inverse value: the sampling rate (it is logical that this is F = 1 / T).  8 000 Hz is enough for a telephone singhal, and, for example, one of the DVD-Audio format options requires a sampling frequency of 192 000 Hz.  The standard in digital recording (in game editors, music editors) is 44 100 Hz - this is the frequency of CD Audio. </p><br><p>  The numerical amplitude values ‚Äã‚Äãare stored in the so-called samples, and it is with them that we will work.  The value of the sample is float and it can be from -1 to 1. Simplified, it looks like this. </p><br><p><img src="https://habrastorage.org/webt/sj/rg/r7/sjrgr7njjj7iwmyi6nebdtpfxze.png"></p><br><h2 id="otrisovka-zvukovoy-volny-statichno">  Sound wave rendering (static) </h2><br><h3 id="bazovaya-informaciya">  Basic information </h3><br><p>  Waveform (or audio form, and in common - "fish") - a visual representation of the audio signal in time.  The waveform can show us at what point in the sound the active phase occurs, and where the attenuation occurs.  Often the waveform is presented for each channel separately, for example, like this: </p><br><p><img src="https://habrastorage.org/webt/hj/xr/vm/hjxrvm-bdrgt-myieappnmqxgb0.png"></p><br><p>  Imagine that we already have AudioSource and the script in which we work.  Let's see what Unity can give us. </p><br><pre><code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//  AudioSource    AudioSource myAudio = gameObject.GetComponent&lt;AudioSource&gt;(); //     .     44100. int freq = myAudio.clip.frequency;</span></span></code> </pre> <br><h3 id="vybor-kol-va-otchetov">  Select number of reports </h3><br><p>  Before we go further, we need to talk a little about the depth of rendering our sound.  With a sampling rate of 44100 Hz, every second, 44100 reports are available for processing.  Suppose we need to draw a track with a length of 10 seconds.  Each report we will draw a line in a pixel width.  So, our oscillogram will be 441,000 pixels long.  The result is a very long, elongated and poorly understood sound wave.  But, in it you can see each specific report!  And you will scare the system, no matter how you draw it. </p><br><p><img src="https://habrastorage.org/webt/qr/yf/j6/qryfj6qyv0v5mrbzjfqz6qcws_y.png"></p><br><p>  If you do not do professional audio software, you do not need such accuracy.  For a general audio picture, we can break all samples into larger periods and take, for example, the average of each 100 samples.  Then our wave will have a completely distinct form: </p><br><p><img src="https://habrastorage.org/webt/2v/yk/kz/2vykkzw2wtewvjzcwsfsz_h1zvq.png"></p><br><p>  Of course, this is not entirely accurate, since you can skip the volume peaks that you may need, so you can try not the average value, but the maximum of a given segment.  This will give a slightly different picture, but your peaks will not be lost. </p><br><h3 id="podgotovka-k-polucheniyu-audiodannyh">  Preparing to receive audio data </h3><br><p>  Let's define the accuracy of our sample as quality, and the final quantity of reports as sampleCount. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quality = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sampleCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; sampleCount = freq / quality;</code> </pre> <br><p>  An example of calculating all the numbers will be lower. </p><br><p>  Next we need to get the samples themselves.  This can be done from the audio clip using the <strong>GetData</strong> method. </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> offsetSamples</span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br><p>  This method takes an array where it writes samples.  offsetSamples is a parameter that is responsible for the starting point of reading an array of data.  If you read the array from the beginning, then there should be zero. </p><br><p>  To record samples, we need to prepare an array for them.  For example, like this: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] samples; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] waveFormArray; <span class="hljs-comment"><span class="hljs-comment">//      samples = new float[myAudio.clip.samples * myAudio.clip.channels];</span></span></code> </pre> <br><p>  Why do we multiply the length by the number of channels?  I'll tell you now ... </p><br><h3 id="informaciya-ob-audiokanalah-v-unity">  Unity audio channel information </h3><br><p>  Many people know that in the sound we usually use two channels: left and right.  Someone knows that there are 2.1 systems, as well as 5.1, 7.1 in which sound sources surround from all sides.  The topic of channels is well described <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D0%25B1%25D1%258A%25D1%2591%25D0%25BC%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25B7%25D0%25B2%25D1%2583%25D0%25BA">on the wiki</a> .  How does this work in Unity? </p><br><p>  When downloading a file, when opening a clip, you can find the following image: </p><br><p><img src="https://habrastorage.org/webt/us/hy/tu/ushytu2q3jhyyl8sbx9tclnaf9i.png"></p><br><p>  Here it is just shown that we have two channels, and one can even notice that they differ from each other.  Unity records samples of these channels one after another.  It turns out this picture: <br><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><msub><mi>L</mi><mn>1</mn></msub><mo>,</mo><msub><mi>R</mi><mn>1</mn></msub><mo>,</mo><msub><mi>L</mi><mn>2</mn></msub><mo>,</mo><msub><mi>R</mi><mn>2</mn></msub><mo>,</mo><msub><mi>L</mi><mn>3</mn></msub><mo>,</mo><msub><mi>R</mi><mn>3</mn></msub><mo>,</mo><msub><mi>L</mi><mn>4</mn></msub><mo>,</mo><msub><mi>R</mi><mn>4</mn></msub><mo>,</mo><msub><mi>L</mi><mn>5</mn></msub><mo>,</mo><msub><mi>R</mi><mn>5</mn></msub><mo>,</mo><msub><mi>L</mi><mn>6</mn></msub><mo>,</mo><msub><mi>R</mi><mn>6</mn></msub><mo>,</mo><msub><mi>L</mi><mn>7</mn></msub><mo>,</mo><msub><mi>R</mi><mn>7</mn></msub><mo>,</mo><msub><mi>L</mi><mn>8</mn></msub><mo>,</mo><msub><mi>R</mi><mn>8</mn></msub><mo>.</mo><mo>.</mo><mo>.</mo><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="63.547ex" height="2.66ex" viewBox="0 -832 27360.5 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-5B" x="0" y="0"></use><g transform="translate(278,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-31" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-2C" x="1413" y="0"></use><g transform="translate(1859,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-31" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-2C" x="3072" y="0"></use><g transform="translate(3517,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-32" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-2C" x="4653" y="0"></use><g transform="translate(5098,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-32" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-2C" x="6311" y="0"></use><g transform="translate(6756,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-33" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-2C" x="7892" y="0"></use><g transform="translate(8337,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-33" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-2C" x="9550" y="0"></use><g transform="translate(9995,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-34" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-2C" x="11131" y="0"></use><g transform="translate(11576,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-34" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-2C" x="12789" y="0"></use><g transform="translate(13235,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-35" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-2C" x="14370" y="0"></use><g transform="translate(14815,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-35" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-2C" x="16029" y="0"></use><g transform="translate(16474,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-36" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-2C" x="17609" y="0"></use><g transform="translate(18054,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-36" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-2C" x="19268" y="0"></use><g transform="translate(19713,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-37" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-2C" x="20848" y="0"></use><g transform="translate(21293,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-37" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-2C" x="22507" y="0"></use><g transform="translate(22952,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-38" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-2C" x="24087" y="0"></use><g transform="translate(24533,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-38" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-2E" x="25746" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-2E" x="26191" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-2E" x="26636" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/everydaytools/blog/432134/&amp;xid=17259,1500004,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhUoZKMXwC34P3CfeYLspiSrIU1dw#MJMAIN-5D" x="27082" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><msub><mi>L</mi><mn>1</mn></msub><mo>,</mo><msub><mi>R</mi><mn>1</mn></msub><mo>,</mo><msub><mi>L</mi><mn>2</mn></msub><mo>,</mo><msub><mi>R</mi><mn>2</mn></msub><mo>,</mo><msub><mi>L</mi><mn>3</mn></msub><mo>,</mo><msub><mi>R</mi><mn>3</mn></msub><mo>,</mo><msub><mi>L</mi><mn>4</mn></msub><mo>,</mo><msub><mi>R</mi><mn>4</mn></msub><mo>,</mo><msub><mi>L</mi><mn>5</mn></msub><mo>,</mo><msub><mi>R</mi><mn>5</mn></msub><mo>,</mo><msub><mi>L</mi><mn>6</mn></msub><mo>,</mo><msub><mi>R</mi><mn>6</mn></msub><mo>,</mo><msub><mi>L</mi><mn>7</mn></msub><mo>,</mo><msub><mi>R</mi><mn>7</mn></msub><mo>,</mo><msub><mi>L</mi><mn>8</mn></msub><mo>,</mo><msub><mi>R</mi><mn>8</mn></msub><mo>.</mo><mo>.</mo><mo>.</mo><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-1"> [L_1, R_1, L_2, R_2, L_3, R_3, L_4, R_4, L_5, R_5, L_6, R_6, L_7, R_7, L_8, R_8 ...] </script></p><br><p>  That is why we need two times more space in the array than just for the number of samples. </p><br><p>  If you select the Force To Mono clip option, the channel will be one and all sound will be in the center.  The preview of your wave will immediately change. </p><br><p><img src="https://habrastorage.org/webt/fx/pk/-f/fxpk-fvqtdsvhfvfyyvl1mjrjla.png"></p><br><p><img src="https://habrastorage.org/webt/po/62/s8/po62s86xpcbainozvupbpekwdig.png"></p><br><h3 id="poluchenie-audiodannyh">  Receive audio data </h3><br><p>  This is what comes out: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quality = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sampleCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] waveFormArray; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] samples; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioSource myAudio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { myAudio = gameObject.GetComponent&lt;AudioSource&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> freq = myAudio.clip.frequency; sampleCount = freq / quality; samples = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[myAudio.clip.samples * myAudio.clip.channels]; myAudio.clip.GetData(samples,<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  ,    .       waveFormArray = new float[(samples.Length / sampleCount)]; //             for (int i = 0; i &lt; waveFormArray.Length; i++) { waveFormArray[i] = 0; for (int j = 0; j &lt; sampleCount; j++) { //Abs     ""    . .  waveFormArray[i] += Mathf.Abs(samples[(i * sampleCount) + j]); } waveFormArray[i] /= sampleCount; } }</span></span></code> </pre> <br><p>  Total, if the track is 10 seconds and it is two-channel, then we get the following: </p><br><ul><li>  The number of samples in the clip (myAudio.clip.sample) = 44100 * 10 = 441000 </li><li>  The length of the array of samples for two channels (samples.Length) = 441000 * 2 = 882000 </li><li>  Number of reports (sampleCount) = 44100/100 = 441 </li><li>  The length of the final array = samples.Length / sampleCount = 2000 </li></ul><br><p>  As a result, we will work with 2000 points, which is quite enough for us to draw the wave.  Now we need to include imagination and think about how we can use this data. </p><br><h3 id="otrisovka-audioinformacii">  Audio rendering </h3><br><h4 id="sozdanie-prostoy-audiodorozhki-s-pomoschyu-debug-sredstv">  Creating a simple audio track using Debug tools </h4><br><p>  As many know, Unity has convenient tools for displaying various kinds of Debug information.  An intelligent developer based on these tools can make, for example, very powerful extensions for the editor.  Our case shows a very atypical use of Debug-methods. </p><br><p>  For drawing we need a line.  We can make it using a vector that will be created from the values ‚Äã‚Äãof our array.  Consider, to make a beautiful mirror audio form, we need to glue the two halves of our visualization. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; waveFormArray.Length - <span class="hljs-number"><span class="hljs-number">1</span></span>; i++) { <span class="hljs-comment"><span class="hljs-comment">//      Vector3 upLine = new Vector3(i * .01f, waveFormArray[i] * 10, 0); //      Vector3 downLine = new Vector3(i * .01f, -waveFormArray[i] * 10, 0); }</span></span></code> </pre> <br><p>  Next, just use Debug.DrawLine to draw our vectors.  You can choose any color.  All these methods need to be called in Update, so we will update the information every frame. </p><br><pre> <code class="cs hljs">Debug.DrawLine(upLine, downLine, Color.green);</code> </pre> <br><p>  If you want, you can add a "slider", which will show the current position of the played track.  This information can be obtained from the "AudioSource.timeSamples" field. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> debugLineWidth = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-comment"><span class="hljs-comment">// ""  .       int currentPosition = (myAudio.timeSamples / quality) * 2; Vector3 drawVector = new Vector3(currentPosition * 0.01f, 0, 0); Debug.DrawLine(drawVector - Vector3.up * debugLineWidth, drawVector + Vector3.up * debugLineWidth, Color.white);</span></span></code> </pre> <br><p>  So here‚Äôs our script: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WaveFormDebug</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quality = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sampleCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> freq; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> debugLineWidth = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] waveFormArray; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] samples; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioSource myAudio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { myAudio = gameObject.GetComponent&lt;AudioSource&gt;(); <span class="hljs-comment"><span class="hljs-comment">//  freq = myAudio.clip.frequency; sampleCount = freq / quality; //  samples = new float[myAudio.clip.samples * myAudio.clip.channels]; myAudio.clip.GetData(samples, 0); //       waveFormArray = new float[(samples.Length / sampleCount)]; for (int i = 0; i &lt; waveFormArray.Length; i++) { waveFormArray[i] = 0; for (int j = 0; j &lt; sampleCount; j++) { waveFormArray[i] += Mathf.Abs(samples[(i * sampleCount) + j]); } waveFormArray[i] /= sampleCount; } } private void Update() { for (int i = 0; i &lt; waveFormArray.Length - 1; i++) { //      Vector3 upLine = new Vector3(i * 0.01f, waveFormArray[i] * 10, 0); //      Vector3 downLine = new Vector3(i * 0.01f, -waveFormArray[i] * 10, 0); // Debug  Debug.DrawLine(upLine, downLine, Color.green); } // ""  .       int currentPosition = (myAudio.timeSamples / quality) * 2; Vector3 drawVector = new Vector3(currentPosition * 0.01f, 0, 0); Debug.DrawLine(drawVector - Vector3.up * debugLineWidth, drawVector + Vector3.up * debugLineWidth, Color.white); } }</span></span></code> </pre> <br><p>  And here is the result: </p><br><p><img src="https://habrastorage.org/webt/gq/ij/fd/gqijfdc9d3b6t1nemd-wqsxqn70.png"></p><br><h4 id="sozdanie-plavnogo-zvukovogo-landshafta-s-pomoschyu-polygoncollider2d">  Create a smooth sound landscape with PolygonCollider2D </h4><br><p>  Before proceeding to this section, I want to note the following: riding along the track generated from the music is, of course, fun, but from the point of view of the gameplay it is almost useless.  And that's why: </p><br><ol><li>  In order for the track to be passable, you need to smooth our data.  All the peaks disappear and you practically cease to "feel your music" </li><li>  Usually, music tracks are very compressed and represent a sound brick, which is badly suited for a 2D game. </li><li>  Unresolved question of the speed of our transport, which should fit the speed of the track.  I want to consider this question in the next article. </li></ol><br><p>  Therefore, as an experiment, this type of generation is quite funny, but it is difficult to make a real gameplay feature based on it.  In any case, we will continue. </p><br><p>  So, we need to make PolygonCollider2D using our data.  This is easy to do.  PolygonCollider2D has a public field points, which accepts Vector2 [].  First we need to transfer our points to the vector of the desired type.  Let's make a function to translate an array of our samples into a vector array: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Vector2[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreatePath</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] src</span></span></span><span class="hljs-function">)</span></span> { Vector2[] result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2[src.Length]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; size; i++) { result[i] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(i * <span class="hljs-number"><span class="hljs-number">0.01f</span></span>, Mathf.Abs(src[i] * lineScale)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br><p>  After that, we simply transfer our resulting array of vectors to the collider: </p><br><pre> <code class="cs hljs">path = CreatePath(waveFormArray); poly.points = path;</code> </pre> <br><p>  See the result.  Here is the beginning of our track ... hmm ... it looks not very passable (for now, don't think about visualization, comments will be later). </p><br><p><img src="https://habrastorage.org/webt/e-/3e/ry/e-3eryzi385zy3f4r-hvnsi0iwc.png"></p><br><p>  Our audio format is too sharp, so the track is strange.  It is necessary to smooth it.  Here we use the moving average algorithm.  You can read more about it in Habr√©, in the article <a href="https://habr.com/post/134375/">Moving Average Algorithm (Simple Moving Average)</a> . </p><br><p>  In Unity, the algorithm is implemented as follows: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function">[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MovingAverage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> frameSize, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> sum = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] avgPoints = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[data.Length - frameSize + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> counter = <span class="hljs-number"><span class="hljs-number">0</span></span>; counter &lt;= data.Length - frameSize; counter++) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> innerLoopCounter = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = counter; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (innerLoopCounter &lt; frameSize) { sum = sum + data[index]; innerLoopCounter += <span class="hljs-number"><span class="hljs-number">1</span></span>; index += <span class="hljs-number"><span class="hljs-number">1</span></span>; } avgPoints[counter] = sum / frameSize; sum = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> avgPoints; }</code> </pre> <br><p>  Modifying our path creation: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] avgArray = MovingAverage(frameSize, waveFormArray); path = CreatePath(avgArray); poly.points = path;</code> </pre> <br><p>  Checking ... </p><br><p><img src="https://habrastorage.org/webt/m5/rk/sb/m5rksbekvjfd45482gbgprvnmn0.png"></p><br><p>  Now our track looks quite normal.  I used a window width of 10. You can modify this parameter to choose the smoothing you need. </p><br><p>  Here is the full script for this section: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WaveFormTest</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> frameSize = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> size = <span class="hljs-number"><span class="hljs-number">2048</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> PolygonCollider2D poly; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> lineScale = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quality = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sampleCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] waveFormArray; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] samples; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Vector2[] path; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioSource myAudio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { myAudio = gameObject.GetComponent&lt;AudioSource&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> freq = myAudio.clip.frequency; sampleCount = freq / quality; samples = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[myAudio.clip.samples * myAudio.clip.channels]; myAudio.clip.GetData(samples, <span class="hljs-number"><span class="hljs-number">0</span></span>); waveFormArray = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[(samples.Length / sampleCount)]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; waveFormArray.Length; i++) { waveFormArray[i] = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; sampleCount; j++) { waveFormArray[i] += Mathf.Abs(samples[(i * sampleCount) + j]); } waveFormArray[i] /= sampleCount * <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//  ,    frameSize float[] avgArray = MovingAverage(frameSize, waveFormArray); path = CreatePath(avgArray); poly.points = path; } private Vector2[] CreatePath(float[] src) { Vector2[] result = new Vector2[src.Length]; for (int i = 0; i &lt; size; i++) { result[i] = new Vector2(i * 0.01f, Mathf.Abs(src[i] * lineScale)); } return result; } private float[] MovingAverage(int frameSize, float[] data) { float sum = 0; float[] avgPoints = new float[data.Length - frameSize + 1]; for (int counter = 0; counter &lt;= data.Length - frameSize; counter++) { int innerLoopCounter = 0; int index = counter; while (innerLoopCounter &lt; frameSize) { sum = sum + data[index]; innerLoopCounter += 1; index += 1; } avgPoints[counter] = sum / frameSize; sum = 0; } return avgPoints; } }</span></span></code> </pre> <br><p>  As I said at the beginning of the section, with this smoothing, we no longer feel the track, moreover, the speed of the machine is not tied to the speed of music (BPM).  We will examine this problem in the next part of this series of articles.  In addition, there we will touch on the topic of specials.  effects under the bit.  By the way, I took the machine from this <a href="https://assetstore.unity.com/packages/tools/physics/2d-car-73763">free asset</a> . </p><br><p>  Probably many of you, looking at the screenshots, wondered how I drew the track itself?  After all, the colliders are not visible. </p><br><p>  I used the wisdom of the Internet and found a way with which you can turn a polygon collider into a mesh, to which you can assign any material, and the line renderer will make a stylish outline.  This method is described in detail <a href="http://answers.unity3d.com/questions/835675/how-to-fill-polygon-collider-with-a-solid-color.html">here</a> .  Triangulator you can take on the <a href="http://wiki.unity3d.com/index.php/Triangulator">Unity Community</a> . </p><br><h2 id="zavershenie">  Completion </h2><br><p>  What we have learned in this article is a basic outline for music games.  Yes, in this form it is, for the time being, a little indifferent, but you can already say with confidence, "Guys, I made the machine drive the audio track!".  To make this a real game, you need to make a lot of effort.  Here is a list of what we can do here: </p><br><ol><li>  Snap the speed of the cars to the track BPM.  The player can only control the inclination of the car, but not the speed.  Then the music will be much stronger to be felt in the process of passing the track. </li><li>  Make a bit-detector and add specials.  effects that will work under the bit.  In addition, you can add animation to the body of the car, which will bounce on the beat of a bit.  It all depends on your imagination. </li><li>  Instead of a moving average, you need to more competently process the track and get an array of data so that the peaks do not disappear, but at the same time the route was easy to build. </li><li>  Well, and, of course, you need to make the gameplay interesting.  You can place a bit of a coin on each punch, add danger zones, etc. </li></ol><br><p>  All this and much more will be studied in the remaining parts of this series of articles.  Thank you all for reading! </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/432134/">https://habr.com/ru/post/432134/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../432120/index.html">Lenovo will pay laptop owners compensation of $ 8.3 million for installing Superfish malware</a></li>
<li><a href="../432122/index.html">Xcode and advanced debugging in LLDB: Part 2</a></li>
<li><a href="../432128/index.html">Crutches, Narnia, Ninja procrusts: three pains of a timlid in a startup</a></li>
<li><a href="../432130/index.html">Autumn mitapy on mobile development in the office Tutu.ru</a></li>
<li><a href="../432132/index.html">William Shakespeare: the difficulty of translating sonnets into Russian</a></li>
<li><a href="../432136/index.html">Cool the CPU in the data center - laser 3D printing will help</a></li>
<li><a href="../432138/index.html">Let's talk about metrics as a way to evaluate a programmer‚Äôs work.</a></li>
<li><a href="../432142/index.html">Hive monitoring and open project</a></li>
<li><a href="../432144/index.html">How we integrated for SAP stores in Europe with cash registers in Russia through 1C</a></li>
<li><a href="../432146/index.html">Zimbra Collaboration Suite as a worthy replacement for Microsoft Exchange</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>