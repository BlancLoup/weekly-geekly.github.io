<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Running javascript in a C # program</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The other day I looked through popular libraries on codeplex and saw a couple of libraries for working with javascript there. I immediately remembered...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Running javascript in a C # program</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/habraeffect/68/a5/68a59a7a878150524a30803a1565a0f2.png"><br><br>  The other day I looked through popular libraries on <a href="http://www.codeplex.com/">codeplex</a> and saw a couple of libraries for working with javascript there.  I immediately remembered the case when I had to write a small program for interacting with my account on one site.  Therefore, without hesitation, I decided to try how they would have coped with that task. <br><br>  Under the cut, I will tell you about the unrelated interaction with the site, how I solved the problem at that time and whether both libraries were able to cope with the same task.  I‚Äôll say <a href="http://jint.codeplex.com/">right away</a> that the following libraries will be discussed: <a href="http://jint.codeplex.com/">jint</a> and <a href="http://javascriptdotnet.codeplex.com/">javascriptdotnet</a> . <br><a name="habracut"></a><br>  I will not give a link to the site, as well as examples of javascript functions that I used when testing, so that readers do not experiment with this resource, it will be discussed in general terms. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I will start with a small story of how development began, I went to the site, went to the office, then I loaded <a href="http://www.fiddler2.com/fiddler2/">fiddler</a> and started watching and recording which parameters are sent to where, by what methods and by what links.  Pretty quickly, I sketched an algorithm for myself and started to implement it, but I ran into a problem, it turned out that one of the parameters that I took for a random number was not that, later it turned out that the call to the random () function in the most visible place served only to distract attention, what actually happens there helped me to install an add-on for Firefox called <a href="http://addons.mozilla.org/en-us/firefox/addon/javascript-deobfuscator/">javascript deobfuscator</a> , for those who are not familiar with this or similar add-ons, it looks like this when opening on google.com: <br><br> <a href=""><img src="https://habrastorage.org/storage/habraeffect/a5/f9/a5f99ac2128c759052113f2042fa4d80.png"></a> <br><br>  In my case it was somewhat easier, because  no background scripts were executed, but it was clearly visible which scripts were executed with a particular action.  It was then that I learned that to get my "random" number, more than 200 lines of code or a little more than 15 functions should be executed.  The first thing I thought about was that I would quickly translate this code into C # and finish it, but the problem was that my javascript knowledge was superficial, and all the code was passed through the obfuscator and it was clear from the code that there were some cryptographic transformations occur, so I decided that it would be easier to execute this code in its original form. <br><br>  In order to check whether my code is actually executed, I immediately chose the easiest way - using the webBrowser component, an example from Msdn: <br><br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">webBrowser1.DocumentText = <br> <font color="#A31515">"&lt;html&gt;&lt;head&gt;&lt;script&gt;"</font> + <br> <font color="#A31515">"function test(message) { alert(message); }"</font> + <br> <font color="#A31515">"&lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;button "</font> + <br> <font color="#A31515">"onclick=\"window.external.Test('called from script code')\"&gt;"</font> + <br> <font color="#A31515">"call client code from script code&lt;/button&gt;"</font> + <br> <font color="#A31515">"&lt;/body&gt;&lt;/html&gt;"</font> ;</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  After that, just call the following code: <br><blockquote> <code><font color="black">webBrowser1.Document.InvokeScript( <font color="#A31515">"test"</font> , <font color="#0000ff">new</font> <font color="#2B91AF">String</font> [] { <font color="#A31515">"called from client code"</font> });</font> <br></code> </blockquote><br>  But this example is only suitable for the test, because  I categorically did not want to use the webBrowser component in my program, so I began to look for other solutions and found the following example: <br><br>  <b>Steps for creating .dll:</b> <br><br>  1. Create a file in Notepad, only with this line: <br><blockquote> <code><font color="black"><font color="#0000ff">class</font> EvalClass { <font color="#0000ff">function</font> Evaluate(expression: String) { <font color="#0000ff">return</font> eval(expression); } }</font> <br></code> </blockquote><br>  2. Save the file as C: \ MyEval.js <br>  3. Open VS Command Prompt (Start, Programs, VS, VS Tools) <br>  4. Write Cd \ to be at the root of C: \ <br>  5. Write <br><blockquote> <code><font color="black">jsc /t:library C:\MyEval.js</font> <br></code> </blockquote><br>  6. After that, a new file MyEval.dll will appear. <br>  7. Copy MyEval.dll to the project and add a link to it (also need to refer to Microsoft.Jscript.dll). <br>  8. Then you can access the library in the following way: <br><blockquote> <code><font color="black">EvalClass jScriptEvaluator = <font color="#0000ff">new</font> EvalClass(); <br> <font color="#0000ff">object</font> objResult = jScriptEvaluator.Evaluate(‚Äú1==1 &amp;&amp; 2==2‚Äù); <br> <br> objResult  True.</font> <br></code> </blockquote><br>  In my case, I did everything absolutely as described above with the only difference that in the class I had much more functions, in fact at the time this code was enough for me. <br><br><h4>  <b><a href="http://jint.codeplex.com/">Jint</a> library</b> </h4><br>  License: The MIT License (MIT) <br><br>  First of all, I decided to try the examples, they all earned, but as I noticed that the codeplex also had problems with the parser, which ‚Äúate‚Äù brackets in some places, having a little corrected the examples, they all worked.  Then I began to try his work on his set of functions, but unfortunately I could not get the library to return the desired value to me, googled, read the discussions.  I tried to change something, but unfortunately I could not overcome String.fromCharCode (): <br><br>  Jint.JintException: Method not defined: fromCharCode <br><br>  The library connects as standard, add links and write: <br><blockquote> <code><font color="black"><font color="#0000ff">using</font> Jint;</font> <br></code> </blockquote><br>  After that, such a code is enough to call the function: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">StreamReader sr = <font color="#0000ff">new</font> StreamReader( <font color="#A31515">@"C:\habr_javascript\MyEval.js"</font> ); <br> <font color="#0000ff">string</font> script = sr.ReadToEnd(); <br> <br> JintEngine engine = <font color="#0000ff">new</font> JintEngine(); <br> engine.Run(script); <br> <br> <font color="#0000ff">object</font> num = engine.Run( <font color="#A31515">"Evaluate(42210607);"</font> ); <br> MessageBox.Show(num.ToString());</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br><h4>  <b><a href="http://javascriptdotnet.codeplex.com/">Javascriptdotnet</a> library</b> </h4><br>  License: New BSD License (BSD) <br><br>  Having started one example, I immediately began to try my test example and bingo, it all worked the first time. <br><br>  Specify the link to the library, add the using directive: <br><blockquote> <code><font color="black"><font color="#0000ff">using</font> Noesis.Javascript;</font> <br></code> </blockquote><br>  And we write code that is almost identical to the previous one: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">StreamReader sr = <font color="#0000ff">new</font> StreamReader( <font color="#A31515">@"C:\habr_javascript\MyEval.js"</font> ); <br> <font color="#0000ff">string</font> script = sr.ReadToEnd(); <br> <br> JavascriptContext context = <font color="#0000ff">new</font> JavascriptContext(); <br> context.Run(script); <br> <br> <font color="#0000ff">object</font> num = context.Run( <font color="#A31515">"Evaluate(42210607);"</font> ); <br> MessageBox.Show(num.ToString());</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br><h4>  Conclusion </h4><br>  I would not like to say something bad about jint, because  Most likely I just did not understand and it works no worse than javascriptdotnet.  Although my program has already been working for more than 6 months, but I immediately wanted to simplify possible edits, since  if the site developers change literally one character, then I have to rebuild the library, and in the case of jint and javascriptdotnet, I just need to edit the resource file.  It‚Äôs also hard to imagine how you can add functions during program execution.  The jint library is developing more actively and the latest release was most recently on February 14, 2011, when javascriptdotnet was updated on September 16, 2010.  Libraries can be used not only for the method specified in the article, but also for testing your website. On the same stackoverflow, I saw that the developers used jint for testing server-side javascript, in fact, they also mention jint more.  In general, I hope that this article was useful to you and, if necessary, it will be useful for you to interact with C # with javascript. <br></div><p>Source: <a href="https://habr.com/ru/post/115021/">https://habr.com/ru/post/115021/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../115014/index.html">Tablet and keyboard: the battle for a place in the sun</a></li>
<li><a href="../115015/index.html">About the "holes" in the security of ERP systems</a></li>
<li><a href="../115018/index.html">Search for the k-th smallest element</a></li>
<li><a href="../115019/index.html">OpenStreetMap News ‚Ññ2</a></li>
<li><a href="../115020/index.html">VLC as a Windows service</a></li>
<li><a href="../115022/index.html">Android Development Tutorial. Part 1/?</a></li>
<li><a href="../115023/index.html">Google, unite!</a></li>
<li><a href="../115024/index.html">Patch intrusive warning "Press Esc for ..." in Flash Player version 10.2.152.32</a></li>
<li><a href="../115026/index.html">RMQ Task - 2. Segment Tree</a></li>
<li><a href="../115027/index.html">Mobile Firefox 4 beta 5</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>