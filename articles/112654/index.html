<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Undelete folders, virus protection on flash drives and all</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 Today we will talk about the so-called "immunizers" and "vaccinators" flash carriers from autorun viruses - how they work, whether they are ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Undelete folders, virus protection on flash drives and all</h1><div class="post__text post__text-html js-mediator-article"><img src="http://www.novedadesdetabasco.com.mx/thum/1277884038virus.jpg" alt="image"><br><br>  Hello! <br><br>  Today we will talk about the so-called "immunizers" and "vaccinators" flash carriers from autorun viruses - how they work, whether they are needed at all.  And of course we will consider one of the easiest ways to create such a "vaccine". <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>SUPER-MEGA-PROTECTION from the autoruns</b> <br><br>  - Some such slogan accompanies all such programs.  Of course: it is claimed that the program is able to detect any known and unknown infection transmitted on flash drives, ensure its blocking and even in a special way modify the file system on the flash drive so that such an infection will never stick again. <br><br>  Such programs became especially popular after the Kido boom - flash drives were one of the ways it was distributed.  The impudence of the ‚Äúutilizators‚Äù reached the point that they began to ask for a program for the money, immediately there were ‚Äúhackers‚Äù, which these programs began to break - well, it went and went. <br><br>  Let's now figure out what this program actually does and whether it makes sense. <br><br>  <b>DETECTION OF INFECTION</b> <br><br>  In fact, most programs consider a flash drive dangerous and ‚Äúdetect infection‚Äù by the presence of autorun.inf in the root of the disk.  Every time the media is mounted, the system‚Äôs autostart function is blocked, and the search for the desired autorun.inf is launched, and if there are, screams and groans begin. <br><br>  Particularly advanced programs can analyze the contents of autorun.inf for the presence of open, after which they parse the value and look - is there a file or folder on the flash drive along this path?  If there is - the cry will be deafening.  It is perfectly understandable the number of falls on almost all disks of presentations and installations, in which autorun.inf is slightly less than everywhere else.  In especially ‚Äúadvanced‚Äù programs, files and folders from open are checked for the ‚Äúhidden‚Äù attribute in order to reduce failures.  This, of course, a great achievement! <br><br>  It is quite obvious that such crafts will not protect against file viruses: if there is a program infected with Sality on the flash drive, it will nicely infect you when it is launched, bypassing all protections.  The sensational Stuxnet case will work without noise and dust - autorun.inf is not used at all.  In short, sad. <br><br>  <b>Have you done vaccination from kori?</b> <br><br>  One of the ‚Äúspecial‚Äù advantages of the programs being discussed for protection against infected flash media is the so-called ‚Äúvaccination‚Äù of the carrier, as a result of which it cannot be infected.  The essence of vaccination is the creation of an autorun.inf folder in the root with known file system errors, as a result of which it cannot be deleted.  In this case, it is impossible to write a file with the same name to the USB flash drive, which means that the malware will not be able to autostart. <br><br>  Alas, this method is miserable a priori: even if autorun.inf is not created, all other malware files will be safely copied and an inexperienced user can launch them by mistake or simply, ‚Äúto understand what it is I have kept‚Äù. <br><br>  In addition, all the errors described are successfully used by the malware itself for self-defense (executable files are hidden in the undelete folders), it is naive to believe that virus writers do not know how to get around what they themselves use. <br><br>  And now we will consider how to create in practice such a ‚Äúnon-removable‚Äù folder without any ‚Äúvaccinators‚Äù. <br><br>  <b>PRACTICE</b> <br><br>  Long time ago, <s>it seems last Friday,</s> when speeds were measured in baud, nobody heard about Mbit / s, and there were two, absolutely incompatible classes to chat on the phone and sit on the Internet: there was a glorious problem: a simple archive was created that dressed in hex editors, modified so that the file in the archive, consisting of ten characters "x", was converted into a file with a 10-degree character of the symbols "x".  The essence of the attack was simple: the archiving algorithm squeezed such a homogeneous file very strongly, but when sending by e-mail, if the client had automatic unpacking, the result file scored completely weak media then.  In total - the full desired "g".  After all, then no one else thought about the file system restrictions - just think: then the owners of 40 MB of screws were considered kings! <br><br>  No, I have not started senile insanity, and in general I am still young and beautiful (hello, girls!), But I remembered all this because our example will be very similar to those ancient methods. <br><br>  So, we will need: <br><br>  - WinRAR archiver.  I used version 3.93, for the rest I can not vouch. <br>  - 7-zip archiver.  In my case - 9.20.04 <br>  - OS Windows XP SP3 <br>  - system library mozg.dll <br>  - driver ruki.sys <br><br>  So what we do.  It is well known that in Windows, the total length of the path along with the file name should not exceed 260 characters.  Therefore, when creating folders with a deep attachment, sooner or later you will have to stop.  This is well known to people who make rips from sites with large attachments - whether you want to or not, but either the names of the folders should be shortened or cross-references should be made.  This is the limitation we will use. <br><br>  Create an empty folder on the disk with the name autorun.inf and add it to the rar-archive using WinRar.  Open the archive in WinRar - well, let's go.  Create another folder inside autorun.inf, then another and another - fill in the required 260 characters.  Well, at the very end, add something to the archive - you can even have an empty text file.  So, the vaccine is ready! <br><br>  If you try to unpack the resulting file with WinRar, the archiver rightly scolds: <br><img src="http://img39.imageshack.us/img39/8213/86191170.jpg" alt="image"><br><br>  But the 7-zip file perfectly unpacks and preserves the folder structure.  In total - voila! <br><br>  1. If the total path length with folder names and file name exceeds 260 characters, then such folder will be displayed, but the file cannot be opened, copied or edited.  The delete folder also fails because the file is not available for the system: <br><img src="http://img402.imageshack.us/img402/5175/23243256.jpg" alt="image"><br><img src="http://img263.imageshack.us/img263/6028/85776439.jpg" alt="image"><br><br>  <a href="http://www.onlinedisk.ru/file/598334/">The sample file</a> described <a href="http://www.onlinedisk.ru/file/598334/">here</a> is observed when unpacking to the root of any NTFS partition. <br><br>  2. If the total length of the path with folder names exceeds 260 characters without even counting the file name, then you simply cannot see the file itself - you will not reach it with either Explorer or file managers.  Well, all the sweets of claim 1 in addition :) <br><br>  <a href="http://www.onlinedisk.ru/file/598335/">The sample file</a> described <a href="http://www.onlinedisk.ru/file/598335/">here</a> is observed when unpacking to the root of any NTFS partition. <br><br>  <b>ADVANTAGES AND DISADVANTAGES</b> <br><br>  The benefits of this are knowledge and understanding!  But there are infinitely many minuses :) Because such a ‚Äúdefense‚Äù is easy to manage.  I will not load with technical details, I am sure that those to whom they understand are not reading this article for a long time, but drinking beer and loading others with technical details :), to put it simply - if we use lower access in the system, then we can perfectly work as with folders, and with hidden files. <br><br>  This is easily seen by the good old IceSword: <br><br><img src="http://img220.imageshack.us/img220/1554/80854430.jpg" alt="image"><br><br>  This anti-rootkit perfectly sees the entire folder structure, and the command force delete deletes them in one move. <br><br>  IceSword is no longer supported, but the Chinese do not give up and, in my opinion, very successfully intercept the baton with the help of the XueTr, which is inappropriate for the Russian ear of the anti-rootkit: <br><br><img src="http://img823.imageshack.us/img823/3435/80208448.jpg" alt="image"><br><br>  - all the same plus snacks, for example - reddish something that is suspicious (in our case - hidden folders and a file) :) <br><br>  Yes, in fact, a lot of things can be seen - I just chose two examples that were the closest. <br><br>  Separately, it is worth paying attention to the situation when in our undeletable folder hides not a regular textbook, but a malicious one.  Kaspersky Anti-Virus successfully checks the contents of the folder, it is easy to check <a href="http://www.onlinedisk.ru/file/598337/">this by</a> unpacking the contents of <a href="http://www.onlinedisk.ru/file/598337/">this archive</a> (inside - not a textbook, but eicar) and checking the resulting folder. <br><br>  As for the popular AVZ utility among the CIS residents, which is used in the manual treatment of infected computers, it is more interesting. <br><br>  I tried to secure and delete the file using the following AVZ script (the already mentioned <a href="http://www.onlinedisk.ru/file/598334/">test1.rar archive was used</a> ): <br><br> <code>begin <br> SearchRootkit(true, true); <br> SetAVZGuardStatus(True); <br> QuarantineFile('D:\autorun.inf\Mozhno_nazvat_kak_hotite_lish_by_bylo_ochen_dlinno_i_v_itoge_summa_papki_i_faila_poluchilas_bolee_260_simvolov\Mozhno_nazvat_kak_hotite_lish_by_bylo_ochen_dlinno_i_v_itoge_summa_papki_i_faila_poluchilas_bolee_260_simvolov\Mozhno_nazvat_kak_hotite_lish_by_bylo_ochen_dlinno_i_v_itoge_summa_papki_i_faila_poluchilas_bolee_260_simvolov.txt',''); <br> DeleteFile('D:\autorun.inf\Mozhno_nazvat_kak_hotite_lish_by_bylo_ochen_dlinno_i_v_itoge_summa_papki_i_faila_poluchilas_bolee_260_simvolov\Mozhno_nazvat_kak_hotite_lish_by_bylo_ochen_dlinno_i_v_itoge_summa_papki_i_faila_poluchilas_bolee_260_simvolov\Mozhno_nazvat_kak_hotite_lish_by_bylo_ochen_dlinno_i_v_itoge_summa_papki_i_faila_poluchilas_bolee_260_simvolov.txt'); <br> BC_ImportAll; <br> ExecuteSysClean; <br> BC_LogFile(GetAVZDirectory + 'boot_clr.log'); <br> SaveLog(GetAVZDirectory+'avz_log.txt'); <br> BC_Activate; <br> RebootWindows(true); <br> end.</code> <br> <br>  In total, direct quarantine and deletion commands did not work: <br><br><blockquote>  File Quarantine error, attempt to direct reading (D: \ autorun.inf \ Mozhno_nazvat_kak_hotite_lish_by_bylo_ochen_dlinno_i_v_itoge_summa_papki_i_faila_poluchilas_bolee_260_simvolov \ Mozhno_nazvat_kak_hotite_lish_by_bylo_ochen_dlinno_i_v_itoge_summa_papki_i_faila_poluchilas_bolee_260_simvolov \ Mozhno_nazvat_kak_hotite_lish_by_bylo_ochen_dlinno_i_v_itoge_summa_papki_i_faila_poluchilas_bolee_260_simvolov.txt) <br>  Quarantine using direct reading - error <br>  File Quarantine error, attempt to direct reading (D: \ autorun.inf \ Mozhno_nazvat_kak_hotite_lish_by_bylo_ochen_dlinno_i_v_itoge_summa_papki_i_faila_poluchilas_bolee_260_simvolov \ Mozhno_nazvat_kak_hotite_lish_by_bylo_ochen_dlinno_i_v_itoge_summa_papki_i_faila_poluchilas_bolee_260_simvolov \ Mozhno_nazvat_kak_hotite_lish_by_bylo_ochen_dlinno_i_v_itoge_summa_papki_i_faila_poluchilas_bolee_260_simvolov.txt) <br>  Quarantine using direct reading - error <br>  Deleting a file: D: \ autorun.inf \ Mozhno_nazvat_kak_hotite_lish_by_bylo_ochen_dlinno_i_v_itoge_summa_papki_i_faila_poluchilas_bolee_260_simvolov \ Mozhno_nazvat_kak_hotite_lish_by_bylo_ochen_dlinno_i_v_itoge_summa_papki_i_faila_poluchilas_bolee_260_simvolov \ Mozhno_nazvat_kak_hotite_lish_by_bylo_ochen_dlinno_i_v_itoge_summa_papki_i_faila_poluchilas_bolee_260_simvolov.txt <br>  &gt;&gt;&gt; To delete a file D: \ autorun.inf \ Mozhno_nazvat_kak_hotite_lish_by_bylo_ochen_dlinno_i_v_itoge_summa_papki_i_faila_poluchilas_bolee_260_simvolov \ Mozhno_nazvat_kak_hotite_lish_by_bylo_ochen_dlinno_i_v_itoge_summa_papki_i_faila_poluchilas_bolee_260_simvolov \ Mozhno_nazvat_kak_hotite_lish_by_bylo_ochen_dlinno_i_v_itoge_summa_papki_i_faila_poluchilas_bolee_260_simvolov.txt must reboot </blockquote><br><br>  After the automatic reboot, BootCleaner worked, which made a successful quarantine, but I still could not delete it: <br><br><blockquote>  Quarantine path: \ ?? \ D: \ AWZ \ Quarantine \ 2011-01-27 \ <br>  QuarantineFile \ ?? \ D: \ autorun.inf \ Mozhno_nazvat_kak_hotite_lish_by_bylo_ochen_dlinno_i_v_itoge_summa_papki_i_faila_poluchilas_bolee_260_simvolov \ Mozhno_nazvat_kak_hotite_lish_by_bylo_ochen_dlinno_i_v_itoge_summa_papki_i_faila_poluchilas_bolee_260_simvolov \ Mozhno_nazvat_kak_hotite_lish_by_bylo_ochen_dlinno_i_v_itoge_summa_papki_i_faila_poluchilas_bolee_260_simvolov.txt - succeeded <br>  QuarantineFile \ ?? \ D: \ autorun.inf \ Mozhno_nazvat_kak_hotite_lish_by_bylo_ochen_dlinno_i_v_itoge_summa_papki_i_faila_poluchilas_bolee_260_simvolov \ Mozhno_nazvat_kak_hotite_lish_by_bylo_ochen_dlinno_i_v_itoge_summa_papki_i_faila_poluchilas_bolee_260_simvolov \ Mozhno_nazvat_kak_hotite_lish_by_bylo_ochen_dlinno_i_v_itoge_summa_papki_i_faila_poluchilas_bolee_260_simvolov.txt - succeeded <br>  DeleteFile \ ?? \ D: \ autorun.inf \ Mozhno_nazvat_kak_hotite_lish_by_bylo_ochen_dlinno_i_v_itoge_summa_papki_i_faila_poluchilas_bolee_260_simvolov \ Mozhno_nazvat_kak_hotite_lish_by_bylo_ochen_dlinno_i_v_itoge_summa_papki_i_faila_poluchilas_bolee_260_simvolov \ Mozhno_nazvat_kak_hotite_lish_by_bylo_ochen_dlinno_i_v_itoge_summa_papki_i_faila_poluchilas_bolee_260_simvolov.txt - failed (0xC0000043) <br>  - End - </blockquote><br><br>  Thus, we copied the malware, but we could not remove and neutralize it.  So I think Oleg Zaitsev still has something to work on :) <br><br>  <b>FINDINGS</b> <b><br></b> <br>  In this review, we have seen that almost all existing programs to provide protection against viruses that spread through flash media do not fully provide this protection.  "Vaccination" or "immunization" flash drives only leads to partial protection, which is easily bypassed by serious malware. <br><br>  If you are really interested in providing protection against this kind of threat, I recommend simply disabling autorun of any media on your system.  This can be done irreversibly (because I am too lazy to remember the default settings in the registry :)) by adding the registry information of <a href="http://www.onlinedisk.ru/file/598341/">this file</a> , or reversibly, using specific programs, such as <a href="">Autorunsettings from Uwe Sieber</a> . </div><p>Source: <a href="https://habr.com/ru/post/112654/">https://habr.com/ru/post/112654/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../112648/index.html">The current status of the tools. User view</a></li>
<li><a href="../112649/index.html">Nokia‚Äôs share of smartphones has dropped to 31%, profits are also suffering</a></li>
<li><a href="../112650/index.html">Take out the trash!</a></li>
<li><a href="../112652/index.html">Gmail Alerts for Desktop</a></li>
<li><a href="../112653/index.html">Symfohub = symfony + GitHub</a></li>
<li><a href="../112655/index.html">The use of high technology for hanging photo frames</a></li>
<li><a href="../112659/index.html">Fast indexing in Search for a site</a></li>
<li><a href="../112661/index.html">Comparative table of the functionality of the systems Rekmermer and ‚ÄúTarget call‚Äù Yandex.Metrica</a></li>
<li><a href="../112662/index.html">Skype 5.0 for Mac OS X</a></li>
<li><a href="../112663/index.html">Coordination center proposes to cancel registration of ‚Äúauction‚Äù domains of the Russian Federation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>