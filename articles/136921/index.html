<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Thinstation - losing weight with thin clients up to version 2.5</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, Habr! 

 Relatively recently, a new version of the popular Thinstation thin client was released, namely 2.5. And, of course, bears in itself...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Thinstation - losing weight with thin clients up to version 2.5</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/0a5/847/8b9/0a58478b9270159511e13f2573d3f7e3.jpg" align="left" alt="image"><br>  Good day, Habr! <br><br>  Relatively recently, a new version of the popular <a href="http://thinstation.org/">Thinstation</a> thin client was released, namely 2.5.  And, of course, bears in itself both new buns, and a new rake plus a minimum of documentation on the new version. <br><br>  In this article (and it is designed for <b>beginners</b> , especially for those who are not very familiar with Linux), I will describe how to quickly build a thin client and make its use safe enough.  Under habrakat use of <a href="http://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25BC%25D0%25B0%25D1%2580%25D1%2582-%25D0%25BA%25D0%25B0%25D1%2580%25D1%2582%25D0%25B0">smart cards</a> , a RDP client of firm <a href="http://www.2x.com/">2X</a> and a happy end.  Welcome! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><h3>  Formulation of the problem </h3><br>  <b>So, we have:</b> <br><ul><li>  Several pieces of iron, proudly referred to as "thin clients."  For example, a couple of dozen have not been new <a href="http://www.parkytowers.me.uk/thin/hp/t5720/index.shtml">HP HSTNC-001L-TC</a> . </li><li>  Configured terminal server to which thin clients will cling.  Let it be MS Windows Server 2003 or 2008. </li></ul><br>  <b>And now what, in fact, want:</b> <br><ul><li>  Download thin clients on the network (diskless that is). </li><li>  Support for thin clients MS RDP versions 6+ or even 7, since  it is more secure <strike>and cool</strike> . </li><li>  And not just MS RDP, but <a href="http://technet.microsoft.com/en-us/magazine/ff458357.aspx">with TLS 1.0 support</a> . </li><li>  User authorization using smart cards (i.e. forwarding a smart card from a thin client to a server). </li><li>  <strike>Grab the world</strike> . </li></ul><br><h3>  Where do we start? </h3><br>  For diskless booting of our thin clients (and they will be loaded via the PXE protocol) we will need to configure a DHCP server and a TFTP server.  What is it for, how is network booting (PXE) and how to set it up well and is described in detail <a href="http://nixts.org/doku.php%3Fid%3Dinfo_pxe">here</a> .  As a TFTP server under Windows, I can recommend tftpd32, which can be downloaded <a href="http://tftpd32.jounin.net/tftpd32_download.html">here</a> .  Despite the name, there are versions for the x64 platform. <br><br>  Further, if there is a desire, you can read a little about Thinstation <a href="http://sourceforge.net/apps/mediawiki/thinstation/index.php%3Ftitle%3DMain_Page">here</a> , <a href="http://sourceforge.net/apps/mediawiki/thinstation/index.php%3Ftitle%3Dthinstation:Help">here</a> and <a href="http://sourceforge.net/projects/thinstation/files/thinstation/thinstation-2.5/">here</a> (under the list of files to download).  Information in Russian can be found <a href="http://nixts.org/">here</a> , although it is already somewhat outdated.  There signs the creation and configuration of images of Thinstation version 2.2.2, much is also relevant for 2.5.  Directly version 2.5 is devoted so far only <a href="http://sourceforge.net/apps/mediawiki/thinstation/index.php%3Ftitle%3DDeveloper:2.5-starting">one page</a> .  So, let's begin. <br><br><h3>  First build </h3><br>  Since Thinstation is based on Linux, it means we need a computer with Linux installed to build a thin client (thanks, KO!).  I used Ubuntu 11.10.  We will also need to install Git (if it does not already exist) and use it to clone our repository with the image generator: <br><br><pre><code class="bash hljs">sudo apt-get install git-core <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /home/user/ git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> --depth 1 git://thinstation.git.sourceforge.net/gitroot/thinstation/thinstation <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> thinstation</code> </pre> <br>  After the image generator is downloaded, you need to run the script: <br><br><pre> <code class="bash hljs">./setup-chroot</code> </pre><br>  When you first start this script will collect the necessary packages and deploy the entire infrastructure for the further generation of our boot images. <br><br>  It is time to collect our first, so far, "fat" image.  This large image with the support of a very wide list of hardware is needed to then generate a small profile to support our specific hardware.  I want to note that this is one of the main advantages of the new version of Thinstation: now you don‚Äôt need to compile a list of drivers that should be included in the image - it is generated automatically by the script. <br><br>  As the developers advise, the assembly should be performed ‚Äúinside chroot session‚Äù, therefore <i>we</i> do not exit the <i>setup-chroot.sh</i> script (press only ‚ÄúQ‚Äù to hide the script‚Äôs welcome message) and write the following commands in the local console: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ts/2.5 nano build.conf</code> </pre><br>  In the file <i>build.conf we</i> uncomment the line " <i>package extensions</i> ".  If you have internet through a proxy, then uncomment the line " <i>param httpproxy</i> " and specify its proxy server settings in it (for example, " <i>param httpproxy <a href="http://user/">user</a> : password @ proxy: port</i> "), save the file and continue building: <br><br><pre> <code class="bash hljs">./build --allmodules</code> </pre><br>  We look at the long wrapper of the build script log, agree to download additional packages if he asks, and wait for the process to finish.  Now we copy the contents of the directory " <i>/home/user/thinstation/ts/2.5/boot-images/pxe</i> " (and this is our compiled boot image) to the root of the TFTP server and try downloading the thin client over the network for the first time. <br><br>  And here we can meet the first long-awaited rake.  If your thin client has little RAM, then we go back to editing the <i>build.conf</i> file and comment out some heavy package, for example " <i>#package chrome</i> ", repeat the build and see a decrease of almost 2 times.  Now the download should go. <br><br>  Even after that, with a probability close to 100%, the full load of the thin client will not occur.  But we do not need this.  We are waiting for the loader to show us a picture with the inscription ‚ÄúThinstation‚Äù and a progress bar.  After that, press Ctrl + Alt + F3 and see the console with an invitation to enter.  Enter the following login-password pair " <i>root - pleasechangeme</i> " and run the script: <br><br><pre> <code class="bash hljs">hwlister.sh</code> </pre><br>  This script will generate us profile files for a specific hardware of our thin client.  Usually there are two: " <i>module.list</i> " (a list of drivers for our hardware) and " <i>vbe_modes.list</i> " (graphics modes).  Now they need to be copied to a Linux machine.  This can be done, for example, through a TFTP server (it must allow writing).  In the console of the thin client, enter: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> / tftp -p -l module.list -r module.list 192.168.0.1 tftp -p -l vbe_modes.list -r vbe_modes.list 192.168.0.1</code> </pre><br>  where 192.168.0.1 is the address of our TFTP server.  Let's go back to the Linux machine, create the folder " <i>/home/user/thinstation/ts/2.5/machine/my_machine</i> " and copy our two received files from the root of the TFTP server into it. <br><br><h3>  Scary beast - smart card </h3><br>  So, in order for our users to log in to the system using smart cards, several things are needed: <br><ul><li>  Actually, the smart cards themselves.  For example, <a href="http://www.aladdin-rd.ru/catalog/etoken/java/">such</a> . </li><li>  Devices for reading smart cards (card readers).  For example, <a href="http://www.athena-scs.com/product.asp%3Fpid%3D1">such</a> . </li><li>  And, of course, our terminal server must be properly configured to use smart cards for authentication.  This server setting is a big topic.  About her separately you can <a href="http://www.techdays.ru/videos/2560.html">see</a> and <a href="http://itband.ru/2010/09/authentication-part2/">read</a> .  In addition, to support specific smart cards, it is necessary to install the manufacturer‚Äôs software on the terminal server.  For selected by me as an example of maps of the company <i>Aladdin</i> it is <a href="http://www.aladdin-rd.ru/support/downloads/etoken/">here</a> .  At this stage, we will assume that we have already managed to configure the terminal server and it allows users to log in using smart cards. </li></ul><br>  Now we need to find and collect drivers for a Linux card reader.  On the manufacturer's website we find drivers <a href="http://www.athena-scs.com/downloads.asp">here</a> , download and unpack: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /home/user/ wget http://www.athena-scs.com/downloads/asedriveiiie-usb-3.7.tar.bz2 tar -xjf asedriveiiie-usb-3.7.tar.bz2 <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> asedriveiiie-usb-3.7</code> </pre><br>  We read the <i>README</i> and see that for the assembly we will need to install the PCSC Lite package (there is <a href="https://alioth.debian.org/frs/%3Fgroup_id%3D30105">here</a> , I installed the latest version of <i>ccid-1.4.5</i> at that time), and we also need the source code <a href="http://sourceforge.net/projects/libusb/files/libusb-0.1%2520%2528LEGACY%2529/0.1.12/"><i>libusb-0.1.12</i></a> ( <b>it is not going</b> with older versions) . <br><br>  We put PCSC Lite, in the folder with the drivers for the card reader, copy the <i>usb.h</i> file from the <i>libusb</i> sources.  Now we start the usual: <br><br><pre> <code class="bash hljs">./configure make make install</code> </pre><br>  Since Thinstation already contains the PCSC Lite package, we can simply copy our drivers to the Thinstation collector, like this: <br><br><pre> <code class="bash hljs">cp -LR /usr/lib/pcsc/drivers/ifd-ASEDriveIIIe-USB.bundle /home/user/thinstation/ts/2.5/packages/ccidreader/lib/pcsc/drivers cp /etc/udev/rules.d/50-pcscd-asedriveiiie.rules /home/user/thinstation/ts/2.5/packages/ccidreader/etc/udev/rules.d</code> </pre><br>  All is ready!  Now, when the reader is loading the thin client, the card reader will be detected and working normally.  In version 2.5, <a href="http://habrahabr.ru/blogs/sysadm/123142/">such</a> perversions for working with smart cards, as for 2.2.2, are no longer needed. <br><br><h3>  RDP clients </h3><br>  Now a little about how the client we will connect to the terminal server. <br>  At the moment, the most famous clients for Microsoft RDP for Linux-based systems are <a href="http://www.rdesktop.org/">rdesktop</a> and its fork - <a href="http://www.freerdp.com/">FreeRDP</a> .  <b>But!</b>  <i>rdesktop</i> does not support TLS 1.0, and <i>FreeRDP</i> does not know how to work with smart cards.  And this causes frank sadness! <br><br>  After a long search, another 2X RDP client was discovered.  You can download it <a href="http://www.2x.com/rdp-client/windows-linux-mac/downloadlinks/">here</a> .  It turned out that he can do all of the above, is free of charge and also supports MS RDP version 7.0 and is actively developing.  What was my luck when I found out that this client is a member of Thinstation! <br><br><h3>  The finish line: configure and build </h3><br>  Careful configuration is a big topic, so we read <a href="http://nixts.org/doku.php%3Fid%3Dinfo_pxe">here</a> in the " <i>Configuration Files</i> " section what each file is for and where it should be.  That article describes the configuration of Thinstation version 2.2.2.  Here I will talk about what has changed in the new version and give examples of my configuration files: <a href="http://pastebin.com/T4DD0J8y">build.conf</a> , <a href="http://pastebin.com/tkci4BrR">thinstation.conf.buildtime</a> and <a href="http://pastebin.com/7J3N79Bx">thinstation.conf.network</a> . <br>  So, I comment on the parameters from the configurations in the examples: <br><br>  <b>build.conf:</b> <br><ul><li>  <i>machine my_machine</i> - remember, we generated a profile for iron and put it in the " <i>my_machine</i> " folder?  This is it! </li><li>  <i>package xorg7-vesa</i> - choose the Xorg-driver.  This is where the problems arose, because the native driver for my SIS chipset <b>did not</b> fit and I had to figure out in practice which of the remaining ones would work.  Vesa works well with my chipset.  Perhaps here it is necessary to select the parameter in practice. </li><li>  <i>package ccidreader</i> is a PCSC Lite package that will allow us to work with smart cards. </li><li>  <i>package 2x, package alsa-lib</i> - this is our wonderful RDP client.  True, in practice it was revealed that he needs the Alsa package for work, therefore we include it. </li><li>  <i>param fastboot false</i> - if this parameter is set to <i>true</i> , then our boot image will be split into the main and loadable part.  Unfortunately, my network card did not load the whole image, therefore we generate an image as a whole. </li><li>  <i>param basepath config</i> - specifies which folder on the TFTP server will contain the configuration files for clients ( <i>thinstation.conf.network</i> , for example). </li><li>  <i>#param rootpasswd, etc.</i>  - comment on the parameters that set any passwords.  If the root password is commented out, then no one, even if it cheatfully gets access to the Thinstation console, will not be able to log in under the root.  And this is good) </li><li>  <i>param 2xurl</i> - specifies where the 2X client will be downloaded from.  It will be downloaded only once when you first run the build script. </li></ul><br>  <b>thinstation.conf.buildtime:</b> <br><ul><li>  <i>DONT_VT_SWITCH_STATE = TRUE</i> - will not allow the user to switch to the console via Ctrl + Alt + F3. </li><li>  <i>DONT_ZAP_STATE = TRUE</i> - will not allow the user to Ctrl + Alt + Backspace to re-initialize the graphics mode and again get into the console. </li></ul><br>  And finally, an example of the description of the launch session for a client 2X ( <i>thinstation.conf.network</i> ): <br><br><pre> <code class="bash hljs">SESSION_0_TITLE=<span class="hljs-string"><span class="hljs-string">"2X"</span></span> SESSION_0_TYPE=2X SESSION_0_2X_OPTIONS=<span class="hljs-string"><span class="hljs-string">"-m MX -C -u user -p password -s ssl://myTerminalServerIp"</span></span> SESSION_0_AUTOSTART=ON</code> </pre><br>  where: <br><ul><li>  <i>-m MX</i> - client mode, MS RDP, fullscreen. </li><li>  <i>-C</i> - smart card redirect. </li><li>  <i>-u user -p password</i> - logical, user-password.  <b>But!</b>  After all, we want to log in using a smart card, not a password!  It's simple: the fact is that the current 2X client will not start without user parameters and password, and the Segmentation fault will spit out you.  And this is complete nonsense.  However, after long conversations with the support service, they promised to solve this problem in the next release.  In the meantime, we simply write a non-existent user and password at random and quietly log in using a smart card, as if it should be so. </li><li>  <i>-s ssl: // myTerminalServerIp</i> - the address of the server to which we will connect.  ssl indicates that TLS 1.0 will be used. </li></ul><br><br>  With the configuration finished.  Now we collect the client: run the <i>setup-chroot.sh</i> script and enter: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ts/2.5 ./build</code> </pre><br>  The resulting image is added to the root of the TFTP server.  Also in the root of the TFTP server, create the folder " <i>config</i> " (the one we specified in <i>build.conf</i> ) and copy the file <i>thinstation.conf.network</i> into it. <br>  All is ready!  We start, check, see the login window of the terminal server and rejoice!  Happy end! <br><br>  <b>PS</b> Perhaps I missed something in this article.  I would like to hear questions and comments.  Thank! <br></div><p>Source: <a href="https://habr.com/ru/post/136921/">https://habr.com/ru/post/136921/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../136913/index.html">Full HD resolution x 4. New TV standard - UHD TV with a resolution of 3840x2160</a></li>
<li><a href="../136914/index.html">Cloud housing</a></li>
<li><a href="../136918/index.html">Pictographic password. Experiment</a></li>
<li><a href="../136919/index.html">How to increase the return on investment of the site?</a></li>
<li><a href="../136920/index.html">Own radio station Spreaker.com</a></li>
<li><a href="../136922/index.html">Learning to use Glade</a></li>
<li><a href="../136923/index.html">CSS3 Logo Design</a></li>
<li><a href="../136924/index.html">Life3D - in search of gliders. Part 2</a></li>
<li><a href="../136925/index.html">Sketch - 100 seconds about SOPA</a></li>
<li><a href="../136926/index.html">Make TCP faster</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>