<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Errors in smart contracts or Parity's new Security Alert</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="7 On November 8, Parity announced a critical error in the code responsible for the operation of their multi-sig wallet based on a publicly available s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Errors in smart contracts or Parity's new Security Alert</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/cu/dc/mg/cudcmgrkgrd1vxsce5zzi-d2ejk.png" align="right"><br>  <s>7</s> On November 8, <a href="https://paritytech.io/">Parity</a> <a href="https://paritytech.io/blog/security-alert.html">announced</a> a critical error in the code responsible for the operation of their multi-sig wallet based on a publicly available <a href="">smart contract</a> .  This is the second such case, the <a href="https://paritytech.io/blog/security-alert-high-2.html">first</a> occurred on 07/19/2017, when, due to the found vulnerability of the smart contract, 150000 ETH were withdrawn ( <a href="https://habrahabr.ru/post/333754/">Read more in Habr√©</a> ). <br><br>  Let's try to describe what the problem was and why about $ 300 million became unavailable. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">What is multi-sig wallets</b> <div class="spoiler_text">  Multi-sig (nature) wallets are created to solve the problem of increasing the protection of a private key, since 1 or more private keys are needed to complete a transaction (in general, M of N keys).  Example for case 2 of 3 keys: one key is stored locally, one in the cloud, and another 1 backup (in a secluded place).  To complete the transaction, you need 2 keys.  A little more you can read <a href="https://99bitcoins.com/what-is-multi%25C2%25ADsig-bitcoin-wallet-should-you-using-one/">here.</a> <br></div></div><br>  User GitHub <a href="https://github.com/devops199">devops199</a> , experimenting with public methods of publicly available smart contracts, called the smart contract <code>kill</code> method (Parity Wallet library).  Issue <a href="https://github.com/paritytech/parity/issues/6995"># 6995</a> on github. <br>  As a result, 584 purses for a total of about 1 million ETH ($ 300 million at the current exchange rate) became ‚Äúfrozen‚Äù, that is, the opportunity to transfer money from them was lost. <br><br><div class="spoiler">  <b class="spoiler_title">Picture with comments devops199</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/3c/k9/qv/3ck9qvjytnkcdtu7qjmehj54yms.jpeg" alt="image"><br></div></div><br>  Technically speaking, he first called the contract initialization method initWallet 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs matlab"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initWallet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(address[] _owners, uint _required, uint _daylimit)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">only_uninitialized</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initDaylimit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(_daylimit)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initMultiowned</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(_owners, _required)</span></span></span><span class="hljs-function">; }</span></span></code> </pre><br>  The <code>only_uninitialized</code> modifier <code>only_uninitialized</code> described as follows. <br><br><pre> <code class="hljs coffeescript"> <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unless</span></span> the contract <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> yet initialized. modifier only_uninitialized { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m_numOwners &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span>; _; }</code> </pre><br>  However, when placing the contract, the list of owners was not initialized, and the variable <code>m_numOwners</code> was equal to 0. The history of all operations with the contract can be found <a href="https://etherscan.io/address/0x863df6bfa4469f3ead0be8f9f2aae51c91a907b4">here.</a> <br><br>  As a result, calling <code>initWallet</code> allowed <code>devops199</code> to take over the contract (when calling initWallet at the library's smart contract, it turned into a regular wallet with the owner <code>msg.sender</code> , i.e. <code>devops199</code> ). <br><br>  Then you can simply <code>kill</code> to remove, which was done: <br><br><pre> <code class="hljs pgsql"> // kills the contract sending everything <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> `_to`. <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> kill(address _to) onlymanyowners(sha3(msg.data)) <span class="hljs-keyword"><span class="hljs-keyword">external</span></span> { suicide(_to); }</code> </pre><br>  The <code>suicide</code> operation in EVM is used to destroy a contract and transfers the remaining balance to the specified address.  At the same time, <code>suicide</code> more efficient than the <code>send</code> operation and costs a negative gas value, since it frees up space from contract data in the blockchain. <br><br>  Since all the logic of the multi-sig wallet was dependent on the contract, all owners who created the wallet after 07/20/2017 (and this is actually all their users, since before July 20 there was another vulnerability) lost access to the ability to transfer their funds wallets parity wallet.  You can fix the error only with another Ethereum fork, but of course this will <a href="https://twitter.com/VitalikButerin/status/928172344631115776">not happen</a> . <br><br>  I believe that the problem could have been easily avoided if Parity had removed the <code>kill</code> function when publishing a smart library contract.  It is useful only at the time of testing, but not in the target system. <br><br>  In this way, the history of the Parity Wallet wallets and $ 300 million, which can no longer be spent, ended. <br><br>  Do not forget to delete the code for testing, before transferring to production! </div><p>Source: <a href="https://habr.com/ru/post/342324/">https://habr.com/ru/post/342324/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../342310/index.html">Installing Proxmox VE on Debian Stretch using Ansible</a></li>
<li><a href="../342312/index.html">Configuring Jail on FreeBSD 11.1</a></li>
<li><a href="../342314/index.html">Playing with Nextgen-antivirus from Palo Alto Networks: it injects its dll into executable processes like * .exe</a></li>
<li><a href="../342316/index.html">Actors for fun and profit</a></li>
<li><a href="../342318/index.html">PouchDB or what to do when the ‚Äúinternet is stable‚Äù</a></li>
<li><a href="../342326/index.html">PVS-Studio report is now in Html format</a></li>
<li><a href="../342330/index.html">Insight on metrics: how do I understand what metrics are and what is their main charm</a></li>
<li><a href="../342332/index.html">Storage of personal data on a foreign hosting: if it is possible, how?</a></li>
<li><a href="../342334/index.html">Introduction to Neural Networks</a></li>
<li><a href="../342336/index.html">Migrating a database from InnoDB to MyRocks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>