<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we drew road shields on the map</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At the beginning of the 20th century, signs began to appear on the main public roads (further, shield) with numbers. Displaying them on the map is not...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we drew road shields on the map</h1><div class="post__text post__text-html js-mediator-article">  At the beginning of the 20th century, signs began to appear on the main public roads (further, shield) with numbers.  Displaying them on the map is not a mandatory attribute, but is important from the point of view of usability.  People who see signs in reality, it is easier to navigate the terrain.  It also gives the map a ‚Äúlocal flavor‚Äù.  It should be noted that the same road can have several plates at the same time.  This is due to the fact that road routes may overlap each other. <br><br><img src="https://habrastorage.org/files/03c/d8a/416/03cd8a4163a64ade9693064e5d83cce7.png"><br>  <i>In OsmAnd, we decided to draw a shield as close as possible to reality using the data from OpenStreetMap.</i> <i><br></i> <br><br><a name="habracut"></a><br><h4>  <b>OpenStreetMap and generic notation</b> </h4><br>  OSM does not have a generally accepted and widely used way of describing road shields.  Road routes are described using relation (‚Äúrelations‚Äù) such as route = road.  But, first, they are well made only for countries with developed infrastructure and / or with a strong local OSM community.  Secondly, they usually do not contain information about the color and shape of the shield.  Therefore, along with OSM data, we used various open sources, including Wikipedia and the site <a href="https://sites.google.com/site/roadnumberingsystems/home/countries">sites.google.com/site/roadnumberingsystems/home/countries</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The basic idea of ‚Äã‚Äãusing the information available in OSM is that we take a road relation and, depending on the network tag, assign a color and shape to the shield, the color of the number (ref).  Just in case, we limit the scope to some region or country.  But it only works for a limited set of countries.  Also, an approach was often used which consisted in parsing ref (road number) and extracting from it a prefix or some sequence inside. <br><img src="https://habrastorage.org/files/e78/1b0/b46/e781b0b46310418c829126a9f4f35d1e.png"><br><br>  Based on this and the country containing the road, the conclusion is made about the characteristics of the road shield.  The third method: some countries have a road numbering system by number range.  For example: from 0 to 99 - regional road, blue shield with white text;  100-499 - national road, green shield with yellow text, etc.  Sometimes a combined approach was used.  Also, when creating an OsmAnd map, information about priorities of shields is recorded there, depending on the road numbering system of specific countries. <br>  In the OSM wiki, there is a ref: color tag that is used around 5,000 times in the world.  Most often it is found in Spain - one of the few countries where none of the above methods for determining the shield parameters work.  In this case, the background color is taken directly from this tag. <br><br><h4>  <b>USA</b> </h4><br>  In the US, the situation is as follows.  Road relations are mapped very well, but the characteristics of the shields have to be determined differently: there are US Interstate highways, US State highways, secondary highways, territorial highways, state highways, county highways, which mainly differ in the number of separators (colons) in the network tag value. <br><img src="https://habrastorage.org/getpro/habr/post_images/4ef/c24/e8b/4efc24e8b752a76717780a984f1fd5ef.jpg" alt="image"><br><br>  The situation is complicated by the fact that almost every state uses its own shields for state highways.  Taking into account the huge number of them, we decided to draw these shields in a simplified way. <br><img src="https://habrastorage.org/getpro/habr/post_images/627/ffa/1fd/627ffa1fd09c763efca5a0378ade40fd.png" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/746/942/edd/746942edd6b7b654410b68bc56fc528d.png" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/81e/252/391/81e252391e9960bf4a89672fc7bf06b0.png" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/a13/f2e/d87/a13f2ed87c9f5a3f646e39781ceb9cb0.png" alt="image"><br>  <i>Examples of Road shield from different states: North Dakota, Idaho, Minnesota, Florida.</i> <i><br></i> <br>  Many roads have modifiers: spur, truck, business, alternate, etc.  In OsmAnd, they are displayed above the shield itself in a small rectangle - just like on real-life signs. <br><img src="https://habrastorage.org/files/1bc/6cf/afd/1bc6cfafdecc41f78c2379489f846b07.png"><br><br><h4>  <b>Canada</b> </h4><br>  In Canada, each state uses its own road numbering system.  The exception is Transcanada Highways, for which the unambiguous tagging method is not accepted in OSM.  The problem was solved completely only by adding a verification of the name of the road to the content of the text ‚Äútranscanada‚Äù in different variations. <br><br><img src="https://habrastorage.org/files/dbf/6a6/1ec/dbf6a61ec8cf40ec8bdb7299b984394b.png"><br><br><h4>  <b>Europe</b> </h4><br><img src="https://habrastorage.org/files/e56/dcf/8bb/e56dcf8bb6204b02b953a82644669d64.png"><br><br>  European countries for the most part do not use curly shields, such as in the USA.  Instead, rectangular tablets are widely used.  The exceptions are Hungary, Romania, the Netherlands (stadsroutes, city roads), highways of Germany, Greece and Italy.  The type of road is indicated by the background color as well as the text color. <br>  European car routes have the prefix E and from one to three white numbers on a green rectangular background.  These routes are to some extent similar to the inter-regional routes of the United States (Interstate Highways).  A sign of such a route in OSM is the relation route = road and the network = e-road tag.  During data processing, it turned out that the relationship of some of these routes did not contain the network = e-road tag, which was eliminated. <br><img src="https://habrastorage.org/getpro/habr/post_images/f11/056/08e/f1105608ee39e50f7a91c4e7a513a2f4.jpg" alt="image"><br><br><h4>  <b>Other countries</b> </h4><br>  There are countries (Lebanon, Mongolia) where it turned out to be problematic to establish what kind of colors and forms in reality should be shields.  It seems that in these countries road shields are not used at all. <br>  Israel, South Korea, Saudi Arabia and some other countries use shields that are not used anywhere else. <br><img src="https://habrastorage.org/files/ca0/40b/d3c/ca040bd3c57e47c28837806435d3fe54.png"><br><br>  The main map style on openstreetmap.org, mapnik, does not use data from road relations.  This fact, together with historical reasons, led to the fact that, as a rule, the ref tag is affixed to all participants in this relationship.  At the same time, a significant part of the roads is not included in road relations and the value of the ref tag is the only data source.  Consequently, we cannot drop the ref tag and rely only on road relations.  Instead, we, in the absence of an appropriate road relation, convert the ref tag to the internal data representation used to store tags derived from road relations.  This makes it possible to simplify the card style code. <br>  At the time of publication of the article OsmAnd supports road shields almost worldwide.  The exception is part of Africa and part of Central America. <br></div><p>Source: <a href="https://habr.com/ru/post/301320/">https://habr.com/ru/post/301320/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../301306/index.html">Google-oriented programming</a></li>
<li><a href="../301310/index.html">Do-it-yourself travel planner for a couple of hours</a></li>
<li><a href="../301312/index.html">LinkedIn: just another resume site</a></li>
<li><a href="../301314/index.html">JS Programming Contest: Word qualifier (addition)</a></li>
<li><a href="../301316/index.html">Attention: Is IT in IT under attack?</a></li>
<li><a href="../301324/index.html">Generating classes from a database using DataGrip</a></li>
<li><a href="../301330/index.html">Calling Java code from Love2D</a></li>
<li><a href="../301332/index.html">So you think you know Const?</a></li>
<li><a href="../301334/index.html">We study Bootmgr. Part 1 - tools and basic principles of debugging the initial stages of loading Windows</a></li>
<li><a href="../301336/index.html">ASP.NET Core RC2: Integrated Modularity Support (application parts)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>