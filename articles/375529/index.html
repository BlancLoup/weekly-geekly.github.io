<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The experience of creating a dial for Pebble watches</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I deliberately did not use the word "my" in the title, as mine is not so much there. Nevertheless, I hope the article will be useful to those who are ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The experience of creating a dial for Pebble watches</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/07a/643/fa6/07a643fa6d394804b64c5f691a1a3f45.png" alt="image"><br><br>  I deliberately did not use the word "my" in the title, as mine is not so much there.  Nevertheless, I hope the article will be useful to those who are only going to go my way. <br><a name="habracut"></a><br>  So, it all started with two articles from the user <a href="http://geektimes.ru/users/tmnhy/" class="user_link">tmnhy</a> (links to the articles themselves at the end of the material), where the creation of the dial was described in detail.  More valuable was the fact that the source code of the working dial was attached to the articles.  Judging by the articles, there is nothing particularly difficult in this matter and I decided to try.  I also contacted <a href="http://geektimes.ru/users/tmnhy/" class="user_link">tmnhy</a> himself, who helped me through the programming process to the end, for which I thank him so much. <br><br>  I always liked the watch with flipping plate numbers, so popular in America.  A few years ago, I even thought about buying an HTC smartphone just because the watch was made in that style there.  This is the dial I wanted to do. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I developed all the development in a special online service from the creators of the watch, CloudPebble.  Honestly, its functionality not only amazed me, but really pleasantly shocked me.  All code is written in the editor with convenient backlighting and auto-completion.  All graphics are added through a special resource manager.  Everything compiles to CloudPebble too, and the application instantly loads into your watch ‚Äî it just can't be more convenient.  You can also download the compiled file to your computer or take a screenshot of the dial.  As I understand it, the screenshot is actually taken on my watch, and not on some emulator on the server, because if you change the dial on the watch at the last second, the screenshot will be removed from it already.  Another advantage of CloudPebble is integration with GitHub, which I also gladly took advantage of. <br><br><img src="https://habrastorage.org/files/c2b/c20/242/c2bc20242f1c4e109e7a288821efd233.png" alt="image" align="left">  The lion's share of the time I took drawing graphics.  As far as drawing graphics, I immediately added it to the project and placed it where necessary.  I took the C code from the <a href="http://geektimes.ru/users/tmnhy/" class="user_link">tmnhy</a> example without any changes and then changed it to fit my needs.  Surprisingly enough for me, the dial has gained a slight touch of steampunk.  When all the graphics were ready and added to the project, the unexpected happened: I exceeded the memory limit on the clock.  The dial without errors was compiled and loaded into the clock, where it instantly "fell."  It was necessary to cut the graphics.  I started with the "saving on matches" and cut off the "thread" at the battery indicator.  Now, instead of this ‚Äúthread‚Äù, a Bluetooth indicator is shown, in which the letter B has come out of the screen.  Visually there is no difference with the previous version.  Next was the most time consuming - the central unit with the date and seconds.  I removed the background image with a circle and drew it programmatically. <br><br>  One nuance was found out here: for drawing a circle, the coordinates of the center and the radius are set, so its size in pixels will always be odd and it‚Äôs impossible to arrange it strictly in the center.  I had to move everything else a little bit, since the old circle had an even size.  For the same reason, the seconds indicator no longer fit into the circle and it also had to be redrawn.  And this is 60 sprites, if that ... However, if we redraw, then you need to squeeze out of it to the maximum.  As a result, everything that really does not change in the indicator of seconds, I transferred to the background image, which allowed to significantly reduce the resolution of the sprite.  Multiply by 60 and it turns out significant savings, which, ultimately, and allowed me to fit into the byte budget. <br><br>  The last problem I had to solve was the name of the city in the weather block.  The fact is that only a not very long name was placed there, but what to do with a long one?  Having played with the fonts, I realized that this is not an option.  As a result, he got out like this: if the name of the city is short enough, it shows the temperature, if it is long - only the temperature. <br><br>  The second integral part of the dial is the settings page.  In fact, this is a regular web page, the address of which is registered in the dial settings and which accepts and returns some variables back to the dial.  The page did not take a lot of time, since there was no need for adaptability and multi-browser compatibility here.  In order to optimize, I minified all CSS and JS and included them in the code of the page.  As a result, it turned out to be simple and fairly optimized: no graphics, and the only include file is jQuery. <br><br><img src="https://habrastorage.org/files/ac7/022/498/ac7022498f1a40679654e2c8edb5b343.jpg" align="right"><br><br>  In this form, the dial was published, but one thing I still did not give rest.  In order to properly configure the display of weather, the user had to find somewhere the ID of his city on openweathermap.org and enter it in the input field on the settings page, which is extremely inconvenient.  I found the official list of cities, consisting of ... 74 thousand items.  It is clear that to ship such a monster entirely is not an option.  The solution I chose was select with AJAX content. <br><br>  Having found a <a href="https://github.com/devbridge/jQuery-Autocomplete">suitable script</a> and ‚Äúhaving trained on cats‚Äù, I put the entire list of cities in the database.  Here a couple of nuances were revealed: 1) cities with the same name existed in different countries and 2) some cities (apparently large enough) had several IDs attached to different coordinates.  I solved the first problem by adding the state flag in front of the city name.  Flags, again for reasons of optimization, found <a href="http://artpolikarpov.ru/projects/flags/">such</a> that they were in one sprite.  I did not find an adequate solution for the second problem, and therefore I simply used GROUP BY in the SQL query in order to cut off duplicates. <br><br><h5>  References to the dial: </h5><br><ul><li>  at the <a href="https://apps.getpebble.com/applications/54a1169143ae82b64b000089">Pebble Store</a> </li><li>  on <a href="http://www.mypebblefaces.com/apps/26414/11501/">mypebblefaces</a> </li><li>  <a href="https://github.com/lentyay/flip-watchface">source</a> </li><li>  <a href="http://pebble.newkamikaze.com/">settings page</a> </li></ul><br><h5>  Additional links: </h5><br><ul><li>  <a href="http://habrahabr.ru/post/245297/">Pebble: work with static graphics</a> </li><li>  <a href="http://habrahabr.ru/post/245247/">Pebble: add configuration and save options to your application</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/375529/">https://habr.com/ru/post/375529/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../375517/index.html">Fully functional muscles grown in the laboratory.</a></li>
<li><a href="../375519/index.html">Conversation with an astronaut: on health, weightlessness and space mutants</a></li>
<li><a href="../375521/index.html">The state of e-commerce in RuNet</a></li>
<li><a href="../375525/index.html">Apple, Google, Intel and Adobe will pay $ 415 million in antitrust</a></li>
<li><a href="../375527/index.html">Beagle 2 probe missing 12 years ago found on Mars</a></li>
<li><a href="../375533/index.html">eCommerce for newbies</a></li>
<li><a href="../375535/index.html">Pilot series of ‚ÄúSpecial Opinion‚Äù is being prepared for production.</a></li>
<li><a href="../375537/index.html">Volunteer programmers save the world: 100 first days</a></li>
<li><a href="../375539/index.html">Stop fearing negative feedback, or working with a reputation</a></li>
<li><a href="../375541/index.html">The vibrator on Arduino is open for programming</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>