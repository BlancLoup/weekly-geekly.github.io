<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Useful devices for the home: do-it-yourself WiFi socket</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello geektimes! In the article I want to provide instructions for creating a WiFi-outlet. 


 It all started with the fact that in the fall I came ac...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Useful devices for the home: do-it-yourself WiFi socket</h1><div class="post__text post__text-html js-mediator-article"><p>  Hello geektimes!  In the article I want to provide instructions for creating a WiFi-outlet. </p><br><p>  It all started with the fact that in the fall I came across WiFi outlets in stores, I thought it was nothing complicated, then I got acquainted with ESP8266 and realized that I was ready to make an outlet myself. </p><br><p>  The socket will consist of: </p><br><ul><li>  Housing; </li><li>  ESP8266 12E with power isolation circuit; </li><li>  Power supply for ESP8266 from 220 volts; </li><li>  220 volt control board; </li><li>  Control panel (button, led, RJ45 port for firmware). </li></ul><br><p>  Prototype: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/f4f/b3c/e19/f4fb3ce1987941288cd6ddc124c26450.gif"></div><a name="habracut"></a><br><p>  Having broken an article into spoilers, I want to structure knowledge. </p><br><div class="spoiler">  <b class="spoiler_title">Housing</b> <div class="spoiler_text"><p>  The body was designed to be easy to assemble and disassemble during development and debugging, and as transparent as possible to see all the components. </p><br><p>  All boards have a maximum size of 5 x 3.5 cm, so the box will be 5 x 5 x 3.5 cm. </p><br><p>  Material: </p><br><ul><li>  a piece of plexiglass, the smallest size of 0.5 x 0.25 meters, is enough for a dozen such crafts </li><li>  hinges smallest found 2.5 x 2.5 cm </li><li>  screws </li></ul><br><p>  Plexiglas was cut out with a soldering iron heated to 300 degrees: the cutting line was cut with a knife blade, and then it was run with a soldering iron along the line with pressure on the soldering iron, then held on the other side, and then it could be broken along the fault line. </p><br><p>  Holes for screws for hinges drilled a mini drill on the engine with a collet and a 1mm drill. </p></div></div><br><div class="spoiler">  <b class="spoiler_title">ESP8266 with power isolation circuit board</b> <div class="spoiler_text"><p>  Implementing a power isolation with ESP8266 on a single board failed due to limitations on the size of the case. </p><br><p>  Presented boards are compatible for ESP8266 12F and 12E: </p><br><p>  ESP8266 itself relies on this board: </p><br><img src="https://habrastorage.org/files/87e/b9d/d6f/87eb9dd6f9994b0bafc22cf499ff0e7f.jpg"><br><p>  A decoupling of power, and firmware occurs here: </p><br><img src="https://habrastorage.org/files/25c/729/7fd/25c7297fd010424888743f38fafbf902.jpg"><br><p>  It will take 5 pieces of 10k ohms and 1 piece 470 ohms 0.125 W SMD resistors and 0.1 mkF SMD condenser. <br>  At 6 contacts there are two holes, one for the incoming wire from the Esp8266 board, and the other for the outgoing wire to the board for the RJ45 socket (used for firmware). </p><br><p>  PS: The connection "locking on programmator wires" is closed in firmware mode, for example, to make a jumper in the cable with an RJ45 connector. </p><br><p>  RJ45 socket board: </p><br><img src="https://habrastorage.org/files/4ba/b10/06b/4bab1006b3db4cb1be59ad704dbf81d4.jpg"><br><p>  Everything will turn out compact. </p></div></div><br><div class="spoiler">  <b class="spoiler_title">ESP8266 Power</b> <div class="spoiler_text"><p>  For power supply, it is easiest to use Chinese USB charging for a phone similar to charging for an iPhone. </p><br><img src="https://habrastorage.org/files/221/828/627/221828627c764b2c84b395a20ba037b4.jpg"><br><p>  Only the red highlighted zener diode (Zener diode) will be replaced.  In USB charging at 5 volts, there is a 5 volt zener diode.  To power the ESP8266, you need 3.3 Volts, and a 3.3 Volt zener diode with a power of more than 1 Watt, with a margin judging by the consumption (3.3 Volts, &lt;300 mA). </p><br><img src="https://habrastorage.org/files/a8b/912/7ce/a8b9127cef4f4a28bf6d9d5c962d74ef.jpg"><br><p>  Next, solder the USB connector and solder to + and -. </p></div></div><br><div class="spoiler">  <b class="spoiler_title">220 volt control board</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/999/c99/7bc/999c997bc71148b0872f503847ae509f.jpg"><br><p>  It will take: </p><br><ul><li>  1 pieces 500k ohms and 1 piece 470 ohms, 1 piece 200 ohms 0.125 W SMD resistors; </li><li>  1 Triac </li><li>  1 Opto-pair, MOC3052 </li><li>  two pairs of terminals for clamping 220 volt wires </li></ul></div></div><br><div class="spoiler">  <b class="spoiler_title">Isolation of wires between the boards in Sprint-Layout</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/6ac/fb5/e2b/6acfb5e2b2ed4b0fa85013ee13fccb1c.jpg"><br><p>  The file is available for download along with other resources. </p></div></div><br><div class="spoiler">  <b class="spoiler_title">Firmware</b> <div class="spoiler_text"><p>  Scripts are <a href="https://github.com/vadimostanin/WiFi-switcher">here.</a> <br>  I used: </p><br><ul><li>  NodeMcu - needed for running lua scripts </li></ul><br><blockquote>  You can get it here <a href="https://nodemcu-build.com/">https://nodemcu-build.com/</a> with enduser setup, file, gpio, net, node, rtc-time, sntp, timer, uart, wifi packages. <br>  sudo python esptool.py --port / dev / ttyUSB0 write_flash 0x00000 The_Path_To_The_NodeMCU_Firmware.bin </blockquote><br><ul><li>  Esplorer - to download lua scripts, html, js, css, and other files on ESP8266 <br><blockquote>  <a href="https://esp8266.ru/esplorer/">https://esp8266.ru/esplorer/</a> &gt; <br></blockquote></li></ul><br><p>  To optimize the memory so that the ESP8266 memory, which is not enough, was not spent on compilation, after uploading files to ESP8266, you need to compile <em>.lua files (except init.lua) into</em> .lc directly to ESP8266 via Esplorer. </p><br><blockquote>  node.compile ("actionsprocess.lua") <br>  node.compile ("constants.lua") <br>  node.compile ("espgetstatehtml.lua") <br>  node.compile ("estbehaviour.lua") <br>  node.compile ("httpfilesender.lua") <br>  node.compile ("httpsend.lua") <br>  node.compile ("httpsender.lua") <br>  node.compile ("schedulermanager.lua") </blockquote></div></div><br><div class="spoiler">  <b class="spoiler_title">Control panel</b> <div class="spoiler_text"><p>  I got this </p><br><img src="https://habrastorage.org/files/675/663/42f/67566342f2794ce7a56662248d00b01b.jpg"><br><p>  The button switches the ESP8266 to the creation mode of its access point in the ‚ÄúOff‚Äù position (to indicate the user Access Point and password to the user access point), and the On / Off state is operational. </p><br><p>  LED - lit when the "Off" button (ESP8266 is in the mode of creating its own access point); </p><br><ul><li>  flashes when the On button and ESP8266 are in the process of connecting; </li><li>  It does not light when the On button is on, and ESP8266 is connected to the router. <br>  RJ45 socket - for firmware, or power supply via USB Uart adapter. </li></ul></div></div><br><div class="spoiler">  <b class="spoiler_title">Android</b> <div class="spoiler_text"><p>  Control of the outlet comes from the android phone.  <a href="https://github.com/vadimostanin/WiFi-switcher/tree/master/RemoteDeviceFinder">WiFi Switcher Git-Hub</a> <br><img src="https://habrastorage.org/files/89a/7b9/b2d/89a7b9b2dbb54c8fb8ee5a3ade6b88fe.jpeg"><img src="https://habrastorage.org/files/d22/00d/025/d2200d0251844973a82e2b90a50083c4.jpeg"><img src="https://habrastorage.org/files/aae/4e6/e87/aae4e6e8707a4bea85d75ed360a5684d.jpeg"></p></div></div><br><div class="spoiler">  <b class="spoiler_title">Outlet scanning process</b> <div class="spoiler_text"><p>  When the socket and the phone are connected to the router, the android phone sends UDP broadcasts to the router on port 33248, open on the socket.  She answers it, sends her Id and Type. </p></div></div><br><div class="spoiler">  <b class="spoiler_title">Download Resources</b> <div class="spoiler_text"><p>  <a href="https://github.com/vadimostanin/WiFi-switcher">WiFi Switcher Git-Hub</a> <br>  Sprint-Layout Boards - <a href="">https://github.com/vadimostanin/WiFi-switcher/blob/master/ESP_control.lay6</a> </p></div></div><br><div class="spoiler">  <b class="spoiler_title">Final product</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/dae/5b2/fd8/dae5b2fd85154146bf14ac76f24912e5.jpg"><br><img src="https://habrastorage.org/files/099/4ed/997/0994ed99710f4177b7b3f5878c06cd6d.jpg"><br><img src="https://habrastorage.org/files/37b/84e/38b/37b84e38b8fc41bd9f047cd0e835032a.jpg"><br><img src="https://habrastorage.org/files/f85/7d5/19b/f857d519b6aa4031911d51c793a79386.jpg"></div></div><br><p>  <strong>Links</strong> </p><br><p> ‚Üí <a href="https://esp8266.ru/esp8266-podkluchenie-obnovlenie-proshivki/">ESP8266 - connection and firmware upgrade</a> <br>  ‚Üí <a href="http://lua-users.org/wiki/">Lua programming language information</a> <br>  ‚Üí <a href="https://nodemcu.readthedocs.io/en/master/en/flash/">Flashing the NodeMCU firmware</a> <br>  ‚Üí <a href="http://www.getchip.net/posts/034-luzhenie-pechatnojj-platy-splavom-roze/">Rosa tinning of the PCB</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/370093/">https://habr.com/ru/post/370093/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../370083/index.html">Underwater GPS from scratch for the year</a></li>
<li><a href="../370085/index.html">Blokchain forces to reconsider the approach to interbank transactions</a></li>
<li><a href="../370087/index.html">How the brain decides what is important and what is not</a></li>
<li><a href="../370089/index.html">Mathematical models help to remove the threat from networks</a></li>
<li><a href="../370091/index.html">Portable Selfie Drones: A Review of Hover Camera Passport from Madrobots</a></li>
<li><a href="../370095/index.html">We investigate and partially analyze cheap Chinese laptops with a diagonal of 13.3 ": you can already live</a></li>
<li><a href="../370097/index.html">How to pay for one client 3 times and not even know about it: Practical case "Audiomania"</a></li>
<li><a href="../370099/index.html">Yahoo! deal delayed due to investigation of company server hacks</a></li>
<li><a href="../370101/index.html">How it works: Audio content in social networks</a></li>
<li><a href="../370105/index.html">Legendary amplifiers - historical ‚Äúanatomy‚Äù of trends: reflections on quality, prices and trends</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>