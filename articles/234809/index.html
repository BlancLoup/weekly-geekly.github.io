<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Instagram "coming down from the clouds" Amazon to Facebook data centers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No matter how many reasons exist to move applications from ordinary data centers to cloud ones, there are at least some reasons to do the opposite. An...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Instagram "coming down from the clouds" Amazon to Facebook data centers</h1><div class="post__text post__text-html js-mediator-article">  No matter how many reasons exist to move applications from ordinary data centers to cloud ones, there are at least some reasons to do the opposite.  An illustrative example of this transfer was the recent transfer of Instagram servers from the Amazon public cloud service to Facebook data centers. <br><br><img src="https://habrastorage.org/files/690/4e3/6d8/6904e36d8b504ce79a7d98599a2b756d.jpg"><a name="habracut"></a><br><br>  To carry out such an operation, Instagram engineers had to think hard, using a non-standard approach in overcoming unexpected difficulties.  This work of theirs is a reminder that placing capacity in the cloud remains a rather difficult task, both for providers and for manufacturers of equipment for the data center. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Facebook founder and CEO Mark Zuckerberg noted that Instagram had the opportunity to appreciate the benefits of engineering solutions and the Facebook infrastructure in 2012 after acquiring an online photo-hosting service from the Internet giant. <br><br><h4>  Not as easy as it first seemed </h4><br>  The team decided to move in order to facilitate integration with Facebook systems and in order to use the entire Facebook infrastructure created by engineers to manage their large-scale server capacity.  After implementing these actions, the engineering team found several points of contact with the Facebook infrastructure, which provided even more opportunities for product development and increased security. <br><br><img src="https://habrastorage.org/files/f15/321/56c/f1532156c25b43948db24e93c6cd0595.bmp"><br><br>  The migration project was not as simple as it was first expected.  ‚ÄúAt first, moving seemed simple: set up a secure network between the Amazon Elastic Compute Cloud (EC2) and Facebook data center and gradually move services in parts,‚Äù said Instagram engineers Rick Branson, Pedro Kahuati and Nick Shotway in a <a href="http://instagram-engineering.tumblr.com/">blog</a> . <br><br><h4>  First tried to move to a closed cloud Amazon </h4><br>  However, they quickly realized that it was not as easy as it seemed at first.  The main problem was the conflict of IP addresses of Facebook and EC2.  The solution was the initial migration to Amazon's Virtual Private Cloud (VPC) and only then to the Facebook data center using Amazon Direct Connect. <br><br><img src="https://habrastorage.org/files/6a6/bb7/d16/6a6bb7d162a84839a9ceeaa2f478675e.jpg"><br><br>  Direct Connect is a service offered by Amazon in the data center, which is essentially the link between user services and public cloud services.  Primarily aimed at enterprises, it was created in order to circumvent the Internet public, maintain productivity and ensure security.  ‚ÄúAmazon's VPC is flexible enough to avoid conflicts with the Facebook network being buried!‚Äù Said the engineers. <br><br><h4>  EC2 is not very "friendly" with VCP Amazon </h4><br>  However, moving applications from a cloud infrastructure to a private cloud is also not as easy as it seems at first.  Instagram has thousands of processes a day.  To reduce the risk of failure and facilitate these processes as much as possible, the team needs EC2 and VPC cloud services at the same time ‚Äî and that‚Äôs the problem. <br><br>  ‚ÄúAWS does not provide the ability to exchange security groups, nor overlap the closed EC2 and VPC networks,‚Äù they write.  "The only way to interact between two closed networks is to create a public address space."  Python and Zookeeper wrote a special application for handling dynamic IP addresses, called Neti, which provided a secure group activity and a separate address for each specific request. <br><br>  Thus, after three weeks, a move was made, called the fastest of its kind.  The stack was ready for placement at a new location - in Facebook data centers. <br><br><h4>  Linux containers made custom tools portable </h4><br>  This stage of the process was more complicated, since  The Instagram team wanted to retain all management tools created for production systems hosted on the EC2.  For this, Chef configurators and a tool called Fabric were used to perform various functions - from hosting applications to promoting databases. <br><br><img src="https://habrastorage.org/files/8f5/ee1/6bd/8f5ee16bdd39478d8a68281584ce8176.jpg"><br><br>  To put the tools in a well-tuned Linux-based Facebook environment, the team placed all the backup tools in Linux-containers (LXC), which is exactly the way they are hosted on Facebook's native servers now.  ‚ÄúFacebook's backup tools are used to create the base structure, and Chef inside containers installs and configures specific Instagram software,‚Äù the Instagram team reported. <br><br><h4>  Migration is experience </h4><br>  Such a project can not pass without the need to explore one or two innovations, and the Instagram team also had to deal with this.  Here are just a few of the new ideas: <br><ul><li>  try almost no effect on the environment to be introduced; </li><li>  apply such "crazy" ideas like the Neti application that simplify the work; </li><li>  create your own applications to avoid surprises; </li><li>  use familiar concepts and processes to make work as easy as possible. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/234809/">https://habr.com/ru/post/234809/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../234791/index.html">We are testing a new type of backup MySQL</a></li>
<li><a href="../234795/index.html">Seagate launches 8TB HDD</a></li>
<li><a href="../234797/index.html">What is worth remembering when choosing a cloud for backup</a></li>
<li><a href="../234803/index.html">Your anonymous publications in Secret are not anonymous.</a></li>
<li><a href="../234807/index.html">The spacecraft "New Horizons" orbited Neptune: Pluto is getting closer</a></li>
<li><a href="../234813/index.html">Show Sound # 15 - Podcast about audio equipment, components, formats and technologies</a></li>
<li><a href="../234819/index.html">To wash or not to wash? Foursquare for clean drivers</a></li>
<li><a href="../234821/index.html">Transformation of smartphones, or is it convenient to call on the tablet</a></li>
<li><a href="../234823/index.html">My experience of teaching children 8-10 years of programming on Scratch</a></li>
<li><a href="../234825/index.html">Nice to meet you. Custom</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>