<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Adding Designer Parameters to the MXML Flex Compiler</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="April 26, 2007. Adobe makes a statement that the Flex Framework is being translated to open source. This news caused a storm of applause among the fla...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Adding Designer Parameters to the MXML Flex Compiler</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/olpictures/ac8/a4f/154/ac8a4f1548e1393f7f22e8c9f97f98a3.jpg" align="left">  April 26, 2007.  Adobe makes a statement that the Flex Framework is being translated to open source.  This news caused a storm of applause among the flashers of the whole world, that <s>fundamentally</s> new frameworks based on it will appear, but this did not go beyond a couple of projects. <br><br>  At that time I did projects using Flex, and the more projects became, the more I did not like some of the nuances of its internal structure. <br>  I think everyone who has worked with Flex knows its problems, as well as the poor quality of the code already written and generated from MXML, so I decided to intervene in this process in order to clean up the order and understand the Flex compiler device, and I started by adding ‚Äúsugar‚Äù to MXML, trying to make it as strong as possible in the spirit of the other features of Adobe‚Äôs brainchild.  Two years later, I decided to share my knowledge with you. <br><a name="habracut"></a><br><h4>  Foreword </h4><br>  I will not give a description of the process of checking out the FlexSDK project from the SVN repository, just leave a link to the <a href="http://opensource.adobe.com/wiki/display/flexsdk/Get%2BSource%2BCode">description of this process.</a> <br><br>  At the time of this writing, the latest version was Flex 4.5.1 (4.5.1.21328), so it's worth it to build on it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      When I first started to dig the compiler, I didn‚Äôt have enough knowledge of Java, so I had to be guided by common sense, all the changes were made in Notepad ++. <br>  I also advise you to use your favorite Java IDE, because without <s>blackjack and whores</s> ‚ÄúGoto Declaration‚Äù and ‚ÄúFind Usages‚Äù was very, very hard. <br><br><h4>  What's inside </h4><br>  Unfortunately, one article is not enough to cover the device of the entire compiler, so in this article I will tell only about a small part of it - the MXML translator. <br>  All sources related to it are in the modules / compiler / src / java / flex2 / compiler / mxml folder: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a20/be6/9c1/a20be69c15802b72e2713e6fb1691f2a.png"><br><br><ul><li>  the analyzer package, oddly enough, is responsible for analyzing parsed XML in the form of Tokens, the SyntaxAnalyzer attracts the most attention.  At this stage, no code generation occurs, only an analysis of the resulting model from MXML; </li><li>  The builder package is the most interesting for us (in the framework of this article), it contains a set of Builders that convert the received Tokens to the AS3 object model.  The diagram shows the components of the package: <br><img src="https://habrastorage.org/getpro/habr/post_images/01d/f82/86e/01df8286eb24c1d0afd369267fbb422f.png"><br>  In short: <br><ol><li>  <a href="">AbstractBuilder</a> - the base class for all others, contains the logic for generating an object from the resulting Token; </li><li>  <a href="">XMLListBuilder</a> , <a href="">XMLBuilder</a> , <a href="">ArrayBuilder</a> , <a href="">VectorBuilder</a> - builders for classes of the same name AS3; </li><li>  <a href="">InlineComponentBuilder</a> processes ‚Äúcomponents within components‚Äù, i.e.  those that are formed when writing &lt;fx: Component&gt; &lt;/ fx: Component&gt;; </li><li>  <a href="">PrimitiveBuilder</a> is responsible for language primitives, such as String, Number, int, uint, Boolean; </li><li>  <a href="">ModelBuilder</a> , <a href="">AnonymousObjectGraphBuilder</a> and <a href="">ServiceRequestBuilder</a> allow you to create an object from &lt;fx: Model /&gt; and the like; </li><li>  <a href="">ComponentBuilder</a> is an extremely important class because  it contains the logic to create an object from any MXML tag that does not fit into the above categories.  Used by us most often, because  it is he who creates the object from constructions of the form &lt;s: Button /&gt;, &lt;s: List /&gt;, &lt;someNamespace: SomeObject /&gt;; </li><li>  <a href="">DocumentBuilder</a> is a root tag, like, for example, &lt;s: Application /&gt;, or any other; </li><li>  <a href="">HTTPServiceBuilder</a> , <a href="">RemoteObjectBuilder</a> and <a href="">WebServiceBuilder</a> - the builders of the corresponding tags; </li></ol></li><li>  The dom package contains Node declarations for each of the common MXML tag types.  To whom it is interesting, I post a <a href="">picture with a visual representation of the</a> package <a href="">structure</a> ; </li><li>  The gen package contains velocity patterns for AS3 code generation + helper classes for this.  It is used only in case of specifying -keep-generated-actionscript, otherwise it is generated immediately in AbstractSyntaxTree; </li><li>  The lang package contains constants that relate to the specifics of the language, as well as handlers for attributes, binders, and other things.  I advise you to pay attention to StandardDefs; </li><li>  The reflect package contains the Reflection APIs and the TypeTable class with a private implementation of each of them; </li><li>  The rep package is the initializers for each node in the MXML document.  Structure: <br><img src="https://habrastorage.org/getpro/habr/post_images/496/147/ac3/496147ac3dbbdfe3635cdb88334fd2e6.png"></li></ul><br><br><h4>  From theory to practice! </h4><br>  I myself did not expect so much ‚Äútheory‚Äù to turn out, but it will greatly help you understand where, what and why.  And now let's go straight to what it was all about - the ability to specify constructor parameters for MXML objects. <br><br>  Many classes in AS3 have the required constructor parameters, because of which these classes have to be wrapped into objects without parameters, or created from in the &lt;fx: Script /&gt; tag, which also violates our usual MXML view, so I suggest making this implementation : <br><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">s:Application</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:fx</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://ns.adobe.com/mxml/2009"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:s</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"library://ns.adobe.com/flex/spark"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fx:Declarations</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Timer</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"flash.utils.*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">new</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1000, 1"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fx:Declarations</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">s:Application</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  The choice of the <em>new</em> keyword is due to the fact that in AS3 we can never create a property named new, since  it is reserved.  What is passed to new will be inserted into parentheses when initializing our object, in this case, <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Timer(<span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre> <br><br><h5>  Pass validation </h5><br>  To validator missed our new attribute, we must add it to the same (for example, includeIn, excludeFrom, and so on).  A text search showed that this attribute is first declared in lang / StandardDefs.java, and then checked in builder / ComponentBuilder.java (isSpecialAttribute method) <br><br>  add to StandardDefs <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String PROP_NEW = <span class="hljs-string"><span class="hljs-string">"new"</span></span>;</code> </pre> <br>  after 310 lines: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String PROP_ID = <span class="hljs-string"><span class="hljs-string">"id"</span></span>;</code> </pre> <br><br>  As well as in ComponentBuilder (isSpecialAttribute method) <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (namespace.length() == <span class="hljs-number"><span class="hljs-number">0</span></span> || namespace.equals(document.getLanguageNamespace())) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (StandardDefs.PROP_ID.equals(localPart) || StandardDefs.PROP_NEW.equals(localPart) || StandardDefs.PROP_INCLUDE_STATES.equals(localPart) || StandardDefs.PROP_EXCLUDE_STATES.equals(localPart) || StandardDefs.PROP_ITEM_CREATION_POLICY.equals(localPart) || StandardDefs.PROP_ITEM_DESTRUCTION_POLICY.equals(localPart)) { isSpecial = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } }</code> </pre><br>  Now the validator does not swear at the MXML tags <em>new</em> attribute. <br><br><h5>  We register a new property with an object model. </h5><br>  So, our attribute has a place to be, but do we need to save its value somewhere?  For this we have Model.java. <br>  Create in rep / Model.java getter / setters for the constructor parameters, adding a property and two methods to the class: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> String constructorParams; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setConstructorParams</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String value)</span></span></span><span class="hljs-function"> </span></span>{ constructorParams = value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getConstructorParams</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> constructorParams; }</code> </pre><br><br>  We will use this property in the registerBodel method (Node node, Model model, boolean topLevel) of AbstractBuilder.java class (line 1617): <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">registerModel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Node node, Model model, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> topLevel)</span></span></span><span class="hljs-function"> </span></span>{ String id = (String)getLanguageAttributeValue(node, StandardDefs.PROP_ID); String newValue = (String)getLanguageAttributeValue(node, StandardDefs.PROP_NEW); <span class="hljs-comment"><span class="hljs-comment">// get the comment from the node and store in the model if(node.comment != null) { // if generate ast if false, lets not scan the tokens here because they will be scanned later in asc scanner. // we will go the velocity template route if(!mxmlConfiguration.getGenerateAbstractSyntaxTree()) { model.comment = node.comment; } else { model.comment = MxmlCommentUtil.commentToXmlComment(node.comment); } } if(newValue != null) { model.setConstructorParams(newValue); } registerModel(id, model, topLevel); }</span></span></code> </pre><br><br><h5>  We use the attribute in code generation </h5><br>  The smallest part remains - to add our attribute to the place where the object is created, passing it to AS IS in the brackets of the constructor.  Said - done! <br><br>  The class rep / init / ValueInitializer.java, the getDefinitionBody () method, immediately after the Adobe TODO on line 467: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">// TODO confirm the availability of a 0-arg ctor!! but do it upstream from here, like when Model is built stringBuilder.append("new " + selfTypeName + "("); if(self.getConstructorParams() != null) { stringBuilder.append(self.getConstructorParams()); } stringBuilder.append(")"); }</span></span></code> </pre><br><br><h5>  Compilation </h5><br>  Now, going to the console in the root folder of the framework (trunk, if you downloaded the entire repository), it remains to run the build project, for which we enter (you must have ant): <br><pre> <code class="bash hljs">BSiDeUp-Mac-mini:trunk bsideup$ ant build</code> </pre> <br>  You can go and make yourself a coffee / put dry crackers / lean back on the chair (underline the necessary), because  The process will take about 5 minutes. <br>  <em>(Hint: after the 1st build it will be possible to run only ant compiler, then only the compiler module will be built)</em> <br><br>  After waiting for something like this: <br><pre> <code class="hljs pgsql"> main: [echo] ant main target completed <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-number"><span class="hljs-number">09</span></span>/<span class="hljs-number"><span class="hljs-number">16</span></span>/<span class="hljs-number"><span class="hljs-number">2011</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">54</span></span>:<span class="hljs-number"><span class="hljs-number">25</span></span> AM BUILD SUCCESSFUL Total <span class="hljs-type"><span class="hljs-type">time</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span> minutes <span class="hljs-number"><span class="hljs-number">33</span></span> seconds</code> </pre><br>  We rejoice and rejoice, otherwise - we re-read the manual of the person and look for what we have missed. <br><br><h4>  Conclusion </h4><br>  Now you can confidently specify our framework as the Flex Framework Location in your favorite IDE, thereby starting to use a modified compiler that supports the new attribute! <br><br>  This time we made a backward-compatible change that allows you to compile other projects using MXML without problems, and in the next article, if the topic is interesting, I will tell you how to change the standard behavior of MXML, making the programmer‚Äôs life even easier, but losing backward compatibility. <br><br>  For those who are interested in the result, not the process, I provide a link to the ready-made <a href="">mxmlc.jar</a> file, just download the Flex SDK 4.5 and replace it with the file $ {FLEX_SDK_DIR} /lib/mxmlc.jar. <br><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/128703/">https://habr.com/ru/post/128703/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../128696/index.html">Problems of creating an educational social network</a></li>
<li><a href="../128697/index.html">Pirate party won 9% of the vote in the elections in Berlin</a></li>
<li><a href="../128698/index.html">Debian 6 + LAMP local server from testing</a></li>
<li><a href="../128699/index.html">Mail.Ru Agent in the browser: approaches to state synchronization</a></li>
<li><a href="../128701/index.html">Internet on the ship: satellite dish + modems + balancer + Wi-Fi</a></li>
<li><a href="../128704/index.html">Genetic algorithm. Just about the difficult</a></li>
<li><a href="../128705/index.html">Jquery-ui inside a binary</a></li>
<li><a href="../128706/index.html">Using synonyms in SEO: bundles, holes, underpages</a></li>
<li><a href="../128707/index.html">Console application PassKeep</a></li>
<li><a href="../128709/index.html">Another implementation of the field "city" for Django</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>