<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a CNC machine from parts available with minimum plumbing work</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue to review the activities of our Hackspace Club . 

 We have long dreamed of buying a machine in our CNC club. But they decided to do it th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a CNC machine from parts available with minimum plumbing work</h1><div class="post__text post__text-html js-mediator-article">  We continue to review the activities of our <a href="http://vk.com/club71815206">Hackspace Club</a> . <br><br>  We have long dreamed of buying a machine in our CNC club.  But they decided to do it themselves.  From scratch, starting from hardware and ending with software (controller firmware and control program).  And we did it. <br><br>  Parts for the machine tried to choose from the commercially available ones, many of which do not even require additional plumbing treatment. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/9f4/a67/4c7/9f4a674c7b954aa8a7071171f5f9e926.jpg"><br><a name="habracut"></a><br>  The controller, we chose the Arduino Mega 2560 and that not to think a lot, the driver for the stepping motors used RAMPS 1.4 (like in the RepRap 3D printer). <br><br><img src="https://habrastorage.org/files/a67/e7f/4ab/a67e7f4ab631490d9e4ea18835f15936.jpg"><br><br>  The program of the controller was written using the algorithm of the state machine method.  The last time I heard about him about 20 years ago at the institute, I don‚Äôt remember what subject I studied.  It was a very good idea.  The code turned out to be small and easily expandable without loss of readability (if in the future you need not only the XYZ axis, or use another G-code).  The controller's program receives the G-code from the USB port and, in fact, gives the command to the XYZ axes' engines to move in a given direction.  Who does not know, the G-code is a sequence of structures of the type G1X10Y20Z10, which tells the machine to move along the X axis by 10 mm, Y by 20 mm and Z by 10 mm.  In fact, in the G-code there are many different constructions (for example, G90 - the absolute coordinate system is used, G91 is relative) and many modifications of the code itself.  On the Internet, a lot has been described about him. <br><br>  I will dwell on the description of the sketch (controller firmware). <br><br>  First, in the description of the variables, we prescribe what kind of controller output will be connected to the motors and limit switches. <br><br>  In this code of the state machine method, the variable takes the value of waiting for the first byte from the USB port, in the second case construction the data availability is checked and the variable _s takes the value get_cmd.  Ie read the data from the port. <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>(_s){ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> begin_cmd: Serial.println(<span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//038 //to_begin_coord(); n_t=0; _s=wait_first_byte; len=0; break; case wait_first_byte: if(Serial.available()){ Serial.print("&gt;"); _s=get_cmd; c_i=0; } break;</span></span></code> </pre> <br>  Then we read everything that is in the port, the _s variable is set to get_tag;  those.  go to the reception of the literal value of the G - code. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> get_cmd: c=Serial.read(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(c!=<span class="hljs-number"><span class="hljs-number">-1</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(c==<span class="hljs-string"><span class="hljs-string">'~'</span></span>){ _s=get_tag; c_i=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">n_t</span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } Serial.print(c); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>((c&gt;=<span class="hljs-number"><span class="hljs-number">97</span></span>)&amp;&amp;(c&lt;=<span class="hljs-number"><span class="hljs-number">122</span></span>)) c-=<span class="hljs-number"><span class="hljs-number">32</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( (c==<span class="hljs-number"><span class="hljs-number">32</span></span>)||(c==<span class="hljs-number"><span class="hljs-number">45</span></span>)||(c==<span class="hljs-number"><span class="hljs-number">46</span></span>)||((c&gt;=<span class="hljs-number"><span class="hljs-number">48</span></span>)&amp;&amp;(c&lt;=<span class="hljs-number"><span class="hljs-number">57</span></span>))||((c&gt;=<span class="hljs-number"><span class="hljs-number">65</span></span>)&amp;&amp;(c&lt;=<span class="hljs-number"><span class="hljs-number">90</span></span>)) ){ cmd[c_i++]=c; len++; } } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;</code> </pre><br><br>  Well, and so on. <br><br><div class="spoiler">  <b class="spoiler_title">full code can be found here.</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Stepper.h&gt; #define STEPS 48 //#define SHAG 3.298701 #define STEP_MOTOR 1 double koefx = 1.333333; double koefy = 1.694915; Stepper stepper0(STEPS, 5, 4, 6, 3); Stepper stepper1(STEPS, 8, 9, 10, 11); Stepper stepper2(STEPS, 13, 12, 7, 2); int x,y,x1,m; int motor; int inPinX = 15; //    22 int inPinY = 14; //    23 int inPinZ = 24; //    24 int x_en = 62; int x_dir = 48; int x_step = 46; int y_en = 56; int y_dir = 61; int y_step = 60; const int begin_cmd=1; const int wait_first_byte=2; const int wait_cmd=3; const int get_cmd=4; const int test_cmd=5; const int get_word=6; const int get_tag=7; const int get_val=8; const int compilation_cmd=9; const int run_cmd=10; int abs_coord=1; const int _X=1; const int _Y=2; //const int =10; //const int =11; //const int =12; int _s=begin_cmd; const int max_len_cmd=500; char cmd[max_len_cmd]; char tag[100][20]; char val[100][20]; int n_t=0; int c_i=0; char c; int i,j; int amount_G=0; int len=0; char*trash; int n_run_cmd=0; int g_cmd_prev; //ya   G class _g_cmd{ public: _g_cmd(){ reset(); } int n; //ya int g; double x; double y; double z; void reset(void){ n=g=x=y=z=99999; } }; double _x,_y,_z; double cur_abs_x,cur_abs_y,cur_abs_z; //ya stoyalo int int f_abs_coord=1; _g_cmd g_cmd[100]; void setup() { stepper0.setSpeed(150); stepper1.setSpeed(150); stepper2.setSpeed(1000); Serial.begin(9600); pinMode(inPinX, INPUT); pinMode(inPinY, INPUT); pinMode(inPinZ, INPUT); pinMode(x_en, OUTPUT); pinMode(x_dir, OUTPUT); pinMode(x_step, OUTPUT); pinMode(y_en, OUTPUT); pinMode(y_dir, OUTPUT); pinMode(y_step, OUTPUT); digitalWrite(x_en, 1); digitalWrite(y_en, 1); to_begin_coord(); //UNIimpstep(12,13,2,7,3,1000); //UNIimpstep(12,13,2,7,3,-1000); } void to_begin_coord(void) { impstep(_X,-10000,1); impstep(_Y,-10000,1); cur_abs_x=cur_abs_y=cur_abs_z=0; } void loop() { switch(_s){ case begin_cmd: Serial.println("&amp;"); //038 //to_begin_coord(); n_t=0; _s=wait_first_byte; len=0; break; case wait_first_byte: if(Serial.available()){ Serial.print("&gt;"); _s=get_cmd; c_i=0; } break; case get_cmd: c=Serial.read(); if(c!=-1){ if(c=='~'){ _s=get_tag; c_i=0; n_t=0; break; } Serial.print(c); if((c&gt;=97)&amp;&amp;(c&lt;=122)) c-=32; if( (c==32)||(c==45)||(c==46)||((c&gt;=48)&amp;&amp;(c&lt;=57))||((c&gt;=65)&amp;&amp;(c&lt;=90)) ){ cmd[c_i++]=c; len++; } } break; case get_tag: while((c_i&lt;len)&amp;&amp;(cmd[c_i]&lt;=32)) c_i++; i=0; while((c_i&lt;len)&amp;&amp;(cmd[c_i]&gt;=65)){ tag[n_t][i]=cmd[c_i]; i++; c_i++; while((c_i&lt;len)&amp;&amp;(cmd[c_i]&lt;=32)) c_i++; } if(i==0){ Serial.println("er2 cmd - 'no tag'"); _s=begin_cmd; break; } tag[n_t][i]=0; _s=get_val; break; case get_val: while((c_i&lt;len)&amp;&amp;(cmd[c_i]&lt;=32)) c_i++; i=0; while((c_i&lt;len)&amp;&amp; ( (cmd[c_i]=='.')||(cmd[c_i]=='-')||((cmd[c_i]&gt;=48)&amp;&amp;(cmd[c_i]&lt;=57)) ) ){ val[n_t][i]=cmd[c_i]; i++; c_i++; while((c_i&lt;len)&amp;&amp;(cmd[c_i]&lt;=32)) c_i++; } if(i==0){ Serial.println("er3 cmd - 'no val'"); _s=begin_cmd; break; } val[n_t][i]=0; n_t++; _s=get_tag; if(c_i&gt;=len) _s=compilation_cmd; break; case compilation_cmd: Serial.println(""); Serial.print("compilation cmd,input ("); Serial.print(n_t); Serial.println("): "); for(i=0;i&lt;n_t;i++){ Serial.print(i); Serial.print("="); Serial.print(tag[i]); Serial.print("("); Serial.print(val[i]); Serial.println(")"); } for (int k=0; k&lt;=j; k++) { g_cmd[k].reset(); } j=0; i=0; while(i&lt;n_t){ if(tag[i][0]=='N'){ g_cmd[j].n=(int)strtod(val[i],&amp;trash); i++; while((i&lt;n_t)&amp;&amp;(tag[i][0]!='N')){ //(g_cmd[j].g==1)&amp;&amp; if(tag[i][0]=='G'){ g_cmd[j].g=(int)strtod(val[i],&amp;trash); g_cmd_prev = g_cmd[j].g; } else { g_cmd[j].g = g_cmd_prev; } if(tag[i][0]=='X') g_cmd[j].x=(double)strtod(val[i],&amp;trash); if(tag[i][0]=='Y') g_cmd[j].y=(double)strtod(val[i],&amp;trash); if(tag[i][0]=='Z') g_cmd[j].z=(double)strtod(val[i],&amp;trash); i++; }//while((i&lt;n_t)&amp;&amp;(tag[i]!="G")) j++; }//if(tag[i]=="G") else i++; }//while(i&lt;n_t) amount_G=j; Serial.print("compilation cmd,output ("); Serial.print(amount_G); Serial.println("): "); for(j=0;j&lt;amount_G;j++){ Serial.print(j); Serial.print("="); Serial.print("N");Serial.print(g_cmd[j].n);Serial.print(" "); Serial.print("G");Serial.print(g_cmd[j].g);Serial.print(" "); Serial.print("X");Serial.print(g_cmd[j].x);Serial.print(" "); Serial.print("Y");Serial.print(g_cmd[j].y);Serial.print(" "); Serial.print("Z");Serial.print(g_cmd[j].z);Serial.println(" "); } n_run_cmd=0; _s=run_cmd; break; case run_cmd: Serial.print("run cmd ["); Serial.print("N");Serial.print(g_cmd[n_run_cmd].n);Serial.print(" "); Serial.print("G");Serial.print(g_cmd[n_run_cmd].g);Serial.print(" "); Serial.print("X");Serial.print(g_cmd[n_run_cmd].x);Serial.print(" "); Serial.print("Y");Serial.print(g_cmd[n_run_cmd].y);Serial.print(" "); Serial.print("Z");Serial.print(g_cmd[n_run_cmd].z);Serial.print(" "); Serial.println("]"); int f_cmd_coord=0; if(g_cmd[n_run_cmd].g==90){ f_abs_coord=1; f_cmd_coord=1; Serial.println("change to ABS coord"); } if(g_cmd[n_run_cmd].g==91){ f_abs_coord=0; f_cmd_coord=1; Serial.println("change to REL coord"); } Serial.print("cur_abs(");Serial.print(cur_abs_x);Serial.print(",");Serial.print(cur_abs_y);Serial.print(",");Serial.print(cur_abs_z);Serial.println(")"); if(f_cmd_coord){if(++n_run_cmd&gt;=amount_G) _s=begin_cmd; break;} if(f_abs_coord){ Serial.println("zdes kosjak G90 ABS"); if (g_cmd[n_run_cmd].x==99999) _x=0; else _x=g_cmd[n_run_cmd].x-cur_abs_x; if (g_cmd[n_run_cmd].y==99999) _y=0; else _y=g_cmd[n_run_cmd].y-cur_abs_y; if (g_cmd[n_run_cmd].z==99999) _z=0; else _z=g_cmd[n_run_cmd].z-cur_abs_z; }else{ Serial.println("normalno G91 REL"); _x=g_cmd[n_run_cmd].x; _y=g_cmd[n_run_cmd].y; _z=g_cmd[n_run_cmd].z; } if((_x==0)&amp;&amp;(_y==0)&amp;&amp;(_z==0)){ Serial.println("exit: _x=0,_y=0,_z=0"); if(++n_run_cmd&gt;=amount_G) _s=begin_cmd; break; } // _x=_x*koefx; // _y=_y*koefy; //_z=_z*koef; double max_l=abs(_x); //ya if(abs(_y)&gt;max_l) max_l=abs(_y); if(abs(_z)&gt;max_l) max_l=abs(_z); double unit_scale=90; // steps in 1.0 double unit_len=max_l*unit_scale,unit_step; double px=0,py=0,pz=0,x=0,y=0,z=0,kx,ky,kz; int all_x_steps=0,all_y_steps=0,all_z_steps=0; kx=_x/unit_len; ky=_y/unit_len; kz=_z/unit_len; // Serial.print("unit_len - "); Serial.print(unit_len); Serial.print(" _x- "); Serial.print(_x); Serial.print(" max_l- "); Serial.println(max_l); // Serial.print("kx=");Serial.print(kx);Serial.print(" ky=");Serial.print(ky);Serial.print(" kz=");Serial.println(kz); if((kx==0)&amp;&amp;(ky==0)&amp;&amp;(kz==0)){if(++n_run_cmd&gt;=amount_G) _s=begin_cmd; break;} for(unit_step=0;unit_step&lt;unit_len;unit_step++){ if((abs(x-px)*unit_scale)&gt;=1){ impstep(_X,STEP_MOTOR*kx/abs(kx),1); //stepper0.step(STEP_MOTOR*kx/abs(kx)); //Serial.print("x_step ");Serial.println(kx/abs(kx)); all_x_steps++; px=x; } if((abs(y-py)*unit_scale)&gt;=1){ impstep(_Y,STEP_MOTOR*ky/abs(ky),1); //stepper1.step(STEP_MOTOR*ky/abs(ky)); //Serial.print("y_step ");Serial.println(ky/abs(ky)); all_y_steps++; py=y; } if((abs(z-pz)*unit_scale)&gt;=1){ UNIimpstep(12,13,2,7,3,10*kz/abs(kz)); //stepper2.step(STEP_MOTOR*kz/abs(kz)); //Serial.print("z_step ");Serial.println(kz/abs(kz)); all_z_steps++; pz=z; } x+=kx; y+=ky; z+=kz; // Serial.print(unit_step);Serial.print(" : "); // Serial.print(x);Serial.print(" | ");Serial.print(y);Serial.print(" | ");Serial.println(z); } Serial.println("-----------------------------------------"); Serial.print("all_steps(");Serial.print(all_x_steps);Serial.print(",");Serial.print(all_y_steps);Serial.print(",");Serial.print(all_z_steps);Serial.print(")"); cur_abs_x+=_x; cur_abs_y+=_y; cur_abs_z+=_z; Serial.print("cur_abs(");Serial.print(cur_abs_x);Serial.print(",");Serial.print(cur_abs_y);Serial.print(",");Serial.print(cur_abs_z);Serial.println(")"); Serial.println("-----------------------------------------"); if(++n_run_cmd&gt;=amount_G) _s=begin_cmd; }//switch(_s) } char end_button(int coord) { int but=0; if(coord==_X) but=digitalRead(inPinX); if(coord==_Y) but=digitalRead(inPinY); if(but){ if(coord==_X) Serial.println("[ X out of range ]"); if(coord==_Y) Serial.println("[ Y out of range ]"); } return but; } char impstep(int coord,int kol,int f_test_coord) { int IN_en,IN_dir,IN_step,pause; pause=2; //35 switch(coord){ case _X: IN_en=x_en; IN_dir=x_dir; IN_step=x_step; digitalWrite(IN_en, 0); break; case _Y: IN_en=y_en; IN_dir=y_dir; IN_step=y_step; digitalWrite(IN_en, 0); break; } if(!f_test_coord) Serial.println("[ break step ]"); //delay(100); if (kol&lt;0) for (int i=0; i&lt;=abs(kol); i++){ if(f_test_coord&amp;&amp;end_button(coord)){ impstep(coord,200,0); return 0; } digitalWrite(IN_dir, LOW); digitalWrite(IN_step, HIGH); delay(pause); digitalWrite(IN_step, LOW); delay(pause); }else for (int i=0; i &lt;= kol; i++){ if(f_test_coord&amp;&amp;end_button(coord)){ impstep(coord,200,0); return 0; } digitalWrite(IN_dir, HIGH); digitalWrite(IN_step, HIGH); delay(pause); digitalWrite(IN_step, LOW); delay(pause); } digitalWrite(IN_en, 1); return 1; } void UNIimpstep(int IN1,int IN2,int IN3,int IN4,int pause,int kol) { //delay(100); if (kol&lt;0) for (int i=0; i&lt;=abs(kol); i++){ digitalWrite(IN1, 0); digitalWrite(IN2, 1); digitalWrite(IN3, 0); digitalWrite(IN4, 0); delay(pause); digitalWrite(IN1, 1); digitalWrite(IN2, 0); digitalWrite(IN3, 0); digitalWrite(IN4, 0); delay(pause); digitalWrite(IN1, 0); digitalWrite(IN2, 0); digitalWrite(IN3, 0); digitalWrite(IN4, 1); delay(pause); digitalWrite(IN1, 0); digitalWrite(IN2, 0); digitalWrite(IN3, 1); digitalWrite(IN4, 0); delay(pause); } else for (int i=0; i &lt;= kol; i++){ digitalWrite(IN1, 1); digitalWrite(IN2, 0); digitalWrite(IN3, 0); digitalWrite(IN4, 0); delay(pause); digitalWrite(IN1, 0); digitalWrite(IN2, 1); digitalWrite(IN3, 0); digitalWrite(IN4, 0); delay(pause); digitalWrite(IN1, 0); digitalWrite(IN2, 0); digitalWrite(IN3, 1); digitalWrite(IN4, 0); delay(pause); digitalWrite(IN1, 0); digitalWrite(IN2, 0); digitalWrite(IN3, 0); digitalWrite(IN4, 1); delay(pause); } }</span></span></span></span></code> </pre><br></div></div><br><br>  The state machine finishes with the case run_cmd construction: where the control signal to the engine itself is given.  Engine management could use the library #include &lt;Stepper.h&gt; but we wrote our function (char impstep - for a bipolar engine, void UNIimpstep - unipolar), so that we could not wait until one engine runs, to send a signal to another.  Well, for the future, a separate procedure will allow more flexible use of the capabilities of a stepper motor.  For example, if we use another engine driver, programmatically set the half-step or engine pitch.  In the current version with RAMPS, 1/16 steps are obtained.  If anyone is interested, you can write a separate article for hours about controlling stepper motors. <br><br>  Now a little about iron. <br><br><img src="//habrastorage.org/files/300/8d9/2b2/3008d92b2e324a50b699f4e7ee290251.jpg"><br><br>  The engines used 17HS8401, the most powerful of the NEMA17 that could be found on ebay.  They also bought bearings and optical limit switches. <br><br><img src="//habrastorage.org/files/33e/0f0/b1c/33e0f0b1cc914bb5b3907976dcd93f81.jpg"><br>  Everything else is domestic, native.  The original idea with the guides, made them from long chrome handles for furniture, they are just 12 mm in diameter for bearings, they are up to a meter in length, and strength is quite enough.  At the ends of the handles, drill holes and tap into threads.  This allowed just a bolt to securely connect the guides with the bearing structure.  For the Z axis, in general, the handle was attached to the whole structural plate; The shaft is sold in any hardware store as a stud with a thread of any diameter.  We used on 8 mm.  Accordingly, the nuts 8 mm.  The nut with the bearing and the bearing structure of the Y axis was connected using a connecting bracket.  Staples bought in a specialized store for shop windows.  You‚Äôve probably seen such chrome constructions in the stores that have ties or shirts hanging on them, so these brackets are used to connect chrome tubes.  The engine was connected to the shaft with a coupling, which was made from a piece of steel bar with a diameter of 14mm, drilled a hole in the center and a pair of holes on the side, for clamping with screws.  You can not bother and buy ready on ebay on request cnc coupling their heap falls out.  Bearing constructive we cut down the guillotine for 1000 p.  The assembly of all this took not much time and got such a machine at the exit, there are no limit switches in the photo yet, the controller and the cutter motor are not installed. <br><br><img src="//habrastorage.org/files/f2a/760/dd2/f2a760dd23804862b0d3a172374cef5a.jpg"><br><br>  Accuracy turned out just amazing, firstly a stepper motor strides 1/16 of a step, secondly a shaft with a fine thread.  When a pen was inserted into the machine instead of a milling cutter, he drew a complex figure, then looked around the figure several more times, and in the figure you could see it was as if he drew once, looked at a magnifying glass trying to find another line.  The rigidity of the machine is also good.  Reeling only in bearings within the allowable limits of their own tolerance and fit.  A little still reeling along the Y axis, well, here I think the constructive Z axis needs to be improved. <br><br>  The photo turned out not quality, in the background the glass reflects.  I do not know what kind of designer I am, but I‚Äôm just a photographer.  Here's a little better. <br><br><img src="//habrastorage.org/files/ceb/dba/753/cebdba753c1e431d9c0122c6f42d91c7.jpg"><br><br>  Now about the control program.  I do not remember why, but we decided to make our program, which transmits the ready G-code from the computer to the controller.  Maybe they just did not find a suitable one. <br><br>  The program is written in Microsoft Visual C ++, the following libraries were used: <br><br>  Module: SERIALPORT.H <br>  Purpose: Declaration for an MFC wrapper class for serial ports <br>  Copyright 1999 by PJ Naughter.  All rights reserved. <br>  The program is still raw, well, in a nutshell we use <br><pre> <code class="cpp hljs">port.Open(<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">9600</span></span>, CSerialPort::NoParity, <span class="hljs-number"><span class="hljs-number">8</span></span>, CSerialPort::OneStopBit, CSerialPort::XonXoffFlowControl);    port.Write(text, l); -    port.Read(sRxBuf, LEN_BUF); -  .</code> </pre><br><br>  Another standard component, the msflexgrid table, was used, in which the G-code currently being executed is entered in real time.  Those.  This program simply opens the ready G-code and in small portions pushes it into the controller. <br><br>  The source code of the control program can be viewed here <a href="">github.com/konstantin1970/cnc.git</a> <br>  To understand, I‚Äôll add that standard windows hyperterminal or putty does the same thing, stuffs the data into the controller. <br>  The G-code itself can be done in any CAD / CAM system, for example, I liked ARTCAM. <br><br>  We have plans to make a more powerful machine on NEMA 23 engines, but for this you need to think of what to do with more powerful guides.  In the controller firmware add the ability to change the speed of rotation of the spindle.  It is especially interesting for us to install a camera and make something like a vision system, so that the machine itself determines the dimensions of the workpiece, calculates the initial coordinate of the workpiece along all axes in the program minimum.  In the program, the maximum that the machine could control all stages of its work with the help of the camera, perhaps even made decisions to change the program.  Well, for example, he saw that the roughness was more than acceptable, he took and sent the mill on the second circle to grind everything at a higher speed. <br><br>  Hopefully, we will be able to continue to share our developments with you, respected hack readers. </div><p>Source: <a href="https://habr.com/ru/post/250385/">https://habr.com/ru/post/250385/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../250373/index.html">As we explained to the children, who is a programmer?</a></li>
<li><a href="../250375/index.html">The book about the design on the FPGA (in Ukrainian)</a></li>
<li><a href="../250379/index.html">VkPlaylistServer - add music from VK to almost any audio player</a></li>
<li><a href="../250381/index.html">Metro.Prosto scheme</a></li>
<li><a href="../250383/index.html">Lock-free data structures. Concurrent map: warm up</a></li>
<li><a href="../250387/index.html">Beeline: people's control (you can mark a technical problem on the map)</a></li>
<li><a href="../250389/index.html">Server insurance company refactoring: when there is less physical space than data</a></li>
<li><a href="../250391/index.html">Toaster. Collective editing of questions</a></li>
<li><a href="../250393/index.html">Vibration API: who needs it and why?</a></li>
<li><a href="../250399/index.html">146% on Kickstarter: was it easy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>