<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to beat Excluded Constraints with RubyGem</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="During the development of iOS / OSX applications, you certainly have to use Interface Builder and Auto Layout. In applications with complex interfaces...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to beat Excluded Constraints with RubyGem</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/05d/5c6/575/05d5c65757ce4927b6185f55a18ae81c.png"><br><br>  During the development of iOS / OSX applications, you certainly have to use Interface Builder and Auto Layout.  In applications with complex interfaces and in applications that have been in development for a long time, there is often a problem with a large number of ‚Äúexcluded constraints‚Äù.  Storyboard loads unreasonably long, and during the transition between scenes, you can catch up with coffee. <br><br>  But, it would seem, the interface of all controllers is just as uncomplicated as in the release six months ago.  What happened?  For those who have used Size Classes, it‚Äôs immediately clear that the interface is not as simple as it seems.  It behaves differently in different orientations and on different displays.  He does this because some constraints apply only in a certain situation. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This means that in other situations these constraints are not used.  Xcode Interface Builder has a feature that helps in the development of complex interfaces and interferes with the development of simple ones.  If you add constraint to some UIView and then remove it from the Xcode Inspector (and most often it is the most convenient way), Xcode will not remove it, but will only add it to the list of unused ones in case it is needed for another display or orientation. <br><br>  Sometimes, if you expand all constraints groups, you can be terrified of what is happening in the storyboard file: <br><img src="https://habrastorage.org/files/f80/e9f/409/f80e9f4093b34467ac72263ceac02297.png"><br><br>  Do not want to watch this?  Welcome under the cut! <br><a name="habracut"></a><br>  More than half of the constraints are in the ‚Äúbasket‚Äù and wait until they are added to a specific display or orientation or deleted.  Until then, precious seconds of downloading the file and the remaining nerve cells of the developer are being eaten. <br><br>  What to do? <br>  You can open all your storyboard- and xib-files in turn, open all UIView heirs in them and, making sure that this constraint is not used for Size Classes, remove them using the Document Outline <br><br>  And you can provide this boring, not having the right to make a mistake work smart Ruby-script.  So, we need to find all the storyboard and xib files in the project: <br><pre><code class="ruby hljs"><span class="hljs-string"><span class="hljs-string">``</span></span><span class="hljs-string"><span class="hljs-string">` files = Dir.glob("**/*.{storyboard,xib}") files.each{ |file| cleanupConstraints(file)} `</span></span><span class="hljs-string"><span class="hljs-string">``</span></span></code> </pre> <br><br>  Done, now in these files you need to find the excluded constraints: <br><br><pre> <code class="ruby hljs"><span class="hljs-string"><span class="hljs-string">``</span></span><span class="hljs-string"><span class="hljs-string">` require 'nokogiri' def cleanupConstraints(file) f = File.open(file) doc = Nokogiri::XML(f) f.close excluded = doc.xpath('//exclude') end `</span></span><span class="hljs-string"><span class="hljs-string">``</span></span></code> </pre><br><br>  You also need to not forget about the Size Classes and leave all the constraints on the ground, which are included in at least one display / orientation combination. <br><pre> <code class="ruby hljs"><span class="hljs-string"><span class="hljs-string">``</span></span><span class="hljs-string"><span class="hljs-string">` require 'nokogiri' def cleanupConstraints(file) f = File.open(file) doc = Nokogiri::XML(f) f.close excluded = doc.xpath('//exclude') included = doc.xpath('//include') result = [] excluded.each do |node| found = false for includedNode in included if node.attr('reference') == includedNode.attr('reference') found = true break end end if !found result.push(node) nodeID = node.attr('reference') constraints = doc.xpath("//constraint[@id='</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{nodeID}</span></span></span><span class="hljs-string">']") result += constraints end end if result.count &gt; 0 f1 = File.open(file, 'w') result.each{ |node| node.remove } f1.write(doc.to_xml) f1.close p "removed </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{result.count}</span></span></span><span class="hljs-string"> constraint(s) from </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{file}</span></span></span><span class="hljs-string">" end end `</span></span><span class="hljs-string"><span class="hljs-string">``</span></span></code> </pre><br><br>  Small win, but how to use this script?  The answer is simple - create a RubyGem. <br><br>  There are several ways to create a <a href="http://guides.rubygems.org/make-your-own-gem/">gem</a> , I used the <a href="http://guides.rubygems.org/make-your-own-gem/">guides.rubygems.org/make-your-own-gem</a> described here. <br><br>  Now you can clear the project (or even all projects at once!) By installing Gem <br><pre> <code class="ruby hljs"><span class="hljs-string"><span class="hljs-string">``</span></span><span class="hljs-string"><span class="hljs-string">` $ gem install constraintClean `</span></span><span class="hljs-string"><span class="hljs-string">``</span></span></code> </pre><br>  In the directory of your project (or in the directory with all your projects) by executing <br><pre> <code class="ruby hljs"><span class="hljs-string"><span class="hljs-string">``</span></span><span class="hljs-string"><span class="hljs-string">` $ constraintClean `</span></span><span class="hljs-string"><span class="hljs-string">``</span></span></code> </pre><br>  And it is beautiful! <br><br>  <a href="https://github.com/kohtenko/KOConstraintClean">github.com/kohtenko/KOConstraintClean</a> </div><p>Source: <a href="https://habr.com/ru/post/262179/">https://habr.com/ru/post/262179/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../262167/index.html">Android WebView: actual problems and their solutions</a></li>
<li><a href="../262169/index.html">Consulo: Running Java code on the .NET platform using IKVM.NET</a></li>
<li><a href="../262173/index.html">Build-Deploy-Test. Continuous integration</a></li>
<li><a href="../262175/index.html">Real-time data processing in AWS Cloud. Part 1</a></li>
<li><a href="../262177/index.html">Web file manager with integrated chickenpox</a></li>
<li><a href="../262181/index.html">Using potential fields in real-time strategy scenarios</a></li>
<li><a href="../262183/index.html">React on ES6 +</a></li>
<li><a href="../262185/index.html">The history of routing in the project MAPS.ME</a></li>
<li><a href="../262187/index.html">Creating a new field type for MS SharePoint using the example of a simple check field</a></li>
<li><a href="../262189/index.html">Malevich</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>