<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>NULL project</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I don’t know about you, but I usually have a fever and complete prostration in my thoughts when I need to write something from scratch. In my head var...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">🔎</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">📜</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">⬆️</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">⬇️</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>NULL project</h1><div class="post__text post__text-html js-mediator-article">  I don’t know about you, but I usually have a fever and complete prostration in my thoughts when I need to write something from scratch.  In my head various abstract models are already flying, from what and where.  But you can’t grasp for any of them, because you’ve got a clean sheet and pulled one thought out of my head, there’s nothing to apply it to, and you’re not able to pull out the whole skeleton because you are already thinking about solving the problem, but you still need write the backbone of the application. <br><br>  Below is the “NULL project”, the very backbone with which everything usually begins.  I have. <br><br>  This post most likely will not be of interest to those who are already experienced and those who are not directly involved in C ++ development, since  The material presented below carries one single goal - to give a ready-made foundation to begin with. <br><a name="habracut"></a><br><h1>  Requirements </h1><br>  I will try to highlight for the beginning a number of requirements that it would be nice to implement in this core <br><ol><li>  Project folder </li><li>  CMake build scripts and scripts for generating solyushinov </li><li>  start and stop scripts </li><li>  the application should start, work and exit correctly, the whole process should be logged </li><li>  you can log in to the console, anyway, each project has its own logger, the main thing is that it would be easy to replace. </li><li>  the application should parse the command line </li><li>  the application should be able to parse the configuration file of the form key = value </li><li>  project without boost?  no, have not heard.  So immediately integrate boost </li><li>  error processing.  Since this is only the backbone and here, in fact, there is no performance, then we do on exceptions. </li><li>  <s>do the world capture function</s> </li></ol><br><h1>  Project folder </h1><br><pre><code class="bash hljs">. ├── CMakeLists.txt ├── gen_eclipse.sh ├── include │  ├── logger.h │  ├── mediator.h │  ├── pid.h │  ├── program_options.h │  ├── thread.h │  └── version.h ├── package.sh ├── src │  ├── logger.cpp │  ├── main.cpp │  ├── mediator.cpp │  ├── pid.cpp │  ├── program_options.cpp │  └── version.cpp ├── start.sh ├── stop.sh └── version.sh</code> </pre> <br><h1>  Solyushinov generator </h1><br>  The goal of the gen_eclipse.sh script is to prepare a folder structure and call cmake to generate debug and release solos.  And also set the current version of the project.  It so happened that I usually develop on Linux systems in the Eclipse environment, hence the name gen_eclipse.  But I did not succeed in fully fostering Cmake and Eclipse.  In order to open a generated project in Eclipse, you need to import an existing MAKE project, with either release or debug, and add links to the include and src directories via the context menu. <br><div class="spoiler">  <b class="spoiler_title">gen_eclipse.sh</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-meta"><span class="hljs-meta">#!/bin/bash ROOT_DIR=$PWD BUILD_DIR=$PWD/"build" BUILD_DIR_R=$BUILD_DIR/release BUILD_DIR_D=$BUILD_DIR/debug mkdir -p $BUILD_DIR mkdir -p $BUILD_DIR_R mkdir -p $BUILD_DIR_D if [ -d $BUILD_DIR_R ]; then if [ -f $BUILD_DIR_R/CMakeCache.txt ]; then rm $BUILD_DIR_R/CMakeCache.txt fi fi if [ -d $BUILD_DIR_D ]; then if [ -f $BUILD_DIR_D/CMakeCache.txt ]; then rm $BUILD_DIR_D/CMakeCache.txt fi fi echo "[[ Generate Release solution]]" cd $BUILD_DIR_R cmake -G "Eclipse CDT4 - Unix Makefiles" -DCMAKE_BUILD_TYPE:STRING="Release" --build $BUILD_DIR_R ../../ echo echo "[[ Generate Debug solution]]" cd $BUILD_DIR_D cmake -G "Eclipse CDT4 - Unix Makefiles" -DCMAKE_BUILD_TYPE:STRING="Debug" --build $BUILD_DIR_D ../../ cd $ROOT_DIR ./version.sh</span></span></code> </pre><br></div></div><br><h1>  Version </h1><br>  The first thing to note is that I use Subversion and rely on revision numbers as versions.  I usually stick to the following version format: MAJOR.MINOR.REVISION.  The first two values ​​are given by pens, the third is the svn revision.  As far as I know, the subversion client cannot return just the revision number, so I use the following mechanism <br><pre> <code class="bash hljs">REVISION=`LANG=C svn info | grep <span class="hljs-string"><span class="hljs-string">"Last Changed Rev:"</span></span> | sed s/<span class="hljs-string"><span class="hljs-string">"Last Changed Rev"</span></span>:\ //` <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [[ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$REVISION</span></span></span><span class="hljs-string">"</span></span> == <span class="hljs-string"><span class="hljs-string">""</span></span> ]]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Cannot recognize number of revision"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> 1 <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> ... VER_CPP=src/version.cpp <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"#include \"version.h\""</span></span> &gt; <span class="hljs-variable"><span class="hljs-variable">$VER_CPP</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"const char* VERSION = \"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$VERSION</span></span></span><span class="hljs-string">\";"</span></span> &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">$VER_CPP</span></span></code> </pre><br><h1>  Startup, Stop Scripts </h1><br>  As a rule, all the software that had to be written under Linux was servers, large and small.  Their peculiarity is that they work in the background, these are services.  I know that for such things it is customary to have start and stop scripts in the init.d directory.  But!  I have not had a single case where only one version of the service would be started on one server.  Therefore, I adhere to the practice of start stop scripts with control on the PID file. <br><div class="spoiler">  <b class="spoiler_title">start.sh</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash source init.conf MAIN_LOG="$APP_LOG_DIR"/start.log echo "Start application '$APP_NAME'" if [ -f $APP_PID ]; then PID=`cat $APP_PID` if [ -z $PID ]; then echo "File '$APP_PID' exist but it's empty, delete it" rm $APP_PID elif ! ps h -p $PID &gt; /dev/null; then echo "File '$APP_PID' exist but process with pid '$PID' doesn't exist, delete it" rm $APP_PID else echo "$APP_NAME already started (file $APP_PID exist)" exit fi fi mkdir -p $APP_LOG_DIR if [ $APP_EXPORT_LIB_DIR ]; then export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$APP_EXPORT_LIB_DIR; fi echo =========================================== &gt;&gt; $MAIN_LOG date &gt;&gt; $MAIN_LOG if [ -f $APP_BIN ]; then ./$APP_BIN -l $APP_LOG_DIR -c $APP_CONF -p $APP_PID &gt;&gt; $MAIN_LOG &amp; else echo "Error: binary file '$APP_BIN' doesn't exist" exit 1 fi if [[ $? != 0 ]]; then echo "Not started" else echo "Started" fi</span></span></code> </pre><br></div></div><br>  The shutdown script has a much more sophisticated logic, for slow shutdown of the server. <br><div class="spoiler">  <b class="spoiler_title">stop.sh</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash source init.conf if [ ! -f $APP_PID ]; then echo "'$APP_NAME' not started (file $APP_PID doesn't exist)" exit fi PID=`cat $APP_PID` if ! ps h -p $PID &gt; /dev/null then echo "'$APP_NAME' not started, removing old $APP_PID file" rm $APP_PID exit fi if ! kill -s SIGTERM $PID then echo "Cannot stop process" exit fi for i in {1..10} do if ps h -p $PID &gt; /dev/null then echo -n . sleep 1 else echo "Stopped" exit fi done echo echo "Can't correctly stop application, finish him" kill -9 $PID rm $APP_PID</span></span></code> </pre><br></div></div><br>  Ps.  Thanks to my colleague Andrew for offering a more usable version of the stop.sh script <br><h1>  Package.sh </h1><br>  In each of the projects I have a script package.sh whose goal is to create an adequate installation package.  As a rule, this is an archived application folder with a set of files sufficient for the application to work.  The minimum set is the stop start scripts, the configuration file, the application itself, and the folder for logs. <br><div class="spoiler">  <b class="spoiler_title">package.sh</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash APP_NAME=projectnull VERSION=`./version.sh show` PACKAGE=$APP_NAME.$VERSION.tar.bz2 echo "Create instalation package of '$APP_NAME' ($PACKAGE)" TEMP_FOLDER=$APP_NAME FILES=( "build/release/projectnull" "start.sh" "stop.sh" "init.conf" "*.conf" ) LOG_DIR=logs if [ -d $TEMP_FOLDER ]; then rm -rf $TEMP_FOLDER fi mkdir $TEMP_FOLDER for i in "${FILES[@]}" do echo "copy '$i'" cp $i $TEMP_FOLDER done echo creat $LOG_DIR mkdir $TEMP_FOLDER/$LOG_DIR tar -cjf $PACKAGE $TEMP_FOLDER rm -rf $TEMP_FOLDER echo Finished</span></span></code> </pre><br></div></div><br><h1>  Functional </h1><br>  And so, what I usually need in order to proceed directly to programming: <br><ol><li>  Command Line Parameters </li><li>  configuration file </li><li>  A simple way to interact with the logger </li><li>  The ability to stop the application correctly </li></ol><br>  Let's start in order: <br><h2>  Command Line Parameters </h2><br>  I selected for myself three such parameters.  Now I will try to explain why they are. <br>  <b>Directory for logging.</b>  The reason why I do not store this parameter in the configuration file is that during the parsing of the configuration file errors that I want to log can happen.  Why a directory?  I'm used to the fact that each launch is a separate log file, thus, it is easier to delete old logs. <br>  <b>Configuration file</b> If not through the command line, how?  Especially if you have several configurations that you want to quickly switch. <br>  <b>PID file.</b>  The only reason why I do not store it in the configuration file is that this parameter is used in 2 places at once.  In start and stop scripts.  And it is much easier to put it into a separate init file, which is connected to start stop scripts, and edit it once, rather than two (I’m talking about the conf file). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Analysis of the command line and the configuration file is done by means of boost :: program_options <br><div class="spoiler">  <b class="spoiler_title">program_options.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> ProgramOptions::load(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> argc, <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* argv[]) { <span class="hljs-function"><span class="hljs-function">options_description </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">desc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Allowed options"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; desc.add_options() (<span class="hljs-string"><span class="hljs-string">"help,h"</span></span>, <span class="hljs-string"><span class="hljs-string">"produce help message"</span></span>) (<span class="hljs-string"><span class="hljs-string">"config,c"</span></span>, value&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;(&amp;conf_file)-&gt;default_value(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(CONF_FILE)), <span class="hljs-string"><span class="hljs-string">"set configuration file"</span></span>) (<span class="hljs-string"><span class="hljs-string">"logdir,l"</span></span>, value&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;(&amp;log_dir)-&gt;default_value(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(LOG_DIR)), <span class="hljs-string"><span class="hljs-string">"set log directory"</span></span>) (<span class="hljs-string"><span class="hljs-string">"pidfile,p"</span></span>, value&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;(&amp;pid_file)-&gt;default_value(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(PID_FILE)), <span class="hljs-string"><span class="hljs-string">"set pid file"</span></span>) ; variables_map vm; store(parse_command_line(argc, argv, desc), vm); notify(vm); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (vm.count(<span class="hljs-string"><span class="hljs-string">"help"</span></span>)) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; desc &lt;&lt; <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>); } <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Will be used the next options:"</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"CONF_FILE = "</span></span> &lt;&lt; conf_file &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"LOG_DIR = "</span></span> &lt;&lt; log_dir &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"PID_DIR = "</span></span> &lt;&lt; pid_file &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span> ; }</code> </pre><br></div></div><br>  Each parameter has default values. <br><blockquote>  ./projectnull -h <br>  Allowed options: <br>  -h [--help] produce help message <br>  -c [--config] arg (= project.conf) set configuration file <br>  -l [--logdir] arg (= logs) set log directory <br>  -p [--pidfile] arg (= project.pid) set pid file <br></blockquote><br><h2>  Logging </h2><br>  I did not begin to invent the logger, as a rule, in each firm it the.  In this project, I limited myself to outputting to the console, in the Note and Error modes.  The only requirement I place on the logger is that it must support an interface like printf.  Agree with me because printf is wonderful.  I just added macros for a convenient logging process. <br><div class="spoiler">  <b class="spoiler_title">logger.h</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ENTRY __PRETTY_FUNCTION__ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LOG_0(s) ; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LOG_1(s) Log::note(ENTRY, s) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LOG_2(s, p1) Log::note(ENTRY, s, p1) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LOG_3(s, p1, p2) Log::note(ENTRY, s, p1, p2) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LOG_4(s, p1, p2, p3) Log::note(ENTRY, s, p1, p2, p3) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LOG_5(s, p1, p2, p3, p4) Log::note(ENTRY, s, p1, p2, p3, p4) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LOG_X(x,s,p1,p2,p3,p4,FUNC, ...) FUNC #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LOG(...) LOG_X(,##__VA_ARGS__,\ LOG_5(__VA_ARGS__),\ LOG_4(__VA_ARGS__),\ LOG_3(__VA_ARGS__),\ LOG_2(__VA_ARGS__),\ LOG_1(__VA_ARGS__),\ LOG_0(__VA_ARGS__)\ )</span></span></code> </pre><br><pre> <code class="cpp hljs">LOG(<span class="hljs-string"><span class="hljs-string">"Appication started, version: %s (%s)"</span></span>, VERSION, BUILD_TYPE);</code> </pre><br>  Output: <br><blockquote>  [N] [int main (int, char **)] Appication started, version: 1.0.3 (RELEASE) </blockquote><br></div></div><br><h2>  Stop </h2><br>  In my opinion, the correct stop is one of the most important functions of the software which is often forgotten.  As a rule, to make a correct stop in an already developed software is an impossible task.  Another thing, if you stick to a certain strategy from the very beginning, then it becomes a trifle.  I do not consider all sorts of sophisticated ways to get a shutdown command over the network, via SMS or via satellite.  I just catch some signals, then initiate the procedure for a correct stop. <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Mediator::wait_exit() { LOG(<span class="hljs-string"><span class="hljs-string">"Set up waiting exit"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">sigset_t</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sig; sigemptyset(&amp;<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>); sigaddset(&amp;<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>, SIGINT); sigaddset(&amp;<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>, SIGQUIT); sigaddset(&amp;<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>, SIGTERM); sigaddset(&amp;<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>, SIGTSTP); sigprocmask(SIG_BLOCK, &amp;<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); sigwait(&amp;<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>, &amp;sig); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (sig) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SIGINT: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SIGQUIT: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SIGTERM: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SIGTSTP: LOG(<span class="hljs-string"><span class="hljs-string">"Catched signal to stopping application"</span></span>); stop(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }</code> </pre><br>  The only thing that is required is to call the wait_exit () function in the main thread, after performing all the active actions. <br><pre> <code class="cpp hljs"> LOG(<span class="hljs-string"><span class="hljs-string">"Appication started, version: %s (%s)"</span></span>, VERSION, BUILD_TYPE); { Mediator mediator; mediator.start(); mediator.wait_exit(); } LOG(<span class="hljs-string"><span class="hljs-string">"Applicatiom stopped"</span></span>);</code> </pre><br>  Thanks to <a href="https://habrahabr.ru/users/mejedi/" class="user_link">mejedi</a> for pointing out the incorrect use of a signal handler for these needs.  I hope I correctly interpreted (implemented) your proposal. <br><h2>  Application structure </h2><br>  So we got to the final part.  As it has already become clear to many, I use the “Mediator” pattern.  Of course, not in all its glory, because no business has logic yet. <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mediator</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Thread { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Mediator(); <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~Mediator(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wait_exit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load_app_configuration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create_pid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: Pid pid_; };</code> </pre><br>  If some work is supposed to be performed in a separate thread, then for such a task there should be a separate class inherited from the special class Thread. <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Thread</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{th_ = boost::thread(boost::bind(&amp;Thread::run, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>));} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{th_.interrupt(); th_.join();} <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~Thread(){} <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: boost::thread th_; };</code> </pre><br>  The purpose of which is to support the start and stop process in a single format. <br><h1>  Repository </h1><br>  The project is available in Google Code, but only for read-only.  It's not because I'm greedy, I just don't know how to open access for everyone.  If you wish to make changes, write your g-email, add you to the project. <br><pre> <code class="bash hljs">svn checkout http://project-null.googlecode.com/svn/trunk/ project-null-read-only</code> </pre><br><h1>  A couple of words... </h1><br>  The idea to arrange this development in a tangible pattern came to me about two months ago, in the process of the next project that needed to be installed quickly and from scratch.  During the writing of the project, I came to the conclusion that this is not the first time that I have a similar architecture, and that it makes no sense to remember all the pitfalls each time and come to the same solution that I used before, you need to arrange it as a template.  I suffered for a long time at the expense of writing this article, but remembering the parable about the teacher and a glass of water, I decided that they would better tell me that the article was not worth a penny than I would continue to think about its expediency. <br><br>  Thanks for attention. <br><br>  Ps.  Added various PID file checks at startup.  Cases are processed with a PID file - there is no process, the PID file is empty. </div><p>Source: <a href="https://habr.com/ru/post/158985/">https://habr.com/ru/post/158985/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../158973/index.html">Good Practice on setting up a small local network based on Active Directory</a></li>
<li><a href="../158975/index.html">Introduction to Pedestrian Modeling</a></li>
<li><a href="../158977/index.html">The digest of interesting news and materials from the world of PHP over the past two weeks, №4 (03.11.2012 - 16.11.2012)</a></li>
<li><a href="../158979/index.html">Experiment with kanban board or how to do everything</a></li>
<li><a href="../158983/index.html">Understanding shaders in Unity3D with a specific example</a></li>
<li><a href="../158987/index.html">Workflow in Mozilla when creating the Save for Later feature for Firefox</a></li>
<li><a href="../158991/index.html">VKontakte "I like" widget caches parameters</a></li>
<li><a href="../158995/index.html">The digest of interesting news and materials from the world of ayti for the last week №31 (November 10 - 16, 2012)</a></li>
<li><a href="../158997/index.html">3D printing and heart tissue biorobots</a></li>
<li><a href="../158999/index.html">The portal Opera redirected users to a malicious resource</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>