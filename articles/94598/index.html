<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Crossbrowser bookmarks for arbitrary page space</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 There are cases when the browser has to read a large text in several steps. This may be a novel, article or technical guide. Well, when...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Crossbrowser bookmarks for arbitrary page space</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  There are cases when the browser has to read a large text in several steps.  This may be a novel, article or technical guide.  Well, when the document is divided into chapters and equipped with easy navigation.  Then, interrupting the reading, you can create a temporary bookmark on the section page or on the anchor point in the document.  And if the text is solid?  Or links to internal sections are not provided?  Or are the sections themselves too large and it is difficult then to search for the necessary paragraph inside the section? <br><br>  One way out is to save the document to disk and read it with the help of any program that allows you to create internal bookmarks or to remember the place where the text was closed. <br><br>  But such multiplication of entities is not convenient for everyone.  Let's try to find a simpler way. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In order for this method to be universal, it is necessary to focus not on the structure of the document (it may not contain any tags at all except <code>body</code> and, maybe, <code>pre</code> ) and not on text content (there may be duplicate lines in the text or the document may be a collection of unsigned pictures).  It remains to focus on the most fragile - on the metric.  Namely - the distance scrolled from the beginning of the document (pages with horizontal scrolling are rare and while they can be neglected). <br><br>  There is an algorithm: we need to get the distance from the beginning of the document to the place of reading and save it somewhere, then to request to scroll the page to the desired section.  To do this, you need: a cross-browser way to determine the scroll distance, a cross-browser repository for the bookmark database and a cross-browser interface to save and restore positions in the document (the algorithm can also be used for server solutions, but we are still interested in the client side). <br><br>  The algorithm will have at least two minuses: binding to the size of the browser window (although users are unlikely to change this size often; in addition, <a href="http://habrahabr.ru/blogs/browsers/94598/">there is an idea</a> how to minimize this dependency) and support only static documents (use, for example, for the often changing friends page in LJ or for the news feed does not work). <br><br><h4>  1. Scroll definition </h4><br>  Since Internet Explorer does not support the <code>window.scrollY</code> and <code>window.pageYOffset</code> , we will use <code>element.scrollTop</code> .  Which element to take depends on the mode of the browser, that is, on the <code>doctype</code> page.  In the following mode (standards mode) you need to use <code>document.documentElement.scrollTop</code> , in the compatibility mode (quirks mode) - <code>document.body.scrollTop</code> .  Fortunately, we don‚Äôt need to check the mode: the <code>scrollTop</code> property of the wrongly selected element will always be zero during any scrolling, so you can simply iterate over both elements and save a nonzero value. <br><br><h4>  2. Bookmark Storage </h4><br>  The only cross-browser storage method that seems convenient is <a href="http://en.wikipedia.org/wiki/Web_Storage">Web Storage</a> technology.  It is supported by all the latest versions of popular browsers (Chrome 4+, Firefox 3.5+, Internet Explorer 8+, Opera 10.5+, Safari 4+).  Reluctantly say goodbye to the support of old versions.  The only drawback: not all browsers support this technology for local files.  Since the functions of the <code>localStorage</code> object create and request data in the database, focusing on page domains, and all local files (that is, pages loaded using the <code>file:///</code> protocol) do not have a domain, there is a difficulty with which not all browsers have coped until now .  Chrome, Opera and Safari support <code>localStorage</code> technology for offline documents, creating a common keystore for all local files.  Internet Explorer gives an error, not finding the <code>localStorage</code> object for documents without a domain.  Firefox is generally silent in a partisan manner and does nothing at the places where the functions are called (the bug is recorded <a href="https://bugzilla.mozilla.org/show_bug.cgi%3Fid%3D507361">here</a> and <a href="https://bugzilla.mozilla.org/show_bug.cgi%3Fid%3D357323">here</a> ).  Therefore, for the last two browsers, the only way is to read online or from the browser cache. <br><br>  For each page we are interested in, we will create in the database a unique key consisting of an arbitrary prefix and the full URL of the document.  So bookmarks will be automatically correlated with their objects and can be saved and requested by two miniature universal functions. <br><br><h4>  3. Interface </h4><br>  To date, there seems to be no general way to create extensions for all browsers.  Therefore, we still have an old proven path - <a href="http://ru.wikipedia.org/wiki/%25D0%2591%25D1%2583%25D0%25BA%25D0%25BC%25D0%25B0%25D1%2580%25D0%25BA%25D0%25BB%25D0%25B5%25D1%2582">bookmarklets</a> . <br><br><h4>  We connect components </h4><br>  Let's create a code for three functions: the first one will get the scroll distance and save it in the database, the second one will restore the page scrolling, the third one will delete the bookmark from the base (this is an optional increase). <br><br>  Scroll save code (create bookmark): <br><blockquote><pre>  localStorage ['bm_' + document.location.href] =
     document.documentElement.scrollTop ||  document.body.scrollTop; </pre></blockquote><br>  Scroll recovery code (go to tab): <br><blockquote><pre>  window.scrollTo (0, localStorage ['bm_' + document.location.href] || 0); </pre></blockquote><br>  Bookmark removal code: <br><blockquote><pre>  localStorage.removeItem ('bm_' + document.location.href); </pre></blockquote><br>  When we remove the spaces (we had to leave the pair, otherwise pieces of long lines disappear beyond the topic borders) and, following the rules, we wrap the code in anonymous functions that do not return values, we get the following bookmarklets: <br><br>  Scroll save code (create bookmark): <br><blockquote><pre>  javascript: (function () {localStorage ['bm _' + document.location.href] = document.documentElement.scrollTop || document.body.scrollTop}) () </pre></blockquote><br>  Scroll recovery code (go to tab): <br><blockquote><pre>  javascript: (function () {window.scrollTo (0, localStorage ['bm _' + document.location.href] || 0)})) () </pre></blockquote><br>  Bookmark removal code: <br><blockquote><pre>  javascript: (function () {localStorage.removeItem ('bm _' + document.location.href)}) () </pre></blockquote><br>  Unfortunately, Habrahabr filters do not allow inserting links with bookmarklet code: for security reasons, the name of the <code>javascript</code> protocol is substituted.  Therefore, it remains to create three bookmarks from scratch and enter the function code instead of the address. <br><br>  If it seems inconvenient to someone, you can drag the links <a href="http://www.dinkypage.com/72039">from here</a> (in Internet Explorer it is better to act through the context menu of the links, adding them to the desired Favorite folder, because dragging booklets does not always work). <br><br>  Of course, these rudiments of functions can be developed by means of each browser.  You can use GreaseMonkey or Custom Buttons for Firefox (or create a full extension), you can arrange the algorithm as a widget for Opera or an extension for Chrome.  You can adjust the automatic creation of bookmarks before closing for the desired pages and automatically go to the last position when they are opened.  You can add the current browser window metric to the name of the keys in the database so that your bookmarks are set for different sizes.  You can implement a server solution (fortunately, no server-side database is required, the price will be a few lines of code). <br><br>  We will consider this another illustration of the capabilities of the remarkable Web Storage technology. </div><p>Source: <a href="https://habr.com/ru/post/94598/">https://habr.com/ru/post/94598/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../94587/index.html">Welcome to Toshiba</a></li>
<li><a href="../94589/index.html">When enemies are all around</a></li>
<li><a href="../94590/index.html">Droidcon Conference 2010 Berlin</a></li>
<li><a href="../94594/index.html">HabraRate - an extension for the Habr's comment filter</a></li>
<li><a href="../94595/index.html">Use head</a></li>
<li><a href="../94606/index.html">IBM finally lost its leadership in the server market</a></li>
<li><a href="../94610/index.html">Electronic reader from Pandigital</a></li>
<li><a href="../94611/index.html">Scratchpad with mcabber in awesome WM</a></li>
<li><a href="../94617/index.html">On titanium oxide can make cheap laser disks up to 25 TB</a></li>
<li><a href="../94618/index.html">Mozilla-vlc-plugin for Windows in xpi format</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>