<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Disruption of a large-scale hacker attack on Windows users in Russia</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On March 6, Windows Defender blocked more than 80,000 copies of several sophisticated Trojans that used sophisticated methods of introducing malicious...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Disruption of a large-scale hacker attack on Windows users in Russia</h1><div class="post__text post__text-html js-mediator-article">  On March 6, Windows Defender blocked more than 80,000 copies of several sophisticated Trojans that used sophisticated methods of introducing malicious code into the address space of processes and equally sophisticated mechanisms for ensuring stability and evasion of detection.  It was possible to reveal a new wave of infection attempts thanks to signals from behavioral analysis systems in combination with cloud models of machine learning. <br><br>  <a href="https://habrahabr.ru/company/microsoft/blog/351692/">The second part with a detailed description of the attack and ways of infection.</a> <br><br><img src="https://habrastorage.org/webt/v6/3g/l6/v63gl6wbkzv37ujsll2hnyei8ha.jpeg"><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Trojans used in the attack were new versions of Dofoil (also known as Smoke Loader).  They tried to infect devices with malware for mining cryptocurrency.  In the next 12 hours, more than 400,000 cases of attack were recorded, of which 73% were in Russia, 18% in Turkey, and 4% in Ukraine. <br><br><img src="https://habrastorage.org/webt/lw/ox/mg/lwoxmglbx1d2e4iefdcofiuvw2o.png"><br><br>  <i>The geographical distribution of the components of the Dofoil attack.</i> <br><br>  At the very beginning of the attack with the help of behavioral monitoring, Windows Defender antivirus revealed an unusual mechanism of attack resistance and stability.  Anti-Virus immediately sent the appropriate signal to our cloud protection service. <br><br><ol><li>  Within a few milliseconds, numerous cloud-based metadata-based machine learning models already blocked the detected threat when it appeared. </li><li>  After another couple of seconds, our machine learning models based on sample and detonation analysis confirmed that the program was reasonably classified as malicious.  A few minutes later, models based on detonation were connected and additionally confirmed the conclusions of the previous mechanisms. </li><li>  A few minutes after the start of the attack, the anomaly detection service notified our specialists about a new potential outbreak of infection. </li><li>  After analyzing, the Microsoft incident response team assigned to the threats of this new wave a name that corresponds to the classification of malware families.  Thus, at the very beginning of the company, users received a warning about blocking this threat, in which it appeared under the names assigned by machine learning systems (for example, Fuery, Fuerboos, Cloxer or Azden).  Those who were blocked later saw the threat under the name of the malware family to which it belongs, that is, Dofoil or Coinminer. </li></ol><br>  Windows 10, Windows 8.1 and Windows 7 users with Windows Defender or Microsoft Security Essentials antivirus software are fully protected from this malware outbreak. <br><br><img src="https://habrastorage.org/webt/fs/om/1m/fsom1m-zismyj53ipr3nwlfd86g.png"><br><br>  <i>Multi-level protection system based on machine learning in the Windows Defender antivirus program</i> <br><br>  Artificial intelligence and the detection of threats based on behavioral analysis in Windows Defender form the basis of our protection system.  A preemptive defense mechanism based on artificial intelligence was applied against this attack.  This approach is similar to multi-level machine-based protection, which stopped the outbreak of an Emotet infection last month. <br><br><h2>  Code implementation and mining cryptocurrencies </h2><br>  Dofoil is the latest family of malware that uses crypto-mining software in its attacks.  The cost of bitcoin and other cryptocurrencies remains attractive, and attackers take advantage of the opening opportunities and embed mining components into attacks.  For example, modern exploit kits contain not extortion programs, but tools for mining cryptocurrency.  Mining scripts are being introduced into fraudulent technical support sites, and even mining functions are added to some of the banker Trojans. <br><br>  The starting point of the Dofoil campaign, which we discovered on March 6, was a Trojan that replaces the explorer.exe process.  Process substitution is a code injection method that creates a new instance of a genuine process (in this case, c: \ windows \ syswow64 \ explorer.exe) and replaces its code with a malicious one. <br><br><img src="https://habrastorage.org/webt/ab/rn/zq/abrnzq_zxurrkij8kjtz31q44ky.png"><br><br>  <i>Windows Defender ATP process replacement detection (SHA-256: d191ee5b20ec95fe65d6708cbb01a6ce72374b309c9bfb7462206a0c7e039f4d, found by Windows Defender antivirus under the name TrojanDownloader: Win32 / Dofoil.AB)</i> <br><br>  The bogus explorer.exe process then creates a second instance of the malicious code that runs the mining program that disguises as a safe Windows binary file, wuauclt.exe. <br><br><img src="https://habrastorage.org/webt/wh/8r/kq/wh8rkqdxvbxpwe6fq_3bxbsh1vm.png"><br><br>  <i>Detection of malware for mining cryptocurrency service Widows Defender ATP (SHA-256: 2b83c69cf32c5f8f43ec2895ec9ac730bf73e1b2f37e44a3cf8ce814fb51f120, detected by Windows Defender antivirus under the name Trojan for a challenge / challenge / challenge profile / wakew /.</i> <br><br>  Although the malware uses the name of a trusted Windows binary file, it runs from a different location.  The command line does not look the same as the source binary file.  In addition, suspicions are caused by network traffic from this binary file. <br><br><img src="https://habrastorage.org/webt/kh/2f/xv/kh2fxvlhssgxgwmbgu4q2egcojw.png"><br><br>  <i>Windows Defender ATP alert process tree: anomalous IP data exchange</i> <br><br><img src="https://habrastorage.org/webt/h7/-_/xe/h7-_xejff9celfkrxg25qqhv3qu.png"><br><br>  <i>Suspicious network activity displayed in the ATP service in Windows Defender</i> <br><br><img src="https://habrastorage.org/webt/ki/ps/aj/kipsajyp_sridvj8cokxqdbaerk.png"><br><br>  <i>Windows Defender ATP alert process tree: a bogus explorer.exe process that creates suspicious connections</i> <br><br>  Dofoil uses a specialized mining application.  Judging by the code, this application supports NiceHash, that is, it can conduct mining of different cryptocurrencies.  The samples we analyzed were used to mine the Electroneum cryptocurrency. <br><br><h2>  Resilience </h2><br>  Sustainability is an important feature of malware mining software.  Such programs use a variety of techniques to go unnoticed for a long time and to mine cryptocurrency using stolen computing resources. <br><br>  To avoid detection, Dofoil modifies the registry.  The mock explorer.exe process creates a copy of the original malware in the Roaming AppData folder and renames it to ditereah.exe.  It then creates a registry key or modifies an existing one to point to the newly created copy of the malware.  In the sample we analyzed, the OneDrive Run section was changed. <br><br><img src="https://habrastorage.org/webt/4m/vm/wj/4mvmwjl5z9wrh6gpjgvwrspmlqc.png"><br><img src="https://habrastorage.org/webt/lp/db/wk/lpdbwkz6w9ypm0qkd6jiudmdyuw.png"><br><br>  <i>Windows Defender ATP alert process tree: creating a new malicious process (SHA-256: d191ee5b20ec95fe65d6708cbb01a6ce72374b309c9bfb7462206a0c7e039f4d) and changing the registry</i> <br><br><h2>  Information exchange with management and control servers </h2><br>  Dofoil is a stable family of Trojan downloaders.  They connect to management and control servers (C &amp; C), from which they receive commands to download and install malware.  In a March 6 campaign, Dofoil Trojans used <a href="https://www.namecoin.org/">Namecoin's</a> decentralized network infrastructure to exchange information with management and control servers. <br><br>  The dummy process explorer.exe records and runs another binary file, D1C6.tmp.exe (SHA256: 5f3efdc65551edb0122ab2c40738c48b677b1058f7dfcdb86b05af42a2d8299c) in the Temp folder.  This file then creates and runs its copy under the name lyk.exe.  The running lyk.exe file connects to IP addresses that act as DNS proxy servers for the Namecoin network.  Then the file tries to contact the vinik.bit management and control server in the NameCoin infrastructure.  The management and control server instructs the malware to connect to the IP address or disconnect from it, download the file from a specific link, launch a specific file or interrupt its execution, or go into sleep mode for a while. <br><br><img src="https://habrastorage.org/webt/cw/tb/g0/cwtbg0wyk-_ktgx03kkf8hy7td0.png"><br><br>  <i>Windows Defender ATP alert process tree: creating a temporary file D1C6.tmp.exe (SHA256: 5f3efdc65551edb0122ab2c40738c48b677b1058f7dfcdb86b05af42a2d8299c)</i> <br><br><img src="https://habrastorage.org/webt/z2/gp/aw/z2gpawbdjfrdx4lu5gnlpamh0nw.png"><br><br>  <i>Alert process tree in Windows Defender ATP: connecting the lyk.exe file to IP addresses</i> <br><br><h2>  Real-time protection in Windows 10 </h2><br>  As the cost of cryptocurrency grows, groups of cybercriminals make more and more attacks in order to penetrate the network and imperceptible mining. <br><br>  <a href="https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/windows-defender-antivirus-in-windows-10%3Focid%3Dcx-blog-mmpc">Antivirus Windows Defender</a> uses a multi-level approach to security.  The use of threat detection algorithms based on behavior analysis, universal patterns and heuristic analysis, as well as machine learning models on client devices and in the cloud provides protection against real-time threats and epidemics. <br><br>  As seen in this case, the Windows Defender Advanced Threat Protection ( <a href="https://www.microsoft.com/ru-ru/WindowsForBusiness/windows-atp%3Focid%3Dcx-blog-mmpc">WDATP</a> ) service signals malicious behavior associated with software installation, code injection, resiliency mechanisms, and cryptocurrency mining operations.  Security services can use the extensive WDATP libraries to detect abnormal network activity and take necessary action.  WDATP also includes protection from the Windows Defender Antivirus, Windows Defender Exploit Guard, and Windows Defender Application Guard, simplifying security management. </div><p>Source: <a href="https://habr.com/ru/post/351356/">https://habr.com/ru/post/351356/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../351342/index.html">Coinbase cryptocurrency wallet owners are faced with double write-offs of fees due to the nature of Visa</a></li>
<li><a href="../351344/index.html">Conference DEFCON 16. "Games with bar codes." Felix Lindner, head of Recurity Labs</a></li>
<li><a href="../351350/index.html">Uploading messages using the Telegram API. Where to begin</a></li>
<li><a href="../351352/index.html">Online implementation of localStorage</a></li>
<li><a href="../351354/index.html">Optimize the performance of sound projects</a></li>
<li><a href="../351360/index.html">The art of exploiting minefields: We analyze CTF-task about the game of Minesweeper from "Mr. Robot"</a></li>
<li><a href="../351362/index.html">‚ÄúDigital States‚Äù: how they evolved</a></li>
<li><a href="../351364/index.html">The battle for network neutrality: two and a half years Net Neutrality</a></li>
<li><a href="../351366/index.html">Battle of Network Neutrality: A State War</a></li>
<li><a href="../351368/index.html">Network Digest: 20 materials on networks, protocols and the battle for Net Neutrality</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>