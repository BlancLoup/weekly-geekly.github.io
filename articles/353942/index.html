<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Modular development of Android applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When developing Android applications, there are times when certain parts of the code can be taken out as libraries so that you can reuse them in diffe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Modular development of Android applications</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/cm/-w/xa/cm-wxapt-bcpqqrespunpuh2wlq.png" alt="image"></p><br><p>  When developing Android applications, there are times when certain parts of the code can be taken out as libraries so that you can reuse them in different projects: </p><br><ul><li>  Modules in the project that are often found.  For example, custom View </li><li>  When the existing API is inconvenient or does not allow us to do what we have in mind, we create an extension for this API. </li></ul><br><p>  Most often, all problems were solved long before us, but in our case it was necessary to take out part of the business logic layer and virtually the entire layer responsible for the data in our 3 main products of the combined company <strong>Roof Roof Market</strong> .  All our products are <a href="https://ru.wiktionary.org/wiki/%25D0%25BA%25D0%25BB%25D0%25B0%25D1%2581%25D1%2581%25D0%25B8%25D1%2584%25D0%25B0%25D0%25B9%25D0%25B4">classified as</a> vehicles, real estate and other goods.  Therefore, we, the developers, decided to write one solution for all products of the company.  In addition, it facilitated our work. </p><a name="habracut"></a><br><h2 id="poprobovali-git-submodule">  Tried git submodule </h2><br><p>  The easiest solution is to use git submodule.  If you briefly explain his work, then to git repository you attach a link to another git repository, which should automatically be cloned with the parent.  It would seem simple: we have several git repository, where all our modular libraries are stored and you just need to specify it in the git submodule. </p><br><p>  But what about the versions?  When updating via the git submodule update command, the changes in the submodule are erased, merge does not occur.  You will have to be constantly updated when another developer makes a change in this submodule.  Instead, it‚Äôs worth developing modules as libraries with a jar file or Android Archive (aar).  In fact, these archives contain the same files that could be in the git submodule, but now there is a more understandable versioning instead of a commit or tag history. </p><br><h2 id="ostorozhno-ne-vse-mozhno-publikovat">  Caution, not all can be published. </h2><br><p>  When publishing libraries, it‚Äôs worth considering that they should not contain confidential company data.  Moreover, it will not be convenient for other developers if the library contains code relating to a specific company.  Therefore, we need a private artifactory for storing libraries in the closed access.  There are many open source solutions, but we use <a href="https://jfrog.com/article/private-repositories/">JFrog Artifactory</a> . </p><br><p>  And if you can publish?  In this case, you will find a bright road to the world of open source projects.  Simply find open web servers that support gradle so that hosted jar and aar files are pulled through dependency in your projects. </p><br><h2 id="itak-nachinaem-sozdavat-modul">  So, we begin to create a module </h2><br><p><img src="https://habrastorage.org/webt/al/b3/ce/alb3cefptzpk8otjkhxtamxikeg.png"><br><img src="https://habrastorage.org/webt/gl/z9/fb/glz9fbn2yton6wjc8fhbnik7dxa.png"><br>  It all starts easy - go to <code>File &gt; New &gt; New Module‚Ä¶</code> <br>  The name of the library that you specify in this window will become the name of your library's binaries. </p><br><p>  Having created a module, you can start writing code.  If you write tests with the attached code, the rest of the team will understand how to use your module.  Even better, create a new sample app module that works exclusively with your module for demonstration on real devices.  It is more convenient when you need to pre-test the code before publishing to an artifactory.  To do this, simply specify the dependency in <strong>build.gradle</strong> .  In the examples, I will specify <strong>librarymodule</strong> as the name of the module. </p><br><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta"># {module project}/sample-app dependencies { implementation project(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":librarymodule"</span></span></span><span class="hljs-meta">) }</span></span></code> </pre> <br><h2 id="nastraivaem-gradle-dlya-publikacii-v-artifactory">  Configuring gradle for publishing to artifactory </h2><br><p>  Take the build script from Chris Banes: <a href="https://github.com/chrisbanes/gradle-mvn-push">Gradle script to load artifacts in Maven repositories</a> </p><br><p>  Specifically, in his case, the process is described in the maven repository for public publication.  The basic settings are absolutely identical: in each module that needs to be published, we call the gradle script file from the module's build.gradle file and create gradle.properties, where the configuration information for the publication will lie.  We are interested in the ability to publish in a private artifactory </p><br><pre> <code class="hljs pgsql"># {project}/build.gradle RELEASE_REPOSITORY_URL={artifactory_url}/<span class="hljs-keyword"><span class="hljs-keyword">release</span></span>-modules SNAPSHOT_REPOSITORY_URL={artifactory_url}/<span class="hljs-keyword"><span class="hljs-keyword">snapshot</span></span>-modules</code> </pre> <br><p>  We need to add 2 folders for publication in the artifactory: one for the official release and a snapshot for the test builds of the modules. </p><br><p><img src="https://habrastorage.org/webt/so/bn/hz/sobnhzi0dyir5lwnsziys3crhnk.png"><br>  When we have finally configured the configuration file gradle.properties, we are ready to make the first publication of the libraries in the artifactory.  In the test build, we specify SNAPSHOT in VERSION_NAME.  Then execute the command: </p><br><pre> <code class="bash hljs">./gradlew clean build sdk:uploadArchives</code> </pre> <br><p><img src="https://habrastorage.org/webt/tb/k_/hr/tbk_hre334nx6b-vx8rqzteqiia.png"></p><br><h2 id="nastroyka-ci-okruzheniya">  Setting up the CI environment </h2><br><p>  We managed to manually publish the modules in our private artifactory.  At the end, it remains to configure the CI environment so that we can embed the publication into our development process. <br>  We want only CI to publish in release artifactory, and for the rest we will add free read and write access to the snapshot.  Therefore, we will make changes in the root file gradle.properties, which usually lies in <code>~/.gradle/gradle.properties</code> .  We assign {% username%} and {% password%} for access when publishing to the artifactory.  This way, we will have the access level set up without making changes to .gitignore. </p><br><pre> <code class="hljs pgsql">// ~/.gradle/gradle.properties artifactory_username=<span class="hljs-keyword"><span class="hljs-keyword">login</span></span> artifactory_password=<span class="hljs-keyword"><span class="hljs-keyword">password</span></span></code> </pre> <br><p>  Add a trigger to the master branch so that when merge we have an assembly assembled for publication in a release artifactory.  We add test launches to the build task list if we have them in the module.  It will be good to adjust the auto increment version. </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Checkout git repository with modules #   ./gradlew test #     ./gradlew librarymodule:build #   artifactory ./gradlew libarrymodule:uploadArchives</span></span></code> </pre> <br><h2 id="ispolzuem-modul-v-produkte">  We use the module in the product </h2><br><p>  As soon as CI assembles the assembly and floods it into an artifactory, a dependency of this module can be added to the project.  But hey, we also need to add a url to our artifactory, because they are not available in a typical repository like maven </p><br><pre> <code class="hljs pgsql"># {project}/build.gradle allprojects { repositories { maven { url artifactory_url/<span class="hljs-keyword"><span class="hljs-keyword">release</span></span>-modules } maven { url {artifactory_url}/<span class="hljs-keyword"><span class="hljs-keyword">snapshot</span></span>-modules } } }</code> </pre> <br><p>  Now we can use it in the project. </p><br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta"># {project}/app/build.gradle dependencies { implementation 'kz.kolesa-team: librarymodule:1.0.0' }</span></span></code> </pre> <br><h2 id="s-chem-my-stolknulis">  What are we faced </h2><br><p>  When Kotlin is connected to our modules, the documentation for Kotlin files is not pulled up.  It turned out that for this you need to add a gradle task with <a href="https://github.com/Kotlin/dokka">Dokka</a> . </p><br><p>  If several developers specified identical versions for libraries when publishing, then, naturally, the latest version of the model was provided with the latest version.  During the development process, the module was required to specify a postfix with the ticket identifier from Jira.  It turns out something like <code>1.0.1-AAS-1-SNAPSHOT</code> . </p><br><h2 id="chto-v-itoge-poluchilos">  What is the result? </h2><br><p>  Over time, we have increased the number of modules.  We kept each module in a separate git repository.  A lot of git repository creates a large amount of inconvenience in the development process if a module is dependent on other modules.  In the end, it turned out that to perform a single task, it was necessary to create a PR in each git repository.  It is not entirely clear in what order they should be tested, not taking into account the permanent change in PR, if changes were made in one of the PRs.  Therefore, to use one git repository for all modules in practice turned out to be the most convenient. </p><br><p>  You may have many such modules.  If a particular module is not required in a particular project, then we can easily remove the dependency, which ultimately allows us not to write duplicate codes in each of three of our projects. </p><br><p>  This modular development of the internal components of the business will help us increase the speed of delivery of features to users.  In conclusion, it is worth noting the important advantage of modular development - the assembly of apk files will take much less time, since gradle will reassemble only the part of the module in which the change occurred. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/353942/">https://habr.com/ru/post/353942/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../353930/index.html">How to move from BuddyBuild to GitLab CI in 4 hours</a></li>
<li><a href="../353932/index.html">Information Retrieval Course at the Winter Pushchino School: we teach high school students to create search engines</a></li>
<li><a href="../353936/index.html">Google Analytics: create remarketing lists from old users without limits</a></li>
<li><a href="../353938/index.html">Services for the selection of keywords on the App Store: a comparative characteristic</a></li>
<li><a href="../353940/index.html">The C ++ Standardization Committee rips the shackles off</a></li>
<li><a href="../353944/index.html">Open lesson "iSCSI in Linux"</a></li>
<li><a href="../353946/index.html">Character kotlin</a></li>
<li><a href="../353948/index.html">Hijacking Telegram on Panic Waves</a></li>
<li><a href="../353950/index.html">Experiments on cats: how to increase the number of purchases in the application</a></li>
<li><a href="../353952/index.html">Issue # 19: IT training - current issues and challenges from leading companies</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>