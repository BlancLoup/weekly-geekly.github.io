<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We develop iOS application on flash</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Probably, many have heard about the Adobe Air project - a very sound initiative from Adobe to make the application on flash compile and run on any pla...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We develop iOS application on flash</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/48d/2d0/b15/48d2d0b15214ca1e716417a873894dd2.jpg" align="left">  Probably, many have heard about the <a href="http://ru.wikipedia.org/wiki/Adobe_AIR">Adobe Air</a> project - a very sound initiative from Adobe to make the application on flash compile and run on any platforms - desktop, iOS, Android, TVs, ... <br><br>  For a long time nothing sensible could be done on air.  But recently the technology is gaining momentum, Adobe has introduced a number of optimizations to the air code, and now it is possible to write a very smart application on it.  In this article I will talk about our experience in developing an air-application for iOS. <br><br><h4>  How did we get to such a life? ... </h4><br>  At the moment, the main project (social game) of our small startup, a company of several people - after a year of development is frozen at the final stage during the search for investors.  So in order not to sit idle while searching / negotiating is underway, it occurred to us to do something not very labor-intensive, and if it can earn something, then in general it is gorgeous. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Because  Neither of us is familiar with unity, nor even with xcode, but we are on ‚Äúyou‚Äù with a flash ‚Äî it occurred to me to try out the Air technology, which was vaunted, to create a more or less presentable and dynamic game. <br><br>  At the moment, use case'ov eir under iOS - count on fingers.  Yes, <a href="http://ru.wikipedia.org/wiki/%25CC%25E0%25F8%25E8%25ED%25E0%25F0%25E8%25F3%25EC">Machinarium</a> is not bad.  But, after all, this is not an indicator.  We were interested in how air will cope with a dynamic toy. <br><br>  So the decision was made.  Approximate dates (1 month) - set.  And we sat down to delve into a new technology for us ... <br><a name="habracut"></a><br>  The main platform on which we focused was the iPhone 4. <br><br><h4>  The idea of ‚Äã‚Äãthe game. </h4><br>  Here we have not thought for a long time.  The task was to find something that would fit the following criteria: <br><ul><li>  Simplicity =&gt; faster development </li><li>  Lack of a large number of animation, graphics, etc.  (so that in the first place - not to burden the artist with work for half a year, and secondly - not to burden the processor of the phone) </li><li>  Desirable - nezayannost themes </li><li>  No need to create 100 challenging puzzle levels (which would also slow down the development) </li></ul><br>  We didn‚Äôt want to invent something of our own, and it wasn‚Äôt even the calculation.  So we started surfing the Internet in search of a cloning object. <br><br>  After a couple of days of searching - we stopped at the toy " <a href="http://itunes.apple.com/us/app/axe-in-face/id390600991%3Fmt%3D8">Ax in Face</a> ".  She met all our requirements.  Its essence was to draw a finger on the trajectory of the ax and throw them at enemies. <br><br><img src="https://habrastorage.org/storage2/cae/666/d0b/cae666d0b64a3911008953209b090f17.jpg"><br><br><h4>  Start of development. </h4><br>  So, we started ... It is worth noting that we had no idea about Air technology at all. <br><br>  But as it turned out - it's not at all scary.  This is the same flash, only with a couple of additional classes for working with specific mobile devices functions - multitouch, etc. <br><br>  So we started the usual development in flash.  I will not write about it - this is not the topic of the article. <br><br>  I‚Äôll tell you only about the problems and difficulties that we encountered while launching the application on hardware (iPhone, iPad). <br><br>  By the way, for those who do not understand what the Air is - I will say it in two words.  You are developing a game in flash.  Then compile it under Air iOS and at the output (ideally) - you get a ready-made .ipa file for sending to the app store. <br><br>  For the user, the program is no different from those written in Objective C or Unity.  It also runs on i-devices.  No additional settings or dancing with a tambourine - does not require. <br><br><h4>  Speed ‚Äã‚Äãperformance. </h4><br>  The theme of speed is the most important in our development.  Naturally, we wanted to get a product that smoothly differed from other iOS games.  Well, or as close as possible to them.  Overtaking events, I will say that it was not possible everywhere. <br><br>  So, our game required the output of a couple of dozen animated sprites to the screen as quickly as possible.  I will describe the technology in chronological order. <br><br><h5>  Flash engine, bitmap frames. </h5><br>  Of course, about any vector of speech can not be.  So the first thing we tried was to export our vector into bitmap and insert them back into flash frames. <br><br><img src="https://habrastorage.org/storage2/dce/275/6a1/dce2756a10820c9c542591b40c6f3303.png"><br><br>  It turned out not bad, but I wanted faster / smoother. <br><br><h5>  Bitmap blitting. </h5><br>  Probably many are familiar with this technology.  This is the case when you spit on the flip pipe and do everything yourself - generate an empty rectangle and every frame, sprite after sprite, using copyPixels, copy them onto it. <br><br>  Next, output the resulting canvas as one Bitmap object. <br><br>  This technology shows itself well on desktops, but on iOS it turned out to be fayl.  The engine worked 10 times slower. <br><br><h5>  Modified flash engine. </h5><br>  Here it is - the golden mean. <br><br>  After some googling, it became clear that it allows to speed up the graphics.  The bottom line is that when we, as in the 1st case, did each frame of animation in a new frame, Flash had to kill each frame of the old frame from memory and create a new one.  What is very resource intensive. <br><br>  I read somewhere about technology that allows you to squeeze the most out of your mobile environment. <br><br>  Its essence is that you create a MovieClip with 1 frame and throw ALL frames of animation into this frame at once. <br><img src="https://habrastorage.org/storage2/3b7/1eb/547/3b71eb547d550890ea7c0b570e2418d1.png" align="left"><br>  Further, with the help of visible you only show what you need.  The trick is that all the animation frames are simultaneously present in the memory (and the virtual machine has already allocated memory for them and stuffed them there), and you only turn on / off their visibility.  But it does not rebuild the memory and everything works as quickly as possible. <br><br>  As a modification of technology, there is an option (which was used) when all frames are stored in separate bitmapData.  And instead of jerking visible at the heap of Bitmaps, you have one, the main Bitmap and rearrange bitmapData to it.  Those.  something like main_bmp.bitmapData = bd_frame [i]; <br><br>  On this and stopped.  The animation speed was about 1.5 times higher than the first case and allowed to display 20-30 sprites at 40 fps on iPhone4, which was fine with us. <br><br><h4>  Performance Optimization Tips. </h4><br>  In the course of development, we encountered a rake, which I would like to sum up in the form of tips: <br><ol><li>  Create as few dynamic objects as possible. </li><li>  The fewer objects on the screen will catch the events of the "mouse" (finger) - the better.  Set all mouseEnabled, mouseChildren to false. </li><li>  Better not try to move large objects and even more so to change their alpha. </li><li>  Put cacheAsBitmap for everything that is not animated. </li><li>  If you need to rotate something or change alpha - use cacheAsBitmapMatrix - this will speed up this process. </li><li>  Do not hang a bunch of liseners on ENTER_FRAME.  Better make one that will call all the necessary. </li><li>  Do not become attached to the frames, but become attached to the timer.  Those.  in your liceboard on ENTER_FRAME, keep the time counter from the last call and proceeding from it - do all the calculations. </li></ol><br>  So ... We didn‚Äôt meet the deadlines, and instead of 1 month, it took 2 everything. But I really didn‚Äôt want to let out a very poop. <br><br><h4>  The specifics of the platform. </h4><br><h5>  Retina vs lo-res. </h5><br>  How does an air application run on iPhones with a different screen behave?  In fact, everything is simple.  In the settings you set, whether you want a retina application or not.  And depending on this, your application will scale. <br><br>  In our case, we created a retina app and the size of the scene is 960x640.  On the iPhone 4 / 4S, it goes without scaling.  On the 3rd series, it scales by 50%. <br><br>  Of course, with a great desire - you can get confused and get scale when initializing, and depending on whether it is 1.0 or 0.5 - output different graphics ... But it would seem very difficult for us (and it wouldn‚Äôt allow collecting scenes in the flash itself, everything I had to write code), so we spat. <br><br><h5>  iPhone vs iPad. </h5><br>  This is the same as with the retina.  If you tick ‚ÄúiPad‚Äù, then the application on the iPad will run full screen, scaling under it (which in the case of 960x640 will cause non-repeated scaling and artifacts).  If you do not put such a tick in, then it will behave like a normal iPhone application running on the iPad - i.e.  run in a small window with a button "x2". <br><br><img src="https://habrastorage.org/storage2/a50/e60/4d7/a50e604d71aa23d84743160a947129c8.jpg"><br><br>  We did just that. <br><br>  Later, we will probably assemble the HD version specifically for the iPad - full screen and with full graphics. <br><br><img src="https://habrastorage.org/storage2/919/b55/cd1/919b55cd15b0d0ddd893df719da26877.png" align="left"><br><h5>  CPU vs GPU. </h5><br>  Flash for Air can be assembled in two versions - with the engine on the GPU and on the CPU.  To my surprise, the algorithm of the engine was such that the difference between the GPU and the CPU was very small (no more than 10%).  Therefore, we stopped at the CPU, since  GPU compilation does not support effects.  Those.  all font strokes and shadows would not work.  Of course, the way out was to take a font with effects, create bitmapdata, draw there () of this font, and add the resulting bitmap to the scene.  In this case, all the effects would be in place, because  draw () is performed in any case on the CPU and therefore does not lose effects. <br><br>  But it was somehow very hemorrhoid and it was decided that the game was not worth the trouble. <br><br>  But I think this issue should be considered individually for each project. <br><br><h4>  Problems and solutions. </h4><br>  Obviously, not all the features of iOS, we will have access from the Air.  For example, to the capabilities of the Game Center.  What to do?  Dead end? <br><br>  Not at all.  For all this, there is a technology native extensions.  With these extensions, you can "reach out" to any specific iron.  How to use them - the topic is quite extensive. <br><br>  In addition, the use of native extensions entails the second (and even third) problems - the inability to compile ipa from flash (you need to use the command line) and dancing with a tambourine to make this work on the hardware. <br><br>  Also, for some reason, the new versions of Eir didn‚Äôt want to spit on the sound switch on the phone.  To make it work, you also need to use the native extension.  If it is interesting, I can write a separate article about native extensions. <br><br>  Plus, the whole process cannot be completed on the PC anyway.  Despite the fact that even certificates can be created under windows (again, if anyone is interested, I can describe all the dances with a tambourine in a separate article), but what cannot be done under Windows is to fill the application in app store.  Recently, this is being done in the only possible way - with the help of a special program that requires a minimum of Mac OS 10.6.8.  And nothing else.  A long and hard dance with a tambourine allowed me to put this version of makosi on a virtual machine under AMD (if anyone is interested, then briefly: only image 10.6.4 (legacy) worked, downloaded a combo update to 10.6.8 (hands!), Set , not rebuilt, replaced kext'y so that it does not hang on PCI configuration begin, loaded with ignored caches).  A few more tambourine dances - and the app is flooded! <br><br><h4>  Findings. </h4><br>  Did the experience succeed?  How exactly the experience of the new technology - I think yes. <br><br><img src="https://habrastorage.org/storage2/1ca/e02/c4b/1cae02c4bcf5e5ea511428bf8ad1b764.jpg"><br><br>  But as a platform for writing dynamic games, I would still not advise Flash.  Because  brakes still have.  For example, the animation of the movement of objects in the menu could not be made smooth on the 4th iPhone.  On 4S and iPad 2 - everything flies.  But, on the other hand, these features are not particularly critical and do not interfere with the gameplay. <br><br>  Summarizing - you can say so - you can write.  And it can even look good.  But on some points, it still does not reach native applications. <br><br>  Although Adobe is also not standing still.  Yesterday he announced the release candidate Air 3.2, where there is full use of the GPU (including 3D).  We'll see‚Ä¶ <br><br><img src="https://habrastorage.org/storage2/fd7/665/d1e/fd7665d1e89c85345794191e6a3145bf.png" align="left"><h4>  Result. </h4><br>  <i>There were pictures, promo codes and links to the product, but because</i>  <i>I do not want to publish in "I am promoting", then I removed them.</i> <br><br>  It's too early to talk about the results - the toy is only a few days in the app store.  Recently published on iphones.ru.  So for now - all ahead.  If it is interesting, then I can write about commercial results.  True, we have already caught a review by 1 point from the ‚Äúhero‚Äù who complains about the lack of achivok (and they are, and right on the main menu) and <b>physics</b> .  Yes, it is precisely the physics that we lack in the game. <br><br>  As a bonus - a couple of sketches: <br><img src="https://habrastorage.org/storage2/73c/788/c5c/73c788c5caa4235ef7f657e8d6a589d3.jpg"><br><img src="https://habrastorage.org/storage2/576/82f/984/57682f98440be1102c6a1a145aa754f2.png"></div><p>Source: <a href="https://habr.com/ru/post/139146/">https://habr.com/ru/post/139146/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../139136/index.html">Where in Russia from bachelor to quality pump to the IT-master?</a></li>
<li><a href="../139138/index.html">Development of your PE packer</a></li>
<li><a href="../139141/index.html">Adobe AIR 3.2 with mobile platform support for Stage3d</a></li>
<li><a href="../139142/index.html">MegaFon data center tour</a></li>
<li><a href="../139143/index.html">Game Survivor (Commodore 64) on html, css and javascript</a></li>
<li><a href="../139150/index.html">Three devices in one - look at Asus PadFone</a></li>
<li><a href="../139151/index.html">Motivation from the evil one</a></li>
<li><a href="../139152/index.html">Organizing partitions on a system disk in a selector cloud</a></li>
<li><a href="../139154/index.html">Running PHP code in javascript files</a></li>
<li><a href="../139156/index.html">The Startup Sauna program from Finland is returning to St. Petersburg!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>