<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Advanced home thermostat</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Prologue  With the advent of the electronically controlled gas boiler at home, living, as it were, becomes more pleasant. Having improved this moment ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Advanced home thermostat</h1><div class="post__text post__text-html js-mediator-article"><h5>  Prologue </h5>  With the advent of the electronically controlled gas boiler at home, living, as it were, becomes more pleasant.  Having improved this moment with a simple thermostat with two buttons and a seven-segment, it seemed that everything was alright.  But it was decided to develop this idea. <br><br><img src="https://habrastorage.org/storage3/acd/0f2/481/acd0f24812b1ae40879f063f8cdbec5b.jpg"><br>  Definitely, the <a href="http://nest.com/living-with-nest/">NEST</a> project is the leader in home temperature control. <br>  So it was decided to create a similar device, but adding the right one and removing what rarely comes in handy. <br><br><h5>  Decision </h5>  Our device should be able to: <br>  1) Show the temperature at home and outdoors <br>  2) Turn on the heating when the temperature of the house drops below the set <br>  3) Accordingly, we will set the temperature schedule (for example, at 6 am we need 22 degrees, when everyone went to work, you can and 18, etc.) <br>  Of the buns <br>  4) The graph of outdoor temperature for the day <br>  5) Hours (turned out in passing) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><h5>  Iron </h5>  For greater clarity, it was decided to use the LCD TFT display on the ILI9320 controller.  This display comes with different diagonals (2.2-3.2 inches).  Resolution 240x320.  There is a resistive touchscreen touchscreen.  In principle, you can use almost any display with the same resolution.  You only need to change the initialization procedure.  In the attachment there is a list of supported controllers for which there are examples of initialization, thanks <a href="http://habrahabr.ru/users/noi/" class="user_link">Noi</a> . <br><br><img src="https://habrastorage.org/storage3/7f8/d21/f99/7f8d21f99926e9bc6cddaf846f7640c6.jpg"><br>  The text was originally only 8x8, and for small inscriptions it was enough, it was also possible to display this font with a double scale.  The font was generated by the LCD Font Generator program and stored in flash.  But for large numbers this was obviously not enough.  Another 128x128 font was created in the same program.  You can choose any font.  But 10 numbers and 3 characters occupied 200kB of memory.  I was too lazy to invent a format for compression, and I added external memory eeprom 24c256.  It stores large numbers and a couple of icons. <br><br><h5>  Scheme </h5><img src="https://habrastorage.org/storage3/632/e1b/1a3/632e1b1a377cb801ed817c23d0b0346c.jpg"><br><br>  Attempting to fit the entire device in a cramped enclosure led to two boards connected by MGTF wire. <br><img src="https://habrastorage.org/storage3/949/732/946/9497329464623d0d52cc623ed99ac97a.jpg"><br><br><img src="https://habrastorage.org/storage3/96c/035/b9f/96c035b9fb23f97eb11013942bc393f3.jpg"><br>  The first board serves for decoupling a fairly small display pitch, the second one is occupied by the Atmega32 (the code takes 47% flash, so the Atmega16 is suitable), the EEPROM and the 3.3V linear regulator. <br><img src="https://habrastorage.org/storage3/fa1/2a1/bad/fa12a1badad9b772ceeb235d1743f929.jpg"><br><br>  The display is powered by 3.3 volts, and the input is not tolerant to 5 volts, so I powered the MC from 3.3V so that the level matching would not be added.  As temperature sensors used DS18B20 <br><img src="https://habrastorage.org/storage3/47c/339/a18/47c339a182fcc92b68af243ffdc0dcaa.jpg"><br><br>  What would the boiler understand that it is time to turn on it is necessary to apply 220V to a special input.  For switching, a relay was added, which was placed inside the boiler on a separate board along with a 12V power supply and a 5V stabilizer.  Also added another relay, its winding is connected to 220 directly.  A common contact goes to the ground, and normally closed at the input of the MK.  Now for what you need.  With the loss of electricity, this relay first of all falls off, thus a zero appears at a certain input of the MK.  Immediately turns off the display.  Now Atmega works only at the expense of charged capacitors in the power supply and consumes 7ma.  This is enough for 2-3 seconds of work; during this time, all the necessary information (home temperature setting schedule, settings) is rewritten into non-volatile memory. <br><br><img src="https://habrastorage.org/storage3/a19/bd2/df9/a19bd2df98191312fd5ae087192a4faf.jpg"><br>  In order for the clock to continue to go while there is no electricity, the DS1307 real-time clock chip has been added.  Since the idea with this microcircuit came after the prototype was made, I added it on a separate shawl, bought from the Chinese for $ 2. <br><br><img src="https://habrastorage.org/storage3/024/022/ec5/024022ec5d92ea874b17ded7bfded347.jpg"><br>  First start <br><img src="https://habrastorage.org/storage3/8db/e21/a88/8dbe21a88771cc857f2e2e13ad74918b.jpg"><br>  Prototype ready <br><img src="https://habrastorage.org/storage3/be3/f44/2e6/be3f442e6178c5d13cee0fc8a8c0b06f.jpg"><br><br><h5>  Soft </h5>  The display has 5 touch buttons, we will use them to select the mode. <br>  Above it always shows the temperature of the house and on the street, the temperature setting at a given time, delta and time. <br>  Pressing the buttons selects the appropriate modes: <br><br>  House temperature <br><img src="https://habrastorage.org/storage3/067/943/555/067943555509d54330b3c843696aa64f.jpg"><br>  (You may notice a lot of service information, which is displayed on the display. It was needed for debugging, but already removed from the firmware) <br><br>  Outdoor temperature <br><img src="https://habrastorage.org/storage3/e2d/3fd/b95/e2d3fdb954f53cfe5190bcf919d9dcfd.jpg"><br><br>  Temperature graph for the day (implemented auto scaling graph) <br><img src="https://habrastorage.org/storage3/aa0/118/ae6/aa0118ae6e0d82b208291288e04fdc34.jpg"><br><br>  Schedule for setting the temperature of the house <br><img src="https://habrastorage.org/storage3/994/cac/d03/994cacd030245527280e1c67c417c968.jpg"><br>  In this mode, we can see the previous schedule of the task (yellow) and the new one that I just asked (green). <br><img src="https://habrastorage.org/storage3/80b/979/8f2/80b9798f2dfad4b6dcba07178247fdc1.jpg"><br>  After 10 seconds, the old one will be removed and the green will be redrawn yellow. <br><br>  Clock.  There is nothing to say <br><img src="https://habrastorage.org/storage3/1ba/484/673/1ba484673763c89edd51675e339a989d.jpg"><br><br>  Settings while minimalist. <br><img src="https://habrastorage.org/storage3/5be/bee/64b/5bebee64bb03b03858fcb1bf1af5aca7.jpg"><br><br>  In the upper part of the display you can see a drawing of a light, it is drawn all in the same LFG program.  With the generation of fonts, drawings and other characters there is not any problems.  The big numbers were a bit wide when they timed out, so they compressed programmatically by 75%.  The pictographs of the house and the street were converted into an array using the LCD Assistant program. <br><img src="https://habrastorage.org/storage3/7ad/161/d71/7ad161d71e55cd63aaf23151cad57e3b.jpg"><br><br>  Well, that's all, for someone, this article can podvodvinet to create this, and maybe help to create a device on a similar display. <br><br>  Source code on <a href="https://github.com/AtXmega/Atmega32-lcd">github.com</a> </div><p>Source: <a href="https://habr.com/ru/post/196124/">https://habr.com/ru/post/196124/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../196110/index.html">Edward Hands - C ++</a></li>
<li><a href="../196112/index.html">Winning startups: Where are they now?</a></li>
<li><a href="../196114/index.html">‚ÄúEvaluate the quality of service‚Äù: Motivator, Management Tool or Demotivator?</a></li>
<li><a href="../196116/index.html">ClojureCup 2013 - Team Report ("unmatched</a></li>
<li><a href="../19612/index.html">Is the end of the world?</a></li>
<li><a href="../196126/index.html">IMotion - 3D motion controller with tactile feedback</a></li>
<li><a href="../196128/index.html">Windows + Tmux + Cygwin</a></li>
<li><a href="../19613/index.html">Google shares fell</a></li>
<li><a href="../196130/index.html">Procedural audio</a></li>
<li><a href="../196132/index.html">The Large Hadron Collider with my own eyes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>