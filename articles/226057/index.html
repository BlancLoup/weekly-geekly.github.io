<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Quickly create callback scripts with Voximplant</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It is not surprising that in many business processes, one way or another there is such a task as to call one phone number and then connect it with ano...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Quickly create callback scripts with Voximplant</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/b10/641/c48/b10641c48cadef93c49f6863107b2306.png" align="left">  It is not surprising that in many business processes, one way or another there is such a task as to call one phone number and then connect it with another number.  Most often, this service is called callback or callback, sometimes - call order.  Many have met him on the websites of online stores, but in most cases this is not an automated callback, but a regular application that falls to the manager by email or appears in CRM, after which the manager dials the client‚Äôs number and talks to him.  Some large companies implement automated callback and even integrate it with queues in the contact center.  In this post, we will look at how to create a callback script using the VoxImplant platform in just a few minutes, as well as integrate this farm with some existing backend for storing / retrieving data on a call, store pop-root and welcome under cat. <a name="habracut"></a><br>  To begin with, let's duplicate the scheme on a larger scale in order to make it easier to explain what, how and with what it interacts when implementing our callback service. <br><img src="https://habrastorage.org/getpro/habr/post_images/fe3/871/556/fe3871556f457fd219564e80bdfd4bbc.png"><br>  It looks a bit cumbersome, but in fact everything is very simple and convenient.  The developer of VoxImplant (to get a developer account you need to register on the <a href="https://voximplant.com/sign-up">site</a> , it is absolutely free) via the HTTP API makes a request to the VoxImplant cloud, after which the script server launches a script previously written in JS that describes the logic for making calls, connecting them, and also , business logic.  Before you make an HTTP request to run a script, you obviously need to write it, and also hook it to an application through a rule (rule), then you need to specify the id of this rule in the HTTP request so that it is clear which script should be launched.  So, in order: <br><ol><li>  Create a VoxImplant application. </li><li>  Create a script. </li><li>  We tie the script to the application using the rule. </li><li>  Make an HTTP request to run the script. </li></ol><br>  After completing the HTTP request to run the script, if everything is done correctly, media_session_access_url will come in response, which allows you to continue remote control of its operation after running the script.  For example, if you need to finish the execution of a script at some specific point, you can write the following in the script: <br><pre><code class="javascript hljs">VoxEngine.addEventListener(AppEvents.HttpRequest, handleHttpRequest); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleHttpRequest</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ VoxEngine.terminate(); }</code> </pre> <br>  In this case, making a request for media_session_access_url, you stop the execution of the script.  We return to the implementation of our callback to phone numbers.  Create an application in the <a href="https://manage.voximplant.com/">Applications</a> section of the control panel, call it trite callback (the full name will be callback.account name.voximplant.com), and in the <a href="https://manage.voximplant.com/">Scenarios</a> section we create a new script of the following type: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> call1, call2, data; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> callerId = <span class="hljs-string"><span class="hljs-string">"+1234567890"</span></span>; <span class="hljs-comment"><span class="hljs-comment">//      VoxEngine.addEventListener(AppEvents.Started, handleScenarioStart); function handleScenarioStart(e) { //         customData, //  script_custom_data  HTTP- StartScenarios //        1:2 data = VoxEngine.customData(); data = data.split(":"); //    -    1 call1 = VoxEngine.callPSTN(data[0], callerId); //   call1.addEventListener(CallEvents.Connected, handleCall1Connected); call1.addEventListener(CallEvents.Failed, function(e) { VoxEngine.terminate(); }); call1.addEventListener(CallEvents.Disconnected, function(e) { VoxEngine.terminate(); }); } function handleCall1Connected(e) { //    ,   call1.say(",     ,  ", Language.RU_RUSSIAN_FEMALE); call1.addEventListener(CallEvents.PlaybackFinished, function(e1) { //        2 call2 = VoxEngine.callPSTN(data[1], callerId); //   call2.addEventListener(CallEvents.Connected, handleCall2Connected); call2.addEventListener(CallEvents.Failed, function(e2) { call1.say(" ,     ", Language.RU_RUSSIAN_FEMALE); call1.addEventListener(CallEvents.PlaybackFinished, function(e3) { VoxEngine.terminate(); }); }); call2.addEventListener(CallEvents.Disconnected, function(e2) { VoxEngine.terminate(); }); }); } function handleCall2Connected(e) { //    -  VoxEngine.sendMediaBetween(call1, call2); //   VoxEngine.easyProcess(call1, call2); }</span></span></code> </pre><br>  In short, this script calls the numbers that we pass through the special request parameter <a href="httpapi/StartScenarios.html">StartScenarios</a> script_custom_data as line1: number2.  First we dial to number 1 and play the message using TTS, then we dial to number 2 and connect two calls to each other.  In this scenario, we do not work out some cases at all, for example, if you have not phoned to number 1, then we simply complete the execution of the script.  If you conjure a little, you can notify the outside world that something has gone wrong, change <br><pre> <code class="javascript hljs">call1.addEventListener(CallEvents.Failed, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ VoxEngine.terminate(); });</code> </pre><br>  on <br><pre> <code class="javascript hljs">call1.addEventListener(CallEvents.Failed, handleCall1Failed);</code> </pre><br>  and describe handleCall1Failed: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleCall1Failed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     var code = e.code, reason = e.reason; //         HTTP- Net.httpRequest("http://somewebservice", function(e1) { //     - e1.code, e1.text, e1.data, e1.headers //   VoxEngine.terminate(); }); }</span></span></code> </pre><br>  This is the simplest example with a GET request.  The <a href="http://voximplant.com/docs/references/appengine/Net.HttpRequestOptions.html">HttpRequestOptions</a> class is available for configuring and managing the HTTP request from the script. <br>  In the same way, using the Date, you can measure the duration of individual calls or sessions within a script and send data to the outside world, if for some reason you can go into the call history to obtain this information does not match the logic of the service / application.  As you probably already understood, we tried to make a very flexible system so that the developer could choose the mechanism for solving various tasks. <br>  After the script is ready, we need to save it under some name, for example, CallbackHabr and go to the Applications section in order to hook the script to the rule and eventually get its ID. <br><img src="https://habrastorage.org/getpro/habr/post_images/479/2f8/86c/4792f886c569d81cec39ddbe4d92c708.png"><br>  To get the ID of the rule, you need to tick a little (in the future we will try to eliminate this drawback of the control panel) - after creating the rule, you need to save the application (it is the application, not the order of the rules), that is, go to the General tab and click Save there.  Then again open the application for editing and open the Rules tab, where the rule ID will be displayed (it can also be obtained via the HTTP API): <br><img src="https://habrastorage.org/getpro/habr/post_images/d5d/503/bbb/d5d503bbbf55e9fcf03ba1f544dcadb7.png"><br>  Well, in general, and that's it, now you can make an HTTP request StartScenarios, for which you will need some more parameters, you can find out your api_key in the Profile section.  The request will end up looking something like this: <br><pre> <code class="javascript hljs">https:<span class="hljs-comment"><span class="hljs-comment">//api.voximplant.com/platform_api/StartScenarios/?account_id=1&amp;api_key=eec36d6c-a0eb-46b5-a006-1c2b65343bac&amp;rule_id=55033&amp;script_custom_data=number1%3Anumber2</span></span></code> </pre><br>  As a result of success, something in the spirit will come back: <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"result"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"media_session_access_url"</span></span> : <span class="hljs-string"><span class="hljs-string">"http:\/\/1.2.3.4:12092\/request?id=93e41c6e20811b9b.1380201554.0@1.2.3.4&amp;token=36bc7ce95edc679e32d83bb6f3ad985f"</span></span> }</code> </pre><br>  Through this media_session_access_url you can continue to communicate with the session, if necessary.  Logs are always available for debugging the script, which are located in the <a href="https://manage.voximplant.com/">Calls</a> section (arrow in the upper right corner), as well as our overdriver, available <a href="https://manage.voximplant.com/">here</a> .  For convenience, we downloaded the script from this post on GitHub so that you can experiment quickly. <br><br>  <a href="">Callback script on github</a> </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/226057/">https://habr.com/ru/post/226057/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../226041/index.html">Irina Kalashnikova: ‚ÄúWe expect the number of mobile solutions to increase significantly this year‚Äù</a></li>
<li><a href="../226047/index.html">Features of loyalty programs and accruals of aviamil in Russian banks</a></li>
<li><a href="../226049/index.html">TiME - space submarine</a></li>
<li><a href="../226051/index.html">Ciklum PHP Speakers' Corner in Vinnitsa June 19</a></li>
<li><a href="../226053/index.html">Userscripts.org: looking for alternatives</a></li>
<li><a href="../226059/index.html">Samsung announces Russia Tizen App Challenge contest for web developers from Russia</a></li>
<li><a href="../226061/index.html">Work at Google: A fly in the ointment</a></li>
<li><a href="../226063/index.html">How to run Chrome extensions not from the WebStore</a></li>
<li><a href="../226065/index.html">How vendors IA-32 put a pig on the creators of virtualization</a></li>
<li><a href="../226067/index.html">We treat Chinese usb sound card</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>