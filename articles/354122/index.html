<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The million question</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Perhaps many of you wondered: how will the behavior of a smart contract change, if its data weighs hundreds of megabytes and stores hundreds of thousa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The million question</h1><div class="post__text post__text-html js-mediator-article">  Perhaps many of you wondered: how will the behavior of a smart contract change, if its data weighs hundreds of megabytes and stores hundreds of thousands or millions of records?  Will transactions go up?  How will this affect the network as a whole?  Will some types of variables in solidity cope with this task better than others?  We decided to personally find out the answers to these questions and conduct an experiment in our private Ethereum network, simulating the situations described.  What came out of this, read further in the article. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/oj/es/hw/ojeshwvomclf3y_apuqszvwdxl0.jpeg" width="400"></div><a name="habracut"></a><br><h3>  Test description </h3><br>  We wanted to find out how the load will affect one smart contract of one million transactions and a large amount of data. <br><br>  Measured such parameters: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  the cost of one transaction in kgas; </li><li>  the duration of the creation of one unit; </li><li>  single block size; </li></ul><br>  <b>Blockchain parameters</b> <br><br>  We had a private PoA blockchain with two authorized writing nodes and one ‚Äúpassive‚Äù from which transactions were sent. <br><br>  All three nodes were running on identical servers: <br><br><ul><li>  Processor: 2 Intel Xeon E5-2670 2.60 GHz. </li><li>  RAM: 8 GB. </li><li>  OS: Windows Server 2012 R2 Datacenter (64-bit). </li></ul><br>  <b>Smart Contract Description</b> <br><br>  It was created two smart contract.  One had mapping bytes32 as the field, =&gt; bytes32, the other had a one-dimensional bytes32 array.  Each of the contracts contained a function that takes as a parameter the value of bytes32 and saves this value as an element of the corresponding mapping or array (in fact, the value was stored in the blockchain's storage). <br><br>  <b>Brief description of the mapping contract</b> <br><br><pre><code class="hljs javascript">contract TesterMapping { mapping (<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">bytes32</span></span></span><span class="hljs-function"> =&gt;</span></span> bytes32) StoragedData; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Storing</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">bytes32 data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(StoragedData[data]!= <span class="hljs-string"><span class="hljs-string">"Y"</span></span>) StoragedData[data] = <span class="hljs-string"><span class="hljs-string">"Y"</span></span>; } }</code> </pre> <br>  <b>Brief description of the contract with the array</b> <br><br><pre> <code class="hljs kotlin">Con tract TesterArray { bytes32[] StoragedArray; function Storing(bytes32 <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(uint256 i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; StoragedArray.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(StoragedArray[i] == <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } StoragedArray.push(<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>); } }</code> </pre><br><h3>  Test progress and results </h3><br>  First, a smart contract with a field-mapping was tested.  Once a second, a transaction with a random 32-byte value was sent to it.  Due to technical problems, testing took a little longer than planned, and the million transaction was sent three weeks after sending the first one.  Then a smart contract with an array was tested. <br><br>  <b>Mapping ‚Äî contract</b> <br><br>  Throughout the experiment, neither the transaction value nor the block size fluctuated by any meaningful amount.  Each transaction was processed almost instantly, both the first and the millionth.  The duration of the block creation periodically varied from 1 to 9 seconds, but always a value of 5 seconds symmetrically set in the genesis block (if one second passed between creating the block n and n + 1, then the block n + 2 appeared after 9 seconds), that is the average block creation time remained equal to 5 seconds.  However, some patterns in the occurrence of these fluctuations were not noticed and, perhaps, this was due to the operation of our network or supporting server software (antiviruses, etc.). <br><br>  <b>Array contract</b> <br><br>  In this variant, due to the presence of an array looping cycle (for searching for matching values), the cost of one transaction increased from 40 thousand KGas to more than 2 million KGas in the first two thousand transactions.  In this case, the duration of processing a single transaction in the first few hundred transactions has already become longer than the creation time of one block.  Because of this, the size of one block for approximately 500 transactions fell to its minimum and did not increase any more, since one transaction began to fall at best into one block.  The processing time very quickly became so long that after sending only three thousand transactions, ‚Äúraking‚Äù the resulting queue took about four hours, while the network would be paralyzed (of course, if the sender in the ‚Äúcombat‚Äù network had enough money to pay for expensive transactions). <br><br><h3>  findings </h3><br><br><ul><li>  The size of the mapping does not affect the speed of working with it or the cost of the transaction (at least up to 1 million items). </li><li>  The Solidity virtual machine is extremely inefficient when working with iterative loops. </li><li>  To work with a large number of records is better to use mapping. </li></ul><br>  Unfortunately, we did not find a way to determine how much data in the storage is occupied by the data of a specific smart contract when using the mapping array.  Perhaps someone from the readers will be able to tell your version. </div><p>Source: <a href="https://habr.com/ru/post/354122/">https://habr.com/ru/post/354122/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../354112/index.html">Own Goal We are testing DDoS protection.</a></li>
<li><a href="../354114/index.html">Java 10 migration notes</a></li>
<li><a href="../354116/index.html">Inventions for smugglers and pharmacists + training your research institute</a></li>
<li><a href="../354118/index.html">True XP / TDD in Pivotal from the inside: how does it look and is it possible?</a></li>
<li><a href="../354120/index.html">Checking the source code of the free graphical editor Krita 4.0</a></li>
<li><a href="../354124/index.html">Review of materials on machine learning ‚Ññ 3 (April 16 - 23, 2018)</a></li>
<li><a href="../354126/index.html">And if we do not design a system for managing the production of IT products. Part 1. Analysis of box solutions</a></li>
<li><a href="../354128/index.html">Moving from the CIS to the Czech Republic, own experience</a></li>
<li><a href="../354130/index.html">HoleyBeep: explanation and exploit</a></li>
<li><a href="../354132/index.html">We relieve the player from irritation: the correct use of random numbers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>