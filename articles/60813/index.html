<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Coloring Calendar List</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Recently, there was a task to make a colorized by the value of the field in the list of the calendar. 
 At the same time, the task was ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Coloring Calendar List</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  Recently, there was a task to make a colorized by the value of the field in the list of the calendar. <br>  At the same time, the task was a little complicated by the fact that it was necessary not only to color the sheet, but also to apply different styles to the blocks on the calendar. <br><br><a name="habracut"></a><br><br><h4>  Implementation </h4><br>  The first thought was to try to paint from the object model. <br>  but ... as it turned out, only the elements displayed on the monthly calendar are able to be painted 0_0 <br>  By the way, these elements have one more feature, it will be described in more detail below. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To begin with, a WebPart was created to display the legend. <br><br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> StyledCalendar : System.Web.UI.WebControls.WebParts.WebPart <br> { <br> <br> <font color="#0000ff">#region</font> [ Properties ] <br> <br> [Personalizable, Browsable( <font color="#0000ff">false</font> )] <br> <font color="#0000ff">public</font> <font color="#0000ff">string</font> FieldID <br> { <br> <font color="#0000ff">get</font> ; <br> <font color="#0000ff">set</font> ; <br> } <br> <br> [Personalizable, Browsable( <font color="#0000ff">false</font> )] <br> <font color="#0000ff">public</font> <font color="#0000ff">string</font> ListID <br> { <br> <font color="#0000ff">get</font> ; <br> <font color="#0000ff">set</font> ; <br> } <br> <br> [Personalizable, Browsable( <font color="#0000ff">false</font> )] <br> <font color="#0000ff">public</font> <font color="#2B91AF">List</font> &lt;ItemData&gt; Colored <br> { <br> <font color="#0000ff">get</font> ; <br> <font color="#0000ff">set</font> ;http://habrahabr.ru/edit/topic/60813/# <br> } <br> <br> <font color="#0000ff">#endregion</font> <br> <font color="#008000">// .............</font> <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  To it was created a class to ensure the selection of a list for coloring, <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/f65/370/872/f6537087226dd8e511f8a15526409ed8.png" alt="image"><br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">[ <font color="#2B91AF">Serializable</font> ] <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> ItemData <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">string</font> CSS { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ;} <br> <font color="#0000ff">public</font> <font color="#0000ff">string</font> JavaScript { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> <font color="#0000ff">public</font> <font color="#0000ff">string</font> ItemGUID { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> <font color="#0000ff">public</font> <font color="#0000ff">string</font> ItemText { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> StyledCalendarEditorPart : EditorPart, IPostBackEventHandler <br> { <br> <font color="#0000ff">private</font> DropDownList _ddlFields; <br> <font color="#0000ff">private</font> DropDownList _ddlValues; <br> <font color="#0000ff">private</font> DropDownList _ddlCalendars; <br> <br> <font color="#008000">// </font> <br> <br> <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> CreateChildControls() <br> { <br> Panel groupPanel = <font color="#0000ff">new</font> Panel(); <br> _ddlFields = <font color="#0000ff">new</font> DropDownList(); <br> _ddlValues = <font color="#0000ff">new</font> DropDownList(); <br> _ddlCalendars = <font color="#0000ff">new</font> DropDownList(); <br> <br> _txtStyleName = <font color="#0000ff">new</font> TextBox(); <br> _txtStyleName.ID = <font color="#A31515">"txtStyleName"</font> ; <br> <br> _btnChange = <font color="#0000ff">new</font> Button(); <br> _btnChange.Text = <font color="#A31515">"Change Style"</font> ; <br> _btnChange.OnClientClick = <font color="#A31515">"openStyleWindow()"</font> ; <br> <br> _ddlValues.Attributes.Add( <font color="#A31515">"onchange"</font> , <font color="#A31515">"onFieldValueChange(this, '"</font> + _txtStyleName.ClientID + <font color="#A31515">"')"</font> ); <br> <br> _ddlCalendars.SelectedIndexChanged += <font color="#0000ff">new</font> EventHandler(_ddlCalendars_SelectedIndexChanged); <br> _ddlCalendars.AutoPostBack = <font color="#0000ff">true</font> ; <br> <br> <font color="#0000ff">if</font> (_list != <font color="#2B91AF">String</font> .Empty ) <br> _ddlCalendars.Text = _list; <br> <br> _ddlFields.SelectedIndexChanged += <font color="#0000ff">new</font> EventHandler(_ddlFields_SelectedIndexChanged); <br> _ddlFields.AutoPostBack = <font color="#0000ff">true</font> ; <br> <br> <font color="#0000ff">if</font> (_field!= <font color="#2B91AF">String</font> .Empty) <br> _ddlFields.Text = _field; <br> <br> groupPanel.Controls.Add( <font color="#0000ff">new</font> LiteralControl( <font color="#A31515">"&lt;br&gt;"</font> )); <br> groupPanel.Controls.Add( <font color="#0000ff">new</font> LiteralControl( <font color="#A31515">"Calendars on page:&lt;br&gt;"</font> )); <br> groupPanel.Controls.Add(_ddlCalendars); <br> <br> groupPanel.Controls.Add( <font color="#0000ff">new</font> LiteralControl( <font color="#A31515">"&lt;br&gt;"</font> )); <br> groupPanel.Controls.Add( <font color="#0000ff">new</font> LiteralControl( <font color="#A31515">"Choice Fields:&lt;br&gt;"</font> )); <br> groupPanel.Controls.Add(_ddlFields); <br> <br> groupPanel.Controls.Add( <font color="#0000ff">new</font> LiteralControl( <font color="#A31515">"&lt;br&gt;"</font> )); <br> groupPanel.Controls.Add( <font color="#0000ff">new</font> LiteralControl( <font color="#A31515">"Field Value:&lt;br&gt;"</font> )); <br> groupPanel.Controls.Add(_ddlValues); <br> groupPanel.Controls.Add( <font color="#0000ff">new</font> LiteralControl( <font color="#A31515">"&lt;br&gt;"</font> )); <br> groupPanel.Controls.Add( <font color="#0000ff">new</font> LiteralControl( <font color="#A31515">"&lt;br&gt;"</font> )); <br> groupPanel.Controls.Add(_btnChange); <br> groupPanel.Controls.Add( <font color="#0000ff">new</font> LiteralControl( <font color="#A31515">"&lt;br&gt;"</font> )); <br> groupPanel.Controls.Add( <font color="#0000ff">new</font> LiteralControl( <font color="#A31515">"Template Preview:&lt;br&gt;"</font> )); <br> <br> _lbPreview = <font color="#0000ff">new</font> Label(); <br> _lbPreview.Text = MakePreview(); <br> groupPanel.Controls.Add(_lbPreview); <br> <br> groupPanel.Controls.Add( <font color="#0000ff">new</font> LiteralControl( <font color="#A31515">"&lt;br&gt;"</font> )); <br> groupPanel.Controls.Add( <font color="#0000ff">new</font> LiteralControl( <font color="#A31515">"Style Name:&lt;br&gt;"</font> )); <br> groupPanel.Controls.Add(_txtStyleName); <br> <br> <font color="#0000ff">this</font> .Controls.Add(groupPanel); <br> } <br> <br> <font color="#008000">// </font> <br> <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  A js file was added to the project, which opened the window <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/514/97f/ebc/51497febc30758d05109611875ba7d45.png" alt="image"><br><br>  The contents of the window - the file SetStyle.aspx put in LAYOUTS <br><br>  Actually you can go to the organization of coloring. <br><br>  Empirically (reflector) it was found where the templates for the list come from <br>  TEMPLATES \ CONTROLTEMPLATES \ DefaultTemplates.aspx <br><br>  In it you can find something like: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">SharePoint:RenderingTemplate</font> <font color="#ff0000">ID</font> <font color="#0000ff">="CalendarViewMonthItemMultiDayTemplate"</font> <font color="#ff0000">runat</font> <font color="#0000ff">="server"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">Template</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">div</font> <font color="#ff0000">class</font> <font color="#0000ff">="&lt;%# DataBinder.Eval(Container,"</font> <font color="#ff0000">DivClass</font> <font color="#0000ff">","</font> <font color="#0000ff">")%&gt;"</font> <font color="#ff0000">dir</font> <font color="#0000ff">="&lt;%# SPHttpUtility.HtmlEncode(DataBinder.Eval(Container,"</font> <font color="#ff0000">DataItem</font> . <font color="#ff0000">Direction</font> <font color="#0000ff">","</font> <font color="#0000ff">"))%&gt;"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">table</font> <font color="#ff0000">border</font> <font color="#0000ff">="0"</font> <font color="#ff0000">width</font> <font color="#0000ff">="100%"</font> <font color="#ff0000">cellspacing</font> = <font color="#ff0000">0</font> <font color="#ff0000">cellpadding</font> = <font color="#ff0000">0</font> <font color="#ff0000">dir</font> <font color="#0000ff">="&lt;%# SPHttpUtility.HtmlEncode(DataBinder.Eval(Container,"</font> <font color="#ff0000">DataItem</font> . <font color="#ff0000">Direction</font> <font color="#0000ff">","</font> <font color="#0000ff">"))%&gt;"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">tr</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">td</font> <font color="#ff0000">class</font> <font color="#0000ff">="&lt;%# SPHttpUtility.HtmlEncode(DataBinder.Eval(Container,"</font> <font color="#ff0000">DataItem</font> . <font color="#ff0000">BackgroundColorClassName</font> <font color="#0000ff">","</font> <font color="#0000ff">"))%&gt;"</font> <br> <font color="#ff0000">onmouseover</font> <font color="#0000ff">="this.className='&lt;%# SPHttpUtility.HtmlEncode(DataBinder.Eval(Container,"</font> <font color="#ff0000">DataItem</font> . <font color="#ff0000">BackgroundColorClassName</font> <font color="#0000ff">","</font> <font color="#0000ff">"))%&gt;sel';"</font> <br> <font color="#ff0000">onmouseout</font> <font color="#0000ff">="this.className='&lt;%# SPHttpUtility.HtmlEncode(DataBinder.Eval(Container,"</font> <font color="#ff0000">DataItem</font> . <font color="#ff0000">BackgroundColorClassName</font> <font color="#0000ff">","</font> <font color="#0000ff">"))%&gt;';"</font> <br> <font color="#ff0000">href</font> <font color="#0000ff">="&lt;%# SPHttpUtility.HtmlUrlAttributeEncode(DataBinder.Eval(Container,"</font> <font color="#ff0000">DataItem</font> . <font color="#ff0000">DisplayFormUrl</font> <font color="#0000ff">","</font> <font color="#0000ff">"))%&gt;?ID=&lt;%# SPHttpUtility.HtmlEncode(DataBinder.Eval(Container,"</font> <font color="#ff0000">DataItem</font> . <font color="#ff0000">ItemID</font> <font color="#0000ff">","</font> <font color="#0000ff">"))%&gt;"</font> <br> <font color="#ff0000">ONCLICK</font> <font color="#0000ff">="GoToLink(this);return false;"</font> <font color="#ff0000">target</font> <font color="#0000ff">="_self"</font> <br> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">a</font> <font color="#ff0000">onfocus</font> <font color="#0000ff">="OnLink(this)"</font> <br> <font color="#ff0000">href</font> <font color="#0000ff">="&lt;%# SPHttpUtility.HtmlUrlAttributeEncode(DataBinder.Eval(Container,"</font> <font color="#ff0000">DataItem</font> . <font color="#ff0000">DisplayFormUrl</font> <font color="#0000ff">","</font> <font color="#0000ff">"))%&gt;?ID=&lt;%# SPHttpUtility.HtmlEncode(DataBinder.Eval(Container,"</font> <font color="#ff0000">DataItem</font> . <font color="#ff0000">ItemID</font> <font color="#0000ff">","</font> <font color="#0000ff">"))%&gt;"</font> <br> <font color="#ff0000">ONCLICK</font> <font color="#0000ff">="GoToLink(this);return false;"</font> <font color="#ff0000">target</font> <font color="#0000ff">="_self"</font> <br> <font color="#ff0000">tabindex</font> =&amp;# <font color="#ff0000">60</font> ;%# <font color="#ff0000">DataBinder</font> . <font color="#ff0000">Eval</font> ( <font color="#ff0000">Container</font> , <font color="#0000ff">"TabIndex"</font> )%&amp;# <font color="#ff0000">62</font> ; <br> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">b</font> <font color="#0000ff">&gt;</font> <font>&lt;%</font> # SPHttpUtility.HtmlEncode(DataBinder.Eval(Container, <font color="#A31515">"DataItem.Title"</font> , <font color="#A31515">"{0:G}"</font> )) <font>%&gt;</font> <font color="#0000ff">&lt;/</font> <font color="#800000">b</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">a</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">td</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">tr</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">table</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">div</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">Template</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">SharePoint:RenderingTemplate</font> <font color="#0000ff">&gt;</font> <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  And so for each type of calendar item. <br><br>  You do not need to change this file.  You can create your own file with any name in the folder CONTROLTEMPLATES.  Sharepoint searches for a template by ID, but checks the type of the controller-template, so you cannot inherit from the template itself - it is sealed: (( <br><br>  Content: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">SharePoint:renderingtemplate</font> <font color="#ff0000">id</font> <font color="#0000ff">="CalendarViewWeekItemTemplate"</font> <font color="#ff0000">runat</font> <font color="#0000ff">="server"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">Template</font> <font color="#0000ff">&gt;</font> <br>   item'a <br> <font color="#0000ff">&lt;/</font> <font color="#800000">Template</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">SharePoint:renderingtemplate</font> <font color="#0000ff">&gt;</font> <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Initially, there was a thought to add Binding, but apart from the reserved fields, no zl list could be reached :( <br>  Then Templated Control was written, into which a part of the table was inserted. <br><br>  Unfortunately, the source code of this case did not remain as this mechanism did not work on <br>  items associated with the monthly calendar, in particular on <b>CalendarViewMonthItemMultiDayTemplate</b> <br><br>  Judging by the debugger when the binding came, almost all the fields of the controller were null. <br>  Everything worked in other controllers 0_o <br><br>  Then the concept was changed - a new non-template control was made which rigidly generated the html code in the Template, while receiving data from the list via the Sharepoint object model. <br><br>  As a result, the template code is reduced to: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">SharePoint:renderingtemplate</font> <font color="#ff0000">id</font> <font color="#0000ff">="CalendarViewWeekItemTemplate"</font> <font color="#ff0000">runat</font> <font color="#0000ff">="server"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">Template</font> <font color="#0000ff">&gt;</font> <br> <br> <font color="#0000ff">&lt;</font> <font color="#800000">myCompany:MyCompanyCalendarViewDayItemCtrl</font> <font color="#ff0000">ID</font> <font color="#0000ff">="myCompanyCalendarViewDayItemCtrl1"</font> <font color="#ff0000">runat</font> <font color="#0000ff">="server"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">myCompany:MyCompanyCalendarViewDayItemCtrl</font> <font color="#0000ff">&gt;</font> <br> <br> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">Template</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">SharePoint:renderingtemplate</font> <font color="#0000ff">&gt;</font> <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Class implementation: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> RenderItemData <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">string</font> ItemName { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">string</font> ItemStyle { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> <font color="#0000ff">public</font> <font color="#0000ff">string</font> ItemDisplayFormUrl { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> <font color="#0000ff">public</font> <font color="#0000ff">string</font> ItemId { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> <font color="#0000ff">public</font> <font color="#0000ff">string</font> ItemTitle { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">string</font> ItemDefaultBackground { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> <font color="#0000ff">public</font> <font color="#0000ff">string</font> ItemDirection { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> <br> } <br> <br> [ToolboxData( <font color="#A31515">"&lt;{0}:MyCompanyCalendarViewMonthItemCtrl runat=server&gt;&lt;/{0}:MyCompanyCalendarViewMonthItemCtrl&gt;"</font> )] <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> MyCompanyCalendarView : WebControl <br> { <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> Dictionary&lt; <font color="#0000ff">string</font> , RenderItemData&gt; _dict; <br> <br> RenderItemData _item; <br> <font color="#0000ff">private</font> <font color="#0000ff">string</font> _dispType; <br> <br> [Bindable( <font color="#0000ff">true</font> )] <br> [Category( <font color="#A31515">"Appearance"</font> )] <br> [Localizable( <font color="#0000ff">true</font> )] <br> <font color="#0000ff">protected</font> <font color="#0000ff">string</font> DisplayType <br> { <br> <font color="#0000ff">get</font> <br> { <br> <font color="#0000ff">return</font> _dispType; <br> } <br> <font color="#0000ff">set</font> <br> { <br> _dispType = <font color="#0000ff">value</font> ; <br> } <br> } <br> <br> <font color="#0000ff">public</font> MyCompanyCalendarView() <br> { <br> <font color="#0000ff">if</font> (_dict == <font color="#0000ff">null</font> ) <br> { <br> _dict = <font color="#0000ff">new</font> Dictionary&lt; <font color="#0000ff">string</font> , RenderItemData&gt;(); <br> } <br> <br> } <br> <br> <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnLoad( <font color="#2B91AF">EventArgs</font> e) <br> { <br> <br> WebPartManager wp = WebPartManager.GetCurrentWebPartManager( <font color="#0000ff">this</font> . <font color="#2B91AF">Page</font> ); <br> <br> StyledCalendar cal = <font color="#0000ff">null</font> ; <br> <br> <font color="#0000ff">foreach</font> (WebPart part <font color="#0000ff">in</font> wp.WebParts) <br> { <br> cal = part <font color="#0000ff">as</font> StyledCalendar; <br> <font color="#0000ff">if</font> (cal != <font color="#0000ff">null</font> ) <br> { <br> <font color="#0000ff">break</font> ; <br> } <br> } <br> <br> <font color="#0000ff">if</font> (cal == <font color="#0000ff">null</font> ) <br> { <br> <font color="#0000ff">return</font> ; <br> } <br> <br> SPCalendarItem calItem = (SPCalendarItem)((Microsoft.SharePoint.WebControls.SPCalendarItemContainer)( <font color="#0000ff">this</font> .Parent)).DataItem; <br> <br> _item = <font color="#0000ff">new</font> RenderItemData(); <br> <br> _item.ItemTitle = calItem.Title; <br> _item.ItemId = calItem.ItemID; <br> _item.ItemDisplayFormUrl = calItem.DisplayFormUrl; <br> _item.ItemDefaultBackground = calItem.BackgroundColorClassName; <br> _item.ItemDirection = calItem.Direction; <br> <br> <font color="#0000ff">using</font> (SPWeb web = SPContext.Current.Web) <br> { <br> SPList list = web.Lists[ <font color="#0000ff">new</font> <font color="#2B91AF">Guid</font> (cal.ListID)]; <br> <br> <font color="#0000ff">string</font> fieldValue = <font color="#2B91AF">String</font> .Empty; <br> <font color="#0000ff">string</font> [] recId = calItem.ItemID.Split( <font color="#0000ff">new</font> <font color="#0000ff">char</font> [] { <font color="#A31515">'.'</font> }); <br> <br> <font color="#0000ff">foreach</font> (SPListItem listItem <font color="#0000ff">in</font> list.Items) <br> { <br> <font color="#0000ff">if</font> (recId.Length &gt; 1) <br> { <br> <font color="#0000ff">if</font> (listItem.ID.ToString() == recId[0]) <br> { <br> fieldValue = listItem[ <font color="#0000ff">new</font> <font color="#2B91AF">Guid</font> (cal.FieldID)].ToString(); <br> <font color="#0000ff">break</font> ; <br> } <br> } <br> <font color="#0000ff">else</font> <br> <font color="#0000ff">if</font> (listItem.ID.ToString() == calItem.ItemID) <br> { <br> fieldValue = listItem[ <font color="#0000ff">new</font> <font color="#2B91AF">Guid</font> (cal.FieldID)].ToString(); <br> <font color="#0000ff">break</font> ; <br> } <br> <br> } <br> <br> _item.ItemName = fieldValue; <br> <br> <font color="#0000ff">foreach</font> (ItemData data <font color="#0000ff">in</font> cal.Colored) <br> { <br> <font color="#0000ff">if</font> (data.ItemText == _item.ItemName) <br> { <br> _item.ItemStyle = data.CSS; <br> } <br> <br> } <br> <br> <font color="#008000">//        Item -     .</font> <br> <br> <font color="#0000ff">if</font> (_dict.ContainsKey(calItem.DisplayFormUrl + _item.ItemId.ToString())) <br> { <br> _dict.Remove(calItem.DisplayFormUrl + _item.ItemId.ToString()); <br> } <br> <br> _dict.Add(calItem.DisplayFormUrl + _item.ItemId.ToString(), _item); <br> <br> } <br> <br> <font color="#0000ff">base</font> .OnLoad(e); <br> } <br> <br> <font color="#008000">//          Item'</font> <br> <font color="#008000">//    - ,    ,   </font> <br> <font color="#0000ff">protected</font> <font color="#0000ff">virtual</font> <font color="#0000ff">string</font> GetInnerTemplate(RenderItemData renderData, SPCalendarItem calendarItem, SPCalendarItemContainer container) <br> { <br> <font color="#2B91AF">StringBuilder</font> sb = <font color="#0000ff">new</font> <font color="#2B91AF">StringBuilder</font> (); <br> <font color="#0000ff">string</font> background = calendarItem.BackgroundColorClassName; <br> <font color="#0000ff">string</font> bgsel = calendarItem.BackgroundColorClassName + <font color="#A31515">"sel"</font> ; <br> <br> <font color="#0000ff">if</font> (renderData != <font color="#0000ff">null</font> &amp;&amp; <font color="#2B91AF">String</font> .IsNullOrEmpty(renderData.ItemStyle) == <font color="#0000ff">false</font> ) <br> { <br> background += <font color="#A31515">"_m"</font> ; <br> bgsel += <font color="#A31515">"_m"</font> ; <br> <br> } <br> <br> sb.AppendFormat( <font color="#A31515">"&lt;td class='{0}'"</font> , background); <br> sb.AppendFormat( <font color="#A31515">"onmouseover=\"this.className='{0}';\""</font> , bgsel); <br> sb.AppendFormat( <font color="#A31515">"onmouseout=\"this.className='{0}';\""</font> , background); <br> sb.AppendFormat( <font color="#A31515">"href='{0}?ID={1}'"</font> , calendarItem.DisplayFormUrl, calendarItem.ItemID); <br> sb.AppendFormat( <font color="#A31515">"ONCLICK='GoToLink(this);return false;' target='_self'"</font> ); <br> sb.AppendFormat( <font color="#A31515">"&gt;"</font> ); <br> sb.AppendFormat( <font color="#A31515">"&lt;a onfocus='OnLink(this)'"</font> ); <br> <br> <font color="#0000ff">if</font> (renderData != <font color="#0000ff">null</font> &amp;&amp; ! <font color="#2B91AF">String</font> .IsNullOrEmpty(renderData.ItemStyle)) <br> { <br> sb.AppendFormat( <font color="#A31515">" {0} "</font> , renderData.ItemStyle); <br> } <br> <br> sb.AppendFormat( <font color="#A31515">"href='{0}?ID={1}'"</font> , calendarItem.DisplayFormUrl, calendarItem.ItemID); <br> sb.AppendFormat( <font color="#A31515">"ONCLICK='GoToLink(this);return false;' target='_self'"</font> ); <br> sb.AppendFormat( <font color="#A31515">"tabindex={0}"</font> , container.TabIndex); <br> sb.AppendFormat( <font color="#A31515">"&gt;"</font> ); <br> sb.AppendFormat( <font color="#A31515">"&lt;b&gt;{0:G}&lt;/b&gt;"</font> , calendarItem.Title); <br> sb.AppendFormat( <font color="#A31515">"&lt;/a&gt;"</font> ); <br> sb.AppendFormat( <font color="#A31515">"&lt;/td&gt;"</font> ); <br> <br> <font color="#0000ff">return</font> sb.ToString(); <br> } <br> <br> <br> <br> <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> Render(HtmlTextWriter writer) <br> { <br> CreateChildControls(); <br> <br> SPCalendarItemContainer cont = Parent <font color="#0000ff">as</font> SPCalendarItemContainer; <br> SPCalendarItem item = cont.DataItem <font color="#0000ff">as</font> SPCalendarItem; <br> RenderItemData renderData = <font color="#0000ff">null</font> ; <br> _dict.TryGetValue(item.DisplayFormUrl + item.ItemID, <font color="#0000ff">out</font> renderData); <br> <br> <br> <font color="#0000ff">string</font> background = item.BackgroundColorClassName; <br> <font color="#0000ff">string</font> bgsel = item.BackgroundColorClassName + <font color="#A31515">"sel"</font> ; <br> <font color="#0000ff">string</font> suffix = <font color="#2B91AF">String</font> .Empty; <br> <br> <font color="#0000ff">if</font> (renderData != <font color="#0000ff">null</font> &amp;&amp; <font color="#2B91AF">String</font> .IsNullOrEmpty(renderData.ItemStyle) == <font color="#0000ff">false</font> ) <br> { <br> suffix = <font color="#A31515">"_m"</font> ; <br> } <br> <br> background += suffix; <br> bgsel += suffix; <br> <br> <font color="#2B91AF">StringBuilder</font> sb = <font color="#0000ff">new</font> <font color="#2B91AF">StringBuilder</font> (); <br> <br> <font color="#0000ff">if</font> (renderData != <font color="#0000ff">null</font> &amp;&amp; ! <font color="#2B91AF">String</font> .IsNullOrEmpty(renderData.ItemStyle)) <br> { <br> sb.AppendFormat( <font color="#A31515">"&lt;div {0} dir='{1}'&gt;"</font> , renderData.ItemStyle, item.Direction); <br> } <br> <font color="#0000ff">else</font> <br> { <br> sb.AppendFormat( <font color="#A31515">"&lt;div class='{0}' dir='{1}'&gt;"</font> , cont.DivClass, item.Direction); <br> } <br> <br> <font color="#0000ff">string</font> tableStyle = <font color="#A31515">""</font> ; <br> <br> <font color="#0000ff">switch</font> (item.CalendarType) <br> { <br> <font color="#0000ff">case</font> 0: <br> <font color="#2B91AF">String</font> .Format( <font color="#A31515">"class='ms-cal-tdayitem{0}'"</font> , suffix); <br> <font color="#0000ff">break</font> ; <br> <font color="#0000ff">case</font> 1: <font color="#008000">// Week Item</font> <br> tableStyle = <font color="#2B91AF">String</font> .Format( <font color="#A31515">"class='ms-cal-tweekitem{0}'"</font> , suffix); <br> <font color="#0000ff">break</font> ; <br> <font color="#0000ff">case</font> 2: <br> tableStyle = <font color="#2B91AF">String</font> .Format( <font color="#A31515">"class='ms-cal-tmonthitem{0}'"</font> , suffix); <br> <font color="#0000ff">break</font> ; <br> <font color="#0000ff">default</font> : <br> tableStyle = <font color="#0000ff">string</font> .Empty; <br> <font color="#0000ff">break</font> ; <br> } <br> <br> sb.AppendFormat( <font color="#A31515">"&lt;table border='0' width='100%' cellspacing=0 cellpadding=0 dir='{0}' {1}&gt;"</font> , item.Direction, tableStyle); <br> sb.AppendFormat( <font color="#A31515">"&lt;tr&gt;"</font> ); <br> <br> sb.Append(GetInnerTemplate(renderData, item, cont)); <br> <br> sb.AppendFormat( <font color="#A31515">"&lt;/tr&gt;"</font> ); <br> sb.AppendFormat( <font color="#A31515">"&lt;/table&gt;"</font> ); <br> sb.AppendFormat( <font color="#A31515">"&lt;/div&gt;"</font> ); <br> <br> writer.Write(sb.ToString()); <br> <br> <font color="#0000ff">base</font> .Render(writer); <br> } <br> <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  In addition, several descendants were inherited for different types of Item. <br>  the descendant controls themselves are inserted into the template. <br><br><h4>  Depla </h4><br><ul><li>  Copy all pages with templates in TEMPLATES \ CONTROLTEMPLATES </li><li>  Copy the page that is displayed in the pop-up window in TEMPLATES \ LAYOUTS </li><li>  Place the project build in the GAC </li><li>  We register our assembly in SafeControl site </li></ul><br><br>  What happened in the end: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/401/1ea/653/4011ea6530e165fb7aa25efe40cb34d0.png" alt="image"><br><br><h4>  What gives such an approach? </h4><br><br>  On codeplex there is a <a href="http://planetwilson.codeplex.com/Release/ProjectReleases.aspx%3FReleaseId%3D11814">project</a> , where a similar calendar is implemented via javascript connection to the page. <br><br><h5>  Minuses: </h5><br><ul><li>  in case of JS error somewhere on the page in the left component, everything falls, for many users the debugger is disabled by default and they see nothing. </li><li>  limited customization options </li></ul><br><br><h5>  What gives such an approach: </h5><br><ul><li>  I make a version in which Silverlight components are inserted into certain cells. </li><li>  Subjectively, the calendar rendering speed has increased (now the entire binding comes from the code) </li><li>  In the same way, it is now possible to replace a controller with a template controller. </li></ul><br><br>  This work was carried out jointly with a friend who unfortunately does not have an account on Habr√©, but very much wants to get into it, I will be grateful for the invite provided to him :) <br><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/60813/">https://habr.com/ru/post/60813/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../60796/index.html">Google Wave - watch video</a></li>
<li><a href="../60803/index.html">Push mi, boom boom, touch mi ... Ajax Push Engine</a></li>
<li><a href="../60806/index.html">Majesty 2 interview with KRI 2009</a></li>
<li><a href="../60809/index.html">Blowing hot air from laptops</a></li>
<li><a href="../60811/index.html">Autodesk DragonFly - interior design in a web browser</a></li>
<li><a href="../60815/index.html">Windows Azure SDK May CTP with Visual Studio 2010 support released</a></li>
<li><a href="../60816/index.html">Brave developer</a></li>
<li><a href="../60818/index.html">Internet Marketing Course by Jeremy Schoemaker</a></li>
<li><a href="../60819/index.html">Sorry I'm late</a></li>
<li><a href="../60821/index.html">Apple's Fastest Pizza Box - Macintosh LC 475</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>