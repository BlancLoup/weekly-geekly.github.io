<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using junit-quickcheck on a simple example in the practice of TDD</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Once again, practicing TDD in Java, I created a small training project in which I showed that if the tests pass, this does not mean that the code is e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using junit-quickcheck on a simple example in the practice of TDD</h1><div class="post__text post__text-html js-mediator-article">  Once again, practicing TDD in Java, I created a small training project in which I showed that if the tests pass, this does not mean that the code is executed correctly.  In fact, the development of unit tests that take into account the various options for input data is a hard work.  To solve this problem, I found the junit-quickcheck library for myself, and I am in a hurry to share my experience of using it. <br><br>  By the way, on Habr√© about this library already have a <a href="http://habrahabr.ru/post/240811/">great article</a> , but I use another example of the code being tested. <br><a name="habracut"></a><br><h2>  The first steps </h2><br>  So, I created a new empty Java project and made an assembly script.  I build this project using gradle.  You can see my study project <a href="https://github.com/risik/tdd-book-java/tree/feature/helloworld">here</a> .  Starting from this commit: d9bd97eaec20427e725f9a4c3ff0c0d36cc27ea3 the project is ready for building and implementing our test case. <br><br>  Now I have to start writing code following the TDD practice.  Some TDD apologists consider it appropriate to begin class development by writing a test for this class.  But here I would argue with them.  My IDE (IntelliJ IDEA) is able to generate tests in the presence of a ready-made class, so I will start the development by <a href="https://github.com/risik/tdd-book-java/commit/0490415ecfea58fb0a75e4b96f90c958dc960834">creating an empty class</a> : 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloSayer</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre> <br>  Here and below, the code is illustrated with links to a commit on github. <br><br>  And now I will ask my IDE to create a test for me and then I will start working according to the test-first scheme.  The first test I will do is a very simple test, with which I simply create a new object.  I want to specify with whom I need to say hello in the constructor.  Moreover, I believe that the object issuing the greeting can issue this greeting to only one.  Therefore, this class will not have a constructor without a parameter. <br><br>  <a href="https://github.com/risik/tdd-book-java/commit/8162299f8fe6a8d924a173ac12479c6dd3d74cc0">Here is the</a> first test I created: <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testCreating</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HelloSayer(<span class="hljs-string"><span class="hljs-string">"World"</span></span>); }</code> </pre><br>  Note that at this point the project is not compiled, that is, the test is red. <br><br>  Well, I'll make the test green.  My IDE can create class methods (including constructors), which I already use, as in the created test, but have not yet implemented.  Using one key combination, I generate <a href="https://github.com/risik/tdd-book-java/commit/26dbbd25542d7b0ccbdbac3b99908c90a30ef535">this constructor</a> and get a green test: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloSayer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HelloSayer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String whom)</span></span></span><span class="hljs-function"> </span></span>{ } }</code> </pre> <br>  Please note that the test, of course, passes, but in fact, my class does not do what I wanted from it.  We work on. <br><br>  <a href="https://github.com/risik/tdd-book-java/commit/9496ef269cc034f3843334a0159c9c3de133782b">I create a test</a> for the <b>getWhom</b> method - this is a getter, with the help of which I will be able to know to whom this object will issue a greeting: <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testWhomGetter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ HelloSayer sayer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HelloSayer(<span class="hljs-string"><span class="hljs-string">"World"</span></span>); assertEquals(<span class="hljs-string"><span class="hljs-string">"World"</span></span>, sayer.getWhom()); }</code> </pre><br>  The project is not compiled again, that is, the test is again red. <br><br>  We continue. <br>  <a href="https://github.com/risik/tdd-book-java/commit/d8ae54fa2446d8147876093501294400e87f0d4fm/risik/tdd-book-java/commit/d8ae54fa2446d8147876093501294400e87f0d4f">Implement the</a> required getter: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloSayer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String whom; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HelloSayer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String whom)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getWhom</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> whom; } }</code> </pre><br>  The project is already compiled, but the test fails.  In order to pass the test, we now have to <a href="https://github.com/risik/tdd-book-java/commit/c1b924524f25547f58958ac3f663a5edb19bab98">implement the</a> designer for real, and not in the way I did before: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HelloSayer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String whom)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.whom = whom; }</code> </pre><br>  The test is green again. <br><br>  A small but important explanation.  In this case study, I commit to the repository very often.  I do this in order to show the reader the sequence of my steps.  Making commits so often in a real project is not necessary. <br><br>  Although I am in favor of the commit being ‚Äúatomic‚Äù.  What is an atomic commit, you can read, for example, here: <a href="http://seesparkbox.com/foundry/atomic_commits_with_git">seesparkbox.com/foundry/atomic_commits_with_git</a> .  Crato to say: as long as you can formulate what you have done, in one sentence it is an atomic commit. <br><br><h2>  Incorrect implementation green test </h2><br>  Well now, let's implement the main method of this class: getting a welcome message. <br>  <a href="https://github.com/risik/tdd-book-java/commit/1afad7d25045fbd2ca2d3619b57abedaebca242a">Here is</a> the test: <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testGreetingString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ HelloSayer sayer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HelloSayer(<span class="hljs-string"><span class="hljs-string">"World"</span></span>); assertEquals(<span class="hljs-string"><span class="hljs-string">"Hello \"World\""</span></span>, sayer.getGreetingString()); }</code> </pre><br>  I expect that the name of the person to whom my greeting writer refers to will be quoted.  The test is red. <br><br>  <a href="https://github.com/risik/tdd-book-java/commit/507011ce6e0fd13425d43e5fe30a0aac133e2999">We implement the</a> required method: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getGreetingString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Hello \"World\""</span></span>; }</code> </pre><br>  The test is green.  I achieved passing the test very easy!  By the way, when implementing the <b>getWhom</b> method I could do the same, but that time I did everything honestly, but I was too lazy here. <br><br>  So, we have a problem: tests all pass, but the class does not do what we need.  One can argue here: it is unlikely that such a problem may arise in real life, and not in an educational project.  In fact, unit tests are usually developed by the same person who writes the functionality.  Therefore, it would be very strange if this person, wrote the implementation of the method, which so does not meet the requirements, although formally, it corresponds to the test. <br><br>  But, secondly, there are cases when different people write tests and functionality.  And first of all, there are much more complicated cases when a developer may simply not provide for all possible input data in tests. <br><br>  In fact, in order to avoid such an incorrect implementation, it would be enough to make a second test with another string of <b>whom</b> .  But I will try to resolve this issue for the most general case.  Solution of the problem in general form requires the use of many different lines.  That is, it is necessary to conduct a test not on the same line of the ‚ÄúWorld‚Äù, as I did, but on different lines. <br><br>  To solve the problem in general, I used a third-party junit-quickcheck library: <a href="https://github.com/pholser/junit-quickcheck">github.com/pholser/junit-quickcheck</a> , which is built on the basis of Theories from JUnit.  <a href="https://github.com/risik/tdd-book-java/commit/7ca99ae3866cfef0ba926965e34f7f925e7a24ad">I connect</a> it to my project. <br><br><pre> <code class="diff hljs"> dependencies { testCompile 'junit:junit:4.+' + testCompile 'com.pholser:junit-quickcheck-core:0.5+' + testCompile 'com.pholser:junit-quickcheck-generators:0.5+' }</code> </pre><br>  At the time of this writing, version 0.5, which I use here, has the status of alpha, but it claims Java 8 support, which I use for this project. <br><br>  Using this library, I re- <a href="https://github.com/risik/tdd-book-java/commit/17016c6f4bceee4911623af2d608f07ca750ee11">implemented the</a> test method to test the <b>greetingString</b> method: <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Theory</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">greetingString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( @ForAll String whom )</span></span></span><span class="hljs-function"> </span></span>{ HelloSayer sayer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HelloSayer(whom); assertEquals(String.format(<span class="hljs-string"><span class="hljs-string">"Hello \"%s\""</span></span>, whom), sayer.getGreetingString()); }</code> </pre><br>  We will understand what this code does.  The <a href="http://habrahabr.ru/users/theory/" class="user_link">Theory</a> annotation with the method indicates that this is a parameterized test method built on the basis of therories.  Annotation <a href="http://habrahabr.ru/users/forall/" class="user_link">ForAll</a> shows that this parameter will be generated.  junit-quickcheck out of the box can generate values ‚Äã‚Äãfor many types of data, including for strings. <br><br>  We start the test and now it is red, as we need.  Now I will <a href="https://github.com/risik/tdd-book-java/commit/e32647c04c63c71fec89aaf1c45c7708ce681110">correct</a> my implementation of the <b>getGreetingString</b> method: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getGreetingString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> String.format(<span class="hljs-string"><span class="hljs-string">"Hello \"%s\""</span></span>, whom); }</code> </pre><br>  Now the test is green and the implementation is, in fact, as it should be.  I recommend to put a breakpoint and trace what parameters are passed to this method.  I would not invent such lines. <br><br>  The next step I <a href="https://github.com/risik/tdd-book-java/commit/154d02f4902773a25644a3494f315b2485892829">rewrote</a> all the tests using string generation. <br>  Generally speaking, this is also a controversial issue.  Perhaps it should leave a simple test, with a simple, understandable line.  If you have to debug your code (for example, if you get unexpected behavior on some specific input line) then it would be more convenient to have a simple test.  Debugging the implementation with the generator is not very easy, since the test code is called repeatedly.  It is much easier to implement a simple test that uses a strictly fixed string that you need.  But I, nevertheless, replaced all the tests with tests with generated parameters. <br><br>  Small final line of this section, I <a href="https://github.com/risik/tdd-book-java/commit/44e31d9ee304989d16bc3bff6bb324c56d0cd205">added</a> control of code coverage to my project.  I use for this Jacoco.  I banish, watch the report and enjoy 100% code coverage. <br><br><h2>  Testing different implementations </h2><br>  Now we are starting to develop our ‚Äúvery important‚Äù class <b>HelloSayer</b> .  I do not really like its implementation. <br>  Specifically, I don‚Äôt like String.format every time the <b>getGreetingString</b> method is <b>called</b> .  However, there are situations when it will be OK, and there are situations when it will not suit me. <br><br>  Therefore, I will render the HelloSayer interface and make several implementations of it.  Here, I again used the capabilities of IntelliJ IDEA on refactoring.  <a href="https://github.com/risik/tdd-book-java/commit/8d77fe55d427566e33403353177b4f76be78c6c7">That's</a> what I got as a result.  Now HelloSayer became the interface, and the implementation that was there went to the HelloSayerInplace class. <br><br><div class="spoiler">  <b class="spoiler_title">Interface and implementation</b> <div class="spoiler_text">  Interface: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> info.risik.books.tdd.HelloWorld; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloSayer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getWhom</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getGreetingString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre><br>  Implementation: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> info.risik.books.tdd.HelloWorld; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloSayerInplace</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloSayer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String whom; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HelloSayerInplace</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String whom)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.whom = whom; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getWhom</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> whom; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getGreetingString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> String.format(<span class="hljs-string"><span class="hljs-string">"Hello \"%s\""</span></span>, whom); } }</code> </pre><br></div></div><br>  And now I‚Äôll make another implementation of this interface, which creates a welcome string right in the constructor and stores it in the object.  I also <a href="https://github.com/risik/tdd-book-java/commit/66641409f1594b370d8b561ba6896615f391231b">implemented the</a> test, thanks to copy-and-paste and search-and-replace: <br><br><div class="spoiler">  <b class="spoiler_title">Another implementation of the interface</b> <div class="spoiler_text">  Implementing the <b>HelloSayerAtOnce</b> class. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> info.risik.books.tdd.HelloWorld; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloSayerAtOnce</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloSayer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String whom; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String message; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HelloSayerAtOnce</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String whom)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.whom = whom; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.message = String.format(<span class="hljs-string"><span class="hljs-string">"Hello \"%s\""</span></span>, whom); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getWhom</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> whom; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getGreetingString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> message; } }</code> </pre><br>  Unit test for it: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> info.risik.books.tdd.HelloWorld; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.pholser.junit.quickcheck.ForAll; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> junit.framework.TestCase; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.junit.contrib.theories.Theories; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.junit.contrib.theories.Theory; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.junit.runner.RunWith; <span class="hljs-meta"><span class="hljs-meta">@RunWith</span></span>(Theories.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloSayerAtOnceTest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Theory</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testCreating</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( @ForAll String whom )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HelloSayerAtOnce(whom); } <span class="hljs-meta"><span class="hljs-meta">@Theory</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testWhomGetter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( @ForAll String whom )</span></span></span><span class="hljs-function"> </span></span>{ HelloSayer sayer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HelloSayerAtOnce(whom); assertEquals(whom, sayer.getWhom()); } <span class="hljs-meta"><span class="hljs-meta">@Theory</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">greetingString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( @ForAll String whom )</span></span></span><span class="hljs-function"> </span></span>{ HelloSayer sayer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HelloSayerAtOnce(whom); assertEquals(String.format(<span class="hljs-string"><span class="hljs-string">"Hello \"%s\""</span></span>, whom), sayer.getGreetingString()); } }</code> </pre><br></div></div><br>  There is a problem here.  I want another third implementation of the same interface, and accordingly, I will have to make a third test class, again through the same copy-and-paste and search-and-replace mechanism.  This is bad.  All classes that implement this interface, regardless of how they are implemented internally, must comply with the same agreement, which I have already described in the test.  I want to follow the principle of DRY (don't repeat youself).  That is, I want to apply the same test to all possible implementations of this interface. <br><br>  Here junit-quickchecker came to my rescue again.  <a href="https://github.com/risik/tdd-book-java/commit/68c287eebe96b5279e581dbf75236f3998a65101">Here is a</a> modified test: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RunWith</span></span>(Theories.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloSayerTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> HelloSayerType { InPlace, AtOnce, } <span class="hljs-comment"><span class="hljs-comment">//... @Theory public void testWhomGetter( @ForAll String whom, @ForAll @ValuesOf HelloSayerType sayerType ) throws Exception { HelloSayer sayer = getFactory(sayerType, whom); assertEquals(whom, sayer.getWhom()); } //... private HelloSayer getFactory(HelloSayerType type, String whom) throws Exception { switch (type) { case InPlace: return new HelloSayerInplace(whom); case AtOnce: return new HelloSayerAtOnce(whom); } throw new Exception("Unknown HelloSayerType"); } }</span></span></code> </pre><br>  I added one generated parameter to the test method: class type (as an enumeration).  Enumerations in junit-checker are supported out of the box.  To do this, I just need to add the @ValuesOf annotation.  And, in fact, all I needed to do was to create an instance of one of the classes. <br><br>  <a href="https://github.com/risik/tdd-book-java/commit/ecea8e643e9e2bd379b573c5d762405892b891e9">Re-implement</a> all test methods using this parameter.  I no longer need a separate test class for the new class, I <a href="https://github.com/risik/tdd-book-java/commit/b4092eb73177e1efeef6e4cf8c0d888539c393df">delete</a> it. <br><br>  And for a snack, I <a href="https://github.com/risik/tdd-book-java/commit/50eada1752aacca71b92ea2ae30655fd338a6b60">implement the</a> third version of HelloSayer: <br><br><div class="spoiler">  <b class="spoiler_title">Implementing HelloSayer with lazy string initialization</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> info.risik.books.tdd.HelloWorld; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloSayerLazy</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloSayer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String whom; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String message; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HelloSayerLazy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String whom)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.whom = whom; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.message = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getWhom</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> whom; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getGreetingString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (message == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { makeMessage(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> message; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ message = String.format(<span class="hljs-string"><span class="hljs-string">"Hello \"%s\""</span></span>, whom); } }</code> </pre><br></div></div><br>  Now, to implement all the tests for this class, I need to <a href="https://github.com/risik/tdd-book-java/commit/5a50b25dd6fb20df1b47b21f72b937197ac37cc7">add</a> only 3 lines: <br><br><pre> <code class="diff hljs"> enum HelloSayerType { InPlace, AtOnce, + Lazy, } @Theory @@ -53,6 +54,8 @@ private HelloSayer getFactory(HelloSayerType type, String whom) throws Exception return new HelloSayerInplace(whom); case AtOnce: return new HelloSayerAtOnce(whom); + case Lazy: + return new HelloSayerLazy(whom); } throw new Exception("Unknown HelloSayerType"); }</code> </pre><br>  Check that the code coverage is still 100%.  All perfectly! <br><br><h2>  Links and other necessary information </h2><br>  Java test <a href="https://github.com/risik/tdd-book-java">cases</a> : <a href="https://github.com/risik/tdd-book-java">github.com/risik/tdd-book-java</a> <br>  Text of the original article: <a href="">github.com/risik/tdd-book/blob/master/helloworld/simple_test.ru.md</a> <br>  The text of the article prepared for habrahabr.ru: <a href="https://github.com/risik/tdd-book/blob/master/helloworld/simple_test.ru.habr.txt">github.com/risik/tdd-book/blob/master/helloworld/simple_test.ru.habr.txt</a> <br>  License: <a href="">CC-BY-NC-SA</a> </div><p>Source: <a href="https://habr.com/ru/post/259859/">https://habr.com/ru/post/259859/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../259847/index.html">Model rover MSL Curiosity</a></li>
<li><a href="../259849/index.html">The crash of the satellite Express-MD1 (July 4, 2013)</a></li>
<li><a href="../259853/index.html">Swift 2.0 will be open source at the end of the year.</a></li>
<li><a href="../259855/index.html">Multidimensional Mtree Tree</a></li>
<li><a href="../259857/index.html">Development of a large scalable web 2.0 project from scratch (social network for 100 million users) - an interview with the leading master class at DevConf 2015</a></li>
<li><a href="../259863/index.html">Visual call graph: VTune Amplifier and beyond</a></li>
<li><a href="../259865/index.html">Mad PHP. Fury code</a></li>
<li><a href="../259867/index.html">Should robots teach children to talk?</a></li>
<li><a href="../259869/index.html">Kubotronic expands horizons</a></li>
<li><a href="../259871/index.html">Graphics Intel Core processors. Quick Reference Guide</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>