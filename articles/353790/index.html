<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Go: Good, bad, angry</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Go has some great properties that the ‚ÄúGood‚Äù section is about. But when it comes to using this language not for creating APIs or network servers (for ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Go: Good, bad, angry</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/ir/c9/xg/irc9xgaj21rqupuv9ogq1jz0t4a.jpeg"><br><p>  Go has some great properties that the ‚ÄúGood‚Äù section is about.  But when it comes to using this language not for creating APIs or network servers (for which it was developed), but for implementing business logic, I consider Go too clumsy and inconvenient.  Although even within the framework of network programming, there are quite a few pitfalls in the language architecture as well as in the implementation, which makes Go dangerous, despite its apparent simplicity. </p><a name="habracut"></a><br><p>  I decided to write this article after applying Go in one of the minor projects.  I actively used this language in a previous project when writing a proxy (HTTP and TCP) for the SaaS service.  I liked working on the network part (I studied the language along the way), but the accounting and billing parts were hard for me.  My minor project was a simple API, and it seemed to me that using Go I could quickly write it.  But, as you know, many projects are more difficult as a result than expected.  I had to implement data processing for calculating statistics, and again I ran into the disadvantages of Go.  This article is a story about the troubles I have experienced. </p><br><p>  About me: I like statically typed languages.  My first significant programs were written in Pascal.  In the early 1990s, I used Ada and C / C ++, then switched to Java, then to Scala (there was a bit of Go between them), and recently began to learn Rust.  I also wrote a large amount of JavaScript code, because until recently, only this language was available in browsers.  I feel uncomfortable when working with dynamically typed languages ‚Äã‚Äãand I try to limit their use to simple scripts.  I like the imperative, functional and object-oriented approaches. </p><br><p>  The article is long, so you can navigate by content: </p><br><ul><li>  <a href="https://habr.com/ru/company/mailru/blog/353790/">Good</a> <br><ul><li>  <a href="https://habr.com/ru/company/mailru/blog/353790/">Go is easy to learn</a> </li><li>  <a href="https://habr.com/ru/company/mailru/blog/353790/">Simple multithreaded programming with Gorutin and channels</a> </li><li>  <a href="https://habr.com/ru/company/mailru/blog/353790/">Excellent standard library</a> </li><li>  <a href="https://habr.com/ru/company/mailru/blog/353790/">Performance</a> </li><li>  <a href="https://habr.com/ru/company/mailru/blog/353790/">The format of the source code is determined by the language</a> </li><li>  <a href="https://habr.com/ru/company/mailru/blog/353790/">Standardized Test Framework</a> </li><li>  <a href="https://habr.com/ru/company/mailru/blog/353790/">Go programs are very easy to use.</a> </li><li>  <a href="https://habr.com/ru/company/mailru/blog/353790/">The expression defer helps not to forget about cleaning</a> </li><li>  <a href="https://habr.com/ru/company/mailru/blog/353790/">New types</a> </li></ul></li><li>  <a href="https://habr.com/ru/company/mailru/blog/353790/">Bad</a> <br><ul><li>  <a href="https://habr.com/ru/company/mailru/blog/353790/">Go ignores the achievements of modern language design</a> </li><li>  <a href="https://habr.com/ru/company/mailru/blog/353790/">Interfaces are structural types.</a> </li><li>  <a href="https://habr.com/ru/company/mailru/blog/353790/">Lack of transfers</a> </li><li>  <a href="https://habr.com/ru/company/mailru/blog/353790/">Dilemma: = / var</a> </li><li>  <a href="https://habr.com/ru/company/mailru/blog/353790/">Zero values ‚Äã‚Äãcause panic.</a> </li><li>  <a href="https://habr.com/ru/company/mailru/blog/353790/">There are no exceptions in Go.</a>  <a href="https://habr.com/ru/company/mailru/blog/353790/">Although wait ... they are!</a> </li></ul></li><li>  <a href="https://habr.com/ru/company/mailru/blog/353790/">Evil</a> <br><ul><li>  <a href="https://habr.com/ru/company/mailru/blog/353790/">Addiction management nightmare</a> </li><li>  <a href="https://habr.com/ru/company/mailru/blog/353790/">Variability is strictly written in the language</a> </li><li>  <a href="https://habr.com/ru/company/mailru/blog/353790/">Tricks of slices</a> </li><li>  <a href="https://habr.com/ru/company/mailru/blog/353790/">Variability and channels: it is easy to arrive at a race condition</a> </li><li>  <a href="https://habr.com/ru/company/mailru/blog/353790/">Inconvenient Error Management</a> </li><li>  <a href="https://habr.com/ru/company/mailru/blog/353790/">Interface nil values</a> </li><li>  <a href="https://habr.com/ru/company/mailru/blog/353790/">Tags of fields struct: runtime DSL in string</a> </li><li>  <a href="https://habr.com/ru/company/mailru/blog/353790/">There are no generic types ... at least for you.</a> </li><li>  <a href="https://habr.com/ru/company/mailru/blog/353790/">Go has few data structures besides slice and map</a> </li><li>  <a href="https://habr.com/ru/company/mailru/blog/353790/">go generate: not bad, but ...</a> </li></ul></li><li>  <a href="https://habr.com/ru/company/mailru/blog/353790/">Conclusion</a> </li><li>  <a href="https://habr.com/ru/company/mailru/blog/353790/">A few days later...</a> </li></ul><br><h2 id="anchor1anchorhoroshiy"><a name="1"></a>  Good </h2><br><h3 id="anchor2anchorgo-prost-v-izuchenii"><a name="2"></a>  Go is easy to learn </h3><br><p>  This is a fact: if you know all kinds of programming languages, you can use the <a href="https://tour.golang.org/welcome/1">Tour of Go</a> to learn the Go syntax for a couple of hours, and after a couple of days, start writing real programs.  Check out <a href="https://golang.org/doc/effective_go.html">Effective Go</a> , learn the <a href="https://golang.org/pkg/">standard library</a> , play around with the <a href="http://www.gorillatoolkit.org/">Gorilla</a> web tools or the <a href="https://gokit.io/">Go kit</a> , and become a very decent Go developer. </p><br><p>  It's all about the comprehensive simplicity of the language.  When I started to learn Go, it reminded me of the times of my <a href="https://en.wikipedia.org/wiki/Java_version_history">acquaintance with Java</a> : it‚Äôs also a simple and rich language, a standard library with no frills.  Learning Go was an enjoyable experience against the backdrop of today's heavy Java environment.  Due to the simplicity of the language, the code on Go is very easy to read, even if the error-handling blocks somewhat complicate the listing (see below). </p><br><p>  But this simplicity may be false.  As Rob Pike said, ‚Äú <a href="https://talks.golang.org/2015/simplicity-is-complicated.slide">simplicity is complicated,</a> ‚Äù and below we will see that a large number of pitfalls await you, and that simplicity and minimalism impede writing a DRY code. </p><br><h3 id="anchor3anchorprostoe-mnogopotochnoe-programmirovanie-s-pomoschyu-gorutin-i-kanalov"><a name="3"></a>  Simple multithreaded programming with Gorutin and channels </h3><br><p>  Perhaps the gorutinas are the best feature of Go.  These are small calculation threads separated from the OS calculation threads. </p><br><p>  When a Go program executes what looks like a blocking I / O operation, the Go runtime suspends the gorutin and returns to it when an event occurs that signals the availability of some result.  In the meantime, a queue of other gorutin execution is being drawn up.  This gives us the scaling capabilities that are characteristic of asynchronous programming, as part of synchronous programming. </p><br><p>  Gorthinas also consume few resources: their stack can <a href="https://dave.cheney.net/2013/06/02/why-is-a-goroutines-stack-infinite">grow and shrink at your will</a> , so you can easily have hundreds, and even thousands of them. </p><br><p>  Once I ran into a leak of gorutin in the application: before they were completed, they were expecting the closure of the channel, but that did not close (standard deadlock problem).  The process, without any reason, consumed 90% of the processor's resources, and when studying <a href="https://golang.org/pkg/expvar/">expvars,</a> it turned out that 600,000 gorutines are standing still!  I guess the processor was occupied by their dispatcher. </p><br><p>  Of course, a system of actors like Akka can <a href="https://doc.akka.io/docs/akka/2.5/general/actor-systems.html">process millions of actors</a> without any effort, in part because they do not have a stack.  But with the help of Gorutin it is much easier to create highly parallelized applications that operate according to the request-response scheme (for example, HTTP API). </p><br><p>  Channels are designed for interaction between gorutin: they provide a convenient model for sending and receiving data with gorutins, without relying on unreliable low-level synchronization primitives.  Channels have their own set <a href="https://blog.golang.org/go-concurrency-patterns-timing-out-and">of usage patterns</a> . </p><br><p>  However, the channels should be used deliberately, because if the size is chosen incorrectly (the channels are not buffered by definition) <a href="https://www.danmrichards.com/blog/2018/03/26/goroutines-channels-and-waitgroups/">deadlocks can occur</a> .  Below, we will see that due to the lack of immutability in Go, the use of channels does not prevent the race condition. </p><br><h3 id="anchor4anchorprekrasnaya-standartnaya-biblioteka"><a name="4"></a>  Excellent standard library </h3><br><p>  <a href="https://golang.org/pkg/">The standard</a> Go <a href="https://golang.org/pkg/">library is</a> really great, especially when it comes to the development of network protocols or APIs: it has an HTTP client and server, encryption, archiving formats, compression, sending letters, and so on.  There is even an HTML parser and a fairly powerful template engine that allows you to create text and HTML with automatic escaping to protect against XSS (for example, used in <a href="https://gohugo.io/templates/introduction/">Hugo</a> ). </p><br><p>  The various APIs are generally simple and easy to understand.  Although sometimes they may look overly simplistic: partly because of the gorutin model, that is, we need to take care of operations that seem synchronous, and partly because several universal functions can replace many specialized ones, <a href="https://bluxte.net/musings/2018/03/22/local-date-time-calculations-in-go/">as I recently found out in time calculations</a> . </p><br><h3 id="anchor5anchorproizvoditelnost"><a name="5"></a>  Performance </h3><br><p>  Go is compiled into native executables.  Many programmers come to Go from Python, Ruby or Node.js.  They are simply blown away by this possibility, since the server is capable of handling a huge number of simultaneous requests.  The same can be said about those who switch from interpreted languages ‚Äã‚Äãwithout parallelization (Node.js) or with global interpreter locking.  Combined with the simplicity of the language, this contributes to Go's popularity. </p><br><p>  But compared to Java, the situation in <a href="https://www.techempower.com/benchmarks/">performance benchmarks is</a> not so straightforward.  But Go is better than Java in terms of memory usage and garbage collection. </p><br><p>  The garbage collector in Go is designed to take into account the <a href="https://blog.golang.org/go15gc">priority of delay</a> and avoidance of large pauses, which is especially important for servers.  It may consume more processor resources, but in a horizontally scalable architecture this is easily solved by adding machines.  Do not forget that Go was created in Google, which barely have enough resources! </p><br><p>  Compared to Java, the garbage collector in Go does less work: structure slices are contiguous arrays of structures, not arrays of pointers, as in Java.  Maps in Go also use <a href="">small arrays as</a> buckets.  As a result, the garbage collector has to do less work, which improves the locality of the processor cache. </p><br><p>  Also, Go is better than Java when used via the command line: given the native nature of the executable files, the Go program has no startup cost, unlike Java, which first has to load and compile bytecode. </p><br><h3 id="anchor6anchorformat-ishodnogo-koda-opredelyaetsya-yazykom"><a name="6"></a>  The format of the source code is determined by the language </h3><br><p>               . Go   ,   .  <code>gofmt</code>     -  .</p><br>
<p>    , <code>gofmt</code> ,       Go,         !</p><br>
<h3 id="anchor7anchorstandartizirovannyy-testovyy-freymvork"><a name="7"></a>  </h3><br>
<p>Go    <a href="https://golang.org/pkg/testing/"> </a>   .      ,            .</p><br>
<h3 id="anchor8anchorprogrammy-na-go-ochen-udobny-v-ekspluatacii"><a name="8"></a>  Go    </h3><br>
<p>   Python, Ruby  Node.js,     ‚Äî    . ,             Docker,         .</p><br>
<p>  Go          <code>expvar</code>,      ,    .   ,      <a href="https://golang.org/pkg/expvar/"> </a> ‚Äî  ‚Äî   HTTP-  .  Java      JMX,      .</p><br>
<h3 id="anchor9anchorvyrazhenie-defer-pomogaet-ne-zabyt-ob-ochistke"><a name="9"></a> defer     </h3><br>
<p> defer    ,   <code>finally</code>  Java:       ,    ,    . ,  <code>defer</code>           .          ,   ,   :</p><br>
<pre><code>file, err := os.Open(fileName)
if err != nil {
    return
}
defer file.Close()

// use file, we don't have to think about closing it anymore</code></pre><br>
<p>, <a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html">try-with-resource</a>  Java   ,   Rust <a href="https://doc.rust-lang.org/rust-by-example/trait/drop.html">  </a>,    ,   Go <em></em>   ,            .</p><br>
<h3 id="anchor10anchornovye-tipy"><a name="10"></a> </h3><br>
<p>  ,     , ,  ,        (persisted object identifiers)   <code>string</code>  <code>long</code>.        ,          ,     ,      .</p><br>
<p> Go     ‚Äî   ,         ,   .    ,         .      :</p><br>
<pre><code>type UserId string // &lt;-- new type
type ProductId string

func AddProduct(userId UserId, productId ProductId) {}

func main() {
    userId := UserId("some-user-id")
    productId := ProductId("some-product-id")

    // Right order: all fine
    AddProduct(userId, productId)

    // Wrong order: would compile with raw strings
    AddProduct(productId, userId)
    // Compilation errors:
    // cannot use productId (type ProductId) as type UserId in argument to AddProduct
    // cannot use userId (type UserId) as type ProductId in argument to AddProduct
}</code></pre><br>
<p> ,       ,           /  .</p><br>
<h2 id="anchor11anchorplohoy"><a name="11"></a></h2><br>
<h3 id="anchor12anchorgo-ignoriruet-dostizheniya-sovremennogo-proektirovaniya-yazykov"><a name="12"></a>Go     </h3><br>
<p>  <a href="https://commandcenter.blogspot.fr/2012/06/less-is-exponentially-more.html">Less is exponentially more</a>   ,  Google  Go       ++,      <a href="https://swtch.com/~rsc/thread/newsqueak.pdf">Newsqueak</a>,   1980-.   Go     <a href="https://en.wikipedia.org/wiki/Plan_9_from_Bell_Labs">Plan9</a>,  ,   Go   Bell Labs  1980-.</p><br>
<p> <a href="https://golang.org/doc/asm"> Go</a>     Plan9.     <a href="https://llvm.org/">LLVM</a>,        ? ,  - ,      ?     ,     ,         ?</p><br>
<p> Go  ,   ,        (   Plan9?),      ,         1990-  2000-.   Go   ,      .</p><br>
<p> ?   .  ?    , ,  -    ++!     ,  , map   <strong></strong>  ,    .</p><br>
<p>Go       ++,  ,        .    . ,       .  -    ,   ,      .    ,             . ,   Rust           .</p><br>
<p>    , Go      Python  Ruby.         //.     ,      .    Go  Docker,        DevOps.   Kubernetes   .</p><br>
<h3 id="anchor13anchorinterfeysy-i-strukturnye-tipy"><a name="13"></a>   </h3><br>
<p> Go    Java   Scala  Rust:   ,     (     ¬´¬ª).</p><br>
<p>,     Java   Scala  Rust,     ,    :      ,   .    Go    <a href="https://en.wikipedia.org/wiki/Structural_type_system"> </a>.</p><br>
<p>  ,         ,    ,    ,       Scala  Kotlin,    Rust.    :  ,   ,      .</p><br>
<p>Go ‚Äî   ,   ,       :</p><br>
<ul>
<li> ,     ,        (function definition matching).  Java  Scala     ,   ,  .</li>
<li>   ,  ,   ,          .        .    ,         .</li>
<li>     -  .        ,       ,      .</li>
</ul><br>
<p><em></em>:    ,   ¬´ nil-¬ª.</p><br>
<h3 id="anchor14anchorotsutstvie-perechisleniy"><a name="14"></a> </h3><br>
<p> Go  ,      .</p><br>
<p>  <code>iota</code>,    ,     ,  .   ,        iota ,       .        ,    .</p><br>
<p>  ,     ,    <code>switch</code> ,        .</p><br>
<h2 id="anchor15anchordilemma---var"><a name="15"></a> := / var</h2><br>
<p> Go         : <code>var x = "foo"</code>  <code>x := "foo"</code>. ?</p><br>
<p>   ,  <code>var</code>     (   ),     <code>var x string</code>,  <code>:=</code>         . ,  <code>:=</code>   <strong></strong>   :</p><br>
<pre><code> var:
var x, err1 = SomeFunction()
if (err1 != nil) {
  return nil
}

var y, err2 = SomeOtherFunction()
if (err2 != nil) {
  return nil
}
C:=:
x, err := SomeFunction()
if (err != nil) {
  return nil
}

y, err := SomeOtherFunction()
if (err != nil) {
  return nil
}</code></pre><br>
<p> <code>:=</code>   ¬´¬ª .      ,  <code>:=</code> (  )    <code>=</code> ():</p><br>
<pre><code>foo := "bar"
if someCondition {
  foo := "baz"
  doSomething(foo)
}
// foo == "bar" even if "someCondition" is true</code></pre><br>
<h3 id="anchor16anchornulevye-znacheniya-privodyat-k-panike"><a name="16"></a>    </h3><br>
<p> Go  .  ,  "<a href="https://dave.cheney.net/2013/01/19/what-is-the-zero-value-and-why-is-it-useful"> </a>"    .  ,   ,           (language implementors).</p><br>
<p> ,         .    <code>io.File</code>,    <a href="https://golang.org/doc/effective_go.html">Effective Go</a>:</p><br>
<pre><code>type File struct {
    *file // os specific
}

func (f *File) Name() string {
    return f.name
}

func (f *File) Read(b []byte) (n int, err error) {
    if err := f.checkValid("read"); err != nil {
        return 0, err
    }
    n, e := f.read(b)
    return n, f.wrapErr("read", e)
}

func (f *File) checkValid(op string) error {
    if f == nil {
        return ErrInvalid
    }
    return nil
}</code></pre><br>
<p>  ?</p><br>
<ul>
<li> <code>Name()</code>     <code>File</code>   ,   <code>file</code>  nil.</li>
<li> <code>Read</code>,   <a href="">   </a> <code>File</code>,     .</li>
</ul><br>
<p> ,  , <code>File</code>      ,      .  <strong></strong>    -  <code>Open</code>  <code>Create</code>.     ‚Äî   ,        .</p><br>
<p>     ,  ,      -     .        <code>html.Template</code>:   .</p><br>
<p>       <code>map</code>:    ,      - ,  :</p><br>
<pre><code>var m1 = map[string]string{} // empty map
var m0 map[string]string     // zero map (nil)

println(len(m1))   // outputs '0'
println(len(m0))   // outputs '0'
println(m1["foo"]) // outputs ''
println(m0["foo"]) // outputs ''
m1["foo"] = "bar"  // ok
m0["foo"] = "bar"  // panics!</code></pre><br>
<p>      ,     <code>map</code>,      ,     - .</p><br>
<p>  ,  ,    ,      -,     .      .</p><br>
<h3 id="anchor17anchorv-go-net-isklyucheniy-hotya-pogodite-oni-est"><a name="17"></a> Go  .  ‚Ä¶  !</h3><br>
<p>  "<a href="https://dave.cheney.net/2012/01/18/why-go-gets-exceptions-right">Why Go gets exceptions right</a>"  ,         Go,    <code>error</code>.     ,           ,   Java (  ,   Go     ,    ).    ,  <code>panic</code> ¬´    ,  ¬ª.</p><br>
<p>  "<a href="https://blog.golang.org/defer-panic-and-recover">Defer, panic and recover</a>" ,      (  ),  : ¬´          JSON-    Go¬ª.</p><br>
<p>,  JSON-  <a href="">   </a>,   .        <code>unmarshal</code>,  <a href="">  </a>     ,   ¬´ ¬ª,         (     ).</p><br>
<p>  Java-    <code>try / catch (DecodingException ex)</code>.     Go ,     ,    .</p><br>
<p> :    <a href="https://github.com/golang/go/commit/74a92b8e8d0eae6bf9918ef16794b0363886713d"> JSON-</a>,       .</p><br>
<h2 id="anchor18anchorzloy"><a name="18"></a></h2><br>
<h3 id="anchor19anchorkoshmar-upravleniya-zavisimostyami"><a name="19"></a>  </h3><br>
<p>    (Jaana Dogan, aka JBD),    Google,       Twitter:</p><br>
<p><em>        ,    Go      .            .</em></p><br>
<p><em>‚Äî JBD (@rakyll) <a href="https://twitter.com/rakyll/status/976563654731579392%3Fref_src%3Dtwsrc%255Etfw">March 21, 2018</a></em></p><br>
<p> :  Go   .    ‚Äî    .</p><br>
<p>    ,     Google,        <a href="https://research.google.com/pubs/pub45424.html">  </a>.     ,     ,        .  ,       .</p><br>
<p> Go            <code>GOPATH</code>.   ?        -,     .        ?   .     ¬´¬ª.</p><br>
<p> ,      <code>GOPATH</code>,      . ,        ?    <code>GOPATH</code>     .</p><br>
<p>  <a href="https://github.com/golang/go/wiki/PackageManagementTools">  </a>    .     ,      ,   (lock files)  Git sha1,   .</p><br>
<p>,  Go 1.6  <a href="https://golang.org/cmd/go/"> </a>  <code>vendor</code>.    ,   ,     .         ,      <a href="https://semver.org/"> </a>.</p><br>
<p>    :    <code>dep</code>, <a href="https://golang.github.io/dep/">   </a>  .    (git-)      (version solver),     .   ,    . ,        <code>GOPATH</code>.</p><br>
<p> <code>dep</code>   ,   <code>vgo</code>,    Google,      Go      .</p><br>
<p>   Go .   ,     ,                 <code>GOPATH</code>...</p><br>
<p>   .</p><br>
<h3 id="anchor20anchorizmenyaemost-zhyostko-propisana-v-yazyke"><a name="20"></a>    </h3><br>
<p> Go    :  <code>struct</code>  ,    <code>const</code>    .   Go        ,    ,         ,     .</p><br>
<p>      ,    .     (map,   )    ,  ,    ,          .</p><br>
<p>  :</p><br>
<pre><code>type S struct {
    A string
    B []string
}

func main() {
    x := S{"x-A", []string{"x-B"}}
    y := x // copy the struct
    y.A = "y-A"
    y.B[0] = "y-B"

    fmt.Println(x, y)
    // Outputs "{x-A [y-B]} {y-A [y-B]}" -- x was modified!
}</code></pre><br>
<p>       ,   ,     .</p><br>
<p> <a href="https://github.com/jinzhu/copier">  </a>,        ()  (reflection),       ,         .            ,       .  Go    <code>Clone</code>,     .</p><br>
<h3 id="anchor21anchorpodvohi-slaysov"><a name="21"></a> </h3><br>
<p>      .    "<a href="https://blog.golang.org/go-slices-usage-and-internals">Go slices: usage and internals</a>",   ,        .  ,   ,   -       (view),    .        <code>copy()</code>,      .</p><br>
<p>    <code>copy()</code>,         <code>append:</code>        , <strong>     </strong>    .         <code>append</code>     ,     .      ,  .</p><br>
<p>   ,   ,    ,     :</p><br>
<pre><code>func doStuff(value []string) {
    fmt.Printf("value=%v\n", value)

    value2 := value[:]
    value2 = append(value2, "b")
    fmt.Printf("value=%v, value2=%v\n", value, value2)

    value2[0] = "z"
    fmt.Printf("value=%v, value2=%v\n", value, value2)
}

func main() {
    slice1 := []string{"a"} // length 1, capacity 1

    doStuff(slice1)
    // Output:
    // value=[a] -- ok
    // value=[a], value2=[a b] -- ok: value unchanged, value2 updated
    // value=[a], value2=[z b] -- ok: value unchanged, value2 updated

    slice10 := make([]string, 1, 10) // length 1, capacity 10
    slice10[0] = "a"

    doStuff(slice10)
    // Output:
    // value=[a] -- ok
    // value=[a], value2=[a b] -- ok: value unchanged, value2 updated
    // value=[z], value2=[z b] -- WTF?!? value changed???
}</code></pre><br>
<h3 id="anchor22anchorizmenyaemost-i-kanaly-legko-pridti-k-sostoyaniyu-gonki"><a name="22"></a>  :     </h3><br>
<p>  Go <a href="https://golang.org/doc/faq">  CSP,  </a>,              .    ¬´<a href="https://blog.golang.org/share-memory-by-communicating">     ,      </a>¬ª.   ,       .</p><br>
<p>   ,  Go     .       ,    :       . ,   (  )     , ,   ,     ,    map,     .      <code>struct</code>  :  ,    ,  ,     .</p><br>
<p> ,      ,         .     -     map.</p><br>
<p>     :  Go  <a href="https://blog.golang.org/race-detector">   </a>,        .             ,           ,  ,    .  production     -  runtime-,   ,  .</p><br>
<h3 id="anchor23anchorneudobnoe-upravlenie-oshibkami"><a name="23"></a>  </h3><br>
<p> Go        ,    :</p><br>
<pre><code>someData, err := SomeFunction()
if err != nil {
    return err;
}</code></pre><br>
<p> Go ,     (   ),  ,     ,       <code>error</code>.      ,   -,           Go   .</p><br>
<p>          ¬´,  ¬ª,      ,             .</p><br>
<p>     :     , , ,     <code>io.Reader</code>:</p><br>
<pre><code>len, err := reader.Read(bytes)
if err != nil {
    if err == io.EOF {
        // All good, end of file
    } else {
        return err
    }
}</code></pre><br>
<p>  "<a href="https://blog.golang.org/errors-are-values">Error has values</a>"          .     :</p><br>
<pre><code>type errWriter struct {
    w   io.Writer
    err error
}

func (ew *errWriter) write(buf []byte) {
    if ew.err != nil {
        return // Write nothing if we already errored-out
    }
    _, ew.err = ew.w.Write(buf)
}

func doIt(fd io.Writer) {
    ew := &amp;errWriter{w: fd}
    ew.write(p0[a:b])
    ew.write(p1[c:d])
    ew.write(p2[e:f])
    // and so on
    if ew.err != nil {
        return ew.err
    }
}</code></pre><br>
<p> ,  ,       ,         .    ,    ,     ,  ,   ,     .      ,   ?     -     Go.</p><br>
<p> Rust   :      ( ,    Go), ,   ,  <code>Result&lt;T, Error&gt;</code>     .   Rust 1.0   <code>try!</code>,    , <a href="https://doc.rust-lang.org/rust-by-example/error/result/enter_question_mark.html">      </a>.         .</p><br>
<p>    Rust  Go,  , ,    Go    ,  .</p><br>
<h3 id="anchor24anchorinterfeysnye-nil-znacheniya"><a name="24"></a> nil-</h3><br>
<p>  Reddit <a href="https://www.reddit.com/r/programming/comments/8bj4yc/go_the_good_the_bad_and_the_ugly/dx82cgz/">jmickeyd</a>    <code>nil</code>  ,      . :</p><br>
<pre><code>type Explodes interface {
    Bang()
    Boom()
}

// Type Bomb implements Explodes
type Bomb struct {}
func (*Bomb) Bang() {}
func (Bomb) Boom() {}

func main() {
    var bomb *Bomb = nil
    var explodes Explodes = bomb
    println(bomb, explodes) // '0x0 (0x10a7060,0x0)'
    if explodes != nil {
        explodes.Bang() // works fine
        explodes.Boom() // panic: value method main.Bomb.Boom called using nil *Bomb pointer
    }
}</code></pre><br>
<p> ,  <code>explodes</code>   <code>nil</code>,     <code>Boom</code>,    <code>Bang</code>. ?     <code>println:</code>  <code>bomb</code>   <code>0x0</code>,   ‚Äî <code>nil</code>,  <code>explodes</code>   <code>nil (0x10a7060,0x0)</code>.</p><br>
<p>    ‚Äî      (method dispatch table)    <code>Bomb</code>  <code>Explodes</code>,   ‚Äî    <code>Explodes</code>,   <code>nil</code>.</p><br>
<p> <code>Bang</code> ,      <strong></strong>  <code>Bomb:</code>       .  <code>Boom</code>   <strong></strong>,       ,   .</p><br>
<p> ,    <code>var explodes Explodes = nil</code>,  <code>!= nil</code>    .</p><br>
<p>    ?    <code>nil</code>   ,     <code>nil</code>, ‚Ä¶     ,     !</p><br>
<pre><code>if explodes != nil &amp;&amp; !reflect.ValueOf(explodes).IsNil() {
    explodes.Bang() // works fine
    explodes.Boom() // works fine
}</code></pre><br>
<p>  ?  <code>Tour of Go</code>  <a href="https://tour.golang.org/methods/12"> </a>   ,    : ¬´<em> ,   ,   nil-,      nil</em>¬ª.</p><br>
<p> ,       .        ,  -  .</p><br>
<h3 id="anchor25anchortegi-poley-struct-runtime-dsl-v-strokovyh"><a name="25"></a>  struct: runtime DSL  </h3><br>
<p>   JSON  Go,     - :</p><br>
<pre><code>type User struct {
    Id string    `json:"id"`
    Email string `json:"email"`
    Name string  `json:"name,omitempty"`
}</code></pre><br>
<p> <a href="https://golang.org/ref/spec"> struct</a>,    .  ¬´    (reflection interface)     struct‚Äô,    ¬ª.        ,    runtime    .     runtime,   .</p><br>
<p>     ,         ¬´<a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D0%25BD%25D0%25BD%25D0%25BE%25D1%2582%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F_(Java)"></a>¬ª  ¬´¬ª.   ,        ,    .</p><br>
<p>  Go    ,        DSL,    runtime?</p><br>
<p>   ,     .       <a href="https://godoc.org/github.com/golang/protobuf/proto"> Go</a>:</p><br>
<pre><code>type Test struct {
    Label         *string             `protobuf:"bytes,1,req,name=label" json:"label,omitempty"`
    Type          *int32              `protobuf:"varint,2,opt,name=type,def=77" json:"type,omitempty"`
    Reps          []int64             `protobuf:"varint,3,rep,name=reps" json:"reps,omitempty"`
    Optionalgroup *Test_OptionalGroup `protobuf:"group,4,opt,name=OptionalGroup" json:"optionalgroup,omitempty"`
}</code></pre><br>
<p>:        JSON?       Go   <code>UpperCamelCase</code>,       ,          JSON   <code>lowerCamelCase  snake_case</code>.      .</p><br>
<p> / JSON        ,    <a href="">Jackson  Java</a>. ,  ,     Docker API    <code>UpperCamelCase</code>:           API.</p><br>
<h3 id="anchor26anchorobobschyonnyh-tipov-net-po-krayney-mere-dlya-vas"><a name="26"></a>  ‚Ä¶   ,  </h3><br>
<p>   ,      ,      Go:     ‚Ä¶ , ,  .    ,   ,       .</p><br>
<p> , map,    <strong></strong>  .  <code>map [string]MyStruct</code>         .   ,          .</p><br>
<p>  Go      .  ,          ,     .    <code>interface{}</code>      .       runtime    .  Java-    <a href="https://en.wikipedia.org/wiki/Java_version_history">JSE 5.0 2004 </a>.</p><br>
<p>  "<a href="https://commandcenter.blogspot.fr/2012/06/less-is-exponentially-more.html">Less is exponentially more</a>"   -       ¬´ ¬ª  ,   ,   . ,      (     Scala    ),       :     .</p><br>
<p>   ,               ¬´¬ª      ‚Äî      Go.</p><br>
<h3 id="anchor27anchorv-go-malo-struktur-dannyh-pomimo-slice-i-map"><a name="27"></a> Go     slice  map</h3><br>
<p>  Go   ,    -     slice  map.    Go   <a href="https://golang.org/pkg/container/"></a>,    .      :     <code>interface{}</code>,    .</p><br>
<p>   <code>sync.Map</code> ‚Äî   map        (thread contention)      map   :</p><br>
<pre><code>type MetricValue struct {
    Value float64
    Time time.Time
}

func main() {
    metric := MetricValue{
        Value: 1.0,
        Time: time.Now(),
    }

    // Store a value

    m0 := map[string]MetricValue{}
    m0["foo"] = metric

    m1 := sync.Map{}
    m1.Store("foo", metric) // not type-checked

    // Load a value and print its square

    foo0 := m0["foo"].Value // rely on zero-value hack if not present
    fmt.Printf("Foo square = %f\n", math.Pow(foo0, 2))

    foo1 := 0.0
    if x, ok := m1.Load("foo"); ok { // have to make sure it's present (not bad, actually)
        foo1 = x.(MetricValue).Value // cast interface{} value
    }
    fmt.Printf("Foo square = %f\n", math.Pow(foo1, 2))

    // Sum all elements

    sum0 := 0.0
    for _, v := range m0 { // built-in range iteration on map
        sum0 += v.Value
    }
    fmt.Printf("Sum = %f\n", sum0)

    sum1 := 0.0
    m1.Range(func(key, value interface{}) bool { // no 'range' for you! Provide a function
        sum1 += value.(MetricValue).Value        // with untyped interface{} parameters
        return true // continue iteration
    })
    fmt.Printf("Sum = %f\n", sum1)
}</code></pre><br>
<p> ,    Go    :          map.     ‚Äî  Go     :</p><br>
<ul>
<li>,  , map,   :   ,     <code>range</code>, </li>
<li>     Go:  ,   -    (casts).</li>
</ul><br>
<p>        ,          .</p><br>
<p>        ,       .      <a href="https://golang.org/pkg/sort/"></a> <code>sort</code>  :</p><br>
<pre><code>import "sort"

type Person struct {
    Name string
    Age  int
}

// ByAge implements sort.Interface for []Person based on the Age field.
type ByAge []Person

func (a ByAge) Len() int           { return len(a) }
func (a ByAge) Swap(i, j int)      { a[i], a[j] = a[j], a[i] }
func (a ByAge) Less(i, j int) bool { return a[i].Age &lt; a[j].Age }

func SortPeople(people []Person) {
    sort.Sort(ByAge(people))
}</code></pre><br>
<p>‚Ä¶ ?      <code>ByAge</code>,     ,    (  ¬´ ¬ª)     .</p><br>
<p><strong></strong>,    , , ‚Äî  <code>Less</code>,      - (domain-dependent).   ‚Äî    ,   ,   Go   .     <strong>   ,    </strong>.    .</p><br>
<p><em>:      <a href="https://golang.org/pkg/sort/">sort.Slice</a>.  ,      (!)          -,   .</em></p><br>
<p> ,  Go     ,    ¬´ Go¬ª,      ,      (downcasting) <code>interface{}</code>...</p><br>
<p> .         ,      , ?</p><br>
<h3 id="anchor28anchorgo-generate-neploho-no"><a name="28"></a>go generate: , ...</h3><br>
<p> Go 1.4  <a href="https://blog.golang.org/generate"></a> <code>go:generate</code>        . ,  ¬´¬ª    <code>//go:generate</code>   : ¬´           <code>//</code>  <code>go:generate</code>¬ª.   ,        .</p><br>
<p>    :</p><br>
<ul>
<li> Go-   :  ProtoBuf / Thrift / Swagger,   (language grammars)   .</li>
<li> Go-,   ,  <a href="https://godoc.org/golang.org/x/tools/cmd/stringer">stringer</a>,    <code>String()</code>    .</li>
</ul><br>
<p>    ,    ,        <code>Makefile‚Äò</code>,        ,     .</p><br>
<p>   ,   ,    Scala  Rust,   (  <a href="https://docs.google.com/document/d/1V03LUfjSADDooDMhe-_K59EgpTEm3V8uvQRuNMAEnjg/edit">  </a>),    AST     . Stringer <a href="">   Go</a>   AST.  Java   ,       .</p><br>
<p>     ,      ,    ¬´¬ª  , ,  ,       ,        .</p><br>
<p>,  ,    Go  <a href="https://dave.cheney.net/2018/01/08/gos-hidden-pragmas">/</a>  <a href="https://dave.cheney.net/2013/10/12/how-to-use-conditional-compilation-with-the-go-build-tool"> </a>,    ?</p><br>
<h2 id="anchor29anchorzaklyuchenie"><a name="29"></a></h2><br>
<p> ,   -   Go.   ,    ,           ,         ,        .</p><br>
<p>   Go    API   ,      .        ,    -,          .</p><br>
<p>         ,   Go:    ,      C  C++. <a href="https://www.rust-lang.org/">Rust</a>  ,       ,          .  ,  Rust ‚Äî    ,       ,       .</p><br>
<p>   ,     , ,  Rust  Go     ,  Rust ‚Äî   ,      ,   . ,      . Rust       <a href="http://www.arewewebyet.org/">-</a>   <a href="http://diesel.rs/">ORM</a>‚Äô.    ,  ¬´  ,       ,    ,    ¬ª.</p><br>
<p>  /service mesh    ,    <a href="https://www.sozu.io/">Sozu</a>,   Rust.  Buoyant ( <a href="https://linkerd.io/">Linkerd</a>)   Kubernetes-service mesh <a href="https://buoyant.io/2017/12/05/introducing-conduit/">Conduit</a>,   Go     (,   <a href="">Kubernetes-</a>),  Rust,     , ‚Äî     .</p><br>
<p><a href="https://swift.org/">Swift</a>      C  C++.       Apple-,      Linux    <a href="https://swift.org/server-apis/"> API</a>  <a href="https://github.com/apple/swift-nio"> Netty</a>.</p><br>
<p>,     ‚Äî  .      . ,        Go,     ,   .</p><br>
<h2 id="anchor30anchorneskolko-dney-spustya"><a name="30"></a>  ...</h2><br>
<p><em>    </em>:     .      <a href="https://news.ycombinator.com/item%3Fid%3D16830153">Hackernews</a> (   )  <a href="https://www.reddit.com/r/programming/comments/8bj4yc/go_the_good_the_bad_and_the_ugly/">/r/programming</a> (   ),   <a href="https%253A%252F%252Fbluxte.net%252Fmusings%252F2018%252F04%252F10%252Fgo-good-bad-ugly%252F">   Twitter</a>.</p><br>
<p>,  ,  (  <a href="https://www.reddit.com/r/golang/comments/8bj4tx/go_the_good_the_bad_and_the_ugly/">/r/golang/</a>),          . ,   <a href="https://www.reddit.com/r/rust/comments/8bjio2/xpost_from_rprogramming_go_the_good_the_bad_and/">/r/rust</a>     Rust.    - : ¬´  ,    ‚Äî  .     ¬ª.</p><br>
<p>            . ,   ,     ,        ,  ,   ,   ,    .</p><br>
<p> ,          <a href="https://golang.org/">golang.org</a>,     Go,              ¬´,   ,   ¬ª.</p><br>
<p>      ,    .     ,        (      ).      !</p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/353790/">https://habr.com/ru/post/353790/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../353776/index.html">We invite you to a workshop on React Native from the developer GeekBrains</a></li>
<li><a href="../353778/index.html">Classic JavaScript inheritance. Parsing the implementation in Babel, BackboneJS and Ember</a></li>
<li><a href="../353780/index.html">Comparison of the speed of different variants of Unity3D script interaction</a></li>
<li><a href="../353782/index.html">Video from the first Badoo PHP Meetup 04/07/2018</a></li>
<li><a href="../353784/index.html">ReactOS 0.4.8: We lured Dr. Watson</a></li>
<li><a href="../353792/index.html">Final of the International Student Programming Olympiad Live</a></li>
<li><a href="../353798/index.html">Package Registry on Ethereum</a></li>
<li><a href="../353800/index.html">Microsoft Office Security: VBA Macros</a></li>
<li><a href="../353802/index.html">Using Multifactor Authentication in Citrix Based on Aladdin RD Solutions - Webinar</a></li>
<li><a href="../353804/index.html">Flask Mega-Tutorial, Part XX: The Magic of JavaScript</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>