<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Three20 demystifying: TTModel</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Those who, because of the need to have to deal with Three20 , in the process of developing iOS applications, know that this library is more or less so...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Three20 demystifying: TTModel</h1><div class="post__text post__text-html js-mediator-article">  Those who, because of the need to have to deal with <a href="http://three20.info/">Three20</a> , in the process of developing iOS applications, know that this library is more or less solving a certain range of tasks related to rapid prototyping, using global navigation, MVC approach to developing applications. <br><br>  The main disadvantage of the library is that it lacks normal documentation, and one that <a href="http://three20.info/documentation">is</a> <a href="http://api.three20.info/annotated.php">not enough</a> for a normal understanding of what is happening inside this library. <br><br>  This is not the only minus of the library, and there are <a href="http://www.quora.com/What-are-the-pros-and-cons-of-using-Three20">many</a> <a href="http://stackoverflow.com/questions/3668479/three20-pros-and-cons">discussions</a> on the Internet regarding the pros and cons of Three20. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It must be said that the main developer <a href="http://cocoamanifest.net/linked/2011/08/nimbus-rebirth-of-three20.html">stopped development over</a> Three20, and decided to create a new <a href="http://nimbuskit.info/">Nimbus</a> library, the main idea of ‚Äã‚Äãwhich would be simplicity and high documentation: <br>  <i>‚ÄúNimbus is an iOS framework.‚Äù</i> <br><br>  Nevertheless, the project exists to this day, and some parts of this project deserve attention, and are sufficiently interesting from the point of view of design. <br><br>  In this post will be discussed in detail issues related to the work of <a href="http://api.three20.info/interface_t_t_model.php">TTModel</a> . <br><br>  For those who are not going to use Three20 in their projects, it will be useful to look at one of the possible, noteworthy, implementations of the model in the MVC pattern. <br><br>  Anyone else interested, please <a name="habracut"></a>  . <br><br><h2>  TTModel </h2><br><br>  Those who are still not familiar with the design pattern MVC (Model-View-Controller), or have forgotten what it is all about, can familiarize themselves with it on the <a href="http://ru.wikipedia.org/wiki/Model-View-Controller">Wiki</a> .  ( <i>‚ÄúRepetition is the mother of learning‚Äù</i> after all) <br><br><h3>  Architecture </h3><br><br>  So, the <i>TTModel</i> in the Three20 library is a classic MVC model.  That is, it is just an abstract data set that does not depend on the view or the controller. <br><br>  The TTModel architecture initially implies that the model may be in different states: <br><ul><li>  <i>- (BOOL) isLoaded</i> - The main flag, which indicates that the model is loaded, and contains relevant data </li><li>  <i>- (BOOL) isLoading</i> </li><li>  <i>- (BOOL) isLoadingMore</i> - the state of the model when the main data is loaded, but a request has been made for additional data </li><li>  <i>- (BOOL) isOutdated</i> - a flag indicating that the data in the model is out of date, and data reloading is necessary to restore the model to its current state </li></ul><br>  In addition, TTModel provides several basic methods for working with it. <br><ul><li>  <i>- (void) load: (TTURLRequestCachePolicy) cachePolicy more: (BOOL) more</i> - Method that causes actual data to be loaded into the model. </li><li>  <i>- (void) cancel</i> - Cancels the loading of data into the model </li><li>  <i>- (void) invalidate: (BOOL) erase</i> - a method that puts the model in a state of "irrelevance".  The erase parameter indicates the need to delete data from the cache. </li></ul><br><br>  This architectural solution is fully justified, and allows you to solve the problem with hiding the implementation of the model.  In fact, it doesn‚Äôt matter to us what the model is loaded with - whether it needs a query to the database to get up-to-date data, a query to the server, a call to 10 consecutive queries, or a complex computing task.  It is important for us to know her condition.  And as soon as the state has changed to <i>isLoaded</i> , we can take relevant data from this model. <br><br><pre><code class="hljs pgsql">//      DBRequestModel * someModel = [[DBRequestModel alloc] initWithQuery:@"SELECT * FROM TABLE USERS"]; //    [someModel <span class="hljs-keyword"><span class="hljs-keyword">load</span></span>:TTURLRequestCachePolicyNone more:<span class="hljs-keyword"><span class="hljs-keyword">NO</span></span>]; //    <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ([someModel isLoading]) { [[NSRunLoop currentRunLoop] runMode:NSDefaultRunLoopMode beforeDate:[NSDate distantFuture]]; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([someModel isLoaded]) { //    result DBRequestModel //   NSArray * users = [someModel result]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { //  ? }</code> </pre> <br>  <b>The above code is written solely to understand that the model does not immediately contain relevant data.</b> <br><br>  The code above could exist in some universe, but I would not advise using it in ours. <br><br><h3>  Tracking model state changes </h3><br><blockquote>  Why should we follow the change in the state of the model?  In order to know when it will be relevant data. </blockquote><br><br>  In order to monitor the state of the model, you must add an object (usually a controller) to the model <i>delegates</i> array. <br><br><pre> <code class="hljs css"><span class="hljs-selector-attr"><span class="hljs-selector-attr">[[someModel delegates]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addObject</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:self</span></span>];</code> </pre><br><br>  In turn, the model, when changing its state, will inform all its delegates about it through the <i>TTModelDelegate</i> protocol <br><br>  The <i>TTModelDelegate</i> protocol provides a set of methods from which you need to select several basic ones: <br><ul><li>  <i>(void) modelDidStartLoad: (id &lt;TTModel&gt;) model</i> - Indicates that the model has started downloading </li><li>  <i>(void) modelDidFinishLoad: (id &lt;TTModel&gt;) model</i> - Indicates that the model has successfully loaded data </li><li>  <i>(void) model: (id &lt;TTModel&gt;) model didFailLoadWithError: (NSError *) error</i> - Called when a <i>model has failed to</i> load.  The cause of the error is specified in the <i>error</i> variable. </li><li>  <i>(void) modelDidCancelLoad: (id &lt;TTModel&gt;) model</i> - Called if the model was canceled by calling the <i>cancel</i> method </li></ul><br><br>  So, by subscribing to the model changes, we implement the methods we need.  All of the above methods are optional, and allow you to focus solely on the functionality that we need. <br><br><pre> <code class="hljs ruby">- (void)showModelDataIfPossible { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>      <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.model = [[DBRequestModel alloc] <span class="hljs-symbol"><span class="hljs-symbol">initWithQuery:</span></span>@<span class="hljs-string"><span class="hljs-string">"SELECT * FROM TABLE USERS"</span></span>]; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>        [[[<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> model] delegates] <span class="hljs-symbol"><span class="hljs-symbol">addObject:</span></span><span class="hljs-keyword"><span class="hljs-keyword">self</span></span>]; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ,     /<span class="hljs-regexp"><span class="hljs-regexp">/        if (! [[self model] isLoaded] &amp;&amp; [[self model] isOutdated]) { /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    [someModel load:TTURLRequestCachePolicyNone more:NO]; } else { /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   ,           /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/     [self showModelData:[self model]]; } } #pragma mark - TTModelDelegate - (void)modelDidStartLoad:(id&lt;TTModel&gt;)model { /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   .. /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/       [self showLoading]; } - (void)modelDidFinishLoad:(id&lt;TTModel&gt;)model { /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      [self hideLoading]; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      [self showModelData:[self model]]; } - (void)model:(id&lt;TTModel&gt;)model didFailLoadWithError:(NSError*)error { /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      [self hideLoading]; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      User-Friendly  TTAlertNoTitle(@"Error code #10"); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   User-Friendly  [self showReloadScreen]; self.reloadLabel.title = @"Something went wrong" "But you could try to reload data"; } - (void)modelDidCancelLoad:(id&lt;TTModel&gt;)model { /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      [self hideLoading]; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      , /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/       /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  ,       /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    } - (void)showModelData:(id&lt;TTModel&gt;)model { /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    result DBRequestModel /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   NSArray * users = [someModel result]; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    [self showUsers:users]; }</span></span></code> </pre><br><br>  I hope it has become more or less clear what <i>TTModel is</i> and how to work with it.  Now let's talk a little about <i>delegates</i> from the model. <br><br><h3>  delegates vs listeners </h3><br><blockquote>  The <i>delegates</i> array in TTModel is a special array that does not retain objects when they are added.  It is created using the <i><a href="">TTCreateNonRetainingArray</a></i> function. <br>  This is done to avoid circular references, and to comply with the convention that the <i>delegate</i> <a href="http://stackoverflow.com/questions/918698/why-are-objective-c-delegates-usually-given-the-property-assign-instead-of-retai">should not be retaine'd</a> . </blockquote><br><br>  In fact, the name for the property is not entirely correct.  The delegate in its functionality should help the main object (in this case, the model) to solve the problem, and in the current implementation, the array of delegates is actually an array of listeners. <br><br>  The main difference between the listener and the delegate is that the <b>listener is informed</b> about changes in the base object, and <b>the delegate</b> is most often <b>asked for</b> some data that is necessary for the functioning of the base object. <br><br>  So, in fact, in TTModel an array of delegates based on functionality is an array of listeners. <br><br><h3>  TTURLRequestModel </h3><br>  For working with models that take data from the network, Three20 uses the <i>TTURLRequestModel</i> class.  It is tied to TTURLRequest and provides a clear example of the fact that you can simply hide a specific implementation of the model. <br><br>  <i>TTURLRequestModel</i> is essentially an abstract class, and doesn‚Äôt really know anything, except it adds a few additional fields to the model related to the network component. <br><br>  What else is interesting in this model, due to the lack of normal documentation, it is not immediately clear how it works, and how to use it correctly :) <br><br><h3>  Create your model? </h3><br><br>  Suppose a model should provide us with a list of some entities, let's call them for simplicity by users. <br><br>  The server provides data page by page.  On each page there are N users. <br><br>  Let's hit the road! <br><br>  Declaring interface <br><br><pre> <code class="hljs objectivec"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ItemsListModel</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TTURLRequestModel</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">NSMutableArray</span></span> * _items; <span class="hljs-comment"><span class="hljs-comment">/*  URL  */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> * _baseURLString; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _page; <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _itemsOnPage; } <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">NSMutableArray</span></span> * users; <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> * baseURLString; <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">assign</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> page; <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> itemsOnPage; <span class="hljs-comment"><span class="hljs-comment">/*   c  URL'      */</span></span> - (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>)initWithBaseURLString:(<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *)baseURLString itemsOnPage:(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)itemsOnPage; <span class="hljs-comment"><span class="hljs-comment">/* ,    TTURLRequest          */</span></span> - (TTURLRequest *)requestForDataWithCachePolicy:(TTURLRequestCachePolicy)cachePolicy more:(<span class="hljs-built_in"><span class="hljs-built_in">BOOL</span></span>) more; <span class="hljs-comment"><span class="hljs-comment">/* ,   NSData * data          */</span></span> - (<span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> *)parseDataToItems:(<span class="hljs-built_in"><span class="hljs-built_in">NSData</span></span> *)data error:(<span class="hljs-built_in"><span class="hljs-built_in">NSError</span></span> **)error; <span class="hljs-keyword"><span class="hljs-keyword">@end</span></span></code> </pre><br><br>  And, actually, we implement our model. <br><br><pre> <code class="hljs pgsql">@implementation ItemsListModel @synthesize items = _items; @synthesize itemsOnPage = _itemsOnPage; @synthesize baseURLString = _baseURLString; @synthesize page = _page; <span class="hljs-comment"><span class="hljs-comment">/*   .   .      0 */</span></span> - (id)initWithBaseURLString:(NSString *)baseURLString itemsOnPage:(<span class="hljs-type"><span class="hljs-type">int</span></span>)itemsOnPage { self = [super init]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (self) { _baseURLString = [baseURLString <span class="hljs-keyword"><span class="hljs-keyword">copy</span></span>]; _itemsOnPage = itemsOnPage; _page = <span class="hljs-number"><span class="hljs-number">0</span></span>; _items = [[NSMutableArray <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>] retain]; _itemsOnPage = <span class="hljs-number"><span class="hljs-number">20</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self; } <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> - (<span class="hljs-type"><span class="hljs-type">void</span></span>)<span class="hljs-keyword"><span class="hljs-keyword">load</span></span>:(TTURLRequestCachePolicy)cachePolicy more:(<span class="hljs-type"><span class="hljs-type">BOOL</span></span>)more { //  ,    ,  //     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( ! [self isLoading]) { //    _isLoadingMore = more; //      //        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( ! more) { [self <span class="hljs-keyword"><span class="hljs-keyword">reset</span></span>]; } //        TT_RELEASE_SAFELY(_loadingRequest); _loadingRequest = [[self requestForDataWithCachePolicy:cachePolicy more:more] retain]; //    [_loadingRequest send]; } } <span class="hljs-comment"><span class="hljs-comment">/* ,        */</span></span> - (TTURLRequest *)requestForDataWithCachePolicy:(TTURLRequestCachePolicy)cachePolicy more:(<span class="hljs-type"><span class="hljs-type">BOOL</span></span>) more { //     //      page // hhtp://baseURL/sdfsd?page=<span class="hljs-number"><span class="hljs-number">0</span></span> // //          //        NSString * fullRequestURL = self.baseURLString; fullRequestURL = [fullRequestURL stringByAddingQueryDictionary: [NSDictionary dictionaryWithObject: [NSString stringWithFormat:@"%d", _page] forKey:@"page" ] ]; //    TTURLRequest * req = [TTURLRequest requestWithURL:fullRequestURL delegate:self]; req.cachePolicy = cachePolicy; req.response = [[TTURLDataResponse <span class="hljs-built_in"><span class="hljs-built_in">new</span></span>] autorelease]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> req; } <span class="hljs-comment"><span class="hljs-comment">/*  ,         */</span></span> - (NSArray *)parseDataToItems:(NSData *)data error:(NSError **)error { NSString * dataString = [[[NSString alloc] initWithData:data <span class="hljs-keyword"><span class="hljs-keyword">encoding</span></span>:NSUTF8StringEncoding] autorelease]; //      SBJSON NSArray * tweets = [dataString JSONValue]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tweets; } - (<span class="hljs-type"><span class="hljs-type">void</span></span>)requestDidFinishLoad:(TTURLRequest *)request { TTURLDataResponse * response = nil; // ,        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([[request response] isKindOfClass:[TTURLDataResponse <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>]]) { response = (TTURLDataResponse *)request.response; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( ! response) { //   -    [self request:request didFailLoadWithError:nil<span class="hljs-comment"><span class="hljs-comment">/*    */</span></span>]; _isLoadingMore = <span class="hljs-keyword"><span class="hljs-keyword">NO</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } NSError * error = nil; //  ,    NSArray * loadedItems = [self parseDataToItems:[response data] error:&amp;error]; // ,       <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (error) { //  ?    [self request:request didFailLoadWithError:error]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } //    ,  //      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([self isLoadingMore]) { [_items addObjectsFromArray:loadedItems]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TT_RELEASE_SAFELY(_items); _items = [[NSMutableArray arrayWithArray:loadedItems] retain]; } //    _page++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([loadedItems count] &lt; _itemsOnPage) { <span class="hljs-comment"><span class="hljs-comment">/* ,          ,     */</span></span> // _hasMoreItems = <span class="hljs-keyword"><span class="hljs-keyword">NO</span></span> } _isLoadingMore = <span class="hljs-keyword"><span class="hljs-keyword">NO</span></span>; [super requestDidFinishLoad:request]; } <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> - (<span class="hljs-type"><span class="hljs-type">void</span></span>)<span class="hljs-keyword"><span class="hljs-keyword">reset</span></span> { _page = <span class="hljs-number"><span class="hljs-number">0</span></span>; TT_RELEASE_SAFELY(_items); [super <span class="hljs-keyword"><span class="hljs-keyword">reset</span></span>]; } <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> - (<span class="hljs-type"><span class="hljs-type">void</span></span>)dealloc { TT_RELEASE_SAFELY(_baseURLString); TT_RELEASE_SAFELY(_items); [super dealloc]; } @<span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br><br>  Well, and finally, an example of using our model in real conditions <br><pre> <code class="hljs smalltalk">@implementation <span class="hljs-type"><span class="hljs-type">MyModelViewController</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#pragma</span></span> mark - <span class="hljs-type"><span class="hljs-type">View</span></span> <span class="hljs-type"><span class="hljs-type">LifeCycle</span></span> - (void)viewWillAppear:(<span class="hljs-type"><span class="hljs-type">BOOL</span></span>)animated { [<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> viewWillAppear:animated]; [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> createAndStartModelIfNeeded]; } //... <span class="hljs-symbol"><span class="hljs-symbol">#pragma</span></span> mark - <span class="hljs-type"><span class="hljs-type">Model</span></span> <span class="hljs-type"><span class="hljs-type">Showing</span></span> - (void)showModelData:(id&lt;<span class="hljs-type"><span class="hljs-type">TTModel</span></span>&gt;)model { //    result <span class="hljs-type"><span class="hljs-type">ItemsListModel</span></span> //   <span class="hljs-type"><span class="hljs-type">NSArray</span></span> * tweets = [(<span class="hljs-type"><span class="hljs-type">ItemsListModel</span></span> *)model items]; //   <span class="hljs-comment"><span class="hljs-comment">" "</span></span> <span class="hljs-type"><span class="hljs-type">NSLog</span></span>(@<span class="hljs-comment"><span class="hljs-comment">"tweets : %{} "</span></span>, tweets); //        :( //      @<span class="hljs-comment"><span class="hljs-comment">"tweets : %@"</span></span> //    -  status <span class="hljs-type"><span class="hljs-type">Label</span></span> if ([tweets count]) { <span class="hljs-type"><span class="hljs-type">NSDictionary</span></span> * firstTweet = [tweets objectAtIndex:<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-type"><span class="hljs-type">NSString</span></span> * tweetText = [firstTweet objectForKey:@<span class="hljs-comment"><span class="hljs-comment">"text"</span></span>]; _statusLabel.text = [[_statusLabel text] stringByAppendingFormat:@<span class="hljs-comment"><span class="hljs-comment">"\n%@"</span></span>, tweetText]; } } <span class="hljs-symbol"><span class="hljs-symbol">#pragma</span></span> mark - <span class="hljs-type"><span class="hljs-type">Model</span></span> <span class="hljs-type"><span class="hljs-type">Creationg</span></span> - (void)createAndStartModelIfNeeded { //   if ( ! _model) { _model = [[<span class="hljs-type"><span class="hljs-type">ItemsListModel</span></span> alloc] initWithBaseURLString:@<span class="hljs-comment"><span class="hljs-comment">"http://api.twitter.com/1/statuses/user_timeline.json?user_id=18191307"</span></span> itemsOnPage:<span class="hljs-number"><span class="hljs-number">20</span></span>]; [[_model delegates] addObject:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>]; } //       -    if ( ! [_model isLoaded] ) { [_model load:<span class="hljs-type"><span class="hljs-type">TTURLRequestCachePolicyNone</span></span> more:<span class="hljs-type"><span class="hljs-type">NO</span></span>]; } } <span class="hljs-symbol"><span class="hljs-symbol">#pragma</span></span> mark - <span class="hljs-type"><span class="hljs-type">TTModel</span></span> <span class="hljs-type"><span class="hljs-type">Delegate</span></span> - (void)modelDidStartLoad:(id&lt;<span class="hljs-type"><span class="hljs-type">TTModel</span></span>&gt;)model { _statusLabel.text = @<span class="hljs-comment"><span class="hljs-comment">""</span></span>; } - (void)modelDidFinishLoad:(id&lt;<span class="hljs-type"><span class="hljs-type">TTModel</span></span>&gt;)model { _statusLabel.text = @<span class="hljs-comment"><span class="hljs-comment">"!   "</span></span>; [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> showModelData:model]; } - (void)model:(id&lt;<span class="hljs-type"><span class="hljs-type">TTModel</span></span>&gt;)model didFailLoadWithError:(<span class="hljs-type"><span class="hljs-type">NSError</span></span>*)error { _statusLabel.text = [<span class="hljs-type"><span class="hljs-type">NSString</span></span> stringWithFormat:@<span class="hljs-comment"><span class="hljs-comment">":(( %@"</span></span>, [error localizedDescription]]; } - (void)modelDidCancelLoad:(id&lt;<span class="hljs-type"><span class="hljs-type">TTModel</span></span>&gt;)model { _statusLabel.text = @<span class="hljs-comment"><span class="hljs-comment">" "</span></span>; } @end</code> </pre><br><br>  To whom it is especially interesting, source codes can be downloaded <a href="">from here</a> .  I did not dare to save Habr's users from enjoying creating a project with a Three20 connection, so that only files with a model and ViewController are in the archive. <br><br><h2>  Summary </h2><br><br>  <i>The TTModel</i> in the Three20 library is a fairly good abstraction that can be used to organize the MVC approach when programming under iOS.  Even if you are not going to use Three20, you should still look at the implementation of TTModel, and, if you wish, make your own model, based on the presented one. </div><p>Source: <a href="https://habr.com/ru/post/134821/">https://habr.com/ru/post/134821/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../134814/index.html">ZAGG Keyboard Case for Galaxy Tab 10.1</a></li>
<li><a href="../134817/index.html">TPoDT keygenme analysis # 2</a></li>
<li><a href="../134818/index.html">Kiri</a></li>
<li><a href="../134819/index.html">XNA Draw: write deferred lighting to three sources using a shader</a></li>
<li><a href="../134820/index.html">Introduction to mnemonics</a></li>
<li><a href="../134822/index.html">SockJS server performance study</a></li>
<li><a href="../134823/index.html">Asynchronous function sequential call</a></li>
<li><a href="../134824/index.html">2GIS - iOS version appeared</a></li>
<li><a href="../134825/index.html">Recognition and speech synthesis in any iOS application in an hour</a></li>
<li><a href="../134826/index.html">Do I need authorization after registration?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>