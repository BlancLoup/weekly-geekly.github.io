<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Multi-agent smart home</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I will begin my first article with a little background. By the time it all began, for the past 7 years I had been involved in a scientific project who...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Multi-agent smart home</h1><div class="post__text post__text-html js-mediator-article">  I will begin my first article with a little background.  By the time it all began, for the past 7 years I had been involved in a scientific project whose goal was to develop a <a href="http://conf.ostis.net/images/8/85/%25D0%2593%25D0%25BE%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25BA%25D0%25BE%25D0%25B2_%25D0%2592.%25D0%2592..2012%25D1%2581%25D1%2582-%25D0%2593%25D1%2580%25D0%25B0%25D1%2584%25D0%25BE%25D0%259C%25D0%259F%25D0%259E%25D0%2597%25D0%259F%25D0%259F%25D0%25A0%25D0%25B8%25D0%259F.pdf">semantic technology for designing intelligent systems</a> .  It all started with the reading of one <a href="https://habrahabr.ru/post/259243/">remarkable article</a> (thanks to <a href="https://habrahabr.ru/users/vovochkin/" class="user_link">vovochkin</a> ) in the second half of 2015.  It was then that I realized that the technology we are developing is well suited for solving problems in the field of the Internet of things.  This was the first factor that led me to the current project.  The second factor was that I strongly liked the film ‚ÄúIron Man‚Äù and I strongly wanted to have my own ‚ÄúJarvis‚Äù at home. <br><br><img src="https://habrastorage.org/web/8ab/06b/6c7/8ab06b6c75ae49588d5cb8e5b5441c7e.png"><br><br><a name="habracut"></a><br>  Several months of planning and reading led me to the following tasks that were to be solved: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  <a href="https://habr.com/ru/post/328238/">Modify the core for storing and processing the knowledge base</a> </li><li>  <a href="https://habr.com/ru/post/328238/">Implement the environment for visual debugging of the house model</a> </li><li>  <a href="https://habr.com/ru/post/328238/">Implement voice input and output</a> </li></ul><br><h4>  Some theory </h4><br>  I will give a little theory which will allow to understand the further description better. <br><br>  The whole system is built around the knowledge base (I will use the abbreviation BR).  Knowledge in it is presented in the form of a <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B5%25D0%25BC%25D0%25B0%25D0%25BD%25D1%2582%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B0%25D1%258F_%25D1%2581%25D0%25B5%25D1%2582%25D1%258C">semantic network</a> (in more detail about the language of knowledge representation can be read in the <a href="http://conf.ostis.net/images/1/15/04._%25D0%2593%25D0%25BE%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25BA%25D0%25BE%25D0%25B2_%25D0%2592.%25D0%2592.%252C_%25D0%2593%25D1%2583%25D0%25BB%25D1%258F%25D0%25BA%25D0%25B8%25D0%25BD%25D0%25B0_%25D0%259D.%25D0%2590._-_%25D0%25A1%25D0%25A1%25D0%259F.pdf">article</a> ).  I will give a couple of simple examples.  Which will simply allow to understand further text and images.  In my examples, I will use two languages: graphic - <a href="https://drive.google.com/file/d/0B9nRd_434bwfNXNjS0t3dDc0Qnc/view%3Fusp%3Dsharing">SCg</a> and text - <a href="http://ostis-dev.github.io/sc-machine/other/scs/">SCs</a> <br><img src="https://habrastorage.org/web/5ec/734/5f0/5ec7345f0b3b464f8ed24c962a08cbc9.png" align="left"><br>  First you need to learn how to set the <b>"is a"</b> relationship.  Everything is quite simple.  The image on the left indicates the fact that an apple and pineapple are fruits.  To do this, we simply created a node denoting the set of all apples - <b>apple</b> and added an incoming arc of belonging from the node denoting the set of all fruits - <b>fruit</b> .  We did the same thing with pineapple. <br><br><img src="https://habrastorage.org/web/c5b/e30/c95/c5be30c9514447b183c28a730a49020d.png" align="right">  In principle, on the basis of the <b>‚Äúis a‚Äù</b> relationship, all storage in the BR is built, including any other relationship.  For example, consider how an image of an object or a class of objects is indicated in a KB.  In this picture it is clear that we have introduced a set denoting all instances of the relationship <b>‚Äúto be an image of something‚Äù</b> and add to it all the arcs denoting binary bundles. <br><br>  Now let's talk a little about how the processing of stored knowledge takes place.  For this, an <a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D0%25B3%25D0%25B5%25D0%25BD%25D1%2582%25D0%25BD%25D0%25BE-%25D0%25BE%25D1%2580%25D0%25B8%25D0%25B5%25D0%25BD%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BF%25D0%25BE%25D0%25B4%25D1%2585%25D0%25BE%25D0%25B4">agent-based approach is used</a> .  The important principle is that agents can interact with each other only through a BR (changing its state).  Immediately give a link to the <a href="http://ostis-dev.github.io/sc-machine/cpp/kpm/">documentation</a> for the development of agents in C ++.  The interaction between agents is implemented using a specialized command-query language (documentation on it in the development process).  Here I will give one example of a request (read this image following the example of the two past, using the <b>‚Äúis a‚Äù</b> relation): <br><br><img src="https://habrastorage.org/web/6ce/d76/eb2/6ced76eb27354acd85c3b9af578c99a8.png" align="left">  This is the simplest example of a query, the weather in Minsk.  In this image, you can see the node that denotes the request instance and is included in the set <b>command</b> and <b>command_find_weather</b> , where the latter determines the type of request.  In essence, a request is a set of elements of which its arguments are. <br><br>  Each agent in the BR has its own specification, where the expected result, the condition of initiation and other properties of the agent are indicated.  One of these properties is the event at which it is initiated.  The following types of such events are currently available: deleting (creating) an incoming (outgoing) arc, deleting an element, changing the contents of a link.  In other words, we sign an agent to an event in the knowledge base and when it happens the agent is initiated.  For commands, such an event is to add an instance of the request to the set <b>command_initiated</b> .  When this happens, all agents subscribed to this event are initiated.  After that, only agents that can handle this type of request continue to work. <br><br><img src="https://habrastorage.org/web/b98/4dc/3d6/b984dc3d6bc946ad8b75a8cc30bab786.png"><br><br>  At the output, each agent generates a result that is associated with the query instance using the <b>nrel_result</b> relationship. <br><br>  Thus, it turns out something like a forum where different agents can communicate with each other using a specialized language.  In this case, none of them in the formation of the request, do not even know whether it will answer or not and who will give it.  This allows you to use different implementations of agents and add them to the system on the go without stopping its work. <br><br>  The description turned out quite large, although I tried to make it minimal and understandable.  I am ready to answer any questions about it in detail in the comments or, if necessary, make a separate article with a detailed description and examples.  But we move on. <br><br><a name="core"></a><h4>  Kernel improvements </h4><br>  By the time I started working on Jarvis, our <a href="https://github.com/ostis-dev/sc-machine">core</a> was in fairly stable and working condition, but the development of agents was possible only with the use of the C language, there are still <a href="https://github.com/ostis-dev/sc-machine/tree/master/sc-kpm/search/agents">examples of such agents</a> in the repository. <br><br>  <b>The first</b> thing that needed to be done was to simplify their development.  Therefore, it was decided to write a C ++ library that would take on many routine tasks.  At that time, I was working as a game developer on the Unreal Engine 4 and therefore I decided that it would be convenient to use a code generator and implemented this <a href="http://ostis-dev.github.io/sc-machine/cpp/cpp-meta/">feature</a> . <br><br>  Now the agent description began to boil down to: <br><br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AMyAgent</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ScAgentAction { SC_CLASS(Agent, CmdClass(<span class="hljs-string"><span class="hljs-string">"command_my"</span></span>)) SC_GENERATED_BODY() };</code> </pre> <br>  The implementation of this agent was to implement one function: <br><br><pre> <code class="cpp hljs">SC_AGENT_ACTION_IMPLEMENTATION(AMyAgent) { <span class="hljs-comment"><span class="hljs-comment">// implement agent logic there return SC_RESULT_OK; }</span></span></code> </pre><br>  More details about the implementation of agents can be found in the <a href="http://ostis-dev.github.io/sc-machine/cpp/kpm/">documentation</a> .  Examples of the implementation of agents with the new library can be found <a href="https://github.com/ostis-dev/sc-machine/tree/77ad13259336424131ab74d22a52ec1188ab9fd4/sc-kpm/nl">here</a> (they temporarily moved to my closed repository, but soon they will be open again). <br><br>  <b>The second</b> thing that needed to be done was the multithreaded launch of agents.  Previously, one thread was used to process events in the KB, which sequentially started the agents from the queue.  Now all available kernels are used in the system.  I must say at once that it was very difficult to provide asynchronous access to the BR from a variety of agents in different streams.  The description of this mechanism is probably a separate article that I can write if such a need arises.  Here I will focus only on a couple of nuances: <br><br><ul><li>  Work with elements that are stored in memory is implemented using the <a href="https://ru.wikipedia.org/wiki/%25D0%259D%25D0%25B5%25D0%25B1%25D0%25BB%25D0%25BE%25D0%25BA%25D0%25B8%25D1%2580%25D1%2583%25D1%258E%25D1%2589%25D0%25B0%25D1%258F_%25D1%2581%25D0%25B8%25D0%25BD%25D1%2585%25D1%2580%25D0%25BE%25D0%25BD%25D0%25B8%25D0%25B7%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F">lock-free</a> approach.  I am not strong in classifying such approaches, but I think that the implementation of <b>‚ÄúWithout locks‚Äù</b> when I have at least one agent (often more than one or almost all) moves forward; <br><br></li><li>  Currently, agents cannot guarantee that the data they are going to work with will not be deleted by another agent.  In the future, it is planned to introduce locks that will force the object to be stored as long as it is necessary for the agent and in the right context (while the necessary types of locks are being discussed).  For the current implementation of agents, this is not a problem, since if an element has been deleted, the agent will return an error when trying to do something in memory with this element. <br></li></ul><br>  <b>The third</b> thing I came across was that most of the services of Amazon, Google, etc.  have ready APIs in different languages, but not for C ++.  Therefore, it was decided to make it possible to run Python code inside C ++.  This is all <a href="https://github.com/ostis-dev/sc-machine/tree/master/sc-memory/cpp/python">implemented</a> using Boost-Python (using Python 3, here I can already help a lot of people with this). <br><br>  In addition to the things described, documentation was written (links were given already).  The entire c ++ library is covered by unit tests.  It all took about a year and all this was done in parallel with the rest of the things and is still being done. <br><br><a name="visual"></a><h4>  Visual model </h4><br>  The visual model was developed to refine the concept and debug basic things.  Video of a small Proof of concept in this model: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/A_aw8tfae0I" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  This model helped to debug the system very well, since it could be assembled and let other people play.  I will not go into details of its implementation, if anyone is interested - I will answer in the comments.  At the moment, this thing does not develop, everything has moved to real devices. <br><br><a name="speech"></a><h4>  Voice interface </h4><br>  In the early prototype, I implemented voice input using the Android API, and the resulting text was parsed using <a href="http://api.ai/">api.ai</a> , which returned to me the request class for initiation and its parameters.  In this or a slightly modified form, it exists now.  But we will lead the conversation in a different way - how this mechanism is implemented with the help of agents. <br><br>  If we recall the comparison of communication between agents with a forum, then this mechanism can be described by the following log (where A &lt;agent_name&gt; are agents that solve different tasks; user is a user): <br><br><pre> <code class="hljs 1c">user:    ADialogueProcessMessage:     <span class="hljs-string"><span class="hljs-string">"  "</span></span> AApiAiParseUserTextAgent:    <span class="hljs-string"><span class="hljs-string">""</span></span>? AResolveAddr:   <span class="hljs-string"><span class="hljs-string">""</span></span> - <span class="hljs-number"><span class="hljs-number">3452</span></span> AApiAiParseUserTextAgent:    <span class="hljs-string"><span class="hljs-string">""</span></span>? AResolveAddr:   <span class="hljs-string"><span class="hljs-string">""</span></span> - <span class="hljs-number"><span class="hljs-number">3443</span></span> AApiAiParseUserTextAgent:    <span class="hljs-number"><span class="hljs-number">3452</span></span>   <span class="hljs-number"><span class="hljs-number">3443</span></span> AAddIntoSet:  ADialogueProcessMessageAgent:      <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   AGenCmdTextResult:      <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  <span class="hljs-string"><span class="hljs-string">"..."</span></span> AGenText:  - <span class="hljs-string"><span class="hljs-string">"  "</span></span></code> </pre><br>  That's what happens under the hood, when solving such a simple task.  But that's not all, then we need to introduce two more concepts.  In addition to agents that I have already described (they react to changes in the BR and change its state), there are two more types of agents: <br><br><ul><li>  <b>effector</b> - these are agents that make a change in the external environment to a change in the BR.  In other words, they are responsible for displaying information: a screen, a manipulator, etc. </li><li>  <b>Receptor</b> agents are agents that, for changes in the external environment, make changes in the BR.  Responsible for entering information: input devices, sensors, etc. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Video work effector agents</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/a6qpTfbUCXY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  In the video, you can see how the lamp (cube) turns on when the node designating it is added to the set of included devices.  Conversely, when it is removed from there, it turns off.  The same happens with the crane. <br></div></div><br>  When agents disassembled the user's request and formed an answer to it in the same language, this answer is added to the set indicating a dialogue with him (the user).  At this moment, one of the "effector" agents displays this answer to the user as a string.  Here is an example of working on video: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/f45hICEsYCU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Separately, the user interface makes a request to generate speech by text.  The agent generates it as an audio file (OGG) using the ivona service. <br><br><h4>  What's next? </h4><br>  Last year was spent on debugging and new core functionality.  A working prototype was obtained, which can already solve interesting problems.  Over the past year, about 750 hours of free time was spent on development. <br><br>  This approach has potential: <br><br><ul><li>  Adding new functionality does not affect already working.  For example, when I needed to do a task scheduler (to run tasks at a certain time or periodically), then I needed only 1 agent who just adds the already formed request to the set initiated at the specified time.  It turns out that any request that is available in the request language can be scheduled.  For example: " <i>" remind me to call my wife "</i> ";  <i>"Turn off the light at 10"</i> ;  <i>"Turn on the TV at 11.05"</i> ;  ...; <br><br></li><li>  I did not describe in this article, but there is a search <a href="http://ostis-dev.github.io/sc-machine/cpp/templates/">by patterns</a> , on the basis of which one can draw a logical conclusion (and already did <a href="http://conf.ostis.net/images/6/69/%25D0%2597%25D0%25B0%25D0%25BB%25D0%25B8%25D0%25B2%25D0%25B0%25D0%25BA%25D0%25BE_%25D0%25A1.%25D0%25A1..2012%25D1%2581%25D1%2582-%25D0%25A1%25D0%25B5%25D0%25BC%25D0%25B0%25D0%25BD%25D0%25A2%25D0%259A%25D0%259F%25D0%2598%25D0%25A0%25D0%2597.pdf">test solvers of problems</a> in geometry and physics); <br><br></li><li>  <a href="https://cloud.google.com/natural-language/">Cloud Natural Language API</a> is planned to be used as an input text analyzer, which will increase the quality of the language interface; <br></li></ul><br>  At this point, I‚Äôll probably finish my first article, in which I tried to describe the basic principles and what was done in my implementation of the ‚Äúsmart home‚Äù, ‚Äúsmart butler‚Äù or ‚ÄúJarvis‚Äù (to whom it is convenient).  I have no illusions that the material turned out good, so I hope for feedback.  Thanks to all who read. </div><p>Source: <a href="https://habr.com/ru/post/328238/">https://habr.com/ru/post/328238/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../328228/index.html">How to define?</a></li>
<li><a href="../328230/index.html">Tables in responsive design - 2</a></li>
<li><a href="../328232/index.html">CVE-2017-5689 - Intel AMT Vulnerability in Detail</a></li>
<li><a href="../328234/index.html">Variable properties of classes in python: benefits for business and disorderly conduct</a></li>
<li><a href="../328236/index.html">No anything</a></li>
<li><a href="../328240/index.html">What is there with JEP-303 or invent invokedynamic</a></li>
<li><a href="../328242/index.html">Getting rid of Auto Layout</a></li>
<li><a href="../328244/index.html">Magic constants in algorithms</a></li>
<li><a href="../328246/index.html">Ethereum smart contracts: we structure tokens as stocks</a></li>
<li><a href="../328248/index.html">We write a script to synchronize folders with Google Drive, plus learn to use the Google Drive API</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>