<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Without knowing the ford, do not go into the water. Part one</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I wanted to write a few small notes about how C / C ++ programmers play with fire, unaware of it. The first note will be about trying to explicitly ca...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Without knowing the ford, do not go into the water. Part one</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/e5b/5bb/9c6/e5b5bb9c61297ab0942366a34c09358e.jpg" alt="Without knowing the ford, do not go into the water"><br>  I wanted to write a few small notes about how C / C ++ programmers play with fire, unaware of it.  The first note will be about trying to explicitly call the constructor. <br><a name="habracut"></a><br>  Programmers are lazy creatures.  Therefore, they strive to solve the problem with a minimum amount of code.  This is a commendable and good pursuit.  The main thing is not to get carried away by the process and stop in time. <br><br>  For example, programmers may be too lazy to create a single initialization function in a class in order to then call it from different constructors.  The programmer thinks: ‚ÄúWhy do I need an extra function?  I'd rather call one constructor from another. ‚Äù  Unfortunately, the programmer doesn‚Äôt always solve this simple problem.  To detect such unsuccessful attempts, I am implementing a new rule in <a href="http://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> right now.  Here is an example of the code I found in the eMule project: <br><pre>  class CSlideBarGroup
 {
 public:
   CSlideBarGroup (CString strName,
     INT iIconIndex, CListBoxST * (pListBox);
   CSlideBarGroup (CSlideBarGroup &amp; Group);
   ...
 }

 CSlideBarGroup :: CSlideBarGroup (CSlideBarGroup &amp; Group)
 {
   CSlideBarGroup (
     Group.GetName (), Group.GetIconIndex (), Group.GetListBox ());
 } </pre><br>  Consider carefully the implementation of the last constructor.  The programmer decided that the code <br><pre>  CSlideBarGroup (
   Group.GetName (), Group.GetIconIndex (), Group.GetListBox ()); </pre><br>  just calls another constructor.  Nothing like this.  Here a new unnamed object of the CSlideBarGroup type is created and immediately destroyed. <br><br>  It turns out that the programmer really called up another constructor.  That's just what he did is not what he intended.  Class fields will remain uninitialized. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Such mistakes are only half the trouble.  Some people know how to really call another constructor.  And cause.  It would be better if they did not know how to do it.  :) <br><br>  For example, the above code could be rewritten as: <br><pre>  CSlideBarGroup :: CSlideBarGroup (CSlideBarGroup &amp; Group)
 {
   this-&gt; CSlideBarGroup :: CSlideBarGroup (
     Group.GetName (), Group.GetIconIndex (), Group.GetListBox ());
 } </pre><br>  or so: <br><pre>  CSlideBarGroup :: CSlideBarGroup (CSlideBarGroup &amp; Group)
 {
   new (this) CSlideBarGroup (
     Group.GetName (), Group.GetIconIndex (),
     Group.GetListBox ());
 } </pre><br>  Now, really, one constructor to initialize data calls another constructor. <br><br>  If you see a programmer who does this, hang him one shelchan from his head and one from me personally. <br><br>  <b>The above examples are very dangerous code, and you need to understand how they work!</b> <br><br>  Due to the petty optimization (laziness to write a separate function), this code can do more harm than good.  Let us consider in more detail why such structures sometimes work, but more often not. <br><pre>  class SomeClass
 {
   int x, y;
 public:
   SomeClass () {new (this) SomeClass (0,0);  }
   SomeClass (int xx, int yy): x (xx), y (yy) {}
 }; </pre><br>  This code will work correctly.  The code is safe and works because the class contains simple data types and is not inherited from other classes.  In this case, a double constructor call does not threaten anything. <br><br>  Consider another code where an explicit constructor call results in an error (an example is taken from the <a href="http://www.viva64.com/go.php%3Furl%3D790">discussion</a> on the StackOverflow site): <br><pre>  class Base 
 { 
 public: 
  char * ptr; 
  std :: vector vect; 
  Base () {ptr = new char [1000];  } 
  ~ Base () {delete [] ptr;  } 
 }; 
 
 class Derived: Base 
 { 
   Derived (Foo foo) {} 
   Derived (Bar bar) { 
      new (this) Derived (bar.foo); 
   } 
 } </pre><br>  When we call the constructor ‚Äúnew (this) Derived (bar.foo);‚Äù, the Base object is already created and the fields are initialized.  Recalling the constructor will result in double initialization.  In 'ptr' write the pointer to the newly allocated memory.  The result is a memory leak.  What the double initialization of an object of type std :: vector will lead to is generally difficult to predict.  One thing is clear.  This code is invalid. <br><br><h2>  Conclusion </h2><br>  An explicit constructor call is required only in extremely rare cases.  In normal programming, an explicit constructor call usually occurs due to the desire to reduce the size of the code.  Do not do this!  Create an ordinary initialization function. <br><pre>  Here is what the correct code should look like:
 class CSlideBarGroup
 {
   void Init (CString strName, INT iIconIndex,
             CListBoxST * (pListBox);
 public:
   CSlideBarGroup (CString strName, INT iIconIndex,
                  CListBoxST * pListBox)
   {
     Init (strName, iIconIndex, pListBox);
   }
   CSlideBarGroup (CSlideBarGroup &amp; Group)
   {
     Init (Group.GetName (), Group.GetIconIndex (),
          Group.GetListBox ());
   }
   ...
 }; </pre></div><p>Source: <a href="https://habr.com/ru/post/137039/">https://habr.com/ru/post/137039/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../137032/index.html">Motorola Mobility sues Apple again</a></li>
<li><a href="../137033/index.html">Transfer to an electronic type of medical record</a></li>
<li><a href="../137034/index.html">Do you use LuCI when setting up your OpenWRT router?</a></li>
<li><a href="../137037/index.html">[archlinux testing news] KDE 4.8 appeared in testing</a></li>
<li><a href="../137038/index.html">SqlBulkCopy - reloading big data without a crash or how to ride a wild horse (C #)</a></li>
<li><a href="../137040/index.html">LTE in Moscow in March 2012</a></li>
<li><a href="../137041/index.html">Man without e-mail</a></li>
<li><a href="../137042/index.html">New Google Privacy Policy</a></li>
<li><a href="../137043/index.html">Web Studio - business "for the soul." There are easier ways to make money online!</a></li>
<li><a href="../137047/index.html">Harmattan 1.2 PR2 for Nokia N950 has been released</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>