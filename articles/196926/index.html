<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Booting Linux without bootloader</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Here, if possible, I will try to answer the question in the easiest and most detailed way possible: 
 "How can I download Linux (for ex...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Booting Linux without bootloader</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  Here, if possible, I will try to answer the question in the easiest and most detailed way possible: <br>  "How can I download Linux (for example, ubuntu) without using a bootloader such as GRUB 2, iELILO?" <br>  It will not understand how to run / install Ubuntu in [UEFI only] mode.  To do this, please refer here <a href="http://help.ubuntu.ru/wiki/%25D1%2583%25D1%2581%25D1%2582%25D0%25B0%25D0%25BD%25D0%25BE%25D0%25B2%25D0%25BA%25D0%25B0_%25D0%25B4%25D0%25B8%25D1%2581%25D1%2582%25D1%2580%25D0%25B8%25D0%25B1%25D1%2583%25D1%2582%25D0%25B8%25D0%25B2%25D0%25B0_%25D0%25BD%25D0%25B0_%25D0%25BA%25D0%25BE%25D0%25BC%25D0%25BF%25D1%258C%25D1%258E%25D1%2582%25D0%25B5%25D1%2580_%25D1%2581_efi">.</a> <br>  and here <a href="http://help.ubuntu.ru/wiki/lubuntu-osinstallation">help.ubuntu.ru/wiki/lubuntu-osinstallation</a> <br>  All actions will be performed on an already running system. <br><a name="habracut"></a><br>  In order to take advantage of this opportunity, you must meet certain requirements. <br><br><h4>  Requirements </h4><br>  1. UEFI instead of BIOS (set [UEFI only] mode); <br>  2. OS 64-bit; <br>  3. Linux (Kernel&gt; = 3.3); <br><br><h4>  Input data </h4><br>  Installed distribution kit lubuntu-13.04-desktop-amd64 with [UEFI only] mode set.  Disconnected Fast Boot (After completion, you can enable). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The resulting partition table <br><pre><code class="bash hljs">user@pc:~$ sudo parted /dev/sda <span class="hljs-built_in"><span class="hljs-built_in">print</span></span> Model: ATA mSata Smartbuy 3 (scsi) Disk /dev/sda: 32,0GB Sector size (logical/physical): 512B/512B Partition Table: gpt Number Start End Size File system Name Flags 1 1049kB 99,6MB 98,6MB fat32 boot 2 99,6MB 27,8GB 27,7GB ext4 3 27,8GB 32,0GB 4182MB linux-swap(v1)</code> </pre> <br>  It is necessary to pay attention to section 1, from which the direct loading of the kernel will be carried out without the participation of a separate loader (for example, GRUB 2), the requirements for it: <br><br><ol><li>  Exposed flag boot; </li><li>  The recommended size is up to 512 MB (I met different recommendations for how it should be sized, basically it‚Äôs 200-300 MB, I‚Äôd note from myself that in fact it will be busy at 5.3 MB); </li><li>  The file system fat32 / fat16 / fat12 (UEFI has support); </li></ol><br>  This section does not have to go first, most importantly, comply with the requirements above (I advise myself to put it first). <br><br>  The preparatory stages have been completed, we have a working 64-bit operating system with UEFI only mode set and a partition for the kernel (at the moment there is a GRUB located, next we will put the kernel). <br><br><h4>  Get and configure your kernel </h4><br>  We load OS, we open the console. <br>  In order for the kernel to boot without using the bootloader, it needs to specify the disk that will be mounted as the root, to do this, you need to assemble your kernel and specify the option for it <br><pre> <code class="hljs objectivec">CONFIG_CMDLINE=<span class="hljs-string"><span class="hljs-string">"root=/dev/sda2 ro"</span></span></code> </pre><br>  I have an OS installed on the sda2 disk. <br>  Usually this line is passed to the GRUB bootloader along with many other parameters. <br><br><div class="spoiler">  <b class="spoiler_title">If you have another version of the distribution</b> <div class="spoiler_text">  Make sure the kernel options are set. <br>  CONFIG_EFI = y <br>  CONFIG_RELOCATABLE = y <br>  CONFIG_EFI_STUB = y <br>  CONFIG_EFI_PARTITION = y <br>  CONFIG_EFI_VARS = m #or y works too. <br>  CONFIG_FB_EFI = y <br>  CONFIG_FRAMEBUFFER_CONSOLE = y <br></div></div><br>  <i>Comment</i> <i><br></i>  <i>On the Ubuntu developer site, it‚Äôs written that if you don‚Äôt use the original kernel, but compiled it yourself, it will be difficult for them to give you support and don‚Äôt send error reports.</i>  <i>( <a href="https://help.ubuntu.com/community/Kernel/Compile">https://help.ubuntu.com/community/Kernel/Compile</a> )</i> <br><br>  We will get the necessary tools (it may take a long time) <br><pre> <code class="bash hljs">sudo apt-get install fakeroot build-essential crash kexec-tools makedumpfile kernel-wedge sudo apt-get install libncurses5 libncurses5-dev libelf-dev asciidoc binutils-dev</code> </pre><br>  Now we will create a directory in which we will perform all the actions, I will call the folder v2, which will symbolize the modification of the last kernel of the system. <br><pre> <code class="bash hljs">user@pc:~$ mkdir v2 user@pc:~$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> v2</code> </pre><br>  Get the source code of the latest kernel version and prepare the environment <br><pre> <code class="bash hljs">user@pc:~/v2$ apt-get <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> linux-image-$(uname -r) user@pc:~/v2$ sudo apt-get build-dep linux-image-$(uname -r)</code> </pre><br>  Go to the folder linux-3.8.0 <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> linux-3.8.0</code> </pre><br>  Now we are going to modify the kernel configuration <br><pre> <code class="bash hljs">chmod a+x debian/scripts/* chmod a+x debian/scripts/misc/* fakeroot debian/rules clean fakeroot debian/rules editconfigs</code> </pre><br>  After the last command is executed, a notification will first be displayed: <br><pre> <code class="bash hljs">Do you want to edit config: amd64/config.flavour.generic? [Y/n]</code> </pre><br>  Here it is just indicated that we edit the configuration for the 64-bit kernel, enter Y, press the input and get the window <br><img src="https://habrastorage.org/getpro/habr/post_images/2ff/37c/b97/2ff37cb97dbc96425257dcc781c07075.png"><br><br>  Now open the search ('/' key), enter cmdline and click on the input and see what is in the screenshot <br><img src="https://habrastorage.org/getpro/habr/post_images/6d7/3d2/6c0/6d73d26c023b7d1df0bcd2942c3aa5ae.png"><br><br>  then press the number 2 and go to edit the 'Built-in kernel command line' parameter, press 'y' and put an asterisk in this field, symbolizing that this mode is on, now go to the field which is below, press input and enter into it the cherished <br><pre> <code class="hljs javascript">root=<span class="hljs-regexp"><span class="hljs-regexp">/dev/</span></span>sda2 ro</code> </pre><br>  This is the very option for which everything was started (Replace your disk instead of sda2). <br>  We received this config: <br><img src="https://habrastorage.org/getpro/habr/post_images/b9c/076/929/b9c0769291db153e8206691b84c6c17b.png"><br><br><div class="spoiler">  <b class="spoiler_title">Small digression (skip)</b> <div class="spoiler_text">  At this stage, I stopped, assembled the kernel, was glad that everything was so simple and when loading the newly assembled kernel I received an error that the kernel could not find the root partition (in fact, this is why the whole kernel build process was started).  I wondered for a long time what was happening and even tried to specify a disk in UUID format, but I consistently received an error: <br><pre> <code class="hljs pgsql">VFS: Cannot <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> root device "sda2" <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-type"><span class="hljs-type">unknown</span></span>-block(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>) error <span class="hljs-number"><span class="hljs-number">-6</span></span> Please append a correct "root=" boot <span class="hljs-keyword"><span class="hljs-keyword">option</span></span>; here are the available partitions: Kernel panic - <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> syncing: VFS: Unable <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> mount root fs <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-type"><span class="hljs-type">unknown</span></span>-block(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre><br>  In the process of googling, I found out that the disk system driver should be built into the kernel, and it was connected by the module.  As a result, the kernel during boot could not find a hard disk at all and reported about this error that the drive could not be mounted. <br></div></div><br>  Now you need to install some more kernel options. <br>  We drive to the console (start one more) <br><pre> <code class="bash hljs">lspci -n</code> </pre><br>  and the resulting output is inserted into the input box on the site <br>  <a href="http://kmuto.jp/debian/hcl/">Debian GNU / Linux device driver check page</a> <br>  click check, we get: <br><img src="https://habrastorage.org/getpro/habr/post_images/d95/884/48e/d9588448edd02e69dd3f98865ca23d9d.png"><br><br>  From this list, we need to enable the disk controller driver, in my case, it is ahci (the string 'Sata Controller', the column 'Driver'). <br>  Press '/' again to search and enter 'ahci'.  For fidelity, we note all three found options for embedding SATA_AHCI_PLATFORM, SATA_ACARD_AHCI and SATA_AHCI. <br><br>  Now we select everywhere 'exit', at the end we agree, save the settings by choosing Yes.  After that, in the console, we refuse to edit configurations for other platforms, because we don‚Äôt need them. <br><br><h4>  Kernel build </h4><br><pre> <code class="bash hljs">user@pc:~/v2/linux-3.8.0$ fakeroot debian/rules clean user@pc:~/v2/linux-3.8.0$ fakeroot debian/rules binary-headers binary-generic</code> </pre><br>  Now it only remains to wait until the kernel is assembled.  Depending on the power of your computer, the kernel build time depends; on my machine, the build process took just under an hour. <br><br>  After the build, we copy the resulting kernel to the boot partition in the 'EFI / boot' folder, because the partition is mounted to the / boot / efi folder, as a result we have the path / boot / efi / EFI / boot / <br><pre> <code class="bash hljs">sudo mkdir -p /boot/efi/EFI/boot/</code> </pre><br>  Now you need to copy the kernel to this folder, giving it the name bootx64.efi <br><pre> <code class="bash hljs">user@pc:~/v2/linux-3.8.0$ sudo cp ./debian/build/build-generic/arch/x86_64/boot/bzImage /boot/efi/EFI/boot/bootx64.efi</code> </pre><br>  It should be noted that the download using the GRUB bootloader will still be available, you just have to switch to UEFI (press del or F12 when booting).  This can be useful if the kernel for some reason does not boot. <br><br>  Now you need to inform UEFI that we want to make our kernel bootable, for this you need to install a program that can edit the UEFI settings. <br><pre> <code class="bash hljs">sudo apt-get install efibootmgr</code> </pre><br>  Make sure you have access to UEFI variables. <br><pre> <code class="bash hljs">sudo modprobe efivars</code> </pre><br>  If it worked without errors, we do the final touch.  Add our kernel in UEFI with priority on download number 1, the name in quotes after - label you can enter your own.  Register in the path to the loader does not matter, because it is not case-sensitive. <br><pre> <code class="bash hljs">sudo efibootmgr --create --part 1 --label <span class="hljs-string"><span class="hljs-string">"Linux"</span></span> --loader <span class="hljs-string"><span class="hljs-string">'\efi\boot\bootx64.efi'</span></span></code> </pre><br>  Now a new line called 'Linux' has been added to the UEFI boot menu, which performs a direct kernel load.  That's all.  You can restart the computer and make sure that the kernel boots bypassing the bootloader. <br><pre> <code class="bash hljs">sudo reboot</code> </pre><br>  To ensure that the kernel you have loaded is compiled, enter <br><pre> <code class="bash hljs">cat /proc/cmdline</code> </pre><br>  You will see a list of parameters passed to the kernel at boot (we ourselves indicated them earlier): <br><pre> <code class="hljs javascript">root=<span class="hljs-regexp"><span class="hljs-regexp">/dev/</span></span>sda2 ro</code> </pre><br><br>  The goal is reached!  Thanks for attention! <br><br>  An article with a similar theme: <br>  <a href="http://habrahabr.ru/post/165575/">Downloading GNU / Linux without a third-party bootloader</a> <br><br>  Sources of <s>wisdom</s> knowledge: <br><ol><li>  <a href="https://help.ubuntu.com/community/UEFI">help.ubuntu.com/community/UEFI</a> </li><li>  <a href="http://www.ondatechnology.org/wiki/index.php%3Ftitle%3DBooting_the_Linux_Kernel_without_a_bootloader">www.ondatechnology.org/wiki/index.php?title=Booting_the_Linux_Kernel_without_a_bootloader</a> </li><li>  <a href="http://swift.siphos.be/linux_sea/kernelbuilding.html">swift.siphos.be/linux_sea/kernelbuilding.html#idm3437981411120</a> </li><li>  <a href="http://askubuntu.com/questions/71332/kernel-panics-with-cannot-open-root-device-error-where-do-i-append-the-root">askubuntu.com/questions/71332/kernel-panics-with-cannot-open-root-device-error-where-do-i-append-the-root</a> </li><li>  <a href="https://help.ubuntu.com/community/Kernel/Compile">help.ubuntu.com/community/Kernel/Compile</a> </li><li>  <a href="https://wiki.ubuntu.com/Kernel/BuildYourOwnKernel">wiki.ubuntu.com/Kernel/BuildYourOwnKernel</a> </li><li>  <a href="http://www.rodsbooks.com/efi-bootloaders/">www.rodsbooks.com/efi-bootloaders</a> </li></ol><br><br>  UPD: <br>  Thanks to <a href="https://habr.com/users/valdikss/" class="user_link">ValdikSS</a> for a valuable comment.  Reaching the goal can be much easier.  There is no need to rebuild the kernel in this case.  It can be copied to the FAT partition along with the initrd (from the / boot directory) and indicate to the loader the correct parameters: <br><pre> <code class="bash hljs">sudo efibootmgr --create --disk /dev/sda --part 1 --label <span class="hljs-string"><span class="hljs-string">"Lubuntu"</span></span> -u --loader <span class="hljs-string"><span class="hljs-string">'\efi\boot\vmlinuz.efi'</span></span> root=/dev/sda2 initrd=/efi/boot/initrd.img rw quiet</code> </pre><br><br><habracut></habracut></div><p>Source: <a href="https://habr.com/ru/post/196926/">https://habr.com/ru/post/196926/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../196912/index.html">SlideStackView or Extending ViewGroup on Android (part 2)</a></li>
<li><a href="../196916/index.html">Agile application in a fixed phase contract</a></li>
<li><a href="../196920/index.html">God bless Dynamic SQL</a></li>
<li><a href="../196922/index.html">How to cheap print a book in Linux</a></li>
<li><a href="../196924/index.html">Overview of the new TI Launchpad (MSP-EXP430F5529LP or MSP430F5529 USB LaunchPad)</a></li>
<li><a href="../196930/index.html">Implementation of 802.1x for computers behind "stupid" phones</a></li>
<li><a href="../196932/index.html">11 years of playing Civilization II without restarting: continuing the story</a></li>
<li><a href="../196936/index.html">Subtleties in the process of design for startups</a></li>
<li><a href="../196938/index.html">LG G2: outside and inside the new Korean flagship</a></li>
<li><a href="../196940/index.html">Police London City successfully fights with the largest torrent trackers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>