<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Install and configure openchange under CentOS 6.5</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In runet and in general, there is little talk about such an interesting product as openchange on the Internet. 
 In theory, openchange and its associa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Install and configure openchange under CentOS 6.5</h1><div class="post__text post__text-html js-mediator-article">  In runet and in general, there is little talk about such an interesting product as openchange on the Internet. <br>  In theory, openchange and its associated components should completely replace the MS Exchange Server, but in practice this is not entirely possible. <br>  Those who are interested in asking in the post itself.  There it will be told about installation on CentOS 6.5. <br><a name="habracut"></a><br><br>  I have to say that the product is rather raw and is not suitable for a large organization. <br><br>  Initial data: <br>  1) Large domain with subdomains and various trusted links to other domains. <br>  2) In connection with the division of a large firm into separate legal entities, the need for its own mail appeared. <br>  3) Users are accustomed to the buns in the form of shared calendars, address book and other things. <br>  Solution: postfix + dovecot and try to all this openchange on the test domain. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Installation </h4><br>  The installation was performed on the CentOS distribution, iptables and selinux were disabled. <br>  Initially, postfix and dovecot were installed and configured with authorization in AD. <br>  There are a lot of installation manuals on the Internet, so I‚Äôll not give you the details in detail, but I‚Äôll say right away that I used only standard repositories. <br>  As inland transport is used lmtp. <br>  To synchronize the messages received via MAPI and IAMP, the following lines were added to the LDAP config: <br><blockquote>  passdb { <br>  driver = static <br>  args = nopassword = y allow_nets = 127.0.0.1 / 32 <br>  } </blockquote><br>  This is required to authorize openchange with dovecot. <br>  Now let's proceed directly to installing openchange. <br>  We connect the necessary repository. <br><blockquote>  [sogo-rhel6] <br>  name = Inverse SOGo Repository <br>  baseurl = http: //inverse.ca/downloads/SOGo/RHEL6/$basearch <br>  gpgcheck = 0 <br>  enable = 1 </blockquote><br>  Run the installation. <br><blockquote>  yum install samba4 openchange sogo-openchange-backend openchange-ocsmanager openchange-rpcproxy sogo </blockquote><br>  I love mysql more than postgresql, so sogo will work under mysql. <br>  Additionally, we put mysql and a connector for sogo <br><blockquote>  yum install mysql-server sope49-gdl1-mysql </blockquote><br><br><h4>  Samba setup </h4><br>  We attach our samba4 in windows AD <br><blockquote>  samba-tool domain join testmail.local DC -UAdministrator --realm = testmail.local </blockquote><br>  Joining is automatic; you only need to enter the password for the Administrator account. <br>  Add the following lines to /etc/samba4/smb.conf <br><blockquote>  # Begin OpenChange Server Configuration <br>  dcerpc endpoint servers = + epmapper, + mapiproxy, + dnsserver <br>  dcerpc_mapiproxy: server = true <br>  dcerpc_mapiproxy: interfaces = exchange_emsmdb, exchange_nsp, exchange_ds_rfr <br>  # End OpenChange Server configuration </blockquote><br>  After that we start samba <br><blockquote>  samba -d 3 -i -M = single </blockquote><br>  Just in case, I will explain what this command means. <br>  -d is debug mode.  The number 3 indicates the level of debag <br>  -i is interactive, that is, all output to the console <br>  -M = single proper operation mode without forks. <br>  For reasons that I don‚Äôt understand, samba4 doesn‚Äôt open the necessary sockets if you try to run it through the samba command, and through init the script it refuses to start with this configuration in smb.conf <br>  Therefore, we have to launch it with the command above, but at the same time it is perfectly sent to the background through nohup. <br><br>  After start we check replication work. <br><blockquote>  samba-tool drs kcc -Uadministrator dcmail.testmail.local <br>  samba-tool drs showrepl </blockquote><br>  For its work, openchange rules the AD schema, but does so only when it itself is the owner of the schema. <br>  We transfer the rights to the scheme to our Linux controller. <br><blockquote>  samba-tool fsmo seize --role = schema </blockquote><br>  Run openchange setup <br><blockquote>  openchange_provision <br>  openchange_provision --openchangedb </blockquote><br>  After that, restart samba <br><br><h4>  Proceed to setting up ocsmanager </h4><br>  vim /etc/ocsmanager/ocsmanager.ini <br>  Changing LDAP Connection Settings <br><blockquote>  [main] <br>  # Possible authentication system <br>  auth = ldap <br>  mapistore_root = / var / lib / samba4 / private <br>  mapistore_data = / var / lib / samba4 / private / mapistore <br>  debug = no <br><br>  [auth: ldap] <br>  #host = ldap: // localhost <br>  host = mail.testmail.local <br>  port = 3268 <br>  bind_dn = CN = user, CN = users, DC = testmail, DC = local <br>  bind_pw = password <br>  basedn = CN = Users, dc = testmail, dc = local <br><br>  [rpcproxy: ldap] <br>  host = mail.testmail.local <br>  port = 389 <br>  basedn = CN = Users, dc = testmail, dc = local </blockquote><br>  We also indicate where samba is <br><blockquote>  SAMBA_HOST = 127.0.0.1 </blockquote><br>  In the LDAP and SAMBA_HOST settings, you can specify the windows domain controller, this does not affect the correctness of the operation. <br>  We start ocsmanager <br>  service openchange-ocsmanager start <br><br><h4>  Sogo setup </h4><br><br>  Create a database and user. <br><blockquote>  CREATE DATABASE `sogo` CHARACTER SET = 'utf8'; <br>  CREATE USER 'sogo' @ 'localhost' IDENTIFIED BY 'sogo'; <br>  GRANT ALL PRIVILEGES ON `sogo`. * TO 'sogo' @ 'localhost' WITH GRANT OPTION; <br>  FLUSH PRIVILEGES; </blockquote><br><br>  Rule config /etc/sogo/sogo.conf <br><br>  Specify where the base is <br><blockquote>  SOGoProfileURL = "mysql: // sogo: sogo @ localhost: 3306 / sogo"; <br>  OCSFolderInfoURL = "mysql: // sogo: sogo @ localhost: 3306 / sogo / sogo_folder_info"; <br>  OCSSessionsFolderURL = "mysql: // sogo: sogo @ localhost: 3306 / sogo / sogo_sessions_folder"; <br></blockquote><br>  We specify the location of the letter directories, as well as the imap and postfix servers <br><blockquote>  // SOGoDraftsFolderName = Drafts;  But with this line samba I fell with errors that were not always reproduced, so unfortunately the drafts are moved to the trash. <br>  SOGoDraftsFolderName = Trash; <br>  SOGoSentFolderName = Sent; <br>  SOGoTrashFolderName = Trash; <br>  SOGoIMAPServer = imaps: // localhost: 993; <br>  SOGoSMTPServer = 127.0.0.1; <br>  SOGoMailDomain = testmail.local; <br>  SOGoMailingMechanism = smtp; <br>  SOGoForceExternalLoginWithEmail = NO; <br>  SOGoMailSpoolPath = / var / spool / sogo; <br>  NGImap4ConnectionStringSeparator = "/"; </blockquote><br>  Specify the location of the LDAP server <br><blockquote>  SOGoUserSources = ( <br>  { <br>  type = ldap; <br>  CNFieldName = cn; <br>  UIDFieldName = sAMAccountName; <br>  baseDN = "CN = users, DC = testmail, DC = local"; <br>  bindDN = "CN = user, CN = users, DC = testmail, DC = local"; <br>  bindFields = (sAMAccountName, mail); <br>  bindPassword = password; <br>  canAuthenticate = YES; <br>  displayName = "Public"; <br>  hostname = "dcmail.testmail.local";  // This is a windows controller <br>  port = "389"; <br>  filter = "mail = '*'"; <br>  id = testmail.local; <br>  isAddressBook = NO; <br>  } <br>  ); <br></blockquote><br>  <u>The key point is if you specify our samba as the hostname, then when you try to enter the outlook, samba hangs tight.</u> <br>  But maybe this is a bug only on my server. <br><br>  Specify the language and time zone <br><blockquote>  SOGoLanguage = Russian; <br>  SOGoTimeZone = Europe / Moscow; </blockquote><br><br>  Optionally, you can also enable the web interface, but I have left the layout in all browsers. <br><blockquote>  / * Web Interface * <br>  SOGoPageTitle = SOGo; <br>  SOGoVacationEnabled = YES; <br>  SOGoForwardEnabled = YES; <br>  SOGoSieveScriptsEnabled = YES; <br>  SOGoMailAuxiliaryUserAccountsEnabled = YES; <br>  SOGoTrustProxyAuthentication = NO; </blockquote><br>  Also, if you use the web interface, you need to remember to specify which ip address will be listened to by sogo (by default 127.0.0.1) <br>  WOPort = "0.0.0.0:20000"; <br>  Run sogo <br>  service sogod start <br><br>  Go to setting up the web part. <br>  /etc/httpd/conf.d/rpcproxy.conf <br>  Specify the SetEnv SAMBA_HOST 127.0.0.1 parameter <br>  We issue rights to the / var / cache / ntlmauthhandler directory <br><blockquote>  chown -R apache: apache / var / cache / ntlmauthhandler </blockquote><br><br>  It is desirable to use ssl.  Install mod_ssl and generate a certificate. <br><br>  /etc/httpd/conf.d/SOGo.conf <br>  When using ssl you need to enable it in the sogo settings <br><blockquote>  RequestHeader set "x-webobjects-server-port" "443" <br>  RequestHeader set "x-webobjects-server-name" "mail.testmail.local" <br>  RequestHeader set "x-webobjects-server-url" " <a href="https://mail.testmail.local/">mail.testmail.local</a> " <br></blockquote><br>  Run apache <br>  service httpd start <br><br>  At this installation can be considered complete. <br>  For those who need boxes we create them by the team <br>  openchange_newuser --create user <br><br>  You can proceed to configure outlook. <br>  Unfortunately, autodiscover at the moment does not correctly work correctly completely and you have to set the parameters by hand. <br>  In my case, it looks like this: <br>  Server: mail.testmail.local <br>  Username: user <br>  Go to the "Other Settings" menu, the security section and tick the box "Always request login credentials" <br>  When connecting from outside, we specify a proxy server. <br><br><h4>  Conclusion </h4><br>  On the domain with openchange subdomains did not work at all, strange bugs were discovered, such as the above described bug with sogo.  Also, samba periodically fell, if the user is in AD, but he does not have a box.  At the moment, the fall has ceased.  But the most annoying thing is that with some problems, the samba just falls with the PANIC message, which makes diagnosis difficult. <br>  The developers of this product didn‚Äôt promise to integrate into already working windows AD, so the creeping bugs may well relate to the fact that we are doing something that is not completely provided by the developers. <br>  But at the moment I managed to consistently launch this product for testing. <br>  I believe that the optimal structure for openchange at this stage of product development will be: <br>  1) Install a separate samba4 \ windows AD controller <br>  2) Delivery to a separate server dovecot + postfix with authorization via LDAP (in case of openchange failure, the organization will still stay with a working mailer) <br>  3) Those who need calendars and address books (and as practice has shown, they are not necessary for everyone) should be connected via mapi to openchange. <br>  4) Write bug reports to developers for speeding up openchange to a more stable state. </div><p>Source: <a href="https://habr.com/ru/post/227893/">https://habr.com/ru/post/227893/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../227879/index.html">New Imaging SDK and SensorCore SDK for Lumia are already available for download.</a></li>
<li><a href="../227881/index.html">Development of cross-browser extensions</a></li>
<li><a href="../227883/index.html">Indexing Android application content is now available to all developers.</a></li>
<li><a href="../227885/index.html">Testing flash storage. Theoretical part</a></li>
<li><a href="../227887/index.html">Testing flash storage. IBM RamSan FlashSystem 820</a></li>
<li><a href="../227897/index.html">Open networks and switches without OS</a></li>
<li><a href="../227903/index.html">Linux dominates supercomputers like never before</a></li>
<li><a href="../227907/index.html">Any Packt Publishing eBook can be purchased for $ 10.</a></li>
<li><a href="../227911/index.html">As I wrote checkers</a></li>
<li><a href="../227913/index.html">Setting up a Mikrotik router for various tasks in SOHO</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>