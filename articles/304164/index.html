<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to speed up build with Maven</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What if the build with Maven is too slow? After all, when an assembly lasts too long, anyone, even the most patient developer, can get bored and distr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to speed up build with Maven</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/8ce/996/8cd/8ce9968cd9a84d8c82d0bcfe51371abe.png" alt="Maven"><br>  What if the build with Maven is too slow?  After all, when an assembly lasts too long, anyone, even the most patient developer, can get bored and distract. <br><br>  For a quick search on Google or for bookmarks, I immediately propose a final solution: <br><pre><code class="bash hljs">mvn package -am -o -Dmaven.test.skip -T 1C</code> </pre> <br>  - to build a project <i>without tests</i> . <br><a name="habracut"></a><br>  This story began with the fact that I downloaded a fairly large Java project from our corporate repository.  I think that many, like me, would immediately assemble him with a team: <br><pre> <code class="bash hljs">mvn clean package</code> </pre><br>  Well, many team: <br><pre> <code class="bash hljs">mvn clean install</code> </pre><br>  My project was assembled in 25 minutes, and each time it was going as long as the first time. <br><br><h1>  package instead of install </h1><br>  According to the project <a href="https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html">lifecycle of the</a> project after the package phase, on which we get a full jar file, there is a phase of verify and then install.  Often it is necessary to get exactly the jar-file, which is not necessary to be placed in a local repository, so in this situation I stopped at the package and saved some time. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  Parallel assembly </h1><br>  During normal launch, Maven does not use all the capabilities of modern processors for parallelizing calculations on different cores, collecting modules one by one.  Fortunately, you can use the -T parameter, specifying Maven to build a dependency graph and assemble the modules in parallel. <br>  The parameter can be used in different ways: <br><pre> <code class="bash hljs">mvn -T 4 package</code> </pre><br>  or <br><pre> <code class="bash hljs">mvn -T 1C package</code> </pre><br>  In the first case, you specify the number of threads to use Maven, and in the second, that you need to use one thread per CPU core. <br>  I am going to use the second method of setting a parameter tied to the number of cores in my final team. <br>  After experimenting with the number of threads per core, try the following options: <br><pre> <code class="bash hljs">mvn -T 1C package mvn -T 1.5C package mvn -T 2C package</code> </pre><br>  - I did not get any noticeable increase in the case of more than 1 thread per core on a compiled project on a Core i7 processor. <br>  I also note that parallel assembly is an experimental function of Maven 3. During assembly, problems may arise when using plugins that are not @threadSafe.  In particular, these are the plugins: <br><ul><li>  Surefire with the parameter forkMode = never, surefire [2.6,) warns (assert) about this. </li><li>  maven-modello-plugin, fixed from version 1.4, </li><li>  All maven-archiver clients (EAR, EJB, JAR, WAR etc), fixed in recent versions </li></ul><br>  and libraries: <br><ul><li>  plexus-utils 2.0.5 </li><li>  maven-archiver 2.4.1 </li><li>  plexus-archiver 1.0 </li><li>  plexus-io 1.0 </li></ul><br><br><h1>  Incremental build </h1><br>  As we discussed above, the project is most often built by the team: <br><pre> <code class="bash hljs">mvn clean package</code> </pre><br>  The clean command is used to clean the project, but is it necessary every time you build it?  No, we usually want an incremental update of the project, and Maven is capable of it with the help of the command: <br><pre> <code class="bash hljs">mvn package -am</code> </pre><br>  Maven collects the module and updates those modules on which this module depends, in case something has changed in them. <br>  This option speeds up the assembly of projects from many modules, in which, as a rule, point changes are made to 1-2 modules. <br><br><h1>  Offline build </h1><br>  It often happens that artifacts on external repositories are not updated very often, especially when they are artifacts of a certain version, or these artifacts must be supported by your efforts (- Welcome to the new project!).  It is quite logical in this situation to tell Maven that you do not need to re-download them every time from the repositories: <br><pre> <code class="bash hljs">mvn package -o</code> </pre><br>  or <br><pre> <code class="bash hljs">mvn package --offline</code> </pre><br><br>  We for brevity will focus on the first version. <br><br><h1>  Test skip </h1><br>  Perhaps the most controversial proposal to optimize the speed of the assembly, I left last.  To those who fully share the values ‚Äã‚Äãof TDD, I simply propose to scroll through this paragraph and remove the -Dmaven.test.skip parameter from our final command. <br>  I will not deny that tests are certainly needed, and the programmer must understand the part of the responsibility that he assumes by disabling them.  But if you suddenly come across a new gigantic project, in which someone once wrote tests, and they do not work, then you will have to turn them off first. <br>  As for the Maven launch option, I want to note only that, as a rule, in order to skip tests, use the command: <br><pre> <code class="bash hljs">mvn package -DskipTests</code> </pre><br>  But you can also skip the compilation of tests, if you run the command in the following form: <br><pre> <code class="bash hljs">mvn package -Dmaven.test.skip</code> </pre><br><br><h1>  Let's sum up </h1><br>  So, once again, the team that we got to speed up the build with Maven: <br><pre> <code class="bash hljs">mvn package -am -o -Dmaven.test.skip -T 1C</code> </pre><br><br>  The result, shown on the project I am collecting, is good: instead of 25 minutes, the build began to take place in 30 seconds. <br>  The authors of several other articles on optimizing build speed with Maven also recommend using compiler launch optimization parameters: <br><pre> <code class="bash hljs">MAVEN_OPTS= -XX:+TieredCompilation -XX:TieredStopAtLevel=1 mvn package</code> </pre><br>  - but, firstly, I did not feel any real speeding up of the assembly, apparently because I was already using the incremental build and in this case the compilation process took not so much time, and secondly, There are a sufficient number of mentions that these parameters can cause OutOfMemory errors and other problems. <br><br>  I hope that in the comments you will also share statistics on speeding up the assembly of your projects! </div><p>Source: <a href="https://habr.com/ru/post/304164/">https://habr.com/ru/post/304164/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../304152/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ217 (June 20 - 26, 2016)</a></li>
<li><a href="../304154/index.html">Algorithmic design</a></li>
<li><a href="../304158/index.html">How to create a startup? Experience in applying Customer Development and Lean Startup methods in Silicon Valley</a></li>
<li><a href="../304160/index.html">Generate passwords for Super Castlevania IV and Rock n 'Roll Racing</a></li>
<li><a href="../304162/index.html">Poll. New <? ~ $ Value?> Tag for HTML data escaping in PHP</a></li>
<li><a href="../304166/index.html">Infinite scrolling vs. pagination</a></li>
<li><a href="../304170/index.html">Admission to the "free" magistracy in the United States. Part one</a></li>
<li><a href="../304174/index.html">Simple automation example letsencrypt</a></li>
<li><a href="../304178/index.html">Mindfields contracts: respectable partnership of developers and enterprises</a></li>
<li><a href="../304180/index.html">PyCon Russia 2016: latest news and final program</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>