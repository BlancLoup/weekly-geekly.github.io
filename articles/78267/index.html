<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Threading Basics in Python</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Foreword 
 I started to write this article after increasing questions both on the forum and icq questions on the topic of multithreading in CPython. T...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Threading Basics in Python</h1><div class="post__text post__text-html js-mediator-article"><h4>  Foreword </h4><br>  I started to write this article after increasing questions both on the forum and icq questions on the topic of multithreading in CPython.  The problem of the people who ask them comes mainly from ignorance or misunderstanding of the basic principles of multi-threaded applications.  At least, this refers to the multithreading model I use, which is called the Thread Pool.  Often there is another problem: people do not have the basic skills of working with standard CPython modules.  In the article I will try to give examples of such ignorance, not dwelling on personalities, since in my humble opinion it does not matter.  Based on the conditions in which this article is written, we will also touch upon work through proxy servers (not to be confused with SOCKS). <br><a name="habracut"></a><br><h4>  Details </h4><br>  <i>The article was written at the time when the latest versions of CPython were: 2.6.2 for the second branch and 3.1.1 for the third branch.</i>  <i>The article uses the newly appeared in CPython 2.6 with statements, therefore, if you want to use this code in earlier versions, you will have to redo the code at your discretion.</i>  <i>In the process of writing this article, only standard modules available "out of the box" were used.</i>  <i>Also, based on the fact that I am not a professional programmer, but a self-taught person, I apologize to a respected audience for possible inaccuracies regarding the interpretation of certain concepts.</i>  <i>Therefore, I invite you to ask questions, which I will answer as much as possible.</i> <br><br>  So, let's start, in fact, what I was going to describe for the first time was recommended by respected lorien with python.su (although in his example, Queue was processed in a separate thread :)), not sure that he was the author of the concept he demonstrated, but for the first time I saw it published it is from him that it‚Äôs not even the Thread Pool, but the Task Pool (although I may be wrong in interpreting this term). <br>  <b>What is a multi-threaded application?</b>  This is an application in which a certain number of threads perform certain tasks.  The trouble of many is that they do not fully capture the fact that the threads act separately from each other as long as the main thread is active.  Personally, I try to write in such a way that it does not bother them, but more on that later.  Also, their problem is the so-called "Hindu" code, which is simply and thoughtlessly copied from somewhere, and the program is brought to the level of "just to work."  Gentlemen, once and for all: if you do not understand how this or that section of your program works, then rewrite it so that it is clear to YOU, if in the future you will grow to understand those things that you assumed to copy without thinking, then you no problem can use this code.  The main thing is YOUR understanding of how your creation works. <br>  We will <b>address the problem of separate work streams</b> .  Gentlemen, the interaction of threads should be thought out before you start writing the application, and not when you have already written it.  In principle, if you adhere to some rules for working with the source code of an application, then remaking a program from single-threaded to multi-threaded occurs easily, painlessly, and quickly. <br>  Regarding the <b>activity of the main thread</b> .  When, as it seems to you, you start ONE thread, TWO threads are actually running.  You need to understand that the number of threads currently active is equal to the number of threads that are currently running by you +1 thread in which the main body of the application is running.  Personally, I try to write in such a way as to clearly separate the main thread from those started by me.  If you do not do this, then perhaps the premature (as it seems to you) application shutdown, although in fact the application will work exactly as you wrote it. <br>  It seems in words it is clear, now we start practice.  In practice, CPython has such an intelligibility as GIL (Global Interpreter Lock).  Sim means a global blocking of the interpreter at the moment when the threads of your application are accessing the processor.  In fact, at any given moment, only one thread is working with the processor.  In this regard, the maximum number of threads, which generally can be run in a standard CPython, fluctuates around 350 pieces. <br>  As an example, an attempt will be made to <b>implement a multi-threaded parser <a href="http://www.google.com/">www.google.com</a></b> .  As I already wrote above, only standard modules will be used for the work, the urllib2, urllib, queue, threading, re modules will be needed to complete the task. <br><br>  In order: <br><blockquote> <code><code><font color="#408080"><em>#==================&lt;  &gt;==================</em></font> <br> <font color="#008000"><strong>import</strong></font> <font color="#0000FF"><strong>urllib2</strong></font> <br> <font color="#408080"><em>#     HTTP, </em></font> <br> <font color="#008000"><strong>import</strong></font> <font color="#0000FF"><strong>urllib</strong></font> <br> <font color="#408080"><em>#     HTTP,    urllib2,</em></font> <br> <font color="#408080"><em>#      - urllib.urlquote</em></font> <br> <font color="#008000"><strong>from</strong></font> <font color="#0000FF"><strong>Queue</strong></font> <font color="#008000"><strong>import</strong></font> Queue <br> <font color="#408080"><em>#,    "Pool",   , </em></font> <br> <font color="#408080"><em>#       ,   </em></font> <br> <font color="#408080"><em>#     </em></font> <br> <font color="#008000"><strong>import</strong></font> <font color="#0000FF"><strong>threading</strong></font> <br> <font color="#408080"><em>#    ,    </em></font> <br> <font color="#408080"><em>#threading.active_count, threading.Thread, threading.Thread.start,</em></font> <br> <font color="#408080"><em>#threading.Rlock</em></font> <br> <font color="#008000"><strong>import</strong></font> <font color="#0000FF"><strong>re</strong></font> <br> <font color="#408080"><em>#     ,   </em></font> <br> <font color="#408080"><em>#  </em></font> <br> <font color="#008000"><strong>import</strong></font> <font color="#0000FF"><strong>time</strong></font> <br> <font color="#408080"><em>#    ,      sleep</em></font> <br> queue <font color="#666666">=</font> Queue() <br> <font color="#408080"><em># ,     (.. </em></font> <br> <font color="#408080"><em># Queue   Queue   )</em></font> <br> <font color="#408080"><em>#==================&lt;/  &gt;=================</em></font> <br> <br> <font color="#408080"><em>#==============================&lt;&gt;==============================</em></font> <br> PROXY <font color="#666666">=</font> <font color="#BA2121">"10.10.31.103:3128"</font> <br> <font color="#408080"><em>#      -,   </em></font> <br> <font color="#408080"><em>#   ,    </em></font> <br> <font color="#408080"><em># PROXY,     -.  </em></font> <br> <font color="#408080"><em>#    None</em></font> <br> HEADERS <font color="#666666">=</font> { <font color="#BA2121">"User-Agent"</font> : <font color="#BA2121">"Opera/9.64 (Windows NT 5.1; U; en) Presto/2.1.1"</font> , <br> <font color="#BA2121">"Accept"</font> : <font color="#BA2121">"text/html, application/xml;q=0.9, application/xhtml+xml, image/ png, image/jpeg, image/gif, image/x-xbitmap, */*;q=0.1"</font> , <br> <font color="#BA2121">"Accept-Language"</font> : <font color="#BA2121">"ru,uk-UA;q=0.9,uk;q=0.8,en;q=0.7"</font> , <br> <font color="#BA2121">"Accept-Charset"</font> : <font color="#BA2121">"iso-8859-1, utf-8, utf-16, *;q=0.1"</font> , <br> <font color="#BA2121">"Accept-Encoding"</font> : <font color="#BA2121">"identity, *;q=0"</font> , <br> <font color="#BA2121">"Connection"</font> : <font color="#BA2121">"Keep-Alive"</font> } <br> <font color="#408080"><em>#      www.google.com  </em></font> <br> <font color="#408080"><em># ,       HEADERS,</em></font> <br> <font color="#408080"><em>#    Opera   , </em></font> <br> <font color="#408080"><em>#       zlib compressed data, ..</em></font> <br> <font color="#408080"><em>#  -         , </em></font> <br> <font color="#408080"><em>#      ...</em></font> <br> THREADS_COUNT <font color="#666666">=</font> <font color="#666666">10</font> <br> <font color="#408080"><em>#     , - </em></font> <br> DEEP <font color="#666666">=</font> <font color="#666666">30</font> <br> <font color="#408080"><em># - ,      , </em></font> <br> <font color="#408080"><em># ,      ,</em></font> <br> <font color="#408080"><em>#   .</em></font> <br> ENCODING <font color="#666666">=</font> <font color="#BA2121">"UTF-8"</font> <br> <font color="#408080"><em>#   (       </em></font> <br> <font color="#408080"><em>#    )</em></font> <br> <font color="#408080"><em>#==============================&lt;/&gt;===================================</em></font> <br> <br> LOCK <font color="#666666">=</font> threading <font color="#666666">.</font> RLock() <br> <font color="#408080"><em>#        threading</em></font> <br> <font color="#408080"><em>#  LOCK,     threading.RLock </em></font> <br> <font color="#408080"><em># threading,  - ,   </em></font> <br> <font color="#408080"><em>#         </em></font> <br> <font color="#408080"><em>#acquire()   threading.RLock  threading.Lock (  </em></font> <br> <font color="#408080"><em># threading)  ,       </em></font> <br> <font color="#408080"><em>#threading.RLock   ,  threading.Lock </em></font> <br> <font color="#408080"><em>#    .</em></font> <br> <br></code></code> </blockquote> <code><code><font color="#408080"><em>#==================&lt;  &gt;==================</em></font> <br> <font color="#008000"><strong>import</strong></font> <font color="#0000FF"><strong>urllib2</strong></font> <br> <font color="#408080"><em>#     HTTP, </em></font> <br> <font color="#008000"><strong>import</strong></font> <font color="#0000FF"><strong>urllib</strong></font> <br> <font color="#408080"><em>#     HTTP,    urllib2,</em></font> <br> <font color="#408080"><em>#      - urllib.urlquote</em></font> <br> <font color="#008000"><strong>from</strong></font> <font color="#0000FF"><strong>Queue</strong></font> <font color="#008000"><strong>import</strong></font> Queue <br> <font color="#408080"><em>#,    "Pool",   , </em></font> <br> <font color="#408080"><em>#       ,   </em></font> <br> <font color="#408080"><em>#     </em></font> <br> <font color="#008000"><strong>import</strong></font> <font color="#0000FF"><strong>threading</strong></font> <br> <font color="#408080"><em>#    ,    </em></font> <br> <font color="#408080"><em>#threading.active_count, threading.Thread, threading.Thread.start,</em></font> <br> <font color="#408080"><em>#threading.Rlock</em></font> <br> <font color="#008000"><strong>import</strong></font> <font color="#0000FF"><strong>re</strong></font> <br> <font color="#408080"><em>#     ,   </em></font> <br> <font color="#408080"><em>#  </em></font> <br> <font color="#008000"><strong>import</strong></font> <font color="#0000FF"><strong>time</strong></font> <br> <font color="#408080"><em>#    ,      sleep</em></font> <br> queue <font color="#666666">=</font> Queue() <br> <font color="#408080"><em># ,     (.. </em></font> <br> <font color="#408080"><em># Queue   Queue   )</em></font> <br> <font color="#408080"><em>#==================&lt;/  &gt;=================</em></font> <br> <br> <font color="#408080"><em>#==============================&lt;&gt;==============================</em></font> <br> PROXY <font color="#666666">=</font> <font color="#BA2121">"10.10.31.103:3128"</font> <br> <font color="#408080"><em>#      -,   </em></font> <br> <font color="#408080"><em>#   ,    </em></font> <br> <font color="#408080"><em># PROXY,     -.  </em></font> <br> <font color="#408080"><em>#    None</em></font> <br> HEADERS <font color="#666666">=</font> { <font color="#BA2121">"User-Agent"</font> : <font color="#BA2121">"Opera/9.64 (Windows NT 5.1; U; en) Presto/2.1.1"</font> , <br> <font color="#BA2121">"Accept"</font> : <font color="#BA2121">"text/html, application/xml;q=0.9, application/xhtml+xml, image/ png, image/jpeg, image/gif, image/x-xbitmap, */*;q=0.1"</font> , <br> <font color="#BA2121">"Accept-Language"</font> : <font color="#BA2121">"ru,uk-UA;q=0.9,uk;q=0.8,en;q=0.7"</font> , <br> <font color="#BA2121">"Accept-Charset"</font> : <font color="#BA2121">"iso-8859-1, utf-8, utf-16, *;q=0.1"</font> , <br> <font color="#BA2121">"Accept-Encoding"</font> : <font color="#BA2121">"identity, *;q=0"</font> , <br> <font color="#BA2121">"Connection"</font> : <font color="#BA2121">"Keep-Alive"</font> } <br> <font color="#408080"><em>#      www.google.com  </em></font> <br> <font color="#408080"><em># ,       HEADERS,</em></font> <br> <font color="#408080"><em>#    Opera   , </em></font> <br> <font color="#408080"><em>#       zlib compressed data, ..</em></font> <br> <font color="#408080"><em>#  -         , </em></font> <br> <font color="#408080"><em>#      ...</em></font> <br> THREADS_COUNT <font color="#666666">=</font> <font color="#666666">10</font> <br> <font color="#408080"><em>#     , - </em></font> <br> DEEP <font color="#666666">=</font> <font color="#666666">30</font> <br> <font color="#408080"><em># - ,      , </em></font> <br> <font color="#408080"><em># ,      ,</em></font> <br> <font color="#408080"><em>#   .</em></font> <br> ENCODING <font color="#666666">=</font> <font color="#BA2121">"UTF-8"</font> <br> <font color="#408080"><em>#   (       </em></font> <br> <font color="#408080"><em>#    )</em></font> <br> <font color="#408080"><em>#==============================&lt;/&gt;===================================</em></font> <br> <br> LOCK <font color="#666666">=</font> threading <font color="#666666">.</font> RLock() <br> <font color="#408080"><em>#        threading</em></font> <br> <font color="#408080"><em>#  LOCK,     threading.RLock </em></font> <br> <font color="#408080"><em># threading,  - ,   </em></font> <br> <font color="#408080"><em>#         </em></font> <br> <font color="#408080"><em>#acquire()   threading.RLock  threading.Lock (  </em></font> <br> <font color="#408080"><em># threading)  ,       </em></font> <br> <font color="#408080"><em>#threading.RLock   ,  threading.Lock </em></font> <br> <font color="#408080"><em>#    .</em></font> <br></code> <br></code> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The main principle for the smooth implementation of multithreading, I think the modularity of the code.  It is not necessary to take the functions you use into separate files or classes, it is enough that at least these are separate functions (Please forgive the pun). <br><br>  Now I will highlight the work of the flow in a separate function, let it be a kind of abstract concept of work.  At this stage, while some of the points will be incomprehensible, but later it will all line up in a clear algorithm. <br><br><blockquote> <code><code><font color="#008000"><strong>def</strong></font> <font color="#0000FF">worker</font> (): <br> <font color="#408080"><em>#   worker,   </em></font> <br> <font color="#008000"><strong>global</strong></font> queue <br> <font color="#408080"><em>#         </em></font> <br> <font color="#408080"><em>#      ,   </em></font> <br> <font color="#408080"><em>#      (!)</em></font> <br> <font color="#008000"><strong>while</strong></font> <font color="#008000">True</font> : <br> <font color="#408080"><em>#  ,     </em></font> <br> <font color="#008000"><strong>try</strong></font> : <br> <font color="#408080"><em># ,  try/except,  </em></font> <br> <font color="#408080"><em># QueueEmpty  ,    ,  </em></font> <br> <font color="#408080"><em>#   </em></font> <br> target_link <font color="#666666">=</font> queue <font color="#666666">.</font> get_nowait() <br> <font color="#408080"><em>#       </em></font> <br> <font color="#408080"><em>#  queue</em></font> <br> <font color="#008000"><strong>except</strong></font> <font color="#D2413A"><strong>Exception</strong></font> , error: <br> <font color="#408080"><em>#  </em></font> <br> <font color="#008000"><strong>return</strong></font> <br> <font color="#408080"><em>#  </em></font> <br> parsed_data <font color="#666666">=</font> get_and_parse_page(target_link) <br> <font color="#408080"><em>#   ,   </em></font> <br> <font color="#408080"><em>#      </em></font> <br> <font color="#008000"><strong>if</strong></font> parsed_data <font color="#666666">!=</font> <font color="#BA2121">"ERROR"</font> : <br> <font color="#408080"><em>#  ,    </em></font> <br> write_to_file(parsed_data) <br> <font color="#408080"><em>#         </em></font> <br> <font color="#008000"><strong>else</strong></font> : <br> queue <font color="#666666">.</font> put(target_link) <br> <font color="#408080"><em>#    ,      queue</em></font> <br> <br></code></code> </blockquote> <code><code><font color="#008000"><strong>def</strong></font> <font color="#0000FF">worker</font> (): <br> <font color="#408080"><em>#   worker,   </em></font> <br> <font color="#008000"><strong>global</strong></font> queue <br> <font color="#408080"><em>#         </em></font> <br> <font color="#408080"><em>#      ,   </em></font> <br> <font color="#408080"><em>#      (!)</em></font> <br> <font color="#008000"><strong>while</strong></font> <font color="#008000">True</font> : <br> <font color="#408080"><em>#  ,     </em></font> <br> <font color="#008000"><strong>try</strong></font> : <br> <font color="#408080"><em># ,  try/except,  </em></font> <br> <font color="#408080"><em># QueueEmpty  ,    ,  </em></font> <br> <font color="#408080"><em>#   </em></font> <br> target_link <font color="#666666">=</font> queue <font color="#666666">.</font> get_nowait() <br> <font color="#408080"><em>#       </em></font> <br> <font color="#408080"><em>#  queue</em></font> <br> <font color="#008000"><strong>except</strong></font> <font color="#D2413A"><strong>Exception</strong></font> , error: <br> <font color="#408080"><em>#  </em></font> <br> <font color="#008000"><strong>return</strong></font> <br> <font color="#408080"><em>#  </em></font> <br> parsed_data <font color="#666666">=</font> get_and_parse_page(target_link) <br> <font color="#408080"><em>#   ,   </em></font> <br> <font color="#408080"><em>#      </em></font> <br> <font color="#008000"><strong>if</strong></font> parsed_data <font color="#666666">!=</font> <font color="#BA2121">"ERROR"</font> : <br> <font color="#408080"><em>#  ,    </em></font> <br> write_to_file(parsed_data) <br> <font color="#408080"><em>#         </em></font> <br> <font color="#008000"><strong>else</strong></font> : <br> queue <font color="#666666">.</font> put(target_link) <br> <font color="#408080"><em>#    ,      queue</em></font> <br></code> <br></code> <br>  The main thing that needs to be clearly understood is the algorithm for the operation of the stream itself, and that it is the threads that must be processed independently of each other.  Total, the flow tasks are very simple - get a link to the search page, pass it to the handler function, from which links to the found sites and the titles of these sites will be returned, after writing the links and title to the file (all this will be in parsed_data). <br><br>  As work progresses, tasks from the simplest to the most complex are implemented, so at these stages the issues of multithreading are practically not affected.  Then came the turn of the implementation of the function that will be responsible for writing to the file. <br><br><blockquote> <code><code><font color="#008000"><strong>def</strong></font> <font color="#0000FF">write_to_file</font> (parsed_data): <br> <font color="#408080"><em>#  write_to_file,  ‚Äì   </em></font> <br> <font color="#008000"><strong>global</strong></font> LOCK <br> <font color="#008000"><strong>global</strong></font> ENCODING <br> LOCK <font color="#666666">.</font> acquire() <br> <font color="#408080"><em>#" ",      </em></font> <br> <font color="#408080"><em>#         </em></font> <br> <font color="#008000"><strong>with</strong></font> <font color="#008000">open</font> ( <font color="#BA2121">"parsed_data.txt"</font> , <font color="#BA2121">"a"</font> ) <font color="#008000"><strong>as</strong></font> out: <br> <font color="#408080"><em># with statement,   parsed_data.txt </em></font> <br> <font color="#408080"><em># "a",      ,  </em></font> <br> <font color="#408080"><em>#    out (  )</em></font> <br> <font color="#008000"><strong>for</strong></font> site <font color="#AA22FF"><strong>in</strong></font> parsed_data: <br> <font color="#408080"><em>#     parsed data,   </em></font> <br> <font color="#408080"><em>#    site</em></font> <br> link, title <font color="#666666">=</font> site[ <font color="#666666">0</font> ], site[ <font color="#666666">1</font> ] <br> <font color="#408080"><em>#  link  title    site</em></font> <br> title <font color="#666666">=</font> title <font color="#666666">.</font> replace( <font color="#BA2121">"&lt;em&gt;"</font> , <font color="#BA2121">""</font> ) <font color="#666666">.</font> replace( <font color="#BA2121">"&lt;/em&gt;"</font> , <font color="#BA2121">""</font> ) <font color="#666666">.</font> replace( <font color="#BA2121">"&lt;b&gt;"</font> , <font color="#BA2121">""</font> ) <font color="#666666">.</font> replace( <font color="#BA2121">"&lt;/b&gt;"</font> , <font color="#BA2121">""</font> ) <br> <font color="#408080"><em>#.replace -  HTML-,    title    </em></font> <br> out <font color="#666666">.</font> write( <font color="#BA2121">u"{link}|{title}</font> <font color="#BB6622"><strong>\n</strong></font> <font color="#BA2121">"</font> <font color="#666666">.</font> format(link <font color="#666666">=</font> link, title <font color="#666666">=</font> title) <font color="#666666">.</font> encode( <font color="#BA2121">"cp1251"</font> )) <br> <font color="#408080"><em>#    ,   </em></font> <br> <font color="#408080"><em># .format,    %    ,    </em></font> <br> <font color="#408080"><em># ,       :</em></font> <br> <font color="#408080"><em>#   | title \n -  (  </em></font> <br> <font color="#408080"><em>#   cp1251)</em></font> <br> LOCK <font color="#666666">.</font> release() <br> <font color="#408080"><em>#""  ,       </em></font> <br> <font color="#408080"><em>#       . -,   </em></font> <br> <font color="#408080"><em>#  ,    ,     </em></font> <br> <font color="#408080"><em># (      )    </em></font> <br> <font color="#408080"><em>#    ‚Äú ‚Äù   </em></font> <br> <font color="#408080"><em>#  parsed_data.txt</em></font> <br> <br></code></code> </blockquote> <code><code><font color="#008000"><strong>def</strong></font> <font color="#0000FF">write_to_file</font> (parsed_data): <br> <font color="#408080"><em>#  write_to_file,  ‚Äì   </em></font> <br> <font color="#008000"><strong>global</strong></font> LOCK <br> <font color="#008000"><strong>global</strong></font> ENCODING <br> LOCK <font color="#666666">.</font> acquire() <br> <font color="#408080"><em>#" ",      </em></font> <br> <font color="#408080"><em>#         </em></font> <br> <font color="#008000"><strong>with</strong></font> <font color="#008000">open</font> ( <font color="#BA2121">"parsed_data.txt"</font> , <font color="#BA2121">"a"</font> ) <font color="#008000"><strong>as</strong></font> out: <br> <font color="#408080"><em># with statement,   parsed_data.txt </em></font> <br> <font color="#408080"><em># "a",      ,  </em></font> <br> <font color="#408080"><em>#    out (  )</em></font> <br> <font color="#008000"><strong>for</strong></font> site <font color="#AA22FF"><strong>in</strong></font> parsed_data: <br> <font color="#408080"><em>#     parsed data,   </em></font> <br> <font color="#408080"><em>#    site</em></font> <br> link, title <font color="#666666">=</font> site[ <font color="#666666">0</font> ], site[ <font color="#666666">1</font> ] <br> <font color="#408080"><em>#  link  title    site</em></font> <br> title <font color="#666666">=</font> title <font color="#666666">.</font> replace( <font color="#BA2121">"&lt;em&gt;"</font> , <font color="#BA2121">""</font> ) <font color="#666666">.</font> replace( <font color="#BA2121">"&lt;/em&gt;"</font> , <font color="#BA2121">""</font> ) <font color="#666666">.</font> replace( <font color="#BA2121">"&lt;b&gt;"</font> , <font color="#BA2121">""</font> ) <font color="#666666">.</font> replace( <font color="#BA2121">"&lt;/b&gt;"</font> , <font color="#BA2121">""</font> ) <br> <font color="#408080"><em>#.replace -  HTML-,    title    </em></font> <br> out <font color="#666666">.</font> write( <font color="#BA2121">u"{link}|{title}</font> <font color="#BB6622"><strong>\n</strong></font> <font color="#BA2121">"</font> <font color="#666666">.</font> format(link <font color="#666666">=</font> link, title <font color="#666666">=</font> title) <font color="#666666">.</font> encode( <font color="#BA2121">"cp1251"</font> )) <br> <font color="#408080"><em>#    ,   </em></font> <br> <font color="#408080"><em># .format,    %    ,    </em></font> <br> <font color="#408080"><em># ,       :</em></font> <br> <font color="#408080"><em>#   | title \n -  (  </em></font> <br> <font color="#408080"><em>#   cp1251)</em></font> <br> LOCK <font color="#666666">.</font> release() <br> <font color="#408080"><em>#""  ,       </em></font> <br> <font color="#408080"><em>#       . -,   </em></font> <br> <font color="#408080"><em>#  ,    ,     </em></font> <br> <font color="#408080"><em># (      )    </em></font> <br> <font color="#408080"><em>#    ‚Äú ‚Äù   </em></font> <br> <font color="#408080"><em>#  parsed_data.txt</em></font> <br></code> <br></code> <br><br>  Next comes the implementation of the get_and_parse_page function: <br> <code><code><a href=""></a> <font color="#008000"><strong>def</strong></font> <font color="#0000FF">get_and_parse_page</font> (target_link): <br> <font color="#408080"><em># ,  ‚Äì   </em></font> <br> <font color="#008000"><strong>global</strong></font> PROXY <br> <font color="#408080"><em>#  ,       PROXY</em></font> <br> <font color="#408080"><em>#   </em></font> <br> <font color="#008000"><strong>global</strong></font> HEADERS <br> <font color="#408080"><em>#     Headers</em></font> <br> <font color="#008000"><strong>if</strong></font> PROXY <font color="#AA22FF"><strong>is</strong></font> <font color="#AA22FF"><strong>not</strong></font> <font color="#008000">None</font> : <br> <font color="#408080"><em>#  PROXY   None</em></font> <br> proxy_handler <font color="#666666">=</font> urllib2 <font color="#666666">.</font> ProxyHandler( { <font color="#BA2121">"http"</font> : <font color="#BA2121">""</font> <font color="#666666">+</font> PROXY <font color="#666666">+</font> <font color="#BA2121">"/"</font> } ) <br> <font color="#408080"><em># -   </em></font> <br> opener <font color="#666666">=</font> urllib2 <font color="#666666">.</font> build_opener(proxy_handler) <br> <font color="#408080"><em>#  opener c   -</em></font> <br> urllib2 <font color="#666666">.</font> install_opener(opener) <br> <font color="#408080"><em># -  ,    </em></font> <br> <font color="#408080"><em>#,       urllib2</em></font> <br> <font color="#408080"><em>#(        </em></font> <br> <font color="#408080"><em>#PROXY)</em></font> <br> page_request <font color="#666666">=</font> urllib2 <font color="#666666">.</font> Request(url <font color="#666666">=</font> target_link, headers <font color="#666666">=</font> HEADERS) <br> <font color="#408080"><em>#  Request,    Request instance,</em></font> <br> <font color="#408080"><em>#  GET      , </em></font> <br> <font color="#408080"><em>#   ...</em></font> <br> <font color="#008000"><strong>try</strong></font> : <br> <font color="#408080"><em>#   ,    </em></font> <br> <font color="#408080"><em>#,  ,      </em></font> <br> page <font color="#666666">=</font> urllib2 <font color="#666666">.</font> urlopen(url <font color="#666666">=</font> page_request) <font color="#666666">.</font> read() <font color="#666666">.</font> decode( <font color="#BA2121">"UTF-8"</font> , <font color="#BA2121">"replace"</font> ) <br> <font color="#408080"><em># page     , </em></font> <br> <font color="#408080"><em># unicode   UTF-8 (,   www.google.com) (</em></font> <br> <font color="#408080"><em>#Python 2.6 unicode -   (!))</em></font> <br> <font color="#008000"><strong>except</strong></font> <font color="#D2413A"><strong>Exception</strong></font> ,error: <br> <font color="#408080"><em>#         error</em></font> <br> <font color="#008000"><strong>print</strong></font> <font color="#008000">str</font> (error) <br> <font color="#408080"><em>#   ,     </em></font> <br> <font color="#408080"><em>#(   )</em></font> <br> <font color="#008000"><strong>return</strong></font> <font color="#BA2121">"ERROR"</font> <br> <font color="#408080"><em>#     ,      </em></font> <br> harvested_data <font color="#666666">=</font> re <font color="#666666">.</font> findall( <font color="#BA2121">r'''\&lt;li\ class\=g\&gt;\&lt;h3\ class\=r\&gt;\&lt;a\ href\=\"(.*?)".*?&gt;(.*?)\&lt;\/a\&gt;\&lt;\/h3\&gt;'''</font> , page) <br> <font color="#408080"><em>#      title  </em></font> <br> <font color="#408080"><em>#      ,   .  </em></font> <br> <font color="#008000"><strong>for</strong></font> data <font color="#AA22FF"><strong>in</strong></font> harvested_data: <br> <font color="#408080"><em>#    harvested_data    data</em></font> <br> <font color="#008000"><strong>if</strong></font> data[ <font color="#666666">0</font> ] <font color="#666666">.</font> startswith( <font color="#BA2121">"/"</font> ): <br> <font color="#408080"><em>#    data()    /</em></font> <br> harvested_data <font color="#666666">.</font> remove(data) <br> <font color="#408080"><em>#    harvested_data</em></font> <br> <font color="#008000"><strong>if</strong></font> <font color="#BA2121">".google.com"</font> <font color="#AA22FF"><strong>in</strong></font> data[ <font color="#666666">0</font> ]: <br> <font color="#408080"><em>#    data()    .google.com</em></font> <br> harvested_data <font color="#666666">.</font> remove(data) <br> <font color="#408080"><em>#     harvested_data</em></font> <br> <font color="#008000"><strong>return</strong></font> harvested_data <br> <font color="#408080"><em>#    </em></font> <br> <br></code></code> <blockquote> <code><code><a href=""></a> <font color="#008000"><strong>def</strong></font> <font color="#0000FF">get_and_parse_page</font> (target_link): <br> <font color="#408080"><em># ,  ‚Äì   </em></font> <br> <font color="#008000"><strong>global</strong></font> PROXY <br> <font color="#408080"><em>#  ,       PROXY</em></font> <br> <font color="#408080"><em>#   </em></font> <br> <font color="#008000"><strong>global</strong></font> HEADERS <br> <font color="#408080"><em>#     Headers</em></font> <br> <font color="#008000"><strong>if</strong></font> PROXY <font color="#AA22FF"><strong>is</strong></font> <font color="#AA22FF"><strong>not</strong></font> <font color="#008000">None</font> : <br> <font color="#408080"><em>#  PROXY   None</em></font> <br> proxy_handler <font color="#666666">=</font> urllib2 <font color="#666666">.</font> ProxyHandler( { <font color="#BA2121">"http"</font> : <font color="#BA2121">""</font> <font color="#666666">+</font> PROXY <font color="#666666">+</font> <font color="#BA2121">"/"</font> } ) <br> <font color="#408080"><em># -   </em></font> <br> opener <font color="#666666">=</font> urllib2 <font color="#666666">.</font> build_opener(proxy_handler) <br> <font color="#408080"><em>#  opener c   -</em></font> <br> urllib2 <font color="#666666">.</font> install_opener(opener) <br> <font color="#408080"><em># -  ,    </em></font> <br> <font color="#408080"><em>#,       urllib2</em></font> <br> <font color="#408080"><em>#(        </em></font> <br> <font color="#408080"><em>#PROXY)</em></font> <br> page_request <font color="#666666">=</font> urllib2 <font color="#666666">.</font> Request(url <font color="#666666">=</font> target_link, headers <font color="#666666">=</font> HEADERS) <br> <font color="#408080"><em>#  Request,    Request instance,</em></font> <br> <font color="#408080"><em>#  GET      , </em></font> <br> <font color="#408080"><em>#   ...</em></font> <br> <font color="#008000"><strong>try</strong></font> : <br> <font color="#408080"><em>#   ,    </em></font> <br> <font color="#408080"><em>#,  ,      </em></font> <br> page <font color="#666666">=</font> urllib2 <font color="#666666">.</font> urlopen(url <font color="#666666">=</font> page_request) <font color="#666666">.</font> read() <font color="#666666">.</font> decode( <font color="#BA2121">"UTF-8"</font> , <font color="#BA2121">"replace"</font> ) <br> <font color="#408080"><em># page     , </em></font> <br> <font color="#408080"><em># unicode   UTF-8 (,   www.google.com) (</em></font> <br> <font color="#408080"><em>#Python 2.6 unicode -   (!))</em></font> <br> <font color="#008000"><strong>except</strong></font> <font color="#D2413A"><strong>Exception</strong></font> ,error: <br> <font color="#408080"><em>#         error</em></font> <br> <font color="#008000"><strong>print</strong></font> <font color="#008000">str</font> (error) <br> <font color="#408080"><em>#   ,     </em></font> <br> <font color="#408080"><em>#(   )</em></font> <br> <font color="#008000"><strong>return</strong></font> <font color="#BA2121">"ERROR"</font> <br> <font color="#408080"><em>#     ,      </em></font> <br> harvested_data <font color="#666666">=</font> re <font color="#666666">.</font> findall( <font color="#BA2121">r'''\&lt;li\ class\=g\&gt;\&lt;h3\ class\=r\&gt;\&lt;a\ href\=\"(.*?)".*?&gt;(.*?)\&lt;\/a\&gt;\&lt;\/h3\&gt;'''</font> , page) <br> <font color="#408080"><em>#      title  </em></font> <br> <font color="#408080"><em>#      ,   .  </em></font> <br> <font color="#008000"><strong>for</strong></font> data <font color="#AA22FF"><strong>in</strong></font> harvested_data: <br> <font color="#408080"><em>#    harvested_data    data</em></font> <br> <font color="#008000"><strong>if</strong></font> data[ <font color="#666666">0</font> ] <font color="#666666">.</font> startswith( <font color="#BA2121">"/"</font> ): <br> <font color="#408080"><em>#    data()    /</em></font> <br> harvested_data <font color="#666666">.</font> remove(data) <br> <font color="#408080"><em>#    harvested_data</em></font> <br> <font color="#008000"><strong>if</strong></font> <font color="#BA2121">".google.com"</font> <font color="#AA22FF"><strong>in</strong></font> data[ <font color="#666666">0</font> ]: <br> <font color="#408080"><em>#    data()    .google.com</em></font> <br> harvested_data <font color="#666666">.</font> remove(data) <br> <font color="#408080"><em>#     harvested_data</em></font> <br> <font color="#008000"><strong>return</strong></font> harvested_data <br> <font color="#408080"><em>#    </em></font> <br> <br></code></code> </blockquote> <code><code><a href=""></a> <font color="#008000"><strong>def</strong></font> <font color="#0000FF">get_and_parse_page</font> (target_link): <br> <font color="#408080"><em># ,  ‚Äì   </em></font> <br> <font color="#008000"><strong>global</strong></font> PROXY <br> <font color="#408080"><em>#  ,       PROXY</em></font> <br> <font color="#408080"><em>#   </em></font> <br> <font color="#008000"><strong>global</strong></font> HEADERS <br> <font color="#408080"><em>#     Headers</em></font> <br> <font color="#008000"><strong>if</strong></font> PROXY <font color="#AA22FF"><strong>is</strong></font> <font color="#AA22FF"><strong>not</strong></font> <font color="#008000">None</font> : <br> <font color="#408080"><em>#  PROXY   None</em></font> <br> proxy_handler <font color="#666666">=</font> urllib2 <font color="#666666">.</font> ProxyHandler( { <font color="#BA2121">"http"</font> : <font color="#BA2121">""</font> <font color="#666666">+</font> PROXY <font color="#666666">+</font> <font color="#BA2121">"/"</font> } ) <br> <font color="#408080"><em># -   </em></font> <br> opener <font color="#666666">=</font> urllib2 <font color="#666666">.</font> build_opener(proxy_handler) <br> <font color="#408080"><em>#  opener c   -</em></font> <br> urllib2 <font color="#666666">.</font> install_opener(opener) <br> <font color="#408080"><em># -  ,    </em></font> <br> <font color="#408080"><em>#,       urllib2</em></font> <br> <font color="#408080"><em>#(        </em></font> <br> <font color="#408080"><em>#PROXY)</em></font> <br> page_request <font color="#666666">=</font> urllib2 <font color="#666666">.</font> Request(url <font color="#666666">=</font> target_link, headers <font color="#666666">=</font> HEADERS) <br> <font color="#408080"><em>#  Request,    Request instance,</em></font> <br> <font color="#408080"><em>#  GET      , </em></font> <br> <font color="#408080"><em>#   ...</em></font> <br> <font color="#008000"><strong>try</strong></font> : <br> <font color="#408080"><em>#   ,    </em></font> <br> <font color="#408080"><em>#,  ,      </em></font> <br> page <font color="#666666">=</font> urllib2 <font color="#666666">.</font> urlopen(url <font color="#666666">=</font> page_request) <font color="#666666">.</font> read() <font color="#666666">.</font> decode( <font color="#BA2121">"UTF-8"</font> , <font color="#BA2121">"replace"</font> ) <br> <font color="#408080"><em># page     , </em></font> <br> <font color="#408080"><em># unicode   UTF-8 (,   www.google.com) (</em></font> <br> <font color="#408080"><em>#Python 2.6 unicode -   (!))</em></font> <br> <font color="#008000"><strong>except</strong></font> <font color="#D2413A"><strong>Exception</strong></font> ,error: <br> <font color="#408080"><em>#         error</em></font> <br> <font color="#008000"><strong>print</strong></font> <font color="#008000">str</font> (error) <br> <font color="#408080"><em>#   ,     </em></font> <br> <font color="#408080"><em>#(   )</em></font> <br> <font color="#008000"><strong>return</strong></font> <font color="#BA2121">"ERROR"</font> <br> <font color="#408080"><em>#     ,      </em></font> <br> harvested_data <font color="#666666">=</font> re <font color="#666666">.</font> findall( <font color="#BA2121">r'''\&lt;li\ class\=g\&gt;\&lt;h3\ class\=r\&gt;\&lt;a\ href\=\"(.*?)".*?&gt;(.*?)\&lt;\/a\&gt;\&lt;\/h3\&gt;'''</font> , page) <br> <font color="#408080"><em>#      title  </em></font> <br> <font color="#408080"><em>#      ,   .  </em></font> <br> <font color="#008000"><strong>for</strong></font> data <font color="#AA22FF"><strong>in</strong></font> harvested_data: <br> <font color="#408080"><em>#    harvested_data    data</em></font> <br> <font color="#008000"><strong>if</strong></font> data[ <font color="#666666">0</font> ] <font color="#666666">.</font> startswith( <font color="#BA2121">"/"</font> ): <br> <font color="#408080"><em>#    data()    /</em></font> <br> harvested_data <font color="#666666">.</font> remove(data) <br> <font color="#408080"><em>#    harvested_data</em></font> <br> <font color="#008000"><strong>if</strong></font> <font color="#BA2121">".google.com"</font> <font color="#AA22FF"><strong>in</strong></font> data[ <font color="#666666">0</font> ]: <br> <font color="#408080"><em>#    data()    .google.com</em></font> <br> harvested_data <font color="#666666">.</font> remove(data) <br> <font color="#408080"><em>#     harvested_data</em></font> <br> <font color="#008000"><strong>return</strong></font> harvested_data <br> <font color="#408080"><em>#    </em></font> <br></code> <br></code> <br><br>  Finally it was the turn to implement the main body of the application: <br> <code><code><a href="http://www.google.com/search%3Fhl%3Dru%26client%3Dopera%26rls%3Dru%26hs%3D67v%26q%3D"></a> <font color="#008000"><strong>def</strong></font> <font color="#0000FF">main</font> (): <br> <font color="#408080"><em># ,   </em></font> <br> <font color="#008000"><strong>print</strong></font> <font color="#BA2121">"STARTED"</font> <br> <font color="#408080"><em>#     </em></font> <br> <font color="#008000"><strong>global</strong></font> THREADS_COUNT <br> <font color="#008000"><strong>global</strong></font> DEEP <br> <font color="#008000"><strong>global</strong></font> ENCODING <br> <font color="#408080"><em>#       </em></font> <br> <font color="#408080"><em>#   </em></font> <br> <font color="#008000"><strong>with</strong></font> <font color="#008000">open</font> ( <font color="#BA2121">"requests.txt"</font> ) <font color="#008000"><strong>as</strong></font> requests: <br> <font color="#408080"><em>#  requests      </em></font> <br> <font color="#008000"><strong>for</strong></font> request <font color="#AA22FF"><strong>in</strong></font> requests: <br> <font color="#408080"><em>#    ,  </em></font> <br> <font color="#408080"><em>#   ,     ,  </em></font> <br> <font color="#408080"><em>#  ,      :)</em></font> <br> request <font color="#666666">=</font> request <font color="#666666">.</font> translate( <font color="#008000">None</font> , <font color="#BA2121">"</font> <font color="#BB6622"><strong>\r\n</strong></font> <font color="#BA2121">"</font> ) <font color="#666666">.</font> decode(ENCODING, <font color="#BA2121">"replace"</font> ) <br> <font color="#408080"><em>#        </em></font> <br> <font color="#408080"><em>#   (   )</em></font> <br> empty_link <font color="#666666">=</font> <font color="#BA2121">"www.google.com/search?hl=ru&amp;client=opera&amp;rls=ru&amp;hs=67v&amp;q={request}&amp;start={N}&amp;sa=N"</font> <br> <font color="#408080"><em>#    , </em></font> <br> <font color="#008000"><strong>for</strong></font> i <font color="#AA22FF"><strong>in</strong></font> <font color="#008000">xrange</font> ( <font color="#666666">0</font> , DEEP, <font color="#666666">10</font> ): <br> <font color="#408080"><em>#    #  0  DEEP,</em></font> <br> <font color="#408080"><em>#      </em></font> <br> <font color="#408080"><em>#  10, ..     </em></font> <br> <font color="#408080"><em># , .. 10, 20, 30 (    )</em></font> <br> queue <font color="#666666">.</font> put(empty_link <font color="#666666">.</font> format(request <font color="#666666">=</font> request <font color="#666666">.</font> encode( <font color="#BA2121">"UTF-8"</font> ), N <font color="#666666">=</font> i)) <br> <font color="#408080"><em>#     </em></font> <br> <font color="#408080"><em>#     UTF-8 ( )</em></font> <br> <font color="#008000"><strong>for</strong></font> _ <font color="#AA22FF"><strong>in</strong></font> <font color="#008000">xrange</font> (THREADS_COUNT): <br> <font color="#408080"><em>#      </em></font> <br> thread_ <font color="#666666">=</font> threading <font color="#666666">.</font> Thread(target <font color="#666666">=</font> worker) <br> <font color="#408080"><em># , target- ,   </em></font> <br> <font color="#408080"><em># ,  </em></font> <br> thread_ <font color="#666666">.</font> start() <br> <font color="#408080"><em>#  start() ,    </em></font> <br> <font color="#008000"><strong>while</strong></font> threading <font color="#666666">.</font> active_count() <font color="#666666">&gt;1</font> : <br> <font color="#408080"><em>#  ,      1 (,</em></font> <br> <font color="#408080"><em>#   )</em></font> <br> time <font color="#666666">.</font> sleep( <font color="#666666">1</font> ) <br> <font color="#408080"><em>#    1 </em></font> <br> <font color="#008000"><strong>print</strong></font> <font color="#BA2121">"FINISHED"</font> <br> <font color="#408080"><em>#      </em></font> <br> <br></code></code> <blockquote> <code><code><a href="http://www.google.com/search%3Fhl%3Dru%26client%3Dopera%26rls%3Dru%26hs%3D67v%26q%3D"></a> <font color="#008000"><strong>def</strong></font> <font color="#0000FF">main</font> (): <br> <font color="#408080"><em># ,   </em></font> <br> <font color="#008000"><strong>print</strong></font> <font color="#BA2121">"STARTED"</font> <br> <font color="#408080"><em>#     </em></font> <br> <font color="#008000"><strong>global</strong></font> THREADS_COUNT <br> <font color="#008000"><strong>global</strong></font> DEEP <br> <font color="#008000"><strong>global</strong></font> ENCODING <br> <font color="#408080"><em>#       </em></font> <br> <font color="#408080"><em>#   </em></font> <br> <font color="#008000"><strong>with</strong></font> <font color="#008000">open</font> ( <font color="#BA2121">"requests.txt"</font> ) <font color="#008000"><strong>as</strong></font> requests: <br> <font color="#408080"><em>#  requests      </em></font> <br> <font color="#008000"><strong>for</strong></font> request <font color="#AA22FF"><strong>in</strong></font> requests: <br> <font color="#408080"><em>#    ,  </em></font> <br> <font color="#408080"><em>#   ,     ,  </em></font> <br> <font color="#408080"><em>#  ,      :)</em></font> <br> request <font color="#666666">=</font> request <font color="#666666">.</font> translate( <font color="#008000">None</font> , <font color="#BA2121">"</font> <font color="#BB6622"><strong>\r\n</strong></font> <font color="#BA2121">"</font> ) <font color="#666666">.</font> decode(ENCODING, <font color="#BA2121">"replace"</font> ) <br> <font color="#408080"><em>#        </em></font> <br> <font color="#408080"><em>#   (   )</em></font> <br> empty_link <font color="#666666">=</font> <font color="#BA2121">"www.google.com/search?hl=ru&amp;client=opera&amp;rls=ru&amp;hs=67v&amp;q={request}&amp;start={N}&amp;sa=N"</font> <br> <font color="#408080"><em>#    , </em></font> <br> <font color="#008000"><strong>for</strong></font> i <font color="#AA22FF"><strong>in</strong></font> <font color="#008000">xrange</font> ( <font color="#666666">0</font> , DEEP, <font color="#666666">10</font> ): <br> <font color="#408080"><em>#    #  0  DEEP,</em></font> <br> <font color="#408080"><em>#      </em></font> <br> <font color="#408080"><em>#  10, ..     </em></font> <br> <font color="#408080"><em># , .. 10, 20, 30 (    )</em></font> <br> queue <font color="#666666">.</font> put(empty_link <font color="#666666">.</font> format(request <font color="#666666">=</font> request <font color="#666666">.</font> encode( <font color="#BA2121">"UTF-8"</font> ), N <font color="#666666">=</font> i)) <br> <font color="#408080"><em>#     </em></font> <br> <font color="#408080"><em>#     UTF-8 ( )</em></font> <br> <font color="#008000"><strong>for</strong></font> _ <font color="#AA22FF"><strong>in</strong></font> <font color="#008000">xrange</font> (THREADS_COUNT): <br> <font color="#408080"><em>#      </em></font> <br> thread_ <font color="#666666">=</font> threading <font color="#666666">.</font> Thread(target <font color="#666666">=</font> worker) <br> <font color="#408080"><em># , target- ,   </em></font> <br> <font color="#408080"><em># ,  </em></font> <br> thread_ <font color="#666666">.</font> start() <br> <font color="#408080"><em>#  start() ,    </em></font> <br> <font color="#008000"><strong>while</strong></font> threading <font color="#666666">.</font> active_count() <font color="#666666">&gt;1</font> : <br> <font color="#408080"><em>#  ,      1 (,</em></font> <br> <font color="#408080"><em>#   )</em></font> <br> time <font color="#666666">.</font> sleep( <font color="#666666">1</font> ) <br> <font color="#408080"><em>#    1 </em></font> <br> <font color="#008000"><strong>print</strong></font> <font color="#BA2121">"FINISHED"</font> <br> <font color="#408080"><em>#      </em></font> <br> <br></code></code> </blockquote> <code><code><a href="http://www.google.com/search%3Fhl%3Dru%26client%3Dopera%26rls%3Dru%26hs%3D67v%26q%3D"></a> <font color="#008000"><strong>def</strong></font> <font color="#0000FF">main</font> (): <br> <font color="#408080"><em># ,   </em></font> <br> <font color="#008000"><strong>print</strong></font> <font color="#BA2121">"STARTED"</font> <br> <font color="#408080"><em>#     </em></font> <br> <font color="#008000"><strong>global</strong></font> THREADS_COUNT <br> <font color="#008000"><strong>global</strong></font> DEEP <br> <font color="#008000"><strong>global</strong></font> ENCODING <br> <font color="#408080"><em>#       </em></font> <br> <font color="#408080"><em>#   </em></font> <br> <font color="#008000"><strong>with</strong></font> <font color="#008000">open</font> ( <font color="#BA2121">"requests.txt"</font> ) <font color="#008000"><strong>as</strong></font> requests: <br> <font color="#408080"><em>#  requests      </em></font> <br> <font color="#008000"><strong>for</strong></font> request <font color="#AA22FF"><strong>in</strong></font> requests: <br> <font color="#408080"><em>#    ,  </em></font> <br> <font color="#408080"><em>#   ,     ,  </em></font> <br> <font color="#408080"><em>#  ,      :)</em></font> <br> request <font color="#666666">=</font> request <font color="#666666">.</font> translate( <font color="#008000">None</font> , <font color="#BA2121">"</font> <font color="#BB6622"><strong>\r\n</strong></font> <font color="#BA2121">"</font> ) <font color="#666666">.</font> decode(ENCODING, <font color="#BA2121">"replace"</font> ) <br> <font color="#408080"><em>#        </em></font> <br> <font color="#408080"><em>#   (   )</em></font> <br> empty_link <font color="#666666">=</font> <font color="#BA2121">"www.google.com/search?hl=ru&amp;client=opera&amp;rls=ru&amp;hs=67v&amp;q={request}&amp;start={N}&amp;sa=N"</font> <br> <font color="#408080"><em>#    , </em></font> <br> <font color="#008000"><strong>for</strong></font> i <font color="#AA22FF"><strong>in</strong></font> <font color="#008000">xrange</font> ( <font color="#666666">0</font> , DEEP, <font color="#666666">10</font> ): <br> <font color="#408080"><em>#    #  0  DEEP,</em></font> <br> <font color="#408080"><em>#      </em></font> <br> <font color="#408080"><em>#  10, ..     </em></font> <br> <font color="#408080"><em># , .. 10, 20, 30 (    )</em></font> <br> queue <font color="#666666">.</font> put(empty_link <font color="#666666">.</font> format(request <font color="#666666">=</font> request <font color="#666666">.</font> encode( <font color="#BA2121">"UTF-8"</font> ), N <font color="#666666">=</font> i)) <br> <font color="#408080"><em>#     </em></font> <br> <font color="#408080"><em>#     UTF-8 ( )</em></font> <br> <font color="#008000"><strong>for</strong></font> _ <font color="#AA22FF"><strong>in</strong></font> <font color="#008000">xrange</font> (THREADS_COUNT): <br> <font color="#408080"><em>#      </em></font> <br> thread_ <font color="#666666">=</font> threading <font color="#666666">.</font> Thread(target <font color="#666666">=</font> worker) <br> <font color="#408080"><em># , target- ,   </em></font> <br> <font color="#408080"><em># ,  </em></font> <br> thread_ <font color="#666666">.</font> start() <br> <font color="#408080"><em>#  start() ,    </em></font> <br> <font color="#008000"><strong>while</strong></font> threading <font color="#666666">.</font> active_count() <font color="#666666">&gt;1</font> : <br> <font color="#408080"><em>#  ,      1 (,</em></font> <br> <font color="#408080"><em>#   )</em></font> <br> time <font color="#666666">.</font> sleep( <font color="#666666">1</font> ) <br> <font color="#408080"><em>#    1 </em></font> <br> <font color="#008000"><strong>print</strong></font> <font color="#BA2121">"FINISHED"</font> <br> <font color="#408080"><em>#      </em></font> <br></code> <br></code> <br><br>  As a result, we get a normally working multithreaded parser.  Naturally with many drawbacks, but beautifully written, I‚Äôm not happy to comment. <br><br>  <b>Code:</b> <br>  This <b>article</b> + <b>source</b> : <a href="http://sendspace.com/file/mw0pac">sendspace.com/file/mw0pac</a> <br>  <b>Code</b> with <b>russian</b> comments: <a href="http://dumpz.org/15202/">dumpz.org/15202</a> <br>  <b>Code</b> with <b>Ukrainian</b> comments: <a href="http://dumpz.org/15201/">dumpz.org/15201</a> <br><br>  PS Yes, I know that this example will seem to someone irrational using the Queue (hello, cr0w).  But the easiest way to handle error handling is using it. <br>  PPS Material does not claim infallibility.  Naturally, there are 100% bydlokod, no understanding by me of what I am describing, misunderstandings with terms, I am bydlokoder, etc.  etc.  But here there is something that you can‚Äôt scold - it WORKS, and it works exactly as it is expected of, the code is clear and commented so that it will be understandable even to a baby. I hope that it will help someone ... <br><br>  <i>¬©</i> <b>login999</b> <br>  <i>uasc.org.ua</i> </div><p>Source: <a href="https://habr.com/ru/post/78267/">https://habr.com/ru/post/78267/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../78259/index.html">Post initialization dating</a></li>
<li><a href="../78260/index.html">YouTube support in Popcorn Hour discontinued</a></li>
<li><a href="../78262/index.html">Microsoft China stole all the design and code from Plurk (microblogging number 1 in Asia) + UPD2: translation of the full version of events</a></li>
<li><a href="../78264/index.html">Blender Basics 3-rd edition</a></li>
<li><a href="../78265/index.html">Now anyone can pay you on their Visa or MasterCard</a></li>
<li><a href="../78268/index.html">Megafon, MTS and Beeline launch 3G in Moscow. And what about the tariffs?</a></li>
<li><a href="../78272/index.html">VTB 24. Telebank Security</a></li>
<li><a href="../78274/index.html">Chrome as a Christmas present</a></li>
<li><a href="../78277/index.html">screensaver Yandex. Photos for Gnome</a></li>
<li><a href="../78284/index.html">Remembering the action when opening a file in Firefox</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>