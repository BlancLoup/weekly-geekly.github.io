<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Friday JS: How to be inspired by Smalltalk and go to hell</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When I read the book Game Development Patterns, written by a wonderful man named Bob Nystrom (I don‚Äôt write his name in Russian, because I don‚Äôt have ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Friday JS: How to be inspired by Smalltalk and go to hell</h1><div class="post__text post__text-html js-mediator-article">  When I read the book Game Development Patterns, written by a wonderful man named Bob Nystrom (I don‚Äôt write his name in Russian, because I don‚Äôt have a clue how to pronounce it), in one of the chapters I came across a small ode to the language <a href="https://en.wikipedia.org/wiki/Smalltalk">Smalltalk</a> as the forefather of all modern object-oriented languages, far ahead of its time.  Since I have an irreconcilable affection for all vintage languages ‚Äã‚Äãin my life, of course, I am useful for Google.  And of course, instead of taking something useful out of this experience, I learned the bad. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/957/af7/01d/957af701d6844af2b365f0414910a871.jpg"></div><br><a name="habracut"></a><br>  The peculiarity of the Smalltalk language, for which my opinion was hooked, is the absence of specially trained control structures.  Instead, control flow is implemented by sending messages to objects.  For example, if you send an <b>ifTrue</b> message to a <b>Boolean</b> <b>object</b> with a code block as an additional argument, this code will be executed if and only if the value of the Boolean object is true. <br><br><pre><code class="smalltalk hljs">result := a &gt; b ifTrue:[ <span class="hljs-string"><span class="hljs-string">'greater'</span></span> ] ifFalse:[ <span class="hljs-string"><span class="hljs-string">'less or equal'</span></span> ]</code> </pre> <br>  The phrase ‚Äúboolean object‚Äù sounds somewhat strange if you don‚Äôt know that there are no simple values ‚Äã‚Äãin Smalltalk: each value is an object.  ‚ÄúWait a minute!  - I exclaimed, - something reminds me of it! ‚ÄùAnd wrap everything up ... 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">Disclaimer</b> <div class="spoiler_text">  If you do something similar in the production code, you will go to hell.  And there no one will be friends with you.  Even Hitler.  Hitler, at least, had some kind of goal. </div></div><br>  In JavaScript, not every value is an object.  However, there is an even more fun thing: automatic type casting.  Every time we try to use a simple value as an object (say, access its property), it ‚Äúwraps‚Äù into the corresponding object wrapper.  It is because of this that we can write something like <b>true.toString ()</b> .  A value of <b>true</b> does not have a <b>toString</b> method, it has a <b>new Boolean (true)</b> object.  If you think about it, it is ironic: even when we try to make an explicit type conversion, we implicitly (sorry for the tautology) use an implicit one. <br><br>  To this object wrapper, more precisely, to its prototype, we can ‚Äúhook‚Äù our own methods.  This is not a good idea: if everyone does this, a conflict will arise sooner or later.  Some small library for working with the clipboard will override the method <b>String.prototype.foo</b> , which previously defined some widget for validating user input.  I can assure you, the widget will not like it.  But since today is Friday, and we are not going (we are not going to?) To use it in the code, which innocent people will work with later, you can afford some Dark Arts. <br><br>  Let's start with some analogue of the Smoltokovsky <b>ifTrue</b> . <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span>.prototype.ifThenElse = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">trueCallback, falseCallback</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.valueOf() ? trueCallback() : falseCallback(); }</code> </pre><br>  After that, if we are not afraid to upset mom, we can do things like: <br><br><pre> <code class="javascript hljs">(<span class="hljs-number"><span class="hljs-number">2</span></span> * <span class="hljs-number"><span class="hljs-number">2</span></span> == <span class="hljs-number"><span class="hljs-number">5</span></span>).ifThenElse( <span class="hljs-comment"><span class="hljs-comment">//,  2017        () =&gt; alert("Freedom is Slavery"), () =&gt; alert("O brave new world!") )</span></span></code> </pre><br>  There are several nuances.  First, the interpreter will swear at us with errors if we pass as an argument not a function, but something else (for example, nothing).  Secondly, in JS there is a tradition (which came from C, where there was no Boolean type) to use in the <b>if</b> construction not only logical values, but generally any.  In the normal case, automatic casting will do all the dirty work, turning the ‚Äúfalsy‚Äù values ‚Äã‚Äãto <b>false</b> and the rest to <b>true</b> , but in our case this will not happen: <br><br><pre> <code class="javascript hljs">(<span class="hljs-number"><span class="hljs-number">2</span></span> * <span class="hljs-number"><span class="hljs-number">2</span></span>).ifThenElse( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> alert(<span class="hljs-string"><span class="hljs-string">"Freedom is Slavery"</span></span>), () =&gt; alert(<span class="hljs-string"><span class="hljs-string">"O brave new world!"</span></span>) ) <span class="hljs-comment"><span class="hljs-comment">//      ,  undefined is not a function</span></span></code> </pre><br>  So you need to climb higher.  Instead of adding a method to the <b>Boolean</b> prototype, add it to the <b>Object</b> prototype.  Sounds like a great plan, doesn't it? <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">call</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">arg</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> arg == <span class="hljs-string"><span class="hljs-string">"function"</span></span> ? arg() : arg; } <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.prototype.ifThenElse = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">trueCallback, falseCallback</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.valueOf()){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> call(trueCallback); }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> call(falseCallback); } }</code> </pre><br>  Almost good.  Now our method has numbers, strings, objects ... but not <b>undefined</b> and not <b>null</b> .  Fortunately or unfortunately, they have no object wrapper.  Unfortunately, these are very common false values.  However, this problem is easy to solve: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> nil = { <span class="hljs-attr"><span class="hljs-attr">valueOf</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> } <span class="hljs-comment"><span class="hljs-comment">//  nil  null //  , ?</span></span></code> </pre><br>  Let's define a couple more useful methods. <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>.prototype.for = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">callback</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.valueOf(); i++){ callback(i); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">countdown</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">n</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-number"><span class="hljs-number">10</span></span> - n); } <span class="hljs-number"><span class="hljs-number">10.</span></span>.for(countdown); <span class="hljs-comment"><span class="hljs-comment">//  ,      js       </span></span></code> </pre> <br>  Of course, this is only a faint shadow of this <b>for</b> loop, which (if you are not afraid to spoil karma and be born an opossum in the next life) you can write with an empty body altogether, taking all the logic into the condition and the final expression.  On the other hand, it is the simplest scenario for using the <b>for</b> loop that occurs most often. <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.prototype.forIn = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">callback</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>){ callback(key, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[key], <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } } <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.prototype.forOwn = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">callback</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.hasOwnProperty(key)){ callback(key, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[key], <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } } } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj = {<span class="hljs-attr"><span class="hljs-attr">foo</span></span>: <span class="hljs-string"><span class="hljs-string">"bar"</span></span>}; obj.forIn(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">key</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(key)); <span class="hljs-comment"><span class="hljs-comment">// "forIn", "forOf", "foo" //  "ifThenElse",          obj.forOwn(key =&gt; console.log(key)); // "foo"</span></span></code> </pre> <br>  This is even like something useful.  Do not let this resemblance deceive yourself. <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Function</span></span>.prototype.while = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">callback</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>()){ callback(); } } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> power = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span></span><span class="hljs-function">) =&gt;</span></span> --power).while( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> result *= <span class="hljs-number"><span class="hljs-number">2</span></span> )</code> </pre><br>  If you need to build a deuce to the fifth degree, but nothing smarter than the code above, you didn‚Äôt think up - it‚Äôs better to rush into the nearest shop with a gun-like object, take the cashier and all buyers hostage and demand that someone consider it as you.  Also the idea is so-so, but from the two evils you need to choose the lesser. <br><br>  And finally: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">String</span></span>.prototype.switch = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">callbackObject</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> f = callbackObject[<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.valueOf()]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> f == <span class="hljs-string"><span class="hljs-string">"function"</span></span> ? f() : f; }; <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"1"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> + </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span></span><span class="hljs-function">).</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">switch</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"12"</span></span></span></span><span class="hljs-function"><span class="hljs-params">: (</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">" JS"</span></span>), <span class="hljs-string"><span class="hljs-string">"3"</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"  JS"</span></span>) })</code> </pre><br>  Compared to the standard JS <b>switch</b> , this method has several drawbacks.  First, it works only for strings.  If you wish, you can expand it to arbitrary values, instead of using the <b>Map</b> object, but my desire to do immoral things has dried up for today, and I give it to an inquisitive reader.  Secondly, there is no <b>default</b> .  Thirdly, there is no possibility to do such things: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>(value){ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"   "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">" "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"  "</span></span>); }</code> </pre><br>  However, many will say that it is rather dignity. <br><br>  Well, I hope you had the same fun as me.  And I have to go back to work - well, to the real work.  Where do not write so.  Well, you understand me. </div><p>Source: <a href="https://habr.com/ru/post/321078/">https://habr.com/ru/post/321078/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../321068/index.html">Roskomnadzor for the Bitcoin ban in Russia</a></li>
<li><a href="../321070/index.html">Perspectives of HR robots / bots in the field of staff recruitment - current realities, opinions and experience of experts</a></li>
<li><a href="../321072/index.html">85% of employees scores on project management systems. How do we do our</a></li>
<li><a href="../321074/index.html">sudo rm -rf, or Chronicle of the incident with the database GitLab.com from 2017/01/31</a></li>
<li><a href="../321076/index.html">Powershell and Cyrillic in console applications (updated)</a></li>
<li><a href="../321082/index.html">Friday format: Is there life after the meeting?</a></li>
<li><a href="../321086/index.html">Physics of trains in Assassin's Creed Syndicate</a></li>
<li><a href="../321088/index.html">Network Controller: software-defined networks in Windows Server 2016. Part 1: features and services</a></li>
<li><a href="../321092/index.html">What Xamarin developers should know at the beginning of 2017</a></li>
<li><a href="../321094/index.html">Price Games: Strategies and Psychology of the Buyer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>