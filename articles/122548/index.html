<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Video peephole with minimum costs</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, habra users. 

 I used to look into the peephole from childhood before opening the door to someone‚Äôs apartment. 
 But after the move, it tur...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Video peephole with minimum costs</h1><div class="post__text post__text-html js-mediator-article"><h4>  Good day, habra users. </h4><br><br>  I used to look into the peephole from childhood before opening the door to someone‚Äôs apartment. <br>  But after the move, it turned out that one could not see into the peephole who asks to visit you. <br>  In other words, you need to do something that will allow you to see what is happening near the elevator without leaving your apartment. <br><br>  Like this: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/3b6/7cc/7a1/3b67cc7a14317b9313d10d6d6597f786.jpg" width="300" height="300" alt="" title="video"></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>No sooner said than done!</b> <br><a name="habracut"></a><br><br><h5>  Raw materials </h5><br>  Based on my greed, I didn‚Äôt want to spend a lot of money on this business, so for a start I looked at what I had in stock: <br><ol><li>  HP computer (it costs me as a file server) </li><li>  Old analog camcorder JVC </li><li>  TV tuner AverMedia 307 </li><li>  Meters 5 wires twisted pair (for the video signal is not the best option, but still) </li></ol><br><br>  From this list it is quite possible to build a video surveillance of the corridor. <br>  But one thing: an old video camera of impressive size (hanging it in the corridor is not very beautiful).  I decided to look for a replacement: I looked at a lot of cameras on the Internet, but most of all I liked the color with the possibility of night shooting <a href="http://www.dealextreme.com/p/cmos-color-surveillance-security-camera-with-4-ir-led-night-vision-pal-44677" title="mini night vision camera">, this mini camera</a> costs only $ 12.  I decided and ordered a camera in China, brought it, checked it, everything seemed to work. <br><br><h5>  Let's get together to put it all together. </h5><br><h6>  Camera installation </h6><br>  The camera is sold without anything in the kit.  The camera has two ‚Äútulip‚Äù outputs and one power output (9V) approximately as a connector of an old Nokia.  These connectors did not suit me because of their size, we cut <s>off the head</s> connectors from the shoulders and extend them with a five-meter twisted pair.  Then we stretch the cable to the apartment and connect it to the TV tuner again with the usual ‚Äútulip‚Äù.  I decided to fix the camera in a regular plastic channel for wiring, it just got the width across there.  I corrected the camera for the desired angle and everything is now installed. <br>  Side view of the camera: <br><img src="https://habrastorage.org/getpro/geektimes/post_images/1ec/555/923/1ec5559239b9694cc2b32ea6eb8f60af.jpg" alt="" title="camera"><br>  Front camera view: <br><img src="https://habrastorage.org/getpro/geektimes/post_images/bf8/d93/ab4/bf8d93ab413bf4cdcc32e8618f187e3e.jpg" alt="" title="camera"><br>  We turn to the computer part. <br><br><h6>  Display video from camera </h6><br>  As a server, I chose Ubuntu Server 11.04 when installing it, he asked about the GUI, chose the xfce desktop.  After installation, created a separate user with automatic login to the graphics system and configured the power manager for a permanent job.  I opened firefox and pressed F11 (fullscreen) and closed it, then added firefox to autorun via session settings.  Now when you start the computer, firefox will immediately open in full-screen mode.  Now we will start the most difficult - installation of the video recorder. <br>  I do not exactly remember the whole set of required packages, but the main ones are video4linux video4linux2 and the <a href="http://www.zoneminder.com/" title="zoneminder">zoneminder</a> video server <a href="http://www.zoneminder.com/" title="zoneminder">itself</a> .  When installing the zoneminder (sudo apt-get install zoneminder ffmpeg), it automatically installed apache, mysql, php5 and all the necessary dependencies.  Now make a link to the apache settings: <br>  sudo ln -s /etc/zm/apache.conf /etc/apache2/conf.d/zoneminder <br>  Then restart apache: sudo service apache2 restart <br>  And voila, open localmin <a href="http://localhost/zm">/ zm</a> in the browser from the server <a href="http://localhost/zm">and</a> see the zoneminder-a configuration panel. <br>  Notice in the center at the top of the inscription running (I immediately started, but there are cases when it does not immediately start, if you click on this inscription, you can start the zoneminder daemon). <br>  Looking ahead, I‚Äôll immediately say that in order to display video in a resolution greater than 320x240, you need to increase the kernel memory by writing the following two lines in /etc/sysctl.conf: <br>  kernel.shmall = 134217728 <br>  kernel.shmmax = 134217728 <br>  And to work immediately (without rebooting) you need: <br>  echo 134217728&gt; / proc / sys / kernel / shmall <br>  echo 134217728&gt; / proc / sys / kernel / shmmax <br>  For more detailed configuration of the zoneminder, you can find the necessary information on the official site <a href="http://www.zoneminder.com/" title="zoneminder">zoneminder.org</a> . <br><br>  I will write in two words: <br>  Add a new monitor, select <br>  Source Type -&gt; local (local device) <br>  Function -&gt; monitor (simple viewing, if modect is selected, motion recording will be performed) <br>  Source tab: <br>  Device Path / dev / video1 (To find the path you need sudo apt-get install v4l2-utils and after v4l2_ctl --all) <br>  Capture Method -&gt; I chose Video For Linux Version 2 <br>  Device Channel 1 (I use the composite input in the TV tuner) <br>  Capture Pallette YUYV <br>  Width and Height according to your desire, but for the selected camera I achieved normal operation at a resolution of 500x340. <br>  Buffers -&gt; Image Buffer Size 200 (frame buffer) <br>  Pre Event Image Count 50 (number of frames before the event to record) <br>  Post Event Image Count 50 (number of frames after the event for recording) <br>  The remaining settings can not be changed, but it is intuitively clear what settings are affected. <br>  Next, the settings of the Zoneminder itself, on the main page on the right above the settings link.  I chose STREAM_METHOD mjpeg instead of jpeg in the images tab, as it seemed to me so it works a little faster.  The rest of the settings for your taste and color. <br><br>  Now on the main page there was a recording of a new camera, clicking on its name (Monitor1) will see the video display from the camera: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/3b6/7cc/7a1/3b67cc7a14317b9313d10d6d6597f786.jpg" width="300" height="300" alt="" title="video"></div><br><br>  The video is displayed in the browser, the browser itself works in full-screen mode, by pressing Ctrl-Tab you can navigate through the browser tabs, so along with the video I opened a page with the weather forecast (and set the browser to open tabs from the last session) and now, not leaving I only see if there is anyone in the corridor, but also the weather for today, and then it suddenly rains, and as always I will forget the umbrella. <br>  Weather display: <br><img src="https://habrastorage.org/getpro/geektimes/post_images/2a8/798/d7d/2a8798d7d2485075649891bb2a9bc92e.jpg" alt="" title="weather"><br><br>  And one more bonus.  Taking a device on Android (however, any device with a program that can show streaming IP video) and installing TinyCamMonitor there, setting the following in the host name field like xxxx / cgi-bin / nph-zms? Mode = single &amp; monitor = 1 &amp; scale = 150 &amp; connkey = 722426 &amp; rand = 1308306882 <br>  where xxxx is the IP address of the server, and the path itself can be taken by looking at the source code of the page with video display in the browser and finding id = "liveStream" src = "xxxx / cgi-bin / nph-zms? mode = single &amp; monitor = 1 &amp; scale = 150 &amp; connkey = 932856 &amp; rand = 1308899602 "alt =" Monitor-1 "width =" 750 "height =" 510 ".  Src is the way to go.  Specify the port number (by default 80) and you can see the camera on the screen of your phone or tablet or another device. <br><br>  Thank you for your attention, I hope you were interested in reading this article. </div><p>Source: <a href="https://habr.com/ru/post/122548/">https://habr.com/ru/post/122548/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../122540/index.html">"Single Anti-AO" in Moscow "Megaphone" - be careful!</a></li>
<li><a href="../122541/index.html">New Apple patent hints at the ability to create third-party widgets in iOS 5</a></li>
<li><a href="../122544/index.html">IEEE 802.11b multipath channel simulation</a></li>
<li><a href="../122545/index.html">Rumor has it that Navalny's blog is blocked by fake DNS records</a></li>
<li><a href="../122546/index.html">Habraeffekt in numbers</a></li>
<li><a href="../122550/index.html">JK Rowling will sell electronic versions of Harry Potter books</a></li>
<li><a href="../122551/index.html">Did you know that ...</a></li>
<li><a href="../122553/index.html">Passwords for WPA / WPA2 using a video card</a></li>
<li><a href="../122554/index.html">HTML database</a></li>
<li><a href="../122556/index.html">Cheerick The story of a startup. Honestly</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>