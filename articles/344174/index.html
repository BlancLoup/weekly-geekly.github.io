<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I came up with and used the format of storing the results of experiments Measurelook</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Due to the specifics of scientific activity, I need to measure the time of the algorithms and build on the resulting graph data. Previously, the proce...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How I came up with and used the format of storing the results of experiments Measurelook</h1><div class="post__text post__text-html js-mediator-article"><p>  Due to the specifics of scientific activity, I need to measure the time of the algorithms and build on the resulting graph data.  Previously, the process looked like this: </p><br><ol><li>  Algorithm prepared. </li><li>  Run the experiment, the output goes to the log. </li><li>  Transfer data to Excel. </li><li>  Postprocessing: split, group, sort. </li><li>  Build a graph, and it is a curve - an error in the experiment, go to step 1. </li></ol><br><p>  The first problem - just to see how the experiment went took a very long time. </p><br><p>  Okay, we survived, the graphs were built, time is running, we are preparing a publication, and it turns out that some experimental parameters of the algorithm are not saved in the experimental results.  Did not watch.  This is the second problem - the storage of metadata about the experiment. </p><br><p>  As a programmer, I was always annoyed by the need for ‚Äúmanual work‚Äù.  Yes, the schedule is ready, but we will manually move something else, repaint it, then draw it.  Every time new data arrives, this process has to be repeated.  The third problem - rebuilding charts should be fully automated. </p><br><p>  To solve these problems, I came up with a format for storing data in JSON and called it Measurelook.  In this article I will talk about Measurelook and its use in the preparation of a scientific publication. </p><br><p><img src="https://habrastorage.org/webt/qw/5c/5x/qw5c5xcvokzgbx1wdtrzdp4ddva.png"></p><a name="habracut"></a><br><h2 id="pervoosnovy---format-i-prosmotrovschik">  Principles - Format and Viewer </h2><br><p>  Format and viewer are two key components of Measurelook.  <em>The format</em> describes the data storage scheme of the experiment.  <em>The viewer</em> is a stand-alone web page that visualizes the experiment data.  You load the file with the experiment data into it and the viewer draws graphics on it. </p><br><p>  The viewer also includes a validator and a migrator.  <em>The validator</em> checks with JSON Schema the correctness of the uploaded file.  <em>Migrator</em> automatically updates the version of the file with the experiment.  On the one hand, this ensures backward compatibility with the current version of the viewer.  On the other hand, you do not need to update your source code to the new version of the format, if the old one suits you. </p><br><p>  The format and viewer work together, but when they are created, different goals are pursued.  The format is designed so that the researcher can save the data he needs.  The viewer is made to visualize simple data.  It builds two-dimensional graphics, but there are no three-dimensional or more dimensional ones.  In the format description, I will indicate what the format can store and cannot display the viewer. </p><br><h2 id="format-measurelook">  Measurelook format </h2><br><p>  Measurelook describes the structure of a JSON file for storing information about a computational experiment. </p><br><p>  <em>Meta</em> is an arbitrary JSON object for storing data about an experiment.  Examples of data: the name of the implementation of the algorithm, compilation parameters, parameters of the hardware and software environment, the name of the dataset.  Here you can also display some parameters of the algorithm run, but more on that later. </p><br><p>  Note: The viewer currently does not know how to handle arbitrary metadata.  It assumes that all metadata are strings. </p><br><p>  Example: </p><br><pre><code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"meta"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"Algorithm implementation name"</span></span>: <span class="hljs-string"><span class="hljs-string">"md_cluster4_4"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"dataset"</span></span>: <span class="hljs-string"><span class="hljs-string">"../datasets/power.csv"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"COMPILE_COMPILER_VERSION"</span></span>: <span class="hljs-string"><span class="hljs-string">"Intel(R) C++ gcc 4.4 mode"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"env_core_number"</span></span>: <span class="hljs-string"><span class="hljs-string">"24"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"env_proc_model"</span></span>: <span class="hljs-string"><span class="hljs-string">"model name: Intel(R) Xeon(R) CPU X5680 @ 3.33GHz"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"max"</span></span>: <span class="hljs-number"><span class="hljs-number">35840</span></span>, <span class="hljs-attr"><span class="hljs-attr">"min"</span></span>: <span class="hljs-number"><span class="hljs-number">5120</span></span>, <span class="hljs-attr"><span class="hljs-attr">"step"</span></span>: <span class="hljs-number"><span class="hljs-number">5120</span></span>, <span class="hljs-attr"><span class="hljs-attr">"dataLoadingTime"</span></span>: <span class="hljs-number"><span class="hljs-number">0.062945</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Openmp thread number"</span></span>: <span class="hljs-number"><span class="hljs-number">24</span></span> } }</code> </pre> <br><p>  <em>Algorithm parameters</em> .  Previously, my idea of ‚Äã‚Äãexperiments was somewhat naive - we change one parameter, measure another, build a graph.  Well, well, we change one, measure several, build several graphs.  But when I got acquainted with the thesis of Teplova A.M.  ‚ÄúAnalysis of the scalability of parallel applications based on supercomputer code design technologies‚Äù has changed the concept.  In his study, graphs are built in two variable parameters and one measured.  For example, we change the size of the input data and the number of processes, and measure the performance.  Accordingly, it should be visualized by the surface in three-dimensional space. </p><br><p>  I decided that this is an important generalization and singled out three groups of algorithm parameters: constants, variable parameters and measured parameters. </p><br><p>  <em>A constant</em> is a parameter of an algorithm that does not change during an experiment.  The constant is described by a triple: name, units, value.  It is preferable to store constants in this block, but it may be more convenient for you to store them in metadata.  Example: dataset dimension. </p><br><p>  <em>Variable parameter</em> is a parameter of the algorithm that changes during the experiment.  It is described by a pair: name, unit of measurement.  Example: input data, number of streams. </p><br><p>  <em>The measured parameter</em> is a parameter of the algorithm, which is measured during the experiment.  Previously, it was also described by the pair: name, unit of measurement.  Later, the division into fixed and indirect parameters was added.  The fixed parameter is the value directly measured during the experiment.  Example: data load time, the time of the algorithm.  An indirect parameter is a parameter that is calculated as the sum of the values ‚Äã‚Äãof fixed parameters.  For them, a list of fixed parameters.  Example: the total running time of an algorithm is the sum of the data loading time and the running time of the algorithm. </p><br><p>  Note: currently, the viewer is able to build graphs using only one variable and several measurable parameters.  The case with two variable parameters needs to be drawn as a surface in three-dimensional space or transformed into a series of graphs in two-dimensional space by translating one variable parameter into a measurable one.  This is realizable, but I did not have such a need. </p><br><p>  Examples: </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"constantParams"</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"dimensionality"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"units"</span></span>: <span class="hljs-string"><span class="hljs-string">"natural number"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span> }], <span class="hljs-attr"><span class="hljs-attr">"changedParams"</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"arraySize"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"units"</span></span>: <span class="hljs-string"><span class="hljs-string">"natural number"</span></span> }], <span class="hljs-attr"><span class="hljs-attr">"measuredParams"</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"calcDistMatrix_duration"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"units"</span></span>: <span class="hljs-string"><span class="hljs-string">"seconds"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"direct"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"pamTotal_duration"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"units"</span></span>: <span class="hljs-string"><span class="hljs-string">"seconds"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"indirect"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sumOf"</span></span>: [<span class="hljs-string"><span class="hljs-string">"pamBuild_duration"</span></span>, <span class="hljs-string"><span class="hljs-string">"pamSwap_duration"</span></span>] }], }</code> </pre> <br><p>  After describing the parameters of the experiment go to the <em>measurements</em> .  The structure of the metering record: </p><br><ul><li>  measureKey, a string is a unique key of each measurement.  It is recommended to collect it as a set of values ‚Äã‚Äãfor all variable parameters and the run number. </li><li>  passId, number - number of the pass. </li><li>  changedParams.name, number ‚Äî values ‚Äã‚Äãof all changeable parameters fixed at the time of the run. </li><li>  measuredParams.name, number - the values ‚Äã‚Äãof all measured parameters obtained during the run. </li><li>  The raw object is arbitrary run data you want to keep.  For example, in the future to double-check the values ‚Äã‚Äãof measured parameters. </li></ul><br><p>  Example: </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"measures"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"5120_0"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"measureKey"</span></span>: <span class="hljs-string"><span class="hljs-string">"5120_0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"raw"</span></span>: { }, <span class="hljs-attr"><span class="hljs-attr">"passId"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"arraySize"</span></span>: <span class="hljs-number"><span class="hljs-number">5120</span></span>, <span class="hljs-attr"><span class="hljs-attr">"calcDistMatrix_duration"</span></span>: <span class="hljs-number"><span class="hljs-number">0.033690</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pamBuild_duration"</span></span>: <span class="hljs-number"><span class="hljs-number">0.054846</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pamSwap_duration"</span></span>: <span class="hljs-number"><span class="hljs-number">0.199832</span></span>, <span class="hljs-attr"><span class="hljs-attr">"iterationCount"</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-attr"><span class="hljs-attr">"avgIterationTime_duration"</span></span>: <span class="hljs-number"><span class="hljs-number">0.039966</span></span> } } }</code> </pre> <br><p>  Other values: </p><br><ul><li>  version, string - format version.  The system has a built-in migrator that automatically updates files in the old format to the new one to ensure backward compatibility. </li><li>  name, string - the name of the experiment.  Added to the format, but currently is not used by the viewer. </li><li>  timestamp, string - the time of the experiment.  Indicated in free form.  Added to the format, but currently is not used by the viewer. </li></ul><br><p>  Example: </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.3.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"PAM performance 1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"timestamp"</span></span>: <span class="hljs-string"><span class="hljs-string">"27.11.2017 22:33:44"</span></span>, }</code> </pre> <br><h2 id="prosmotrovschik">  Viewer </h2><br><p>  <em>The viewer</em> is a web page that displays basic information about the experiment and you can see the primary graphs. </p><br><p>  Functions implemented: </p><br><ul><li>  Graph display for each run </li><li>  Display of graphs by mean and / or median </li><li>  Selection of any subset of changeable parameters for drawing </li><li>  Replacing the values ‚Äã‚Äãof variable parameters on their logarithms </li><li>  Display of currently drawn data in a table with the ability to download CSV </li><li>  And the most important feature - pasting the results of the experiment from the clipboard.  Very handy during the debugging process. </li></ul><br><h2 id="ot-dannyh-k-konechnym-grafikam">  From data to final plots </h2><br><p>  JSON is a common thing, the format is simple.  I suppose you can organize data output in this form in many programming languages.  For myself, I made an auxiliary printer in the C language using bstring.  It is published with an example of use on a githab (see links). </p><br><p>  Whereupon I consider that I completed the ‚ÄúHow to do it?‚Äù Part and turn to the ‚ÄúWhat to do with it?‚Äù Part. </p><br><p>  As it was with me - there are a lot of files, measurement results.  It is necessary to process them into beautiful graphics. <br>  I did this as follows: </p><br><ol><li>  The nodejs program reads data and performs post processing.  For example, recalculates the time of the algorithm in acceleration. </li><li>  Called Mustache template engine.  He is given a template of a program in the R language for plotting into which our data is embedded.  At the output we get a program for R drawing the desired schedule. </li><li>  R program is executed, and its result is saved in the vector format svg. </li><li>  svg is converted using Inkscape to the final presentation: pdf image for the article or png for the presentation. </li></ol><br><p>  Anticipating questions: <br>  Q: Why R, not d3.js? <br>  A: Because I had a little experience on R before that, and because programming d3 seemed subjective to me to be too low-level. </p><br><p>  Q: Why does R save svg instead of pdf and png right away? <br>  A: R it certainly can, but when I tried it, pdf he tried to print smartly with fonts.  Apparently, he did not find the Cyrillic alphabet and the graphics were obtained without inscriptions.  So, yes, another superfluous program, but it is guaranteed to work and I trust the quality of the Inkscape transformation more. </p><br><p>  From my large repository for drawing 8 types of graphs, I made a small drawing of one type and published it on a githaba (see links). </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  The project Measurelook solved the tasks set for it - the organization of data storage for computational experiments and a simple preview tool.  It also served as the basis for solving the third task - a fully automated rebuilding of graphs. </p><br><h2 id="ssylki">  Links </h2><br><ol><li>  <a href="https://ntsdk.github.io/measurelook/index.html">Viewer online</a> </li><li>  <a href="https://github.com/NtsDK/measurelook">Repository with Assemblies Viewer</a> </li><li>  <a href="https://github.com/NtsDK/measurelook-c-printer">Repository with Measurelook C printer + sample usage</a> </li><li>  <a href="https://github.com/NtsDK/measurelook-plot-demo">Repository with an example of drawing final graphs using Measurelook, R and Inkscape</a> </li><li>  <a href="https://github.com/NtsDK/smtk-nims">Source code viewer Measurelook</a> (the project is not the main, see contributing.md) </li></ol></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/344174/">https://habr.com/ru/post/344174/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../344160/index.html">List of useful ideas for high-load services</a></li>
<li><a href="../344164/index.html">Layers, Bulbs, Hexogons, Ports and Adapters - it's all about one thing</a></li>
<li><a href="../344166/index.html">TeamCity 2017.2: 100 free build configurations, Docker, .NET CLI, composite builds and improvements in Kotlin DSL</a></li>
<li><a href="../344170/index.html">How we taught smart socket to measure power</a></li>
<li><a href="../344172/index.html">Malfunctions of the site. How to effectively organize the support of web resources by third-party services</a></li>
<li><a href="../344178/index.html">Postmortem Shadow Tactics: Blades of the Shogun</a></li>
<li><a href="../344180/index.html">Trading supervised: an example of a business monitoring system</a></li>
<li><a href="../344182/index.html">Examination of internal FPGA defects: we are looking for a black cat in a dark room</a></li>
<li><a href="../344184/index.html">Development patterns: MVC vs MVP vs MVVM vs MVI</a></li>
<li><a href="../344186/index.html">How many English words do you need to learn to communicate and read articles? (spoiler: 3000)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>