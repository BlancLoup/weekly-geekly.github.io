<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Office 365. Web application development. Authorization ADAL JS, New Microsoft Graph API</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article we will give an introduction to the development of web applications for Office 365: 
 - registration of the application in corporate A...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Office 365. Web application development. Authorization ADAL JS, New Microsoft Graph API</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/b72/eb8/368/b72eb8368bab7f46644ce795fa86f2db.png" hspace="15" vspace="15" align="left" height="450" alt="office-365-app-launcher">  In this article we will give an introduction to the development of web applications for Office 365: <br>  - registration of the application in corporate Azure <br>  - user authorization <br>  - retrieving data from Office 365 services <br><br>  The main goal: to learn how to make Office 365 applications that can be sold in the <a href="https://appsource.microsoft.com/en-us/marketplace/">Microsoft AppSource Marketplace</a> . <br><br>  For example, let's make a minimalist Single Page web application in JavaScript, displaying a list of letters.  Without Angular, TypeScript, without collectors, without command lines and without server code. <br><a name="habracut"></a><br>  If you want to immediately get a working code - an example on <a href="https://github.com/AlexeyBoiko/Azure-Examples/blob/master/Office-365-single-page-web-app-with-ADAL-js.html">GitHub</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <br><br>  The result is this: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/675/a0c/d65/675a0cd65081356141681c0785c3c694.png" alt="Office-365-web-app"></div><br><br><h2>  We will need </h2><br>  - Office 365 subscription <br>  - local web server, for example, IIS Express in Visual Studio <br><br><h2>  Terminology, which Office 365 applications are </h2><br>  There is a lot of information on Office 365 applications, it's hard to start right away.  Therefore, we give a few keywords and terms for googling. <br><br>  <b>Office 365 app launcher</b> - shown in the image below.  Clicking on "Get more apps" we get to the <a href="https://appsource.microsoft.com/en-us/marketplace/">store</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/687/f4a/4a3/687f4a4a3df1f5451bf9a8df17c45fbb.png" alt="office-365-app-launcher-get-more-apps"></div><br>  We want to make an application that can be published in this store. <br><br>  Among Office 365 applications, you can highlight: <br>  - Office 365 Add-in <br>  - Office 365 web app, also known as the Azure AD web app <br><br>  <b>The Office 365 Add-in</b> is an add-on integrated into the UI of the Office 365 services. For example, it can be an additional panel with information when viewing a letter, a SharePoint web part, a button in Excel.  Note that add-ons can work not only in web versions (for example, Outlook Web Access), but also in desktop applications (Outlook). <br><br>  <b>Office 365 web app</b> is <br>  - stand-alone web application <br>  - opens on your domain <br>  - with your hosting <br>  - communicates with Office 365 services (such as Outlook, SharePoint) using web APIs (such as <a href="https://developer.microsoft.com/en-us/graph">Microsoft Graph API</a> , but not only - see below) <br><br>  Those.  This is a separate site, with Office 365 it is connected by the fact that it receives / changes data of Office 365 users. In order for this site to access the Office 365 API, it must be registered with Office 365 (Azure AD).  A link to the application can be placed in the app launcher. <br><br>  Registration administrator can do manually or installing the application from the store.  When registering, the rights of the application on the parts of the API are indicated (for example, access to mail).  Office 365 web apps are displayed in this section of the store: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0e9/591/911/0e95919116be3cfb1b5c940c22638e83.png" alt="Office-365-store"></div><br><br>  In this article we will make the Office 365 web app, we will register manually. <br><br>  <b>Multi-Tenant, single-organization (Single-Tenant) web-apps</b> - Multi-Tenant is an application that can work with several organizations.  Single organization - applications developed for one company.  For the store, of course, only Multi-Tenant is suitable. <br><br><h2>  Register web app in Azure </h2><br>  In order for our Office 365 web app (our site) to use the Office 365 API, it must be registered.  The manual registration process is shown below. <br><br>  Go to the <a href="https://portal.azure.com/">admin panel Azure</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9e0/474/fd6/9e0474fd65db6dfc67482f1837a138f7.png" alt="Office-365-azure-app-registration"></div><br><br>  In the Sign-on URL field, enter the URL of the site; in our case, the test application is hosted on localhost: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e1a/aa1/768/e1aaa1768bfe156be8b75d366f1053ec.png" alt="Office-365-azure-app-registration"></div><br>  In the application manifest, you need to set the parameter ‚Äúoauth2AllowImplicitFlow‚Äù: true. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a8c/006/3e7/a8c0063e715f028d87c699b509c077a1.png" alt="Office-365-azure-app-registration"></div><br>  After registration, the application will receive an Application ID, we will need it later.  Do not forget to give rights to Microsoft Graph. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/577/90d/18d/57790d18d896fc12f972e381e7cee382.png" alt="Office-365-azure-app-registration"></div><br><h2>  Authorization, Microsoft Graph API </h2><br>  Office 365 offers many different web APIs.  Microsoft Graph API is a modern API that allows you to work with all Office 365 services. Wherever you can use Microsoft Graph, only resort to more specialized APIs if necessary. <br><br>  Microsoft Graph API is a separate topic, we just note that it is convenient and allows you to make simple REST requests. <br><br>  Each API request must contain a secret token, thanks to which the Microsoft Graph API understands which user the request came from and what actions are allowed to be performed. <br><br>  Token issues an ‚ÄúAzure AD Authorization Endpoint‚Äù.  Token has a limited lifespan. <br><br>  In our case, a single page web application, without server code, the token is obtained as follows: <br><br>  1. The user opens the site (we have http: // localhost: 54495 /) <br>  2. JavaScript sends the user to the Microsoft authorization page (let's call this ‚ÄúAzure AD Authorization Endpoint‚Äù), and passes the application ID (see earlier Application ID) <br>  3. ‚ÄúAzure AD Authorization Endpoint‚Äù generates a token, redirects the user back to the site in the url after # indicates token. <br>  4. JavaScript site saves token (for example in local storage).  Now you can make requests to the Office 365 API passing token. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cf6/4a4/3f0/cf64a43f08bcc782898d3fc2eb666ef4.png" alt="Office-365-auth"></div><br>  The process is described in more detail in the article <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-authentication-scenarios">Authentication Scenarios for Azure AD</a> . <br><br>  Our application does not contain server code.  Pay attention to the scheme Browser only once calls the Web Application to get the HTML and JS code, the remaining requests the Browser makes to the Office 365 API. <br><br>  But you can make your ASP.NET MVC application, which, like the Office 365 API, will check this same token.  And not in the browser, but on the server to use the Office 365 API.  You don‚Äôt have to manually parse the HTTP headers - Microsoft took care of everything.  An example of such an application is ‚Äú <a href="https://github.com/Azure-Samples/active-directory-angularjs-singlepageapp">Integrating Azure AD into an AngularJS single page app</a> ‚Äù. <br><br><h2>  ADAL JS </h2><br>  Above, for understanding, we reviewed the process of obtaining and using token.  <a href="https://github.com/AzureAD/azure-activedirectory-library-for-js">Active Directory Authentication Library (ADAL) for JavaScript (ADAL JS)</a> does all this for us.  You just need to connect it to the page.  An example of using ADAL JS: <br><br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// create config and get AuthenticationContext window.config = { tenant: "igtit.onmicrosoft.com", clientId: "21XXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX", postLogoutRedirectUri: window.location.origin, endpoints: { graphApiUri: "https://graph.microsoft.com", }, cacheLocation: "localStorage" }; var authContext = new AuthenticationContext(config); var isCallback = authContext.isCallback(window.location.hash); authContext.handleWindowCallback(); if (isCallback &amp;&amp; !authContext.getLoginError()) { window.location = authContext._getItem(authContext.CONSTANTS.STORAGE.LOGIN_REQUEST); } // check if user need to login var user = authContext.getCachedUser(); var token = authContext.getCachedToken(config.clientId); if (!user || !token) { authContext.login(); } // use token authContext.acquireToken(config.endpoints.graphApiUri, function (error, token) { if (error || !token) { // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> for some error call authContext.login() console.log("ADAL error: " + error); return; } // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> USE token here, request graph Api });</span></span></code> </pre> <br>  In our example, the token will be stored in local storage. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c29/70c/dcb/c2970cdcb8206725f1b5a4d2449a77d9.png" alt="office-365-adal-js-local-storage"></div><br>  When requesting the Graph API, you need to pass token <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url = config.endpoints.graphApiUri + <span class="hljs-string"><span class="hljs-string">"/v1.0/me/messages"</span></span>; $.ajax({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"GET"</span></span>, <span class="hljs-attr"><span class="hljs-attr">url</span></span>: url, <span class="hljs-attr"><span class="hljs-attr">headers</span></span>: { <span class="hljs-string"><span class="hljs-string">"Authorization"</span></span>: <span class="hljs-string"><span class="hljs-string">"Bearer "</span></span> + token } }).done(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// messages var items = response.value; console.log(items); }).fail(function () { console.log("Error"); });</span></span></code> </pre> <br>  Full <a href="https://github.com/AlexeyBoiko/Azure-Examples/blob/master/Office-365-single-page-web-app-with-ADAL-js.html">GitHub</a> example. <br><br><h2>  Links </h2><br>  <a href="https://msdn.microsoft.com/en-us/office/office365/howto/connect-your-app-to-o365-app-launcher">Have your app appear in the Office 365 app launcher</a> <br>  <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-authentication-scenarios">Authentication Scenarios for Azure AD</a> <br>  <a href="https://stackoverflow.com/questions/36591868/adal-js-with-multi-tenant-azure-active-directory">ADAL.js with Multi-Tenant Azure Active Directory</a> <br>  <a href="https://github.com/AzureAD/azure-activedirectory-library-for-js">Active Directory Authentication Library (ADAL) for JavaScript</a> <br>  <a href="https://nickvandenheuvel.eu/tag/adal-js/">Authenticate an Office 365 user with ADAL JS</a> <br>  <a href="https://developer.microsoft.com/en-us/graph">Microsoft Graph API</a> </div><p>Source: <a href="https://habr.com/ru/post/346552/">https://habr.com/ru/post/346552/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346542/index.html">The decentralized data warehouse Ethereum Swarm</a></li>
<li><a href="../346544/index.html">Detection of known malicious code in TLS-encrypted traffic (without decryption)</a></li>
<li><a href="../346546/index.html">‚ÄúNon-existent‚Äù cryptomachine of ‚Äúnon-existent‚Äù agency: NSA (No Such Agency) and KL-7</a></li>
<li><a href="../346548/index.html">First look at react-native</a></li>
<li><a href="../346550/index.html">Track for extracting word meanings from texts and resolving lexical polysemy</a></li>
<li><a href="../346554/index.html">Public "Schastmatrinstva" and its small statistical study</a></li>
<li><a href="../346556/index.html">Richard Hamming: Chapter 28. Systems Engineering</a></li>
<li><a href="../346558/index.html">Why am I still not engaged in open source</a></li>
<li><a href="../346560/index.html">Richard Hamming: Chapter 26. Experts</a></li>
<li><a href="../346562/index.html">Richard Hamming: Chapter 23. Mathematics</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>