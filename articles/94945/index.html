<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Draw a map in a WPF application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, a production need has arisen ‚Äî map a map of Russia on a form, with details down to the regions. At the same time you need: 


- depending on...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Draw a map in a WPF application</h1><div class="post__text post__text-html js-mediator-article">  Recently, a production need has arisen ‚Äî map a map of Russia on a form, with details down to the regions.  At the same time you need: <br><ul><li>  depending on various conditions, change the appearance of map areas; </li><li>  the card must ‚Äúperceive‚Äù user input and respond to it; </li><li>  you need to have a good quality ‚Äúpicture card‚Äù regardless of the monitor resolution. </li></ul><br><a name="habracut"></a><br><br>  The quality requirement is easily achieved when using vector graphics.  And then I got the idea to use WPF - and what, draw a picture in Expression Blend, thereby obtaining a set of WPF controls.  The rest - add "interactive" - ‚Äã‚Äãa matter of technology. <br>  So, the very first thing to do was get the image itself.  Our country is big, which is, of course, wonderful, but there were no desire to draw so many elements ourselves.  This was not required - <a href="">an excellent sample of the</a> map of Russia was found in Wikimedia Commons: <br><img src="https://habrastorage.org/storage/habraeffect/db/4e/db4eb08e65b8167eae4d1b528801e98b.png" alt="Wikimedia map"><br>  This is just what you need!  One moment is the SVG file.  It was necessary to somehow convert it to XAML.  As a result of the search, I came across a set of <a href="http://xamltune.codeplex.com/">XamlTune</a> , which has a console utility with the speaker name svg2xaml.  She did an excellent job with her task, and soon I received a canvas with a lot of nested Path elements, which depicts our country.  The resulting XAML looks like this: <br><blockquote><code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Canvas</font> <font color="#ff0000">x:Key</font> <font color="#0000ff">="svg2"</font> <font color="#ff0000">Width</font> <font color="#0000ff">="1091.9919"</font> <font color="#ff0000">Height</font> <font color="#0000ff">="630.11902"</font> <font color="#ff0000">ClipToBounds</font> <font color="#0000ff">="True"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">Canvas</font> <font color="#ff0000">Name</font> <font color="#0000ff">="State_Outline"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">Path</font> <font color="#ff0000">Stroke</font> <font color="#0000ff">="#FF000000"</font> <font color="#ff0000">StrokeMiterLimit</font> <font color="#0000ff">="4"</font> <font color="#ff0000">Name</font> <font color="#0000ff">="polygon81"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">Path.Data</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">PathGeometry</font> <font color="#ff0000">FillRule</font> <font color="#0000ff">="Nonzero"</font> <font color="#ff0000">Figures</font> <font color="#0000ff">="M715.671,134.212L715.368,133.002 717.637,134.061 718.771,132.926 720.359,131.338 722.704,128.994 724.141,130.733 724.897,130.733 726.787,128.843 728.527,126.801 731.854,125.289 734.274,127.104 732.913,130.885 732.913,133.002 731.325,134.59 728.829,135.725 726.107,136.784 723.385,136.784 721.343,138.826 718.091,137.691 716.427,135.271 715.671,134.212z"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">Path.Data</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">Path</font> <font color="#0000ff">&gt;</font> <br> <font>&lt;!-- ... --&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">Canvas</font> <font color="#0000ff">&gt;</font> <br> <font>&lt;!-- ... --&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">Canvas</font> <font color="#0000ff">&gt;</font> <br></font></code> </blockquote><br>  Obviously, several copies of the canvas are used to draw the borders of the state and subjects. <br>  Things are going well - it remains to display the map.  It would seem that everything is very simple - we put the canvas on the form and enjoy.  That's the way it is, only you can notice its very solid dimensions: Width = "1091.99" Height = "630.119".  How to scale it?  If you replace the canvas with a Grid, for example, when you resize a form, all parts of the map ‚Äúdisperse‚Äù.  To avoid this, use the Viewbox control.  Post it on the form as follows: <br><blockquote> <code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Viewbox</font> <font color="#ff0000">Child</font> <font color="#0000ff">="{StaticResource svg2}"</font> <font color="#ff0000">Stretch</font> <font color="#0000ff">="Uniform"</font> <font color="#0000ff">/&gt;</font></font> <br></code> </blockquote><br>  It is worth noting here that I put the outline with the map on the resources with the key ‚Äúsvg2‚Äù.  The canvas will be compressed while maintaining the proportions to the current size of the ViewBox container.  In this case, the absolute coordinates within the canvas will remain valid, and the layout of the map will not "go."  Now you can style the mouse click handler, like this: <br><blockquote> <code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Style</font> <font color="#ff0000">TargetType</font> <font color="#0000ff">="{x:Type Path}"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">EventSetter</font> <font color="#ff0000">Event</font> <font color="#0000ff">="MouseDown"</font> <font color="#ff0000">Handler</font> <font color="#0000ff">="mouseDownHandler"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">Style</font> <font color="#0000ff">&gt;</font></font></code> </blockquote> <br>  So  a click handler will be defined for all Path elements.  Well, etc. - in the style, you can define triggers, set properties, thereby providing the necessary appearance and behavior: further actions depend on your tasks and imagination.  For example, you can select the boundaries of the region when you hover the mouse, or highlight the background when an event occurs, etc. <br>  I needed an interactive map, i.e.  so that you can work with its individual parts, including  accepting user input.  If this is not required, you can use the canvas with the map as a VisualBrush.  You can do this, for example, like this: <br><blockquote> <code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Window</font> <font color="#ff0000">x:Class</font> <font color="#0000ff">="WpfApplication46.Window1"</font> <font color="#ff0000">xmlns</font> <font color="#0000ff">="http://schemas.microsoft.com/winfx/2006/xaml/presentation"</font> <font color="#ff0000">xmlns:x</font> <font color="#0000ff">="http://schemas.microsoft.com/winfx/2006/xaml"</font> <font color="#ff0000">Title</font> <font color="#0000ff">="Window1"</font> <font color="#ff0000">Height</font> <font color="#0000ff">="300"</font> <font color="#ff0000">Width</font> <font color="#0000ff">="300"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">Window.Resources</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">Canvas</font> <font color="#ff0000">x:Key</font> <font color="#0000ff">="svg2"</font> <font color="#ff0000">Width</font> <font color="#0000ff">="1091.99"</font> <font color="#ff0000">Height</font> <font color="#0000ff">="630.119"</font> <font color="#0000ff">&gt;</font> <br> <font>&lt;!-- ...  ... --&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">Canvas</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">Window.Resources</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">Grid</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">Border</font> <font color="#ff0000">Margin</font> <font color="#0000ff">="20"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">Border.Background</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">VisualBrush</font> <font color="#ff0000">Stretch</font> <font color="#0000ff">="Uniform"</font> <font color="#ff0000">Visual</font> <font color="#0000ff">="{StaticResource svg2}"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">Border.Background</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">Border</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">Grid</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">Window</font> <font color="#0000ff">&gt;</font></font></code> </blockquote> <br>  To preserve the original aspect ratio of the canvas with the map, the Uniform value was set for the Stretch property of the brush.  Of course, if we use VisualBrush, we will get a performance gain - less CPU resources and RAM will be required.  In confirmation of this - the data from the profiler from the Visual Studio 2010 suite (the blue line of the graph is the CPU load): <br>  1) <b>Option with VisualBrush</b> (allocation of a managed-memory ~ 11,36Mb): <br><img src="https://habrastorage.org/storage/habraeffect/ce/4a/ce4af1c25dcbb1bed45c064ce8fbdcb2.png" alt="image"><br>  2) <b>Option with ViewBox</b> (allocation of a managed-memory ~ 14,83Mb): <br><img src="https://habrastorage.org/storage/habraeffect/0a/27/0a272ed3f001fb0165dfaab8295318eb.png" alt="image"><br>  Therefore, if user input processing is not needed, the VisualBrush approach is preferable. <br><br>  So, it‚Äôs quite simple and quick to solve the problem of working with a geographic map.  It is in these situations that you begin to understand the full power of WPF technology.  Not the most trivial task - getting an interactive and ‚Äúrubber‚Äù (i.e. resistant to resizing) map - has come down to using the utility and ‚Äúscrewing‚Äù the styles.  Very significant, in my opinion. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="http://docs.google.com/leaf%3Fid%3D0BzyAXcDN19h4OTAzZTFlYjMtOTRmMy00ZGQyLTllYzUtMjVkYzIwM2YzMDIx%26hl%3Den">Sample source code</a> </div><p>Source: <a href="https://habr.com/ru/post/94945/">https://habr.com/ru/post/94945/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../94934/index.html">HDD mod EEE PC 701</a></li>
<li><a href="../94936/index.html">Algodoo - a physics simulation game in the form of a ‚Äú2D sandbox‚Äù</a></li>
<li><a href="../94937/index.html">Mark Zuckerberg: I ‚Äã‚Äãhelped a pretty penny to open source rival Facebook</a></li>
<li><a href="../94938/index.html">The first results of the School Project in Nizhny Novgorod</a></li>
<li><a href="../94942/index.html">How Macsolutions repaired my laptop</a></li>
<li><a href="../94946/index.html">Opera Mini on iPhone gained 2.6 million users in 2 weeks</a></li>
<li><a href="../94947/index.html">Resonance in the service of humanity</a></li>
<li><a href="../94948/index.html">About old technologies in new software</a></li>
<li><a href="../94951/index.html">Samsung have developed a USB monitor for PC</a></li>
<li><a href="../94952/index.html">Enable IPv6 on dd-wrt</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>