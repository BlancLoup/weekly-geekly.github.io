<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Physics Snake. From scratch. Part one</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="An article with the tag "teaching material." From scratch, so we will write our own not difficult (for a start) physics engine and immediately not a d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Physics Snake. From scratch. Part one</h1><div class="post__text post__text-html js-mediator-article">  An article with the tag "teaching material."  From scratch, so we will write our own not difficult (for a start) physics engine and immediately not a difficult game (I chose a snake) on it.  But the article will most likely not be about this, as this is not such a difficult task, but how it will all be in JavaScript, and with the most beautiful (correct) code (I expect all that can be done even better you describe in comments).  "And in response, ripe tomatoes flew ..."  Let's start. <br>  (who read right up to here, hold the cookies, control the left-right arrows): <br>  - <a href="http://lyashenko-inc.in.ua/projects/snake/">that's what will happen: in part one</a> <br>  - <a href="http://lyashenko-inc.in.ua/projects/snake_dev_mode/">and this is the same (dev-mode)</a> <br><a name="habracut"></a><br>  Let's start with index.html <br><div class="spoiler">  <b class="spoiler_title">look at the code</b> <div class="spoiler_text"><pre><code class="javascript hljs">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"/&gt; &lt;link rel="stylesheet" href="css/main.css" type="text/css" /&gt; &lt;/head&gt; &lt;body&gt; &lt;div id="container"&gt; &lt;div id="bg"&gt;&lt;/div&gt; &lt;canvas id="canvas" width="900" height="600"&gt;&lt;/canvas&gt; &lt;/div&gt; &lt;script src="js/LAB.min.js" type="text/javascript"&gt;&lt;/script&gt; &lt;script type="text/javascript"&gt; $LAB .script("js/engine/CustomEvent.js").wait() .script("js/engine/Body.js").wait() .script("js/engine/World.js") .script("js/Bonus.js") .script("js/EnemyCloud.js") .script("js/Hero.js") .script("js/mainApp.js"); &lt;/script&gt; &lt;/body&gt; &lt;/html&gt;</code> </pre> <br></div></div><br>  <b>We connect scripts before the closing body tag.</b> <br><blockquote>  Why not in the head?  As soon as the browser sees the script tag, it blocks the further construction of the page until the moment when the script is loaded.  That is, before you will be just a white screen (and do not need here about the Gigabit Internet). </blockquote><br>  We have a lot of files.  Ideally, everything needs to be obfuscated and put into one file.  Or group the maximum in a couple of files.  We will use the LAB.js library to load the remaining files with scripts. <br>  <b>Download files in parallel.</b> <br><blockquote>  We use LAB.js (or else you can, for example, LazyLoad.js, etc.).  It allows us to load script files in parallel (as you remember, it has already been mentioned above that construction stops at each insert script tag, that is, all scripts are loaded in turn in a row) plus we can control the load (for example, the wait function).  We, for example, cannot use, say, a jQuery plugin, when jQuery itself has not loaded yet, of course, we put a pause on jQuery, and as soon as it loads, everything will go further. </blockquote><br>  Go to the mainApp.js file. <br><div class="spoiler">  <b class="spoiler_title">look at the code</b> <div class="spoiler_text"><pre> <code class="javascript hljs">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> game = { <span class="hljs-attr"><span class="hljs-attr">images</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'images/en_blue.png'</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'images/en_white.png'</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'images/en_red.png'</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">loadCount</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">load</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> self = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, max = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.images.length; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = max; i--;) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.images[i].img = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Image(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.images[i].img.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ self.loadCount++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (self.loadCount == max) { self.loadComplete(); } } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.images[i].img.src = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.images[i].url; } }, <span class="hljs-attr"><span class="hljs-attr">loadComplete</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.initControll().initGame().startLoop(); }, <span class="hljs-attr"><span class="hljs-attr">canvas</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'canvas'</span></span>), <span class="hljs-attr"><span class="hljs-attr">config</span></span>: { <span class="hljs-attr"><span class="hljs-attr">fps</span></span>: <span class="hljs-number"><span class="hljs-number">1000</span></span>/<span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-attr"><span class="hljs-attr">stageW</span></span>: <span class="hljs-number"><span class="hljs-number">900</span></span>, <span class="hljs-attr"><span class="hljs-attr">stageH</span></span>: <span class="hljs-number"><span class="hljs-number">600</span></span> }, <span class="hljs-attr"><span class="hljs-attr">bodies</span></span>: [], <span class="hljs-attr"><span class="hljs-attr">enemies</span></span>: [], <span class="hljs-attr"><span class="hljs-attr">bonuses</span></span>: [], <span class="hljs-attr"><span class="hljs-attr">initControll</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handlers = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.controllHandlers(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.documentElement.addEventListener) { <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.addEventListener(<span class="hljs-string"><span class="hljs-string">'keydown'</span></span>, handlers.keyDown); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.addEventListener(<span class="hljs-string"><span class="hljs-string">'keyup'</span></span>, handlers.keyUp); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.attachEvent(<span class="hljs-string"><span class="hljs-string">'keydown'</span></span>, handlers.keyDown); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.attachEvent(<span class="hljs-string"><span class="hljs-string">'keyup'</span></span>, handlers.keyUp); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; }, <span class="hljs-attr"><span class="hljs-attr">controllHandlers</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> self = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">keyDown</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ self.keyDownControll(e.keyCode); }, <span class="hljs-attr"><span class="hljs-attr">keyUp</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ self.keyUpControll(e.keyCode); } } }, <span class="hljs-attr"><span class="hljs-attr">initGame</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//-- world this.world = new World(this.canvas, this.config.stageW, this.config.stageH); //-- bonuses this.initBonuses(); //-- enemies this.initEnemies(); //-- Hero this.hero = new Hero(); this.world.addChild(this.hero.body); this.hero.initTales(this.world); return this; }, initBonuses: function() { var self = this, all = 20, good = 10, offset = 20; for (var i = 0; i &lt; all; i++) { if (i &lt; good) { this.bonuses.push(new Bonus({ x: offset + Math.random()*(self.config.stageW - 2*offset) , y: Math.random()*self.config.stageH, bonuseType: true, radius: Math.random()*1+2 })); } else { this.bonuses.push(new Bonus({ x: offset + Math.random()*(self.config.stageW - 2*offset) , y: Math.random()*self.config.stageH, bonuseType: false, radius: Math.random()*1+2 })); } this.world.addChild(this.bonuses[i].body); } }, initEnemies: function() { var enemiesData = [ { x: 10, y: 470, speed: 3 }, { x: 10, y: 300, speed: 2 }, { x: 10, y: 130, speed: 1 } ]; for (var i=0, max = enemiesData.length; i &lt; max; i++) { this.enemies.push(new EnemyCloud({ x: enemiesData[i].x, y: enemiesData[i].y })); this.enemies[i].body.speed.default_x = enemiesData[i].speed; this.world.addChild(this.enemies[i].body); //--bonuses this.enemies[i].bonuses = this.bonuses; this.enemies[i].world = this.world; } }, keyDownControll: function(_keyCode) { switch (_keyCode) { case 37: this.hero.controll.left = true; break; case 39: this.hero.controll.right = true; break; default: break; } }, keyUpControll: function(_keyCode) { switch (_keyCode) { case 37: this.hero.controll.left = false; break; case 39: this.hero.controll.right = false; break; default: break; } }, startLoop: function() { var self = this; this.enterFrame = setInterval(function() { self.loop(); }, this.config.fps); }, loop: function() { var hero = this.hero, enemies = this.enemies, bonuses = this.bonuses; this.world.update(); //-- controll hero if (hero.controll.left) { hero.speed.angle -= hero.speed.rotation; } if (hero.controll.right) { hero.speed.angle += hero.speed.rotation; } hero.body.speed.x = hero.speed.x*Math.cos(Math.PI*hero.speed.angle/180); hero.body.speed.y = hero.speed.y*Math.sin(Math.PI*hero.speed.angle/180); for (var i = 0, maxI = enemies.length; i&lt;maxI; i++) { enemies[i].body.position.x += enemies[i].body.speed.default_x; if (enemies[i].body.position.x &gt; this.config.stageW - enemies[i].body.config.width) { enemies[i].body.speed.default_x = -enemies[i].body.speed.default_x; } if (enemies[i].body.position.x &lt; 0) { enemies[i].body.speed.default_x = -enemies[i].body.speed.default_x; } } for (var j = 0, maxJ = bonuses.length; j&lt;maxJ; j++) { if (bonuses[j].body.userData.bonuseType) { bonuses[j].body.position.y += bonuses[j].speed.y; if (bonuses[j].body.position.y &gt; this.config.stageH - 5) { bonuses[j].body.position.y = 5; } } } hero.enterFrame(); } }; game.load(); })();</span></span></code> </pre><br></div></div><br>  The points: <br>  <b>Wrap everything in an anonymous function</b> and call it. <br><blockquote>  The scope in JavaScript is determined by the function.  The variable defined in the function will not be visible outside of it (the global namespace will not be littered).  Plus, if you don‚Äôt yet define a variable, use it immediately, for example: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myFunc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ a = <span class="hljs-number"><span class="hljs-number">123</span></span>; }</code> </pre><br>  it becomes global (a property of a global object), this is the same thing that you would write <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myFunc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.a = <span class="hljs-number"><span class="hljs-number">123</span></span>; }</code> </pre><br>  that, as you know, at some point will lead to a conflict of names. <br></blockquote><br>  The game itself is represented by the game object, that is, here we can say we have the namespace "game".  How does it all start?  That's right, with preloading images.  Therefore, the only thing we have is called <br><pre> <code class="javascript hljs"> game.load();</code> </pre><br>  We look at it, the first thing we see: <br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> self = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, max = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.images.length; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = max; i--;) {</code> </pre><br>  So: save the link to our object (game). <br>  <b>Where does this lead us?</b> <br><blockquote>  This is determined at the time of the function call.  Recall the same call, aplly, which explicitly defines the context of the call.  The context, that is, the object pointed to by this.  In our case, we see the <code>onload</code> function; if we turn to this, it will refer to the HTMLImageElement (the images that loaded). <br></blockquote><br>  We look further, we get the length of the array, and we wrote a loop for the form: <code>for (var i = max; i--;) {</code> <br>  <b>Cycle speed</b> <br><blockquote>  Slowest cycle <pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span></code> </pre>  (I think it‚Äôs clear why), plus he iterates over the properties in a random order, which can often lead to logical errors, so we use it only in cases where it is not necessary to obtain all (and not known) properties of the object.  Next is the view loop. <br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.images.length; i++;) {</code> </pre><br>  here, for some reason, each iteration we recalculate the length of the array (although most people don‚Äôt bother it for some reason, and they write like this all the time, although (in my experience, when sorting an already finished array) only in a very small part of cases, this length could change iteration time). <br>  Next (logical) is <br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>, max = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.images.length; i&lt;max; i++;) {</code> </pre><br>  we get the length only once. <br>  Well, in the end (as it turned out, iterating through the array from the end faster than from the beginning), ok, we do: <br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.images.length; i&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>; i--;) {</code> </pre><br>  and more beautiful: <br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.images.length; i--;) {</code> </pre><br></blockquote><br>  We look further, we installed the onload handler, after which we start uploading a picture <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.images[i].img.src = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.images[i].url;</code> </pre><br>  <b>First, the event listener, then the event itself.</b> <br><blockquote>  If you change the order of the given strings (everything seems to be fine, the picture will not have time to load until the interpreter reaches the next row) everything will work.  Almost everywhere.  Yes, you guessed it, IE8 already tells you everything he thinks about you.  Therefore, follow this. <br></blockquote><br>  After the download is complete, the control will be initialized, some kind of game data, the start of the cycle <br><pre> <code class="javascript hljs"> loadComplete: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.initControll().initGame().startLoop(); }</code> </pre><br>  nice and <a href="http://en.wikipedia.org/wiki/Method_chaining">simple</a> . <br><br>  Before moving to these functions, we see the following code: <br><pre> <code class="javascript hljs"> canvas: <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'canvas'</span></span>), <span class="hljs-attr"><span class="hljs-attr">config</span></span>: { <span class="hljs-attr"><span class="hljs-attr">fps</span></span>: <span class="hljs-number"><span class="hljs-number">1000</span></span>/<span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-attr"><span class="hljs-attr">stageW</span></span>: <span class="hljs-number"><span class="hljs-number">900</span></span>, <span class="hljs-attr"><span class="hljs-attr">stageH</span></span>: <span class="hljs-number"><span class="hljs-number">600</span></span> }</code> </pre><br>  <b>We make links to html elements that will be used frequently.</b> <br><blockquote>  DOM operations are the slowest.  What happens if I go to the DOM in every frame and look for the canvas I need?  And if also (which we all love) with jQuery, $ ('# canvas') - and this is in a loop, the creation of jQuery objects is also added.  In general, we all understand that this is evil. <br></blockquote><br>  We put all the settings in the config field (everything is clear here). <br><br>  We look at the initialization of the control from the keyboard <br><div class="spoiler">  <b class="spoiler_title">look at the code</b> <div class="spoiler_text"><pre> <code class="javascript hljs"> initControll: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handlers = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.controllHandlers(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.documentElement.addEventListener) { <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.addEventListener(<span class="hljs-string"><span class="hljs-string">'keydown'</span></span>, handlers.keyDown); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.addEventListener(<span class="hljs-string"><span class="hljs-string">'keyup'</span></span>, handlers.keyUp); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.attachEvent(<span class="hljs-string"><span class="hljs-string">'keydown'</span></span>, handlers.keyDown); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.attachEvent(<span class="hljs-string"><span class="hljs-string">'keyup'</span></span>, handlers.keyUp); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; }, <span class="hljs-attr"><span class="hljs-attr">controllHandlers</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> self = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">keyDown</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ self.keyDownControll(e.keyCode); }, <span class="hljs-attr"><span class="hljs-attr">keyUp</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ self.keyUpControll(e.keyCode); } } }, <span class="hljs-attr"><span class="hljs-attr">keyDownControll</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_keyCode</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (_keyCode) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">37</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.hero.controll.left = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">39</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.hero.controll.right = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }, <span class="hljs-attr"><span class="hljs-attr">keyUpControll</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_keyCode</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (_keyCode) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">37</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.hero.controll.left = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">39</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.hero.controll.right = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }</code> </pre><br></div></div><br>  Something is written, a lot of excess, no?  Why not just do something in the index.html file <br><pre> <code class="javascript hljs">&lt;body onkeydown=<span class="hljs-string"><span class="hljs-string">"eventHandler"</span></span>&gt;</code> </pre><br>  and so on. <br>  <b>We write unobtrusive JavaScript</b> <br><blockquote>  We can talk about this a lot, <a href="http://ru.wikipedia.org/wiki/%25D0%259D%25D0%25B5%25D0%25BD%25D0%25B0%25D0%25B2%25D1%258F%25D0%25B7%25D1%2587%25D0%25B8%25D0%25B2%25D1%258B%25D0%25B9_JavaScript">let's start with Viky.</a> In a nutshell, the point is that everything should be divided. </blockquote><br>  We look, we checked the first on IE, and, I could write <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (navigator.userAgent.indexOf(<span class="hljs-string"><span class="hljs-string">' MSIE'</span></span>) ! == <span class="hljs-number"><span class="hljs-number">-1</span></span>) {</code> </pre><br>  but it is anti-pattern (if we are already talking about the correct code), if for example <br>  <b>need <code>addEventListener</code> method</b> , <br><blockquote>  then only view verification <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.documentElement.addEventListener) {</code> </pre><br>  we can definitely say something. </blockquote>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And all the functions in here were needed in order to "get rid" of the event. <br>  <b>"Unbound" from the events.</b> <br><blockquote>  Look at the line: <br><pre> <code class="javascript hljs">self.keyDownControll(e.keyCode);</code> </pre><br>  Here I don‚Äôt transfer the reference to the event <code></code> , but <code>.keyCode</code> , that is, if suddenly I need to ‚Äúmanually‚Äù simulate actions on keyboard events, I‚Äôll just write, for example, game.keyDownControll (37); </blockquote><br><br><h6>  About physics: </h6><br>  It would not be bad to do that we would have a notion of a physical world with its own characteristics, and the created physical bodies were simply added to it by the addChild method, and then we don‚Äôt want to know what it does there.  Plus there would be some sort of dispatcher for collisions of bodies, and some sort of console with the output of the necessary information during debugging.  Well, look part of the function: <br><pre> <code class="javascript hljs">initGame: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.world = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> World(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.canvas, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.config.stageW, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.config.stageH); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.hero = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Hero(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.world.addChild(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.hero.body); },</code> </pre><br>  Okay, they created the world, they transferred the canvas, where everything will be drawn, the width, the height of the world.  We created an object of the Hero class, we add its physical component ‚Äúbody‚Äù to the world. <br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.world.addChild(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.hero.body);</code> </pre><br>  We look as we initialize body. <br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.body = Body.create(<span class="hljs-string"><span class="hljs-string">'Circle'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">x</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-attr"><span class="hljs-attr">radius</span></span>: <span class="hljs-number"><span class="hljs-number">18</span></span>, <span class="hljs-attr"><span class="hljs-attr">gravity</span></span>: <span class="hljs-number"><span class="hljs-number">0.1</span></span>, <span class="hljs-attr"><span class="hljs-attr">bgColor</span></span>: <span class="hljs-string"><span class="hljs-string">"#eeeeee"</span></span>, <span class="hljs-attr"><span class="hljs-attr">fade</span></span>: { <span class="hljs-attr"><span class="hljs-attr">x</span></span>: <span class="hljs-number"><span class="hljs-number">0.999</span></span>, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: <span class="hljs-number"><span class="hljs-number">0.999</span></span> } });</code> </pre><br>  Body is the main class of the engine, Body.create is the <a href="http://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25B0%25D0%25B1%25D1%2580%25D0%25B8%25D1%2587%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BC%25D0%25B5%25D1%2582%25D0%25BE%25D0%25B4_(%25D1%2588%25D0%25B0%25D0%25B1%25D0%25BB%25D0%25BE%25D0%25BD_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B5%25D0%25BA%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F)">factory method</a> , it allows us to create different (so far we don‚Äôt have many of them) bodies.  We created a circle.  And passed the object with the settings.  By variable names I think it is clear what is responsible for what. <br>  <b>Passed the object</b> <br><blockquote>  Always transfer the object (unless of course the number of parameters passed is planned to be more than 2), then you will not have to do very popular (among beginners) things, like: <br><pre> <code class="javascript hljs">myFunc(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-number"><span class="hljs-number">123</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">'string_lol'</span></span>);</code> </pre><br>  (so, I did not miss the order of the parameter anywhere?) And this is also all clear. <br></blockquote><br>  Well, we created some kind of body, added it to the world, we look at what's next.  Next you need (as in us a dynamic game) to create a timer, where everything will be updated according to the tick.  We look part of the code <br><pre> <code class="javascript hljs">startLoop: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> self = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.enterFrame = setInterval(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ self.loop(); }, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.config.fps); }, <span class="hljs-attr"><span class="hljs-attr">loop</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hero = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.hero, enemies = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.enemies, bonuses = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bonuses; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.world.update(); <span class="hljs-comment"><span class="hljs-comment">//...</span></span></code> </pre><br>  I have only <b>one permanent timer for the</b> whole game (this.enterFrame). <blockquote>  You can always cope with one timer, if it seems to you that there is not, and that you have unique objects of some class there, that each object should have its own timer - most likely you need to revise the architecture of your application.  They can be added and removed, but the monotonous actions that go on throughout the game cycle are done on a single timer. </blockquote><br>  As you can see, I call <code>this.world.update();</code>  each frame, it updates the whole world gives the results of the collisions and so on. <br>  It is clear that the entire performance will take this function, since each frame is called, so you need to make it as ‚Äúright‚Äù as possible (as far as possible), as you can see, I immediately <br><pre> <code class="javascript hljs"> hero = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.hero, enemies = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.enemies, bonuses = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bonuses;</code> </pre><br>  I reassign global variables to local ones. <br>  <b>Variables and interpreter.</b> <br><blockquote>  When the interpreter encounters a variable, it looks at how it is initialized, starting from the deepest level (that is, where the code is currently running, for example, a function) and to the top, that is, if for example we are accessing a global variable, we will have to go through all levels until you can find her.  If you need to access global variables from some deep nesting more than once, you need to reassign them to local ones. <br></blockquote><br>  We also wanted to define as a collision event, with what exactly to know who faced whom. <br>  We look at the class Hero, a function to initiate events <br><pre> <code class="javascript hljs">Hero.prototype.initEvents = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> self = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.body.addHitListener(<span class="hljs-string"><span class="hljs-string">'bodies'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">)</span></span>{ self.hitAction(e.data); }); <span class="hljs-comment"><span class="hljs-comment">/*this.body.addHitListener('limits', function(e) { });*/</span></span> }</code> </pre><br>  That is, on this.body (as we remember this is a physical object, in fact it is the head of our snake), we hung up the event handler.  They can be of two types: on a physical body and on going beyond the world.  The <code>e.data</code> stores a reference to the object that <code>this.body</code> .  Cool.  All as we wanted. <br>  Making your event is not so difficult (and if <a href="http://api.jquery.com/trigger/">jQuery is used</a> , it will be even easier).  But we will write it ourselves.  I rendered it into a separate class <code>CustomEvent</code> .  It can be used in any other place where you need it. <br><div class="spoiler">  <b class="spoiler_title">look at the code</b> <div class="spoiler_text"><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CustomEvent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_eventName, _target, _handler</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.eventName = _eventName; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_target &amp;&amp; _handler) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.eventListener(_target, _handler); } } CustomEvent.prototype.eventListener = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_target, _handler</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> _target == <span class="hljs-string"><span class="hljs-string">'string'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(_target); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target = _target; } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.handler = _handler; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target.addEventListener) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target.addEventListener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.eventName, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.handler, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target.attachEvent) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target.attachEvent(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.eventName, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.handler); } } CustomEvent.prototype.eventRemove = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target.removeEventListener) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target.removeEventListener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.eventName, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.handler, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target.detachEvent) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target.detachEvent(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.eventName, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.handler); } } CustomEvent.prototype.eventDispatch = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createEvent) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> e = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createEvent(<span class="hljs-string"><span class="hljs-string">'Events'</span></span>); e.initEvent(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.eventName, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createEventObject) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> e = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createEventObject(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } e.data = _data; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target.dispatchEvent) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target.dispatchEvent(e); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target.fireEvent) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target.fireEvent(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.eventName, e); } }</code> </pre><br></div></div><br>  Everything should also be clear here.  We go further.  Everyone probably wonders how she (the snake) wraps her tail so beautifully?  There is no secret here, we simply move each next element of the snake's ‚Äútail‚Äù to the position of the previous one, that is, in the cycle <br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.tales[j].moveTo(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.tales[j - <span class="hljs-number"><span class="hljs-number">1</span></span>].position.x, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.tales[j - <span class="hljs-number"><span class="hljs-number">1</span></span>].position.y, <span class="hljs-number"><span class="hljs-number">5</span></span>);</code> </pre><br>  this.tales [j] is a physical body, that is, in the engine there is also some other method <code>moveTo(_x, _y, _speed)</code> .  Which as we see it just moves from the current point to the point with the given coordinates.  How to do?  Just get the coordinates between the two points by coordinates, divide by the number of transitions (_speed) and we will get this step in one transition.  Everything. <br><br>  We also want a dev-mod.  And there is nothing difficult.  Since this is set for the whole engine, it is logical that this will be a static property of the Body (I remind you, Body is the main class of the engine).  We are looking at the Hero class constructor (since the debug information will be for it, then we initialize it here) <br><pre> <code class="javascript hljs"> Body.devMode.usePhysLimits = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; Body.devMode.display = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; Body.devMode.bodyId = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.body.id; Body.devMode.use = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; Body.useGravity = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> </pre><br><ul><li>  The first is whether to use the borders of the world, as we can see the bodies are beating themselves from them. </li><li>  The second is whether to display the frames of the physical body (we can impose a pattern on the body, or simply fill it with color), and these are the frames of the geometric body itself. </li><li>  The third is for which body the debugging is: yes, for the snake head, that is, <code>this.body</code> , and assigned by <code>id</code> (yes, each body has its own identifier). </li><li>  The fourth is whether to display the console itself. </li><li>  And the fifth is not entirely from dev mode, says whether to use gravity (which engine without gravity), but with us, as you can see, the game ‚Äútop view‚Äù is therefore <code>false</code> . </li></ul><br><br><h5>  Here you go. </h5><br>  (who read right up to here, hold the cookies, control the left-right arrows): <br>  - <a href="http://lyashenko-inc.in.ua/projects/snake/">that's what will happen: in part one</a> <br>  - <a href="http://lyashenko-inc.in.ua/projects/snake_dev_mode/">and this is the same (dev-mode)</a> <br>  and the <a href="">link to the files</a> maybe someone will be interested to look more carefully. <br><br>  <i>PS Well, in the second part we will try to do something more like a game from this.</i> </div><p>Source: <a href="https://habr.com/ru/post/167007/">https://habr.com/ru/post/167007/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../166991/index.html">Yandex has released a social-search iOS-application for the USA</a></li>
<li><a href="../166999/index.html">ONDA V972 - a new generation of Chinese tablets</a></li>
<li><a href="../167001/index.html">The story of a single application or the struggle for performance</a></li>
<li><a href="../167003/index.html">In the Russian Google new director</a></li>
<li><a href="../167005/index.html">Paul Graham: How to find an idea for a startup (part four)</a></li>
<li><a href="../167011/index.html">Why I like working as a programmer in Louisville (or why I won't move to work in your startup)</a></li>
<li><a href="../167013/index.html">Security notes. Password recovery</a></li>
<li><a href="../167015/index.html">Mash the brain with regular expressions - Regex Tuesday Challenge</a></li>
<li><a href="../167019/index.html">Valve released Half-Life under Linux</a></li>
<li><a href="../167021/index.html">Google Apps for Business is easier and more accessible.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>