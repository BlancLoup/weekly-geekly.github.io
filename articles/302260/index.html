<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÄúAttack to the fuel depot‚Äù or break the SCADA system on PHDays VI</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="PHDays organizers traditionally showed their organization skills, as always something new, interesting and of course a large number of stands under th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>‚ÄúAttack to the fuel depot‚Äù or break the SCADA system on PHDays VI</h1><div class="post__text post__text-html js-mediator-article">  PHDays organizers traditionally showed their organization skills, as always something new, interesting and of course a large number of stands under the control of SCADA systems.  A rare opportunity to try their hand at breaking into the life support system of a large city, deploy an anti-missile system and fire a shot, arrange a train accident, flood the city, take control of the dam and much more. <br><br>  All participants, and we are not an exception, are attracted by the opportunity to gain experience with SCADA, which manages industrial facility models.  We found the booth of InfoTeKS company very interesting - ‚ÄúAttack on fuel storage‚Äù, which we managed to conquer.  Below is the hacking sequence, who cares. <br><br>  <b>Terms of the contest "Attack on the fuel warehouse"</b> <b><br></b>  Baseline: The attack consists of two phases. <br>  1. Stage: It is necessary to find a hint in the ‚ÄúDigital bar‚Äù to start the first stage of the attack.  As a result of the first stage of the attack, it is required to master a certain ‚Äúsecret‚Äù to proceed to stage No. 2.  The first stage is considered to be successfully completed if the actions of the violator were not noticed by the firewall. <br>  2. Stage: Having received the ‚Äúsecret‚Äù, the attacker proceeds to the second stage of the attack.  The task is to submit an unauthorized team to fill the punch. <br>  Purpose: To carry out unauthorized discharge of fuel of 50 or 100 liters. <br>  Permitted: Use your own laptop, with any necessary software. <br>  Forbidden: Any physical impact on the layout of the fuel depot.  The intruder will be immediately suspended from participation in the competition. <br><a name="habracut"></a><br>  So, stage 1. <br>  Known: <br>  WiFi <br>  SSID: step_default <br>  PASS: 00000000 <br>  FTP <br>  login: user <br>  pass: Zb1HjJ9I 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/d0f/448/ce4/d0f448ce4ebe4681972a50ea64117c8b.jpg"><br><br>  Having connected to the network via DHCP we get IP 50.50.50.12.  and scan the available network. <br>  <b>sudo netdiscover -i wlan0</b> result gives us several IPs, each of which is scanned to open ports via nmap. <br>  nmap -Pn - from the entire list, the most interesting was IP: 50.50.50.3, with open ports 22 (SSH), 21 (FTP), 80 (HTTP) and 7777 (not known service).  I immediately remembered that we have a login and password for the FTP server.  After authorization on FTP, the file 7777.zip is detected.  Download and try to unpack, but it was not there, the archive is password-protected.  Enter all that we know from the conditions of the job and found along the way.  Nothing helped.  Decided to postpone the issue and move on.  Through the browser, open <a href="http://50.50.50.3/">50.50.50.3</a> and see the following: <br><br><img src="https://habrastorage.org/files/80e/7f4/fe5/80e7f4fe57b04c3192bbc455c57beabb.png"><br><br>  It would seem an ordinary picture, but the experience of passing HackQuest did not pass without a trace.  Download the picture and study the contents. <br><br><img src="https://habrastorage.org/files/26f/8be/a55/26f8bea55f1e4cc58460a1161d5620ac.png"><br><br>  Using cat, we find some value at the end of the file " <b>TnpjM056bzNPVFU0TWpRMk5nbz0K</b> ".  Upon reflection, they came to the conclusion that this is Base64 and executed the following command: <br><br>  <b>echo TnpjM056bzNPVFU0TWpRMk5nbz0K |</b>  <b>base64 -d</b> <br>  got the answer - <b>Nzc3Nzo3OTU4MjQ2Ngo =</b> <br><br>  doing this trick again, this time with the result <br>  <b>echo Nzc3Nzo3OTU4MjQ2Ngo = |</b>  <b>base64 -d</b> <br>  in response - <b>7777: 79582466</b> <br><br>  So, now we have new meanings, the question remains: "Where to put them!?".  Attempts to log in with this data via FTP and SSH, as well as using the password to the * .zip archive, did not produce a result.  We remembered that port 7777 was also open on the remote machine. We connect via telnet and get the message ‚ÄúTell me your ID‚Äù.  Since the first part of the response is an indication of the port (7777), it is assumed that the second requested ID. <br><br><img src="https://habrastorage.org/files/a8a/fb6/0d2/a8afb60d2023419691c197210a575d34.png"><br><br>  Everything is done right!  The result was another FLAG ( <b>Ffl42Nm5b4 # 445</b> ).  Without departing from the ticket office, we recall that we also have a file named 7777.zip.  Enter the received data as a password and voila, the archive is unpacked.  Inside the archive, the johny file, looking at the contents of which our sysadmin, without a shadow of a doubt, pronounced the sentence ‚ÄúThis is an SSH key‚Äù and did the following: <br><br><img src="https://habrastorage.org/files/6f8/d15/322/6f8d15322b514fbdb2fc4212ddcb101c.png"><br><br>  Using the SSH key and the file name as the account name (johny), we connected to the 50.50.50.3 server and received new data in response <br>  <b>IG10: YourPassPhrese987</b> <br><br>  IG10 turned out to be another Wi-Fi access point.  Having connected to IG10, we started all over again. <br><br>  <b>sudo netdiscover -i wlan0</b> <br>  this time attention was attracted by the fact that the network had two address spaces - 192.168.2.1/24 and 192.168.20.1/24 <br>  It is noteworthy that the gateway (192.168.1.1 &amp; 192.168.20.1) had the same MAC, which means that there is only one router on the network.  For access to both subnets prescribed route. <br><br>  <b>sudo route add-net 192.168.0.0 netmask 255.255.0.0 gw 192.168.20.1</b> <b><br></b> <br>  Next, they took up spoofing.  To supply fuel to a robot connected to the IG10 network's WiFi, a command was sent, which, in turn, was processed on the server and issued a command to dump the fuel.  Unfortunately, we didn‚Äôt save the * .pcap file with the data collected via spoofing, so we‚Äôll have to explain it on our fingers. <br>  We found that when pressing the fuel reset button with IP 192.168.20.7 (presumably a robot), via modbus protocol, towards IP 192.168.2.2 (presumably the control server), a packet is transmitted to port 502. Thus, we defined the roles of devices.  It remains only to reproduce the re-sending of the packet, we already had all the necessary information for this.  However, we didn‚Äôt work out the replay of the sending package by our own because of the complexity of sending the generated package.  Github came to the rescue by downloading the necessary lib and modifying it a little to fit my goals, I managed to reproduce the data sent by the robot - the command to dump the fuel. <br><br><img src="https://habrastorage.org/files/bdc/2b1/ef6/bdc2b1ef606942669474bb82cb160be7.png"></div><p>Source: <a href="https://habr.com/ru/post/302260/">https://habr.com/ru/post/302260/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../302250/index.html">Win-Win: DotNext speakers at the SPB .NET Community meeting and vice versa</a></li>
<li><a href="../302252/index.html">Big interview with Simon Dunlop - founder of Dream Industries: how to bring Russian IT products to the world market</a></li>
<li><a href="../302254/index.html">Docker in the service of the .NET development team</a></li>
<li><a href="../302256/index.html">Competition for the classification of words from Hola or "where to get another percent?"</a></li>
<li><a href="../302258/index.html">How to take screenshots faster: create your own free storage on Amazon S3</a></li>
<li><a href="../302262/index.html">Why geymindustry need marketing research</a></li>
<li><a href="../302264/index.html">Three approaches to building a data center from Louros Project, Keystone NAP and Iron Mountain</a></li>
<li><a href="../302266/index.html">Developer in the project management triangle</a></li>
<li><a href="../302268/index.html">Email - not a sparrow, fly out - you won't catch it or how we did email marketing with a machine</a></li>
<li><a href="../302270/index.html">ESET specialists released a tool to decrypt TeslaCrypt files</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>