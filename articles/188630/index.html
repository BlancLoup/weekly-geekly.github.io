<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>NodeJS is beautiful, modular, object or make it so with the help of redis and nohm</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, in the IT community, quite a lot of hype around server-side JavaScript, in particular, NodeJS, however, oddly enough, it turned out to be qu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>NodeJS is beautiful, modular, object or make it so with the help of redis and nohm</h1><div class="post__text post__text-html js-mediator-article">  Recently, in the IT community, quite a lot of hype around server-side JavaScript, in particular, NodeJS, however, oddly enough, it turned out to be quite difficult to find information on how to write modular, object code.  What I mean?  The fact is that I was familiar with js quite recently, before I wrote small Java applications, and in my spare time I write the server part of an online game in PHP and, as was to be expected, like many novice JS programmers, I was very unusual instead of object-oriented use of so-called prototype-oriented programming.  Moreover, JavaScript brings a lot of confusion even in this case with its Object.prototype and __proto__.  The first thing that occurred to me, like many other developers, was to make my own implementation of the ‚Äúusual OOP‚Äù.  A little thought, I decided that this is simply no need if we work with nodeJS.  For my, albeit short-lived practice, I was not able to meet a task that would require a real OO approach, I mean the real need for inheritance, polymorphism, and especially encapsulation (of course, all this is necessary, but to the extent that js provides). <br><a name="habracut"></a><br>  Having studied quite a lot of applications on nodeJS, I noticed that for some reason practically nowhere use the MVC pattern as it is now accepted in most PHP frameworks, although this model seems to me very convenient and the cost of creating it (as I thought in early enough serious) will bear fruit. <br><br>  Real project <br>  I was assigned the task of implementing the ‚Äúslot machines‚Äù application server on node.js, it would seem - quite simple.  I got quite a lot of code from a person who has done this before.  Redis is used as a database.  The structure of the application looked like this: <br>  -root <br>  --application.js <br>  --config.js <br>  --constants.js <br>  --import_data.js <br>  --slots_module.js <br>  --user_activity.js <br>  --social.js <br>  --node_modules / <br>  --- there are modules for node.js <br><br>  A pretty familiar structure for a node, isn't it?  : =) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But with the growth of requirements for the application, and the number of various functionalities, as one would expect it, it became very difficult to maintain this application.  Application and config grew by 5000 lines each, it became a lot of duplication of code and other amenities, it became almost impossible to determine where to be, without using the project search. <br><br>  And finally, we come to the main point.  Boiling hot.  I decided to do a major refactoring and reorganization of the application.  First of all, I remembered that there is such a thing as Object Relational Mapping (ORM) and to my surprise I found a pretty good ORM implementation for NodeJS and Redis.  This was a great impetus to the use of my usual architecture.  The nohm module allows you to quite simply describe the models, their properties and methods, which allows you to reduce the code, make it more structured and beautiful.  Here is a simple example of how to describe and use a user model (User.js) <br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** * User: hlogeon * Date: 31.07.13 * Time: 23:36 * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> continue creating this * read http://maritz.github.io/nohm/ */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> nohm = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'nohm'</span></span>).Nohm; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> redis = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'redis'</span></span>).createClient(); nohm.setClient(redis); nohm.model(<span class="hljs-string"><span class="hljs-string">'User'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">properties</span></span>: { <span class="hljs-attr"><span class="hljs-attr">balance</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"integer"</span></span>, <span class="hljs-attr"><span class="hljs-attr">defaultValue</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">index</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, <span class="hljs-attr"><span class="hljs-attr">ad_id</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-attr"><span class="hljs-attr">index</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">bonus_games_pending</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"boolean"</span></span>, <span class="hljs-attr"><span class="hljs-attr">index</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, <span class="hljs-attr"><span class="hljs-attr">chips</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"integer"</span></span>, <span class="hljs-attr"><span class="hljs-attr">defaultValue</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-attr"><span class="hljs-attr">source</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">spins_count</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"integer"</span></span>, <span class="hljs-attr"><span class="hljs-attr">defaultValue</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-attr"><span class="hljs-attr">mute</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"boolean"</span></span>, <span class="hljs-attr"><span class="hljs-attr">defaultValue</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, <span class="hljs-attr"><span class="hljs-attr">sound</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"boolean"</span></span>, <span class="hljs-attr"><span class="hljs-attr">defaultValue</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, <span class="hljs-attr"><span class="hljs-attr">charges_base</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"boolean"</span></span>, <span class="hljs-attr"><span class="hljs-attr">defaultValue</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, <span class="hljs-attr"><span class="hljs-attr">parent_ref</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-attr"><span class="hljs-attr">index</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">sid</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-attr"><span class="hljs-attr">index</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">bonus_to</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"integer"</span></span>, <span class="hljs-attr"><span class="hljs-attr">defaultValue</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-attr"><span class="hljs-attr">points_count</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"integer"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">parent_id</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-attr"><span class="hljs-attr">index</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">invitation_accepted</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">ref_type</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-attr"><span class="hljs-attr">index</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">spins_temporary</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"integer"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">enter_date</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"integer"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">free_spins</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"integer"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">screen</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">last_game</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">startOffer</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"boolean"</span></span>, <span class="hljs-attr"><span class="hljs-attr">index</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">last_activity</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"integer"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">win_turn</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"integer"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">double_game_pending</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"integer"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">level</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"integer"</span></span>, <span class="hljs-attr"><span class="hljs-attr">index</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">last_spin</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"integer"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">uid</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-attr"><span class="hljs-attr">index</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">status</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">bonus_games_temporary</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"integer"</span></span>, <span class="hljs-attr"><span class="hljs-attr">defaultValue</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-attr"><span class="hljs-attr">browser</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">builded</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: string, } }, <span class="hljs-attr"><span class="hljs-attr">methods</span></span>: { <span class="hljs-attr"><span class="hljs-attr">getContryFlag</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'http://example.com/flag_'</span></span>+<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.p(<span class="hljs-string"><span class="hljs-string">'country'</span></span>)+<span class="hljs-string"><span class="hljs-string">'.png'</span></span>; }, <span class="hljs-attr"><span class="hljs-attr">updateBalance</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> balance = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.p(<span class="hljs-string"><span class="hljs-string">'balance'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.p(<span class="hljs-string"><span class="hljs-string">'balance'</span></span>, balance+value); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.save(); }, <span class="hljs-attr"><span class="hljs-attr">updateChips</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> chips = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.p(<span class="hljs-string"><span class="hljs-string">"chips"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.p(<span class="hljs-string"><span class="hljs-string">"chips"</span></span>, chips+value); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.save(); }, <span class="hljs-attr"><span class="hljs-attr">incrSpins</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> spins = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.p(<span class="hljs-string"><span class="hljs-string">'spins_count'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.p(<span class="hljs-string"><span class="hljs-string">'spins_count'</span></span>, spins+<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.save(); }, <span class="hljs-attr"><span class="hljs-attr">swichMute</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mute = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.p(<span class="hljs-string"><span class="hljs-string">'mute'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.p(<span class="hljs-string"><span class="hljs-string">'mute'</span></span>, !mute); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.save(); }, <span class="hljs-attr"><span class="hljs-attr">swichSound</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sound = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.p(<span class="hljs-string"><span class="hljs-string">'sound'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.p(<span class="hljs-string"><span class="hljs-string">'sound'</span></span>, !sound); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.save(); }, <span class="hljs-attr"><span class="hljs-attr">setPointsCount</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.p(<span class="hljs-string"><span class="hljs-string">'points_count'</span></span>, value); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.save(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value; }, <span class="hljs-attr"><span class="hljs-attr">incrPointsCount</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> count = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.p(<span class="hljs-string"><span class="hljs-string">'points_count'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.p(<span class="hljs-string"><span class="hljs-string">'points_count'</span></span>, count+<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.save(); }, <span class="hljs-attr"><span class="hljs-attr">incrSpinsTmp</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tmp = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.p(<span class="hljs-string"><span class="hljs-string">'spins_temporary'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.p(<span class="hljs-string"><span class="hljs-string">'spins_temporary'</span></span>, tmp+<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.save(); }, <span class="hljs-attr"><span class="hljs-attr">incrFreeSpins</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> spins = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.p(<span class="hljs-string"><span class="hljs-string">'free_spins'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.p(<span class="hljs-string"><span class="hljs-string">'free_spins'</span></span>, spins+<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.save(); }, <span class="hljs-attr"><span class="hljs-attr">incrLevel</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> level = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.p(<span class="hljs-string"><span class="hljs-string">'level'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.p(<span class="hljs-string"><span class="hljs-string">'level'</span></span>, level+<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.save(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.p(<span class="hljs-string"><span class="hljs-string">'level'</span></span>); } } }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> user = nohm.factory(<span class="hljs-string"><span class="hljs-string">'User'</span></span>); exports.user = user;</code> </pre> <br><br>  Usage example: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> user = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./UserTest'</span></span>).user; app.get(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//       var activeUser = nohm.factory('User'); activeUser.save(function(errs){ if(errs){ //  ,     res.json(errs); } else{ //  ,         res.json(activeUser.allProperties()); } }); //  -? app.get('/findUser', function (req, res) { var id = req.body.id; // user.load(id, function(err, aUser){ if(err){ //  ,  ! res.json(err); } else{ //  ,   - ,     ! console.log(aUser.getCountryFlag()); res.json(aUser.allProperties); } }) });</span></span></code> </pre><br><br>  You must admit that this is much simpler than the permanent redis.hgetall (), especially since now we can define user methods in the model and even in Relations. <br><br>  Thanks to this approach, I broke the application into modules and the new structure looks like this: <br>  -root <br>  --application.js <br>  --constants.js <br>  --config.js <br>  --models / <br>  --- User.js <br>  --- Slotmachine.js <br>  --- Event.js <br>  --helpers / <br>  --- Social.js <br>  --node_modules / <br><br>  Although the files have become a bit larger, the code support has become much simpler, the number of lines has decreased significantly, and the readability has increased is incredible!  Now I don‚Äôt have to unravel noodles from callback functions of level 10 nesting.  Everything is transparent, simple and clear. <br><br>  I hope someone will benefit from this little article from a beginner in nodejs.  I will be very grateful for the criticism! </div><p>Source: <a href="https://habr.com/ru/post/188630/">https://habr.com/ru/post/188630/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../188614/index.html">Landing Page: Experiment Results</a></li>
<li><a href="../188616/index.html">Dell Latitude E6420 ATG - frame laptop for those who understand</a></li>
<li><a href="../188620/index.html">Swiss scientists have developed an artificial eye</a></li>
<li><a href="../188622/index.html">How to speed build 1000 VisualStudio C ++ projects</a></li>
<li><a href="../188626/index.html">Internet pirates turn young children into corrupt</a></li>
<li><a href="../188632/index.html">New features of Hyper-V 2012 R2</a></li>
<li><a href="../188638/index.html">Solving the problem of clustering using gradient descent</a></li>
<li><a href="../188640/index.html">The 7th international IT HR-conference ‚ÄúAnswer the answer!‚Äù</a></li>
<li><a href="../188644/index.html">GoIP SMS Server for Asterisk (Part 1)</a></li>
<li><a href="../188648/index.html">Edward Snowden received temporary asylum in Russia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>