<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Block system encryption of Windows Linux installed systems. Encrypted multiboot. Defense and attack on GRUB2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cowboy strategy: 
 [A] block system encryption of Windows 7 installed system; 
 [B] GNU / Linux (Debian) block system encryption of the installed syst...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Block system encryption of Windows Linux installed systems. Encrypted multiboot. Defense and attack on GRUB2</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/y7/04/pd/y704pdw4xfrpf8nipub8isyyzra.jpeg"><br><br><h3>  Cowboy strategy: </h3><br>  [A] block system encryption of Windows 7 installed system; <br>  [B] GNU / Linux <i>(Debian)</i> block system encryption of the installed system <i>(including / boot)</i> ; <br>  [C] GRUB2 setting, bootloader protection with digital signature, authentication protection; <br>  [D] sweep - destroy unencrypted data; <br>  [E] Universal backup of encrypted OS; <br>  [F] attack &lt;on item [C]&gt; on the GRUB2 bootloader; <br>  [G] useful documentation. <br><br>  <b>‚îÄ‚îÄ‚îÄSchema # rooms 40 # &lt;BIOS / MBR / 1HDD without lvm&gt;:</b> <br>  ‚ïº‚îÄ‚îÄ‚ïº encryption is not hidden; <br>  ‚ïº‚îÄ‚îÄ‚ïº Windows 7 installed - full system encryption; <br>  ‚ïº‚îÄ‚îÄ‚ïº GNU / Linux installed <i>(Debian and derived distributions)</i> - full system encryption <i>(/, including / boot; swap)</i> ; <br>  ‚ïº‚îÄ‚îÄ‚ïº Independent loaders: VeraCrypt is installed in the MBR, GRUB2 is installed in the extended partition; <br>  ‚ïº‚îÄ‚îÄ‚ïº OS installation / reinstallation is not required; <br>  ‚îÄ‚îÄ‚ïº used cryptographic software: VeraCrypt, Cryptsetup, GnuPG, Seahorse, GRUB2 - free / free. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The above scheme partially solves the problem of ‚Äúremote boot to a flash drive‚Äù, allows you to enjoy encrypted Windows / Linux and exchange data via an ‚Äúencrypted channel‚Äù from one OS to another. <br><br>  <b>PC boot order:</b> <br><br><ul><li>  turning on the machine; </li><li>  boot loader VeraCrypt <i>(correct password will continue loading Windows 7)</i> ; </li><li>  pressing the ‚ÄúEsc‚Äù key will load the GRUB2 bootloader; </li><li>  GRUB2 boot loader <i>(choice of distribution / GNU / Linux / CLI)</i> , requires authentication of the GRUB2-superuser &lt;login / password&gt;; </li><li>  after successful authentication and distribution selection, you will need to enter a password phrase to unlock "/boot/initrd.img"; </li><li>  after entering error-free passwords in GRUB2, you will need to enter a password <i>(third password, BIOS password or GNU / Linux user account password</i> to unlock <i>)</i> and unlock the GNU / Linux OS, or automatically substitute the secret key <i>(two passwords + key)</i> ; </li><li>  external invasion of the GRUB2 configuration will freeze the GNU / Linux boot process. </li></ul><br>  When partitioning a hard disk <i>(MBR table), a</i> PC can have no more than 4 main partitions, or 3 main and one extended partitions, as well as an unlabeled area.  An extended partition, unlike the main one, can contain subsections <i>(logical drives = extended partition)</i> .  In other words, the ‚Äúextended partition‚Äù on the HDD replaces LVM for the current task: full system encryption.  If your disk is mapped to 4 main partitions, you need to use lvm, either transform <i>(with formatting) the</i> section from main to extended, or competently use all four sections and leave everything as it is, getting the desired result.  Even if you have one partition on the disk, Gparted will help to split the HDD <i>(into additional sections)</i> without losing data, but still with a small price to pay for such actions. <br><br>  The layout of the hard disk, for which the verbalization of the entire article will go, is presented in the table below. <br><br><img src="https://habrastorage.org/webt/jd/3k/wf/jd3kwfqr9mas6ldlmil_5qwwbg8.png"><br>  <i>Table (‚Ññ 1) sections 1Tb.</i> <br><br>  Something similar should be with you. <br>  Sda1 - the main section number 1 NTFS <i>(encrypted)</i> ; <br>  sda2 - extended marker section; <br>  sda6 - logical drive <i>(GRUB2 boot loader is installed on it);</i> <br>  sda8 - swap (encrypted paging file); <br>  sda9 - test logical drive; <br>  sda5 - logical disk for the curious; <br>  sda7 - GNU / Linux OS (transferred OS to an encrypted logical drive); <br>  sda3 - the main section number 2 with Windows 7 <i>(encrypted)</i> ; <br>  sda4 - the main section number 3 <i>(it was located unencrypted GNU / Linux, used for backup)</i> . <br><br><h3>  [A] Block system encryption Windows 7 </h3><br><div class="spoiler">  <b class="spoiler_title">A1.</b>  <b class="spoiler_title">Veracrypt</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/-q/in/7s/-qin7s3t7xacdjov7invu_8kb2y.png"><br><br>  Downloading from the <a href="https://www.veracrypt.fr/en/Downloads.html">official site</a> , or from the <a href="https://sourceforge.net/projects/veracrypt/">sourceforge</a> mirror, the installation version of the VeraCrypt cryptographic software <i>(at the time of publishing the article v1.23, the portable version of VeraCrypt is not suitable for system encryption)</i> .  Check the checksum of the loaded software. <br><br> <code>$ Certutil -hashfile "C:\VeraCrypt Setup 1.23.exe" SHA256</code> <br> <br>  and compare the result with the <a href="https://launchpadlibrarian.net/388150962/veracrypt-1.23-sha256sum.txt">laid out</a> COP on the VeraCrypt developer site. <br><br>  If the HashTab software is installed, it is even simpler: PCM <i>(VeraCrypt Setup 1.23.exe)</i> -properties hash of the sum of files. <br><br>  To verify the program signature, <a href="https://www.gnupg.org/download/index.html">gnuPG</a> software must be installed in the system;  <a href="https://www.gpg4win.org/get-gpg4win.html">gpg4win</a> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">A2.</b>  <b class="spoiler_title">Installing / launching VeraCrypt software with administrator rights</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/py/ih/fo/pyihfozxju5pulv79n_3mllt9km.jpeg"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">A3.</b>  <b class="spoiler_title">Selection of parameters for system encryption of the active partition</b> <div class="spoiler_text">  VeraCrypt - System - Encrypt system partition / disk - Normal - Encrypt Windows system partition - Multiboot - <i>(warning: "For inexperienced users not recommended to use this method" and this is true, agree "Yes")</i> - Boot disk <i>("yes", even if not so, all the same "yes")</i> - The number of system disks "2 or more" - Multiple systems on one disk "Yes" - Not Windows bootloader "No" <i>(in fact "Yes", but VeraCrypt / GRUB2 loaders will not divide the MBR between more specifically, only the smallest part of the bootloader code is stored in the MBR / boot path,</i>  <i>naya part is located within the file system)</i> - Multiboot - Configure encryption options ... <br><br>  If you deviate from the above steps ( <i>block system encryption scheme)</i> , then VeraCrypt will roll out a warning and will not allow you to encrypt the partition. <br><br>  In the next step, to targeted data protection, conduct a ‚ÄúTest‚Äù and choose an encryption algorithm.  If you have an out of date CPU, then the Twofish encryption algorithm is likely to be the fastest.  If the CPU is powerful, note the difference: AES - encryption on the test results will be several times faster than its crypto competitors.  AES is a popular encryption algorithm, the hardware of modern CPUs is specially optimized for the ‚Äúsecret‚Äù <s>and for ‚Äúhacking</s> ‚Äù. <br><br>  VeraCrypt supports the ability to encrypt disks in a cascade of AES <i>(Twofish)</i> / and other combinations.  On a 2-core Intel 2.20GHz CPU a decade ago <i>(without hardware support for AES, A / T cascade encryption),</i> performance degradation is almost imperceptible.  <i>(AMD CPU of the same era / ~ parameters ‚Äî performance is slightly reduced)</i> .  The OS works in dynamics and the consumption of resources for transparent encryption is imperceptible.  Unlike, for example, a noticeable decrease in performance due to the installed test unstable desktop environment Mate v1.20.1 <i>(or v1.20.2 I do not remember exactly)</i> in GNU / Linux, or because of the work of the telemetry subroutine in Windows7.  Usually sophisticated users perform hardware performance tests before encryption.  For example, in Aida64 / Sysbench / systemd-analyze and compared with the results of the same tests after the system is encrypted, thereby refuting the myth for itself, "system encryption is harmful."  The slowdown of the machine and the inconvenience are noticeable when backing up / restoring encrypted data, because the ‚Äúsystem backup data‚Äù operation itself is not measured in ms, and those &lt;decrypt / encrypt on the fly&gt; are added.  In the end, each user chooses an encryption algorithm regarding the satisfaction of the tasks set and the degree of his paranoia. <br><br>  It is better to leave the PIM parameter by default so that when booting the OS each time you do not enter exact iteration values.  VeraCrypt uses a huge number of iterations to create a truly ‚Äúslow hash‚Äù.  An attack on such a ‚Äúcryptulite‚Äù by the Brute force method / rainbow tables makes sense only with a <s>short</s> ‚Äúsimple‚Äù passphrase and a personal charset-list of the victim.  Paying for password strength is a delay in correctly entering a password when booting the OS <i>(mounting VeraCrypt volumes in GNU / Linux is much faster).</i> <br>  Free software for implementing brute force attacks <i>(extracting a passphrase from the header of a VeraCrypt / LUKS drive)</i> Hashcat and John the Ripper, the latter does not know how to work with Twofish for example. <br><br>  Due to the cryptographic strength of the encryption algorithms, unstoppable crypto-punkers are developing software with a different attack vector.  For example, extracting metadata / keys from RAM <i>(cold boot attack / DMA),</i> there is specialized free and non-free software for this purpose. <br><br>  Upon completion of setting / generating ‚Äúunique metadata‚Äù of the encrypted active partition, VeraCrypt will offer to restart the PC and test the performance of its bootloader.  After reboot a / start Windows, VeraCrypt will load in standby mode, it remains only to confirm the encryption process - Y. <br><br>  At the final step of system encryption, VeraCrypt will offer to create a backup copy of the header of the active encrypted partition in the form of ‚Äúveracrypt rescue disk.iso‚Äù - it is necessary to make - <u>in this software such an operation is a requirement</u> <i>(in LUKS, the requirement is unfortunately omitted but underlined in the documentation)</i> .  Rescue disk is useful to all, and to someone, and not once.  The loss <i>(header / MBR rewrite) of the header</i> backup will permanently deny access to the decrypted partition from the Windows OS. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">A4.</b>  <b class="spoiler_title">Creating a rescue disk VeraCrypt</b> <div class="spoiler_text">  By default, VeraCrypt offers to burn ‚Äúmetadata ~ 2-3MB‚Äù on a CD, but not all people have disks or DWD-ROM drives, and creating a bootable ‚ÄúVeraCrypt Rescue disk‚Äù flash drive for someone will be a technical surprise: Rufus / GUIdd-ROSA ImageWriter and other similar software will not be able to cope with the task, because in addition to copying the displaced metadata to the bootable flash drive, you need to copy / paste from the image outside the file system of the USB drive, in short, correctly copy the MBR / road to trinket.  Under the GNU / Linux OS, you can create a bootable flash drive using the dd utility, looking at this table. <br><br><img src="https://habrastorage.org/webt/_z/zl/f-/_zzlf-zhvflotagy215jpqv9dkw.jpeg"><br><br>  Creating a rescue disk in the Windows environment - otherwise.  The developer VeraCrypt did not include the solution to this problem in the official <a href="https://www.veracrypt.fr/en/VeraCrypt%2520Rescue%2520Disk.html">documentation</a> on the "rescue disk", but suggested a solution in another way: he put additional software to create the "usb rescue disk" in free access on his forum VeraCrypt.  The archivist of this software for Windows is ‚Äú <a href="http://vk.cc/8BOfoV">creating a usb veracrypt rescue disk</a> ‚Äù.  After saving the rescue disk.iso, the block system encryption process of the active partition will begin.  During encryption, the OS does not stop, no restart of the PC is required.  Upon completion of the encryption operation, the active partition becomes fully encrypted, you can use it.  If the VeraCrypt loader does not appear when the PC starts up, and the header recovery operation does not help, then check the ‚Äúboot‚Äù flag, it should be installed on the partition where Windows is present <i>(regardless of encryption and other OS, see table 1).</i> <br>  <i><b>This completes the description of block system encryption with Windows OS.</b></i> <br></div></div><br><h3>  [B] LUKS.  Encryption GNU / Linux <i>(~ Debian)</i> installed OS.  Algorithm and Steps </h3><br>  In order to encrypt the installed Debian / derived distribution, you need to map the prepared partition to the virtual block device, transfer it to the mapped GNU / Linux disk, and install / configure GRUB2.  If you do not have a bare server, and you value your time, then you need to use the GUI, and most of the terminal commands described below are meant to be driven in ‚ÄúChuck-Norris mode‚Äù. <br><br>  <b>B1.</b>  <b>Booting a PC from GNU / Linux live usb "</b> <br><br>  "To hold a cryptotest on the performance of iron" <br><br><pre> <code class="bash hljs">lscpu &amp;&amp; ryptsetup benchmark</code> </pre> <br><img src="https://habrastorage.org/webt/xm/t5/ko/xmt5koolr78zxwr0rwicahnlr78.jpeg"><br><br>  If you are a happy owner of a powerful AES-enabled car, then the numbers will look like the right side of the terminal, if you are happy, but with antique iron, the left side. <br><br>  <b>B2.</b>  <b>Partitioning disk.</b>  <b>mount / format fs logical disk HDD in Ext4 (Gparted)</b> <br><br><div class="spoiler">  <b class="spoiler_title">B2.1.</b>  <b class="spoiler_title">Creating an encrypted sda7 section header</b> <div class="spoiler_text">  Describe the names of the sections, hereinafter, I will agree with respect to its partition table, laid out above.  According to your disk layout, you must substitute your partition names. <br><br>  Comparison of disk drive encryption <i>(/ dev / sda7&gt; / dev / mapper / sda7_crypt).</i> <br>  # Simple creation of "LUKS-AES-XTS partition" <br><br><pre> <code class="bash hljs">cryptsetup -v -y luksFormat /dev/sda7</code> </pre> <br>  Options: <br><br>  * luksFormat - initialize the LUKS header; <br>  * -y - password phrase (not key / file); <br>  * -v-verbalization (output information in the terminal); <br>  * / dev / sda7 - your logical disk from the extended partition <i>(where GNU / Linux transfer / encryption is planned)</i> . <br><br>  The default encryption algorithm is &lt;L <i>UKS1: aes-xts-plain64, Key: 256 bits, LUKS header hashing: sha256, RNG: / dev / urandom</i> &gt; <i>(depends on the version of cryptsetup).</i> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># default-  cryptsetup --help #     .</span></span></code> </pre> <br>  In the absence of AES hardware support on the CPU, the best choice would be to create an extended ‚ÄúLUKS-Twofish-XTS partition‚Äù. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">B2.2.</b>  <b class="spoiler_title">Advanced creation of the ‚ÄúLUKS-Twofish-XTS-partition‚Äù</b> <div class="spoiler_text"><pre> <code class="bash hljs">cryptsetup luksFormat /dev/sda7 -v -y -c twofish-xts-plain64 -s 512 -h sha512 -i 1500 --use-urandom</code> </pre> <br>  Options: <br>  * luksFormat - initialize the LUKS header; <br>  * / dev / sda7 your future encrypted logical drive; <br>  * -v verbalization; <br>  * -y password phrase; <br>  * -c select data encryption algorithm; <br>  * -s encryption key size; <br>  * -h hash / crypto function, used by the RNG <i>(--use-urandom)</i> to generate a unique encryption / decryption key for the logical disk header, the secondary header key (XTS);  a unique master key stored in an encrypted disk header, a secondary XTS key, all this metadata and an encryption routine that encrypts / decrypts any data on the partition <i>(except for the section header)</i> using the master key and the secondary XTS key disk. <br>  * -i iterations in milliseconds, instead of ‚Äúquantity‚Äù <i>(the time delay in processing a passphrase affects the OS load and the cryptographic strength of the keys).</i>  To maintain a balance of cryptographic strength with a simple password of the ‚Äúrussian‚Äù type, it is required to increase the value - (i), with a complex password of the type ‚Äú? 8d∆±ob / √∏fh‚Äù the value can be reduced. <br>  * --use-urandom random number generator, generate keys and salt. <br><br>  After mapping the sda7&gt; sda7_crypt partition <i>(the operation is fast, since an encrypted header with ~ 3 MB of metadata is created and that's it)</i> , you need to format and mount the sda7_crypt file system. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">B2.3.</b>  <b class="spoiler_title">Matching</b> <div class="spoiler_text"><pre> <code class="bash hljs">cryptsetup open /dev/sda7 sda7_crypt <span class="hljs-comment"><span class="hljs-comment">#       .</span></span></code> </pre><br>  options: <br>  * open -make the section "with the name"; <br>  * / dev / sda7 is a logical disk; <br>  * sda7_crypt ‚Äî mapping a name that is used to mount an encrypted partition or initialize it when the OS boots. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">B2.4.</b>  <b class="spoiler_title">Formatting the sda7_crypt file system in ext4.</b>  <b class="spoiler_title">Mounting the drive in the OS</b> <div class="spoiler_text">  <i>(Note: working with an encrypted partition will not work in Gparted)</i> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#    mkfs.ext4 -v -L DebSHIFR /dev/mapper/sda7_crypt</span></span></code> </pre><br>  options: <br>  * -v-verbalization; <br>  * -L-disk label (which is displayed in the Explorer among other disks). <br><br>  Next, you should mount the virtual-encrypted block device / dev / sda7_crypt into the system <br><br><pre> <code class="bash hljs">mount /dev/mapper/sda7_crypt /mnt</code> </pre> <br>  Working with files in the / mnt folder will automatically encrypt / decrypt data in sda7. <br><br>  It is more convenient to map and mount a partition in the explorer <i>(nautilus / caja GUI)</i> , the partition will already be in the disk selection list, you only need to enter a passphrase for opening / decrypting the disk.  The matching name will be selected automatically and not ‚Äúsda7_crypt‚Äù, but something like / dev / mapper / Luks-xx-xx ... <br></div></div><br><div class="spoiler">  <b class="spoiler_title">B2.5.</b>  <b class="spoiler_title">Backup disc header (metadata ~ 3MB)</b> <div class="spoiler_text">  One of the most <b>important</b> operations that needs to be done without delay is a backup copy of the ‚Äúsda7_crypt‚Äù header.  If you overwrite / damage the header <i>(for example, by installing GRUB2 in sda7 partition, etc.)</i> , the encrypted data will be lost completely without any possibility to restore them, because it will not be possible to regenerate the same keys, the unique keys will be created. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   cryptsetup luksHeaderBackup --header-backup-file ~/_DebSHIFR /dev/sda7</span></span></code> </pre><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   cryptsetup luksHeaderRestore --header-backup-file &lt;file&gt; &lt;device&gt;</span></span></code> </pre> <br>  options: <br>  * luksHeaderBackup --header-backup-file-backup command; <br>  * luksHeaderRestore --header-backup-file - restore command; <br>  * ~ / Backup_DebSHIFR - backup file; <br>  * / dev / sda7-partition whose backup copy of the encrypted disk header needs to be saved. <br>  <i><b>In this step, &lt;create and edit an encrypted partition&gt; is completed.</b></i> <br></div></div><br>  <b>B3.</b>  <b>Transferring the GNU / Linux OS <i>(sda4)</i> to an encrypted partition <i>(sda7)</i></b> <br><br>  Create a folder / mnt2 <i>(Note - we are still working with live usb, sda7_crypt is mounted at / mnt)</i> , and we mount our GNU / Linux into / mnt2, which needs to be encrypted. <br><br><pre> <code class="bash hljs">mkdir /mnt2 mount /dev/sda4 /mnt2</code> </pre><br>  We carry out the correct transfer of the OS using the Rsync software <br><pre> <code class="bash hljs">rsync -avH --progress /mnt2/ /mnt</code> </pre> <br>  Rsync options are described in E1. <br><br>  Next, <b>you need</b> to defragment the partition of the logical disk <br><pre> <code class="bash hljs">e4defrag -c /mnt/ <span class="hljs-comment"><span class="hljs-comment"># , e4defrag ,    ~"0",  ,       ! e4defrag /mnt/ #   GNU/Linux</span></span></code> </pre> <br>  <i><b>Migrating and synchronizing [GNU / Linux&gt; GNU / Linux-encrypted] is completed in this step.</b></i> <br><br>  <b>AT 4.</b>  <b>Configuring GNU / Linux on an encrypted sda7 partition</b> <br><br>  After the successful transfer of the OS / dev / sda4&gt; / dev / sda7, you need to enter GNU / Linux on the encrypted partition, and perform further configuration <i>(without rebooting the PC) of the</i> encrypted system.  That is, to be in live usb, but to execute commands ‚Äúrelative to the root of the encrypted OS‚Äù.  Simulate a similar situation will be "chroot".  In order to promptly receive information from which OS you are currently working <i>(encrypted or not, since the data in sda4 and sda7 are synchronized)</i> , unsynchronize OSs.  Create in the root directories <i>(sda4 / sda7_crypt)</i> empty marker files, for example, / mnt / encryptedOS and / mnt2 / decryptedOS.  Quick check what OS you are in <i>(including the future):</i> <br><pre> <code class="bash hljs">ls /&lt;Tab-Tab&gt;</code> </pre> <br><br><div class="spoiler">  <b class="spoiler_title">B4.1.</b>  <b class="spoiler_title">"Simulation of the entrance to the encrypted OS"</b> <div class="spoiler_text"><pre> <code class="bash hljs">mount --<span class="hljs-built_in"><span class="hljs-built_in">bind</span></span> /dev /mnt/dev mount --<span class="hljs-built_in"><span class="hljs-built_in">bind</span></span> /proc /mnt/proc mount --<span class="hljs-built_in"><span class="hljs-built_in">bind</span></span> /sys /mnt/sys chroot /mnt</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">B4.2.</b>  <b class="spoiler_title">Verify that the operation is performed on an encrypted system.</b> <div class="spoiler_text"><pre> <code class="bash hljs">ls /mnt&lt;Tab-Tab&gt; <span class="hljs-comment"><span class="hljs-comment">#   "/"</span></span></code> </pre><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">history</span></span> <span class="hljs-comment"><span class="hljs-comment">#       su  .</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">B4.3.</b>  <b class="spoiler_title">Create / configure an encrypted swap (swap partition), edit crypttab / fstab</b> <div class="spoiler_text">  Since the paging file is formatted every time the OS starts, it does not make sense to create and match the swap with the logical disk now, and type the commands as in p. B2.2.  For Swap, each time it starts, its temporary encryption keys will be automatically generated.  Swap-a key life cycle: unmounting / disabling the swap partition <i>(+ clearing the RAM)</i> ;  or restart the OS.  Configuring swap, open the file responsible for the configuration of block encrypted devices <i>(similar to the fstab file, but responsible for crypto).</i> <br><br><pre> <code class="bash hljs">nano /etc/crypttab</code> </pre> <br>  rule <br><blockquote>  # "Target name" "source device" "key file" "options" <br>  swap / dev / sda8 / dev / urandom swap, cipher = twofish-xts-plain64, size = 512, hash = sha512 </blockquote><br>  Options <br>  * swap - the mapped name when encrypting / dev / mapper / swap. <br>  * / dev / sda8 - use your logical partition under swap. <br>  * / dev / urandom is the generator of random encryption keys for swap ( <i>with each new OS load, new keys are created).</i>  The / dev / urandom generator is less random than / dev / random, after all / dev / random is used when working in dangerous paranoid circumstances.  When booting the OS / dev / random, it slows down the boot for a few ¬± minutes <i>(see systemd-analyze)</i> . <br>  * swap, cipher = twofish-xts-plain64, size = 512, hash = sha512: -partition knows that it is swap and is formatted "accordingly";  encryption algorithm. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   fstab nano /etc/fstab</span></span></code> </pre><br>  rule <br><blockquote>  # swap was on / dev / sda8 during installation <br>  / dev / mapper / swap none swap sw 0 0 <br></blockquote><br>  / dev / mapper / swap is the name specified in crypttab. <br>  <i><b>The swap partition configuration is complete.</b></i> <br><br></div></div><br><div class="spoiler">  <b class="spoiler_title">B4.4.</b>  <b class="spoiler_title">Configuring Encrypted GNU / Linux (editing crypttab / fstab files)</b> <div class="spoiler_text">  The / etc / crypttab file, as written above, describes encrypted block devices that are configured during system boot. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># /etc/crypttab nano /etc/crypttab</span></span></code> </pre><br>  if the section sda7&gt; sda7_crypt was mapped as in p. B2.1 <br><blockquote>  # "Target name" "source device" "key file" "options" <br>  sda7_crypt UUID = 81048598-5bb9-4a53-af92-f3f9e709e2f2 none luks <br></blockquote><br>  if they mapped the sda7 section&gt; sda7_crypt as in p. B2.2 <br><blockquote>  # "Target name" "source device" "key file" "options" <br>  sda7_crypt UUID = 81048598-5bb9-4a53-af92-f3f9e709e2f2 none cipher = twofish-xts-plain64, size = 512, hash = sha512 </blockquote><br>  if you mapped the sda7&gt; sda7_crypt section as in p.2.1 or B2.2, but do not want to re-enter the password to unlock and boot the OS, then you can substitute the secret key / random file instead of the password <br><blockquote>  # "Target name" "source device" "key file" "options" <br>  sda7_crypt UUID = 81048598-5bb9-4a53-af92-f3f9e709e2f2 / etc / skey luks </blockquote><br>  Description <br>  * none - reports that when booting the OS, entering a secret passphrase is required to unlock the root. <br>  * UUID is the partition ID.  To find out your ID dial in the terminal <i>(a reminder that all this time and further, you are working in the terminal in the chroot environment, and not in another live usb terminal).</i> <br><pre> <code class="bash hljs">fdisk -l <span class="hljs-comment"><span class="hljs-comment">#   blkid #  - </span></span></code> </pre><br><blockquote>  / dev / sda7: UUID = "81048598-5bb9-4a53-af92-f3f9e709e2f2" TYPE = "crypto_LUKS" PARTUUID = "0332d73c-07" <br>  / dev / mapper / sda7_crypt: LABEL = "DebSHIFR" UUID = "382111a2-f993-403c-aa2e-292b5eac4780" TYPE = "ext4" <br></blockquote><br>  This line can be seen when requesting blkid from the live usb terminal when sda7_crypt is mounted). <br>  You take the UUID from your sdaX <i>(not sdaX_crypt!, UUID sdaX_crypt - it will automatically go away when generating the grub.cfg config).</i> <br>  * cipher = twofish-xts-plain64, size = 512, hash = sha512 -luks encryption in advanced mode. <br>  * / etc / skey is a secret key file that is automatically inserted to unlock the OS boot <i>(instead of entering the 3rd password).</i>  You can specify any file up to 8MB, but data will be read &lt;1MB. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ""   &lt; &gt;  691. head -c 691 /dev/urandom &gt; /etc/skey</span></span></code> </pre><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   (691)  7-   luks cryptsetup luksAddKey --key-slot 7 /dev/sda7 /etc/skey</span></span></code> </pre> <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  "/ luks-" cryptsetup luksDump /dev/sda7</span></span></code> </pre><br>  It will look something like this: <br><blockquote>  (do it yourself and see for yourself). </blockquote><br>  / etc / fstab contains descriptive information about various file systems. <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># /etc/fstab nano /etc/fstab</span></span></code> </pre><br><blockquote>  # "File system" "mount poin" "type" "options" "dump" "pass" <br>  # / was on / dev / sda7 during installation <br>  / dev / mapper / sda7_crypt / ext4 errors = remount-ro 0 1 <br></blockquote><br>  option <br>  * / dev / mapper / sda7_crypt - sda7 mapping name&gt; sda7_crypt, which is specified in the / etc / crypttab file. <br>  <b>The crypttab / fstab configuration is complete.</b> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">B4.5.</b>  <b class="spoiler_title">Editing configuration files.</b>  <b class="spoiler_title">Key moment</b> <div class="spoiler_text">  <b>B4.5.1.</b>  <b>Editing the /etc/initramfs-tools/conf.d/resume config</b> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#      swap ,  . nano /etc/initramfs-tools/conf.d/resume</span></span></code> </pre><br>  and comment out <i>(if there is) the</i> "#" line "resume".  The file must be completely empty. <br><br>  <b>B4.5.2.</b>  <b>Editing the /etc/initramfs-tools/conf.d/cryptsetup config</b> <br><br><pre> <code class="bash hljs">nano /etc/initramfs-tools/conf.d/cryptsetup</code> </pre> <br>  should match <br><blockquote>  # /etc/initramfs-tools/conf.d/cryptsetup <br>  CRYPTSETUP = yes <br>  export CRYPTSETUP <br></blockquote><br><br>  <b>B4.5.3.</b>  <b>Editing the / etc / default / grub <i>config (this config is responsible for the ability to generate grub.cfg when working with encrypted / boot)</i></b> <br><br><pre> <code class="bash hljs">nano /etc/default/grub</code> </pre> <br>  add the line "GRUB_ENABLE_CRYPTODISK = y" <br>  the 'y' value, grub-mkconfig, and grub-install will check for the presence of encrypted disks and generate additional commands required for their access at boot time <i>(ins &lt;cryptomount / set root&gt;)</i> . <br>  should be like <br><blockquote>  GRUB_DEFAULT = 0 <br>  GRUB_TIMEOUT = 10 <br>  GRUB_DISTRIBUTOR = `lsb_release -i -s 2&gt; / dev / null ||  echo Debian` <br>  GRUB_CMDLINE_LINUX_DEFAULT = "acpi_backlight = vendor" <br>  GRUB_CMDLINE_LINUX = "quiet splash noautomount" <br>  GRUB_ENABLE_CRYPTODISK = y <br></blockquote><br><br>  <b>B4.5.4.</b>  <b>Editing the / etc / cryptsetup-initramfs / conf-hook config</b> <br><br><pre> <code class="bash hljs">nano /etc/cryptsetup-initramfs/conf-hook</code> </pre> <br> ,   &lt;CRYPTSETUP=y&gt;  &lt;#&gt;. <br>   <i>(   ,       ,       initrd.img).</i> <br><br> <b>B4.5.5.   /etc/cryptsetup-initramfs/conf-hook</b> <br><br><pre> <code class="bash hljs">nano /etc/cryptsetup-initramfs/conf-hook</code> </pre> <br>  <br><blockquote> KEYFILE_PATTERN="/etc/skey" <br> UMASK=0077 <br></blockquote><br>     ¬´skey¬ª  initrd.img,         <i>(     ,    ¬´skey¬ª).</i> <br></div></div><br><div class="spoiler"> <b class="spoiler_title">B4.6.  /boot/initrd.img [version]</b> <div class="spoiler_text">      initrd.img    cryptsetup,   <br><pre> <code class="bash hljs">update-initramfs -u</code> </pre> <br>   initrd.img <i>(  ¬´,    ¬ª)</i>  ,   cryptsetup, , ,     Nvidia ‚Äî   .   , ,     .   <i>( chroot ./boot/initrd.img).</i>  <i><b>Attention!</b></i> <i> [update-initramfs -u]  ,  cryptsetup open /dev/sda7 <b>sda7_crypt</b> ‚Äî     ,    /etc/crypttab,   reboot-a  busybox) <br> <i><b>      .</b></i> <br></i> <br></div></div><br><h3> []    GRUB2 </h3><br><div class="spoiler"> <b class="spoiler_title">C1.        (    20)</b> <div class="spoiler_text"><pre> <code class="bash hljs">mkfs.ext4 -v -L GRUB2 /dev/sda6</code> </pre> <br></div></div><br><div class="spoiler"> <b class="spoiler_title">C2.  /dev/sda6  /mnt</b> <div class="spoiler_text">     chroot,       /mnt2,   /mnt ‚Äî  . <br>   GRUB2 <br><br><pre> <code class="bash hljs">mount /dev/sda6 /mnt</code> </pre> <br>       GRUB2,   /mnt/boot/grub/i-386-pc <i>(  , ,  ¬´i386-pc¬ª)</i>   <i>(,     ,   .mod: cryptodisk; luks; gcry_twofish; gcry_sha512; signature_test.mod),</i>    GRUB2  . <br><br><pre> <code class="bash hljs">apt-get update apt-get install grub2</code> </pre><br>  Important!     GRUB2  ,   ¬´ ¬ª      ‚Äì     <i>( ‚Äî   GRUB2 ‚Äî  ¬´MBR¬ª   live usb)</i> .      / VeraCrypt.    GRUB2,   ,       ,    ¬´MBR¬ª.       GRUB2,  <a href="https://www.gnu.org/software/grub/manual/grub/grub.html"></a>     ‚Äì   <i>(    GRUB 2.02 ~BetaX).</i> <br></div></div><br><div class="spoiler"> <b class="spoiler_title">C3.  GRUB2    [sda6]</b> <div class="spoiler_text">       [.C.2] <br><br><pre> <code class="bash hljs">grub-install --force --root-directory=/mnt /dev/sda6</code> </pre> <br>  <br> * --force - ,   ,        <i>( ).</i> <br> * --root-directory -  &lt;boot/grub&gt;   sda6. <br> * /dev/sda6 - sda  <i>(  &lt;&gt;  /mnt /dev/sda6).</i> <br></div></div><br><div class="spoiler"> <b class="spoiler_title">C4.    [grub.cfg]</b> <div class="spoiler_text">    ¬´update-grub2¬ª,        <br><br><pre> <code class="bash hljs">grub-mkconfig -o /mnt/boot/grub/grub.cfg</code> </pre> <br>   /  grub.cfg,      ()      <i>(¬´grub-mkconfig¬ª       live usb,       Windows 10     ‚Äî  ).</i>    ¬´¬ª,  ¬´grub.cfg¬ª  ,     ,    GRUB  <i>(       ),</i>  GRUB2   . <br> <b> ¬´ ¬ª   GRUB2 .</b> <br></div></div><br><div class="spoiler"> <b class="spoiler_title">C5. Proof-test   GNU/Linux</b> <div class="spoiler_text">   .    GNU/Linux <i>(   chroot).</i> <br><br><pre> <code class="bash hljs">umount -a <span class="hljs-comment"><span class="hljs-comment">#     GNU/Linux Ctrl+d #   chroot umount /mnt/dev umount /mnt/proc umount /mnt/sys umount -a #     live usb reboot</span></span></code> </pre> <br>       VeraCrypt. <br><img src="https://habrastorage.org/webt/ih/jd/9c/ihjd9ciwkuzmd6mqdwmxhbcgx5q.jpeg"><br><br> *     ‚Äî    Windows. <br> *  ¬´Esc¬ª   GRUB2,    GNU/Linux ‚Äì   (sda7_crypt)   /boot/initrd.img. <br><img src="https://habrastorage.org/webt/e4/j2/jo/e4j2jofau3dugyj7jrnztkzpbn4.jpeg"><br><br> *   ,     (. .B4.4/4.5)        /boot/initrd.img,     / ,      ¬´skey¬ª,      . <br><img src="https://habrastorage.org/webt/rj/76/al/rj76alpbc7ebscvxe2_0uraoaya.jpeg"><br> ( ¬´   ¬ª). <br><br> *     GNU/Linux    . <br><img src="https://habrastorage.org/webt/j_/q0/fn/j_q0fnugeazypbbwrv_sym9qxvq.jpeg"><br><br> *      ,    /boot/initrd.img <i>( 4.6).</i> <br><br><pre> <code class="bash hljs">update-initramfs ‚Äìu</code> </pre> <br>        GRUB2 <i>(  -  live usb)</i>    <br><br><pre> <code class="bash hljs">mount /dev/sda6 /mnt grub-mkconfig -o /mnt/boot/grub/grub.cfg</code> </pre><br> <b>     GNU/Linux:</b> <br><br><ul><li> GNU/Linuxinux  ,  /boot/kernel and initrd; </li><li>     initrd.img; </li><li>    <i>(    initrd; /   ;    Linux)</i> . </li></ul><br> <b>¬´  GRUB2¬ª     .</b> <br></div></div><br><div class="spoiler"> <b class="spoiler_title">6.   GRUB2.     +  </b> <div class="spoiler_text"> GNU/Linux  ,     ‚Äì    BIOS.       GRUB2 ,  /   ,     ‚Äì   [. . F]. <br>  ¬´¬ª GRUB2      ¬´/¬ª. <br><ul><li>    ¬´  ¬ª   ,         ‚Äì     . </li><li>        - ,      CLI,      -GRUB2. </li></ul><br><br><div class="spoiler"> <b class="spoiler_title">6.1.   </b> <div class="spoiler_text"> ,         <br><br><pre> <code class="bash hljs">ls /&lt;Tab-Tab&gt; <span class="hljs-comment"><span class="hljs-comment"># -</span></span></code> </pre> <br>       GRUB2 <br><br><pre> <code class="bash hljs">grub-mkpasswd-pbkdf2 <span class="hljs-comment"><span class="hljs-comment">#/  .</span></span></code> </pre> <br>   . -    <br><blockquote> grub.pbkdf2.sha512.10000.DE10E42B01BB6FEEE46250FC5F9C3756894A8476A7F7661A9FFE9D6CC4D0A168898B98C34EBA210F46FC10985CE28277D0563F74E108FCE3ACBD52B26F8BA04D.27625A4D30E4F1044962D3DD1C2E493EF511C01366909767C3AF9A005E81F4BFC33372B9C041BE9BA904D7C6BB141DE48722ED17D2DF9C560170821F033BCFD8 <br></blockquote><br>   GRUB <br><br><pre> <code class="bash hljs">mount /dev/sda6 /mnt</code> </pre> <br>   <br><br><pre> <code class="bash hljs">nano -$ /mnt/boot/grub/grub.cfg</code> </pre> <br>    ,   ¬´grub.cfg¬ª  -  (" --unrestricted" "--user", <br>     <i>(  ### END /etc/grub.d/41_custom ###)</i> <br> <i>¬´set superusers=¬ªroot" <br> password_pbkdf2 root ".</i> <br><br>     <br><blockquote> # This file provides an easy way to add custom menu entries. Simply type the <br> # menu entries you want to add after this comment. Be careful not to change <br> # the 'exec tail' line above. <br> ### END /etc/grub.d/40_custom ### <br><br> ### BEGIN /etc/grub.d/41_custom ### <br> if [ -f ${config_directory}/custom.cfg ]; then <br> source ${config_directory}/custom.cfg <br> elif [ -z "${config_directory}" -a -f $prefix/custom.cfg ]; then <br> source $prefix/custom.cfg; <br>  fi <br> set superusers=¬´root¬ª <br> password_pbkdf2 root grub.pbkdf2.sha512.10000.DE10E42B01BB6FEEE46250FC5F9C3756894A8476A7F7661A9FFE9D6CC4D0A168898B98C34EBA210F46FC10985CE28277D0563F74E108FCE3ACBD52B26F8BA04D.27625A4D30E4F1044962D3DD1C2E493EF511C01366909767C3AF9A005E81F4BFC33372B9C041BE9BA904D7C6BB141DE48722ED17D2DF9C560170821F033BCFD8 <br> ### END /etc/grub.d/41_custom ### <br>  # <br></blockquote><br>      ¬´grub-mkconfig -o /mnt/boot/grub/grub.cfg¬ª         grub.cfg,    <i>(/)</i>    GRUB-    <br><br><pre> <code class="bash hljs">nano /etc/grub.d/41_custom</code> </pre> <br><blockquote> cat &lt;&lt; EOF <br> set superusers=¬´root¬ª <br> password_pbkdf2 root grub.pbkdf2.sha512.10000.DE10E42B01BB6FEEE46250FC5F9C3756894A8476A7F7661A9FFE9D6CC4D0A168898B98C34EBA210F46FC10985CE28277D0563F74E108FCE3ACBD52B26F8BA04D.27625A4D30E4F1044962D3DD1C2E493EF511C01366909767C3AF9A005E81F4BFC33372B9C041BE9BA904D7C6BB141DE48722ED17D2DF9C560170821F033BCFD8 <br> EOF <br></blockquote><br><br>    ¬´grub-mkconfig -o /mnt/boot/grub/grub.cfg¬ª, ,   ,     grub.cfg. <br> <b>     GRUB2 .</b> <br></div></div><br><div class="spoiler"> <b class="spoiler_title">6.2.    </b> <div class="spoiler_text"> ,        pgp-  <i>(   ).</i>       : gnuPG; kleopatra/GPA; Seahorse. -        . Seahorse ‚Äî    3.14.0 <i>( , , V3.20 ‚Äì     ).</i> <br><br> PGP-  //    su! <br><br>     <br><br><pre> <code class="bash hljs">gpg - -gen-key</code> </pre> <br>    <br><br><pre> <code class="bash hljs">gpg --<span class="hljs-built_in"><span class="hljs-built_in">export</span></span> -o ~/perskey</code> </pre> <br>           <br><br><pre> <code class="bash hljs">mount /dev/sda6 /mnt <span class="hljs-comment"><span class="hljs-comment">#sda6 ‚Äì  GRUB2</span></span></code> </pre> <br>   GRUB2 <br><br><pre> <code class="bash hljs">rm -rf /mnt/</code> </pre> <br>  GRUB2  sda6,        GRUB ¬´core.img¬ª <br><br><pre> <code class="bash hljs">grub-install --force --modules=<span class="hljs-string"><span class="hljs-string">"gcry_sha256 gcry_sha512 signature_test gcry_dsa gcry_rsa"</span></span> -k ~/perskey --root-directory=/mnt /dev/sda6</code> </pre> <br>  <br> * --force - ,   ,    <i>( ).</i> <br> * --modules=¬´gcry_sha256 gcry_sha512 signature_test gcry_dsa gcry_rsa¬ª - GRUB2        . <br> * -k ~/perskey -  ¬´PGP-¬ª <i>(    ,   ).</i> <br> * --root-directory -  boot   sda6 <br> /dev/sda6 - sda . <br><br> / grub.cfg <br><br><pre> <code class="bash hljs">grub-mkconfig -o /mnt/boot/grub/grub.cfg</code> </pre> <br>     ¬´grub.cfg¬ª  ¬´trust /boot/grub/perskey¬ª <i>(  pgp-.)</i>     GRUB2   ,       ¬´signature_test.mod¬ª,          ¬´set check_signatures=enforce¬ª. <br><br>     <i>(    grub.cfg)</i> <br><blockquote> ### BEGIN /etc/grub.d/41_custom ### <br> if [ -f ${config_directory}/custom.cfg ]; then <br> source ${config_directory}/custom.cfg <br> elif [ -z "${config_directory}" -a -f $prefix/custom.cfg ]; then <br> source $prefix/custom.cfg; <br>  fi <br> trust /boot/grub/perskey <br> set superusers=¬´root¬ª <br> password_pbkdf2 root grub.pbkdf2.sha512.10000.DE10E42B01BB6FEEE46250FC5F9C3756894A8476A7F7661A9FFE9D6CC4D0A168898B98C34EBA210F46FC10985CE28277D0563F74E108FCE3ACBD52B26F8BA04D.27625A4D30E4F1044962D3DD1C2E493EF511C01366909767C3AF9A005E81F4BFC33372B9C041BE9BA904D7C6BB141DE48722ED17D2DF9C560170821F033BCFD8 <br> ### END /etc/grub.d/41_custom ### <br>  # </blockquote><br><br>   "/boot/grub/perskey"       ,  hd0,6,    ¬´¬ª    ,    GRUB2 <i>(. set rot=..).</i> <br><br>  GRUB2 <i>(     /GRUB)</i>   ¬´perskey¬ª. <br>  ,   <i>(  nautilus/caja):</i>     ¬´seahorse¬ª  .         su. <br>    sudo "/mnt/boot" ‚Äì  ‚Äì .       <br><br><img src="https://habrastorage.org/webt/ja/bw/id/jabwidfus4xnsjb774pllt4z1hc.jpeg"><br><br>   "/mnt/boot/grub/perskey" <i>(   grub)</i>       . ,   /    [*.sig]. <br>    "/boot" <i>( kernel, initrd).</i>    - ,      bash-   ¬´ ¬ª. <br><br>      <i>( -   )</i> <br><br><pre> <code class="bash hljs">rm -f $(find /mnt/boot/grub -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -name <span class="hljs-string"><span class="hljs-string">'*.sig'</span></span>)</code> </pre> <br>        ,    ,    GRUB2. <br><br><pre> <code class="bash hljs">apt-mark hold grub-common grub-pc grub-pc-bin grub2 grub2-common</code> </pre> <br> <b>   &lt;   &gt;   GRUB2 .</b> <br></div></div><br><div class="spoiler"> <b class="spoiler_title">C6.3. Proof-test  GRUB2,     </b> <div class="spoiler_text"> GRUB2.   -  GNU/Linux    CLI <i>( )</i>   .    /    initrd <br><br><img src="https://habrastorage.org/webt/wu/ip/nt/wuipntxpfzxczd8sz-_nihhtkrc.jpeg"><br> ,   GRUB2-. <br><br>   -   GRUB2/   grub.cfg,   /,   .mod,    .  GRUB2 . <br><br><img src="https://habrastorage.org/webt/1j/cn/ao/1jcnaogftdd3pme8jexwyrzhe_m.jpeg"><br> ,    GRUB2 ¬´ ¬ª. <br><br>  ¬´¬ª  ¬´ ¬ª,     ¬´0¬ª.        <i>(  ¬´      ¬ª         ¬´0¬ª ‚Äî  ).</i> <br><br>     ? <br><br>   : /  GRUB2 , ,   luks.mod.sig   . <br><br>  :   CLI     <br><br><pre> <code class="bash hljs">trust_list</code> </pre> <br>      ¬´perskey¬ª,   ¬´0¬ª,     ,  .C6.2. <br> <b>     ¬´ GRUB2    ¬ª .</b> <br></div></div><br></div></div><br><h3> [D]  ‚Äî    </h3><br><blockquote>      ,  ¬´     ¬ª,       . </blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As usual, there are various ‚Äúmyths and </font></font><a href="https://docs.bleachbit.org/doc/shred-files-and-wipe-disks.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">legends</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äù about data recovery after they are deleted from the hard disk. If you believe in cyberspace, or are members of the Dr web community and have never tried to recover data after deleting / rewriting it </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(for example, restoring using R-studio)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , then the proposed method is unlikely to suit you, use what is closer to you. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After the successful transfer of GNU / Linux to an encrypted partition, the old copy must be deleted without the possibility of data recovery. Universal cleaning method: software for Windows / Linux free GUI software </font></font><a href="https://www.bleachbit.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BleachBit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quickly </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">format the partition</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> whose data you want to destroy </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(using Gparted),</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Run BleachBit, select "Clean up free space" - select a partition </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(your sdaX with the previous copy of GNU / Linux)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , the cleaning process will start. </font><font style="vertical-align: inherit;">BleachBit - wipes the disc in one pass - this is what we need, BUT! </font><font style="vertical-align: inherit;">this only works in theory if you formatted the disk and cleaned it in BB v2.0 software. </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Attention</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! </font><font style="vertical-align: inherit;">BB wipes the disk, leaving the metadata, the file names are saved when the data is </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erased (Ccleaner does not leave metadata).</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And the myth of data recovery is not exactly a myth.</font></font></b> <div class="spoiler_text"> Bleachbit V2.0-2  unstable OS Debian <i>(    : sfill; wipe-Nautilus -       )</i>      :  ¬´  ¬ª <b> </b>  HDD/ <i>(ntfs/ext4)</i> .           ,    .   <i>()</i>   /    /    ¬´¬ª   .   ,   ,   ,   <b>¬´ ¬ª  </b>   3+   . <br>  GNU/Linux  Bleachbit <b>2.0-2</b>        ,     .  :  Windows   CCleaner  ¬´  ntfs¬ª  ,        . <br><br>  ,    <u></u>   , <b>   Bleachbit   </b> , ,   ¬´ / ¬ª. <br>   ¬´    ¬ª  Windows  CCleaner/BB   ¬´¬ª.  GNU/Linux    <i>(  )</i>      <i>( +           (  ,  ))</i> ,                . <br></div></div><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this step, ‚Äúdisc cleaning‚Äù is completed.</font></font></b> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [E] Universal backup of encrypted OS </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Each user has his own method of data backup, but the encrypted data of the ‚ÄúSystem OS‚Äù requires a slightly different approach to the task. </font><font style="vertical-align: inherit;">Unified software such as Clonezilla and similar software cannot work directly with encrypted data. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setting the task of backing up encrypted block devices:</font></font><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> universality - the same algorithm / backup software for Windows / Linux; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the ability to work in the console from any GNU / Linux live usb without the need for additional software download </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(but still recommend the GUI)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> backup security - stored ‚Äúimages‚Äù must be encrypted / password protected; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> the size of the encrypted data must match the size of the actual data copied; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">convenient extraction of the necessary files from the backup </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(there is no requirement to decrypt the entire section first).</font></font></i> </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> For example, backup / restore through the utility "dd" </font></font><br><br><pre> <code class="bash hljs">dd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>=/dev/sda7 of=//sda7.img bs=7M conv=sync,noerror dd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>=//sda7.img of=/dev/sda7 bs=7M conv=sync,noerror</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Corresponds to almost all items of the task, but according to claim 4 does not hold water, as it copies the entire section of the disk as a whole, including free space. </font><font style="vertical-align: inherit;">Not interested. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For example, a backup copy of GNU / Linux via the tar archiver | </font><font style="vertical-align: inherit;">gpg is convenient, but for Windows backup you need to look for another solution. </font><font style="vertical-align: inherit;">Not interested.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E1. </font><font style="vertical-align: inherit;">Backup Windows / Linux. </font><font style="vertical-align: inherit;">A bunch of Grsync + VeraCrypt volume</font></font></b> <div class="spoiler_text">    : <br><ol><li>    <i>(/)</i> VeraCrypt  ; </li><li> /    Rsync   VeraCrypt; </li><li>     VeraCrypt  www. </li></ol><br><br>    VeraCrypt   : <br>    <i>(     Windows,     GNU/Linux)</i> ; <br>   ,    ¬´ ¬ª <i>(  )</i> ‚Äì  . <br>        Windows,       GNU/Linux &gt; VeraCrypt ,        . <br>   Twofish  70   <i>( ,    )</i>  HDD ~   <i>(      ,   ).</i>  VeraCrypt Windows/Linux        ,       ¬´   ¬ª,     . <br><br>    VeraCrypt <i>( )</i> ,     . <br> //   VeraCrypt GUI&gt; GNU/Linux live usb <i>(    /media/veracrypt2,   Windows   /media/veracrypt1).</i>      Windows   GUI rsync <i>(grsync)</i> ,  . <br><br><img src="https://habrastorage.org/webt/py/0v/hw/py0vhwm-rlgyctkndhzgcyrzpu8.jpeg"><br><br>   .    ,      . <br>     GNU/Linux,    GUI rsync ¬´  Windows¬ª. <br><br>       .   rsync: <br> * -g - ; <br> * -P --progress ‚Äî     ; <br> * -H - ,  ; <br> * - -  <i>(  rlptgoD)</i> ; <br> * -v -. <br><br>    ¬´ Windows VeraCrypt¬ª     cryptsetup,   alias (su) <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"alias veramount='cryptsetup open --veracrypt --tcrypt-system --type tcrypt /dev/sdaX Windows_crypt &amp;&amp; mount /dev/mapper/ Windows_crypt /media/veracrypt1'"</span></span> &gt;&gt; .bashrc &amp;&amp; bash</code> </pre><br>    ¬´veramount <s>pictures</s> ¬ª      ,   - ,    Windows. <br><br> /   VeraCrypt  cryptsetup  <br><br><pre> <code class="bash hljs">cryptsetup open --veracrypt --tcrypt-system --<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> tcrypt /dev/sdaX Windows_crypt mount /dev/Windows_crypt /mnt</code> </pre> <br> / / VeraCrypt  cryptsetup  <br><br><pre> <code class="bash hljs">cryptsetup open --veracrypt --<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> tcrypt /dev/sdaY test_crypt mount /dev/test_crypt /mnt</code> </pre> <br>         Windows/Linux. <br> <b>       .</b> <br></div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [F] Attack on GRUB2 bootloader </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you have protected your bootloader with a digital signature and / or authentication </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(see p. C6.)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , Then it will not protect you from physical access. Encrypted data will remain inaccessible, but protection bypass </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(reset of digital signature protection)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GRUB2 allows a cyber villain to inject its code into the bootloader without arousing suspicion </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(unless the user manually monitors the status of the bootloader, or creates a strong, arbitrary script for grub.cfg).</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Algorithm attack. Intruder </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* Boot a PC from live usb. Any change </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(by the intruder) of the</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> files will result in notifying the real PC owner about the invasion of the bootloader. But simple GRUB2 reinstallation with grub.cfg saving</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(and the subsequent possibility of editing it)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> will allow the attacker to edit any files </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(in this situation, when GRUB2 is loaded, the alert will not be sent to the real user. The status is the same &lt;0&gt;)</font></font></i> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * Mounts the unencrypted partition, keeps "/ mnt / boot / grub / grub.cfg ". </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* Reinstalls the bootloader </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(ejecting ‚Äúperskey‚Äù from the core.img image)</font></font></i> <br><br><pre> <code class="bash hljs">grub-install --force --root-directory=/mnt /dev/sda6</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* Returns "grub.cfg"&gt; "/mnt/boot/grub/grub.cfg", if necessary, it edits, for example, adding your module "keylogger.mod" to the folder with the loader modules in the "grub.cfg"&gt; line "Insmod keylogger". Or, for example, if the enemy is cunning, then after reinstalling GRUB2 </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(all signatures remain in place),</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> it collects the main image of GRUB2 using ‚Äúgrub-mkimage with the (-c) option.‚Äù The ‚Äú-c‚Äù option will allow you to load your config before loading the main "Grub.cfg". A config can consist of just one line: redirection to any ‚Äúmodern.cfg‚Äù, mixed, for example, with ~ 400 files </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(modules + signatures)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the folder "/ boot / grub / i386-pc". </font><font style="vertical-align: inherit;">At the same time, the intruder can enter arbitrary code and load modules without affecting "/boot/grub/grub.cfg", even if the user has applied "hashsum" to the file and temporarily displayed it on the screen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The attacker will not need to crack the login / password of the GRUB2 superuser, you just need to copy the lines </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(responsible for authentication)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "/boot/grub/grub.cfg" into your "modern.cfg"</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">superusers = set ¬´root¬ª </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">password_pbkdf2 root grub.pbkdf2.sha512.10000.DE10E42B01BB6FEEE46250FC5F9C3756894A8476A7F7661A9FFE9D6CC4D0A168898B98C34EBA210F46FC10985CE28277D0563F74E108FCE3ACBD52B26F8BA04D.27625A4D30E4F1044962D3DD1C2E493EF511C01366909767C3AF9A005E81F4BFC33372B9C041BE9BA904D7C6BB141DE48722ED17D2DF9C560170821F033BCFD8</font></font><br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And for the PC host, the GRUB2 authentication of the root user will still be valid. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chain loading </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(the loader loads another loader)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , as I wrote above, does not make sense </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(it is intended for another purpose)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Because of the BIOS, you cannot load an encrypted bootloader </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(chain loading restarts GRUB2&gt; encrypted GRUB2, an error!)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . However, if you still use the idea of ‚Äã‚Äãchain loading, then you can be sure that it is the encrypted </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(not upgraded)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äúgrub.cfg‚Äù </font><font style="vertical-align: inherit;">that is loaded </font><font style="vertical-align: inherit;">from the encrypted partition. And this is also a false sense of security, because everything that is stated in the encrypted "grub.cfg"</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(module loading) is added to modules that are loaded from unencrypted GRUB2. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you want to check this, then select / encrypt another sdaY partition, copy GRUB2 onto it </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(grub-install operation on the encrypted partition is impossible)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and in the ‚Äúgrub.cfg‚Äù </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(unencrypted config)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> change lines like this</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menuentry 'GRUBx2' --class parrot --class gnu-linux --class gnu --class os $ menuentry_id_option 'gnulinux-simple-382111a2-f993-403c-aa2e-292b5eac4780' { </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">load_video </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">insmod gzio </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if [x $ grubp ma ]; </font><font style="vertical-align: inherit;">then insmod xzio; </font><font style="vertical-align: inherit;">insmod lzopio;</font></font> fi <br> insmod part_msdos <br> insmod cryptodisk <br> insmod luks <br> insmod gcry_twofish <br> insmod gcry_twofish <br> insmod gcry_sha512 <br> insmod ext2 <br> cryptomount -u 15c47d1c4bd34e5289df77bcf60ee838 <br> set root='cryptouuid/15c47d1c4bd34e5289df77bcf60ee838' <br> normal /boot/grub/grub.cfg <br>  } <br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strings </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* insmod - loading the necessary modules to work with an encrypted disk; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* GRUBx2 -the name of the output line in the boot menu GRUB2; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* cryptomount -u 15c47d1c4bd34e5289df77bcf60ee838 - see fdisk -l (sda9); </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* set root-install root; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* normal /boot/grub/grub.cfg - executable configuration file on the encrypted partition. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The confidence that it is the encrypted ‚Äúgrub.cfg‚Äù that is being loaded is a positive response to entering the password / unlocking the ‚ÄúsdaY‚Äù when selecting the ‚ÄúGRUBx2‚Äù line in the GRUB menu. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When working in the CLI, in order not to get confused </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(and to check if the ‚Äúset root‚Äù variable environment worked),</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">create empty marker files, for example, in the encrypted "/ shifr_grub" section, in the unencrypted "/ noshifr_grub" section. </font><font style="vertical-align: inherit;">CLI Check</font></font><br><br><pre> <code class="bash hljs">cat /Tab-Tab</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As noted above, this will not help from downloading malicious modules if such modules are on your PC. </font><font style="vertical-align: inherit;">For example, a keylogger who can save keystrokes to a file and mix with other files in "~ / i386" until an attacker downloads it with physical access to a PC. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The easiest way to verify that digital signature protection is actively working </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(not reset)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and no one has invaded the bootloader, in the CLI we type the command</font></font><br><br><pre> <code class="bash hljs">list_trusted</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in response, we receive a cast of our perskey, or do not get anything if we are attacked </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(you also need to check ‚Äúset check_signatures = enforce‚Äù)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essential minus of such step, to fill teams manually. If you add this command to ‚Äúgrub.cfg‚Äù and protect it with a digital signature, then the preliminary output of the key snapshot on the screen is too short in timing, and you may not have time to see the output, having received the GRUB2 download. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There is no one to complain to: the developer in his </font></font><a href="https://www.gnu.org/software/grub/manual/grub/grub.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Clause 18.2 officially states</font></font><blockquote> ¬´Note that even with GRUB password protection, GRUB itself cannot prevent someone with physical access to the machine from altering that machine's firmware (eg, Coreboot or BIOS) configuration to cause the machine to boot from a different (attacker-controlled) device. GRUB is at best only one link in a secure boot chain¬ª. </blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GRUB2 is too overloaded with functions that can give a sense of false security, and its development has already been ahead of MS-DOS OS, but this is just a bootloader. It's funny that GRUB2 - ‚Äútomorrow‚Äù can become an OS, and GNU / Linux loaded virtual machines for it. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A small video about how I dropped the GRUB2 digital signature protection and announced my intrusion to a real user </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(scared, but instead of what is shown on the video - you can write a non-harmless arbitrary code / .mod)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/qhmsLeAN2Ag" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Findings: <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1) Block system encryption for Windows is easier to implement, and protection with one password is more convenient than protection with multiple passwords with GNU / Linux block system encryption. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2) The article was written as a relevant, detailed and </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">simple</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> guide to full Windows / GNU / Linux system encryption, which you are not meeting on the network. Therefore, it did not consider some interesting chapters: about cryptographers who disappear / remain in the shadows; that in different GNU / Linux books they do not write about encryption; on Article 55 of the Constitution of the Russian Federation; about what you need to encrypt the root / boot. The article turned out to be already considerable, but detailed (describing even simple steps), in turn, this will save you a lot of time when you take up full system encryption.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3) System encryption performed on Windows 7 64; </font><font style="vertical-align: inherit;">GNU / Linux Parrot 4x; </font><font style="vertical-align: inherit;">GNU / Debian 9.0 / 9.5. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4) Implemented a successful attack on the GRUB2 bootloader. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5) Tutorial was created to help all the paranoid CIS, but was not duplicated in the blog Habr social network vk (for reasons unknown to me).</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [G] Useful Documentation </font></font></h3><br><ol><li> <a href="https://vk.cc/8GNX7R"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TrueCrypt User Guide </font></font></a> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(February 7, 2012 RU)</font></font></i> </li><li> <a href="https://vk.cc/8GNWkR"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VeraCrypt Documentation</font></font></a> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ usr / share / doc / cryptsetup (-run) [local resource] </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(the official detailed documentation for setting up GNU / Linux encryption using cryptsetup)</font></font></i> </li><li> <a href="https://vk.cc/8GNWJB"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The official cryptsetup FAQ </font></font></a> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(a brief documentation on configuring GNU / Linux encryption using cryptsetup)</font></font></i> </li><li> <a href="https://vk.cc/8GNXyB"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LUKS device encryption </font></font></a> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(archlinux documentation)</font></font></i> </li><li> <a href="https://vk.cc/8GNXOw"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detailed cryptsetup syntax </font></font></a> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(arch manual page)</font></font></i> </li><li> <a href="https://vk.cc/8GNY5W"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crypttab Detailed Description </font></font></a> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(arch manual page)</font></font></i> </li><li> <a href="https://vk.cc/8GNYis"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Official documentation GRUB2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li></ol><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tags: full disk encryption, partition encryption, full Linux encryption, full system encryption. </font></font></div><p>Source: <a href="https://habr.com/ru/post/429208/">https://habr.com/ru/post/429208/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../429196/index.html">iOS runtime mobile exploration with Objection, or Hack own application</a></li>
<li><a href="../429198/index.html">The Kernel-Bridge Framework: Ring0 Bridge</a></li>
<li><a href="../429200/index.html">British scientists have launched a supercomputer with 1 million cores, which simulates the human brain</a></li>
<li><a href="../429202/index.html">Expensive courses: is it worth it?</a></li>
<li><a href="../429204/index.html">The most important misconceptions about game development</a></li>
<li><a href="../429210/index.html">The harsh reality: Your stakeholders do not want business analysis</a></li>
<li><a href="../429212/index.html">Microsoft has confirmed the presence of (mass) problems with the activation of Windows 10</a></li>
<li><a href="../429214/index.html">Middleware and Pipeline features in Laravel</a></li>
<li><a href="../429216/index.html">Google Play sales check - is it worth worrying?</a></li>
<li><a href="../429218/index.html">Julia and partial differential equations</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>