<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using the ArcGIS API for Python in Jupyter Notebook</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! This is the blog of the company Technoserv. In the production process on projects that we carry out, interesting technological cases are born. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using the ArcGIS API for Python in Jupyter Notebook</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/a50/4ad/8b3/a504ad8b320b4061ada91791b9c2fd75.PNG"><br><br><p>  Hello!  This is the blog of the company Technoserv.  In the production process on projects that we carry out, interesting technological cases are born.  There are so many of them that we decided to start sharing them with the world.  And yes, this is our first publication. </p><br><p>  The honor to start a blog fell to me, and I write about what is close and loved to me: about geo-information technologies.  I work in the department of Big Data, where I develop high-load geographic information systems and services based on engines for distributed computing.  We will talk more about high matters, and today we will gradually begin immersion in GIS. </p><br><p>  Increasingly, data analysts (or as they call them Data Scientist) need to visualize data on a map.  What tool is now considered the most convenient for the work of the analyst?  Of course, notebooks!  Until recently, the possibilities for visualization of geodata were not so much.  You could make static rasters in matplotlib, sometimes you could even add basemaps.  Interesting was the library for working with Leaflet, where you can open geojson files.  Today I want to talk about the ArcGIS API for Python from Esri. </p><br><p>  This article will be useful both for analysts who want to study examples of working with GIS, as well as for cartographers and GIS specialists who are interested in trying their hand at writing code. </p><br><a name="habracut"></a><br><h2 id="chto-takoe-arcgis-api-for-python">  What is the ArcGIS API for Python? </h2><br><p>  It is an easy-to-use and functional-rich library for visualizing and analyzing geodata, as well as for managing a corporate GIS (Geographic Information System), from spatial data to administration.  An important feature of this library is "Pythonic" (Pythonic) using standard constructions, structures and idioms, which distinguishes it from the arcpy standard ArcGIS library, which sometimes caused developers to rage with both code style and speed. </p><br><p>  This article discusses the features that are available without purchasing ArcGIS licenses or an ArcGIS Online subscription.  To work, you will need a free ArcGIS Online account (I‚Äôll omit the details of its creation - it‚Äôs quite simple to do at <a href="http://www.arcgis.com/">http://www.arcgis.com</a> ).  In this variant there is a restriction on 1000 objects in the layer. <br>  The API is distributed as a cong-package arcgis.  Inside the package, which is a conceptual GIS model, the functionality is organized in several different modules, which makes it easy to use and understand.  Each module has several types and functions that cover a specific aspect of GIS. </p><br><p>  I will consider a small part of the API as an introductory material. </p><br><ul><li> <code>arcgis.gis</code> provides a basic information model for both corporate GIS and ArcGIS Online.  This module provides management functions (create, read, update, and delete) by users, groups, and content.  Actually, this is your entry point to GIS. </li><li>  <code>arcgis.widgets</code> is, in fact, a module for managing cartographic widgets (MapView) in Jupyter notebook. </li></ul><br><h2 id="ustanovka">  Installation </h2><br><p>  At the moment, the library is distributed only inside Anaconda for Python 3x.  Put everything simple. </p><br><pre> <code class="python hljs">%%cmd conda install -c esri arcgis</code> </pre> <br><p>  I hope everything went well.  Now you can start using. <br>  If you don‚Äôt want to install Anaconda, but you want to test the library, you can try the Esri sandbox: <a href="https://notebooks.esri.com/">https://notebooks.esri.com</a> . </p><br><h2 id="ispolzovanie">  Using </h2><br><p>  The GIS object in the gis module is the most important point in the ArcGIS API for Python, your entry point.  He personifies the GIS that you work with, be ArcGIS Online or corporate ArcGIS.  The object allows you to work with geo-content or to administer GIS.  Let's start with the initialization of the GIS object </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> arcgis <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> arcgis.gis <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> GIS</code> </pre> <br><p>  For work, you can use it as a basic anonymous connection to ArcGIS Online ... </p><br><pre> <code class="python hljs">gis = GIS()</code> </pre> <br><p>  ... and with login. </p><br><pre> <code class="python hljs">my_gis = GIS(url=<span class="hljs-string"><span class="hljs-string">'http://arcgis.com'</span></span>, username=<span class="hljs-string"><span class="hljs-string">'andrey_zhukov'</span></span>, password=<span class="hljs-string"><span class="hljs-string">''</span></span>)</code> </pre> <br><p>  For any tool you can call help, for example </p><br><pre> <code class="python hljs">gis?</code> </pre> <br><p>  In addition, contextual input is also supported. </p><br><img src="https://habrastorage.org/getpro/habr/post_images/a24/2f4/e80/a242f4e8058edf03c107fab99becf0cc.png"><br><p>  Embed the map - it's easy! <br>  Let's initialize the object of the map hello_map with the center in Moscow and with a zoom level of 15. </p><br><pre> <code class="python hljs">hello_map = my_gis.map(<span class="hljs-string"><span class="hljs-string">""</span></span>, zoomlevel = <span class="hljs-number"><span class="hljs-number">15</span></span>)</code> </pre> <br><p>  Now let's call him ... </p><br><pre> <code class="python hljs">hello_map</code> </pre> <br><img src="https://habrastorage.org/files/42b/d85/704/42bd8570410d477fa8910a618fa9d71d.PNG"><br><p>  Welcome! <br>  The basic elements work in the map - dragging with the mouse (pan) and zooming (zoom) with the mouse wheel (or the corresponding gesture on the touchpad), and with on-screen buttons. <br>  Subsequent manipulations with the hello_map object will be reflected in the frame above. <br>  What can be controlled from the card? <br>  For example, zoom. </p><br><pre> <code class="python hljs">hello_map.zoom = <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre> <br><p>  Increase the area of ‚Äã‚Äãthe map </p><br><pre> <code class="python hljs">hello_map.height = <span class="hljs-string"><span class="hljs-string">'600px'</span></span></code> </pre> <br><p>  Such picture will turn out: </p><br><img src="https://habrastorage.org/files/d75/7bb/76b/d757bb76b8894af7b3cf7f1b5b5c3f16.PNG"><br><p>  Let's look at the list of available base maps. </p><br><pre> <code class="python hljs">hello_map.basemaps</code> </pre> <br><pre> <code class="hljs json">['streets', 'satellite', 'hybrid', 'topo', 'gray', 'dark-gray', 'oceans', 'national-geographic', 'terrain', 'osm']</code> </pre> <br><p>  Can I see everything?  Of course! </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sleep <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> basemap <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> hello_map.basemaps: hello_map.basemap = basemap sleep(<span class="hljs-number"><span class="hljs-number">5</span></span>)</code> </pre> <br><p>  In the frame of the map you can see something like this: </p><br><img src="https://habrastorage.org/files/bdc/91d/217/bdc91d217d524014b6cf87a16399b32c.gif"><br><p>  OpenStreetMap - quite familiar, dwell on it. </p><br><pre> <code class="python hljs">hello_map.basemap = <span class="hljs-string"><span class="hljs-string">'osm'</span></span></code> </pre> <br><p>  Look for addresses.  Find the address of the BC Omega Plaza and approx map to it. <br>  Geocoding at one address is absolutely free, but batch geocoding already requires credits to the organization‚Äôs account. </p><br><pre> <code class="python hljs">location = arcgis.geocoding.geocode(<span class="hljs-string"><span class="hljs-string">',  , 19'</span></span>, max_locations=<span class="hljs-number"><span class="hljs-number">1</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]</code> </pre> <br><pre> <code class="python hljs">hello_map.extent = location[<span class="hljs-string"><span class="hljs-string">'extent'</span></span>]</code> </pre> <br><img src="https://habrastorage.org/files/e67/d05/244/e67d05244360469db5097036b808ca78.PNG"><br><p>  You can add content from the ArcGIS Online gallery to the map.  Let's look for something interesting ... </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> IPython.display <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> display items = gis.content.search(<span class="hljs-string"><span class="hljs-string">'title:Moscow'</span></span>, item_type=<span class="hljs-string"><span class="hljs-string">'Feature Collection'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> items: display(item)</code> </pre> <br><img src="https://habrastorage.org/files/b3d/5e6/8b2/b3d5e68b206b45acae4a274dfe44734a.PNG"><br><p>  <code>Moscow Walking Tour</code> - great!  Refine item. </p><br><pre> <code class="python hljs">my_layer = items[<span class="hljs-number"><span class="hljs-number">2</span></span>] display(my_layer)</code> </pre> <br><img src="https://habrastorage.org/files/b2c/8fa/7c6/b2c8fa7c68924e54814232ecfdf0e5b8.PNG"><br><p>  Add a service and look at our hello_map </p><br><pre> <code class="python hljs">hello_map.add_layer(my_layer)</code> </pre> <br><pre> <code class="python hljs">hello_map.zoom = <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre> <br><img src="https://habrastorage.org/files/b5c/b1a/5da/b5cb1a5dac97404197de7615af6ff75d.PNG"><br><p>  We received a web map embedded in a frame inside a notebook.  It supports navigation and information output by clicking on objects.  Today, many organizations use ArcGIS technology not only at the corporate level, but also to publish open data.  Some of these open data are available for search and use on ArcGIS Online, others can be found through the open data portal ( <a href="https://opendata.arcgis.com/">https://opendata.arcgis.com/</a> ) and uploaded to ArcGIS Online. </p><br><p>  Happy <del>  hacking </del>  mapping! </p><br><h2 id="rabota-s-obektami">  Work with objects </h2><br><p>  Of course, every Data Scientist working in Jupyter Notebook is used to pandas and DataFrame.  Let's work with a complete dataset using pandas and ArcGIS. </p><br><p>  To do this, we first import csv into pandas, and then convert it to a map layer. <br>  As an example, I will take a layer of Moscow parking machines.  I have already conjured a bit with the original csv.  I recoded to utf8 and renamed the columns to avoid unexpected problems. </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd parkomats = pd.read_csv(<span class="hljs-string"><span class="hljs-string">r'.\data\data-417-2017-02-14.csv'</span></span>, sep=<span class="hljs-string"><span class="hljs-string">';'</span></span>)</code> </pre> <br><p>  Let's see the resulting object.  It already has latitude and longitude, as well as a pseudo-geojson-field geoData.  When importing data, ArcGIS itself attempts to identify geometry fields or addresses.  If we needed to collect data by addresses, we would have to collect an address from several fields. </p><br><pre> <code class="python hljs">parkomats.tail()</code> </pre> <br><img src="https://habrastorage.org/files/f3c/91f/0ae/f3c91f0aebbf4235afe2c0cd73adc6ec.PNG"><br><p>  Now import the DataFrame from pandas into gis objects.  To do this, simply call the import_data function.  As a result, we have a FeatureCollection object. </p><br><pre> <code class="python hljs">geoparkomats = my_gis.content.import_data(parkomats) geoparkomats</code> </pre> <br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FeatureCollection</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Now add objects to the map.  To do this, initialize the new map object and add our new layer to it. </p><br><pre> <code class="python hljs">parkomat_map = my_gis.map(<span class="hljs-string"><span class="hljs-string">''</span></span>, zoomlevel=<span class="hljs-number"><span class="hljs-number">12</span></span>) parkomat_map.basemap = <span class="hljs-string"><span class="hljs-string">'osm'</span></span> parkomat_map.height = <span class="hljs-string"><span class="hljs-string">'600px'</span></span> parkomat_map.add_layer(geoparkomats) parkomat_map</code> </pre> <br><img src="https://habrastorage.org/files/a53/08f/b58/a5308fb583904e8aafc229a61e39d68e.PNG"><br><p>  Already not bad!  But it would be nice to issue this data.  Let's try to decorate them.  For starters, just by parking zones </p><br><pre> <code class="python hljs">parkomat_cat_map = my_gis.map(<span class="hljs-string"><span class="hljs-string">''</span></span>, zoomlevel=<span class="hljs-number"><span class="hljs-number">10</span></span>) parkomat_cat_map.basemap = <span class="hljs-string"><span class="hljs-string">'gray'</span></span> parkomat_cat_map.add_layer(geoparkomats, {<span class="hljs-string"><span class="hljs-string">"renderer"</span></span>:<span class="hljs-string"><span class="hljs-string">"ClassedColorRenderer"</span></span>, <span class="hljs-string"><span class="hljs-string">"field_name"</span></span>:<span class="hljs-string"><span class="hljs-string">"ParkingZoneNumber"</span></span>}) parkomat_cat_map.height = <span class="hljs-string"><span class="hljs-string">'600px'</span></span> parkomat_cat_map</code> </pre> <br><img src="https://habrastorage.org/files/2fa/aee/c58/2faaeec5858d4d01a7ee44f30d72b233.PNG"><br><p>  Many people like heatmaps.  Let's try to do it. </p><br><pre> <code class="python hljs">parkomat_heat_map = my_gis.map(<span class="hljs-string"><span class="hljs-string">''</span></span>, zoomlevel=<span class="hljs-number"><span class="hljs-number">11</span></span>) parkomat_heat_map.basemap = <span class="hljs-string"><span class="hljs-string">'dark-gray'</span></span> parkomat_heat_map.add_layer(geoparkomats, {<span class="hljs-string"><span class="hljs-string">"renderer"</span></span>:<span class="hljs-string"><span class="hljs-string">"HeatmapRenderer"</span></span>}) parkomat_heat_map.height = <span class="hljs-string"><span class="hljs-string">'600px'</span></span> parkomat_heat_map</code> </pre> <br><img src="https://habrastorage.org/files/894/27f/879/89427f879af142408d1c5fe7f115d7d5.PNG"><br><p>  As you can see, adding and styling a layer is not difficult. </p><br><p>  In addition, you can arrange all the cards nearby.  To do this, create and configure three new frames and enter them into one box. </p><br><pre> <code class="python hljs">just_map = my_gis.map(<span class="hljs-string"><span class="hljs-string">''</span></span>, zoomlevel=<span class="hljs-number"><span class="hljs-number">10</span></span>) just_map.basemap = <span class="hljs-string"><span class="hljs-string">'osm'</span></span> just_map.add_layer(geoparkomats)</code> </pre> <br><pre> <code class="python hljs">cat_map = my_gis.map(<span class="hljs-string"><span class="hljs-string">''</span></span>, zoomlevel=<span class="hljs-number"><span class="hljs-number">10</span></span>) cat_map.basemap = <span class="hljs-string"><span class="hljs-string">'gray'</span></span> cat_map.add_layer(geoparkomats, {<span class="hljs-string"><span class="hljs-string">"renderer"</span></span>:<span class="hljs-string"><span class="hljs-string">"ClassedColorRenderer"</span></span>, <span class="hljs-string"><span class="hljs-string">"field_name"</span></span>:<span class="hljs-string"><span class="hljs-string">"ParkingZoneNumber"</span></span>})</code> </pre> <br><pre> <code class="python hljs">heat_map = my_gis.map(<span class="hljs-string"><span class="hljs-string">''</span></span>, zoomlevel=<span class="hljs-number"><span class="hljs-number">10</span></span>) heat_map.basemap = <span class="hljs-string"><span class="hljs-string">'dark-gray'</span></span> heat_map.add_layer(geoparkomats, {<span class="hljs-string"><span class="hljs-string">"renderer"</span></span>:<span class="hljs-string"><span class="hljs-string">"HeatmapRenderer"</span></span>})</code> </pre> <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ipywidgets <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * just_map.layout=Layout(flex=<span class="hljs-string"><span class="hljs-string">'1 1'</span></span>, padding=<span class="hljs-string"><span class="hljs-string">'5px'</span></span>) cat_map.layout=Layout(flex=<span class="hljs-string"><span class="hljs-string">'1 1'</span></span>, padding=<span class="hljs-string"><span class="hljs-string">'5px'</span></span>) heat_map.layout=Layout(flex=<span class="hljs-string"><span class="hljs-string">'1 1'</span></span>, padding=<span class="hljs-string"><span class="hljs-string">'5px'</span></span>) box = HBox([just_map, cat_map, heat_map]) box.height = <span class="hljs-string"><span class="hljs-string">'300px'</span></span> box</code> </pre> <br><img src="https://habrastorage.org/files/a50/4ad/8b3/a504ad8b320b4061ada91791b9c2fd75.PNG"><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  So, you‚Äôve learned how easy it is to use high-grade web maps in Jupyter Notebook using the ArcGIS API for Python.  This is a new product, barely out of beta, but already quite interesting, with great prospects.  With questions on work and suggestions for improving the API, you can either comment in the article or write to the Russian representative of Esri in Russia - esri-cis.ru. </p><br><p>  The materials of this article are posted on GitHub ( <a href="https://github.com/fall-out-bug/arcgis_python">https://github.com/fall-out-bug/arcgis_python</a> ).  Esri's library code and extensive material can also be found on GitHub ( <a href="https://github.com/Esri/arcgis-python-api">https://github.com/Esri/arcgis-python-api</a> ) </p><br><p>  <strong>Happy mapping!</strong> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/324124/">https://habr.com/ru/post/324124/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../324114/index.html">PVS-Studio: search for security defects</a></li>
<li><a href="../324116/index.html">FSE coding</a></li>
<li><a href="../324118/index.html">Difficulties in creating an isometric game in Unity</a></li>
<li><a href="../324120/index.html">Search for ski slopes from space</a></li>
<li><a href="../324122/index.html">Dark path</a></li>
<li><a href="../324126/index.html">Logo is clothing</a></li>
<li><a href="../324128/index.html">Configure SSL VPN on the Cisco Router</a></li>
<li><a href="../324130/index.html">Criminal Code of the developer</a></li>
<li><a href="../324132/index.html">What to do if you are locked in rbash</a></li>
<li><a href="../324136/index.html">Splunk. Introduction to machine data analysis - part 1. Examples of SPL queries and log visualization</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>