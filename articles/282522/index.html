<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Monte Carlo method for tree search</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The Monte Carlo method is a decision-making algorithm often used in games as the basis of artificial intelligence. He had a strong influence on the pr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Monte Carlo method for tree search</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/6f6/095/ca2/6f6095ca2a5a4b69b97155a325f90351.jpg"><br><br>  The Monte Carlo method is a decision-making algorithm often used in games as the basis of artificial intelligence.  He had a strong influence on the programs for the game of Go, although it finds its application in other games, both desktop and conventional computer games (for example, <a href="http://aigamedev.com/open/coverage/mcts-rome-ii/">Total War: Rome II</a> ).  It is also worth noting that the Monte Carlo method is used in the acclaimed AlphaGo program, which won the 9th Dan go-professional in a series of 5 games. <br><br>  In this article I would like to tell you about the version of the Monte Carlo algorithm called Upper Confidence bound applied to Trees (UCT).  It was after the publication of this algorithm in 2006 that the programs for the game of go greatly strengthened their positions and achieved significant success in the game against a person. <br><a name="habracut"></a><br>  The basis of the UCT algorithm is the solution of the problem of multi-armed bandits.  In particular, the Upper Confidence Bound (UCB) algorithm is used.  He has already been described on Habr√© <a href="https://habrahabr.ru/company/surfingbird/blog/168611/">here</a> , but I still repeat the main points. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The task is: there is a set of slot machines, each with its own probability of winning.  It is required to determine the automaton that will bring more winnings. <br><br>  UCB Algorithm: <br>  1. Initialization.  Play on each machine once <br>  2. At each subsequent iteration, select the machine with the maximum value <img src="https://habrastorage.org/files/32b/14d/c7e/32b14dc7ef6646c4b21232219976ecc3.png">  <i>where</i> <i><img src="https://habrastorage.org/files/1bb/25c/a6f/1bb25ca6fbbd491ea1ec25d5e0da5413.png"></i>  <i>This is the average winnings of the i-th machine,</i> <i><img src="https://habrastorage.org/files/cf2/916/daa/cf2916daae934164b5137aa5d59eeddd.png"></i>  <i>number of games on all machines, and</i> <i><img src="https://habrastorage.org/files/413/6fb/1c3/4136fb1c3f6c47ec91413cf8f9dc30fa.png"></i>  <i>the number of games played on the i-th machine.</i> <br><br>  In practice, a modification of the UCB formula is often used to search the board game's move tree. <br><br>  For example, this: <img src="https://habrastorage.org/files/f99/904/a9a/f99904a9a1114879badf0992eb0d339b.png">  , <br><br>  <i>here</i> <i><img src="https://habrastorage.org/files/14a/a58/38d/14aa5838d2b9494882173e6da0a94796.png"></i>  <i>this is the number of wins of the i-th node.</i> <i><img src="https://habrastorage.org/files/413/6fb/1c3/4136fb1c3f6c47ec91413cf8f9dc30fa.png"></i>  <i>- the number of visits to the i-th node, and</i> <i><img src="https://habrastorage.org/files/cf2/916/daa/cf2916daae934164b5137aa5d59eeddd.png"></i>  <i>the number of visits to all adjacent nodes.</i>  <i><i>c</i> is a constant used to set the desired balance between the width and depth of the search.</i>  <i>The larger it is, the deeper the search will be.</i> <br><br>  As the name implies, the UCT algorithm (Upper Confidence bound applied to Trees) uses the UCB approach to search the tree.  Consider step by step each phase of the algorithm: <br><br><img src="https://habrastorage.org/files/845/732/8d8/8457328d86ed4c7290e5acb7584acec7.png"><br>  <i>The first phase, the <b>choice</b> .</i>  <i>We consider each position as a task of a multi-armed gangster.</i>  <i>Nodes at each stage are selected according to the UCB algorithm.</i>  <i>This phase is valid until a node is found in which not all subsidiaries have victory statistics.</i>  <i>In the figure, the first value in a node is the number of wins, the second total number of games in this node.</i> <br><br><img src="https://habrastorage.org/files/fe1/040/ad2/fe1040ad20844976a1b0faa0f1585d22.png"><br>  <i>Second phase <b>expansion</b> .</i>  <i>When the UCB algorithm can no longer be applicable, a new child node is added.</i> <br><br><img src="https://habrastorage.org/files/ee0/126/16d/ee012616dca84a56ab3d8e48bd911114.png"><br>  <i>The third phase, <b>simulation</b> .</i>  <i>From the node created at the previous stage, the game starts with random or, in the case of heuristics, not entirely random moves.</i>  <i>The game goes to the end of the game.</i>  <i>Here only the information about the winner is important, the position evaluation does not matter.</i> <br><br><img src="https://habrastorage.org/files/6c1/073/8ae/6c10738ae8b74c0f9cc3190d60a96ed9.png"><br>  <i>The fourth phase, the <b>reverse spread</b> .</i>  <i>At this stage, information about the game played is distributed up the tree, updating the information in each of the previously passed nodes.</i>  <i>Each of these nodes increases the number of games, and the nodes that match the winner also increase the number of wins.</i>  <i>At the end of the algorithm, the node visited the most times is selected</i> . <br><br>  UCT does not always choose only the best move, but also periodically examines less successful nodes.  The second parameter of the formula is slowly growing for those sites that are visited less frequently.  And in the end, at some stage, the algorithm will choose just such a move as the preferred one.  If the move meets expectations, it will be more likely to be selected next time. <br><br>  Compared with other algorithms for finding optimal moves, UCT has the following advantages: <br><br><ul><li>  UCT can be safely stopped at any stage of work.  And at the time of stopping, he will calculate evenly all the moves from the root node <br><img src="https://habrastorage.org/files/cea/885/fcd/cea885fcd2d5406da3f6e2a4fbdf2658.png"><br>  <i>An example of stopping the alpha beta algorithm.</i>  <i>It can be seen that the nodes with the ‚Äú?‚Äù Sign have not been investigated.</i> <br></li><li>  The tree grows asymmetrically, exploring the preferred moves deeper than the others.  Thus, greater efficiency is achieved in comparison with other algorithms in games with a significant number of options for enumeration. <br></li></ul><br><br>  Since  Since the moves chosen randomly are mostly meaningless and do not have a general direction, various heuristic methods based on information about a particular game are used to improve the performance of the algorithm.  One of these methods is the use of templates. <br><br>  Here is an example of a 3x3 pattern for cutting stones in Go: <br><img src="https://habrastorage.org/files/78b/d27/556/78bd27556aae441c8faa1d8cc0ad049b.jpg"><br>  <i>The move will be regarded as interesting when the first pattern matches, but the second and third ones do not.</i>  <i>That is, the white group can be "cut."</i>  <i>The square shows the position of interest to us.</i> <br><br>  Templates can be used both at the stage of selecting a move in the tree, and at the stage of simulation.  Often, such patterns are searched somewhere in the vicinity of the last move made.  This is done because the current move is not rarely a response to the previous one and is likely to be made somewhere nearby. <br><br>  An example from the series before and after.  On the left, the game situation with the use of the usual UCT, on the right UCT with the use of templates: <br><img src="https://habrastorage.org/files/4e0/611/c7c/4e0611c7c8e24f8db79ecaf3c3d6a85c.jpg"><br>  <i>It can be seen that in the first picture the stones are arranged haphazardly across the board.</i> <br><br>  In most cases, templates are written by hand, but there are also <a href="https://pdfs.semanticscholar.org/285c/d356a977ab4ccacdc75746086b84b9c02aa0.pdf">examples of</a> automatic generation. <br><br>  In order not to be sprayed on the whole board and not to waste time on the miscalculation of unnecessary options.  One can single out the most important area in which one can already explore the moves.  Obviously, if at the moment the whole struggle is concentrated around one group in a certain corner of the board, then it does not make sense to consider the empty areas around.  Algorithms for determining such areas are beyond the scope of the article, but those who are interested can read in detail here: <a href="http://www.cs.cmu.edu/afs/cs/user/mjs/ftp/thesis-program/2008/abstracts/lowEA.pdf">Common Fate Graph</a> . <br><br>  The UCT algorithm can be simultaneously run in multiple threads.  Here are some ways to parallelize calculations: <br><ul><li>  Parallelization of nodes, simultaneous simulation of games from the same node. </li><li>  Parallelization of the root, building independent trees. </li><li>  Parallelization of a tree, joint construction of a single tree by several threads. </li></ul><br><br>  This is probably all that I would like to say about the Monte Carlo algorithm and in particular the UCT.  In general, the algorithm with additional modifications shows good game results.  In favor of this statement says, that all modern Go-programs use it.  I hope that for some of you it will also be useful. <br><br><cut></cut></div><p>Source: <a href="https://habr.com/ru/post/282522/">https://habr.com/ru/post/282522/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../282511/index.html">All that wanted</a></li>
<li><a href="../282513/index.html">Microsoft Research Summer School 2016 in Kazan - Internet of Things</a></li>
<li><a href="../282517/index.html">Perfect HTTP performance</a></li>
<li><a href="../282518/index.html">How to choose a server for a small company: a guide for doubters</a></li>
<li><a href="../282520/index.html">Lightning Talk: Get your five minutes on PHDays VI</a></li>
<li><a href="../282524/index.html">Message system or ‚Äúsoft coupling‚Äù between components for Unity3D</a></li>
<li><a href="../282528/index.html">Multiphone in FreePBX: full connection automation</a></li>
<li><a href="../282530/index.html">Certified FSTEK version of Veeam Backup and Replication: backing up confidential information</a></li>
<li><a href="../282532/index.html">We are looking for free IPv4 in BGP full-view</a></li>
<li><a href="../282534/index.html">Yandex Font - Yandex Sans</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>