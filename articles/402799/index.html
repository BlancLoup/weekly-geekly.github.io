<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Noolite MTRF-32 + Arduino + Domoticz</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, I describe the connection of the Noolite MTRF-32 module to my Domoticz-based smart home control system. 

 A little about the house i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Noolite MTRF-32 + Arduino + Domoticz</h1><div class="post__text post__text-html js-mediator-article">  In this article, I describe the connection of the Noolite MTRF-32 module to my Domoticz-based smart home control system. <br><a name="habracut"></a><br><h3>  A little about the house itself </h3><br>  My house is private.  It has already introduced some of the rudiments of a smart home based on Domoticz and wireless actuators on MySensors. <br><br>  At the moment, sensors for opening doors, switching on house lighting, temperature and humidity sensors at home and on the street, voice information about events and weather forecasts are implemented. <br><br>  The house is wooden, so I did not really want to control the lighting by closing the relyushki from China.  Pull the wires anywhere, too, is not an option.  After much deliberation, the light control was done on noolite power units and consoles and it remained to somehow make friends with Domoticz. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      At that moment, <a href="https://geektimes.ru/post/281962/">an article</a> about the Noolite MTRF-32 module came across.  Domoticz supports sending HTTP GET requests.  The prospect of using modules with feedback is also beckoning, so the module was ordered. <br><br><h3>  The fact that you need to measure 7 times before cutting </h3><br>  As it turned out, I bought is not exactly what you need.  At the time of purchase was available one module MTRF-32.  And reading the article, I did not see information about the varieties of these modules.  In general, I needed a USB version of the MTRF-32-USB. <br><br><div class="spoiler">  <b class="spoiler_title">Should clarify</b> <div class="spoiler_text">  32 means control over 32 channels.  To date, a module with 64 channels is available on the noolite website, both options with or without USB.  Question to the readers of the MTRF-32 somehow you can upgrade to the MTRF-64? <br></div></div><br>  What is done is done.  The shawl was postponed until <s>someone</s> laid <s>out a ready-made library of</s> better times. <br><br>  For some reason, the best times have not come.  Although I thought that the system is popular. <br><br><h3>  First try </h3><br>  After walking around the site Noolite found NooliteOne software to work with the MTRF-64-USB.  It turned out that it works through the com-port and I realized that the MTRF-64 is different from the MTRF-64-USB by the built-in USB-COM adapter.  Included with the software were the drivers from the FTDI chip, and on my board was a contact suitable contact pad. <br><br>  I did not solder the chip.  But I made a Chinese Arduino Nano with an FTDI USB-COM adapter and connected it to the board. <br><br>  Did not take off.  For some reason, NooliteOne did not find my adapter.  I already started looking towards decompilation when I discovered the <a href="https://github.com/zhum/ardunoo">library</a> for the MT1132 module. <br><br><h3>  Second try </h3><br>  I compared the description of the modules and realized that in terms of data transfer, they almost do not differ.  The functionality implemented in the library for MT1132 was sufficient for me (I don‚Äôt need feedback yet - there are no suitable power units). <br><br>  Having corrected the code in the library, I began to receive answers from the MTRF-32.  Oddly enough, it all worked the first time.  And that's what happened: <br><br><div class="spoiler">  <b class="spoiler_title">Ardunoo.H</b> <div class="spoiler_text"><pre><code class="javascript hljs"> </code> </pre> <br>  #ifndef ARDUNOO_H <br>  #define ARDUNOO_H <br><br>  #if defined (ARDUINO) &amp;&amp; ARDUINO&gt; = 100 <br>  #include "Arduino.h" <br>  #else <br>  #include "WProgram.h" <br>  #endif <br><br>  #include &lt;SoftwareSerial.h&gt; <br><br>  class ArduNoo { <br><br>  byte chnl; <br>  SoftwareSerial ns; <br><br>  public: <br>  ArduNoo (byte rx, byte tx, byte ch = 0); <br>  void on (byte ch = -1); <br>  void off (byte ch = -1); <br>  void onoff (byte ch = -1); <br>  void bind (byte ch = -1); <br>  void unbind (byte ch = -1); <br><br>  bool command (byte channel, byte command); <br>  }; <br><br>  #endif <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Ardunoo.cpp</b> <div class="spoiler_text">  #include &lt;ardunoo.h&gt; <br><br>  ArduNoo :: ArduNoo (byte rx, byte tx, byte ch): ns (rx, tx) { <br>  chnl = ch; <br>  ns.begin (9600); <br>  } <br><br>  void ArduNoo :: off (byte ch) { <br>  command (ch, 0); <br>  } <br><br>  void ArduNoo :: on (byte ch) { <br>  command (ch, 2); <br>  } <br><br>  void ArduNoo :: onoff (byte ch) { <br>  command (ch, 4); <br>  } <br><br>  void ArduNoo :: unbind (byte ch) { <br>  command (ch, 9); <br>  } <br><br>  void ArduNoo :: bind (byte ch) { <br>  command (ch, 15); <br>  } <br><br>  bool ArduNoo :: command (byte chnl, byte command) { <br>  static byte i, r, buf [17] = {171,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,172}; <br>  int sum = 0; <br><br>  memset (buf + 2.0,14);  / * clear message body * / <br>  buf [4] = chnl; <br>  buf [5] = command; <br><br>  for (i = 0; i &lt;15; ++ i) {// 10 <br>  sum + = buf [i]; <br>  } <br>  buf [15] = lowByte (sum); // 10 <br>  buf [16] = 172; // 11 <br><br>  for (i = 0; i &lt;17; ++ i) { <br>  ns.write (buf [i]); <br>  } <br>  // debug code <br>  for (i = 0; i &lt;17; ++ i) { <br>  while (! ns.available ()) delay (10); <br>  r = ns.read (); <br>  Serial.print¬Æ; <br>  } <br>  Serial.println (); <br><br>  return true; <br>  } <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Ardunoo.ino</b> <div class="spoiler_text">  #include &lt;SoftwareSerial.h&gt; <br>  #include &lt;ardunoo.h&gt; <br><br>  #define RXpin 10 <br>  #define TXpin 11 <br><br>  ArduNoo noo (RXpin, TXpin); <br>  String readString, chString; <br><br>  void setup () { <br>  Serial.begin (9600); <br>  } <br><br>  void loop () { <br>  readString = ""; <br>  chString = ""; <br>  while (Serial.available ()) { <br>  delay (3);  // delay <br>  if (Serial.available ()&gt; 0) { <br>  char c = Serial.read ();  // gets one byte from serial buffer <br>  readString + = c;  // makes the string readString <br>  } <br>  } <br>  if (readString.length ()&gt; 1 &amp;&amp; readString.length () &lt;4) {// we expect 1 letter and 1 or 2 digits (ch = 0-31) <br>  for (int i = 1; i &lt;readString.length (); i ++) { <br>  if (isDigit (readString [i])) { <br>  chString.concat (readString [i]); <br>  } <br>  } <br>  //Serial.println(readString[0]); <br>  int ch = chString.toInt (); <br>  switch (readString [0]) { <br>  case 'n': // on <br>  noo.on (ch); <br>  break; <br>  case 'f': // off <br>  noo.off (ch); <br>  break; <br>  case 'x': // toggle <br>  noo.onoff (ch); <br>  break; <br>  case 'b': // bind <br>  noo.bind (ch); <br>  break; <br>  case 'u': // unbind <br>  noo.unbind (ch); <br>  break; <br>  case 'y': // on all channels <br>  for (int i = 0; i &lt;32; i ++) { <br>  noo.on (i); <br>  delay (100); <br>  } <br>  break; <br>  case 'z': // off all channels <br>  for (int i = 0; i &lt;32; i ++) { <br>  noo.off (i); <br>  delay (100); <br>  } <br>  break; <br>  } <br>  } <br>  } <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Library license from Zhumatiy Sergey</b> <div class="spoiler_text">  The MIT License (MIT) <br><br>  Copyright ¬© 2014 Zhumatiy Sergey <br><br>  Permission is hereby granted <br>  associated software files (the ‚ÄúSoftware‚Äù), to deal <br>  in the Software without restriction, including without limitation the rights <br>  to use, copy, modify, merge, publish, distribute, sublicense, and / or sell <br>  Software is copyrighted <br>  furnished to do so, subject to the following conditions: <br><br>  This is a copyright notice. <br>  copies or substantial portions of the Software. <br><br>  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR <br>  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, <br>  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE <br>  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER <br>  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, <br>  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE <br>  SOFTWARE. <br></div></div><br>  Implemented commands to turn off, turn on, switch, turn on everything, turn off everything. <br><br>  Things are easy, you need to give the command port to com.  Since it is problematic from Domoticz to Windows, I decided to write a console application that will broadcast commands from the lua script.  Commands are passed to the application as launch parameters. <br><br><div class="spoiler">  <b class="spoiler_title">noo.cs</b> <div class="spoiler_text">  using System; <br>  using System.Collections.Generic; <br>  using System.Linq; <br>  using System.Text; <br>  using System.IO.Ports; <br><br>  namespace noo <br>  { <br>  class program <br>  { <br>  static void Main (string [] args) <br>  { <br>  if (args.Length == 2) <br>  { <br>  SerialPort COM = new SerialPort (args [0]); <br>  COM.Open (); <br>  COM.WriteLine (args [1]); <br>  COM.Close (); <br>  } <br>  } <br>  } <br>  } <br></div></div><br><h3>  Command example: </h3><br>  noo.exe com5 n4 - turn on the light on channel 4, transmitted to the Arduino board on the COM5 port.  Possible values ‚Äã‚Äãfor the second launch parameter: <br><br><ul><li>  nX - enable channel X </li><li>  fX - turn off channel X </li><li>  xX - switch channel X </li><li>  bX - tie power block to channel X </li><li>  uX - untie the power unit from channel X </li><li>  yX - enable all channels, X any value </li><li>  zX - turn off all channels, X any value </li></ul><br><div class="spoiler">  <b class="spoiler_title">lua script</b> <div class="spoiler_text">  local sensor1 = 'SWHallWay' <br>  local sensor2 = 'SWHall' <br>  local sensor3 = 'SWKitchen' <br>  local sensor4 = 'SWBedroom' <br>  local sensor5 = 'BTNLiteOff' <br>  commandArray = {} <br>  if (devicechanged [sensor1] == 'On') then <br>  os.execute ("c: \\ PROGRA ~ 1 \\ Domoticz \\ scripts \\ noo.exe com4 n3") <br>  end <br>  if (devicechanged [sensor1] == 'Off') then <br>  os.execute ("c: \\ PROGRA ~ 1 \\ Domoticz \\ scripts \\ noo.exe com4 f3") <br>  end <br>  if (devicechanged [sensor2] == 'On') then <br>  os.execute ("c: \\ PROGRA ~ 1 \ Domoticz \\ scripts \\ noo.exe com4 n0") <br>  end <br>  if (devicechanged [sensor2] == 'Off') then <br>  os.execute ("c: \\ PROGRA ~ 1 \ Domoticz \\ scripts \\ noo.exe com4 f0") <br>  end <br>  if (devicechanged [sensor3] == 'On') then <br>  os.execute ("c: \\ PROGRA ~ 1 \\ Domoticz \\ scripts \\ noo.exe com4 n1") <br>  end <br>  if (devicechanged [sensor3] == 'Off') then <br>  os.execute ("c: \\ PROGRA ~ 1 \\ Domoticz \\ scripts \\ noo.exe com4 f1") <br>  end <br>  if (devicechanged [sensor4] == 'On') then <br>  os.execute ("c: \\ PROGRA ~ 1 \ Domoticz \\ scripts \\ noo.exe com4 n2") <br>  end <br>  if (devicechanged [sensor4] == 'Off') then <br>  os.execute ("c: \\ PROGRA ~ 1 \\ Domoticz \\ scripts \\ noo.exe com4 f2") <br>  end <br>  if (devicechanged [sensor5] == 'Off') then <br>  os.execute ("c: \\ PROGRA ~ 1 \\ Domoticz \\ scripts \\ noo.exe com4 z9") <br>  end <br>  return commandArray <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Ground floor plan in Domoticz</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/9b9/300/3b5/9b93003b5232474da997a3bf950765b1.PNG"><br></div></div><br>  Short <a href="https://youtu.be/M1AZG00RTbA">video</a> </div><p>Source: <a href="https://habr.com/ru/post/402799/">https://habr.com/ru/post/402799/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../402785/index.html">Saving games on the Nintendo Switch can be lost at any time: there is no backup</a></li>
<li><a href="../402791/index.html">Critical vulnerability in Xfce, which could lead to the failure of the monitor, has not yet been fixed</a></li>
<li><a href="../402793/index.html">Thermoacoustic engine - Stirling engine without pistons</a></li>
<li><a href="../402795/index.html">What is antibiotics</a></li>
<li><a href="../402797/index.html">In Norway, fish parasites are fought with underwater laser robots</a></li>
<li><a href="../402803/index.html">The term "artificial intelligence" has lost all meaning</a></li>
<li><a href="../402807/index.html">Electron microscope in the garage. High voltage</a></li>
<li><a href="../402809/index.html">Smartphones may be to blame for the increase in the number of accidents involving pedestrians</a></li>
<li><a href="../402811/index.html">RuTracker is blocked, but the number of downloaded torrents has not changed</a></li>
<li><a href="../402813/index.html">Flea Market Gadgets: Toshiba Camileo P10 Camcorder</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>