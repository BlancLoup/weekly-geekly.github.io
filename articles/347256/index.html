<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Making games in Python 3 and Pygame: Part 3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="(The remaining parts of the tutorial: first , second , fourth , fifth .) 

 This is the third of the five parts of the game creation tutorial using Py...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Making games in Python 3 and Pygame: Part 3</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/e38/895/a15/e38895a159ff5bbd8da2f1040b61d219.gif" alt="image"><br>  (The remaining parts of the tutorial: <a href="https://habrahabr.ru/post/347138/">first</a> , <a href="https://habrahabr.ru/post/347170/">second</a> , <a href="https://habrahabr.ru/post/347266/">fourth</a> , <a href="https://habrahabr.ru/post/347286/">fifth</a> .) <br><br>  This is the third of the five parts of the game creation tutorial using Python 3 and Pygame.  In the second part, we looked at the <code>TextObject</code> class, which is used to render text to the screen, created the main window, and learned how to draw objects: bricks, a ball, and a racket. <br><br>  In this part, we dive deeper into the heart of Breakout and learn how to handle events, get to know the main Breakout class, and see how to move various objects in the game. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Event handling </h2><br>  Breakout has three types of events: keystroke events, mouse events, and timer events.  The main loop in the Game class handles keystrokes and mouse events and passes them to subscribers (by calling a handler function). <br><br>  Although the Game class is very general and does not have knowledge of the Breakout implementation, the subscription itself and event handling methods are very specific. <br><a name="habracut"></a><br><h3>  Breakout class </h3><br>  The Breakout class implements the majority of knowledge about how the game is controlled Breakout.  In this series of tutorials, we will meet the Breakout class several times.  Here are the lines that register various event handlers. <br><br>  It should be noted that <em>all</em> key events (for both the left and right arrows) are transmitted to the same racket handler method. <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#   handle_mouse_event()   self.mouse_handlers.append(b.handle_mouse_event) #   handle()      self.keydown_handlers[pygame.K_LEFT].append(paddle.handle) self.keydown_handlers[pygame.K_RIGHT].append(paddle.handle) self.keyup_handlers[pygame.K_LEFT].append(paddle.handle) self.keyup_handlers[pygame.K_RIGHT].append(paddle.handle)</span></span></code> </pre> <br><h3>  Keystroke processing </h3><br>  The Game class calls registered handlers for each key event and passes the key.  Note that this is not a Paddle class.  In Breakout, the only object that is interested in such events is the racket.  When a key is pressed or released, its <code>handle()</code> method is called.  The Paddle object does not need to know whether it was a key press or key release event, because it controls the current state with a pair of boolean variables: <code>moving_left</code> and <code>moving_right</code> .  If <code>moving_left</code> is True, then the left key was pressed, and the next event will be the release of the key, which will reset the variable.  The same applies to the "right" key.  The logic is simple and consists in switching the state of these variables in response to any event. <br><br><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, key)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> key == pygame.K_LEFT: self.moving_left = <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.moving_left <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: self.moving_right = <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.moving_right</code> </pre> <br><h3>  Handling Mouse Events </h3><br>  Breakout has a game menu that we will meet soon.  The menu button controls various mouse events, such as movement and button presses (mouse down and mouse up events).  In response to these events, the button updates the internal state variable.  Here is the mouse handling code: <br><br><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle_mouse_event</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, type, pos)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> type == pygame.MOUSEMOTION: self.handle_mouse_move(pos) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> type == pygame.MOUSEBUTTONDOWN: self.handle_mouse_down(pos) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> type == pygame.MOUSEBUTTONUP: self.handle_mouse_up(pos) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle_mouse_move</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, pos)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.bounds.collidepoint(pos): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.state != <span class="hljs-string"><span class="hljs-string">'pressed'</span></span>: self.state = <span class="hljs-string"><span class="hljs-string">'hover'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: self.state = <span class="hljs-string"><span class="hljs-string">'normal'</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle_mouse_down</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, pos)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.bounds.collidepoint(pos): self.state = <span class="hljs-string"><span class="hljs-string">'pressed'</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle_mouse_up</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, pos)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.state == <span class="hljs-string"><span class="hljs-string">'pressed'</span></span>: self.on_click(self) self.state = <span class="hljs-string"><span class="hljs-string">'hover'</span></span></code> </pre> <br>  Notice that the <code>handle_mouse_event()</code> method, registered to receive mouse events, checks the type of the event and forwards it to the appropriate method that handles this type of event. <br><br><h3>  Timer event handling </h3><br>  Timer events are not processed in the main loop.  However, since the main loop is called every frame, it is easy to check whether the time for a particular event has arrived.  You will see this later when we discuss the temporary special effects. <br><br>  Another situation is the need to pause the game.  For example, when displaying a message that a player must read and so that nothing distracts him.  The <code>show_message()</code> method of the Breakout class uses this approach and calls <code>time.sleep()</code> .  Here is the corresponding code: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> config <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> c <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Breakout</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Game)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">show_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, text, color=colors.WHITE, font_name=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'Arial'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, font_size=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">20</span></span></span></span><span class="hljs-function"><span class="hljs-params">, centralized=False)</span></span></span><span class="hljs-function">:</span></span> message = TextObject(c.screen_width // <span class="hljs-number"><span class="hljs-number">2</span></span>, c.screen_height // <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span>: text, color, font_name, font_size) self.draw() message.draw(self.surface, centralized) pygame.display.update() time.sleep(c.message_duration)</code> </pre> <br><h2>  Game process </h2><br>  Gameplay (gameplay) is the place in which Breakout rules come into play.  The gameplay consists of moving various objects in response to events and changing the state of the game based on their interactions. <br><br><h3>  Move the racket </h3><br>  You saw earlier that the Paddle class responds to keystrokes with arrows, updating its <code>moving_left</code> and <code>moving_right</code> .  The movement itself takes place in the <code>update()</code> method.  Certain calculations are performed here if the racket is close to the left or right edge of the screen.  We do not want the racket to go beyond the screen (taking into account the specified offset). <br><br>  Therefore, if the movement moves the object beyond the boundaries, then the code adjusts the movement so that it stops right at the border.  Since the racket moves only horizontally, the vertical component of the movement is always zero. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pygame <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> config <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> game_object <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> GameObject <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Paddle</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(GameObject)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, w, h, color, offset)</span></span></span><span class="hljs-function">:</span></span> GameObject.__init__(self, x, y, w, h) self.color = color self.offset = offset self.moving_left = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> self.moving_right = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.moving_left: dx = -(min(self.offset, self.left)) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> self.moving_right: dx = min(self.offset, c.screen_width - self.right) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.move(dx, <span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br><h3>  Move the ball </h3><br>  The ball simply uses the functionality of the base class <code>GameObject</code> , which moves objects based on their speed (its horizontal and vertical components).  As we will see soon, the speed of the ball is determined by many factors in the Breakout class.  Since the movement is simply to add speed to the current position, the direction in which the ball moves is completely determined by the speed along the horizontal and vertical axes. <br><br><h3>  Set the initial speed of the ball </h3><br>  The ball in Breakout arises from nowhere at the very beginning of the game every time a player loses a life.  It simply materializes from the ether and begins to fall either straight down or at a slight angle.  When the ball is created in the <code>create_ball()</code> method, it receives a speed with a random horizontal component in the interval from -2 to 2 and a vertical component specified in the config.py module (the default value is 3). <br><br><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create_ball</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> speed = (random.randint(<span class="hljs-number"><span class="hljs-number">-2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>), c.ball_speed) self.ball = Ball(c.screen_width // <span class="hljs-number"><span class="hljs-number">2</span></span>, c.screen_height // <span class="hljs-number"><span class="hljs-number">2</span></span>, c.ball_radius, c.ball_color, speed) self.objects.append(self.ball)</code> </pre> <br><h2>  Summarize </h2><br>  In this section, we looked at handling events like keystrokes, mouse movement, and mouse clicks.  We also studied some elements of the Breakout gameplay: moving the racket, moving the ball and controlling the speed of the ball. <br><br>  In the fourth part, we will look at the important topic of collision recognition and see what happens when the ball hits different game objects: racket, bricks, walls, ceiling and floor.  Then we will pay attention to the game menu.  We will create our own buttons that we use as a menu and will be able to show and hide if necessary. </div><p>Source: <a href="https://habr.com/ru/post/347256/">https://habr.com/ru/post/347256/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../347244/index.html">What engineers read GridGain. Books for those interested in In-Memory Computing</a></li>
<li><a href="../347246/index.html">An honest approach to managing people, or why I never do counteroffers</a></li>
<li><a href="../347250/index.html">Is javascript a solution to an asynchronous problem?</a></li>
<li><a href="../347252/index.html">How neural networks help in e-learning</a></li>
<li><a href="../347254/index.html">Understanding Meltdown and Specter: What you need to know about new vulnerabilities found in almost all CPUs</a></li>
<li><a href="../347258/index.html">Why salt HTTP callbacks</a></li>
<li><a href="../347260/index.html">How to find a good marketer?</a></li>
<li><a href="../347262/index.html">Che Burashka and hacking systems selling tickets to Moscow electric trains</a></li>
<li><a href="../347264/index.html">ATM Security: Application Control Application Difficulties</a></li>
<li><a href="../347266/index.html">Making games in Python 3 and Pygame: Part 4</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>