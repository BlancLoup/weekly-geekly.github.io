<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I taught parents to download Turkish TV shows with one click.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day! 
 Many of us have parents who are not very friendly with technology, and we have to be friends for them. My family is watching the entire se...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How I taught parents to download Turkish TV shows with one click.</h1><div class="post__text post__text-html js-mediator-article">  Good day! <br>  Many of us have parents who are not very friendly with technology, and we have to be friends for them.  My family is watching the entire series ‚ÄúThe <a href="http://ru.wikipedia.org/wiki/%25D0%2592%25D0%25B5%25D0%25BB%25D0%25B8%25D0%25BA%25D0%25BE%25D0%25BB%25D0%25B5%25D0%25BF%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25B2%25D0%25B5%25D0%25BA">Magnificent Age</a> ‚Äù, the series of which are released once a week.  It seems not so often, but Saturday after Saturday to hear ‚ÄúGo check if there is a series‚Äù, it became tiresome to search for distribution, launch a torrent, and so on, and I decided to shift it to the digital shoulders of the fourth .NetFramework. <br>  What we need: <br>  - <a href="http://www.microsoft.com/visualstudio/rus">Visual Studio 2010</a> or higher <br>  - Console torrent client <a href="http://aria2.sourceforge.net/manual/ru/html/aria2c.html">Aria2c</a> . <br><a name="habracut"></a><br>  Be careful, there is a Hindu code in some places!  I warned. <br><br>  The task in front of me was this: the application starts, downloads the torrent and feeds it to the console torrent client, which downloads the series to a USB flash drive (the USB flash drive is inserted into the TV). <br><br>  First we need to understand what series we want to download.  The series comes out in Turkey on Wednesdays, with our translation on Saturday-Sunday.  The other day came the 96 series.  Now the calendar is 18 week.  This means that 78 should be added to the current week number if the program is launched on a weekday, and 79 if it is launched on a weekend. <br>  It will look like this: <br><pre><code class="cs hljs">DateTimeFormatInfo dfi = DateTimeFormatInfo.CurrentInfo; DateTime date1 = DateTime.Now; Calendar cal = dfi.Calendar; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> week = cal.GetWeekOfYear(date1, dfi.CalendarWeekRule, dfi.FirstDayOfWeek); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> day = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)cal.GetDayOfWeek(date1) == <span class="hljs-number"><span class="hljs-number">0</span></span> ? <span class="hljs-number"><span class="hljs-number">6</span></span> : (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)cal.GetDayOfWeek(date1) - <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     ,   GetDayOfWeek  0  ,     . GetWeekOfYear    ,     var epnumber = week + 79 - ((day &lt; 5) ? 1 : 0);</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Now that we know the series number, we can go to the tracker. <br>  First you need to log in, for this we create a POST request for the login.php page, and give it a login / password pair. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] buffer = Encoding.ASCII.GetBytes(<span class="hljs-string"><span class="hljs-string">"login_username=_&amp;login_password=_&amp;login=%C2%F5%EE%E4"</span></span>); HttpWebRequest WebReq = (HttpWebRequest)WebRequest.Create(<span class="hljs-string"><span class="hljs-string">"http://login.rutracker.org/forum/login.php"</span></span>);<span class="hljs-comment"><span class="hljs-comment">//  Post- var cc = new CookieContainer(); WebReq.CookieContainer = cc;//  WebReq.Method = "POST"; WebReq.ContentType = "application/x-www-form-urlencoded"; WebReq.ContentLength = buffer.Length; HttpWebResponse WebResp; try { Stream PostData = WebReq.GetRequestStream(); PostData.Write(buffer, 0, buffer.Length); PostData.Close(); WebResp = (HttpWebResponse)WebReq.GetResponse(); } catch (Exception e) { MessageBox.Show(" ", " ", MessageBoxButtons.OK, MessageBoxIcon.Error); return; }</span></span></code> </pre><br>  The server, in response, spat at us with an authorization cookie, which is stored in cc.  Now with this cookie you can make a search request for the series: <br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url = <span class="hljs-string"><span class="hljs-string">@"http://rutracker.org/forum/tracker.php?nm=%D0%92%D0%B5%D0%BB%D0%B8%D0%BA%D0%BE%D0%BB%D0%B5%D0%BF%D0%BD%D1%8B%D0%B9%20%D0%B2%D0%B5%D0%BA%20sub%20"</span></span>+epnumber; WebReq = (HttpWebRequest)WebRequest.Create(url); WebReq.CookieContainer = cc; WebReq.Method = <span class="hljs-string"><span class="hljs-string">"GET"</span></span>; WebReq.ContentType = <span class="hljs-string"><span class="hljs-string">"application/x-www-form-urlencoded"</span></span>; WebResp = (HttpWebResponse)WebReq.GetResponse(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> result; Encoding responseEncoding = Encoding.GetEncoding(WebResp.CharacterSet); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (StreamReader sr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamReader(WebResp.GetResponseStream(), responseEncoding)) { result = sr.ReadToEnd(); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { MessageBox.Show(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, MessageBoxButtons.OK, MessageBoxIcon.Error); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; }</code> </pre><br><br>  A search page with parsim for the presence of links to torrent files of the form <a href="http://dl.rutracker.org/forum/dl.php%3F12345">dl.rutracker.org/forum/dl.php?12345</a> : <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> pattern = <span class="hljs-string"><span class="hljs-string">@"http://dl.rutracker.org/forum/dl.php\?t=\d+"</span></span>; Regex regex = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Regex(pattern); Match match = regex.Match(result); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (match.Length == <span class="hljs-number"><span class="hljs-number">0</span></span>) { MessageBox.Show(<span class="hljs-string"><span class="hljs-string">"    !"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, MessageBoxButtons.OK, MessageBoxIcon.Error); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> AutoClosingMessageBox.Show(<span class="hljs-string"><span class="hljs-string">"  !  ."</span></span>, <span class="hljs-string"><span class="hljs-string">"Caption"</span></span>, <span class="hljs-number"><span class="hljs-number">3000</span></span>);</code> </pre><br><br>  Torrent file found, save it to your hard drive: <br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { WebReq = (HttpWebRequest)WebRequest.Create(match.ToString()); WebReq.CookieContainer = cc; WebReq.AllowAutoRedirect = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; WebReq.Method = <span class="hljs-string"><span class="hljs-string">"POST"</span></span>; WebReq.Referer = url; WebReq.ContentType = <span class="hljs-string"><span class="hljs-string">"application/x-www-form-urlencoded"</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> Stream ReceiveStream = WebReq.GetResponse().GetResponseStream(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> filename = <span class="hljs-string"><span class="hljs-string">@"C:\123.torrent"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] buffer1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[<span class="hljs-number"><span class="hljs-number">1024</span></span>]; FileStream outFile = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileStream(filename, FileMode.Create); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> bytesRead; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((bytesRead = ReceiveStream.Read(buffer1, <span class="hljs-number"><span class="hljs-number">0</span></span>, buffer.Length)) != <span class="hljs-number"><span class="hljs-number">0</span></span>) outFile.Write(buffer1, <span class="hljs-number"><span class="hljs-number">0</span></span>, bytesRead); outFile.Close(); ReceiveStream.Close(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { MessageBox.Show(<span class="hljs-string"><span class="hljs-string">"   -!"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, MessageBoxButtons.OK, MessageBoxIcon.Error); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; }</code> </pre><br><br>  Now we check whether hapless relatives have forgotten to insert a flash drive, and whether there is enough space on it: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">string</span></span> letter = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (DriveInfo i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> System.IO.DriveInfo.GetDrives()) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i.DriveType.ToString() == <span class="hljs-string"><span class="hljs-string">"Removable"</span></span> &amp;&amp; i.ToString() != <span class="hljs-string"><span class="hljs-string">"A:\\"</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i.TotalFreeSpace &lt; <span class="hljs-number"><span class="hljs-number">3000000000</span></span>) { MessageBox.Show(<span class="hljs-string"><span class="hljs-string">"   ,  3!"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, MessageBoxButtons.OK, MessageBoxIcon.Error); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } letter = String.Copy(i.ToString()); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//Console.WriteLine(i.DriveType); } catch (Exception E) { return; } } if (letter == "") { MessageBox.Show(" !", "", MessageBoxButtons.OK, MessageBoxIcon.Error); return; }</span></span></code> </pre><br><br>  Finally, everything is ready for the jump, you can proceed! <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> par = <span class="hljs-string"><span class="hljs-string">@"--seed-time=0 -d "</span></span> + letter + <span class="hljs-string"><span class="hljs-string">" --select-file="</span></span>+(epnumber<span class="hljs-number"><span class="hljs-number">-3</span></span>)+ <span class="hljs-string"><span class="hljs-string">@" ""C:\123.torrent"" "</span></span>; <span class="hljs-comment"><span class="hljs-comment">//--seed-time=0 -    ,  .      ,    . //-d -          //--select-file -  ,   .     ,     3. Process P = Process.Start(@"C:\aria2-1.17.0-win-32bit-build1\aria2-1.17.0-win-32bit-build1\aria2c.exe", par); P.WaitForExit(); int result1 = P.ExitCode; Console.WriteLine(result1); if (result1 == 0) { MessageBox.Show(" !   !", "", MessageBoxButtons.OK, MessageBoxIcon.Information); } else { MessageBox.Show(" !", "", MessageBoxButtons.OK, MessageBoxIcon.Exclamation); }</span></span></code> </pre><br><br>  All series downloaded and waiting for viewing. <br>  The full text of the script at <a href="http://pastebin.com/8L03vkJg">http://pastebin.com/8L03vkJg</a> . <br>  Take care of your parents. <br><br>  PS Yes, it is clear that in Per / PHP / Python / ... you can reduce the number of lines several times.  The code is written for the purpose of self-education. </div><p>Source: <a href="https://habr.com/ru/post/178493/">https://habr.com/ru/post/178493/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../178481/index.html">A quick way to create an installer for a Java program</a></li>
<li><a href="../178483/index.html">Is there life in the world of PostPC? Part 3: having fun with iOS</a></li>
<li><a href="../178487/index.html">Game editor for platformer - post-mortem</a></li>
<li><a href="../178489/index.html">Protecting Citrix Web Interface against brute-force attacks with CAPTCHA</a></li>
<li><a href="../178491/index.html">Digest of upcoming IT events for May 2013</a></li>
<li><a href="../178497/index.html">Catalog of tools for developing mobile applications</a></li>
<li><a href="../178499/index.html">The use of car DVRs in Austria is prohibited</a></li>
<li><a href="../178501/index.html">Shodan - the worst Internet search engine</a></li>
<li><a href="../178503/index.html">US universities are starting to use online course materials in mixed classes.</a></li>
<li><a href="../178507/index.html">AWS Multifactor Authentication</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>