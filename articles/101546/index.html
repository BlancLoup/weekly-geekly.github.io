<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Own presentation (view) in Spring MVC</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you worked with Spring MVC, you probably noticed that it supports many different views (view) that allow you to generate pdf, excel, csv using jstl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Own presentation (view) in Spring MVC</h1><div class="post__text post__text-html js-mediator-article">  If you worked with Spring MVC, you probably noticed that it supports many different views (view) that allow you to generate pdf, excel, csv using jstl, freemarker, velocity and jasperReports.  But what if you needed to fill out any document in docx format with a template and transfer it to the user?  On the one hand, you can use access to the standard response in the method, and if you plan to use this generation many times, then put it into a separate class.  But this solution is not very elegant and violates the MVC pattern. <a name="habracut"></a>  To prevent this from happening, you can write your own view.  To do this, you will need to inherit from one of the abstract views (view) for example from AbstractTemplateView.  For docx, this view looks like this: <br><blockquote>  <font color="#000000">package</font> <font color="#006699">ru.habrahabr.spring.view</font> <font color="#339933">;</font> <br><br>  <font color="#000000">import</font> <font color="#006699">org.apache.commons.code.binary.Base64</font> <font color="#339933">;</font> <br>  <font color="#000000">import</font> <font color="#006699">org.docx4j.XmlUtils</font> <font color="#339933">;</font> <br>  <font color="#000000">import</font> <font color="#006699">org.docx4j.openpackaging.io.SaveToZipFile</font> <font color="#339933">;</font> <br>  <font color="#000000">import</font> <font color="#006699">org.docx4j.openpackaging.packages.WordprocessingMLPackage</font> <font color="#339933">;</font> <br>  <font color="#000000">import</font> <font color="#006699">org.docx4j.openpackaging.parts.WordprocessingML.MainDocumentPart</font> <font color="#339933">;</font> <br>  <font color="#000000">import</font> <font color="#006699">org.docx4j.wml.Document</font> <font color="#339933">;</font> <br>  <font color="#000000">import</font> <font color="#006699">org.springframework.web.servlet.view.AbstractTemplateView</font> <font color="#339933">;</font> <br><br>  <font color="#000000">import</font> <font color="#006699">javax.servlet.ServletOutputStream</font> <font color="#339933">;</font> <br>  <font color="#000000">import</font> <font color="#006699">javax.servlet.http.HttpServletRequest</font> <font color="#339933">;</font> <br>  <font color="#000000">import</font> <font color="#006699">javax.servlet.http.HttpServletResponse</font> <font color="#339933">;</font> <br>  <font color="#000000">import</font> <font color="#006699">java.net.URLEncoder</font> <font color="#339933">;</font> <br>  <font color="#000000">import</font> <font color="#006699">java.util.HashMap</font> <font color="#339933">;</font> <br>  <font color="#000000">import</font> <font color="#006699">java.util.Locale</font> <font color="#339933">;</font> <br>  <font color="#000000">import</font> <font color="#006699">java.util.Map</font> <font color="#339933">;</font> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <font color="#000000">public</font> <font color="#000000">class</font> DocxView <font color="#000000">extends</font> AbstractTemplateView <font color="#009900">{</font> <br><br>  <font color="#000000">public</font> DocxView <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  setContentType <font color="#009900">(</font> <font color="#0000ff">"application / vnd.openxmlformats-officedocument.wordprocessingml.document"</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br><br>  @ <font color="#003399">Override</font> <br>  <font color="#000000">protected</font> <font color="#006600">boolean</font> generatesDownloadContent <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#000000">return</font> <font color="#006600">true</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br><br>  @ <font color="#003399">Override</font> <br>  <font color="#000000">protected</font> <font color="#006600">void</font> renderMergedTemplateModel <font color="#009900">(</font> Map <font color="#339933">&lt;</font> String, Object <font color="#339933">&gt;</font> model, <br>  HttpServletRequest request, HttpServletResponse response <font color="#009900">)</font> <font color="#000000">throws</font> <font color="#003399">Exception</font> <font color="#009900">{</font> <br><br>  WordprocessingMLPackage <font color="#006699">wordMLPackage</font> = <br>  WordprocessingMLPackage.  <font color="#006633">load</font> <font color="#009900">(</font> getApplicationContext <font color="#009900">(</font> <font color="#009900">)</font> . <font color="#006633">getResource</font> <font color="#009900">(</font> getUrl <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> . <font color="#006633">getFile</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <br><br>  MainDocumentPart documentPart = wordMLPackage.  <font color="#006633">getMainDocumentPart</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  org.  <font color="#006633">docx4j</font> .  <font color="#006633">wml</font> .  <font color="#003399">Document</font> wmlDocumentEl = <font color="#009900">(</font> org. <font color="#006633">Docx4j</font> . <font color="#006633">Wml</font> . <font color="#003399">Document</font> <font color="#009900">)</font> documentPart.  <font color="#006633">getJaxbElement</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#003399">String</font> xml = XmlUtils.  <font color="#006633">marshaltoString</font> <font color="#009900">(</font> wmlDocumentEl, <font color="#006600">true</font> <font color="#009900">)</font> <font color="#339933">;</font> <br><br>  HashMap <font color="#339933">&lt;</font> String, String <font color="#339933">&gt;</font> mappings = <font color="#000000">new</font> HashMap <font color="#339933">&lt;</font> String, String <font color="#339933">&gt;</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000000">for</font> <font color="#009900">(</font> <font color="#003399">Object</font> key: model. <font color="#006633">keySet</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  mappings  <font color="#006633">put</font> <font color="#009900">(</font> key. <font color="#006633">toString</font> <font color="#009900">(</font> <font color="#009900">)</font> , model. <font color="#006633">get</font> <font color="#009900">(</font> key <font color="#009900">)</font> . <font color="#006633">toString</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br><br>  <font color="#003399">Object</font> obj = XmlUtils.  <font color="#006633">unmarshallFromTemplate</font> <font color="#009900">(</font> xml, mappings <font color="#009900">)</font> <font color="#339933">;</font> <br>  documentPart.  <font color="#006633">setJaxbElement</font> <font color="#009900">(</font> <font color="#009900">(</font> <font color="#003399">Document</font> <font color="#009900">)</font> obj <font color="#009900">)</font> <font color="#339933">;</font> <br><br>  <font color="#003399">String</font> name = model.  <font color="#006633">get</font> <font color="#009900">(</font> <font color="#0000ff">"filename"</font> <font color="#009900">)</font> + <font color="#0000ff">".docx"</font> <font color="#339933">;</font> <br><br>  response.  <font color="#006633">setHeader</font> <font color="#009900">(</font> <font color="#0000ff">"Content-Disposition"</font> , <font color="#0000ff">"attachment"</font> + name <font color="#009900">)</font> <font color="#339933">;</font> <br><br>  ServletOutputStream out = response.  <font color="#006633">getOutputStream</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">(</font> <font color="#000000">new</font> SaveToZipFile <font color="#009900">(</font> wordMLPackage <font color="#009900">)</font> <font color="#009900">)</font> .  <font color="#006633">save</font> <font color="#009900">(</font> out <font color="#009900">)</font> <font color="#339933">;</font> <br><br>  out.  <font color="#006633">flush</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br><br>  <font color="#009900">}</font> <br><br>  <font color="#000000">public</font> <font color="#006600">boolean</font> checkResource <font color="#009900">(</font> <font color="#003399">Locale</font> locale <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#000000">return</font> getApplicationContext <font color="#009900">(</font> <font color="#009900">)</font> .  <font color="#006633">getResource</font> <font color="#009900">(</font> getUrl <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> .  <font color="#006633">exists</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br><br>  <font color="#009900">}</font> <br></blockquote><br>  In the constructor, we set the content type, and in the <b>generatesDownloadContent</b> method, we indicate that the content type is downloadable.  And in <b>renderMergedTemplateModel</b> , we read the file by getting the path to it from <b>getUrl</b> and fill in the document by template.  Reading template data comes from model.  <b>checkResouce is</b> required to check if the view file is present. <br><br>  Now, when the view is ready, you need to configure a chain of view locators (ResolveViewers). To do this, add to mvc-config.xml: <br><blockquote>  <font color="#00007f">&lt;</font> bean id <font color="#00007f">=</font> <font color="#ff0000">"docxViewResolver"</font> <font color="#0000ff">class</font> <font color="#00007f">=</font> <font color="#ff0000">"org.springframework.web.servlet.view.UrlBasedViewResolver"</font> <font color="#00007f">&gt;</font> <br>  <font color="#00007f">&lt;</font> property name <font color="#00007f">=</font> <font color="#ff0000">"viewClass"</font> value <font color="#00007f">=</font> <font color="#ff0000">"ru.habrahabr.spring.view.DocxView"</font> <font color="#00007f">&gt; &lt;/</font> property <font color="#00007f">&gt;</font> <br>  <font color="#00007f">&lt;</font> property name <font color="#00007f">=</font> <font color="#ff0000">"order"</font> value <font color="#00007f">=</font> <font color="#ff0000">"1"</font> <font color="#00007f">/&gt;</font> <br>  <font color="#00007f">&lt;</font> property name <font color="#00007f">=</font> <font color="#ff0000">"prefix"</font> value <font color="#00007f">=</font> <font color="#ff0000">"/ WEB-INF / views /"</font> <font color="#00007f">/&gt;</font> <br>  <font color="#00007f">&lt;</font> property name <font color="#00007f">=</font> <font color="#ff0000">"suffix"</font> value <font color="#00007f">=</font> <font color="#ff0000">".docx"</font> <font color="#00007f">/&gt;</font> <br>  <font color="#00007f">&lt;/</font> bean <font color="#00007f">&gt;</font> <br><br>  <font color="#00007f">&lt;</font> bean id <font color="#00007f">=</font> <font color="#ff0000">"jspViewResolver"</font> <font color="#0000ff">class</font> <font color="#00007f">=</font> <font color="#ff0000">"org.springframework.web.servlet.view.InternalResourceViewResolver"</font> <font color="#00007f">&gt;</font> <br>  <font color="#00007f">&lt;</font> property name <font color="#00007f">=</font> <font color="#ff0000">"prefix"</font> value <font color="#00007f">=</font> <font color="#ff0000">"/ WEB-INF / views /"</font> <font color="#00007f">/&gt;</font> <br>  <font color="#00007f">&lt;</font> property name <font color="#00007f">=</font> <font color="#ff0000">"suffix"</font> value <font color="#00007f">=</font> <font color="#ff0000">".jsp"</font> <font color="#00007f">/&gt;</font> <br>  <font color="#00007f">&lt;/</font> bean <font color="#00007f">&gt;</font> <br></blockquote><br><ul><li>  <b>InternalResourceViewResolver</b> is a standard view locator. </li><li>  <b>UrlBasedViewResolver</b> - url based locator.  As url, view url is implied. </li></ul><br>  On setting up UrlBasedViewResolver worth staying in more detail.  This locator allows you to use any View, including self-written ones, which is indicated via <b>viewClass</b> , then <b>prefix is</b> indicated, <b>suffix</b> is the same as for the standard view locator, <b>order is</b> required to specify the order of processing locators in the chain.  As a result, the <b>UrlBasedViewResolver</b> locator will first be <b>called,</b> which will create a View and call the checkResource () method to check for the presence of the necessary file for the view.  If it is not there, the method will return false, and the locator will return null instead of the view and the chain will go to the <b>InternalResourceViewResolver</b> . <br>  Then you can put the <b>views</b> in the <b>views</b> <b>test.docx</b> file for example in the <b>views / docx</b> directory.  And then in the usual way we create a controller method: <br><blockquote>  <font color="#000000">package</font> <font color="#006699">ru.habrahabr.spring.controller</font> <font color="#339933">;</font> <br><br>  <font color="#000000">import</font> <font color="#006699">org.springframework.stereotype.Controller</font> <font color="#339933">;</font> <br>  <font color="#000000">import</font> <font color="#006699">org.springframework.ui.Model</font> <font color="#339933">;</font> <br>  <font color="#000000">import</font> <font color="#006699">org.springframework.util.MultiValueMap</font> <font color="#339933">;</font> <br>  <font color="#000000">import</font> <font color="#006699">org.springframework.web.bind.annotation.RequestMapping</font> <font color="#339933">;</font> <br><br>  <a href="https://habrahabr.ru/users/controller/" class="user_link">Controller</a> <br>  <font color="#000000">public</font> <font color="#000000">class</font> DocxController <font color="#009900">{</font> <br><br>  @RequestMapping <font color="#009900">(</font> value = <font color="#0000ff">"/ get / docx"</font> , method = RequestMethod. <font color="#006633">GET</font> <font color="#009900">)</font> <br>  <font color="#000000">public</font> <font color="#003399">String</font> doGenerate <font color="#009900">(</font> Model model <font color="#009900">)</font> <font color="#009900">{</font> <br>  model.  <font color="#006633">addAttribute</font> <font color="#009900">(</font> <font color="#0000ff">"filename"</font> , <font color="#0000ff">"test"</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  model.  <font color="#006633">addAttribute</font> <font color="#009900">(</font> <font color="#0000ff">"test"</font> , <font color="#0000ff">"test"</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000000">return</font> <font color="#0000ff">"docx / test"</font> <font color="#339933">;</font> <br></blockquote><br>  Next, call the get / docx method and get the file in docx. </div><p>Source: <a href="https://habr.com/ru/post/101546/">https://habr.com/ru/post/101546/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../101539/index.html">University editors will learn to use statistics</a></li>
<li><a href="../101540/index.html">Health and coding - how to combine?</a></li>
<li><a href="../101541/index.html">Who gets funding for Internet startups?</a></li>
<li><a href="../101544/index.html">Versioning and data history</a></li>
<li><a href="../101545/index.html">Granin. This strange life</a></li>
<li><a href="../101547/index.html">Plugin system example</a></li>
<li><a href="../101548/index.html">Toshiba Media Controller - now for Apple iPhone and iPod touch users</a></li>
<li><a href="../101549/index.html">IPhone Fourth is afraid of heat</a></li>
<li><a href="../101550/index.html">Interviews with Techdays winners</a></li>
<li><a href="../101552/index.html">Commercial software with a free past</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>