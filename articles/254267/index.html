<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Evolution of web injects, part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Currently, web inject files have been adopted in many banking malware and are used as a means for financial fraud. This mechanism of malware operation...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Evolution of web injects, part 1</h1><div class="post__text post__text-html js-mediator-article">  Currently, web inject files have been adopted in many banking malware and are used as a means for financial fraud.  This mechanism of malware operation was initially distributed in single copies and was dependent on one or another family of malicious programs.  Over the past few years, web injections have been used as part of a whole cybercriminal ecosystem in which independent developers sell their products to botnet operators. <br><br><img src="https://habrastorage.org/files/d1b/85a/377/d1b85a377bbb41df9a0892a63173b7ce.jpeg"><br><br>  Such a market for the sale of such services can be observed in numerous underground forums, where we see an increasing number of offers from cybercriminals for the sale of sets of web injects.  They include all the necessary opportunities to conduct bank fraud, including mechanisms to circumvent special security measures that banks use to ensure the security of user accounts. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>  Our study focuses on the very nature of web injecting and their growing market.  We look back and see how web injects have evolved over time from the very beginning, when they looked like a regular phishing system and ending with automatic ATS systems that can be used to bypass two-factor 2FA authentication. <br><br>  To date, the botnet operator, in order to earn money on fraudulent transactions, needs only a malicious program that can inject malicious HTML content into legitimate web pages of the browser.  Thus, he, in fact, does not care how this malicious mechanism will be implemented, only its effectiveness is important to him.  Therefore, to implement this algorithm and its mechanisms, it can resort to the services of other cybercriminals who know this area much better than him and who can offer the best services for conducting fraudulent schemes. <br><br>  <b>Introduction</b> <br><br>  In fact, web injections are one of the most advanced tools that use bank Trojans to conduct fraudulent transactions with users' bank accounts.  Recently, banks have begun to use special security mechanisms that are designed to protect an account or user account from unauthorized access.  Web injections are also not standing still, and their authors adapt their cybercrime tools to circumvent these security mechanisms.  Selling kits of web injects in underground forums has been observed for several years now. <br><br>  As we know, over the past few years, users are increasingly turning to Internet banking services for various banking operations.  Cybercriminals also do not stand still and create special malicious tools to compromise users' computers and their mobile devices.  At the very beginning of their evolution, the attackers relied on banking trojans, which contained functions for compromising several financial institutions and were well-known keyloggers (keyboard spies) and grabbers / hijackers of web forms.  Both of these tools were used to steal confidential data from online banking accounts. <br><br>  Keyloggers are less useful because they generate a general flow of characters typed by the user from the keyboard, from which you will still need to isolate the desired username and password to access your online banking account.  This task fell on the shoulders of botnet operators.  Grabber of forms became an obvious way out of this situation, since it could only receive data of interest to intruders that the user entered into a fake login form into an online banking account.  Then, the captured data was sent to the remote server of the attackers. <br><br>  From the point of view of today, form grabbers are a rather outdated way of capturing GET and POST HTTP protocol requests, with which form data is sent to a remote server.  The well-known and already studied Zeus and SpyEye banking trojans were the first to use the form grabbing mechanism based on interceptions of API functions in the context of the web browser process.  Some malware used forms grabbing based on tracking the network traffic flow generated by the browser.  Using the API interception mechanism is more preferable for attackers, since this way the form data is intercepted before they are directly encrypted for subsequent transfer to a web server.  This method is not without flaws, since it is dependent on a particular browser or its version. <br><br>  Modern malware is increasingly using these outdated techniques; instead, they resort to web-injecting services that allow them to fine-tune and use a malicious scheme of web page compromise and theft of funds.  In addition, the web injections themselves allow you to modify the content of the web pages of online banking sites, depending on the specific bank.  Web injections allow attackers to perform a wide range of actions on a compromised web page that the user sees.  There are several sets of web injects offered for sale in underground forums that use a jQuery JavaScript library. <br><br>  Zeus and SpyEye, the popular banking trojans, were among the first to use web injections to compromise specific banking sites and modify their content.  The content of the web page can be modified using the API call interception mechanism.  This is the same method that malware uses to organize forms grabbing.  A banking trojan can inspect the content received from the server and modify it on the fly before directly displaying this content in a browser.  This technique is used to trick a user who trusts in the content that the web browser displays when they visit the online banking web page.  This method is known as an attack on a user called Man-in-the-Browser (MitB).  Below in Fig.  Figure 1 shows an example of a real web injection that resulted in deletion of text with warnings about financial fraud. <br><br><img src="https://habrastorage.org/files/371/940/b76/371940b76133481db87fdadefda9882c.png"><br>  Fig.  1. Malware using web-inject has deleted service information from the web page (online banking warning).  At the top is a view of the original web page, at the bottom a compromised web page with the warning text removed. <br><br>  The malicious content that will be added to the web page is located in the web injects configuration file.  This file is usually downloaded by the infected computer from a remote C &amp; C server.  This method of transferring the configuration file is very convenient for attackers, since they can modify the contents of such a file once on the server and infected computers will receive an upgraded version of this file the next time.  There are various formats of web injects configuration files, but one of them has gained the most popularity.  It was used in the SpyEye banking Trojan and eventually became the de facto standard.  In Fig.  Figure 2 shows an example web injects configuration file. <br><br><img src="https://habrastorage.org/files/37f/683/9cb/37f6839cbe5a45ffa8f9d93c35ffb83a.png"><br>  Fig.  2. The standard format of the web injects configuration file. <br><br>  As you can see above, the first parameter is the target URL where a specific web injection should work.  The characters in the line after the URL indicate to the banking trojan what action it should take when the user opens this address in the browser.  Table 1 shows the values ‚Äã‚Äãof these service symbols, and Table 2 shows the various parameters (tags) of the configuration file.  Some web injections are quite simple and contain functions similar to a simple phishing mechanism, i.e. they embed special fields into the body of the web page, in which the user is prompted to enter his personal and confidential data.  An example of such a web inject is shown in Fig.  3 <br><br><img src="https://habrastorage.org/files/22c/c20/15d/22cc2015d9b14fe9a8064bcc28e15697.png"><br>  Table 1. The most common flags for the set_url parameter. <br><br><img src="https://habrastorage.org/files/15b/1d4/b66/15b1d4b666b345dabebbcc11fac4924e.png"><br>  Table 2. The most common tags of the web injects configuration file. <br><br><img src="https://habrastorage.org/files/14d/ff2/c1b/14dff2c1bdfc4919bdcefa3fbbd2842b.png"><br>  Fig.  3. An example of malicious webpage content that specializes in collecting personal and confidential user information. <br><br>  <b>Automatic Transfer System (ATS)</b> <br><br>  Over time, web injecting has become increasingly specialized and multifunctional.  Some of them contain special advanced features that help attackers to perform fraudulent operations with the user's account.  Special scripts that implement such operations are designed to bypass the protective mechanisms of specified online banking websites.  As web injecting developed, the security systems of banks' sites were also improved and all new features were added to detect malicious activity.  In Fig.  4. You can see an example of a web injection in which the attackers have provided time intervals between malicious actions to simulate human behavior. <br><br><img src="https://habrastorage.org/files/130/2a6/2a9/1302a62a9c144c3a9e73cb3f9f956ae3.png"><br>  Fig.  4. A webinjection function that defines the logic for using time delays. <br><br>  As soon as the fraudulent transfer from the user's account has been completed, a web injection hides the operation by using special mechanisms.  Concealment is understood as an imperceptible adjustment of the cash balance of a bank account.  Thus, the user remains ignorant of the fact that funds have been stolen from his account. <br><br>  The popularity of ATS attacks has decreased recently, as the level of complexity to success ratio has decreased (success-rate-to-complexity ratio).  We can still observe the use of ATS methods of in-the-wild attacks, but some cybercriminals have refused to use them in favor of those attacks that use "manual control".  In this case, the attackers simply take the compromised computer under their control and perform fraudulent actions manually. <br><br>  <b>Bypassing the Transaction Authorization Number (TAN) mechanism</b> <br><br>  With the advent of banking malware, security experts at banks began to introduce special additional security features into banking resources.  One of the most popular of these functions was two-factor authentication, which strengthened the security of transactions. <br><br>  Two-factor authentication raises the security bar when conducting banking transactions through the use of special confirmation codes.  Such codes can be obtained by the user in his bank simply in the form of a list, so-called.  Transaction Authorization Numbers (TAN), or in the form of SMS-messages from the bank, the so-called  Mobile codes (mTAN).  If two-factor authentication is enabled, the user will use the received mTAN codes to confirm the ongoing transaction on the online banking website. <br><br>  To bypass the mTAN mechanism, attackers can lure the user to install a special malicious program for a mobile device that will intercept SMS messages received from the bank.  This can be accomplished through social engineering techniques.  For example, as soon as a user logs into his online banking account via a compromised web browser, the malicious code will inject special malicious content onto a web page.  Content is a text with a request to provide information about the mobile device used by the user (Fig. 5.). <br><br><img src="https://habrastorage.org/files/90c/af6/9f8/90caf69f8038421eaeb526041347b3f9.png"><br>  Fig.  5. Malicious content on a web page that requests information about a mobile device. <br><br>  After the user provides such information, he will receive an SMS message to his mobile device with a link to download the malicious application.  He can also use the QR code to get the link.  After its opening, the malware will be downloaded to the device, then the user will have to manually start its installation.  This procedure can consist of several stages, for example, attackers can embed such content into the online banking web page that will act as a guide to installing malware, instructing the user step by step.  As soon as the malware is installed on the mobile device, it will be able to redirect all received SMS messages to the attackers' phone, giving them the ability to bypass mTAN codes when conducting fraudulent actions with the user's account.  Perkele and iBanking banking trojans are well-known malware representatives with such capabilities. <br><br>  Since banks began to use two-factor authentication mechanisms, web injection developers were forced to adapt their malicious tools to circumvent them.  As shown below, the attackers use one of the forms of social engineering to deceive the user and lure the necessary information from him, which will be used to circumvent these protective measures. <br><br>  The information that became available to us after monitoring the activities of botnet malware provided us with a picture of the methods used by attackers to bypass the mTAN scheme.  They all boil down to one general principle: displaying a special message to the user with a fictional story that will attract his attention.  The attackers display it to the user at the very moment when he logs into his online banking account and believes that he is using a secure connection with the server and that all data displayed by the browser is reliable.  One of these stories is based on the information that a certain amount of money was mistakenly transferred to the user and he should return it back.  Such a scheme becomes possible because the malicious code of a web-injection can correct the cash balance displayed to the user, thus misleading it.  Another story was based on the fact that the user was asked to "calibrate" his mobile device by performing a test cash transaction. <br><br>  In Fig.  6. A fake malware message is shown asking to enter a TAN code from a list in the text field that was issued to a user in a bank.  As we know, the codes in this list are numbered, so attackers ask for the code behind a certain number.  The attackers ask the user to give them the TAN code in the event that they need to steal a certain amount of money from the user's account and confirm this operation with the 2FA mechanism.  Phishing message is compiled as convincingly as possible for the corresponding impact on the user. <br><br><img src="https://habrastorage.org/files/24e/484/2a3/24e4842a385146d4b050a4feb6112a98.png"><br><br>  It should be noted that there are other web injections that are aimed not at compromising the websites of financial institutions and banks, but at compromising known services, for example, Facebook, Twitter, Google, Yahoo.  Such web injections specialize in stealing users' confidential or private information, such as a credit card number or phone number.  In Fig.  7 shows a web-inject, which is focused on a service known service Twitter. <br><br><img src="https://habrastorage.org/files/cdf/f3d/970/cdff3d9705794654b45d896731eb78bd.png"><br>  Fig.  7. Web inject for Twitter service. <br><br>  <b>Encryption of web injects configuration files</b> <br><br>  Since web injects configuration files contain key information for security researchers and CERT organizations around the world, attackers are directly interested in keeping the contents of these files out of their hands.  For this purpose, encryption and obfuscation algorithms are applied to the files. <br><br>  At the initial stage of the development of web inject files, the attackers did not use encryption and these files were transferred from the remote server to the bot in the open form.  After the antivirus companies turned their attention to banker Trojans and began to track the appearance of these configuration files, the attackers began to use encryption, making the process of decrypting the content more difficult with each step.  Banking Trojans such as Zeus and its modifications currently use several levels of encryption, and the decrypted file itself is stored in memory in parts, not in its entirety. <br><br>  Compression or compression of JavaScript code can be performed by an attacker using the so-called.  mechanism / packer /, but in this case, it can be quite quickly converted to the original look.  The operation of obtaining original content can be performed using simple permutations of the ‚Äúeval‚Äù function and the services of the JS beautifier service.  This compression method is convenient because it reduces the size of the content of the web-inject, but its obvious disadvantage is the weak content security.  In Fig.  8. A fragment of the script that was compressed using / packer / is shown. <br><br><img src="https://habrastorage.org/files/e65/066/a2b/e65066a2bf494a81b436fcadb0ba1992.png"><br>  Fig.  8. An example of a mechanism compressed / packer / script. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The algorithms used by hackers to obfuscate the content of web injections can significantly complicate their analysis, since deobfuscating the content can be a non-trivial task. </font></font> In Fig.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 9. An example of such obfuscated content is shown. </font></font><br><br><img src="https://habrastorage.org/files/c2a/f2f/6b9/c2af2f6b96274203b1e04350105626ea.png"><br>  Fig.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9. An example of obfuscated web injection. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The increase in the number of banking Trojans, as well as their complexity, will inevitably lead to a demand for high-quality web injections. </font><font style="vertical-align: inherit;">Such demand has already been secured by corresponding proposals in underground cybercriminal forums.</font></font></div><p>Source: <a href="https://habr.com/ru/post/254267/">https://habr.com/ru/post/254267/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../254255/index.html">Authorization through Chinese social networks</a></li>
<li><a href="../254257/index.html">We make payments iOS AppStore with checking on the server</a></li>
<li><a href="../254259/index.html">Remote control of the Lego Mindstorms robot via JMX and IP Video</a></li>
<li><a href="../254261/index.html">Trinity computer in browser</a></li>
<li><a href="../254263/index.html">Creating a plugin for logical replication in PostgreSQL 9.4+</a></li>
<li><a href="../254273/index.html">Optimization of ISPmanager for projects on Bitrix or how I crossed ISPmanager and VMBitrix (Bitrix environment)</a></li>
<li><a href="../254275/index.html">The ratio of abstraction and complexity in modeling</a></li>
<li><a href="../254277/index.html">The results of a survey of the popularity of PHP frameworks from Sitepoint</a></li>
<li><a href="../254279/index.html">MVC on the server does not happen</a></li>
<li><a href="../254281/index.html">Complete energy autonomy or how to survive with solar panels in the outback (part 3. transitional)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>