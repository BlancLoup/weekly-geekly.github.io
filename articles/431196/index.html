<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How Yandex.Taxi predicts the time of filing a car using machine learning</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Imagine that you need to call a taxi. You open the application, see that the car will arrive in seven minutes, click "Order" - and ... the car is 15 m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How Yandex.Taxi predicts the time of filing a car using machine learning</h1><div class="post__text post__text-html js-mediator-article">  Imagine that you need to call a taxi.  You open the application, see that the car will arrive in seven minutes, click "Order" - and ... the car is 15 minutes away from you, if it is found at all.  Agree, unpleasant? <br><br>  Under the cut, let's talk about how machine learning methods help Yandex.Taxi better predict ETA (Estimated Time of Arrival). <br><br><img src="https://habrastorage.org/webt/bf/5e/aq/bf5eaq56xusobc6hswfokurhe0u.png"><br><a name="habracut"></a><br>  To begin, we recall that the user sees in the application before ordering: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img width="300" src="https://habrastorage.org/webt/xk/qf/cg/xkqfcgfun58vtoyhun-ldoq-wra.png"><br><br>  The blue points on the map are the best points for boarding a taxi.  Red pin - the point to which the user calls a taxi.  The pin shows how long the car will arrive.  In an ideal world.  But in the real world, other people nearby also call themselves a car through the Yandex.Taxi application.  And we do not know which car will go to whom, because they are distributed only after the order.  If the machine is already assigned, for the forecast we will use the Yandex.Map routing and the time when moving along the optimal path.  This time (perhaps with a small margin) we will show the user immediately after ordering.  The question remains: how to predict ETA before ordering? <br><br>  And here comes machine learning.  We make a sample with the objects and the correct answers and train the algorithm to guess the answer according to the features of the object.  In our case, the objects are user sessions, the answers are the time after which the car actually arrived.  Signs of the object can be numerical parameters known before ordering: the number of drivers and users of the application next to the pin, the distance to the nearest service vehicles and other potentially useful values. <br><br><h2>  Why is it important </h2><br><br>  In an ideal world, people do everything in advance and always plan their time accurately.  But we live in the real world.  If a person is late for work or, even worse, at the airport, it is important for him to understand whether he will have time to leave and get to his destination. <br>  When deciding what to order, the future passenger is guided, including waiting time.  It can be very different in different applications for calling a taxi, and in different rates of a single application.  So that the user does not regret the choice, it is very important to show the exact ETA. <br><br>  It seems simple.  Come up with more signs, train a model, for example CatBoost, predict the time before the car arrives - and you can finish on this.  But experience shows that it is better not to rush and think carefully, and then do it. <br><br>  At first we had no doubt that it was necessary to predict the time after which the driver would actually arrive at the user.  Yes, before ordering, we do not know for sure which machine will be assigned.  But we can predict ETA, using data not about a specific driver, but about drivers in the vicinity of the order.  Of course, the forecast must be fair enough that the user can plan time. <br><br>  But what does ‚Äúhonest‚Äù mean?  After all, any prediction algorithm is good or good only statistically.  There are also successful, and frankly bad results, but it is necessary ‚Äúon average‚Äù not to deviate much from the correct answers.  Here we must understand that "on average" is different.  For example, the average is at least three concepts from statistics: expectation, median and fashion.  The picture from Darella Huff's magnificent book ‚ÄúHow to lie with the help of statistics‚Äù perfectly shows the difference: <br><br><img width="600" src="https://habrastorage.org/webt/lu/i4/ia/lui4iawdwfbczidpq-rcivxyrr4.png"><br><br>  We want the model to be on average a little mistaken.  Depending on the value ‚Äúon average‚Äù, there are two options for assessing the quality of forecasts.  The first option is to show the user the expected time before the arrival of a taxi.  As a result, a model will be learned that minimizes the average square of the forecast error (Mean Squared Error, MSE): <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>M</mi><mi>S</mi><mi>E</mi><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>1</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>n</mi></mrow><mtext>&amp;#xA0;</mtext><mi>s</mi><mi>u</mi><msubsup><mi>m</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>n</mi></mrow></msubsup><mo stretchy=&quot;false&quot;>(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>&amp;#x2212;</mo><mtext>&amp;#xA0;</mtext><mi>h</mi><mi>a</mi><mi>t</mi><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>y</mi></mrow><mi>i</mi></msub><msup><mo stretchy=&quot;false&quot;>)</mo><mn>2</mn></msup><mtext>&amp;#xA0;</mtext><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>o</mi><mi>w</mi><mi>m</mi><mi>i</mi><mi>n</mi></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="54.112ex" height="3.262ex" viewBox="0 -987.6 23298.2 1404.6" role="img" focusable="false" style="vertical-align: -0.969ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-4D" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-53" x="1051" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-45" x="1697" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMAIN-3D" x="2739" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-66" x="4045" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-72" x="4596" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-61" x="5047" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-63" x="5577" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMAIN-31" x="6010" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-6E" x="6511" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-73" x="7361" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-75" x="7831" y="0"></use><g transform="translate(8403,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-6E" x="1242" y="499"></use><g transform="translate(878,-308)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMAIN-3D" x="345" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMAIN-31" x="1124" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMAIN-28" x="10530" y="0"></use><g transform="translate(10920,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-79" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-69" x="693" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMAIN-2212" x="11977" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-68" x="13228" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-61" x="13804" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-74" x="14334" y="0"></use><g transform="translate(14695,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-79" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-69" x="693" y="-342"></use></g><g transform="translate(15530,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMAIN-29" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMAIN-32" x="550" y="583"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-72" x="16623" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-69" x="17075" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-67" x="17420" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-68" x="17901" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-74" x="18477" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-61" x="18839" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-72" x="19368" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-72" x="19820" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-6F" x="20271" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-77" x="20757" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-6D" x="21473" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-69" x="22352" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-6E" x="22697" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>M</mi><mi>S</mi><mi>E</mi><mo>=</mo><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>n</mi></mrow><mtext>&nbsp;</mtext><mi>s</mi><mi>u</mi><msubsup><mi>m</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>n</mi></mrow></msubsup><mo stretchy="false">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>‚àí</mo><mtext>&nbsp;</mtext><mi>h</mi><mi>a</mi><mi>t</mi><msub><mrow class="MJX-TeXAtom-ORD"><mi>y</mi></mrow><mi>i</mi></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mtext>&nbsp;</mtext><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>o</mi><mi>w</mi><mi>m</mi><mi>i</mi><mi>n</mi></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> MSE = \ frac {1} {n} \ sum_ {i = 1} ^ {n} (y_i - \ hat {y} _i) ^ 2 \ rightarrow min </script></p><br><br>  Here <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>y</mi><mi>i</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.939ex" height="1.817ex" viewBox="0 -520.7 834.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-79" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-69" x="693" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>y</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-2"> y_i </script>  - right answers, <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>h</mi><mi>a</mi><mi>t</mi><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>y</mi></mrow><mi>i</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.928ex" height="2.539ex" viewBox="0 -780.1 2552.3 1093.4" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-68" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-61" x="826" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-74" x="1356" y="0"></use><g transform="translate(1717,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-79" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-69" x="693" y="-342"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>h</mi><mi>a</mi><mi>t</mi><msub><mrow class="MJX-TeXAtom-ORD"><mi>y</mi></mrow><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-3"> \ hat {y} _i </script>  - model predictions. <br><br>  Another option is not to be mistaken with the ETA forecast mainly in one direction, up or down.  In this case, we will show the user the median time distribution before the arrival of a taxi.  As a result, a model will be trained that optimizes the average prediction error module (Mean Absolute Error, MAE): <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>M</mi><mi>A</mi><mi>E</mi><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>1</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>n</mi></mrow><mtext>&amp;#xA0;</mtext><mi>s</mi><mi>u</mi><msubsup><mi>m</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>n</mi></mrow></msubsup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><msub><mi>y</mi><mi>i</mi></msub><mo>&amp;#x2212;</mo><mtext>&amp;#xA0;</mtext><mi>h</mi><mi>a</mi><mi>t</mi><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>y</mi></mrow><mi>i</mi></msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mtext>&amp;#xA0;</mtext><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>o</mi><mi>w</mi><mi>m</mi><mi>i</mi><mi>n</mi></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="52.786ex" height="2.901ex" viewBox="0 -832 22727.3 1249" role="img" focusable="false" style="vertical-align: -0.969ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-4D" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-41" x="1051" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-45" x="1802" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMAIN-3D" x="2844" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-66" x="4150" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-72" x="4701" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-61" x="5152" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-63" x="5682" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMAIN-31" x="6115" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-6E" x="6616" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-73" x="7466" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-75" x="7936" y="0"></use><g transform="translate(8508,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-6E" x="1242" y="499"></use><g transform="translate(878,-308)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMAIN-3D" x="345" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMAIN-31" x="1124" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMAIN-7C" x="10635" y="0"></use><g transform="translate(10914,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-79" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-69" x="693" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMAIN-2212" x="11971" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-68" x="13222" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-61" x="13798" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-74" x="14328" y="0"></use><g transform="translate(14689,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-79" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-69" x="693" y="-342"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMAIN-7C" x="15524" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-72" x="16052" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-69" x="16504" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-67" x="16849" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-68" x="17330" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-74" x="17906" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-61" x="18268" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-72" x="18797" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-72" x="19249" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-6F" x="19700" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-77" x="20186" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-6D" x="20902" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-69" x="21781" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/431196/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhh_Q1cuowzaECfGozY3I__HulOiyQ#MJMATHI-6E" x="22126" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>M</mi><mi>A</mi><mi>E</mi><mo>=</mo><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>n</mi></mrow><mtext>&nbsp;</mtext><mi>s</mi><mi>u</mi><msubsup><mi>m</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>n</mi></mrow></msubsup><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msub><mi>y</mi><mi>i</mi></msub><mo>‚àí</mo><mtext>&nbsp;</mtext><mi>h</mi><mi>a</mi><mi>t</mi><msub><mrow class="MJX-TeXAtom-ORD"><mi>y</mi></mrow><mi>i</mi></msub><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mtext>&nbsp;</mtext><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>o</mi><mi>w</mi><mi>m</mi><mi>i</mi><mi>n</mi></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-4"> MAE = \ frac {1} {n} \ sum_ {i = 1} ^ {n} | y_i - \ hat {y} _i | \ rightarrow min </script></p><br><br>  But we realized that we are a little ahead. <br><br><h2>  Rethinking Problem Statement </h2><br>  After the appointment, we know what kind of car goes to the user, which means we can estimate its travel time on Yandex.Maps.  This time is shown in the pin after the order.  On the one hand, we now have more information and the forecast will be more accurate, but, on the other hand, this is also an estimate with an error. <br><br>  That was the catch in the ETA pin problem.  As long as the driver is not appointed, it is necessary to predict <b>exactly the time that Yandex.Maps routing will show later,</b> and not the actual time before the vehicle is delivered. <br><br>  It would seem that nonsense: instead of the exact value, take as a target a different forecast?  But it makes sense, and here's why.  On the way to you, the designated machine may linger.  The driver got into a dangerous situation on the road, in a traffic jam due to an accident or went out to buy water.  Such delays are difficult to predict.  They create additional noise in the target variable, due to which the already difficult task of predicting ETA in pin becomes even more difficult. <br><br>  How to get rid of noise?  Predict the smoothed target variable ‚Äî the time that is displayed after the machine is assigned based on the route to the user. <br><br>  This is also the logic from the point of view of business: travel time along the optimal path from ETA cannot be eliminated anyway, but additional delays can be reduced by working with drivers. <br><br><h2>  Quality metrics, data, model and training </h2><br>  We found out that for ETA in Pina it is necessary to predict not the actual time, but the time that will be obtained after the machine is assigned along the route.  Of the two quality metrics, MAE and MSE, we chose MAE.  Perhaps from the point of view of the intuitiveness of the forecast, it is more logical to estimate the expectation (MSE), rather than the median (MAE).  But MAE has a nice feature: the model is more resistant to emissions (outliers) among training examples. <br><br>  Signs are divided into groups: <br>  - built on the current time; <br>  - geo (coordinates, distance to the city center and significant objects on the map); <br>  - pin (how many and what cars nearby, their density is calculated differently); <br>  - statistics on the zone (as usual, we are mistaken, how many are predicted); <br>  - data on the nearest drivers (in what time they arrive, how much closer is the first closer than the second, etc.). <br><br>  On these signs, <a href="https://habr.com/company/yandex/blog/333522/">CatBoost was</a> trained, of course.  The decisive argument was that the gradient boost implemented in CatBoost over balanced trees has long established itself as a very powerful method of machine learning, and the method of encoding categorical features in CatBoost regularly justifies itself in our tasks.  Another nice feature of the library is fast GPU training. <br><br>  Now a few words about which models were compared.  The original ETA (up to machine learning) was calculated on the basis of the time for which the machine closest to the user can arrive.  The current model (used in the application now) is what came out of it using machine learning and <b>what this article is about.</b>  In addition, the production will soon roll out a new model.  It uses an order of magnitude more significant for solving the problem of signs.  The table below shows the measurements of the quality of these models on historical data.  By the way, we still have a lot of plans - <a href="https://ya.cc/4ZfkE">come help</a> . <br><br>  <b>ETA forecast quality for validation *</b> <br><br><table><tbody><tr><td><br></td><td>  Mean Absolute Error <br></td><td>  Error more than 1 minute <br></td><td>  Error more than 2 minutes <br></td><td>  Error more than 5 minutes <br></td></tr><tr><td width="124"><p>  Original ETA </p><br></td><td width="125"><p>  82,082 </p><br></td><td width="125"><p>  29.95 </p><br></td><td width="125"><p>  18,12 </p><br></td><td width="125"><p>  3.7 </p><br></td></tr><tr><td width="124"><p>  Current model </p><br></td><td width="125"><p>  79.276 (‚Äì3.4) </p><br></td><td width="125"><p>  29.33 (‚Äì2.1) </p><br></td><td width="125"><p>  16.98 (‚Äì6.3) </p><br></td><td width="125"><p>  3 (‚Äì19.2) </p><br></td></tr><tr><td width="124"><p>  New model </p><br></td><td width="125"><p>  78,414 (‚Äì4.5) </p><br></td><td width="125"><p>  28.95 (‚Äì3.4) </p><br></td><td width="125"><p>  16.62 (‚Äì8.2) </p><br></td><td width="125"><p>  2.8 (‚Äì23.2) </p><br></td></tr></tbody></table><br><br>  * Percentage (change in parentheses compared to baseline ETA). <br><br>  Machine learning allowed to win about two seconds, or 3.4% of the average deviation of the forecast.  And in the new model - almost a second, a total of 4.5% already.  But it is difficult to understand from these numbers that the ETA has improved significantly.  To feel the benefits of machine learning, you should pay attention to the last column.  Misses with a forecast of more than 5 minutes was 19.2%, and in the new model - even 23.2% less!  By the way, such errors occur only in 3 and 2.8% of cases in models using machine learning. <br><br><h2>  Results </h2><br>  We refined the ETA in Pina mainly in order to provide users with a reliable forecast.  But, of course, in any application of machine learning in business, it is imperative to evaluate the economic effect.  And to understand whether it is comparable with the cost of building and implementing models.  After the A / B test online, it turned out that we, using machine learning, received a statistically significant increase in conversion from order to trip (after all, an order can be canceled) and an increase in conversion from a user session to an order. <br><br>  In both cases, this is an effect of the order of 0.1 percentage points.  This, by the way, does not contradict statistical significance: on our data volumes, even such a difference is reliably detected in 2‚Äì4 weeks.  And with the importance for the business, in fact, everything is also quite good: it turned out that the cost of specifying the ETA is bounced off with a conversion increase in just a few months. <br><br>  As a result, we received a useful and illustrative case.  The specification of the ETA in the pin has become an instructive story about the careful selection of the target variable.  On the product side, this is a very motivating example: we improved the application and saw that users appreciated this.  We hope that the updated ETA will help our passengers to keep up with meetings, trains and airplanes more often. <br><br>  PS If you are interested in other Yandex.Taxi technologies, then we recommend a <a href="https://habr.com/company/yandex/blog/429226/">post about dynamic pricing</a> , which my colleague recently published. </div><p>Source: <a href="https://habr.com/ru/post/431196/">https://habr.com/ru/post/431196/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../431186/index.html">Designing Types: How to make invalid states ineffable on C #</a></li>
<li><a href="../431188/index.html">Technical aspects of Internet blocking in Russia. Problems and Prospects</a></li>
<li><a href="../431190/index.html">How to assess the level of an SEO company without entering into an agreement with it</a></li>
<li><a href="../431192/index.html">Firecracker introduces AWS - ‚Äúmicro-virtualization‚Äù for Linux</a></li>
<li><a href="../431194/index.html">Warm tube hardcore. How did DotNext 2018 Moscow</a></li>
<li><a href="../431202/index.html">Debian and Devuan have joined forces for the sake of sysvinit</a></li>
<li><a href="../431204/index.html">The backdoor in one of the dependencies of the EventStream library</a></li>
<li><a href="../431208/index.html">Splunk through the eyes of a newbie: how we made a vault inventory system</a></li>
<li><a href="../431210/index.html">Second meeting Write the Docs Moscow. House Techwriters: do not forget that we exist</a></li>
<li><a href="../431212/index.html">Cache pagination in Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>