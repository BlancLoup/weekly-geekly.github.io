<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Shed Skin - an experimental translator from Python to C ++</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 

 Shed Skin is an experimental translator from Python to C ++, designed to speed up the execution of Python programs with intensive calc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Shed Skin - an experimental translator from Python to C ++</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br><br>  Shed Skin is an experimental translator from Python to C ++, designed to speed up the execution of Python programs with intensive calculations.  It converts programs written in a limited subset of the Python language to C ++.  C ++ code can be compiled into executable code, which can be either a separate program or an extension module that can be easily imported and used in a regular Python program. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Shed Skin uses the type matching methods used in the Python program to generate the explicit type declarations required for the C ++ version.  Since C ++ is a static-typed language, Shed Skin requires that Python code be written so that all variables are of a specific type. <br><br>  In addition to the restrictions on typing and a subset of the language, supported programs cannot freely use the standard Python library, although about 25 commonly used modules are supported, such as random and re (see Library Restrictions). <br><br>  In addition, the type detection technology used by Shed Skin currently does not scale well for programs that exceed several thousand lines of code (the maximum size of the program being broadcast is about 6,000 lines (sloccount)).  In general, this means that Shed Skin is currently more suitable for broadcasting small programs and extension modules that do not use intensively the features of Python's dynamic typing or standard and external libraries.  See below a collection of 75 non-trivial example programs. <br><br>  Since Shed Skin is still in the early stages of development, it can be seriously improved.  At the moment, you may encounter any errors in the process of using it.  Please send us a report about them so we can fix them! <br><br>  Shed Skin is currently compatible with versions 2.4 to 2.7 of Python, behaves like 2.6, and runs on Windows and most UNIX platforms such as GNU / Linux and OSX. <br><br><h4>  Restrictions on typing </h4><br><br>  Shed Skin translates ordinary, but statically typed programs in C ++.  The restriction on static typing means that variables can have only one, immutable type.  So, for example, the code <br><br><pre><code class="python hljs">a = <span class="hljs-number"><span class="hljs-number">1</span></span> a = <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-comment"><span class="hljs-comment"># </span></span></code> </pre> <br><br>  not allowed  However, as in C ++, types can be abstract, for example, code <br><br><pre> <code class="python hljs">a = A() a = B() <span class="hljs-comment"><span class="hljs-comment"># </span></span></code> </pre><br><br>  where A and B have a common base class, let's say. <br><br>  The restriction on typing also means that elements of the same collection (list, set, etc.) cannot have different types (because the types of their members must also be static).  Thus, the code: <br><br><pre> <code class="python hljs">a = [<span class="hljs-string"><span class="hljs-string">'apple'</span></span>, <span class="hljs-string"><span class="hljs-string">'b'</span></span>, <span class="hljs-string"><span class="hljs-string">'c'</span></span>] <span class="hljs-comment"><span class="hljs-comment">#  b = (1, 2, 3) #  c = [[10.3, -2.0], [1.5, 2.3], []] # </span></span></code> </pre><br><br>  let's say but code <br><br><pre> <code class="python hljs">d = [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2.5</span></span>, <span class="hljs-string"><span class="hljs-string">'abc'</span></span>] <span class="hljs-comment"><span class="hljs-comment">#  e = [3, [1, 2]] #  f = (0, 'abc', [1, 2, 3]) # </span></span></code> </pre><br><br>  not allowed  Keys and values ‚Äã‚Äãof dictionaries can have different types: <br><br><pre> <code class="python hljs">g = {<span class="hljs-string"><span class="hljs-string">'a'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'b'</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'c'</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>} <span class="hljs-comment"><span class="hljs-comment">#  h = {'a': 1, 'b': 'hello', 'c': [1, 2, 3]} # </span></span></code> </pre><br><br>  In the current version of Shed Skin, mixed types are also allowed in tuples of length two: <br><br><pre> <code class="python hljs">a = (<span class="hljs-number"><span class="hljs-number">1</span></span>, [<span class="hljs-number"><span class="hljs-number">1</span></span>]) <span class="hljs-comment"><span class="hljs-comment"># </span></span></code> </pre><br><br>  In the future, it may be possible to allow mixed types in tuples of greater length. <br><br>  Type None can only be mixed with non-scalar types (that is, not with int, float, bool, or complex): <br><br><pre> <code class="python hljs">l = [<span class="hljs-number"><span class="hljs-number">1</span></span>] l = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-comment"><span class="hljs-comment"># </span></span></code> </pre><br><br><pre> <code class="python hljs">m = <span class="hljs-number"><span class="hljs-number">1</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-comment"><span class="hljs-comment"># </span></span></code> </pre><br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fun</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x = None)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># :     x, , x = -1 pass fun(1)</span></span></code> </pre><br><br>  Integers and floating-point numbers (integers and floats) can usually be mixed (integers become floating-point numbers).  If this is not possible, Shed Skin will display an error message. <br><br><h4>  Limitations on a Python subset </h4><br><br>  Shed Skin will always support only a subset of all features of the Python language.  Currently the following features are not supported: <br><br><ul><li>  eval, getattr, hasattr, isinstance, all dynamic </li><li>  arbitrary precision arithmetic (integers - int - become 32-bit (signed) by default on most architectures, see Command Line Options) </li><li>  package-unpacking of arguments (* args and ** kwargs) </li><li>  multiple inheritance </li><li>  nested functions and classes </li><li>  unicode </li><li>  inheritance from built-in types (excluding Exception and object) </li><li>  function overload __iter__, __call__, __del__ </li><li>  closures </li></ul><br><br>  Some other features are only partially supported: <br><br><ul><li>  class attributes can only be accessed through the class name: <br><pre> <code class="python hljs"> self.class_attr <span class="hljs-comment"><span class="hljs-comment">#  SomeClass.class_attr #  SomeClass.some_static_method() # </span></span></code> </pre><br></li><li>  function references can be passed, but not to class methods and not to classes, and they cannot be contained in any container: <br><pre> <code class="python hljs">var = <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x, y: x+y <span class="hljs-comment"><span class="hljs-comment">#  var = some_func #  var = self.some_method # ,    var = SomeClass #  [var] # ,   </span></span></code> </pre><br></li></ul><br><br><h4>  Library Restrictions </h4><br><br>  Currently, the following 25 modules are heavily supported.  Some of them, such as os.path, were translated to C ++ using Shed Skin. <br><br><ul><li>  array </li><li>  binascii </li><li>  bisect </li><li>  collections (defaultdict, deque) </li><li>  colorsys </li><li>  ConfigParser (without SafeConfigParser) </li><li>  copy </li><li>  csv (without Dialect, Sniffer) </li><li>  datetime </li><li>  fnmatch </li><li>  getopt </li><li>  glob </li><li>  heapq </li><li>  itertools (without starmap) </li><li>  math </li><li>  mmap </li><li>  os (under Windows some functionality is missing) </li><li>  os.path </li><li>  random </li><li>  re </li><li>  select (select function only, under UNIX) </li><li>  socket </li><li>  string </li><li>  struct (without struct, pack_into, unpack_from) </li><li>  sys </li><li>  time </li></ul><br><br>  Note that any other module, such as pygame, pyqt, or pickle, can be used in conjunction with an extension module generated using Shed Skin.  Examples of such use are found in the Shed Skin examples. <br><br><h4>  Installation </h4><br><br>  There are two types of installers: Windows Sappacking Installer and UNIX Archive.  But, of course, it‚Äôs better if Shed Skin is installed using your GNU / Linux installation manager (Shed Skin is available at least on Debian, Ubuntu, Fedora and Arch). <br><br><h5>  Windows </h5><br><br>  To install the Windows version, simply download and run the installer.  If you are using ActivePython or another non-standard Python distribution, or MingW, first remove it.  Also keep in mind that, probably, in the 64-bit version of Python, some file is missing, so the assembly of extension modules is not possible.  Instead of 64-bit, use the 32-bit version of Python. <br><br><h5>  UNIX </h5><br><br><h6>  Installation via package manager </h6><br><br>  Sample command for Ubuntu: <br><br><pre> <code class="bash hljs">sudo apt-get install shedskin</code> </pre><br><br><h6>  Manual installation </h6><br><br>  To install the distribution package from a UNIX archive manually, do the following: <br><br><ul><li>  download and unzip the archive </li><li>  run the command run sudo python setup.py install </li></ul><br><br><h5>  Dependencies </h5><br><br>  To compile and run the programs generated by shedskin, the following libraries are needed: <br><br><ul><li>  g ++, C ++ compiler (version 4.2 or higher). </li><li>  pcre debug files </li><li>  Python debug files </li><li>  garbage collector Boehm </li></ul><br><br>  To install these libraries under Ubuntu, enter: <br><br><pre> <code class="bash hljs">sudo apt-get install g++ libpcre++dev python-all-dev libgc-dev</code> </pre><br><br>  If the Boehm garbage collector is not available through your package manager, use this method.  Download, for example, version 7.2alpha6 from the website, unpack it, and install it as follows: <br><br><pre> <code class="bash hljs">./configure --prefix=/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-threads=posix --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-cplusplus --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-thread-local-alloc --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-large-config make make check sudo make install</code> </pre><br><br>  If the PCRE library is not available through your package manager, use the following method.  Download, for example, version 8.12 from the website, unpack it and install it as follows: <br><br><pre> <code class="bash hljs">./configure --prefix=/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> make sudo make install</code> </pre><br><br><h5>  Osx </h5><h5></h5><h6>  Manual installation </h6><br><br>  To install Shed Skin from a UNIX archive on an OSX system, do the following: <br><br><ul><li>  download and unzip the archive </li><li>  run the command run sudo python setup.py install </li></ul><br><br><h6>  Dependencies </h6><br><br>  To compile and run the programs generated by shedskin, the following libraries are needed: <br><br><ul><li>  g ++, C ++ compiler (version 4.2 or higher; comes with Apple Xcode development environment?). </li><li>  pcre debug files </li><li>  Python debug files </li><li>  garbage collector Boehm </li></ul><br><br>  If the Boehm garbage collector is not available through your package manager, use this method.  Download, for example, version 7.2alpha6 from the website, unpack it, and install it as follows: <br><br><pre> <code class="bash hljs">./configure --prefix=/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-threads=posix --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-cplusplus --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-thread-local-alloc --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-large-config make make check sudo make install</code> </pre><br><br>  If the PCRE library is not available through your package manager, use the following method.  Download, for example, version 8.12 from the website, unpack it and install it as follows: <br><br><pre> <code class="bash hljs">./configure --prefix=/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> make sudo make install</code> </pre><br><br><h4>  Broadcast usual program </h4><br><br>  On Windows, first execute (by double-clicking) the init.bat file in the directory where you installed Shed Skin. <br><br>  To compile the following simple test program named test.py: <br> <code>print 'hello, world!' <br></code> <br><br>  enter: <br> <code>shedskin test <br></code> <br><br>  Two C ++ files are created with the names test.cpp and test.hpp, as well as a Makefile. <br><br>  To create an executable file named test (or test.exe), type: <br><br><pre> <code class="bash hljs">make</code> </pre><br><br><h4>  Creating an extension module </h4><br><br>  To compile the following program named simple_module.py as an extension module: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># simple_module.py def func1(x): return x+1 def func2(n): d = dict([(i, i*i) for i in range(n)]) return d if __name__ == '__main__': print func1(5) print func2(10)</span></span></code> </pre><br><br>  enter: <br><br><pre> <code class="bash hljs">shedskin -e simple_module make</code> </pre><br><br>  To make the 'make' command successfully on a non-Windows system, make sure you have the Python debug files installed (on Debian, install python-dev; on Fedora, install python-devel). <br><br>  Note that in order to define types, your module only has to call its own functions.  This effect is achieved in the example due to the fact that calls are placed inside the if __name __ == '__ main__' condition, so they are not called if the module is imported.  Functions can only be called indirectly, that is, if func2 calls func1, the call to func1 can be omitted. <br><br>  The extension module can now be simply imported and used as usual: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> simple_module <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> func1, func2 &gt;&gt;&gt; func1(<span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-number"><span class="hljs-number">6</span></span> &gt;&gt;&gt; func2(<span class="hljs-number"><span class="hljs-number">10</span></span>) {<span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>: <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>: <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>: <span class="hljs-number"><span class="hljs-number">25</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>: <span class="hljs-number"><span class="hljs-number">36</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>: <span class="hljs-number"><span class="hljs-number">49</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>: <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>: <span class="hljs-number"><span class="hljs-number">81</span></span>}</code> </pre><br><br><h5>  Restrictions </h5><br><br>  There are significant differences between using a compiled expansion module and the original. <br><br>  You can transfer and return only built-in scalar types and containers (int, float, complex, bool, str, list, tuple, dict, set), as well as None and instances of user-defined classes.  For example, anonymous functions and iterators are currently not supported. <br>  Built-in objects as well as their contents are completely converted to each function call / return from the Shed Skin types to CPython and vice versa.  This means that you cannot change the built-in CPython objects from the Shed Skin side and vice versa, and the conversion can be slow. You can send / return instances of user-defined classes without any transformations and change them from any side. <br>  Global variables are converted only once, during initialization, from Shed Skin to CPython.  This means that the values ‚Äã‚Äãof the CPython version and the Shed Skin version can change independently of each other.  This problem can be avoided by using only constant glabolic variables, or by adding getter functions and setters. <br>  Multiple (interoperable) expansion modules are not currently supported.  Also, importing and simultaneously using the Python and translated versions may not work. <br><br><h5>  Integration with Numpy </h5><br><br>  Shed Skin currently has no direct support for Numpy.  However, it is possible to transfer the Numpy array to the translated Shed Skin module as a list using its tolist method.  Note that this is very inefficient (see above), so it can be used if a large amount of time is spent inside the expander.  Consider the following example: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># simple_module2.py def my_sum(a): """ compute sum of elements in list of lists (matrix) """ h = len(a) # number of rows in matrix w = len(a[0]) # number of columns s = 0.0 for i in range(h): for j in range(w): s += a[i][j] return s if __name__ == '__main__': print my_sum([[1.0, 2.0], [3.0, 4.0]])</span></span></code> </pre><br><br>  After translating this module as an extension module using Shed Skin, we can pass the Numpy array as follows: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy &gt;&gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> simple_module2 &gt;&gt;&gt; a = numpy.array(([<span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">2.0</span></span>], [<span class="hljs-number"><span class="hljs-number">3.0</span></span>, <span class="hljs-number"><span class="hljs-number">4.0</span></span>])) &gt;&gt;&gt; simple_module2.my_sum(a.tolist()) <span class="hljs-number"><span class="hljs-number">10.0</span></span></code> </pre><br><br><h4>  Distribution of binary codes </h4><h4></h4><h5>  Windows </h5><br><br>  To use the generated Windows binary code on another system or run it without init.bat running, place the following files in a directory with the binary file: <br><br>  shedskin-0.9 \ shedskin \ gc.dll <br>  shedskin-0.9 \ shedskin-libpcre-0.dll <br>  shedskin-0.9 \ bin \ libgcc_s_dw-1.dll <br>  shedskin-0.9 \ bin \ libstdc ++. dll <br><br><h5>  UNIX </h5><br><br>  To use the generated binary file on another system, make sure that libgc and libpcre3 are installed there.  If this is not the case, and you cannot install them globally on the system, you can place copies of these libraries in the same directory as the binary, using the following commands: <br><br><pre> <code class="bash hljs">$ ldd <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> libgc.so.1 =&gt; /usr/lib/libgc.so.1 libpcre.so.3 =&gt; /lib/x86_64-linux-gnu/libpcre.so.3 $ cp /usr/lib/libgc.so.1 . $ cp /lib/x86_64-linux-gnu/libpcre.so.3 . $ LD_LIBRARY_PATH=. ./<span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> </pre><br><br>  Note that both systems must be 32-bit or 64-bit.  If this is not the case, Shed Skin must be installed on another system in order to rebuild the binary. <br><br><h4>  Multiprocessing </h4><br><br>  Suppose we have defined the following function in a file called meuk.py: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">part_sum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(start, end)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" calculate partial sum """</span></span> sum = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(start, end): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x % <span class="hljs-number"><span class="hljs-number">2</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>: sum -= <span class="hljs-number"><span class="hljs-number">1.0</span></span> / x <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: sum += <span class="hljs-number"><span class="hljs-number">1.0</span></span> / x <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sum <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: part_sum(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>)</code> </pre><br><br>  To translate this file into an extension module, enter: <br><br><pre> <code class="bash hljs"> shedskin -e meuk make</code> </pre><br><br>  To use the resulting extension module with the standard multiprocessing standard library module, simply add a Python wrapper: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> multiprocessing <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Pool <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">part_sum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(start, end)</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> meuk <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> meuk.part_sum(start, end) pool = Pool(processes=<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> sum(pool.map(part_sum, [(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">10000000</span></span>), (<span class="hljs-number"><span class="hljs-number">10000001</span></span>, <span class="hljs-number"><span class="hljs-number">20000000</span></span>)]))</code> </pre><br><br><h4>  Calling C / C ++ Code </h4><br><br>  To call the code in C / C ++, do the following: <br><br>  Give Shed Skin typing information using the C / C ++ code type model.  Suppose we need to call a simple function that returns a list of n smallest primes greater than a given number.  The following type model, contained in the stuff.py file, is sufficient for Shed Skin to perform type matching: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#stuff.py def more_primes(n, nr=10): return [1]</span></span></code> </pre><br><br>  To produce an actual type mapping, write a test program called test.py, which uses this type model, and then translate it: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#test.py import stuff print stuff.more_primes(100) shedskin test</span></span></code> </pre><br><br>  In addition to test.py, this code also translates stuff.py in C ++.  Now you can manually write C / C ++ code in the stuff.cpp file.  To avoid rewriting it during the next translation of the test.py file, move stuff. * To the lib / Shed Skin directory. <br><br><h5>  Standard library </h5><br><br>  By moving stuff. * To lib /, we actually added support for an arbitrary library module to Shed Skin.  Other programs broadcast by Shed Skin can now import our library and use more_primes.  In fact, in the lib / directory there are types and implementation models of all supported modules.  As you can see, some were partially converted to C ++ using Shed Skin. <br><br><h5>  Types of Shed Skin </h5><br><br>  Shed Skin reimplements Python's built-in types using its own C ++ class set.  They have the same interface as their Python colleagues, so they are easy to use (assuming you have a basic knowledge of C ++).  For details on class definitions, see the lib / builtin.hpp file.  If in doubt, convert similar Python code to C ++ and look at the result! <br><br><h4>  Command line options </h4><br><br>  The shedskin command supports the following options: <br><br><ul><li>  -a --ann Display commented source code (.ss.py) </li><li>  -b --nobounds Disable range checking </li><li>  -e --extmod Generate extension module </li><li>  -f --flags Set flags for Makefile </li><li>  -g --nogcwarns Disable runtime GC warnings </li><li>  -l --long Use whole long long ("64-bit") </li><li>  -m --makefile Specify a different Makefile name </li><li>  -n --silent Silent mode, show only warnings </li><li>  -o --noassert Disable assert statements </li><li>  -r --random Use fast random number generator (rand ()) </li><li>  -s --strhash Use fast string hashing algorithm (murmur) </li><li>  -w --nowrap Disable wrap-around checking </li><li>  -x --traceback Print traceback for uncaught exceptions. </li><li>  -L --lib Add library directory </li></ul><br><br>  For example, to translate the test.py file as a plug-in, enter shedskin ‚Äìe test or shedskin ‚Äì ‚Äìextmod test. <br><br>  The -b or --nobounds option is very often used because it disables out of range exceptions (IndexError), which can greatly affect performance. <br><br><pre> <code class="python hljs"> a = [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> a[<span class="hljs-number"><span class="hljs-number">5</span></span>] <span class="hljs-comment"><span class="hljs-comment"># invalid index: out of bounds</span></span></code> </pre><br><br><h4>  Performance Tips and Tricks </h4><br><h5>  Tips </h5><br><br>  Small allocations of memory (for example, creating a new tuple, list, or class instance) usually do not slow down the Python program much.  However, after translation in C ++, they often become a bottleneck.  This happens because for each allocation of memory, the memory is requested from the system, it must be cleared by the garbage collector, and a large number of subsequent allocations of memory are likely to cause an absence in the cache.  A key approach to high performance is often a reduction in the number of small allocations, for example, replacing a small generator expression with a cycle or eliminating intermediate tuples in some calculations. <br><br>  However, note that for idiomatic for a, b in enumerate (..), for a, b in enumerate (..) and for a, b in somedict.iteritems (), intermediate small objects are thrown away by the optimizer, and strings of length 1 cached <br><br>  Some features of Python (which can slow down the generated code) are not always necessary and can be turned off.  See the ‚ÄúCommand Line Options‚Äù section for details.  Turning off range checking is usually a very safe optimization and can greatly help in the case of code where an index operation is often used. <br><br>  Access through an attribute in the generated code is faster than taking by index.  For example, vx * vy * vz is faster than v [0] * v [1] * v [2]. <br><br>  Shed Skin takes the flags for the C ++ compiler from FLAGS * files in the directory where Shed Skin is installed.  These flags can be changed, or modified using a local file called FLAGS. <br><br>  With a large number of floating point calculations, it is not always necessary to follow the IEEE floating point specifications.  Adding the -ffast-math flag can significantly improve performance. <br><br>  Due to the profiling can squeeze even greater performance.  In the latest versions of GCC, first compile and execute the generated code with -fprofile-generate, and then with fprofile-use. <br><br>  For best results, configure the latest version of Boehm GC with CPPFLAGS = "- O3 -march = native" ./configure - enable-cplusplus - enable-threads = pthreads - enable-thread-local-alloc - enable-large -config --enable-parallel-mark.  The latter option allows the GC to use multiple processor cores. <br><br>  When optimizing, it is very useful to know how much time is spent in each part of your program.  The Gprof2Dot program can be used to create beautiful traffic for a single program, as well as for the original Python code.  OProfile can be used to profile an expansion module. <br><br>  To use Gprof2dot, download the gprof2dot.py file from the website and install Graphviz.  Then: <br><br><pre> <code class="bash hljs">shedskin program make program_prof ./program_prof gprof program_prof | gprof2dot.py | dot -Tpng -ooutput.png</code> </pre><br><br>  To use OProfile, install it and use it as follows. <br><br><pre> <code class="bash hljs">shedskin -e extmod make sudo opcontrol --start python main_program_that_imports_extmod sudo opcontrol --shutdown opreport -l extmod.so</code> </pre><br><br><h5>  Receptions </h5><br><br>  The following two code fragments work in the same way, but only the second is supported: <br><br><pre> <code class="python hljs">statistics = {<span class="hljs-string"><span class="hljs-string">'nodes'</span></span>: <span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-string"><span class="hljs-string">'solutions'</span></span>: set()} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">statistics</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> s = statistics(); s.nodes = <span class="hljs-number"><span class="hljs-number">28</span></span>; s.solutions = set()</code> </pre><br><br>  The order of calculating the arguments of a function or print statement changes during translation in C ++, so it is best not to count on it: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">'hoei'</span></span>, raw_input() <span class="hljs-comment"><span class="hljs-comment"># raw_input    'hoei'!</span></span></code> </pre><br><br>  Tuples with different element types and lengths&gt; 2 are not currently supported.  However, they can be emulated: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mytuple</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, a, b, c)</span></span></span><span class="hljs-function">:</span></span> self.a, self.b, self.c = a, b, c</code> </pre><br><br>  Block comments surrounded by # {and #}, Shed Skin ignores.  This feature can be used to comment on code that cannot be compiled.  For example, the following snippet will display a dot only when running under CPython: <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"x ="</span></span>, x <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"y ="</span></span>, y <span class="hljs-comment"><span class="hljs-comment">#{ import pylab as pl pl.plot(x, y) pl.show() #}</span></span></code> </pre><br>  Version 0.9.4, June 16, 2013, Mark Dufour and James Coughlan </div><p>Source: <a href="https://habr.com/ru/post/194650/">https://habr.com/ru/post/194650/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../194640/index.html">Centrifuge is gaining momentum</a></li>
<li><a href="../194642/index.html">The age of our galaxy</a></li>
<li><a href="../194644/index.html">Winter, a smartphone and gloves, or prepare your finger in the summer ...</a></li>
<li><a href="../194646/index.html">Peachy Printer - another 3D printer with a kickstarter or a new player in the market?</a></li>
<li><a href="../194648/index.html">The traffic compression feature has been added to Google Chrome for iOS</a></li>
<li><a href="../194654/index.html">Apple iPhone 5s: autopsy, comparison with previous generations and maintainability assessment</a></li>
<li><a href="../194658/index.html">Reading Java configuration files: nProperty</a></li>
<li><a href="../194660/index.html">Articles from businessmen from Silicon Valley. Alexey Fedoseev: ‚ÄúA brave and new, but not very clear world (part 1)‚Äù</a></li>
<li><a href="../194662/index.html">Nintendo story led by Hiroshi Yamauchi</a></li>
<li><a href="../194664/index.html">Parse the x.509 certificate</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>