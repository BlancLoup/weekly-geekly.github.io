<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Google's Faces API Example</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not so long ago, Google released version 7.8 of the Google Play Services library. Among the major innovations, there is a new Mobile Vision API consis...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Google's Faces API Example</h1><div class="post__text post__text-html js-mediator-article">  Not so long ago, Google released version 7.8 of the Google Play Services library.  Among the major innovations, there is a new Mobile Vision API consisting of two large components: Barcode API for scanning and recognizing various barcode and QR codes and the updated Faces API for searching and tracking faces in pictures.  Under the cat we will get acquainted with the Faces API, consider its main features and write a small application. <br><a name="habracut"></a><br>  The Faces API provides the ability to detect and track human faces on the finished images and streams coming from the camera of the device.  It copes with this task quite tolerably: <br><br> <a href=""><img src="https://habrastorage.org/files/1cd/074/6cb/1cd0746cb310400fa1644a5cf4aabde2.jpg"></a> <br><br>  Although in complex cases the algorithm may fail: <br><table><tbody><tr><td> <a href=""><img src="https://habrastorage.org/files/38f/fdb/ee5/38ffdbee530a4a75ae01737f9e4599cb.jpg" width="100%"><br></a> <br>  First kind error <br></td><td> <a href=""><img src="https://habrastorage.org/files/126/275/741/126275741d3a40d29a59a853b1364d32.jpg" width="100%"><br></a> <br>  Second kind error <br></td></tr></tbody></table><br>  In addition to simple tracking, the library can determine the orientation of a person in space, calculate the position of the main points of the face (nose, eyes, corners of the mouth) and produce the simplest recognition: determine the likelihood that a person‚Äôs eyes are open and the probability of a smile: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <a href=""><img src="https://habrastorage.org/files/3d9/986/d9b/3d9986d9bf7e44c892e0f5517fad03ed.jpg"></a> <br><br>  But enough of the introduction, let's move on to practice.  Every minute, Instagram users upload <a href="http://www.dailymail.co.uk/sciencetech/article-2381188/Revealed-happens-just-ONE-minute-internet-216-000-photos-posted-278-000-Tweets-1-8m-Facebook-likes.html">216 thousand photos</a> .  With a finger pointing to the sky, suppose that 40% of them are selfies.  Same 1440 pieces per second!  Let's try to join the trend and make a small application to automate self.  Few mines like sour mines, so we will only shoot smiling faces.  The attentive reader will ask, what's the automation?  It's simple: in order not to force users to search by touch the shutter button, we will automatically take a picture after a person just winks at the camera. <br><br>  As a basis we will use the official <a href="https://github.com/googlesamples/android-vision">examples of the Vision API</a> from Google.  For simplicity, the issues of drawing frames from the camera are omitted.  Interested people can look at the <a href="https://github.com/nesterov-n/Smiley">sources on the githaba</a> . <br><br>  To connect the Faces API to your project, simply add a dependency in the gradle script: <br><br><pre><code class="java hljs">compile <span class="hljs-string"><span class="hljs-string">'com.google.android.gms:play-services-vision:7.8.0'</span></span></code> </pre> <br>  To start, make a copy of the detector.  Selfies are most often individual cases, so we‚Äôll only track the face of one person: <br><br><pre> <code class="java hljs">FaceDetector detector = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FaceDetector.Builder(context) <span class="hljs-comment"><span class="hljs-comment">//       .setClassificationType(FaceDetector.ALL_CLASSIFICATIONS) //  ""    .setProminentFaceOnly(true) .setTrackingEnabled(true) .build();</span></span></code> </pre><br>  Create the "brains" of our detector - processing algorithm.  The detector needs a factory that will create an instance of the handler for each face found.  <s>Using a pile of antics in front of the phone‚Äôs front camera,</s> it was empirically defined: a more or less adequate smile in a photo is 0.4 and higher, and a wink can be formalized like this: ‚Äúthe probabilities that the eyes are open, for the right and left eyes, differ by more than 0.6‚Äù .  Well, let's implement this algorithm in our handler: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GraphicFaceTracker</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tracker</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Face</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onUpdate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(FaceDetector.Detections&lt;Face&gt; detectionResults, Face face)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> isSmiling = face.getIsSmilingProbability() &gt; <span class="hljs-number"><span class="hljs-number">0.4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isSmiling) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> leftEye = face.getIsLeftEyeOpenProbability(); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> rightEye = face.getIsRightEyeOpenProbability(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Math.abs(leftEye - rightEye) &gt;= <span class="hljs-number"><span class="hljs-number">0.6</span></span>) { takeShot(); <span class="hljs-comment"><span class="hljs-comment">//   } } } } private class GraphicFaceTrackerFactory implements MultiProcessor.Factory&lt;Face&gt; { @Override public Tracker&lt;Face&gt; create(Face face) { return new GraphicFaceTracker(); } }</span></span></code> </pre><br>  We give our detector a copy of the factory: <br><br><pre> <code class="java hljs"> GraphicFaceTrackerFactory trackerFactory = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GraphicFaceTrackerFactory(); MultiProcessor&lt;Face&gt; processor = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MultiProcessor.Builder&lt;&gt;(trackerFactory).build(); detector.setProcessor(processor);</code> </pre><br>  Now all that is left is to simply create and launch a stream from the camera.  <b>Important!</b>  Do not forget to stop the camera correctly when we no longer need it.  Otherwise, the camera will remain locked, and no application will have access to it until the phone reboots. <br><br><pre> <code class="java hljs">CameraSource cameraSource = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CameraSource.Builder(context, detector) .setFacing(CameraSource.CAMERA_FACING_FRONT) .build().start();</code> </pre><br>  So.  Compile.  We start.  We try on colleagues.  <s>Everything is working.</s>  Rule the bugs.  We try on colleagues.  Everything is working. <br><br><img src="https://habrastorage.org/files/a9e/7b4/a1c/a9e7b4a1c1274c858e7d61575c7ef7d5.jpg"><br><br>  In general, the Faces API leaves a pleasant impression for both the developer and the user.  Developers will enjoy the simplicity and ease of development, and users will like the speed and quality of work.  We are waiting in the Play Store even more applications with face recognition. <br><br>  Useful links: <br>  <a href="https://developers.google.com/android/reference/com/google/android/gms/vision/face/package-summary">Google Documentation</a> <br>  <a href="https://github.com/nesterov-n/Smiley">Application sources</a> </div><p>Source: <a href="https://habr.com/ru/post/266885/">https://habr.com/ru/post/266885/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../266873/index.html">Functional C #: Immutability</a></li>
<li><a href="../266877/index.html">Git for a professional programmer</a></li>
<li><a href="../266879/index.html">Grandstream GVC 3200 Video Conferencing Solution Review - ‚ÄúIt Changes Everything‚Äù</a></li>
<li><a href="../266881/index.html">Using Java 8 Libraries for Android Applications with Maven</a></li>
<li><a href="../266883/index.html">How Russian cloud services for business inhibit their own market</a></li>
<li><a href="../266891/index.html">Inoventica Services on Habr√©</a></li>
<li><a href="../266893/index.html">Creating a native iOS plugin for Unity3d. Undocumented features</a></li>
<li><a href="../266895/index.html">HTML5 customization customization element</a></li>
<li><a href="../266897/index.html">Implementing a pseudo-random number generator on a FPGA using Vivado HLS 2014.4</a></li>
<li><a href="../266899/index.html">Reinforced.Typings is a library for automatically generating TypeScript-taipings and not only</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>