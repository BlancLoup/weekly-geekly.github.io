<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The difficulty of finding errors in scientific applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is a continuation of a note on why unit tests work poorly in scientific applications; and in this article I want to talk about the difficulties o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The difficulty of finding errors in scientific applications</h1><div class="post__text post__text-html js-mediator-article">  This is a continuation of a <a href="http://habrahabr.ru/blogs/development/92038/">note</a> on why unit tests work poorly in scientific applications;  and in this article I want to talk about the difficulties of finding errors and debugging (scientific applications) that I once faced, and many of which were amazing for me as a web developer. <br><a name="habracut"></a><br><br>  The article will consist of several sections: <br><ol><li>  Introduction, for order </li><li>  Difficulty finding errors <br><ul><li>  Parallelism </li><li>  Error locality </li><li>  Non-obvious typos </li><li>  The impact of the setting on the result </li><li>  Error Identification: Error Or Not? </li></ul><br></li><li>  Conclusion </li></ol><br><h4>  Introduction </h4><br>  The main purpose of this article is to describe one‚Äôs own experience in the hope that it will be interesting and unusual to someone (especially, I think, to industrial programmers);  Perhaps someone can better prepare for writing diplomas / coursework / laboratory.  The preamble, the formulation of a scientific problem, a brief description of the algorithm can be found in the aforementioned article [1].  Therefore, I will immediately turn to the presentation of those unusual (for example, for web developers) difficulties in finding errors, in order to broaden the horizons of readers and consciousness in general. <br><br><h4>  Difficulty finding errors </h4><br><h5>  Parallelism </h5><br>  This is an exceptionally short point for completeness, in which I will once again mention that in parallel programs it is much more difficult to find errors and perform debugs than in single-stream ones.  And most resource-intensive scientific programs are parallel. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Error locality </h5><br>  Here I mean that an error in the code of one class can manifest itself in completely unexpected places.  And the point is not in the poor application architecture and high connectivity of the modules, but in the features of the tasks and modeling.  For example, if when modeling a fluid flow in a pipe, the velocity profile is distorted at the walls, this does not mean that the error is in the wall calculation algorithm, it can be anywhere.  And vice versa, if the density is distributed strangely in the thickness of the liquid, this does not mean that the matter is not in the algorithm for calculating the walls. <br><br>  Compare this with a typical business application scenario: if product discounts are calculated incorrectly in online store purchases, the error is almost certainly hidden in the product discount calculation code. <br><br>  It can be argued that it is easy to identify the source of the error from the change history.  Like, as soon as the application stopped working, you need to look for the error in the modified code.  However, this approach is not applicable to parts of the program that were added for the first time (for example, adding heat transfer, new boundary conditions, etc.), because there is no previous working version (heat transfer, given boundary conditions, etc.). <br><br>  In addition, errors in scientific applications may not manifest for a long time.  For example, if when adding a new type of boundary conditions, the Poiseuille flow [2], driven by force, not pressure gradient, suddenly ceased to be correctly modeled, it may turn out that this is not a matter of the new boundary conditions algorithm, but the logic of taking into account external force, before that, the error was not critical.  (see also the item ‚ÄúSlow error rate‚Äù in [1]). <br><br><h5>  Non-obvious typos </h5><br>  One of the problems of scientific algorithms is that they are often not obvious.  Even if you create a program with a beautiful architecture, if you allocate a special class for the algorithm, design it well and write it, you probably will not be able to avoid several problems. <br><br>  First, these are meaningless variable names (because these are auxiliary variables from the original scientific article that do not carry a semantic load).  Secondly, these are unobvious operations on class variables (because they are also taken from the original article, which were obtained using dark magic methods such as optimization of standard deviation, Fredholm alternative, calculation of spatial density harmonics, etc.). <br><br>  If you debug a business application and see a line like <br>  bool categoryIsVisible = categoryIsEnabled ||  productsCount&gt; 0; <br>  then you will immediately notice a typo, because the condition must have a logical "AND". <br><br>  But imagine that you came across a line (from a real project) <br>  double probability = latticeVectorWeight * density * (1.0 + 3.0 * dotProduct + 9.0 / 2.0 * dotProduct * dotProduct - 3.0 / 2.0 * velocitySquare); <br>  It is unlikely that you will determine that you have mixed up somewhere plus and minus.  And, by the way, the variable names here are meaningful. <br><br><h5>  The impact of the setting on the result </h5><br>  At this point, I will try to explain that the work of scientific applications is much stronger (compared to business applications) depends on the input data, the system parameters, its initial state ‚Äî that is, the system setting. <br><br>  The main sources of dependency on the setting are as follows. <br><br>  1. The parameters of the system greatly (qualitatively) affect the result of the program, unlike business applications, where the parameters usually affect only quantitatively (for example, the work of the CMS will not fundamentally depend on whether the administrator adds five or ten lines) <br><br>  2. The smaller area of ‚Äã‚Äãstability of the algorithms for the input data.  In business applications, the main limitation on data is the absence of overflow errors (and who is paying attention to it ?!).  In scientific algorithms (one of the differences in which is to work with sets of greater power), you need to remember about stability (and after this, the rigidity of differential equations, theory of stability, Lyapunov indicators, etc.) and follow it.  In addition, in business applications, all restrictions are deterministic (they say, the name during registration cannot be longer than 100 characters, email must correspond to a certain regular expression), while in scientific tasks it is often necessary to use trial and error to determine the working range of input data. <br><br>  3. Everything else (difficult to formalize for now).  In particular, it is the conversion of units of measurement from physical to units of measurement for a program. <br><br>  To illustrate these aspects, I will demonstrate the checklist, which I compiled for myself after weeks of vain debagging an application for modeling hydrodynamics.  If I could not find an error in several hours / days of step-by-step execution, I checked with this checklist. <br><br>  Attention!  It is somewhat far from the subject of Habr and the interests of the majority of readers, so that you can skip it if you wish and go on to the next item. <br>  So checklist: <br><ol><li>  Check incompressibility </li><li>  Check Reynolds numbers </li><li>  Check the transfer of values </li></ol><br>  The first of these points means that the algorithm works only in a weakly compressible fluid, which is equivalent to its low velocities (much less than the speed of sound in a fluid) (after all, the flow is induced by a density gradient).  When I forgot about this restriction for the first time, I spent several days searching for errors in the code, because the program seemed to work almost correctly. <br><br>  The second of points is equivalent to checking the stability domain of the algorithm.  The fact is that the Reynolds number determines how much fluid motion is turbulent and unstable [3].  The larger it is, the more unstable the current, the less - the more "viscous".  It turns out that even if the motion is never physically turbulent (again, in the Poiseuille flow), the calculations begin to diverge at sufficiently large Reynolds numbers.  Of course, until I stepped on this rake (and I didn‚Äôt look like a week), I didn‚Äôt think about tracking the area of ‚Äã‚Äãsustainability. <br><br>  The third item is specific only to physical calculations and some algorithms.  The method used accepts input physical quantities in special lattice units (when the unit of length is the step of the uniform spatial lattice, and the unit of time is proportional to it).  Until I came across a special article [4] devoted to the transfer of values ‚Äã‚Äãin this method, I unsuccessfully tried for several weeks to understand why the program behaves not quite correctly. <br><br>  It is worth noting that the second and third points barely allow automatic checking. <br><br><h5>  Error Identification: Error Or Not? </h5><br>  This problem is completely unimaginable in business applications;  and it lies in the fact that it is often impossible to say for sure whether a deviation in the program‚Äôs behavior (from the expected one) is an error. <br><br>  For example, it is known that the velocity profile when a viscous fluid flows through a cylindrical tube will be parabolic [2].  Nevertheless, suppose that in modeling, the fluid at the pipe walls flows a little faster than it should.  Options are usually considered the following: <br><ol><li>  this is actually a mistake </li><li>  this is a feature of the algorithm </li><li>  this is a consequence of incorrect or inappropriate for the algorithm input data (initial conditions, physical parameters) (see. "The influence of the setting on the result") </li></ol><br>  Verification through unit testing of the first item is complicated by the difficulties of writing unit tests in such applications [1]. <br><br>  The second point in this example is easy to check by replacing the wall calculation algorithm.  However, it may turn out that modeling with a new method also leads to distorted results.  In this case, you can try a couple more algorithms (if they exist in principle, and if you have time to look for them, disassemble and implement them). <br><br>  Checking the third point, unfortunately, is not so trivial.  One option is to try to change the input parameters and the system setting to determine if there is an area in the initial data phase space in which the program works.  Sadly, this is not so simple, because the number of degrees of freedom in the initial conditions is very large in complex modeling (different physical parameters can be set, such as viscosity and thermal conductivity; the initial distribution of velocities, forces, densities in the entire system, etc.) .  For example, in the test with the flow of liquid through the pipe, it took me several days to try to start modeling not with a stationary velocity distribution, but with a stationary liquid, which was subsequently accelerated by constant force ‚Äî and the error disappeared! <br><br><h4>  Conclusion </h4><br>  Here, in fact, all the difficulties of finding errors, which I wanted to talk about.  If someone has thoughts on how to avoid or effectively cope with such effects, I will be glad to hear them. <br><br>  Thanks for reading! <br><br><h6>  References: </h6><br>  [1] <a href="http://habrahabr.ru/blogs/development/92038/">Why unit tests do not work in scientific applications</a> <br>  [2] <a href="http://en.wikipedia.org/wiki/Hagen%25E2%2580%2593Poiseuille_equation">Poiseuille Stream</a> <br>  [3] <a href="http://en.wikipedia.org/wiki/Reynolds_number">Reynolds number</a> <br>  [4] <a href="http://www.lbmethod.org/_media/howtos:lbunits.pdf">Conversion of values ‚Äã‚Äãto LBM</a> </div><p>Source: <a href="https://habr.com/ru/post/93570/">https://habr.com/ru/post/93570/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../93559/index.html">Sviaz-Expocomm 2010 through our eyes: photo report</a></li>
<li><a href="../93560/index.html">Tunerr - chromatic online guitar tuner</a></li>
<li><a href="../93563/index.html">Ekaterinburg, St. Petersburg, Penza - Startup Point is coming to you!</a></li>
<li><a href="../93565/index.html">Yota in Irkutsk</a></li>
<li><a href="../93568/index.html">I want to do hosting, the essence is ...</a></li>
<li><a href="../93572/index.html">MODx and Vbulletin 3.8.x - peace, friendship, chewing gum</a></li>
<li><a href="../93573/index.html">A robot from a DNA molecule could walk about 50 steps.</a></li>
<li><a href="../93577/index.html">Quiet Guitar</a></li>
<li><a href="../93581/index.html">UMI CMS + RBK Money inside</a></li>
<li><a href="../93583/index.html">Caught Neo (Universal IT soldier)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>