<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SQL injection. Check, hacking, protection</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="SQL injection is one of the most accessible ways to hack a site. 
 The essence of such injections is the injection of arbitrary SQL code into the data...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SQL injection. Check, hacking, protection</h1><div class="post__text post__text-html js-mediator-article">  <b>SQL injection</b> is one of the most accessible ways to hack a site. <br>  The essence of such injections is the injection of arbitrary SQL code into the data (transmitted via GET, POST requests or Cookie values).  If the site is vulnerable and performs such injections, then in fact there is an opportunity to create from the database (most often it is MySQL) anything. <br><br><h3>  How to calculate a vulnerability that allows to introduce SQL injections? </h3><br>  Pretty easy.  For example, there is a test site <a href="http://test.ru/">test.ru.</a>  The site displays a list of news, with the possibility of a detailed view.  The address of the page with a detailed description of the news is as follows: <a href="http://test.ru/%3Fdetail%3D1">test.ru/?detail=1</a> .  Ie, through the GET request, the detail variable passes the value 1 (which is the identifier of the entry in the news tabica). <br><a name="habracut"></a><br>  We change the GET request to <code>?detail=1'</code> or <code>?detail=1"</code> Next we try to send these requests to the server, that is, we go to <a href="http://test.ru/%3Fdetail%3D1">test.ru/?detail=1</a> ' or to <a href="http://test.ru/%3Fdetail%3D1">test.ru/?detail=1</a> ". <br><br>  If an error occurs on entering these pages, then the site is vulnerable to SQL injections. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>An example of an error that occurs when checking a vulnerability</i> <br><img src="https://habrastorage.org/getpro/habr/post_images/98c/b32/191/98cb321919ea63fc4524e5e885896a83.jpg" alt="image"><br><br>  <b>Possible SQL injections (SQL deployments)</b> <br>  1) The simplest is to minimize the WHERE condition to a true result for any parameter values. <br>  2) Attach to the query results of another query.  This is done through the UNION operator. <br>  3) Comment out part of the request. <br><br><h3>  Practice.  Options for hacking a site with a vulnerability to SQL injection </h3><br>  So, we have the already mentioned site <a href="http://test.ru/">test.ru.</a>  The database stores 4 news, 3 of which are displayed.  Permission to publish news depends on the public parameter (if the parameter contains the value 1, then the news is published). <br><br>  <i>List of permitted news</i> <br><img src="https://habrastorage.org/getpro/habr/post_images/d26/ea2/0b7/d26ea20b7eaa192eac01ffc180c62e66.jpg" alt="image"><br><br>  When accessing the page <a href="http://test.ru/%3Fdetail%3D4">test.ru/?detail=4</a> , which should display the fourth news, an error appears - the news was not found. <br>  In our case, the news exists, but it is prohibited for publication. <br><img src="https://habrastorage.org/getpro/habr/post_images/968/a44/6b7/968a446b76347ad0edab65196f37e8e7.jpg" alt="image"><br><br>  But since we already checked the site for vulnerability and it gave out a database error, then we try to sort out possible variants of requests. <br>  In the address bar, plus (+) plays the role of a space, so do not be scared <br><br>  <b>I'm testing the following options:</b> <br>  <a href="http://test.ru/%3Fdetail%3D4%2BOR%2B1">test.ru/?detail=4+OR+1</a> <br>  <a href="http://test.ru/%3Fdetail%3D4%2B--">test.ru/?detail=4+--</a> <br>  <a href="http://test.ru/%3Fdetail%3D4%2BUNION%2BSELECT%2B">test.ru/?detail=4+UNION+SELECT+</a> * + FROM + news + WHERE + id = 4 <br><br>  As a result, luck smiled and two requests (first and third) returned us a detailed description of the fourth news. <br><img src="https://habrastorage.org/getpro/habr/post_images/32e/a51/6c8/32ea516c8d15554506911bd78ec30ba3.jpg" alt="image"><br><br><h3>  Parse example from the inside </h3><br>  A block of code answers for receiving a detailed description of the news: <br> <code>$detail_id=$_GET['detail']; <br> $zapros="SELECT * FROM `$table_news` WHERE `public`='1' AND `id`=$detail_id ORDER BY `position` DESC";</code> <br> <br>  Not only does $ detail_id get the value without any processing, so the `id` = $ detail_id construct is crooked, it‚Äôs better to stick with` id` = '$ detail_id' (that is, write the comparison value in direct apostrophes). <br><br>  Looking at the request received when accessing the page through <code><a href="http://test.ru/%3Fdetail%3D4%2BOR%2B1"></a> test.ru/?detail=4+OR+1 <br> <br> SELECT * FROM `news` WHERE `public`='1' AND `id`=4 OR 1 ORDER BY `position` DESC</code> <br> <br>  it is not entirely clear why the 4th news was displayed.  The fact is that the query returned all the entries from the news table, sorted in descending order from above.  And so our fourth news was the very first, and it also came out as detailed.  Ie just a coincidence. <br><br>  Parse the request generated when accessing through <code><a href="http://test.ru/%3Fdetail%3D4%2BUNION%2BSELECT%2B"></a> test.ru/?detail=4+UNION+SELECT+*+FROM+news+WHERE+id=4</code>  <code><a href="http://test.ru/%3Fdetail%3D4%2BUNION%2BSELECT%2B"></a> test.ru/?detail=4+UNION+SELECT+*+FROM+news+WHERE+id=4</code> . <br><br>  Here the name of the table with the news (in our case, this news) was taken as a logical search. <br>  So, the query <code>SELECT * FROM `news` WHERE `public`='1' AND `id`=4 UNION SELECT * FROM news WHERE id=4 ORDER BY `position` DESC</code> .  The zero result of the first part of the request (before UNION) was joined by the result of the second part (after UNION), which returned a detailed description of the 4th news. <br><br><h3>  Protection against SQL injections (SQL implementations) </h3><br>  Protection against hacking comes down to the basic rule of "trust but verify."  You need to check everything - numbers, strings, dates, data in special formats. <br><br><h5>  Numbers </h5><br>  To check a variable for a numeric value, the function is_numeric (n); is used, which returns true if the parameter n is a number, and false otherwise. <br>  You can also not check the value for a number, but manually override the type.  Here is an example that overrides the $ id value obtained from $ _GET ['id_news'] to an integer type value (as an integer): <br> <code>$id=(int)$_GET['id_news'];</code> <br> <br><h5>  Strings </h5><br>  Most hacking through SQL occur due to the presence of quotes, apostrophes, and other special characters in the rows.  For this deactivation, you need to use the addslashes ($ str); function, which returns the string $ str with an added backslash (\) before each special character.  This process is called adaptation. <br><br> <code>$a="    ' "; <br> echo addslashes($a); // :     \'</code> <br> <br>  In addition, there are two functions created specifically for the adaptation of strings used in SQL expressions. <br>  This is mysql_escape_string ($ str);  and mysql_real_escape_string ($ str) ;. <br><br>  The first one does not take into account the coding of the connection with the database and can be bypassed, but the second one takes it into account and is absolutely safe.  mysql_real_escape_string ($ str);  returns the string $ str with a backslash added to the following characters: <code>\x00, \n, \r, \, ', "  \x1a</code> . <br><br><h3>  Magic quotes </h3><br>  Magic Quotes - The effect of automatically replacing quotes with backslash (\) and quotation marks during I / O operations.  In some PHP configurations, this option is enabled, but not in some.  In order to avoid double-shielding of characters and screen the data in a normal way through mysql_real_escape_string ($ str);, it is necessary to remove the automatically inserted backslashes (if magic quotes are included). <br><br>  Checking the inclusion of magic quotes for data obtained from GET, POST or Cooks is organized via the <code>get_magic_quotes_gpc();</code> function <code>get_magic_quotes_gpc();</code>  (returns 1 - if magic quotes are on, 0 - if disabled). <br><br>  If magic quotes are included (that is, back slashes are added) and this happens more often, they should be removed.  This is done through the stripslashes ($ str) function;  (returns the string $ str without backslashes for quotes and direct apostrophes). <br><br>  In conclusion, I cite the code with full string adaptation for writing to the database. <br><br> <code>if(get_magic_quotes_gpc()==1) <br> { <br> $element_title=stripslashes(trim($_POST["element_title"])); <br> $element_text=stripslashes(trim($_POST["element_text"])); <br> $element_date=stripslashes(trim($_POST["element_date"])); <br> } <br> else <br> { <br> $element_title=trim($_POST["element_title"]); <br> $element_text=trim($_POST["element_text"]); <br> $element_date=trim($_POST["element_date"]); <br> } <br> <br> $element_title=mysql_real_escape_string($element_title); <br> $element_text=mysql_real_escape_string($element_text); <br> $element_date=mysql_real_escape_string($element_date);</code> <br> <br>  <i>The article was prepared on the basis of practical skills for the protection of web systems.</i>  <i>The theory is a good thing, but the practice is more important and most importantly it works.</i> </div><p>Source: <a href="https://habr.com/ru/post/130826/">https://habr.com/ru/post/130826/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../130820/index.html">The design of the site Open Font Library has changed</a></li>
<li><a href="../130821/index.html">What are the most effective methods of motivating IT staff?</a></li>
<li><a href="../130822/index.html">History, part 1. How it all began: LG from 1947 to 1980</a></li>
<li><a href="../130824/index.html">Training IT specialists in Serbia</a></li>
<li><a href="../130825/index.html">iPhone 4S, Galaxy Nexus - the choice is obvious?</a></li>
<li><a href="../130827/index.html">Whitelisting: about technology, its market prospects and utility for the company</a></li>
<li><a href="../130829/index.html">Basics of email targeting and segmentation</a></li>
<li><a href="../130830/index.html">Functional thinking: Thinking functionally, Part 2</a></li>
<li><a href="../130831/index.html">CodeSniffer and PhpEd</a></li>
<li><a href="../130832/index.html">Fifth habrae</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>