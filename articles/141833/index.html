<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Routes on Google Maps in your Android application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not so long ago, I needed to write an application that would show the route between two given points on the map. As a tool were selected maps from Goo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Routes on Google Maps in your Android application</h1><div class="post__text post__text-html js-mediator-article">  Not so long ago, I needed to write an application that would show the route between two given points on the map.  As a tool were selected maps from Google.  After a brief search, articles were found about the <a href="http://habrahabr.ru/post/131252/">integration of maps</a> into the application, about <a href="http://habrahabr.ru/post/139929/">pin filtering</a> , about <a href="http://habrahabr.ru/post/52009/">routes</a> .  However, there was no article describing how to make such routes in the Android application, and I decided to correct this omission (for new developers for Android, it will come in handy).  Welcome under habrakat. <a name="habracut"></a><br><br>  Suppose we have already read an article about integration, got an API-Key, and wrote an application with a map with two points marked on it.  Therefore, it only remains for us to lay a route between two given points. <br><br><h4>  Getting a route </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      First of all, you need to send a request and get a file with the route data.  To do this, we will need to open the connection by the specified link (the latitude and longitude in the link are separated by commas) and receive the data in the form of XML.  We will pull out the route points from the file, we will be the DOM parser, for which we create the Document object. <br><br> <code>String urlString = "http://maps.google.com/maps?f=d&amp;hl=en&amp;saddr=" + startGeoPoint + "&amp;daddr=" + stopGeoPoint + "&amp;ie=UTF8&amp;0&amp;om=0&amp;output=kml"; <br> Document document = null; <br> HttpURLConnection urlConnection = null; <br> URL url = null; <br> try { <br> url = new URL(urlString); <br> urlConnection = (HttpURLConnection) url.openConnection(); <br> urlConnection.connect(); <br> DocumentBuilderFactory documentBuildFactory = DocumentBuilderFactory.newInstance(); <br> DocumentBuilder documentBuilder = documentBuildFactory.newDocumentBuilder(); <br> document = documentBuilder.parse(urlConnection.getInputStream()); <br> } catch (Exception e) { } <br></code> <br><br>  Following the KML <a href="https://developers.google.com/kml/documentation/">documentation</a> , the route consists of smaller segments, so we have to create an array of points through which our route will pass.  Details on parsing the XML file can be found in <a href="http://habrahabr.ru/post/115054/">this</a> article.  It is worth noting that the points are in the body of the "coordinates" tag, which, in turn, is inside the "LineString". <br><br> <code>String points = null; <br> NodeList nodeList = document.getElementsByTagName("LineString"); <br> points = nodeList.item(0).getFirstChild().getFirstChild().getNodeValue(); <br> String[] finalArray = points.split(" "); <br></code> <br><br>  On this receipt of the coordinates for which the route will be built is completed.  Moving on to drawing the line itself. <br><br><h4>  Overlay route lines </h4><br><br>  This class inherits Overlay and is (roughly speaking) a graphic level that will be displayed on the map.  In this class, we will create a constructor through which we will set the start and end points of the line, and we will add a draw method that will draw this line. <br><br> <code>private GeoPoint start; <br> private GeoPoint stop; <br> public MapOverlay(GeoPoint start, GeoPoint stop) { <br> this.start = start; <br> this.stop = stop; <br> } <br> <br> @Override <br> public boolean draw(Canvas canvas, MapView mapView, boolean shadow, long when) { <br> // TODO Auto-generated method stub <br> Projection projection = mapView.getProjection(); <br> if (shadow == false) { <br> Paint paint = new Paint(); <br> paint.setAntiAlias(true); <br> Point point = new Point(); <br> projection.toPixels(start, point); <br> paint.setColor(Color.BLUE); <br> Point point2 = new Point(); <br> projection.toPixels(stop, point2); <br> paint.setStrokeWidth(2); <br> canvas.drawLine((float) point.x, (float) point.y, (float) point2.x, (float) point2.y, paint); <br> } <br> return super.draw(canvas, mapView, shadow, when); <br> } <br></code> <br><br>  And now we need to write a method that will add points to this level, creating our route. <br><br><h4>  Creating a route </h4><br><br>  If you have reached this point, then, most likely, you know that GeoPoint first indicates the latitude, then the longitude. <br><br> <code>String coords = finalArray[0].split(","); <br> GeoPoint start = new GeoPoint((int) (Double.parseDouble(coords[1]) * 1E6), (int) (Double.parseDouble(coords[0]) * 1E6)); <br> //       ,     ,      ,       <br> mapView.getOverlays().add(new MapOverlay(start, start)); <br> GeoPoint geoPoint1; <br> GeoPoint geoPoint2 = start; <br> for (int i = 1; i &lt; finalArray.length; i++) { <br> coords = finalArray[i].split(","); <br> geoPoint1 = geoPoint2; <br> geoPoint2 = new GeoPoint((int) (Double.parseDouble(coords[1]) * 1E6), (int) (Double.parseDouble(coords[0]) * 1E6)); <br> mapView.getOverlays().add(new MapOverlay(geoPoint1, geoPoint2)); <br> } <br> mapView.getOverlays().add(new MapOverlay(geoPoint2, geoPoint2)); <br></code> <br><br>  This completes the creation of the route.  Thanks for attention.  As an example, I will give a screenshot of what happened to me. <br><br><img src="http://habrastorage.org/storage2/28c/6ef/772/28c6ef7728fd3303cfd27ef6cd1220e3.png"><br><br>  PS This is my first article, so please do not judge strictly, since I don‚Äôt have much experience writing articles, and the code was explained only with words and on fingers. </div><p>Source: <a href="https://habr.com/ru/post/141833/">https://habr.com/ru/post/141833/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../141826/index.html">Tim Cook will open the D10 conference</a></li>
<li><a href="../141827/index.html">The simplest compression algorithms: RLE and LZ77</a></li>
<li><a href="../141829/index.html">Samba <3.6.4 (CVE-2012-1182) remote execution of arbitrary code with root-rights</a></li>
<li><a href="../141830/index.html">How Instagram prepared for the launch of the Android application</a></li>
<li><a href="../141832/index.html">Google Chrome 19 introduces open tabs sync.</a></li>
<li><a href="../141834/index.html">Meteor - A new way to create applications</a></li>
<li><a href="../141835/index.html">Disassembly of the Nikon D5100 DSLR and 18-55mm lens</a></li>
<li><a href="../141839/index.html">Linux Hacking Exercises</a></li>
<li><a href="../141840/index.html">Meetup Stack Overflow in Moscow</a></li>
<li><a href="../141841/index.html">–ódMax: create a clip with space scenes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>