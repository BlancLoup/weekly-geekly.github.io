<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Kali Linux: Configuring and building ISO images</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Downloading Kali Linux from removable media is useful in many situations. In the simplest form, such a medium, in the format of a DVD or flash drive, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Kali Linux: Configuring and building ISO images</h1><div class="post__text post__text-html js-mediator-article">  Downloading Kali Linux from removable media is useful in many situations.  In the simplest form, such a medium, in the format of a DVD or flash drive, is created using a standard ISO image of the system.  However, much more features are provided by assembling your own images and creating bootable media with a permanent data storage.  In addition, sometimes images of a system that are configured in a special way can be useful.  The third and fourth sections of the ninth chapter of the book ‚Äú <a href="https://kali.training/introduction/kali-linux-revealed-book/">Kali Linux Revealed</a> ‚Äù, the translations of which we publish in this material, are devoted to all this. <br><br> <a href="https://habrahabr.ru/company/ruvds/blog/341882/"><img src="https://habrastorage.org/webt/m-/jk/s8/m-jks8sgbnzfvx3zx6pdl7jjlsa.jpeg"></a> <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">9.3.</font>  <font color="#3AC1EF"><b>Build your own Kali Linux ISOs</b></font> </h2><br>  The standard version of Kali Linux is flexible and has many features.  Immediately after its installation, you can begin to solve many difficult problems.  Of course, some level of knowledge of the tools included in the distribution, creativity, patience and experience will not hurt here.  However, the image of Kali can be customized, including in it what is needed, or removing the excess, to set automatic execution of any actions during the system boot. <br><br>  Among the examples of such special images are the <a href="https://www.offensive-security.com/kali-linux/kali-linux-iso-of-doom">Kali ISO of Doom</a> and <a href="https://www.offensive-security.com/kali-linux/kali-linux-evil-wireless-access-point/">Kali Evil Wireless Access Point</a> , the most interesting projects that rely on custom-made Kali Linux implementations.  Take a look at the process of creating your own Kali Linux ISO images. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The official images of Kali are collected using <a href="http://debian-live.alioth.debian.org/live-build/">live-build</a> .  This is a set of scripts that allows you to fully automate and customize all aspects of creating ISO images.  The <code>live-buid</code> uses, when forming its configuration, the directory structure.  This configuration and some related helper scripts can be found in the <code>live-build-config</code> Git repository.  We will use this repository as a basis for building images that are configured in accordance with special requirements. <br><br>  Before proceeding, you should be aware that the commands shown in this section are designed to run in the current version of Kali Linux.  If you try to use them in an OS other than Kali, or in the outdated version of Kali, they most likely will not work properly. <br><br><h2>  <font color="#3AC1EF">9.3.1.</font>  <font color="#3AC1EF">Install the necessary software</font> </h2><br>  The first step in building your own ISO image is to install the necessary packages and download the Git repository with the Kali <code>live-build</code> configuration: <br><br><pre> <code class="hljs lua"># apt install curl git live-build [...] # git clone git://git.kali.org/live-build-<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>.git [...] # cd live-build-<span class="hljs-built_in"><span class="hljs-built_in">config</span></span> # ls auto  build_all.sh  build.sh  kali-<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>  README</code> </pre> <br>  After that, you can already create updated (but unmodified) Kali ISO images.  To do this, simply use the command <code>./build.sh --verbose</code> .  The assembly will take a lot of time, because in its course all the packages that need to be included in the image will be loaded.  After completing this process, you can find a new ISO image in the <code>images</code> directory. <br><br><h2>  <font color="#3AC1EF">9.3.2.</font>  <font color="#3AC1EF">Build a Live Image with Different Desktop Environments</font> </h2><br>  The standard <code>build.sh</code> script from the <code>live-build</code> kit is responsible for preparing the <code>config</code> directory.  Her presence is expected to <code>live-build</code> .  The script helps to set different configurations, depending on its option <code>--variant</code> . <br><br>  The script creates the <code>config</code> directory by combining files from <code>kali-config/common</code> and <code>kali-config/variant-X</code> , where <code>X ‚Äî</code> the name of the variant specified using the <code>--variant</code> parameter.  When this option is not specified explicitly, the <code>default</code> name is used as a variant name. <br><br>  The <code>kali-config</code> folder contains directories for the most popular desktop environments: <br><br><ul><li>  <code>e17</code> for Enlightenment; <br></li><li>  <code>gnome</code> for GNOME; <br></li><li>  <code>i3wm</code> for frame window manager i3; <br></li><li>  <code>kde</code> for KDE; <br></li><li>  <code>lxde</code> for LXDE; <br></li><li>  <code>mate</code> for Mate Desktop Environment; <br></li><li>  <code>xfce</code> for XFCE. <br></li></ul><br>  The <code>light</code> option is a special case.  It is based on <a href="https://www.xfce.org/">XFCE</a> and is used to create an official lightweight ISO image that contains a reduced set of applications. <br><br>  Here, for example, how to create a Kali Live image using KDE as your desktop environment: <br><br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta"># ./build.sh --variant kde --verbose</span></span></code> </pre> <br>  The above concept of options allows you to perform a general system configuration, using a set of standard presets.  However, in fact, the images are amenable to much deeper customization.  You can read about it in the <a href="http://debian-live.alioth.debian.org/live-manual/unstable/manual/html/live-manual.en.html">Debian Live System Manual</a> .  There you will find many other ways to customize the images, which are to change the contents of the corresponding subdirectories in <code>kali-config</code> .  Below we look at a few examples. <br><br><h2>  <font color="#3AC1EF">9.3.3.</font>  <font color="#3AC1EF">Change the set of installed packages</font> </h2><br>  <code>Live-build</code> , after launch, installs all the packages listed in the <code>package-lists/*.list.chroot</code> .  The standard configuration includes the <code>package-lists/kali.list.chroot</code> , which contains an entry for the <code>kali-linux-full</code> package (this is the basic meta package, which results in the inclusion of all Kali packages in the image).  The line with the mention of this package can be commented out and use another meta package or make your own list of other packages.  In addition, you can combine both approaches, starting with a meta package and adding additional necessary packages. <br><br>  Using <code>package-lists</code> , only those packages that are already available in the official Kali repository can be included in the image.  However, if you have your own packages, you can include them in the Live image by placing the corresponding .deb files in the <code>packages.chroot</code> directory (for example, in <code>kali-config/config-gnome/packages.chroot</code> , if you, when building, use the GNOME graphical environment option). <br><br>  Meta-packages are empty packages that are used only because they include many dependencies on other packages.  As a result, they simplify the installation of sets of packages that are usually installed together.  The <code>kali-meta</code> source package is responsible for building all the meta packages provided by Kali Linux: <br><br><ul><li>  <code>kali-linux</code> : the base system (it is used in all other meta packages). <br></li><li>  <code>kali-linux-full</code> : standard installation of Kali Linux. <br></li><li>  <code>kali-linux-all</code> : a meta package that combines all other meta packages, as well as other packages (here, almost everything that is in Kali, so it's just a huge package!). <br></li><li>  <code>kali-linux-sdr</code> : Software Defined Radio (SDR) tools. <br></li><li>  <code>kali-linux-gpu</code> : tools that use a graphics card (GPU) to perform heavy calculations. <br></li><li>  <code>kali-linux-wireless</code> : tools for research and analysis of wireless networks. <br></li><li>  <code>kali-linux-web</code> : tools for researching web applications. <br></li><li>  <code>kali-linux-forensic</code> : digital <code>kali-linux-forensic</code> tools (they are used to search for evidence in investigating various incidents). <br></li><li>  <code>kali-linux-voip</code> : VoIP (Voice Over IP) tools. <br></li><li>  <code>kali-linux-pwtools</code> : password cracking tools. <br></li><li>  <code>kali-linux-top10</code> : the ten most popular tools. <br></li><li>  <code>kali-linux-rfid</code> : tools for working with RFID. <br></li></ul><br>  You can use these meta packages when creating your own list of packages for <code>live-build</code> .  A complete list of the available meta packages and the software they include can be found <a href="http://tools.kali.org/kali-metapackages">here</a> . <br><br><blockquote><h3>  <font color="#3AC1EF">‚ñçAutomation of customization of installed packages</font> </h3><br>  To automate the configuration of installed packages, you can use Debconf answer files (for more information, see section 4.3.2., ‚Äú <a href="https://kali.training/chapter-4/unattended-installations/">Creating an Answer File</a> ‚Äù), placing them in <code>preseed/*.cfg</code> .  They will be used to customize the packages used to create the live image. </blockquote><br><h2>  <font color="#3AC1EF">9.3.4.</font>  <font color="#3AC1EF">Use hooks to fine-tune image content.</font> </h2><br>  Working with <code>live-build</code> , you can use hooks that are performed at various stages of the build process.  <code>chroot ‚Äî</code> <code>hooks/live/*.chroot</code> are executable scripts that are installed as <code>hooks/live/*.chroot</code> in the configuration tree and are executed using <code>chroot</code> .  While <code>chroot ‚Äî</code> a command that allows you to temporarily change the root directory of an operating system to a selected directory, it is also used by <code>live-build</code> to designate a directory containing the full (alternative) tree of the file system.  In the case of <code>live-build</code> , the chroot directory is the directory where the file system is prepared for the live image.  Since applications running using <code>chroot</code> do not have access beyond the selected directory, the same is true for chroot hooks: you can only use and modify what is available in the <code>chroot</code> environment.  We rely on these hooks to perform many Kali-specific settings (take a look at <code>kali-config/common/hooks/live/kali-hacks.chroot</code> ). <br><br>  Binary hooks ( <code>hooks/live/*.binary</code> Binary) are executed in the context of the build process, at the end of this process.  They are not called during assembly using <code>chroot</code> .  With their help, you can modify the contents of the assembly ISO image, but not the Live-file system, since at this point it has already been created.  We use this feature in Kali to make some changes to the standard <code>isolinux</code> configuration created by <code>live-build</code> .  For example, take a look at <code>config/common/hooks/live/persistence.binary</code> , where we add boot menu items to enable the persistent data store. <br><br><h2>  <font color="#3AC1EF">9.3.5.</font>  <font color="#3AC1EF">Adding files to the ISO image or to the Live file system</font> </h2><br>  Another very common way to customize images is to add files to either the live file system or an ISO image. <br><br>  Files can be added to the file system by placing them where they should be in the <code>includes.chroot</code> configuration directory.  For example, there is a standard file <code>kali-config/common/includes.chroot/usr/lib/live/config/0031-root-password</code> , which ultimately turns out to be located in the Live-file system at <code>/usr/lib/live/config/0031-root-password</code> . <br><br><blockquote><h3>  <font color="#3AC1EF">‚ñçHooks live-boot</font> </h3><br>  The scripts installed in <code>/lib/live/config/XXXX-name</code> are executed by the <code>init</code> script of the <code>live-boot</code> package.  They reconfigure many aspects of the system so that they are suitable for working in live mode.  Here you can add your own scripts to customize your Live-system during operation.  In particular, they are used, for example, to implement their own boot parameters. </blockquote><br>  You can add files to the ISO image by placing them in the <code>includes.binary</code> configuration directory where they should be.  For example, there is a standard <code>kali-config/common/includes.binary/isolinux/splash.png</code> that overrides the background image used by the <code>isolinux</code> bootloader (it is stored in the <code>/isolinux/splash.png</code> file in the ISO image file system). <br><br><h2>  <font color="#3AC1EF">9.4.</font>  <font color="#3AC1EF"><b>Adding Permanent Storage to Live-ISO using USB Disk</b></font> </h2><br><h2>  <font color="#3AC1EF">9.4.1.</font>  <font color="#3AC1EF">Permanent Storage Features</font> </h2><br>  Here we look at the steps needed to add a permanent storage of information on a USB flash drive with Kali written on it.  The essence of a live-file system is its ephemerality.  All data saved when working with such a system disappears after a reboot, the same goes for system settings.  In order to avoid this, you can use the <code>live-boot</code> feature, called persistence.  This feature is activated if the boot options include the <code>persistence</code> keyword. <br><br>  Since modifying the boot menu is not an easy task, Kali, by default, has two menu items that allow you to enable persistent storage.  This is shown in the following figure, <code>Live USB Persistence</code> and <code>Live USB Encrypted Persistence</code> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0c1/423/6bb/0c14236bb43018c6953437a9056d1edc.png"></div><br>  <i><font color="#999999">Fig.</font></i>  <i><font color="#999999">9.1.</font></i>  <i><font color="#999999">Menu items to enable persistent storage</font></i> <br><br>  When this feature is enabled, <code>live-boot</code> scan all partitions for file systems marked as <code>persistence</code> (this can be changed using the <code>persistence-label=value</code> boot parameter), and the installer will create a repository for the directories that are listed in the <code>persistence.conf</code> file found in this section (each directory is listed on a separate line).  The special option <code>/ union</code> allows you to enable full preservation of all directories using cascade-unified mount (union mount).  With this approach, an additional file system level is created, in which only changes made to the data of the underlying file system are saved.  Directory data that is not lost after a reboot is stored in the file system, which contains the corresponding <code>persistence.conf</code> file. <br><br><h2>  <font color="#3AC1EF">9.4.2.</font>  <font color="#3AC1EF">Create unencrypted storage on a USB drive</font> </h2><br>  It assumes that you have prepared a USB flash drive with a Live system, following the instructions found in section 2.1.4., ‚Äú <a href="https://kali.training/2-getting-started-with-kali/downloading-kali-linux/">Copying an Image to a DVD-ROM or a USB Flash Drive,</a> ‚Äù and that the size of the media is enough to store the image ( about 3 GB) and for storing data directories that fall into the permanent storage.  In addition, we assume that Linux sees the USB flash drive as <code>/dev/sdb</code> , and that it contains only two partitions that are part of the standard ISO image ( <code>/dev/sdb1</code> and <code>/dev/sdb2</code> ).  Doing what is discussed below, be very careful.  The fact is that if you accidentally re-partition the wrong disk, this can result in the loss of important data. <br><br>  In order to add a new partition to the disk, you need to know the size of the image that already exists on the flash drive.  This will give you the opportunity to make the new section begin immediately after the Live image.  Then you need to use the <code>parted</code> command to create the partition.  The following commands analyze the <code>kali-linux-2016.1-amd64.iso</code> ISO image, which is expected to be present on a USB flash drive: <br><br><pre> <code class="hljs mel"># parted /dev/sdb <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> Model: SanDisk Cruzer Edge (scsi) Disk /dev/sdb: <span class="hljs-number"><span class="hljs-number">32</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>GB Sector <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> (logical/physical): <span class="hljs-number"><span class="hljs-number">512</span></span>B/<span class="hljs-number"><span class="hljs-number">512</span></span>B Partition Table: msdos Disk Flags: Number  Start   End     Size    Type     File <span class="hljs-keyword"><span class="hljs-keyword">system</span></span>  Flags <span class="hljs-number"><span class="hljs-number">1</span></span>      <span class="hljs-number"><span class="hljs-number">32</span></span>,<span class="hljs-number"><span class="hljs-number">8</span></span>kB  <span class="hljs-number"><span class="hljs-number">2852</span></span>MB  <span class="hljs-number"><span class="hljs-number">2852</span></span>MB  primary               boot, hidden <span class="hljs-number"><span class="hljs-number">2</span></span>      <span class="hljs-number"><span class="hljs-number">2852</span></span>MB  <span class="hljs-number"><span class="hljs-number">2945</span></span>MB  <span class="hljs-number"><span class="hljs-number">93</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>MB  primary # start=$(du --block-<span class="hljs-keyword"><span class="hljs-keyword">size</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span>MB kali-linux<span class="hljs-number"><span class="hljs-number">-2016.1</span></span>-amd64.iso | awk <span class="hljs-string"><span class="hljs-string">'{print $1}'</span></span>) # echo <span class="hljs-string"><span class="hljs-string">"Size of image is $start MB"</span></span> Size of <span class="hljs-keyword"><span class="hljs-keyword">image</span></span> is <span class="hljs-number"><span class="hljs-number">2946</span></span> MB # parted -a optimal /dev/sdb mkpart primary <span class="hljs-string"><span class="hljs-string">"${start}MB"</span></span> <span class="hljs-number"><span class="hljs-number">100</span></span>% Information: You may need to update /etc/fstab. # parted /dev/sdb <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> Model: SanDisk Cruzer Edge (scsi) Disk /dev/sdb: <span class="hljs-number"><span class="hljs-number">32</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>GB Sector <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> (logical/physical): <span class="hljs-number"><span class="hljs-number">512</span></span>B/<span class="hljs-number"><span class="hljs-number">512</span></span>B Partition Table: msdos Disk Flags: Number  Start   End     Size    Type     File <span class="hljs-keyword"><span class="hljs-keyword">system</span></span>  Flags <span class="hljs-number"><span class="hljs-number">1</span></span>      <span class="hljs-number"><span class="hljs-number">32</span></span>,<span class="hljs-number"><span class="hljs-number">8</span></span>kB  <span class="hljs-number"><span class="hljs-number">2852</span></span>MB  <span class="hljs-number"><span class="hljs-number">2852</span></span>MB  primary               boot, hidden <span class="hljs-number"><span class="hljs-number">2</span></span>      <span class="hljs-number"><span class="hljs-number">2852</span></span>MB  <span class="hljs-number"><span class="hljs-number">2945</span></span>MB  <span class="hljs-number"><span class="hljs-number">93</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>MB  primary <span class="hljs-number"><span class="hljs-number">3</span></span>      <span class="hljs-number"><span class="hljs-number">2946</span></span>MB  <span class="hljs-number"><span class="hljs-number">32</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>GB  <span class="hljs-number"><span class="hljs-number">29</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>GB  primary</code> </pre> <br>  When the new <code>/dev/sdb3</code> created, format it in the <code>ext4</code> file system and assign the <code>persistence</code> label to it using the <code>mkfs.ext4</code> (and its <code>-L</code> options to assign a label).  Then the partition is mounted in the <code>/mnt</code> directory and the <code>persistence.conf</code> file is added there.  Be careful when formatting any disk.  If you format the wrong partition or the wrong drive, you may lose something important. <br><br><pre> <code class="hljs pgsql"># mkfs.ext4 -L persistence /dev/sdb3 mke2fs <span class="hljs-number"><span class="hljs-number">1.43</span></span>-WIP (<span class="hljs-number"><span class="hljs-number">15</span></span>-Mar<span class="hljs-number"><span class="hljs-number">-2016</span></span>) Creating filesystem <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-number"><span class="hljs-number">7096832</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>k blocks <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-number"><span class="hljs-number">1777664</span></span> inodes Filesystem <span class="hljs-type"><span class="hljs-type">UUID</span></span>: dede20c4<span class="hljs-number"><span class="hljs-number">-5239</span></span><span class="hljs-number"><span class="hljs-number">-479</span></span>a-b115<span class="hljs-number"><span class="hljs-number">-96561</span></span>ac857b6 Superblock backups stored <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> blocks: <span class="hljs-number"><span class="hljs-number">32768</span></span>, <span class="hljs-number"><span class="hljs-number">98304</span></span>, <span class="hljs-number"><span class="hljs-number">163840</span></span>, <span class="hljs-number"><span class="hljs-number">229376</span></span>, <span class="hljs-number"><span class="hljs-number">294912</span></span>, <span class="hljs-number"><span class="hljs-number">819200</span></span>, <span class="hljs-number"><span class="hljs-number">884736</span></span>, <span class="hljs-number"><span class="hljs-number">1605632</span></span>, <span class="hljs-number"><span class="hljs-number">2654208</span></span>, <span class="hljs-number"><span class="hljs-number">4096000</span></span> Allocating <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-keyword"><span class="hljs-keyword">tables</span></span>: done Writing inode <span class="hljs-keyword"><span class="hljs-keyword">tables</span></span>: done Creating journal (<span class="hljs-number"><span class="hljs-number">32768</span></span> blocks): done Writing superblocks <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> filesystem accounting information: done # mount /dev/sdb3 /mnt # echo "/ union" &gt;/mnt/persistence.conf # ls -l /mnt total <span class="hljs-number"><span class="hljs-number">20</span></span> drwx<span class="hljs-comment"><span class="hljs-comment">------ 2 root root 16384 May 10 13:31 lost+found -rw-r--r-- 1 root root     8 May 10 13:34 persistence.conf # umount /mnt</span></span></code> </pre> <br>  Now the USB flash drive is ready so that you can boot from it using the <code>Live USB Persistence</code> menu item. <br><br><h2>  <font color="#3AC1EF">9.4.3.</font>  <font color="#3AC1EF">Creating an encrypted storage on a USB flash drive</font> </h2><br>  If necessary, a permanent data storage can be organized on an encrypted partition, it supports <code>live-boot</code> .  This approach allows you to protect data by creating an encrypted LUKS partition, on which they are stored. <br><br>  Creating encrypted storage begins with the same actions that we performed before.  However, now, instead of formatting the partition in the <code>ext4</code> file system, use <code>cryptsetup</code> to initialize the partition as a LUKS container.  Then open this container and configure the <code>ext4</code> file system as you did when creating unencrypted storage, but instead of using the <code>/dev/sdb3</code> partition, use the virtual partition created by <code>cryptsetup</code> .  This virtual partition is the decrypted content of the encrypted partition, which is available in <code>/dev/mapper</code> under the name you assigned to it.  In the example below, we will use the name <code>kali_persistence</code> .  Recall that when performing such operations, it is worth being vigilant and not accidentally formatting the wrong disk or partition. <br><br><pre> <code class="hljs vbscript"># cryptsetup --verbose --verify-passphrase luksFormat /dev/sdb3 WARNING! ======== This will overwrite data <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> /dev/sdb3 irrevocably. Are you sure? (Type uppercase yes): YES Enter passphrase: Verify passphrase: Command successful. # cryptsetup luksOpen /dev/sdb3 kali_persistence Enter passphrase <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> /dev/sdb3: # mkfs.ext4 -L persistence /dev/mapper/kali_persistence mke2fs <span class="hljs-number"><span class="hljs-number">1.43</span></span>-WIP (<span class="hljs-number"><span class="hljs-number">15</span></span>-Mar<span class="hljs-number"><span class="hljs-number">-2016</span></span>) Creating filesystem <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-number"><span class="hljs-number">7096320</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>k blocks <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-number"><span class="hljs-number">1774192</span></span> inodes Filesystem UUID: <span class="hljs-number"><span class="hljs-number">287892</span></span>c1<span class="hljs-number"><span class="hljs-number">-00</span></span>bb<span class="hljs-number"><span class="hljs-number">-43</span></span>cb-b513<span class="hljs-number"><span class="hljs-number">-81</span></span>cc9e6fa72b Superblock backups stored <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> blocks: <span class="hljs-number"><span class="hljs-number">32768</span></span>, <span class="hljs-number"><span class="hljs-number">98304</span></span>, <span class="hljs-number"><span class="hljs-number">163840</span></span>, <span class="hljs-number"><span class="hljs-number">229376</span></span>, <span class="hljs-number"><span class="hljs-number">294912</span></span>, <span class="hljs-number"><span class="hljs-number">819200</span></span>, <span class="hljs-number"><span class="hljs-number">884736</span></span>, <span class="hljs-number"><span class="hljs-number">1605632</span></span>, <span class="hljs-number"><span class="hljs-number">2654208</span></span>, <span class="hljs-number"><span class="hljs-number">4096000</span></span> Allocating group tables: done Writing inode tables: done Creating journal (<span class="hljs-number"><span class="hljs-number">32768</span></span> blocks): done Writing superblocks <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> filesystem accounting information: done # mount /dev/mapper/kali_persistence /mnt # echo <span class="hljs-string"><span class="hljs-string">"/ union"</span></span> &gt;/mnt/persistence.conf # umount /mnt # cryptsetup luksClose /dev/mapper/kali_persistence</code> </pre> <br><h2>  <font color="#3AC1EF">9.4.4.</font>  <font color="#3AC1EF">Using multiple permanent repositories</font> </h2><br>  If you use the Kali Live image in different situations, you can create several file systems with different labels and, on the boot command line, specify which file system to use in a particular session.  This is done using the boot parameter <code>persistence-label=label</code> . <br><br>  Suppose you are a professional pentester.  Working with a client, you use persistent storage located on an encrypted partition.  You do this to protect your data in case the USB flash drive is stolen or hacked.  At the same time, you want to be able to demonstrate Kali and any advertising materials stored on an unencrypted partition on the same disk.  Since you wouldn‚Äôt like to manually edit the parameters on each boot, you decide to build your own Live image with separate items in the boot menu. <br><br>  The first step is to build your own Live-ISO (in accordance with section 9.3., " <a href="https://kali.training/9-advanced-usage/building-custom-kali-live-iso-images/">Building Kali Linux's own ISO images,</a> " and, in particular, with section 9.3.4., " <a href="https://kali.training/9-advanced-usage/building-custom-kali-live-iso-images/">Using hooks to fine-tune the contents of the image</a> ").  The most important thing to do at this stage is to modify the <code>kali-config/common/hooks/live/persistence-menu.binary</code> , bringing it to something like this (pay attention to the <code>persistence-label</code> parameters): <br><br><pre> <code class="hljs vhdl">#!/bin/sh <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ ! -d isolinux ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>   cd binary fi cat &gt;&gt;isolinux/live.cfg &lt;&lt;<span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">label</span></span> live-demo   menu <span class="hljs-keyword"><span class="hljs-keyword">label</span></span> ^Live USB <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> Demo Data   linux /live/vmlinuz   initrd /live/initrd.img   append boot=live username=root hostname=kali persistence-<span class="hljs-keyword"><span class="hljs-keyword">label</span></span>=demo persistence <span class="hljs-keyword"><span class="hljs-keyword">label</span></span> live-work   menu <span class="hljs-keyword"><span class="hljs-keyword">label</span></span> ^Live USB <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> Work Data   linux /live/vmlinuz   initrd /live/initrd.img   append boot=live username=root hostname=kali persistence-<span class="hljs-keyword"><span class="hljs-keyword">label</span></span>=work persistence-encryption=luks persistence <span class="hljs-keyword"><span class="hljs-keyword">END</span></span></code> </pre> <br>  Next, we collect the ISO image and copy it to a USB flash drive.  Then we create and initialize two partitions and file systems that will be used to organize permanent data stores.  The first section, labeled <code>demo</code> , was created without encryption, the second, labeled <code>work</code> , is encrypted.  Here, based on the assumption that the USB disk is visible in the system as <code>/dev/sdb</code> , and the size of our ISO image is 3000 MB, you need to perform the following sequence of actions: <br><br><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta"># parted /dev/sdb mkpart primary 3000 MB 55% # parted /dev/sdb mkpart primary 55% 100% # mkfs.ext4 -L demo /dev/sdb3 [...] # mount /dev/sdb3 /mnt # echo </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/ union"</span></span></span><span class="hljs-meta"> &gt;/mnt/persistence.conf # umount /mnt # cryptsetup --verbose --verify-passphrase luksFormat /dev/sdb4 [...] # cryptsetup luksOpen /dev/sdb4 kali_persistence [...] # mkfs.ext4 -L work /dev/mapper/kali_persistence [...] # mount /dev/mapper/kali_persistence /mnt # echo </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/ union"</span></span></span><span class="hljs-meta"> &gt;/mnt/persistence.conf # umount /mnt # cryptsetup luksClose /dev/mapper/kali_persistence</span></span></code> </pre> <br>  That's all.  Now you can boot from a USB disk and select the necessary items from the new boot menu. <br><br><blockquote><h3>  <font color="#3AC1EF">‚ñçSetting self-destruct password to enhance system security</font> </h3><br>  Kali has a modified <code>cryptsetup</code> to implement a new feature.  ,       (nuke password), ,  ,   ,      . <br><br>    ,               .         ,   ( )      . <br><br>     ,              . <br><br>        ,   ,    ,    : <br><br><pre> <code class="hljs cs">$ cryptsetup luksAddNuke /dev/sdb4 Enter any existing passphrase: Enter <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> passphrase <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> key slot: Verify passphrase:</code> </pre> <br>      <a href="https://www.kali.org/tutorials/nuke-kali-linux-luks/"></a> . </blockquote><br><h2>  <font color="#3AC1EF"><b>Results</b></font> </h2><br>     ,    ISO-,     USB-,      Live-,   ,           .          ¬´ <a href="https://kali.training/introduction/kali-linux-revealed-book/">Kali Linux Revealed</a> ¬ª       . <br><br>  Dear readers!     ,         Kali Linux? <br><br>  : <br><br> ‚Üí  1. <a href="https://habrahabr.ru/company/ruvds/blog/338338/">Kali Linux:  ,     </a> <br> ‚Üí  2. <a href="https://habrahabr.ru/company/ruvds/blog/338480/">Kali Linux:     netfilter</a> <br> ‚Üí  3. <a href="https://habrahabr.ru/company/ruvds/blog/338668/">Kali Linux:   </a> <br> ‚Üí  4. <a href="https://habrahabr.ru/company/ruvds/blog/338668/">Kali Linux:      </a> <br> ‚Üí  5. <a href="https://habrahabr.ru/company/ruvds/blog/339312/">Kali Linux:   </a> <br> ‚Üí  6. <a href="https://habrahabr.ru/company/ruvds/blog/339636/">Kali Linux:    </a> <br> ‚Üí  7. <a href="https://habrahabr.ru/company/ruvds/blog/339828/">Kali Linux:     </a> <br> ‚Üí  8. <a href="https://habrahabr.ru/company/ruvds/blog/340198/">Kali Linux:      </a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Üí Part 9. </font></font><a href="https://habrahabr.ru/company/ruvds/blog/340824/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kali Linux: package modification</font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Üí Part 10. </font></font><a href="https://habrahabr.ru/company/ruvds/blog/341428/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kali Linux: kernel build</font></font></a> </div><p>Source: <a href="https://habr.com/ru/post/341882/">https://habr.com/ru/post/341882/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../341872/index.html">The announcement of the mitap ThinkPHP # 15 in Kharkov</a></li>
<li><a href="../341874/index.html">Web application on Node and Vue, part 3: client and server development</a></li>
<li><a href="../341876/index.html">Configuring Authentication in SAP Netweaver AS Java (Part 1 of 3)</a></li>
<li><a href="../341878/index.html">Debugging React Applications in VS Code</a></li>
<li><a href="../341880/index.html">What is RxJS and why is it useful to know about it</a></li>
<li><a href="../341884/index.html">What we have learned by spending $ 100,000 in AdWords</a></li>
<li><a href="../341886/index.html">A quick comparative review of Docker GUI solutions</a></li>
<li><a href="../341888/index.html">Automata programming. Part 4. Efficiency of auto-designed programs</a></li>
<li><a href="../341890/index.html">It does not matter how much the company earns - it is important how it spends them. Automate Purchasing in an Organization with Flexbby</a></li>
<li><a href="../341892/index.html">Mateus Fernandez, ZEIT - in IT without education. FrontFest.Keynote</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>