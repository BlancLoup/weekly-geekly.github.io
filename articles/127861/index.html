<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>jqGrid - Dynamic tables on jQuery. Complicated Search</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 In my opinion, jqGrid is the most successful and most convenient plugin for jQuery at the moment, working with database tables via AJAX...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>jqGrid - Dynamic tables on jQuery. Complicated Search</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  In my opinion, jqGrid is the most successful and most convenient plugin for jQuery at the moment, working with database tables via AJAX requests and PHP (There is also a version for ASP.NET). <br><br>  I will omit all the details in this article, focusing your attention only on the question of how to make a complex table search using this plugin. <br><a name="habracut"></a><br>  For a start, I advise you to meet: <ul><li>  with the plugin itself <a href="http://www.trirand.com/blog/">here</a> ; </li><li>  with examples of his work <a href="http://www.trirand.com/blog/jqgrid/jqgrid.html">here</a> ; </li><li>  with the article <a href="http://www.linkexchanger.su/2010/118.html">‚ÄúIntroduction to jqGrid‚Äù</a> , which describes how to link jqGrid + php + Mysql (or other databases). </li></ul><br>  How to get data WITHOUT the where clause in this article will not be described.  It is assumed that you have read the article ‚ÄúIntroduction to jqGrid‚Äù and now you want not only to sort the results and break them into pages, but to do complex searches on several fields of the table at once. <br><br>  Please pay special attention to the example located at the link above, titled "Searching (4.0) new" -&gt; "Show query in search". 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And so, we created an HTML document: <br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"newapi"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"pnewapi"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Enable JavaScript code: <br><pre> <code class="javascript hljs">jQuery(<span class="hljs-string"><span class="hljs-string">"#grps1"</span></span>).jqGrid({ <span class="hljs-comment"><span class="hljs-comment">//     url:'ajax/get.php', //  -    datatype: "json", //  - colNames:['Inv No', 'Date', 'Client', 'Amount','Tax','Total','Notes'], colModel:[ {name:'id', key : true, index:'id', width:55, searchtype:"integer"}, {name:'invdate',index:'invdate', width:90}, {name:'name', index:'name', width:100}, {name:'amount',index:'amount', width:80, align:"right", searchtype:"number"}, {name:'tax',index:'tax', width:80, align:"right", searchtype:"number"}, {name:'total',index:'total', width:80,align:"right", searchtype:"number"}, {name:'note',index:'note', width:150, sortable:false} ], rowNum:10, width:700, rowList:[10,20,30], pager: '#pgrps1', //     sortname: 'invdate', viewrecords: true, sortorder: "desc" }); jQuery("#grps1").jqGrid('navGrid','#pgrps1', //    {edit:false,add:false,del:false}, //    ,    .      : ""  "" {}, //    {}, //    {}, //    { multipleSearch:true, //     multipleGroup:true, //      showQuery: true //    } );</span></span></code> </pre><br>  We connected the necessary styles and scripts (you can download it <a href="http://www.trirand.com/blog/%3Fpage_id%3D6">here</a> ): <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/redmond/jquery-ui.css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"css/ui.jqgrid.css"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"src/grid.loader.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Please note that I do not connect the library with one file or separate parts, as it could be done, but I use the file ‚Äúgrid.loader.js‚Äù, which also comes with the sources on the official website of the plugin.  I changed it a bit and provide a modified code snippet: <br><pre> <code class="javascript hljs">... var pathtojsfiles = <span class="hljs-string"><span class="hljs-string">"src/"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// set include to false if you do not want some modules to be included var modules = [ { include: true, incfile:'i18n/grid.locale-ru.js'}, //       'ru' ...</span></span></code> </pre> <br>  Using this file it is convenient to manage the components of this module, as well as select its language. <br><br><h4>  Advanced Search </h4><br>  Advanced Search Form: <br><img src="http://hostingkartinok.com/image/01201109/e0cace59f6cf5151a672ee6024a6937e.jpg" alt="Advanced Search Form"><br><br>  Now the sweetest.  What does the jqGrid give us when searching? <br>  POST or GET parameters (depending on jqGrid settings): <br><ol><li>  $ _REQUEST ['_ <b>search</b> '] - A boolean value, if the query is conditional on a search, it takes a true value; </li><li>  $ _REQUEST [' <b>filters</b> '] - An object with conditions in the json view; </li><li>  $ _REQUEST [' <b>searchField</b> '] - The name of the field to search for (if the condition is simple); </li><li>  $ _REQUEST [' <b>searchOper</b> '] - Comparison operation for a search field (if the condition is simple); </li><li>  $ _REQUEST [' <b>searchString</b> '] - The value of the field to search for (if the condition is simple); </li></ol><br>  Now, knowing this data, it is necessary to generate the ‚Äúwhere‚Äù condition string and pass it on to the necessary procedure, which previously only took the name of the column to be sorted, the direction of sorting, the page number and the number of records per page (for <a href="http://ru.wikipedia.org/wiki/%25D0%259F%25D0%25B0%25D0%25B3%25D0%25B8%25D0%25BD%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F">pagination</a> ). <br><br>  Here is the code that needs to be inserted before the query into the database (in the example, a POST request is used): <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($_search){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_POST[<span class="hljs-string"><span class="hljs-string">'filters'</span></span>])) $filters = $_POST[<span class="hljs-string"><span class="hljs-string">'filters'</span></span>];<span class="hljs-comment"><span class="hljs-comment">//    if (isset($_POST['searchField'])) $searchField = $_POST['searchField']; //     () if (isset($_POST['searchOper'])) $searchOper = $_POST['searchOper']; //     () if (isset($_POST['searchString'])) $searchString = $_POST['searchString']; //     () $searchString = generateSearchString($filters, $searchField, $searchOper, $searchString); }</span></span></code> </pre> <br>  Here is the "heart" of this article, the function of generating conditions for searching in the database. <br><br>  The <b>generateSearchString ()</b> function: <br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateSearchString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($filters, $searchField, $searchOper, $searchString)</span></span></span></span>{ $where = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($filters){ $filters = json_decode($filters); $where .= <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::generateSearchStringFromObj($filters); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $where; }</code> </pre> <br>  The recursive function <b>generateSearchStringFromObj () of</b> generating conditions for fetching from the database: <br><pre> <code class="php hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateSearchStringFromObj</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($filters)</span></span></span></span>{ $where = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     if(count($filters)) foreach($filters-&gt;rules as $index =&gt; $rule){ $rule-&gt;data = addslashes($rule-&gt;data); $where .= "`".preg_replace('/-|\'|\"/', '', $rule-&gt;field)."`"; switch($rule-&gt;op){ //          jqGrid case 'eq': $where .= " = '".$rule-&gt;data."'"; break; case 'ne': $where .= " != '".$rule-&gt;data."'"; break; case 'bw': $where .= " LIKE '".$rule-&gt;data."%'"; break; case 'bn': $where .= " NOT LIKE '".$rule-&gt;data."%'"; break; case 'ew': $where .= " LIKE '%".$rule-&gt;data."'"; break; case 'en': $where .= " NOT LIKE '%".$rule-&gt;data."'"; break; case 'cn': $where .= " LIKE '%".$rule-&gt;data."%'"; break; case 'nc': $where .= " NOT LIKE '%".$rule-&gt;data."%'"; break; case 'nu': $where .= " IS NULL"; break; case 'nn': $where .= " IS NOT NULL"; break; case 'in': $where .= " IN ('".str_replace(",", "','", $rule-&gt;data)."')"; break; case 'ni': $where .= " NOT IN ('".str_replace(",", "','", $rule-&gt;data)."')"; break; } //   ,      if(count($filters-&gt;rules) != ($index + 1)) $where .= " ".addslashes($filters-&gt;groupOp)." "; } //     $isSubGroup = false; if(isset($filters-&gt;groups)) foreach($filters-&gt;groups as $groupFilters){ $groupWhere = self::generateSearchStringFromObj($groupFilters); //     ,    if($groupWhere){ //   ,           //       if(count($filters-&gt;rules) or $isSubGroup) $where .= " ".addslashes($filters-&gt;groupOp)." "; $where .= $groupWhere; $isSubGroup = true; // , ,        } } if($where) return '('.$where.')'; return ''; //   }</span></span></code> </pre> <br><h5>  PS </h5><br>  Inline search form: <br><img src="http://hostingkartinok.com/image/01201109/86264fd42b76c6091e47681ee37330a6.jpg" alt="Inline search form"><br><br>  ATTENTION: this formula will not work in inline search.  In the inline search, jqGrid will pass in the query parameters the column names and their values. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $_POST[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]; <span class="hljs-comment"><span class="hljs-comment">//  3,         id  3</span></span></code> </pre> <br>  Thus, to implement inline-search by `id`, it is enough to write such code: <br><br><pre> <code class="php hljs">$where = <span class="hljs-string"><span class="hljs-string">"`id` = "</span></span> . (int)$_POST[<span class="hljs-string"><span class="hljs-string">'id'</span></span>];</code> </pre> <br>  To search by several fields, the condition will be supplemented with additional strings joined together by an ‚ÄúAND‚Äù.  Naturally, instead of equality, you can use any condition allowed for your database. <br><br>  <a href="http://file.qip.ru/file/ZzlW8rJC/get.html">The source</a> file for the AJAX request handler from jqGrid.  (Carefully read the comments, the script will work only if you set up a connection to the database and enter my request to the database instead of my module). </div><p>Source: <a href="https://habr.com/ru/post/127861/">https://habr.com/ru/post/127861/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../127852/index.html">What if ATMs were designed by interaction designers?</a></li>
<li><a href="../127854/index.html">The official extension for Google Chrome. English at your fingertips!</a></li>
<li><a href="../127855/index.html">Official ASP.NET MVC 4 Roadmap</a></li>
<li><a href="../127856/index.html">Conceptor.ru 4.0: Freedom of ideas!</a></li>
<li><a href="../127860/index.html">Video presentation + review of the new Lbook v60</a></li>
<li><a href="../127862/index.html">Amateur HF radio communication, part 1 - the observer</a></li>
<li><a href="../127864/index.html">Data structures in pictures. Linkedlist</a></li>
<li><a href="../127866/index.html">Evolutionary way of thinking</a></li>
<li><a href="../127868/index.html">Nonblocking message queue for two threads</a></li>
<li><a href="../127869/index.html">Nokia N950 Developer Kit for Developer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>