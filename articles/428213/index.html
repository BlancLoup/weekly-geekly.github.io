<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to interpret model predictions in SHAP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One of the most important tasks in the field of data science is not only building a model capable of making qualitative predictions, but also the abil...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to interpret model predictions in SHAP</h1><div class="post__text post__text-html js-mediator-article">  One of the most important tasks in the field of data science is not only building a model capable of making qualitative predictions, but also the ability to interpret such predictions. <br><br>  If we do not just know that the customer is inclined to buy goods, but also understand what affects their purchase, we will be able to build a company strategy in the future, aimed at increasing sales efficiency. <br><a name="habracut"></a><br>  Or the model predicted that the patient would soon get sick.  The accuracy of such predictions is not very high, because  there are many factors hidden from the model, but an explanation of the reasons why the model made such a prediction can help the doctor pay attention to new symptoms.  Thus, it is possible to expand the boundaries of the model, if its accuracy itself is not too high. <br><br>  In this post I want to talk about the technique of <a href="https://github.com/slundberg/shap">SHAP</a> , which allows you to look under the hood of a variety of models. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If everything is more or less clear with linear models, the greater the absolute value of the coefficient under the predictor, the more important this predictor is, then the importance of features of the same gradient boosting is much more difficult to explain. <br><br><h2>  Why there was a need for such a library </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/959/75c/7c1/95975c7c11b6c26f5f48cb388118b87d.png" alt="image"><br><br>  On the sklearn stack, in the xgboost, lightGBM packages, there were built-in methods of feature importance for ‚Äúwooden models‚Äù: <br><br><ol><li>  <b>Gain</b> <br>  This measure shows the relative contribution of each feature to the model.  for calculation, we go through each tree, look at each node of the tree, which feature leads to a node splitting and how much uncertainty of the model is reduced according to the metric (Gini impurity, information gain). <br>  For each feature, its contribution is summed over all trees. <br></li><li>  <b>Cover</b> <br>  Shows the number of observations for each feature.  For example, you have 4 features, 3 trees.  Suppose feature 1 in the tree nodes contains 10, 5, and 2 observations in trees 1, 2, and 3, respectively. Then, for this feature, the importance will be 17 (10 + 5 + 2). <br></li><li>  <b>Frequency</b> <br>  It shows how often this feature is found in the tree nodes, that is, the total number of tree partitions into nodes for each feature in each tree is considered. <br></li></ol><br>  The main problem in all these approaches is that it is not clear how this feature affects the prediction of the model.  For example, we learned that the level of income is important for assessing the solvency of a bank‚Äôs customer to pay off a loan.  But how exactly?  How much higher income shifts model predictions? <br><br>  Of course, we can make several predictions by changing the level of income.  But what to do with other features?  After all, we find ourselves in the situation that it is necessary to gain an understanding of the influence of income, <b>independently</b> of other features, with their average value. <br><br>  There is a sort of average bank customer "in a vacuum."  How will the predictions of the model change depending on the change in income? <br><br>  This is where the <b>SHAP</b> library comes to the rescue. <br><br><h2>  Calculate the importance of features using SHAP </h2><br>  In the <b>SHAP</b> library, to calculate the <a href="https://en.wikipedia.org/wiki/Shapley_value">importance of features, Shapley values ‚Äã‚Äãare calculated</a> (after the name of the American mathematician and the library is named). <br><br>  To assess the importance of the feature, the prediction of the model is evaluated <b>with</b> and <b>without</b> this feature. <br><br><h4>  A bit of prehistory </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/b6f/410/244/b6f410244b45bae7fcd61de04c764502.jpg" alt="image"><br><br>  Shapley values ‚Äã‚Äãcome from game theory. <br><br>  Consider the scenario: a group of people playing cards.  How to distribute the prize fund between them in accordance with their contribution? <br><br>  A number of assumptions are made: <br><br><ul><li>  The amount of remuneration of each player is equal to the total amount of the prize fund. </li><li>  If two players have made an equal contribution to the game, they will receive an equal reward. </li><li>  If the player has made no contribution, he does not receive a reward. </li><li>  If a player has spent two games, then his total remuneration consists of the amount of rewards for each of the games. </li></ul><br>  We present the features of the model as players, and the prize pool as the final prediction of the model. <br><br><h4>  Consider an example </h4><br>  The formula for calculating the Shaply value for the i-th feature: <br><br><p><math> </math> $$ display $$ \ begin {equation *} \ phi_ {i} (p) = \ sum_ {S \ subseteq N / \ {i \}} \ frac {| S |! (n - | S | -1) !} {n!} (p (S \ cup \ {i \}) - p (S)) \ end {equation *} $$ display $$ </p><br><br>  Here: <br><br><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><merror><mtext>p&amp;#xA0;(S&amp;#xA0;\&amp;#xA0;cup&amp;#xA0;\&amp;#xA0;{i&amp;#xA0;\})</mtext></merror></math>" role="presentation"><span class="noError" aria-hidden="true" style="display: inline-block;">p&nbsp;(S&nbsp;\&nbsp;cup&nbsp;\&nbsp;{i&nbsp;\})</span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><merror><mtext>p&nbsp;(S&nbsp;\&nbsp;cup&nbsp;\&nbsp;{i&nbsp;\})</mtext></merror></math></span></span><script type="math/tex" id="MathJax-Element-2"> p (S \ cup \ {i \}) </script>  - this is the prediction of the model with the i-th feature, <br><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>p</mi><mo stretchy=&quot;false&quot;>(</mo><mi>s</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.159ex" height="2.66ex" viewBox="-38.5 -832 1790.5 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex; margin-left: -0.089ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMATHI-70" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-28" x="503" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMATHI-73" x="893" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-29" x="1362" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi><mo stretchy="false">(</mo><mi>s</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-3"> p (s) </script>  - this is a model prediction without an i-feature, <br><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.395ex" height="1.455ex" viewBox="0 -520.7 600.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMATHI-6E" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-4"> n </script>  - number of features, <br><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>S</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.499ex" height="2.057ex" viewBox="0 -780.1 645.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMATHI-53" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math></span></span><script type="math/tex" id="MathJax-Element-5"> S </script>  - arbitrary set of features without the i-th feature <br><br>  The Shaply value for the i-th feature is calculated for each sample of data (for example, for each client in the sample) on all possible combinations of features (including the absence of all features), then the values ‚Äã‚Äãobtained are summed modulo and the resulting importance of the i-th feature is obtained. <br><br>  These calculations are extremely costly, so various algorithms for optimization of calculations are used under the hood, for more details, see the link above on the githabe. <br><br>  Take the vanilla example from the <a href="https://xgboost.readthedocs.io/en/latest/tutorials/model.html">xgboost documentation</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4de/6d0/b89/4de6d0b89b0f73bba9b68e5dbd446348.png" alt="image"><br><br>  We want to appreciate the importance of features for predicting whether a person likes computer games. <br><br>  In this example, for simplicity, we have two features: age (age) and gender (gender).  Gender (floor) takes values ‚Äã‚Äã0 and 1. <br><br>  Take Bobby (the little boy in the leftmost node of the tree) and calculate the Shaply value for the age feature. <br><br>  We have two sets of features S: <br><br><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><merror><mtext>\&amp;#xA0;{\}</mtext></merror></math>" role="presentation"><span class="noError" aria-hidden="true" style="display: inline-block;">\&nbsp;{\}</span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><merror><mtext>\&nbsp;{\}</mtext></merror></math></span></span><script type="math/tex" id="MathJax-Element-6"> \ {\} </script>  - no features, <br><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><merror><mtext>\&amp;#xA0;{gender&amp;#xA0;\}</mtext></merror></math>" role="presentation"><span class="noError" aria-hidden="true" style="display: inline-block;">\&nbsp;{gender&nbsp;\}</span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><merror><mtext>\&nbsp;{gender&nbsp;\}</mtext></merror></math></span></span><script type="math/tex" id="MathJax-Element-7"> \ {gender \} </script>  - there is only a feature floor. <br><br><h4>  Situation when there are no feature values </h4><br>  Different models work differently with situations when there are no features for sample data, that is, for all features, the values ‚Äã‚Äãare NULL. <br><br>  It will be considered in this case that the model averages the predictions by the branches of the tree, that is, the prediction without features will be <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mo stretchy=&quot;false&quot;>(</mo><mn>2</mn><mo>+</mo><mn>0.1</mn><mo stretchy=&quot;false&quot;>)</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>/</mo></mrow><mn>2</mn><mo>+</mo><mo stretchy=&quot;false&quot;>(</mo><mo>&amp;#x2212;</mo><mn>1</mn><mo stretchy=&quot;false&quot;>)</mo><mo stretchy=&quot;false&quot;>]</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>/</mo></mrow><mn>2</mn><mo>=</mo><mn>0.025</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="30.743ex" height="2.66ex" viewBox="0 -832 13236.4 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-28" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-32" x="668" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-2B" x="1390" y="0"></use><g transform="translate(2391,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-31" x="779" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-29" x="3670" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-2F" x="4060" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-32" x="4560" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-2B" x="5283" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-28" x="6284" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-2212" x="6673" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-31" x="7452" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-29" x="7952" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-5D" x="8342" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-2F" x="8620" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-32" x="9121" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-3D" x="9899" y="0"></use><g transform="translate(10955,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-30" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-32" x="1279" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-35" x="1780" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mo stretchy="false">(</mo><mn>2</mn><mo>+</mo><mn>0.1</mn><mo stretchy="false">)</mo><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mn>2</mn><mo>+</mo><mo stretchy="false">(</mo><mo>‚àí</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">]</mo><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mn>2</mn><mo>=</mo><mn>0.025</mn></math></span></span><script type="math/tex" id="MathJax-Element-8"> [(2 + 0.1) / 2 + (-1)] / 2 = 0.025 </script>  . <br><br>  If we add age knowledge, the prediction of the model will be <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>(</mo><mn>2</mn><mo>+</mo><mn>0.1</mn><mo stretchy=&quot;false&quot;>)</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>/</mo></mrow><mn>2</mn><mo>=</mo><mn>1.05</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="18.341ex" height="2.66ex" viewBox="0 -832 7897 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-28" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-32" x="389" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-2B" x="1112" y="0"></use><g transform="translate(2112,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-31" x="779" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-29" x="3392" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-2F" x="3781" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-32" x="4282" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-3D" x="5060" y="0"></use><g transform="translate(6116,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-30" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-35" x="1279" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mn>2</mn><mo>+</mo><mn>0.1</mn><mo stretchy="false">)</mo><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mn>2</mn><mo>=</mo><mn>1.05</mn></math></span></span><script type="math/tex" id="MathJax-Element-9"> (2 + 0.1) / 2 = 1.05 </script>  . <br><br>  As a result, the value of Shaply for the case of the absence of features: <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display"><span class="MathJax_SVG" id="MathJax-Element-10-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><merror><mtext>\&amp;#xA0;frac&amp;#xA0;{|&amp;#xA0;S&amp;#xA0;|!&amp;#xA0;(n&amp;#xA0;-&amp;#xA0;|&amp;#xA0;S&amp;#xA0;|&amp;#xA0;-1)!}&amp;#xA0;{n!}&amp;#xA0;(p&amp;#xA0;(S&amp;#xA0;\&amp;#xA0;cup&amp;#xA0;\&amp;#xA0;{i&amp;#xA0;\})&amp;#xA0;-&amp;#xA0;p&amp;#xA0;(S))&amp;#xA0;=&amp;#xA0;\&amp;#xA0;frac&amp;#xA0;{1&amp;#xA0;(2-0&amp;#xA0;-1)!}&amp;#xA0;{2!}&amp;#xA0;(1.025)&amp;#xA0;=&amp;#xA0;$&amp;#xA0;0.512</mtext></merror></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><span class="noError" aria-hidden="true" style="display: inline-block;">\&nbsp;frac&nbsp;{|&nbsp;S&nbsp;|!&nbsp;(n&nbsp;-&nbsp;|&nbsp;S&nbsp;|&nbsp;-1)!}&nbsp;{n!}&nbsp;(p&nbsp;(S&nbsp;\&nbsp;cup&nbsp;\&nbsp;{i&nbsp;\})&nbsp;-&nbsp;p&nbsp;(S))&nbsp;=&nbsp;\&nbsp;frac&nbsp;{1&nbsp;(2-0&nbsp;-1)!}&nbsp;{2!}&nbsp;(1.025)&nbsp;=&nbsp;$&nbsp;0.512</span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><merror><mtext>\&nbsp;frac&nbsp;{|&nbsp;S&nbsp;|!&nbsp;(n&nbsp;-&nbsp;|&nbsp;S&nbsp;|&nbsp;-1)!}&nbsp;{n!}&nbsp;(p&nbsp;(S&nbsp;\&nbsp;cup&nbsp;\&nbsp;{i&nbsp;\})&nbsp;-&nbsp;p&nbsp;(S))&nbsp;=&nbsp;\&nbsp;frac&nbsp;{1&nbsp;(2-0&nbsp;-1)!}&nbsp;{2!}&nbsp;(1.025)&nbsp;=&nbsp;$&nbsp;0.512</mtext></merror></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-10"> \ frac {| S |! (n - | S | -1)!} {n!} (p (S \ cup \ {i \}) - p (S)) = \ frac {1 (2-0 -1)!} {2!} (1.025) = $ 0.512</script></p><br><br><h4>  The situation when we know the floor </h4><br>  For bobby for <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>g</mi><mi>e</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>r</mi></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.942ex" height="2.419ex" viewBox="0 -780.1 2989 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMATHI-67" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMATHI-65" x="480" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMATHI-6E" x="947" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMATHI-64" x="1547" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMATHI-65" x="2071" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMATHI-72" x="2537" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi>g</mi><mi>e</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>r</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-11"> {gender} </script>  prediction without features age, only with features gender <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mo stretchy=&quot;false&quot;>(</mo><mn>2</mn><mo>+</mo><mn>0.1</mn><mo stretchy=&quot;false&quot;>)</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>/</mo></mrow><mn>2</mn><mo>+</mo><mo stretchy=&quot;false&quot;>(</mo><mo>&amp;#x2212;</mo><mn>1</mn><mo stretchy=&quot;false&quot;>)</mo><mo stretchy=&quot;false&quot;>]</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>/</mo></mrow><mn>2</mn><mo>=</mo><mn>0.025</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="30.743ex" height="2.66ex" viewBox="0 -832 13236.4 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-28" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-32" x="668" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-2B" x="1390" y="0"></use><g transform="translate(2391,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-31" x="779" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-29" x="3670" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-2F" x="4060" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-32" x="4560" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-2B" x="5283" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-28" x="6284" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-2212" x="6673" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-31" x="7452" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-29" x="7952" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-5D" x="8342" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-2F" x="8620" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-32" x="9121" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-3D" x="9899" y="0"></use><g transform="translate(10955,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-30" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-32" x="1279" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/428213/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgVkXPpagLZo3UJGO2qyACkumwLlg#MJMAIN-35" x="1780" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mo stretchy="false">(</mo><mn>2</mn><mo>+</mo><mn>0.1</mn><mo stretchy="false">)</mo><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mn>2</mn><mo>+</mo><mo stretchy="false">(</mo><mo>‚àí</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">]</mo><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mn>2</mn><mo>=</mo><mn>0.025</mn></math></span></span><script type="math/tex" id="MathJax-Element-12"> [(2 + 0.1) / 2 + (-1)] / 2 = 0.025 </script>  .  If we know age, then prediction is the leftmost tree, that is, 2. <br><br>  As a result, the Shaply value for this case: <br><br><p><math> </math> $$ display $$ \ begin {equation *} \ frac {| S |! (n - | S | -1)!} {n!} (p (S \ cup \ {i \}) - p (S) ) = \ frac {1 (2-1-1)!} {2!} (1.975) = 0.9875 \ end {equation *} $$ display $$ </p><br><br><h4>  Summarize </h4><br><br>  Total Shaply value for feature age (age): <br><p><math> </math> $$ display $$ \ begin {equation *} \ phi_ {Age Bobby} = 0.9875 + 0.5125 = 1.5 \ end {equation *} $$ display $$ </p><br><h2>  Real example from business </h2><br>  The SHAP library has a rich visualization functionality that helps to easily and simply explain the model for both the business and the analyst himself in order to assess the adequacy of the model. <br><br>  On one of the projects, I analyzed the outflow of employees from the company.  Xgboost was used as a model. <br><br>  Code in python: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> shap shap_test = shap.TreeExplainer(best_model).shap_values(df) shap.summary_plot(shap_test, df, max_display=<span class="hljs-number"><span class="hljs-number">25</span></span>, auto_size_plot=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br>  The resulting graph of the importance of features: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3f8/5d0/8d0/3f85d08d0c377285d8d6751bd04bb758.png" alt="image"><br><br>  How to read it: <br><br><ul><li>  the values ‚Äã‚Äãto the left of the central vertical line are negative class (0), to the right positive (1) </li><li>  the thicker the line on the graph, the more such observation points </li><li>  the redder the point on the graph, the higher the feature values ‚Äã‚Äãin it </li></ul><br>  From the graph you can draw interesting conclusions and check their adequacy: <br><br><ul><li>  the less an employee is paid a salary, the higher the likelihood of his leaving </li><li>  There are regions of offices, where the outflow is higher </li><li>  the younger the employee, the higher the likelihood of his leaving </li><li>  ... </li></ul><br>  You can immediately form a portrait of the outgoing employee: he did not get a salary, he is young enough, single for a long time in one position, there was no grade increase, there were no high annual assessments, he began to communicate with his colleagues a little. <br><br>  Simple and convenient! <br><br>  You can explain the prediction for a particular employee: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/388/aab/c93/388aabc9318855e327e570de00359744.png" alt="image"><br><br>  Or see the dependence of predictions on a specific feature in the form of 2D graphics: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cf8/863/c5b/cf8863c5b4e8fb3c3775725507bc9be9.png" alt="image"><br><br>  You can even visualize the predictions of neural networks in the pictures: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3ac/ab2/146/3acab21469b2afd94b135923ec5e6d4c.png" alt="image"><br><br><h2>  Conclusion </h2><br>  I myself learned about SHAP values ‚Äã‚Äãabout six months ago and this completely replaced other methods for assessing the importance of features. <br><br>  Main advantages: <br><br><ul><li>  convenient visualization and interpretation </li><li>  honest calculation of the importance of features </li><li>  the ability to evaluate features for a specific subsample of data (for example, how our customers differ from other clients in the sample) is done with a simple dataset filter in pandas and its analysis in the shap, literally a couple of lines of code </li></ul></div><p>Source: <a href="https://habr.com/ru/post/428213/">https://habr.com/ru/post/428213/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../428201/index.html">Wormholes in JavaScript</a></li>
<li><a href="../428203/index.html">We look charts: estimates and forecasts for the cloud computing market, data in 2018</a></li>
<li><a href="../428205/index.html">Lifehacks NaviHaka</a></li>
<li><a href="../428209/index.html">Developer Cookbook: Domain Driven Design Recipes (Part 2, Structure and Interaction)</a></li>
<li><a href="../428211/index.html">The book "Evolutionary Architecture. Continuous change support</a></li>
<li><a href="../428217/index.html">Million video calls per day or ‚ÄúCall Mom!‚Äù</a></li>
<li><a href="../428219/index.html">Where did the practice of mass relocation of qualified personnel come from?</a></li>
<li><a href="../428221/index.html">Generating arbitrary realistic entities using AI</a></li>
<li><a href="../428223/index.html">Cities and their ‚Äúbig data‚Äù</a></li>
<li><a href="../428225/index.html">How to do web analytics for SaaS through Google Analytics: introducing and tracking funnels</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>