<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>AVR microcontrollers and Ada language</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I want to share a link to the AVR-Ada project ( sourceforge.net/projects/avr-ada ) by Rolf Ebert and give an example of using the Hell...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>AVR microcontrollers and Ada language</h1><div class="post__text post__text-html js-mediator-article">  In this article I want to share a link to the AVR-Ada project ( <a href="http://sourceforge.net/projects/avr-ada/">sourceforge.net/projects/avr-ada</a> ) by Rolf Ebert and give an example of using the Hell language in an amateur project on a microcontroller.  The article may be useful to those who, like me, are not at all friendly with the language of "C".  As an example, let's take a banal device - a thermometer on a DS18B20 sensor and an ATtiny13 microcontroller with LED indication. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/c74/336/afe/c74336afe4ea149ea6b02affebe9fd37.png" alt="Thermometer"><br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Part 1. Software components </h2><br>  To develop the firmware you will need to download the following: <br>  1.1.  WinAVR-20100110 ( <a href="http://sourceforge.net/projects/winavr/files/WinAVR/20100110/">sourceforge.net/projects/winavr/files/WinAVR/20100110</a> ) - SDK for the development of firmware in Assembler and C.  Includes "Programmers Notepad" with Ada syntax highlighting. <br>  1.2.  AVR-Ada-1.1.0 ( <a href="http://sourceforge.net/projects/avr-ada/files/avr-ada/bin_windows/">sourceforge.net/projects/avr-ada/files/avr-ada/bin_windows</a> ) - GNAT compiler and Ada libraries for WinAVR.  Includes sample programs. <br>  1.3.  Program programmer.  In my case, this is AvrOSPII, supplied with the programmer. <br><br>  In the download section of AVR-Ada there are versions 1.1 and 1.2.  For ease of installation, I recommend using an older version, since the new one requires several additional libraries (dll) that are not available in the installer.  If you want to install version 1.2, then the missing parts can be found in MinGW ( <a href="http://sourceforge.net/projects/mingw/files/">sourceforge.net/projects/mingw/files</a> ). <br><br>  AVR-Ada should be installed over WinAVR in the same directory.  Compilation is done using the ‚Äúmake‚Äù utility, so the directories ‚ÄúC: \ WinAVR-20100110 \ utils \ bin‚Äù and ‚ÄúC: \ WinAVR-20100110 \ bin‚Äù should be included in the PATH environment variable. <br><br><h2>  Part 2. Hardware components </h2><br>  The following devices are required: <br>  2.1.  The programmer ‚Äî in my case ‚Äî the Inex PX-400 is driven by an assortment of ‚Äúvillage‚Äù stores. <br>  2.2.  Power supply for thermometer and programmer - any 5 V mobile phone charger will do. <br>  2.3.  Actually a thermometer. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/8d6/df4/6ad/8d6df46adf083a3f035ff8400f19efee.png" alt="Scheme"><br><br>  The device consists of an ATtiny13 microcontroller ( <a href="http://www.atmel.com/devices/attiny13.aspx">www.atmel.com/devices/attiny13.aspx</a> ), a DS18B20 temperature sensor, a current-limiting resistor of at least 100 Ohms and a LED.  The sensor is connected via a 1-wire bus to the PB4 pin of the microcontroller.  Please note that the sensor can not be connected to the terminals used to connect the programmer (RESET, SCK, MOSI, MISO), since the intervention of the sensor in the exchange of data can lead to unpredictable consequences.  Description of the 1-wire bus requires a 4.7 kOhm pull-up resistor, or less for parasitic power mode.  It is also recommended to reduce this value when the tire is long.  In our case, the length of the bus is minimal and parasitic power is not required, therefore, a pull-up resistor of 20-50 kŒ© is enough that is built into the microcontroller.  The LED connects to the PB3 pin.  It is also possible to connect the LEDs to the terminals SCK, MOSI, MISO, but you will need to fulfill a number of additional requirements. <br><br>  To turn on the LED, it is necessary to switch the corresponding output of the microcontroller to the "output" mode and give it a high level.  For data exchange with a thermal sensor, a ready-made library is used, which will independently configure the output.  To work correctly, time extracts need to set the clock frequency of the microcontroller to 8 MHz (‚Äúfuse bit‚Äù CKDIV8 = 1).  By default, the ATtiny13 is tuned to 1 MHz.  Installation is performed in accordance with the instructions on the programmer. <br><br><h2>  Part 3. Programming </h2><br>  As the title of the article will be programmed in the language of Hell.  The language is easy to learn, source codes are easy to read.  The textbook in Russian can be read here <a href="http://ada-ru.org/V-0.4w/index.html">ada-ru.org/V-0.4w/index.html</a> <br><br>  Let's start with a flashing LED.  The entire project will consist of the source text (the ‚ÄúMain.adb‚Äù file), the project file (build.gpr) and the ‚Äúmake‚Äù utility configuration (Makefile).  About the last two it is written in the part dedicated compilation.  The file ‚ÄúMain.adb‚Äù will look like this: <br><br>  Main.adb <br><hr><br><img src="https://habrastorage.org/getpro/geektimes/post_images/5e5/a42/9f6/5e5a429f6acc2950ab3a55ff186074c7.png" alt="Listing 1"><br><hr><br><br>  The same code with comments: <br>  Main.adb <br><hr><br><img src="https://habrastorage.org/getpro/geektimes/post_images/201/d83/e8a/201d83e8a1f8517c74a687005b2805e8.png" alt="Listing 2"><br><hr><br><br>  Let us expand the example by reading the temperature from the sensor memory  To the above files you need to add the One_Wire library (files one_wire.ads, one_wire.adb, one_wire-init_comm.adb, one_wire-avr_wiring.ads), which can be found in the folder ‚ÄúC: \ WinAVR-20100110 \ lib \ gnat \ onewire‚Äù.  Special attention should be paid to the file ‚Äúone_wire-avr_wiring.ads‚Äù.  It is necessary to specify the output of the microcontroller used to connect the bus 1-wire.  For the given scheme it will look like this: <br>  one_wire-avr_wiring.ads <br><hr><br><img src="https://habrastorage.org/getpro/geektimes/post_images/bd3/4b9/172/bd34b9172250f62b2dafb33882ad2df2.png" alt="Listing 2"><br><hr><br><br>  Extended sample code: <br>  Main.adb <br><hr><br><img src="https://habrastorage.org/getpro/geektimes/post_images/c74/ceb/876/c74ceb8760cee1b62cf2b0f154dd769a.png" alt="Listing 3"><br><hr><br><br><h2>  Part 4. Compilation </h2><br>  As mentioned earlier, the compilation is carried out using the ‚Äúmake‚Äù utility, which is located in the ‚ÄúC: \ WinAVR-20100110 \ utils \ bin‚Äù directory.  To compile, you need to copy the folder with the project ‚ÄúMakefile‚Äù from the folder ‚ÄúC: \ WinAVR-20100110 \ share \ doc \ avr-ada \ apps \ examples‚Äù and specify the necessary parameters in it: <br><br>  Makefile <br><pre><code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#   MCU := attiny13 #    GNAT (  ) GPR := build.gpr #    ADA_TARGETS := main #     ...</span></span></code> </pre> <br><br>  The GNAT compiler (The GNU Ada Compiler) allows you to set various options through a project file with the extension "* .gpr".  Examples of projects can also be found in the folder ‚ÄúC: \ WinAVR-20100110 \ share \ doc \ avr-ada \ apps \ examples‚Äù.  In our case, it will look like this: <br>  build.gpr <br><pre> <code class="delphi hljs">project Build extends "avr_app" <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> --  ""   "avr_app", --    AVR-Ada <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Object_Dir use "obj"; --      obj, --     <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Exec_Dir use "."; --        <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Source_Dirs use ("."); --        <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> Build;</code> </pre><br><br>  Now you can go to the folder with the project and try to compile: <br><pre> <code class="hljs bash">&gt;<span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-string"><span class="hljs-string">"  "</span></span> &gt;make</code> </pre><br>  In order not to climb into the console, ‚ÄúProgrammers Notepad‚Äù has the ‚ÄúTools&gt; [WinAVR] Make all‚Äù command. <br>  Most likely, compilation from the first time will not be performed.  This is due to the very strict syntax of Ada and the compiler's meticulousness.  We'll have to fix a lot of syntax errors that are not considered errors in other languages. <br><br>  If the compilation is still successful, then the main.hex file will appear in the root folder, which you need to flash into the microcontroller in accordance with the instructions on the programmer. <br><br><h2>  Part 5. Decorative </h2><br>  A small glass cup can be used as the body of the device obtained (no, this is not a stack for vodka consumption, it is a candlestick). <br>  A handful of matte white beads works well as a diffuser.  It creates the impression of a smooth growth and attenuation of the fire with a smooth brightness control. <br>  A blue LED has been added to indicate negative temperatures in my thermometer. <br>  In addition to the simplest unary indication system shown in the example, there are also options for unary-decimal, binary, ternary and unary with zero offset indications. <br><br><h2>  application </h2><br>  Unfortunately, Habrahabr does not support Ada syntax highlighting (well, or I am a ‚Äúnovice user‚Äù), so I had to insert the code in the form of pictures.  Archive with code in text form <a href="">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/161257/">https://habr.com/ru/post/161257/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../161243/index.html">The iTunes Store is now in Russia - long live the ruble!</a></li>
<li><a href="../161245/index.html">ABBYY Labs. Q & A Project: Demonstration of Opportunities</a></li>
<li><a href="../161247/index.html">Google releases second version of Maps Android API</a></li>
<li><a href="../161251/index.html">When in your country will turn off the Internet?</a></li>
<li><a href="../161253/index.html">Express.js project template</a></li>
<li><a href="../161259/index.html">The book ‚ÄúDeveloping Applications for Windows 8 in C #‚Äù is available for download.</a></li>
<li><a href="../161261/index.html">Google targeting tablets</a></li>
<li><a href="../161267/index.html">Hyper-V 3.0 against ... Or suicidal holivor</a></li>
<li><a href="../161269/index.html">Portal oplatagosuslug.ru opened</a></li>
<li><a href="../161271/index.html">Self-propelled road construction combine: 1 km of road in 1 day and $ 3-5 million</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>