<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>jQuery Deferred Object (detailed description)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On January 31, jQuery 1.5 was released, one of the key innovations of which was the tool Deferred Object. It is about him that I want to tell more in ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>jQuery Deferred Object (detailed description)</h1><div class="post__text post__text-html js-mediator-article">  On January 31, jQuery 1.5 was released, one of the key innovations of which was the tool Deferred Object.  It is about him that I want to tell more in this article. <br><br>  This new library functionality is aimed at simplifying work with deferred callbacks.  Deferred Object, similar to the jQuery object, is ‚Äúchainable‚Äù (chainable), but has its own set of methods.  Deferred Object is able to register multiple handlers in a queue, call handlers registered in a queue, and switch the state to ‚Äúcompleted‚Äù or ‚Äúerror‚Äù for synchronous or asynchronous functions. <br><a name="habracut"></a><br><h2>  general description </h2><br>  The idea is quite simple: you need to create a Deferred Object, give this object to some external code that can hook handlers to it (or not hook), and then initiate the execution of these handlers by calling just one object method. <br><br>  The whole process of using the Deferred Object can be divided into three global stages: <br><ul><li>  A deferred object is created and initialized, the state of which was ‚Äúnot executed‚Äù. </li><li>  The resulting object is issued to the external code, where handlers are added to the object in the queue using the methods <strong>deferred.then ()</strong> , <strong>deferred.done ()</strong> and <strong>deferred.fail ()</strong> .  Handlers can be of two types: ‚Äúexecution processing‚Äù and ‚Äúerror handling‚Äù. </li><li>  Upon fulfillment of a certain condition (event) in the code where the object was created, the method for executing handlers is called: <strong>deferred.resolve ()</strong> calls handlers for ‚Äúsuccessful completion‚Äù and translates the state of the object to ‚Äúcompleted‚Äù, <strong>deferred.reject ()</strong> calls handlers for ‚Äúerrors‚Äù and translates the state of the object to "canceled." </li></ul><br>  The word ‚Äúqueue‚Äù in the description of Deferred Object is not just used - the handlers added to the queue are called in the order in which they were added (those who were added earlier will be called earlier). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      When adding handlers, it is not necessary to check the state of the deferred object (or if it has already been completed or canceled).  If the "run" / "error" handler is added to an already "completed" / "canceled" object, it will be called immediately. <br><br>  Re-call the resolve / reject of the object deferred does not lead to a change in its state and re-call handlers, but is simply ignored (and it doesn‚Äôt matter what the resolve () or reject () was called before). <br><br>  Deferred Object is ‚Äúchained‚Äù, which means that its methods (not all) return a reference to the source object, which makes it possible to call several methods of the object in a row, separating them with a full stop.  For example, like this: deferred.done (callback1) .fail (callback2); <br><br><h2>  Description of methods </h2><br>  <strong>deferred.done (doneCallbacks)</strong> <br>  adds a handler that will be called when the deferred object goes into the "completed" state <br><br>  <strong>deferred.fail (failCallbacks)</strong> <br>  adds a handler that will be called when the deferred object goes into the "canceled" state <br><br>  <strong>deferred.then (doneCallbacks, failCallbacks)</strong> <br>  adds handlers at once of both types described above, equivalent to writing deferred.done (doneCallbacks) .fail (failCallbacks) <br><br>  In the three methods described above, the doneCallbacks, failCallback arguments can be separate functions or arrays of functions. <br><br>  <strong>deferred.resolve (args)</strong> <br>  puts the deferred object in the "completed" state and calls all doneCallbacks handlers with args parameters (the usual listing of parameters is separated by commas) <br><br>  <strong>deferred.reject (args)</strong> <br>  sets the deferred object to the "canceled" state and calls all failCallbacks handlers with args parameters <br><br>  The call context (this inside the function) of the handlers when using the two methods described above will be the projection of the deferred object (or the object itself, if the projection cannot be created) (for the deferred projection, see further in the description deferred.promise ()).  If it is required to start handler functions with a different call context, then the following two methods should be used: <br><br>  <strong>deferred.resolveWith (context, args)</strong> <strong><br></strong>  <strong>deferred.rejectWith (context, args)</strong> <br>  methods are completely analogous to .resolve (args) and .reject (args), only the context will be available inside the handler functions via the this keyword <br><br>  You can check the status of a deferred object using the methods: <br><br>  <strong>deferred.isResolved ()</strong> <strong><br></strong>  <strong>deferred.isRejected ()</strong> <br>  methods return true or false depending on the current state of the object.  At the time of execution of the handlers (but the latter has not yet been executed), the corresponding method returns true. <br><br><h2>  Creating a projection using the deferred.promise () method </h2><br>  This method creates and returns a ‚Äúprojection‚Äù of a deferred object ‚Äî it is a kind of copy of an object that has methods for adding handlers and checking state.  Those.  we get a deferred object that works with the same queue of handlers as the original, allows adding handlers to it, viewing the state of the original object, but does not allow changing the state of the original object. <br><br>  Creating a projection is necessary when it is necessary to give an external code the ability to add handlers to the queue and at the same time protect against unauthorized calling of methods for changing the state of an object. <br><br><h2>  Creating a Deferred Object </h2><br>  You can create a deferred object in two ways: create a new instance of your own using the $ .Deferred () method (the new keyword is optional) or call the $ .when (args) method to use the previously created deferred objects. <br><br>  <strong>$ .Deferred (func)</strong> <br><br>  The method returns a new deferred object.  The func argument is optional; you can pass to it a function that initializes the created object before returning it from the constructor.  Inside the func function, you can access the object being initialized by deferred through this and / or through the first function argument. <br><br>  <strong>$ .when (deferred1, deferred2, ...)</strong> <br><br>  This method is used to create a deferred object that goes into the "completed" state after all its arguments (deferred objects) go into this state, or go into the "canceled" state as soon as at least one of its arguments is canceled. <br><br>  If you want to wait for the execution of all tasks and only then complete our tasks, then in this case the place is for this method. <br>  <u>Example 1</u> <br><blockquote><code><font color="black">$.when($.get( <font color="#A31515">'/echo/html/'</font> ), $.post( <font color="#A31515">'/echo/json/'</font> )).done( <font color="#0000ff">function</font> (args1, args2) { alert( <font color="#A31515">" "</font> ); });</font></code> </blockquote> <br>  This code will display the message ‚Äúdownload completed‚Äù only after both pages have been successfully loaded into the specified blocks. <br><br>  If the argument of $ .when () is not a deferred object, then it is considered that this task has already been successfully completed and the program's program is oriented to the remaining arguments. <br><br>  When a deferred object obtained by the $ .when () method becomes "executed", the call context (this within the function) of the handlers will be the projection of this deferred object, and the arrays in which the corresponding execution arguments passed to $ will be passed to the handlers .when () deferred objects (or one argument itself, if it is one).  In the example above, args1 is an array of arguments to the success call for the first ajax request, and args2 for the second. <br><br><h2>  Use Deferred Object in $ .ajax () </h2><br>  In jQuery 1.5, the ajax engine was radically rewritten and now the <strong>$ .ajax ()</strong> method and its shortened versions also use deferred objects.  This makes it possible to assign quite a few simple handlers to request completion events (success or failure), as well as assign handlers to complete several parallel requests. <br><br>  From the methods $ .ajax (), $ .get (), $ .post (), $ .getScript (), $ .getJSON () returns an object that has a projection of the deferred object, i.e.  it has methods that allow you to add handlers to the queue and use this object as the $ .when () argument. <br><br>  In addition to this object, synonyms of methods have been added, which by names are more appropriate to the subject of ajax requests: <br><ul><li>  deferred.success = deferred.done - add handler for successful completion of the request </li><li>  deferred.error = deferred.fail - add an error handler to complete the request </li><li>  deferred.complete - add a request handler to complete the request (no matter successful or error), it is called after all the handlers added via success / done or error / fail </li></ul><br><h2>  Interesting Facts </h2><br>  The $ .when () method, when evaluating its arguments that they belong to deferred objects, checks whether they have a .promise () method, and if there is such a method, then even the ‚Äúleft‚Äù object is considered deferred.  A bug is associated with this, when referring to such ‚Äúleft‚Äù objects as if they are deferred leads to execution errors. <br><br>  In the latest development versions of jQuery (jquery-git.js), the deferred object also has the .invert () method, which, similar to the .promise () method, creates a projection of the object only with the opposite methods: done &lt;=&gt; fail, isResolved &lt; =&gt; isRejected, promise &lt;=&gt; invert.  The application of this method has not yet been noticed by me <br><br><h2>  Examples of using </h2><br>  In example 1. (see above) a solution to a typical problem of tracking the completion of several ajax requests is already shown. <br><br>  <u>Example 2</u> <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">//    3 </font> <br> <font color="#0000ff">function</font> test() { <br> <font color="#0000ff">var</font> d = $.Deferred(); <br> setTimeout( <font color="#0000ff">function</font> () { d.resolve(); }, 3000); <br> <font color="#0000ff">return</font> d.promise(); <br> } <br> <br> <font color="#0000ff">var</font> t = test().done( <font color="#0000ff">function</font> () { alert( <font color="#A31515">" "</font> ); }); <br> <br> <font color="#008000">//      </font> <br> setTimeout( <font color="#0000ff">function</font> () { <br> alert( <font color="#A31515">"  "</font> ); <br> t.done( <font color="#0000ff">function</font> () { alert( <font color="#A31515">""</font> ); }); <br> }, 5000);</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  This is a purely demo example, a deferred object is constructed, the state of which is translated to ‚Äúcompleted‚Äù after 3 seconds, and issued to an external code.  In the external code, one handler is added immediately - it is called after 3 seconds, and the second 5 seconds after construction, when the state is already ‚Äúcompleted‚Äù, so it is called immediately when added. <br><br>  <u>Example 3</u> <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">div</font> <font color="#ff0000">id</font> <font color="#0000ff">="d1"</font> <font color="#ff0000">style</font> <font color="#0000ff">="width:100px;height:100px;background:red;"</font> <font color="#0000ff">&gt;</font> 1 <font color="#0000ff">&lt;/</font> <font color="#800000">div</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">div</font> <font color="#ff0000">id</font> <font color="#0000ff">="d2"</font> <font color="#ff0000">style</font> <font color="#0000ff">="width:100px;height:100px;background:green;"</font> <font color="#0000ff">&gt;</font> 2 <font color="#0000ff">&lt;/</font> <font color="#800000">div</font> <font color="#0000ff">&gt;</font></font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">//     </font> <br> <font color="#0000ff">var</font> a1 = $.Deferred(), <br> a2 = $.Deferred(); <br> <br> $( <font color="#A31515">'#d1'</font> ).slideUp(2000, a1.resolve); <br> $( <font color="#A31515">'#d2'</font> ).fadeOut(4000, a2.resolve); <br> <br> a1.done( <font color="#0000ff">function</font> () { alert( <font color="#A31515">'a1'</font> ); }); <br> a2.done( <font color="#0000ff">function</font> () { alert( <font color="#A31515">'a2'</font> ); }); <br> $.when(a1, a2).done( <font color="#0000ff">function</font> () { alert( <font color="#A31515">'both'</font> ); });</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  This code provides an example of solving a more real problem when you need to execute some code after completing several animations.  It is quite simple to add an animation completion handler on one element (this is also used), but it is somewhat more difficult to track the completion of independent animations.  Using deferred objects and $ .when (), the code becomes straightforward. <br><br>  All examples can be run and tested on the <a href="http://jsfiddle.net/">jsfiddle.net</a> service <a href="http://jsfiddle.net/">.</a> <br><br>  Materials: <br>  <a href="http://blog.jquery.com/2011/01/31/jquery-15-released/">blog.jquery.com/2011/01/31/jquery-15-released</a> <br>  <a href="http://api.jquery.com/category/deferred-object/">api.jquery.com/category/deferred-object</a> <br>  <a href="http://www.erichynds.com/jquery/using-deferreds-in-jquery/">www.erichynds.com/jquery/using-deferreds-in-jquery</a> (translation: <a href="http://habrahabr.ru/blogs/jquery/112960/">habrahabr.ru/blogs/jquery/112960</a> ) <br>  JQuery 1.5 <a href="http://jquery.com/">source code</a> and <a href="http://api.jquery.com/">documentation</a> </div><p>Source: <a href="https://habr.com/ru/post/113073/">https://habr.com/ru/post/113073/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../113065/index.html">Python (x, y)</a></li>
<li><a href="../113066/index.html">Half a million passwords were found in the Waledac botnet server caches</a></li>
<li><a href="../113068/index.html">Mozilla released Firefox 4 beta 4 for Android and Maemo</a></li>
<li><a href="../113069/index.html">The three most useful skills that I learned 5 years ago</a></li>
<li><a href="../113072/index.html">Where are the negative reviews on ebaytoday.ru?</a></li>
<li><a href="../113074/index.html">Automatic file copying on iOS device without jailbreak and file managers</a></li>
<li><a href="../113075/index.html">Virtual keyboard</a></li>
<li><a href="../113076/index.html">Group of users</a></li>
<li><a href="../113077/index.html">6 reasons why you should not write functional specifications</a></li>
<li><a href="../113078/index.html">Web developer pitfalls</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>