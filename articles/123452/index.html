<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Pitfalls when working with php-handlersocket</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="HandlerSocket is a noSQL plugin for mySQL that allows you to access databases bypassing the SQL level. 

 This article is intended for those who succe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Pitfalls when working with php-handlersocket</h1><div class="post__text post__text-html js-mediator-article"> HandlerSocket is a noSQL plugin for mySQL that allows you to access databases bypassing the SQL level. <br><br>  This article is intended for those who successfully installed HandlerSocket and php-handlersocket, and also encountered a poor manual and strange behavior of this plugin for php. <br><a name="habracut"></a><br>  If you hear about this decision for the first time, then I recommend to get acquainted with the following materials: <br>  <a href="http://tokarchuk.ru/2010/10/nosql-in-mysql-improve-mysql/">NoSQL in MySQL: MySQL overclocks to 750,000 queries per second</a> <br>  <a href="http://habrahabr.ru/blogs/nosql/113040/">First experience with Handler Socket &amp; php_handlersocket</a> <br>  <a href="http://habrahabr.ru/blogs/nosql/113039/">Some subtleties of Update &amp; Insert in Handler Socket</a> <br><br>  On close examination and knowledge of the deepest depths of mySQL, many of the questions are rather naive, but these are the questions that have puzzled me during development.  At the same time, it is not always clear that from the ‚Äúfeatures‚Äù I discovered are a consequence of the internal structure of mySQL, which is the result of the work of tentacles by the creator of the HandlerSocket Yoshinori Matsunobu, and that, in turn, by the code php-handlersocket. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To illustrate the examples, the following source table is used: <br><br> <code>CREATE TABLE IF NOT EXISTS `test` ( <br> `id` int(11) NOT NULL AUTO_INCREMENT, <br> `country_id` int(11) NOT NULL, <br> `city_id` int(11) NOT NULL, <br> `language` varchar(2) NOT NULL, <br> `name` varchar(255) NOT NULL, <br> `created_at` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00', <br> PRIMARY KEY (`id`), <br> KEY `idx_name` (`name`), <br> KEY `idx_country_language` (`country_id`,`language`) <br> ) ENGINE=InnoDB DEFAULT CHARSET=utf8 AUTO_INCREMENT=0; <br> <br> INSERT INTO `test` (`id`, `country_id`, `city_id`, `language`, `name`, `created_at`) VALUES <br> (1, 1, 1, 'es', 'Terminator', '2011-07-02 00:00:00'), <br> (2, 1, 1, 'en', 'Flash Gordon'', '2011-07-02 01:00:00'), <br> (3, 3, 4, 'en', 'Batman', '2011-07-02 02:00:00'), <br> (4, 1, 2, 'jp', 'Godzilla', '2011-07-02 03:00:00'), <br> (5, 2, 8, 'es', 'Superman', '2011-07-02 04:00:00'); <br></code> <br>  And, of course, the HandlerSockets themselves <br><br> <code>$hsr = new HandlerSocket('localhost', 9998); //   <br> $hsw = new HandlerSocket('localhost', 9999); //   <br></code> <br>  And now let's imagine for a moment that we are confronted only with a junior and his more experienced comrade who has sat down for using php-handlersocket. <br><br>  <b>I executed executeInsert (), and nothing appeared in the database!</b> <br><br>  If you use innoDB, then do FLUSH TABLE.  innoDB is transactional tables, so you need to tell mySQL that "everything has arrived."  Of course, there are no such problems with myISAM. <br><br>  <b>And why does my AUTO_INCREMENT field always get the value 0?</b> <br><br>  Considering auto_increment is not the responsibility of php-handlersocket.  But it does not forbid to consider it yourself, the main thing is not to forget to install it in the table using ALTER TABLE SET auto_increment after finishing work with php-handlersocket. <br><br>  <b>I can‚Äôt add a record by setting values ‚Äã‚Äãof only some fields!</b> <br><br>  When using executeInsert (), you cannot skip fields in openIndex (), but you can stop there, i.e.  Do not specify all fields in the table until the end. <br><br>  Does not work: <br><br> <code>$hsw-&gt;openIndex(0, 'test_db', 'test', '', 'id,name'); <br> $hsw-&gt;executeInsert(0, array(999, 'Green Lantern')); <br></code> <br>  Works: <br><br> <code>$hsw-&gt;openIndex(0, 'test_db', 'test', '', 'id,country_id,city_id,language,name'); <br> $hsw-&gt;executeInsert(0, array(999, 2, 3, 'en', 'Green Lantern')); <br></code> <br>  <b>I need to do a ‚ÄúSELECT * FROM Customers‚Äù!</b> <br><br>  By default, if the $ limit parameter is not specified, php-handlersocket returns only one entry that matches the specified criteria.  In order to get all the records from the table, regardless of the criteria, you can try the following: <br><br> <code>$hsr-&gt;openIndex(0, 'test_db', 'test', '', 'id,country_id,city_id,language,name,created_at'); <br> $res = $hsr-&gt;executeSingle(0, '&gt;', array(0), 9999999999); <br></code> <br>  However, it is worth remembering that an array will return to $ res, which can be very large, which can lead to irreparable consequences. <br><br>  <b>Reverse sorting by index is vital for me!</b> <br><br>  Then you should be a Hindu for a while!  Attention, never try to reproduce it at home: <br><br> <code>$hsr-&gt;openIndex(0, 'test_db'', 'test', '', 'id,country_id,city_id,language,name,created_at'); <br> $res = $hsr-&gt;executeSingle(0, '&lt;', array(9999999999)); <br></code> <br>  If you decided to achieve nirvana at all, and you want to sort the results by an index, which is a text field (in our case, idx_name), you can try the following: <br><br> <code>$hsr-&gt;openIndex(0, 'test_db'', 'test', 'idx_name', 'id,country_id,city_id,language,name,created_at'); <br> $res = $hsr-&gt;executeSingle(0, '&lt;', array('ZZZZZZZZZ')); <br></code> <br>  I recommend to treat these "ficham" very skeptical. <br><br>  <b>Some kind of nonsense with $ limit and $ skip.</b>  <b>$ limit = 3, $ skip = 0 returns the first 3 records, and $ limit = 3, $ skip = 3 does not return anything at all!</b> <br><br>  The fact is that php-handlersocket believes that $ limit is the number of all entries that should be selected, starting with zero, and $ skip - with which in order of recording it is necessary to return the result.  Those.  using the values ‚Äã‚Äãof the parameters $ limit = 3, $ skip = 3 means ‚Äúhey, take me only 3 entries and return to me those that are after the third‚Äù, which results in the return of an empty array.  To emulate "LIMIT 3, 3" you need to use the following: <br><br> <code>$hsw-&gt;openIndex(0, 'db_test', 'test', '', 'id,country_id,city_id,language,name,created_at'); <br> $r = $hsw-&gt;executeSingle(0, '&gt;', array(0), 6, 3); <br></code> <br>  <b>My sample does not work by index, where there are two fields and one of them is text (idx_country_language)!</b> <br><br>  Unfortunately, as practice has shown, php-handlersocket is not able to search by indexes containing text fields or dates.  Alternatively, it may be advisable to use the ENUM field type where possible.  At the same time, php-handlersocket copes remarkably with a sample of indices for one field (text or date). <br><br>  <b>findings</b> <br><br>  HandlerSocket + php-handlersocket are currently very interesting, but still a crutch for mySQL.  Rewriting the entire site for their use will not work in any case, but for a banal key-value-storage with pleasant additions, this solution is recommended. </div><p>Source: <a href="https://habr.com/ru/post/123452/">https://habr.com/ru/post/123452/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../123445/index.html">Craftsman added another display to the Nexus One</a></li>
<li><a href="../123446/index.html">MS SQL 2011 - New Sequence Object</a></li>
<li><a href="../123447/index.html">Mobile Saturday is now in Odessa!</a></li>
<li><a href="../123448/index.html">metabus - a platform for building thematic search engines</a></li>
<li><a href="../123451/index.html">Gearman - distribution framework for tasks, introduction</a></li>
<li><a href="../123453/index.html">Do-it-yourself textile printer with minimum cost</a></li>
<li><a href="../123455/index.html">"Store domains" from REG.RU as an alternative to auctions</a></li>
<li><a href="../123456/index.html">The sixth meeting of Apple-developers in St. Petersburg</a></li>
<li><a href="../123457/index.html">We place the files from Assets to the SD card using Infles</a></li>
<li><a href="../123460/index.html">CentOS 6 on the way</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>