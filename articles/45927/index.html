<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Portlet Basics</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi habrareyudi! Today I want to tell you about one interesting technology that I just met recently - this is portlet technology. Although on Habr√© the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Portlet Basics</h1><div class="post__text post__text-html js-mediator-article"> Hi habrareyudi!  Today I want to tell you about one interesting technology that I just met recently - this is <a href="http://ru.wikipedia.org/wiki/%25D0%259F%25D0%25BE%25D1%2580%25D1%2582%25D0%25BB%25D0%25B5%25D1%2582">portlet</a> technology.  Although on Habr√© there are already a couple of mentions about portlets, but I didn‚Äôt find anything intelligible there.  Therefore, I decided to write my own article where I want to show in practice how to program portlets.  In this case, simultaneously inserting some theoretical information.  And taking into account the fact that there is very little documentation in Russian, then I would like to tell about it twice :) <br><a name="habracut"></a><br>  To be in the know, we need a few definitions: <br><br>  The portal, in its simplest consideration, is a software platform containing a portlet-container, which in turn supports the <a href="http://portals.apache.org/pluto/portlet-1.0-apidocs/">Portlet API</a> and allows us to run portlets.  Also, the portal usually provides the means for managing groups and users, as well as wide possibilities for their customization. <br><br>  A portlet is a separate small web application that runs on a portal, the portal in turn aggregates one or more portlets on a separate web page, which are usually configured for individual users and groups of the portal.  As a result, we get a regular web page filled with several web applications.  And yet, portlets have a lot of servlet analogies, I think that many who are well aware of this will notice.  Once again to draw analogies and I will not dwell on this. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In this article I will describe the development of portlets within the <a href="http://jcp.org/en/jsr/detail%3Fid%3D168">JSR 168</a> specification, but I will not talk about choosing a portal, installing it, deploying portlets, etc.  I‚Äôll say right away that I was developing an application on <a href="http://www-01.ibm.com/software/websphere/portal/">IBM Web Sphere Portal 6</a> .  If someone tells about the features of development and deployment on other portals like Jboss Portal or some other, I would be very grateful :) <br><br>  So let's start developing, and we will develop ... in fact, for a long time I thought it would be better to cite as an example, I wanted the example not to be something trivial like Hello World, I wanted the portlet to find practical application and my choice fell on the portlet for aggregation <a href="http://ru.wikipedia.org/wiki/RSS">RSS</a> .  Why?  Actually! <br><br>  So, our mini TK: <br>  It is necessary to write a portlet that will collect rss from various channels and display it.  At the same time, we will provide each portal user with the opportunity to customize the portlet to fit their needs, i.e.  create and delete displayed channels, as well as set the number of news from each channel and the frequency of their updates. <br><br>  First, let's create a list of classes, libraries and jsp-nis that we need for our application: <br><br>  1) HabraRssPortlet - the actual portlet class itself. <br>  2) RssUtil - class for working with RSS. <br>  3) rssutils - a library (of course, you can write the parser itself, but it will take time and probably won't work out right away - it‚Äôs proven by experience) <br>  3) HabraRssPortletView.jsp - for displaying Rss. <br>  4) HabraRssPortletEdit.jsp - to configure the portlet by the user. <br>  5) HabraRssPortletHelp.jsp - where there will be something like ‚ÄúAbout‚Äù <br>  6) portlet.xml and web.xml - well, I think it is clear for what ... <br><br>  Let's go! <br><br>  I want to start with the deployment descriptor portlet.xml in order to explain some of the points that we will need later, the web.xml descriptor will not lead here, everything is painfully simple.  If someone is interested, then you can always look at the attachment. <br><br>  <strong>portlet.xml</strong> <br> <code><code><a href=""></a> <a href=""></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;?</font> <font color="#800000">xml</font> <font color="#ff0000">version</font> <font color="#0000ff">="1.0"</font> <font color="#ff0000">encoding</font> <font color="#0000ff">="UTF-8"</font> ? <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet-app</font> <font color="#ff0000">xmlns</font> <font color="#0000ff">="http://java.sun.com/xml/ns/portlet/portlet-app_1_0.xsd"</font> <font color="#ff0000">version</font> <font color="#0000ff">="1.0"</font> <font color="#ff0000">xmlns:xsi</font> <font color="#0000ff">="http://www.w3.org/2001/XMLSchema-instance"</font> <font color="#ff0000">xsi:schemaLocation</font> <font color="#0000ff">="http://java.sun.com/xml/ns/portlet/portlet-app_1_0.xsd java.sun.com/xml/ns/portlet/portlet-app_1_0.xsd"</font> <font color="#ff0000">id</font> <font color="#0000ff">="ru.habrahabr.rssportlet.HabraRssPortlet.a97fbe5bd1"</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet-name</font> <font color="#0000ff">&gt;</font> HabraRssPortlet <font color="#0000ff">&lt;/</font> <font color="#800000">portlet-name</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">display-name</font> <font color="#0000ff">&gt;</font> HabraRssPortlet <font color="#0000ff">&lt;/</font> <font color="#800000">display-name</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">display-name</font> <font color="#ff0000">xml:lang</font> <font color="#0000ff">="ru"</font> <font color="#0000ff">&gt;</font> HabraRssPortlet <font color="#0000ff">&lt;/</font> <font color="#800000">display-name</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet-class</font> <font color="#0000ff">&gt;</font> ru.habrahabr.rssportlet.HabraRssPortlet <font color="#0000ff">&lt;/</font> <font color="#800000">portlet-class</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">init-param</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> wps.markup <font color="#0000ff">&lt;/</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">value</font> <font color="#0000ff">&gt;</font> html <font color="#0000ff">&lt;/</font> <font color="#800000">value</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">init-param</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">expiration-cache</font> <font color="#0000ff">&gt;</font> 0 <font color="#0000ff">&lt;/</font> <font color="#800000">expiration-cache</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">supports</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">mime-type</font> <font color="#0000ff">&gt;</font> text/html <font color="#0000ff">&lt;/</font> <font color="#800000">mime-type</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet-mode</font> <font color="#0000ff">&gt;</font> view <font color="#0000ff">&lt;/</font> <font color="#800000">portlet-mode</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet-mode</font> <font color="#0000ff">&gt;</font> edit <font color="#0000ff">&lt;/</font> <font color="#800000">portlet-mode</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet-mode</font> <font color="#0000ff">&gt;</font> config <font color="#0000ff">&lt;/</font> <font color="#800000">portlet-mode</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet-mode</font> <font color="#0000ff">&gt;</font> help <font color="#0000ff">&lt;/</font> <font color="#800000">portlet-mode</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">supports</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">supported-locale</font> <font color="#0000ff">&gt;</font> ru <font color="#0000ff">&lt;/</font> <font color="#800000">supported-locale</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">resource-bundle</font> <font color="#0000ff">&gt;</font> ru.habrahabr.rssportlet.nl.HabraRssPortletResource <font color="#0000ff">&lt;/</font> <font color="#800000">resource-bundle</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet-info</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">title</font> <font color="#0000ff">&gt;</font> HabraRssPortlet <font color="#0000ff">&lt;/</font> <font color="#800000">title</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">short-title</font> <font color="#0000ff">&gt;</font> HabraRssPortlet <font color="#0000ff">&lt;/</font> <font color="#800000">short-title</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">keywords</font> <font color="#0000ff">&gt;</font> HabraRssPortlet <font color="#0000ff">&lt;/</font> <font color="#800000">keywords</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">portlet-info</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet-preferences</font> <font color="#0000ff">&gt;</font> &lt;br&gt;            &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">preference</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> updateFrequency <font color="#0000ff">&lt;/</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font>&lt;!-- in minutes --&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">value</font> <font color="#0000ff">&gt;</font> 10 <font color="#0000ff">&lt;/</font> <font color="#800000">value</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">preference</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">preference</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> itemQuantity <font color="#0000ff">&lt;/</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">value</font> <font color="#0000ff">&gt;</font> 3 <font color="#0000ff">&lt;/</font> <font color="#800000">value</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">preference</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">preference</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> rssLinks <font color="#0000ff">&lt;/</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">value</font> <font color="#0000ff">&gt;</font> www.vz.ru/rss.xml <font color="#0000ff">&lt;/</font> <font color="#800000">value</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">preference</font> <font color="#0000ff">&gt;</font> &lt;br&gt;&lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">portlet-preferences</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">portlet</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">custom-portlet-mode</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet-mode</font> <font color="#0000ff">&gt;</font> config <font color="#0000ff">&lt;/</font> <font color="#800000">portlet-mode</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">custom-portlet-mode</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">portlet-app</font> <font color="#0000ff">&gt;</font> &lt;br&gt;</font> &lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> <blockquote> <code><code><a href=""></a> <a href=""></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;?</font> <font color="#800000">xml</font> <font color="#ff0000">version</font> <font color="#0000ff">="1.0"</font> <font color="#ff0000">encoding</font> <font color="#0000ff">="UTF-8"</font> ? <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet-app</font> <font color="#ff0000">xmlns</font> <font color="#0000ff">="http://java.sun.com/xml/ns/portlet/portlet-app_1_0.xsd"</font> <font color="#ff0000">version</font> <font color="#0000ff">="1.0"</font> <font color="#ff0000">xmlns:xsi</font> <font color="#0000ff">="http://www.w3.org/2001/XMLSchema-instance"</font> <font color="#ff0000">xsi:schemaLocation</font> <font color="#0000ff">="http://java.sun.com/xml/ns/portlet/portlet-app_1_0.xsd java.sun.com/xml/ns/portlet/portlet-app_1_0.xsd"</font> <font color="#ff0000">id</font> <font color="#0000ff">="ru.habrahabr.rssportlet.HabraRssPortlet.a97fbe5bd1"</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet-name</font> <font color="#0000ff">&gt;</font> HabraRssPortlet <font color="#0000ff">&lt;/</font> <font color="#800000">portlet-name</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">display-name</font> <font color="#0000ff">&gt;</font> HabraRssPortlet <font color="#0000ff">&lt;/</font> <font color="#800000">display-name</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">display-name</font> <font color="#ff0000">xml:lang</font> <font color="#0000ff">="ru"</font> <font color="#0000ff">&gt;</font> HabraRssPortlet <font color="#0000ff">&lt;/</font> <font color="#800000">display-name</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet-class</font> <font color="#0000ff">&gt;</font> ru.habrahabr.rssportlet.HabraRssPortlet <font color="#0000ff">&lt;/</font> <font color="#800000">portlet-class</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">init-param</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> wps.markup <font color="#0000ff">&lt;/</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">value</font> <font color="#0000ff">&gt;</font> html <font color="#0000ff">&lt;/</font> <font color="#800000">value</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">init-param</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">expiration-cache</font> <font color="#0000ff">&gt;</font> 0 <font color="#0000ff">&lt;/</font> <font color="#800000">expiration-cache</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">supports</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">mime-type</font> <font color="#0000ff">&gt;</font> text/html <font color="#0000ff">&lt;/</font> <font color="#800000">mime-type</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet-mode</font> <font color="#0000ff">&gt;</font> view <font color="#0000ff">&lt;/</font> <font color="#800000">portlet-mode</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet-mode</font> <font color="#0000ff">&gt;</font> edit <font color="#0000ff">&lt;/</font> <font color="#800000">portlet-mode</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet-mode</font> <font color="#0000ff">&gt;</font> config <font color="#0000ff">&lt;/</font> <font color="#800000">portlet-mode</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet-mode</font> <font color="#0000ff">&gt;</font> help <font color="#0000ff">&lt;/</font> <font color="#800000">portlet-mode</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">supports</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">supported-locale</font> <font color="#0000ff">&gt;</font> ru <font color="#0000ff">&lt;/</font> <font color="#800000">supported-locale</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">resource-bundle</font> <font color="#0000ff">&gt;</font> ru.habrahabr.rssportlet.nl.HabraRssPortletResource <font color="#0000ff">&lt;/</font> <font color="#800000">resource-bundle</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet-info</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">title</font> <font color="#0000ff">&gt;</font> HabraRssPortlet <font color="#0000ff">&lt;/</font> <font color="#800000">title</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">short-title</font> <font color="#0000ff">&gt;</font> HabraRssPortlet <font color="#0000ff">&lt;/</font> <font color="#800000">short-title</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">keywords</font> <font color="#0000ff">&gt;</font> HabraRssPortlet <font color="#0000ff">&lt;/</font> <font color="#800000">keywords</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">portlet-info</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet-preferences</font> <font color="#0000ff">&gt;</font> &lt;br&gt;            &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">preference</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> updateFrequency <font color="#0000ff">&lt;/</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font>&lt;!-- in minutes --&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">value</font> <font color="#0000ff">&gt;</font> 10 <font color="#0000ff">&lt;/</font> <font color="#800000">value</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">preference</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">preference</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> itemQuantity <font color="#0000ff">&lt;/</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">value</font> <font color="#0000ff">&gt;</font> 3 <font color="#0000ff">&lt;/</font> <font color="#800000">value</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">preference</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">preference</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> rssLinks <font color="#0000ff">&lt;/</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">value</font> <font color="#0000ff">&gt;</font> www.vz.ru/rss.xml <font color="#0000ff">&lt;/</font> <font color="#800000">value</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">preference</font> <font color="#0000ff">&gt;</font> &lt;br&gt;&lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">portlet-preferences</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">portlet</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">custom-portlet-mode</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet-mode</font> <font color="#0000ff">&gt;</font> config <font color="#0000ff">&lt;/</font> <font color="#800000">portlet-mode</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">custom-portlet-mode</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">portlet-app</font> <font color="#0000ff">&gt;</font> &lt;br&gt;</font> &lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </blockquote> <code><code><a href=""></a> <a href=""></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;?</font> <font color="#800000">xml</font> <font color="#ff0000">version</font> <font color="#0000ff">="1.0"</font> <font color="#ff0000">encoding</font> <font color="#0000ff">="UTF-8"</font> ? <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet-app</font> <font color="#ff0000">xmlns</font> <font color="#0000ff">="http://java.sun.com/xml/ns/portlet/portlet-app_1_0.xsd"</font> <font color="#ff0000">version</font> <font color="#0000ff">="1.0"</font> <font color="#ff0000">xmlns:xsi</font> <font color="#0000ff">="http://www.w3.org/2001/XMLSchema-instance"</font> <font color="#ff0000">xsi:schemaLocation</font> <font color="#0000ff">="http://java.sun.com/xml/ns/portlet/portlet-app_1_0.xsd java.sun.com/xml/ns/portlet/portlet-app_1_0.xsd"</font> <font color="#ff0000">id</font> <font color="#0000ff">="ru.habrahabr.rssportlet.HabraRssPortlet.a97fbe5bd1"</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet-name</font> <font color="#0000ff">&gt;</font> HabraRssPortlet <font color="#0000ff">&lt;/</font> <font color="#800000">portlet-name</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">display-name</font> <font color="#0000ff">&gt;</font> HabraRssPortlet <font color="#0000ff">&lt;/</font> <font color="#800000">display-name</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">display-name</font> <font color="#ff0000">xml:lang</font> <font color="#0000ff">="ru"</font> <font color="#0000ff">&gt;</font> HabraRssPortlet <font color="#0000ff">&lt;/</font> <font color="#800000">display-name</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet-class</font> <font color="#0000ff">&gt;</font> ru.habrahabr.rssportlet.HabraRssPortlet <font color="#0000ff">&lt;/</font> <font color="#800000">portlet-class</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">init-param</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> wps.markup <font color="#0000ff">&lt;/</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">value</font> <font color="#0000ff">&gt;</font> html <font color="#0000ff">&lt;/</font> <font color="#800000">value</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">init-param</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">expiration-cache</font> <font color="#0000ff">&gt;</font> 0 <font color="#0000ff">&lt;/</font> <font color="#800000">expiration-cache</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">supports</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">mime-type</font> <font color="#0000ff">&gt;</font> text/html <font color="#0000ff">&lt;/</font> <font color="#800000">mime-type</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet-mode</font> <font color="#0000ff">&gt;</font> view <font color="#0000ff">&lt;/</font> <font color="#800000">portlet-mode</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet-mode</font> <font color="#0000ff">&gt;</font> edit <font color="#0000ff">&lt;/</font> <font color="#800000">portlet-mode</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet-mode</font> <font color="#0000ff">&gt;</font> config <font color="#0000ff">&lt;/</font> <font color="#800000">portlet-mode</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet-mode</font> <font color="#0000ff">&gt;</font> help <font color="#0000ff">&lt;/</font> <font color="#800000">portlet-mode</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">supports</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">supported-locale</font> <font color="#0000ff">&gt;</font> ru <font color="#0000ff">&lt;/</font> <font color="#800000">supported-locale</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">resource-bundle</font> <font color="#0000ff">&gt;</font> ru.habrahabr.rssportlet.nl.HabraRssPortletResource <font color="#0000ff">&lt;/</font> <font color="#800000">resource-bundle</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet-info</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">title</font> <font color="#0000ff">&gt;</font> HabraRssPortlet <font color="#0000ff">&lt;/</font> <font color="#800000">title</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">short-title</font> <font color="#0000ff">&gt;</font> HabraRssPortlet <font color="#0000ff">&lt;/</font> <font color="#800000">short-title</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">keywords</font> <font color="#0000ff">&gt;</font> HabraRssPortlet <font color="#0000ff">&lt;/</font> <font color="#800000">keywords</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">portlet-info</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet-preferences</font> <font color="#0000ff">&gt;</font> &lt;br&gt;            &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">preference</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> updateFrequency <font color="#0000ff">&lt;/</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font>&lt;!-- in minutes --&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">value</font> <font color="#0000ff">&gt;</font> 10 <font color="#0000ff">&lt;/</font> <font color="#800000">value</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">preference</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">preference</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> itemQuantity <font color="#0000ff">&lt;/</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">value</font> <font color="#0000ff">&gt;</font> 3 <font color="#0000ff">&lt;/</font> <font color="#800000">value</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">preference</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">preference</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> rssLinks <font color="#0000ff">&lt;/</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">value</font> <font color="#0000ff">&gt;</font> www.vz.ru/rss.xml <font color="#0000ff">&lt;/</font> <font color="#800000">value</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">preference</font> <font color="#0000ff">&gt;</font> &lt;br&gt;&lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">portlet-preferences</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">portlet</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">custom-portlet-mode</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet-mode</font> <font color="#0000ff">&gt;</font> config <font color="#0000ff">&lt;/</font> <font color="#800000">portlet-mode</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">custom-portlet-mode</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">portlet-app</font> <font color="#0000ff">&gt;</font> &lt;br&gt;</font> &lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br></code> <br><ul><li>  <strong>portlet-app</strong> - the main element of the deployment descriptor, must contain at least two attributes: version and identifier + links to the schemas describing the given xml.  Also inside the <strong>portlet-app</strong> element there can be portlet declarations, custom modes and portlet states. </li><li>  <strong>portlet</strong> - this element represents the portlet class and all its metadata </li><li>  <strong>portlet-name</strong> - the name of the portlet </li><li>  <strong>display-name</strong> - the display name of the portlet </li><li>  <strong>portlet-class</strong> - the portlet class, specified along with the package structure </li><li>  <strong>init-param</strong> - portlet initialization parameters </li><li>  <strong>expiration-cache</strong> - <strong>cache</strong> timeout </li><li>  <strong>supports</strong> - supported modes and mime types </li><li>  <strong>supported-locale</strong> - supported locales </li><li>  <strong>resource-bundle</strong> - the class responsible for the metadata that is in the bundle </li><li>  <strong>portlet-info</strong> - information about the portlet.  If there is a bundle, then this information can be put into it. </li><li>  <strong>portlet-preferences</strong> - are a kind of repository, this is where we will keep the links to Rss, the update period and the number of news from each channel.  Optional for this element is the preferences-validator element, which in turn checks preferences.  I want to note that preferences do not have to be specified in the descriptor, they can also be created programmatically during program operation. </li><li>  <strong>custom-portlet-mode</strong> - custom portlet modes, here I have enabled the config mode for an example, although we will not use it </li></ul><br><br>  Below is the main class of our application - <strong>HabraRssPortlet</strong> , which is a descendant of the <strong>GenericPortlet</strong> class, and it, in turn, is an abstract class and provides the default implementation of the Portlet interface.  The same GenericPortlet provides support for several modes: <strong>VIEW, EDIT, HELP</strong> , and sometimes custom modes such as CONFIG, but this already depends on the specific implementation of the portal.  For the end user, all three modes are most often represented by various displayed information and available functionality in one mode or another.  The transition between the modes is carried out either through the portlet menu, or through the buttons / links.  Usually, for any portlet class, several methods are overloaded, most often these are <strong>doView, doEdit and doHelp methods</strong> , each of which is responsible for the corresponding mode. <br><br>  <strong>HabraRssPortlet.java</strong> <br> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">package ru.habrahabr.rssportlet; <br> <br> import java.io.*; <br> import java.util.*; <br> import javax.portlet.*; <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> HabraRssPortlet extends GenericPortlet { <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> JSP_FOLDER    = <font color="#A31515">"/_HabraRssPortlet/jsp/"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> VIEW_JSP     = <font color="#A31515">"HabraRssPortletView"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> EDIT_JSP     = <font color="#A31515">"HabraRssPortletEdit"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> HELP_JSP     = <font color="#A31515">"HabraRssPortletHelp"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> CONFIG_JSP    = <font color="#A31515">"HabraRssPortletConfig"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> RSS_LINKS    = <font color="#A31515">"rssLinks"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> UPDATE_FREQUENCY = <font color="#A31515">"updateFrequency"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> ITEM_QUANTITY  = <font color="#A31515">"itemQuantity"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> NEW_RSS_LINK   = <font color="#A31515">"newRssLink"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> ADD_NEW_RSS_LINK = <font color="#A31515">"addNewRssLink"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> DELETE_RSS_LINK = <font color="#A31515">"deleteRssLink"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> RSS_LINKS_LIST  = <font color="#A31515">"rssLinksList"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> FREQUENCY     = <font color="#A31515">"frequency"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> QUANTITY     = <font color="#A31515">"quantity"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> SET_FREQUENCY  = <font color="#A31515">"setFrequency"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> SET_QUANTITY   = <font color="#A31515">"setQuantity"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> ERROR_MESSAGE  = <font color="#A31515">"errorMessage"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> UPDATE_FEEDS   = <font color="#A31515">"updateFeeds"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> EDIT_BACK     = <font color="#A31515">"editBack"</font> ; <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> HashMap rssMap    = <font color="#0000ff">new</font> HashMap(); <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> HashMap updateTimeMap = <font color="#0000ff">new</font> HashMap(); <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> doView(RenderRequest request, RenderResponse response)throws PortletException, IOException { <br> response.setContentType(request.getResponseContentType()); <br> PortletPreferences preferences = request.getPreferences(); <br> <br> <font color="#0000ff">if</font> (!rssMap.containsKey(request.getUserPrincipal().getName())){ <br> rssMap.put(request.getUserPrincipal().getName(), <font color="#0000ff">new</font> <font color="#2B91AF">ArrayList</font> ()); <br> updateTimeMap.put(request.getUserPrincipal().getName(), <font color="#0000ff">new</font> Long(0)); <br> <br> } <br> <br> <font color="#0000ff">if</font> (RssUtil.checkUpdateTime(getLastUpdateTime(request), preferences)) { <br> <font color="#2B91AF">ArrayList</font> rssItems = ( <font color="#2B91AF">ArrayList</font> )rssMap. <font color="#0000ff">get</font> (request.getUserPrincipal().getName()); <br> rssItems.clear(); <br> rssItems = RssUtil.updateRssFeeds(preferences); <br> System. <font color="#0000ff">out</font> .println( <font color="#A31515">"News for user "</font> + request.getUserPrincipal().getName() + <font color="#A31515">" updated!"</font> ); <br> rssMap.put(request.getUserPrincipal().getName(), rssItems); <br> setLastUpdateTime(request); <br> <br> } <br> <br> <font color="#0000ff">int</font> interval = Integer.parseInt(preferences.getValue(UPDATE_FREQUENCY, <font color="#A31515">"60"</font> )); <br> System. <font color="#0000ff">out</font> .println( <font color="#A31515">"Time befor update (in seconds) = "</font> + ((interval * 60) - ((System.currentTimeMillis() - getLastUpdateTime(request).longValue()) / 1000 ))); <br> <br> request.setAttribute( <font color="#A31515">"rssMap"</font> , rssMap. <font color="#0000ff">get</font> (request.getUserPrincipal().getName())); <br> PortletRequestDispatcher rd = getPortletContext().getRequestDispatcher(getJspFilePath(request, VIEW_JSP)); <br> rd.include(request, response); <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> doEdit(RenderRequest request, RenderResponse response) <br> throws PortletException, IOException { <br> response.setContentType(request.getResponseContentType()); <br> PortletRequestDispatcher rd = getPortletContext().getRequestDispatcher( <br> getJspFilePath(request, EDIT_JSP)); <br> rd.include(request, response); <br> } <br> <br> <font color="#0000ff">protected</font> <font color="#0000ff">void</font> doHelp(RenderRequest request, RenderResponse response) <br> throws PortletException, IOException { <br> response.setContentType(request.getResponseContentType()); <br> PortletRequestDispatcher rd = getPortletContext().getRequestDispatcher(getJspFilePath(request, HELP_JSP)); <br> rd.include(request, response); <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> processAction(ActionRequest request, ActionResponse response) <br> throws PortletException, java.io.IOException { <br> PortletPreferences preferences = request.getPreferences(); <br> <br> <font color="#0000ff">if</font> (request.getParameter(ADD_NEW_RSS_LINK) != <font color="#0000ff">null</font> ) { <br> <font color="#0000ff">if</font> (request.getParameter(NEW_RSS_LINK).trim().length() &gt; 0) { <br> <font color="#2B91AF">String</font> [] links = ( <font color="#2B91AF">String</font> []) preferences.getValues(HabraRssPortlet.RSS_LINKS, <font color="#0000ff">null</font> ); <br> <font color="#2B91AF">String</font> newLink = request.getParameter(NEW_RSS_LINK); <br> preferences.setValues(RSS_LINKS, addToArray(links, newLink)); <br> preferences.store(); <br> System. <font color="#0000ff">out</font> .println( <font color="#A31515">"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; New rss link added "</font> + newLink); <br> } <font color="#0000ff">else</font> { <br> response.setRenderParameter(ERROR_MESSAGE, <font color="#A31515">"Link must be not empty!"</font> ); <br> } <br> } <br> <br> <font color="#0000ff">if</font> (request.getParameter(DELETE_RSS_LINK) != <font color="#0000ff">null</font> ) { <br> <font color="#0000ff">if</font> (request.getParameter(RSS_LINKS_LIST) != <font color="#0000ff">null</font> <br> &amp;&amp; request.getParameter(RSS_LINKS_LIST).trim().length() &gt; 0 ) { <br> <font color="#2B91AF">String</font> [] links = ( <font color="#2B91AF">String</font> []) preferences.getValues( <br> HabraRssPortlet.RSS_LINKS, <font color="#0000ff">null</font> ); <br> <font color="#2B91AF">String</font> deletedLink = request.getParameter(RSS_LINKS_LIST); <br> <font color="#0000ff">if</font> (isFound(links, deletedLink)) { <br> preferences.setValues(RSS_LINKS, deleteFromArray(links, deletedLink)); <br> preferences.store(); <br> System. <font color="#0000ff">out</font> .println( <font color="#A31515">"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Rss link deleted "</font> + deletedLink); <br> } <br> } <font color="#0000ff">else</font> { <br> response.setRenderParameter(ERROR_MESSAGE, <font color="#A31515">"Choose a link!"</font> ); <br> } <br> } <br> <br> <font color="#0000ff">if</font> (request.getParameter(SET_FREQUENCY) != <font color="#0000ff">null</font> ) { <br> <font color="#0000ff">if</font> (request.getParameter(FREQUENCY).trim().length() &gt; 0 <br> &amp;&amp; isDigit(request.getParameter(FREQUENCY))) { <br> <font color="#2B91AF">String</font> frequency = request.getParameter(FREQUENCY); <br> preferences.setValue(UPDATE_FREQUENCY, frequency); <br> preferences.store(); <br> System. <font color="#0000ff">out</font> .println( <font color="#A31515">"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Frequency updated "</font> + frequency); <br> } <font color="#0000ff">else</font> { <br> response.setRenderParameter(ERROR_MESSAGE, <font color="#A31515">"Set valid frequency!"</font> ); <br> } <br> } <br> <br> <font color="#0000ff">if</font> (request.getParameter(SET_QUANTITY) != <font color="#0000ff">null</font> ) { <br> <font color="#0000ff">if</font> (request.getParameter(QUANTITY).trim().length() &gt; 0 <br> &amp;&amp; isDigit(request.getParameter(QUANTITY))) { <br> <font color="#2B91AF">String</font> quantity = request.getParameter(QUANTITY); <br> preferences.setValue(ITEM_QUANTITY, quantity); <br> preferences.store(); <br> System. <font color="#0000ff">out</font> .println( <font color="#A31515">"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Quantity updated "</font> + quantity); <br> } <font color="#0000ff">else</font> { <br> response.setRenderParameter(ERROR_MESSAGE, <font color="#A31515">"Set valid quantity!"</font> ); <br> } <br> } <br> <br> <font color="#0000ff">if</font> (request.getParameter(UPDATE_FEEDS) != <font color="#0000ff">null</font> ) { <br> <font color="#2B91AF">ArrayList</font> rssItems = ( <font color="#2B91AF">ArrayList</font> )rssMap. <font color="#0000ff">get</font> (request.getUserPrincipal().getName()); <br> rssItems.clear(); <br> rssItems = RssUtil.updateRssFeeds(preferences); <br> System. <font color="#0000ff">out</font> .println( <font color="#A31515">"News fo user "</font> + request.getUserPrincipal().getName() + <font color="#A31515">" updated!"</font> ); <br> rssMap.put(request.getUserPrincipal().getName(), rssItems); <br> setLastUpdateTime(request); <br> } <br> <br> <font color="#0000ff">if</font> (request.getParameter(EDIT_BACK) != <font color="#0000ff">null</font> ) { <br> response.setPortletMode(PortletMode.VIEW); <br> } <br> <br> <br> <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#2B91AF">String</font> getJspFilePath(RenderRequest request, <font color="#2B91AF">String</font> jspFile) { <br> <font color="#2B91AF">String</font> markup = request.getProperty( <font color="#A31515">"wps.markup"</font> ); <br> <font color="#0000ff">if</font> (markup == <font color="#0000ff">null</font> ) <br> markup = getMarkup(request.getResponseContentType()); <br> <font color="#0000ff">return</font> JSP_FOLDER + markup + <font color="#A31515">"/"</font> + jspFile + <font color="#A31515">"."</font> <br> + getJspExtension(markup); <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#2B91AF">String</font> getMarkup( <font color="#2B91AF">String</font> contentType) { <br> <font color="#0000ff">if</font> ( <font color="#A31515">"text/vnd.wap.wml"</font> .equals(contentType)) <br> <font color="#0000ff">return</font> <font color="#A31515">"wml"</font> ; <br> <font color="#0000ff">else</font> <br> <font color="#0000ff">return</font> <font color="#A31515">"html"</font> ; <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#2B91AF">String</font> getJspExtension( <font color="#2B91AF">String</font> markupName) { <br> <font color="#0000ff">return</font> <font color="#A31515">"jsp"</font> ; <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#2B91AF">String</font> [] addToArray( <font color="#2B91AF">String</font> [] array, <font color="#2B91AF">String</font> s) { <br> <font color="#2B91AF">String</font> [] ans = <font color="#0000ff">new</font> <font color="#2B91AF">String</font> [array.length + 1]; <br> System.arraycopy(array, 0, ans, 0, array.length); <br> ans[ans.length - 1] = s; <br> <font color="#0000ff">return</font> ans; <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#2B91AF">String</font> [] deleteFromArray( <font color="#2B91AF">String</font> [] array, <font color="#2B91AF">String</font> s) { <br> <font color="#2B91AF">String</font> [] ans = <font color="#0000ff">new</font> <font color="#2B91AF">String</font> [array.length - 1]; <br> <font color="#0000ff">int</font> addIndex = 0; <br> <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; array.length; i++) { <br> <font color="#0000ff">if</font> (array[i].equals(s)) { <br> addIndex++; <br> <font color="#0000ff">continue</font> ; <br> } <br> ans[i - addIndex] = array[i]; <br> } <br> <font color="#0000ff">return</font> ans; <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> boolean isFound( <font color="#2B91AF">String</font> [] array, <font color="#2B91AF">String</font> s) { <br> boolean found = <font color="#0000ff">false</font> ; <br> <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; array.length; i++) { <br> <font color="#0000ff">if</font> (array[i].equals(s)) { <br> found = <font color="#0000ff">true</font> ; <br> <font color="#0000ff">break</font> ; <br> } <br> } <br> <font color="#0000ff">return</font> found; <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> boolean isDigit( <font color="#2B91AF">String</font> s) { <br> <font color="#0000ff">char</font> [] array = s.toCharArray(); <br> <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; array.length; i++) { <br> <font color="#0000ff">if</font> (!Character.isDigit(array[i])) { <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> } <br> } <br> <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> Long getLastUpdateTime(PortletRequest request){ <br> <font color="#0000ff">return</font> (Long)updateTimeMap. <font color="#0000ff">get</font> (request.getUserPrincipal().getName()); <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> setLastUpdateTime(PortletRequest request){ <br> updateTimeMap.put(request.getUserPrincipal().getName(), <font color="#0000ff">new</font> Long(System.currentTimeMillis())); <br> } <br> <br> <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> <blockquote> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">package ru.habrahabr.rssportlet; <br> <br> import java.io.*; <br> import java.util.*; <br> import javax.portlet.*; <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> HabraRssPortlet extends GenericPortlet { <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> JSP_FOLDER    = <font color="#A31515">"/_HabraRssPortlet/jsp/"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> VIEW_JSP     = <font color="#A31515">"HabraRssPortletView"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> EDIT_JSP     = <font color="#A31515">"HabraRssPortletEdit"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> HELP_JSP     = <font color="#A31515">"HabraRssPortletHelp"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> CONFIG_JSP    = <font color="#A31515">"HabraRssPortletConfig"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> RSS_LINKS    = <font color="#A31515">"rssLinks"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> UPDATE_FREQUENCY = <font color="#A31515">"updateFrequency"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> ITEM_QUANTITY  = <font color="#A31515">"itemQuantity"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> NEW_RSS_LINK   = <font color="#A31515">"newRssLink"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> ADD_NEW_RSS_LINK = <font color="#A31515">"addNewRssLink"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> DELETE_RSS_LINK = <font color="#A31515">"deleteRssLink"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> RSS_LINKS_LIST  = <font color="#A31515">"rssLinksList"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> FREQUENCY     = <font color="#A31515">"frequency"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> QUANTITY     = <font color="#A31515">"quantity"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> SET_FREQUENCY  = <font color="#A31515">"setFrequency"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> SET_QUANTITY   = <font color="#A31515">"setQuantity"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> ERROR_MESSAGE  = <font color="#A31515">"errorMessage"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> UPDATE_FEEDS   = <font color="#A31515">"updateFeeds"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> EDIT_BACK     = <font color="#A31515">"editBack"</font> ; <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> HashMap rssMap    = <font color="#0000ff">new</font> HashMap(); <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> HashMap updateTimeMap = <font color="#0000ff">new</font> HashMap(); <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> doView(RenderRequest request, RenderResponse response)throws PortletException, IOException { <br> response.setContentType(request.getResponseContentType()); <br> PortletPreferences preferences = request.getPreferences(); <br> <br> <font color="#0000ff">if</font> (!rssMap.containsKey(request.getUserPrincipal().getName())){ <br> rssMap.put(request.getUserPrincipal().getName(), <font color="#0000ff">new</font> <font color="#2B91AF">ArrayList</font> ()); <br> updateTimeMap.put(request.getUserPrincipal().getName(), <font color="#0000ff">new</font> Long(0)); <br> <br> } <br> <br> <font color="#0000ff">if</font> (RssUtil.checkUpdateTime(getLastUpdateTime(request), preferences)) { <br> <font color="#2B91AF">ArrayList</font> rssItems = ( <font color="#2B91AF">ArrayList</font> )rssMap. <font color="#0000ff">get</font> (request.getUserPrincipal().getName()); <br> rssItems.clear(); <br> rssItems = RssUtil.updateRssFeeds(preferences); <br> System. <font color="#0000ff">out</font> .println( <font color="#A31515">"News for user "</font> + request.getUserPrincipal().getName() + <font color="#A31515">" updated!"</font> ); <br> rssMap.put(request.getUserPrincipal().getName(), rssItems); <br> setLastUpdateTime(request); <br> <br> } <br> <br> <font color="#0000ff">int</font> interval = Integer.parseInt(preferences.getValue(UPDATE_FREQUENCY, <font color="#A31515">"60"</font> )); <br> System. <font color="#0000ff">out</font> .println( <font color="#A31515">"Time befor update (in seconds) = "</font> + ((interval * 60) - ((System.currentTimeMillis() - getLastUpdateTime(request).longValue()) / 1000 ))); <br> <br> request.setAttribute( <font color="#A31515">"rssMap"</font> , rssMap. <font color="#0000ff">get</font> (request.getUserPrincipal().getName())); <br> PortletRequestDispatcher rd = getPortletContext().getRequestDispatcher(getJspFilePath(request, VIEW_JSP)); <br> rd.include(request, response); <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> doEdit(RenderRequest request, RenderResponse response) <br> throws PortletException, IOException { <br> response.setContentType(request.getResponseContentType()); <br> PortletRequestDispatcher rd = getPortletContext().getRequestDispatcher( <br> getJspFilePath(request, EDIT_JSP)); <br> rd.include(request, response); <br> } <br> <br> <font color="#0000ff">protected</font> <font color="#0000ff">void</font> doHelp(RenderRequest request, RenderResponse response) <br> throws PortletException, IOException { <br> response.setContentType(request.getResponseContentType()); <br> PortletRequestDispatcher rd = getPortletContext().getRequestDispatcher(getJspFilePath(request, HELP_JSP)); <br> rd.include(request, response); <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> processAction(ActionRequest request, ActionResponse response) <br> throws PortletException, java.io.IOException { <br> PortletPreferences preferences = request.getPreferences(); <br> <br> <font color="#0000ff">if</font> (request.getParameter(ADD_NEW_RSS_LINK) != <font color="#0000ff">null</font> ) { <br> <font color="#0000ff">if</font> (request.getParameter(NEW_RSS_LINK).trim().length() &gt; 0) { <br> <font color="#2B91AF">String</font> [] links = ( <font color="#2B91AF">String</font> []) preferences.getValues(HabraRssPortlet.RSS_LINKS, <font color="#0000ff">null</font> ); <br> <font color="#2B91AF">String</font> newLink = request.getParameter(NEW_RSS_LINK); <br> preferences.setValues(RSS_LINKS, addToArray(links, newLink)); <br> preferences.store(); <br> System. <font color="#0000ff">out</font> .println( <font color="#A31515">"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; New rss link added "</font> + newLink); <br> } <font color="#0000ff">else</font> { <br> response.setRenderParameter(ERROR_MESSAGE, <font color="#A31515">"Link must be not empty!"</font> ); <br> } <br> } <br> <br> <font color="#0000ff">if</font> (request.getParameter(DELETE_RSS_LINK) != <font color="#0000ff">null</font> ) { <br> <font color="#0000ff">if</font> (request.getParameter(RSS_LINKS_LIST) != <font color="#0000ff">null</font> <br> &amp;&amp; request.getParameter(RSS_LINKS_LIST).trim().length() &gt; 0 ) { <br> <font color="#2B91AF">String</font> [] links = ( <font color="#2B91AF">String</font> []) preferences.getValues( <br> HabraRssPortlet.RSS_LINKS, <font color="#0000ff">null</font> ); <br> <font color="#2B91AF">String</font> deletedLink = request.getParameter(RSS_LINKS_LIST); <br> <font color="#0000ff">if</font> (isFound(links, deletedLink)) { <br> preferences.setValues(RSS_LINKS, deleteFromArray(links, deletedLink)); <br> preferences.store(); <br> System. <font color="#0000ff">out</font> .println( <font color="#A31515">"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Rss link deleted "</font> + deletedLink); <br> } <br> } <font color="#0000ff">else</font> { <br> response.setRenderParameter(ERROR_MESSAGE, <font color="#A31515">"Choose a link!"</font> ); <br> } <br> } <br> <br> <font color="#0000ff">if</font> (request.getParameter(SET_FREQUENCY) != <font color="#0000ff">null</font> ) { <br> <font color="#0000ff">if</font> (request.getParameter(FREQUENCY).trim().length() &gt; 0 <br> &amp;&amp; isDigit(request.getParameter(FREQUENCY))) { <br> <font color="#2B91AF">String</font> frequency = request.getParameter(FREQUENCY); <br> preferences.setValue(UPDATE_FREQUENCY, frequency); <br> preferences.store(); <br> System. <font color="#0000ff">out</font> .println( <font color="#A31515">"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Frequency updated "</font> + frequency); <br> } <font color="#0000ff">else</font> { <br> response.setRenderParameter(ERROR_MESSAGE, <font color="#A31515">"Set valid frequency!"</font> ); <br> } <br> } <br> <br> <font color="#0000ff">if</font> (request.getParameter(SET_QUANTITY) != <font color="#0000ff">null</font> ) { <br> <font color="#0000ff">if</font> (request.getParameter(QUANTITY).trim().length() &gt; 0 <br> &amp;&amp; isDigit(request.getParameter(QUANTITY))) { <br> <font color="#2B91AF">String</font> quantity = request.getParameter(QUANTITY); <br> preferences.setValue(ITEM_QUANTITY, quantity); <br> preferences.store(); <br> System. <font color="#0000ff">out</font> .println( <font color="#A31515">"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Quantity updated "</font> + quantity); <br> } <font color="#0000ff">else</font> { <br> response.setRenderParameter(ERROR_MESSAGE, <font color="#A31515">"Set valid quantity!"</font> ); <br> } <br> } <br> <br> <font color="#0000ff">if</font> (request.getParameter(UPDATE_FEEDS) != <font color="#0000ff">null</font> ) { <br> <font color="#2B91AF">ArrayList</font> rssItems = ( <font color="#2B91AF">ArrayList</font> )rssMap. <font color="#0000ff">get</font> (request.getUserPrincipal().getName()); <br> rssItems.clear(); <br> rssItems = RssUtil.updateRssFeeds(preferences); <br> System. <font color="#0000ff">out</font> .println( <font color="#A31515">"News fo user "</font> + request.getUserPrincipal().getName() + <font color="#A31515">" updated!"</font> ); <br> rssMap.put(request.getUserPrincipal().getName(), rssItems); <br> setLastUpdateTime(request); <br> } <br> <br> <font color="#0000ff">if</font> (request.getParameter(EDIT_BACK) != <font color="#0000ff">null</font> ) { <br> response.setPortletMode(PortletMode.VIEW); <br> } <br> <br> <br> <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#2B91AF">String</font> getJspFilePath(RenderRequest request, <font color="#2B91AF">String</font> jspFile) { <br> <font color="#2B91AF">String</font> markup = request.getProperty( <font color="#A31515">"wps.markup"</font> ); <br> <font color="#0000ff">if</font> (markup == <font color="#0000ff">null</font> ) <br> markup = getMarkup(request.getResponseContentType()); <br> <font color="#0000ff">return</font> JSP_FOLDER + markup + <font color="#A31515">"/"</font> + jspFile + <font color="#A31515">"."</font> <br> + getJspExtension(markup); <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#2B91AF">String</font> getMarkup( <font color="#2B91AF">String</font> contentType) { <br> <font color="#0000ff">if</font> ( <font color="#A31515">"text/vnd.wap.wml"</font> .equals(contentType)) <br> <font color="#0000ff">return</font> <font color="#A31515">"wml"</font> ; <br> <font color="#0000ff">else</font> <br> <font color="#0000ff">return</font> <font color="#A31515">"html"</font> ; <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#2B91AF">String</font> getJspExtension( <font color="#2B91AF">String</font> markupName) { <br> <font color="#0000ff">return</font> <font color="#A31515">"jsp"</font> ; <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#2B91AF">String</font> [] addToArray( <font color="#2B91AF">String</font> [] array, <font color="#2B91AF">String</font> s) { <br> <font color="#2B91AF">String</font> [] ans = <font color="#0000ff">new</font> <font color="#2B91AF">String</font> [array.length + 1]; <br> System.arraycopy(array, 0, ans, 0, array.length); <br> ans[ans.length - 1] = s; <br> <font color="#0000ff">return</font> ans; <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#2B91AF">String</font> [] deleteFromArray( <font color="#2B91AF">String</font> [] array, <font color="#2B91AF">String</font> s) { <br> <font color="#2B91AF">String</font> [] ans = <font color="#0000ff">new</font> <font color="#2B91AF">String</font> [array.length - 1]; <br> <font color="#0000ff">int</font> addIndex = 0; <br> <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; array.length; i++) { <br> <font color="#0000ff">if</font> (array[i].equals(s)) { <br> addIndex++; <br> <font color="#0000ff">continue</font> ; <br> } <br> ans[i - addIndex] = array[i]; <br> } <br> <font color="#0000ff">return</font> ans; <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> boolean isFound( <font color="#2B91AF">String</font> [] array, <font color="#2B91AF">String</font> s) { <br> boolean found = <font color="#0000ff">false</font> ; <br> <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; array.length; i++) { <br> <font color="#0000ff">if</font> (array[i].equals(s)) { <br> found = <font color="#0000ff">true</font> ; <br> <font color="#0000ff">break</font> ; <br> } <br> } <br> <font color="#0000ff">return</font> found; <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> boolean isDigit( <font color="#2B91AF">String</font> s) { <br> <font color="#0000ff">char</font> [] array = s.toCharArray(); <br> <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; array.length; i++) { <br> <font color="#0000ff">if</font> (!Character.isDigit(array[i])) { <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> } <br> } <br> <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> Long getLastUpdateTime(PortletRequest request){ <br> <font color="#0000ff">return</font> (Long)updateTimeMap. <font color="#0000ff">get</font> (request.getUserPrincipal().getName()); <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> setLastUpdateTime(PortletRequest request){ <br> updateTimeMap.put(request.getUserPrincipal().getName(), <font color="#0000ff">new</font> Long(System.currentTimeMillis())); <br> } <br> <br> <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </blockquote> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">package ru.habrahabr.rssportlet; <br> <br> import java.io.*; <br> import java.util.*; <br> import javax.portlet.*; <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> HabraRssPortlet extends GenericPortlet { <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> JSP_FOLDER    = <font color="#A31515">"/_HabraRssPortlet/jsp/"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> VIEW_JSP     = <font color="#A31515">"HabraRssPortletView"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> EDIT_JSP     = <font color="#A31515">"HabraRssPortletEdit"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> HELP_JSP     = <font color="#A31515">"HabraRssPortletHelp"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> CONFIG_JSP    = <font color="#A31515">"HabraRssPortletConfig"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> RSS_LINKS    = <font color="#A31515">"rssLinks"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> UPDATE_FREQUENCY = <font color="#A31515">"updateFrequency"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> ITEM_QUANTITY  = <font color="#A31515">"itemQuantity"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> NEW_RSS_LINK   = <font color="#A31515">"newRssLink"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> ADD_NEW_RSS_LINK = <font color="#A31515">"addNewRssLink"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> DELETE_RSS_LINK = <font color="#A31515">"deleteRssLink"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> RSS_LINKS_LIST  = <font color="#A31515">"rssLinksList"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> FREQUENCY     = <font color="#A31515">"frequency"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> QUANTITY     = <font color="#A31515">"quantity"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> SET_FREQUENCY  = <font color="#A31515">"setFrequency"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> SET_QUANTITY   = <font color="#A31515">"setQuantity"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> ERROR_MESSAGE  = <font color="#A31515">"errorMessage"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> UPDATE_FEEDS   = <font color="#A31515">"updateFeeds"</font> ; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> final <font color="#2B91AF">String</font> EDIT_BACK     = <font color="#A31515">"editBack"</font> ; <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> HashMap rssMap    = <font color="#0000ff">new</font> HashMap(); <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> HashMap updateTimeMap = <font color="#0000ff">new</font> HashMap(); <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> doView(RenderRequest request, RenderResponse response)throws PortletException, IOException { <br> response.setContentType(request.getResponseContentType()); <br> PortletPreferences preferences = request.getPreferences(); <br> <br> <font color="#0000ff">if</font> (!rssMap.containsKey(request.getUserPrincipal().getName())){ <br> rssMap.put(request.getUserPrincipal().getName(), <font color="#0000ff">new</font> <font color="#2B91AF">ArrayList</font> ()); <br> updateTimeMap.put(request.getUserPrincipal().getName(), <font color="#0000ff">new</font> Long(0)); <br> <br> } <br> <br> <font color="#0000ff">if</font> (RssUtil.checkUpdateTime(getLastUpdateTime(request), preferences)) { <br> <font color="#2B91AF">ArrayList</font> rssItems = ( <font color="#2B91AF">ArrayList</font> )rssMap. <font color="#0000ff">get</font> (request.getUserPrincipal().getName()); <br> rssItems.clear(); <br> rssItems = RssUtil.updateRssFeeds(preferences); <br> System. <font color="#0000ff">out</font> .println( <font color="#A31515">"News for user "</font> + request.getUserPrincipal().getName() + <font color="#A31515">" updated!"</font> ); <br> rssMap.put(request.getUserPrincipal().getName(), rssItems); <br> setLastUpdateTime(request); <br> <br> } <br> <br> <font color="#0000ff">int</font> interval = Integer.parseInt(preferences.getValue(UPDATE_FREQUENCY, <font color="#A31515">"60"</font> )); <br> System. <font color="#0000ff">out</font> .println( <font color="#A31515">"Time befor update (in seconds) = "</font> + ((interval * 60) - ((System.currentTimeMillis() - getLastUpdateTime(request).longValue()) / 1000 ))); <br> <br> request.setAttribute( <font color="#A31515">"rssMap"</font> , rssMap. <font color="#0000ff">get</font> (request.getUserPrincipal().getName())); <br> PortletRequestDispatcher rd = getPortletContext().getRequestDispatcher(getJspFilePath(request, VIEW_JSP)); <br> rd.include(request, response); <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> doEdit(RenderRequest request, RenderResponse response) <br> throws PortletException, IOException { <br> response.setContentType(request.getResponseContentType()); <br> PortletRequestDispatcher rd = getPortletContext().getRequestDispatcher( <br> getJspFilePath(request, EDIT_JSP)); <br> rd.include(request, response); <br> } <br> <br> <font color="#0000ff">protected</font> <font color="#0000ff">void</font> doHelp(RenderRequest request, RenderResponse response) <br> throws PortletException, IOException { <br> response.setContentType(request.getResponseContentType()); <br> PortletRequestDispatcher rd = getPortletContext().getRequestDispatcher(getJspFilePath(request, HELP_JSP)); <br> rd.include(request, response); <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> processAction(ActionRequest request, ActionResponse response) <br> throws PortletException, java.io.IOException { <br> PortletPreferences preferences = request.getPreferences(); <br> <br> <font color="#0000ff">if</font> (request.getParameter(ADD_NEW_RSS_LINK) != <font color="#0000ff">null</font> ) { <br> <font color="#0000ff">if</font> (request.getParameter(NEW_RSS_LINK).trim().length() &gt; 0) { <br> <font color="#2B91AF">String</font> [] links = ( <font color="#2B91AF">String</font> []) preferences.getValues(HabraRssPortlet.RSS_LINKS, <font color="#0000ff">null</font> ); <br> <font color="#2B91AF">String</font> newLink = request.getParameter(NEW_RSS_LINK); <br> preferences.setValues(RSS_LINKS, addToArray(links, newLink)); <br> preferences.store(); <br> System. <font color="#0000ff">out</font> .println( <font color="#A31515">"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; New rss link added "</font> + newLink); <br> } <font color="#0000ff">else</font> { <br> response.setRenderParameter(ERROR_MESSAGE, <font color="#A31515">"Link must be not empty!"</font> ); <br> } <br> } <br> <br> <font color="#0000ff">if</font> (request.getParameter(DELETE_RSS_LINK) != <font color="#0000ff">null</font> ) { <br> <font color="#0000ff">if</font> (request.getParameter(RSS_LINKS_LIST) != <font color="#0000ff">null</font> <br> &amp;&amp; request.getParameter(RSS_LINKS_LIST).trim().length() &gt; 0 ) { <br> <font color="#2B91AF">String</font> [] links = ( <font color="#2B91AF">String</font> []) preferences.getValues( <br> HabraRssPortlet.RSS_LINKS, <font color="#0000ff">null</font> ); <br> <font color="#2B91AF">String</font> deletedLink = request.getParameter(RSS_LINKS_LIST); <br> <font color="#0000ff">if</font> (isFound(links, deletedLink)) { <br> preferences.setValues(RSS_LINKS, deleteFromArray(links, deletedLink)); <br> preferences.store(); <br> System. <font color="#0000ff">out</font> .println( <font color="#A31515">"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Rss link deleted "</font> + deletedLink); <br> } <br> } <font color="#0000ff">else</font> { <br> response.setRenderParameter(ERROR_MESSAGE, <font color="#A31515">"Choose a link!"</font> ); <br> } <br> } <br> <br> <font color="#0000ff">if</font> (request.getParameter(SET_FREQUENCY) != <font color="#0000ff">null</font> ) { <br> <font color="#0000ff">if</font> (request.getParameter(FREQUENCY).trim().length() &gt; 0 <br> &amp;&amp; isDigit(request.getParameter(FREQUENCY))) { <br> <font color="#2B91AF">String</font> frequency = request.getParameter(FREQUENCY); <br> preferences.setValue(UPDATE_FREQUENCY, frequency); <br> preferences.store(); <br> System. <font color="#0000ff">out</font> .println( <font color="#A31515">"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Frequency updated "</font> + frequency); <br> } <font color="#0000ff">else</font> { <br> response.setRenderParameter(ERROR_MESSAGE, <font color="#A31515">"Set valid frequency!"</font> ); <br> } <br> } <br> <br> <font color="#0000ff">if</font> (request.getParameter(SET_QUANTITY) != <font color="#0000ff">null</font> ) { <br> <font color="#0000ff">if</font> (request.getParameter(QUANTITY).trim().length() &gt; 0 <br> &amp;&amp; isDigit(request.getParameter(QUANTITY))) { <br> <font color="#2B91AF">String</font> quantity = request.getParameter(QUANTITY); <br> preferences.setValue(ITEM_QUANTITY, quantity); <br> preferences.store(); <br> System. <font color="#0000ff">out</font> .println( <font color="#A31515">"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Quantity updated "</font> + quantity); <br> } <font color="#0000ff">else</font> { <br> response.setRenderParameter(ERROR_MESSAGE, <font color="#A31515">"Set valid quantity!"</font> ); <br> } <br> } <br> <br> <font color="#0000ff">if</font> (request.getParameter(UPDATE_FEEDS) != <font color="#0000ff">null</font> ) { <br> <font color="#2B91AF">ArrayList</font> rssItems = ( <font color="#2B91AF">ArrayList</font> )rssMap. <font color="#0000ff">get</font> (request.getUserPrincipal().getName()); <br> rssItems.clear(); <br> rssItems = RssUtil.updateRssFeeds(preferences); <br> System. <font color="#0000ff">out</font> .println( <font color="#A31515">"News fo user "</font> + request.getUserPrincipal().getName() + <font color="#A31515">" updated!"</font> ); <br> rssMap.put(request.getUserPrincipal().getName(), rssItems); <br> setLastUpdateTime(request); <br> } <br> <br> <font color="#0000ff">if</font> (request.getParameter(EDIT_BACK) != <font color="#0000ff">null</font> ) { <br> response.setPortletMode(PortletMode.VIEW); <br> } <br> <br> <br> <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#2B91AF">String</font> getJspFilePath(RenderRequest request, <font color="#2B91AF">String</font> jspFile) { <br> <font color="#2B91AF">String</font> markup = request.getProperty( <font color="#A31515">"wps.markup"</font> ); <br> <font color="#0000ff">if</font> (markup == <font color="#0000ff">null</font> ) <br> markup = getMarkup(request.getResponseContentType()); <br> <font color="#0000ff">return</font> JSP_FOLDER + markup + <font color="#A31515">"/"</font> + jspFile + <font color="#A31515">"."</font> <br> + getJspExtension(markup); <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#2B91AF">String</font> getMarkup( <font color="#2B91AF">String</font> contentType) { <br> <font color="#0000ff">if</font> ( <font color="#A31515">"text/vnd.wap.wml"</font> .equals(contentType)) <br> <font color="#0000ff">return</font> <font color="#A31515">"wml"</font> ; <br> <font color="#0000ff">else</font> <br> <font color="#0000ff">return</font> <font color="#A31515">"html"</font> ; <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#2B91AF">String</font> getJspExtension( <font color="#2B91AF">String</font> markupName) { <br> <font color="#0000ff">return</font> <font color="#A31515">"jsp"</font> ; <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#2B91AF">String</font> [] addToArray( <font color="#2B91AF">String</font> [] array, <font color="#2B91AF">String</font> s) { <br> <font color="#2B91AF">String</font> [] ans = <font color="#0000ff">new</font> <font color="#2B91AF">String</font> [array.length + 1]; <br> System.arraycopy(array, 0, ans, 0, array.length); <br> ans[ans.length - 1] = s; <br> <font color="#0000ff">return</font> ans; <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#2B91AF">String</font> [] deleteFromArray( <font color="#2B91AF">String</font> [] array, <font color="#2B91AF">String</font> s) { <br> <font color="#2B91AF">String</font> [] ans = <font color="#0000ff">new</font> <font color="#2B91AF">String</font> [array.length - 1]; <br> <font color="#0000ff">int</font> addIndex = 0; <br> <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; array.length; i++) { <br> <font color="#0000ff">if</font> (array[i].equals(s)) { <br> addIndex++; <br> <font color="#0000ff">continue</font> ; <br> } <br> ans[i - addIndex] = array[i]; <br> } <br> <font color="#0000ff">return</font> ans; <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> boolean isFound( <font color="#2B91AF">String</font> [] array, <font color="#2B91AF">String</font> s) { <br> boolean found = <font color="#0000ff">false</font> ; <br> <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; array.length; i++) { <br> <font color="#0000ff">if</font> (array[i].equals(s)) { <br> found = <font color="#0000ff">true</font> ; <br> <font color="#0000ff">break</font> ; <br> } <br> } <br> <font color="#0000ff">return</font> found; <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> boolean isDigit( <font color="#2B91AF">String</font> s) { <br> <font color="#0000ff">char</font> [] array = s.toCharArray(); <br> <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; array.length; i++) { <br> <font color="#0000ff">if</font> (!Character.isDigit(array[i])) { <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> } <br> } <br> <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> Long getLastUpdateTime(PortletRequest request){ <br> <font color="#0000ff">return</font> (Long)updateTimeMap. <font color="#0000ff">get</font> (request.getUserPrincipal().getName()); <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> setLastUpdateTime(PortletRequest request){ <br> updateTimeMap.put(request.getUserPrincipal().getName(), <font color="#0000ff">new</font> Long(System.currentTimeMillis())); <br> } <br> <br> <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br></code> <br>  Go through the code: <br><br>  With a set of constants, everything is clear, then we create two static objects of HashMap type ‚Äî the key to all values ‚Äã‚Äãof both maps is the name of a specific portal user, the value of either an ArrayList object containing Rss content or a Long object containing the time of the last update of the channels.  Since the lifetime of a static portlet variable is equal to the lifetime of the portlet itself, I decided to store the data exactly in them, and not persist them somewhere, all the more I see little point in saving rss'a to any database. <br><br>  Then begins what we talked about a little higher, namely, the redefinition of methods of the GenericPortlet class: <br><br>  <strong>The doView method:</strong> from the request object we get an object of type PortletPreferences, from which, in turn, we can pull out the value we need or, alternatively, add our own value to it.  Then we check our first map for the presence of a key with the name of the active user, if there is no such key, then we enter the key-value pairs in both maps, in one case the value is an ArrayList object, in the other - the Long object containing the last update time.  Next, we check if we need a news update.  Let me remind you that for all users one channel is set by default, the same number of news and the time of their update (see portlet.xml) So, if a user has visited the page with our portlet for the first time, then the channel will be immediately updated for him Received rss-content is entered into our ArrayList, which we received from the map with rss-content by user name (key).  Then everything is simple - in the request we put the same ArrayList, call PortletRequestDispatcher and redirect to the Hsp page of HabraRssPortletView, which will display our rss content: <br><br>  <strong>HabraRssPortletView.jsp</strong> <br> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font>&lt;%@page session="false" contentType="text/html" pageEncoding="ISO-8859-1" import="java.util.*,javax.portlet.*,ru.habrahabr.rssportlet.*" %&gt;</font> &lt;br&gt; <font>&lt;%@taglib uri="http://java.sun.com/portlet" prefix="portlet" %&gt;</font> &lt;br&gt; <font>&lt;%@taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet:defineObjects</font> <font color="#0000ff">/&gt;</font> &lt;br&gt;&lt;br&gt;&lt;br&gt; <font>&lt;%</font> &lt;br&gt; <font color="#0000ff">if</font> (request.getAttribute( <font color="#A31515">"rssMap"</font> ) != <font color="#0000ff">null</font> ){&lt;br&gt; <font>%&gt;</font> &lt;br&gt;    &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">c:forEach</font> <font color="#ff0000">var</font> <font color="#0000ff">="item"</font> <font color="#ff0000">items</font> <font color="#0000ff">="${rssMap}"</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">p</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">b</font> <font color="#0000ff">&gt;&lt;</font> <font color="#800000">a</font> <font color="#ff0000">href</font> <font color="#0000ff">="${item.link}"</font> <font color="#0000ff">&gt;</font> ${item.title} <font color="#0000ff">&lt;/</font> <font color="#800000">a</font> <font color="#0000ff">&gt;&lt;/</font> <font color="#800000">b</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">span</font> <font color="#0000ff">&gt;</font> ${item.description} <font color="#0000ff">&lt;/</font> <font color="#800000">span</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">p</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">hr</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">c:forEach</font> <font color="#0000ff">&gt;</font> &lt;br&gt;    &lt;br&gt; <font>&lt;%</font> &lt;br&gt; } <font color="#0000ff">else</font> {&lt;br&gt; <font>%&gt;</font> Error!!!! <font>&lt;%</font> &lt;br&gt; }&lt;br&gt; <font>%&gt;</font></font> &lt;br&gt;&lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> <blockquote> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font>&lt;%@page session="false" contentType="text/html" pageEncoding="ISO-8859-1" import="java.util.*,javax.portlet.*,ru.habrahabr.rssportlet.*" %&gt;</font> &lt;br&gt; <font>&lt;%@taglib uri="http://java.sun.com/portlet" prefix="portlet" %&gt;</font> &lt;br&gt; <font>&lt;%@taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet:defineObjects</font> <font color="#0000ff">/&gt;</font> &lt;br&gt;&lt;br&gt;&lt;br&gt; <font>&lt;%</font> &lt;br&gt; <font color="#0000ff">if</font> (request.getAttribute( <font color="#A31515">"rssMap"</font> ) != <font color="#0000ff">null</font> ){&lt;br&gt; <font>%&gt;</font> &lt;br&gt;    &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">c:forEach</font> <font color="#ff0000">var</font> <font color="#0000ff">="item"</font> <font color="#ff0000">items</font> <font color="#0000ff">="${rssMap}"</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">p</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">b</font> <font color="#0000ff">&gt;&lt;</font> <font color="#800000">a</font> <font color="#ff0000">href</font> <font color="#0000ff">="${item.link}"</font> <font color="#0000ff">&gt;</font> ${item.title} <font color="#0000ff">&lt;/</font> <font color="#800000">a</font> <font color="#0000ff">&gt;&lt;/</font> <font color="#800000">b</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">span</font> <font color="#0000ff">&gt;</font> ${item.description} <font color="#0000ff">&lt;/</font> <font color="#800000">span</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">p</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">hr</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">c:forEach</font> <font color="#0000ff">&gt;</font> &lt;br&gt;    &lt;br&gt; <font>&lt;%</font> &lt;br&gt; } <font color="#0000ff">else</font> {&lt;br&gt; <font>%&gt;</font> Error!!!! <font>&lt;%</font> &lt;br&gt; }&lt;br&gt; <font>%&gt;</font></font> &lt;br&gt;&lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </blockquote> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font>&lt;%@page session="false" contentType="text/html" pageEncoding="ISO-8859-1" import="java.util.*,javax.portlet.*,ru.habrahabr.rssportlet.*" %&gt;</font> &lt;br&gt; <font>&lt;%@taglib uri="http://java.sun.com/portlet" prefix="portlet" %&gt;</font> &lt;br&gt; <font>&lt;%@taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">portlet:defineObjects</font> <font color="#0000ff">/&gt;</font> &lt;br&gt;&lt;br&gt;&lt;br&gt; <font>&lt;%</font> &lt;br&gt; <font color="#0000ff">if</font> (request.getAttribute( <font color="#A31515">"rssMap"</font> ) != <font color="#0000ff">null</font> ){&lt;br&gt; <font>%&gt;</font> &lt;br&gt;    &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">c:forEach</font> <font color="#ff0000">var</font> <font color="#0000ff">="item"</font> <font color="#ff0000">items</font> <font color="#0000ff">="${rssMap}"</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">p</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">b</font> <font color="#0000ff">&gt;&lt;</font> <font color="#800000">a</font> <font color="#ff0000">href</font> <font color="#0000ff">="${item.link}"</font> <font color="#0000ff">&gt;</font> ${item.title} <font color="#0000ff">&lt;/</font> <font color="#800000">a</font> <font color="#0000ff">&gt;&lt;/</font> <font color="#800000">b</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">span</font> <font color="#0000ff">&gt;</font> ${item.description} <font color="#0000ff">&lt;/</font> <font color="#800000">span</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">p</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;</font> <font color="#800000">hr</font> <font color="#0000ff">&gt;</font> &lt;br&gt; <font color="#0000ff">&lt;/</font> <font color="#800000">c:forEach</font> <font color="#0000ff">&gt;</font> &lt;br&gt;    &lt;br&gt; <font>&lt;%</font> &lt;br&gt; } <font color="#0000ff">else</font> {&lt;br&gt; <font>%&gt;</font> Error!!!! <font>&lt;%</font> &lt;br&gt; }&lt;br&gt; <font>%&gt;</font></font> &lt;br&gt;&lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br></code> <br><br>  On the page from the query, we get our ArrayList object, iterate it with JSTL and display our Rss content. <br><br> <a href="http://ipicture.ru/Gallery/Viewfull/9764110.html"><img src="http://pic.ipicture.ru/uploads/081201/thumbs/pvWGMAfTWP.jpg"></a> <br>  <strong>The doEdit method:</strong> there is nothing special here, just call PortletRequestDispatcher and go to the jsp-page HabraRssPortletEdit.  All the logic is sewn in it, although it is not good.  We, of course, fix all this without any problems. What is happening on this page?  In the scriptlet, using the same PortletPreferences object, we get the values ‚Äã‚Äãwe need, namely: <br><br>  a) List of rss channels. <br>  b) the frequency of updates. <br>  c) Number of news from each channel. <br><br>  <strong>HabraRssPortletEdit.jsp (part)</strong> <br> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">&lt;%&lt;br&gt; PortletPreferences preferences = renderRequest.getPreferences();&lt;br&gt; <font color="#0000ff">if</font> ( preferences!= <font color="#0000ff">null</font> ) {&lt;br&gt; <font color="#2B91AF">String</font> frequency = ( <font color="#2B91AF">String</font> )  preferences.getValue(HabraRssPortlet.UPDATE_FREQUENCY, <font color="#A31515">"60"</font> );&lt;br&gt; <font color="#2B91AF">String</font> quantity = ( <font color="#2B91AF">String</font> )  preferences.getValue(HabraRssPortlet.ITEM_QUANTITY, <font color="#A31515">"5"</font> );&lt;br&gt; <font color="#2B91AF">String</font> [] links = ( <font color="#2B91AF">String</font> []) preferences.getValues(HabraRssPortlet.RSS_LINKS, <font color="#0000ff">null</font> );&lt;br&gt;%&gt;</font> &lt;br&gt;&lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> <blockquote> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">&lt;%&lt;br&gt; PortletPreferences preferences = renderRequest.getPreferences();&lt;br&gt; <font color="#0000ff">if</font> ( preferences!= <font color="#0000ff">null</font> ) {&lt;br&gt; <font color="#2B91AF">String</font> frequency = ( <font color="#2B91AF">String</font> )  preferences.getValue(HabraRssPortlet.UPDATE_FREQUENCY, <font color="#A31515">"60"</font> );&lt;br&gt; <font color="#2B91AF">String</font> quantity = ( <font color="#2B91AF">String</font> )  preferences.getValue(HabraRssPortlet.ITEM_QUANTITY, <font color="#A31515">"5"</font> );&lt;br&gt; <font color="#2B91AF">String</font> [] links = ( <font color="#2B91AF">String</font> []) preferences.getValues(HabraRssPortlet.RSS_LINKS, <font color="#0000ff">null</font> );&lt;br&gt;%&gt;</font> &lt;br&gt;&lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </blockquote> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">&lt;%&lt;br&gt; PortletPreferences preferences = renderRequest.getPreferences();&lt;br&gt; <font color="#0000ff">if</font> ( preferences!= <font color="#0000ff">null</font> ) {&lt;br&gt; <font color="#2B91AF">String</font> frequency = ( <font color="#2B91AF">String</font> )  preferences.getValue(HabraRssPortlet.UPDATE_FREQUENCY, <font color="#A31515">"60"</font> );&lt;br&gt; <font color="#2B91AF">String</font> quantity = ( <font color="#2B91AF">String</font> )  preferences.getValue(HabraRssPortlet.ITEM_QUANTITY, <font color="#A31515">"5"</font> );&lt;br&gt; <font color="#2B91AF">String</font> [] links = ( <font color="#2B91AF">String</font> []) preferences.getValues(HabraRssPortlet.RSS_LINKS, <font color="#0000ff">null</font> );&lt;br&gt;%&gt;</font> &lt;br&gt;&lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br></code> <br>  Next, we draw the fields we need, lists and buttons, inserting into them the values ‚Äã‚Äãobtained just above, and which we can then freely edit, i.e.  add rss-feeds, delete them, change the values ‚Äã‚Äãof the update rate, etc. <br><br> <a href="http://ipicture.ru/Gallery/Viewfull/9764182.html"><img src="http://pic.ipicture.ru/uploads/081201/thumbs/ldgT6i253r.jpg"></a> <br> <a href="http://ipicture.ru/Gallery/Viewfull/9764247.html"><img src="http://pic.ipicture.ru/uploads/081201/thumbs/gc9Pz6hSNV.jpg"></a> <br><br>  <strong>The doHelp method:</strong> there is nothing interesting at all, we call the same PortletRequestDispatcher and redirect to the HabraRssPortletHelp page, we write anything there, although it is usually customary to write something like reference information. <br><br>  <strong>The processAction method:</strong> - the heart of our portlet, this is where all the user interaction processing takes place, in our case these are all submissions from the forms that are located on the HabraRssPortletEdit page.  Please note that this method uses objects of type ActionRequest and ActionResponse, unlike RenderRequest and RenderResponse, which are responsible for rendering the portlet, these two are responsible for user interaction.  Processing is the simplest validation of input parameters, changing and creating preferences values.  I note that the preferences validation can be put into a separate class, which should be implemented by Preferences Validator, and you should not forget to register this class in the portlet.xml descriptor.  We made it a bit simpler, if the incoming parameters do not suit us, then we set the rendering parameter to the ActionResponse object, which contains an error message, this message will be displayed on the same window. <br><br> <a href="http://ipicture.ru/Gallery/Viewfull/9764286.html"><img src="http://pic.ipicture.ru/uploads/081201/thumbs/ee4fMRDOkY.jpg"></a> <br>  Yes, it is also very important that you can change the preferences values ‚Äã‚Äãonly inside the processAction method.  The most important thing to remember is to call the store () method on an object of type PortletPreferences after all changes, otherwise the changes will not be saved.  I‚Äôm sorry to say that the portal keeps the preferences separately for each user, so if one user adds a few more links to his channel list, then other users still have one link, the same goes for the other preferences, they are individual for each user. .  Is it really very convenient?  :) <br><br> <a href="http://ipicture.ru/Gallery/Viewfull/9764313.html"><img src="http://pic.ipicture.ru/uploads/081201/thumbs/xzKBH2n2P5.jpg"></a> <br><br>  Now let's take a little look at the class responsible for RSS.  I already mentioned above that I used the finished library, you can download it <a href="http://today.java.net/pub/a/today/2006/03/21/reading-news-with-sun-rss-utilities.html">here</a> , maybe it is not the best, but that is, that is :) <br><br>  <strong>Rssutil.java</strong> <br> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">package ru.habrahabr.rssportlet;&lt;br&gt;&lt;br&gt; <font color="#0000ff">public</font> <font color="#0000ff">class</font> RssUtil {&lt;br&gt;&lt;br&gt; <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#2B91AF">ArrayList</font> updateRssFeeds(PortletPreferences preferences){&lt;br&gt; <font color="#2B91AF">ArrayList</font> allItems = <font color="#0000ff">new</font> <font color="#2B91AF">ArrayList</font> ();&lt;br&gt; <font color="#2B91AF">String</font> [] links = preferences.getValues(HabraRssPortlet.RSS_LINKS, <font color="#0000ff">null</font> );&lt;br&gt; <font color="#0000ff">int</font> quantity = Integer.parseInt(preferences.getValue(HabraRssPortlet.ITEM_QUANTITY, <font color="#A31515">"3"</font> ));&lt;br&gt; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i=0; i &lt; links.length; i++){&lt;br&gt; <font color="#2B91AF">String</font> link = links[i];&lt;br&gt;            InputStream stream = <font color="#0000ff">null</font> ;&lt;br&gt; <font color="#0000ff">try</font> {&lt;br&gt;                URL s = <font color="#0000ff">new</font> URL(link);&lt;br&gt;                URLConnection connection = s.openConnection();&lt;br&gt; <font color="#0000ff">if</font> (!(connection instanceof URLConnection)) {            &lt;br&gt; <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalArgumentException(s.toExternalForm() + <font color="#A31515">" is not a valid HTTP Url"</font> );&lt;br&gt;                }&lt;br&gt;                stream = connection.getInputStream();&lt;br&gt; <font color="#0000ff">try</font> {&lt;br&gt;                    RssParser parser = RssParserFactory.createDefault();&lt;br&gt;                    Rss rss = parser.parse(stream);&lt;br&gt;                    Collection items = rss.getChannel().getItems();&lt;br&gt; <font color="#0000ff">if</font> (items != <font color="#0000ff">null</font> &amp;&amp; !items.isEmpty()) {&lt;br&gt;                        Iterator it = items.iterator();&lt;br&gt; <font color="#0000ff">int</font> count = 0;&lt;br&gt; <font color="#0000ff">while</font> (it.hasNext() &amp;&amp; count &lt; quantity){&lt;br&gt;                            Item item = (Item) it.next();&lt;br&gt;                            allItems.add(item);&lt;br&gt;                            count++;&lt;br&gt;                        }&lt;br&gt;                    }&lt;br&gt;                } <font color="#0000ff">catch</font> (RssParserException e) {&lt;br&gt;                    e.printStackTrace();&lt;br&gt;                }&lt;br&gt;            } <font color="#0000ff">catch</font> (IOException e) {&lt;br&gt;                e.printStackTrace();&lt;br&gt;            }&lt;br&gt;        }&lt;br&gt; <font color="#0000ff">return</font> allItems;&lt;br&gt;    }&lt;br&gt;&lt;br&gt; <font color="#0000ff">public</font> <font color="#0000ff">static</font> boolean checkUpdateTime(Long lastUpdateTime, PortletPreferences preferences) {&lt;br&gt; <font color="#0000ff">int</font> interval = Integer.parseInt(preferences.getValue(HabraRssPortlet.UPDATE_FREQUENCY, <font color="#A31515">"60"</font> ));&lt;br&gt; <font color="#0000ff">if</font> (((System.currentTimeMillis() - lastUpdateTime.longValue()) / 1000) &gt; (interval * 60))&lt;br&gt; <font color="#0000ff">return</font> <font color="#0000ff">true</font> ;&lt;br&gt; <font color="#0000ff">return</font> <font color="#0000ff">false</font> ;&lt;br&gt;    }&lt;br&gt;&lt;br&gt;}&lt;br&gt;</font> &lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> <blockquote> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">package ru.habrahabr.rssportlet;&lt;br&gt;&lt;br&gt; <font color="#0000ff">public</font> <font color="#0000ff">class</font> RssUtil {&lt;br&gt;&lt;br&gt; <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#2B91AF">ArrayList</font> updateRssFeeds(PortletPreferences preferences){&lt;br&gt; <font color="#2B91AF">ArrayList</font> allItems = <font color="#0000ff">new</font> <font color="#2B91AF">ArrayList</font> ();&lt;br&gt; <font color="#2B91AF">String</font> [] links = preferences.getValues(HabraRssPortlet.RSS_LINKS, <font color="#0000ff">null</font> );&lt;br&gt; <font color="#0000ff">int</font> quantity = Integer.parseInt(preferences.getValue(HabraRssPortlet.ITEM_QUANTITY, <font color="#A31515">"3"</font> ));&lt;br&gt; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i=0; i &lt; links.length; i++){&lt;br&gt; <font color="#2B91AF">String</font> link = links[i];&lt;br&gt;            InputStream stream = <font color="#0000ff">null</font> ;&lt;br&gt; <font color="#0000ff">try</font> {&lt;br&gt;                URL s = <font color="#0000ff">new</font> URL(link);&lt;br&gt;                URLConnection connection = s.openConnection();&lt;br&gt; <font color="#0000ff">if</font> (!(connection instanceof URLConnection)) {            &lt;br&gt; <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalArgumentException(s.toExternalForm() + <font color="#A31515">" is not a valid HTTP Url"</font> );&lt;br&gt;                }&lt;br&gt;                stream = connection.getInputStream();&lt;br&gt; <font color="#0000ff">try</font> {&lt;br&gt;                    RssParser parser = RssParserFactory.createDefault();&lt;br&gt;                    Rss rss = parser.parse(stream);&lt;br&gt;                    Collection items = rss.getChannel().getItems();&lt;br&gt; <font color="#0000ff">if</font> (items != <font color="#0000ff">null</font> &amp;&amp; !items.isEmpty()) {&lt;br&gt;                        Iterator it = items.iterator();&lt;br&gt; <font color="#0000ff">int</font> count = 0;&lt;br&gt; <font color="#0000ff">while</font> (it.hasNext() &amp;&amp; count &lt; quantity){&lt;br&gt;                            Item item = (Item) it.next();&lt;br&gt;                            allItems.add(item);&lt;br&gt;                            count++;&lt;br&gt;                        }&lt;br&gt;                    }&lt;br&gt;                } <font color="#0000ff">catch</font> (RssParserException e) {&lt;br&gt;                    e.printStackTrace();&lt;br&gt;                }&lt;br&gt;            } <font color="#0000ff">catch</font> (IOException e) {&lt;br&gt;                e.printStackTrace();&lt;br&gt;            }&lt;br&gt;        }&lt;br&gt; <font color="#0000ff">return</font> allItems;&lt;br&gt;    }&lt;br&gt;&lt;br&gt; <font color="#0000ff">public</font> <font color="#0000ff">static</font> boolean checkUpdateTime(Long lastUpdateTime, PortletPreferences preferences) {&lt;br&gt; <font color="#0000ff">int</font> interval = Integer.parseInt(preferences.getValue(HabraRssPortlet.UPDATE_FREQUENCY, <font color="#A31515">"60"</font> ));&lt;br&gt; <font color="#0000ff">if</font> (((System.currentTimeMillis() - lastUpdateTime.longValue()) / 1000) &gt; (interval * 60))&lt;br&gt; <font color="#0000ff">return</font> <font color="#0000ff">true</font> ;&lt;br&gt; <font color="#0000ff">return</font> <font color="#0000ff">false</font> ;&lt;br&gt;    }&lt;br&gt;&lt;br&gt;}&lt;br&gt;</font> &lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> <br></code></code> </blockquote> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">package ru.habrahabr.rssportlet;&lt;br&gt;&lt;br&gt; <font color="#0000ff">public</font> <font color="#0000ff">class</font> RssUtil {&lt;br&gt;&lt;br&gt; <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#2B91AF">ArrayList</font> updateRssFeeds(PortletPreferences preferences){&lt;br&gt; <font color="#2B91AF">ArrayList</font> allItems = <font color="#0000ff">new</font> <font color="#2B91AF">ArrayList</font> ();&lt;br&gt; <font color="#2B91AF">String</font> [] links = preferences.getValues(HabraRssPortlet.RSS_LINKS, <font color="#0000ff">null</font> );&lt;br&gt; <font color="#0000ff">int</font> quantity = Integer.parseInt(preferences.getValue(HabraRssPortlet.ITEM_QUANTITY, <font color="#A31515">"3"</font> ));&lt;br&gt; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i=0; i &lt; links.length; i++){&lt;br&gt; <font color="#2B91AF">String</font> link = links[i];&lt;br&gt;            InputStream stream = <font color="#0000ff">null</font> ;&lt;br&gt; <font color="#0000ff">try</font> {&lt;br&gt;                URL s = <font color="#0000ff">new</font> URL(link);&lt;br&gt;                URLConnection connection = s.openConnection();&lt;br&gt; <font color="#0000ff">if</font> (!(connection instanceof URLConnection)) {            &lt;br&gt; <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalArgumentException(s.toExternalForm() + <font color="#A31515">" is not a valid HTTP Url"</font> );&lt;br&gt;                }&lt;br&gt;                stream = connection.getInputStream();&lt;br&gt; <font color="#0000ff">try</font> {&lt;br&gt;                    RssParser parser = RssParserFactory.createDefault();&lt;br&gt;                    Rss rss = parser.parse(stream);&lt;br&gt;                    Collection items = rss.getChannel().getItems();&lt;br&gt; <font color="#0000ff">if</font> (items != <font color="#0000ff">null</font> &amp;&amp; !items.isEmpty()) {&lt;br&gt;                        Iterator it = items.iterator();&lt;br&gt; <font color="#0000ff">int</font> count = 0;&lt;br&gt; <font color="#0000ff">while</font> (it.hasNext() &amp;&amp; count &lt; quantity){&lt;br&gt;                            Item item = (Item) it.next();&lt;br&gt;                            allItems.add(item);&lt;br&gt;                            count++;&lt;br&gt;                        }&lt;br&gt;                    }&lt;br&gt;                } <font color="#0000ff">catch</font> (RssParserException e) {&lt;br&gt;                    e.printStackTrace();&lt;br&gt;                }&lt;br&gt;            } <font color="#0000ff">catch</font> (IOException e) {&lt;br&gt;                e.printStackTrace();&lt;br&gt;            }&lt;br&gt;        }&lt;br&gt; <font color="#0000ff">return</font> allItems;&lt;br&gt;    }&lt;br&gt;&lt;br&gt; <font color="#0000ff">public</font> <font color="#0000ff">static</font> boolean checkUpdateTime(Long lastUpdateTime, PortletPreferences preferences) {&lt;br&gt; <font color="#0000ff">int</font> interval = Integer.parseInt(preferences.getValue(HabraRssPortlet.UPDATE_FREQUENCY, <font color="#A31515">"60"</font> ));&lt;br&gt; <font color="#0000ff">if</font> (((System.currentTimeMillis() - lastUpdateTime.longValue()) / 1000) &gt; (interval * 60))&lt;br&gt; <font color="#0000ff">return</font> <font color="#0000ff">true</font> ;&lt;br&gt; <font color="#0000ff">return</font> <font color="#0000ff">false</font> ;&lt;br&gt;    }&lt;br&gt;&lt;br&gt;}&lt;br&gt;</font> &lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <br></code> <br><br>  The class consists of two static methods, one of which actually receives Rss-content from existing channels, and the other checks whether it is time to update.  Nothing complicated :) <br><br>  Well, that seems to be all.  All that was said here is my personal IMHO.  If someone has any questions - ask in comments :) All <a href="http://rapidshare.com/files/169204632/HabraRssPortlet.7z.html">code</a> and <a href="http://rapidshare.com/files/169204335/HabraRssPortlet.war.html">war-archive</a> can be taken as an attachment :) <br><br>  Ps.  Yes, and sorry for System.out.println () in the code, left for clarity. <br><br></div><p>Source: <a href="https://habr.com/ru/post/45927/">https://habr.com/ru/post/45927/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../45919/index.html">Monty Hall's paradox: is there any difference?</a></li>
<li><a href="../45921/index.html">Home server - AMD, Debian x64, Bind9, Apache 2, PHP5, MySQL5, Trac, Subversion and a lot of fun</a></li>
<li><a href="../45924/index.html">kawaii phone for motorola</a></li>
<li><a href="../45925/index.html">Glasses display: Teleglass by Scalar</a></li>
<li><a href="../45926/index.html">habra</a></li>
<li><a href="../45929/index.html">MySpace in Russia: details</a></li>
<li><a href="../45930/index.html">Russian coding4fun started</a></li>
<li><a href="../45931/index.html">40 years old computer mouse</a></li>
<li><a href="../45932/index.html">Summarizing the experience of the three stages</a></li>
<li><a href="../45933/index.html">26.8 million unique internet users per week</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>