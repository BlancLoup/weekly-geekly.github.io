<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A little trick to quickly switch between applications.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Preamble 
 It so happened that I have long used Logitech mice - MX300 and MX310. They have an extra button above the wheel, on which you can hang vari...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A little trick to quickly switch between applications.</h1><div class="post__text post__text-html js-mediator-article"><h4>  Preamble </h4><br>  It so happened that I have long used Logitech mice - MX300 and MX310.  They have an extra button above the wheel, on which you can hang various functions.  In the old drivers (MouseWare), among these functions was the ‚ÄúRecall Application‚Äù, which was switched over to the previous active window - about the same as what happens if you press Alt + Tab once.  I immediately liked this opportunity: often there is a situation when you need to switch to some window, do something there (for example, copy a line) and go back (respectively, to paste this copied line).  Alt + Tab in this case is less convenient (because the left hand should be removed from the combination Ctrl + C, and then returned to its previous position to press Ctrl + V). <br><br>  But here I set myself Windows XP x64, and it turned out that MouseWare for 64-bit systems is inaccessible.  For the MX310, a more modern SetPoint utility was found, but the ‚ÄúRecall Application‚Äù function is no longer there.  Fortunately, we managed to adjust the sending of the Alt + Tab shortcut to the desired button, but the flashing of the task list window at the time of switching was a bit annoying.  So, having overcome laziness, I was honored to write a small utility that helped eliminate this drawback. <br><a name="habracut"></a><br><h4>  Ambula </h4><br>  In fact, only one thing was required of the utility: hang in the background and, upon receiving a signal to press a button, switch to the ‚Äúneighboring‚Äù window.  The problem was not so trivial, as I assumed at first.  The signal to press the button directly cannot be obtained, since the list of available actions in SetPoint does not contain such an action ‚Äúsend a signal to press the sixth button‚Äù.  So I had to cheat a little bit: by pressing a button, emulate some keyboard shortcut, and the program has already caught this combination.  Naturally, you need to choose something that is not used in normal work;  I chose Ctrl + Alt + Shift + Z. <br><br>  The second difficulty was choosing the right window.  You can navigate through the Z-stack of applications by calling GetWindow (hwnd, GW_HWNDNEXT), but among these windows there are a large number of those that do not need to be switched.  For example, invisible.  Even if you leave only visible windows, there are many other top-level windows that are not in the regular Alt + Tab list.  Here I could not find a satisfactory solution.  One option was able to google <a href="http://stackoverflow.com/questions/210504/enumerate-windows-like-alt-tab-does">Stack overflow</a> , but I didn‚Äôt get it right with the enumeration of windows.  There are also <a href="http://www.ntwind.com/software/taskswitchxp.html">TaskSwitchXP</a> source <a href="http://www.ntwind.com/software/taskswitchxp.html">files</a> , but the attempt to adapt the code to my needs failed (extra windows appeared in the list).  I couldn‚Äôt figure it out completely in the code, so either I did something wrong, or the code was not originally designed for such inappropriate use.  (However, I will continue to deal with it.) In the end, I conducted my own research and determined the empirical conditions for choosing the ‚Äúright‚Äù windows (I will list these conditions at the end).  The resulting program code fit on one page: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WinMainCRTStartup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!RegisterHotKey(<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, MOD_CONTROL | MOD_SHIFT | MOD_ALT, <span class="hljs-string"><span class="hljs-string">'Z'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; MSG msg = {<span class="hljs-number"><span class="hljs-number">0</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (GetMessage(&amp;msg, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (msg.message == WM_HOTKEY) { HWND current_wnd = GetForegroundWindow(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (current_wnd == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Find top-level owner of the current window HWND owner = current_wnd; do { current_wnd = owner; owner = GetWindow(current_wnd, GW_OWNER); } while ((owner != NULL) &amp;&amp; IsWindowVisible(owner)); // Find next window in Z-stack to switch to do { current_wnd = GetWindow(current_wnd, GW_HWNDNEXT); if (current_wnd == NULL) break; owner = GetWindow(current_wnd, GW_OWNER); } while (!IsWindowVisible(current_wnd) || ((GetWindowLongPtr(current_wnd, GWL_EXSTYLE) &amp; WS_EX_TOOLWINDOW) != 0) || ((owner != NULL) &amp;&amp; IsWindowVisible(owner))); if (current_wnd != NULL) SetForegroundWindow(current_wnd); } } UnregisterHotKey(NULL, 0); return 0; }</span></span></code> </pre> <br><h5>  Small technical comments </h5><ul><li>  The function is called <strong>WinMainCRTStartup</strong> , because CRT is not involved here, so I turned it off.  As a result, the compiled program takes 3072 bytes.  More information about this can be found on the <a href="">RSDN</a> . </li><li>  The empirical conditions for choosing the ‚Äúright‚Äù window are as follows.  The window should: <ol><li>  be visible; </li><li>  Do not have an extended style <strong>WS_EX_TOOLWINDOW</strong> ; </li><li>  the owner window for this window must be missing or invisible. </li></ol></li><li>  The first cycle (search for the ‚Äúroot‚Äù owner window) is needed to cope with the situation when the current window is the ‚Äúwrong‚Äù window.  For example, in the ABBYY Lingvo program, all windows, including card windows, are ‚Äúwrong‚Äù: these are top-level windows, and each of them is owned by some fictitious window that has a visibility flag, but with zero dimensions.  If the current window is such a window card, then the GetWindow loop (current_wnd, GW_HWNDNEXT) first of all gets into this most fictitious Lingvo window and, since it is formally ‚Äúcorrect,‚Äù activates it.  Those.  switching to another application does not occur.  It would be possible to use GetAncestor (current_wnd, GA_ROOTOWNER) instead of a loop, but in this case the visibility of the windows is not taken into account and the result is incorrect. </li><li>  Unfortunately, this heuristic algorithm is not perfect.  In particular, it works incorrectly with Excel 2003 windows (it is easy to loop in one window).  True, this is partly the fault of Excel itself, which organizes windows in some completely unintelligible way, so even the standard Alt + Tab can loop on one window and you need to double-press Tab to skip this cycle.  With this mystery, I still plan to sort out.  You also need to be careful with virtual machines, because in the case of intercepting keyboard input the key combination will go to the virtual machine and not to the host system. </li><li>  In the current version of the correct exit from the program is not provided (therefore, generally speaking, the UnregisterHotKey call at the end of the program is superfluous, but I left it for beauty :-)).  If you want to periodically terminate the program, and you don‚Äôt want to kill the process, you can add another global keyboard shortcut registration, and in the message processing loop, check which combination was pressed, and if it is not Ctrl + Alt + Shift + Z, - exit the loop. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/105312/">https://habr.com/ru/post/105312/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../105303/index.html">Open beta testing of the e-commerce project "Notando Commerce"</a></li>
<li><a href="../105304/index.html">Russian Post will reach anyone, even Ukrainians</a></li>
<li><a href="../105307/index.html">Quite ordinary linuksovka in Yekaterinburg</a></li>
<li><a href="../105308/index.html">Cacti and Network UPS Tools</a></li>
<li><a href="../105309/index.html">InsidersTalk - interviews with people of different professions</a></li>
<li><a href="../105314/index.html">Interview with the founder of QNX Software Systems, dedicated to the release of the BlackBerry Tablet OS</a></li>
<li><a href="../105315/index.html">Review T-Mobile G2, aka HTC Desire Z: Opening the box</a></li>
<li><a href="../105316/index.html">Stuxnet hit more than 1,000 enterprises in China</a></li>
<li><a href="../105317/index.html">Open registration of domains in the zone. RF will begin on November 11</a></li>
<li><a href="../105318/index.html">Google launched Phone Gallery</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>