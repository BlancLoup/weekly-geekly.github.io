<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How traffic optimization is done</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=""Efficiency" standard WAN - only about 10% 

 If you look into almost any communication channel between a branch of a company and a data center, you c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How traffic optimization is done</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/5cd/bcd/9ad/5cdbcd9adc2a0438758f53ad5a25c239.png"><br>  <i>"Efficiency" standard WAN - only about 10%</i> <br><br>  If you look into almost any communication channel between a branch of a company and a data center, you can see a rather suboptimal picture: <br><ul><li>  First of all, a lot of (up to 60‚Äì70% of the channel) <b>redundant information is being transmitted</b> , which one way or another was already requested. </li><li>  Secondly, the channel is loaded with <b>‚Äútalkative‚Äù applications</b> designed for operation in a local network - they exchange short messages, which negatively affects their performance in the communication channel. </li><li>  Third, the <b>TCP protocol</b> was originally designed for local area networks and is excellent for small RTT delays and in the absence of packet loss on the network.  In real channels with packet loss, the speed greatly degrades and slowly recovers due to large RTT. </li></ul><br>  I work as the head of the engineering team of the CROC telecommunications department and regularly optimize the communication channels of data centers of both our and energy companies, banks and other organizations.  Below I will tell the basics and give the most interesting, in my opinion, solution. <a name="habracut"></a><br><br><h4>  Compression and Deduplication </h4><br>  The first problem has already been described: a lot of redundant duplicate data is transmitted in the channel.  The most striking example is the Citrix farm, in which branches of a bank operate: in a single office, the same data can request 20-30 different machines.  Accordingly, the channel could be easily unloaded by 60‚Äì70% due to deduplication. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      At Citrix itself, of course, you can enable data compression, but efficiency (compression) is several times lower than with specialized traffic optimizers.  Mainly due to the fact that optimizers not only compress data, but also deduplicate.  Through the optimizer passes the traffic of the entire branch.  And the more users in the branch, the more repeated user requests and the greater the effect of deduplication.  For one user, standard compression, for example, Limpel-Ziv, may be even higher than deduplication, but if there are more devices, deduplication will come out on top. <br><br>  As a rule, optimizers are a PACK, but they can also be implemented in the form of virtual machines.  To optimize traffic on the communication channel, optimizers should be installed at both sites.  Optimizers are placed before VPN gateways, since deduplicating encrypted traffic is useless. <br><br>  The deduplication algorithm works as follows: <br><ol><li>  The branch makes a request to the data center; </li><li>  The server sends data to the office; </li><li>  Before getting into the communication channel, the data passes through the optimizer on the data center side; </li><li>  The optimizer segments data and deduplicates it.  The data is divided into blocks, each of which receives a short name - a link to the block; <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e5a/d56/df2/e5ad56df2cae820cb6b502cff4594dd7.png"><br></li><li>  Links and data blocks are stored in the local repository - the so-called dictionary; </li><li>  Links and data blocks are passed to the optimizer in the branch.  But before sending, the data center optimizer compresses the data according to an algorithm.  As a result, the data does not become more even with the first (cold) data transfer; </li><li>  The branch optimizer recovers algorithm-compressed data obtained from the data center, builds its local symmetric dictionary of correspondences (data block - reference), removes the reference data from the data and sends the initial data to the client; </li><li>  Now, any data passing through the branch office or data center optimizers will be checked for duplicated data.  If a match is found with a block located in the dictionary, then this raw data block will be replaced by a short link.  A known (already transmitted) block is not transmitted. </li></ol><br><br>  It remains to add that the dictionary is constantly updated and, thanks to a special algorithm, the most popular data blocks remain in the dictionary. <br><br>  We see a fundamental difference from traditional caching devices.  <b>Caching devices work at the file level.</b>  If the file has undergone any changes, even minor, then it should be transferred again.  Optimizers work at the level of data blocks, and when a previously transferred file is changed, only changes will be sent to the communication channel, and the rest will be replaced by links. <br><br>  Another problem is that TCP speed is limited by the window size (TCP Windows Size).  Window size - the amount of data transmitted by the sender before receiving confirmation from the recipient.  At the same time, for transmitting compressed traffic, it is required to transmit TCP Windows Size less times, which leads to an increase in transmission speed. <br><br>  <b>So again, it works like this:</b> <br><ul><li>  Device A deduplicates traffic. </li><li>  Device B collects the ‚Äúbig picture‚Äù from its local storage. </li><li>  Both of these devices work symmetrically. </li><li>  Both of these devices do not affect the infrastructure and the configuration of everything that lies behind them, that is, they are simply included in the break of the channel, for example, at the exit from the data center and the entrance to the regional office of the company. </li><li>  Devices do not limit communication with nodes where there are no such devices. </li></ul><br><br><h4>  Deduplication for encrypted channels </h4><br>  The encrypted channel is obviously worse suited for compression and deduplication, that is, there is almost no practical benefit from working with already encrypted traffic.  Therefore, optimizers are included in the gap before the encryption device: the data center sends data to the optimizer, the optimizer sends it to encryption (for example, to a secure VPN channel), on that side the traffic is decrypted and sent to the optimizer in place, and the latter sends it to the network.  This is the regular function of ‚Äúoptimizer boxes‚Äù, and all this happens without reducing the risk of traffic compromise. <br><br><h4>  Mobile deduplication </h4><br>  In recent years, people with laptops and tablets, who also need a lot of data (the same images of virtual machines or a sample from the database), often work directly with data centers.  For them, not ‚Äúoptimizer boxes‚Äù are used, but a special software that simply consumes part of the processor resources and part of the hard disk for the same purposes.  In fact, we are changing a certain decrease in notebook performance and hard disk space in the cache to a faster channel.  Users usually do not notice anything other than speeding up network services. <br><br><h4>  Who makes these optimizers? </h4><br>  We use Riverbed solutions.  This company was founded in 2002, and in 2004 introduced its first model of optimizers for communication channels.  Riverbed products and solutions, including WAN network optimization, performance management, application delivery and data warehousing acceleration, enable IT professionals to increase and manage performance.  Optimizers are very easy to integrate into the network.  The easiest way is to install a "break" from the LAN to the router or VPN gateway. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/20a/c33/303/20ac3330367f2329c3de4b09a698c326.png"><br>  <i>Competitive decisions.</i>  <i>In 2013, Riverbed occupied 50% of the market for the WAN optimization segment.</i> <br><br>  From the point of view of the commercial director of the customer, these are several boxes, which, after a simple connection to the network, speed up slow channels by 2-3 times and reduce the load on channels by 2 times.  For this, almost everyone loves them! <br><br><h4>  Optimizer connection </h4><br>  The easiest and most reliable way is to ‚Äúbreak‚Äù between the border router and the LAN switch.  If the optimizer fails, it closes the contacts of the LAN and WAN interfaces - and the traffic simply passes through it, like a normal cross-over cable.  Accordingly, seeing non-optimized traffic, the optimizer on that side also simply passes it through itself without processing. <br><br>  <b>Respectively:</b> <br><ul><li>  Communication branch with the optimizer and the data center with the optimizer - traffic is optimized. </li><li>  Connection of a branch without an optimizer and a data center with an optimizer - the data center optimizer just transparently passes traffic without changes. </li><li>  The affiliate's connection with the optimizer and the data center with the optimizer when any of the optimizers fails - the traffic simply does not compress and goes ‚Äúas is‚Äù. </li></ul><br>  Naturally, in data centers, optimizers are clustered for fault tolerance or increasing power plus are supplied with Interceptor balancers.  But about it a little lower, when we get to the specific equipment. <br><br><h4>  TCP acceleration </h4><br>  TCP speed is limited by the size of the window.  The window is the amount of information that the server can send to the client before receiving confirmation of receipt. <br><br>  TCP's standard behavior is: <br><ul><li>  slow connection acceleration; TCP window size increases; </li><li>  in case of packet loss - a sharp drop in speed (window decrease by 2 times); </li><li>  and again its slow increase (increase in the window); </li><li>  again packet loss and sagging bands and so on. </li></ul><br><br><img src="https://habrastorage.org/getpro/habr/post_images/678/c60/42c/678c6042c2b3eb2f69b411b2dec5588c.png"><br>  <i>Orange "saw" on the chart - the standard behavior of TCP</i> <br><br>  On communication channels with high bandwidth, but with the presence of any level of losses and large RTT delays, the available bandwidth is used inefficiently, that is, the channel is never fully loaded. <br><br>  At Riverbed, they were thinking about the same direction.  And since we already have optimizer boxes in the input and output, it is foolish not to use them to modify the TCP protocol to avoid standard problems.  Therefore, optimizers are able not only to optimize traffic at the data level (deduplication / compression), but also to speed up the transport layer. <br><br>  Here are a number of modes available for TCP acceleration: <br><ul><li>  HighSpeed ‚Äã‚ÄãTCP mode - here the speed reaches its maximum much faster than during normal operation with TCP.  With losses, it is not so low and does not sink so much as standard TCP; </li><li>  MaxTCP mode - uses 100% bandwidth without slowing down.  The packet is lost - the slowdown does not occur.  However, this mode requires the setting of QoS QoS rules to determine the limitations of the available bandwidth that MX-TCP traffic can occupy; </li><li>  SCPS mode - designed specifically for satellite communication channels.  Here the bands are not limited, as in MaxTCP.  SCPS perfectly adapts to the floating characteristics of satellite channels. </li></ul><br><br><h4>  Application optimization </h4><br>  Many applications are "talkative", that is, they can send up to 50 packets when one is enough.  As I have already said, this is a consequence of designing for local networks, and not for work through the channels of ‚Äúdistant‚Äù communication.  Using optimizers, the number of round-trip passes is reduced by more than 50 times. <br><br>  Here's what it looks like: <br><img src="https://habrastorage.org/getpro/habr/post_images/fe0/8ba/ba4/fe08baba4f58076ffb09d7b6563fde70.png"><br><br>  Optimizers act as transparent proxies at the seventh level for a number of the most common application protocols. <br><br>  The data center optimizer acts as a client in relation to the server.  The branch optimizer acts as a server in relation to clients.  Thus, inefficient, ‚Äúchatty‚Äù communication of applications remains in the local network.  Between optimizers, application messaging occurs in a more suitable form for communication channels - the number of messages decreases. <br><br>  Riverbed Optimization Devices can speed up the following application protocols at the seventh level: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fcf/927/bf9/fcf927bf9e90d561cf631bff36d009e5.png"><br><br>  Interestingly, there are also encrypted applications, including encrypted Citrix and MAPI.  When optimizing encrypted traffic does not decrease the level of security. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/699/a6b/6d8/699a6b6d8916a178c4ea284b9e891a4a.png"><br>  <i>Examples of application acceleration.</i>  <i>In a real network, the acceleration will depend on the communication channel.</i>  <i>The worse the communication channel, the greater the rate of acceleration can be achieved.</i> <br><br><h4>  Typical connection scheme </h4><br><br><img src="https://habrastorage.org/getpro/habr/post_images/373/48a/ccb/37348accb08ea7341182d32806dfa208.png"><br><br>  Steelhead optimizers are placed in front of the data link, but before encryption devices.  For data centers with special requirements, clustering is also used to improve reliability, plus Interceptor load balancers. <br><br><h4>  Result (example) </h4><br><br><img src="https://habrastorage.org/getpro/habr/post_images/876/4bd/87f/8764bd87fd0129b4303951ef0ab2b60a.png"><br>  <i>Green - WAN traffic.</i>  <i>Blue - LAN traffic.</i>  <i>Without Riverbed, they would be the same.</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1eb/2f7/aff/1eb2f7afff2830062e63f9ff7340b111.png"><br>  <i>The highlighted column shows the percentage of compression on TCP ports.</i> <br><br><h4>  Iron rulers </h4><br><br><img src="https://habrastorage.org/getpro/habr/post_images/270/337/c99/270337c994bdfa9a198875a2a7e62c25.png"><br><br>  Capacity can be extended by license.  To improve performance, in some cases a hardware upgrade is required.  Upgrade capabilities within the platform are indicated by green arrows. <br><br>  The younger model is suitable even for a small online store: it is from 1 megabit per second and 20 channels.  A flagship supports up to 150,000 simultaneous open connections on channels of 1.5 gigabits per second.  If this is not enough, the Inteceptor balancer is used.  Clusters of balancers and optimizers allow you to work with a channel up to 40 gigabits per second with 1 million connections open simultaneously. <br><br><h4>  How much is the price list? </h4><br>  The younger model is about 100 thousand rubles, a device for medium data centers - 1.1 million rubles, for large data centers - from 5.5 million rubles.  At the same time, the price changes quite strongly depending on the specific usage patterns, plus there may be discounts, therefore the mentioned numbers are purely approximate, better check by mail (it is at the end of the topic).  The payback of such solutions for medium and large businesses is easy enough to calculate, simply figuring that you will get from 30 to 60% of the channel (again, I can call a specific indicator with an accuracy of 10% depending on the type of utilization of the channel), and Users will not complain about application brakes. <br><br><h4>  More Riverbed items: </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/4d6/003/c97/4d6003c9749021506387ae18ae1b2fba.png"><br><br>  After the channel is optimized in the manner described, we often monitor and resolve problems with specific services and equipment.  In practice, they are whole detectives.  I will tell about them a bit later.  If interested - subscribe to the CROC corporate blog on Habr√©. <br><br><h4>  For whom I specifically implemented: </h4><br>  I do not have the right to call all customers, but I can say that Riverbed‚Äôs traffic optimization solution was used to: <br><ul><li>  the five largest representatives of the banking sector; </li><li>  a large gold company; </li><li>  a large logistics company; </li><li>  a number of smaller companies. </li></ul><br><br><h4>  Questions </h4><br>  If you are interested in something specific, ask in the comments or by mail <b>AVrublevsky@croc.ru</b> .  By the same mail, I can send pricing, implementation schemes and evaluation of channel optimization after discussing your specific situation.  It is clear that an accurate assessment is possible only after the test, but on average, the error after discussion is about 10%. </div><p>Source: <a href="https://habr.com/ru/post/214693/">https://habr.com/ru/post/214693/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../214679/index.html">New Yandex.Disk interface. How did we do it and why in general do it</a></li>
<li><a href="../214681/index.html">FineReader 12: new in the interface and the complexity of converting achievements to percentages</a></li>
<li><a href="../214683/index.html">Updated development tools for android, java 7 support</a></li>
<li><a href="../214685/index.html">MtGox Bitcoin Exchange sources are merged, some are posted on the Internet</a></li>
<li><a href="../214691/index.html">Microsoft Free Exam Preparation Webinar Series Starts</a></li>
<li><a href="../214695/index.html">Counts - sigmajs</a></li>
<li><a href="../214697/index.html">Forget about storage. Nutanix - a revolution in virtualization</a></li>
<li><a href="../214703/index.html">New free courses of virtual academy Microsoft Virtual Academy, February 2014</a></li>
<li><a href="../214705/index.html">Intel 730 - SSD, overclocked to the limit</a></li>
<li><a href="../214707/index.html">Another do-it-yourself NAS, part 1: from what was</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>