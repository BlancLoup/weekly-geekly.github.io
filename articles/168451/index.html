<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Nine Circles Automated Testing</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to tell you about our automated testing system. The system in my understanding is not only code, but also hardware, processes and people. 

 I ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Nine Circles Automated Testing</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/501/61d/085/50161d0851606c7ba88b4143ccabeaa9.jpg" align="left"><br><br>  I want to tell you about our automated testing system.  The system in my understanding is not only code, but also hardware, processes and people. <br><br>  I will answer the questions: What are we testing?  Who is doing this?  Why is this all happening?  What do we have? <br>  And then I will tell how everything works: I will describe the testing circles - from the first to the ninth. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  What? </h5><br>  Our product is a corporate web application Service Desk, written in java. <br><br><h5>  Who! </h5><br>  I am the lead of the automated testing group;  programmers whose code we are testing;  manual testers, whose routine we eradicate;  managers who believe that if the tests have passed, then everything is not so bad. <br><br><h5>  What for? </h5><br>  The goal of my group is to protect the product from the <a href="http://www.slideshare.net/Cartmendum/testlabs09-part-i">regression spiral of death</a> . <br>  The task of the group is the non-detection of defects by a maximum of interesting methods with a minimum amount of manual labor. <br><br><h5>  What do we already have? </h5><br>  900 short and not so application usage scenarios coded into tests. <br>  CI Jenkins on six servers, three DBMS, two OS families and three browsers for which we write the product. <br><br><h4>  How it works? </h4><br><a name="habracut"></a><br><h5>  Circle one - test script. </h5><br>  The smallest unit - the test begins with the script. <br><div class="spoiler">  <b class="spoiler_title">Javadoc test method, which we then collect and show the manual testers and PMMs.</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/c20/a8c/352/c20a8c352c5a19608aaaee52926fb56e.png"></div></div><br><ol><li>  The title of the test - briefly and clearly describes what we check. </li><li>  Reference to the formulation for which the test was written;  if it is not there, then the case is just a game of the sore imagination of the tester, we have corporate software, we are not joking. </li><li>  Test script in Russian, describing the three phases of the test - preparation, execution of the action and verification. </li></ol><br><blockquote>  <b>Note:</b> The script is not a translation from java to Russian, on the contrary, the script is primary, and it takes longer to write a quality case than to encode it.  In our case, it is usually written by the wrong person who encodes the test. </blockquote><br>  <b>The first phase of the</b> test is the preparation of the testing system. <br><pre><code class="java hljs">Catalog catalog = DAOCatalog.create(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); catalog.set(Catalog.TITLE, ‚Äú          ‚Äù) DSLCatalog.add(catalog); CatalogItem item = DAOCatalogItem.create(catalog); DSLCatalogItem.add(item);</code> </pre> <br>  The concept is a system model described by methods from the DAO;  There are DSL prefixed methods that lead the system under test to the state described by the model. <br>  Methods from DSL change the application through the system API, in our case it is the restfull service.  The entire first phase of the test is carried out through the API. <br><blockquote>  <b>Note:</b> The rule is to write a DSL for each encoded test action in order to further execute it through the API. </blockquote><br>  The model is a map string, we try to avoid excessive complication of the testing system. <br><br>  <b>The second phase of the</b> test is a test action using selenium, through a browser. <br><pre> <code class="java hljs">DSLCatalog.goToCard(tester, item.get(CatalogItem.PARENT_CODE)); tester.clickElement(ADD_ELEMEMT); DSLForm.assertFormAppear(tester, DSLForm.DIALOG); tester.sendKeys(DSLForm.TITLE_INPUT, item.get(CatalogItem.TITLE)); tester.sendKeys(DSLForm.CODE_INPUT, item.get(CatalogItem.CODE)); tester.clickElement(DSLForm.SAVE_ON_FORM); DSLForm.assertFormDisappear(tester, DSLForm.DIALOG);</code> </pre><br><blockquote>  <b>Note:</b> Also, to ensure testability, each new interface element in the system has its own unique id within the page.  Therefore, our xpath look like this: <pre> <code class="java hljs"> <span class="hljs-string"><span class="hljs-string">"//*[@id='description-value']"</span></span></code> </pre>  or <pre> <code class="java hljs"> <span class="hljs-string"><span class="hljs-string">"//*[@id='description-input']"</span></span></code> </pre><br>  Not so: <br><pre> <code class="java hljs"><span class="hljs-string"><span class="hljs-string">"/html/body/table/tbody/tr/td[6]/table/tbody/tr[4]/td/div"</span></span></code> </pre><br>  A class of problems with layout changes is solved. </blockquote><br><br>  <b>The third phase</b> is verification or verification.  We perform it at least once through the interface: <br><pre> <code class="java hljs">Assert.assertEquals(<span class="hljs-string"><span class="hljs-string">"      "</span></span>, template.get(ReportTemplate.TITLE), tester.getTextElement(DSLForm.TITLE_VALUE));</code> </pre><br>  And then you can check already through the API. <br><pre> <code class="java hljs">ModelMap map = SdDataUtils.getObject(sc.get(Bo.METACLASS_FQN), Bo.UUID, sc.getUUID()); String message = String.format(<span class="hljs-string"><span class="hljs-string">"   uuid- '%s'   ."</span></span>, sc.getUUID()); Assert.assertEquals(message, team.get(Bo.TITLE), SdDataUtils.getMapValue(map, <span class="hljs-string"><span class="hljs-string">"responsibleTeam"</span></span>).get(<span class="hljs-string"><span class="hljs-string">"title"</span></span>));</code> </pre><br><blockquote>  <b>Note:</b> Our application has an asynchronous interface;  in the community of automators, they write a lot about the problems with the expectation of the appearance of elements;  Significantly accelerates the testing process. </blockquote><br>  The second and third phases can pass without using a browser, such as almost a hundred API tests. <br><blockquote>  <b>Note:</b> Someone should have a thought: is <i>n‚Äôt too much attention paid to testing through the UI and on a raised application?</i> <br>  I will answer: the feature of our software is the high complexity of not individual functions, but business logic.  Almost every test requires a database and a large context.  In this case, unit-tests are not much gain in time and significantly lose on the complexity of writing. </blockquote><br><br><h5>  The second circle.  Environment test </h5><br>  Before each launch of the testing system: <br><ul><li>  check the availability of the system and the ability to log into it </li><li>  check the global system settings and, if necessary, set the required values </li></ul><br>  Before each class with tests <br><ul><li>  restart the browser </li><li>  check the availability of the system </li></ul><br>  After each test: <br><ul><li>  we delete all the objects created by him - this is necessary to maintain the speed of the system and isolate the tests.  When created, objects are queued and deleted in the reverse order. </li></ul><br><br><h5>  The third circle is the test hierarchy. </h5><br><img src="https://habrastorage.org/storage2/23a/b54/a9d/23ab54a9dacf9f2cd299303c654d6b43.png" align="left"><br><ul><li>  One test - one action.  Exceptions not more than 5% </li><li>  Tests are combined into classes of 3-10 pieces, they test the business requirement </li><li>  5-15 classes are combined in packages.  Package tests the essence or aspect of the application </li><li>  Packages 15 </li></ul><br><br><blockquote>  <b>Note:</b> <a href="http://maven.apache.org/plugins/maven-javadoc-plugin/">Javadoc</a> , going to the team <pre> <code class="bash hljs">mvn -f sdng-inttest/pom.xml javadoc:<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>-javadoc -e</code> </pre> <br>  It helps manual testers and PMAs to find out what tests are, allows not to search for git in the web-based interface and not to install an IDE. <br><div class="spoiler">  <b class="spoiler_title">The root looks like this:</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/3f6/da3/afc/3f6da3afc5e28f356bfd3387b8c86a45.png"></div></div><br></blockquote><br><br><h5>  Circle four - the organization of the project testing system. </h5><br><img src="https://habrastorage.org/storage2/42e/a33/5fe/42ea335fefe00ae0561e9c7f215a7af0.png" align="left"><br>  60,000 lines of testing system code <br><ul><li>  Test code </li><li>  Utility domain methods: DSL code (work with the system under test) and DAO (work with models) </li><li>  Utility methods that are not tied to the application under test - work with strings, files, JSON, etc. </li><li>  The core of the testing system: logs, screenshots, cleaning, interface to the webdriver, the exception mechanism. </li></ul><br><br><blockquote>  <b>Note:</b> This is how the browser settings for tests look, I hope someone will be useful: <br><div class="spoiler">  <b class="spoiler_title">Firefox profile</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/** *  Firefox . * http://code.google.com/p/selenium/wiki/FirefoxDriver * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment">    FirefoxDriver,   WebDriver. * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@exception</span></span></span><span class="hljs-comment"> WebDriverException    . */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> WebDriver </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openFirefox</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ FirefoxProfile firefoxProfile = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FirefoxProfile(); <span class="hljs-comment"><span class="hljs-comment">//   firefoxProfile.setPreference("browser.sessionhistory.max_total_viewer", "1"); // 3   ,     firefoxProfile.setPreference("browser.sessionhistory.max_entries", 3); firefoxProfile.setPreference("browser.sessionhistory.max_total_viewers", 1); firefoxProfile.setPreference("browser.sessionstore.max_tabs_undo", 0); //    firefoxProfile.setPreference("network.http.pipelining", true); firefoxProfile.setPreference("network.http.pipelining.maxrequests", 8); //  firefoxProfile.setPreference("nglayout.initialpaint.delay", "0"); //    firefoxProfile.setPreference("browser.download.manager.scanWhenDone", false); //   firefoxProfile.setPreference("browser.tabs.animate", false); // firefoxProfile.setPreference("browser.search.suggest.enabled", false); //  firefoxProfile.setPreference("image.animation_mode", "none"); //   firefoxProfile.setPreference("browser.bookmarks.max_backups", 0); // firefoxProfile.setPreference("browser.formfill.enable", false); //       //firefoxProfile.setPreference("browser.cache.memory.enable", false); firefoxProfile.setPreference("browser.cache.disk.enable", false); //     tslogs firefoxProfile.setPreference("browser.download.folderList", 2); firefoxProfile.setPreference("browser.download.manager.showWhenStarting", false); firefoxProfile.setPreference("browser.download.dir", new File("").getAbsolutePath()); firefoxProfile.setPreference("browser.helperApps.neverAsk.saveToDisk", "application/xml,application/pdf,application/zip,text/plain,application/vnd.ms-excel"); return new FirefoxDriver(firefoxProfile); }</span></span></code> </pre></div></div></blockquote><br>  We also have such a wonderful thing as unit tests for the core of the testing system. <br><blockquote>  <b>Note: The</b> testing system has been living for a year and a half, survived the move from svn to git, 300 commits, therefore 100 unit tests are vital </blockquote><br>  The two main usage scenarios are run from Jenkins and from eclipse. <br>  Algorithm of work with launch configuration: <br><ol><li>  Test system settings transmitted from maven - the highest priority.  We write them to the config.  If there is no config, then create. </li><li>  The remaining settings are taken from the config.  If there is no config, then by default. </li><li>  Thus, the developers of the application and tests set up their personal config, and in CI, all the necessary parameters are passed through maven. </li></ol><br><div class="spoiler">  <b class="spoiler_title">My configuration file:</b> <div class="spoiler_text"><pre> <code class="bash hljs">allowscreenshot=<span class="hljs-literal"><span class="hljs-literal">true</span></span> needinit=<span class="hljs-literal"><span class="hljs-literal">true</span></span> superlogin=naumen allowsaveconfig=<span class="hljs-literal"><span class="hljs-literal">true</span></span> clickertime=3600000 testerpassword=atpassword testerlogin=atlogin superpassword= needdelete=<span class="hljs-literal"><span class="hljs-literal">true</span></span> webaddress=http://localhost:9090/sd/ browsertype=firefox</code> </pre><br></div></div><br><br><blockquote>  <b>Note:</b> The vehicle is all grown-up - it has its own statements and usage scenarios. <br>  ‚ÄúAs an auto tester, I want to be able to run a testing application on a local computer in order to perform certain tests on a local or client stand, to further analyze the data obtained, or to develop new tests.‚Äù <br>  ‚ÄúAs a developer, I want the TS to check the project after each change, in order to identify problems and errors in a timely manner. <br>  And so on. </blockquote><br><br>  We perform balancing of tests for their parallelization in a rather ugly way. <br><div class="spoiler">  <b class="spoiler_title">Startup profile in pom.xml</b> <div class="spoiler_text"><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">profile</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>smoke-snap2-branch<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>integration-tests<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">excludes</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">exclude</span></span></span><span class="hljs-tag">&gt;</span></span>all<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">exclude</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">excludes</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">includes</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">include</span></span></span><span class="hljs-tag">&gt;</span></span>**/selenium/**/advlist/*Test.java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">include</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">include</span></span></span><span class="hljs-tag">&gt;</span></span>**/selenium/**/bo/*Test.java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">include</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">include</span></span></span><span class="hljs-tag">&gt;</span></span>**/selenium/**/advimport/*Test.java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">include</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">include</span></span></span><span class="hljs-tag">&gt;</span></span>**/selenium/**/user/*Test.java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">include</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">include</span></span></span><span class="hljs-tag">&gt;</span></span>**/selenium/**/rights/*Test.java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">include</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">includes</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">profile</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  There are several such profiles for which packages are manually broken. <br><br><h5>  The fifth circle.  Source Code Management. </h5><br>  We use this git branching model as the most appropriate for our needs. <br><blockquote>  <b>Note:</b> Tests are in the same place as the application code.  Thus, uncoupling the branch, the developer unhooks the test code as well, this ensures the synchronization of the tests and the application.  Even to this obvious decision, we did not come immediately. </blockquote><br><br><h5>  The sixth circle.  Separate build in CI Jenkins. </h5><br>  Assembly begins with a description.  I believe that the rules should be as close as possible to the place of their application.  Immediately - useful links. <br><div class="spoiler">  <b class="spoiler_title">Look</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/509/c44/036/509c440368a58264c9e2cdee693c3d9b.png"></div></div><br><br>  Useful plugins to customize builds: <br><ul><li>  <a href="https://wiki.jenkins-ci.org/display/JENKINS/Clone%2BWorkspace%2BSCM%2BPlugin">Clone Workspace</a> , which allows you to avoid desynchronization, when between compiling code in the parent assembly and running tests in a child, someone made a commit. </li><li>  <a href="https://wiki.jenkins-ci.org/display/JENKINS/Xvfb%2BPlugin">Xvfb</a> is a virtual screen. </li></ul><br><br>  Running tests: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> DISPLAY=<span class="hljs-string"><span class="hljs-string">'localhost:'</span></span><span class="hljs-variable"><span class="hljs-variable">$DISPLAY_NUM</span></span><span class="hljs-string"><span class="hljs-string">'.0'</span></span>; mvn verify -P war-deploy,<span class="hljs-variable"><span class="hljs-variable">$TEST_PROFILE</span></span> -Dext.prop.dir=<span class="hljs-variable"><span class="hljs-variable">$WORKSPACE</span></span>/<span class="hljs-variable"><span class="hljs-variable">$PROP_DIR</span></span> -Dwebaddress=http://localhost:<span class="hljs-variable"><span class="hljs-variable">$DEPLOY_PORT</span></span>/sd -Dselenium.deploy.port=<span class="hljs-variable"><span class="hljs-variable">$DEPLOY_PORT</span></span> -Dcargo.tomcat.ajp.port=<span class="hljs-variable"><span class="hljs-variable">$ARJ_PORT</span></span> -Dcargo.rmi.port=<span class="hljs-variable"><span class="hljs-variable">$RMI_PORT</span></span></code> </pre><br>  where war-deploy profile is raising an application using <a href="http://cargo.codehaus.org/Maven2%2Bplugin">maven-cargo-plugin</a> <br><br>  Post-assembly operations. <br><ul><li>  Archive artifacts, save prints </li><li>  <a href="https://wiki.jenkins-ci.org/display/JENKINS/Instant%2BMessaging%2BPlugin">Jabber</a> and <a href="https://wiki.jenkins-ci.org/display/JENKINS/Email-ext%2Bplugin">email notification</a> </li><li>  <a href="https://wiki.jenkins-ci.org/display/JENKINS/Blame%2BUpstream%2BCommitters%2BPlugin">Blame Upstream Committers</a> allows you to send letters to the committers of the parent assembly. </li></ul><br><br><h5>  The seventh circle.  Assembly hierarchy. </h5><br>  A group of assemblies that provides services to programmers is called a <i>branch.</i> <br><img src="https://habrastorage.org/storage2/00b/b93/472/00bb934722997db0d296a55d40588e8c.png"><br>  Parent assembly - compile the project. <br>  Second level child builds are unit tests for postgresql, mssql, oracle;  static code analysis (CPD, PMD, findbugs);  build war file (under one browser to save time) for UI tests. <br>  The third level - UI tests in three streams and tests for migration. <br><br><div class="spoiler">  <b class="spoiler_title">Typical third branch</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/327/c87/41b/327c8741bdc756ae0eddbb607dcea05d.png"></div></div><br><blockquote>  <b>Note:</b> Build migration testing is a simple and effective test in which we take backup of an ancient database with data and go up to the last war file.  Allows you to make sure that all data migrations are completed and the application is upgraded to a non-empty database. </blockquote><br><br><h5>  Eighth round, continuous integration system level </h5><br>  Our CI is 4 branches in which programmers can run tests by manually starting and pointing to their branch.  And one main branch running on a commit to develop differs from the others with the presence of test builds on all supported DBMSs.  Not earlier than two weeks ago, each branch was located on a separate server (we chose <a href="http://www.hetzner.de/hosting/produkte_rootserver/ex4">EX4</a> , since we do not need reliability, but the processor speed is critical; experiments showed that the three Jenkins nodes per server are optimal).  After reconfiguring virtual screens, ports, and DBMS settings, we now have a common node space. <br><div class="spoiler">  <b class="spoiler_title">Download schedule looks like this:</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/83c/b5b/941/83cb5b94103769d1ce8b82ab17e75ae6.png"></div></div><br><br>  <a href="https://wiki.jenkins-ci.org/display/JENKINS/Promoted%2BBuilds%2BPlugin">Jenkins promoted builds plugin</a> , allowing you to draw beautiful stars for assemblies, all of whose daughters passed without fallen tests.  It turned out to be more useful than three hundred tests through the interface or a thousand unit tests.  Before him, some irresponsible PMs released releases, despite the presence of fallen tests, persuasion and threats did not help.  But as soon as each build has asterisks - the first signal system worked and once every two weeks the leitmotif of the day - <i>wait for two stars</i> .  This resulted in increased demands on the speed of error correction by programmers and on the quality of the code of the testing system ‚Äî random triggers now cost more. <br><div class="spoiler">  <b class="spoiler_title">PMs are meditating on this picture on the day of release.</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/eba/e9b/edf/ebae9bedf487b6dd73ad9120e79e58a3.png"></div></div><br><br>  The assembly using the <a href="https://wiki.jenkins-ci.org/display/JENKINS/Performance%2BPlugin">Performance Plugin</a> - monitoring the performance of typical operations, allows you to quickly find the worst errors related to system performance. <br><div class="spoiler">  <b class="spoiler_title">The result looks like this:</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/f10/e95/dd4/f10e95dd43aece6dc0b0312f25f44f91.png"></div></div><br><br>  In the development of the assembly, automatically conducting a full load testing.  But this is a topic for a separate article. <br><br><blockquote>  <b>Note:</b> Some more useful stuff: <br><ul><li>  <a href="https://wiki.jenkins-ci.org/display/JENKINS/Parameterized%2BTrigger%2BPlugin">Parameterized Trigger Plugin</a> - if you have a complicated build hierarchy. </li><li>  <a href="https://wiki.jenkins-ci.org/display/JENKINS/JobConfigHistory%2BPlugin">JobConfigHistory Plugin</a> - works wonders with LDAP. </li><li>  <a href="https://wiki.jenkins-ci.org/display/JENKINS/Configuration%2BSlicing%2BPlugin">Configuration Slicing Plugin</a> - if you have more than 50 almost different assemblies. </li><li>  <a href="https://wiki.jenkins-ci.org/display/JENKINS/Rebuild%2BPlugin">Rebuild Plugin is</a> just a useful thing. </li><li>  <a href="https://wiki.jenkins-ci.org/display/JENKINS/The%2BContinuous%2BIntegration%2BGame%2Bplugin">The Continuous Integration Game plugin</a> - my group always wins, as we only do what we write tests. </li></ul></blockquote><br><br><h5>  Round nine, people and processes. </h5><br>  The most difficult thing in automated testing is to get a good case.  It takes up to half the time.  The main supplier is manual testers, we eat their cases and ask for more, but they have lots of other interesting work.  Therefore, we write tests for defects, and in general each performed task in JIRA passes through my gaze - is it possible to write a test for it?  We also have an <a href="https://wiki.jenkins-ci.org/display/JENKINS/Emma%2BPlugin">Emma Plugin</a> and three build counting builds - for uint tests, for UI tests and total.  According to these reports, we write tests on the system API.  But for the rest of the functionality, the report on coverage does not have any value - the specificity of our software is such that you need to focus on covering tests with not code, but requirements. <br><div class="spoiler">  <b class="spoiler_title">Simple coverage schedule</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/52d/6b4/574/52d6b45740c1bee58fed6343c89cbd0c.png"></div></div><br><br>  Development of features in the context of automated testing looks like this: <br>  Unhook the git branch.  Write feature code.  Run tests in the branch.  Fix tests in the thread.  Get two stars.  Drain with develop. <br><br>  The principle that slowed down the speed of development, increased the readiness of the code for release and saved a lot of time for my group: <br>  <i>The programmer has the moral right to commit, the assembly of testing in the branches of which received two stars.</i> <br>  If the programmer uncoupled from the commit in which all tests passed, then his commit should have the same property. <br>  At first, the principle was reinforced by a revert of commits and a ban on commits in develop. <br><br>  This development process has imposed a limit on the total time for passing all tests - 2 hours.  We do not have nightly tests and tests running on weekends, absolutely all tests pass a maximum of 2 hours.  The automated testing group for the last six months worked in the following mode: <br>  <i>Write tests up to 2 hours - buy servers and parallelize - write tests up to 2 hours - optimize test code - write tests up to 2 hours - change servers for faster - write tests ...</i> <br><br><h4>  Afterword </h4><br>  All that I have said is not my merit.  My contribution to the test code is a third of the lines.  In CI - a quarter of configs.  Two dozen people worked on the testing and continuous integration system - from technical support and testers to development managers and analysts. <br><br>  I want to hear from you not only questions, but also wise advice, useful settings and cool ideas.  Just remember about my role in the project - I can change anything in the code, a lot of things in CI, something in the processes.  People I can not change. <br><br>  If there is a willing not only to give valuable guidance, but for example, learn how to do it all yourself - or teach me how to work properly - welcome to the PM, I'm looking for a colleague. </div><p>Source: <a href="https://habr.com/ru/post/168451/">https://habr.com/ru/post/168451/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../168441/index.html">Announced stable release of MySQL 5.6</a></li>
<li><a href="../168443/index.html">Australian court decided that Google is not responsible for advertising on its pages.</a></li>
<li><a href="../168445/index.html">Has the government refused to build the Death Star? Well, we have a kickstarter!</a></li>
<li><a href="../168447/index.html">HP Board of Directors is considering dividing a company</a></li>
<li><a href="../168449/index.html">How much is a second wait</a></li>
<li><a href="../168453/index.html">Games for programmers</a></li>
<li><a href="../168455/index.html">NetWrix Account Lockout Examiner is now free.</a></li>
<li><a href="../168457/index.html">Notch earned 101 million USD for 2012 on Minecraft licenses, now slightly confused</a></li>
<li><a href="../168459/index.html">For bills abroad - a fine of up to 100%</a></li>
<li><a href="../168461/index.html">Why does Google add while (1); to your JSON responses?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>