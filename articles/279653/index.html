<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>2.2 Streams</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="From the translator: This article is the seventh in the translation cycle of the official SFML library guide. Past article can be found here. This ser...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>2.2 Streams</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/bc7/94a/b37/bc794ab377be444f8090426e56ae38bd.png"><br><br>  <i>From the translator: This article is the seventh in the translation cycle of the official SFML library guide.</i>  <i>Past article can be found <a href="https://habrahabr.ru/post/279347/" title="Previous article: Time Processing">here.</a></i>  <i>This series of articles aims to provide people who do not know the original language the opportunity to get acquainted with this library.</i>  <i>SFML is a simple and cross-platform multimedia library.</i>  <i>SFML provides a simple interface for developing games and other multimedia applications.</i>  <i>The original article can be found <a href="http://www.sfml-dev.org/tutorials/2.3/system-thread.php" title="Original article: Threads">here</a> .</i>  <i>Let's start.</i> <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Table of contents:</b> <div class="spoiler_text">  0.1 Introduction <br><br>  1. Getting Started 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  <a href="https://habrahabr.ru/post/278977/" title="Go to the article: SFML and Visual Studio">SFML and Visual Studio</a> </li><li>  <a href="https://habrahabr.ru/post/279069/" title="Go to Article: SFML and Code :: Blocks (MinGW)">SFML and Code :: Blocks (MinGW)</a> </li><li>  <a href="https://habrahabr.ru/post/279107/" title="Go to Article: SFML and Linux">SFML and Linux</a> </li><li>  <a href="https://habrahabr.ru/post/279147/" title="Go to Article: SFML and Xcode (Mac OS X)">SFML and Xcode (Mac OS X)</a> </li><li>  <a href="https://habrahabr.ru/post/279279/" title="Go to Article: Compiling SFML with CMake">Compiling SFML with CMake</a> </li></ol><br>  2. System Module <br><br><ol><li>  <a href="https://habrahabr.ru/post/279347/" title="Go to article: Processing Time">Processing time</a> </li><li>  <a href="https://habrahabr.ru/post/279653/" title="Go to article: Streams">Streams</a> </li><li>  <a href="https://habrahabr.ru/post/279689/" title="Go to article: Working with custom data streams">Work with custom data streams</a> </li></ol><br>  3. Window Module <br><br><ol><li>  <a href="https://habrahabr.ru/post/279957/" title="Go to Article: Opening and Managing Windows">Opening and managing windows</a> </li><li>  <a href="https://habrahabr.ru/post/280153/" title="Go to article: Event Handling">Event handling</a> </li><li>  Work with the keyboard, mouse and joysticks </li><li>  Using OpenGL </li></ol><br>  4. Graphics Module <br><br><ol><li>  Drawing 2D objects </li><li>  Sprites and textures </li><li>  Text and Fonts </li><li>  Forms </li><li>  Designing your own objects using arrays of vertices </li><li>  Position, Rotation, Scale: Transform Objects </li><li>  Adding special effects with shaders </li><li>  2D camera control and view </li></ol><br>  5. Audio module <br><br><ol><li>  Playing sounds and music </li><li>  Audio recording </li><li>  Custom audio streams </li><li>  Spitalization: sounds in 3D </li></ol><br>  6. Network module <br><br><ol><li>  Socket communication </li><li>  Use and Expansion Packages </li><li>  Web requests using HTTP </li><li>  File Transfer Using FTP </li></ol><br></div></div><br><h2>  What is a thread? </h2><br>  Most of you already know what a stream is, but we will explain what it is for newcomers to this topic. <br><br>  A thread is essentially a sequence of instructions that are executed in parallel with other threads.  Each program creates at least one thread: the main one, which runs the main () function.  A program that uses only the main thread is single-threaded;  if you add one or more threads, it becomes multi-threaded. <br><br>  So, in short, threads are a way to do several things at once.  This can be useful, for example, for displaying animations and processing user input while loading images or sounds.  Flows are also widely used in network programming, while waiting for data to be received, the application will continue to be updated and drawn. <br><br><h2>  SFML or std :: thread threads? </h2><br>  In its latest version (2011), the standard C ++ library provides a <a href="http://en.cppreference.com/w/cpp/thread" title="C ++ 11 stream classes">set of classes for working with streams</a> .  At the time of writing SFML, the C ++ 11 standard was not yet written and there was no standard way to create threads.  When SFML 2.0 was released, there were many compilers that did not support this new standard. <br><br>  If you are working with a compiler that supports the new standard and contains a header file, forget about the SFML stream classes and use the standard C ++ classes instead.  But, if you work with a compiler that does not support this standard, or plan to distribute your code and want to achieve full portability, the SFML stream classes are a good choice. <br><br><h2>  Creating streams using SFML </h2><br>  Enough talk, let's look at the code.  The class that makes it possible to create threads using SFML is called <a href="http://www.sfml-dev.org/documentation/2.3/classsf_1_1Thread.php" title="Documentation for sf :: thread">sf :: Thread</a> , and this is how (thread creation) looks like in action: <br><br><pre><code class="hljs swift">#include &lt;<span class="hljs-type"><span class="hljs-type">SFML</span></span>/<span class="hljs-type"><span class="hljs-type">System</span></span>.hpp&gt; #include &lt;iostream&gt; void <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">//      thread.launch() for (int i = 0; i &lt; 10; ++i) std::cout &lt;&lt; "I'm thread number one" &lt;&lt; std::endl; } int main() { //     func     sf::Thread thread(&amp;func); //   thread.launch(); //     ... for (int i = 0; i &lt; 10; ++i) std::cout &lt;&lt; "I'm the main thread" &lt;&lt; std::endl; return 0; }</span></span></code> </pre> <br>  In this code, the functions main and func are executed in parallel after calling thread.launch ().  The result of this is that the text displayed by both functions is mixed in the console. <br><br><img src="https://habrastorage.org/files/3f0/c79/e9c/3f0c79e9cf104bd2990a238986b561cc.png"><br><br>  The entry point into the stream, i.e.  the function that will be executed when the thread starts must be passed to the <a href="http://www.sfml-dev.org/documentation/2.3/classsf_1_1Thread.php" title="Documentation for sf :: thread">sf :: Thread</a> constructor.  <a href="http://www.sfml-dev.org/documentation/2.3/classsf_1_1Thread.php" title="Documentation for sf :: thread">sf :: Thread</a> tries to be flexible and accept various entry points: non-member functions or class methods, functions with or without arguments, functors, and so on.  The above example shows how to use a member function, here are a few other examples. <br><br><ul><li>  non-member function with one argument: <br><br><pre> <code class="hljs go">void <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x)</span></span></span></span> { } sf::Thread thread(&amp;<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function">, 5);</span></span></code> </pre></li><li>  class method: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">class</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MyClass</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">public</span></span>: void <span class="hljs-built_in"><span class="hljs-built_in">func</span></span>() { } }; <span class="hljs-selector-tag"><span class="hljs-selector-tag">MyClass</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">object</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">sf</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">::Thread</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">thread</span></span>(&amp;<span class="hljs-selector-tag"><span class="hljs-selector-tag">MyClass</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">::func</span></span>, &amp;<span class="hljs-selector-tag"><span class="hljs-selector-tag">object</span></span>);</code> </pre></li><li>  functor (functional object): <br><br><pre> <code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyFunctor</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">operator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } }; sf::<span class="hljs-function"><span class="hljs-function">Thread </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">thread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MyFunctor())</span></span></span></span>;</code> </pre></li></ul><br>  The last example that the functor uses is the most powerful because it can accept any type of functor and therefore makes the <a href="http://www.sfml-dev.org/documentation/2.3/classsf_1_1Thread.php" title="Documentation for sf :: thread">sf :: Thread</a> class compatible with many types of functions that are not directly supported.  This function is especially interesting with C ++ 11 lambda expressions or std :: bind. <br><br><pre> <code class="hljs objectivec"><span class="hljs-comment"><span class="hljs-comment">//  - sf::Thread thread([](){ std::cout &lt;&lt; "I am in thread!" &lt;&lt; std::endl; });</span></span></code> </pre><br><pre> <code class="hljs pgsql">//  std::bind <span class="hljs-type"><span class="hljs-type">void</span></span> func(std::string, <span class="hljs-type"><span class="hljs-type">int</span></span>, <span class="hljs-type"><span class="hljs-type">double</span></span>) { } sf::Thread thread(std::bind(&amp;func, "hello", <span class="hljs-number"><span class="hljs-number">24</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span>));</code> </pre><br>  If you want to use <a href="http://www.sfml-dev.org/documentation/2.3/classsf_1_1Thread.php" title="Documentation for sf :: thread">sf :: Thread</a> inside a class, do not forget that it does not have a standard constructor.  Therefore, you must initialize it in the constructor of your class in the initialization list: <br><br><pre> <code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ClassWithThread</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: ClassWithThread() : m_thread(&amp;ClassWithThread::f, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) { } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... } sf::Thread m_thread; };</code> </pre><br>  If you really need to create an instance of <a href="http://www.sfml-dev.org/documentation/2.3/classsf_1_1Thread.php" title="Documentation for sf :: thread">sf :: Thread</a> after initializing an object, you can create it in a heap. <br><br><h2>  Start stream </h2><br>  After you have created an instance of <a href="http://www.sfml-dev.org/documentation/2.3/classsf_1_1Thread.php" title="Documentation for sf :: thread">sf :: Thread</a> , you must start it by running the function. <br><br><pre> <code class="hljs swift">sf::<span class="hljs-type"><span class="hljs-type">Thread</span></span> thread(&amp;<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">thread</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">launch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>;</code> </pre><br>  A launch invokes a function that you passed to the constructor of a new thread, and immediately ends its work, so that the calling thread can immediately continue execution. <br><br><h2>  Stop threads </h2><br>  The thread automatically terminates when the function that serves as the entry point for the stream returns its value.  If you want to wait for the completion of a thread from another thread, you can call its wait function. <br><br><pre> <code class="hljs swift">sf::<span class="hljs-type"><span class="hljs-type">Thread</span></span> thread(&amp;<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function">); //   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">thread</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">launch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; ... <span class="hljs-comment"><span class="hljs-comment">//     ,     thread.wait();</span></span></code> </pre><br>  The wait function is also implicitly called by the <a href="http://www.sfml-dev.org/documentation/2.3/classsf_1_1Thread.php" title="Documentation for sf :: thread">sf :: Thread</a> destructor, so the thread cannot remain started (and uncontrolled) after its <a href="http://www.sfml-dev.org/documentation/2.3/classsf_1_1Thread.php" title="Documentation for sf :: thread">sf :: Thread</a> instance is destroyed.  Remember this when you manage your streams (see the last section of the article). <br><br><h2>  Pause flow </h2><br>  There is no function in SFML that provides a way to pause a thread;  The only way to pause a thread is to do it from the code of the thread itself.  In other words, you can only pause the current thread.  To do this, you can call the sf :: sleep function: <br><br><pre> <code class="hljs swift">void <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { ... sf::sleep(sf::milliseconds(<span class="hljs-number"><span class="hljs-number">10</span></span>)); ... }</code> </pre><br>  sf :: sleep has one argument ‚Äî the pause time.  This time can be expressed in any unit, as was shown in the article about <a href="https://habrahabr.ru/post/279347/" title="Go to article: Processing Time">processing time</a> . <br><br>  Note that you can pause any thread with this function, even the main thread. <br><br>  sf :: sleep is the most effective way to suspend a thread: during the suspension of the thread, it (the stream) consumes almost no CPU resources.  Suspending, based on active waiting, like an empty while loop, consumes 100% of CPU resources and does ... nothing.  However, keep in mind that the duration of the suspension is just a hint;  the actual duration of the suspension (more or less than the time you specify) depends on the OS.  So do not rely on this feature with a very accurate countdown. <br><br><h2>  Shared Data Protection </h2><br>  All threads in the program share some memory, they have access to all variables in their scope.  This is very convenient, but also dangerous: since the parallel start of a thread, variables or functions can be used simultaneously by different threads.  If the operation is not thread safe, it can lead to undefined behavior (i.e., it can lead to data failure or corruption). <br><br>  There are several software tools that can help you protect shared data and make your code thread-safe, they are called synchronization primitives.  The most common are the following primitives: mutexes, semaphores, conditional variables, and spinlocks.  All of them are variants of the same concept: they protect a piece of code, giving only a certain stream the right to access data and block others. <br><br>  The most common (and used) primitive is a mutex.  Mutex stands for Mutual Exclusion.  This is a guarantee that only one thread can execute code.  Let's see how mutexes work, using the example below: <br><br><pre> <code class="hljs go">#include &lt;SFML/System.hpp&gt; #include &lt;iostream&gt; sf::Mutex mutex; void <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { mutex.lock(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; ++i) std::cout &lt;&lt; <span class="hljs-string"><span class="hljs-string">"I'm thread number one"</span></span> &lt;&lt; std::endl; mutex.unlock(); } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> main() { sf::Thread thread(&amp;<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">thread</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">launch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mutex</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i = 0; i &lt; 10; ++i)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">std</span></span></span><span class="hljs-function">::</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cout</span></span></span><span class="hljs-function"> &lt;&lt; "</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">I</span></span></span><span class="hljs-function">'</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">m</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">thread</span></span></span><span class="hljs-function">" &lt;&lt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">std</span></span></span><span class="hljs-function">::</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endl</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mutex</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unlock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-function"> 0; }</span></span></code> </pre><br>  This code uses a shared resource (std :: cout), and, as we can see, this leads to undesirable results.  Output streams mixed in console.  To ensure that the output prints correctly, instead of being randomly mixed, we protect the relevant areas of the code with a mutex. <br><br>  The first thread that reaches the mutex.lock () call blocks the mutex and gains access to the code that prints the text.  When other threads reach the mutex.lock () call, the mutex is already locked, and other threads suspend their execution (this is similar to the sf :: sleep call, the sleep thread does not consume CPU time).  When the first thread unlocks the mutex, the second thread continues its execution, locks the mutex and prints the text.  This leads to the fact that the text in the console is printed sequentially and does not mix. <br><br><img src="https://habrastorage.org/files/ef7/ce1/063/ef7ce1063ad547c6bff8dcec20a494aa.png"><br><br>  A mutex is not only a primitive that you can use to protect shared data, you can use it in many other cases.  However, if your application does complex things when working with threads, and you feel that the capabilities of mutexes are not enough - do not hesitate to look for another library with more functionality. <br><br><h2>  Mutex Protection </h2><br>  Do not worry: mutexes are already thread-safe, there is no need to protect them.  But they are not safe in terms of exceptions.  What happens if an exception is thrown when the mutex is locked?  It can never be unlocked and will remain locked forever.  All threads trying to unlock a locked mutex will be blocked forever.  In some cases, your application will be "frozen." <br><br>  To ensure that a mutex is always unlocked in an environment in which it (the mutex) can throw an exception, SFML provides a RAII class that allows you to wrap the mutex into the sf :: Lock class.  The lock occurs in the constructor, unlocking occurs in the destructor.  Simple and effective. <br><br><pre> <code class="hljs cpp">sf::Mutex mutex; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ sf::<span class="hljs-function"><span class="hljs-function">Lock </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mutex)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">// mutex.lock() functionThatMightThrowAnException(); // mutex.unlock(),     } // mutex.unlock()</span></span></code> </pre><br>  Remember that sf :: Lock can also be used in functions that have multiple return values. <br><br><pre> <code class="hljs ruby">sf::Mutex mutex; bool func() { sf::Lock lock(mutex); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> mutex.lock() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!image1.loadFromFile(<span class="hljs-string"><span class="hljs-string">"..."</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> mutex.unlock() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!image2.loadFromFile(<span class="hljs-string"><span class="hljs-string">"..."</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> mutex.unlock() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!image3.loadFromFile(<span class="hljs-string"><span class="hljs-string">"..."</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> mutex.unlock() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } /<span class="hljs-regexp"><span class="hljs-regexp">/ mutex.unlock()</span></span></code> </pre><br><h2>  Common Misconceptions </h2><br>  A thing that is often overlooked: a thread cannot exist without a corresponding <a href="http://www.sfml-dev.org/documentation/2.3/classsf_1_1Thread.php" title="Documentation for sf :: thread">sf :: Thread</a> instance.  The following code can often be seen on the forums: <br><br><pre> <code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startThread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ sf::<span class="hljs-function"><span class="hljs-function">Thread </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">thread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(&amp;funcToRunInThread)</span></span></span></span>; thread.launch(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ startThread(); <span class="hljs-comment"><span class="hljs-comment">// ... return 0; }</span></span></code> </pre><br>  Programmers who write such code expect the startThread () function to start a thread that will live on its own and be destroyed when the function completes (passed as an entry point).  This is not happening.  The thread function blocks the main thread, as if the program were not running. <br><br>  What's the matter?  The <a href="http://www.sfml-dev.org/documentation/2.3/classsf_1_1Thread.php" title="Documentation for sf :: thread">sf :: Thread</a> instance is local to the startThread () function, so it is immediately destroyed when the function returns its value.  The <a href="http://www.sfml-dev.org/documentation/2.3/classsf_1_1Thread.php" title="Documentation for sf :: thread">sf :: Thread</a> destructor is called, wait () is called, as stated above, the result is a blocking of the main thread, which waits for the thread function to complete, instead of executing it in parallel. <br><br>  So do not forget: you must manage the <a href="http://www.sfml-dev.org/documentation/2.3/classsf_1_1Thread.php" title="Documentation for sf :: thread">sf :: Thread</a> instances so that they live as long as the thread functions are required. <br><br>  Next article: <a href="https://habrahabr.ru/post/279689/" title="Go to article: Working with custom data streams">Working with custom data streams</a> . </div><p>Source: <a href="https://habr.com/ru/post/279653/">https://habr.com/ru/post/279653/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../279639/index.html">What can flog whips in the digital age? How does GitHub comply with DMCA, RFC 7725 and what is HTTP 451?</a></li>
<li><a href="../279641/index.html">Dagger 2. Part Two. Custom scopes, Component dependencies, Subcomponents</a></li>
<li><a href="../279645/index.html">Weekly assembly Vivaldi 1.0.425.3 with a surprise</a></li>
<li><a href="../279647/index.html">Generation and visualization of multidimensional data with R</a></li>
<li><a href="../279651/index.html">Algorithms are just one of the variables in the equation.</a></li>
<li><a href="../279655/index.html">The source code of the compact hypervisor is published on GitHub.</a></li>
<li><a href="../279657/index.html">man! (Go => D) .basics</a></li>
<li><a href="../279659/index.html">Quick launch and use of your open docker-registry</a></li>
<li><a href="../279661/index.html">woSign continued Chinese freebies (though not as big as before)</a></li>
<li><a href="../279663/index.html">How ITMO students create robots</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>