<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Rollback in Cisco IOS XR</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Anyone who has ever encountered the need to make changes to the configuration of Cisco equipment running IOS XR knows that, unlike the usual IOS, IOS-...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Rollback in Cisco IOS XR</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/9d4/34f/7c6/9d434f7c608545a3aeb1744c56916053.gif" alt="image alt"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/6e5/7af/989/6e57af9891074df88c78f8d83d129fe7.png" alt="image alt"></div><br>  Anyone who has ever encountered the need to make changes to the configuration of Cisco equipment running IOS XR knows that, unlike the usual IOS, IOS-XR requires a commit to apply the configuration.  But how to commit the config, I think that everyone who has experienced the iOS XR at least once in their lives knows.  But how to roll back the config?  On JunOS, everything is easy and understandable, which cannot be said about iOS XR.  Until a certain time, I did not know this, but one night I had only 5 minutes to learn this, roll back the config and not get an accident.  I didn‚Äôt find anything in the network except for the manual of Ziska itself in English, so I decided to write a small educational program on this topic, maybe someone could use it. <br><br>  So let's go ... <br><a name="habracut"></a><br><blockquote>  Note: although the article is intended for novice engineers, it may be useful for engineers, who are familiar with iOS XR.  As they say, live and learn. </blockquote><br>  To begin with - as an introduction - I will briefly describe the process of applying the configuration on IOS XR to those who are not familiar with it (IOS XR).  Suppose that we want to add a descriptor to the config: <br><br><pre><code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE4(config)#interface gigabitEthernet <span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span> description <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW5"</span></span> RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE4(config)#show Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">11.950</span></span> UTC Building configuration... !! IOS XR Configuration <span class="hljs-number"><span class="hljs-number">5.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span> description <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW5"</span></span> ! end</code> </pre> <br>  On an ordinary IOS, everything is simple - they added something to the config - the changes were immediately applied.  On iOS XR, until we make a commit, the changes will not apply: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE4(config)#<span class="hljs-keyword"><span class="hljs-keyword">do</span></span> sh run int gi0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span> description Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">09.346</span></span> UTC % No such configuration item(s)</code> </pre> <br>  Make a commit: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE4(config)#commit comment add desc int ge0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span> Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">43.443</span></span> UTC</code> </pre> <br>  Now everything is in order, the configuration changes have been applied: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE4(config)#<span class="hljs-keyword"><span class="hljs-keyword">do</span></span> sh run int gi0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span> description Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">48.353</span></span> UTC interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span> description <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW5"</span></span> ! end</code> </pre> <br>  As you can see from the above conclusions, I made a comment on the commit.  This is very helpful when searching for a configuration to roll back to. <br><br>  Now let's go directly to the rollbacks themselves.  To roll back the configuration, you can use the following command: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE4#rollback configuration ? last Rollback last &lt;n&gt; commits made to Rollback up to (and including) a specific commit to-exclude Rollback up to (and excluding) a specific commit <span class="hljs-number"><span class="hljs-number">1000000037</span></span> Commit ID <span class="hljs-number"><span class="hljs-number">1000000036</span></span> Commit ID <span class="hljs-number"><span class="hljs-number">1000000035</span></span> Commit ID <span class="hljs-number"><span class="hljs-number">1000000034</span></span> Commit ID <span class="hljs-number"><span class="hljs-number">1000000033</span></span> Commit ID <span class="hljs-number"><span class="hljs-number">1000000032</span></span> Commit ID <span class="hljs-number"><span class="hljs-number">1000000031</span></span> Commit ID <span class="hljs-number"><span class="hljs-number">1000000030</span></span> Commit ID <span class="hljs-number"><span class="hljs-number">1000000029</span></span> Commit ID <span class="hljs-number"><span class="hljs-number">1000000028</span></span> Commit ID <span class="hljs-number"><span class="hljs-number">1000000027</span></span> Commit ID <span class="hljs-number"><span class="hljs-number">1000000026</span></span> Commit ID <span class="hljs-number"><span class="hljs-number">1000000025</span></span> Commit ID <span class="hljs-number"><span class="hljs-number">1000000024</span></span> Commit ID <span class="hljs-number"><span class="hljs-number">1000000023</span></span> Commit ID <span class="hljs-number"><span class="hljs-number">1000000022</span></span> Commit ID <span class="hljs-number"><span class="hljs-number">1000000021</span></span> Commit ID <span class="hljs-number"><span class="hljs-number">1000000020</span></span> Commit ID <span class="hljs-number"><span class="hljs-number">1000000019</span></span> Commit ID <span class="hljs-number"><span class="hljs-number">1000000018</span></span> Commit ID</code> </pre> <br>  As you can see, the router dumped us a bunch of Commit ID.  Unlike Juniper, in which the list of commits starts from 0 and zero commit is the current config, on the IOS XR the commit ID increases with each commit, and the current commit is the one that has the highest ID from the list presented.  In our case, 1000000037 is the current configuration.  Compared to JunOS, this is a commit with ID 0. <br><br>  If we need to roll back just one commit - that is, the configuration with ID 1000000036, then everything is simple, you can do this: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE4#rollback configuration last <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  And in the end we will roll back to the configuration with ID 1000000036. <br><br>  But if you made more than one commit, or you need to roll back to a specific configuration during the work.  How to be here?  To do this, you need to look at who commits and when and find the right one: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE4#sh configuration commit list <span class="hljs-number"><span class="hljs-number">10</span></span> Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">39.113</span></span> UTC SNo. Label/ID User Line Client Time Stamp ~~~~ ~~~~~~~~ ~~~~ ~~~~ ~~~~~~ ~~~~~~~~~~ <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1000000037</span></span> bormoglot con0_0_CPU0 CLI Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">43</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1000000036</span></span> bormoglot con0_0_CPU0 CLI Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">1000000035</span></span> bormoglot con0_0_CPU0 CLI Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">1000000034</span></span> bormoglot con0_0_CPU0 CLI Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">54</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">1000000033</span></span> bormoglot con0_0_CPU0 Rollback Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">34</span></span>:<span class="hljs-number"><span class="hljs-number">08</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">1000000032</span></span> bormoglot con0_0_CPU0 CLI Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span>:<span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">1000000031</span></span> bormoglot con0_0_CPU0 Rollback Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span>:<span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">1000000030</span></span> bormoglot con0_0_CPU0 CLI Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span>:<span class="hljs-number"><span class="hljs-number">43</span></span>:<span class="hljs-number"><span class="hljs-number">43</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">1000000029</span></span> bormoglot con0_0_CPU0 CLI Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">1000000028</span></span> bormoglot con0_0_CPU0 CLI Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">26</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span></code> </pre> <br><blockquote>  Note: the number 10 means how many commits to display, otherwise Tsisk will dump you all commits, which will be redundant information (you are unlikely to make 40-50 commits at a time, although who knows ...).  Unlike JunOS, iOS XR saves the last 100 commits. </blockquote><br>  But in my case, the above output did not really help in finding the desired commit.  Not only did I commit only, it‚Äôs still impossible to navigate in time to which commit I need to return.  And here comments to commits will help us: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE4#sh configuration commit list <span class="hljs-number"><span class="hljs-number">5</span></span> detail Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">19.682</span></span> UTC <span class="hljs-number"><span class="hljs-number">1</span></span>) CommitId: <span class="hljs-number"><span class="hljs-number">1000000037</span></span> Label: NONE UserId: bormoglotx Line: con0_0_CPU0 Client: CLI Time: Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">43</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> Comment: add desc int ge0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) CommitId: <span class="hljs-number"><span class="hljs-number">1000000036</span></span> Label: NONE UserId: bormoglotx Line: con0_0_CPU0 Client: CLI Time: Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> Comment: <span class="hljs-string"><span class="hljs-string">"descr gi0/0/0/4"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) CommitId: <span class="hljs-number"><span class="hljs-number">1000000035</span></span> Label: NONE UserId: bormoglotx Line: con0_0_CPU0 Client: CLI Time: Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> Comment: <span class="hljs-string"><span class="hljs-string">"descr gi0/0/0/3"</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>) CommitId: <span class="hljs-number"><span class="hljs-number">1000000034</span></span> Label: NONE UserId: bormoglotx Line: con0_0_CPU0 Client: CLI Time: Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">54</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> Comment: <span class="hljs-string"><span class="hljs-string">"descr gi0/0/0/2"</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>) CommitId: <span class="hljs-number"><span class="hljs-number">1000000033</span></span> Label: NONE UserId: bormoglotx Line: con0_0_CPU0 Client: Rollback Time: Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">34</span></span>:<span class="hljs-number"><span class="hljs-number">08</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> Comment: no evi2</code> </pre> <br>  Now it's easier, I see my comments on commits and I can understand something about what I added in each of the commits.  But the comment does not always reflect all changes in the configuration.  And if it is not written by you, then it is generally incomprehensible what is hidden under the described descriptor.  To understand what exactly has changed in the config, you need to use the following command: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE4#show configuration commit changes <span class="hljs-number"><span class="hljs-number">1000000037</span></span> Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">05.485</span></span> UTC Building configuration... !! IOS XR Configuration <span class="hljs-number"><span class="hljs-number">5.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span> description <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW5"</span></span> ! end</code> </pre> <br>  This command displays what exactly was added or removed to the configuration in the specified commit. <br><blockquote>  Note: in addition to the commit ID, there is a commit number in the order specified in the detailed output: <br><br><pre> <code class="javascript hljs"> <span class="hljs-number"><span class="hljs-number">1</span></span>) CommitId: <span class="hljs-number"><span class="hljs-number">1000000037</span></span> Label: NONE UserId: bormoglotx Line: con0_0_CPU0 Client: CLI Time: Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">43</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> Comment: add desc int ge0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span></code> </pre> <br>  1 is the commit number, and 10,000,00037 is its ID.  You can also watch configuration changes or roll back by the commit number, for example: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE4#show configuration commit changes last <span class="hljs-number"><span class="hljs-number">1</span></span> Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">24</span></span>:<span class="hljs-number"><span class="hljs-number">19.616</span></span> UTC Building configuration... !! IOS XR Configuration <span class="hljs-number"><span class="hljs-number">5.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span> description <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW5"</span></span> ! end</code> </pre> <br>  After last, specify the number of commits to the desired one (the number is equal to the number of the commit).  Unlike ID, the commit number is constantly changing (I think it is clear that the commit number is incremented with each commit run) </blockquote><br>  But the peculiarity of this command is that it shows us exactly the changes that were applied in the specified commit.  For example, let's see what has changed in the configuration when working on a commit 1000000036: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE4# RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE4#show configuration commit changes <span class="hljs-number"><span class="hljs-number">1000000036</span></span> Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">25</span></span>:<span class="hljs-number"><span class="hljs-number">21.772</span></span> UTC Building configuration... !! IOS XR Configuration <span class="hljs-number"><span class="hljs-number">5.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">4</span></span> description <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW4"</span></span> ! end</code> </pre> <br>  In essence, this conclusion shows us what has changed in commit 1000000036 compared with the previous commit 1000000035. That is, in the JunOS world, the analogue of the <font color="#03b75a">show system rollback 2 compare 3</font> command (the first digit is the configuration that will be displayed, the second digit is the configuration, with which the comparison will be made).  The following command works in the same way, but it displays information so to speak ‚Äúfrom its bell tower‚Äù: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE4#show configuration rollback changes <span class="hljs-number"><span class="hljs-number">1000000036</span></span> Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">27</span></span>:<span class="hljs-number"><span class="hljs-number">34.912</span></span> UTC Building configuration... !! IOS XR Configuration <span class="hljs-number"><span class="hljs-number">5.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">4</span></span> no description <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW4"</span></span> ! end</code> </pre> <br>  The command shows that we will cancel if we make a rollback for this commit, but it shows changes within only the specified commit, and not the configuration as a whole.  For example, we made 5 commits and now roll back to all 5 commits.  This command will show us not the resultant changes when there is a rollback for 5 commits, then only those changes that will be reversed within the specified commit ID, without taking into account all intermediate commits.  But after all, the result of applying rolback will be the cancellation not only of the specified commit, but also of all intermediate changes, that is, we need to see a comparison of the current configuration with the configuration that was at the time of the commit specified in the command.  That is, if we again draw an analogy with the JunOS world, we need the output of the <font color="#03b75a">show system rollback 5 compare 0</font> command.  To do this, use the show configuration commit changes command but with the <font color="#0755f2">to</font> or <font color="#0755f2">to-exclude</font> keyword: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE4#show configuration rollback changes ? last Changes <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> rolling back last &lt;n&gt; commits to Changes up to (and including) a specific commit to-exclude Changes up to (and excluding) a specific commit</code> </pre> <br><blockquote>  Note: the to-exclude keyword appeared in the 5th branch of IOS XR, and then not on all versions.  In any case, there is no such command on version 5.1.3, and already in 5.3.3. </blockquote><br>  With the to keyword, the command will bring you all the changes that will be made to the config as a result of applying the rollback, including the commit specified in the command and all intermediate configuration changes.  We look how it works: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE4#show configuration rollback changes to <span class="hljs-number"><span class="hljs-number">1000000035</span></span> Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span>:<span class="hljs-number"><span class="hljs-number">21.933</span></span> UTC Building configuration... !! IOS XR Configuration <span class="hljs-number"><span class="hljs-number">5.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">3</span></span> no description <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW3"</span></span> ! interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">4</span></span> no description <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW4"</span></span> ! interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span> no description <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW5"</span></span> ! end</code> </pre> <br>  That is, if we apply this rollback, then all changes including changes applied in commit 1000000035 are canceled. In essence, we roll back to the configuration that was before applying the 1000000035 commit, that is, to the configuration with commit ID 1000000034. This becomes clear after viewing Configuration changes made to commit 1000000035: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE4#show configuration commit changes <span class="hljs-number"><span class="hljs-number">1000000035</span></span> Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">34</span></span>:<span class="hljs-number"><span class="hljs-number">23.184</span></span> UTC Building configuration... !! IOS XR Configuration <span class="hljs-number"><span class="hljs-number">5.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">3</span></span> description <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW3"</span></span> ! end</code> </pre> <br>  In this commit, a handle was added to the interface GigabitEthernet0 / 0/0/3.  The output of the <font color="#0755f2">show configuration rollback changes to 1000000035</font> command shows that this descriptor will be deleted and we will roll back to the configuration that was added by the commit 1000000034. Yes, this is a little different from the JunOS commit.  In JunOS, we jump to the configuration we specified, but on IOS XR, using the specified command, we jump to the configuration that was before applying the specified commit, canceling and changing the commit specified in the command.  Please note that in versions up to 5.3.X there is only such a command. <br><br>  When using the command with the <font color="#0755f2">to-exclude</font> keyword, the work of the command will be similar to the rollback in JunOS ‚Äî the configuration that was applied in the specified commit will be rolled back: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE4#show configuration rollback changes to-exclude <span class="hljs-number"><span class="hljs-number">1000000035</span></span> Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">37</span></span>:<span class="hljs-number"><span class="hljs-number">17.183</span></span> UTC Building configuration... !! IOS XR Configuration <span class="hljs-number"><span class="hljs-number">5.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">4</span></span> no description <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW4"</span></span> ! interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span> no description <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW5"</span></span> ! end</code> </pre> <br>  If you compare with the output that was presented when parsing the command with the to keyword, you will see differences - the changes that were made during the execution of commit 1000000035 are not reversed.  I personally prefer this method, but, as I wrote earlier, this command is available only from version 5.3.x. <br><br><blockquote>  Note: the <font color="#0755f2">show configuration commit changes</font> command can also show all changes that have been made from the current configuration to the specified commit (taking into account all intermediate configuration changes).  To do this, use the since keyword and specify the commit ID or the last keyword and specify the serial number of the commit: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE4#sh configuration commit changes <span class="hljs-number"><span class="hljs-number">1000000035</span></span> Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">33.533</span></span> UTC Building configuration... !! IOS XR Configuration <span class="hljs-number"><span class="hljs-number">5.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">3</span></span> description <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW3"</span></span> ! end</code> </pre> <br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE4#sh configuration commit changes since <span class="hljs-number"><span class="hljs-number">1000000035</span></span> Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">38.212</span></span> UTC Building configuration... !! IOS XR Configuration <span class="hljs-number"><span class="hljs-number">5.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">3</span></span> description <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW3"</span></span> ! interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">4</span></span> description <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW4"</span></span> ! interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span> description <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW5"</span></span> ! end</code> </pre> <br>  But again, do not forget that this command shows everything that has been added to the configuration starting from the specified commit and ending with the current one, and you will roll back all these changes with your rollerback! </blockquote><br>  After JunOS, it's a little hard to understand the first rollback version.  But we move on. <br><br>  Unlike JunOS, Cisco does not just load the configuration when rolling back, but immediately applies it without even asking the administrator.  This is a very significant difference, especially after JunOS, which loads the configuration, allows it to be edited (if necessary), checked and committed.  But not everything is so bad, IOS XR also knows how to load a config without an automatic commit, but more on that later. <br><br>  You can see what will change in the configuration with rolback in addition to the above commands in another way that JunOS lovers will like.  It is necessary to use the previously mentioned commands but with the keyword <font color="#0755f2">diff</font> .  Here is an example of the output of configuration changes in the usual form: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE4#show configuration rollback changes to <span class="hljs-number"><span class="hljs-number">1000000025</span></span> Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">42</span></span>:<span class="hljs-number"><span class="hljs-number">44.450</span></span> UTC Building configuration... !! IOS XR Configuration <span class="hljs-number"><span class="hljs-number">5.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> shutdown ! interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">1.777</span></span> l2transport ! interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span> no description <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW2"</span></span> ! interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">3</span></span> no description <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW3"</span></span> ! interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">4</span></span> no description <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW4"</span></span> ! interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span> no description <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW5"</span></span> ! no interface BVI777 interface BVI777 ipv4 address <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.254</span></span> <span class="hljs-number"><span class="hljs-number">255.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> no mac-address <span class="hljs-number"><span class="hljs-number">200.0</span></span><span class="hljs-number"><span class="hljs-number">.4777</span></span> mac-address <span class="hljs-number"><span class="hljs-number">200.0</span></span><span class="hljs-number"><span class="hljs-number">.4777</span></span> ! router bgp <span class="hljs-number"><span class="hljs-number">6262</span></span> vrf VRF_EVPN no address-family ipv4 unicast ! ! evpn ! end</code> </pre> <br>  But using the <font color="#0755f2">diff</font> keyword.  I think that the output below is easier to read, since it is indicated what is being added and what is being removed from the configuration: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE4#show configuration rollback changes to <span class="hljs-number"><span class="hljs-number">1000000025</span></span> diff Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">42</span></span>:<span class="hljs-number"><span class="hljs-number">50.580</span></span> UTC Building configuration... !! IOS XR Configuration <span class="hljs-number"><span class="hljs-number">5.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> # interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> + shutdown + ! # interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">1.777</span></span> l2transport # ! - interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span> - description <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW2"</span></span> - ! - interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">3</span></span> - description <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW3"</span></span> - ! - interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">4</span></span> - description <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW4"</span></span> - ! - interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span> - description <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW5"</span></span> - ! - interface BVI777 + interface BVI777 - vrf VRF_EVPN - ipv4 address <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.254</span></span> <span class="hljs-number"><span class="hljs-number">255.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> + ipv4 address <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.254</span></span> <span class="hljs-number"><span class="hljs-number">255.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> - mac-address <span class="hljs-number"><span class="hljs-number">200.0</span></span><span class="hljs-number"><span class="hljs-number">.4777</span></span> + mac-address <span class="hljs-number"><span class="hljs-number">200.0</span></span><span class="hljs-number"><span class="hljs-number">.4777</span></span> + ! # router bgp <span class="hljs-number"><span class="hljs-number">6262</span></span> # vrf VRF_EVPN - address-family ipv4 unicast - label mode per-vrf - redistribute connected - redistribute <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> - ! - ! - ! # evpn # ! end</code> </pre> <br>  The truth is that configuration changes are somewhat strange, for example, these lines are useless: <br><br><pre> <code class="javascript hljs">- ipv4 address <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.254</span></span> <span class="hljs-number"><span class="hljs-number">255.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> + ipv4 address <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.254</span></span> <span class="hljs-number"><span class="hljs-number">255.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> - mac-address <span class="hljs-number"><span class="hljs-number">200.0</span></span><span class="hljs-number"><span class="hljs-number">.4777</span></span> + mac-address <span class="hljs-number"><span class="hljs-number">200.0</span></span><span class="hljs-number"><span class="hljs-number">.4777</span></span></code> </pre> <br>  Why this is done is not clear to me.  But you have to put up with it. <br><br>  Now consider another very useful feature - this is loading the configuration without its automatic commit.  This is already done from the configuration mode.  Here all actions are the same as described above and the same rules apply (to and to-exclude), but the configuration is not committed automatically.  Consider an example: <br><br>  If we make a rollback, then this part of the configuration will be removed: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE4#show configuration rollback changes to <span class="hljs-number"><span class="hljs-number">1000000035</span></span> Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>:<span class="hljs-number"><span class="hljs-number">53.187</span></span> UTC Building configuration... !! IOS XR Configuration <span class="hljs-number"><span class="hljs-number">5.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">3</span></span> no description <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW3"</span></span> ! interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">4</span></span> no description <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW4"</span></span> ! interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span> no description <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW5"</span></span> ! end</code> </pre> <br>  Go to configuration mode and download the changes: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE4(config)#load rollback changes to <span class="hljs-number"><span class="hljs-number">1000000035</span></span> Building configuration... Loading. <span class="hljs-number"><span class="hljs-number">254</span></span> bytes parsed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> sec (<span class="hljs-number"><span class="hljs-number">249</span></span>)bytes/sec</code> </pre> <br><blockquote>  Note: The output specifies the to keyword, so not only the changes applied to the specified commit are loaded, but also all intermediate commits.  If the command were without to: <font color="#0755f2">load rollback changes 1000000035</font> , only the changes that were made with this commit would be loaded, and with the to-exclude keyword all changes would be loaded to commit 1000000035, not including the changes applied in commit 1000000035 itself. </blockquote><br>  With a simple rollback, the configuration would automatically commit and we would have removed the descriptors from three interfaces.  In our case, all descriptors are in place: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE4(config)#<span class="hljs-keyword"><span class="hljs-keyword">do</span></span> show int description | i <span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/[<span class="hljs-number"><span class="hljs-number">3</span></span><span class="hljs-number"><span class="hljs-number">-5</span></span>] Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">49</span></span>:<span class="hljs-number"><span class="hljs-number">31.632</span></span> UTC Gi0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">3</span></span> admin-down admin-down <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW3"</span></span> Gi0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">4</span></span> admin-down admin-down <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW4"</span></span> Gi0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span> admin-down admin-down <span class="hljs-string"><span class="hljs-string">"link to RZN-CE4-SW5"</span></span></code> </pre> <br>  But if you look at the configuration, we see that the changes are uploaded, but not applied - you can change them (although it‚Äôs not so easy, because part of the config will be deleted - as you can see, the no description command is indicated instead of the descript) and commit: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE4(config)#show Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">49</span></span>:<span class="hljs-number"><span class="hljs-number">33.962</span></span> UTC Building configuration... !! IOS XR Configuration <span class="hljs-number"><span class="hljs-number">5.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">3</span></span> no description ! interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">4</span></span> no description ! interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span> no description ! end</code> </pre> <br>  If you change your mind to commit, the easiest way to use the following command <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE4(config)#abort RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE4#</code> </pre> <br>  You will simply be thrown out of the configuration mode and all non-committed changes will be deleted.  If you type end or exit, Cisco will ask what you want to do with the configuration: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span>(config)#end Uncommitted changes found, commit them before exiting(yes/no/cancel)? [cancel]:n RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span>#</code> </pre> <br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span>(config)#exit Uncommitted changes found, commit them before exiting(yes/no/cancel)? [cancel]:n RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span>#</code> </pre> <br>  Adding a label to a commit or rolback can be added to one of the very useful functions: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span>#rollback configuration to <span class="hljs-number"><span class="hljs-number">1000000003</span></span> label bormoglotx RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span>#show configuration commit list Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">42</span></span>:<span class="hljs-number"><span class="hljs-number">50.333</span></span> UTC SNo. Label/ID User Line Client Time Stamp ~~~~ ~~~~~~~~ ~~~~ ~~~~ ~~~~~~ ~~~~~~~~~~ <span class="hljs-number"><span class="hljs-number">1</span></span> bormoglotx bormoglot con0_0_CPU0 Rollback Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">42</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1000000004</span></span> bormoglot con0_0_CPU0 Rollback Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span>:<span class="hljs-number"><span class="hljs-number">34</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">1000000003</span></span> bormoglot con0_0_CPU0 CLI Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">38</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">1000000002</span></span> bormoglot con0_0_CPU0 CLI Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">25</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">1000000001</span></span> bormoglot con0_0_CPU0 CLI Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span>:<span class="hljs-number"><span class="hljs-number">57</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span></code> </pre> <br>  Now, instead of the ID indicated what you write. <br><blockquote>  Note: the ID itself is still assigned and indicated either in the detailed output or when selecting the commit ID: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span>#show configuration rollback changes ? bormoglotx <span class="hljs-number"><span class="hljs-number">1000000005</span></span> bormoglotx<span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-number"><span class="hljs-number">1000000006</span></span></code> </pre> </blockquote><br>  In my opinion it is convenient.  Two identical tags can not be specified, get the following error: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span>#rollback configuration to <span class="hljs-number"><span class="hljs-number">1000000004</span></span> label bormoglotx Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">47</span></span>:<span class="hljs-number"><span class="hljs-number">24.214</span></span> UTC Loading Rollback Changes. Loaded Rollback Changes <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> sec Committing. Rollback operation failed due to - <span class="hljs-string"><span class="hljs-string">'CfgMgr'</span></span> detected the <span class="hljs-string"><span class="hljs-string">'warning'</span></span> condition <span class="hljs-string"><span class="hljs-string">'The specified label already exists in commit database.'</span></span> Running configuration has not been modified.</code> </pre> <br>  Another useful command would be <font color="#0755f2">show-error commit</font> , which immediately indicates an error (as JunOS does).  For example, a commit that will result in an error: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span>(config)#commit Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span>:<span class="hljs-number"><span class="hljs-number">40.048</span></span> UTC % Failed to commit one or more configuration items during a pseudo-atomic operation. All changes made have been reverted. Please issue <span class="hljs-string"><span class="hljs-string">'show configuration failed [inheritance]'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> session to view the errors</code> </pre> <br>  Now we need to give the <font color="#0755f2">show configuration failed</font> command to see the problem in the config.  But you can immediately give the <font color="#0755f2">commit show-error</font> command and if Jisk does not like the config, then an <font color="#0755f2">error</font> message will immediately appear in the console: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span>(config)#commit show-error Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span>:<span class="hljs-number"><span class="hljs-number">44.254</span></span> UTC % Failed to commit one or more configuration items during a pseudo-atomic operation. All changes made have been reverted. !! SEMANTIC ERRORS: This configuration was rejected by !! the system due to semantic errors. The individual !! errors <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> each failed configuration command can be !! found below. interface BVI777 vrf VRF-TEST !!% <span class="hljs-string"><span class="hljs-string">'RSI'</span></span> detected the <span class="hljs-string"><span class="hljs-string">'fatal'</span></span> condition <span class="hljs-string"><span class="hljs-string">'The interface'</span></span>s numbered and unnumbered IPv4/IPv6 addresses must be removed prior to changing or deleting the VRF<span class="hljs-string"><span class="hljs-string">' ! end RP/0/0/CPU0:RZN-PE-4(config)#</span></span></code> </pre> <br>  The output immediately shows a piece of the config with an error. <br><br>  I also wanted to draw attention to the commit <font color="#0755f2">commit best-effort</font> function.  This keyword for commit will apply all the lines that are correct, but the invalid ones will be ignored.  Perhaps someone will need this function.  Personally, I have never used it. <br><br>  If necessary, the entire commit sheet can be cleared (for example, when swapping or re-using equipment as a new node).  To do this, use the following command: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span>#clear configuration commits oldest <span class="hljs-number"><span class="hljs-number">43</span></span> Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">26</span></span>:<span class="hljs-number"><span class="hljs-number">58.078</span></span> UTC Deleting <span class="hljs-number"><span class="hljs-number">43</span></span> rollback points <span class="hljs-string"><span class="hljs-string">'1000000001'</span></span> to <span class="hljs-string"><span class="hljs-string">'1000000043'</span></span> <span class="hljs-number"><span class="hljs-number">48</span></span> KB <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> disk space will be freed. Continue <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> deletion?[confirm] RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span>#show configuration commit list Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">27</span></span>:<span class="hljs-number"><span class="hljs-number">18.977</span></span> UTC The commit database is empty.</code> </pre> <br>  True information about all commits will still be saved, though in another place: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span>#show configuration history Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">15</span></span>:<span class="hljs-number"><span class="hljs-number">04.042</span></span> UTC Sno. Event Info Time Stamp ~~~~ ~~~~~ ~~~~ ~~~~~~~~~~ <span class="hljs-number"><span class="hljs-number">1</span></span> startup configuration applied Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> commit id <span class="hljs-number"><span class="hljs-number">1000000001</span></span> Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> commit id <span class="hljs-number"><span class="hljs-number">1000000002</span></span> Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span>:<span class="hljs-number"><span class="hljs-number">07</span></span>:<span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> commit id <span class="hljs-number"><span class="hljs-number">1000000003</span></span> Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span>:<span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">26</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span></code> </pre> <br>  But the IDs indicated in this conclusion cannot be guided, since when resetting, the numbering begins again, for example, after 43 it goes again 1: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span>#show configuration history | b ^<span class="hljs-number"><span class="hljs-number">52</span></span> Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">57.924</span></span> UTC <span class="hljs-number"><span class="hljs-number">52</span></span> commit id <span class="hljs-number"><span class="hljs-number">1000000043</span></span> Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">24</span></span>:<span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> <span class="hljs-number"><span class="hljs-number">53</span></span> commit id <span class="hljs-number"><span class="hljs-number">1000000001</span></span> Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">28</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> <span class="hljs-number"><span class="hljs-number">54</span></span> commit id <span class="hljs-number"><span class="hljs-number">1000000001</span></span> Sun Dec <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span>:<span class="hljs-number"><span class="hljs-number">57</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span></code> </pre> <br>  Well, do not forget about such an important and useful team as a <font color="#0755f2">commit confirmed</font> , can significantly simplify life and save a lot of nerves.  I think that there is no point in presenting it. <br><br>  In conclusion, I wanted to describe the rake, which I once stepped on.  You need to be careful with the rollback command, if instead of <font color="#0755f2">rollback configuration to 1000000020</font> you specify <font color="#ff0037">rollback configuration 1000000020</font> , then changes in the current configuration will be limited to those changes that were made in the commit ID you specified.  I will show it on an example. <br><br>  I make three commits in succession, adding one descriptor each.  First commit: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span>(config)#interface gigabitEthernet <span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">3</span></span> description <span class="hljs-number"><span class="hljs-number">111111</span></span> RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span>(config)#commit comment add <span class="hljs-number"><span class="hljs-number">11111</span></span> Tue Dec <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">15.328</span></span> UTC RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span>(config)#</code> </pre> <br>  Second commit: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span>(config)#interface gigabitEthernet <span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">4</span></span> description <span class="hljs-number"><span class="hljs-number">22222</span></span> RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span>(config)#commit comment add <span class="hljs-number"><span class="hljs-number">22222</span></span> Tue Dec <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">33.627</span></span> UTC RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span>(config)#</code> </pre> <br>  Third commit: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span>(config)#interface gigabitEthernet <span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span> description <span class="hljs-number"><span class="hljs-number">33333</span></span> RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span>(config)#commit comment add <span class="hljs-number"><span class="hljs-number">33333</span></span> Tue Dec <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">54.856</span></span> UTC RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span>(config)#</code> </pre> <br>  Look at the ID of our commits: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span>#show configuration commit list <span class="hljs-number"><span class="hljs-number">5</span></span> Tue Dec <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">04.915</span></span> UTC SNo. Label/ID User Line Client Time Stamp ~~~~ ~~~~~~~~ ~~~~ ~~~~ ~~~~~~ ~~~~~~~~~~ <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1000000022</span></span> bormoglot con0_0_CPU0 CLI Tue Dec <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">54</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1000000021</span></span> bormoglot con0_0_CPU0 CLI Tue Dec <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">1000000020</span></span> bormoglot con0_0_CPU0 CLI Tue Dec <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">1000000019</span></span> bormoglot con0_0_CPU0 Rollback Tue Dec <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">1000000018</span></span> bormoglot con0_0_CPU0 CLI Tue Dec <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">26</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span></code> </pre> <br>  Now let's see what changes were made to commits (are these really our commits). <br><br>  First rollback: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span>#show configuration rollback changes <span class="hljs-number"><span class="hljs-number">1000000022</span></span> Tue Dec <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">23.474</span></span> UTC Building configuration... !! IOS XR Configuration <span class="hljs-number"><span class="hljs-number">5.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span> no description <span class="hljs-number"><span class="hljs-number">33333</span></span> ! end</code> </pre> <br>  Second rollback: <br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span>#show configuration rollback changes <span class="hljs-number"><span class="hljs-number">1000000021</span></span> Tue Dec <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">27.184</span></span> UTC Building configuration... !! IOS XR Configuration <span class="hljs-number"><span class="hljs-number">5.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">4</span></span> no description <span class="hljs-number"><span class="hljs-number">22222</span></span> ! end</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And the third rollback: </font></font><br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span>#show configuration rollback changes <span class="hljs-number"><span class="hljs-number">1000000020</span></span> Tue Dec <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">30.373</span></span> UTC Building configuration... !! IOS XR Configuration <span class="hljs-number"><span class="hljs-number">5.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">3</span></span> no description <span class="hljs-number"><span class="hljs-number">111111</span></span> ! end</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Suppose that I need to roll back all the changes and return to the configuration that was at commit 1000000019. We are looking at what will change when rollerback: </font></font><br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span>#show configuration rollback changes to <span class="hljs-number"><span class="hljs-number">1000000020</span></span> Tue Dec <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">34.553</span></span> UTC Building configuration... !! IOS XR Configuration <span class="hljs-number"><span class="hljs-number">5.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">3</span></span> no description <span class="hljs-number"><span class="hljs-number">111111</span></span> ! interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">4</span></span> no description <span class="hljs-number"><span class="hljs-number">22222</span></span> ! interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span> no description <span class="hljs-number"><span class="hljs-number">33333</span></span> ! end</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And now making rollback, we make a mistake by skipping the to keyword: </font></font><br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span>#rollback configuration <span class="hljs-number"><span class="hljs-number">1000000020</span></span> Tue Dec <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">49.342</span></span> UTC Loading Rollback Changes. Loaded Rollback Changes <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> sec Committing. <span class="hljs-number"><span class="hljs-number">2</span></span> items committed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> sec (<span class="hljs-number"><span class="hljs-number">1</span></span>)items/sec Updating. Updated Commit database <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> sec Configuration successfully rolled back commit <span class="hljs-string"><span class="hljs-string">'1000000020'</span></span>.</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Config rolled back, everything seems fine. </font><font style="vertical-align: inherit;">But the result is not what we expected. </font><font style="vertical-align: inherit;">We look at the config:</font></font><br><br><pre> <code class="javascript hljs">RP/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0:RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span>#show running-config Tue Dec <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">56.432</span></span> UTC Building configuration... !! IOS XR Configuration <span class="hljs-number"><span class="hljs-number">5.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> !! Last configuration change at Tue Dec <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> by bormoglotx ! hostname RZN-PE<span class="hljs-number"><span class="hljs-number">-4</span></span> interface MgmtEth0/<span class="hljs-number"><span class="hljs-number">0</span></span>/CPU0/<span class="hljs-number"><span class="hljs-number">0</span></span> shutdown ! interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> description link to core ! interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> description link to SW1 ! interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span> shutdown ! interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">3</span></span> shutdown ! interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">4</span></span> description <span class="hljs-number"><span class="hljs-number">22222</span></span> shutdown ! interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span> description <span class="hljs-number"><span class="hljs-number">33333</span></span> shutdown ! #      </code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Only the descrip- tion from the interface GigabitEthernet0 / 0/0/3 interface, which I hung out, committing 10,000,00020, was removed, and the changes that were in commits 10,000,00021 and 10,000,00022 were not canceled. </font><font style="vertical-align: inherit;">So don‚Äôt skip to or to-exclude when config is rolled back more than 1 commit. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I hope the above will be useful to someone.</font></font> Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/317466/">https://habr.com/ru/post/317466/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../317456/index.html">JetBrains Night in Moscow. Video. How CLion handles the complexities of C ++</a></li>
<li><a href="../317458/index.html">Creating a web application in PHP using Firebird and Laravel</a></li>
<li><a href="../317460/index.html">How to become a product manager (and stop being a sales director). Part 3</a></li>
<li><a href="../317462/index.html">Android screen stabilization</a></li>
<li><a href="../317464/index.html">Remember everything: the roman room method</a></li>
<li><a href="../317468/index.html">Yandex.Metrica or specialized monitoring system - what and when to choose?</a></li>
<li><a href="../317470/index.html">My story of emigration, the dream of the administrator</a></li>
<li><a href="../317472/index.html">New Year! Distributing 10 Trips to New Orleans on VeeamON 2017</a></li>
<li><a href="../317474/index.html">10 best books to run a successful startup under the version of MakeRight</a></li>
<li><a href="../317476/index.html">Debugging Your OS: A Lesson in Memory Allocation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>