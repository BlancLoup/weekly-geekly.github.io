<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Network Virtualization in Hyper-V. Configuring the HNV gateway based on Windows Server 2012 R2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In several previous posts on network virtualization technology (Hyper-V Network Virtualization, HNV), I talked about the architecture , settings , and...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Network Virtualization in Hyper-V. Configuring the HNV gateway based on Windows Server 2012 R2</h1><div class="post__text post__text-html js-mediator-article">  In several previous posts on network virtualization technology (Hyper-V Network Virtualization, HNV), I talked about the <a href="http://habrahabr.ru/company/microsoft/blog/173159/">architecture</a> , <a href="http://habrahabr.ru/company/microsoft/blog/176039/">settings</a> , and <a href="http://habrahabr.ru/company/microsoft/blog/209684/">new</a> HNV features in Windows Server 2012 R2.  Today we will talk about, perhaps, the most difficult topic - building an HNV gateway based on <a href="http://technet.microsoft.com/ru-RU/evalcenter/dn205286">Windows Server 2012 R2</a> to provide virtualized network segments with access to the outside world.  There will be a lot of screenshots. <a name="habracut"></a><br><br>  In most cases, virtual machines (VMs) deployed in virtualized networks require interaction with the outside world ‚Äî to communicate with other data center facilities, to access the Internet, to access the corporate network of a company that has located these VMs in the data center etc. For the HNV technology, the outside world is anything outside the virtualized network.  And before moving on, it is necessary to once again decide on terminology, which over the two years of its existence, HNV slightly changed. <br><br><br><h1>  Terminology </h1><br>  So, the defining concept of HNV is the Customer Network, which has a unique Routing Domain ID (RDID).  This is the very same virtualized network.  There are several synonyms for the Customer Network, depending on which tool you use: <br><ul><li>  in VMM, this is the VM Network; </li><li>  in PowerShell, this is a Routing Domain; </li><li>  in many articles and blogs this is Tenant or Tenant Virtual Network. </li></ul><br>  But all these terms are the essence of the Customer Network.  Each customer network consists of one or more virtual subnets (Virtual Subnet), and each virtual subnet has its own unique 24-bit VSID.  Packets are routed between VMs belonging to the same customer‚Äôs network, regardless of whether these machines are located on the same virtual subnet or on different, on the same physical host, or on different ones.  But if you need communication with the outside world, that is, you need to transfer packets outside the Customer Network, then the HNV Gateway (HNVGW) must be configured. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <br><h1>  Options for the implementation of the gateway </h1><br>  The HNV gateway can be either a complete hardware solution or a host based on Windows Server 2012 R2.  Currently, three hardware solutions are available on the market: <br><ul><li>  by <a href="http://www.nappliance.com/mnv/mnvgateway.pdf">nAppliance</a> </li><li>  by <a href="http://www.ironnetworks.com/products/NetGateway-MNV">Iron Networks</a> </li><li>  from <a href="https://f5.com/about-us/news/press-releases/f5-enhances-synthesis-architecture-to-extend-reach-of-software-defined-application-services">F5</a> </li></ul><br>  In this post, I will focus on creating an HNV gateway based on Windows Server 2012 R2, while managing HNV in my demo network, including setting up the gateway, will be done using System Center 2012 R2 Virtual Machine Manager (VMM).  Using the following abbreviation VMM, I assume it is version R2, unless explicitly stated otherwise. <br><br>  Recall that, strictly speaking, HNV is a technology of Windows Server 2012 and higher, and it can be configured without VMM, simply using PowerShell cmdlets.  I cite links to examples of relevant scripts <a href="http://gallery.technet.microsoft.com/scriptcenter/Simple-Hyper-V-Network-d3efb3b8">without using</a> and <a href="http://gallery.technet.microsoft.com/scriptcenter/Simple-Hyper-V-Network-6928e91b">using an</a> HNV gateway.  But in real-world scenarios, VMM is used to manage HNV, which takes on the role of centrally storing and distributing HNV policies. <br><br><br><h1>  Gateway architecture </h1><br>  Architecturally, the Windows Server 2012 R2-based HNV Gateway is a physical host running one or more VMs that route packets from virtualized networks to the outside world and back.  I pay attention, it is a <u><i>physical</i></u> host.  Implementing an HNV gateway just as a virtual machine does not work out, if only because a packet of encapsulation (see the HNV concept post) requires the Hyper-V role, but does not support embedded Virtualization Hyper-V. <br><br>  To be fair, it is worth noting that, technically, a gateway can also be built on the basis of Windows Server 2012. But at the same time, firstly, the gateway with Windows Server 2012 will require starting as many VMs as you have Customer Networks, and scaling such a solution is difficult.  Secondly, to manage such a gateway using VMM, you will need to write a provider for VMM.  Using the same Windows Server 2012 R2 + System Center 2012 R2 Virtual Machine Manager - it is almost ready HNV-gateway "out of the box."  In Windows Server 2012 R2, a multi-tenant gateway is implemented, which allows you to use one VM to route the traffic of different virtualized networks, and a system provider has already been built into System Center 2012 R2 Virtual Machine Manager to manage this gateway. <br><br>  What are the options for working HNV-gateway?  There are two. <br><br><br><h4>  Private Cloud (Routing) </h4><br>  The first option implements the routing of traffic from the Customer Network to the data center network, and the routing can be both direct and address translation (NAT). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f90/a66/116/f90a661162f1bef54150bccc5b629eee.gif" alt="image"><br><br>  The figure shows direct routing, which makes sense if the CA-address spaces of different tenants (Customer Networks) do not overlap and they need access to the corporate network.  Or, as in the figure, there is only one tenant with several subnets.  For a private cloud, when tenants, for example, are virtualized networks of various departments of a large enterprise, it is quite possible. <br><br>  When using NAT to each tenant, the HNV gateway assigns a dedicated IP address on its external interface, and all packets from the tenant's virtual machines are sent to the outside world with this dedicated IP in the "Sender IP address" field. <br><br><br><h4>  Hybrid Cloud (Site to site VPN) </h4><br>  The second option involves building a network-to-network tunnel from the HNV gateway to the required point, for example, via the Internet to the customer‚Äôs corporate network. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eca/fa3/ee6/ecafa3ee63dd2cb53372bf6908385483.png" alt="image"><br><br>  This is just a typical hoster scenario, when the customer's VMs are located in the hoster's data center and are connected via VPN to the customer's network.  In this case, the HNV technology allows the customer to save the IP settings and not be afraid for the operation of the software inside the VM, and for the hoster to place the virtual servers with the desired IP by the customer, isolating these virtual machines from other VMs and not configuring VLANs. <br><br>  Concluding the architectural section of the post, I‚Äôll note briefly what is the multi-tenancy of the gateway based on Windows Server 2012 R2. <br><br>  Imagine that in the data center the networks of two customers, <i>Contoso</i> and <i>Woodgrove</i> , are virtualized using exactly the same CA spaces: 10.0.0.0/24.  How to "dissolve" the packages of these customers on the HNV-gateway?  The first possible solution is to create your VM on the gateway for each customer and specify it in the settings of the corresponding customer network as the default gateway.  Thus, packets sent to the outside world from <i>Contoso</i> will always come to the network interface of one VM gateway, packets from <i>Woodgrove</i> to the interface of the second VM, etc. As mentioned, the Windows Server 2012 gateway would use this approach . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3c9/0fc/804/3c90fc804c61a78496594b0c7ef52a82.png" alt="image"><br><br>  In Windows Server 2012 R2, the ability to use so-called cells (compartments) has appeared for routing.  For each tenant, a virtual cell is created in the virtual machine (compartment), which includes virtual network interfaces, IP addresses, a routing table, an ARP table, etc. The elements of one cell are isolated from the elements of another cell.  Packet routing from <i>Contoso</i> is therefore within the corresponding cell and does not intersect, does not affect the routing of <i>Woodgrove</i> packets in another cell, even if the entries in the routing tables of these cells look the same.  This approach allows you to use one VM to route packets of different tenants without any conflicts. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/435/3a4/da0/4353a4da02237aa34da66859ba6e5f81.png" alt="image"><br><br>  As seen in fig.  above, there is a default cell (default compartment), which includes the network settings that are specified when creating a VM, and two cells for tenants that appeared during the HNV gateway configuration process. <br><br><br><h1>  Gateway creation </h1><br>  Fortified by theory, we proceed directly to the creation of a gateway.  For simplicity, I will consider a non-clustering version of the gateway, although it is clear that in a real data center, such an important element of virtualization involves working in high availability mode.  A detailed document on how to make the HNV Gateway highly accessible can be found <a href="http://go.microsoft.com/fwlink/p/%3FLinkId%3D329037">here</a> . <br>  The main steps to create a gateway include the following: <br><ul><li>  setting up logical networks and VM networks; </li><li>  configure host for gateway role </li><li>  VM preparation for gateway </li><li>  adding a gateway to VMM </li><li>  configure the gateway for specific networks VM </li></ul><br>  Let's take it in order. <br><br><br><h4>  Setting up logical networks and VM networks </h4><br>  This item is described in some detail in one of the previous <a href="http://habrahabr.ru/company/microsoft/blog/176039/">posts</a> , so I‚Äôll show only how logical and virtual networks look in my Contoso laboratory candlestick data center. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/033/572/0b5/0335720b5bd1ce2064e95845fdbc822c.png" alt="image"><br><br>  For our task, we need three logical networks: the external segment (Contoso_External_LN01), the network to control the gateway (Contoso_Management_LN01) and the network (Contoso_HNV_LN01), over which the virtualized networks are actually created.  The IP pool of the Contoso_HNV_LN01 network sets the PA space, and the checkbox allowing the use of HNV technology must be marked in the properties of this network. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cdd/172/bd2/cdd172bd2659ffb899fc408da69cd917.png" alt="image"><br><br>  VM networks (VM Networks, they are also customer networks, they are Customer Networks) look like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6d9/d71/6a3/6d9d716a382334c51dcc2d9a1e6c1585.png" alt="image"><br><br>  You see two VM networks for <i>Adatum</i> and <i>Fabrikam</i> using intersecting address space (10.30.1.0/24).  In the <b>Gateway Connection</b> column, you can see that so far none of the VM networks use the gateway. <br><br><br><h4>  Configuring Host for Gateway Role </h4><br>  In general, any host running Windows Server 2012 R2 that VMM manages can be configured as an HNV gateway.  In an amicable way, this host should have several physical network interfaces looking into the desired segments (external, control segment, HNV segment).  However, from the architectural part of the post, it follows that the VM is actually routing the packets in the gateway.  Therefore, how many physical network cards should be in the host acting as a gateway is determined by performance, reliability (timing can be used, for example) and, of course, the logic of how and where you want to send packets.  Specifically, in my booth, the host gateway contains only one physical network interface, so far this is enough for me for experiments. <br><br>  But in any case, in the properties of the host selected for the gateway role, this checkbox should be set <br><br><img src="https://habrastorage.org/getpro/habr/post_images/801/aed/597/801aed597d9c678647db3b19c7850e06.png" alt="image"><br><br>  It will prevent the launch on the gateway of any "ordinary" VM, involving the use of HNV.  In a real situation, you are unlikely to run anything else on the gateway other than the components of the gateway itself. <br><br><br><h4>  VM preparation for gateway </h4><br>  Now let's talk about the VM itself that will route the packets using the compartments.  The easiest way is to deploy it using the service template.  In this case, you can immediately tell VMM so that when deploying a VM, the RRAS service was raised in it, so that two of them would be raised on a cluster for high availability of such machines. But, first, we agreed to do everything with our hands in order to better understand what happens, secondly, the service templates do not support second-generation VMs, which are deployed, and they work more brightly. <br><br>  Therefore, I created a second-generation VM template based on VHDX with a Windows Server 2012 R2 image.  In this process, there is nothing unusual, I will show only the network settings in the template. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/32d/e49/b13/32de49b1389d67c81d47b0bd9408ce13.png" alt="image"><br><br>  You see three virtual network adapters (vNIC): one is connected to the external network (see fig.), The second is connected to the management network, the third can be left in the <b>Not Connected</b> state in the template, and during or immediately after the VM is deployed, connect it through the virtual switch (Hyper-V Extensible Switch) to a network that uses HNV.  Usually, when describing a gateway, this network is called Backend. <br><br>  Now we deploy the VM based on this template to the host that we chose and configured as a gateway in the previous paragraph.  Pay attention to the name that you give to this VM.  It will be needed later in the configuration of the gateway. <br><br>  After the VM has been deployed, go into it, connect the network adapter to the Backend network, turn off the Firewall and for convenience, rename the network adapters so that the names reflect their purpose, for example <br><br><img src="https://habrastorage.org/getpro/habr/post_images/40c/0f9/54c/40c0f954cd5a33dc0ccecadb903b564a.png" alt="image"><br><br>  Now the VM (I called it <i>GatewayVM01</i> ) needs to install the <b>Remote Access</b> role.  This is done as standard via <b>Server Manager</b> , <b>Manage</b> -&gt; <b>Add Roles and Features</b> .  Click <b>Next</b> , until we reach the choice of role, select <b>Remote Access</b> , then <b>Next</b> , until we reach <b>Role Services</b> , where we mark two services <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7ce/dca/c75/7cedcac752a43047f661c74df0661cef.png" alt="image"><br><br>  Click on <b>Next</b> and <b>Install</b> .  After the installation is complete, click the <b>Open the Getting Started Wizard.</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b84/8a4/acb/b848a4acba9fd96cf754fa63068a32dd.png" alt="image"><br><br>  and in the wizard window that opens, select <b>Deploy VPN only</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4d6/0c4/0d1/4d60c40d1c69101fdbcccd563a2c6e4c.png" alt="image"><br><br>  As a result, the well-known RRAS console will open, from which it can be seen that the service has not yet been configured. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f39/9a0/174/f399a0174fb5edb0ab9bb64b4357eab2.png" alt="image"><br><br>  Thus, we set up the host and the corresponding VM, and now everything is ready to add this ‚Äúpreset‚Äù as an HNV gateway to the VMM console for further configuration. <br><br><br><h4>  Add Gateway to VMM </h4><br>  In the VMM console, go to the <b>Fabric</b> section, click <b>Add Resources,</b> and select <b>Network Service</b> .  On the first page of the wizard we give the gateway a meaningful name and description. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/628/fa7/197/628fa7197b4625f8174fc415f051be04.png" alt="image"><br><br>  Then select <b>Microsoft</b> as the manufacturer and <b>Microsoft Windows Server Gateway</b> in the list of models. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b6e/5f9/b4e/b6e5f9b4e15425a67cbaad5d538fd484.png" alt="image"><br><br>  On the <b>Credentials</b> page, you must select <b>Run As account</b> to access the device.  This entry must have administrative rights to the VM gateway.  In our case, the VM was not included in the domain, so we specify the entry with the password of the local administrator.  If there is no such record in VMM, you can immediately create it. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/877/078/87e/87707887e3fbf70fca905199960424da.png" alt="image"><br><br>  Perhaps the most interesting parameter is the <b>Connection String</b> , in which using the three parameters <b>VMHost</b> , <b>GatewayVM</b> and <b>BackendSwitch,</b> you must specify the name of the host and VM ‚Äú <b>stubs</b> ‚Äù and the name of the virtual switch on the host through which the VM connects to the Backend network.  Please note that there are no spaces in the connection string; the separator is a semicolon ( <b>;</b> ). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dfc/e30/ef3/dfce30ef3edc668b23d6c4e84bd7983b.png" alt="image"><br><br>  In addition to the three listed above, there are several other parameters, a description of which can be found <a href="http://technet.microsoft.com/library/dn249417.aspx">here</a> (see Section 16).  In particular, <b>DirectRoutingMode = True will</b> configure the gateway to work in direct routing mode. <br><br>  With the connection string specified above, certificates are not used, so on the <b>Certificates</b> page, just click <b>Next</b> . <br><br>  On the <b>Provider</b> page, click the <b>Test</b> button and make sure that all tests pass without errors. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bca/348/e85/bca348e850e436817fba422a8db8a0db.png" alt="image"><br><br>  On the <b>Host Group</b> page, we indicate which host groups can use this gateway. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a10/f8a/3be/a10f8a3bef87119e1a6a1a4376ffeee1.png" alt="image"><br><br>  We check the settings on the <b>Summary</b> page, and if everything is correct, click <b>Finish</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/474/71e/a88/47471ea885510d59c026cb846024ae20.png" alt="image"><br><br>  Verify that the related tasks in the <b>Jobs</b> section completed successfully.  It remains to configure the network interfaces of the newly created HNV gateway.  In the <b>Fabric</b> -&gt; <b>Networking</b> -&gt; <b>Network Service</b> section of the VMM console, right-click the gateway, select <b>Properties</b> and go to the <b>Connectivity</b> tab.  Here you need to enable <b>Front End Connection</b> and <b>Back End Connection</b> and select the correct VM network adapters and the corresponding logical subnet sites. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0f0/434/6a5/0f04346a5ae82b01361dce13a388f7d2.png" alt="image"><br><br>  Now, VMM knows which adapters of the VM the gateway is intended for, and properly configures the RRAS service inside this VM.  When jobs are completed, in the RRAS VM console of the gateway you will see that the service is running and works as a multi-tenant gateway. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e9c/bae/aca/e9cbaeacac3ba17f046de5640ff389cd.png" alt="image"><br><br>  Things to do, configure the required VM networks to use the HNV-created gateway. <br><br><br><h4>  Configure a gateway for specific VM networks </h4><br>  In the VMM console, go to the <b>VMs and Services</b> section, click on <b>VM Networks</b> , select the required VM network, and click the <b>Properties</b> button.  Go to the <b>Connectivity</b> tab and enable the use of the HNV gateway by this network.  For the <i>Fabrikam</i> network, for example, we enable NAT <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8ac/431/3ac/8ac4313acf3a35f3aaba8ddbd25894d2.png" alt="image"><br><br>  VMM will automatically allocate from the IP pool of the logical network associated with the external interface of the HNV gateway, the address to which the sender addresses of all packets from the <i>Fabrikam</i> network will be transmitted.  But you can manually select an IP from the pool, specifying it in the <b>IP address</b> field <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d59/268/12c/d5926812cadde5684d8bc4330edb40bb.png" alt="image"><br><br>  Having closed the properties window, in the lower part of the VMM console you can see which specific external address is used for this VM network. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/073/d46/649/073d46649542acfcea5f1c2cb945fa5e.png" alt="image"><br><br>  We do the same for the <i>Adatum</i> network and all other virtualized networks that need external access with NAT support. <br><br>  Now let's see how the connection to the outside world is configured via VPN, that is, we are implementing the Hybrid Cloud (Site to site VPN) script.  At the same time, I assume that the VPN device in the corporate network is already configured, using the IKEv2 protocol and Preshared Key based authentication, which is typical for network-to-network tunnels, and we know its external IP. <br><br>  In the properties of the same VM <i>Fabrikam</i> network, on the already familiar <b>Connectivity</b> tab, mark the topmost checkbox <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8ca/a6d/70e/8caa6d70e54039c0e01ede11119bee64.png" alt="image"><br><br>  At the same time, in the properties window of the VM network, a new <b>VPN Connections</b> tab appears, where you need to click <b>Add to</b> add the VPN connection, specify its name and IP address of the VPN device to which the tunnel is built <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0e0/d77/d64/0e0d77d64839281a392360d59d495d1c.png" alt="image"><br><br>  In the <b>Authentication</b> section, we indicate the prepared <b>Run As account</b> entry with the specified Preshared Key, <br><br><img src="https://habrastorage.org/getpro/habr/post_images/439/80c/b95/43980cb95b892b9ffd106174397a00b8.png" alt="image"><br><br>  and in the section <b>Routes we</b> register the necessary routes, for example <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4af/2a8/e8e/4af2a8e8e276e57e7685e47a051e9135.png" alt="image"><br><br>  As you might notice, BGP support has been implemented to dynamically update routes. <br><br>  You can look at the advanced settings in <b>Advanced</b> , say, change the VPN protocol or encryption settings, but if nothing is required, then click OK.  At the bottom of the VMM console for the configured VM network, something like this will now appear. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6e8/e6c/4e2/6e8e6c4e2301ac73cbafe0a3ffcd2059.png" alt="image"><br><br>  As soon as from any VM running on the virtualized <i>Fabrikam</i> network, we try to ping the address from the subnet specified with the VPN tunnel settings, for example, 10.30.50.101, the HNV gateway will raise the tunnel and establish connection with the specified VPN device, and through it with corporate network <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4e1/ffc/a57/4e1ffca57be939c24b5f1e0c3c1c20bb.png" alt="image"><br><br>  It is done! <br><br>  If the information from this post was not enough, you can use the detailed step- <a href="http://www.microsoft.com/en-us/download/details.aspx%3Fid%3D39284">by</a> -step <a href="http://www.microsoft.com/en-us/download/details.aspx%3Fid%3D39284">guide</a> to create a laboratory stand. <br><br>  One question remains open: how are packets actually routed when using an HNV gateway, what does it look like inside the gateway?  But this is already a difficulty level of 400 for the most sophisticated.  :) Although, if there are any, I'm ready to write. <br><br>  Hope the material was helpful. <br><br>  Thank! </div><p>Source: <a href="https://habr.com/ru/post/231713/">https://habr.com/ru/post/231713/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../231699/index.html">How many cats on Habr√©?</a></li>
<li><a href="../231703/index.html">Some facts about the CAP- ‚Äútheorem‚Äù</a></li>
<li><a href="../231705/index.html">Blink: Wireless Surveillance System for Home and Office</a></li>
<li><a href="../231707/index.html">A small overview of the monitor AOC G2460Pqu - 144 Hz to the masses</a></li>
<li><a href="../231711/index.html">Katie Sierra on how to create popular applications and improve the "coolness" of its users</a></li>
<li><a href="../231715/index.html">Show Sound # 13 - Podcast on audio equipment, components, formats and technologies</a></li>
<li><a href="../231717/index.html">IBM poll: analytics for managing business processes in your company</a></li>
<li><a href="../231719/index.html">WordPress Optimization. Competition "UPU for the year for the best ideas!"</a></li>
<li><a href="../231723/index.html">[Translation] 10 commandments that storage manufacturers want to hide</a></li>
<li><a href="../231725/index.html">nooLite: new PT112 temperature sensor and RX2132 USB receiver</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>