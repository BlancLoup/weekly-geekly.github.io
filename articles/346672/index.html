<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Single Sign-On, or Dancing Six</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This piece of paper was originally written as a reminder for myself, but at the insistent requests of my colleagues, I did, after a year and a half, g...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Single Sign-On, or Dancing Six</h1><div class="post__text post__text-html js-mediator-article"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/f6/fx/ge/f6fxgeu7szxqgu8fcofgta4h_ok.jpeg" width="250"></div><br><br>  This piece of paper was originally written as a reminder for myself, but at the insistent requests of my colleagues, I did, after a year and a half, gather my courage and publish it. <p></p><br><p>  The material is prosaic, but it may be useful to someone, which I will be very happy about.  Even more I would appreciate constructive advice and feedback. </p><br><p>  So, our topic is <strong>‚ÄúHow to implement Single Sign-On for a web application under the conditions of variegatedness and normal shaggy system zoo‚Äù</strong> . </p><a name="habracut"></a><br><h2 id="single-sign-on-vvodnaya">  Single Sign-On.  Introductory </h2><br><blockquote>  Trust someone, so trust in everything. <br>  ¬© Cecilius Statius </blockquote><p>  For those who do not know (although they are unlikely to read this material), I would say that Single Sign-On (in the further narrative - ‚ÄúSSO‚Äù) in the conventional wisdom is not a technology, much less a kind of magic protocol.  SSO is an approach, a method that allows AAA (Authentication &amp; Authorization &amp; Accounting) AA connectivity between heterogeneous systems and applications without additional gestures from the end user. </p><br><p>  Typical examples of <abbr title="Single Sign-On, Single Sign On">SSO</abbr> are, for example, solutions built entirely on <a href="http://www.microsoft.com/">Microsoft</a> products;  in this case, the Active Directory server (s) provide not only the storage of the directory, but also control the behavior of the workstations connected to the domain, the software installed on them and all the rest, up to the hardware (we can all prohibit the same USB policies).  The <abbr title="Authentication &amp; Authorization &amp; Accounting">AAA</abbr> paradigm in this situation is provided almost automatically when using Microsoft products, that is, in a homogeneous environment. </p><br><p>  Heterogeneous IT-structure in terms of <abbr title="Authentication &amp; Authorization &amp; Accounting">AAA</abbr> transparency is somewhat more complicated, however, many methods of implementation have already been developed for this environment and there are no numbers for them. </p><br><p>  As examples: </p><br><ul><li>  The well-known company <a href="http://www.atlassian.com/">Atlassian</a> has on board the well-proven product <a href="https://www.atlassian.com/software/crowd">Atlassian Crowd</a> , which solves similar problems, but it is sharpened for a specific line of software products of this company. </li><li>  Many of us use the <a href="http://gosuslugi.ru/">State Services Portal</a> , and absolutely all of us, being responsible taxpayers, know that authentication is available on the <a href="http://nalog.ru/">nalog.ru</a> website through the State Services Portal. </li><li>  Paradoxical, but surprisingly frequent authentication option: ‚ÄúI log on to Google, then to Facebook with authentication through Google, and then to AliExpress with authentication through Facebook‚Äù. </li></ul><br><p>  Two of the three points listed above are not related to <abbr title="Single Sign-On, Single Sign On">SSO</abbr> . </p><br><p>  Guess what?  :) </p><br><h3 id="aksioma">  Axiom </h3><br><p>  In this article, we assume that <abbr title="Single Sign-On, Single Sign On">SSO is</abbr> implemented and works exclusively within the Intranet (in a corporate environment), and at the same time provides sufficient reliability, resiliency and security. </p><br><h3 id="zadacha">  Task </h3><br><p>  At the entrance we have: </p><br><ul><li>  A web application built on the <a href="http://www.intersystems.ru/">InterSystems</a> platform. </li><li>  Linux servers on which it is spinning.  Servers are located on the customer‚Äôs intranet. </li><li>  Developed Microsoft Customer infrastructure, including very well-tuned group policies on a competent domain forest and a bunch of controllers. </li><li>  Dear Customer, who said the key phrases ‚ÄúIt is necessary!‚Äù And ‚ÄúTo be ready yesterday!‚Äù. </li><li>  And, fortunately, a full-fledged test server, so we have a place to turn around! </li></ul><br><p>  At once I will make a reservation that there are more simple ways to solve this problem, besides the one described below, but we are not looking for them.  Well, the requirements of the customer were not the most unambiguous. </p><br><p>  <em>So, let's start!</em> </p><br><h2 id="tancuem-s-pingvinami-linux">  We dance with penguins.  Linux </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bi/uj/b4/biujb4n241npdydbjnmxbiv-imo.png" width="250"></div><br><blockquote>  Domain: Eukaryotes, Kingdom: Animals, Submarine: Eumetazoi, Type: Chordates, Subtype: Vertebrates, Infratype: Maxillary, Topclass: Four-legged, Class: Birds, Subclass: Novonybnye, Order: Pingvinochnye, Family: Penguin, Type: Ohter, Newbred, Squad: Pinguinnye 7.2 </blockquote><br><h3 id="ustanovka">  Installation </h3><br><p>  We got a fully fledged descendant / clone of RHEL named <a href="https://www.oracle.com/ru/linux/operating-system/index.html">Oracle Linux Server</a> release 7.2. </p><br><h3 id="nastroyka">  Customization </h3><br><p>  As always, Linux in its server form is simple, carefree and reliable, but it is important for us to make sure that it is properly configured, especially in terms of network settings. </p><br><h3 id="testirovanie">  Testing </h3><br><p>  First, we look at the DNS settings, because  This is critical for the health of the entire solution: </p><br><pre><code class="hljs pgsql">[root@my-test-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> ~]# cat /etc/resolv.conf # <span class="hljs-keyword"><span class="hljs-keyword">Generated</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> NetworkManager <span class="hljs-keyword"><span class="hljs-keyword">search</span></span> my-<span class="hljs-keyword"><span class="hljs-keyword">domain</span></span>.ru nameserver <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> nameserver <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span></code> </pre> <br><p>  At this stage, you need to check the availability of DNS servers (which, in our case, are also domain controllers).  You can do this in different ways, just use your favorite utilities and verification methods (host, dig, telnet, ping, ...).  It is important that the ports we need are available and workable, and in the case of DNS, this is primarily TCP / 53.  And do not forget about the blasphemy and the greed of network administrators and security guards (I myself am), which can close everything to you, including ICMP, and leave only a couple of requested and agreed ports.  What is right. </p><br><h2 id="sobachiy-vals-kerberos">  Dog Waltz.  Kerberos </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6f/lg/k5/6flgk5txn3p_53l12znq1hqtzyg.png" width="250"></div><br><blockquote>  Cerberus, also Kerber (from ancient Greek ŒöŒ≠œÅŒ≤ŒµœÅŒøœÇ, lat. Cerberus), in Greek mythology is the creature of Typhon and Echidna (Tartarus and Gaia), a three-headed dog with a poisonous mixture flowing from the jaws.  Cerberus guarded the exit from the realm of the dead of Hades, not allowing the dead to return to the world of the living.  However, this amazing creature was defeated by Hercules in one of his exploits. </blockquote><p>  I am sure that it is not necessary to remind you about the need to properly configure Kerberos for ‚Äúfruitful cooperation‚Äù with MSAD. </p><br><p>  Of course, to install and configure you need root rights on the server.  Or sudo.  Or "Call Saul." </p><br><h3 id="ustanovka-1">  Installation </h3><br><p>  Installing and configuring the necessary packages is quite simple, if the "evil network admins" gave your server access to the Internet. </p><br><p>  Unfortunately, the Internet with access to the repositories is needed at the installation stage, if the good admins have not installed everything you need beforehand. </p><br><p>  And everything is sad if there is no access or installed packages. </p><br><p>  However, we will be optimistic and, considering that the admins have opened the channel for at least an hour, we are doing the installation: </p><br><pre> <code class="bash hljs">[root@my-test-server ~]<span class="hljs-comment"><span class="hljs-comment"># yum install krb5-workstation  : ulninfo   --&gt;   ---&gt;  krb5-workstation.x86_64 0:1.14.1-26.el7    --&gt;  : libkadm5(x86-64) = 1.14.1-26.el7 : krb5-workstation-1.14.1-26.el7.x86_64 --&gt;  : krb5-libs(x86-64) = 1.14.1-26.el7 : krb5-workstation-1.14.1-26.el7.x86_64 --&gt;  : libkadm5srv_mit.so.10(kadm5srv_mit_10_MIT)(64bit) : krb5-workstation-1.14.1-26.el7.x86_64 --&gt;  : libkadm5srv_mit.so.10()(64bit) : krb5-workstation-1.14.1-26.el7.x86_64 --&gt;   ---&gt;  krb5-libs.x86_64 0:1.13.2-10.el7    ---&gt;  krb5-libs.x86_64 0:1.14.1-26.el7    ---&gt;  libkadm5.x86_64 0:1.14.1-26.el7    --&gt;      ============================================================== Package     ============================================================== : krb5-workstation x86_64 1.14.1-26.el7 ol7_latest 772 k  : libkadm5 x86_64 1.14.1-26.el7 ol7_latest 172 k  : krb5-libs x86_64 1.14.1-26.el7 ol7_latest 741 k    ====+++++=============================================  1  (+1 )  ( 1 )  : 1.6 M Is this ok [y/d/N]: y Downloading packages: No Presto metadata available for ol7_latest (1/3): krb5-libs-1.14.1-26.el7.x86_64.rpm | 741 kB 00:00:00 (2/3): libkadm5-1.14.1-26.el7.x86_64.rpm | 172 kB 00:00:00 (3/3): krb5-workstation-1.14.1-26.el7.x86_64.rpm | 772 kB 00:00:00 --------------------------------------------------------------------------------   3.9 MB/s | 1.6 MB 00:00:00 Running transaction check Running transaction test Transaction test succeeded Running transaction  : krb5-libs-1.14.1-26.el7.x86_64 1/4  : libkadm5-1.14.1-26.el7.x86_64 2/4  : krb5-workstation-1.14.1-26.el7.x86_64 3/4  : krb5-libs-1.13.2-10.el7.x86_64 4/4  : krb5-libs-1.14.1-26.el7.x86_64 1/4  : libkadm5-1.14.1-26.el7.x86_64 2/4  : krb5-workstation-1.14.1-26.el7.x86_64 3/4  : krb5-libs-1.13.2-10.el7.x86_64 4/4 : krb5-workstation.x86_64 0:1.14.1-26.el7  : libkadm5.x86_64 0:1.14.1-26.el7  : krb5-libs.x86_64 0:1.14.1-26.el7 !</span></span></code> </pre><br><p>  Of course, you may have different versions of the package manager used and their versions, but this does not change the essence of the matter. </p><br><p>  And <strong>yes, I promise</strong> that more of these most comprehensive listings of a trivial installation will not appear in the article. </p><br><h3 id="nastroyka-1">  Customization </h3><br><p>  A fully working Kerberos configuration file will initially look something like this: </p><br><pre> <code class="hljs pgsql">[root@my-test-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> ~]# cat /etc/krb5.conf [logging] default = FILE:/var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/krb5libs.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> kdc = FILE:/var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/krb5kdc.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> admin_server = FILE:/var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/kadmind.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> [libdefaults] dns_lookup_realm = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> ticket_lifetime = <span class="hljs-number"><span class="hljs-number">24</span></span>h renew_lifetime = <span class="hljs-number"><span class="hljs-number">7</span></span>d forwardable = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> rdns = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> default_realm = MY-<span class="hljs-keyword"><span class="hljs-keyword">DOMAIN</span></span>.RU default_ccache_name = KEYRING:persistent:%{uid} [realms] MY-<span class="hljs-keyword"><span class="hljs-keyword">DOMAIN</span></span>.RU = { kdc = ad.my-<span class="hljs-keyword"><span class="hljs-keyword">domain</span></span>.ru admin_server = ad.my-<span class="hljs-keyword"><span class="hljs-keyword">domain</span></span>.ru } [domain_realm] .my-<span class="hljs-keyword"><span class="hljs-keyword">domain</span></span>.ru = MY-<span class="hljs-keyword"><span class="hljs-keyword">DOMAIN</span></span>.RU my-<span class="hljs-keyword"><span class="hljs-keyword">domain</span></span>.ru = MY-<span class="hljs-keyword"><span class="hljs-keyword">DOMAIN</span></span>.RU</code> </pre><br><p>  where ad.my-domain.ru must be the correct <abbr title="Fully Qualified Domain Name">FQDN</abbr> , allowed and accessible.  <em>It is important!</em> </p><br><h3 id="testirovanie-1">  Testing </h3><br><p>  In the next step, as a rule, everything happens very simply with us. <br>  Just make sure everything is bad: </p><br><pre> <code class="hljs pgsql">[root@my-test-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> ~]# klist klist: Credentials <span class="hljs-keyword"><span class="hljs-keyword">cache</span></span> keyring 'persistent:<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-string"><span class="hljs-string">' not found</span></span></code> </pre> <br><p>  We call specialists in three-headed dogs (AKA sysadmin, who knows the top-secret domain admin login / password), and ask him to enter it like this: </p><br><pre> <code class="hljs markdown">[root@my-test-server ~]# kinit SuperPuperAdmin Password for SuperPuperAdmin@MY-DOMAIN.RU: <span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">***</span></span>*</code> </pre> <br><p>  After this, the klist should return something already meaningful. <br>  We consider our dog to be finished, though ... </p><br><blockquote>  It is well known that the Nissan is a nonsuchable Passat. </blockquote><br><h2 id="tanec-velikih-ravnin-apache">  Dance of the Great Plains.  Apache </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6h/cs/ww/6hcswwrm6h3mh708zhyodhklyo0.png" height="250"></div><br><blockquote>  Apache is a collective name for several culturally related tribes of North American Indians who speak the Apache languages ‚Äã‚Äãof the Atabasco branch of the Na-Dene family. <br><blockquote>  The Apaches have created their own breathtaking masked dance by the name of Gahan, with which they celebrate the coming of age by girls.  Also, the Apaches still have dance ceremonies for visions and predictions. </blockquote><br></blockquote><p>  We begin to hunt together with the Apache Indians. </p><br><h3 id="ustanovka-2">  Installation </h3><br><p>  As before, the packages are our everything (with the exception of the all-powerful shamans-admins, of course): </p><br><pre> <code class="hljs css"><span class="hljs-selector-attr"><span class="hljs-selector-attr">[root@my-test-server ~]</span></span># <span class="hljs-selector-tag"><span class="hljs-selector-tag">yum</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">install</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">httpd</span></span>  : <span class="hljs-selector-tag"><span class="hljs-selector-tag">ulninfo</span></span>   <span class="hljs-selector-attr"><span class="hljs-selector-attr">[‚Ä¶skipped‚Ä¶]</span></span> : <span class="hljs-selector-tag"><span class="hljs-selector-tag">httpd</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x86_64</span></span> 0<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:2.4.6-45.0.1.el7</span></span>  : <span class="hljs-selector-tag"><span class="hljs-selector-tag">httpd-tools</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x86_64</span></span> 0<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:2.4.6-45.0.1.el7</span></span> !</code> </pre> <br><h3 id="nastroyka-2">  Customization </h3><br><p>  This, of course, is not enough, because the newly-established Indian does not know our language.  <a href="">Configure it</a> like this: </p><br><pre> <code class="hljs pgsql">[root@my-test-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> ~]# cat &gt; /etc/httpd/conf.d/ensemble.conf DocumentRoot "/opt/isc/ensemble/csp" CSPModulePath /opt/isc/ensemble/csp/bin/ LoadModule csp_module_sa /opt/isc/ensemble/csp/bin/CSPa24.so <span class="hljs-keyword"><span class="hljs-keyword">User</span></span> cacheusr <span class="hljs-keyword"><span class="hljs-keyword">Group</span></span> cacheusr &lt;<span class="hljs-keyword"><span class="hljs-keyword">Location</span></span> /&gt; CSP <span class="hljs-keyword"><span class="hljs-keyword">On</span></span> SetHandler csp-<span class="hljs-keyword"><span class="hljs-keyword">handler</span></span>-sa &lt;/<span class="hljs-keyword"><span class="hljs-keyword">Location</span></span>&gt; ServerName my-test-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span>.my-<span class="hljs-keyword"><span class="hljs-keyword">domain</span></span>.ru /&gt; &lt;Directory /&gt; <span class="hljs-keyword"><span class="hljs-keyword">Options</span></span> MultiViews FollowSymLinks AllowOverride <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> Require <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> granted &lt;FilesMatch "\.(log|ini|pid|exe|so)$"&gt; Require <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> denied &lt;/FilesMatch&gt; &lt;/Directory&gt; HostnameLookups <span class="hljs-keyword"><span class="hljs-keyword">Off</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">Location</span></span> /csp&gt; CSP <span class="hljs-keyword"><span class="hljs-keyword">On</span></span> SetHandler csp-<span class="hljs-keyword"><span class="hljs-keyword">handler</span></span>-sa &lt;/<span class="hljs-keyword"><span class="hljs-keyword">Location</span></span>&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">Location</span></span> "/csp/bin/Systems/"&gt; SetHandler cspsys-<span class="hljs-keyword"><span class="hljs-keyword">handler</span></span>-sa &lt;/<span class="hljs-keyword"><span class="hljs-keyword">Location</span></span>&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">Location</span></span> "/csp/bin/RunTime/"&gt; SetHandler csp-<span class="hljs-keyword"><span class="hljs-keyword">handler</span></span>-sa &lt;/<span class="hljs-keyword"><span class="hljs-keyword">Location</span></span>&gt; CSPFileTypes csp cls zen cxw <span class="hljs-keyword"><span class="hljs-keyword">Alias</span></span> /csp/ /opt/isc/ensemble/csp/ &lt;Directory "/opt/isc/ensemble/csp/"&gt; AllowOverride <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Options</span></span> MultiViews FollowSymLinks ExecCGI Require <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> granted &lt;FilesMatch "\.(log|ini|pid|exe)$"&gt; Require <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> denied &lt;/FilesMatch&gt; &lt;/Directory&gt;</code> </pre> <br><p>  And give the ‚Äúpinotchek under the cheek‚Äù: </p><br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">root@my-test-server ~</span></span>]<span class="hljs-meta"><span class="hljs-meta"># systemctl restart httpd</span></span></code> </pre> <br><p>  We make sure that he learned to speak Russian, by logging into the <a href="">System Management Portal</a> . </p><br><p>  Apaches were once a proud and independent people, they have this in their blood, so with all due respect and courtesy we will ask Apache to start working with our Penguin Soothsayer: </p><br><pre> <code class="hljs pgsql">[root@my-test-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> ~]# systemctl <span class="hljs-keyword"><span class="hljs-keyword">is</span></span>-enabled httpd disabled [root@my-test-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> ~]# systemctl <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> httpd Created symlink <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> /etc/systemd/<span class="hljs-keyword"><span class="hljs-keyword">system</span></span>/multi-<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.target.wants/httpd.service <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> /usr/lib/systemd/<span class="hljs-keyword"><span class="hljs-keyword">system</span></span>/httpd.service. [root@my-test-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> ~]# systemctl <span class="hljs-keyword"><span class="hljs-keyword">is</span></span>-enabled httpd enabled</code> </pre> <br><p>  Having listened to ‚ÄúPioneer Dawn‚Äù, having made water procedures, having walked a three-headed dog and having brushed an Indian, we pass to ‚ÄúProduction Gymnastics‚Äù, which today will be dancing (and even with tambourines). </p><br><h2 id="tancuem-sambu">  We are dancing Sambu! </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/o3/vk/h9/o3vkh9-erbhjqtxsutoxdq7p788.png" width="250"></div><br><blockquote>  Samba (port. Samba) - Brazilian dance, a symbol of Brazilian national identity.  The dance has gained worldwide fame thanks to Brazilian carnivals.  One of the varieties of samba entered the compulsory top five Latin American ballroom dancing program.  Performed at a pace of 50-52 beats per minute, at a rate of 2/4 or 4/4. </blockquote><p>  As we all know perfectly well, our beloved Samba in the server version is completely logical divided into three main executable modules: <em>(smb | nmb | winbind) d</em> . </p><br><p>  Theoretically, we need only a working <em>winbindd</em> .  Yes, this is just one of the demons of Samba.  But he, installed separately from the whole package, for some reason did not want to work on the existing platform, but I did not want to understand the reasons for his discontent. </p><br><p>  Therefore, we are installed in full. </p><br><h3 id="ustanovka-3">  Installation </h3><br><p>  The procedure is very simple, especially if your (a) Admin (sha) is dancing with you. </p><br><pre> <code class="hljs css"><span class="hljs-selector-attr"><span class="hljs-selector-attr">[root@my-test-server ~]</span></span># <span class="hljs-selector-tag"><span class="hljs-selector-tag">yum</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">install</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">samba</span></span>  : <span class="hljs-selector-tag"><span class="hljs-selector-tag">ulninfo</span></span>   <span class="hljs-selector-tag"><span class="hljs-selector-tag">--</span></span>&gt;   <span class="hljs-selector-tag"><span class="hljs-selector-tag">---</span></span>&gt;  <span class="hljs-selector-tag"><span class="hljs-selector-tag">samba</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x86_64</span></span> 0<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:4.4.4-9.el7</span></span>    <span class="hljs-selector-tag"><span class="hljs-selector-tag">--</span></span>&gt;    <span class="hljs-selector-attr"><span class="hljs-selector-attr">[‚Ä¶skipped‚Ä¶]</span></span>  1  (+12 )  : 6<span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">M</span></span>  : 23 <span class="hljs-selector-tag"><span class="hljs-selector-tag">M</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Is</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">this</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ok</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[y/d/N]</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">y</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[‚Ä¶skipped‚Ä¶]</span></span> : <span class="hljs-selector-tag"><span class="hljs-selector-tag">samba</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x86_64</span></span> 0<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:4.4.4-9.el7</span></span>  : <span class="hljs-selector-tag"><span class="hljs-selector-tag">libaio</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x86_64</span></span> 0<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0.3.109-13.el7</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">libldb</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x86_64</span></span> 0<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1.1.26-1.el7</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">libtalloc</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x86_64</span></span> 0<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:2.1.6-1.el7</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">libtdb</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x86_64</span></span> 0<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1.3.8-1.el7_2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">libtevent</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x86_64</span></span> 0<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0.9.28-1.el7</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">libwbclient</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x86_64</span></span> 0<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:4.4.4-9.el7</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">pytalloc</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x86_64</span></span> 0<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:2.1.6-1.el7</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">samba-client-libs</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x86_64</span></span> 0<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:4.4.4-9.el7</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">samba-common</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.noarch</span></span> 0<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:4.4.4-9.el7</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">samba-common-libs</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x86_64</span></span> 0<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:4.4.4-9.el7</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">samba-common-tools</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x86_64</span></span> 0<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:4.4.4-9.el7</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">samba-libs</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x86_64</span></span> 0<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:4.4.4-9.el7</span></span> !</code> </pre> <br><p>  The suit is ready, we tighten the tie: </p><br><pre> <code class="hljs css"><span class="hljs-selector-attr"><span class="hljs-selector-attr">[root@my-test-server ~]</span></span># <span class="hljs-selector-tag"><span class="hljs-selector-tag">yum</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">install</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">samba-winbind</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[‚Ä¶skipped‚Ä¶]</span></span> : <span class="hljs-selector-tag"><span class="hljs-selector-tag">samba-winbind</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x86_64</span></span> 0<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:4.4.4-9.el7</span></span>  : <span class="hljs-selector-tag"><span class="hljs-selector-tag">samba-winbind-modules</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x86_64</span></span> 0<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:4.4.4-9.el7</span></span> !</code> </pre> <br><h3 id="nastroyka-3">  Customization </h3><br><p>  It's not enough to come to the carnival, you also need to dance a little (already with tambourines): </p><br><pre> <code class="hljs pgsql">[root@my-test-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> ~]# cat /etc/samba/smb.conf # See smb.conf.example <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> a more detailed config file <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> # <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> the smb.conf manpage. # Run <span class="hljs-string"><span class="hljs-string">'testparm'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> verify the config <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> correct <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> # you modified it. [<span class="hljs-keyword"><span class="hljs-keyword">global</span></span>] workgroup = AD <span class="hljs-keyword"><span class="hljs-keyword">security</span></span> = ads <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> string = my-test-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> netbios <span class="hljs-type"><span class="hljs-type">name</span></span> = my-test-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">security</span></span> = ads realm = my-<span class="hljs-keyword"><span class="hljs-keyword">domain</span></span>.ru <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> = *</code> </pre> <br><p>  We rehearse the first steps (of course, we are mistaken at first): </p><br><pre> <code class="hljs pgsql">[root@my-test-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> ~]# systemctl <span class="hljs-keyword"><span class="hljs-keyword">restart</span></span> winbind Job <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> winbind.service failed because the control process exited <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> error code. See "systemctl status winbind.service" <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> "journalctl -xe" <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> details.</code> </pre> <br><p>  We call on the help of the dance teachers, and (‚ÄúHow many wonderful discoveries are to us ...‚Äù) it turns out to be the very same dog trainers who helped us in taming our three-headed puppy! </p><br><pre> <code class="hljs markdown">[root@my-test-server ~]# net ads join --U SuperPuperAdmin@my-domain.ru Enter root's password: <span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">***</span></span>*</code> </pre> <br><p>  And we hope for a miracle ... It all depends on the hands and on the place from which they grow ... </p><br><blockquote>  "There are so many on the ground. <br>  And different destinies, <br>  Hope gives dawn. <br>  Ferryman people <br>  ¬© Prodigy &amp; Rammstein, 2048 </blockquote><p>  If then we see something like this: </p><br><pre> <code class="hljs pgsql">[root@my-test-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span>]# net ads <span class="hljs-keyword"><span class="hljs-keyword">info</span></span> LDAP <span class="hljs-keyword"><span class="hljs-keyword">server</span></span>: <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.123</span></span> LDAP <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>: AD.my-<span class="hljs-keyword"><span class="hljs-keyword">domain</span></span>.ru Realm: MY-<span class="hljs-keyword"><span class="hljs-keyword">DOMAIN</span></span>.RU Bind <span class="hljs-type"><span class="hljs-type">Path</span></span>: dc=MYDOMAiN,dc=RU LDAP port: <span class="hljs-number"><span class="hljs-number">389</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Server</span></span> <span class="hljs-type"><span class="hljs-type">time</span></span>: , <span class="hljs-number"><span class="hljs-number">33</span></span>  <span class="hljs-number"><span class="hljs-number">2049</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span>:<span class="hljs-number"><span class="hljs-number">12</span></span> ATL KDC <span class="hljs-keyword"><span class="hljs-keyword">server</span></span>: <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.123</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Server</span></span> <span class="hljs-type"><span class="hljs-type">time</span></span> <span class="hljs-keyword"><span class="hljs-keyword">offset</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><p>  then Happiness is almost There! </p><br><h3 id="testirovanie-2">  Testing </h3><br><p>  Check it (Happiness) availability: </p><br><pre> <code class="hljs tex">[root@my-test-server /]# wbinfo -g MYDOMAIN<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">proverka</span></span></span></span> MYDOMAIN<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"></span></span></span></span> MYDOMAIN<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"></span></span></span></span> MYDOMAIN<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"></span></span></span></span> MYDOMAIN<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"></span></span></span></span> MYDOMAIN<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"></span></span></span></span> MYDOMAIN<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"></span></span></span></span>  MYDOMAIN<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"></span></span></span></span>  MYDOMAIN<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"></span></span></span></span> windows MYDOMAIN<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"></span></span></span></span> 1c MYDOMAIN<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"></span></span></span></span> MYDOMAIN<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"></span></span></span></span></code> </pre> <br><p>  There is a contact! </p><br><h2 id="medlyak-mod_auth_ntlm_winbind">  Ballad  mod_auth_ntlm_winbind </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/oo/bx/-c/oobx-crj4mtvdyv0agobstl3fsa.png" height="300"></div><br><blockquote>  Before you dance a slow dance, you will have to invite someone to it, because it is not considered acceptable to move under it alone.  Seize the moment and approach the girl you like.  If you are going to dance a slow dance, announce your intention to a potential partner directly, without unnecessary wordiness.  Do not be too cheeky and pushy, leave the decision for her to agree or not.  In the latter case, she refuses, but thanks you. </blockquote><br><h3 id="ustanovka-4">  Installation </h3><br><p>  Find a live repository on the <em>Web</em> with <em>mod_auth_ntlm_winbind</em> . <br>  Yes, there are few of them alive (I took it from some svn). <br>  Yes, the versions are not new at all. <br>  Yes, you will need to assemble them "manually." <br>  Yes, not everyone will gather. <br>  Yes, even after patches and edits manually. <br>  Yes, the build will require a fully configured environment (gcc + glib + apxs + headers + * -dev + ...). <br>  <em>And YES, this is the only option I know that works stably.</em> </p><br><h3 id="nastroyka-4">  Customization </h3><br><p>  With the configuration, everything is more or less elementary, add Apache to your config-file (to the main one, or to conf.d / xyz.conf, if desired): </p><br><pre> <code class="hljs pgsql">&lt;Directory "/opt/isc/ensemble/csp/myapp/"&gt; AuthName "NTLM my-domain.ru" NegotiateAuth <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> NegotiateAuthHelper "/usr/bin/ntlm_auth --helper-protocol=gss-spnego" NTLMBasicAuthoritative <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> AuthType Negotiate require <span class="hljs-keyword"><span class="hljs-keyword">valid</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">user</span></span> #LogLevel <span class="hljs-keyword"><span class="hljs-keyword">debug</span></span> ##    &lt;/Directory&gt;</code> </pre> <br><p>  Of course, the paths must be specified correctly for your installation, like all other parameters. </p><br><p>  For initial debugging, I advise you to uncomment the line <em>LogLevel</em> , then additional and sometimes very useful messages will be written to the Apache protocol files. </p><br><h2 id="belyy-tanec-kto-kogo">  White dance.  Who will win?.. </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hf/ap/yb/hfapyb0hmfdfmcmg-qtfkomz6je.jpeg" width="250"></div><br><blockquote>  Leicht versprochen, leicht gebrochen. </blockquote><p>  I would like to answer a very natural and very timely (by the end of the article!) Question: ‚ÄúWhat the hell are we doing all this?‚Äù I‚Äôll answer that it‚Äôs all just for one line in the HTTP server response! .. </p><br><h3 id="bochka-myoda">  A barrel of honey </h3><br><p>  We need the correct REMOTE_USER automatically transferred by the web server (or HTTP_REMOTE_USER is not important) in order to: </p><br><ol><li>  a user who successfully logged in to Windows under his domain account, </li><li>  Having passed all the checks in MSAD, </li><li>  then went to the application developed on one of the InterSystems products by a web browser, </li><li>  installed on a Linux server, which is also included in the domain, </li><li>  where the Apache web server with the necessary module is installed and configured, </li><li>  returned us the name of the domain user account (sAMAccountName). </li></ol><br><p>  And we get it! </p><br><p>  After that, we can easily from the server side using, for example, LDAP access to AD, to request other details of this user (group membership, etc.). <br>  There is a separate article about this mechanic, it has its own subtleties. </p><br><h3 id="parochka-lozhek-dyogtya">  A couple of spoons of tar </h3><br><ul><li>  So far, only browsers from MS (IE, Edge) work natively with NTLM (and we use NTML).  However, in both FireFox and Chrome, there is the possibility of donation, moreover, in a corporate environment, both their centralized configuration and distribution of pre-configured packages by means of group policies is possible. </li><li>  Not everyone immediately becomes clear what to do with the received REMOTE_USER on the side of <a href="http://www.intersystems.ru/cache/">InterSystems Cach√©</a> .  There is no consensus on this matter yet, and there are many different options, ranging from setting all users to one super-secret password and then calling <a href="">% session.Login ()</a> to creating their own user-role security model.  There is a topic for discussion! </li></ul><br><h2 id="single-sign-on-vyvodnaya">  Single Sign-On.  Pinout </h2><br><p>  I would be very grateful if you tell me in the comments a better configuration;  I even admit that a new AAA interaction mechanic has appeared for the Linux + Apache + MSAD bundle, which I don‚Äôt know about. </p><br><p>  Thank! </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/346672/">https://habr.com/ru/post/346672/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346660/index.html">[Video] Reports from the iOS developer Red Hot Chili Apples</a></li>
<li><a href="../346662/index.html">Autopilot on AT91SAM7</a></li>
<li><a href="../346666/index.html">ICO regulation. Estonia</a></li>
<li><a href="../346668/index.html">Networks and neighbors: methods of survival of machine learning in the ‚Äúwild‚Äù. Open Workshop AI @ MIPT</a></li>
<li><a href="../346670/index.html">Web components: review and use in production</a></li>
<li><a href="../346676/index.html">Testing components with Puppeteer and Jest</a></li>
<li><a href="../346680/index.html">Bobaos - access to the KNX TP / UART bus with the Raspberry Pi</a></li>
<li><a href="../346682/index.html">Digital events in Moscow from January 15 to 21</a></li>
<li><a href="../346684/index.html">Running in bags, blindfolded, back to front</a></li>
<li><a href="../346686/index.html">Projection modeling. Abstracts for beginners</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>