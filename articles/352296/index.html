<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A simple asynchronous task manager for Unity3D</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Welcome, dear readers. This article will discuss the implementation of a simple manager of asynchronously executed tasks for the develo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A simple asynchronous task manager for Unity3D</h1><div class="post__text post__text-html js-mediator-article"><h2>  Introduction </h2><br>  Welcome, dear readers.  This article will discuss the implementation of a simple manager of asynchronously executed tasks for the development of <b>Unity3d</b> .  This manager basically uses the so-called <b>Coroutine</b> , which is present in the engine. <br><a name="habracut"></a><br>  As usual, before describing the implementation and going into details, you need to understand what we are doing and why we need it. <br><br>  Consider a simple example that I think many have encountered when developing games.  We have a certain character who must perform a series of actions: go to point A, take an object, move to point B, put an object.  As you can see, this is the usual sequence.  It can be implemented in the code in different ways, as the most primitive version in one <b>Update</b> with condition checking.  However, everything becomes more complicated if we have a lot of such characters and actions, they also have quite a lot.  I would like our code to be able to say such a character, perform a series of actions consistently and let you know when you‚Äôre done, but for the time being I‚Äôll do other things.  In this case, just asynchronous approach will be useful.  At the moment there are many different systems (including for <b>Unity</b> ) that allow you to do this, for example, <b>UniRx</b> (reactive asynchronous programming).  But all such things for beginner developers are quite complicated in understanding and mastering, so let's try to take advantage of what the engine itself gives us, namely <b>Coroutine</b> . <br><br>  <b>Note</b> : the example described above is just one of many, besides it there are many areas where you can describe a similar situation: sequential (or parallel) loading of resources over the network, initialization of interdependent subsystems, animation in the UI, etc. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Implementation </h2><br>  Before you write code and go into the depths of C #, we‚Äôll dwell on architecture and terminology. <br><br>  So, above, I wrote as an example, the actions of the character that he should perform.  As part of the system that will be described in this article, this action is a kind of task that the character must perform.  If we generalize this concept, then a task is any action that any essence of the game logic can perform.  The task should obey the following rules: <br><br><ul><li>  You can run it </li><li>  You can subscribe to the completion event </li><li>  It can be forced to stop </li></ul><br><div class="spoiler">  <b class="spoiler_title">We describe these rules through the interface.</b> <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ITask</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-function">ITask </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Subscribe</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Action completeCallback</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; }</code> </pre> <br></div></div><br>  Why does Subscribe return ITask?  It just increases the convenience due to the possibility of creating a structure of the form: <br><br><pre> <code class="cs hljs">ITask myTask; myTask.Subscribe(() =&gt; Debug.Log(‚ÄúTask Complete‚Äù)).Start();</code> </pre><br>  The interface for the task is created, but it lacks one important thing - this is the priority of execution.  What is it for?  Imagine a situation where we set tasks for a character and, logically, a situation arises that he must stop all his tasks and perform another - important for the game process.  In this case, we need to completely stop the current chain and perform a new task.  The described example is only one of several behaviors, besides this the priorities may be as follows: <br><br><ul><li>  Normal priority, each new task is placed at the end of the queue. </li><li>  Top priority, new task placed at the top of the queue </li><li>  Priority with the forced stop of current tasks </li></ul><br><div class="spoiler">  <b class="spoiler_title">Taking into account the priorities, the task interface will take the final form.</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> TaskPriorityEnum { Default, High, Interrupt } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ITask</span></span> { TaskPriorityEnum Priority { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-function">ITask </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Subscribe</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Action feedback</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; }</code> </pre><br></div></div><br>  So, we have decided on a common understanding of what a task is, now we need a concrete implementation.  As described above, <b>Coroutine</b> will be used in this system.  <b>Coroutine</b> , in the simplest sense, is a coroutine (if translated literally), which runs mostly on the thread, but without blocking it.  Due to the use of iterators (IEnumerator), a return to this coroutine occurs on each frame if a <b>yield return</b> call has occurred within it. <br><br><div class="spoiler">  <b class="spoiler_title">Implement the Task class, which will implement the ITask interface</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Task</span></span> : <span class="hljs-title"><span class="hljs-title">ITask</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> TaskPriorityEnum Priority { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _taskPriority; } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> TaskPriorityEnum _taskPriority = TaskPriorityEnum.Default; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Action _feedback; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> MonoBehaviour _coroutineHost; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Coroutine _coroutine; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> IEnumerator _taskAction; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IEnumerator taskAction, TaskPriorityEnum priority = TaskPriorityEnum.Default</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Task(taskAction, priority); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Task</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IEnumerator taskAction, TaskPriorityEnum priority = TaskPriorityEnum.Default</span></span></span><span class="hljs-function">)</span></span> { _coroutineHost = TaskManager.CoroutineHost; _taskPriority = priority; _taskAction = taskAction; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_coroutine == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _coroutine = _coroutineHost.StartCoroutine(RunTask()); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_coroutine != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _coroutineHost.StopCoroutine(_coroutine); _coroutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ITask </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Subscribe</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Action feedback</span></span></span><span class="hljs-function">)</span></span> { _feedback += feedback; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RunTask</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _taskAction; CallSubscribe(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CallSubscribe</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_feedback != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _feedback(); } } }</code> </pre><br></div></div><br>  A bit of explanation on the code: <br><br><ul><li>  The static Create method is necessary for the convenience of writing the form: <br><pre> <code class="cs hljs">Task.Create(..).Subscribe(..).Start()</code> </pre> </li><li>  <b>_coroutineHost</b> is a link to an instance of any <b>MonoBehaviour</b> object on behalf of which the task will be launched (or <b>Coroutine</b> ).  You can send a link, for example, through a static variable. </li><li>  In the <b>Subscribe</b> method, subscribers are added via + =, since there may be several of them (and we will need this later) </li></ul><br>  In the rest, it is quite simple and clear code without any frills. <br><br>  So, we described the task interface and made an implementation of the class that implements it, but for a full-fledged system, this is not enough, we need a manager who will monitor the execution of tasks along the chain in compliance with priorities.  Since in any game there can be a multitude of subsystems that may need their own task manager, we will implement it in the form of a regular class, instances of which will be created and stored by everyone it needs. <br><br><div class="spoiler">  <b class="spoiler_title">Implementing a task manager class.</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TaskManager</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ITask CurrentTask { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _currentTask; } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ITask _currentTask; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;ITask&gt; _tasks = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;ITask&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddTask</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IEnumerator taskAction, Action callback, TaskPriorityEnum taskPriority = TaskPriorityEnum.Default</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> task = Task.Create(taskAction, taskPriority).Subscribe(callback); ProcessingAddedTask(task, taskPriority); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Break</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(_currentTask != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _currentTask.Stop(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Restore</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { TaskQueueProcessing(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Break(); _tasks.Clear(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProcessingAddedTask</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ITask task, TaskPriorityEnum taskPriority</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>(taskPriority) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TaskPriorityEnum.Default: { _tasks.Add(task); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TaskPriorityEnum.High: { _tasks.Insert(<span class="hljs-number"><span class="hljs-number">0</span></span>, task); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TaskPriorityEnum.Interrupt: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_currentTask != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; _currentTask.Priority != TaskPriorityEnum.Interrupt)) { _currentTask.Stop(); } _currentTask = task; task.Subscribe(TaskQueueProcessing).Start(); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(_currentTask == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _currentTask = GetNextTask(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_currentTask != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _currentTask.Subscribe(TaskQueueProcessing).Start(); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TaskQueueProcessing</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _currentTask = GetNextTask(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(_currentTask != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _currentTask.Subscribe(TaskQueueProcessing).Start(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> ITask </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetNextTask</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_tasks.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> returnValue = _tasks[<span class="hljs-number"><span class="hljs-number">0</span></span>]; _tasks.RemoveAt(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> returnValue; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre><br></div></div><br>  Let's sort the given code: <br><br><ul><li>  <b>CurrentTask</b> property - it is necessary to monitor the activity of the task chain and it is possible to subscribe to the current task end event for anyone who has access to the manager </li><li>  <b>AddTask</b> is the main class method that creates and adds to the queue a new task according to the specified priority.  After adding, if the task list is empty, it automatically starts </li><li>  At the time of launching the task (in the <b>ProcessingAddedTask</b> method), an additional subscription occurs by the task manager itself to the event of its completion (this is why + was used in the <b>Task</b> class).  When the task is completed, the manager takes the next one from the queue and so on until all the tasks in the list are completed. </li></ul><br>  Otherwise, as in the case of the <b>Task</b> class, the code is very primitive, but this was the goal of this article. <br><br><h2>  Using </h2><br><div class="spoiler">  <b class="spoiler_title">Consider a simple example of how and where you can use the system described above.</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TaskManagerTest</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Button StartTaskQueue; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Button StopTaskQueue; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Image TargetImage; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Transform From; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Transform To; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> TaskManager _taskManager = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TaskManager(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { StartTaskQueue.onClick.AddListener(StartTaskQueueClick); StopTaskQueue.onClick.AddListener(StopTaskQueueClick); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StartTaskQueueClick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _taskManager.AddTask(MoveFromTo(TargetImage.gameObject.transform, From.position, To.position, <span class="hljs-number"><span class="hljs-number">2f</span></span>)); _taskManager.AddTask(AlphaFromTo(TargetImage, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>)); _taskManager.AddTask(Wait(<span class="hljs-number"><span class="hljs-number">1f</span></span>)); _taskManager.AddTask(AlphaFromTo(TargetImage, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>)); _taskManager.AddTask(MoveFromTo(TargetImage.gameObject.transform, To.position, From.position, <span class="hljs-number"><span class="hljs-number">2f</span></span>)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StopTaskQueueClick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_taskManager.CurrentTask != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _taskManager.Break(); }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { _taskManager.Restore(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Wait</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> time</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">yield</span></span></span><span class="hljs-function"> return new </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WaitForSeconds</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">time</span></span></span><span class="hljs-function">)</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveFromTo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Transform target, Vector3 </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">from</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Vector3 to, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> time</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = <span class="hljs-number"><span class="hljs-number">0f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { t = Mathf.Clamp(t + Time.deltaTime, <span class="hljs-number"><span class="hljs-number">0f</span></span>, time); target.position = Vector3.Lerp(<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>, to, t / time); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (t &lt; time); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AlphaFromTo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Image target, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">from</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> to, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> time</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imageColor = target.color; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = <span class="hljs-number"><span class="hljs-number">0f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { t = Mathf.Clamp(t + Time.deltaTime, <span class="hljs-number"><span class="hljs-number">0f</span></span>, time); imageColor.a = Mathf.Lerp(<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>, to, t / time); target.color = imageColor; <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (t &lt; time); } }</code> </pre><br></div></div><br>  So what does this code do?  Clicking the <b>StartTaskQueue</b> button launches a chain of tasks for operating an <b>Image</b> ( <b>TargetImage</b> ) object: <br><br><ul><li>  moves an object from the <b>From</b> position to the <b>To</b> position </li><li>  hides an object through alpha </li><li>  waiting one second </li><li>  shows the object through alpha </li><li>  moves an object from the <b>To</b> position to the <b>From</b> position </li></ul><br>  When you click the <b>StopTaskQueue</b> button, the current task chain is stopped, if there is an active task in the manager, and if it is not there, then the task chain is restored (if possible). <br><br><h2>  Conclusion </h2><br>  Despite the relative simplicity of the code, this subsystem allows you to solve many problems in the development, which, when solved in the forehead, can cause certain difficulties.  When using such managers and other similar (more complex) ones, you get flexibility and a guarantee that the applied actions to the object will be completed in the necessary sequence and if this process is to be interrupted, it will not cause ‚Äúdances with a tambourine‚Äù.  In my projects, I use a more complex version of the described system, which allows working with both <b>Action</b> and <b>YieldInstruction</b> and <b>CustomYieldInstruction</b> .  Among other things, I use more priority options for performing tasks, as well as the mode for starting a task outside the manager and out of queues using <b>Func</b> (allows you to return the result of the task).  Implementing these things is not difficult, and you yourself can easily figure out how to do this using the code above. <br></div><p>Source: <a href="https://habr.com/ru/post/352296/">https://habr.com/ru/post/352296/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../352278/index.html">IT Event Digest for April</a></li>
<li><a href="../352280/index.html">C ++ cycling for professionals</a></li>
<li><a href="../352282/index.html">Continuous Integration for Newbies</a></li>
<li><a href="../352292/index.html">Hitachi: how the Japanese sunk from chainsaws to modern storage systems</a></li>
<li><a href="../352294/index.html">How to create an ideal product roadmap and what is needed for this?</a></li>
<li><a href="../352298/index.html">From idea to AppStore</a></li>
<li><a href="../352300/index.html">Resolve IP addresses in Linux: a clear and detailed description</a></li>
<li><a href="../352302/index.html">Zuckerberg called. Facebook programmer about his experience of interviewing in the US and the workflow on Facebook</a></li>
<li><a href="../352304/index.html">Do-it-yourself Property Injection (Xamarin / .Net)</a></li>
<li><a href="../352306/index.html">Four facts about memcached amplification</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>