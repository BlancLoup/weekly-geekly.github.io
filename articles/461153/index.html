<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>WebComponents as frameworks, component interaction</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When it comes to web components, they often say: ‚ÄúWhat do you want without frameworks? Everything is ready there. ‚Äù In fact, there are frameworks crea...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>WebComponents as frameworks, component interaction</h1><div class="post__text post__text-html js-mediator-article">  When it comes to web components, they often say: ‚ÄúWhat do you want without frameworks?  Everything is ready there. ‚Äù  In fact, there are frameworks created on the basis of implementations of the standards included in the group of web components.  There are even relatively good ones like the <a href="https://x-tag.github.io/">X-Tag</a> .  But today we‚Äôll still understand how simple, elegant and powerful the browser API has become for solving everyday development tasks, including organizing the interaction of components with each other and with other objects from the context of the browser‚Äôs execution, and you can always use frameworks with web components, even those that were developed across standards, including through the mechanisms that we will analyze today, at least as stated <a href="https://custom-elements-everywhere.com/">on the site</a> . <br><a name="habracut"></a><br>  Decisions like a reaction taught us that there should be one big data store and the components signed for its changes, and in web components they are also trying to discern the absence of such a subsystem, actually implying even unconsciously reverse binning and it already exists in web components. <br><br>  Each element has attributes of the value of which we can change.  And if you list the names in the <b>observedAttributes</b> hook, then when they change, <b>attributeChangedCallback ()</b> will be automatically called in which we can determine the behavior of the component when the attribute changes.  Using getter magic, it is easy to do reverse binding in a similar way. <br><br>  We have already sketched some project in the <a href="https://habr.com/ru/post/460397/">first part</a> and today we will continue to cut it further. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It‚Äôs worth mentioning one limitation right away, at least in the current implementation, that the attribute value can only be a primitive value specified by a literal and reducible to a string, but in general it is possible to transfer ‚Äúobjecs‚Äù in this way using single quotes from the outside and double to define values ‚Äã‚Äãand fields of the project. <br><br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">my-component</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">my</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{"foo": "bar"}'</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">my-component</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  To use this value in the code, you can implement an <b>auto-magic</b> getter that will call <b>JSON.parse () on it</b> . <br><br>  But for now, the numerical value of the counter is enough for us. <br><br>  We add a new attribute to our element, specify it as observed, click the click handler to increment this counter, and add the update of the displayed value by direct link to the change hook, the logic of which is implemented in a separate <b>reusable updateLabel ()</b> method. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyWebComp</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTMLElement</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); } connectedCallback() { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> html = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.importNode(myWebCompTemplate.content, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.attachShadow({<span class="hljs-attr"><span class="hljs-attr">mode</span></span>: <span class="hljs-string"><span class="hljs-string">'open'</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shadowRoot.appendChild(html); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateLabel(); } updateLabel() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shadowRoot.querySelector(<span class="hljs-string"><span class="hljs-string">'#helloLabel'</span></span>).textContent = <span class="hljs-string"><span class="hljs-string">'Hello '</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getAttribute(<span class="hljs-string"><span class="hljs-string">'greet-name'</span></span>) + <span class="hljs-string"><span class="hljs-string">' '</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getAttribute(<span class="hljs-string"><span class="hljs-string">'count'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> get observedAttributes() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">'count'</span></span>]; } attributeChangedCallback(name, oldValue, newValue) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (name === <span class="hljs-string"><span class="hljs-string">'count'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateLabel(); } } showMessage(event) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setAttribute(<span class="hljs-string"><span class="hljs-string">'count'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getAttribute(<span class="hljs-string"><span class="hljs-string">'count'</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>); } }</code> </pre><br><img src="https://habrastorage.org/webt/cp/zl/eu/cpzleupyc6rpa6qkrn30g4dh1n4.png"><br><br>  Each item received an independent, automatically updated counter. <br><br>  Homework: implement the conversion of the counter to a number and use through an auto-getter;) <br><br>  Of course, more advanced options are possible.  For example, if you do not take into account simple callbacks and events, using the native Proxy and the same getters and setters, you can implement the functionality of reverse binding. <br><br>  Add <b>my-counter.js</b> file with a class of this kind <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyCounter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventTarget</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.count = <span class="hljs-number"><span class="hljs-number">0</span></span>; } increment() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.count++; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dispatchEvent(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomEvent(<span class="hljs-string"><span class="hljs-string">'countChanged'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">detail</span></span>: { <span class="hljs-attr"><span class="hljs-attr">count</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.count } })); } }</code> </pre><br>  We inherited a class from <b>EventTarget</b> so that other classes can subscribe to events thrown by objects of this class and define a count property that will store the counter value. <br><br>  Now add the instance of this class as a static property for the component. <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"module"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">import</span></span></span><span class="javascript"> { MyWebComp } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">from</span></span></span><span class="javascript"> </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"./my-webcomp.js"</span></span></span><span class="javascript">; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">import</span></span></span><span class="javascript"> { MyCounter } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">from</span></span></span><span class="javascript"> </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"./my-counter.js"</span></span></span><span class="javascript">; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">let</span></span></span><span class="javascript"> counter = </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">new</span></span></span><span class="javascript"> MyCounter(); </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">Object</span></span></span><span class="javascript">.defineProperty(MyWebComp.prototype, </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'counter'</span></span></span><span class="javascript">, { </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">value</span></span></span><span class="javascript">: counter }); customElements.define(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'my-webcomp'</span></span></span><span class="javascript">, MyWebComp); </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  And in the component code, we will subscribe to the value change the <b>updateLabel ()</b> label update method, into which we will add the value display from the global shared counter.  And in the click handler, a direct call to the incremental method. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyWebComp</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTMLElement</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); } connectedCallback() { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> html = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.importNode(myWebCompTemplate.content, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.attachShadow({<span class="hljs-attr"><span class="hljs-attr">mode</span></span>: <span class="hljs-string"><span class="hljs-string">'open'</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shadowRoot.appendChild(html); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateLabel(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.counter.addEventListener(<span class="hljs-string"><span class="hljs-string">'countChanged'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateLabel.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)); } updateLabel() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shadowRoot.querySelector(<span class="hljs-string"><span class="hljs-string">'#helloLabel'</span></span>).textContent = <span class="hljs-string"><span class="hljs-string">'Hello '</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getAttribute(<span class="hljs-string"><span class="hljs-string">'greet-name'</span></span>) + <span class="hljs-string"><span class="hljs-string">' '</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getAttribute(<span class="hljs-string"><span class="hljs-string">'count'</span></span>) + <span class="hljs-string"><span class="hljs-string">' '</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.counter.count; } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> get observedAttributes() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">'count'</span></span>]; } attributeChangedCallback(name, oldValue, newValue) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (name === <span class="hljs-string"><span class="hljs-string">'count'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shadowRoot) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateLabel(); } } } showMessage(event) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setAttribute(<span class="hljs-string"><span class="hljs-string">'count'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getAttribute(<span class="hljs-string"><span class="hljs-string">'count'</span></span>)) + <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.counter.increment(); } }</code> </pre><br>  Despite the fact that each element received two counters, each of its values ‚Äã‚Äãwill be incremented independently, but the value of the shared counter will be the same for both elements, and the individual values ‚Äã‚Äãwill be determined by the number of clicks only on them. <br><br><img src="https://habrastorage.org/webt/pa/hs/kt/pahskt4tkdbbowmovchpejbdv3q.png"><br><br>  Thus, we got direct binding in direct binding and due to the use of events, this value is weak in updating.  Of course, nothing prevents the increment from being implemented through events, by binding the <b>increment ()</b> method to the event‚Äôs lyser: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyCounter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventTarget</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.count = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'increment'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.increment.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)); } increment() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.count++; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dispatchEvent(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomEvent(<span class="hljs-string"><span class="hljs-string">'countChanged'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">detail</span></span>: { <span class="hljs-attr"><span class="hljs-attr">count</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.count } })); } }</code> </pre><br>  and replacing the method call with an event throw: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyWebComp</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTMLElement</span></span></span><span class="hljs-class"> </span></span>{ ... showMessage(event) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setAttribute(<span class="hljs-string"><span class="hljs-string">'count'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getAttribute(<span class="hljs-string"><span class="hljs-string">'count'</span></span>)) + <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.counter.dispatchEvent(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomEvent(<span class="hljs-string"><span class="hljs-string">'increment'</span></span>)); } }</code> </pre><br>  What does it change?  Now, if during the development the <b>increment ()</b> method is removed or changed, the correctness of our code will be violated, but there will be no interpreter errors, i.e.  operability will remain.  This characteristic is called weak connectivity. <br><br>  In development, both direct and weak binding are needed, usually it is customary to implement direct binding inside the logic of one component module, and weak binding between different modules and components to provide flexibility and extensibility of the entire system.  HTML semantics implies a high level of such flexibility, i.e.  preference for weak connectivity, but the application will work more reliably if the connections inside the components are direct. <br><br>  We can hang up handlers in the old fashion and call events on the global <b>document</b> object. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyWebComp</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTMLElement</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); } connectedCallback() { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> html = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.importNode(myWebCompTemplate.content, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.attachShadow({<span class="hljs-attr"><span class="hljs-attr">mode</span></span>: <span class="hljs-string"><span class="hljs-string">'open'</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shadowRoot.appendChild(html); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateLabel(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.counter.addEventListener(<span class="hljs-string"><span class="hljs-string">'countChanged'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateLabel.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'countChanged'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateLabel.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)); } disconnectedCallback() { <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.removeEventListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomEvent(<span class="hljs-string"><span class="hljs-string">'increment'</span></span>)); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.removeEventListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomEvent(<span class="hljs-string"><span class="hljs-string">'countChanged'</span></span>)); } ... showMessage(event) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setAttribute(<span class="hljs-string"><span class="hljs-string">'count'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getAttribute(<span class="hljs-string"><span class="hljs-string">'count'</span></span>)) + <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.counter.dispatchEvent(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomEvent(<span class="hljs-string"><span class="hljs-string">'increment'</span></span>)); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.dispatchEvent(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomEvent(<span class="hljs-string"><span class="hljs-string">'increment'</span></span>)); } }</code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyCounter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventTarget</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.count = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'increment'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.increment.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'increment'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.increment.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)); } increment() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.count++; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dispatchEvent(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomEvent(<span class="hljs-string"><span class="hljs-string">'countChanged'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">detail</span></span>: { <span class="hljs-attr"><span class="hljs-attr">count</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.count } })); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.dispatchEvent(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomEvent(<span class="hljs-string"><span class="hljs-string">'countChanged'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">detail</span></span>: { <span class="hljs-attr"><span class="hljs-attr">count</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.count } })); } }</code> </pre><br>  The behavior is no different, but now we need to think about removing the event handler from the global object if the element itself is removed from the tree.  Fortunately, web components provide us not only design hooks, but also destruction, avoiding memory leaks. <br><br>  There is also one more important point: the events of tree elements can interact with each other through a mechanism called ‚Äúbubbling‚Äù. <br><br>  When the user clicks on our element, the event, having worked on the element itself, starts to be called on the parent like circles on the water, then on the parent of this parent and so on to the root element. <br><br>  At any point in this call chain, the event can be intercepted and processed. <br><br>  This, of course, is not exactly the same event, and its derivatives and contexts, although they will contain links to each other as for example in <b>event.path</b> , will not completely coincide. <br><br>  However, this mechanism allows you to associate child elements with their parents in such a way that this link does not violate engineering patterns, i.e.  without direct links, but only due to their own behavior. <br><br>  In ancient times, this also gave rise to a lot of trouble, when the events of certain elements caused ‚Äúcircles‚Äù or echoes in some sections of the document that were undesirable for reactions. <br><br>  For years, web developers struggled with the ‚Äúpropaganda‚Äù (spreading or surfacing) of events and stopped them and turned them as they could, but for their comfortable use, as in the case with IDs, only the isolation of the shadow tree was lacking. <br><br>  The magic here is that events do not loot outside the Shadow Tree.  But nevertheless, you can catch the event thrown by its children in the host component and roll it up the tree in the form of some other event meaning, well, or just process it. <br><br>  To understand how it all works, we wrap our <b>webcomp</b> elements in a container like this: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">my-webcont</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">count</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">0</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">my-webcomp</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"myWebComp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">greet-name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"John"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">count</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">0</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"this.showMessage(event)"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">my-webcomp</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">my-webcomp</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"myWebComp2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">greet-name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Josh"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">count</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">0</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"this.showMessage(event)"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">my-webcomp</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">my-webcont</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  The container will have this code: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyWebCont</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTMLElement</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); } connectedCallback() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'increment'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateCount.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)); } updateCount(event) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setAttribute(<span class="hljs-string"><span class="hljs-string">'count'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getAttribute(<span class="hljs-string"><span class="hljs-string">'count'</span></span>)) + <span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> get observedAttributes() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">'count'</span></span>]; } attributeChangedCallback(name, oldValue, newValue) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (name === <span class="hljs-string"><span class="hljs-string">'count'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.querySelectorAll(<span class="hljs-string"><span class="hljs-string">'my-webcomp'</span></span>).forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">el</span></span></span><span class="hljs-function">) =&gt;</span></span> { el.setAttribute(<span class="hljs-string"><span class="hljs-string">'count'</span></span>, newValue); }); } } }</code> </pre><br>  In <b>connectedCallback (),</b> we will hang the handler on the <b>increment</b> event, which will throw the children.  The handler will increment the element‚Äôs own counter, and a callback to change its value will go through all the child elements and increment their counters, on which the handlers previously developed by us hang. <br><br>  The code of the child elements will change slightly, in fact, all we need is for the <b>increment</b> event to throw out the element itself and not its aggregates, and do it with the <b>bubbles: true</b> attribute. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyWebComp</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTMLElement</span></span></span><span class="hljs-class"> </span></span>{ ... showMessage(event) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setAttribute(<span class="hljs-string"><span class="hljs-string">'count'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getAttribute(<span class="hljs-string"><span class="hljs-string">'count'</span></span>)) + <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.counter.dispatchEvent(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomEvent(<span class="hljs-string"><span class="hljs-string">'increment'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dispatchEvent(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomEvent(<span class="hljs-string"><span class="hljs-string">'increment'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">bubbles</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> })); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.dispatchEvent(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomEvent(<span class="hljs-string"><span class="hljs-string">'increment'</span></span>)); } }</code> </pre><br><img src="https://habrastorage.org/webt/30/ez/z8/30ezz8bzyeaq2cpksbwn8wmzf2q.png"><br><br>  Now, despite some general randomness, the first element counters will always show the value of the parent.  All together, what we have done here today is certainly not an example to follow, but only an overview of the possibilities and techniques by which you can organize a truly modular interaction between components, avoiding a minimum of tools. <br><br>  You can find the finished code for the reference in the same repository, in the <a href="https://bitbucket.org/techminded/mywebcomp/src/events/">events brunch</a> . </div><p>Source: <a href="https://habr.com/ru/post/461153/">https://habr.com/ru/post/461153/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../461141/index.html">My first day with Haiku: she is unexpectedly good</a></li>
<li><a href="../461143/index.html">On current issues of game design and ways to resolve them. View from below</a></li>
<li><a href="../461145/index.html">What should a team lead: roles, responsibilities and skills</a></li>
<li><a href="../461147/index.html">How to save 64 hours by combining keys in PowerPoint</a></li>
<li><a href="../461151/index.html">From idea to production - Development of IoT project</a></li>
<li><a href="../461155/index.html">Charity Cloud: Migration Guide</a></li>
<li><a href="../461157/index.html">What Feedback Assistant will offer - a developer platform that will replace Bug Reporter</a></li>
<li><a href="../461159/index.html">Ivideon Bridge: how to connect legacy CCTV systems to the cloud</a></li>
<li><a href="../46116/index.html">Officially started selling Grand Theft Auto IV on PC</a></li>
<li><a href="../461161/index.html">Android preferences delegate</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>