<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÄúBlack Holes‚Äù Revealed at macOS High Sierra</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="You live in your life, you do not scratch your turnip, you can‚Äôt blow it. And then suddenly you need to move from the dilapidated iPhone 6 to the bran...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>‚ÄúBlack Holes‚Äù Revealed at macOS High Sierra</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/ay/8p/2d/ay8p2dauct6x-1hz__4sumc98z8.png"><br><br>  You live in your life, you do not scratch your turnip, you can‚Äôt blow it.  And then suddenly you need to move from the dilapidated iPhone 6 to the brand new iPhone X. And since your whole life for the past seven years is stored in photo and old video smartphone, you really do not want to lose this good.  And now you back up your farm through iTunes on a Mac, try to move to a new ‚Äúbalalaika‚Äù and suddenly it turns out that there is no longer any place to backup your phone on your computer‚Äôs hard drive.  You start frantically clearing the <s>Augean stables of the</s> disk space, but the result is ‚Äúmute‚Äù.  Moreover, deleting the ‚Äúleft files‚Äù and clearing the recycle bin does not lead to anything.  Such a thriller recently broke out with Parallels Vice President Nikolai Dobrovolsky.  Under the cut a detective story about the discovery of a ‚Äúblack hole‚Äù in macOS High Sierra, the search for truth and a happy ending that the main characters of the movie ‚ÄúTitanic‚Äù could envy. <a name="habracut"></a><br><br>  Further in colors and pictures from the words of the protagonist, a narration will follow about the ailment and methods of miraculous healing. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/pf/nm/sd/pfnmsdyjnjzuzjskg44jgdqnctu.jpeg"><br><br><h3>  <font color="#cc0000">In search of a "black hole"</font> </h3><br>  Having decided to backup the contents of my new iPhone X via iTunes, I simultaneously needed 70GB of free disk space on my computer.  Without thinking, I deleted most of the unnecessary files.  Films, pictures and other masterpieces of modern art.  I removed it long and painfully.  As a result, instead of the required 70 gigs, more than 100GB was cleared.  I clean the basket.  And what was my surprise when, during subsequent attempts to dig it out, the system showed me a figure of three fingers.  "There is no place, boy, blow into the garden, smoke bamboo."  All subsequent attempts to free up additional disk space and save nothing.  On the one hand there is more than enough space, but on the other hand, it is not there.  Miracles.  "See the gopher?"  Not?  And he is! ".  Classic. <br><br>  Bypassed all fans of Apple, climbed the Russian and overseas forums.  At the first stage, no one added clarity.  What-only versions were not.  From the exotic: ‚ÄúThese are the wrong bees, they make the wrong honey‚Äù to ‚ÄúWait, it will disappear by itself‚Äù.  As time went.  The sore did not disappear.  At the end of the week, it was possible to read at one of the American forums that the APFS (Apple Files System), which materialized recently on macOS High Sierra and the implementation of Time Machine snapshots on it, was to blame.  Today, this is installed on all new laptops by default.  Also, with updates you can roll it. <br><br>  So, this very ‚Äúclever ingot‚Äù when interacting with Time Machine works to put it mildly a little differently.  What happened before?  It used to be a very simple scheme.  There are some extra files on the Mac, you delete them, they go to the trash.  You clean the trash, files are completely deleted, keep free space. <br><br>  Now, with Time Machine turned on and backed up to an external disk or <a href="https://www.apple.com/ru/airport-time-capsule/">Time Capsule</a> on macOS High Sierra and APFS, it starts to sound strange.  In addition to the fact that Time Machine starts backing up data and leaves it on an external disk, it also makes some local backups (Local Snapshots) on the hard disk in which the recent change history is stored.  So that you could theoretically search for the future in the wilds of Time Machine, even if you don‚Äôt have this external disk with backups.  Those.  it not only saves information to an external disk, but also reserves space somewhere and tries to show you what you had in the recent past.  Therefore, there is a situation in which a ‚Äúblack hole‚Äù forms on the hard disk of your computer.  Thus, somewhere in the depths of your computer, additional disk space is reserved.  Moreover, its volume and location in their right mind and sober memory cannot be determined.  Remove and clean this farm in a simple way, you are also unlikely to succeed. <br><br>  Perhaps my situation will seem atypical.  I have a Time Machine backed up on an external drive.  I also have macOS High Sierra and APFS.  But, as they say, you can't throw the words out of the song. <br><br>  So the method of "scientific sticking" revealed that there are certain commands that allow you to manage these very mystical Local Snapshots in macOS High Sierra.  By the way, despite the fact that they write everywhere that if you have ten percent of free space, APFS deletes them by itself, in fact, while you do not clean them with pens, nothing will happen.  They are theoretically once removed, but no predictions and systematics were found in this charitable process. <br><br>  There is a reasonable question, and why would you dear friend found Local Snapshots not immediately removed?  And the garden does not fence?  It's simple.  It is impossible to get to them, because they live in a certain reserved area, where no one has direct access.  "Black Hole", not otherwise.  Through the Finder you can not get there.  This kind of hidden area, which even <a href="https://itunes.apple.com/ru/app/daisydisk/id411643860%3Fmt%3D12">DaisyDisk</a> shows as a system area.  She does not know how to get there, but she knows that she exists. <br><br><h3>  <font color="#cc0000">"Sleight of hand and no fraud" (c).</font> </h3><br>  I propose to proceed to a session of magic with its subsequent exposure.  As they say it is better to see once than hear a hundred times. <br><br>  So, you have a computer with a 128GB hard drive.  Under the hood macOS High Sierra c APFS. <br><img src="https://habrastorage.org/webt/sr/ma/64/srma648tkilqwpxtdshhcxazw-i.png"><br><br>  In order to recreate the situation of lack of disk space, take a <a href="https://support.apple.com/kb/PH22247%3Flocale%3Dru_RU%26viewlocale%3Dru_RU">Disk Image</a> and create three large files of 30 GB each. <br><br><img src="https://habrastorage.org/webt/h3/v4/wc/h3v4wcf4ju2izf22t5dmij_jfew.png"><br><img src="https://habrastorage.org/webt/-d/sf/i5/-dsfi5a8ti7vklbby0z5iwt3lkw.png"><br><img src="https://habrastorage.org/webt/fu/oh/xs/fuohxsu-9y7y5pckkspu2nd19w4.png"><br><img src="https://habrastorage.org/webt/k6/ft/17/k6ft17jrcgtzvokaeedj8elsr_4.png"><br><br>  As we see our files took up more than 103GB.  Full box.  Next we run Time Machine. <br><br><img src="https://habrastorage.org/webt/8u/dh/kx/8udhkxpsrqhywblel7pp31mnmxk.png"><br><br>  At this stage, we understand that for the next backup we need to free up disk space.  We delete unnecessary files.  In this case, remove one of the three disk images on 30GB. <br><br><img src="https://habrastorage.org/webt/70/a1/lu/70a1ludyqk3qzrgozelzha3ip3a.png"><br><br>  Feel free to remove unnecessary, because we also need free space.  Then clean the basket without regrets. <br><br><img src="https://habrastorage.org/webt/uz/cm/wx/uzcmwxtcauxo2hejzvjhu1pfkoc.png"><br><br>  And here you theoretically freed up 30GB of free space.  Let's fill it with a new image of the disk of the appropriate volume. <br><br><img src="https://habrastorage.org/webt/a1/q-/eg/a1q-egkxcj_n4mwscldow1r3agq.png"><br><br>  And, lo and behold!  There is no place. <br><br><img src="https://habrastorage.org/webt/tc/xd/y_/tcxdy_q-3zxfgmvsuvjiv_2wwpg.png"><br><br>  And in the "Documents" and "Basket" no mention of the "ghost file" is not. <br><br><img src="https://habrastorage.org/webt/l6/u2/2j/l6u22jtdia1xhztud7_nwxpx4gg.png"><br><br>  Launch DaisyDisk and see that ‚ÄúHidden Space‚Äù (‚ÄúBlack Hole‚Äù) has formed on our hard disk.  The size of this beauty is similar in volume to the files that we deleted earlier.  I repeat, to understand that there somehow it is problematic to remove it without dancing with tambourines. <br><br><img src="https://habrastorage.org/webt/7j/39/an/7j39anvrqo0szg67hh1bersbidm.png"><br><img src="https://habrastorage.org/webt/di/cv/2x/dicv2xs2rnwbnfbh8unpbmzjlos.png"><br><br>  And here Russian savvy comes to your aid, a few mantras to a computer mother, and here is such a nice script: <br><br>  tmutil listlocalsnapshotdates / |  while read line; <br>  do <br>  tmutil deletelocalsnapshots $ line <br>  done <br><br>  It shows the list of Local Snapshots and deletes them, which can also be done directly by hands at the Terminal: <br><img src="https://habrastorage.org/webt/cb/vr/uk/cbvrukcftjge6b4ri34yzomlkpi.png"><br><img src="https://habrastorage.org/webt/vw/zt/9m/vwzt9mck0t_9t2xus20wajjtjtc.png"><br><br>  For the purity of the experiment, we create a new disk image on 30GB.  We understand that everything is spiky! <br><br><img src="https://habrastorage.org/webt/pf/ls/ks/pflsks-yt4xtetzigcj_9g1goe0.png"><br><br><img src="https://habrastorage.org/webt/i4/du/4z/i4du4zf0p_en9lekdaiztcmnf9k.png"><br><br>  The End! <br><br>  <b>ZY</b>  Write if you have similar problems or even stranger squiggles.  It will be interesting to discuss them in the comments. </div><p>Source: <a href="https://habr.com/ru/post/351128/">https://habr.com/ru/post/351128/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../351114/index.html">How not to get the phone (almost) any beauty in Moscow, or an interesting feature MT_FREE</a></li>
<li><a href="../351116/index.html">Security Basics: Keychain and Hashing</a></li>
<li><a href="../351118/index.html">As i blakecoin miner did</a></li>
<li><a href="../351122/index.html">Dimnie: from geeks with github to corporate accountants</a></li>
<li><a href="../351126/index.html">FastTrack Training. "Network Basics". "The value of Cisco in data centers." Eddie Martin December 2012</a></li>
<li><a href="../351130/index.html">Font (more) Awesome - patterned invention</a></li>
<li><a href="../351132/index.html">Thymeleaf Tutorial: Chapter 6. Iterations</a></li>
<li><a href="../351134/index.html">Low-level code optimization on the Elbrus platform: vector addition uint16_t using intrinsics</a></li>
<li><a href="../351136/index.html">10 nuances that you need to pay attention to when choosing a VPS hosting</a></li>
<li><a href="../351138/index.html">How to optimize DevOps using machine learning</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>