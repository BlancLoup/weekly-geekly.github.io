<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>NTLM-relay reincarnation or how to become a domain administrator in 1 minute</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This post is a logical continuation of the research begun in tyts and tyts . 

 In the first post I wrote about the good old SMB Relay in the context ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>NTLM-relay reincarnation or how to become a domain administrator in 1 minute</h1><div class="post__text post__text-html js-mediator-article">  This post is a logical continuation of the research begun in <a href="http://habrahabr.ru/post/142219/">tyts</a> and <a href="http://habrahabr.ru/post/182954/">tyts</a> . <br><br>  In the first post I wrote about the good old SMB Relay in the context of modern operating conditions. <br>  The second post affected a new technique called SMB Hijacking with which you can execute code even if the outgoing SMB session uses Kerberos. <br><br>  This time we will talk about the next technique, which is based on the classic NTLM Relay. <br><a name="habracut"></a><br>  There is nothing fundamentally new in it, it differs from SMB Relay only in the service to which the data is redirected, but in terms of its impact, this technique is inconceivably superior to its progenitor. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As you remember, in a domain network, the controller is protected from SMB Relay by a rather simple and effective mechanism called SMB Signing, therefore redirection to DC as a third-party host is impossible.  The problem is that one of the central systems of the Active Directory domain, which looks like an LDAP server from the outside, by default does not require the mandatory signature of packets during remote network interaction!  To put it mildly, this is quite a frank backdoor in the system, left for some unknown reason.  Either this is done intentionally for backward compatibility, or Microsoft employees thought that if there are no working exploits, then there is no cause for concern. <br><br>  The lack of tools for NTLM relay on LDAP (Active Directory) is also not entirely clear.  The vector is fairly obvious, but it is covered very poorly, perhaps the researchers simply could not think that a domain controller could be so defenseless in the default configuration. <br><br>  In 2012, at the Blackhat conference, a certain Zack Fasel presented his tool called ZackAttack.  Among the declared functionality, there was also a relay on LDAP.  Despite the rather crude, but in some cases, the work implementation, the main merit of Zack, for me personally, was not the creation of the tool, but the mention of the lack of mandatory signature of packages when working with Active Directory.  It took quite a long time before my hands reached this topic, but it happened and the working implementation of the attack appeared in Intercepter-NG. <br><br>  For the attack requires only one condition: you need to know which computer is currently running the current domain administrator.  The attacker does not even have to be a member of the domain, just connect to the network.  As in the case of other attacks, to speed up the action, a link to the pseudo-web service Interceter, which will require NTLM authorization, is injected into the attacker's traffic.  During the web surfing, the attacker will automatically and imperceptibly send authentication information, which will then be redirected to Active Directory.  As a result of the attack, a new user will be created with Domain Admins rights. <br><br>  The attack was successfully tested on the server operating systems Windows 2003 and 2008R2, but it should also work on Windows 2012, because  The policy ‚ÄúDomain controller: LDAP server signing requirements‚Äù is similarly set to none by default. <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/lexALI8Tphk%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700191,15700253&amp;usg=ALkJrhjHx_jAv7DTGF8V5uzbDHZBIJ3kVw" frameborder="0" allowfullscreen=""></iframe><br><br>  You can try out the attack yourself with the release of the new version of Intercepter-NG, which is scheduled for autumn. </div><p>Source: <a href="https://habr.com/ru/post/226189/">https://habr.com/ru/post/226189/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../226173/index.html">Frontend Developer Speakers' Corner in Minsk, June 17</a></li>
<li><a href="../226175/index.html">The US government is selling at auction 29 thousand Bitcoin seized from Silk Road</a></li>
<li><a href="../226179/index.html">Internet-connected devices</a></li>
<li><a href="../226183/index.html">The history of the creation of cinematics "Enduring". Part one</a></li>
<li><a href="../226185/index.html">Useful and strange: 8 amazing ideas from the world of the Internet of things (+1)</a></li>
<li><a href="../226195/index.html">Plugin for Xcode that automatically checks the accessibility of interfaces in iOS: distribution of free beta versions</a></li>
<li><a href="../226199/index.html">How our books hit the shelves</a></li>
<li><a href="../226201/index.html">Taking pictures from a digital SLR camera (Nikon) from the c # program code</a></li>
<li><a href="../226203/index.html">Analog is becoming increasingly digital</a></li>
<li><a href="../226205/index.html">Vessyl: a smart cup that knows how much and what you drink</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>