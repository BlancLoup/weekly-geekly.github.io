<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Php + Cache + Tags = phpCacheTag</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Once, while reading Habr, I stumbled upon the post of a respected dmitrykoterov about cache and tags, which I really sank into the soul. Once, I was m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Php + Cache + Tags = phpCacheTag</h1><div class="post__text post__text-html js-mediator-article">  Once, while reading Habr, I stumbled upon the <a href="http://habrahabr.ru/blogs/php/57142/">post of a</a> respected <a href="https://habrahabr.ru/users/dmitrykoterov/" class="user_link">dmitrykoterov</a> about cache and tags, which I really sank into the soul.  Once, I was messing with the cache, and also, like so many, I came to the conclusion that he (the cache) really lacks native tags, which would be convenient to cut certain portions of the cache with one line.  Hack, without going into the naming of variables that are listed under these tags.  It is strange that the implementation of this opportunity involved third-party developers, if we talk about the most popular in our memcache. <br><br> <a href="http://code.google.com/p/phpcachetag/"><img src="https://habrastorage.org/getpro/habr/post_images/134/b1b/711/134b1b7116bc7d5717c8d0fccf4511c1.png" alt="phpCacheTag" align="left"></a>  As a result, on my next Saturday-Sunday Kodo-Marathon, I decided, nevertheless, to tackle this issue closely and write a universal library for any cache backend, be it memcache or caching in files in pure php.  The library was written and settled on <a href="http://code.google.com/p/phpcachetag/">googlecode</a> .  Sorry for the English, just below I will try to correct. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The goal was to write gracefully and so that it could easily be implemented on any site, no matter how terrible it was written.  The Singleton pattern was chosen to implement it, as well as exclusively static calls to public methods.  Currently, only memcache is supported, but there is nothing easier to write adapters for other caching systems. <br><br>  Suppose we have a function call <br><blockquote>  $ res = GetMeaningOfLife (true, false, 42); </blockquote><br>  in the depths of which <s>thermonuclear reactions</s> take place very complex calculations.  Accordingly, it is necessary to <s>cut the</s> cache. <br><br>  It all starts with installing a caching system. <br><blockquote>  CacheTag :: SetBackend (CacheTag :: BACKEND_MEMCACHE); </blockquote><br>  Now learn the library to extract data <br><blockquote>  CacheTag :: SetFunction ('GetMeaningOfLife', true, false, 42); </blockquote><br>  By the way, if instead of 'GetMeaningOfLife' you write array ($ UniverseObject, 'GetMeaningOfLife'), the data will be extracted from the GetMeaningOfLife method of the UniverseObject object. <br>  The current cache unit is given its name.  It is formed from the name of the called function / method, function parameters and additional cache parameters, which are described below. <br><br>  Then we label the current cache item with tags. <br><blockquote>  CacheTag :: SetTags (CacheTag :: TAG_PURPOSE, CacheTag :: TAG_LIFE); </blockquote><br>  Tags look like CacheTag :: TAG_YOURTAGNAME, obviously this is just a constant.  They need to work hard to announce themselves in the class settings.  Here, by the way, I foresee the question ‚ÄúWhy are the settings in the classroom?  And in general, why separately, the files two times and obchelsya? ".  The class is easy to inherit.  Tags implemented by the method of constants for convenient autocompletion, array elements would not be that, and indeed in this class all your personal settings are not particularly dependent on the main functionality - for easy and safe updating. <br><br>  It is very (very) important to note that, in fact, we now have in the cache a variable named purpose, or that you set it to TAG_PURPOSE.  In order to fully use the system, we need additional parameters that, in fact, will already identify the values ‚Äã‚Äãof variables in the cache.  Tags simply logically enclose the rest, smaller values ‚Äã‚Äãin groups, convenient for deletion. <br><br>  Like tags, parameters are also constants.  And they look like CacheTag :: PAR_YOURPARNAME.  They serve in order to distinguish one unit of cache from another (evrkika!).  To set a parameter, use the method <br><blockquote>  CacheTag :: SetParam (CacheTag :: PARAM_PAGE, $ currentPageNum); </blockquote><br>  Once again I will note: parameters is not an optional feature.  Without them, the holiday will not be.  And the meaning of the tags disappears, since the variable name is not set explicitly, but is assembled from the specified tags and parameters. <br><br>  There are not rare moments when a bulky function returns a result depending on the current user, or, say, a page with a breakdown of long content (read pagination).  These variables can, in a sneaky way, be taken implicitly by a function, magically ‚Äúcasting‚Äù with the help of global and other tricks.  And the parameters, it is very convenient to indicate before starting the generation of the cache, conveniently and accurately. <br><br>  Now you can take data <br><blockquote>  $ res = CacheTag :: Fetch (); </blockquote><br>  That's all.  What we have in the end: <br><br>  It was <br><blockquote>  $ res = GetMeaningOfLife (true, false, 42); </blockquote><br>  It became <br><blockquote>  // $ res = GetMeaningOfLife (true, false, 42); <br>  CacheTag :: SetFunction ('GetMeaningOfLife', true, false, 42); <br>  CacheTag :: SetTags (CacheTag :: TAG_PURPOSE, CacheTag :: TAG_LIFE); <br>  CacheTag :: SetParam (CacheTag :: PARAM_PAGE, $ currentPageNum); <br>  $ res = CacheTag :: Fetch (); </blockquote><br>  All we needed to do was to comment out the call to the original function and add a couple of lines.  Any additional logic and other if / else. <br>  From now on, the data will be collected by themselves, if they are not in the cache, and stored for a certain time in the config file.  Otherwise, the result will be returned from the cache. <br><br>  If you suddenly need to abandon the cache, turn it off in the settings.  All calls will be forced through the specified functions.  Convulsive find / replace for the entire project is optional. <br><br>  Sooner or later there comes a time when the cache needs to be updated.  Well, for example, if, suddenly, you have <br><blockquote>  new BabyBorn ('boy');  <sup>*</sup> </blockquote><br>  and the meaning of life urgently changed, you progoditsya method <br><blockquote>  CacheTag :: Flush (); </blockquote><br>  It is used instead of CacheTag :: Fetch () ;.  Those.  we set the necessary tags, parameters and variables corresponding to this set will be marked for deletion. <br>  Everything, the past meaning of life is no longer relevant.  At the next appeal, it will be taken again. <br><br>  By the way, practice by beginners, and not very often, programmers to output the generated html-content (print / echo / ...) is often how and where it is necessary, instead of returning it and outputting centrally (I personally think that even ob_ * does not justify ).  Content can be displayed in several places, including functions called from cached.  Such projects, at times, are not easy to cache in standard ways, without a change in their code, what to do if it‚Äôs not scary, you just don‚Äôt want to.  But, praise phpCacheTag, this problem now does not bother us.  In the cache, under the same name both the return value and the content released to the standard stream are stored during the execution of the function / method.  This content will be printed out when queried for this variable, as in the actual operation of a function. <br><br>  Summarizing all the above, we put everything together in the simplest example: <br><br><blockquote>  error_reporting (E_ALL); <br>  require_once ("CacheTag.class.php"); <br><br>  function f () <br>  { <br>  sleep (1); <br>  return 2; <br>  } <br><br>  CacheTag :: SetBackend (CacheTag :: BACKEND_MEMCACHE); <br>  CacheTag :: SetFunction ('f'); <br>  CacheTag :: SetTags (CacheTag :: TAG_PRODUCT); <br>  CacheTag :: SetParam (CacheTag :: PARAM_ID, 2); <br>  CacheTag :: SetTimeout (0.1); <br>  CacheTag :: Fetch (); <br></blockquote><br><br>  Create tag constants, parameters and backends in the config class.  Their values, by the way, are unimportant, the main thing is that they do not overlap. <br><br>  By and large, that's all.  I will try to force myself to be a good programmer and write full-fledged documentation to the whole matter. <br><br>  In the meantime, you are welcome <a href="http://code.google.com/p/phpcachetag/">to try</a> , constructively criticize and bug-report. <br><br>  Happy coding. <br><br><h2>  Updated (August 24, 2010): </h2><br><br>  Version: 0.1.5 <br><ul><li>  Bug: Settings are not reset after calling Flush () </li><li>  Bug: Debag message for Replace () is not displayed </li><li>  Changed: Modified example.php </li><li>  Changed: Modified Fetch () not to access the cache when it is not necessary </li><li>  Changed: It is possible to use a zero time limit </li><li>  Changed: Memcache uses 127.0.0.1 instead of localhost </li></ul><br><br><hr><br><h6>  <sup>*</sup> The BabyBorn class is not part of the library.  If necessary, you can write it yourself. </h6></div><p>Source: <a href="https://habr.com/ru/post/100726/">https://habr.com/ru/post/100726/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../100719/index.html">File Storage for iPhone</a></li>
<li><a href="../100720/index.html">Create a forum on drupal</a></li>
<li><a href="../100721/index.html">Fast commits with git and fortune</a></li>
<li><a href="../100724/index.html">Hell html</a></li>
<li><a href="../100725/index.html">Vkontakte changes</a></li>
<li><a href="../100728/index.html">Web service performance monitoring. Part I</a></li>
<li><a href="../100730/index.html">It is hacked again! iOS 4 - successfully hacked!</a></li>
<li><a href="../100733/index.html">iTunes - I hate you! ..</a></li>
<li><a href="../100734/index.html">Application Licensing Technology Overview</a></li>
<li><a href="../100735/index.html">New social service "Idea for World"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>