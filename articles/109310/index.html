<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>CMS do it yourself. Theory of cycling</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="How many funny guys 
 And everyone makes a bike. 
 And one of them one morning 
 Comes up with gunpowder. 
 Viktor Tsoi. 



 At first, I wanted to wr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>CMS do it yourself. Theory of cycling</h1><div class="post__text post__text-html js-mediator-article">  How many funny guys <br>  And everyone makes a bike. <br>  And one of them one morning <br>  Comes up with gunpowder. <br>  <i>Viktor Tsoi.</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f48/49f/600/f4849f600dc861d93777474f5228c59b.gif" alt="image"><br><br>  At first, I wanted to write an article in the section ‚ÄúI am promoting myself‚Äù about what a young man I was and what a wonderful thing I did, but, searching a little on the net, I discovered without surprise that I was not at all the only one of its kind.  Then I decided to go from the opposite: probably, almost every Web programmer at least once in his life tries to write a full-fledged CMS.  At the same time, in the design process (and this process, often, comes already at the time of writing code), the developer certainly has questions.  With these questions, he turns to the search engines and gets to the sites of those who have already gone through such a rake. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, I began to look at what requests beginner ‚Äúbike developers‚Äù get to me, and tried to highlight some things that were not obvious to me at the beginning of my work. <br><br><a name="habracut"></a><br><br><h4>  1. MVC - our everything! </h4><br>  Wherever the conversation about the development of web applications, the fashionable abbreviation MVC (Model-View-Controller) immediately pops up.  This approach says that the interface should be separated from logic, and logic from data.  I will not say that I am fully imbued with these ideas, but that changes in design (or even designs) should not affect the logic of the code - I am ready to defend myself foaming at the mouth :) <br><br>  This is where the rake number one rests: the appearance must be separated from the logic of the program.  How to do it - everyone decides for himself.  On this issue, the copies are broken quite a bit: here and various template engines, and xslt conversions, and just php + html rendered into separate files.  The choice is large, but the ‚Äúsilver bullet‚Äù, as usual, does not exist: on one side of the scale lies flexibility, on the other - clarity.  Even <a href="http://smarty.net/">Smarty</a> , with its ‚Äúprogramming for the smallest,‚Äù seems difficult to many users.  So if we focus on the user who wants to put the system "out of the box" and file it for their needs with minimal programming knowledge, then it is worth it. <br><br>  In addition, designs should be replaceable and, possibly, even on the fly.  That is, you need to provide for their convenient storage and editing.  And one more thing that many ignored: the design should be easy to edit and update.  If you had to adapt the design of some free forum, consisting of two hundred templates, in which everything is tightly ‚Äúnailed‚Äù by tables and pieces of JavaScript are inserted ‚Äúfrom logic‚Äù, then you understand what you don‚Äôt want to see. <br><br>  I came up with this design: in the user design there is only what is not in the basic design.  That is, in the most minimalist case, the design consists of an empty catalog with the name of the design.  It is clear that in this case the design will look exactly the same as the base one, since all the missing parts will be taken from it, but as a starting point it is very convenient.  If css appears in the design, the system automatically switches to it (while still html borrows from the base one).  The same with JS.  What we get from this: in the user design are only those files that he himself made.  The user does not need to remember which file he corrected, and which one he simply copied from the basic design at the beginning of the work.  Also on the site are displayed almost all the innovations of the basic design without editing the user.  Such a system seemed convenient and logical to me, although to some it seems somewhat unexpected.  Whether to take it into service or come up with your own is up to you. <br><br><h4>  2. Site structure </h4><br>  Start writing a kernel.  What should the core do?  And it should do all the ‚Äúdirty‚Äù work: determine the site settings, the rights and settings of user groups, the used modules, templates, caching parameters, localization, etc.  That is, so that by the time plug-ins started working, they could get all the information of interest from the kernel.  It sounds scary, but all this is relatively easy to write and work if you clearly understand the interaction of elements. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a2f/dba/c04/a2fdbac04daf5a2ddbbe19679e5a3e1a.png" alt="image"><br><br>  I decided for myself that the site would not be a bunch of pages dumped somewhere in the database, but a strict hierarchy.  As a result, the site structure is tree-like and the missing parts, as in the case of designs, are inherited from the parents.  The structure of user groups is also tree-like - the rights and settings are also inherited from the parents.  Localization files and modules also have a simple hierarchy.  A clear hierarchy made it possible to shift all kinds of unpleasant things to the engine, such as automatic generation of a site map, various menus, distribution of rights (yes, yes, to give the right to something to several groups, it is not necessary to edit each one - it‚Äôs enough to define the hierarchy), etc.  Live and rejoice!  And everything would be fine if it were not for the rake: <br><br><h5>  Rakes first.  Caching </h5><br>  While I was engaged in designing my ‚Äúmegadvigka‚Äù it was somehow not up to caching ... Yes, and you think - what is so complicated about it?  I placed the page in a variable, saved it to a file, and next time I showed it from there.  Business ... at any time you can attach!  Oh ... and we have another page for registered users ... Um ... well, think about it - save two pages to the cache!  And in the header you need to output ‚Äúhello, Vasya‚Äù ... well, then this fragment in the header is not to be cached.  and the same fragment in the basement ... and in the middle ... Hmm ... I still need to cache different parts of the page for different periods ... Sit down and rewrite the caching engine and caching for block caching - so that each block has its own lifetime. <br><br><h5>  The second rake.  Caching </h5><br>  How?!  Again caching?  After all, they did everything beautifully!  Well, yes ... they did ... and it even worked until the task arose to generate content for each user based on his personal settings.  The cache size at the same time grows with the speed of a jet fighter, and its contents become obsolete much earlier than will be requested again.  Instead of speeding up the site, we get its slowdown, and gigabytes of useless cached pages ... The main script on the site is ‚Äúhis majesty‚Äù cache invalidator.  Hmm ... rewrite the engine again: this time we implement caching at the database query level, since this is the bottleneck in performance.  Rewrote ... all - nirvana. <br><br><h5>  The third rake.  Caching </h5><br>  You look at your creation and feel like a complete idiot: instead of saving the whole page, every time you create it.  But caching was conceived with precision for the reverse!  How am I so burdock something? <br><br>  The result was that some modules are cached by blocks, and some at the request level.  This allowed for months to store in the cache such rarely changed items as, for example, the menu of the site. <br><br>  I learned the lesson for myself: the system must be initially designed in such a way that at certain stages of execution you have grouped data that can be easily put into the cache or taken from there.  Also, the caching system should not be rigidly tied to the engine, since today it is enough to store the cache in files, and tomorrow (or even tonight) already submit work with the memcache server. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/612/4da/a4b/6124daa4b19d174c403ec703f0dbef0e.png" alt="image"><br><br>  In the process of writing the engine, it also makes sense to read a smart book about refactoring ... or read it after writing the engine.  In any case, all three (you, the engine and the book) can be beneficial. <br><br><h4>  3. Modularity. </h4><br>  The modern system is hard to imagine as a ‚Äúthing in itself‚Äù - it must have interfaces for expanding its functionality.  Thus, we turn to the most delicious part of the CMS - writing modules.  It is also full of questions: how should the module look, how to connect to the system, etc. <br>  In some systems, the call of modules is rigidly registered in the kernel of the system, so if you want to write a module or install a third-party module, then climb into the source code, arm with the installation manual and enter the corresponding calls into the code.  With all the idiocy of the approach, many systems function exactly like that.  There is a variation of this solution: each module is a separate file in a certain directory.  In this case, we get not just the need to register the module into the kernel, but also execute it as a single file.  There were also variants with active templates: that is, they entered {module_name} in the template and when the parser reached this tag, the module module is called for execution, the result of which is in place of the tag.  Perhaps this way is convenient, but in this case we not only did not separate the logic from the presentation, but just the opposite - we mixed them well. <br><br>  After a certain number of cones, I came to a system that, perhaps, is not an example of conciseness and simplicity, but seems to me quite comfortable.  Each module is a separate directory from which the kernel calls only one file (index.php).  This file can both output ‚ÄúHello world!‚Äù And include control files of a hyperspatial quasi-emitter - this will be convenient as a module developer.  In the same directory is an xml file with a description of the parameters of the module, possible settings and the system of rights.  This file is used so that the system can add modules by itself and not shift this headache to the user: clicked the ‚Äúinstall module‚Äù button ‚Äî please receive. <br><br>  With the installation sorted out.  A new problem arises - how not to allow the user to place on one page, say, a photo album and, for example, a forum?  To common sense, hope is useless, so we need typing modules.  A module of this type (for such modules I have peeped on the concept of ‚Äúcomponent‚Äù somewhere) there can be only one on the page. <br><br>  Well, well, there will be only one component on the page, but there may be many others ‚Äî in what order should they be connected?  After all, it would be stupid if a module of a skin switch that at the end of its work transfers the user to the home page of the site connects after it has completed the module for analyzing the dynamics of the number of rabbits in the mating season - and we don‚Äôt see the results of the analysis .  Consequently, the modules must be specified the order of their connection. <br><br>  Some enter for this an analog nix runlevel, where for each module it is necessary to prescribe between which modules it should be connected.  As a user, such a decision plunged me into prostration, but as a developer, I came up with almost the same thing: the modules are divided into three large groups.  One of the groups is the ‚Äúcomponent‚Äù already mentioned, the other two differ only in that the modules of one group are connected before the component, and the other after.  Moreover, I hid this separation from the user, so that only the ‚Äúcomponent‚Äù and ‚Äújust a module‚Äù remained for him. <br><br>  So, the module was designed, the connection was determined ... Now we need to decide how to configure it and how to allow it.  And then everything is simple: since we have the kernel designed for dirty work, then let him have a headache and hurt - the module in xml issued a list of settings, and let the kernel parse it, store it and provide it on request - that's all simply. <br><br>  Another problem I encountered during the development process is data transfer between modules.  According to the conditions of the problem, they do not know anything about each other and are called by the kernel in the order of numbers.  But I want to transfer from one module to another news!  For this, I introduced a special class for global variables, where each module can save something for memory for those who come after it.  This is perhaps not a very elegant solution. <br><br><h4>  4. Updates </h4><br>  You always want to have the latest version, but to make for this a minimum of gestures.  Hence the desire to automate the update process.  And here again there is, albeit not very extensive, but still a zoo of solutions.  The most progressive ones offer to put 777 rights on all directories, and 666 on files, and then ‚Äúthe script will do everything itself‚Äù.  The fact that this is a security hole the size of the Grand Canyon, in general, does not bother anyone. <br><br>  I had ideas regarding two options: the script downloads updates to a temporary directory, and then, after asking the user for the FTP access parameters, updates itself.  So he doesn‚Äôt have to give any extra rights, and everything happens automatically, and updates are chased within the server ... you just have to either ask the user for FTP access parameters every time, or store them right there on the site ... that is, all the eggs are in one basket.  Therefore, I preferred another option: the user himself downloads updates (archive or via svn), uploads them to the site, and the code on the site, feeling that he has become ‚Äúnewer‚Äù makes the necessary corrections to the database and / or settings ... And the first option was more beautiful ... but I did not dare. <br><br>  These are the most memorable milestones of my "bicycle construction".  Reading this, I very much regret that at the beginning of my work I didn‚Äôt meet something like this, and I myself didn‚Äôt have enough experience and bumps to ask the "right" questions.  What I got in the end, you <a href="http://labcms.ru/">can see here</a> and if you have any questions, I am ready to answer them. <br><br>  By the way, if you have any answers to unasked questions, I will also listen to them with pleasure.  After all, experience - it is known, whose son, and it is almost impossible to make all the mistakes alone;) </div><p>Source: <a href="https://habr.com/ru/post/109310/">https://habr.com/ru/post/109310/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../109303/index.html">Microsoft SWIT 2010. Day One</a></li>
<li><a href="../109305/index.html">ABBYY Lingvo dictionaries in e-books</a></li>
<li><a href="../109307/index.html">Ipad cut with waterjet</a></li>
<li><a href="../109308/index.html">Video review of the Windows Phone 7 platform on HTC Mozart</a></li>
<li><a href="../109309/index.html">Google CDN Features</a></li>
<li><a href="../109311/index.html">Microsot SWIT (Day I. Reports 1,2) Oleg Kryuchkov, Igor Shastitko</a></li>
<li><a href="../109313/index.html">WPF 4.0 - Text Display</a></li>
<li><a href="../109314/index.html">Samsung Super PLS Displays</a></li>
<li><a href="../109317/index.html">Hosting Control Panel - WebsitePanel</a></li>
<li><a href="../109318/index.html">Moto CMS will speak in Russian?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>