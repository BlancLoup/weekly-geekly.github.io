<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using the KOMPAS-3D API ‚Üí Lesson 1 ‚Üí Basics</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Designers and engineers are accustomed to working in KOMPAS, manually building drawings, 3D models and assemblies. However, the COMPASS system provide...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using the KOMPAS-3D API ‚Üí Lesson 1 ‚Üí Basics</h1><div class="post__text post__text-html js-mediator-article">  Designers and engineers are accustomed to working in KOMPAS, manually building drawings, 3D models and assemblies.  However, the COMPASS system provides a rich set of functions to automate their work.  If desired, the entire process of building a complex drawing, 3D-model or assembly can be reduced to pressing a single button.  The truth for this will have to work for us, programmers. <br><br>  Within one article it is impossible to describe all the capabilities of KOMPAS for automation.  Even a book is not enough for this.  Fortunately for us, KOMPAS includes documentation, header files for various programming languages, and a number of examples. <br><br><img src="https://habrastorage.org/web/a45/55d/40b/a4555d40b7ac47a0be878efc466320a6.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Sergey Alexandrovich Norseev, Software Engineer, JSC Signal Research Institute, Kovrov, tells.  Author of the book ‚ÄúDevelopment of applications for KOMPAS in Delphi‚Äù <br><a name="habracut"></a><br><br><h2>  <font color="#00B2FF">Documentation and examples</font> </h2><br><br>  The documentation is framed as a single CHM file.  It is located in the KOMPAS directory <i>SDK</i> .  On my home computer, for example, the full path to it looks like this: <i>"C: \ Program Files \ ASCON \ KOMPAS-3D v17 \ SDK \ SDK.chm"</i> .  The figure below shows the contents of this file. <br><br><img src="https://habrastorage.org/web/d85/e57/efc/d85e57efcb304171841050f023a7f892.png"><br><br>  This file contains a complete description of all interfaces, their properties and methods.  In this article we will give only a brief overview of the interaction with KOMPAS through COM interfaces version 5. <br><br>  In addition to the documentation, a large number of programming examples for this system in different programming languages ‚Äã‚Äãare included in the package of KOMPAS.  They are located in the same directory as the documentation.  When you open the <i>‚ÄúSDK‚Äù</i> directory, you will see several archives whose names correspond to programming languages: <i>‚ÄúBasic‚Äù</i> , <i>‚ÄúC #‚Äù</i> , <i>‚Äú ++‚Äù</i> and <i>‚ÄúPascal‚Äù</i> .  They are examples.  We will use the C ++ language, unpack the corresponding archive to any place convenient to you.  C ++ Builder is used as the medium. <br><br><img src="https://habrastorage.org/web/bc5/2c1/77d/bc52c177dab2418bb9c57e486933e724.png"><br><br><h2>  <font color="#00B2FF">Header files</font> </h2><br><br>  Before we begin, we need the header files.  They are located in the <i>‚ÄúSDK \ Include \‚Äù</i> directory.  We need the following files. <br><br>  <i>"Ks_TLB.h"</i> and <i>"Ks_TLB.cpp"</i> .  They contain declarations of all major interfaces.  These are the main files. <br><br>  <i>"KsConstants.h"</i> and <i>"ldefin2D.h"</i> .  These are optional files that define various constants. <br>  After these files are connected to our project, we can start working. <br><br><img src="https://habrastorage.org/web/e11/93c/7a2/e1193c7a2baa45a8ac790e7da5dc40c8.png"><br><br><h2>  <font color="#00B2FF">Connection to COMPASS</font> </h2><br><br>  The KOMPAS system itself in the ‚ÄúAPI of version 5 interfaces‚Äù is described by the <b>KompasObject</b> interface.  The corresponding COM object is specified by the string <b>"KOMPAS.Application.5"</b> .  Below is an example of connecting to KOMPAS. <br><br><pre><code class="hljs ruby">KompasObjectPtr kompas; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  kompas.CreateInstance(L<span class="hljs-string"><span class="hljs-string">"KOMPAS.Application.5"</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   kompas-&gt;Visible = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   kompas.Unbind();</code> </pre> <br><br>  The <b>‚ÄúKompasObjectPtr‚Äù</b> data type sets the pointer to the <b>KompasObject</b> interface. <br><br>  As a result of this program, the main window of the KOMPAS program will appear on the screen.  It will not open a single document. <br><br><img src="https://habrastorage.org/web/519/4c0/c05/5194c0c05abb4b229aa034ed8a9c07b0.png"><br><br>  To close the COMPASS program, use the <b>Quit ()</b> method of the <b>KompasObject</b> interface.  One of the most important methods of the <b>KompasObject</b> interface is the <b>GetParamStruct</b> method.  It returns a pointer to the parameter interface of an object of a particular type.  The requested object type is passed to the method as the value of a single parameter.  In total, according to the KOMPAS documentation, through this method you can get 129 parameter interfaces for objects of various types. <br><br><h2>  <font color="#00B2FF">Drawing and fragment</font> </h2><br><br>  Creating a drawing and a fragment takes place in two stages.  At the first stage, the parameters of the created document are prepared.  On the second - the document itself is created.  This two-step approach is used to create almost all objects in the KOMPAS system. <br><br>  Document parameters are described by the <b>ksDocumentParam</b> interface.  To get a pointer to it, use the <b>KompasObject</b> interface's <b>GetParamStruct method</b> with the <b>ko_DocumentParam</b> parameter.  The main property of this interface is the <b>type</b> property, which indicates the type of document described by this interface. <br><br>  The drawing and fragment are described by the <b>ksDocument2D</b> interface.  You can get a pointer to it using the <b>KompasObject</b> <b>Document2D</b> method.  The following is an example of a program creating a new drawing. <br><br><pre> <code class="hljs haskell"><span class="hljs-type"><span class="hljs-type">KompasObjectPtr</span></span> kompas; //  kompas.<span class="hljs-type"><span class="hljs-type">CreateInstance</span></span>(<span class="hljs-type"><span class="hljs-type">L</span></span><span class="hljs-string"><span class="hljs-string">"KOMPAS.Application.5"</span></span>); //   <span class="hljs-type"><span class="hljs-type">DocumentParamPtr</span></span> <span class="hljs-type"><span class="hljs-type">DocumentParam</span></span>; <span class="hljs-type"><span class="hljs-type">DocumentParam</span></span>=(<span class="hljs-type"><span class="hljs-type">DocumentParamPtr</span></span>)kompas-&gt;<span class="hljs-type"><span class="hljs-type">GetParamStruct</span></span>(ko_DocumentParam); <span class="hljs-type"><span class="hljs-type">DocumentParam</span></span>-&gt;<span class="hljs-type"><span class="hljs-type">Init</span></span>(); <span class="hljs-type"><span class="hljs-type">DocumentParam</span></span>-&gt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> = lt_DocSheetStandart; //:  //  </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Document2DPtr</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Document2D</span></span></span><span class="hljs-class">; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Document2D</span></span></span><span class="hljs-class"> = (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Document2DPtr</span></span></span><span class="hljs-class">)kompas-&gt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Document2D</span></span></span><span class="hljs-class">(); </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Document2D</span></span></span><span class="hljs-class">-&gt;ksCreateDocument(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DocumentParam</span></span></span><span class="hljs-class">); //   kompas-&gt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Visible</span></span></span><span class="hljs-class"> = true; kompas.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Unbind</span></span></span><span class="hljs-class">();</span></span></code> </pre> <br><br>  As a result of this program, the main window of the KOMPAS program will appear on the screen with a new drawing.  This drawing will have neither a frame nor a main inscription, since we have not configured them. <br><br><img src="https://habrastorage.org/web/ffc/947/00c/ffc94700c8a84942a9b61856204e5e6a.png"><br><br>  To create a fragment in the <b>type</b> field of the <b>ksDocumentParam</b> interface, <b>you</b> must specify the value <b>lt_DocFragment</b> .  In all other respects, the process of creating a new fragment is similar to the process of creating a drawing. <br><br><h2>  <font color="#00B2FF">Specification</font> </h2><br><br>  Creating a specification is similar to creating a drawing and a fragment.  Here, too, the <b>ksDocumentParam</b> interface is <b>used</b> .  But there are a number of differences.  First, the specification is described by the <b>ksSpcDocument</b> interface.  A pointer to this interface returns the <b>KompasObject</b> interface's <b>SpcDocument</b> <b>()</b> <b>method</b> .  Secondly, in the case of creating a specification, you must specify the full path to the style library.  If it is not specified, the system will not create a specification.  The style library is the file <i>‚Äúgraphic.lyt‚Äù</i> .  It is located in the <i>Sys \</i> <i>KOMPAS</i> directory.  The following is an example of a program that creates a specification. <br><br><pre> <code class="hljs erlang-repl">//  KompasObjectPtr kompas; kompas.CreateInstance(L<span class="hljs-string"><span class="hljs-string">"KOMPAS.Application.5"</span></span>); //   DocumentParamPtr DocumentParam; DocumentParam=(DocumentParamPtr)kompas-&gt;GetParamStruct(ko_DocumentParam); DocumentParam-&gt;Init(); DocumentParam-&gt;type = lt_DocSpc; //:  //      BSTR str; str = kompas-&gt;ksSystemPath(sptSYSTEM_FILES); SysReAllocString(&amp;str, SysAllocString(L<span class="hljs-string"><span class="hljs-string">"\graphic.lyt"</span></span>)); //     SheetParPtr SheetPar; SheetPar = (SheetParPtr)DocumentParam-&gt;GetLayoutParam(); SheetPar-&gt;Init(); SheetPar-&gt;layoutName = str; //  SpcDocumentPtr SpcDocument; SpcDocument = (SpcDocumentPtr)kompas-&gt;SpcDocument(); SpcDocument-&gt;ksCreateDocument(DocumentParam); //   kompas-&gt;Visible = true; kompas.Unbind();</code> </pre> <br><br>  I make three important points to the above example. <br><ol><li>  To get the path to the <i>Sys</i> directory, we use the <b>KompasObject</b> interface's <b>ksSystemPath method</b> .  This method returns the path to the specified KOMPAS directory. <br></li><li>  COMPASS, however, like all COM objects, operates on <i>BSTR</i> strings.  These lines, just like the <i>wchar_t *</i> strings, are composed of Unicode characters, but have a more complex structure.  An attempt to send a regular Unicode string ( <i>wchar_t *</i> ) to KOMPAS will fail. </li><li>  The path to the style library is specified in the <b>ksSheetPar</b> interface.  This interface sets the design options for the drawing and / or specification. </li></ol><br><br>  As a result of this program, the KOMPAS window with the specification created in it will appear on the screen. <br><br><img src="https://habrastorage.org/web/190/a9e/559/190a9e55933d4c9ab440c2380af2b220.png"><br><br><h2>  <font color="#00B2FF">Detail and assembly</font> </h2><br><br>  The part and assembly in KOMPAS are described by the <b>ksDocument3D</b> interface.  More specifically, this interface describes a file containing a part or assembly.  To obtain a pointer to the <b>ksDocument3D</b> interface <b>,</b> use the <b>Document3D ()</b> method of the <b>KompasObject</b> interface.  The following is an example of creating a part. <br><br><pre> <code class="hljs pgsql">//  KompasObjectPtr kompas; kompas.CreateInstance(L"KOMPAS.Application.5"); //  Document3DPtr Document3D; Document3D = (Document3DPtr)kompas-&gt;Document3D(); Document3D-&gt;<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); //   kompas-&gt;Visible = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; kompas.Unbind();</code> </pre> <br><br>  The <b>Create</b> method of the <b>ksDocument3D</b> interface has two input parameters.  They are listed below. <br><ol><li>  Sign of the document editing mode ( <i>TRUE</i> - invisible mode; <i>FALSE</i> - visible). </li><li>  The type of file to be created ( <i>TRUE</i> - part; <i>FALSE</i> - assembly). </li></ol><br><br>  This shows that to create an assembly in the above example, you just need to change the value of the second parameter in the <b>Create</b> method. <br><br><img src="https://habrastorage.org/web/ef7/b77/c6a/ef7b77c6aad94633a07932f7668e9bd1.png"><br><br>  <b>Conclusion</b> <br><br>  In this article, I showed a small part of the tip of the iceberg called ‚Äúinteraction with the COMPASS system through COM interfaces‚Äù.  I just showed how to connect to KOMPASU and how to create documents of all basic types (drawing, fragment, specification, detail and assembly).  These documents are created without content.  How to fill them will be discussed in the following articles.  Follow the news blog. <br><br>  <a href="https://habrahabr.ru/company/ascon/blog/330588/"><b>The second part of.</b></a> <br><br> <a href=""><img src="https://habrastorage.org/web/595/eee/f27/595eeef271b24830b3578751fcb52716.png"></a>  Sergey Norseev, author of the book ‚ÄúDevelopment of applications for KOMPAS in Delphi‚Äù. </div><p>Source: <a href="https://habr.com/ru/post/328088/">https://habr.com/ru/post/328088/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../328078/index.html">Working with Dunno - Proactive Reading Technologies and Hybrid Storage</a></li>
<li><a href="../328080/index.html">‚ÄúRunn Me!‚Äù - tells us another PHP framework *. And heard "Throw Me!". Part 2</a></li>
<li><a href="../328082/index.html">Stress test teams: how to make a GPU benchmark and do not overheat</a></li>
<li><a href="../328084/index.html">On the issue of restrictions</a></li>
<li><a href="../328086/index.html">Distributed data structures [part 1, overview]</a></li>
<li><a href="../328090/index.html">.NET API in web development: past and future</a></li>
<li><a href="../328092/index.html">CI & CD Fengshun Automation with Jenkins and Jira</a></li>
<li><a href="../328094/index.html">Learn and love Xdebug</a></li>
<li><a href="../328096/index.html">Why is your email list ineffective?</a></li>
<li><a href="../328098/index.html">Headquarters Touch Instinct. Tour of the St. Petersburg office</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>