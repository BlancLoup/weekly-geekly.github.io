<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Berkeley DB STL Interface</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr. Not so long ago, for one of my projects, an embedded database was needed, which would store the elements in the form of a key-value, provide...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Berkeley DB STL Interface</h1><div class="post__text post__text-html js-mediator-article"><p>  Hi, Habr.  Not so long ago, for one of my projects, an embedded database was needed, which would store the elements in the form of a key-value, provide support for transactions, and, optionally, encrypt data.  After a brief search, I came across a <a href="https://www.oracle.com/database/technologies/related/berkeleydb.html">Berkeley DB</a> project.  In addition to the features I need, this database provides an STL-compatible interface that allows you to work with the database as you would with an ordinary (almost ordinary) STL container.  Actually, this interface will be discussed below. </p><a name="habracut"></a><br><h2 id="berkeley-db">  Berkeley db </h2><br><p>  <strong>Berkeley DB</strong> is an embedded, scalable, high-performance, open source database.  It is available free of charge for use in <strong>open source</strong> projects, but for proprietary there are significant limitations.  Supported features: </p><br><ul><li>  transactions </li><li>  proactive log for failover recovery </li><li>  <strong>AES</strong> data <strong>encryption</strong> </li><li>  replication </li><li>  indexes </li><li>  synchronization tools for multi-threaded applications </li><li>  access policy - one writer, many readers </li><li>  caching </li></ul><br><p>  And so many others. </p><br><p>  When the system is initialized, the user can specify which subsystems to use.  This allows you to eliminate the waste of resources on such operations as transactions, logging, locks, when they are not needed. </p><br><p>  The choice of storage structure and data access is available: </p><br><ul><li>  <strong>Btree</strong> - implementation of sorted balanced tree </li><li>  <strong>Hash</strong> - linear hash implementation </li><li>  <strong>Heap</strong> - for storage uses <em>heap file</em> , logically paginated.  Each entry is identified by a page and an offset within it.  The storage is organized in such a way that the deletion of the record does not require compaction.  This allows you to use it with a lack of physical space. </li><li>  <strong>Queue</strong> - a queue that stores records of fixed length with a logical number as a key.  It is designed for quick insertion at the end, and supports a special operation that deletes and returns an entry from the head of the queue in one call. </li><li>  <strong>Recno</strong> - allows you to save records of both fixed and variable length with a logical number as a key.  Provides access to an item by its index. </li></ul><br><p>  To avoid ambiguity, it is necessary to define several concepts that are used in the description of the work of <strong>Berkeley DB</strong> . </p><br><p>  <em>Database</em> - <em>data</em> store in the form of a key-value.  An analogue of <em>the</em> <strong>Berkeley DB</strong> database in other DBMS is a table. </p><br><p>  <em>The database environment</em> is a wrapper for one or more <em>databases</em> .  It defines general settings for all <em>databases</em> , such as cache size, file storage paths, use and configuration of locking, transaction, and logging subsystems. </p><br><p>  In a typical use case, an <em>environment</em> is created and configured, and in it one or more <em>databases</em> . </p><br><h2 id="stl-interfeys">  STL interface </h2><br><p>  <strong>Berkeley DB</strong> is a library written in <strong>C.</strong>  It has binding to languages ‚Äã‚Äãsuch as <strong>Perl</strong> , <strong>Java</strong> , <strong>PHP</strong> and others.  The interface for <strong>C ++</strong> is a shell over <strong>C</strong> code with objects and inheritance.  In order to make it possible to access the database in the same way as operations with <strong>STL-</strong> containers, there is an <strong>STL-</strong> interface, like an add-in over <strong>C ++</strong> .  Graphically, the layers of interfaces look like this: </p><br><p><img src="https://habrastorage.org/webt/k9/0u/gw/k90ugwajcb5xsts9zxn7e6urjew.png"></p><br><p> For <strong>example</strong> , an <strong>STL</strong> interface allows you to retrieve an item from a database by key (for <strong>Btree</strong> or <strong>Hash</strong> ) or by index (for <strong>Recno</strong> ), similarly to containers <code>std::map</code> or <code>std::vector</code> , to find an element in the database through the standard algorithm <code>std::find_if</code> , iterate over the entire database through the <code>foreach</code> .  All classes and functions of the <strong>Berkeley DB</strong> <strong>STL</strong> interface are in the <strong>dbstl</strong> namespace, for short, the <strong>dbstl</strong> will <strong>also</strong> be understood as the <strong>STL</strong> interface. </p><br><h2 id="ustanovka">  Installation </h2><br><p>  The database supports most <strong>Linux</strong> <strong>platforms</strong> , <strong>Windows</strong> , <strong>Android</strong> , <strong>Apple iOS</strong> , etc. </p><br><p>  For <strong>Ubuntu 18.04</strong> , install the following packages: </p><br><ul><li>  libdb5.3-stl-dev </li><li>  libdb5.3 ++ - dev </li></ul><br><p>  To build from source for <strong>Linux,</strong> you must install <a href="https://www.gnu.org/software/autoconf/autoconf.html">autoconf</a> and <a href="https://www.gnu.org/software/libtool/libtool.html">libtool</a> .  The latest version of the source code can be found <a href="https://www.oracle.com/technetwork/database/database-technologies/berkeleydb/downloads/index.html">at the link</a> . </p><br><p>  For example, I downloaded the archive with version <strong>18.1.32</strong> - db-18.1.32.zip.  It is necessary to unpack the archive and go to the source folder: </p><br><pre> <code class="plaintext hljs">unzip db-18.1.32.zip cd db-18.1.32</code> </pre> <br><p>  Next, move to the <strong>build_unix</strong> directory and run the build and installation: </p><br><pre> <code class="plaintext hljs">cd build_unix ../dist/configure --enable-stl --prefix=/home/user/libraries/berkeley-db make make install</code> </pre> <br><h2 id="dobavlenie-v-cmake-proekt">  Add to cmake project </h2><br><p>  To illustrate examples with <strong>Berkeley DB,</strong> use the <a href="https://github.com/sqglobe/BerkeleyDBSamples">BerkeleyDBSamples</a> project. </p><br><p>  The structure of the project is as follows: </p><br><pre> <code class="plaintext hljs">+-- CMakeLists.txt +-- sample-usage | +-- CMakeLists.txt | +-- sample-map-usage.cpp | +-- submodules | +-- cmake | | +-- FindBerkeleyDB</code> </pre> <br><p>  The root <a href="https://github.com/sqglobe/BerkeleyDBSamples/blob/master/CMakeLists.txt">CMakeLists.txt</a> describes the general parameters of the project.  Source files with examples are in <a href="https://github.com/sqglobe/BerkeleyDBSamples/tree/master/sample-usage">sample-usage</a> .  <a href="https://github.com/sqglobe/BerkeleyDBSamples/blob/master/sample-usage/CMakeLists.txt">sample-usage / CMakeLists.txt</a> searches for libraries, determines the assembly of examples. </p><br><p>  <a href="https://gitlab.com/sum01/FindBerkeleyDB">FindBerkeleyDB</a> is used in the examples to connect the library to the <strong>cmake</strong> project.  It is added as a <strong>git</strong> submodule in <a href="https://github.com/sqglobe/BerkeleyDBSamples/tree/master/submodules/cmake">submodules / cmake</a> .  Build may require <code>BerkeleyDB_ROOT_DIR</code> .  For example, for the library above installed from source, you need to specify the <strong>cmake</strong> flag <code>-DBerkeleyDB_ROOT_DIR=/home/user/libraries/berkeley-db</code> . </p><br><p>  In the root <a href="https://github.com/sqglobe/BerkeleyDBSamples/blob/master/CMakeLists.txt">CMakeLists.txt</a> file, add the path to the <strong>FindBerkeleyDB</strong> module to the <strong>CMAKE_MODULE_PATH</strong> : </p><br><pre> <code class="plaintext hljs">list(APPEND CMAKE_MODULE_PATH "${CMAKE_CURRENT_SOURCE_DIR}/submodules/cmake/FindBerkeleyDB")</code> </pre> <br><p>  After that in <a href="https://github.com/sqglobe/BerkeleyDBSamples/blob/master/sample-usage/CMakeLists.txt">sample-usage / CMakeLists.txt</a> the library is searched in the standard way: </p><br><pre> <code class="plaintext hljs">find_package(BerkeleyDB REQUIRED)</code> </pre> <br><p>  Next, add the executable file and link it with the library <strong>Oracle :: BerkeleyDB</strong> : </p><br><pre> <code class="plaintext hljs">add_executable(sample-map-usage "sample-map-usage.cpp") target_link_libraries(sample-map-usage PRIVATE Oracle::BerkeleyDB ${CMAKE_THREAD_LIBS_INIT} stdc++fs)</code> </pre> <br><h2 id="prakticheskiy-primer">  Practical example </h2><br><p>  To demonstrate the use of <strong>dbstl, let</strong> ‚Äôs analyze a simple example from <a href="">sample-map-usage.cpp</a> .  This application demonstrates working with the <code>dbstl::db_map</code> in a single-threaded program.  The container itself is similar to <code>std::map</code> and stores data as a key / value pair.  <strong>Btree</strong> or <strong>Hash</strong> can be used as the underlying database structure.  Unlike <code>std::map</code> , for the <code>dbstl::db_map&lt;std::string, TestElement&gt;</code> actual value type is <code>dbstl::ElementRef&lt;TestElement&gt;</code> .  This type is returned, for example, for <code>dbstl::db_map&lt;std::string, TestElement&gt;::operator[]</code> .  It defines methods for storing an object of type <code>TestElement</code> in the database.  One of these methods is <code>operator=</code> . </p><br><p>  In the example, working with the database is as follows: </p><br><ul><li>  The application calls <strong>Berkeley DB</strong> data access methods. </li><li>  these methods access the cache for reading or writing </li><li>  if necessary, the file is directly accessed </li></ul><br><p>  Graphically, this process is shown in the figure: </p><br><p><img src="https://habrastorage.org/webt/xm/em/or/xmemorwh73yw9mnue-h1lp0gmbo.png"></p><br><p>  To reduce the complexity of the example, it does not use exception handling.  Some <strong>dbstl</strong> container <strong>methods</strong> may throw exceptions when errors occur. </p><br><h2 id="razbor-koda">  Parsing code </h2><br><p>  To work with <strong>Berkeley DB,</strong> you need to connect two header files: </p><br><pre> <code class="plaintext hljs">#include &lt;db_cxx.h&gt; #include &lt;dbstl_map.h&gt;</code> </pre> <br><p>  The first one adds the primitives of the <strong>C ++</strong> interface, and the second one defines the classes and functions for working with the database, as with the associative container, as well as many utility methods.  <strong>The STL</strong> interface is located in the <strong>dbstl</strong> namespace. </p><br><p>  For storage, the <strong>Btree</strong> structure is <strong>used</strong> , the key is <code>std::string</code> , and the value is the custom structure <code>TestElement</code> : </p><br><pre> <code class="plaintext hljs">struct TestElement{ std::string id; std::string name; };</code> </pre> <br><p>  In the <code>main</code> function, we initialize the library by calling <code>dbstl::dbstl_startup()</code> .  It must be located before the first use of primitives <strong>STL-</strong> interface. </p><br><p>  After that, we initialize and open <em>the database environment</em> in the directory specified by the <code>ENV_FOLDER</code> variable: </p><br><pre> <code class="plaintext hljs">auto penv = dbstl::open_env(ENV_FOLDER, 0u, DB_INIT_MPOOL | DB_CREATE);</code> </pre> <br><p>  The <code>DB_INIT_MPOOL</code> flag <code>DB_INIT_MPOOL</code> responsible for initializing the caching subsystem, <code>DB_CREATE</code> for creating all the necessary media files.  The same team registers this object in the resource manager.  He is responsible for closing all registered objects (it also records database objects, cursors, transactions, etc.) and clearing dynamic memory.  If you already have a <em>database environment</em> object and need only register it with the resource manager, you can use the <code>dbstl::register_db_env</code> function. </p><br><p>  A similar operation is performed with <em>the database</em> : </p><br><pre> <code class="plaintext hljs">auto db = dbstl::open_db(penv, "sample-map-usage.db", DB_BTREE, DB_CREATE, 0u);</code> </pre> <br><p>  The data will be written to disk in the <strong>sample-map-usage.db file</strong> , which will be created in the absence (thanks to the <code>DB_CREATE</code> flag) in the <code>ENV_FOLDER</code> directory.  Tree is used for storage (parameter <code>DB_BTREE</code> ). </p><br><p>  In <strong>Berkeley DB,</strong> keys and values ‚Äã‚Äãare stored as an array of bytes.  To use a custom type (in our case, <code>TestElement</code> ), you must specify functions for: </p><br><ul><li>  get the number of bytes for object storage; </li><li>  marshaling an object to an array of bytes; </li><li>  unmarshaling </li></ul><br><p>  In the example, this functional is performed by static methods of the <code>TestMarshaller</code> class.  It <code>TestElement</code> objects in memory, as follows: </p><br><ul><li>  The length of the <code>id</code> field is copied to the beginning of the buffer. </li><li>  next byte is the content of the <code>id</code> field. </li><li>  after it the size of the <code>name</code> field is copied </li><li>  then the content from the <code>name</code> field is placed </li></ul><br><p><img src="https://habrastorage.org/webt/ko/ad/ul/koaduleknjbnfvapxlo6wff4qvm.png"></p><br><p>  We describe the functions of <code>TestMarshaller</code> : </p><br><ul><li>  <code>TestMarshaller::restore</code> - fills the <code>TestElement</code> object with data from the buffer </li><li>  <code>TestMarshaller::size</code> - returns the size of the buffer, which is required to save the specified object. </li><li>  <code>TestMarshaller::store</code> - saves the object in the buffer. </li></ul><br><p>  To register marshaling / <code>dbstl::DbstlElemTraits</code> functions, use <code>dbstl::DbstlElemTraits</code> : </p><br><pre> <code class="plaintext hljs">dbstl::DbstlElemTraits&lt;TestElement&gt;::instance()-&gt;set_size_function(&amp;TestMarshaller::size); dbstl::DbstlElemTraits&lt;TestElement&gt;::instance()-&gt;set_copy_function(&amp;TestMarshaller::store); dbstl::DbstlElemTraits&lt;TestElement&gt;::instance()-&gt;set_restore_function( &amp;TestMarshaller::restore );</code> </pre> <br><p>  Initialize the container: </p><br><pre> <code class="plaintext hljs">dbstl::db_map&lt;std::string, TestElement&gt; elementsMap(db, penv);</code> </pre> <br><p>  This is how copying elements from <code>std::map</code> into the created container looks like: </p><br><pre> <code class="plaintext hljs">std::copy( std::cbegin(inputValues), std::cend(inputValues), std::inserter(elementsMap, elementsMap.begin()) );</code> </pre> <br><p>  But in this way you can print the contents of the database to the standard output: </p><br><pre> <code class="plaintext hljs">std::transform( elementsMap.begin(dbstl::ReadModifyWriteOption::no_read_modify_write(), true), elementsMap.end(), std::ostream_iterator&lt;std::string&gt;(std::cout, "\n"), [](const auto data) -&gt; std::string { return data.first + "=&gt; { id: " + data.second.id + ", name: " + data.second.name + "}"; });</code> </pre> <br><p>  A call to the <code>begin</code> method in the example above looks a bit unusual: <code>elementsMap.begin(dbstl::ReadModifyWriteOption::no_read_modify_write(), true)</code> . <br>  This design is used to get an iterator <em>read-only</em> .  <strong>dbstl</strong> does not define the <code>cbegin</code> method, instead it uses the <code>readonly</code> parameter (the second in a row) in the <code>begin</code> method.  You can also use a <em>constant</em> container <em>reference</em> to get an <em>read-only</em> iterator.  Such an iterator allows only a read operation, it will throw an exception when writing. </p><br><p>  Why is the code above using <em>read-only</em> iterator?  First, <em>only a</em> read operation through an iterator is performed.  Secondly, the documentation states that it has <em>better</em> performance than the regular version. </p><br><p>  Adding a new key / value pair, or, if the key already exists, updating the value is as easy as in <code>std::map</code> : </p><br><pre> <code class="plaintext hljs">elementsMap["added key 1"] = {"added id 1", "added name 1"};</code> </pre> <br><p>  As mentioned above, the <code>elementsMap["added key 1"]</code> introduction returns a wrapper class for which <code>operator=</code> is redefined, the subsequent call of which directly saves the object in the database. </p><br><p>  If you need to insert an item into the container: </p><br><pre> <code class="plaintext hljs">auto [iter, res] = elementsMap.insert( std::make_pair(std::string("added key 2"), TestElement{"added id 2", "added name 2"}) );</code> </pre> <br><p>  Calling <code>elementsMap.insert</code> returns <code>std::pair&lt;,  &gt;</code> .  If the object cannot be inserted, the <em>success flag</em> will be <strong>false</strong> .  Otherwise, <em>the success flag</em> is <strong>true</strong> , and the <em>iterator</em> points to the inserted object. </p><br><p>  Another way to find a value by key is to use the <code>dbstl::db_map::find</code> method, similar to <code>std::map::find</code> : </p><br><pre> <code class="plaintext hljs">auto findIter = elementsMap.find("test key 1");</code> </pre> <br><p>  Through the resulting iterator, you can access the key - <code>findIter-&gt;first</code> , the fields of the element <code>TestElement</code> - <code>findIter-&gt;second.id</code> and <code>findIter-&gt;second.name</code> .  To extract a <em>key</em> / <em>value</em> pair <em>,</em> use the dereference operator - <code>auto iterPair = *findIter;</code>  . </p><br><p>  When applying to the iterator a dereference operator ( <strong>*</strong> ) or access to a class member ( <strong>-&gt;</strong> ), the database is accessed and data is extracted from it.  Moreover, previously extracted data, even if they were modified, are erased.  This means that in the example below, the changes made on the iterator will be discarded and the value stored in the database will be output to the console. </p><br><pre> <code class="plaintext hljs">findIter-&gt;second.id = "skipped id"; findIter-&gt;second.name = "skipped name"; std::cout &lt;&lt; "Found elem for key " &lt;&lt; "test key 1" &lt;&lt; ": id: " &lt;&lt; findIter-&gt;second.id &lt;&lt; ", name: " &lt;&lt; findIter-&gt;second.name &lt;&lt; std::endl;</code> </pre> <br><p>  To avoid this, you need to get the wrapper of the stored object from the iterator by calling <code>findIter-&gt;second</code> and save it to a variable.  Next, make all changes on this wrapper, and write the result to the database by calling the <code>_DB_STL_StoreElement</code> wrapper <code>_DB_STL_StoreElement</code> : </p><br><pre> <code class="plaintext hljs">auto ref = findIter-&gt;second; ref.id = "new test id 1"; ref.name = "new test name 1"; ref._DB_STL_StoreElement();</code> </pre> <br><p>  It is even easier to update the data - just get the wrapper with the <code>findIter-&gt;second</code> instruction and assign the required <code>TestElement</code> object to <code>TestElement</code> , as in the example: </p><br><pre> <code class="plaintext hljs">if(auto findIter = elementsMap.find("test key 2"); findIter != elementsMap.end()){ findIter-&gt;second = {"new test id 2", "new test name 2"}; }</code> </pre> <br><p>  Before the end of the program, you must call <code>dbstl::dbstl_exit();</code>  to close and delete all registered objects in the resource manager. </p><br><h2 id="v-zaklyuchenii">  In custody </h2><br><p>  This article provides a brief overview of the basic features of <strong>dbstl</strong> containers <strong>using</strong> the example of <code>dbstl::db_map</code> in a simple single-threaded program.  This is only a small introduction, and features such as transactionalism, locks, resource management, exception handling, and execution in a multithreaded environment are not considered here. </p><br><p>  I did not intend to describe in detail the methods and their parameters, for this it is better to refer to the relevant documentation on the <a href="https://docs.oracle.com/database/bdb181/html/api_reference/CXX/frame_main.html">C ++ interface</a> and on the <a href="https://docs.oracle.com/database/bdb181/html/api_reference/STL/frame_main.html">STL interface</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/459862/">https://habr.com/ru/post/459862/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../45985/index.html">Chrome will support extensions.</a></li>
<li><a href="../459850/index.html">Amateur radio technology: how I ordered the installation of a PCB in a Chinese factory</a></li>
<li><a href="../459852/index.html">The practice of using the lottie library in the bank‚Äôs mobile application</a></li>
<li><a href="../459858/index.html">Research of modern Malware Cerberus for Android</a></li>
<li><a href="../459860/index.html">Configure ClickHouse for integration testing in gitlab-ci</a></li>
<li><a href="../459866/index.html">Solving a task with pwnable.kr 02 - collision. Hash collision</a></li>
<li><a href="../459870/index.html">Sample Model-View-Update Architecture on F #</a></li>
<li><a href="../459872/index.html">Patton Jeff. User stories. The art of agile software development</a></li>
<li><a href="../459874/index.html">You have something to hide</a></li>
<li><a href="../459878/index.html">7 tips to optimize CSS to speed up page loading</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>