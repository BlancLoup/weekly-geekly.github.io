<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Japanese QtQuick Crosswords</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I like to prototype something in my free time. This allows you to learn something new. This prototype is a client for the http://www.nonograms.ru/ res...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Japanese QtQuick Crosswords</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/files/14c/5a6/66d/14c5a666d9444ff4b7231d473792b644.png" alt="Skull and Bones, KDPV"></p><br><p>  I like to prototype something in my free time.  This allows you to learn something new.  This prototype is a client for the <a href="http://www.nonograms.ru/">http://www.nonograms.ru/</a> resource, the developer of which is Cast Iron <a href="https://habrahabr.ru/users/kyberprizrak/" class="user_link">K.A</a> / <a href="https://habrahabr.ru/users/kyberprizrak/" class="user_link">KyberPrizrak</a> /.  All code is available on <a href="https://github.com/RPG-18/yang">GiHub</a> .  On the C ++ side, working with HTML, the gallery model.  On the QtQuick side, visualization. </p><br><p>  This time I decided to pick it up: </p><br><ul><li>  <a href="http://doc.qt.io/qt-5/qobject.html">Q_GADGET</a> and its use in Qml; </li><li>  is there life without Qt WebKit; </li><li><p>  pick <em>Qt Labs Controls</em> . </p><br><p>  What is done: </p><br></li><li>  crossword gallery; </li><li>  solving a crossword puzzle. </li></ul><br><p>  Under the cat will be considered: </p><br><ul><li>  screenshots; </li><li>  how to get HTML without Qt WebKit; </li><li>  how to make a crossword puzzle without Canvas. </li></ul><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Screenshots</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/files/208/547/e20/208547e20187416287fe2e1a06e19291.jpg" alt="gallery"><br><img src="https://habrastorage.org/files/f5f/260/d5f/f5f260d5f2d34e678d381466b0ff82af.jpg" alt="Menu"></p></div></div><br><h2>  We do without Qt WebKit </h2><br><p>  The site gives a crossword in the form of a matrix: </p><br><pre><code class="hljs lua">var d=<span class="hljs-string"><span class="hljs-string">[[571,955,325,492], [6,53,49,55], [47,18,55,65], ...]]</span></span></code> </pre> <br><p>  Further JS squeaks create html crossword code.  The WebKit module has been marked as <strong>deprecated</strong> .  In exchange, it is proposed to use the Web Engine module based on the Chrome project. </p><br><p>  Here a slight disappointment awaits.  The Web Engine has no DOM API on the page.  To parse the HTML code, I had to use third-party tools ( <a href="https://habrahabr.ru/post/280270/">Parsim HTML in C ++ and Gumbo</a> ). <br>  But we can load the page, render and get the necessary HTML. </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">QString </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getHtml</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QUrl&amp; url)</span></span></span><span class="hljs-function"> </span></span>{ QWebEnginePage page; QEventLoop loop; QObject::connect(&amp;page, &amp;QWebEnginePage::loadFinished, &amp;loop, &amp;QEventLoop::quit); page.load(url); loop.exec(); QTimer::singleShot(<span class="hljs-number"><span class="hljs-number">1000</span></span>, &amp;loop, &amp;QEventLoop::quit); QString html; page.toHtml([&amp;html, &amp;loop](<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QString&amp; data){ html = data; loop.quit(); }); loop.exec(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> html; }</code> </pre> <br><p>  <em>QTimer :: singleShot</em> here is used to wait for the page to complete.  The <em>toHtml</em> method <em>is</em> asynchronous and accepts a callback function as an input parameter to get the result. </p><br><h2>  Building a crossword puzzle </h2><br><p><img src="https://habrastorage.org/files/5dc/5f6/31b/5dc5f631b7364fc68359d4ea3c9df636.jpg" alt="Crossword puzzle"><br>  Crossword decided to present as a set of columns and lines.  At the top, 10 columns are circled in red, each of size 3. Three lines are circled on the left, each one is 3. Then the code will operate on these values. </p><br><p>  Crossword can be done in several ways: </p><br><ul><li>  draw on C ++; </li><li>  draw on JS and Canvas; </li><li>  build from base elements (Item, Rectangle, MouseArea, etc.) </li></ul><br><p>  I chose the last option. </p><br><div class="spoiler">  <b class="spoiler_title">Full code</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> QtQuick <span class="hljs-number"><span class="hljs-number">2.5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Qt.labs.controls <span class="hljs-number"><span class="hljs-number">1.0</span></span> Item { clip:<span class="hljs-keyword"><span class="hljs-keyword">true</span></span> property <span class="hljs-type"><span class="hljs-type">int</span></span> margin: <span class="hljs-number"><span class="hljs-number">20</span></span> property <span class="hljs-type"><span class="hljs-type">int</span></span> fontSize: <span class="hljs-number"><span class="hljs-number">12</span></span> property <span class="hljs-type"><span class="hljs-type">int</span></span> ceilSize: <span class="hljs-number"><span class="hljs-number">20</span></span>; property <span class="hljs-type"><span class="hljs-type">int</span></span> incCeilSize: ceilSize + <span class="hljs-number"><span class="hljs-number">1</span></span> property color borderColor: "#424242" property <span class="hljs-type"><span class="hljs-type">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">rows</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; property <span class="hljs-type"><span class="hljs-type">int</span></span> rowSize: <span class="hljs-number"><span class="hljs-number">0</span></span>; property <span class="hljs-type"><span class="hljs-type">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">column</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; property <span class="hljs-type"><span class="hljs-type">int</span></span> columnSize: <span class="hljs-number"><span class="hljs-number">0</span></span>; implicitHeight : crossGrid.height+margin*<span class="hljs-number"><span class="hljs-number">2</span></span> implicitWidth : crossGrid.width+margin*<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> loadFromNonogramsOrg(url) { console.log("Load:"+url); crossword.formNanogramsOrg(url); } <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> showOnlyNaturalNumber(val) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> val &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ? val: " "; } <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> drawCrossword(){ var csize = crossword.size; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(csize.<span class="hljs-keyword"><span class="hljs-keyword">column</span></span>() === <span class="hljs-number"><span class="hljs-number">0</span></span> || csize.<span class="hljs-keyword"><span class="hljs-keyword">rows</span></span>() === <span class="hljs-number"><span class="hljs-number">0</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } console.log(csize.<span class="hljs-keyword"><span class="hljs-keyword">column</span></span>() + "x" + csize.<span class="hljs-keyword"><span class="hljs-keyword">rows</span></span>()); hRepeater.model = <span class="hljs-number"><span class="hljs-number">0</span></span>; rRepeater.model = <span class="hljs-number"><span class="hljs-number">0</span></span>; rowSize = crossword.rowSize(); columnSize = crossword.columnSize(); <span class="hljs-keyword"><span class="hljs-keyword">rows</span></span> = csize.<span class="hljs-keyword"><span class="hljs-keyword">rows</span></span>(); column = csize.<span class="hljs-keyword"><span class="hljs-keyword">column</span></span>(); hRepeater.model = crossword.columnSize()*csize.<span class="hljs-keyword"><span class="hljs-keyword">column</span></span>(); rRepeater.model = crossword.rowSize()*csize.<span class="hljs-keyword"><span class="hljs-keyword">rows</span></span>(); bgImg.visible = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } Image{ id: bgImg asynchronous: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> visible: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> height: parent.height width: parent.width source:"qrc:/wall-paper.jpg" } Grid { id: crossGrid anchors.centerIn: parent <span class="hljs-keyword"><span class="hljs-keyword">columns</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> spacing: <span class="hljs-number"><span class="hljs-number">2</span></span> rowSpacing: <span class="hljs-number"><span class="hljs-number">0</span></span> columnSpacing: <span class="hljs-number"><span class="hljs-number">0</span></span> Rectangle{ id:topLeftItm width: rowSize * ceilSize height:columnSize * ceilSize border.width: <span class="hljs-number"><span class="hljs-number">1</span></span> border.color: borderColor color: "transparent" } Grid { id: cGrid <span class="hljs-keyword"><span class="hljs-keyword">rows</span></span>: columnSize <span class="hljs-keyword"><span class="hljs-keyword">columns</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">column</span></span> Repeater { id: hRepeater model: <span class="hljs-number"><span class="hljs-number">0</span></span> Item { width: ceilSize; height: ceilSize property <span class="hljs-type"><span class="hljs-type">int</span></span> rw : Math.floor(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">column</span></span>) property <span class="hljs-type"><span class="hljs-type">int</span></span> cn : Math.floor(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>%<span class="hljs-keyword"><span class="hljs-keyword">column</span></span>) property <span class="hljs-type"><span class="hljs-type">int</span></span> prw: rw+<span class="hljs-number"><span class="hljs-number">1</span></span> property <span class="hljs-type"><span class="hljs-type">int</span></span> pcm: cn+<span class="hljs-number"><span class="hljs-number">1</span></span> Rectangle{ height: (prw % <span class="hljs-number"><span class="hljs-number">5</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) || (prw == columnSize) ? ceilSize : incCeilSize width: (pcm % <span class="hljs-number"><span class="hljs-number">5</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) ? ceilSize : incCeilSize color: "transparent" border.width: <span class="hljs-number"><span class="hljs-number">1</span></span> border.color: borderColor <span class="hljs-type"><span class="hljs-type">Text</span></span> { anchors.centerIn: parent <span class="hljs-type"><span class="hljs-type">text</span></span>:showOnlyNaturalNumber( crossword.columnValue(cn,rw)); font{ <span class="hljs-keyword"><span class="hljs-keyword">family</span></span>: mandarinFont.name pixelSize: fontSize } } } } } } Grid { id: rGrid <span class="hljs-keyword"><span class="hljs-keyword">rows</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">rows</span></span> <span class="hljs-keyword"><span class="hljs-keyword">columns</span></span>: rowSize Repeater { id: rRepeater model: <span class="hljs-number"><span class="hljs-number">0</span></span> Item { width: ceilSize; height: ceilSize property <span class="hljs-type"><span class="hljs-type">int</span></span> rw : Math.floor(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>/rowSize) property <span class="hljs-type"><span class="hljs-type">int</span></span> cn : Math.floor(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>%rowSize) property <span class="hljs-type"><span class="hljs-type">int</span></span> prw: rw+<span class="hljs-number"><span class="hljs-number">1</span></span> property <span class="hljs-type"><span class="hljs-type">int</span></span> pcn: cn+<span class="hljs-number"><span class="hljs-number">1</span></span> Rectangle{ height: prw % <span class="hljs-number"><span class="hljs-number">5</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span> ? ceilSize : incCeilSize width: (pcn % <span class="hljs-number"><span class="hljs-number">5</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) || (pcn == rowSize) ? ceilSize : incCeilSize color: "transparent" border.width: <span class="hljs-number"><span class="hljs-number">1</span></span> border.color: borderColor <span class="hljs-type"><span class="hljs-type">Text</span></span> { anchors.centerIn: parent <span class="hljs-type"><span class="hljs-type">text</span></span>:showOnlyNaturalNumber( crossword.rowValue(rw,cn)); font{ <span class="hljs-keyword"><span class="hljs-keyword">family</span></span>: mandarinFont.name pixelSize: fontSize } } } } } } Rectangle{ id: playingField width: <span class="hljs-keyword"><span class="hljs-keyword">column</span></span> * ceilSize height:<span class="hljs-keyword"><span class="hljs-keyword">rows</span></span> * ceilSize border.width: <span class="hljs-number"><span class="hljs-number">1</span></span> border.color: borderColor color: "transparent" Grid{ <span class="hljs-keyword"><span class="hljs-keyword">rows</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">rows</span></span> <span class="hljs-keyword"><span class="hljs-keyword">columns</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">column</span></span> Repeater { id: bRepeater model: <span class="hljs-keyword"><span class="hljs-keyword">rows</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">column</span></span> Item { id: ceilItm width: ceilSize; height: ceilSize property <span class="hljs-type"><span class="hljs-type">int</span></span> rw : Math.floor(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">column</span></span>) property <span class="hljs-type"><span class="hljs-type">int</span></span> cn : Math.floor(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>%<span class="hljs-keyword"><span class="hljs-keyword">column</span></span>) state: "default" Rectangle{ id: itmRec height: (rw+<span class="hljs-number"><span class="hljs-number">1</span></span>) % <span class="hljs-number"><span class="hljs-number">5</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span> ? ceilSize : incCeilSize width: (cn+<span class="hljs-number"><span class="hljs-number">1</span></span>) % <span class="hljs-number"><span class="hljs-number">5</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span> ? ceilSize : incCeilSize color: "transparent" border.width: <span class="hljs-number"><span class="hljs-number">1</span></span> border.color: borderColor } <span class="hljs-type"><span class="hljs-type">Text</span></span>{ id: itmTxt visible:<span class="hljs-keyword"><span class="hljs-keyword">false</span></span> height: parent.height width: parent.width font.pixelSize: ceilSize horizontalAlignment: <span class="hljs-type"><span class="hljs-type">Text</span></span>.AlignHCenter verticalAlignment: <span class="hljs-type"><span class="hljs-type">Text</span></span>.AlignVCenter <span class="hljs-type"><span class="hljs-type">text</span></span>:"+" rotation:<span class="hljs-number"><span class="hljs-number">45</span></span> } MouseArea { anchors.fill: parent onClicked: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(parent.state == "default"){ parent.state = "SHADED"; }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(parent.state == "SHADED"){ parent.state = "CLEAR"; }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ parent.state = "default"; } } } states: [ State{ <span class="hljs-type"><span class="hljs-type">name</span></span>:"SHADED" PropertyChanges { target: itmRec; color: "black"; } PropertyChanges { target: itmTxt; visible: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } }, State{ <span class="hljs-type"><span class="hljs-type">name</span></span>:"CLEAR" PropertyChanges { target: itmRec; color: "transparent"; } PropertyChanges { target: itmTxt; visible: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } ] } } } } } <span class="hljs-type"><span class="hljs-type">Text</span></span>{ visible: bgImg.visible anchors{ right: parent.right rightMargin: <span class="hljs-number"><span class="hljs-number">10</span></span> bottom: parent.bottom } <span class="hljs-type"><span class="hljs-type">text</span></span>:qsTr("Source: ")+"www.nonograms.ru" font{ <span class="hljs-keyword"><span class="hljs-keyword">family</span></span>: hanZiFont.name pixelSize: <span class="hljs-number"><span class="hljs-number">12</span></span> } } Connections { target: crossword onLoaded: { drawCrossword(); } } }</code> </pre> </div></div><br><p>  The basis is represented by Item, the size of which is calculated from the size of the <em>crossGrid</em> and the size of the indent ( <em>margin</em> ) </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">Item</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">clip</span></span>:true implicitHeight : crossGrid.height+margin*<span class="hljs-number"><span class="hljs-number">2</span></span> implicitWidth : crossGrid.width+margin*<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> Image{ id: bgImg asynchronous: true visible: false height: parent.height width: parent.width source:<span class="hljs-string"><span class="hljs-string">"qrc:/wall-paper.jpg"</span></span> } <span class="hljs-selector-tag"><span class="hljs-selector-tag">Grid</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">id</span></span>: crossGrid anchors.centerIn: parent columns: <span class="hljs-number"><span class="hljs-number">2</span></span> spacing: <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } }</code> </pre> <br><p>  <strong>CrossGrid</strong> element </p><br><p><img src="https://habrastorage.org/files/c87/49e/6c0/c8749e6c02b94b7baa9b06310176d3cd.jpg" alt="crossGrid"></p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">Grid</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">id</span></span>: crossGrid anchors.centerIn: parent columns: <span class="hljs-number"><span class="hljs-number">2</span></span> spacing: <span class="hljs-number"><span class="hljs-number">2</span></span> rowSpacing: <span class="hljs-number"><span class="hljs-number">16</span></span> columnSpacing: <span class="hljs-number"><span class="hljs-number">16</span></span> Rectangle{ id:topLeftItm color: <span class="hljs-string"><span class="hljs-string">"transparent"</span></span> border.width: <span class="hljs-number"><span class="hljs-number">1</span></span> border.color: borderColor <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } <span class="hljs-selector-tag"><span class="hljs-selector-tag">Grid</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">id</span></span>: cGrid <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } <span class="hljs-selector-tag"><span class="hljs-selector-tag">Grid</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">id</span></span>: rGrid <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } <span class="hljs-selector-tag"><span class="hljs-selector-tag">Rectangle</span></span>{ <span class="hljs-attribute"><span class="hljs-attribute">id</span></span>: playingField <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } }</code> </pre> <br><p>  <strong>topLeftItm a</strong> rectangle that fills the space.  <strong>cGrid</strong> and <strong>rGrid</strong> describe the grid with numbers.  <strong>playingField</strong> field to solve crossword. </p><br><h3>  Grid construction </h3><br><p>  If you write this: </p><br><pre> <code class="hljs pgsql">Grid { id: cGrid <span class="hljs-keyword"><span class="hljs-keyword">rows</span></span>: columnSize <span class="hljs-keyword"><span class="hljs-keyword">columns</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">column</span></span> Repeater { id: hRepeater <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> Item { width: ceilSize; height: ceilSize Rectangle{ height: ceilSize width: ceilSize color: "transparent" border.width: <span class="hljs-number"><span class="hljs-number">1</span></span> border.color: borderColor <span class="hljs-type"><span class="hljs-type">Text</span></span> { anchors.centerIn: parent <span class="hljs-type"><span class="hljs-type">text</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> font{ <span class="hljs-keyword"><span class="hljs-keyword">family</span></span>: mandarinFont.name pixelSize: fontSize } } } } } }</code> </pre> <br><p>  then we get a doubling of the line </p><br><p><img src="https://habrastorage.org/files/ed0/e6a/fbf/ed0e6afbf48844e2ac4ded805cdd7df2.jpg" alt="double line"></p><br><p>  To remove the doubling of the line, use the trick with the size of <em>Item</em> and <em>Rectangle</em> .  Item size is fixed so that all elements are located exactly in the repeater.  <em>The rectangle is</em> wider and taller by one, depending on the need for a double line. </p><br><pre> <code class="hljs pgsql">Repeater { id: hRepeater model: <span class="hljs-number"><span class="hljs-number">0</span></span> Item { width: ceilSize; height: ceilSize property <span class="hljs-type"><span class="hljs-type">int</span></span> rw : Math.floor(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">column</span></span>) property <span class="hljs-type"><span class="hljs-type">int</span></span> cn : Math.floor(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>%<span class="hljs-keyword"><span class="hljs-keyword">column</span></span>) property <span class="hljs-type"><span class="hljs-type">int</span></span> prw: rw+<span class="hljs-number"><span class="hljs-number">1</span></span> property <span class="hljs-type"><span class="hljs-type">int</span></span> pcm: cn+<span class="hljs-number"><span class="hljs-number">1</span></span> Rectangle{ height: (prw % <span class="hljs-number"><span class="hljs-number">5</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) || (prw == columnSize) ? ceilSize : incCeilSize width: (pcm % <span class="hljs-number"><span class="hljs-number">5</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) ? ceilSize : incCeilSize color: "transparent" border.width: <span class="hljs-number"><span class="hljs-number">1</span></span> border.color: borderColor <span class="hljs-type"><span class="hljs-type">Text</span></span> { anchors.centerIn: parent <span class="hljs-type"><span class="hljs-type">text</span></span>:showOnlyNaturalNumber( crossword.columnValue(cn,rw)); font{ <span class="hljs-keyword"><span class="hljs-keyword">family</span></span>: mandarinFont.name pixelSize: fontSize } } } } }</code> </pre> <br><p>  Here, on the basis of the index, the row ( <em>rw</em> ) and column ( <em>cn</em> ) are calculated, incremented by one, the remainder of the division by 5 is taken. That is,  every 5 cells, the width or height of the Rectangle and Item are the same, which doubles the line. </p><br><h4>  Crossword puzzle </h4><br><p>  From the field, we need a grid and click processing.  We introduce the state of the grid cell: </p><br><ul><li>  inactive ( <strong>default</strong> ); </li><li>  shaded ( <strong>SHADED</strong> ); </li><li>  marked empty ( <strong>clear</strong> ). </li></ul><br><p>  We will begin with the inactive state and change on a mouse click in the following sequence <br><img src="https://habrastorage.org/files/c27/500/7e2/c275007e290f44b19466e43a2af111c7.jpg" alt="State graph"></p><br><p>  Cell drawing code: </p><br><pre> <code class="hljs mel">Item { id: ceilItm width: ceilSize; height: ceilSize property <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rw : Math.<span class="hljs-keyword"><span class="hljs-keyword">floor</span></span>(index/column) property <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cn : Math.<span class="hljs-keyword"><span class="hljs-keyword">floor</span></span>(index%column) state: <span class="hljs-string"><span class="hljs-string">"default"</span></span> Rectangle{ id: itmRec height: (rw+<span class="hljs-number"><span class="hljs-number">1</span></span>) % <span class="hljs-number"><span class="hljs-number">5</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span> ? ceilSize : incCeilSize width: (cn+<span class="hljs-number"><span class="hljs-number">1</span></span>) % <span class="hljs-number"><span class="hljs-number">5</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span> ? ceilSize : incCeilSize <span class="hljs-keyword"><span class="hljs-keyword">color</span></span>: <span class="hljs-string"><span class="hljs-string">"transparent"</span></span> border.width: <span class="hljs-number"><span class="hljs-number">1</span></span> border.<span class="hljs-keyword"><span class="hljs-keyword">color</span></span>: borderColor } Text{ id: itmTxt visible:false height: <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>.height width: <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>.width font.pixelSize: ceilSize horizontalAlignment: Text.AlignHCenter verticalAlignment: Text.AlignVCenter <span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-string"><span class="hljs-string">"+"</span></span> rotation:<span class="hljs-number"><span class="hljs-number">45</span></span> } MouseArea { anchors.fill: <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span> onClicked: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>.state == <span class="hljs-string"><span class="hljs-string">"default"</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>.state = <span class="hljs-string"><span class="hljs-string">"SHADED"</span></span>; }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>.state == <span class="hljs-string"><span class="hljs-string">"SHADED"</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>.state = <span class="hljs-string"><span class="hljs-string">"CLEAR"</span></span>; }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>.state = <span class="hljs-string"><span class="hljs-string">"default"</span></span>; } } } states: [ State{ name:<span class="hljs-string"><span class="hljs-string">"SHADED"</span></span> PropertyChanges { target: itmRec; <span class="hljs-keyword"><span class="hljs-keyword">color</span></span>: <span class="hljs-string"><span class="hljs-string">"black"</span></span>; } PropertyChanges { target: itmTxt; visible: false; } }, State{ name:<span class="hljs-string"><span class="hljs-string">"CLEAR"</span></span> PropertyChanges { target: itmRec; <span class="hljs-keyword"><span class="hljs-keyword">color</span></span>: <span class="hljs-string"><span class="hljs-string">"transparent"</span></span>; } PropertyChanges { target: itmTxt; visible: true; } } ] }</code> </pre> <br><p>  <strong>The itmTxt</strong> element adds a cross to the cell, displaying it as marked empty.  Here we use the ability to describe different states through <em>states</em> . <br>  <strong>MouseArea</strong> makes the transition.  That is why everything was started.  No calculations (converting mouse coordinates to grid cells), no manual redrawing. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/283474/">https://habr.com/ru/post/283474/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../283456/index.html">Save Firefox</a></li>
<li><a href="../283458/index.html">End-to-end encryption, now it's just</a></li>
<li><a href="../283468/index.html">DevConf-2016: master classes program</a></li>
<li><a href="../283470/index.html">Let's get acquainted: the company Align Technology</a></li>
<li><a href="../283472/index.html">How data centers are changing right now: Data center technology solutions</a></li>
<li><a href="../283476/index.html">50 sociopaths in a live-action role-playing game: Gibson's Neuronomicon and its mechanics</a></li>
<li><a href="../283478/index.html">Communication 2016: what's interesting?</a></li>
<li><a href="../283480/index.html">NFC - to the masses. New technologies at Eurovision, music and sports venues</a></li>
<li><a href="../283482/index.html">Once again about how not to make a ‚Äúsieve‚Äù from your network</a></li>
<li><a href="../283484/index.html">Errors when connecting payments on the Internet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>