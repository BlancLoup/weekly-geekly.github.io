<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Introduction to the development of WinRT applications in HTML / JavaScript. Improving data handling</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article continues the series of materials ( first part , second part ), devoted to the basics of developing WinRT applications on HTML / JS for W...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Introduction to the development of WinRT applications in HTML / JavaScript. Improving data handling</h1><div class="post__text post__text-html js-mediator-article">  <i>This article continues the series of materials ( <a href="http://habrahabr.ru/company/microsoft/blog/163443/">first part</a> , <a href="http://habrahabr.ru/company/microsoft/blog/163813/">second part</a> ), devoted to the basics of developing WinRT applications on HTML / JS for Windows 8. In this part we will try to improve the reliability of receiving and the quality of data display, and also talk a little about contracts.</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ae7/41f/e51/ae741fe51685125f823f3125aaf9ba51.png"><br><br>  Let me remind you that in the previous part we stopped at the fact that we learned how to get data from external RSS feeds and changed the data display styles for various application states, including the snapped mode. <br><a name="habracut"></a><br><h3>  Data output restriction </h3><br>  If you try to trace once again how the data is received and displayed, you will easily notice that we do not limit them in any way.  The application receives data feeds from RSS as input, converts them into an internal structure used to link the data, and then projects them into the collection on the screen.  In fact, we immediately see all the data right from the first screen. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote>  I note that a feature of this solution is that, in fact, we always have on hand all the available information.  In a complex project with a large amount of data, perhaps server logic and the presence of special APIs, it would most likely make sense to request data as needed, loading only the headers first.  But that's another story.  :) </blockquote><br><br>  Ultimately, in our case, instead of showing quickly and completely the whole picture of the latest events, for which it would be sufficient to display the 6-8 last records, we immediately bring down the entire news flow to the user.  A large set of data also does not allow you to quickly switch to neighboring groups - you have to scroll for too long (looking too far ahead, I will say that this problem is partially smoothed by Semantic Zoom). <br><br>  Thus, our first priority is to limit the flow of data on the first screen. <br><br>  To do this, open the <b>pages \ groupedItems \ groupedItems.js file</b> . <br><br>  At the beginning of the function in the variable area, create two more: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> groupedItems; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tilesLimit = <span class="hljs-number"><span class="hljs-number">6</span></span>;</code> </pre> <br><br>  In the first, we will store the filtered collection.  The second one indicates how many tiles can be displayed (ideally, these parameters should be put into separate configuration files or similar data structures describing the project parameters). <br><br>  Next, find the following line: <br><br><pre> <code class="javascript hljs">_initializeLayout: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">listView, viewState</span></span></span><span class="hljs-function">) </span></span>{</code> </pre> <br><br>  This function is called when the page is initialized and prescribes what data to display on the screen depending on the display mode used.  The data source is a global <b>Data</b> object, described in the <b>data.js</b> file. <br><br>  Add at the beginning of the function the following lines: <br><br><pre> <code class="javascript hljs"> groupedItems = Data.items.createFiltered(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> item.index &lt; tilesLimit; }).createGrouped( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">groupKeySelector</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> item.group.key; }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">groupDataSelector</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> item.group; } );</code> </pre> <br><br>  Let me remind you that the <b>Data</b> property of the <b>Data</b> object contains a collection of data ( <a href="http://msdn.microsoft.com/en-us/library/windows/apps/hh700774.aspx">WinJS.Binding.List</a> ), grouped by belonging to certain RSS feeds. <br><br>  To filter the data, we take this collection and leave only elements whose index is less than our limit, and then re-group the collection in accordance with the groups. <br><br><blockquote>  <b>Note</b> : in this case, we explicitly limit the number of elements to six (tilesLimit), however, in general, this is the wrong approach.  On a large monitor, the number of tiles may be less than desired, besides, lonely hanging tiles may appear at the end of the list.  The most correct: dynamically calculate the limit depending on the available space. </blockquote><br><br>  Later in the same function, replace the references to <b>Data</b> and <b>Data.items below</b> with the variable <b>groupedItems</b> : <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (viewState === appViewState.snapped) { listView.itemDataSource = groupedItems.groups.dataSource; listView.groupDataSource = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; listView.layout = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ui.ListLayout(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { listView.itemDataSource = groupedItems.dataSource; listView.groupDataSource = groupedItems.groups.dataSource; listView.layout = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ui.GridLayout({ <span class="hljs-attr"><span class="hljs-attr">groupHeaderPosition</span></span>: <span class="hljs-string"><span class="hljs-string">"top"</span></span> }); }</code> </pre> <br><br><blockquote>  <b>Note</b> : Be careful with other Data entries on this page.  In this case, we do not change them, as they are used in the transition to the internal pages, and above we just made a data filter.  But in general, if you change the source of the data, it may need to be changed everywhere, or, more correctly, take out the layer of work with the data separately. </blockquote><br><br>  Run the project: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/446/9be/545/4469be54533b7b934aaf87e74ce2b7aa.png"><br><br>  Fine!  Now we immediately see all the freshest. <br><br><h3>  Check Internet connection </h3><br>  The next important point: make sure that the application behaves correctly in the absence of an Internet connection.  If you try to start the current version of the application with the network disconnected, for example, by turning on Airplane mode, it should cause an error due to the inability to download the necessary stream.  (Perhaps they had time to cache, so for the reliability of the experiment, you can connect any other threads.) <br><br>  In addition, if the stream is unavailable, there will also be a problem. <br><br>  To check the availability of the Internet, open the <b>js \ data.js file</b> and <i>add the</i> following function to it: <br><br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isInternetConnection</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> connectionProfile = Windows.Networking.Connectivity.NetworkInformation.getInternetConnectionProfile(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (connectionProfile != <span class="hljs-literal"><span class="hljs-literal">null</span></span>); }</code> </pre> <br><br>  Here we refer to WinRT to find out the current network status.  This is already good information, although it does not give a 100% guarantee that there is really access to the Internet and the right stream. <br><br>  Now let's <i>add a</i> function that will display an error message if there are problems: <br><br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showConnectionError</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">msg, donotexit</span></span></span><span class="hljs-function">) </span></span>{ msg = (msg != <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) ? msg : <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> messageDialog = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Windows.UI.Popups.MessageDialog(msg, <span class="hljs-string"><span class="hljs-string">"Can not connect"</span></span>); messageDialog.commands.append(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Windows.UI.Popups.UICommand(<span class="hljs-string"><span class="hljs-string">"Ok"</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)); messageDialog.showAsync().done(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">command</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!donotexit &amp;&amp; command.id == <span class="hljs-number"><span class="hljs-number">1</span></span>) { MSApp.terminateApp({ <span class="hljs-attr"><span class="hljs-attr">number</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">stack</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">description</span></span>: <span class="hljs-string"><span class="hljs-string">"No internet connection"</span></span> }); } }); }</code> </pre><br>  This function, using the WinRT API, displays the specified error message and, by default, if donotexit is not set (or it is false), the application terminates. <br><br><blockquote>  <b>Note</b> : in a real application, the behavior logic may differ.  For example, an application may intentionally cache data or prompt the user to try downloading the streams from the server again if there was a temporary loss of the connection. </blockquote><br><br>  Next step: start the connection check, for this <i>replace the</i> line <br><br><pre> <code class="javascript hljs"> list = getBlogPosts(list);</code> </pre> <br><br>  to the following: <br><br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tryUpdateData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isInternetConnection()) { list = getBlogPosts(list); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { showConnectionError(<span class="hljs-string"><span class="hljs-string">"Please check your internet connection. "</span></span>); } }; tryUpdateData();</code> </pre> <br><br>  In fact, we wrapped the data conversion into an Internet connection check.  If not, the application displays an error message and closes: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9d6/9da/fac/9d69dafac69e0008b94dd178284715c9.png"><br><br>  Now let's go back to the <b>getBlogPosts</b> function.  Here, too, there is the likelihood of receiving an error, for example, if an RSS feed has stopped working, in this case our XHR wrapper will cause an exception that needs to be intercepted. <br><br>  Try replacing one of the links in RSS with an incorrect one and launch the application (here we assume that the server‚Äôs response will be the corresponding incorrect link). <br><br>  To handle an exception, in the Promise description, you need to add a function that is called when an error occurs.  Immediately after the internal anonymous function function (response) {...} <i>add</i> a comma separated: <br><br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) </span></span>{ showConnectionError(<span class="hljs-string"><span class="hljs-string">"Can't get rss updates for "</span></span> + feed.title + <span class="hljs-string"><span class="hljs-string">". Used source: "</span></span> + feed.url, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); }</code> </pre> <br><br>  In this case, we display an error message, but do not close the application: it is possible that other threads will be processed normally. <br><br>  Try to make one of the links incorrect and start the application: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2af/67b/9a1/2af67b9a10b1478f66d6ef4f3361545b.png"><br><br>  Hooray!  Now we can please the user with malicious messages.  Here I want to repeat once again an important thought: such informing the user is just a half-measure.  Ideally, you need to cache data and inform the user about the presence of connection problems in a less disruptive way.  See for example how Bing News works in Windows 8. <br><br><h3>  Share information </h3><br>  Finally, in this article, we will learn how to share information from an application to the outside, using contracts of general access (sharing) and printing. <br><br>  Open the <b>pages \ itemDetail \ itemDetail.js file</b> .  Add a variable to hold the event handler at the beginning: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sharingHandler;</code> </pre> <br><br>  <i>Add</i> also at the beginning or near the end (outside WinJS.UI.Pages.define ()) the following functions: <br><br>  1. <b>setupSharing</b> - registration for data transfer <br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupSharing</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dataTransferManager = Windows.ApplicationModel.DataTransfer.DataTransferManager.getForCurrentView(); sharingHandler = onSharingDataRequested.bind(item); dataTransferManager.addEventListener(<span class="hljs-string"><span class="hljs-string">"datarequested"</span></span>, sharingHandler); }</code> </pre> <br><br>  Here we access the data transfer manager through WinRT and hang the data request event handler. <br><br>  2. <b>onSharingDataRequested</b> - event for processing the request <br><br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSharingDataRequested</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request = e.request; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> text = item.title; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item.link) { text += <span class="hljs-string"><span class="hljs-string">"\n\r"</span></span> + item.link; request.data.setUri(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Windows.Foundation.Uri(item.link)); } request.data.properties.title = text; request.data.properties.description = <span class="hljs-string"><span class="hljs-string">"Some awesome news on Windows!"</span></span>; request.data.setText(text); }</code> </pre> <br><br>  Here we describe what data we transmit to the recipient application: link, text, etc.  (Details of the data transfer can be found here: <a href="http://msdn.microsoft.com/ru-ru/library/windows/apps/hh758314.aspx">sharing content and receiving it</a> ). <br><br>  Inside the <b>ready</b> function, at the very end, add a call to register for contract support: <br><br><pre> <code class="javascript hljs"> setupSharing(item);</code> </pre> <br><br>  Run the application, go to the post and through the charm buttons panel, try to transfer the news to another application: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/676/071/313/676071313303807b2e4502893153d316.png"><br><br>  It remains to add another very important detail.  If you try to return to the level above (leave the current page) and use the sharing contract (Sharing), you will see that it still ‚Äúresponds‚Äù and offers the user several options to choose from.  This is not what we would expect as a proper application behavior. <br><br>  To prevent this from happening, you need to reset the event handlers in the data transfer manager.  This can be done at the entrance to each page, or vice versa at the exit.  Add the following function: <br><br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearContracts</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dataTransferManager = Windows.ApplicationModel.DataTransfer.DataTransferManager.getForCurrentView(); dataTransferManager.removeEventListener(<span class="hljs-string"><span class="hljs-string">"datarequested"</span></span>, sharingHandler); }</code> </pre> <br><br>  Here we simply remove the corresponding event handler.  To call a function after the description of the <b>ready</b> property, separated by commas, add a function for <b>unload</b> : <br><br><pre> <code class="javascript hljs"> unload: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ clearContracts(); }</code> </pre> <br><br>  Done, now data transfer works only where it should work. <br><br><h3>  We print articles </h3><br><br>  Now let's add print support.  First of all, it should be noted that by default your application does not know how to print.  To submit documents for printing, the system printing contract ( <a href="http://msdn.microsoft.com/ru-ru/library/windows/apps/hh465225.aspx">Print</a> ) is available to users through the ‚ÄúDevices‚Äù wonder-button: <br><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a79/c19/ba4/a79c19ba43dc3c419caf7046e40a36f7.png"><br><br>  To add the ability to print in the same <b>pages \ itemDetail \ itemDetail.js file</b> (this is our print context), you must subscribe to the corresponding manager in the same way as we did for general access.  <i>Add a</i> variable to store the handler: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> printTaskHandler;</code> </pre> <br><br>  the function to sign on the print contract: <br><br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupPrinting</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> printManager = Windows.Graphics.Printing.PrintManager.getForCurrentView(); printTaskHandler = onPrintTaskRequested.bind(item) printManager.addEventListener(<span class="hljs-string"><span class="hljs-string">"printtaskrequested"</span></span>, printTaskHandler); }</code> </pre> <br><br>  and event handlers: <br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPrintTaskRequested</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">printEvent</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> printTask = printEvent.request.createPrintTask(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.group.title, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">args</span></span></span><span class="hljs-function">) </span></span>{ args.setSource(MSApp.getHtmlPrintDocumentSource(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>)); }); }</code> </pre> <br><br>  Here you can also customize print options and subscribe to additional events. <br>  for example, handle a print end event. <br><br>  Inside the <b>ready</b> function, at the very end, add a call to register for contract support: <br><pre> <code class="javascript hljs"> setupPrinting(item);</code> </pre> <br><br>  and don't forget to remove the print request handler in <b>clearContracts</b> : <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> printManager = Windows.Graphics.Printing.PrintManager.getForCurrentView(); printManager.removeEventListener(<span class="hljs-string"><span class="hljs-string">"printtaskrequested"</span></span>, printTaskHandler);</code> </pre> <br><br>  Try to launch the application and send the article to print: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/572/a12/e10/572a12e1007b8ab61b9efc5990254586.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/284/2d6/f0a/2842d6f0a8a5c581fa546654b4dc8fe9.png"><br><br>  If you are observant enough, you should immediately see the problem: only one page has been sent to print, moreover, in the form that the page looks like on the screen (with horizontal scrolling). <br><br>  In the same way that you would solve this problem for the web, here we are come to the aid of media queries and CSS rules for printing.  (You can also print a specially generated page, a fragment, iframe, etc.) <br><br>  Add a new <b>pages \ itemDetail \ print.css</b> file to the project, or simply write the following code into the css-file associated with the desired page (itemDetail.css).  Add the following lines to it: <br><br><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">media</span></span> print { <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.itemdetailpage</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.fragment</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">-ms-grid-rows</span></span>: <span class="hljs-number"><span class="hljs-number">40px</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>fr; } <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">header</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[role="banner"]</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">-ms-grid-columns</span></span>: <span class="hljs-number"><span class="hljs-number">40px</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>fr <span class="hljs-meta"><span class="hljs-meta">!important</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/*   "" */</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.win-backbutton</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">display</span></span>:none; } <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">header</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[role="banner"]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">h1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.titlearea</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin</span></span>: <span class="hljs-number"><span class="hljs-number">0px</span></span> <span class="hljs-meta"><span class="hljs-meta">!important</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">1em</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">text-transform</span></span>: uppercase; } <span class="hljs-comment"><span class="hljs-comment">/*         */</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.itemdetailpage</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.fragment</span></span>, <span class="hljs-selector-class"><span class="hljs-selector-class">.itemdetailpage</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.content</span></span>, <span class="hljs-selector-class"><span class="hljs-selector-class">.itemdetailpage</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.content</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">article</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>:auto <span class="hljs-meta"><span class="hljs-meta">!important</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">overflow</span></span>: visible <span class="hljs-meta"><span class="hljs-meta">!important</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.content</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">padding-left</span></span>: <span class="hljs-number"><span class="hljs-number">40px</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.itemdetailpage</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.content</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">article</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">column-width</span></span>: auto; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: auto; <span class="hljs-attribute"><span class="hljs-attribute">margin-left</span></span>: <span class="hljs-number"><span class="hljs-number">0px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin-top</span></span>: <span class="hljs-number"><span class="hljs-number">40px</span></span>; } }</code> </pre><br><br>  Run the application and try to print: <br><img src="https://habrastorage.org/getpro/habr/post_images/595/be7/25d/595be725dddd3029a850bc08b331ffcb.png"><br><br>  This concludes the current article. <br><br><h3>  Project </h3><br>  The finished project at the current stage can be downloaded here: <a href="http://aka.ms/win8jsreadertemplate_v2">http://aka.ms/win8jsreadertemplate_v2</a> . <br><br><h3>  Further </h3><br>  In the next part, we will continue to deal with the display and see how to use more complex templates and add support for contextual scaling. <br><br><h3>  Previous parts </h3><br><ul><li>  <a href="http://habrahabr.ru/company/microsoft/blog/163443/">From template to data application</a> </li><li>  <a href="http://habrahabr.ru/company/microsoft/blog/163813/">Styling applications</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/165909/">https://habr.com/ru/post/165909/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../165897/index.html">Substitution DSDT via GRUB2</a></li>
<li><a href="../165899/index.html">Metadata for organizing photo archive storage</a></li>
<li><a href="../165901/index.html">Kiev - a free seminar "Proliant Gen8: new opportunities and technologies"</a></li>
<li><a href="../165903/index.html">NUM ismatics, Numerology and just about NUMA</a></li>
<li><a href="../165907/index.html">Top-up developers in the Smart TV Alliance</a></li>
<li><a href="../165915/index.html">Death penalty for copying</a></li>
<li><a href="../165919/index.html">Three ways to support the insertion of images in the input field from the developers of Yandex. Mail</a></li>
<li><a href="../165921/index.html">Content orientation as trend 2013</a></li>
<li><a href="../165923/index.html">ImageCMS 4.2 release: access rights and other innovations</a></li>
<li><a href="../165927/index.html">Seafile updated to version 1.4</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>