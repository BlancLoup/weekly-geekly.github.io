<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>About ScalaCheck. Generators (Part 2)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Part 2. Generators 


 In the introductory article of the series, I hope you have already managed to get acquainted with the generators. In this tutor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>About ScalaCheck. Generators (Part 2)</h1><div class="post__text post__text-html js-mediator-article"><p>  <strong>Part 2. Generators</strong> </p><br><p>  In the <a href="https://habrahabr.ru/post/319456/">introductory</a> article of the series, I hope you have already managed to get acquainted with the generators.  In this tutorial we will consolidate the knowledge gained, learn to write our own (including recursive) generators.  Although he is dedicated to generators, we will not forget about the properties either.  Moreover, we will actively use them, demonstrating the full power of the generator mechanism.  Consider the mechanism of preconditions.  Perhaps it would be more logical to devote the second article of the series to the properties, and perhaps this would be the right decision.  However, according to my personal observations, it is the generators that cause the greatest difficulties.  Properties we consider in the next article. </p><a name="habracut"></a><br><p>  <strong>Cycle structure</strong> </p><br><ul><li>  <a href="https://habrahabr.ru/post/319456/">Introduction</a> </li><li>  <a href="https://habr.com/ru/post/320104/">Generators</a> </li><li>  <a href="https://habrahabr.ru/post/323038/">Properties</a> </li><li>  Minimization and state testing </li><li>  Integration and Settings </li></ul><br><h1 id="generatory">  Generators </h1><br><p> The <code>forAll</code> method from the <code>Prop</code> object uses data generated in an arbitrary way.  It can be both simple data types and container ( <em>compound</em> ).  In ScalaCheck, any generator is <a href="http://bit.ly/2jKPK0La">Gen‚Äôs</a> successor: </p><br><pre> <code class="hljs scala"><span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Gen</span></span></span><span class="hljs-class">[+</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">] </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply</span></span></span></span>(prms: <span class="hljs-type"><span class="hljs-type">Gen</span></span>.<span class="hljs-type"><span class="hljs-type">Params</span></span>): <span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">T</span></span>] ... }</code> </pre> <br><p>  The class is parametric by the type of value generated.  Accordingly, for strings we will have <code>Gen[String]</code> , and for notorious <code>Person</code> - <code>Gen[Person]</code> .  You can also use the <code>arbitrary</code> method from an <code>Arbitrary</code> object, provided that the necessary vises exist in the scope. </p><br><h2 id="dobavlyaem-podderzhku-implicitov-k-nashim-generatoram">  Add implicit support to our generators </h2><br><p>  Since we are talking about implications, let's figure out how to make an <code>arbitrary</code> <br>  for your type.  First, we need the type itself: </p><br><pre> <code class="hljs scala"><span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LED</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Red</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LED</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Green</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LED</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Blue</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LED</span></span></span></span></code> </pre> <br><p>  Now let's create a generator for our diodes: </p><br><pre> <code class="hljs scala"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> ledGenerator: <span class="hljs-type"><span class="hljs-type">Gen</span></span>[<span class="hljs-type"><span class="hljs-type">LED</span></span>] = <span class="hljs-type"><span class="hljs-type">Gen</span></span>.oneOf(<span class="hljs-type"><span class="hljs-type">Red</span></span>, <span class="hljs-type"><span class="hljs-type">Green</span></span>, <span class="hljs-type"><span class="hljs-type">Blue</span></span>)</code> </pre> <br><p>  And now let's create an <code>implicit</code> <code>Arbitrary</code> instance from the generator we have: </p><br><pre> <code class="hljs scala"><span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> arbitraryLed: <span class="hljs-type"><span class="hljs-type">Arbitrary</span></span>[<span class="hljs-type"><span class="hljs-type">LED</span></span>] = <span class="hljs-type"><span class="hljs-type">Arbitrary</span></span>(ledGenerator) <span class="hljs-type"><span class="hljs-type">Arbitrary</span></span>.arbitrary[<span class="hljs-type"><span class="hljs-type">LED</span></span>].sample <span class="hljs-comment"><span class="hljs-comment">// Some(Green)</span></span></code> </pre> <br><p>  Now, having LEDs in our scope, we can check some properties: </p><br><pre> <code class="hljs javascript">val ledProp = forAll { <span class="hljs-attr"><span class="hljs-attr">diode</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">LED</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">//    }</span></span></code> </pre> <br><p>  For a number of primitive types, as well as containers from the standard library, implicit conversions are already predefined inside the <code>Arbitrary</code> object: </p><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.scalacheck.Arbitrary.arbitrary <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> arbitraryString = arbitrary[String] <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> arbitraryInteger = arbitrary[<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>]</code> </pre> <br><p>  <code>Gen.resultOf</code> can greatly help you in this matter.  This function accepts a case-class, for the parameters of the constructor of which <code>arbitrary</code> values ‚Äã‚Äãare already defined: </p><br><pre> <code class="hljs kotlin">case <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Coord</span></span></span></span>(x: <span class="hljs-built_in"><span class="hljs-built_in">Double</span></span>, y: <span class="hljs-built_in"><span class="hljs-built_in">Double</span></span>) <span class="hljs-comment"><span class="hljs-comment">//     resultOf. val genCoord = Gen.resultOf(Coord) //    Arbitrary. implicit val arbitraryCoord = Arbitrary(genCoord) //         . val prop = Prop.forAll { coord: Coord =&gt; //... }</span></span></code> </pre> <br><h2 id="metod-sample">  <code>sample</code> method </h2><br><p>  Unfortunately, the <code>toString</code> method is not defined for instances of the <code>Gen</code> class, but there is a method that is better and more convenient.  You even have to use it very often when writing generators.  This is the <code>Gen.sample</code> method.  It returns an example of the generated value inside <code>Option</code> : </p><br><pre> <code class="hljs ruby">/<span class="hljs-regexp"><span class="hljs-regexp">/ ScalaCheck     ,   /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  10 . Arbitrary.arbitrary[String].sample map (_ take 10) /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/     . /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ Some(Ôº±ÂÜãÊâßÈæ≠Ó¨îËΩô‚ÆªÊãçÁÆò„ñï) Arbitrary.arbitrary[Double].sample /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ Some(-5.180668081211655E245)</span></span></code> </pre> <br><h2 id="transformacii">  Transformations </h2><br><p>  As already mentioned in the previous section, the <code>map</code> method can also be applied to generators.  We illustrate this with the following example: </p><br><pre> <code class="hljs swift">val octDigitStr = choose(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">map</span></span> (<span class="hljs-number"><span class="hljs-number">_</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">toString</span></span>) octDigitStr.sample <span class="hljs-comment"><span class="hljs-comment">// Some(3) octDigitStr.sample // Some(5)</span></span></code> </pre> <br><h2 id="filtraciya">  Filtration </h2><br><p>  For generators, there is also a <code>filter</code> method, although, in fact, this is just an alias for calling <code>suchThat</code> method: </p><br><pre> <code class="hljs pgsql">val evenOct = octDigit.<span class="hljs-keyword"><span class="hljs-keyword">filter</span></span>(_ % <span class="hljs-number"><span class="hljs-number">2</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) evenOct.sample // <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> //  ,   : evenOct.sample // <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> //  ,    ? evenOct.sample // <span class="hljs-keyword"><span class="hljs-keyword">Some</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre> <br><p>  The example above demonstrates why you should not use <code>filter</code> or <code>suchThat</code> .  The new generator simply rejects values ‚Äã‚Äãthat do not pass the filter.  This greatly slows the testing process. </p><br><blockquote>  Preconditions act like filters. </blockquote><br><h2 id="predusloviya">  Preconditions </h2><br><p>  The preconditions represented in logic by the operation of implication in ScalaCheck are the methods used inside properties.  They allow you to limit the input data.  Recorded by the operator <code>==&gt;</code> .  In order to take advantage of the preconditions, you need to add <code>Prop.propBoolean</code> .  So let's check the statement that for any even number, the last digit will also be an even number: </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.scalacheck.Prop.{forAll, propBoolean} def isEven(number: <span class="hljs-type"><span class="hljs-type">Int</span></span>) = number % <span class="hljs-number"><span class="hljs-number">2</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span> //    . def lastChar(number: <span class="hljs-type"><span class="hljs-type">Int</span></span>) = number.toString.last.toInt // . val p2 = forAll(arbitrary[<span class="hljs-type"><span class="hljs-type">Int</span></span>] suchThat isEven) { number =&gt; isEven(lastChar(number)) } //  . val p1 = forAll(arbitrary[<span class="hljs-type"><span class="hljs-type">Int</span></span>]) { number =&gt; isEven(number) ==&gt; isEven(lastChar(number)) }</code> </pre> <br><p>  To run a property, we can use the <code>check</code> function: </p><br><pre> <code class="hljs ruby">/<span class="hljs-regexp"><span class="hljs-regexp">/     p1.check /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ + OK, passed 100 tests. /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   p2.check /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ + OK, passed 100 tests.</span></span></code> </pre> <br><p>  The harder the filter, the more values ‚Äã‚Äãwill be ignored.  This can be critical for a small set of values ‚Äã‚Äãor for values ‚Äã‚Äãthat are very far apart.  For example, prime numbers on the Int range.  From a similar venture ScalaCheck can easily get tired and surrender to you: </p><br><pre> <code class="hljs pgsql">scala&gt; p1.<span class="hljs-keyword"><span class="hljs-keyword">check</span></span> ! Gave up <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> <span class="hljs-keyword"><span class="hljs-keyword">only</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> passed tests. <span class="hljs-number"><span class="hljs-number">100</span></span> tests were discarded</code> </pre> <br><p>  You will not notice this in the example with even numbers, and in the example with simple numbers - it is easy.  You should also know that: </p><br><blockquote>  The filter for even numbers can be implemented in different ways.  For example, you can take <br>  any integer and just multiply it by 2. In the case of prime numbers <br>  it will be much easier to calculate them in advance, using, for example, <br>  <a href="http://bit.ly/2jI81b3">sieve Eratosthenes</a> and then push the list <br>  computed values ‚Äã‚Äãinside <code>Gen.oneOf</code> , which we will look at later in this <br>  article. </blockquote><p>  If you combine generators using <code>suchThat</code> , you may also have problems.  In such cases, you should use the <code>retryUtil</code> method.  Unlike <code>suchThat</code> , it makes ScalaCheck work harder, which can end in an endless cycle.  Called <code>retrtyUtil</code> similar to <code>fiter</code> or <code>suchThat</code> : </p><br><pre> <code class="hljs pgsql">arbitrary[<span class="hljs-type"><span class="hljs-type">Int</span></span>] retryUntil isEven</code> </pre> <br><p>  You may also notice that the <code>collect</code> and <code>flatten</code> , as well as <code>fromOption</code> , are declared <code>Deprecated</code> .  This is done so that you have less temptation to produce empty generators. </p><br><h2 id="sozdaem-svoy-generator">  Create your own generator </h2><br><p>  As noted earlier, you can create your own generators by combining the ones that already exist with for comprehension: </p><br><pre> <code class="hljs pgsql">val coordGen = <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> { i &lt;- arbitrary[<span class="hljs-type"><span class="hljs-type">Int</span></span>]; j &lt;- arbitrary[<span class="hljs-type"><span class="hljs-type">Int</span></span>] } yield (i, j) coordGen.sample // <span class="hljs-keyword"><span class="hljs-keyword">Option</span></span>[(<span class="hljs-type"><span class="hljs-type">Int</span></span>, <span class="hljs-type"><span class="hljs-type">Int</span></span>)] = <span class="hljs-keyword"><span class="hljs-keyword">Some</span></span>((<span class="hljs-number"><span class="hljs-number">45</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>)) coordGen.sample // <span class="hljs-keyword"><span class="hljs-keyword">Option</span></span>[(<span class="hljs-type"><span class="hljs-type">Int</span></span>, <span class="hljs-type"><span class="hljs-type">Int</span></span>)] = <span class="hljs-keyword"><span class="hljs-keyword">Some</span></span>((<span class="hljs-number"><span class="hljs-number">29</span></span>, <span class="hljs-number"><span class="hljs-number">37</span></span>))</code> </pre> <br><p>  You can declare generators for any data structure.  A simple case of using ADT: </p><br><pre> <code class="hljs scala"><span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LightColor</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Red</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LightColor</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Orange</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LightColor</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Green</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LightColor</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FlashingGreen</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LightColor</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Extinct</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LightColor</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">colorGen</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">Gen</span></span>.oneOf(<span class="hljs-type"><span class="hljs-type">Red</span></span>, <span class="hljs-type"><span class="hljs-type">Orange</span></span>, <span class="hljs-type"><span class="hljs-type">Green</span></span>, <span class="hljs-type"><span class="hljs-type">Extinct</span></span>)</code> </pre> <br><p>  If you complicate your life, so thoroughly: </p><br><pre> <code class="hljs haskell">//       ,     . <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Color</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LightColor</span></span></span><span class="hljs-class"> object </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PedestrianTrafficLight</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sealed</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">State</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">_1</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Color</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">_2</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Color</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Stop</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">State</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Red</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Extinct</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Move</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">State</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Extinct</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Green</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FinishMove</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">State</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Extinct</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FlashingGreen</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">states</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Seq</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">State</span></span></span><span class="hljs-class">] = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Seq</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Move</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FinishMove</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Stop</span></span></span><span class="hljs-class">) } object </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">VehicularTrafficLight</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sealed</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">State</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">_1</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Color</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">_2</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Color</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">_3</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Color</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Stop</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">State</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Red</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Extinct</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Extinct</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Ready</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">State</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Red</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Orange</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Extinct</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Move</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">State</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Extinct</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Extinct</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Green</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Warn</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">State</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Red</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Orange</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Extinct</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FinishMove</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">State</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Extinct</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Extinct</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FlashingGreen</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">states</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Seq</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">State</span></span></span><span class="hljs-class">] = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Seq</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Stop</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Ready</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Move</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Warn</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FinishMove</span></span></span><span class="hljs-class">) } sealed trait </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TrafficLight</span></span></span><span class="hljs-class"> case class </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PedestrianTrafficLight</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">state</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PedestrianTrafficLight</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">State</span></span></span><span class="hljs-class">) extends </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TrafficLight</span></span></span><span class="hljs-class"> case class </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">VehicularTrafficLight</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">state</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">VehicularTrafficLight</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">State</span></span></span><span class="hljs-class">) extends </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TrafficLight</span></span></span></span></code> </pre> <br><p>  Let's announce our generators: </p><br><pre> <code class="hljs haskell"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Gen._ //      val pedestrianTrafficLightStateGen = Gen.oneOf(<span class="hljs-type"><span class="hljs-type">PedestrianTrafficLight</span></span>.<span class="hljs-title"><span class="hljs-title">states</span></span>) //      val vehicularTrafficLightStateGen = Gen.oneOf(<span class="hljs-type"><span class="hljs-type">VehicularTrafficLight</span></span>.<span class="hljs-title"><span class="hljs-title">states</span></span>)</code> </pre> <br><p>  Now let's generate a tuple of pedestrian and traffic lights.  There is only one thing: the state of traffic lights should not be mutually exclusive.  To begin with, we will define the condition under which a pedestrian can perform a maneuver.  Since we create a generator by composition, we use <code>retryUntil</code> instead of <code>suchThat</code> : </p><br><pre> <code class="hljs scala"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pedestrianCanGo = pedestrianTrafficLightStateGen.retryUntil { state =&gt; state != <span class="hljs-type"><span class="hljs-type">PedestrianTrafficLight</span></span>.<span class="hljs-type"><span class="hljs-type">Stop</span></span> }</code> </pre> <br><p>  Now we will generate the state of the car traffic light and, starting from it, we will determine the permissible condition for the pedestrian, and then we will combine them into the list.  The generator we received will be of the following type: <code>Gen[(VehicularTrafficLight.State, PedestrianTrafficLight.State)]</code> . <code>Gen[(VehicularTrafficLight.State, PedestrianTrafficLight.State)]</code> . </p><br><pre> <code class="hljs javascript">val states = vehicularTrafficLightStateGen flatMap { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> vehState @ VehicularTrafficLight.Stop =&gt; pedestrianCanGo map (<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pedState</span></span></span><span class="hljs-function"> =&gt;</span></span> (vehState, pedState)) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pedestrianCanNotGo</span></span></span><span class="hljs-function"> =&gt;</span></span> (pedestrianCanNotGo, PedestrianTrafficLight.Stop) }</code> </pre> <br><p>  Now we will display the states of the traffic lights in the objects themselves: </p><br><pre> <code class="hljs javascript">val trafficLightPair = states map { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v, p</span></span></span><span class="hljs-function">) =&gt;</span></span> (VehicularTrafficLight(v), PedestrianTrafficLight(p)) }</code> </pre> <br><p>  Check the results?  I got: </p><br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">VehicularTrafficLight</span></span>(<span class="hljs-name"><span class="hljs-name">FinishMove</span></span>),PedestrianTrafficLight(<span class="hljs-name"><span class="hljs-name">Stop</span></span>))</code> </pre> <br><p>  and </p><br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">VehicularTrafficLight</span></span>(<span class="hljs-name"><span class="hljs-name">Move</span></span>),PedestrianTrafficLight(<span class="hljs-name"><span class="hljs-name">Stop</span></span>))</code> </pre> <br><p>  which is quite like the truth.  Maybe somewhere I was wrong.  The main thing was to demonstrate the mechanism itself. </p><br><blockquote>  ScalaCheck also allows you to generate recursive data structures, <br>  However, it is difficult to call this process easy and trivial.  Further in this <br>  This article will cover recursive generators and problems that you <br>  may encounter when using them. </blockquote><br><h2 id="generatory-v-svoystvah">  Generators in the properties </h2><br><p>  In most of the previously used examples, ScalaCheck independently selects the appropriate generator instance and uses it to calculate the property.  However, we did not write the generators ourselves, so that ScalaCheck could take away from the field of visibility, which was horrible.  Remember our "compatible" traffic lights?  Let's tackle them somewhere: </p><br><pre> <code class="hljs haskell"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Prop.{forAll, propBoolean} def isRed(<span class="hljs-title"><span class="hljs-title">trafficLight</span></span>: <span class="hljs-type"><span class="hljs-type">VehicularTrafficLight</span></span>) = trafficLight.state == VehicularTrafficLight.Stop def notRed(<span class="hljs-title"><span class="hljs-title">trafficLight</span></span>: <span class="hljs-type"><span class="hljs-type">PedestrianTrafficLight</span></span>) = trafficLight.state != PedestrianTrafficLight.Stop //        Prop.forAll val canNotBothBeRed = forAll(<span class="hljs-title"><span class="hljs-title">trafficLightPair</span></span>) { case (<span class="hljs-title"><span class="hljs-title">vehicular</span></span>, <span class="hljs-title"><span class="hljs-title">pedestrian</span></span>) =&gt; isRed(<span class="hljs-title"><span class="hljs-title">vehicular</span></span>) ==&gt; notRed(<span class="hljs-title"><span class="hljs-title">pedestrian</span></span>) }</code> </pre> <br><p>  Check? </p><br><pre> <code class="hljs pgsql">canNotBothBeRed.<span class="hljs-keyword"><span class="hljs-keyword">check</span></span></code> </pre> <br><p>  And make sure all is well: </p><br><pre> <code class="hljs markdown"><span class="hljs-bullet"><span class="hljs-bullet">+ </span></span>OK, passed 100 tests.</code> </pre> <br><p>  Often, one generator is not enough, then you can use several: </p><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> p = forAll(Gen.posNum[<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>], Gen.negNum[<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>]) { (pos, neg) =&gt; neg &lt; pos }</code> </pre> <br><p>  Properties, like generators, can be nested in each other, so the example above can be rewritten as: </p><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> p = forAll(Gen.posNum[<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>]) { pos =&gt; forAll(Gen.negNum[<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>]) { neg =&gt; neg &lt; pos } }</code> </pre> <br><p>  Instead of nested <code>forAll</code> calls <code>forAll</code> you can also assemble a tuple of generators you want to use.  And do not call <code>forAll</code> twice. </p><br><h2 id="metki-na-generatorah">  Generator Tags </h2><br><p>  Using tags is good practice.  This allows improved error reports and improved readability of code using generators.  To add a label, you can use the operators <code>|:</code> and <code>:|</code>  .  A label can be either a string or a symbol.  Several tags may be added to the generator.  To illustrate, take the previous example, <em>just change the sign, making the property absurd</em> : </p><br><pre> <code class="hljs objectivec"><span class="hljs-comment"><span class="hljs-comment">//  |:  :|   . val p = forAll('positive |: Gen.posNum[Int]) { pos =&gt; forAll(Gen.negNum[Int] :| "negative numbers") { neg =&gt; neg &gt; pos } }</span></span></code> </pre> <br><p>  Agree, it became better? </p><br><pre> <code class="hljs vhdl">! Falsified <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> passed tests. &gt; <span class="hljs-built_in"><span class="hljs-built_in">positive</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> &gt; positive_ORIGINAL: <span class="hljs-number"><span class="hljs-number">1</span></span> &gt; negative numbers: <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><h1 id="generatory-primitivov">  Primitive Generators </h1><br><h2 id="konstanty">  Constants </h2><br><p>  It's hard to come up with something simpler than <code>Gen.const</code> .  It takes any value and carefully packs it into the generator.  Any object in the right place at the right time will be implicitly cast to <code>Gen</code>  Therefore, most likely, you will not have to call this method explicitly. </p><br><h2 id="umirashka">  Umirashka </h2><br><p>  Inside ScalaCheck, the <code>Gen.fail</code> method is <code>Gen.fail</code> to return a non-viable generator.  When you try to call the <code>sample</code> method, you always get <code>None</code> .  Most likely, he will not meet on your way, and if he does, consider that you are familiar with him: </p><br><pre> <code class="hljs pgsql">Gen.fail.sample // <span class="hljs-keyword"><span class="hljs-keyword">Option</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">Nothing</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span></code> </pre> <br><h2 id="chisla">  Numbers </h2><br><p>  You can use <code>Gen.posNum</code> and <code>Gen.negNum</code> to generate positive and negative numbers, respectively: </p><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.scalacheck.Gen <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.scalacheck.Prop.forAll <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> negative = Gen.negNum[<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> positive = Gen.posNum[<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> propCube = forAll (negative) { x =&gt; x * x * x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> }</code> </pre> <br><p>  <code>Gen.chooseNum</code> has an interesting functionality: this generator generates numbers in a given range (inclusive), with more weight for zero (if it is within the specified range), minimum and maximum values, as well as for the presented list of values: </p><br><pre> <code class="hljs objectivec"><span class="hljs-comment"><span class="hljs-comment">//  specials  vararg. Gen.chooseNum(minT = 2, maxT = 10, specials = 9, 5)</span></span></code> </pre> <br><p>  <code>Gen.choose</code> can be used to generate numeric values ‚Äã‚Äãwithin a specified range.  Moreover, this is the rare type of generator that never fails.  It can also be used with symbols.  Speaking of symbolic generators ... </p><br><h2 id="simvoly">  Characters </h2><br><p>  ScalaCheck has many character generators.  You are invited to choose from the following: </p><br><ul><li> <code>Gen.alphaUpperChar</code> </li> <li> <code>Gen.alphaLowerChar</code> </li> <li> <code>Gen.alphaChar</code> </li> <li> <code>Gen.numChar</code> </li> <li> <code>Gen.alphaNumChar</code> </li> </ul><br><p>  Now let's try to generate coordinates for the game ‚ÄúSea Battle‚Äù: </p><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> coord = <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> { letter: <span class="hljs-built_in"><span class="hljs-built_in">Char</span></span> &lt;- Gen.alphaUpperChar number: <span class="hljs-built_in"><span class="hljs-built_in">Char</span></span> &lt;- Gen.numChar } yield s<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$letter</span></span></span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$number</span></span></span><span class="hljs-string">"</span></span> coord.sample <span class="hljs-comment"><span class="hljs-comment">// Some(L1)</span></span></code> </pre> <br><p>  Thanks to for comprehension, you can generate any aggregates: lists, tuples, strings.  Speaking of strings ... </p><br><h2 id="stroki">  Strings </h2><br><p>  You can also easily generate them.  <code>Gen.alphaStr</code> generates strings only from alphabetic characters.  <code>Gen.numStr</code> generates numeric strings.  It is possible to separately generate strings from different case characters: <code>Gen.alphaLowerStr</code> and <code>Gen.alphaUpperStr</code> are designed for this purpose.  <code>Gen.idenifier</code> gives you a non-empty string that always starts with an alphabetic lower case character followed by alphanumeric characters.  For some grammars, this is quite an identifier. </p><br><pre> <code class="hljs cs">import org.scalacheck.Gen val stringsGen = <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> { key &lt;- Gen.identifier <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> &lt;- Gen.numStr } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">yield</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Bucket</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">key take </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">8</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span><span class="hljs-function"><span class="hljs-params"> take </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span></span><span class="hljs-function">) stringsGen.sample </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">// Some(Bucket(kinioQqg,60))</span></span></span></span></code> </pre> <br><h2 id="funkcii">  Functions </h2><br><p>  You can also generate functions in Scalacheck (function0 instances: <code>() =&gt; T</code> ).  To do this, pass the generator responsible for the return value to <code>Gen.function0</code> : </p><br><pre> <code class="hljs pgsql">val f = Gen.function0(Arbitrary.arbitrary[<span class="hljs-type"><span class="hljs-type">Int</span></span>]).sample //  tostring  ,      - : // <span class="hljs-keyword"><span class="hljs-keyword">some</span></span>(org.scalacheck.gen$$<span class="perl"><span class="perl">$lambda$4</span><span class="hljs-number"><span class="perl"><span class="hljs-number">0</span></span></span><span class="perl">/</span><span class="hljs-number"><span class="perl"><span class="hljs-number">1418621776</span></span></span><span class="perl">@4f7d0008)</span></span></code> </pre> <br><h1 id="generatory-konteynerov">  Container generators </h1><br><p>  You can generate instances of standard collections using <code>arbitrary</code> : </p><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Arbitrary.arbitrary <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> listgen = arbitrary[List[<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>]] <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> optgen = arbitrary[Option[<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>]]</code> </pre> <br><p>  But this is often not enough, so ScalaCheck provides advanced tools for working with collections, as well as their generation.  Next, we will omit the <code>Option</code> s, which the <code>sample</code> method returns, and will show you the values ‚Äã‚Äãimmediately, so as not to be led into a misleading. </p><br><h3 id="generiruem-option">  Generate Option </h3><br><p>  If you use <code>Gen.some</code> , then the "income" is guaranteed: </p><br><pre> <code class="hljs pgsql">//     : Gen.<span class="hljs-keyword"><span class="hljs-keyword">some</span></span>("") // <span class="hljs-keyword"><span class="hljs-keyword">Some</span></span>()</code> </pre> <br><p>  Worse, when money has additional degrees of freedom: </p><br><pre> <code class="hljs pgsql">// . Gen.<span class="hljs-keyword"><span class="hljs-keyword">option</span></span>("") // <span class="hljs-keyword"><span class="hljs-keyword">None</span></span></code> </pre> <br><h3 id="generiruem-spiski-i-slovari">  We generate lists and dictionaries </h3><br><p>  <code>Gen.listOf</code> produces lists of arbitrary lengths, and <code>Gen.listOfN</code> generates lists of a given length. </p><br><pre> <code class="hljs pgsql">//  <span class="hljs-number"><span class="hljs-number">3</span></span>     Gen[<span class="hljs-type"><span class="hljs-type">Int</span></span>]. Gen.listOf(<span class="hljs-number"><span class="hljs-number">3</span></span>) map (_ take <span class="hljs-number"><span class="hljs-number">5</span></span>) // List(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) //    . Gen.listOfN(<span class="hljs-number"><span class="hljs-number">5</span></span>, Gen.posNum[<span class="hljs-type"><span class="hljs-type">Double</span></span>]) map (_ take <span class="hljs-number"><span class="hljs-number">5</span></span>)</code> </pre> <br><p>  <code>Gen.listOf</code> generator can return an empty list.  If you are guaranteed a non-empty list, you can use <code>Gen.nonEmptyListOf</code> .  To generate dictionaries or maps ( <code>Map</code> ), there are similar methods: <code>Gen.mapOf</code> , <code>Gen.mapOfN</code> , as well as <code>Gen.nonEmptyMapOf</code> .  Unlike methods for a list, generators for dictionaries require that a two-element tuple generator be passed to them: </p><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Arbitrary._ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> tupleGen = <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> { i &lt;- arbitrary[<span class="hljs-built_in"><span class="hljs-built_in">Short</span></span>] j &lt;- arbitrary[<span class="hljs-built_in"><span class="hljs-built_in">Short</span></span>] } yield (i, j) Gen.mapOfN(<span class="hljs-number"><span class="hljs-number">3</span></span>, tupleGen) map (_ take <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-comment"><span class="hljs-comment">// Map(10410 -&gt; -7991, -19269 -&gt; -18509, 0 -&gt; -18730)</span></span></code> </pre> <br><h2 id="porozhdaem-spisok-elementov-zadannogo-mnozhestva">  We generate a list of elements of a given set </h2><br><p>  <code>Gen.someOf</code> will return you an <code>ArrayBuffer</code> from some set of elements included in the set you specify, for example: </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.scalacheck.Gen.someOf val numbers = someOf(List(1, 2, 3, 4, 5)).sample <span class="hljs-comment"><span class="hljs-comment">// Some(ArrayBuffer(5, 4, 3)) val leds = someOf(List(Red, Green, Blue)).sample // Some(ArrayBuffer(Blue, Green))</span></span></code> </pre> <br><p>  <code>Gen.pick</code> works similarly to <code>Gen.someOf</code> .  The only difference is that <code>Gen.pick</code> allows you to specify the required number of elements: </p><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.scalacheck.Gen.pick <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> lettersGen = Gen.pick(<span class="hljs-number"><span class="hljs-number">2</span></span>, List(<span class="hljs-string"><span class="hljs-string">'a'</span></span>, <span class="hljs-string"><span class="hljs-string">'e'</span></span>, <span class="hljs-string"><span class="hljs-string">'i'</span></span>, <span class="hljs-string"><span class="hljs-string">'o'</span></span>, <span class="hljs-string"><span class="hljs-string">'t'</span></span>, <span class="hljs-string"><span class="hljs-string">'n'</span></span>, <span class="hljs-string"><span class="hljs-string">'m'</span></span>)).sample <span class="hljs-comment"><span class="hljs-comment">// Some(ArrayBuffer(m, n))</span></span></code> </pre> <br><h3 id="porozhdaem-posledovatelnost">  Spawn sequence </h3><br><p>  <code>Gen.sequence</code> creates an <code>ArrayList</code> based on the received sequence of values.  If at least one of the provided generators falls, the whole sequence will fall. </p><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Gen.{<span class="hljs-keyword"><span class="hljs-keyword">const</span></span>, choose} <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> ArrayListGen = Gen.sequence(List(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span>(<span class="hljs-string"><span class="hljs-string">'a'</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>(<span class="hljs-string"><span class="hljs-string">'b'</span></span>), choose(<span class="hljs-string"><span class="hljs-string">'c'</span></span>, <span class="hljs-string"><span class="hljs-string">'d'</span></span>))) <span class="hljs-comment"><span class="hljs-comment">// [a, b, d]</span></span></code> </pre> <br><h3 id="generiruem-beskonechnyy-potok">  We generate an endless stream </h3><br><p>  ScalaCheck supports the ability to generate endless streams: </p><br><pre> <code class="hljs scala"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> stream = <span class="hljs-type"><span class="hljs-type">Gen</span></span>.infiniteStream(<span class="hljs-type"><span class="hljs-type">Gen</span></span>.choose(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-comment"><span class="hljs-comment">//   8  stream.sample map (stream =&gt; stream.take(8).toList) // Some(List(1, 0, 0, 0, 1, 1, 1, 0))</span></span></code> </pre> <br><h2 id="generator-konteynerov">  Container generator </h2><br><p>  The methods listed above for dictionaries and lists are, in fact, special cases of using <code>Gen.containerOf</code> and its associates: <code>containerOfN</code> and nonEmptyContainerOf`.  This is the most generalized form that allows you to generate most of the collections known to us.  Let's consider the following examples: </p><br><pre> <code class="hljs markdown">import Arbitrary._ //   ¬´¬ª     . val prettyShortSeq = Gen.containerOfN[<span class="hljs-string"><span class="hljs-string">Seq, Short</span></span>](<span class="hljs-link"><span class="hljs-link">3, arbitrary[Short]</span></span>) // Vector(0, -24114, 32767) //  :  . val genNonEmptyList = Gen.nonEmptyContainerOf[Map[K, V], (K, V)] (oneOf("foo", "bar"))</code> </pre> <br><p>  Generators created using <code>containerOf</code> abstracted over types, but not <a href="https://en.wikipedia.org/wiki/Kind_(type_theory)">genders</a> (kinds).  Let's look at the signature of the <code>containerOf</code> method: </p><br><pre> <code class="hljs markdown">def containerOf[<span class="hljs-string"><span class="hljs-string">C[_</span></span>],T](g: Gen[T])(implicit evb: Buildable[T,C[T]], evt: C[T] =&gt; Traversable[T] ): Gen[C[T]] =</code> </pre> <br><p>  and its implementation: </p><br><pre> <code class="hljs markdown">buildableOf[<span class="hljs-string"><span class="hljs-string">C[T</span></span>],T](g)</code> </pre> <br><p>  So, if you need to generate a list or something that can be represented as <code>* ‚ü∂ *</code> , then <code>containerOf</code> will be useful to you.  And if you need to generate something like <code>* ‚ü∂ * ‚ü∂ *</code> (for example, <code>Map</code> ), you will have to use an even more abstract method, which we can spy on in the <code>mapOf</code> implementation: </p><br><pre> <code class="hljs markdown">def mapOf[<span class="hljs-string"><span class="hljs-string">T,U</span></span>](<span class="hljs-link"><span class="hljs-link">g: =&gt; Gen[(T,U</span></span>)]) = buildableOf[<span class="hljs-string"><span class="hljs-string">Map[T,U</span></span>],(T,U)](g)</code> </pre> <br><p>  Similar to the methods of <code>container</code> , there are methods <code>buildableOf</code> , <code>buildableOfN</code> and <code>nonEmptyBuildableOf</code> .  Scalacheck usually decides how to build the collection passed to it as a type.  For this, it uses an implicit instance of <code>org.scalacheck.util.Buildable</code> .  Such instances are declared in ScalaCheck for all standard collection types.  It's easy enough to implement your collection and get support for <code>containerOf</code> , as well as instances of <code>Arbitrary</code> . </p><br><h2 id="generatory-vysshego-poryadka">  Higher order generators </h2><br><p>  I think you, dear reader, know what are <a href="https://en.wikipedia.org/wiki/Higher-order_function">the highest order functions</a> .  Similar behavior is peculiar to generators: the generator can accept other generators as arguments, generating these other generators.  The container generators considered earlier by us, with rare exceptions, are also generators of a higher order. </p><br><h2 id="odin-iz-mnozhestva">  One of many </h2><br><p>  <code>Gen.oneOf</code> is capable of receiving from two to <code>N</code> generators, thereby generating a new generator. </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Gen.{oneOf, const, choose} //      Gen[T] val dogies = oneOf("Lucy", "Max", "Daisy", "Barney") //        val windows = oneOf(choose(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>), const(<span class="hljs-number"><span class="hljs-number">10</span></span>))</code> </pre> <br><p>  In <code>oneOf</code> you can pass any successor to <code>scala.collection.Seq</code> , for example, a list. </p><br><h2 id="chastotnyy-generator">  Frequency generator </h2><br><p>  <code>Gen.frequency</code> accepts a list of tuples as input.  Each of which consists of a generator and its probabilistic weight.  The output is a new generator that will use the integer values ‚Äã‚Äãpassed to it as probabilistic weights: </p><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> russianLettersInText = Gen.frequency ( (<span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>), (<span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>), (<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>), (<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>), (<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-comment"><span class="hljs-comment">//..   )</span></span></code> </pre> <br><h2 id="lenivyy-generator">  Lazy generator </h2><br><p>  Using <code>Gen.lzy</code> will allow you to postpone the generation until it is really needed.  It is very useful in composite generators, as well as in the generation of recursive data structures, such as AST.  In the case of <code>Gen.lzy</code> , calculations are performed once.  <code>Gen.delay</code> also <code>Gen.delay</code> calculations, however, they will be executed every time. </p><br><h1 id="razmer-generatorov">  Generator Size </h1><br><p>  <code>Gen.size</code> takes as its only parameter a lambda, which takes an integer as its parameter.  This number is the size that ScalaCheck indicates during generator execution.  <code>Gen.resize</code> allows <code>Gen.resize</code> to set the size for the generator where it is needed.  We illustrate this with the following example: </p><br><pre> <code class="hljs markdown">def genNonEmptySeq[<span class="hljs-string"><span class="hljs-string">T</span></span>](<span class="hljs-link"><span class="hljs-link">genElem: Gen[T]</span></span>): Gen[<span class="hljs-string"><span class="hljs-string">Seq[T</span></span>]] = Gen.sized { size =&gt; for { listSize <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Gen.choose</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span></span><span class="xml"><span class="hljs-tag">) </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">list</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Gen.containerOfN</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Seq</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">T</span></span></span></span><span class="xml"><span class="hljs-tag">](</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">listSize</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">genElem</span></span></span></span><span class="xml"><span class="hljs-tag">) } </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">yield</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">list</span></span></span></span><span class="xml"><span class="hljs-tag"> } </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">val</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">intVector</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">genNonEmptySeq(Arbitrary.arbitrary[Int])</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">val</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">p</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">Prop.forAll(Gen.resize(5,</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">intVector</span></span></span></span><span class="xml"><span class="hljs-tag">)) { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">list</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span></span> list.length <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">=</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">5</span></span></span></span><span class="xml"><span class="hljs-tag"> }</span></span></span></span></code> </pre> <br><p>  Check: </p><br><pre> <code class="hljs objectivec">p.check <span class="hljs-comment"><span class="hljs-comment">// + OK, passed 100 tests.</span></span></code> </pre> <br><p>  <code>Gen.resize</code> creates a new generator based on an existing one, but with a resized size.  This is useful when creating recursive generators, as well as creating complex generators from simple ones using composition. </p><br><h1 id="rekursivnye-generatory">  Recursive generators </h1><br><p>  I often have to work with recursive data structures, namely AST.     <em></em>   .      ,  , ,     .          : </p><br><pre> <code class="hljs scala"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IntTree</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Leaf</span></span></span><span class="hljs-class"> (</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">value: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IntTree</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Node</span></span></span><span class="hljs-class"> (</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">children: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Seq</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">IntTree</span></span></span></span><span class="hljs-class"><span class="hljs-params">]</span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IntTree</span></span></span></span></code> </pre> <br><p>     : </p><br><pre> <code class="hljs ruby">import org.scalacheck.Gen.<span class="hljs-number"><span class="hljs-number">_</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">treeGen</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Gen</span></span></span><span class="hljs-function">[</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IntTree</span></span></span><span class="hljs-function">] = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">oneOf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(leafGen, nodeGen)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">leafGen</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Gen</span></span></span><span class="hljs-function">[</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Leaf</span></span></span><span class="hljs-function">] = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">arbitrary</span></span></span><span class="hljs-function">[</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Int</span></span></span><span class="hljs-function">] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">map</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value =&gt; Leaf(value)</span></span></span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nodeGen</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Gen</span></span></span><span class="hljs-function">[</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Node</span></span></span><span class="hljs-function">] = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">listOf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(treeGen)</span></span></span></span> map (children =&gt; Node(children))</code> </pre> <br><p>     : </p><br><pre> <code class="hljs pgsql">treeGen.sample <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> thread "main" java.lang.StackOverflowError at org.scalacheck.ArbitraryLowPriority$$<span class="ruby"><span class="ruby">anon$1.arbitrary(Arbitrary.</span><span class="hljs-symbol"><span class="ruby"><span class="hljs-symbol">scala:</span></span></span><span class="hljs-number"><span class="ruby"><span class="hljs-number">70</span></span></span><span class="ruby">) at org.scalacheck.ArbitraryLowPriority.arbitrary(Arbitrary.</span><span class="hljs-symbol"><span class="ruby"><span class="hljs-symbol">scala:</span></span></span><span class="hljs-number"><span class="ruby"><span class="hljs-number">74</span></span></span><span class="ruby">) at org.scalacheck.ArbitraryLowPriority.arbitrary$(Arbitrary.</span><span class="hljs-symbol"><span class="ruby"><span class="hljs-symbol">scala:</span></span></span><span class="hljs-number"><span class="ruby"><span class="hljs-number">74</span></span></span><span class="ruby">) at org.scalacheck.Arbitrary$.arbitrary(Arbitrary.</span><span class="hljs-symbol"><span class="ruby"><span class="hljs-symbol">scala:</span></span></span><span class="hljs-number"><span class="ruby"><span class="hljs-number">61</span></span></span><span class="ruby">)</span></span></code> </pre> <br><p>  <code>treeGen</code>       .      .      .    <code>treeGen</code> : </p><br><pre> <code class="hljs ruby"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">treeGen</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Gen</span></span></span><span class="hljs-function">[</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IntTree</span></span></span><span class="hljs-function">] = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lzy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(oneOf(leafGen, nodeGen)</span></span></span></span>)</code> </pre> <br><p>  Run: </p><br><pre> <code class="hljs pgsql">treeGen.sample // <span class="hljs-keyword"><span class="hljs-keyword">Some</span></span>(Leaf(<span class="hljs-number"><span class="hljs-number">857998833</span></span>)) // <span class="hljs-keyword"><span class="hljs-keyword">Some</span></span>(Leaf(<span class="hljs-number"><span class="hljs-number">2147483647</span></span>)) // <span class="hljs-keyword"><span class="hljs-keyword">Some</span></span>(Leaf(<span class="hljs-number"><span class="hljs-number">489549235</span></span>))</code> </pre> <br><p><img src="https://habrastorage.org/files/52f/ad5/dcd/52fad5dcdb664a788f414993b40503ae.jpg" alt="image"></p><br><pre> <code class="hljs ruby">Exception <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> thread <span class="hljs-string"><span class="hljs-string">"main"</span></span> java.lang.StackOverflowError at org.scalacheck.rng.Seed.<span class="hljs-keyword"><span class="hljs-keyword">next</span></span>(Seed.<span class="hljs-symbol"><span class="hljs-symbol">scala:</span></span><span class="hljs-number"><span class="hljs-number">17</span></span>) at org.scalacheck.rng.Seed.long(Seed.<span class="hljs-symbol"><span class="hljs-symbol">scala:</span></span><span class="hljs-number"><span class="hljs-number">39</span></span>) at org.scalacheck.Gen$Choose$.org$scalacheck$Gen$Choose$$chLng(Gen.<span class="hljs-symbol"><span class="hljs-symbol">scala:</span></span><span class="hljs-number"><span class="hljs-number">309</span></span>) at org.scalacheck.Gen$Choose$$anon$5.$anonfun$choose$1(Gen.<span class="hljs-symbol"><span class="hljs-symbol">scala:</span></span><span class="hljs-number"><span class="hljs-number">358</span></span>) at org.scalacheck.Gen$$anon$3.doApply(Gen.<span class="hljs-symbol"><span class="hljs-symbol">scala:</span></span><span class="hljs-number"><span class="hljs-number">254</span></span>) at org.scalacheck.Gen.$anonfun$map$1(Gen.<span class="hljs-symbol"><span class="hljs-symbol">scala:</span></span><span class="hljs-number"><span class="hljs-number">75</span></span>) at org.scalacheck.Gen$$anon$3.doApply(Gen.<span class="hljs-symbol"><span class="hljs-symbol">scala:</span></span><span class="hljs-number"><span class="hljs-number">254</span></span>) at org.scalacheck.Gen.$anonfun$flatMap$2(Gen.<span class="hljs-symbol"><span class="hljs-symbol">scala:</span></span><span class="hljs-number"><span class="hljs-number">80</span></span>) at org.scalacheck.Gen$R.flatMap(Gen.<span class="hljs-symbol"><span class="hljs-symbol">scala:</span></span><span class="hljs-number"><span class="hljs-number">242</span></span>) at org.scalacheck.Gen$R.flatMap$(Gen.<span class="hljs-symbol"><span class="hljs-symbol">scala:</span></span><span class="hljs-number"><span class="hljs-number">239</span></span>)</code> </pre> <br><p>      ,   ,    .      .  <code>Gen.sized</code>  <code>Gen.resize</code>     : </p><br><pre> <code class="hljs scala"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nodeGen</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Gen</span></span>[<span class="hljs-type"><span class="hljs-type">Node</span></span>] = sized { size =&gt; choose(<span class="hljs-number"><span class="hljs-number">0</span></span>, size) flatMap { currSize =&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> nGen = resize(size / (currSize + <span class="hljs-number"><span class="hljs-number">1</span></span>), treeGen) listOfN(currSize, nGen) map (child =&gt; <span class="hljs-type"><span class="hljs-type">Node</span></span>(child)) } }</code> </pre> <br><p>   : </p><br><pre> <code class="hljs lisp">val nGen = resize(<span class="hljs-name"><span class="hljs-name">size</span></span> / (<span class="hljs-name"><span class="hljs-name">currSize</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>), treeGen)</code> </pre> <br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we are creating a smaller generator: the size will be reduced in proportion to the level of nesting. </font><font style="vertical-align: inherit;">For a specific N, an empty generator of size 0 will be created, and we will not get a stack overflow. </font><font style="vertical-align: inherit;">The size of the generator should be reduced each time, since the generator does not know what level of nesting it is at.</font></font></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So we figured out the recursive generators. </font></font><a href="https://etorreborre.blogspot.ru/2011/02/scalacheck-generator-for-json.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An example of</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> generating AST for JSON can be found on the Eric Torreborre blog (the creator of specs2).</font></font></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This concludes our acquaintance with the generators and go to the properties. </font><font style="vertical-align: inherit;">More about them will be discussed in the next article in the series.</font></font> See you! </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/320104/">https://habr.com/ru/post/320104/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../320092/index.html">Maintainers do not scale</a></li>
<li><a href="../320096/index.html">Deploy Elixir Applications</a></li>
<li><a href="../320098/index.html">UIColor and UIImage in Xcode 8 using literals</a></li>
<li><a href="../320100/index.html">Development of SELinux-module for the application</a></li>
<li><a href="../320102/index.html">Upgrading features and infrastructure of free video conferencing 3CX WebMeeting</a></li>
<li><a href="../320106/index.html">VulnHub: Immerse yourself in hacking in the style of the TV series Mr. Robot</a></li>
<li><a href="../320108/index.html">Why case value is exaggerated and why it is harmful</a></li>
<li><a href="../320110/index.html">Windows Performance Station or how I taught the computer to work effectively</a></li>
<li><a href="../320114/index.html">Stagnation: message format</a></li>
<li><a href="../320116/index.html">"... and in every joke there is some joke"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>