<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PHP / JSON database</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When developing web applications, there is often a need to store certain settings or temporary data. Usually, it uses either files or databases. If th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PHP / JSON database</h1><div class="post__text post__text-html js-mediator-article">  When developing web applications, there is often a need to store certain settings or temporary data.  Usually, it uses either files or databases.  If this is a database, then storing a single-row table in the database, as is often the case, is not a very good option.  For this, config files of certain formats (* .php, * .ini, * .xml, * .json) are often used. <br><a name="habracut"></a><br><h4>  Json database </h4><br>  In this post I want to talk about using json files as a database.  Using the json format is convenient because the information in this format is Javascript arrays and objects that can be easily accessed from the client side of the web application. <br>  Any database includes a set of functions for writing, reading, updating and deleting data from tables.  In this case, it will be a class with a set of methods for managing the database. <br><pre><code class="php hljs">$jdb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Jsondb($path);</code> </pre> <br><ul><li>  $ path - the path from the root to the folder in which the files will be stored.  By default, $ path = $ _SERVER ["DOCUMENT_ROOT"]. '/ Jdb /'. </li></ul><br><br><h4>  Database management </h4><br>  Below is a set of methods and examples of their use. <br><br>  <b>Create</b> <br>  Create a table. <br><pre> <code class="php hljs">$jdb-&gt;create($table, $keys);</code> </pre><br><ul><li>  $ keys - an array of table keys and their characteristics.  Auto_increment and default are supported. <br></li></ul><br>  Example: <br><pre> <code class="php hljs">$keys = <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span>( <span class="hljs-string"><span class="hljs-string">'id'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">Array</span></span>(<span class="hljs-string"><span class="hljs-string">'auto_increment'</span></span>), <span class="hljs-string"><span class="hljs-string">'title'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">Array</span></span>(<span class="hljs-string"><span class="hljs-string">'default'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'habrahabr'</span></span>), <span class="hljs-string"><span class="hljs-string">'posts'</span></span>, <span class="hljs-string"><span class="hljs-string">'userId'</span></span> ); $jdb-&gt;create(<span class="hljs-string"><span class="hljs-string">'habr'</span></span>, $keys);</code> </pre><br>  <b>Select</b> <br>  Fetching data from a table. <br><pre> <code class="php hljs">$jdb-&gt;select($select, $table, $rules);</code> </pre><br><ul><li>  $ select - an array or string containing the keys to select. </li><li>  $ table - the name of the table from which the data will be sampled. </li><li>  $ rules is an array containing the where, order and limit parameters. </li></ul><br>  Example: <br><pre> <code class="php hljs">$rules = <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span>( <span class="hljs-string"><span class="hljs-string">'where'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">Array</span></span>( <span class="hljs-string"><span class="hljs-string">'id'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">Array</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>), <span class="hljs-string"><span class="hljs-string">'name'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'habr'</span></span> ), <span class="hljs-string"><span class="hljs-string">'order'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">Array</span></span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span>,<span class="hljs-string"><span class="hljs-string">'desc'</span></span>), <span class="hljs-string"><span class="hljs-string">'limit'</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">5</span></span> ); $jdb-&gt;select(<span class="hljs-string"><span class="hljs-string">'*'</span></span>,<span class="hljs-string"><span class="hljs-string">'habr'</span></span>,$rules); $rules = <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span>( <span class="hljs-string"><span class="hljs-string">'order'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">Array</span></span>(<span class="hljs-string"><span class="hljs-string">'rand()'</span></span>), <span class="hljs-string"><span class="hljs-string">'limit'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">Array</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>) ); $select = <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span>,<span class="hljs-string"><span class="hljs-string">'title'</span></span>,<span class="hljs-string"><span class="hljs-string">'userId'</span></span>); <span class="hljs-comment"><span class="hljs-comment">#  ,  $select ='id,title, userId'; $jdb-&gt;select($select, 'habr', $rules);</span></span></code> </pre><br>  <b>Insert</b> <br>  Insert data into the table. <br><pre> <code class="php hljs">$fdb-&gt;Insert($table, $data);</code> </pre><br><ul><li>  $ data - associative data array to insert into the table. </li></ul><br>  Example: <br><pre> <code class="php hljs">$data = <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span>(<span class="hljs-string"><span class="hljs-string">'title'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'new title'</span></span>, <span class="hljs-string"><span class="hljs-string">'userId'</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">6431</span></span>); $jdb-&gt;insert(<span class="hljs-string"><span class="hljs-string">'habr'</span></span>, $data);</code> </pre><br>  <b>Update</b> <br>  Update data in the table. <br><pre> <code class="php hljs">$jdb-&gt;update($table, $data, $where);</code> </pre><br><ul><li>  $ table - the name of the table. </li><li>  $ data is an associative array with update data. </li><li>  $ where is an associative array with data for selecting the necessary record for updating. </li></ul><br>  Example: <br><pre> <code class="php hljs">$data = <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span>(<span class="hljs-string"><span class="hljs-string">'title'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'updated title'</span></span>); $where = <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span>(<span class="hljs-string"><span class="hljs-string">'title'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'new title'</span></span>, <span class="hljs-string"><span class="hljs-string">'userId'</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">6431</span></span>); $jdb-&gt;update(<span class="hljs-string"><span class="hljs-string">'habr'</span></span>, $data, $where);</code> </pre><br>  <b>Delete</b> <br>  Deleting records from the table. <br><pre> <code class="php hljs">$jdb-&gt;delete($table, $where);</code> </pre><br><ul><li>  $ table - the name of the table. </li><li>  $ where is an associative array of data to select the desired record for deletion. </li></ul><br>  Example: <br><pre> <code class="php hljs">$where = <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span>(<span class="hljs-string"><span class="hljs-string">'userId'</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">6431</span></span>); $jdb-&gt;delete(<span class="hljs-string"><span class="hljs-string">'habr'</span></span>, $where);</code> </pre><br>  <b>Drop</b> <br>  Deleting a table. <br><pre> <code class="php hljs">$jdb-&gt;drop($table);</code> </pre><br><ul><li>  $ table - the name of the table. </li></ul><br>  Example: <br><pre> <code class="php hljs">$jdb-&gt;drop(<span class="hljs-string"><span class="hljs-string">'habr'</span></span>);</code> </pre><br>  <b>Alter</b> <br>  Adding and removing keys from a table. <br><pre> <code class="php hljs">$jdb-&gt;alter($table, $todo, $keys);</code> </pre><br><ul><li>  $ table - the name of the table. </li><li>  $ todo - the action to be performed.  May be add or drop. </li><li>  $ keys - a string or an associative array of data for deleting or adding keys. </li></ul><br>  Example: <br><pre> <code class="php hljs">$jdb-&gt;alter(<span class="hljs-string"><span class="hljs-string">'habr'</span></span>, <span class="hljs-string"><span class="hljs-string">'drop'</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span>,<span class="hljs-string"><span class="hljs-string">'userId'</span></span>); $keys = <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span>( <span class="hljs-string"><span class="hljs-string">'postTitle'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">Array</span></span>( <span class="hljs-string"><span class="hljs-string">'default'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'habrapost'</span></span> ) ); $jdb-&gt;alter(<span class="hljs-string"><span class="hljs-string">'habr'</span></span>, <span class="hljs-string"><span class="hljs-string">'add'</span></span>, $keys); $keys = <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span>(<span class="hljs-string"><span class="hljs-string">'acc'</span></span>,<span class="hljs-string"><span class="hljs-string">'userId'</span></span>); <span class="hljs-comment"><span class="hljs-comment">#  ,  $keys = 'acc, userId'; $jdb-&gt;alter('habr', 'add', $keys);</span></span></code> </pre><br>  <b>Truncate</b> <br>  Completely clear the table. <br><pre> <code class="php hljs">$jdb-&gt;truncate($table);</code> </pre><br><ul><li>  $ table - the name of the table. </li></ul><br>  <b>Exists</b> <br>  Checks the existence of a table. <br><pre> <code class="php hljs">$jdb-&gt;exists($table);</code> </pre><br><ul><li>  $ table - the name of the table. </li></ul><br><h5>  Identifying errors in queries </h5><br>  All the listed methods return the result of the query, if it was successful, and false if not.  The " <b>status</b> " method allows you to find out the status of the previous request. <br><pre> <code class="php hljs">$jdb-&gt;status($flag);</code> </pre><br><ul><li>  $ flag is false by default.  If set to true, a text message will be returned with an error instead of a status code. </li></ul><br>  Example: <br><pre> <code class="php hljs">$jdb-&gt;create(<span class="hljs-string"><span class="hljs-string">'users'</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">Array</span></span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">Array</span></span>(<span class="hljs-string"><span class="hljs-string">'auto_increment'</span></span>),<span class="hljs-string"><span class="hljs-string">'name'</span></span>)); $jdb-&gt;create(<span class="hljs-string"><span class="hljs-string">'users'</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">Array</span></span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span>,<span class="hljs-string"><span class="hljs-string">'name'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $jdb-&gt;status(); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $jdb-&gt;status(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* * 101 * Table already exists; */</span></span> $jdb-&gt;select(<span class="hljs-string"><span class="hljs-string">'phone'</span></span>, <span class="hljs-string"><span class="hljs-string">'users'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $jdb-&gt;status(); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $jdb-&gt;status(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* * 202 * Try ro select an unexisting keys from table "users"; */</span></span></code> </pre><br>  List of status codes: <br><ul><li>  0 - All ok. </li><li>  101 - Table already exists. </li><li>  102 - Table doent exist. </li><li>  103 - Unkonw property. </li><li>  201 - Key already exist. </li><li>  202 - Keys doesn‚Äôt exsit. </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Auxiliary methods </h4><br>  <b>Last_insert_id</b> <br>  It often happens that you need to find out the id of the added record in the database.  To do this, use the last_insert_id method. <br><pre> <code class="php hljs">$jdb-&gt;last_insert_id();</code> </pre><br>  Example: <br><pre> <code class="php hljs">$jdb-&gt;insert(<span class="hljs-string"><span class="hljs-string">'users'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span>(<span class="hljs-string"><span class="hljs-string">'name'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'username'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $jdb-&gt;last_insert_id();</code> </pre><br>  <b>Exist</b> <br>  Checks the existence of a table.  Returns true or false; <br>  Example: <br><pre> <code class="php hljs">$jdb-&gt;exist(<span class="hljs-string"><span class="hljs-string">'user'</span></span>);</code> </pre><br>  Also, for convenience, it is possible to use sql syntax to execute queries.  To do this, use another class. <br><pre> <code class="php hljs">Jsonsql::request(<span class="hljs-string"><span class="hljs-string">'select * from `users`'</span></span>, $path);</code> </pre><br><ul><li>  $ path - the path from the root to the folder in which the files are stored.  By default, $ path = $ _SERVER ["DOCUMENT_ROOT"]. '/ Jdb /'. </li></ul><br><br>  Since php has the ability to create functions and classes with the same name, you can apply the following construction: <br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Jsonsql</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($string, $path = false)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Jsonsql::request($string, $path); }</code> </pre><br>  Example: <br><pre> <code class="php hljs">Jsonsql(<span class="hljs-string"><span class="hljs-string">'create table `new` (id auto_increment, title default "untitled", text)'</span></span>); Jsonsql(<span class="hljs-string"><span class="hljs-string">'select `name`,`title` from `habr` where `id` in(1,34,5,9,4,100) order by rand()'</span></span>, <span class="hljs-string"><span class="hljs-string">'/jdb/test/'</span></span>);</code> </pre><br><h5>  Additional requests </h5><br>  Check the status of the request: <br><pre> <code class="php hljs">Jsonsql(<span class="hljs-string"><span class="hljs-string">'status'</span></span>); <span class="hljs-comment"><span class="hljs-comment">#     Jsonsql('status code'); #   </span></span></code> </pre><br>  Find out the id of the added record in the database: <br><pre> <code class="php hljs">Jsonsql(<span class="hljs-string"><span class="hljs-string">'last_insert_id'</span></span>);</code> </pre><br>  Find out whether there is a table or not: <br><pre> <code class="php hljs">Jsonsql(<span class="hljs-string"><span class="hljs-string">'table exists `users`'</span></span>);</code> </pre><br><br><h4>  Comparing Jsondb with MySql </h4><br>  Of course, there is nothing to compare here, databases are created to store data and quickly access it.  But still interesting. <br>  To compare the speed and the amount of memory used, a series of tests was performed for the insert, update and select methods. <br><br>  <b>Insert</b> <br>  Ten rows were written ten times in the database.  Below is a graph of the script execution time versus the number of operations performed. <br><img src="https://habrastorage.org/getpro/habr/post_images/bd1/6c7/406/bd16c7406bad9d0585a77ce240e15392.png" alt="image"><br>  Used memory: <br><ul><li>  Jsondb - 525.67 Kb. </li><li>  MySQL - 421.16 Kb. </li></ul><br>  It can be seen that the performance of Jsondb is very dependent on the number of records in the table. <br><br>  <b>Update</b> <br>  100 database entries have been updated. <br><ul><li>  Jsondb - 0.03223 sec., 626.66 Kb. </li><li>  MySQL - 0.01991 sec., 470.84 Kb. </li></ul><br><br>  <b>Select</b> <br>  All records from the database were selected. <br><ul><li>  Jsondb - 0.00313 sec., 626.66 Kb. </li><li>  MySQL - 0.00391 sec., 387.69 Kb. </li></ul><br><br>  And a sample of data from the database with the conditions where, order and limit. <br><ul><li>  Jsondb - 0.02123 sec., 626.66 Kb. </li><li>  MySQL - 0.03991 sec., 387.69 Kb. </li></ul><br>  From all this it follows that the speed of such a data storage system, especially when using the update and insert methods, very much depends on the number of records in one table.  The selection of data from the tables is quite fast.  Using this method of storing information is well suited for storing various application settings and temporary data.  As mentioned above, this is also a big plus due to the fact that any information stored in this form can be accessed from the client side of the application.  If more, then for example using the jQuery method <a href="http://api.jquery.com/jQuery.getJSON/">$ .getJSON</a> . <br><br>  Here is the <a href="">link</a> where you can download the sources and examples. </div><p>Source: <a href="https://habr.com/ru/post/119719/">https://habr.com/ru/post/119719/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../119706/index.html">Counting objects in a binary image. Part 2</a></li>
<li><a href="../119707/index.html">Free Windows images for testing sites in Internet Explorer</a></li>
<li><a href="../11971/index.html">Samsung will release an inexpensive HD DVD / Blu-ray player</a></li>
<li><a href="../119711/index.html">How to finish the game</a></li>
<li><a href="../119712/index.html">Super-brand secrets: Apple (translation)</a></li>
<li><a href="../11972/index.html">Ecma adopts holographic disc standards</a></li>
<li><a href="../119720/index.html">Laptop Review Lenovo ThinkPad X220</a></li>
<li><a href="../119721/index.html">CSS3 sprite animation</a></li>
<li><a href="../119722/index.html">Playboy with Marlboro video ad or return player from Vogue magazine</a></li>
<li><a href="../119726/index.html">The first event, broadcast on YouTube live on PPV, will be held in Moscow</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>