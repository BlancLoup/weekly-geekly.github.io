<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Custom tables in MODx Revolution</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article we will sort the following questions: 


1. Creating custom tables for MODx Revolution. 
2. Generation of XML-schema and php-file-clas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Custom tables in MODx Revolution</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="http://newpg.ru/assets/images/modx/modx-logo.png" alt="image">  In this article we will sort the following questions: <br><ol><li>  Creating custom tables for MODx Revolution. </li><li>  Generation of XML-schema and php-file-classes for xPDO. </li><li>  Work with custom tables. </li></ol><br><a name="habracut"></a><br>  One of the biggest difficulties in switching from Evolution to Revolution is xPDO IMHO.  After all, as it used to be simple: I climbed into a muscle through phpMyAdmin, created a label, and work with it, sending pure SQL queries through $ modx-&gt; db. <br>  Now, however, any changes in the database do not worry much about $ modx, except for a full drop of tables, etc.  As interconnected xPDO and MODx (or rather $ modx), I wrote <a title="MODx + xPDO" href="http://newpg.ru/documentation/modx/modx-revolution/xpdo.html">here</a> . <br>  I consider the difficulties in working with user tables in MODx Revolution to be a considerable obstacle for many programmers. <br>  But in fact, everything is not so difficult. <br>  The whole algorithm considered in three words: <br><ol><li>  Also through phpMyAdmin (or another convenient used tool) we create the tables we need </li><li>  Using the code below, we generate the necessary xPDO files for operation. </li><li>  Using the $ modx-&gt; addPackage () method, we load our new class in the right place and we are already working with our tables through the methods $ modx-&gt; getObject (), $ modx-&gt; getCollection (), etc. </li></ol><br><br>  So, the code we need to generate files (Source <a href="http://newpg.ru/files__/xpdo-schema-generator.html">here</a> ): <br><br><blockquote> <code><font color="black">&lt;?php <br> <br> <br></font></code> <br> <code><font color="black"><font color="#008000">/*******************************************************/</font> <br></font></code> <br> <code><font color="black"><font color="#008000">/*                    */</font> <br></font></code> <br> <code><font color="black"><font color="#008000">/*******************************************************/</font> <br> <br></font></code> <br> <code><font color="black"><font color="#008000">//  .        $modx-&gt;addPackage()</font> <br> &lt;br&gt; <br></font></code> <code><font color="black">$obj = <font color="#A31515">'program'</font> ; <br> <br></font></code> <br> <code><font color="black"><font color="#008000">/*</font> <br> <font color="#008000"> .      ,     .</font> <br> <font color="#008000"> , xPDO        ,</font> <br> <font color="#008000">  ,      .</font> <br> <font color="#008000">*/</font> <br> &lt;br&gt; <br></font></code> <code><font color="black">$tablePrefix= <font color="#A31515">'modx_program_'</font> ; <br> <br></font></code> <br> <code><font color="black"><font color="#008000">// ,    XML-     </font> <br></font></code> <br> <code><font color="black"><font color="#008000">//            $modx-&gt;addPackage();</font> <br> &lt;br&gt; <br></font></code> <code><font color="black">$Path = dirname(__FILE__). <font color="#A31515">'/model/'</font> ; <br> <br></font></code> <br> <code><font color="black"><font color="#008000">// -</font> <br> &lt;br&gt; <br> $Schema = $Path. <font color="#A31515">'/'</font> .$obj. <font color="#A31515">'.mysql.schema.xml'</font> ; <br> <br></font></code> <br> <code><font color="black"><font color="#008000">/*******************************************************/</font> <br> <br> <br> &lt;br&gt; <br> <font color="#008000">//   -        </font> <br> &lt;br&gt; <br> require_once dirname(dirname(dirname(__FILE__))). <font color="#A31515">'/core/config/config.inc.php'</font> ; <br> <br></font></code> <br> <code><font color="black"><font color="#008000">//    MODx</font> <br> &lt;br&gt; <br> include_once MODX_CORE_PATH . <font color="#A31515">'model/modx/modx.class.php'</font> ; <br> <br></font></code> <br> <code><font color="black"><font color="#008000">//   MODx</font> <br> &lt;br&gt; <br> $modx= <font color="#0000ff">new</font> modX(); <br> <br></font></code> <br> <code><font color="black"><font color="#008000">//  ,  </font> <br> &lt;br&gt; <br> <font color="#008000">// $modx-&gt;initialize('mgr');</font> <br> <br></font></code> <br> <code><font color="black"><font color="#008000">//   </font> <br></font></code> <br> <code><font color="black"><font color="#008000">//  </font> <br> &lt;br&gt; <br> $modx-&gt;setLogLevel(modX::LOG_LEVEL_INFO); <br> &lt;br&gt; <br> $modx-&gt;setLogTarget(XPDO_CLI_MODE ? <font color="#A31515">'ECHO'</font> : <font color="#A31515">'HTML'</font> ); <br> <br></font></code> <br> <code><font color="black"><font color="#008000">// !!! !</font> <br> &lt;br&gt; <br> <font color="#008000">//   -</font> <br> &lt;br&gt; <br> $modx-&gt;addPackage( <font color="#A31515">'transport.modPackageBuilder'</font> , <font color="#A31515">''</font> , <font color="#0000ff">false</font> , <font color="#0000ff">true</font> ); <br> <br></font></code> <br> <code><font color="black"><font color="#008000">//     (MySQL / MsSQL  ..)</font> <br> &lt;br&gt; <br> $manager = $modx-&gt;getManager(); <br> <br></font></code> <br> <code><font color="black"><font color="#008000">// - </font> <br> &lt;br&gt; <br> $generator = $manager-&gt;getGenerator(); <br> <br> <br></font></code> <br> <code><font color="black"><font color="#008000">//  -XML</font> <br> <font color="#008000">&lt;br&gt; <br> // /xpdo/om/mysql/xpdogenerator.class.php</font> <br> &lt;br&gt; <br> <font color="#008000">// public function writeSchema($schemaFile, $package= '', $baseClass= '', $tablePrefix= '', $restrictPrefix= false)</font> <br> <font color="#008000">&lt;br&gt; <br> // $tablePrefix - ,     ,     .</font> <br> <font color="#008000">&lt;br&gt; <br> // $restrictPrefix -  true,       </font> <br> &lt;br&gt; <br> $xml= $generator-&gt;writeSchema($Schema, $obj, <font color="#A31515">'xPDOObject'</font> , $tablePrefix ,$restrictPrefix= <font color="#0000ff">true</font> ); <br> <br></font></code> <br> <code><font color="black"><font color="#008000">//     (php)   xml</font> <br> &lt;br&gt; <br> $generator-&gt;parseSchema($Schema, $Path); <br> <br> &lt;br&gt; <br> &lt;br&gt; <br> print <font color="#A31515">"&lt;br /&gt;&lt;br /&gt;"</font> ;</font> <br></code> <br></blockquote>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Fill this file with the server, assign the correct path to the MODx configuration, and the directories where the generated files will be created.  Access the file through the browser.  As a result, an xml file should be created in the specified folder, in which our tables and a php file will be described. <br>  These files, if very necessary, can be moved to another folder where you decide to store your new Class.  In the future, these files will always be needed to work with their tables. <br><br>  Now you can work with your tables.  In order to better understand the mechanism of xPDO interaction with the XML schema, as well as to understand what is written in the generator file, and what objects you get at the output, I quote my note on this issue.  Honestly, at first without it was just no way ... <br><br><h2>  1. Connection of packages and execution of requests to the scheme </h2><br><br><h3>  1.1 Selection of records from the table </h3><br>  The first thing to do is to figure out what is generally needed in order to refer to the scheme.  To do this, examine the XML file. <br>  Here is the main block of the scheme we created: <br><br><blockquote> <code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">model</font> <font color="#ff0000">package</font> <font color="#0000ff">="testtbl"</font> <font color="#ff0000">baseClass</font> <font color="#0000ff">="xPDOObject"</font> <font color="#ff0000">platform</font> <font color="#0000ff">="mysql"</font> <font color="#ff0000">defaultEngine</font> <font color="#0000ff">="MyISAM"</font> <font color="#ff0000">version</font> <font color="#0000ff">="1.1"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">object</font> <font color="#ff0000">class</font> <font color="#0000ff">="Tbl"</font> <font color="#ff0000">table</font> <font color="#0000ff">="tbl"</font> <font color="#ff0000">extends</font> <font color="#0000ff">="xPDOObject"</font> <font color="#0000ff">&gt;</font></font> <br></code> </blockquote><br><br>  The most basic thing we need here is: <br>  one. <blockquote> <code><font color="black"><font color="#0000ff">&lt;</font> model package="testtbl"</font></code> </blockquote>  we need the value of the package attribute to know which package we need to load.  In this case, this is testtbl.  Call the package like this: <br><br><blockquote> <code><font color="black">$modx-&gt;addPackage( $package, $path, $prefix); <br> // !!!    addPackage  ,               ,  .</font></code> </blockquote> <br><br>  Consider the parameters carefully. <br>  <strong>$ package</strong> .  The name of the package.  In our case, just testtbl <br>  <strong>$ path</strong> .  Path to the package directory (in which there is an XML file and a folder by the name of the Object, in which all PHP files) <br>  <strong>$ prefix</strong> .  If the prefix, which is different from the default prefix, was indicated when creating the scheme, then it is necessary to indicate it. <br><br>  There is another little trick, how to accurately determine the required prefix. <br>  Formula: <strong>$ prefix = $ fullTableName - $ tableName;</strong> <br>  Here <strong>$ fullTableName</strong> is the full name of the database table to which we refer, <br>  <strong>$ tableName</strong> - the value of the attribute table <strong>&lt;object</strong> tag of our XML file <br><br>  Execute the query: <br><br><blockquote> <code><font color="black">$result = $modx-&gt;getCollection( <font color="#A31515">'Tbl'</font> ); <br> <font color="#0000ff">foreach</font> ($result <font color="#0000ff">as</font> $row){ <br> print ‚Äú&lt;br /&gt;Next:‚Äù. $row-&gt; <font color="#0000ff">get</font> ('columnName'); <br> }</font></code> </blockquote> <br><br><h3>  1.2 Creating a new entry in the table </h3><br><br><blockquote> <code><font color="black"><font color="#0000ff">private</font> <font color="#0000ff">static</font> function testCreateRows(){ <br> <br> $pkg = <font color="#A31515">'testtbl'</font> ; <br> <br> <br> $modx-&gt;addPackage( <font color="#A31515">'testtbl'</font> , $Path , <font color="#A31515">'modx_kl_test'</font> )) ; <br> <br> $row = $modx-&gt;newObject( <font color="#A31515">'Tbl'</font> ); <br> $row-&gt;fromArray(array( <br> <font color="#A31515">'id'</font> =&gt; 5 <br> )); <br> $row-&gt;save(); <br> <br> <font color="#0000ff">return</font> ; <br> }</font> <br></code> </blockquote><br><br>  It seems to be all.  If anything is not clear, ask. </div><p>Source: <a href="https://habr.com/ru/post/123072/">https://habr.com/ru/post/123072/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../123061/index.html">Magic square</a></li>
<li><a href="../123064/index.html">4road.net vs RosYam</a></li>
<li><a href="../123065/index.html">As I developed the device, from idea to production. Part 2</a></li>
<li><a href="../123068/index.html">News Corp. sold myspace</a></li>
<li><a href="../123070/index.html">Behavior patterns</a></li>
<li><a href="../123074/index.html">Biz Stone left Twitter to work on new projects</a></li>
<li><a href="../123075/index.html">What is the difference between EYE tracking and MOUSE tracking?</a></li>
<li><a href="../123076/index.html">UserLook - Find out what's happening on your site now.</a></li>
<li><a href="../123077/index.html">HP thought about promoting webOS</a></li>
<li><a href="../123078/index.html">Voyage Linux 0.7.5 released</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>