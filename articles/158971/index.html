<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Scripting Techniques in Bash</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Linux administrators have to write bash scripts regularly. Below I provide tips on how to speed up this work, as well as improve the reliability of sc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Scripting Techniques in Bash</h1><div class="post__text post__text-html js-mediator-article">  Linux administrators have to write bash scripts regularly.  Below I provide tips on how to speed up this work, as well as improve the reliability of scripts. <br><h2>  Tip 1 </h2>  Do not write scripts that perform actions without asking anything.  Such scripts are rarely needed.  But all kinds of "good" for copying, synchronization, launching something, more than enough.  And if in your favorite Midnight Commander you suddenly clicked on the wrong script, then anything can happen to the system.  It's like the rules of the road - "written in blood." <br><h2>  Tip 2 </h2>  Starting from the previous one, it‚Äôs nice to put something like: at the beginning of each script: <pre><code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">read</span></span> -n 1 -p <span class="hljs-string"><span class="hljs-string">" ,     (y/[a]): "</span></span> AMSURE [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$AMSURE</span></span></span><span class="hljs-string">"</span></span> = <span class="hljs-string"><span class="hljs-string">"y"</span></span> ] || <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> 1&gt;&amp;2</code> </pre>  The echo command, by the way, is needed here because after pressing the &lt;y&gt; button you will not have a line feed, therefore, the next output will go to the same line. <br><h2>  Tip 3 </h2>  This is the key advice of all.  In order not to write the same thing every time - use libraries of functions.  After reading a lot of articles on Bash, I have to admit that this topic receives little attention.  Perhaps because of evidence.  However, I consider it necessary to recall this.  So. <br>  Get your own library of functions, for example myfunc.sh, and put it, for example, in / usr / bin.  When writing scripts, it will not only help reduce your work, but also allow you to modify many scripts in one fell swoop if you improve any function. <br>  For example, in the light of Tip 2, you can write this function: <a name="habracut"></a><pre> <code class="bash hljs"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myAskYN</span></span></span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> AMSURE <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -n <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> ] ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> -n 1 -p <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string"> (y/[a]): "</span></span> AMSURE <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> -n 1 AMSURE <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> 1&gt;&amp;2 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$AMSURE</span></span></span><span class="hljs-string">"</span></span> = <span class="hljs-string"><span class="hljs-string">"y"</span></span> ] ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> 0 <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> 1 <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> }</code> </pre>  The only optional parameter this function takes is the question string.  If the string is not set - silent wait for pressing (in cases where the script has already managed to display all that is needed before calling this function).  Thus, the application may be such: <pre> <code class="bash hljs">myAskYN <span class="hljs-string"><span class="hljs-string">" ,    ?"</span></span> || <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre>  You can write another similar function myAskYNE, with the letter E at the end, in which return is replaced with exit.  Then the recording will be even easier: <pre> <code class="bash hljs">myAskYNE <span class="hljs-string"><span class="hljs-string">" ,    ?"</span></span></code> </pre>  The advantages are obvious: a) write less code, b) code is easier to read, c) do not get distracted by trifles, like the prefix "(y / [a]):" to the test (I note that [a] means any, and taken into square quotes indicates that this is the default). <br>  And the last is here.  In order to use functions from our library, you need to remember to include it in the script itself: <pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash a1=myfunc.sh ; source "$a1" ; if [ $? -ne 0 ] ; then echo " ‚Äî    $a1" 1&gt;&amp;2 ; exit 1 ; fi myAskYN " ,    ?" echo Run!</span></span></code> </pre>  I deliberately put the whole call and error handling in one line, because this thing is standard and does not relate directly to the logic of the script.  Why stretch it half a screen?  Note also that the name of the script is assigned to a variable.  This allows you to specify the name of the script once, and therefore, you can duplicate the string and replace the library name to connect another library of functions, if necessary. <br>  Now, any script starting with these three lines will never do something without confirmation.  I grant you to write a function similar to myAskYN, called myAskYESNO. <br><h2>  Tip 4 </h2>  Develop success and demonstrate some obvious features with minimal comments. <pre> <code class="bash hljs"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sayWait</span></span></span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> AMSURE [ -n <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> ] &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$@</span></span></span><span class="hljs-string">"</span></span> 1&gt;&amp;2 <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> -n 1 -p <span class="hljs-string"><span class="hljs-string">"(    )"</span></span> AMSURE <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> 1&gt;&amp;2 } <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cdAndCheck</span></span></span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ! [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(pwd)</span></span></span><span class="hljs-string">"</span></span> = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> ] ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"!!     </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string"> -  . ."</span></span> 1&gt;&amp;2 <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> 1 <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> } <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkDir</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ! [ -d <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> ] ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -z <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$2</span></span></span><span class="hljs-string">"</span></span> ] ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"!!  </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string"> -  . ."</span></span> 1&gt;&amp;2 <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$2</span></span></span><span class="hljs-string">"</span></span> 1&gt;&amp;2 <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> 1 <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> } <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkFile</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ! [ -f <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> ] ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -z <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$2</span></span></span><span class="hljs-string">"</span></span> ] ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"!!  </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string"> -  . ."</span></span> 1&gt;&amp;2 <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$2</span></span></span><span class="hljs-string">"</span></span> 1&gt;&amp;2 <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> 1 <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> } <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkParm</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -z <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> ] ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"!!</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$2</span></span></span><span class="hljs-string">.  . ."</span></span> 1&gt;&amp;2 <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> 1 <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> }</code> </pre>  Here I will draw your attention to the constantly occurring combination 1&gt; &amp; 2 after echo.  The fact is that your scripts will probably display some valuable information.  And this information does not always fit into the screen, and therefore it is not bad to save it to a file or send it to less.  The combination 1&gt; &amp; 2 means redirecting output to the standard error device.  And when you call the script like this: <pre> <code class="bash hljs">my-script.sh &gt; out.txt my-script.sh | less</code> </pre>  there will be no unnecessary erroneous and service messages, but only what you really want to display. <br><h2>  Tip 5 </h2>  Bash does not do well with returning a value from a function.  However, using your own library, this issue is easily solved.  Just get a variable in which the function will enter the value, and on exiting the function analyze this variable.  By the way, the declaration of a variable is well placed at the beginning of the library of your functions.  Also, you can create other variables that will be used everywhere.  Here is the beginning of your library of functions: <pre> <code class="bash hljs">curPath= <span class="hljs-comment"><span class="hljs-comment">#     ,    cRes= #        pYes= #  --yes,   </span></span></code> </pre>  Now we can add another useful function to the collection: <pre> <code class="bash hljs"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">input1</span></span></span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> a1 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -n <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> ] ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> -p <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> -sn 1 cRes <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> -sn 1 cRes <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> <span class="hljs-comment"><span class="hljs-comment">#    while [ "$2" = "${2#*$cRes}" ] ; do read -sn 1 cRes done echo $cRes 1&gt;&amp;2 }</span></span></code> </pre>  Here is an example of its use: <pre> <code class="bash hljs">cat &lt;&lt;<span class="hljs-string"><span class="hljs-string">'EOF'</span></span>   : ------------------------ a)  1 b)  2 .)  EOF input1 <span class="hljs-string"><span class="hljs-string">" : "</span></span> <span class="hljs-string"><span class="hljs-string">"ab."</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">" : </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$cRes</span></span></span><span class="hljs-string">"</span></span></code> </pre>  This function restricts keystrokes to the list of specified ones (for example, a, b, and dot).  No other keys will be perceived and nothing will be displayed when they are pressed.  The example also shows the use of a return variable ($ cRes).  It returns the letter pressed by the user. <br><h2>  Tip 6 </h2>  What script without parameters?  About their processing written tons of literature.  I will share my vision. <br><ol><li>  It is highly desirable that the parameters be processed regardless of their sequence. </li><li>  I do not like to use single-letter parameters (and therefore getopts) for the simple reason that there are a lot of scripts and few letters.  And remember that for one script -r means replace, for another replicate, and for the third, remove is almost impossible.  Therefore, I use 2 notations, and at the same time: a) - show-files-only, b) -sfo (as a contraction from the previous one).  Practice shows that such keys are remembered instantly and for a very long time. </li><li>  The script should give an error to an unknown key.  This will partially help to identify errors when writing parameters. </li><li>  From council 2 we take the rule: never run a script without confirmation.  But we add to this an important exception - if the --yes key is not specified (the key, of course, can be any). </li><li>  Keys may be accompanied by a value.  In this case, the following rule applies for long keys: --source-file = my.txt (spelling through equals), and for short ones: -sf my.txt (separated by spaces). </li></ol>  In this light, the processing parameters may look like this: <pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> [ 1 ] ; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> = <span class="hljs-string"><span class="hljs-string">"--yes"</span></span> ] ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> pYes=1 <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${1#--source-file=}</span></span></span><span class="hljs-string">"</span></span> != <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> ] ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> pSourceFile=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${1#--source-file=}</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> = <span class="hljs-string"><span class="hljs-string">"-sf"</span></span> ] ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">shift</span></span> ; pSourceFile=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${1#--dest-file=}</span></span></span><span class="hljs-string">"</span></span> != <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> ] ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> pDestFile=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${1#--dest-file=}</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> = <span class="hljs-string"><span class="hljs-string">"-df"</span></span> ] ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">shift</span></span> ; pDestFile=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> [ -z <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> ] ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">break</span></span> <span class="hljs-comment"><span class="hljs-comment">#   else echo ":  " 1&gt;&amp;2 exit 1 fi shift done checkParm "$pSourceFile" "   " checkParm "$pDestFile" "   " if [ "$pYes" != "1" ] ; then myAskYNE " ,    ?" fi echo "source=$pSourceFile, destination=$pDestFile"</span></span></code> </pre>  This code provides the following features: <ul><li><pre> <code class="bash hljs">./test.sh -sf mysource -df mydest ./test.sh --<span class="hljs-built_in"><span class="hljs-built_in">source</span></span>-file=mysource --dest-file=mydest ./test.sh --<span class="hljs-built_in"><span class="hljs-built_in">source</span></span>-file=mysource --dest-file=mydest --yes</code> </pre> </li><li>  Parameters can be set in any order and combinations of full and abbreviated key forms. </li><li>  Since the parameters are required, there is a check for their presence (but not correctness), thanks to checkParm. </li><li>  If the --yes key is missing, a confirmation prompt will appear. </li></ul>  This is the basic part that can be developed further.  For example, add a couple of parameter processing functions to our library: <pre> <code class="bash hljs"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">procParmS</span></span></span></span>() { [ -z <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$2</span></span></span><span class="hljs-string">"</span></span> ] &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> 1 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$2</span></span></span><span class="hljs-string">"</span></span> ] ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> cRes=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$3</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> 0 <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> 1 } <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">procParmL</span></span></span></span>() { [ -z <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> ] &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> 1 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${2#$1=}</span></span></span><span class="hljs-string">"</span></span> != <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$2</span></span></span><span class="hljs-string">"</span></span> ] ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> cRes=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${2#$1=}</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> 0 <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> 1 }</code> </pre>  At the same time, the parameter processing cycle will look much more digestible: <pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> [ 1 ] ; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> = <span class="hljs-string"><span class="hljs-string">"--yes"</span></span> ] ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> pYes=1 <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> procParmS <span class="hljs-string"><span class="hljs-string">"-sf"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$2</span></span></span><span class="hljs-string">"</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> pSourceFile=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$cRes</span></span></span><span class="hljs-string">"</span></span> ; <span class="hljs-built_in"><span class="hljs-built_in">shift</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> procParmL <span class="hljs-string"><span class="hljs-string">"--source-file"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> pSourceFile=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$cRes</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> procParmS <span class="hljs-string"><span class="hljs-string">"-df"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$2</span></span></span><span class="hljs-string">"</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> pDestFile=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$cRes</span></span></span><span class="hljs-string">"</span></span> ; <span class="hljs-built_in"><span class="hljs-built_in">shift</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> procParmL <span class="hljs-string"><span class="hljs-string">"--dest-file"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> pDestFile=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$cRes</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> [ -z <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> ] ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">break</span></span> <span class="hljs-comment"><span class="hljs-comment">#   else echo ":  " 1&gt;&amp;2 exit 1 fi shift done</span></span></code> </pre>  In fact, this cycle can be copied from the script to the script without thinking about anything other than the names of the keys and the name of the variable for this key.  And in this case they are not repeated and the possibility of error is excluded. <br>  There is no limit to perfection, and you can ‚Äúimprove‚Äù functions for a long time, for example, in procParmS, check the third parameter for a non-empty value and fall out by mistake in such a case.  And so on. <br>  The function library file from this example can be downloaded <a href="http://linuxmy.com//mystat/habr0001/myfunc">here</a> . <br>  Test file <a href="http://linuxmy.com//mystat/habr0001/test">here</a> . </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/158971/">https://habr.com/ru/post/158971/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../158959/index.html">Microsoft Surface as an attempt to lift your hair</a></li>
<li><a href="../158961/index.html">Using RabbitMQ in django projects without Celery, and what's new in Celery 3.0</a></li>
<li><a href="../158963/index.html">Eliminating the artifacts of compression PVRTC textures</a></li>
<li><a href="../158965/index.html">Understanding MSP430 and Toilet Automation</a></li>
<li><a href="../158969/index.html">Difficult forms in Django</a></li>
<li><a href="../158973/index.html">Good Practice on setting up a small local network based on Active Directory</a></li>
<li><a href="../158975/index.html">Introduction to Pedestrian Modeling</a></li>
<li><a href="../158977/index.html">The digest of interesting news and materials from the world of PHP over the past two weeks, ‚Ññ4 (03.11.2012 - 16.11.2012)</a></li>
<li><a href="../158979/index.html">Experiment with kanban board or how to do everything</a></li>
<li><a href="../158983/index.html">Understanding shaders in Unity3D with a specific example</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>