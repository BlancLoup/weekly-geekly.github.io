<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Architecture IoT-solutions on a real example</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue to talk about solution development companies (ISVs). In this issue, the technical director of the company INPROSISTEM AlexandrSurkov tells...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Architecture IoT-solutions on a real example</h1><div class="post__text post__text-html js-mediator-article"><blockquote><p>  <em>We continue to talk about solution development companies (ISVs).</em>  <em>In this issue, the technical director of the company INPROSISTEM <a href="https://habrahabr.ru/users/alexandrsurkov/" class="user_link">AlexandrSurkov</a> tells about the experience of developing the architecture of <a href="http://sesmick.ru/">security IoT-system SESMIK</a> .</em> </p></blockquote><br><br>  Many believe that the concept of <a href="https://ru.wikipedia.org/wiki/%25D0%2598%25D0%25BD%25D1%2582%25D0%25B5%25D1%2580%25D0%25BD%25D0%25B5%25D1%2582_%25D0%25B2%25D0%25B5%25D1%2589%25D0%25B5%25D0%25B9">‚ÄúInternet of Things‚Äù</a> is inextricably linked to the network that we use every day.  One can imagine a picture where a multitude of devices, united in a single whole through a global network, exchange data between themselves and servers and create a digital picture of the world.  In this article I will talk about how we made a system that combines hundreds of sensors. <br><a name="habracut"></a><br><br>  The concept of "Internet" should be considered much broader.  In this case, it is a common network for devices.  It may contain 10 devices, and maybe 10,000. It can be wired, and maybe wireless.  It may be located in the same room, and may cover several countries.  It all depends on the tasks that are put in front of the system. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      At the same time creating even a small network of devices is accompanied by many difficulties. <br><br><h3>  Formulation of the problem </h3><br><br>  We were assigned the task of developing a perimeter security system.  The perimeter is a fence surrounding an object.  Its length is unlimited. <br><br>  The system was created from scratch.  By the time the design began, there was a prototype of a sensor capable of collecting perimeter vibrations, by analyzing which, it was possible to clearly determine whether the fence was being overcome or destroyed.  Experimentally, we determined that the sensors should be placed approximately every 10 meters. <br><br>  In addition to sensors, control devices with relays and controlled devices with ‚Äúdry contact‚Äù were planned.  The system should work in outdoor conditions with a wide range of temperatures and weather conditions. <br><br>  So, there is: <br><ul><li>  3 types of devices; </li><li>  At least 100 devices per kilometer; </li><li>  The number of kilometers is unlimited; </li><li>  The system must have street performance. </li></ul><br><br>  You can immediately identify the main issues of architecture: <br><ul><li>  Organization of data transmission and power; </li><li>  Distribution of information flows: where and how to analyze data; </li><li>  Security solutions: what protocols to use; </li><li>  How to manage so many devices. </li></ul><br><br><h3>  General solution scheme </h3><br><br>  Clemens Vasters has written an <a href="http://blogs.msdn.com/b/clemensv/archive/2014/02/10/service-assisted-communication-for-connected-devices.aspx">excellent article</a> on what the developer of the Internet of Things is facing.  The same problems had to be solved by us. <br><br>  Many solutions were dictated by GOST and other requirements for such systems.  But much had to come up with themselves. <br><br>  First, it was necessary to understand how to distribute information flows in the system.  For the analysis of oscillations, both the time and frequency components were used.  The frequency range from 0 to 500 hertz.  Means, measurements need to be done 1000 times a second.  Each measurement is made in 3 axes of 10 bits each. <br>  Total 3 * 10 * 1000 = 30 kilobits per second from only one sensor.  Per kilometer (100 sensors) it is already 3 megabits. <br><br>  You can transfer this data, but how to process it?  A perimeter of 10 km would have given 30 megabits of data per second.  It turns out that the server load increases with the number of devices. <br><br>  It was decided that each sensor would process the data itself and give only alarm facts.  This significantly reduced the amount of data and distributed the computational load. <br><br>  Networking was chosen wired due to the fact that wireless requires a battery.  Since the system is real-time, the battery life will be very small.  In addition, negative temperatures greatly reduce the capacity of the power supply.  Yes, and mute the wireless connection is relatively easy, and this is already a very significant drawback to the security system. <br><br>  GOSTs prohibit laying 220V on the fence, so our devices will be ‚Äúpowered‚Äù from constant voltage. <br><br>  We chose a bus as the network architecture.  This made it possible not to pull the wire to each sensor. <br><br>  However, the bus imposes a restriction on the length of the network and the number of devices.  Therefore, a new device was introduced: the gateway.  It has 2 buses, is engaged in device management and data broadcasting to and from the server.  He also controls the parameters of nutrition and the environment. <br>  Thus, another large load is removed from the server: sensor management. <br><br>  In addition, such a modular approach with a distributed computational load makes it possible to integrate a very large number of sensors into a common system without a significant increase in server requirements. <br><br>  The remaining actuators as well as the sensors are connected to the bus. <br><br>  The result is such a scheme: <br><br><img src="https://habrastorage.org/files/d26/91c/bc2/d2691cbc291a455392209ce7dd17e060.png"><br><br>  <b>Selection of protocols and methods of interaction</b> <br><br>  Now it was necessary to determine how the data will be transmitted.  Each device in the system participates in 2 types of exchange: <br><ul><li>  command from the server - the answer to the server; </li><li>  asynchronous event from device to server. </li></ul><br><br>  Commands are used to change the status of a device and its settings.  Events are generated if the device has information for the server (for example, an alarm from the sensor) <br><br>  On the server side, the gateway is considered to be the same actuating device as everyone else, since, in addition to managing devices on the bus, it also takes care of monitoring power and temperature parameters. <br><br>  As a bus, the choice was mainly between <a href="https://ru.wikipedia.org/wiki/RS-485">RS485</a> and <a href="https://ru.wikipedia.org/wiki/Controller_Area_Network">CAN</a> .  Only these two standards made it possible to connect multiple devices over fairly large distances. <br><br>  As a result of the analysis, we preferred CAN.  The network parameters are as follows: <br><ul><li>  Maximum 500 meters; </li><li>  Maximum 100 devices; </li><li>  The speed is 50 kbps. </li></ul><br><br>  In our opinion, these are the optimal balance of speed, device density and network length for our system. <br><br>  The gateway uses a microcontroller with two CAN drivers on board, which allowed us to make 2 flank and close one gateway 1 km. <br><br>  CAN also has other advantages: noise immunity, collision resolution and guaranteed delivery of packets to the addressee.  In addition, it has a fairly strong model for diagnosing errors in the network. <br><br>  However, CAN is only the link layer of the network.  To work directly with it, there are many higher level protocols.  The most famous of them is <a href="https://ru.wikipedia.org/wiki/CANopen">CANOpen</a> . <br><br>  After examining the various options, we concluded that none of the protocols does not suit us.  Some are too complicated for our task, some require fees for use, and some do not support what we would like to implement. <br><br>  And I wanted to implement the system on the principle of <a href="https://ru.wikipedia.org/wiki/Plug_and_Play">PlugAndPlay</a> : <br><ul><li>  Connecting and disconnecting devices without power off; </li><li>  Automatic detection of system configuration changes; </li><li>  The system should start working immediately after assembly. </li></ul>  . <br><br>  As a result, we managed to do what was intended by writing our own simple but powerful enough protocol.  Since we are talking about a small bus bandwidth and a small computing power of microcontrollers, the type of protocol was chosen byte.  Due to the optimization of bandwidth, the protocol turned out to be rather strongly connected with CAN, but we managed to make it theoretically portable to other standards. <br><br>  The protocol allows: <br><ul><li>  Detect connected devices on the fly </li><li>  detect disconnection of devices; </li><li>  work in the mode of request-response; </li><li>  send asynchronous events; </li><li>  transfer streaming data from the device. </li></ul><br><br>  Having established the exchange between devices and the gateway, it remains to deal with the server. <br><br>  Gateway has an <a href="https://ru.wikipedia.org/wiki/Ethernet">Ethernet</a> output.  This is the most universal data transmission technology.  The network can be organized as you like: optical channels, wireless channels, a regular twisted pair - at the same time we can always connect to this network using optical converters and access points.  This allows the customer to design the network infrastructure of any complexity and length. <br><br>  Data transfer was organized using TCP / IP based <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25BE%25D0%25BA%25D0%25B5%25D1%2582%25D1%258B_%25D0%2591%25D0%25B5%25D1%2580%25D0%25BA%25D0%25BB%25D0%25B8">Socket Berkeley</a> .  This solution allows the server to receive information from any sensor guaranteed and does not depend on software platforms.  We have developed our own protocol over TCP / IP.  It is also byte, to optimize the work on the side of the microcontroller.  Byte protocols have a big minus: complexity with the subsequent modification.  However, the text protocol for the microcontroller device is too redundant. <br><br>  The most difficult in terms of software development was the server.  We implemented an asynchronous multi-threaded interaction model, which allowed us to obtain a ‚Äúlive‚Äù system that instantly reacts to any changes.  Connecting a new device, loss of communication with the gateway, alarm from the sensor, opening the lid on the device - any event in the system is instantly recorded, even if they occur simultaneously. <br><br>  As a result, we got a flexible modular system, managed through a single center - the server.  It also has its own protocol, allowing you to connect to it and receive events in the system.  This allows you to use our system as an integral part of a large complex and scale it almost to infinity. <br><br><img src="https://habrastorage.org/files/9fc/e2a/83e/9fce2a83ef694678abb5bde41e4eaa95.png"><br><br><h3>  Security questions </h3><br><br>  With the security of the system, everything turned out to be quite simple.  The fact is that all networks that are located on protected objects are themselves protected objects.  Thus, all networks with which the system works become ‚Äútrusted‚Äù. <br><br>  In addition, the ‚Äúprice‚Äù of hacking the security information system is much higher than other ways to overcome.  In other words, an experienced intruder will find a simpler way to overcome the obstacle, and a less experienced one simply cannot crack the system. <br><br>  Therefore, we did not use any special ways to protect information, limiting ourselves only to the basic principles. <br><br><h3>  What's next? </h3><br><br>  Despite the fact that the system has already been formed, we continue to actively develop it and look for new methods of application. <br><br>  One of the directions of development of the system is machine learning.  Using these algorithms, you can filter out regular interference, such as noise from a truck train and aircraft.  In experiments for this direction Azure Machine Learning helps us a lot.  It contains many ready-made solutions for machine learning, which allows you to quickly get results. <br>  Analysis of fence oscillations is not the only way to use the technologies incorporated in our system.  Controlling vibrations of high-rise buildings, pipelines and gas pipelines, fragile loads, vibration diagnostics of turbines and moving parts of various designs is not a complete list of possibilities. <br><br>  The number of sensors in such systems will only increase and here we practically do not pass the transition to cloud systems at sites for which the use of the Internet is not prohibited. <br><br>  The new IoT technologies from Microsoft seem very promising to us.  A single Windows platform can theoretically save a lot of time, since you can write code that is common for different hardware platforms. <br><br>  And for data processing use Azure IoT Suite.  According to the developers, it contains tools that allow not only to combine and manage multiple IoT devices, but also to process large amounts of data from them.  This is what we are going to check in the near future. <br><br><h3>  Conclusion </h3><br><br>  When we started developing the system, the concept of ‚ÄúInternet of Things‚Äù has not yet gained such popularity.  There was little experience, we encountered many things for the first time.  Now, when much is written and told about this concept, it has become clear that the right path has been chosen. <br><br>  The work was difficult and long.  Creating the first commercial version of the system took about 3 years.  The first went to the development of engineering samples of individual devices.  Another year was spent on developing the system as a whole.  The third year was debugging and debugging. <br><br>  During this time we have gained tremendous experience in solving various engineering problems.  Moreover, the selection of buildings, cable products, organization of production and logistics took no less effort than the development of the system itself. <br><br>  Now the system is mounted and works on many objects in Russia and abroad.  The largest of them consists of several perimeters with a total length of more than 15 km.  In the design are larger objects. <br><br>  More information can be obtained on <a href="http://sesmick.ru/">the system website</a> . </div><p>Source: <a href="https://habr.com/ru/post/272657/">https://habr.com/ru/post/272657/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../272647/index.html">IBM cloud service translates applications into 9 languages</a></li>
<li><a href="../272649/index.html">Photoshop for coder (programmer)</a></li>
<li><a href="../272651/index.html">MongoDB as a monitoring tool for LOG files</a></li>
<li><a href="../272653/index.html">On the other side of the game: an open course on game design</a></li>
<li><a href="../272655/index.html">How we taught 1C to generate an IVR menu for Asterisk</a></li>
<li><a href="../272659/index.html">Next, in search of palindromes 3</a></li>
<li><a href="../272661/index.html">NOT unlimited mailbox, or Tale about the secret limitation of Mail.ru</a></li>
<li><a href="../272667/index.html">Practice: How to set up an HP ProLiant ML10v2 server and prepare it for OS installation</a></li>
<li><a href="../272669/index.html">Tarantool as an application server</a></li>
<li><a href="../272671/index.html">ICQ mobile application design contest</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>