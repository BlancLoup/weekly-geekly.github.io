<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The results of the study of authentication methods and some mechanisms of protection against WEB-attacks on the example of Google, VK and others</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What is the topic? 
 In this article I will talk about the implementations of different functionalities (mainly on web services) to ensure the safety ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The results of the study of authentication methods and some mechanisms of protection against WEB-attacks on the example of Google, VK and others</h1><div class="post__text post__text-html js-mediator-article"><h4>  What is the topic? </h4><br>  In this article I will talk about the implementations of different functionalities (mainly on web services) to ensure the safety of users on the example of the ‚Äúgiants‚Äù of the modern IT industry.  This material will be useful to developers, architects, team leads and managers in setting tasks of similar functionality.  The implementations in the article were developed by teams of professionals, tested by time and hundreds of millions of users (as well as by a large number of hackers), although there are no guarantees that this particular implementation is absolutely correct and 100% safe, of course not.  Information is based on personal analysis of these resources. <br><a name="habracut"></a><br><br><h4>  Authorization </h4><br>  The most successful and interesting option is implemented in VK.  Described in brief <a href="http://habrahabr.ru/post/156517/">here</a> .  The password is entered on the main page of the site, but the action of the form leads to the subdomain (login.vk.com), a cookie is set there for the current domain (login.vk.com) and for vk.com (remixsid).  If something is wrong with the cookie on the ‚Äúmain‚Äù domain (changed, the last IP did not match, etc.), a redirect to login.vk.com automatically occurs.  And if the password was actually entered in this browser, then it will have a persistent cookie (which was set when entering the password), which will be used for automatic login.  If it is not there (for example, cookies were taken away via XSS), then it will not allow your account.  There is also a record of the latest active sessions - 6 pieces, which are considered ‚Äúalive‚Äù and which can be completed in your personal account, which is very convenient.  Google also has a separate domain for authorization.  And since it has a lot of different services, then the authorization also sends a list of services, where to start with these cookies. <br><br><h4>  Two-factor authentication </h4><br>  They talk about it to the left and to the right and in the general case it is customary to implement <abbr title="One time password">OTP by</abbr> sending via SMS.  Take Google again as an example.  And the first problem: the connection is not available, what should the user do?  To do this, we implemented two solutions: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  Offline generation of OTP through the application on a mobile device.  The first step is the synchronization of the website and the mobile application by entering a special code.  After the passwords on the server and on the mobile phone are matched in time (it is better that the phone is synchronized via NTP).  Those.  On the mobile device, offline, the password is displayed, which is suitable as an OTP (every minute - a new password).  As a result, anywhere, with a working mobile device, we can log in without receiving an SMS / receiving a call from Google. </li><li>  One-time, already generated, passwords.  On the <a href="https://accounts.google.com/b/0/SmsAuthSettings">accounts.google.com/b/0/SmsAuthSettings</a> page, you can retrieve and print passwords that will always (once) come up when you request an OTP code.  Can be printed and put in wallet </li></ul><br>  Authorization of Google employees on their internal portal <a href="https://login.corp.google.com/">login.corp.google.com</a> also happens with the use of two-factor authorization, but you can also use usb-token (analogy with banks) for authorization. <br><br>  What to do if your service provides an API for mobile devices?  And some applications running outside the browser are incompatible with two-step authentication and cannot request verification codes?  Here, following the example of Google, we solved the problem as follows.  You can generate an <a href="https://accounts.google.com/IssuedAuthSubTokens%3Fhl%3Dru">"application password"</a> .  The name of the application is entered and the one-time issue (nowhere and never is displayed) is the password for the application, which must be entered instead of the password. <br><br><h4>  Password recovery </h4><br>  The logical continuation will be this item.  Using the standard scheme with the expulsion of a link to the mail, what is better to do, generate a new password yourself or give the opportunity to enter it to the user?  In general, the second method (Google) is preferable.  But if you decide to use the first one, generate a password with at least 7-8 characters (letters / numbers / at least one special character).  Literally the other day, I analyzed a table with users and passwords, where the password was set automatically (md5, 6 characters, [a-zA-Z0-9]).  And for a penny got them in pure form.  Anyway, it is recommended: sha * and two "salts".  (Ie kind of sha * ($ stat_salt. $ password. $ email)), i.e.  when, with a full database dump, no password will still be able to be decrypted, since the static ‚Äúsalt‚Äù (which, for example, is protected in the code) will be unknown.  But this is a topic for another conversation. <br><br>  It is also important to understand that it is also necessary to implement it correctly.  Example: Facebook, last year.  Password recovery via SMS.  They send us the code on the phone, we enter it and change the end user id in the form.  As a result, we change the password to any user.  How could you not check the user ID, which we change the password?  How was it possible not to match the sent code in SMS and user id?  Epic fail. <br><br><h4>  CSRF Protection </h4><br>  Protection against <abbr title="CSRF (English ross Site Request Forgery - ‚ÄúCross-site request forgery‚Äù, also known as XSRF) is a type of attack on website visitors that uses the disadvantages of the HTTP protocol. If the victim enters the site created by the attacker, a request is secretly sent to another server (for example, to the server of the payment system), performing some kind of malicious operation (for example, transferring money to the attacker's account). In order to carry out this attack, the victim must be authorized on the server to which the request is sent, and this request must not require any confirmation from the user, which cannot be ignored or forged by the attacking script.">CSRF</abbr> correctly implemented using the "hidden" tokens (&lt;input type = "hidden"&gt;).  But how to generate them correctly?  Google, at each authorization, issues a token to the session and stores it in a cookie.  Those.  looks cookie, looks what came in the form, if everything is ok - we work further.  That is, one token for all actions in a single session.  It is wrong to ask the user if there is a mismatch of tokens, whether he really wanted to perform this action (‚Äúhello‚Äù to the service developers who just recognized themselves in this article), as this is very doubtful (the user can click the machine) + there are workarounds for such ‚Äúclarification requests‚Äù ".  Vkontakte acted differently - they generate one token for each action, which is based on the current user id, action id and some ‚Äútarget‚Äù id (user, community / public number, etc.).  But, unfortunately, it is not checked everywhere. <br><br><h4>  Separate content domain </h4><br>  All user content <b>needs</b> to <b>be</b> uploaded to a separate domain.  This can save from a variety of threats.  Google has googleusercontent.com, VK has vk.me.  Using the example of an <a href="http://habrahabr.ru/company/dsec/blog/202784/">XSS</a> article <a href="http://habrahabr.ru/company/dsec/blog/202784/">iOS device using the example of software from Facebook, Google, VKontakte</a> , when the ‚Äúfeature‚Äù of an entire platform for exploiting a vulnerability cannot do any harm - another indicator than a separate (isolated, no cookie) domain for user content is important . <br><br><h4>  Content Security Policy </h4><br>  Now many resources are actively developing with CSP.  For example, Yandex recently implemented a version of mail with full CSP support.  CSP is a header that tells the browser where it comes from (from what addresses) and what content (pictures, scripts) can be downloaded.  As a result, when an attacker even finds a way to conduct an XSS attack, he cannot send any data directly to another server, or even execute inline scripts.  Of course, there are also workarounds, for example, you can generate a picture and embed js into it and, if possible, upload it to one of the allowed domains.  And refer to it &lt;script src "... image.gif&gt;, <a href="http://sergeybelove.ru/tools/img_js.html">an example</a> . <br><br><h4>  HSTS </h4><br>  Speaking again about the HTTP headers ( <a href="http://habrahabr.ru/post/168739/">article</a> ), it is impossible not to mention the <abbr title="HSTS (abbr. From the English. HTTP Strict Transport Security) - a mechanism that activates the forced secure connection via the HTTPS protocol. This security policy allows you to immediately establish a secure connection, instead of using the HTTP protocol. The mechanism uses a special HTTP Strict-Transport-Security header to switch a user who has logged in via HTTP to an HTTPS server.">HSTS</abbr> .  It's one thing just to send it. <br>  Another thing is that there is a pre-shared sheet in Chrome and Firefox, among which are listed the domains that must be visited via HTTPS - <a href="http://src.chromium.org/viewvc/chrome/trunk/src/net/">src.chromium.org/viewvc/chrome/trunk/src/net/http/transport_security_state_static.json</a> . <br>  You can send a request to add your resource in the mail <img src="http://dev.chromium.org/_/rsrc/1273071774544/sts/email.png"><br><br><h4>  Accounts on 3rd-party resources </h4><br>  Quite often (and sometimes necessary) to use the services of other services (domain registration, monitoring, etc.).  And it <i>seems like</i> there is a cycle (for example, once every 3 months) when the password is changed on all such resources.  Good practice. <br><br>  Perhaps somewhere else the ‚Äúgiants‚Äù (I have no information) use VPN access to work resources (frequent practice and in small companies) and some other protection mechanisms.  If you know those - share in the comments :) <br><br>  <b>upd:</b> <a href="https://twitter.com/isox_xx/status/423063347378933760">It is possible</a> that Apple uses VPN. </div><p>Source: <a href="https://habr.com/ru/post/209042/">https://habr.com/ru/post/209042/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../209030/index.html">HTC: One X, One X + will remain on the current version of Android</a></li>
<li><a href="../209032/index.html">FutuReView: the story of one R & D project</a></li>
<li><a href="../209034/index.html">Launching a platform for public discussions of legislative initiatives in the IT sphere - # We speak for the Internet</a></li>
<li><a href="../209038/index.html">Google simplified image search by license type</a></li>
<li><a href="../209040/index.html">Import data to online stores</a></li>
<li><a href="../209048/index.html">Use new reports in the structured data dashboard to fix markup errors.</a></li>
<li><a href="../209050/index.html">Geonames, Google Maps, Geocoding, time zones and everything, everything, everything</a></li>
<li><a href="../209056/index.html">The Power of Objective-C 2.0. Effective programming for iOS and OS X</a></li>
<li><a href="../209060/index.html">Samsung branded retail in the province: we test and wonder</a></li>
<li><a href="../209062/index.html">IT Tree with Hackspace</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>