<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Making a greeting card on March 8 in HTML5 and EaselJS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="(the picture is clickable and congratulatory) 

 The general idea : flying butterflies on the background of a beautiful picture and spring music. ( I ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Making a greeting card on March 8 in HTML5 and EaselJS</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://kichinsky-2.hosting.parking.ru/projects/march8/"><img src="https://habrastorage.org/getpro/habr/post_images/30a/8a3/24a/30a8a324afd4dda081ad4c234a4076f4.png"></a> <br><br>  <font>(the picture is clickable and congratulatory)</font> <br><br>  <strong>The general idea</strong> : flying butterflies on the background of a beautiful picture and spring music.  ( <em>I confess at once that I also had a Silverlight version of a postcard that I did a year ago.</em> <em><a href="http://blogs.msdn.com/b/kichinsky/archive/2010/03/04/how-to-create-animated-butterflies-in-expression-blend.aspx">A lesson on the animation of butterflies in Silverlight</a> .</em> ) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In addition to the standard CSS tools, we will use HTML5 Canvas and the <a href="http://easeljs.com/">EaselJS</a> animation library to <a href="http://easeljs.com/">render the postcard</a> . <br><a name="habracut"></a><br><h4>  Butterfly Animation </h4><br><br>  We will start with the assumption that you have already prepared butterflies and that you have separate wings in the form of corresponding pictures: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4a6/3f9/2a6/4a63f92a6614feb1a493565a70e34aea.png"><br><br><h5>  Step 1. Drawing the Wings </h5><br>  Let's first draw a couple of wings.  To draw each of the wings, we need a <em>Bitmap</em> class, whose objects we will create based on the loaded images.  To put the wings together, we need the <em>Container</em> class <em>.</em>  To draw a scene in EaselJS there is a class <em>Stage</em> . <br><br>  <strong>Loading images</strong> <br>  To upload images, you need to use the standard <em>Image</em> by hanging the corresponding events on it: <br><br><blockquote><code><font color="black"><font color="#008000">// loading left wing</font> <br> leftImg = <font color="#0000ff">new</font> Image(); <br> leftImg.src = leftSrc; <br> leftImg.onload = onWingImageLoaded; <br> <br> <font color="#008000">// loading right wing</font> <br> rightImg = <font color="#0000ff">new</font> Image(); <br> rightImg.src = rightSrc; <br> rightImg.onload = onWingImageLoaded;</font></code> </blockquote> <br><br>  (Ideally, you should also hang up events for an error in the download and handle it correctly.) <br><br>  <strong>Butterfly assembly</strong> <br>  After both wings are loaded, you need to collect them in one container, which can be operated as a whole: <br><br><blockquote> <code><font color="black"><font color="#008000">// create a new container for butterfly wings</font> <br> <font color="#0000ff">var</font> butterfly = <font color="#0000ff">new</font> Container(); <br> <font color="#008000">// create wings</font> <br> <font color="#0000ff">var</font> lWing = <font color="#0000ff">new</font> Bitmap(leftImg); <br> <font color="#0000ff">var</font> rWing = <font color="#0000ff">new</font> Bitmap(rightImg); <br> <br> <font color="#008000">// assemble a batterfly</font> <br> butterfly.addChild(lWing); <br> butterfly.addChild(rWing);</font></code> </blockquote> <br><br>  For each of the wings inside the container, you need to move the registration point relative to which they will be positioned and further rotate: <br><br><blockquote> <code><font color="black"><font color="#008000">// change wings registration point inside container</font> <br> lWing.regX = lWing.image.width; <br> lWing.regY = lWing.image.height / 2; <br> rWing.regX = 0; <br> rWing.regY = rWing.image.height / 2;</font></code> </blockquote> <br><br>  <strong>Butterfly placement</strong> <br>  Next, add a butterfly to the stage, place it in the right place and start the scene drawing: <br><br><blockquote> <code><font color="black"><font color="#008000">// add butterfly to stage</font> <br> stage.addChild(butterfly); <br> <br> <font color="#008000">// change batterfly position</font> <br> butterfly.x = canvas.width * Math.random() | 0; <br> butterfly.y = canvas.height * Math.random() | 0; <br> <br> <font color="#008000">// redraw stage</font> <br> stage.update();</font></code> </blockquote> <br><br>  <strong>Common code</strong> <br><blockquote> <code><font color="black"><font color="#0000ff">var</font> leftSrc = <font color="#A31515">"../images/Cypres 1.png"</font> ; <br> <font color="#0000ff">var</font> rightSrc = <font color="#A31515">"../images/Cypres 2.png"</font> ; <br> <font color="#0000ff">var</font> leftImg; <br> <font color="#0000ff">var</font> rightImg; <br> <font color="#0000ff">var</font> loadedWings = 0; <br> <br> <font color="#0000ff">function</font> init() { <br> <font color="#008000">// create a new stage and point it at our canvas:</font> <br> canvas = <font color="#0000ff">document</font> .getElementById( <font color="#A31515">"canvas"</font> ); <br> stage = <font color="#0000ff">new</font> Stage(canvas); <br> <br> <font color="#008000">// loading left wing</font> <br> leftImg = <font color="#0000ff">new</font> Image(); <br> leftImg.src = leftSrc; <br> leftImg.onload = onWingImageLoaded; <br> <br> <font color="#008000">// loading right wing</font> <br> rightImg = <font color="#0000ff">new</font> Image(); <br> rightImg.src = rightSrc; <br> rightImg.onload = onWingImageLoaded; <br> } <br> <br> <font color="#0000ff">function</font> onWingImageLoaded( <font color="#0000ff">event</font> ) { <br> loadedWings++; <br> <font color="#0000ff">if</font> (loadedWings == 2) <br> onButterflyReady(); <br> } <br> <br> <font color="#0000ff">function</font> onButterflyReady() { <br> <font color="#008000">// create a new container for butterfly wings</font> <br> <font color="#0000ff">var</font> butterfly = <font color="#0000ff">new</font> Container(); <br> <font color="#008000">// create wings</font> <br> <font color="#0000ff">var</font> lWing = <font color="#0000ff">new</font> Bitmap(leftImg); <br> <font color="#0000ff">var</font> rWing = <font color="#0000ff">new</font> Bitmap(rightImg); <br> <br> <font color="#008000">// assemble a batterfly</font> <br> butterfly.addChild(lWing); <br> butterfly.addChild(rWing); <br> <br> <font color="#008000">// change wings registration point inside container</font> <br> lWing.regX = lWing.image.width; <br> lWing.regY = lWing.image.height / 2; <br> rWing.regX = 0; <br> rWing.regY = rWing.image.height / 2; <br> <br> <br> <font color="#008000">// add butterfly to stage</font> <br> stage.addChild(butterfly); <br> <br> <font color="#008000">// change batterfly position</font> <br> butterfly.x = canvas.width * Math.random() | 0; <br> butterfly.y = canvas.height * Math.random() | 0; <br> <br> <font color="#008000">// redraw stage</font> <br> stage.update(); <br> }</font></code> </blockquote> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/22b/757/bd2/22b757bd280c142c6908ca1f1dee9182.png"><br><br>  <font>Ready example, you can find here:</font> <a href="http://kichinsky-2.hosting.parking.ru/projects/march8/samples/sample1.htm"><font>example 1</font></a> <font>.</font> <br><br><h5>  Step 2. Wing our wings </h5><br>  <strong>Timer</strong> <br>  Run animations or sequentially occurring events in various ways.  In EaselJS, you can subscribe to the scene update timer and make changes at each step.  (This is similar to the game state update cycle, in which scene rendering occurs on a timer.) <br><br>  First you need to subscribe to the timer (the response frequency can also be set): <br><br><blockquote> <code><font color="black">Ticker.addListener(window);</font></code> </blockquote> <br><br>  Next, you need to define the tick function in the windows scope, inside which you need to update the state of the scene and start the drawing: <br><br><blockquote> <code><font color="black"><font color="#008000">// update scene on each tick</font> <br> <font color="#0000ff">function</font> tick() { <br> butterfly.move() <br> stage.update(); <br> }</font></code> </blockquote> <br><br>  <strong>Step by Step Wing Animation</strong> <br>  To describe the animation of a butterfly, you need to break all the wings of the wings and move into separate steps.  But first, let's set another parameter defining the initial state of the butterfly, the initial scale (in principle, you can not set it if you do not plan to make butterflies of different sizes, then scale = 1.0): <br><br><blockquote> <code><font color="black"><font color="#008000">// initial scale</font> <br> butterfly.scale = butterfly.lWing.scaleX <br> = butterfly.lWing.scaleY = butterfly.rWing.scaleX <br> = butterfly.rWing.scaleY = 0.5 + 0.2 * Math.random();</font></code> </blockquote> <br><br>  Wing animations are well done through horizontal (X) scaling, and for periodicity, you can use trigonometric functions. <br><br>  Let's set the number of animation steps: <br><br><blockquote> <code><font color="black"><font color="#008000">// animation steps</font> <br> butterfly.step = butterfly.steps = 40 + 60 * Math.random();</font></code> </blockquote> <br><br>  It now remains to describe each stroke: <br><br><blockquote> <code><font color="black">butterfly.move = <font color="#0000ff">function</font> () { <br> <font color="#0000ff">var</font> wingAngle = (butterfly.steps - butterfly.step) / butterfly.steps * Math.PI; <br> butterfly.lWing.scaleX = butterfly.rWing.scaleX <br> = butterfly.scale * (0.4 + 0.6 * Math.abs(Math.cos(wingAngle * 4))); <br> <br> butterfly.step--; <br> }</font></code> </blockquote> <br><br>  <strong>Common code</strong> <br><blockquote> <code><font color="black"><font color="#0000ff">var</font> leftSrc = <font color="#A31515">"../images/Cypres 1.png"</font> ; <br> <font color="#0000ff">var</font> rightSrc = <font color="#A31515">"../images/Cypres 2.png"</font> ; <br> <font color="#0000ff">var</font> leftImg; <br> <font color="#0000ff">var</font> rightImg; <br> <font color="#0000ff">var</font> loadedWings = 0; <br> <font color="#0000ff">var</font> butterfly; <br> <font color="#0000ff">var</font> butterflyLoaded = <font color="#0000ff">false</font> ; <br> <br> <font color="#0000ff">function</font> init() { <br> <font color="#008000">// create a new stage and point it at our canvas:</font> <br> canvas = <font color="#0000ff">document</font> .getElementById( <font color="#A31515">"canvas"</font> ); <br> stage = <font color="#0000ff">new</font> Stage(canvas); <br> <br> <font color="#008000">// loading left wing</font> <br> leftImg = <font color="#0000ff">new</font> Image(); <br> leftImg.src = leftSrc; <br> leftImg.onload = onWingImageLoaded; <br> <br> <font color="#008000">// loading right wing</font> <br> rightImg = <font color="#0000ff">new</font> Image(); <br> rightImg.src = rightSrc; <br> rightImg.onload = onWingImageLoaded; <br> <br> <font color="#008000">// subscribe to Ticker</font> <br> Ticker.addListener(window); <br> } <br> <br> <font color="#0000ff">function</font> onWingImageLoaded( <font color="#0000ff">event</font> ) { <br> loadedWings++; <br> <font color="#0000ff">if</font> (loadedWings == 2) <br> onButterflyReady(); <br> } <br> <br> <font color="#0000ff">function</font> onButterflyReady() { <br> <font color="#008000">// create a new container for butterfly wings</font> <br> butterfly = <font color="#0000ff">new</font> Container(); <br> <font color="#008000">// create wings</font> <br> butterfly.lWing = <font color="#0000ff">new</font> Bitmap(leftImg); <br> butterfly.rWing = <font color="#0000ff">new</font> Bitmap(rightImg); <br> <br> <font color="#008000">// assemble a batterfly</font> <br> butterfly.addChild(butterfly.lWing); <br> butterfly.addChild(butterfly.rWing); <br> <br> <font color="#008000">// change wings registration point inside container</font> <br> butterfly.lWing.regX = butterfly.lWing.image.width; <br> butterfly.lWing.regY = butterfly.lWing.image.height / 2; <br> butterfly.rWing.regX = 0; <br> butterfly.rWing.regY = butterfly.rWing.image.height / 2; <br> <br> <br> <font color="#008000">// add butterfly to stage</font> <br> stage.addChild(butterfly); <br> <br> <font color="#008000">// change batterfly position</font> <br> butterfly.x = canvas.width * Math.random() | 0; <br> butterfly.y = canvas.height * Math.random() | 0; <br> <br> <font color="#008000">// initial rotation</font> <br> butterfly.lWing.rotation = butterfly.rWing.rotation <br> = butterfly.angle = 360 * Math.random() | 0; <br> <br> <font color="#008000">// initial scale</font> <br> butterfly.scale = butterfly.lWing.scaleX <br> = butterfly.lWing.scaleY = butterfly.rWing.scaleX <br> = butterfly.rWing.scaleY = 0.5 + 0.2 * Math.random(); <br> <br> <font color="#008000">// animation steps</font> <br> butterfly.step = butterfly.steps = 40 + 60 * Math.random(); <br> <br> <font color="#008000">// move butterfly</font> <br> butterfly.move = <font color="#0000ff">function</font> () { <br> <font color="#0000ff">var</font> wingAngle = (butterfly.steps - butterfly.step) / butterfly.steps * Math.PI; <br> butterfly.lWing.scaleX = butterfly.rWing.scaleX <br> = butterfly.scale * (0.4 + 0.6 * Math.abs(Math.cos(wingAngle * 4))); <br> <br> butterfly.step--; <br> } <br> <br> butterflyLoaded = <font color="#0000ff">true</font> ; <br> <br> <font color="#008000">// redraw stage</font> <br> stage.update(); <br> } <br> <br> <font color="#008000">// update scene on each tick</font> <br> <font color="#0000ff">function</font> tick() { <br> <font color="#0000ff">if</font> (butterflyLoaded &amp;&amp; butterfly.step &gt;= 0) { <br> butterfly.move() <br> } <br> stage.update(); <br> }</font></code> </blockquote> <br><br> <font><img src="https://habrastorage.org/getpro/habr/post_images/55e/c65/09a/55ec6509a3f436889ae6852adff5e96b.png"><img src="https://habrastorage.org/getpro/habr/post_images/1d9/42e/cb6/1d942ecb6b0069e19f9a47493cb2bb43.png"></font> <br><br>  <font>Ready example, you can find here:</font> <a href="http://kichinsky-2.hosting.parking.ru/projects/march8/samples/sample2.htm"><font>example 2</font></a> <font>.</font> <br><br><h5>  Step 3. Move the butterfly </h5><br>  Now that we have taught the butterfly to flap its wings, let's get it moving.  To do this, we will need to take into account the angle of rotation and the direction and speed of movement: <br><br><blockquote> <code><font color="black"><font color="#008000">// initial rotation</font> <br> butterfly.lWing.rotation = butterfly.rWing.rotation <br> = butterfly.angle = 360 * Math.random() | 0; <br> <font color="#008000">// movement direction</font> <br> butterfly.direction = 8 * Math.random() - 4.0; <br> <font color="#008000">// movement speed</font> <br> butterfly.speed = 5 * Math.random() + 5;</font></code> </blockquote> <br><br>  Inside the <em>butterfly.move</em> function, it remains to add a change in the angle of rotation: <br><br><blockquote> <code><font color="black">butterfly.angle += butterfly.direction + (5.0 * Math.random() - 2.5); <br> butterfly.lWing.rotation = butterfly.rWing.rotation = butterfly.angle;</font></code> </blockquote> <br><br>  and increase in movement: <br><br><blockquote> <code><font color="black">butterfly.x += (butterfly.speed * Math.sin((butterfly.angle) / 180.0 * Math.PI)); <br> butterfly.y -= (butterfly.speed * Math.cos((butterfly.angle) / 180.0 * Math.PI));</font></code> </blockquote> <br><br>  The butterfly should fly. <br><br> <font><img src="https://habrastorage.org/getpro/habr/post_images/3d8/920/930/3d8920930e8aa4d6e04d618a73497bc3.png"></font> <br><br>  <font>Ready example, you can find here:</font> <a href="http://kichinsky-2.hosting.parking.ru/projects/march8/samples/sample3.htm"><font>example 3</font></a> <font>.</font> <br><br><h5>  Step 4. We make the code </h5><br>  Since we will need to process the whole collection of butterflies, it is logical to select the code describing the butterfly's work in a separate block (the added reaction to the mouse is also highlighted in blue): <br><br><blockquote> <code><font color="black">( <font color="#0000ff">function</font> (window) { <br> <br> Butterfly = <font color="#0000ff">function</font> (leftImg, rightImg) { <br> <font color="#0000ff">this</font> .initialize(); <br> <font color="#0000ff">this</font> .initButterfly(leftImg, rightImg); <br> } <br> <br> <font color="#0000ff">var</font> p = Butterfly.prototype = <font color="#0000ff">new</font> Container(); <br> <br> p.lWing = <font color="#0000ff">null</font> ; <br> p.rWing = <font color="#0000ff">null</font> ; <br> p.angle = 0; <br> p.direction = 0; <br> p.speed = 0; <br> <br> p.steps = 0; <br> p.step = -1; <br> <br> p.initButterfly = <font color="#0000ff">function</font> (leftImg, rightImg) { <br> <font color="#008000">// create wings</font> <br> <font color="#0000ff">this</font> .lWing = <font color="#0000ff">new</font> Bitmap(leftImg); <br> <font color="#0000ff">this</font> .rWing = <font color="#0000ff">new</font> Bitmap(rightImg); <br> <br> <font color="#008000">// change wings registration point inside container</font> <br> <font color="#0000ff">this</font> .lWing.regX = <font color="#0000ff">this</font> .lWing.image.width; <br> <font color="#0000ff">this</font> .lWing.regY = <font color="#0000ff">this</font> .lWing.image.height / 2; <br> <font color="#0000ff">this</font> .rWing.regX = 0; <br> <font color="#0000ff">this</font> .rWing.regY = <font color="#0000ff">this</font> .rWing.image.height / 2; <br> <br> <font color="#008000">// initial rotation</font> <br> <font color="#0000ff">this</font> .lWing.rotation = <font color="#0000ff">this</font> .rWing.rotation = <font color="#0000ff">this</font> .angle = 360 * Math.random() | 0; <br> <br> <font color="#008000">// initial scale</font> <br> <font color="#0000ff">this</font> .scale = <font color="#0000ff">this</font> .lWing.scaleX = <font color="#0000ff">this</font> .lWing.scaleY = <font color="#0000ff">this</font> .rWing.scaleX = <font color="#0000ff">this</font> .rWing.scaleY = 0.5 + 0.2 * Math.random(); <br> <br> <font color="#008000">// assembling batterfly</font> <br> <font color="#0000ff">this</font> .addChild( <font color="#0000ff">this</font> .lWing); <br> <font color="#0000ff">this</font> .addChild( <font color="#0000ff">this</font> .rWing); <br> <br> <font color="#0000ff">this</font> .mouseEnabled = <font color="#0000ff">true</font> ; <br> <font color="#0000ff">this</font> .onMouseOver = <font color="#0000ff">function</font> (e) { <font color="#0000ff">this</font> .reset(); }; <br> }; <br> <br> p.reset = <font color="#0000ff">function</font> () { <br> <font color="#008000">// animation steps</font> <br> <font color="#0000ff">this</font> .step = <font color="#0000ff">this</font> .steps = 40 + 60 * Math.random(); <br> <font color="#008000">// movement direction</font> <br> <font color="#0000ff">this</font> .direction = 8 * Math.random() - 4.0; <br> <font color="#008000">// movement speed</font> <br> <font color="#0000ff">this</font> .speed = 5 * Math.random() + 5; <br> }; <br> <br> p.move = <font color="#0000ff">function</font> () { <br> <font color="#008000">// update rotation</font> <br> <font color="#0000ff">this</font> .angle += <font color="#0000ff">this</font> .direction + (5.0 * Math.random() - 2.5); <br> <font color="#0000ff">this</font> .lWing.rotation = <font color="#0000ff">this</font> .rWing.rotation = <font color="#0000ff">this</font> .angle; <br> <br> <font color="#008000">// update wings</font> <br> <font color="#0000ff">var</font> wingAngle = ( <font color="#0000ff">this</font> .steps - <font color="#0000ff">this</font> .step) / <font color="#0000ff">this</font> .steps * Math.PI; <br> <font color="#0000ff">this</font> .lWing.scaleX = <font color="#0000ff">this</font> .rWing.scaleX = <font color="#0000ff">this</font> .scale * (0.4 + 0.6 * Math.abs(Math.cos(wingAngle * 4))); <br> <br> <font color="#008000">// update position</font> <br> <font color="#0000ff">this</font> .x += ( <font color="#0000ff">this</font> .speed * Math.sin(( <font color="#0000ff">this</font> .angle) / 180.0 * Math.PI)); <br> <font color="#0000ff">this</font> .y -= ( <font color="#0000ff">this</font> .speed * Math.cos(( <font color="#0000ff">this</font> .angle) / 180.0 * Math.PI)); <br> <font color="#0000ff">this</font> .step--; <br> }; <br> <br> p.isActive = <font color="#0000ff">function</font> () { <br> <font color="#0000ff">return</font> <font color="#0000ff">this</font> .step &gt;= 0; <br> }; <br> <br> window.Butterfly = Butterfly; <br> } (window));</font></code> </blockquote> <br><br>  The remaining piece of code is simplified a bit, you also need to enable tracking of mouse events: <br><br><blockquote> <code><font color="black"><font color="#0000ff">var</font> leftSrc = <font color="#A31515">"../images/Cypres 1.png"</font> ; <br> <font color="#0000ff">var</font> rightSrc = <font color="#A31515">"../images/Cypres 2.png"</font> ; <br> <font color="#0000ff">var</font> leftImg; <br> <font color="#0000ff">var</font> rightImg; <br> <font color="#0000ff">var</font> loadedWings = 0; <br> <font color="#0000ff">var</font> butterfly; <br> <font color="#0000ff">var</font> butterflyLoaded = <font color="#0000ff">false</font> ; <br> <br> <font color="#0000ff">function</font> init() { <br> <font color="#008000">// create a new stage and point it at our canvas:</font> <br> canvas = <font color="#0000ff">document</font> .getElementById( <font color="#A31515">"canvas"</font> ); <br> stage = <font color="#0000ff">new</font> Stage(canvas); <br> stage.enableMouseOver(10); <br> <br> <font color="#008000">// loading left wing</font> <br> leftImg = <font color="#0000ff">new</font> Image(); <br> leftImg.src = leftSrc; <br> leftImg.onload = onWingImageLoaded; <br> <br> <font color="#008000">// loading right wing</font> <br> rightImg = <font color="#0000ff">new</font> Image(); <br> rightImg.src = rightSrc; <br> rightImg.onload = onWingImageLoaded; <br> <br> <font color="#008000">// subscribe to Ticker</font> <br> Ticker.addListener(window); <br> } <br> <br> <font color="#0000ff">function</font> onWingImageLoaded( <font color="#0000ff">event</font> ) { <br> loadedWings++; <br> <font color="#0000ff">if</font> (loadedWings == 2) <br> onButterflyImagesReady(); <br> } <br> <br> <font color="#0000ff">function</font> onButterflyImagesReady() { <br> <font color="#008000">// create a new container for butterfly wings</font> <br> <font color="#0000ff">var</font> butterfly = <font color="#0000ff">new</font> Butterfly(leftImg, rightImg); <br> <br> <font color="#008000">// add butterfly to stage</font> <br> stage.addChild(butterfly); <br> <br> <font color="#008000">// change batterfly position</font> <br> butterfly.x = canvas.width * Math.random() | 0; <br> butterfly.y = canvas.height * Math.random() | 0; <br> <br> butterfly.reset(); <br> butterflyLoaded = <font color="#0000ff">true</font> ; <br> <br> <font color="#008000">// redraw stage</font> <br> stage.update(); <br> } <br> <br> <font color="#008000">// update scene on each tick</font> <br> <font color="#0000ff">function</font> tick() { <br> <font color="#0000ff">if</font> (butterflyLoaded &amp;&amp; butterfly.step &gt;= 0) { <br> butterfly.move() <br> } <br> stage.update(); <br> }</font></code> </blockquote> <br><br>  <font>Ready example, you can find here:</font> <a href="http://kichinsky-2.hosting.parking.ru/projects/march8/samples/sample4.htm"><font>example 4</font></a> <font>.</font> <br><br><h4>  Lots and lots of butterflies </h4><br>  Now let's add more butterflies.  We will need an array of wing image addresses: <br><br><blockquote> <code><font color="black"><font color="#0000ff">var</font> bfimgsrc = [{ left: <font color="#A31515">"../images/Didius 1.png"</font> , right: <font color="#A31515">"../images/Didius 2.png"</font> }, <br> { left: <font color="#A31515">"../images/Amphitrion 1.png"</font> , right: <font color="#A31515">"../images/Amphitrion 2.png"</font> }, <br> { left: <font color="#A31515">"../images/Catenarius 1.png"</font> , right: <font color="#A31515">"../images/Catenarius 2.png"</font> }, <br> { left: <font color="#A31515">"../images/Cyanides 1.png"</font> , right: <font color="#A31515">"../images/Cyanides 2.png"</font> }, <br> { left: <font color="#A31515">"../images/Cypres 1.png"</font> , right: <font color="#A31515">"../images/Cypres 2.png"</font> }, <br> { left: <font color="#A31515">"../images/Diana 1.png"</font> , right: <font color="#A31515">"../images/Diana 2.png"</font> }, <br> { left: <font color="#A31515">"../images/Hecuba 1.png"</font> , right: <font color="#A31515">"../images/Hecuba 2.png"</font> }, <br> { left: <font color="#A31515">"../images/Peleides 1.png"</font> , right: <font color="#A31515">"../images/Peleides 2.png"</font> }, <br> { left: <font color="#A31515">"../images/Polyphemus 1.png"</font> , right: <font color="#A31515">"../images/Polyphemus 2.png"</font> }, <br> { left: <font color="#A31515">"../images/Sulkowski 1.png"</font> , right: <font color="#A31515">"../images/Sulkowski 2.png"</font> }];</font></code> </blockquote> <br><br>  Creating the butterflies will be <em>moved</em> to a separate function <em>loadButterflyis</em> and we will launch more butterflies by mouse click: <br><br><blockquote> <code><font color="black"><font color="#0000ff">function</font> init() { <br> <font color="#008000">// create a new stage and point it at our canvas:</font> <br> canvas = <font color="#0000ff">document</font> .getElementById( <font color="#A31515">"canvas"</font> ); <br> stage = <font color="#0000ff">new</font> Stage(canvas); <br> stage.enableMouseOver(10); <br> <br> loadButterflyis(18); <br> <br> canvas.onclick = <font color="#0000ff">function</font> () { <br> loadButterflyis(5); <br> }; <br> <br> <font color="#008000">// subscribe to Ticker</font> <br> Ticker.addListener(window); <br> } <br> <br> <font color="#0000ff">function</font> loadButterflyis(count) { <br> <font color="#0000ff">for</font> ( <font color="#0000ff">var</font> k = 0; k &lt; count; k++) { <br> <font color="#0000ff">var</font> i = Math.floor(bfimgsrc.length * Math.random()); <br> <br> <font color="#0000ff">var</font> bfimages = { <br> left: <font color="#0000ff">new</font> Image(), <br> right: <font color="#0000ff">new</font> Image(), <br> loadedWings: 0, <br> onready: onButterflyImagesReady <br> }; <br> <br> <font color="#008000">// loading left wing</font> <br> bfimages.left.src = bfimgsrc[i].left; <br> bfimages.left.onload = onWingImageLoaded; <br> bfimages.left.butterfly = bfimages; <br> <br> <font color="#008000">// loading right wing</font> <br> bfimages.right.src = bfimgsrc[i].right; <br> bfimages.right.onload = onWingImageLoaded; <br> bfimages.right.butterfly = bfimages; <br> } <br> }</font></code> </blockquote> <br><br>  Updated <em>tick</em> : <br><br><blockquote> <code><font color="black"><font color="#008000">// update scene on each tick</font> <br> <font color="#0000ff">function</font> tick() { <br> <font color="#0000ff">for</font> ( <font color="#0000ff">var</font> i = 0; i &lt; bfs.length; i++) { <br> <font color="#0000ff">var</font> butterfly = bfs[i]; <br> <font color="#0000ff">if</font> (butterfly.isActive()) { <br> butterfly.move(); <br> } <br> <font color="#0000ff">else</font> <font color="#0000ff">if</font> (Math.random() &gt; 0.999) { <br> butterfly.reset(); <br> } <br> } <br> stage.update(); <br> }</font></code> </blockquote> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6ea/c9d/6a6/6eac9d6a6bc59a551e9ccc8d982dfe08.png"><br><br>  <font>Ready example, you can find here:</font> <a href="http://kichinsky-2.hosting.parking.ru/projects/march8/samples/sample5.htm"><font>example 5</font></a> <font>.</font> <br><br><br><h4>  Special effects </h4><br>  Additional effects will be pretty simple.  Themed background: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/223/077/8bc/2230778bc04ff7552dd18770c95d3cfc.png"><br><br>  And the audio on the background: <br><br><blockquote> <code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">audio</font> <font color="#ff0000">src</font> <font color="#0000ff">="audio/ArrivalForest.mp3"</font> <font color="#ff0000">autoplay</font> <font color="#ff0000">loop</font> <font color="#0000ff">/&gt;</font></font></code> </blockquote> <br>  (Mogul enthusiasts easily add support for other audio formats.) <br><br>  <a href="http://constantin.kichinsky.ru/projects/march82011/"><font>The final version is also available</font></a> <font>.</font> <br><br><h4>  Upd. </h4><br>  I solve the problem with hosting, laid out temporarily on the test parking and separately: intermediate examples and the final version in one file - <a href="http://narod.ru/disk/6923480001/March8.zip.html">narod.ru/disk/6923480001/March8.zip.html</a> <br><br> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="gray">Source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </div><p>Source: <a href="https://habr.com/ru/post/115030/">https://habr.com/ru/post/115030/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../115023/index.html">Google, unite!</a></li>
<li><a href="../115024/index.html">Patch intrusive warning "Press Esc for ..." in Flash Player version 10.2.152.32</a></li>
<li><a href="../115026/index.html">RMQ Task - 2. Segment Tree</a></li>
<li><a href="../115027/index.html">Mobile Firefox 4 beta 5</a></li>
<li><a href="../115029/index.html">We translate mobile Firefox in fullscreen mode for Android</a></li>
<li><a href="../115031/index.html">Realization of this 3D effect in your projects</a></li>
<li><a href="../115034/index.html">Adult game</a></li>
<li><a href="../115039/index.html">What to read on the weekend? Recommend</a></li>
<li><a href="../115040/index.html">‚ÄúI don‚Äôt think I don‚Äôt like it. Turbo C ++ doesn‚Äôt launch the program ..‚Äù (c) Viktor Sergeevich</a></li>
<li><a href="../115041/index.html">Publish a variety of content for a couple of clicks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>