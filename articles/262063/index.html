<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Almost duplicate search and geometry</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, I came across a task to search for almost duplicates among a large number of short texts. The search for a ready-made solution did not lead ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Almost duplicate search and geometry</h1><div class="post__text post__text-html js-mediator-article">  Recently, I came across a task to search for almost duplicates among a large number of short texts.  The search for a ready-made solution did not lead to success, and the resulting solution turned out to be quite interesting, and I could not deny myself the pleasure to share it. <br><br><h2>  Wording </h2><br>  There is a large database of texts (hundreds of thousands of texts).  The length of the text is about the same, about 250 characters, the language is English.  Some of the texts were edited (typos were corrected, commas were placed, etc.);  Thus, both the original text and its corrected copy appear in the database.  There are not many such pairs, say no more than 1%.  Task: find all such pairs. <br><a name="habracut"></a><br>  For the formal definition of what ‚Äúedited text‚Äù is, the editorial distance is well suited (I use the <a href="https://docs.python.org/2/library/difflib.html">difflib</a> module in python).  Since there are usually few revisions, it is enough to take pairs of texts that differ by no more than 2-3 edits. <br><br>  The problem is that there are a lot of texts and it is impossible to compare them in pairs because the editorial distance is calculated rather slowly.  Moreover, there is no simple natural way to split texts into small groups (for example, by subject) in order to reduce the score. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  main idea </h2><br>  I would like to break the entire set of texts into small subsets in such a way that it was necessary to calculate the editorial distance only within the subsets.  This can be done in the following way: we associate each text with a point in a certain multidimensional space so that the texts close in the editorial sense are translated into close points, and the far texts into, so to say, not very close points.  It is enough to calculate the editorial distance only for close in a geometrical sense texts. <br><br>  The second requirement for the mapping is quite soft - you can make mistakes, and translate far texts into close points.  But each such error leads to an extra distance calculation. <br><br>  To quickly find nearby points, you can use the spatial index. <br><br><h2>  Implementation </h2><br>  As such a display ‚Äútext -&gt; dot‚Äù, a display counting letters will suit.  The space we are considering will have a dimension equal to the number of letters in the alphabet of the language.  The coordinate corresponding to a letter will be equal to the number of occurrences of the letter X in the text.  For example, f ("aac") = [2, 0, 1, 0, ..., 0].  We use only letters as coordinates, and do not use punctuation, because observations of texts showed that punctuation can change much more (and not necessarily because of human editing; for example, outwardly similar punctuation characters can be encoded by different unicode sequences). <br><br>  Thus, we get from the definition that close texts will be displayed in close points. <br>  It turns out that the opposite condition will be fulfilled quite accurately (for small distances, this is our case). <br><br>  After each text is assigned a dot, we build a <a href="https://en.wikipedia.org/wiki/R-tree">spatial index</a> on these points (I use the <a href="https://pypi.python.org/pypi/Rtree/">rtree</a> module for python).  The index allows you to make quick queries like "find all points that fall into a certain multidimensional box". <br><br>  Around each point we describe a cube with a side = 4 (~ 2 * number of edits) and look at all the points that fall into this cube.  Search edited texts can be limited only to this cube. <br><br><h3>  Small optimization </h3><br>  You can reduce the number of points for testing by editing distance by increasing the dimension of space.  A natural candidate for an increase in dimension is the introduction of n-grams as coordinates.  On the other hand, increasing the dimension reduces the performance of spatial indexes.  Naturally, there is the task of identifying ‚Äúuseful‚Äù n-grams. <br><br>  However, even a simple introduction of a small number of coordinates <pre><code class="python hljs">hash(bigramm) % p</code> </pre>  (the remainder of dividing the hash of the bigram by a natural number p) gives a strong decrease in the number of points in the cube. <br>  (The choice of parameters depends on the properties of the text database, the implementation of the hash function, but on my base, using p = 3 reduces the number of test pairs by half). <br>  Not all bigrams are equally useful.  It turns out that increasing the dimension (modulus p) does not necessarily reduce the number of pairs tested.  This is due to the fact that, when taking the remainder, some digrams, useful in themselves, merge into one coordinate. <br><br><h2>  Funny observation </h2><br>  It turns out that with almost-identical sets of letters, sometimes you can describe dozens of sentences quite different in meaning (i.e., a large number of texts can fall into one cube with a small side length).  However, this rarely happens (on the basis I have). <br><br>  It is hard to believe, but the following two texts are very close geometrically: "JSE MARKET REPORT JSE" and "365 Data Centers Offers Cloud Storage 17 US Markets 25 September 2014". </div><p>Source: <a href="https://habr.com/ru/post/262063/">https://habr.com/ru/post/262063/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../262051/index.html">Development of trainings in the grocery company</a></li>
<li><a href="../262053/index.html">We collect people base from open data WhatsApp and VK</a></li>
<li><a href="../262055/index.html">The word ‚ÄúM‚Äù, or Monads, is already here.</a></li>
<li><a href="../262057/index.html">Twelve simple initial steps to developing a module for Node.js</a></li>
<li><a href="../262061/index.html">Malefactors actively use 0day vulnerability of Flash Player for cyber attacks</a></li>
<li><a href="../262065/index.html">Combining offices in 3CX (Part 2. Use Session Boarder Controller)</a></li>
<li><a href="../262067/index.html">Plot chat, or how we won first place on wth.by</a></li>
<li><a href="../262069/index.html">RabbitMQ Spring tutorial</a></li>
<li><a href="../262071/index.html">How to correctly select and buy Backup Exec 15</a></li>
<li><a href="../262073/index.html">Horizontal scaling of database servers for OLTP systems, or what is on the market</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>