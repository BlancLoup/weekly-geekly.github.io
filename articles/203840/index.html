<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a brickwork for the site</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The company Sidzheko is engaged in supporting the website of the organization Reconstroy , which sells and delivers brick, tile, architectural decor a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a brickwork for the site</h1><div class="post__text post__text-html js-mediator-article">  The company <a href="http://sijeko.ru/">Sidzheko</a> is engaged in supporting the website of the organization <a href="http://xn--e1aicmebjeik.xn--p1ai/">Reconstroy</a> , which sells and delivers brick, tile, architectural decor and many other building materials in the Central Black Earth Region. <br><br>  In the process of working on the site, the idea of ‚Äã‚Äãa brickwork appeared. <br><br>  The German concern " <a href="http://feldhaus-klinker.de/">Feldhaus Klinker</a> " has model series of brick "Vascu Mix" and "Sintra Mix", which are specifically designed to mix in different proportions and create a unique pattern of masonry.  There are a number of ‚ÄúQuick Mix‚Äù putties applied to them, when the joints of masonry joints between bricks are plastered over.  To demonstrate this approach, we decided to make a brickwork constructor, which I haven‚Äôt seen yet in the runet (I will be happy with examples). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <a href="http://xn--e1aicmebjeik.xn--p1ai/%25D0%25BA%25D0%25BE%25D0%25BD%25D1%2581%25D1%2582%25D1%2580%25D1%2583%25D0%25BA%25D1%2582%25D0%25BE%25D1%2580-%25D0%25BA%25D0%25BB%25D0%25B0%25D0%25B4%25D0%25BA%25D0%25B8"><img src="https://habrastorage.org/getpro/habr/post_images/f86/657/f93/f86657f9349b23d8880d927aad363907.jpg" alt="  " title="Brick construction"></a> <br><br><a name="habracut"></a><br><br>  On the bricks and seams, shadows and scratches are superimposed to bring the drawing as close to life as possible.  Switches decided to stylize a touch device.  For the designer, hundreds of images were processed: photos of clutches, bricks, putties for seams, etc. <br><br>  Mode "Drunk Master" - fun for: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8b8/ee3/765/8b8ee37655505e1de370e723b488bb84.jpg" alt=" ¬´ ¬ª" title="Drunk Master Mode"><br><br><br><br><h4>  Process </h4><br>  We leave the designer with the pictures (in fact, the amount of work there is disproportionately more than the programmer side of the matter), Dima's fronterer does nicely on the client side, I try to make it to his skill on the backend. <br><br>  So‚Ä¶ <br><br><h4>  Basic steps </h4><br>  We take all the possible photos of the clutches that we could only find in the company's promotional materials, add our photos. <br><br>  Cut bricks, we clipping them with transparent fields. <br><br>  We bring images of bricks to one size.  From each model we need a few real photos, so that as a result it would be boring. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/834/f83/90f/834f8390fe80aed9e91be6fcc2703dc7.png" alt="" title="Bricks"><br><br>  Virtual clutch is not built in the same sequence as the real one :-) <br>  So, first fill the entire field with a picture of the seam, propagating it to the desired size of the picture. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e9c/854/b9e/e9c854b9e8e41fe583441f6b96d5b54e.jpg" alt="image"><br><br>  Then we fill a layer of bricks in which different models of a ruler are mixed in the necessary proportion.  Even rows are shifted horizontally by half a half from odd ones.  (There are other drawings of clutches for business lovers, but so far it has been decided to focus on the classic in order to meet the deadlines.) <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e17/8c8/675/e178c8675e6cd30d34c2c7a2c0637c0b.jpg" alt="image"><br><br>  It would be possible to stop, but it looks too refined.  Reality is always better: rubbing, scratching - the appearance of each thing reflects its history.  It is necessary to artificially ‚Äúwear out‚Äù the image with noises. <br><br>  You can make noise simply by randomly changing each pixel of the image.  But it works for a long time, and it doesn't look very good: we, after all, want to emulate the real texture of materials, and not the ISO-noise of the camera. <br><br><pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//  () for ($x = 0; $x &lt; $allWidth; $x++) for ($y = 0; $y &lt; $allHeight; $y++) imagesetpixel($image, $x, $y, imagecolorallocatealpha($image, 0xff, 0xff, 0xff, MyRand::rand(115, 127)));</span></span></code> </pre> <br><img src="http://habrastorage.org/storage3/373/bb6/c94/373bb6c94be7a75798720f9fc6c14d99.jpg" alt="Random noise"><br><br>  Let's go in a more interesting way (which, moreover, will greatly save the time of image generation) - apply ‚Äúscratches‚Äù. <br><br>  Scratches are essentially lines of white and black with random length, inclination and transparency.  If the upper part of the line is light and the lower part is dark, it looks like a <i>bulge</i> in the image, if the upper part is dark and the lower light looks like a <i>scratch</i> (bulge, yes). <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//   () //    for ($x = 0; $x &lt; 5000; $x++) { $dotX = MyRand::rand(0, $allWidth); $dotY = MyRand::rand(0, $allHeight); $scratchWidth = MyRand::rand(1, 8); // 80% - (+1)  20%  (-1) $scratchAdj = MyRand::rand(0, 10) &gt; 8 ? -1 : +1; for ($i = 0; $i &lt; $scratchWidth; $i++) { imagesetpixel($image, $dotX+$i, $dotY+$scratchAdj, imagecolorallocatealpha($image, 0xff, 0xff, 0xff, MyRand::rand(95, 110))); imagesetpixel($image, $dotX+$i, $dotY, imagecolorallocatealpha($image, 0x00, 0x00, 0x00, MyRand::rand(95, 110))); } }</span></span></code> </pre><br><img src="http://habrastorage.org/storage3/06c/e5b/c78/06ce5bc78a4e4c4e3644f95a1d3831c0.jpg" alt=" " title="Selective noise"><br><br>  Without noise and with them: <br><br><img src="http://habrastorage.org/storage3/d2f/aab/464/d2faab4648115102b867a09bba08cc14.jpg" alt="    " title="No noise and with them"><br><br>  It remains to apply the copyright.  Load the font (Ubuntu will do). <br><br><pre> <code class="php hljs">imagettftext($image, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">90</span></span>, $allWidth - <span class="hljs-number"><span class="hljs-number">7</span></span>, $allHeight - <span class="hljs-number"><span class="hljs-number">7</span></span>, imagecolorallocatealpha($image, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">90</span></span>), <span class="hljs-string"><span class="hljs-string">'font/ubuntu-r.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'Sijeko Brick Generator '</span></span> . GENERATOR_VERSION);</code> </pre><br><img src="http://habrastorage.org/storage3/07a/eee/67a/07aeee67aac5fdfc5bc9b066d139ecb1.jpg" alt="" title="Copyright"><br><br>  Done! <br><br>  The output constructor can produce both JPEG and PNG (all source images in PNG24), but due to the large size of the resulting PNG, we stopped at JPEG. <br><br><h5>  Caching and URLs </h5><br>  The second time to build an image with the same input parameters is not necessary, we will spare the processor and the user;  save the image at the first call and issue it from the cache on subsequent ones. <br><br>  The ID of the image cache (the same - the file name) must be the same for any order of variables in the GET part of the URL.  Therefore, we first delete all unnecessary variables (keys and values ‚Äã‚Äãthat can be manually substituted into the URL), and then sort the <code>$_GET</code> global array by keys: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//   (         ) ksort($_GET);</span></span></code> </pre><br>  Then we get the rest of the identifier: <br><br><pre> <code class="php hljs">$fileIdentifier = <span class="hljs-string"><span class="hljs-string">'images/cache/'</span></span> . $randSeed; $fileIdentifier .= sprintf( <span class="hljs-string"><span class="hljs-string">'/lineup-%s_color-%d_drunk-%s_'</span></span>, $lineup, $backFile, $isDrunk ? <span class="hljs-string"><span class="hljs-string">'on'</span></span> : <span class="hljs-string"><span class="hljs-string">'off'</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($_GET <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $value) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($value)) $fileIdentifier .= preg_replace(<span class="hljs-string"><span class="hljs-string">'/[^a-z0-9_-]/ui'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, $key) . <span class="hljs-string"><span class="hljs-string">'-'</span></span> . preg_replace(<span class="hljs-string"><span class="hljs-string">'/[^a-z0-9_-]/ui'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, $value) . <span class="hljs-string"><span class="hljs-string">'_'</span></span>; } $fileIdentifier = rtrim($fileIdentifier, <span class="hljs-string"><span class="hljs-string">'_'</span></span>); $fileIdentifier .= <span class="hljs-string"><span class="hljs-string">'.'</span></span> . OUTPUT_FORMAT;</code> </pre><br><br>  Do not forget about HTTP headers associated with caching: <br><br><pre> <code class="php hljs">header(<span class="hljs-string"><span class="hljs-string">'Cache-Control: Public'</span></span>); header(<span class="hljs-string"><span class="hljs-string">'Pragma: Public'</span></span>); header(<span class="hljs-string"><span class="hljs-string">'Last-Modified: '</span></span> . gmdate(<span class="hljs-string"><span class="hljs-string">'D, d MYH:i:s'</span></span>, $time) . <span class="hljs-string"><span class="hljs-string">' GMT'</span></span>); header(<span class="hljs-string"><span class="hljs-string">'Expires: '</span></span> . gmdate(<span class="hljs-string"><span class="hljs-string">'D, d MYH:i:s'</span></span>, $time + <span class="hljs-number"><span class="hljs-number">30</span></span>*<span class="hljs-number"><span class="hljs-number">24</span></span>*<span class="hljs-number"><span class="hljs-number">60</span></span>*<span class="hljs-number"><span class="hljs-number">60</span></span>) . <span class="hljs-string"><span class="hljs-string">' GMT'</span></span>);</code> </pre><br><br><h5>  Random number generator </h5><br>  To fully follow the url philosophy, the same picture should always be displayed for each link.  But we have a lot of random factors in the system (noise, unevenness).  To be extremely precise, we need not a pseudo-random number generator (PRNG), but a pseudo-random sequence generator (PRN).  Each sequence defined by a certain identifier ( <code>seed</code> ) must be unique and repeatable. <br><br>  In new versions of PHP (‚â•5.2.1), the <code>mt_rand()</code> generator stopped issuing the same sequences with the same <code>mt_srand($seed)</code> parameter <code>mt_srand($seed)</code> at least, <a href="http://www.php.net/manual/en/function.mt-srand.php">it is recommended</a> not to count on this behavior).  Let's write your bike.  Since we do not need cryptographic security from the generator, we will use one of the most popular and simple methods - multiplication with transfer. <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** *        . * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> integer $min * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> integer $max * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> integer */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($min = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $max = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0xffffffff</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$m_z = <span class="hljs-number"><span class="hljs-number">36969</span></span> * (<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$m_z &amp; <span class="hljs-number"><span class="hljs-number">65535</span></span>) + (<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$m_z &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$m_w = <span class="hljs-number"><span class="hljs-number">18000</span></span> * (<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$m_w &amp; <span class="hljs-number"><span class="hljs-number">65535</span></span>) + (<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$m_w &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span>); $res = ((<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$m_z &lt;&lt; <span class="hljs-number"><span class="hljs-number">16</span></span>) + <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$m_w) &amp; <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span>; $res = $res &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ? $res : ~$res; <span class="hljs-comment"><span class="hljs-comment">//var_dump($res, PHP_INT_MAX, 0xffffffff); die; return intval($min + floor(($res / doubleval(0xffffffff)) * ($max - $min + 1))); }</span></span></code> </pre><br>  Where <code>self::$m_z</code> and <code>self::$m_w</code> are static fields of the current state of the generator.  For the same given set of <code>self::$m_z</code> and <code>self::$m_w</code> generator will produce the same pseudo-random sequences of integers. <br><br><h5>  Drunk Master Mode </h5><br>  Turn each brick to a random angle in a narrow range of inclination, and the drunk master is already working on your wall. <br><br>  Varying the range of inclination in degrees, you can change the amount and degree drunk (sorry for the pun).  I stopped at ¬± 3.2 ¬∞. <br><br><h4>  Links </h4><br><ul><li>  <a href="http://xn--e1aicmebjeik.xn--p1ai/%25D0%25BA%25D0%25BE%25D0%25BD%25D1%2581%25D1%2582%25D1%2580%25D1%2583%25D0%25BA%25D1%2582%25D0%25BE%25D1%2580-%25D0%25BA%25D0%25BB%25D0%25B0%25D0%25B4%25D0%25BA%25D0%25B8">Masonry</a> constructor - <a href="http://xn--e1aicmebjeik.xn--p1ai/%25D0%25BA%25D0%25BE%25D0%25BD%25D1%2581%25D1%2582%25D1%2580%25D1%2583%25D0%25BA%25D1%2582%25D0%25BE%25D1%2580-%25D0%25BA%25D0%25BB%25D0%25B0%25D0%25B4%25D0%25BA%25D0%25B8">http: //rekonstroy.rf/design-kladki</a> . </li><li>  Feldhaus Klinker - <a href="http://feldhaus-klinker.de/">http://feldhaus-klinker.de</a> . </li><li>  Reconstroy - <a href="http://xn--e1aicmebjeik.xn--p1ai/">http: //rekonstroy.rf</a> . </li><li>  A small description of the designer on our website - <a href="http://sijeko.ru/works/programming/brick-constructor">http://sijeko.ru/works/programming/brick-constructor</a> . </li></ul></div><p>Source: <a href="https://habr.com/ru/post/203840/">https://habr.com/ru/post/203840/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../203828/index.html">How to safely read Habr at work using our information security screens</a></li>
<li><a href="../203830/index.html">Creative Commons 4.0 licenses approved</a></li>
<li><a href="../203832/index.html">Genetic algorithms in Matlab playfully</a></li>
<li><a href="../203834/index.html">"Backups" in a living organism</a></li>
<li><a href="../203836/index.html">Don't shoot yourself in the foot using LINQ</a></li>
<li><a href="../203842/index.html">Started pre-orders for YotaPhone for 20 000 rubles</a></li>
<li><a href="../203846/index.html">Overview of the mobile application "Ostrovok" for the Android platform</a></li>
<li><a href="../203848/index.html">Runetology (212): Vladimir Bakuteev, CEO of LiveTex</a></li>
<li><a href="../203850/index.html">Open data is here</a></li>
<li><a href="../203852/index.html">University timetable s01e02: Windows phone, mobile site and how to help us</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>