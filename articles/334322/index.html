<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Configuring Authentication in Citrix XenDesktop 7.xc Using JaCarta PKI Smart Cards</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article describes the process of setting up two-factor authentication using JaCarta PKI smart cards developed by Aladdin RD in a virtual environm...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Configuring Authentication in Citrix XenDesktop 7.xc Using JaCarta PKI Smart Cards</h1><div class="post__text post__text-html js-mediator-article">  This article describes the process of setting up two-factor authentication using JaCarta PKI smart cards developed by <a href="https://www.aladdin-rd.ru/company/">Aladdin RD</a> in a virtual environment of Citrix XenDesktop version 7.x. <br><a name="habracut"></a><br>  <a href="https://www.aladdin-rd.ru/catalog/jacarta/pki/">JaCarta PKI</a> is a line of USB, MicroUSB tokens or smart cards for strict two-factor user authentication when accessing secured information resources of the enterprise, secure key storage, and key containers of software SKZI. <br><br>  The advantages of using Aladdin RD solutions with Citrix products are: <br><br><ul><li>  Secure access to virtual desktops and applications, multi-factor authentication with XenApp / XenDesktop <br></li><li>  Netscaler Gateway support; <br></li><li>  the ability to work with smart cards and USB tokens after authenticating to a Citrix VDI session with any applications that support these devices; <br></li><li>  the ability to embed Citrix solutions into an existing public key infrastructure (PKI), and vice versa, embed PKI into an existing Citrix virtual environment. </li></ul><br>  Citrix virtual authentication using smart cards and JaCarta USB tokens from Aladdin RD is based on public key infrastructure (PKI) and X.509 digital certificates stored on these devices.  Solutions comply with international standards; only a setup without complex software integrations is required. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      All models of smart cards and JaCarta USB tokens are based on a smart card microcontroller with special built-in protection from cloning, hacking and other special attacks (secure by design). <br><br><h2>  Brief description of the infrastructure of the demo stand </h2><br><ul><li>  Microsoft Windows Server 2008 R2 - server with domain controller role (DC.aladdin.local) <br></li><li>  Microsoft Windows Server 2008 R2 - server with the role of the Microsoft Certification Authority (MS CA) (CA.aladdin.local) <br><ul><li>  JC Client 6.24.16 </li></ul><br></li><li>  Microsoft Windows Server 2008 R2 - XenDesktop software components (software) (Citrix Director, Citrix License Server, Citrix Studio, Citrix StoreFront, Citrix Delivery Controller) (XD7.aladdin.local).  These components can be installed on different servers. <br><ul><li>  Citrix XenDesktop 7.0 Software </li></ul><br></li><li>  Microsoft Windows 7 64-bit - user's test PC (Test2.aladdin.local) <br><ul><li>  Citrix Receiver 4.0.0.45893 <br></li><li>  JC Client 6.24.16 </li></ul><br></li><li>  Microsoft Windows 7 32-bit - test reference machine - the ‚Äúgolden‚Äù image from which virtual machines will be deployed for users (win7x32.aladdin.local) <br><ul><li>  Citrix Receiver 4.0.0.45893 <br></li><li>  JC Client 6.24.16 <br></li><li>  Virtual Delivery Agent </li></ul></li></ul><br><h2>  Creating virtual machines </h2><br><h3>  1. Creating a virtual machine directory </h3><br>  Before creating a directory for virtual machines, you need to prepare a reference machine.  In this test environment, this is a virtual machine with a Windows 7 (32-bit) operating system. <br><br>  To prepare the reference machine, you need to install the Virtual Delivery Agent software (the distribution kit is located on the disk with the XenDesktop 7.0 software), JC Client 6.24.16 (installation and configuration of the JC Client 6.24.16 software are described in the JC-Client - Administrator's Guide) ), as well as other software that is necessary for the work of users of this group.  After installation, the virtual machine must be turned off. <br><br>  <b>Creating a directory for virtual machines</b> <br><br>  On the server where the <b>Citrix Studio</b> component is installed (installation and configuration of the Citrix XenDesktop 7.x software is described at <a href="http://support.citrix.com/proddocs/topic/xendesktop-71/cds-install-config-intro.html">http://support.citrix.com/proddocs/topic/xendesktop-71/cds-install-config-intro.html</a> ), Launch <b>Citrix Studio</b> (Start -&gt; All Programs -&gt; Citrix), connect to Citrix Delivery Controller and go to <b>Machine Catalogs</b> , run the <b>Create Machine Catalog</b> wizard (Figure 1). <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/aa5/0ad/4eb/aa50ad4ebb754d7f9ca036e82dd46d48.png"></div><br>  <i>Fig.</i>  <i>1 - ‚ÄúCreate Machine Catalog‚Äù window</i> <br><br>  Click <b>Next</b> . <br><br>  Select <b>Windows Desktop OS</b> or another item depending on the settings of your environment (Fig. 2). <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/ed2/204/d3c/ed2204d3c8284694b232dc65dec426ba.png"></div><br>  <i>Fig.</i>  <i>2 - The operating system selection window for the directory</i> <br><br>  Click <b>Next</b> . <br><br>  Select <b>Virtual Machines and Machine Creation Services (MCS)</b> (Figure 3). <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/7f5/c99/5ea/7f5c995ea8034415984020291e75f515.png"></div><br>  <i>Fig.</i>  <i>3 - Virtual machine delivery method selection window</i> <br><br>  Click <b>Next</b> . <br><br>  In the <b>Desktop Experience</b> window, configure the desktop settings for users and the method for storing user data as shown below (Figure 4).  Other options may be selected depending on the settings of your environment and the tasks required. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/792/c05/7a0/792c057a02df4ef483fe1cc3ce02366e.png"></div><br>  <i>Fig.</i>  <i>4 - Virtual machine settings window</i> <br><br>  Click <b>Next</b> . <br><br>  From the list of available virtual machines, select the previously created reference machine (Fig. 5). <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/3e5/37e/dd0/3e537edd0fcf4ea2bb00e6eb06156bc6.png"></div><br>  <i>Fig.</i>  <i>5 - Reference machine selection window</i> <br><br>  Click <b>Next</b> . <br><br>  Set the number of virtual machines in the directory and set their technical characteristics (Fig. 6). <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/94d/af6/8d0/94daf68d0ac9428bbc3508c0cddbb2a4.png"></div><br>  <i>Fig.</i>  <i>6 - Choosing user virtual machine options</i> <br><br>  Click <b>Next</b> . <br><br>  Configure the scheme to automatically add the accounts of the created machines to the <b>Active Directory (AD)</b> directory service (Fig. 7). <br><br>  For ease of administration, you can pre-create an organizational unit (OU) in the <b>AD</b> directory service, where the accounts of the created virtual machines will be added. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/c49/e7f/608/c49e7f6089a0439ab17710fdcef14290.png"></div><br>  <i>Fig.</i>  <i>7 - Window "Active Directory Computer Account"</i> <br><br>  Click <b>Next</b> . <br><br>  Check the parameters of the created virtual machines and determine the name for the directory, as well as the name of the virtual machine to display to users (Fig. 8). <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/579/c12/489/579c1248914a413cbcabd9363a21591f.png"></div><br>  <i>Fig.</i>  <i>8 - Summary window</i> <br><br>  Click <b>Finish</b> . <br><br>  Catalog of virtual machines created (Fig. 9). <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/211/868/850/211868850a7a483186e0c06661f2faf3.png"></div><br>  <i>Fig.</i>  <i>9 - Created directory of virtual machines</i> <br><br><h3>  2. Creating a virtual machine user group - Delivery Group </h3><br>  To associate the created virtual machines with users, you must configure the user group of virtual machines ( <b>Delivery Group</b> ). <br><br>  Open the <b>Citrix Studio</b> Management Console and go to the <b>Delivery Group</b> -&gt; <b>Create Delivery Group</b> tab (Figure 10). <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/b6e/be8/38c/b6ebe838cbce4ade932194243989c243.png"></div><br>  <i>Fig.</i>  <i>10 - Delivery Group Window</i> <br><br>  Select the previously created directory of virtual machines and specify how many virtual machines will be available for users of this group (Fig. 11). <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/fd0/9c3/113/fd09c31131a1498ebdedf83301dfc406.png"></div><br>  <i>Fig.</i>  <i>11 - ‚ÄúMachines‚Äù window</i> <br><br>  Click <b>Next</b> . <br><br>  Select the type of resources delivered: applications or virtual machines (Fig. 12). <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/b59/dc3/ecc/b59dc3ecceeb48fdb8feaadc70d4dd5a.png"></div><br>  <i>Fig.</i>  <i>12 - Select "Delivery Type"</i> <br><br>  Click <b>Next</b> . <br><br>  Assign users to which virtual machines will be associated (Figure 13). <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/2ad/455/299/2ad45529950f4114ae6fc0e59b4dea5d.png"></div><br>  <i>Fig.</i>  <i>13 - User selection window</i> <br><br>  Click <b>Next</b> . <br><br>  <b>Citrix Receiver is</b> configured later (see Section 2.5). <br><br>  In the next window, select <b>Manually, using a StoreFront server address that I will provide later</b> (Figure 14). <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/476/e19/603/476e19603479496e98fcd6c21bcd9089.png"></div><br>  <i>Fig.</i>  <i>14 - Citrix StoreFront Settings Window</i> <br><br>  Click <b>Next</b> . <br><br>  Check the final settings and determine the name of the group (fig. 15). <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/437/353/763/437353763d034ab98c320c9d9a7ceb3e.png"></div><br>  <i>Fig.</i>  <i>15 - Summary window</i> <br><br>  Click <b>Finish</b> . <br><br>  A group of virtual machine users has been created (Fig. 16). <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/ccf/f08/ec1/ccff08ec16ac4ee198129d7c33acd7d0.png"></div><br>  <i>Fig.</i>  <i>16 - Created by the Delivery Group</i> <br><br>  <b>Attention</b> : Make sure that all virtual machines in the pool are registered (have Registered status (Fig. 17)). <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/2cc/2d7/f17/2cc2d7f173a2443daa1e12517a5b2cd6.png"></div><br>  <i>Fig.</i>  <i>17 - Virtual Machine Status Window</i> <br><br><h3>  3. Check availability of virtual machines </h3><br>  Go to the workstation (PC) of the user.  This is Windows 7 x64 with JC Client 6.24.16 preinstalled. <br><br>  Open a browser and in the address bar specify the path to the Citrix <b>XenDesktop</b> web interface: <a href="http://xd7.aladdin.local/Citrix/StoreWeb/">http: //xd7.aladdin.local/Citrix/StoreWeb/</a> (Fig. 18). <br><br>  If <b>Citrix Receiver is</b> not installed, the Citrix Receiver installation window will appear (Figure 19). <br><br>  Click <b>Install</b> . <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/025/1ed/11e/0251ed11e4e04a5ab5793090db15f7b5.png"></a> </div><br>  <i>Fig.</i>  <i>18 - XenDesktop Software Web Interface</i> <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/4af/411/0a4/4af4110a4e80409292199081b0780f29.png"></a> </div><br>  <i>Fig.</i>  <i>19 - Installing Citrix Receiver</i> <br><br>  Enter the username and <b>password of the</b> user account in the directory service AD.  This account must be a member of the virtual machine user group, which was created in section 1.2 (Figure 20). <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/ae3/ba1/0be/ae3ba10be52c4202b5dd6d48986bb44e.png"></a> </div><br>  <i>Fig.</i>  <i>20 - User Authentication Window in the XenDesktop Software Web Interface</i> <br><br>  Make sure that the virtual machine is available, and then end the user session (Figure 21). <br><br>  (Start -&gt; Log Out) <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/844/da7/1e9/844da71e9aab4cadafa56f67d2f7fa71.png"></a> </div><br>  <i>Fig.</i>  <i>21 - User's Virtual Machine</i> <br><br><h2>  Configuring Smart Card Authentication </h2><br><br><h3>  1. Certificate Issue for IIS </h3><br>  On the server where XenDesktop 7 is installed, start the Internet Information Services (IIS) service management snap-in (Figure 22). <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/ea1/60d/076/ea160d076e73481aa4b8f2c81869d723.png"></a> </div><br>  <i>Fig.</i>  <i>22 - Path to IIS Service Management Snap-in</i> <br><br>  Open the <b>Server Certificates</b> tab (fig. 23). <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/e4d/d46/183/e4dd4618389d45d3b5a0351e60a5e1bf.png"></a> </div><br>  <i>Fig.</i>  <i>23 - IIS Service Management Tools</i> <br><br>  Select <b>Create Domain Certificate</b> (Figure 24). <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/1ad/148/d76/1ad148d7661a429f9b1683a7023621d2.png"></a> </div><br>  <i>Fig.</i>  <i>24 - Create Certificate Tab</i> <br><br>  Fill in the organization information for the issued certificate (fig. 25). <br><br>  In the <b>Common name</b> field, enter the fully qualified domain name of the server with the XenDesktop software installed.  In the present example: xd7.aladdin.local. <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/8d5/51e/485/8d551e485e714ca29137608e755cccd1.png"></a> </div><br>  <i>Fig.</i>  <i>25 - Information about the organization in the issued certificate</i> <br><br>  Select the organization's certification authority and in the <b>Friendly name</b> field, specify the fully qualified domain name of the server with the <b>XenDesktop</b> software installed.  In the present example: <b>xd7.aladdin.local</b> (Figure 26). <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/e4b/8bd/4e4/e4b8bd4e446b4df19162a4e8fb9fa612.png"></a> </div><br>  <i>Fig.</i>  <i>26 - Certificate issue for IIS service</i> <br><br>  Click <b>Finish</b> . <br><br>  Verify that the certificate was successfully issued (Figure 27). <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/76c/77f/9fe/76c77f9fe7fe48b1805304e565fb7c7b.png"></a> </div><br>  <i>Fig.</i>  <i>27 - Certificate Issue Result</i> <br><br><h3>  2. Configure SSL access to IIS </h3><br>  Click the <b>Default Web Site</b> tab and click <b>Bindings ...</b> <br><br>  In the window that opens, click <b>Add</b> (fig. 28). <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/53a/129/577/53a12957712343269b26213d9120cf06.png"></a> </div><br>  <i>Fig.</i>  <i>28 - Site Bindings settings window</i> <br><br>  Select the connection type <b>https</b> , and in the SSL certificate list select the previously issued certificate for IIS (Figure 29). <br><br>  In this example, the certificate name is xd7.aladdin.local. <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/8bb/08d/78b/8bb08d78b51d440992bec6c2a8359b29.png"></a> </div><br>  <i>Fig.</i>  <i>29 - Add Site Binding Window</i> <br><br>  Click <b>OK</b> . <br><br>  Make sure that this type of connection is added to the list (Fig. 30). <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/4ea/e6e/b65/4eae6eb65c0d4998b701dd6c27a9dfbf.png"></a> </div><br>  Fig.  30 - The result of setting the type of connection <br><br>  Close the ‚ÄúSite Bindings‚Äù window. <br><br><h3>  3. Configure Citrix StoreFront </h3><br>  <b>Attention!</b>  When working with StoreFront in multi-server installations, use only one server when making changes to the settings.  Make sure that the Citrix StoreFront Management Console is not running on another server or servers of this server group.  After completing the configuration, make sure that the changes were applied to all servers of the group. <br><br>  Launch Citrix Studio.  In the Citrix StoreFront tab, click the Authentication tab (Figure 31). <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/aca/cc9/b8d/acacc9b8d8a44e4f8fcd40c1453d3ad0.png"></a> </div><br>  <i>Fig.</i>  <i>31 - StoreFront Authentication Tab</i> <br><br>  Select Add / Remove Authentication Methods. <br><br>  The <b>Add / Remove Methods</b> window opens (Figure 32). <br><br>  Select the smart card authentication method. <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/c9e/5f6/e4c/c9e5f6e4c6fd44d8bac344636908f801.png"></a> </div><br>  <i>Fig.</i>  <i>32 - Add / Remove Authentication Methods Window</i> <br><br>  Click <b>OK</b> . <br><br>  Make sure that the <b>Smart card</b> authentication method has been added to the <b>Authentication</b> tab (Fig. 33). <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/53a/7d3/564/53a7d35648d64449a44176bcfa48edc1.png"></a> </div><br>  <i>Fig.</i>  <i>33 - Result of changing authentication methods</i> <br><br>  Open <b>Default Web Site -&gt; Citrix -&gt; Authentication -&gt; Certificate</b> (Figure 34). <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/adf/9f2/7a0/adf9f27a04504f47a56f632c216e504f.png"></a> </div><br>  <i>Fig.</i>  <i>34 - Certificate Home Tab</i> <br><br>  Select SSL Settings -&gt; Require SSL.  Check the Require parameter (fig. 35). <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/b0b/996/75a/b0b99675acc44848a997822b57accd4a.png"></a> </div><br>  <i>Fig.</i>  <i>35 - SSL Settings</i> <br><br>  To verify the SSL settings, you must perform the following steps: <br><br><ul><li>  connect to the user's PC; <br></li><li>  connect the smart card with the user certificate to the user's PC; <br></li><li>  open browser; <br></li><li>  in the address bar, specify the path to the page with the test application.  In this example, <a href="https://xd7.aladdin.local/Citrix/Authentication/Certificate/test.aspx">https: //xd7.aladdin.local/Citrix/Authentication/Certificate/test.aspx</a> . </li></ul><br>  Instead of xd7.aladdin.local, you must specify the fully qualified domain name of the server with Citrix XenDesktop. <br><br>  The following window will appear in which you need to select a user certificate (Figure 36). <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/748/d0a/fd5/748d0afd57774ec08421326fefd4228b.png"></a> </div><br>  <i>Fig.</i>  <i>36 - User certificate request window</i> <br><br>  Select a user certificate and click <b>OK</b> . <br><br>  The following window will be displayed (Fig. 37). <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/924/bfe/5a1/924bfe5a1506493c898427b0dfe086fe.png"></a> </div><br>  <i>Fig.</i>  <i>37 - PIN code request window for a user's smart card</i> <br><br>  Enter the PIN code of the user's smart card and click <b>OK</b> . <br><br>  If the SSL connection is established successfully, you will see on the opened page information about the user's certificate (Fig. 38). <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/726/56c/e8a/72656ce8a2d045499701ec17fa883086.png"></a> </div><br>  <i>Fig.</i>  <i>38 - User certificate verification window</i> <br><br>  Connect to a server with Citrix <b>XenDesktop</b> installed and configure the communication protocols for <b>SSL</b> . <br><br>  Launch <b>the Citrix Studio Management Console</b> .  To do this, open the <b>Citrix StoreFront</b> software and select the <b>Server Group</b> tab.  Select the <b>Change Base URL</b> and change the <b>http</b> value to <b>https</b> (Fig. 39). <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/726/72a/261/72672a261d344cac9129c9ca5517f2d4.png"></a> </div><br>  <i>Fig.</i>  <i>39 - ‚ÄúChange Base URL‚Äù window</i> <br><br>  Click <b>OK</b> . <br><br>  Click the Stores tab (fig. 40). <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/b62/cfa/036/b62cfa036ec746a1a0616a57dddf92f8.png"></a> </div><br>  <i>Fig.</i>  <i>40 - Stores Tab</i> <br><br>  Select <b>Manage Delivery Controllers</b> . <br><br>  In the opened window, click <b>Edit</b> (fig. 41). <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/83d/993/464/83d99346420645d38546cb9c9595cadf.png"></a> </div><br>  <i>Fig.</i>  <i>41 - Manage Delivery Controllers window</i> <br><br>  In the <b>Transport type</b> field, replace HTTP with HTTPS (Fig. 42, Fig. 43). <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/8a8/50b/133/8a850b133d594d4288d8f0b8fc562b3f.png"></a> </div><br>  <i>Fig.</i>  <i>42 - ‚ÄúEdit Delivery Controller‚Äù window with HTTP value</i> <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/4b9/7f3/3d5/4b97f33d577748898f0f475357c6dd6a.png"></a> </div><br>  <i>Fig.</i>  <i>43 - ‚ÄúEdit Delivery Controller‚Äù window with HTTPS value</i> <br><br>  Click <b>OK</b> . <br><br>  Make sure that the <b>Service using HTTPS</b> value appears in the <b>Status</b> field (Figure 44). <br><br>  <b>Attention</b> : After applying the settings, you must restart the server with Citrix XenDesktop. <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/3e3/572/54f/3e357254f82b4a11a1c70bbbc43cd079.png"></a> </div><br>  <i>Fig.</i>  <i>44 - Status field value</i> <br><br><h3>  4. Customize XML Queries </h3><br>  You must allow XML requests to the server with Citrix XenDesktop installed.  To do this, follow these steps. <br><br>  On a server with Citrix XenDesktop installed, open the <b>Windows PowerShell</b> command prompt (Figure 45). <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/449/3bb/e88/4493bbe88e014a388760bfb2f2a05565.png"></a> </div><br>  <i>Fig.</i>  <i>45 - Path to the Windows PowerShell command line</i> <br><br>  In the command line that opens, execute the command: <br><br>  Set-BrokerSite -TrustRequestsSentToTheXmlServicePort $ true (Figure 46) <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/1a1/499/148/1a14991485ca438d8a37e813f86326c7.png"></a> </div><br>  <i>Fig.</i>  <i>46 - Command Line "Windows PowerShell"</i> <br><br><h3>  5. Setting up a user's PC </h3><br>  Connect to the user's PC.  Open Citrix Receiver and add a server connection string, with published desktops and / or applications (Figure 47). <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/946/afe/e5a/946afee5a38a41b5b38c3832b7579aea.png"></a> </div><br>  <i>Fig.</i>  <i>47 - Adding Server Address to Citrix Receiver</i> <br><br>  To ensure correct operation, it is necessary that the <b>address of the server with Citrix StoreFront software</b> be added <b>to trusted (Trusted)</b> or <b>local (Local Intranet)</b> sites in your browser.  In the security level settings for each of the options, you must ensure that the <b>Automatic logon</b> setting is enabled.  It is recommended to use the browser - Internet Explorer 9.0 and higher. <br><br>  If the server address is correct, and the smart card with the certificate is connected to the USB port of the user's PC, a window will open asking for the user's PIN code (Fig. 48). <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/4e7/2f6/2cd/4e72f62cdf114d12902418a1b85c2d20.png"></a> </div><br>  <i>Fig.</i>  <i>48 - Citrix Receiver Software: PIN Request for User Smart Card</i> <br><br>  Enter the user PIN (Fig. 49). <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/301/185/29f/30118529fa6f4e3ab8d50cfbebc9936f.png"></a> </div><br>  <i>Fig.</i>  <i>49 - Enter user PIN</i> <br><br>  Connection to the application server (Fig. 50). <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/eb3/764/620/eb37646207f04fd48b29d8e2bdaefe0a.png"></a> </div><br>  <i>Fig.</i>  <i>50 - Connecting to an application server</i> <br><br>  Once connected, open the <b>All Applications</b> tab.  The available applications and desktops are displayed. <br><br>  In the present example, select <b>Win7x32</b> (Fig. 51). <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/774/db5/32b/774db532b69142b7b843ca769f3b569d.png"></a> </div><br>  <i>Fig.</i>  <i>51 - List of available applications</i> <br><br>  To log into Windows on a virtual machine, you must enter the PIN code on the user's key carrier (Fig. 52). <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/e6d/ecd/b8c/e6decdb8ca82435abe556c3f79c03c31.png"></a> </div><br>  <i>Fig.</i>  <i>52 - Smartcard authentication on remote desktop</i> <br><br>  Authentication was successful (Fig. 53). <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/7ea/931/a4d/7ea931a4d6fe4128bb26c2627b926c19.png"></a> </div><br>  <i>Fig.</i>  <i>53 - Successful smart card authentication on remote desktop</i> <br><br><h2>  Configuring Pass-Through Smart Card Authentication </h2><br><h3>  1. How to configure Single Sing-On when authenticating with a smart card when using XenDesktop 7 software </h3><br>  <b>Attention</b> : For correct operation of pass-through smart card authentication, it is necessary that the user's end device (user PC) is added to the domain in which the infrastructure servers with Citrix XenDesktop 7 software installed (Delivery Controller, StoreFront, etc.) or, when using multiple domains, trusts have been configured between domains. <br><br>  Configuring Single Sign-on (SSO) for smart card authentication using XenDesktop7 software consists of several steps. <br><br>  Create a virtual machine directory. <br><br>  Creating a group of users of virtual machines. <br><br>  Installing Citrix Receiver 4.0 and higher on a user's PC. <br><br>  Configure Citrix XenDesktop Software Authentication Policies. <br><br>  Issue a certificate for IIS and configure SSL access to IIS. <br><br>  Setting up XML requests to the server with XenDesktop 7 installed. <br><br>  Configure Citrix StoreFront 2.1 software to enable SSO for smart card authentication. <br><br>  Setting up a user's PC (p. 34). <br><br><h3>  2. Install and configure Citrix Receiver 4.0 software to enable SSO for smart card authentication. </h3><br>  To configure pass-through smart card authentication on Citrix Receiver 4.0, you must install Citrix Receiver 4.0 with additional options.  Install Citrix Receiver 4.0 from the command line: <br><br><ul><li>  On the user's PC, launch the CMD command line utility with administrator rights; <br></li><li>  on the command line, specify the path to the installer file for Citrix Receiver 4.0 and optionally specify the parameters for enabling SSO: / includeSSON AM_SMARTCARDPINENTRY = CSP;  Example: C: \ Distr \ CitrixReceiver.exe / includeSSON AM_SMARTCARDPINENTRY = CSP <br></li><li>  wait for the installation of Citrix Receiver 4.0 to finish and restart the user's PC; <br></li><li>  after rebooting the user's PC, check that the executable processes (Task Manager / Processes) have a ssonsrv.exe process present; <br></li><li>  Configure authentication policies for Citrix XenDesktop software that will be applied to Citrix servers and user devices, as described in Section 3.3. </li></ul><br>  Detailed information for configuring smart card authentication can be found on the online documentation website: <a href="http://support.citrix.com/proddocs/topic/receiver-windows-40/receiver-windows-smart-card-cfg.html">http://support.citrix.com/proddocs/topic/receiver-windows-40/receiver-windows-smart-card-cfg.html</a> .  To configure pass-through authentication settings, you need to pay attention to the following sections: <b>To enable single sign-on for smart card authentication, To use CSP PIN prompts</b> . <br><br><h3>  3. Configure Authentication Policies for Citrix XenDesktop </h3><br>  It is recommended to configure policies through Active Directory Directory Services group policies.  You can also configure from the local policy management snap-in. <br><br>  To configure group policies, you must perform the following sequence of actions: <br><br><ul><li>  In the Active Directory Directory Services Group Policy Templates, import the Citrix ADM Template Policy Template ( <b>Add Template</b> in the Group Policy Management snap-in).  The policy template can be found in the Citrix Receiver client installation folder: <b>C: \ Program Files (x86) \ Citrix \ ICA Client \ Configuration \ icaclient.adm</b> . <br></li><li>  create a policy (or edit an existing one) and enable pass-through smart card authentication; <br></li><li>  open the Computer Configuration section -&gt; Policies -&gt; Administrative templates -&gt; Classic -&gt; Citrix Components -&gt; Citrix receiver -&gt; User Authentication; <br></li><li>  select the Smart Card Authentication setting and enable the ‚ÄúAllow smart card authentication‚Äù and ‚ÄúUse pass-through authentication for PIN‚Äù options.  Select the Local User Name and Password setting and enable the "Enable pass-through authentication" and "Allow pass-through authentication for all ICA connections" parameters (Fig. 54, Fig. 55). </li></ul><br>  Detailed information is available on the website - <a href="http://support.citrix.com/proddocs/topic/ica-settings/ica-settings-wrapper.html">http://support.citrix.com/proddocs/topic/ica-settings/ica-settings-wrapper.html</a> <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/671/aab/92e/671aab92e36049fb9f42d107a312047f.png"></a> </div><br>  <i>Fig.</i>  <i>54 - Configuring AD Group Policies for SSO</i> <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/d47/6e2/d0e/d476e2d0e1d341d68fa5696da1518d82.png"></a> </div><br>  <i>Fig.</i>  <i>55 - Configuring AD Directory Group Policy for SSO</i> <br><br><h3>  4. Configure Citrix StoreFront 2.1 to enable pass-through smart card authentication </h3><br>  <b>Attention</b> : When working with Citrix StoreFront in multi-server installations, use only one server when making changes to the settings.  Make sure that the Citrix StoreFront Management Console is not running on another server (s) of this server group.  After completing the configuration, make sure that the changes were applied to all servers of the group. <br><br>  To configure Citrix StoreFront to operate SSO with smart card authentication, you must perform the following steps on a server with Citrix StoreFront installed: <br><br><ul><li>  perform the initial setup of the Citrix StoreFront 2.1 software, according to the section ‚ÄúCitrix StoreFront Setup; <br></li><li>  in the Add / Remove Authentication Methods section, add the Domain pass-through authentication method (Figure 56); <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/ac4/8a3/30c/ac48a330c0f7487dae73c98f693b2ce2.png"></div><br>  <i>Fig.</i>  <i>56 - Setting authentication method</i> <br><br></li><li>  To enable pass-through authentication using smart cards, you must make additional configuration changes.  To do this, edit <b>default.ica</b> for each Citrix Store software that requires pass-through smart card authentication; <br></li><li>  using a text editor, open the file <b>default.ica</b> , which is located in the folder: <br>  C: \ inetpub \ wwwroot \ Citrix \ storename \ App_Data \; <br></li><li>  if the infrastructure does not use authentication via NetScaler Gateway, then add the following parameters <br>  [Application]: DisableCtrlAltDel = Off. <br>  This setting will apply to all users; <br></li><li>  To enable pass-through smart card authentication using NetScaler Gateway, add the following parameter: <br>  [Application]: UseLocalUserAndPassword = On;  Detailed information is available at: <a href="http://support.citrix.com/proddocs/topic/dws-storefront-21/dws-configure-conf-smartcard.html">http://support.citrix.com/proddocs/topic/dws-storefront-21/dws-configure-conf-smartcard.html</a> . <br></li><li>  Configure the user according to the section - Customizing the user's PC (see Section 2.5).  Verify that the login to the user's virtual machine is successful.  Check that after logging in to the user's PC (using a smart card or password), the window will no longer appear requesting credentials or a PIN code when accessing the StoreFront or / and the user's virtual machine. </li></ul><br>  As a result, I would like to point out once again the advantages of using strict two-factor <br>  authentication in VDI using solutions "Aladdin RD": <br><br><ul><li>  increasing the overall level of security, which is due to the abandonment of simple passwords and the transition to strong authentication using the second factor; <br></li><li>  Providing secure access to virtual desktops and applications; <br></li><li>  the ability to work with smart cards and USB tokens after authentication in a secure session; <br></li><li>  the possibility of using electronic signatures; <br></li><li>  support for RSA- and GOST-algorithms; <br></li><li>  additional benefits - the same card, in addition to the basic functions of authentication and electronic signature, can serve as a pass to the premises (presence of RFID tags), can also be a salary (payment application MasterCard or VISA) or a transport card; <br></li><li>  other customization options are available - logo application and use <br>  corporate style of the customer. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/334322/">https://habr.com/ru/post/334322/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../334308/index.html">JetBrains MPS for those interested # 1</a></li>
<li><a href="../334314/index.html">Reduce the size of the application: proven methods</a></li>
<li><a href="../334316/index.html">‚ÄúAlex, please kill me already‚Äù: conversational interfaces</a></li>
<li><a href="../334318/index.html">Happy System Administrator</a></li>
<li><a href="../334320/index.html">The budget for the operation of the data center: instructions for compiling</a></li>
<li><a href="../334324/index.html">ICFP Contest 2017 - strength test for real developers</a></li>
<li><a href="../334326/index.html">Yota in Russia: from unlimited to flexible packages</a></li>
<li><a href="../334328/index.html">What is needed for high-quality Web development?</a></li>
<li><a href="../334330/index.html">As a large courier company, the personal data of its customers handed out</a></li>
<li><a href="../334334/index.html">How ‚ÄúAktiv‚Äù organized the ‚Äúelectronic talk‚Äù</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>