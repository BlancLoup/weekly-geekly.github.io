<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automatic screen lock in GNU / Linux</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Do you often go for a regular cup of coffee or go out of the office / office to make a personal call, do you find yourself thinking that you forgot to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automatic screen lock in GNU / Linux</h1><div class="post__text post__text-html js-mediator-article">  Do you often go for a regular cup of coffee or go out of the office / office to make a personal call, do you find yourself thinking that you forgot to lock the screen of your computer?  And on the computer at this time there was an open correspondence in Skype / mail or worse - a root session in the console?  As a result, you try to return to your computer as quickly as possible, so that good colleagues do not have time to set the <a href="">wallpaper with the Black Lord</a> to the background of the desktop. <br>  In this article I will give an example of solving this problem with screen lock, which will help to close access to the desktop at the moment when you move away from the computer. <br><a name="habracut"></a><br><br><h4>  Introduction </h4><br>  I will describe briefly the proposed solution, in order to understand what we will do now.  We will do so that the operating system will itself, using Bluetooth, check how far the user is located, and in the event of "inaccessibility" will automatically block the screen.  The process of unlocking will remain on the user's conscience, and will consist in entering the password that is used in his account.  Automatically removing the lock is quite a risky undertaking, so we will not consider this scenario.  In terms of complexity, this article is aimed at advanced Linux users, because  Some stages of the setup will be described without unnecessary details, relying on the obvious, so as not to go away from the main illuminated topic. <br><br><h4>  Training </h4><br>  First you need to make sure that our computer and mobile phone support Bluetooth technology.  If there is no problem with a mobile phone, because  Most modern devices have support for the "blue tooth", then with a computer may well be.  I will not tell you in detail how to set up Bluetooth in different Linux distributions, but simply describe the main stages of setting up support for it, provided that the hardware includes the necessary components, using the example of Gentoo. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  The main stages of setting up Bluetooth support in Linux </h5><br><ol><li>  Turn on Bluetooth support for BIOS if it is controlled by a separate parameter, such as on Lenovo laptops </li><li>  Determine which Bluetooth controller is used in the computer configuration: <pre><code class="bash hljs">~ $ lsusb | grep -i bluetooth Bus 001 Device 003: ID 0a5c:217f Broadcom Corp. Bluetooth Controller</code> </pre> </li><li>  Include in the kernel support for the Bluetooth subsystem and the necessary driver for your controller: <pre> <code class="bash hljs">Kernel Configuration ---&gt; Bluetooth subsystem support ---&gt; Bluetooth device drivers ---&gt; &lt;*&gt; HCI USB driver</code> </pre></li><li>  Save the configuration, install the updated kernel and its modules, and then restart the system to boot with the new kernel </li><li>  Install the Bluez package (with test-programs support) that will do the work at the program level.  In the Gentoo package base, it looks like this: <pre> <code class="bash hljs">* net-wireless/bluez Latest version available: 4.101-r5 Latest version installed: [ Not Installed ] Size of files: 866 kB Homepage: http://www.bluez.org/ Description: Bluetooth Tools and System Daemons <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Linux License: GPL-2 LGPL-2.1</code> </pre></li><li>  Under a user with root privileges, start the bluetooth daemon and add it to the system autoload: <pre> <code class="bash hljs">~ <span class="hljs-comment"><span class="hljs-comment"># /etc/init.d/bluetooth start ~ # rc-update add bluetooth default</span></span></code> </pre></li><li>  Check that the bluetooth device is determined and ready to go: <pre> <code class="bash hljs">~ <span class="hljs-comment"><span class="hljs-comment"># hcitool dev Devices: hci0 CC:52:AF:E3:FB:67 ~ # hciconfig list hci0: Type: BR/EDR Bus: USB BD Address: CC:52:AF:E3:FB:67 ACL MTU: 1021:8 SCO MTU: 64:1 UP RUNNING PSCAN ...</span></span></code> </pre></li></ol><br>  This preparation is completed, proceed to the next stage. <br><br><h4>  Customization </h4><br>  In this section there will be the whole essence of the solution, namely, we will configure the pairing between the mobile phone and the computer.  After that, in the operating system we will prepare a script for checking the availability of the phone via the Bluetooth channel, which will be called every minute by means of the Cron daemon-scheduler.  Let's get started <br><ol><li>  Enable bluetooth on the phone and configure its visibility for the rest of the network: <br><img src="https://habrastorage.org/storage2/536/1ce/3cd/5361ce3cd682841db70d786f9f2941a7.jpg"></li><li>  On the computer side, start scanning the bluetooth network, as a result of which we will determine the address of our mobile phone (you can spy on the phone itself): <pre> <code class="bash hljs">~ <span class="hljs-comment"><span class="hljs-comment"># hcitool scan Scanning ... 00:AA:70:31:9A:19 LG-E400</span></span></code> </pre></li><li>  Configure the pairing, on the phone to accept the incoming connection: <pre> <code class="bash hljs">~ <span class="hljs-comment"><span class="hljs-comment"># simple-agent hci0 00:AA:70:31:9A:19 RequestConfirmation (/org/bluez/3522/hci0/dev_00_AA_70_31_9A_19, 724215) Confirm passkey (yes/no): yes Release New device (/org/bluez/3522/hci0/dev_00_AA_70_31_9A_19)</span></span></code> </pre><br><img src="https://habrastorage.org/storage2/aaf/078/4ab/aaf0784abc6be96bd3143249bfdc80b9.jpg"></li><li>  Add mobile address to the list of trusted devices: <pre> <code class="bash hljs">~ <span class="hljs-comment"><span class="hljs-comment"># bluez-test-device trusted 00:AA:70:31:9A:19 yes</span></span></code> </pre></li><li>  Check the availability of the phone from a computer via bluetooth: <pre> <code class="bash hljs">~ <span class="hljs-comment"><span class="hljs-comment"># l2ping -c 10 00:AA:70:31:9A:19</span></span></code> </pre></li><li>  Disable the visibility in the bluetooth settings of the mobile phone, if this does not happen automatically: <br><img src="https://habrastorage.org/storage2/5fc/a05/844/5fca05844e10ecb2bb4f4e3b1c5542c7.jpg"></li><li>  Prepare a script that will check the availability of the phone and in case of inaccessibility block the screen: <pre> <code class="bash hljs">~ <span class="hljs-comment"><span class="hljs-comment"># if ! /usr/bin/l2ping -c 1 &lt;%ADDR%&gt; ; then su &lt;%USERNAME%&gt; -c '&lt;%SCREENLOCKER%&gt;' ; fi</span></span></code> </pre><br>  In my case: <br>  <i>&lt;% ADDR%&gt;</i> = 00: AA: 70: 31: 9A: 19 <br>  <i>&lt;% USERNAME%&gt;</i> = not a root user, under which X runs and all the rest of the main work in the system <br>  <i>&lt;% SCREENLOCKER%&gt;</i> = I use the <i>gnome-extra / gnome-screensaver</i> package from the Gnome environment without the rest of the environment, so the screen lock command looks like this - <b>gnome-screensaver-command --lock</b> </li><li>  Run a test check as root when bluetooth is enabled on the phone </li><li>  Disable bluetooth on the phone and re-run the test, also with root privileges </li><li>  Add a minute rule to crontab: <pre> <code class="bash hljs">~ <span class="hljs-comment"><span class="hljs-comment"># crontab -l #minute (0-59), #| hour (0-23), #| | day of the month (1-31), #| | | month of the year (1-12), #| | | | day of the week (0-6 with 0=Sunday). #| | | | | commands * * * * * export DISPLAY=:0 &amp;&amp; if ! /usr/bin/l2ping -c 1 &lt;%ADDR%&gt; &gt;/dev/null 2&gt;/dev/null ; then su &lt;%USERNAME%&gt; -c '&lt;%SCREENLOCKER%&gt;' ; fi</span></span></code> </pre>  If such rules in crontab scare you, you can put the check in a separate script in the / usr / local / sbin directory, with more tricky checks, which you then specify in the crontab rule. </li></ol><br>  This completes the configuration and verification. <br><br><h4>  Result </h4><br>  We received a tool that will monitor our mobile phone and will lock the screen if it is removed from the computer.  In real conditions, this distance is not more than 10-20 meters and bluetooth on the phone should work stably.  The daily life of a mobile phone battery is somewhat reduced, since  we use short connections of 2-3 seconds. </div><p>Source: <a href="https://habr.com/ru/post/169819/">https://habr.com/ru/post/169819/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../169805/index.html">Installing and configuring Redmine 1.3.0 on Windows XP SP2 / Windows 7</a></li>
<li><a href="../169809/index.html">Dial-up service still brings AOL 500 million dollars a year</a></li>
<li><a href="../169811/index.html">Free software from JetBrains for educational institutions</a></li>
<li><a href="../169815/index.html">Conference "Internet advertising day: from planning to performance evaluation"</a></li>
<li><a href="../169817/index.html">Sega has released its own laptops</a></li>
<li><a href="../169823/index.html">Manage Windows services using PowerShell. Part 5. CIM Cmdlets</a></li>
<li><a href="../169827/index.html">Safety Code: Null Safe Design Pattern</a></li>
<li><a href="../169829/index.html">IPv6 Address Space Allocation for ISP</a></li>
<li><a href="../169831/index.html">Is national security private?</a></li>
<li><a href="../169839/index.html">Technology expose Red October</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>