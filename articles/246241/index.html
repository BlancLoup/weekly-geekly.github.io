<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>BLE from Nordic Semiconductor. Getting started with a stack using the nRF51822 chip</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. 

 For a while I had the idea to write an article about this stack, its features and applications using the nRF51822 chip. And the recent publi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>BLE from Nordic Semiconductor. Getting started with a stack using the nRF51822 chip</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/25a/53e/d01/25a53ed01d9644b99f52c396f5df89b2.jpg"><br>  Hello. <br><br>  For a while I had the idea to write an article about this stack, its features and applications using the nRF51822 chip.  And the recent publication " <a href="http://habrahabr.ru/company/intellectro/blog/246005/">BLE stack from TI</a> " made me sit down and try to turn the idea into something tangible. <br><br>  Nordic Semiconductor provides a very interesting, in my opinion, solution.  On the one hand, there is a powerful chip on the ARM Cortex-M0 core, on the other hand, the constantly evolving stack software and a set of libraries included in the SDK. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Unfortunately, on Habr√© there are no articles on the subject of BLE on NORDIC, as in other matters, there are practically no articles in runet, so I hope that the article will be useful to those who are beginning to use the products of this company in the part concerning BLE, Those who are interested in Bluetooth technology and BLE in particular. <br><a name="habracut"></a><br><h4>  1. Iron </h4><br>  The nRF51822 chip considered by us from the side of the memory size is presented in 3 variants: <br><ul><li>  256KB flash and 16KB of RAM; </li><li>  128KB flash and 16KB RAM; </li><li>  256KB flash and 32KB of RAM. </li></ul><br>  In this case, the RAM is divided into blocks and each block has its own power management.  I focus on this attention, because when programming a chip you need to know that the application uses the upper half of the RAM, while the younger half is always used by the stack. <br><br>  Depending on the stack version, the client software loading address may also change.  It is also necessary to pay attention.  If you incorrectly specify the address of the software download, the programmer will give an error, according to which you can never understand why it was not possible to flash the chip.  The software download address is indicated in the specification for each version of the stack. <br><br>  So, if you decide to work with BLE from NORDIC, then first of all you need to purchase one of the debugging kits.  Here are some of them: <br>  - <a href="http://www.nordicsemi.com/eng/Products/Bluetooth-Smart-Bluetooth-low-energy/nRF51822-Evaluation-Kit">nRF51822 Evaluation Kit</a> (EK) is an independent platform for evaluation and prototyping, based on the nRF51822 chip. <br><br><img src="https://habrastorage.org/files/508/54b/93e/50854b93e1f74541948ceb12d30aad3c.PNG"><br><br>  The kit includes: <br><ul><li>  A board with a chip, with a pair of buttons and a pair of LEDs.  On the board is the Segger programmer, which has its own unique number, which allows us to program our chip, make debugging and, not least, allow us to use the UART to communicate with the computer nRF51822 via USB; </li><li>  USB dongle, also with the nRF51822 chip and the Segger programmer, which has a special NORDIC firmware and is used to communicate with the board. </li></ul><br><br>  - <a href="http://www.nordicsemi.com/eng/Products/Bluetooth-Smart-Bluetooth-low-energy/nRF51822-Development-Kit">nRF51822 Development Kit</a> (DK) - platform dependent on the ‚ÄúStarter Kit‚Äù, makes it possible to create full-fledged applications using not only BLE, but also all the resources of the nRF51822 chip, like a microcontroller. <br><img src="https://habrastorage.org/files/0d1/1af/7ff/0d11af7ff41b48dd87b19e28695bf2c9.PNG"><br><br>  The kit includes: <br><ul><li>  board with nRF51822 and PCB antenna; </li><li>  board with nRF51822 and with antenna connector; </li><li>  USB dongle is the same as in EK; </li><li>  5 chips nRF51822; </li><li>  programmer </li></ul><br>  By the way, ‚Äúdependence‚Äù on the ‚ÄúStarter Kit‚Äù is not critical, if you know how to use a soldering iron or you have a prototype board and wiring. <br><br>  - <a href="http://www.nordicsemi.com/eng/Products/2.4GHz-RF/nRFgo-Starter-Kit">nRF51822 Starter Kit</a> (SK) is a kind of ‚Äúmotherboard‚Äù to which you can connect the EK and DK to use all the features of the nRF51822 chip. <br><br><img src="https://habrastorage.org/files/171/a53/f5d/171a53f5d13e4d08b15c4b23817a84f3.PNG"><br><br>  The kit includes 2 motherboards with cable sets. <br><br><img src="https://habrastorage.org/files/a19/a59/fb1/a19a59fb1dc3407886e16d9f0f307eef.PNG"><br><br>  Recently, the company does not recommend using EK and DK, since  new debug kits have appeared: " <a href="http://www.nordicsemi.com/eng/Products/nRF51-DK">nRF51 DK</a> " and " <a href="http://www.nordicsemi.com/eng/Products/nRF51-Dongle">nRF51 Dongle</a> ", but I believe that EK and DK are still a very good tool for learning and prototyping. <br><br>  Currently, my task uses nRF51822 DK without SK.  Thanks to the connectors on the DK cards, you can connect any peripherals, such as LEDs, to indicate the presence of a connection or some kind of error, using connecting wires and a breadboard model.  A feature of using DK without SK is that the DK board needs to be powered, and for this you need to know the pinout of the card's connectors. <br><br><img src="https://habrastorage.org/files/8de/8e8/813/8de8e881395746798f1ff174a83945f9.PNG"><br><br>  It is in the document "nRF51822_Development_Kit_User_Guide".  Due to the fact that I use the STM32L152-DISCOVERY debugging module as the ‚Äúsuper-host‚Äù for the nRF51822, the 3.3V power supply is supplied from there. <br><br>  <i><b>Nuance:</b> until you purchase one of the sets, you cannot download from the site neither the specification, nor the stack, nor the software, except for the software ‚ÄúnRFgo Studio‚Äù and documentation on the chips.</i> <br><br>  Each debugging kit has its own unique number (key) pasted on the box with the kit.  After buying a set, you need to register on the site and in the user profile enter the key indicated on the box.  After that, you will be available: <br><ul><li>  product specifications; </li><li>  user manuals; </li><li>  specification, firmware and stack API; </li><li>  software; </li><li>  "Reference layout"; </li></ul><br><br><h4>  2. Software offered by NORDIC </h4><br><ul><li>  SoftDevice S110 stack (S120, S130) - contains API header files and a binary (HEX) file which contains the stack firmware (for each type of stack, its own HEX).  There is no source code for the stack itself. </li><li>  nRF51 SDK - contains the header files of the API to the stack, as well as the source codes of the libraries in the C language to simplify working with the stack and peripherals of the nRF51422 and nRF51822 chips; </li><li>  Master Control Panel (MCP) - 32 and 64 bit software designed to work with USB dongle and allows you to search for devices, discover services, read the attributes of services, establish a Bluetooth connection, receive and transmit data.  In server mode, it is possible to create any services, with characteristics defined both in the Bluetooth SIG, and with its own.  In general, this is the main program for debugging your software on the other side of a wireless connection.  Installing the Master Control Panel also installs software called the ‚ÄúMaster Emulator‚Äù.  About him in few places written, but it may appeal to many developers.  The fact is that this is an API that allows you to create a .NET PC application with the role of master device. </li><li>  nRFgo Studio - 32 and 64 bit software designed for stack firmware and client software.  Also, it can be used to change the firmware of motherboards included in the SK package;  create your services, including on your own UUIDs;  configure connection security settings, configure GAP and advertising, configure chip periphery, calculate chip energy consumption and much more. </li><li>  nRF Sniffer - software for viewing packets transmitted from one device to another; </li><li> The nRF51-BLE-Driver is actually not a driver in the usual sense of the word.  This is a DLL that provides an API to the stack in the C language. Thanks to it, you can write a PC application that will communicate with the stack, which can be embedded into a USB dongle, which is part of a DK or EK.  The API provides an implementation of the peripheral role only. </li><li>  You can also download the source code of Android and iOS applications that allow you to work with debugging kits.  The applications themselves can be found in the respective app store platforms.  Applications allow you to test for example, the work of updating the firmware over the air (DFU - Device Firmware Update Service) or UART via Bluetooth. </li></ul><br><br><h4>  3. Development Tools </h4><br>  For programming, you can use both paid and free development tools.  NORDIC suggests using Keil MDK-ARM, IAR, as well as any IDE that allows you to work with GCC ARM.  To work with GCC, a document called ‚ÄúnAN-29 nRF51 Development with GCC and Eclipse Application Note‚Äù is proposed, which describes suggestions for developers who want to use Eclipse, GCC and GDB. <br><br>  NORDIC thinks Keil is preferable to use, and even the ‚ÄúnRF51 SDK‚Äù installer integrates the SDK into Keil, making it easier to create an application project.  All examples in the SDK have Keil format project files. <br><br><img src="https://habrastorage.org/files/f58/b7d/375/f58b7d3755d54cc89ce139371474ad48.png"><br><br><h4>  4. SoftDevice stack </h4><br><br>  The stack is offered in 3 versions. <br><ul><li>  S110 SoftDevice ‚Äìis intended for use in case your device should have the role of a peripheral device (Peripheral / Broadcaster). </li><li>  S120 SoftDevice - designed for use in case your device should be a central device (Central / Observer).  This stack can support up to 8 simultaneous connections to peripheral devices. </li><li>  S120 SoftDevice - designed for use in case your device should be both peripheral and central (Central / Peripheral / Broadcaster / Observer). </li></ul><br><br>  The API of any of the stack options allows you to control both the BLE controller and the host, i.e.  and other peripherals included in the chip.  It is more correct to say this: if you use the SoftDevice stack, then the rest of the periphery is managed through the stack API and it controls what and when to use it.  Naturally, the chip can be used without any stack at all, just like a regular microcontroller. <br><br>  The release information for the next version of the SDK always indicates the supported stack version.  This is very important, because the first thing a programmer encounters is the impossibility to flash his program due to the inconsistency between the SDK version and SoftDevice.  For example, the SDK version 6.1.0 works with the following stack versions: S110 - 7.0.0, 7.1.0;  S120 - 1.0.0. <br><br><h4>  5. Firmware stack and client application. </h4><br><br>  Due to the fact that the stack is offered only as a binary firmware file, the question arises: how to work with the chip if you need to sew both the stack and your program? <br><br><img src="https://habrastorage.org/files/85d/a1d/344/85da1d34476b42f19776ba440539f085.jpg"><br><img src="https://habrastorage.org/files/b61/3b9/ec0/b613b9ec08ee402ca5e550cc9f0e106c.jpg"><br><br>  As can be seen from these two figures, the stack is sewn to the bottom of the flash memory and uses the lower half of the RAM, starting at 0x2000000.  The application is sewn into flash memory, starting from the address CODE_R1_BASE uses RAM from the address RAM_R1_BASE. <br><br>  The variables CODE_R1_BASE and RAM_R1_BASE differ depending on the stack version. <br><br>  The stack is sewn using the ‚ÄúnRFgo Studio‚Äù program once, after which you can write your application and sew it with either ‚ÄúnRFgo Studio‚Äù or, more conveniently, using Keil. <br><br><img src="https://habrastorage.org/files/706/d14/6d2/706d146d235243c9bcba3ed376f0653b.PNG"><br><img src="https://habrastorage.org/files/3ff/438/1cc/3ff4381ccd8d49d89f42da3f5318c47f.PNG"><br><br>  The stack HEX file is sewn once, after which you can write your application and sew it or ‚ÄúnRFgo Studio‚Äù or, more conveniently, using Keil. <br><br>  Here is an example of setting up memory in Keil for S110 v.6.0.0 stack: <br><br><img src="https://habrastorage.org/files/c1c/f6f/856/c1cf6f85680e463c8741902eef82df95.png"><br><br>  The CODE_R1_BASE is 0x16000, and the RAM_R1_BASE is 0x20002000. <br><br>  And here is an example of setting memory in Keil for the S120 v.1.0.0 stack: <br><br><img src="https://habrastorage.org/files/e57/1a6/8fb/e571a68fbc84469da31bc9f218f215e4.png"><br><br>  The CODE_R1_BASE is 0x18000, and the RAM_R1_BASE is 0x20002800 <br><br><h4>  6. Conclusion </h4><br>  The SDK offers a large number of examples of using the nRF51822 chip both as a simple microcontroller and as a stack.  Thanks to the examples, you can quickly master the programming of the chip in parallel by studying all the subtleties of the SDK, and there are not enough of them. <br><br>  NORDIC has created a good forum where you can get an answer to almost any question.  Employees of the company often answer questions themselves and rather quickly. <br><br>  Thank you for reading my article to the end.  If you are interested and I pass the sandbox, then in the next article I will talk about the features of implementing client software using the SDK stack. <br><br>  I would like to wish you good luck and success in mastering and using Nordic Semiconductor products, I personally like their solutions. <br><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/246241/">https://habr.com/ru/post/246241/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../246221/index.html">A chance to learn from Yandex what he knows best</a></li>
<li><a href="../246223/index.html">Installing and configuring a VPS with a CentOS 6.x pair of commands with VestaCP</a></li>
<li><a href="../246235/index.html">Habr, meet - new LinguaLeo with a personalized system of learning a foreign language</a></li>
<li><a href="../246237/index.html">And IT, and PI: tell where small businesses get money for development</a></li>
<li><a href="../246239/index.html">Kiev Ciklum Speakers' Corner: "Manage your energy, not time", December 24</a></li>
<li><a href="../246245/index.html">Smartphone owners, on average, spend 5‚Öì hours a year waiting for video to load.</a></li>
<li><a href="../246247/index.html">How to build your own framework for iOS</a></li>
<li><a href="../246249/index.html">Security Meetup at the Mail.Ru Group office - how it was</a></li>
<li><a href="../246251/index.html">Key qualities of business intelligence in IT</a></li>
<li><a href="../246253/index.html">As we increased the responsiveness of the application</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>