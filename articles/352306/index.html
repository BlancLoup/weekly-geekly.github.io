<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Four facts about memcached amplification</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is a translation of Artem ximaera Gavrichenkov‚Äôs original publication, ‚ÄúUnderstanding the facts of memcached amplification attacks,‚Äù published on...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Four facts about memcached amplification</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/oi/sk/ux/oiskux3ks4ji1j06tbjoxwc2iye.png"></div><br>  <i>This is a translation of Artem <a href="https://habrahabr.ru/users/ximaera/" class="user_link">ximaera</a> Gavrichenkov‚Äôs original publication, ‚ÄúUnderstanding the facts of memcached amplification attacks,‚Äù published <a href="https://blog.apnic.net/2018/03/26/understanding-the-facts-of-memcached-amplification-attacks/">on the</a> <a href="https://en.wikipedia.org/wiki/Asia-Pacific_Network_Information_Centre">APNIC</a> (Asia-Pacific Network Information Center) <a href="https://blog.apnic.net/2018/03/26/understanding-the-facts-of-memcached-amplification-attacks/">blog</a> .</i> <br><br>  The week from February 25 to March 3 <a href="https://habrahabr.ru/company/qrator/blog/350074/">was</a> high-intensity from the point of view of memcached-amplified DDoS attacks in all corners of the world, that is, on the Internet. <br><br>  Nevertheless, let us once again recall all the facts that we know about amplified attacks. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Fact number one: Amplifiers were, are and will be </h3><br>  NTP (Network Time Protocol) was the first protocol maliciously used as an amplifier of DDoS attacks back in 2013.  Thousands and hundreds of thousands of NTP servers by that time were deployed throughout the network, so the use of this amplification vector was quite beneficial for attackers.  And NTP gave the opportunity that resulted in a wave of NTP-amplified DDoS attacks.  At the beginning of 2014, for some time NTP as the main amplifier became even more popular than the DNS protocol (Domain Name System). <br><a name="habracut"></a><br>  In 2015, we saw a massive rise of botnets.  They used UDP-based (User Datagram Protocol) amplifiers, setting a record for the band of DDoS attacks observed by that time.  Different botnets used different techniques, but a combination of thousands of compromised devices and NTP or DNS amplifications made such attacks extremely dangerous, as shown by the denial of service from Dyn and OVH in 2016. Joint resistance to the botnet command and control centers (C &amp; C) made it possible to avoid potential capture by botnets of control over the entire network. <br><br>  The same 2016 clearly demonstrated that NTP and DNS are not the only protocols used as amplifiers.  Portmap, SNMP, SSDP, Chargen, MSSQL, CLDAP and some other network protocols provide excellent opportunities to strengthen DDoS attacks.  Despite this, the next 2017 year brought a lot of different vulnerabilities that allow exploiting the dark sides of other protocols, because attackers with knowledge do not go on vacation and try to look for new, previously unexplored, attack vectors. <br><br><div class="spoiler">  <b class="spoiler_title">Video interview in English about attacks with DNS amplification</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/horM1YvpAEY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><br><h3>  Fact number two: Amplification has not changed and has not evolved - just found new vulnerabilities </h3><br>  Moreover, it is vulnerabilities that are the reason why we witnessed the events of the end of February and the beginning of March 2018.  After in 2017, a group of Chinese researchers from 0Kee described the amplification path through memcached, it took the attackers only a couple of months to set a world record of an amplified DDoS attack conducted using an unprotected memcached server.  Being free, free and present in virtually every Linux distribution, memcached is a powerful tool for destruction, providing a hypothetically infinite amplification factor (according to our data, the amplification factor is more than 10,000x, according to Akamai - more than 50,000x).  In this case, we again run into the capacity of transit connections as the main requirement for survival under a similar link-level attack. <br><br>  <a href="https://drive.google.com/file/d/1zkep0_EJvRAsTA5mMn0HKi8L5lTYTJsN/view">Link</a> to the original presentation 0Kee. <br><br>  When 10 years ago, the interception of UDP traffic was added to the basic memcached configuration, the birth of the new amplifier was simply obvious.  Just ten years ago, amplifiers as such did not worry almost anyone.  Only now, in the conditions of the growth of transmission and processing speeds of packets that has been going on for the past ten years, this has become a problem. <br><br>  The general concept of reflection and amplification has not changed at all.  First, illegitimate requests are sent to the vulnerable (open to the world on port 11211) memcached server (this technique is traditionally called <a href="https://en.wikipedia.org/wiki/IP_address_spoofing">IP-spoofing</a> ).  After this, the UDP server prepares a response and sends thousands of responses to the target with the help of an attacker, flooding the target host, which is quite legitimate from the point of view of memcached flood of responses.  Huge values ‚Äã‚Äãof PPS and BPS cannot be bypassed by any general means and means, since such a volume of traffic quickly makes routing devices at the boundaries of networks unavailable due to resource exhaustion. <br><br><h3>  Fact number three: When something works, it works;  but sometimes against you </h3><br>  So, a new world record has already been set in the DDoS attack band: Arbor Networks <a href="https://www.arbornetworks.com/blog/asert/netscout-arbor-confirms-1-7-tbps-ddos-attack-terabit-attack-era-upon-us/">showed</a> 1.7 Tbit / s to one of its customers, while GitHub, under the protection of Akamai, <a href="https://blogs.akamai.com/2018/03/memcached-fueled-13-tbps-attacks.html">survived</a> 1.3 Tbit / s.  The attack on GitHub was riveted by the attention of many media, as it is a large and popular resource, the normal operation of which is supported by many services and products around the world.  Qrator Labs client - Qiwi payment system, successfully neutralized the 480 Gbit / s attack of the amplified memcached UDP traffic. <br><br>  The Shodan statistics still show a large number of active memcached amplifiers open to attackers from anywhere in the world: <br><br><img src="https://habrastorage.org/webt/0n/ah/b6/0nahb6sl1l76bjkcapvznywkohs.png"><br>  <i>Shodan statistics for port 11211</i> <br><br>  As you can see from this screenshot, mainland China and the United States are the two main sources of memcached amplifiers.  Qrator.Radar also collected some statistics on the number of accessible and vulnerable memcached servers: <br><br><img src="https://habrastorage.org/webt/nl/by/1z/nlby1zvyfkjjfaq473oi3wkvrbo.png"><br>  <i>Qrator.Radar statistics on the total number of vulnerable memcached servers</i> <br><br>  The number of such servers drops very quickly.  Why?  No one wants to kill or be killed.  Operators (classical communications providers and transit operators) are worried about their networks and that they can be used as a tool to enhance what can easily be called "illegal." <br><br>  In order to make this information even more obvious and understandable, we collected statistics on the number of amplifiers in the customer cone of individual autonomous systems, here's an example of the top of this list: <br><br><img src="https://habrastorage.org/webt/1q/ni/po/1qnipokmb45ulj6jrc72puryvk0.png"><br><br>  DDoSmon also provides the ability to receive fairly detailed statistics on the number of targets of memcached-amplified DDoS attacks, where current trends are also visible: <a href="https://ddosmon.net/memcached_amplification_attack">https://ddosmon.net/memcached_amplification_attack</a> <br><br><img src="https://habrastorage.org/webt/pp/z8/jh/ppz8jhgmieo9aee7dnkr_lgjsys.png"><br><br><h3>  Fact number four: everything that can be corrected should be corrected. </h3><br>  Memcached users should disable UDP support in case they do not use UDP to transfer data.  Also, memcached should listen only to localhost - not all available interfaces, as it happens in some default settings. <br><br>  Any player larger than a single company that is responsible only for itself or one person responsible for a specific resource must be 100% sure that no memcached servers are visible from the rest of the network and are closed by a firewall. <br><br>  Be sure to pay attention <a href="http://www.senki.org/operators-security-toolkit/filtering-exploitable-ports-and-minimizing-risk-to-and-from-your-customers/">to the recommendations of</a> AUSNOG (Australian Network Operators' Group) for the implementation of Explotable Port Filters. <br><br>  And although the number of vulnerable servers across the network is declining, attackers continue to search for new and stronger ways to exploit vulnerabilities and, in general, are currently succeeding in this search.  System administrators, who are supposedly responsible for memcached servers, behave recklessly or even ignorantly, so that the long tail of attempts to close the remaining caches that cause problems, do not go anywhere.  That is why it is so important to try to deal with the problem of memcached amplification at the operator level. <br><br>  Currently, the best way to do this is to use rate limits on all ports looking outside and monitor UDP traffic on port 11211 until it can be managed.  It protects your infrastructure, and your customers, and any random victim. <br><br>  It contains several recommendations at once: <a href="http://www.senki.org/memcached-on-port-11211-udp-tcp-being-exploited/">http://www.senki.org/memcached-on-port-11211-udp-tcp-being-exploited/</a> <br><br>  NTT recommends adding memcached UDP / 11211 to the same ‚Äúexploitable ports‚Äù list as NTP, CHARGEN and SSDP.  Below is an example configuration for IOS XR, allowing you to set rate-limit on amplification sensitive UDP ports up to 1% of capacity.  Qrator Labs considers this method of processing memcached traffic extremely useful and efficient, recommending it for deployment: <br><br> <code>ipv4 access-list exploitable-ports <br> permit udp any eq ntp any <br> permit udp any eq 1900 any <br> permit udp any eq 19 any <br> permit udp any eq 11211 any <br> ! <br> ipv6 access-list exploitable-ports-v6 <br> permit udp any eq ntp any <br> permit udp any eq 1900 any <br> permit udp any eq 19 any <br> permit udp any eq 11211 any <br> ! <br> class-map match-any exploitable-ports <br> match access-group ipv4 exploitable-ports <br> match access-group ipv6 exploitable-ports-v6 <br> end-class-map <br> ! <br> policy-map ntt-external-in <br> class exploitable-ports <br> police rate percent 1 <br> conform-action transmit <br> exceed-action drop <br> ! <br> set precedence 0 <br> set mpls experimental topmost 0 <br> ! <br> class class-default <br> set mpls experimental imposition 0 <br> set precedence 0 <br> ! <br> end-policy-map <br> ! <br> interface Bundle-Ether19 <br> description Customer: the best customer <br> service-policy input ntt-external-in <br> ipv4 address xxx/x <br> ipv6 address yyy/y <br> ... <br> ! <br> interface Bundle-Ether20 <br> service-policy input ntt-external-in <br> ... <br> ... etc ... <br></code> </div><p>Source: <a href="https://habr.com/ru/post/352306/">https://habr.com/ru/post/352306/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../352296/index.html">A simple asynchronous task manager for Unity3D</a></li>
<li><a href="../352298/index.html">From idea to AppStore</a></li>
<li><a href="../352300/index.html">Resolve IP addresses in Linux: a clear and detailed description</a></li>
<li><a href="../352302/index.html">Zuckerberg called. Facebook programmer about his experience of interviewing in the US and the workflow on Facebook</a></li>
<li><a href="../352304/index.html">Do-it-yourself Property Injection (Xamarin / .Net)</a></li>
<li><a href="../352308/index.html">Lecture by Andrei Bezrukov on the digital economy, global challenges and what it is like to be a spy</a></li>
<li><a href="../352310/index.html">Development of elevator movement algorithm</a></li>
<li><a href="../352312/index.html">You don't need autotest developers.</a></li>
<li><a href="../352314/index.html">Went out for bread - bought a house: augmented reality as the future of banking</a></li>
<li><a href="../352316/index.html">We invite you to the All-Russian Student Olympiad in the direction of "Information Security" in the MEPI</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>