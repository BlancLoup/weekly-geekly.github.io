<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>GitHub opened the code of its load balancer - how their solution works</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The developers from GitHub last week laid out in open access the sources of their load balancer - GLB Director. The team worked on this project for se...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>GitHub opened the code of its load balancer - how their solution works</h1><div class="post__text post__text-html js-mediator-article">  The developers from GitHub last week <a href="https://github.com/github/glb-director">laid out</a> in open access the sources of their load balancer - GLB Director.  The team worked on this project for several years. <br><br>  What is remarkable about their decision, how it is arranged, and who has yet transferred the load distribution systems to open source, we describe below. <br><br> <a href="https://habr.com/company/it-grad/blog/420093/"><img src="https://habrastorage.org/webt/ip/ug/d_/ipugd_mjizp2ny7vkrzcf0yuale.jpeg"></a> <a name="habracut"></a><br>  <font color="#A9A9A9"><i>/ Flickr / <a href="https://www.flickr.com/photos/theilr/8065855132">theilr</a> / <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC</a></i></font> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Why does GitHub have a balancer? </h2><br>  GitHub uses <a href="https://githubengineering.com/githubs-metal-cloud/">bare metal</a> based cloud infrastructure to improve performance.  In this case, the software works without additional levels of virtualization on the bare metal. <br><br>  Previously, the company used <a href="http://www.haproxy.org/">haproxy</a> with a special hardware configuration for load balancing, which provided fault tolerance for 10 Gigabit Ethernet connections.  However, this approach did not scale well (it meant vertical scaling), and GitHub decided to write its own load balancer, which could still work on low-cost hardware. <br><br><h2>  What GLB Director can do and how it works </h2><br>  The GitHub balancer provides uninterrupted TCP connections, manages the load of individual services, is resistant to DDoS attacks and is able to scale horizontally.  It is ‚Äú <a href="https://github.com/github/glb-director">sharpened</a> ‚Äù for work in data centers, where a large number of servers announce one IP address via <a href="https://ru.wikipedia.org/wiki/Border_Gateway_Protocol">BGP</a> , and routers use <a href="https://en.wikipedia.org/wiki/Equal-cost_multi-path_routing">ECMP</a> strategy. <br><br>  Load balancing <a href="https://github.com/github/glb-director">is performed</a> at levels L4 and L7.  Unlike solutions such as <a href="https://en.wikipedia.org/wiki/Linux_Virtual_Server">LVS</a> , GLB Director does not direct all packets to the director node (routing node), in order to redistribute them between other nodes.  Instead, it <a href="">uses a</a> rendezvous hash variation (rendezvous hashing, <a href="https://en.wikipedia.org/wiki/Rendezvous_hashing">HRW</a> ) to create a static table to select a pair of proxy servers (primary and secondary) for each incoming connection.  If one of them fails, the packet is sent to the second.  The system remembers this choice, and it does not need to be made for each package. <br><br>  The "health" of servers is monitored by the glb-healthcheck solution, which switches the primary and secondary systems in case of detection of problems.  glb-healthcheck <a href="https://githubengineering.com/glb-director-open-source-load-balancer/">monitors the</a> correct operation of each <a href="https://tools.ietf.org/html/draft-ietf-nvo3-gue-05">GUE</a> tunnel (Generic UDP Encapsulation) and an arbitrary HTTP port of backend servers. <br><br>  GLB also uses the <a href="https://ru.wikipedia.org/wiki/Netfilter">Netfilter</a> system and the <a href="https://en.wikipedia.org/wiki/Iptables">iptables</a> utility.  Netfilter solves a simple task: it determines whether the internal TCP / IP packet in each GUE packet matches the requirements of the Linux kernel stack.  If not, it forwards the packet to the secondary proxy server, rather than decapsulating it locally. <br><br>  The scheme of interaction of components is as follows: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qo/jn/nq/qojnnqepktvxzsncjezsypdkpcw.png" width="500"></div><br>  In GitHub <a href="https://githubengineering.com/glb-director-open-source-load-balancer/">they hope</a> that their balancer will be useful to all companies that have their data centers. <br><br>  How to install GLB and start working with it can be found in the <a href="">quick start guide prepared by the developers</a> . <br><br><h2>  Similar developments </h2><br>  In May, Facebook also <a href="https://www.datacenterknowledge.com/facebook/facebook-open-sources-katran-load-balancer-details-network-provisioning-tool">shared the</a> source code for its Katran load balancer library.  The IT giant <a href="https://code.fb.com/open-source/open-sourcing-katran-a-scalable-network-load-balancer/">uses</a> it to effectively distribute the load between backend servers. <br><br>  The previous balancer of the company - L4LB - could not cope with the task, as it required dedicated servers for work, which increased the load on the network.  To solve this problem, the company and developed Katran.  It is launched using the eXpress Data Path framework and the eBPF virtual machine.  VM extends the overall functionality by running programs at specific points in the Linux kernel. <br><br><img src="https://habrastorage.org/webt/p0/d_/za/p0d_za_m1honswwhdemydbkrszs.jpeg"><br>  <font color="#A9A9A9"><i>/ Flickr / <a href="https://www.flickr.com/photos/112931986%40N07/11646644866/">Da Sal</a> / <a href="https://creativecommons.org/licenses/by/2.0/">CC</a></i></font> <br><br>  The updated balancer more effectively <a href="https://code.fb.com/open-source/open-sourcing-katran-a-scalable-network-load-balancer/">distributes the</a> load on the infrastructure and increases the speed of packet processing.  Sources developers <a href="https://github.com/facebookincubator/katran">"flooded"</a> on GitHub. <br><br>  The Katran system <a href="https://news.ycombinator.com/item%3Fid%3D17718367">has a number of</a> differences from the solution proposed in GitHub.  For example, the Facebook system uses XDP and IPIP tunnels that work with the Linux kernel.  GLB, in contrast, resorts to using DPDK to process packets from user space. <br><br>  Theo Julienne, developer of GitHub, <a href="https://www.theregister.co.uk/2018/08/09/github_load_balancing_director/">added</a> that <a href="https://www.dpdk.org/">DPDK</a> allows to handle large volumes of incoming traffic.  This ensures high performance (10 Gigabit connectivity) even in complex working environments and provides some protection against DDoS attacks. <br><br>  The transfer of powerful tools such as GLB and Katran in open source will open up new opportunities for other IT companies and will contribute to the more rapid development of the IT ecosystem in the world. <br><br><hr><br>  <i>PS A couple of additional articles from the First Corporate IaaS blog:</i> <i><br><br></i> <ul><li>  <a href="https://iaas-blog.it-grad.ru/blog/onlajn-uslugi-dlya-b2cb2b-iz-oblaka/">How to place 100% of the infrastructure in the cloud IaaS-provider and not regret it</a> </li><li>  <a href="https://iaas-blog.it-grad.ru/proizvoditelnost/testirovanie-diskovoj-sistemy-v-oblake/">Testing a disk system in the cloud: the basics</a> </li><li>  <a href="https://iaas-blog.it-grad.ru/funkcionalnost/balansirovka-nagruzki-v-oblake-iaas/">Load Balancing in the IaaS Cloud: Why DRS is needed</a> </li></ul><br><hr></div><p>Source: <a href="https://habr.com/ru/post/420093/">https://habr.com/ru/post/420093/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../420083/index.html">Perfect Action for Google Assistant - 8 lessons of the Moscow hackathon</a></li>
<li><a href="../420085/index.html">Recognizing objects and human emotions using the Firebase ML Kit</a></li>
<li><a href="../420087/index.html">This is a post with reports and videos on MS SQL Server</a></li>
<li><a href="../420089/index.html">Robomobili: Platooning and Bavarian sausages</a></li>
<li><a href="../420091/index.html">Comments in the code as a way of expression</a></li>
<li><a href="../420095/index.html">Asymmetric cryptography with a one-time secret key: description of the idea and possible application</a></li>
<li><a href="../420097/index.html">Security Week 30: five paragraphs about Black Hat</a></li>
<li><a href="../420099/index.html">Creating a thin client based on cheap single board PCs</a></li>
<li><a href="../420101/index.html">9 years of encapsulated development - how does the project team work in a corporation of 2500 people</a></li>
<li><a href="../420103/index.html">The best English-speaking reports from HighLoad ++ 2017</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>