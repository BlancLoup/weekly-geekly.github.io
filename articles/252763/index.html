<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Virtual Link Trunking (VLT) Technology for Dell Network Factories</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today we want to tell you about Dell Virtual Link Trunking (VLT) technology, which allows you to combine two switches into a fault-tolerant configurat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Virtual Link Trunking (VLT) Technology for Dell Network Factories</h1><div class="post__text post__text-html js-mediator-article">  Today we want to tell you about Dell Virtual Link Trunking (VLT) technology, which allows you to combine two switches into a fault-tolerant configuration for connecting to other switches or servers using Link Aggregation Group (LAG) and 802.3ad LACP protocol. <br><br>  Usually, LAGs from servers and access level switches can be connected to only one aggregation level switch.  To ensure fault tolerance, you can use the stack aggregation of several aggregation switches, which represent a single logical device.  But this solution has its drawbacks, since the stack has a single control plane - it becomes the weak link of the system.  When upgrading the operating system, all switches in the stack need to be rebooted, due to which service interruptions occur.  Now let's compare this scheme with the one that uses VLT technology: this configuration already has two control planes, so the network continues to work even when updating the operating system on one of the switches.  In this case, all the physical links between the switches assembled in the VLT and the devices connected to them are also duplicated. <br><a name="habracut"></a><br>  All major manufacturers of network equipment have this kind of technology, each of which has its own proprietary implementation.  For example, Cisco supports the Virtual Port Channel (vPC), Brocade uses Multi-Chassis Trunking (MCT), and Juniper supports the Virtual Chassis technology.  Technologies are also used with open standards that provide similar functionality: Transparent Interconnection of Lots of Links (TRILL) and Shortest Path Bridging (SPB). <br><br>  <b>Main advantages of VLT</b> <br><ul><li>  no loops form in the Layer 2 domain; </li><li>  availability and fault tolerance; </li><li>  fast convergence in network failures; </li><li>  all physical channels in the network are active and used more efficiently; </li><li>  active load distribution on the default gateway using VRRP or Peer-routing functionality; </li><li>  fast convergence when rebooting one of the switches; </li><li>  Migration of virtual machines within a Layer 2 domain. </li></ul><br>  <b>VLT Technology Description</b> <br>  VLT is a configuration of two switches, which on Layer 2 are perceived by other network devices as a whole.  Physically, these are two devices that are interconnected according to a special scheme, but for servers, switches and other network devices, they look like a single switch.  However, each of them has its own control plane, is configured independently of the other, and is controlled by its own operating system.  Although a single network device connects to two switches using a LAG, VLT does not allow loops to form ‚Äî the one that the Spanning Tree Protocol (STP) is struggling with.  Such a connection provides fault tolerance and even load distribution between the switches.  They can connect switches or stacks of switches, servers, or other devices that support the integration of multiple ports in a LAG using the LACP protocol. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let's take the example of a small scheme in the terminology of the VLT, which we will need in the future. <br><img src="https://habrastorage.org/files/1a0/432/b78/1a0432b782b34af6972eadf8c85d7777.png"><br><br><ul><li>  Virtual link trunk (VLT) is a virtual network link between connected devices and two VLT switches. </li><li>  VLT backup link is a backup connection that checks the performance of VLT switches.  Through it, periodic keep alive packets are transmitted between VLT switches. </li><li>  VLT interconnect (VLTi) - a connection for transferring service information between VLT switches.  These ports must be 10 Gbps or 40 Gbps. </li><li>  VLT domain - a domain of two VLT switches, VLTi ports and all VLT connections of devices connected to them.  This domain is used for a single configuration of global VLT parameters. </li><li>  VLT peer is one of two VLT switches interconnected via VLT interconnect (VLTi). </li><li>  Non-VLT port ‚Äî Any port on a VLT switch that has a device connected to it that is not connected to another VLT switch. </li></ul><br>  Periodic hello service messages are transmitted through the VLT backup connection, and VLT control messages through the VLTi interfaces.  This is necessary to synchronize the L2 / L3 control plane between two VLT switches.  MAC, ARP and IGMP tables are synchronized between them to provide joint switching and protection against failures if one of the switches or physical connection channels fails.  VLT technology also provides forwarding traffic along the shortest path, bypassing the VLTi channel, but which can be used in the event of a failure. <br>  The backup heartbeat packet exchange channel is usually provided through the control ports of the switches connected to a dedicated control network.  Also, the backup channel can connect any ports of the VLT switches, but for heartbeat packets it is recommended to use the control port: it can work when the VLTi channel has failed. <br><br>  In the VLT, one of the switches is chosen as the main switch, and it takes control of the LACP and STP protocols and sends service packets to the second VLT peer. <br><br>  All VLANs configured for VLT connections are automatically added tagged for the VLTi channel. <br>  Each device connected to a domain VLT receives broadcast packets through VLT switches only once.  Broadcast packets are blocked when they are sent to the port of the connected device, if they are received by the VLT in peer via the VLTi link.  But this only happens when the ports for the connected device are active at both peers.  If a port on one of the peers does not work, then information about its status is immediately transmitted to the second peer.  That, in turn, immediately removes the lock, and the device continues to receive packets. <br><br>  <b>Dell Switch Table with VLT Support</b> <br><img src="https://habrastorage.org/files/947/a2a/37b/947a2a37b35c45f48ffc3985977168dc.png"><br>  <i>The table was updated in January 2016 due to the release of new products that support VLT.</i> <br><br>  <b>Default Gateway with VLT</b> <br>  To protect the default gateway, you can configure the VRRP protocol within the VLT domain.  In this case, both switches will route traffic sent to the default gateway, including the switch, which is not the current VRRP master. <br><br>  An alternative to the VRRP protocol is Peer-routing functionality in the VLT domain.  Consider how it works. <br><br>  Packets from the server destined to the default IP gateway 10.10.10.2 (as shown in the diagram on the left), due to the hash algorithm for the LAG, can be forwarded to the Peer 1 switch. Without Peer-routing functionality, the switch will have to forward these packets to the Peer 2 switch . <br><img src="https://habrastorage.org/files/62b/914/80a/62b91480a2bf474e8efdbfcb1f350136.png"><br><br>  Peer-routing functionality allows the switch to forward packets to the default gateway located on the next VLT peer (as shown in the diagram on the right).  Thanks to this, optimal routing is achieved, packets are delivered faster, the VLTi link does not load, and VRRP is not required to be configured.  Peer-routing functionality protects the default gateway for more VLAN interfaces compared to VRRP, which has a limitation of 255 VLANs. <br><br>  <b>VLT Routing</b> <br>  In data center networks, it is important to provide a ‚Äústretched‚Äù Layer 2 domain for clustered applications and free migration of virtual machines.  VLT technology provides such a ‚Äústretched‚Äù VLAN routing capabilities.  This is achieved using the Peer-routing functionality, which in addition to the default gateway supports routing protocols OSPF, IS-IS and BGP.  One of these protocols can be configured within a ‚Äústretched‚Äù VLAN on VLT switches.  And then the neighbors using the routing protocol will be able to share their routes.  In this case, only broadcast mode is supported for OSPF or IS-IS routing protocols, not point-to-point. <br><br>  In data centers with high density of virtual machines for a given VLAN that is ‚Äústretched‚Äù across several racks, you can configure several default gateways and distribute them across switches in VLT domains.  This will allow in turn to distribute ARP tables across VLT domains for greater scaling. <br><br>  The VLT supports the IPv4 and IPv6 routing protocols, but Peer-routing functionality to protect the default gateway only works for IPv4.  For IPv6 default-gateway protection, it is recommended to configure the VRRP protocol. <br><br>  The diagram shows an example of using OSPF on a network with multiple VLT domains: <br><br><img src="https://habrastorage.org/files/68c/317/012/68c3170127154f478316b54ea62e3c57.png"><br><br>  OSPF is configured on VLAN 10 interfaces in broadcast mode.  For optimal propagation of routes, the VLT kernel-level switch, acting as the main (IP 10.10.10.1), is recommended to be designated as the DR for the OSPF, and its next VLT peer (IP 10.10.10.2) should be designated the BDR.  On the main VLT peer for VLAN 10, you need to set the highest OSPF priority in order for this switch to be DR selected.  On the adjacent VLT peer, a lower priority is set to select it as the BDR.  After exchanging routes, all VLT switches have information through which next-hop addresses routes are available.  At the same time, it is possible to ‚Äústretch‚Äù VLANs across all network switches, as shown in the example of VLAN 20 used for virtual machines. <br><br>  <b>Proxy Gateway for the neighboring VLT domain</b> <br>  Between the two VLT domains, you can configure the functionality of the Proxy Gateway.  It allows you to locally route traffic destined for the default gateway from a neighboring VLT domain.  This functionality is well suited for the case when two VLT domains are located in different geographically remote data centers.  Proxy Gateway allows you to optimize packet flow between data centers, reduce channel loading between data centers and provide protection in case of failure of one of the VLT peers that act as the default gateway. <br><img src="https://habrastorage.org/files/170/e31/2a0/170e312a080f4b1197cd01e24867ba4a.png"><br><br>  An example of the use of this feature is shown in the diagram.  Remote VLT domains are interconnected by four physical links using dark fiber or DWDM.  A virtual machine, with a configured default gateway C, migrates to a geographically remote data center without stopping its work.  After moving to data center 2, the virtual machine will continue to work without reconfiguration.  Packets sent by the virtual machine to gateway C will be locally routed by switches C1 and D1.  If static routes are used on switches C and D, then you need to configure them on switches C1 and D1 for symmetric routing. <br><br>  <b>VLT setup example</b> <br>  Before you begin configuring, make sure that both switches in the VLT domain use the same version of the Dell Networking OS and that RSTP is configured.  It will provide protection from loops if configuration errors are made. <br><br>  In the following example, VLT peer 1 uses the hostname S4810-1, VLT peer 2 - the hostname S4810-2, and the Top-of-Rack switch - the hostname S60-1. <br><img src="https://habrastorage.org/files/85f/94d/30b/85f94d30bb2444b5a3607842fa603b96.png"><br><br>  Configure VLTi between VLT peers.  It is recommended to use for this static LAG: <br><br><pre>  s4810-1 (conf) #interface port-channel 100
 s4810-1 (conf-if-po-1) # channel-member TenGigabitEthernet 0 / 4-5
 s4810-2 (conf) #interface port-channel 100
 s4810-2 (conf-if-po-1) # channel-member TenGigabitEthernet 0 / 4-5 </pre><br>  Set the same VLT domain number on VLT peers: <br><pre>  s4810-1 (conf) #vlt domain 1 </pre><br>  Add a VLTi link inside the VLT domain configuration: <br><pre>  s4810-1 (conf-vlt-domain) # peer-link port-channel 100 </pre><br>  Configure backup connection between VLT peers.  On VLT peer 1, use the IP address specified on the VLT peer 2 management interface for backup communication: <br><pre>  s4810-2 # show interfaces managementethernet 0/0
 Internet address is 10.11.206.58/24
 s4810-1 (conf-vlt-domain) # back-up destination 10.11.206.58 </pre><br>  Assign the VLT to the peer 1 as the main role with the help of a lower priority than that of the neighbor: <br><pre>  s4810-1 (conf-vlt-domain) # primary-priority 100 </pre><br>  Set the default MAC address for communication in the VLT domain: <br><pre>  s4810-1 (conf-vlt-domain) # system-mac mac-address 00: 11: 22: 33: 44: 55 </pre><br>  Assign a unique unit ID (0 and 1) to each peer: <br><pre>  s4810-1 (conf-vlt-domain) # unit-id 0 </pre><br>  When you create a VLT domain on the switches, Dell Networking OS can assign the MAC address for the interaction itself and give the switches a unique unit ID.  Using the system-mac mac-address and unit-id commands minimizes the synchronization time of peers after rebooting one of the switches. <br><br>  Configure the VLT domain on peer 2: <br><pre>  s4810-2 (conf) #vlt domain 1
 s4810-2 (conf-vlt-domain) # peer-link port-channel 100
 s4810-2 (conf-vlt-domain) # back-up destination 10.11.206.43
 s4810-2 (conf-vlt-domain) # system-mac mac-address 00: 11: 22: 33: 44: 55
 s4810-2 (conf-vlt-domain) # unit-id 1 </pre><br>  We configure VLT connection of peers 1 and 2 with the Top-of-Rack switch.  To do this, we configure LACP LAG on the ports of peers 1 and 2 connected to the Top-of-Rack switch.  Set up the same VLT ID for this LACP LAG on VLT peers 1 and 2: <br><pre>  s4810-1 (conf) #interface TenGigabitEthernet 0/40
 s4810-1 (conf-if-te-0/40) # port-channel-protocol lacp
 s4810-1 (conf-if-te-0/40-lacp) # port-channel 1 mode active 
 s4810-1 (conf) #interface port-channel 1
 s4810-1 (conf-if-po-1) #switchport 
 s4810-1 (conf-if-po-1) # vlt-peer-lag port-channel 1 </pre><br><pre>  s4810-2 (conf) #interface TenGigabitEthernet 0/40
 s4810-2 (conf-if-te-0/40) # port-channel-protocol lacp
 s4810-2 (conf-if-te-0/40-lacp) # port-channel 1 mode active 
 s4810-2 (conf) #interface port-channel 1
 s4810-2 (conf-if-po-1) #switchport 
 s4810-2 (conf-if-po-1) # vlt-peer-lag port-channel 1 </pre><br>  On the Top-of-Rack switch, we configure the LACP LAG for the physical ports connected to peers 1 and 2: <br><pre>  S60-1 (conf) #interface range TenGigabitEthernet 0/48, TenGigabitEthernet 0/50
 S60-1 (conf-if-range-te-0/48, te-0/50) # port-channel-protocol lacp
 S60-1 (conf-if-range-te-0/48, te-0/50-lacp) # port-channel 1 mode active </pre><br>  Check whether the VLT, the VLTi connection, the backup channel and the status of the neighboring VLT peer are working: <br><pre>  s4810-1 # show vlt brief
  VLT Domain Brief
 ------------------
  Domain ID: 1
  Role: Primary
  Role Priority: 100
  ICL Link Status: Up
  HeartBeat Status: Up
  VLT Peer Status: Up
  Local Unit Id: 0
  Version: 6 (1)
  Local System MAC address: 00: 01: e8: 8b: 2d: 41
  Remote System MAC address: 00: 01: e8: 8b: 28: a9
  Configured System MAC address: 00: 11: 22: 33: 44: 55
  Remote system version: 6 (1)
  Delay-Restore timer: 90 seconds </pre><br>  Check if VLT LAG is active on both VLT peers: <br><pre>  s4810-1 # show vlt detail
 Local LAG Id Peer LAG Id Local Status Peer Status Active VLANs
 ------------ ----------- ------------ ----------- ---- ---------
 1 1 UP UP 1 </pre><br><br><pre>  s4810-1 # sho interfaces port-channel 1 brief
 Codes: L - LACP Port-channel
     LAG Mode Status Uptime Ports
 L 1 L2L3 up 00:34:00 Te 0/40 (Up) </pre><br>  <b>Design example</b> <br>  Consider an example of a data center network infrastructure design using VLT technology.  Two VLT domains are connected by one LAG consisting of four 40GE ports.  VLT allows you to distribute traffic across all channels between the level of blade switches and core network switches. <br><img src="https://habrastorage.org/files/3a8/d48/f1f/3a8d48f1f0114709b33c71f178d3ec9d.png"><br><br>  This network infrastructure also provides convergence of LAN and SAN networks by supporting iSCSI DCB technology on all components of the solution: Dell EqualLogic storage systems, Dell switches and converged adapters for Dell blade servers. <br><br>  You can read more about this design example and its configuration described in the <a href="http://en.community.dell.com/techcenter/extras/m/white_papers/20403697">Datacenter Reference Architecture - Deploying Active fabric for Datacenter</a> . </div><p>Source: <a href="https://habr.com/ru/post/252763/">https://habr.com/ru/post/252763/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../252751/index.html">High website availability: site file geo-replication with lsyncd</a></li>
<li><a href="../252753/index.html">DaData.ru prompts email and determines the city by IP</a></li>
<li><a href="../252755/index.html">Tales of the antivirus forest</a></li>
<li><a href="../252759/index.html">Creating a Windows Runtime component in Visual C ++</a></li>
<li><a href="../252761/index.html">Optimizing the ToArray and ToList methods by providing the number of elements</a></li>
<li><a href="../252767/index.html">We program in a cloud: the review popular IDE</a></li>
<li><a href="../252769/index.html">Align the modal window in the center</a></li>
<li><a href="../252771/index.html">Perspective matrices in graphic API or the devil hides in details</a></li>
<li><a href="../252773/index.html">Material Design: to the moon and back</a></li>
<li><a href="../252779/index.html">e-Ticket misunderstanding</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>