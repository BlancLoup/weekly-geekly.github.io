<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>You are using interfaces in go wrong!</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="With such a loud headline, I thought to write an article first. No, in fact, it is quite possible that you are fine and this article is not about you....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>You are using interfaces in go wrong!</h1><div class="post__text post__text-html js-mediator-article">  With such a loud headline, I thought to write an article first.  No, in fact, it is quite possible that you are fine and this article is not about you.  But very often, when people come from other languages, you can see how they are trying to ‚Äúpull their ears‚Äù patterns from the language they are used to, and they often do not work well in Go. <br><br><img src="https://habrastorage.org/web/445/ca5/be2/445ca5be2bdb44078ea6672369596db0.png"><br><br>  In this article, I would like to collect a few typical mistakes that novice Go programmers make (including myself), and how to avoid these errors. <br><a name="habracut"></a><br><h3>  Packing </h3><br>  Packages in go have one feature that is not found in most other languages ‚Äã‚Äã‚Äî cyclic dependencies between packages are prohibited.  Therefore, package partitioning suddenly becomes very important so that you can effectively develop large applications. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Very often, when broken into packages, people try to divide them into too small entities, and there are packages with abstract names like ‚Äúcommon‚Äù, ‚Äúdomain‚Äù, ‚Äúmisc‚Äù, etc., which contain ‚Äúcommon logic‚Äù between packages, in order to avoid creating loops.  In principle, there is nothing wrong with this fact directly, but if you look at the standard library, then there are no such packages in it, although it operates with rather complex entities. <br><br>  How does she do it?  What is the difference between the standard library and your project?  If you look closely, you can literally pick out a couple of basic points where things go different from other languages ‚Äã‚Äãin go: <br><br>  <b>1. Packages may be large</b> <br><br>  The ‚Äúnet / http‚Äù package, for example, has more than 40 files, and more than 20 different public types are defined.  They all belong to HTTP and it would be illogical to break them into several packages.  Types like http.Header, http.Client, http.Server all look logical and there is no need to try, for example, to separate the client implementation from the server implementation just for the sake of getting smaller modules. <br><br>  <b>2. Packages can consist almost entirely of interfaces, global constants and variables.</b> <br><br>  For example, there is the io package, which contains all the necessary interfaces and constants that relate to a very general concept of "input-output".  But in this package there is generally no hint of implementation, because there are many implementations of these interfaces, and otherwise ring dependencies would have been obtained. <br><br>  In short, the idea is as follows - break into packets based on the subject area to which the relevant entities relate.  If some entities from different packages refer to each other, then perhaps you just need to shove them into one big package and you end up with a much more logical and understandable type hierarchy. <br><br><h3>  Use of interfaces </h3><br>  Interfaces must be defined in a separate package from the implementation.  The implementation returns a specific type, not an interface.  Almost always, interfaces must be defined in the package that <i>accepts the dependency</i> , or separately.  This allows you to simultaneously avoid circular dependencies, and makes your code more testable and flexible. <br><br>  <b>An example of the first approach (interface is defined in the receiver)</b> <br><br>  You all know the fmt package.  And they also probably wrote something like the following: <br><br><pre><code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">//  habr.go package habr type Article struct { title string } func (a *Article) String() string { return a.title } //  main.go package main import ( "fmt" "habr" ) func main() { a := &amp;habr.Article{title: "    Go !"} fmt.Printf("The article: %s\n", a) }</span></span></code> </pre> <br>  Pay attention to the String () method.  In the fmt package, the fmt.Stringer interface is declared, and the implementation of this interface is accepted in the same package (albeit in this case implicitly). <br><br>  The habr package, in turn, does not depend on the fmt package at all and the fmt package can freely import it if it wishes.  This allows you to "gently" create cyclic dependencies, without the need to refactor code and rebuild the entire package structure. <br><br>  A more detailed example (and rationale) can be seen at the following links (in English): <br><br><ul><li>  <a href="https://github.com/golang/go/wiki/CodeReviewComments">github.com/golang/go/wiki/CodeReviewComments#interfaces</a> </li><li>  <a href="http://idiomaticgo.com/post/best-practice/accept-interfaces-return-structs/">idiomaticgo.com/post/best-practice/accept-interfaces-return-structs</a> </li></ul><br>  <b>An example of the second approach (the allocation of interfaces in a separate package)</b> <br><br>  If an interface (or some type) is needed more than in one place and it has value by itself, then it should be allocated in a separate package.  This is how the io package appeared - it contains the most useful interfaces, constants and variables that somehow relate to I / O.  In order not to introduce additional dependencies when importing this package, there is a separate package that contains convenient functions for working with interfaces from io - the ioutil package. <br><br>  Interfaces from the io package turned out so successful that, as far as I know, Go is the only language in which the standard out-of-the-box library can print simultaneously to files, sockets, HTTP responses, byte buffers, etc., and this the functionality went to the standard library almost ‚Äúfree‚Äù, thanks to well thought-out abstractions. <br><br><h3>  General recommendations </h3><br>  In this (a little short and a little messy) article I mentioned 2 things that beginners often skip in recommendations for using go.  I hope this article will help to achieve a better understanding of how not to feel pain when using this beautiful language. <br><br><h3>  Links </h3><br>  Most likely you have already read <a href="https://golang.org/doc/effective_go.html">Effective Go</a> , but if not, I highly recommend it :).  There are also two great articles that describe ‚Äúgood practices‚Äù when programming with go: <br><br><ul><li>  <a href="https://github.com/golang/go/wiki/CodeReviewComments">github.com/golang/go/wiki/CodeReviewComments</a> </li><li>  <a href="http://idiomaticgo.com/post/best-practice/accept-interfaces-return-structs/">idiomaticgo.com/post/best-practice/accept-interfaces-return-structs</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/332948/">https://habr.com/ru/post/332948/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../332938/index.html">How to build a small but good network?</a></li>
<li><a href="../332940/index.html">Marketer Notes: How to install Ubuntu on RPI and connect to Azure IoT Hub</a></li>
<li><a href="../332942/index.html">Post-quantum cryptography and the decline of the RSA - a real threat or an imaginary future?</a></li>
<li><a href="../332944/index.html">IoT on guard, or how to make our world a little safer</a></li>
<li><a href="../332946/index.html">Experience in implementing Apple Pay mobile payment service in a bank</a></li>
<li><a href="../332950/index.html">Aggregation of Internet channels through mobile operators</a></li>
<li><a href="../332952/index.html">Show me a business problem and I will try to avoid it.</a></li>
<li><a href="../332954/index.html">Notifications of missed calls from Asterisk to Bitrix24</a></li>
<li><a href="../332956/index.html">Red, white, blue: eight rules for choosing a color palette that everyone should know</a></li>
<li><a href="../332958/index.html">35 tips for those attending a technical conference</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>