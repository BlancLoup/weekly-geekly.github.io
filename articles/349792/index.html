<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Network layer in iOS application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Virtually any mobile application interacts with servers through their API. The developer then has the task to implement the network layer of his appli...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Network layer in iOS application</h1><div class="post__text post__text-html js-mediator-article">  Virtually any mobile application interacts with servers through their API.  The developer then has the task to implement the network layer of his application.  The providers of an API develop its interface, often in the same way, but it also happens that the API has its own specifics.  For example, the Vkontakte API with any error in accessing their methods does not display this in the status of the response code, but displays it in the response body itself as JSON by the ‚Äúerror‚Äù key: that is, firstly, you will not understand by the status code whether the request was successful, and secondly, you will not know what error occurred until you change the logic for processing the response.  Thus, the developer has the task of implementing a sufficiently flexible layer, control over which can be carried out at different stages of work with the server. <br><br>  I want to tell how you can build a fairly flexible network layer. <br><br>  Please note that this is the architecture of the network layer of the application, and not the implementation of working with the network.  You can use any network framework. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Here is what it will look like in the end: <br><br><pre><code class="hljs scala"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-type"><span class="hljs-type">UIKit</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewController</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">UIViewController</span></span> { let service: <span class="hljs-type"><span class="hljs-type">WallPostable</span></span> = <span class="hljs-type"><span class="hljs-type">BasicWallAPI</span></span>() <span class="hljs-meta"><span class="hljs-meta">@IBOutlet</span></span> weak <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> textField: <span class="hljs-type"><span class="hljs-type">UITextField</span></span>! <span class="hljs-meta"><span class="hljs-meta">@IBAction</span></span> func postAction() { service.postWall(<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>: textField.text!) } }</code> </pre> <a name="habracut"></a><br>  So, how does the work with the API for the end user look like (I mean the programmer who uses the layer implementation): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f1a/a09/e3b/f1aa09e3b2a729c8580a6f356b32b47a.png" alt="image"><br><br>  Let's open the API box a bit: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9b8/94f/4af/9b894f4af73bdd058704b6f5859e2a87.png" alt="image"><br><br>  How do I see the Send box: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/012/d0a/36d/012d0a36dd06e050dc629eb8c1c279ea.png" alt="image"><br><br>  We form a request.  Usually requests have some identical headers and in order not to register them in each request, we prepare requests in the ‚ÄúRequest Preparation‚Äù block.  Next, we send a fully compiled request using a convenient framework (in my example, I use Apple‚Äôs native framework).  Send a request is always the easiest, everything starts when you receive a response. <br><br>  How I see the Handle box: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/72d/2f5/e0f/72d2f5e0fe66b96a0fd30c284c60ab8d.png" alt="image"><br><br>  We check the received answer for success, then in case of a successful answer we will convert it into a model that is understandable for the application and give it back.  If the request is not executed successfully, then we give it to the error handling block: it gets an error code, a message if there is one, reacts to all this as we tell it, forms an error that is understandable for the application and gives. <br><br>  The network layer, which I implement, divides each action and encapsulates it in the appropriate type, which will implement this unique duty.  These types will be interconnected by protocols. <br><br>  So, what we need: <br><br><ul><li>  Request <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTTPMethod</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">GET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">POST</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">PUT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">DELETE</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTTPRequestRepresentable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> path: <span class="hljs-type"><span class="hljs-type">String</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> httpMethod: <span class="hljs-type"><span class="hljs-type">HTTPMethod</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parameters: <span class="hljs-type"><span class="hljs-type">JSON?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> headerFields: [<span class="hljs-type"><span class="hljs-type">String</span></span>: <span class="hljs-type"><span class="hljs-type">String</span></span>]? { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bodyString: <span class="hljs-type"><span class="hljs-type">String?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTTPRequestRepresentable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">urlRequest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">URLRequest?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> urlComponents = <span class="hljs-type"><span class="hljs-type">URLComponents</span></span>(string: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.path) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> parametersJSON = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.parameters { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> queryItems = [<span class="hljs-type"><span class="hljs-type">URLQueryItem</span></span>]() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (key, value) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> parametersJSON { queryItems.append(<span class="hljs-type"><span class="hljs-type">URLQueryItem</span></span>(name: key, value: value <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">String</span></span>)) } urlComponents.queryItems = queryItems } <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> url = urlComponents.url <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> urlRequest = <span class="hljs-type"><span class="hljs-type">URLRequest</span></span>(url: url) urlRequest.httpMethod = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.httpMethod.rawValue urlRequest.allHTTPHeaderFields = headerFields <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> body = bodyString { urlRequest.httpBody = body.data(using: .utf8) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> urlRequest } }</code> </pre></li><li>  The sender of the request, which will be described later </li><li>  Response handler <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Result</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">E</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Value</span></span>(<span class="hljs-type"><span class="hljs-type">T</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Error</span></span>(<span class="hljs-type"><span class="hljs-type">E</span></span>) } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ResponseHandler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">ResultType</span></span> <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">ErrorType</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleResponse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> response: ResponseRepresentable, completion: </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(Result&lt;ResultType, ErrorType&gt;)</span></span></span></span></span></span> -&gt; ()) }</code> </pre></li><li>  The model in which we want to convert the answer <br>  This layer is built taking into account the excellent opportunity in Swift 4, which provided us with a protocol like Decodable, with the implementation of which your model will independently (almost) be created from the answer that came. <br></li></ul><br>  The sender of the request needs: <br><br><ul><li>  Request Provider <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RequestPreparator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepareRequest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> request: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">inout</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HTTPRequestRepresentable)</span></span></span></span> }</code> </pre></li></ul><br>  The response handler in turn needs: <br><br><ul><li>  Response Validator (checks response to success) <br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SuccessResponseChecker</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isSuccessResponse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> response: ResponseRepresentable)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> }</code> </pre></li><li>  Handler for failed response <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ErrorHandler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> errorCodeHandler: <span class="hljs-type"><span class="hljs-type">ErrorCodeHandler</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> error: ErrorRepresentable)</span></span></span></span> }</code> </pre></li><li>  The response converter to the model <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DecodingProcessor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">DecodingResult</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decodeFrom</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> data: Data)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">DecodingResult</span></span> }</code> </pre></li></ul><br><br>  Now about the sender of the request.  In our case, they will be the service to which the request is transmitted, it is the responsibility to send it and then transfer the response to the response processor. <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">ResultType</span></span>: <span class="hljs-type"><span class="hljs-type">Decodable</span></span> <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">ErrorType</span></span>: <span class="hljs-type"><span class="hljs-type">ErrorRepresentable</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typealias</span></span> <span class="hljs-type"><span class="hljs-type">SuccessHandlerBlock</span></span> = (<span class="hljs-type"><span class="hljs-type">ResultType</span></span>) -&gt; () <span class="hljs-keyword"><span class="hljs-keyword">typealias</span></span> <span class="hljs-type"><span class="hljs-type">FailureHandlerBlock</span></span> = (<span class="hljs-type"><span class="hljs-type">ErrorType</span></span>) -&gt; () <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request: <span class="hljs-type"><span class="hljs-type">HTTPRequestRepresentable?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> responseHandler: <span class="hljs-type"><span class="hljs-type">HTTPResponseHandler</span></span>&lt;<span class="hljs-type"><span class="hljs-type">ResultType</span></span>, <span class="hljs-type"><span class="hljs-type">ErrorType</span></span>&gt;? { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendRequest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Self?</span></span> }</code> </pre><br>  We will return ourselves for the implementation of Method Chaining. <br><br>  As you can see, I just described the protocols by which the whole system will communicate with objects within the system.  This enables us to control any stage we need by simply injecting our implementation of the protocol. <br><br>  It often happens that for more than one request the same code arrives at an error, but it means completely different for them.  When a service is one big object that processes everything itself, problems arise that lead to ‚Äúcrutches‚Äù and the inevitable growth of the class and the reduction of its beauty.  In this case, if you need to somehow respond to an error in your own way, you simply implement the error handler protocol and inject it into the response handler: you will not change anything else, you will expand the system and not modify it, which is good An example of an open-close principle from a system perspective.  All objects fulfill one of their roles: Single Responsibility Principle.  Implementation of the remaining principles, I think obviously. <br><br>  The idea is to implement the service to which we give the request, say what model we want to get in the end and what type of error we expect, give if we need our own handlers for the response, errors, decoding the response.  Then we just ask him to send a request and wait for an answer. <br><br>  Generic programming is perfect for achieving this goal.  We will generalize in order to obtain a service that works successfully with any model. <br><br>  So, this is how our service looks like, sending a request: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseService</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Decodable</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">E</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ErrorRepresentable</span></span></span><span class="hljs-class">&gt;: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">typealias</span></span> <span class="hljs-type"><span class="hljs-type">ResultType</span></span> = <span class="hljs-type"><span class="hljs-type">T</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typealias</span></span> <span class="hljs-type"><span class="hljs-type">ErrorType</span></span> = <span class="hljs-type"><span class="hljs-type">E</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> responseHandler: <span class="hljs-type"><span class="hljs-type">HTTPResponseHandler</span></span>&lt;<span class="hljs-type"><span class="hljs-type">T</span></span>, <span class="hljs-type"><span class="hljs-type">E</span></span>&gt;? = <span class="hljs-type"><span class="hljs-type">HTTPResponseHandler</span></span>&lt;<span class="hljs-type"><span class="hljs-type">T</span></span>, <span class="hljs-type"><span class="hljs-type">E</span></span>&gt;() <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request: <span class="hljs-type"><span class="hljs-type">HTTPRequestRepresentable?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> successHandler: <span class="hljs-type"><span class="hljs-type">SuccessHandlerBlock?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> failureHandler: <span class="hljs-type"><span class="hljs-type">FailureHandlerBlock?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> noneHandler: (() -&gt; ())? <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> requestPreparator: <span class="hljs-type"><span class="hljs-type">RequestPreparator?</span></span> = <span class="hljs-type"><span class="hljs-type">BaseRequestPreparator</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> session: <span class="hljs-type"><span class="hljs-type">URLSession</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> session = <span class="hljs-type"><span class="hljs-type">URLSession</span></span>(configuration: <span class="hljs-type"><span class="hljs-type">URLSessionConfiguration</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>, delegate: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, delegateQueue: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> session } <span class="hljs-meta"><span class="hljs-meta">@discardableResult</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendRequest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">BaseService</span></span>&lt;<span class="hljs-type"><span class="hljs-type">T</span></span>, <span class="hljs-type"><span class="hljs-type">E</span></span>&gt;? { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request = request <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } requestPreparator?.prepareRequest(&amp;request) <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> urlRequest = request.urlRequest() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } session.dataTask(with: urlRequest) { [<span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] (data, response, error) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> response = <span class="hljs-type"><span class="hljs-type">BaseResponse</span></span>(data: data, response: response, error: error) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>?.responseHandler?.handleResponse(response, completion: { [<span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] (result) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> .<span class="hljs-type"><span class="hljs-type">Value</span></span>(model): <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>?.processSuccess(model) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> .<span class="hljs-type"><span class="hljs-type">Error</span></span>(error): <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>?.processError(error) } }) }.resume() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> } <span class="hljs-meta"><span class="hljs-meta">@discardableResult</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSucces</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> success: @escaping SuccessHandlerBlock)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">BaseService</span></span>&lt;<span class="hljs-type"><span class="hljs-type">T</span></span>, <span class="hljs-type"><span class="hljs-type">E</span></span>&gt; { successHandler = success <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> } <span class="hljs-meta"><span class="hljs-meta">@discardableResult</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onFailure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> failure: @escaping FailureHandlerBlock)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">BaseService</span></span>&lt;<span class="hljs-type"><span class="hljs-type">T</span></span>, <span class="hljs-type"><span class="hljs-type">E</span></span>&gt; { failureHandler = failure <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processSuccess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> model: T)</span></span></span></span> { successHandler?(model) successHandler = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> error: E)</span></span></span></span> { failureHandler?(error) failureHandler = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } }</code> </pre><br>  As you can see, all he does is to prepare the request, send it using the Apple framework and send the response to the processing to the response processor. <br><br>  As you understand, the parameter of the generalized class T is the type of the final model, and E is the type of error.  Knowledge of these types is more needed by the response handler, take a look at it: <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTTPResponseHandler</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Decodable</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">E</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ErrorRepresentable</span></span></span><span class="hljs-class">&gt;: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ResponseHandler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">typealias</span></span> <span class="hljs-type"><span class="hljs-type">ResultType</span></span> = <span class="hljs-type"><span class="hljs-type">T</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typealias</span></span> <span class="hljs-type"><span class="hljs-type">ErrorType</span></span> = <span class="hljs-type"><span class="hljs-type">E</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isResponseRepresentSimpleType: <span class="hljs-type"><span class="hljs-type">Bool</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">T</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> == <span class="hljs-type"><span class="hljs-type">Int</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> || <span class="hljs-type"><span class="hljs-type">T</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> == <span class="hljs-type"><span class="hljs-type">String</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> || <span class="hljs-type"><span class="hljs-type">T</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> == <span class="hljs-type"><span class="hljs-type">Double</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> || <span class="hljs-type"><span class="hljs-type">T</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> == <span class="hljs-type"><span class="hljs-type">Float</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> errorHandler: <span class="hljs-type"><span class="hljs-type">ErrorHandler</span></span> = <span class="hljs-type"><span class="hljs-type">BaseErrorHandler</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> successResponseChecker: <span class="hljs-type"><span class="hljs-type">SuccessResponseChecker</span></span> = <span class="hljs-type"><span class="hljs-type">BaseSuccessResponseChecker</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> decodingProcessor = <span class="hljs-type"><span class="hljs-type">ModelDecodingProcessor</span></span>&lt;<span class="hljs-type"><span class="hljs-type">T</span></span>&gt;() <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> nestedModelGetter: <span class="hljs-type"><span class="hljs-type">NestedModelGetter?</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleResponse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> response: ResponseRepresentable, completion: </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(Result&lt;T, E&gt;)</span></span></span></span></span></span> -&gt; ()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> successResponseChecker.isSuccessResponse(response) { processSuccessResponse(response, completion: completion) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { processFailureResponse(response, completion: completion) } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processSuccessResponse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> response: ResponseRepresentable, completion: </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(Result&lt;T, E&gt;)</span></span></span></span></span></span> -&gt; ()) { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> data = response.data <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-comment"><span class="hljs-comment">//      ,       guard let result = try? decodingProcessor.decodeFrom(data) else { completion(Result.Error(E(ProcessingErrorType.modelProcessingError))) return } completion(.Value(result)) } private func simpleTypeUsingNestedModelGetter(from data: Data) -&gt; T? { let getter = nestedModelGetter! guard let escapedModelJSON = try? getter.getFrom(data) else { return nil } guard let result = escapedModelJSON[getter.escapedModelKey] as? T else { return nil } return result } private func processFailureResponse(_ response: ResponseRepresentable, completion: (Result&lt;T, E&gt;) -&gt; ()) { let error = E(response) completion(.Error(error)) errorHandler.handleError(error) } }</span></span></code> </pre><br>  I deliberately deleted some lines so as not to distract from the main implementation.  What do these deleted lines do?  I implemented the ability to extract a nested model, if the rest of the answer you do not need.  This happens, for example, when you request the wall of the VC and it returns something like: <br><br><pre> <code class="hljs json">[<span class="hljs-string"><span class="hljs-string">"response"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"items"</span></span>: [{<span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"text"</span></span>: <span class="hljs-string"><span class="hljs-string">"some"</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">"text"</span></span>: <span class="hljs-string"><span class="hljs-string">"awesome"</span></span>}], <span class="hljs-attr"><span class="hljs-attr">"count"</span></span>: <span class="hljs-number"><span class="hljs-number">231</span></span> }]</code> </pre><br>  and you only need items, in which case you can give the NestedModelGetter response handler, which has keyPath in the form of ‚Äúresponse.items‚Äù, and it will pull out your model for you.  Also in my implementation, you can get count, that is, a primitive type, for which you must of course give an object that data converts to this type. <br><br>  The whole project is available below the link, where you can see everything. <br><br>  It also shows that the response handler has a validator of success, and in the case of an unsuccessful response, we give the answer to the error handler. <br><br>  I will give an example of a post wall model so that it is clear how it allows itself to be assembled from the answer: <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WallItem</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Decodable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> id: <span class="hljs-type"><span class="hljs-type">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> text: <span class="hljs-type"><span class="hljs-type">String</span></span> }</code> </pre><br>  Models simply implement the Decodable protocol, and, of course, if the keys in JSON do not match the model names, you must also add CodingKeys to the model.  All of this can be found in the Apple documentation. <br><br>  I will also give an example of a validator validator for the VK API: <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VKAPISuccessChecker</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SuccessResponseChecker</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> jsonSerializer = <span class="hljs-type"><span class="hljs-type">JSONSerializer</span></span>() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isSuccessResponse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> response: ResponseRepresentable)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> httpResponse = response.response <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">HTTPURLResponse</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> isSuccesAccordingToStatusCode = <span class="hljs-type"><span class="hljs-type">Range</span></span>(uncheckedBounds: (<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">300</span></span>)).<span class="hljs-built_in"><span class="hljs-built_in">contains</span></span>(httpResponse.statusCode) <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> data = response.data <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> json = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>? jsonSerializer.serialize(data) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> isSuccesAccordingToStatusCode &amp;&amp; !json.keys.<span class="hljs-built_in"><span class="hljs-built_in">contains</span></span>(<span class="hljs-string"><span class="hljs-string">"error"</span></span>) } }</code> </pre><br>  The process of assembling a service for querying a VK wall is as follows: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> service = <span class="hljs-type"><span class="hljs-type">BaseService</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Wall</span></span>, <span class="hljs-type"><span class="hljs-type">VKAPIError</span></span>&gt;() service.request = <span class="hljs-type"><span class="hljs-type">GETWallRequest</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> responseHandler = <span class="hljs-type"><span class="hljs-type">HTTPResponseHandler</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Wall</span></span>, <span class="hljs-type"><span class="hljs-type">VKAPIError</span></span>&gt;() responseHandler.nestedModelGetter = <span class="hljs-type"><span class="hljs-type">ResponseModelGetter</span></span>.wallResponse responseHandler.successResponseChecker = <span class="hljs-type"><span class="hljs-type">VKAPISuccessChecker</span></span>() service.responseHandler = responseHandler <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> service</code> </pre><br><br>  A bit of error.  All types of errors implement the protocol: <br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ErrorRepresentable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> message: <span class="hljs-type"><span class="hljs-type">String?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> errorCode: <span class="hljs-type"><span class="hljs-type">Int?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> type: <span class="hljs-type"><span class="hljs-type">ErrorType</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(<span class="hljs-number"><span class="hljs-number">_</span></span> type: <span class="hljs-type"><span class="hljs-type">ErrorType</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(<span class="hljs-number"><span class="hljs-number">_</span></span> response: <span class="hljs-type"><span class="hljs-type">ResponseRepresentable</span></span>) } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ErrorType</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rawValue: <span class="hljs-type"><span class="hljs-type">String</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> } }</code> </pre><br><br>  ErrorType implement my enums.  Let's look at the structure of the error VK: <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VKAPIErrorType</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ErrorType</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> invalidAccessToken <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> unknownError } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VKAPIError</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ErrorRepresentable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> errorCode: <span class="hljs-type"><span class="hljs-type">Int?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> message: <span class="hljs-type"><span class="hljs-type">String?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> type: <span class="hljs-type"><span class="hljs-type">ErrorType</span></span> = <span class="hljs-type"><span class="hljs-type">VKAPIErrorType</span></span>.unknownError <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(<span class="hljs-number"><span class="hljs-number">_</span></span> type: <span class="hljs-type"><span class="hljs-type">ErrorType</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.type = type } <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(<span class="hljs-number"><span class="hljs-number">_</span></span> response: <span class="hljs-type"><span class="hljs-type">ResponseRepresentable</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> data = response.data <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> jsonSerializer = <span class="hljs-type"><span class="hljs-type">JSONSerializer</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> dataJSON = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>? jsonSerializer.serialize(data), <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> errorJSON = dataJSON[<span class="hljs-string"><span class="hljs-string">"error"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">JSON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } errorCode = errorJSON[<span class="hljs-string"><span class="hljs-string">"error_code"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">Int</span></span> message = errorJSON[<span class="hljs-string"><span class="hljs-string">"error_msg"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> code = errorCode <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> code { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>: type = <span class="hljs-type"><span class="hljs-type">VKAPIErrorType</span></span>.invalidAccessToken <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: type = <span class="hljs-type"><span class="hljs-type">VKAPIErrorType</span></span>.unknownError } } }</code> </pre><br><br>  I think no adequate developer would like to register a service build in each controller.  Me too, so let's wrap up the build process in Builder: <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">APIBuilder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">ErrorType</span></span>: <span class="hljs-type"><span class="hljs-type">ErrorRepresentable</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildAPI</span></span></span><span class="hljs-function">&lt;T: Decodable&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> responseType: T.</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">, request: HTTPRequestRepresentable?, decodingProcessor: ModelDecodingProcessor&lt;T&gt;?, nestedModelGetter: NestedModelGetter? )</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">BaseService</span></span>&lt;<span class="hljs-type"><span class="hljs-type">T</span></span>, <span class="hljs-type"><span class="hljs-type">ErrorType</span></span>&gt; }</code> </pre><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VKAPIBuilder</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">APIBuilder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">typealias</span></span> <span class="hljs-type"><span class="hljs-type">ErrorType</span></span> = <span class="hljs-type"><span class="hljs-type">VKAPIError</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildAPI</span></span></span><span class="hljs-function">&lt;T: Decodable&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> responseType: T.</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">, request: HTTPRequestRepresentable? = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">nil</span></span></span></span><span class="hljs-function"><span class="hljs-params">, decodingProcessor: ModelDecodingProcessor&lt;T&gt;? = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">nil</span></span></span></span><span class="hljs-function"><span class="hljs-params">, nestedModelGetter: NestedModelGetter? = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">nil</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">BaseService</span></span>&lt;<span class="hljs-type"><span class="hljs-type">T</span></span>, <span class="hljs-type"><span class="hljs-type">VKAPIError</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> service = <span class="hljs-type"><span class="hljs-type">BaseService</span></span>&lt;<span class="hljs-type"><span class="hljs-type">T</span></span>, <span class="hljs-type"><span class="hljs-type">VKAPIError</span></span>&gt;() service.request = request <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> responseHandler = <span class="hljs-type"><span class="hljs-type">HTTPResponseHandler</span></span>&lt;<span class="hljs-type"><span class="hljs-type">T</span></span>, <span class="hljs-type"><span class="hljs-type">VKAPIError</span></span>&gt;() responseHandler.nestedModelGetter = nestedModelGetter responseHandler.successResponseChecker = <span class="hljs-type"><span class="hljs-type">VKAPISuccessChecker</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> decodingProcessor = decodingProcessor { responseHandler.decodingProcessor = decodingProcessor } service.responseHandler = responseHandler <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> service } }</code> </pre><br><br>  Now we wrap it all in a separate object that will implement the following protocols: <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WallGettable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getWall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(completion: @escaping </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(Wall)</span></span></span></span></span></span> -&gt; ()) } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WallPostable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postWall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with message: String)</span></span></span></span> } <span class="hljs-keyword"><span class="hljs-keyword">typealias</span></span> <span class="hljs-type"><span class="hljs-type">WallAPI</span></span> = <span class="hljs-type"><span class="hljs-type">WallGettable</span></span> &amp; <span class="hljs-type"><span class="hljs-type">WallPostable</span></span></code> </pre><br>  But its implementation: <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BasicWallAPI</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WallAPI</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> getWallService: <span class="hljs-type"><span class="hljs-type">BaseService</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Wall</span></span>, <span class="hljs-type"><span class="hljs-type">VKAPIError</span></span>&gt; = { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">VKAPIBuilder</span></span>().buildAPI(<span class="hljs-type"><span class="hljs-type">Wall</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, nestedModelGetter: <span class="hljs-type"><span class="hljs-type">ResponseModelGetter</span></span>.wallResponse) }() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> postService: <span class="hljs-type"><span class="hljs-type">BaseService</span></span>&lt;[<span class="hljs-type"><span class="hljs-type">String</span></span>: [<span class="hljs-type"><span class="hljs-type">String</span></span>: <span class="hljs-type"><span class="hljs-type">Int</span></span>]], <span class="hljs-type"><span class="hljs-type">VKAPIError</span></span>&gt; = { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">VKAPIBuilder</span></span>().buildAPI([<span class="hljs-type"><span class="hljs-type">String</span></span>: [<span class="hljs-type"><span class="hljs-type">String</span></span>: <span class="hljs-type"><span class="hljs-type">Int</span></span>]].<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) }() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getWall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(fromOwnerWith id: String, completion: @escaping </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(Wall)</span></span></span></span></span></span> -&gt; ()) { getWallService.request = <span class="hljs-type"><span class="hljs-type">WallRouter</span></span>.<span class="hljs-type"><span class="hljs-type">GET</span></span>(id, <span class="hljs-built_in"><span class="hljs-built_in">count</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>) getWallService.sendRequest()?.onSucces({ (wall) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> completion(wall) }) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postWall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with message: String)</span></span></span></span> { postService.request = <span class="hljs-type"><span class="hljs-type">WallRouter</span></span>.<span class="hljs-type"><span class="hljs-type">POST</span></span>(message: message) postService.sendRequest() } }</code> </pre><br><br>  In my case, requests are structures of the type: <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WallRouter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GET</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTTPGETRequest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> path: <span class="hljs-type"><span class="hljs-type">String</span></span> = <span class="hljs-string"><span class="hljs-string">"https://api.vk.com/method/wall.get"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parameters: <span class="hljs-type"><span class="hljs-type">JSON?</span></span> = [:] <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> headerFields: [<span class="hljs-type"><span class="hljs-type">String</span></span>: <span class="hljs-type"><span class="hljs-type">String</span></span>]? <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(<span class="hljs-number"><span class="hljs-number">_</span></span> ownerID: <span class="hljs-type"><span class="hljs-type">String</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">count</span></span>: <span class="hljs-type"><span class="hljs-type">Int</span></span>) { parameters?[<span class="hljs-string"><span class="hljs-string">"owner_id"</span></span>] = ownerID parameters?[<span class="hljs-string"><span class="hljs-string">"count"</span></span>] = <span class="hljs-built_in"><span class="hljs-built_in">count</span></span> } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">POST</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTTPPOSTRequest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> path: <span class="hljs-type"><span class="hljs-type">String</span></span> = <span class="hljs-string"><span class="hljs-string">"https://api.vk.com/method/wall.post"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parameters: <span class="hljs-type"><span class="hljs-type">JSON?</span></span> = [:] <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> headerFields: [<span class="hljs-type"><span class="hljs-type">String</span></span>: <span class="hljs-type"><span class="hljs-type">String</span></span>]? <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bodyString: <span class="hljs-type"><span class="hljs-type">String?</span></span> = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(message: <span class="hljs-type"><span class="hljs-type">String</span></span>) { parameters?[<span class="hljs-string"><span class="hljs-string">"message"</span></span>] = message } } }</code> </pre><br><br>  Here we come to the result, which was shown at the beginning of the article.  A pleasant plus is the implementation of the Separation of Concerns principle, that is, the controller will be able to call only those methods that it needs and will not know about anything else. <br><br><h3>  Usage example </h3><br>  Let's also implement a method for getting the number of records on the wall, that is, the values ‚Äã‚Äãof the count field. <br><br>  Expand the WallGettable protocol: <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WallGettable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getWall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(completion: @escaping </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(Wall)</span></span></span></span></span></span> -&gt; ()) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getWallItemsCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(completion: @escaping </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(Int)</span></span></span></span></span></span> -&gt; ()) }</code> </pre><br><br>  We implement a new method in our structure: <br><pre> <code class="hljs swift"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> getWallItemsCountService: <span class="hljs-type"><span class="hljs-type">BaseService</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Int</span></span>, <span class="hljs-type"><span class="hljs-type">VKAPIError</span></span>&gt; = { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">VKAPIBuilder</span></span>().buildAPI(<span class="hljs-type"><span class="hljs-type">Int</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, decodingProcessor: <span class="hljs-type"><span class="hljs-type">IntDecodingProcessor</span></span>(), nestedModelGetter: <span class="hljs-type"><span class="hljs-type">ResponseModelGetter</span></span>.wallResponseCount) }() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getWallItemsCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(fromOwnerWith id: String, completion: @escaping </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(Int)</span></span></span></span></span></span> -&gt; ()) { getWallItemsCountService.request = <span class="hljs-type"><span class="hljs-type">WallRouter</span></span>.<span class="hljs-type"><span class="hljs-type">GET</span></span>(id, <span class="hljs-built_in"><span class="hljs-built_in">count</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>) getWallItemsCountService.sendRequest()?.onSucces({ (<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> completion(<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>) }) }</code> </pre><br>  What is ResponseModelGetter? <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ResponseModelGetter</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NestedModelGetter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> wallResponse = <span class="hljs-string"><span class="hljs-string">"response"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> wallResponseItems = <span class="hljs-string"><span class="hljs-string">"response.items"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> wallResponseCount = <span class="hljs-string"><span class="hljs-string">"response.count"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> wallResponseFirstText = <span class="hljs-string"><span class="hljs-string">"response.items.text"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyPath: <span class="hljs-type"><span class="hljs-type">String</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.rawValue } }</code> </pre><br>  Call the new method: <br><br><pre> <code class="hljs swift"> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewDidLoad() getWallAPI.getWallItemsCount(fromOwnerWith: <span class="hljs-string"><span class="hljs-string">"&lt;some id&gt;"</span></span>) { (<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Wall items count is \(count)"</span></span>) } }</code> </pre><br>  Get the console output: <br><br><pre> <code class="hljs swift"><span class="hljs-type"><span class="hljs-type">Wall</span></span> items <span class="hljs-built_in"><span class="hljs-built_in">count</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">1650</span></span></code> </pre> <br>  Of course, it is not necessary to wrap the API with all this logic, but it is convenient, beautiful, and correct (the main thing is not to dump all API methods into one class).  When testing a layer on the VC API, do not forget to insert your access_token (where you will find it to register in ReqestPreparators). <br><br>  Details of the implementation you can see in the project, available by <a href="https://github.com/IsaAliev/FlexibleNetworkLayer">reference</a> . <br><br>  If you like the implementation, do not take the stars for it. </div><p>Source: <a href="https://habr.com/ru/post/349792/">https://habr.com/ru/post/349792/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../349780/index.html">UX Marathon with Google Russia</a></li>
<li><a href="../349784/index.html">How to find a company sponsor visa in the United States. Tips and tricks</a></li>
<li><a href="../349786/index.html">A brief history of Rust: from hobby to the most popular PL according to StackOverflow</a></li>
<li><a href="../349788/index.html">Hypervisors. What is it and how does a virtual server work?</a></li>
<li><a href="../349790/index.html">Announcement Dart 2.0: Optimized for customer development</a></li>
<li><a href="../349794/index.html">Magento Meetup Kharkov - Videos and Presentations</a></li>
<li><a href="../349796/index.html">Why I don't like DevOps (and modern software)</a></li>
<li><a href="../349798/index.html">Automate the removal of forgotten transactions</a></li>
<li><a href="../349800/index.html">Depth training with reinforcements does not work yet</a></li>
<li><a href="../349802/index.html">Multi-stage (multi-stage builds) builds in Docker</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>