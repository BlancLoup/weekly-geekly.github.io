<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Failover: perfectionism is ruining us and ... laziness</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In summer, consumer activity and the intensity of changes in the infrastructure of web projects traditionally decrease, Captain Obvious tells us. Just...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Failover: perfectionism is ruining us and ... laziness</h1><div class="post__text post__text-html js-mediator-article">  <i>In summer, consumer activity and the intensity of changes in the infrastructure of web projects traditionally decrease, Captain Obvious tells us.</i>  <i>Just because even IT people happen to go on vacation.</i>  <i>And CTO, too.</i>  <i>It is all the more difficult for those who remain in office, but this is not about it now: perhaps, this is why summer is the best period in which to rush to think about the existing reservation scheme and draw up a plan for its improvement.</i>  <i>And in this, you will benefit from the experience of Egor Andreev from <a href="https://admindivision.ru/">AdminDivision</a> , which he spoke about at the <a href="https://uptime.community/ru/uptimeday-4">Uptime day</a> conference.</i> <br><br>  During the construction of reserve sites, when reserving there are several traps that can be accessed.  And you can‚Äôt be caught in them at all.  And perfectionism and ... laziness ruin us in all this, as in many other things.  We are trying to make everything, everything, everything is perfect, but we don‚Äôt need to do it perfectly!  It is necessary to do only certain things, but to make them right, to complete it so that they work normally. <br><br>  Failover - this is not some kind of fun fun thing "so it was";  this is a thing that should do exactly one thing - reduce downtime so that the service, company, loses less money.  And in all reservation methods, I suggest thinking in the following context: where is the money? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/jz/ia/-7/jzia-79mf2emmdcqetbiatuuqfo.jpeg"><br><a name="habracut"></a><br>  <b>The first trap</b> : when we build large reliable systems and are engaged in redundancy - we reduce the number of accidents.  This is a terrible delusion.  When we do backup, we most likely increase the number of accidents.  And if we do everything right, then together we will reduce the downtime.  Accidents will be more, but they will occur at lower costs.  What is a reservation?  - this is a complication of the system.  Any complication is bad: we have more cogs, more gears, in a word, more elements - and, therefore, a higher chance of breaking.  And they really break.  And they will break more often.  A simple example: let's say we have a certain site, with PHP, MySQL.  And it urgently needs to reserve. <br><br>  Shtosh (c) We take the second platform, build an identical system ... The complexity becomes twice as large - we have two entities.  And we also roll in from above a certain logic of data transfer from one site to another - that is, data replication, static copying and so on.  So, the replication logic is usually very complicated, and therefore, the total complexity of the system may not be 2, but 3, 5, 10 times more. <br><br>  <b>The second trap</b> : when we build really big complex systems, we fantasize what we want to get in the end.  Voila: we want to get a super-reliable system that works without any downtime, switches for half a second (or even better instantly), and we begin to make dreams come true.  But there is also a nuance: the smaller the desired switching time, the more complex the logic of the system.  The more difficult we have to do this logic, the more often the system will break.  And you can get into a very unpleasant situation: we are trying to reduce downtime by all means, but in fact we are complicating everything, and when something goes wrong, there will be more downtime.  Here you often catch yourself thinking: here ... it would be better not to reserve.  It would be better if it worked alone and with understandable downtime. <br><br>  How can you deal with this?  We must stop lying to ourselves, stop flattering ourselves that we are going to build a spacecraft here, but to adequately understand how much the project can lie.  And under this maximum time we will choose which, in fact, methods will increase the reliability of our system. <br><br><img src="https://habrastorage.org/webt/iv/s3/fl/ivs3flng1tmpqnfqym23_-dhjms.jpeg"><br><br>  It's time for ‚Äústories from g‚Äù ... from life, of course. <br><br><h4>  Example number one </h4><br>  Imagine a business site for the pipe-rolling plant No. 1 of N. City. It is written in huge letters - TUBE-ROLLING PLANT No. 1.  Just below is the slogan: ‚ÄúOur pipes are the most round pipes in N‚Äù.  And below the phone number of the CEO and his name.  We understand that you need to reserve - this is a very important thing!  We begin to understand what it consists of.  Html-statics - that is, a couple of pictures, where the general, in fact, at the table in the bathhouse, with their partner, are discussing some kind of regular deal.  We start thinking about downtime.  It comes to mind: it takes five minutes to lie there, no more.  And then the question is: how much sales have there been from this site?  How much?  What does ‚Äúzero‚Äù mean?  And that is what it means: because over the past year, all four deals were made by the general at the same table, with the same people with whom they go to the bathhouse, sit at the table.  And we understand that even if the site lays down the day - nothing terrible will happen. <br><br>  Based on the introductory, there is a day to raise this story.  We start thinking about the redundancy scheme.  And we choose the most ideal reservation scheme for this example: we do not use redundancy.  This whole thing is raised by any admin in half an hour with smoke breaks.  Put the web server, put the files - everything.  It will work.  There is no need to follow anything, nothing needs to be given special attention.  That is, the conclusion from example number one is pretty obvious: services that are not needed to be backed up are not needed. <br><br><img src="https://habrastorage.org/webt/em/ho/dj/emhodjmsvznkfjdzlc2chs4goow.jpeg"><br><br><h4>  Example number two </h4><br>  Company blog: specially trained write news there, so we took part in such an exhibition, but we released another new product and so on.  Let's say this is standard PHP with WordPress, a small database and a little bit of static.  Of course, it comes to my mind again that in no case can one lie - ‚Äúno more than five minutes!‚Äù, That is all.  But let's think further.  What is this blog doing?  They come from Yandex, from Google for some requests, by organics.  Great.  And are sales somehow related to him?  Insight: not really.  Advertising traffic goes to the main site, which is on another machine.  We are starting to think about the backup scheme of a blozhek.  In a good way, it needs to be raised in a couple of hours, and it would be nice to prepare for this.  It would be reasonable to take a machine in another data center, roll in the environment, that is, the web server, PHP, WordPress, MySQL, and leave it lying dimmed.  At the moment when we understand that everything is broken, you need to do two things - roll out a mysql dump to 50 meters, it will fly there in a minute, and roll out some number of pictures from the backup.  This, too, there is not God knows how much.  Thus, in half an hour the whole thing rises.  No replication, or God forgive me, automatic failover.  Conclusion: the fact that we can quickly roll out of the backup is not necessary to reserve. <br><br><img src="https://habrastorage.org/webt/hd/h-/s6/hdh-s6csoog6vc1peorwrxkwaw0.jpeg"><br><br><h4>  Example number three, more difficult </h4><br>  Online store.  PhP with an open heart slightly sawed, mysql with a solid base.  Quite a lot of static (because the online store has beautiful HD pictures and all that), Redis for the session and Elasticsearch for the search.  We start thinking about downtime.  And here, of course, it is obvious that the day the online store can not lie painlessly.  After all, the longer he lies, the more money we lose.  It is worth accelerating.  How much?  I suppose if we lie down for an hour, then no one will go mad.  Yes, we will lose something, but we will begin to be zealous - it will only get worse.  We determine the scheme of idle time allowed per hour. <br><br>  How can you reserve all this?  The machine is needed in any case: an hour of time is quite a bit.  Mysql: replication is already needed here, live replication, because in an hour 100 GB in a dump, most likely, it will not merge.  Statics, pictures: again, in an hour 500 GB may not have time to merge.  So, it is better to copy the pictures immediately.  Redis: here is more interesting.  In Redis, the sessions lie - we just cannot take it and bury it.  Because it will not be very good: all users will be logged out, baskets cleared and so on.  People will be forced to re-enter their username and password, and many people can split off and the purchase is not completed.  Again, the conversion will fall.  On the other hand, Redis is straightforward one-to-one, with the latest logged in users, probably also not needed.  And a good compromise is to take Redis and restore it from a backup, yesterday, or, if you do it every hour, it is an hour ago.  The blessing of restoring it from backup is copying a single file.  And the most interesting story is Elasticsearch.  Has anyone ever raised MySQL replication?  Has anyone ever raised Elasticsearch replication?  And who after she worked normally?  What I need: we see in our system some entity.  She seems kind of useful - but she is complicated. <br>  Difficult in the sense that our fellow engineers have no experience with it.  Or have a negative experience.  Or we understand that while this is a fairly new technology with nuances or dampness.  We think ... Damn, elastic is also healthy, it is also a long time to restore it from the backup, what to do?  We understand that elastic in our case is used for searching.  And how does our online store sell?  We go to marketers, ask, where people come from.  They answer: "90% of Yandex Market come directly to the item card."  And either buy or not.  Consequently, the search needs 10% of users.  And to keep the replication of elastic, especially between different data centers in different zones, there are, indeed, many nuances.  Which exit?  We take elastic on a reserved site and do nothing with it.  If the matter drags on, then we will probably raise it sometime later, but this is not certain.  Actually, the conclusion is plus or minus the same: services that do not affect the money, we, again, do not reserve.  To make the scheme easier. <br><br><img src="https://habrastorage.org/webt/xo/eu/z8/xoeuz8bhw_hpg4lwinkn1zjorhy.jpeg"><br><br><h4>  Example number four, even harder </h4><br>  Integrator: selling flowers, calling a taxi, selling goods, in general, anything.  Serious thing that works 24/7 for a large number of users.  With a full-fledged interesting stack, where there are interesting bases, solutions, high load, and most importantly, it hurts him to lie for more than 5 minutes.  Not only and not so much because people will not buy, but because people will see that this thing does not work, will be upset and may not come at all for the second time. <br><br>  Okay.  Five minutes.  What are we going to do with it?  In this case, we are grown-up, with all the money we are building a real backup site, with replication of everything and everything, and maybe even automating the switching to this site to the maximum.  And in addition to this, you need to remember to do one important thing: actually, write the switching rules.  The rules, even if you have automated everything and everything, can be very simple.  From the series ‚Äúto launch such a scenario ansible‚Äù, ‚Äúto press such a daw in route 53‚Äù and so on - but it must be some exact list of actions. <br><br>  And everything seems to be clear.  Replication to switch is a trivial task, or it will switch itself.  Rewrite the domain name in dns - from the same series.  The trouble is that when a similar project falls, a panic begins, and even the strongest, bearded admins may be subject to it.  Without a clear instruction ‚Äúopen the terminal, go here, the address at our server is still like this‚Äù the period of 5 minutes allocated for resuscitation is difficult to sustain.  Well, plus, when we use these rules, it is easy to fix some changes in the infrastructure, for example, and change the rules accordingly. <br>  Well, if the backup system is very complicated and at some point we made a mistake, then we can lay down our backup site and, in addition, turn the data into a pumpkin at both sites - it will be completely sad. <br><br><img src="https://habrastorage.org/webt/xa/3t/zr/xa3tzr7mykypd7fsmkvtyumf1o4.jpeg"><br><br><h4>  Example number five, full hardcore </h4><br>  International service with hundreds of millions of users worldwide.  All time zones that only exist, highload at max speeds, cannot be laid at all.  A minute - and it will be sad.  What to do?  Reserve, again, in full.  They did everything that was mentioned in the previous example, and a little more.  Ideal world, and our infrastructure - it is in all notions of the IaaC devops.  That is, everything in general in git, and just press the button. <br><br>  What is missing?  One - the teachings.  Without them it is impossible.  It seems that everything is perfect here, everything is under control.  Press the button, everything happens.  Even if this is so - and we understand that this is not the case - our system interacts with some other systems.  For example, this is dns from route 53, s3-storage, integration with some api.  We will not be able to foresee everything in this speculative experiment.  And while we really do not pull the switch - do not know whether it will work or not. <br><br><img src="https://habrastorage.org/webt/6q/v-/jk/6qv-jkxmxhmvzrwuocwtx6gfhu8.jpeg"><br><br>  On this, probably, everything.  Do not be lazy and do not overdo it.  And may the uptime be with you! </div><p>Source: <a href="https://habr.com/ru/post/460611/">https://habr.com/ru/post/460611/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../4606/index.html">Mozilla started creating Firefox 3.0</a></li>
<li><a href="../46060/index.html">Netbook - the most popular gift for the New Year</a></li>
<li><a href="../460605/index.html">Auto Photo Studio, Part 1</a></li>
<li><a href="../460607/index.html">App Store with hacking tools from Offensive Security on Android</a></li>
<li><a href="../46061/index.html">Terrorism can stop the growth of the Indian economy</a></li>
<li><a href="../460615/index.html">In the wake of Industrial Ninja: how PLCs were cracked at Positive Hack Days 9</a></li>
<li><a href="../46062/index.html">Startup: "Startup Cemetery"</a></li>
<li><a href="../460621/index.html">Tic Tac Toe, Part 4: Interacting with the Flask backend using HTTP</a></li>
<li><a href="../460623/index.html">About torture of Julian Assange</a></li>
<li><a href="../460629/index.html">The probability that 2 miners have the same world</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>