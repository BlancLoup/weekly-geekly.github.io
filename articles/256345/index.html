<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Control robots created with LEGO¬Æ Mindstorms¬Æ NXT Brick using the Wolfram Language (Mathematica)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Download the article as a Mathematica document (NB) , CDF file or PDF . 

 NXT is a general purpose processor that is used to control motors and senso...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Control robots created with LEGO¬Æ Mindstorms¬Æ NXT Brick using the Wolfram Language (Mathematica)</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/361/685/348/361685348f8340c9947889ec491e9568.png"></div><br>  <i>Download the article as a <a href="">Mathematica document (NB)</a> , <a href="">CDF file</a> or <a href="http://www.mathematica-journal.com/data/uploads/2013/03/Cousineau.pdf">PDF</a> .</i> <br><br>  NXT is a general purpose processor that is used to control motors and sensors;  It is ideal for creating autonomous robots.  It can also communicate with more complex software on the computer via Bluetooth.  In this article, we will show how to properly interact with the NXT through the <a href="http://www.wolfram.com/language">Wolfram Language</a> ( <i><a href="http://www.wolfram.com/mathematica">Mathematica</a></i> ), sending the correct signals.  We will also introduce a package that manages all interactions between functions.  These functions can be used in conjunction with dynamic cells to display the status of the robot and control its motor. <br><a name="habracut"></a><br><h3>  Introduction </h3><br>  Robots are ideal targets for testing cognitive theories, such as learning, adaptation, and also for classifying environmental impacts.  A key element of most robots is the central processor, which receives media data through sensors and acts on the environment with the help of motors.  To this end, in 2006, LEGO introduced a new programmable designer - LEGO MINDSTORMS NXT.  This designer, equipped with four sensors and three motors, has 256 KB of flash memory for storing data.  It can run programs compiled specifically for this constructor (files with the .rxe extension compiled by LEGO LabVIEW or third-party compilers, such as NBC or NXC).  The versatility and low cost of this designer make it an ideal object for projects to develop robots. <br><br>  NXT is well suited for the development of autonomous robots, including intelligence.  You can also explore learning algorithms;  for example, you can find more optimal ways to solve the problem of finding a way out of the maze, rather than the usual trial and error method.  Finally, NXT can also be used to study social cognitive models in which multiple robots must interact in order to increase group survival. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This article shows how to control the designer via Bluetooth.  We will also introduce the <b>Math4NXT</b> package, which facilitates a number of tasks.  Used in conjunction with the built-in <b><a href="http://reference.wolfram.com/language/ref/Dynamic.html">Dynamic</a></b> function in <i>Mathematica</i> , the LEGO robot control becomes very simple. <br><br><h3>  Creating a communication line </h3><br>  The first time you run NXT, use Bluetooth on your computer to find it and create a connection.  As for the very first use, you will need to enter a password on the constructor (by default - ‚Äú1234 ‚Ä≥) and the computer.  Then you will need to select the ‚ÄúDev‚Äù service available on the constructor.  Thus, the COM port is allocated as a communication link between the computer and the designer.  The COM port name is set as a variable (for example, COM11), however, it remains constant for a specific computer-NXT pair (for more detailed instructions on pairing, see [1]).  Once you have specified a specific COM port, you will no longer need to repeat this process. <br><br>  The NXT designer has an operating system (firmware), which immediately processes requests received from the COM port.  He does this even if the program is currently running on the constructor.  These commands in the LEGO documentation [2] are called <i>direct</i> .  Direct commands include file operations, motor control, setting up sensors and reading data from them, interaction between different designers.  Commands are transmitted via the COM port by means of messages representing a sequence of bytes (numbers from 0 to 255).  Some commands imply a response from the constructor, which is also sent as a message.  Before each message, information is sent about the length of this message, to which 2 bytes are allocated.  Thus, the management of the NXT constructor is the sending of certain bytes in a certain order through the serial port. <br><br>  In order to use the serial COM port, you should use a package for <i>Mathematica</i> called SerialIO [3].  This package consists of two parts.  The first is an executable program designed for your computer and operating system.  SerialIO presents such programs for Linux, Windows (32-bit and 64-bit), as well as for OS X. The second part contains <i>Mathematica</i> functions that can be used in your project.  It includes the <b>SerialOpen</b> and <b>SerialClose commands</b> for opening and closing the communication channel on this COM port, and <b>SerialWrite</b> and <b>SerialRead</b> write or read data from the COM port.  The figure below shows the different levels through which information flows during communication between the NXT and the computer. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c5e/922/cd0/c5e922cd0f31b83df5919f879874a4a7.gif" width="580" height="343"><br>  <i>Figure 1. Software architecture communicating with the NXT and the computer.</i>  <i>The last three windows on the right represent Mathematica programs, and the other two are issued by the Math4NXT package, which will be discussed later.</i> <br><br>  Download the SerialIO package from the <a href="http://library.wolfram.com/">Wolfram Library Archive</a> and install it in the folder of your choice (best of all in AddOns <i>Mathematica</i> , which is in the ExtraPackages folder).  For more convenience, you can place your working folder at this address, as a result of which MathLink-compatible programs will be automatically saved there. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5b5/f8f/887/5b5f8f887ed04bbe2be61536b5ada73e.gif" width="580" height="30"><br><br>  Next, download the package via <a href="http://reference.wolfram.com/language/ref/Needs.html">Needs</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/720/7df/015/7207df0150eeb5f6208050d4f371fd82.gif" width="129" height="13"><br><br>  If the command is successful, you can see the SerialO process running on your computer in the background.  The following command opens the COM port and establishes a communication channel with the constructor (it must be enabled). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/312/7b3/78d/3127b378d05f5de061935cd8344898d0.gif" width="209" height="14"><br><br>  If you have a NXT constructor and you want to calculate the code cells that are presented in this article, then you need to select a cell while holding the Alt key, so all cells will be selected.  Next, from the <i>Mathematica</i> main menu, select Cell Cell Properties Evaluatable.  Without the NXT connected, executing these commands will return an error message and an uncalculated cell. <br><br>  To make sure the connection is open, look at the display on the constructor, which is in the upper left corner.  If you see <img src="https://habrastorage.org/getpro/habr/post_images/3aa/017/d86/3aa017d86927d1b4f6bb3921a7fe852d.gif" width="13" height="18">  &lt;, this means that the connection is not established.  BUT <img src="http://www.mathematica-journal.com/data/uploads/2013/03/Cousineau_1.gif" width="13" height="18">  &lt;&gt; means the connection is established.  The variable <b>mybrick</b> contains a data flow descriptor from the COM port and is used in all subsequent messages.  The COM port is closed using the following command. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4d7/327/481/4d7327481a39ecef80811ac99ab075f6.gif" width="144" height="14"><br><br>  Exiting <i>Mathematica</i> (or stopping the kernel) closes the COM port and terminates the SerialO process, which runs in the background. <br><br><h3>  Sending a message and receiving a reply </h3><br>  The SerialIO package was made to send text via the COM port (or individual characters / lines of text).  However, with regards to managing the NXT, it makes more sense to send the numbers directly.  Therefore, we need to convert the numbers to the corresponding characters in the ASCII code before we send them.  This is a bit inconvenient, and we will propose a more accurate solution later. <br><br>  The message always starts with a byte that indicates whether the NXT should respond to it.  It‚Äôs more convenient for anyone, but many commands sent to the constructor return only a status byte (0 - successful execution, otherwise - an error message).  In the case of a response message in the form of a status byte, the response is rather useless.  To request a response, the first byte must be 0;  128 means the NXT should not respond. <br><br>  The second byte of the message is always the command number.  All this is presented in the documentation of the LEGO Group [2].  Subsequent bytes depend on the command sent. <br><br>  For example, a request to NXT to play a sound is set by the direct PlayTone command.  The number of this command is 3. Then two parameters must be set: the tone frequency (a number from 200 to 14000) and the duration of the tones (in milliseconds, a number from 0 to 65535).  These two parameters are encoded as UWORD (unsigned word - WORD), that is, more than two bytes are allocated, the least significant byte is set first.  For convenience, we will write the conversion function <b>toUWORD</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/96e/29c/4f8/96e29c4f82598981269a62f821f70074.gif" width="400" height="14"><br><br>  Thus, a tone frequency of 480 Hz and a duration of two seconds correspond to the following sequence of bytes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c73/c8a/b32/c73c8ab326c7829d06b896b145c0976b.gif" width="93" height="29"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/46d/916/028/46d91602891b3f8ccf9ee90e03134466.gif" width="54" height="13"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/ad1/6c4/345/ad16c4345faae569843ee94ab16c8a1e.gif" width="54" height="13"><br><br>  The whole message would look like this. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d7d/5e7/44c/d7d5e744c788c373c19e25073c31f70e.gif" width="221" height="14"><br><br>  Before the message itself, its length must be indicated, which can be obtained by the following command. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c3f/f84/214/c3ff84214f972ee4e17f68295da6d7f6.gif" width="295" height="14"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/3bb/a0c/6dd/3bba0c6dd22660dbd02a77f88d69a4f4.gif" width="39" height="13"><br><br>  We combine the two parts to get the complete message and get a list of characters corresponding to their numbers (such characters may not be viewable on your computer) in this line of code. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/485/0b4/0aa/4850b40aa92e28747c4698abc22a3375.gif" width="483" height="14"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/d65/065/252/d6506525264f8efde31b1c3ca20e6c82.gif" width="126" height="13"><br><br>  Let's send these characters to the NXT designer one by one. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fab/3ff/188/fab3ff1888b123022c2547948aa07b19.gif" width="271" height="14"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/d65/065/252/d6506525264f8efde31b1c3ca20e6c82.gif" width="126" height="13"><br><br>  Now you can hear the beep.  Since we requested an answer (the first byte was zero), we need to read it. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4e2/bcd/1b7/4e2bcd1b7fb46bb07408e2b35c0357a9.gif" width="188" height="14"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/0c8/965/1c9/0c89651c96c1b9c0fb3095782a243535.gif" width="21" height="13"><br><br>  Again, the answer consists of text (the characters may not be viewable).  Let's convert them to a list of numbers. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b6a/1ce/3b4/b6a1ce3b46bc930b19c48a55d3a3f0f4.gif" width="158" height="14"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/3fc/c86/95e/3fcc8695e47ec0f22f69e0e93d466e62.gif" width="93" height="13"><br><br>  The bytes are returned in the following order: the length of the returned message, encoded in more than two bytes in UWORD (in this case, 3, 0 means the length of the message is 3 characters), the second byte indicates that this is a response message;  the third byte indicates the number of the command that issued the response (in this case, the Playtone command) and, finally, the status of the command (where 0 indicates success).  PlayTone does not return other information;  Some direct commands may return more complex messages. <br><br>  As an example, we send the GetBatteryLevel command.  This command is number 11 and does not require any parameters / additional information.  If a response is requested (but it is meaningless to send this command and not request an answer), it returns the command status (0 for success), followed by two bytes indicating the battery voltage on the NXT in millivolts.  To decipher the voltage, let's create another conversion function - <b>fromUWORD</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1e2/f85/750/1e2f8575003dea7a8a3e7926082b4185.gif" width="391" height="16"><br><br>  Let's collect the whole message, combine it with its length, convert it into a list of characters and send them. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fb3/b27/da1/fb3b27da19d58d33b2d17eb32c60e843.gif" width="490" height="62"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/18f/334/165/18f334165408530266d2ed6f6892bc5c.gif" width="61" height="13"><br><br>  Now let's read the answer and convert it to numbers. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/487/f49/b33/487f49b3365e022b59667e5e9c54a94b.gif" width="318" height="14"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/40b/af7/954/40baf7954624e1ccd3a1608a7eb71042.gif" width="158" height="13"><br><br>  The first two bytes indicate the length of the response (5 bytes);  2 and 11 show that this is a response to the GetBatteryLevel command;  0 indicates that the command was successful;  and finally, 247 and 27 show the battery voltage, which we convert to a number with the <b>fromUWORD</b> command described above. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/462/50f/2f8/46250f2f808357ab4b57bc3afc53b433.gif" width="126" height="13"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/d49/6b7/99d/d496b799d21a5c3bf2411deba342d8c8.gif" width="29" height="13"><br><br>  Thus, the batteries have a voltage of 7.16 volts, which is much lower than the expected 9 volts for fresh batteries. <br><br><h3>  <b>SerialWrite</b> override to send whole numbers or lists of them </h3><br>  Since it is more convenient to represent numbers, rather than characters, that are sent to the constructor, we expand the <b>SerialWrite</b> command contained in the SerialIO package to be able to send both individual integers from 0 to 255 (bytes) and their lists. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/198/525/fa2/198525fa25f6565ad81931bbb02dcb82.gif" width="468" height="142"><br><br>  With this extension, the entire message (which consists of bytes) can be transmitted by one call to <b>SerialWrite</b> .  For example, the following instructions reassemble the PlayTone team (this time without an answer). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f58/b31/4ac/f58b314accc5d4f4c41dd72fe5ed16b7.gif" width="443" height="77"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/f91/c65/27e/f91c6527e79f76c1d59d18e15dbc8ba4.gif" width="192" height="13"><br><br>  The entire message is sent by calling one command. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2f8/35c/75e/2f835c75e7551702dca633ea77008ac2.gif" width="213" height="14"><br><br><h3>  Direct commands represented in <b>Math4NXT</b> </h3><br>  The above shows how a command can be sent to the NXT constructor, and its response read.  Then, it‚Äôs just a question of assembling the message in the correct order and with the right information, and, if necessary, reading the answer and its interpretation.  For these purposes, the documentation provided by the LEGO Group (especially Appendix 2 in [2]) is fairly complete. <br><br>  For greater simplicity, we encoded all the direct commands in a package called <b>Math4NXT</b> .  You should first get the <b>Math4NXT</b> package.  Since it uses the SerialIO package in the background, also install it in the directory where <i>Mathematica</i> searches (for example, <i>FileNameJoin [{$ InstallationDirectory, "AddOns", "ExtraPackages", "SerialIO"}]</i> ).  Then load <b>Math4NXT</b> with the following command. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/764/8fa/772/7648fa77212d86f25c1efb574dcbfa6f.gif" width="580" height="14"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/2a5/6a0/69e/2a56a069e01c836561720963c995b33f.gif" width="539" height="45"><br><br>  Since we placed the <b>Math4NXT</b> package not in one of the folders <i>Mathematica</i> searches for, we need to set the path using the <b>Needs</b> command.  Then open the serial port (if it has not already been done), as shown earlier. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/312/7b3/78d/3127b378d05f5de061935cd8344898d0.gif" width="209" height="14"><br><br>  All direct commands begin with the letters <b>NXT</b> .  Therefore, the command to read the battery level in the package will be called <b>NXTGetBatteryLevel</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b53/69e/e3c/b5369ee3c945da74ee65ed5b429d83de.gif" width="142" height="14"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/4f7/4b7/adc/4f74b7adc484167fce16cde70599532a.gif" width="425" height="13"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/9ca/471/6f6/9ca4716f668506ec9019a96e8663e2f1.gif" width="232" height="14"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/ff6/d4b/279/ff6d4b2793126b9e3430ee37a185c173.gif" width="338" height="14"><br><br>  By default, the command returns a response using named strings (for example, <b>‚ÄúStatus‚Äù</b> ).  You can extract some of the information in the usual way. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/377/72c/123/37772c12322401014d5fbace71a7fa8a.gif" width="123" height="14"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/bf3/820/352/bf38203529d7409a9fd0e681fd6d8471.gif" width="29" height="13"><br><br>  This format can be changed, for example, to raw (that is, to output in bytes, as in the two previous sections), using the <b>ResultFormat</b> option. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e2e/cf5/75f/e2ecf575fb80645871f4d9c52b186d92.gif" width="331" height="14"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/530/512/d81/530512d810df381a66ceb010ee081172.gif" width="158" height="13"><br><br>  On the other hand, the transmitted and received bytes can be displayed in a separate window using the option <img src="https://habrastorage.org/getpro/habr/post_images/4db/5b4/715/4db5b47155cfba84791824e4cf1ed55e.gif" width="75" height="13">  . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0a0/e90/2ca/0a0e902ca18ef1b2ea070be3d5f7de06.gif" width="281" height="14"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/ff6/d4b/279/ff6d4b2793126b9e3430ee37a185c173.gif" width="338" height="14"><br><br>  This option opens <i>a message box</i> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/64d/25f/b3e/64d25fb3ec85590c63abfafda54176dc.gif" width="580" height="168"><br>  <i>Figure 2. A message window opens automatically when the option</i> <i><img src="https://habrastorage.org/getpro/habr/post_images/a10/057/b4e/a10057b4e87e554daf6e147e1fa4fbad.gif" width="61" height="12"></i>  <i>is used.</i> <br><br>  All direct commands are available. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/71d/600/7e2/71d6007e25d5eb874e415d12c295e47b.gif" width="41" height="13"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/687/51e/d47/68751ed47dccd4c07d5b796283ac4c55.gif" width="580" height="259"><br><br><h3>  Expansion of direct commands </h3><br>  Direct teams have many limitations.  Firstly, due to the nature of the COM port, the message can not be longer than 253 bytes.  This is a big limitation when working with files that can be much larger.  In addition, LEGO sensors work very differently;  Some sensors are passive, do not require power, while others are active, and still others are programmable - like I2C sensors.  To use the commands uniformly and avoid length restrictions, we set higher-level commands within which these problems are solved. <br><br>  The names of all these commands begin with <b>M4N</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/20a/cd1/25c/20acd125c9cb8d1a38bcb424820ef204.gif" width="41" height="13"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/981/20c/fc3/98120cfc311b140324471efdc87d1e0b.gif" width="580" height="97"><br><br>  One example is the <b>M4NFileNames</b> command that lists all the files present on the constructor (optionally with file size). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/57e/deb/e9b/57edebe9b83dab1c6943d88b4b28de74.gif" width="99" height="13"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/760/78a/57b/76078a57b06dfe27fabb8fe8a0239f0d.gif" width="478" height="28"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/495/470/1e2/4954701e2809596030845a302ea39b06.gif" width="414" height="14"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/4a8/59f/f0f/4a859ff0fba24129de836ccfcf16d76a.gif" width="193" height="158"><br><br>  This command works by calling the direct commands <b>NXTFindFirst</b> (command number 134), <b>NXTFindNext</b> (135), and <b>NXTClose</b> (132), using the algorithm given in Program 1. To see several calls to the NXT commands, use the option <img src="https://habrastorage.org/getpro/habr/post_images/4db/5b4/715/4db5b47155cfba84791824e4cf1ed55e.gif" width="75" height="13">  in <b>M4NFileNames</b> . <br><br><pre><code class="hljs pgsql">res=NXTFindFirst[mybrick,"*.*"]; <span class="hljs-keyword"><span class="hljs-keyword">While</span></span> [("Status"/.res)=<span class="hljs-number"><span class="hljs-number">0</span></span>, res=NXTFindNext[mybrick,"Handle"/.res] ] NXTClose[mybrick];</code> </pre> <br>  <i>Program 1. <b>M4NFileNames</b> uses a general algorithm to retrieve all the file names present on the NXT.</i>  <i>This algorithm does not show how to collect file names (contained as bytes in <b>res</b> ) into a list.</i> <br><br>  Similarly, to facilitate the use of sensors, there is a command that transmits a message to <i>Mathematica</i> about the types of sensors connected.  The reading from the sensor is subsequently made according to its type.  To set the sensor type, use the <b>M4NSetSensor</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/63b/4a6/45d/63b4a645d5acb296ac10fc3f92ed2339.gif" width="309" height="14"><br><br>  After that, reading from the sensor is performed by the universal command <b>M4NReadSensor</b> .  To match the style of direct commands, the first sensor is placed on port <b>0 of</b> the NXT input. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ec9/8c9/817/ec98c9817c83a7df739c6da6898c8d3d.gif" width="177" height="14"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/f46/0c5/cfd/f460c5cfd9fb1a8c20abbf49674babda.gif" width="7" height="13"><br><br>  The result is presented either as <b>1</b> for the ‚Äúpressed‚Äù state, or <b>0</b> as for the ‚Äúunpressed‚Äù state.  This command works the same regardless of the type of sensor connected.  Therefore, if you connect the ultrasonic sensor to the third input, you can run the following two commands. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/169/a47/7ba/169a477ba6be4924b10122ba12cfeb0f.gif" width="431" height="14"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/c04/55e/0c0/c0455e0c0b0eaddb5f387684f27b0bea.gif" width="263" height="14"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/40b/8e1/6a9/40b8e16a9b43b3e597f6106ade57e2b0.gif" width="7" height="13"><br><br>  An ultrasonic sensor is a sophisticated sensor designed to detect the distance to obstacles in front of it (in cm).  It is equipped with a microprocessor that works on the I2C protocol.  It must first be turned on, and after downloading it, you can start reading data from it.  Using the option <img src="https://habrastorage.org/getpro/habr/post_images/4db/5b4/715/4db5b47155cfba84791824e4cf1ed55e.gif" width="75" height="13">  You will see that much more information exchange is required to initialize the ultrasonic sensor than when initializing the touch sensor.  However, all of this communication is completely invisible with the <b>M4N</b> teams. <br><br><h3>  Work with motors </h3><br>  Another limitation of direct NXT firmware commands concerns engine control.  New LEGO engines contain built-in rev counters that track the amount of rotational motion.  However, a direct command can only stop the engine when it reaches a certain number of degrees passed, after which the motor changes its direction of rotation. <br><br>  Motor PID controller is a more efficient way to control rotation.  It sets the number of degrees and adjusts the engine power so that it slows down when the goal is almost reached (using the integral and the derivative; see [4, 5]). <br><br>  The authors [5] developed a PID controller for the NXT.  This controller is on the NXT;  the computer sends the specified motion, after which the controller takes control of the engine, adjusting the force until the number of degrees of rotation is reached.  The program of the controller is called <b>MotorControl22.rxe</b> , for version 2.2. <br><br>  Take the program MotorControl22.rxe and send it to the constructor.  To do this, import the contents of the file into <i>Mathematica</i> and upload it to NXT.  After installation (this step may take several minutes when transferred via Bluetooth - the file weighs 37 kilobytes) you can start the controller.  Here are the commands to accomplish this;  The first part verifies that the file is not yet on the constructor. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/267/f69/413/267f694139ca90abbf99d52405977aac.gif" width="460" height="78"><br><br>  Finally, via <b>M4NSetMotor,</b> tell your program what types of engines you have and which port they are connected to. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0c6/750/779/0c6750779210e8dd432913e06e36699b.gif" width="445" height="14"><br><br>  By the way, <b>M4NSetMotor</b> loads MotorControl22.rxe, if it is not present on the constructor and starts this program, if it is not already running.  Therefore, you can not worry about these details and can only rely on <b>M4NSetMotor</b> . <br><br>  Now that the controller is up and running, you can send instructions to it using commands related to motors. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fb5/097/410/fb5097410eb4d7594f5582431a15dced.gif" width="84" height="13"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/96f/d6d/eef/96fd6deef4bd77cc2ffbd9391dd59ca7.gif" width="580" height="61"><br><br>  <b>M4NRunMotor</b> , <b>M4NStopMotor</b> and <b>M4NBrakeMotor</b> can be used both on conventional engines and on engines with a rev counter (tachometer).  However, <b>M4NRunMotorFor</b> can only be used with motors equipped with a tachometer and a PID controller.  If the engine is controlled by a PID controller, then you should not send any other instructions.  Therefore, <b>M4NRunMotorFreeQ</b> can be used to test the controller. <br><br>  The following command set starts two motors. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/19e/e4d/dff/19ee4ddff9f2c607bdf242b789e803fb.gif" width="194" height="14"><br><br>  You can stop the motors using two different modes ( <b>M4NBrakeMotor</b> blocks the engine, while <b>M4NStopMotor</b> stops <b>feeding the</b> engine). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ad0/409/b88/ad0409b88780b9df75f6cc6a3a42c292.gif" width="214" height="30"><br><br>  The following commands verify that the <b>MOTORA</b> motor <b>is</b> free ‚Äî before driving, while driving (10 full turns) and six seconds after the movement began. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7bb/c2c/030/7bbc2c03069cd167e31c0dbab21812f8.gif" width="472" height="78"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/d19/add/e7c/d19adde7cfb5d0b07afd301d070a5f0c.gif" width="29" height="13"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/3dd/d08/138/3ddd08138a55f3bf7e080b35b9760256.gif" width="36" height="13"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/d19/add/e7c/d19adde7cfb5d0b07afd301d070a5f0c.gif" width="29" height="13"><br><br><h3>  Robot Setup </h3><br>  At the program level, the robot has a specific configuration that determines which sensors are connected to the input and which motors are available at the output.  Earlier, we showed two commands that can be used to identify sensors and motors. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/540/624/48d/54062448d56ecb311a25409ca020ee6e.gif" width="445" height="30"><br><br>  We have created a generic <b>M4NInitialize</b> command, the goal of which is to install all these elements in one command.  In addition, it can also be used to set the volume level and assign a name to the designer (if you have a lot of them, it would be nice to rename it by the name of the COM port to which they are connected). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e8a/b3e/80d/e8ab3e80d8e18622bdbf65f60d65f59a.gif" width="580" height="30"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/5a0/057/b64/5a0057b64e848ca91caf019dbf2b3ba5.gif" width="107" height="14"><br><br>  In addition, <b>M4NInitialize</b> checks whether the firmware version on the NXT is compatible with this package and that the battery has a sufficient charge level (otherwise it returns a warning).  You can also set the path to the folder containing the MotorControl22.rxe controller using the <b>MotorControlPath</b> option, in case it is still not on the NXT. <br><br><h3>  Dynamic robot control </h3><br>  <b>M4N</b> and <b>NXT</b> commands can be used dynamically.  For example, to get the current state of touch sensors, the following steps should be performed. <br><br>  First, initialize the sensors using <b>M4NInitialize</b> or <b>M4NSetSensor</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/73a/9b1/4b6/73a9b14b652a4acec78e7d10b8da2391.gif" width="580" height="30"><br><br>  The <b>ShowSensor</b> function creates a panel with <b>On</b> and <b>Off</b> elements, which are set depending on the sensor value.  This feature uses some options for convenience only. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b28/51f/b79/b2851fb794c72ca512cf13331c16e0d9.gif" width="580" height="46"><br><br>  Then, we can use <b>ShowSensor</b> four times in a row to get a string with indicators. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1b3/9eb/0a5/1b39eb0a53f34bad133783766abc86ab.gif" width="578" height="46"><br><br>  The <a href="http://reference.wolfram.com/language/ref/UpdateInterval.html">UpdateInterval</a> option determines how long to communicate with the sensors. <br><br>  As a final example, we will create a joystick that controls two motors.  Motor rotation speed (adjusted by the <b>MotorPower</b> option) depends on the position of the joystick (vertical axis).  In addition, the motors move synchronously if the position of the joystick is centered on the horizontal axis. <br><br>  First, we define an advanced ClickPane function that works with more events than the regular <a href="http://reference.wolfram.com/language/ref/ClickPane.html">ClickPane</a> function. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2a8/1d7/553/2a81d75537789e75f71f7fb77f4b9c62.gif" width="506" height="379"><br><br>  We must remember to initialize the motors (so that the PID controller is on). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1e2/64e/ab8/1e264eab8dac3f8d913560375da3ab59.gif" width="453" height="14"><br><br>  That's all.  The following example displays a panel with a red dot (top of the joystick).  Thus, we constantly set the engine power so that it is proportional to the position of the joystick.  In addition, if the joystick is released, it returns to the center with an exponential function represented by the variable <b>mult</b> .  Finally, if you click on the panel anywhere, the joystick will instantly return to the center with a beep. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d92/a68/094/d92a68094b956ba8b069cacef3f56847.gif" width="580" height="301"><br><br><h3>  Robot moving along a given trajectory </h3><br>  To illustrate a simple example of an autonomous robot, we will create a robot moving along a specific path.  The purpose of this robot is to follow the edge of a certain line.  The line should be dark on a light background (or vice versa);  border contrast is an important factor.  To achieve this, you will need a robot equipped with a light sensor at the front (see, for example, the assembly instructions given on page 33 of the MINDSTORMS training brochure [2]). <br><br>  For this project, we will need a light sensor and two motors, which we initialized. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3bc/219/512/3bc219512bdcdc6e5a1cffa1307e7edd.gif" width="580" height="14"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/5a0/057/b64/5a0057b64e848ca91caf019dbf2b3ba5.gif" width="107" height="14"><br><br>  At the first stage, we must calibrate the sensor so that the readings on the light and dark surfaces are set.  Use the code below to get 100 readings when the robot moves on a light surface. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/611/c69/06c/611c6906cea814b988ac37954e47237c.gif" width="405" height="14"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/93a/158/f48/93a158f4888bb013078aa4d885eea515.gif" width="36" height="13"><br><br>  Then use this code when moving the robot on a dark surface. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/720/6f2/cd9/7206f2cd9353359b5ebf3db3830beb07.gif" width="405" height="14"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/dd0/f05/427/dd0f05427fe82eb0b41102561acbcde6.gif" width="22" height="13"><br><br>  The average of the above two values ‚Äã‚Äãis a critical value.  If the robot, which follows the left edge of the dark line, observes a lighter area than the average value, we need it to go to the right (and vice versa). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/33d/cda/2e7/33dcda2e7296e328bfe758539f4ff826.gif" width="161" height="13"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a37/d80/5dc/a37d805dc321983982595c508a2e30e3.gif" width="43" height="13"><br><br>  The next short program moves the robot at a moderate speed (the variable <b>basespeed</b> is set to 20) and adjusts the base speed according to the difference between the current reading and the average value. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/515/4df/494/5154df49456e9eb4a7be6b607c25e8f1.gif" width="545" height="141"><br><br>  The <b>mult constant is</b> used to control the steering coefficient.  Larger values ‚Äã‚Äãcause the robot to make sudden changes in direction.  This value should be small for smooth movement.  However, if there are sharp turns on the trajectory, the small multiplier does not allow the robot to turn a sufficient angle to find the edge again.  The findings will present some details. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7d6/f33/479/7d6f33479466cb6e2facb95d61bdf767.jpg"><br><br><h3>  Technical limitations </h3><br>  There are several direct commands that we decided not to implement in this package.  They are related to rebooting the NXT, changing its firmware, erasing the flash memory, and performing a reset.  In essence, these commands destroy the robot. <br><br>  With the <b>M4N</b> and <b>NXT</b> commands, the robot can be controlled very efficiently and easily.  However, the COM port is not very fast.  It is important to note that each switch in the direction of transmission of the port signal takes 6 ms.  This is the reason why answers should be avoided if they are not really necessary.  In some applications, these delays may be so important that the program must be moved to the constructor in whole or in part.  The MotorControl22.rxe PID controller is an example in which a program is distributed between two machines: the computer sets the necessary movements, and the designer executes the millisecond solutions within the millisecond to achieve the goal. <br><br><h3>  findings </h3><br>  There is one new theory in cognitive science - the theory of incarnations.  She argues that the cognitive system must be in interactive communication with the outside world in order to develop a meaningful view of the world.  This view is contrary to the classical view of artificial intelligence (AI), which states that cognitive agents manipulate features or symbols that may not be related to aspects of the external world.  Therefore, from the point of view of AI, sensors and actuators do not depend on cognitive functions and can be built separately.  This view is valid when we develop cognitive systems in the virtual world (for example, based on computer modeling).  However, when robots get physical incarnation, we see how difficult it is to hold this position. <br><br>  A simple program of following the trajectory shows it.  In a virtual environment, the robot following the trajectory can operate at full speed, and the turns can be sharp, because there is no inertia and the risk that the robot will fall.  When a robot gets physical incarnation, these aspects become very serious problems.  Of course, the programmer adapts the program to take into account these risks (reduction in speed and decrease in the gain factor).  In addition, data on bright and dark areas are calibrated by the programmer in a very simple way.  However, if the ambient light changes, calibration should be done again.  In addition, as mentioned earlier, if the <b>mult</b> multiplier is too small, the robot may not be able to move fast enough around a sharp curve.  Finally, the robot following the trajectory uses wheels.  If he used his legs instead, the flexibility and limitations of the muscles would take effect. <br><br>  All the above problems can be considered at worst as inconveniences, and at best as challenges for the programmer.  However, the simplest animals are immune to all these problems.  The theory of incarnations asserts that organisms have created the proper ideas about the world, interacting with it, and that these ideas have become reliable in relation to all possible sources of malfunction.  Representations and algorithms specified by the programmer, on the other hand, may not meet the requirements of the real world, no matter how simple and elegant they may be. <br><br>  NXT is a simple but complete platform for testing robots in real life.  In combination with the computing power of the <i>Mathematica</i> system, it is easy to develop adaptive algorithms, such as neural networks, and to observe what ideas the robot has about the world.  It remains to be seen what the simplest adaptive program of the robot looks like, which follows a predetermined path. <br><br><h3>  Thanks </h3><br>  The author would like to thank Vincent Brault, Dominic Langlois and Sylvain Chartier from the CONEC laboratory (University of Ottawa) for their help in developing the <b>Math4NXT</b> package. <br><br><h3>  References </h3><br>  [1] MathWorks.  ‚ÄúSet Up a Bluetooth Connection.‚Äù (Feb 4, 2013) <a href="http://www.mathworks.com/help/simulink/ug/bluetooth-communications.html">www.mathworks.com/help/simulink/ug/bluetooth-communications.html</a> . <br><br>  [2] The LEGO Group.  ‚ÄúLEGO MINDSTORMS NXT Bluetooth Developer Kit.‚Äù (Jan 7, 2013) <a href="http://mindstorms.lego.com/en-us/support/files/default.aspx">mindstorms.LEGO.com/en-us/support/files/default.aspx</a> . <br><br>  [3] R. Raguet-Schofield.  ‚ÄúSerialIO.‚Äù Wolfram Library Archive.  (Jan 7, 2013) <a href="http://library.wolfram.com/infocenter/MathSource/5726">library.wolfram.com/infocenter/MathSource/5726</a> . <br><br>  [4] J. Sluka.  ‚ÄúA PID Controller For LEGO MINDSTORMS Robots.‚Äù (Jan 7, 2013) <a href="http://www.inpharmix.com/jps/PID_Controller_For_Lego_Mindstorms_Robots.html">www.inpharmix.com/jps/PID_Controller_For _Lego _Mindstorms _Robots.html</a> . <br><br>  [5] Institute of Imaging &amp; Computer Vision.  ‚ÄúRWTH ‚Äî MINDSTORMS NXT Toolbox.‚Äù (Jan 7, 2013) <a href="http://www.mindstorms.rwth-aachen.de/trac/wiki/MotorControl">www.mindstorms.rwth-aachen.de/trac/wiki/MotorControl</a> . <br><br>  D. Cousineau, ‚ÄúControlling Robots Built with the LEGO MINDSTORMS NXT Brick,‚Äù <em>The Mathematica Journal</em> , 2013. dx.doi.org/doi:10.3888/tmj.15-3. <br><br><h3>  about the author </h3><br>  Denis Cousineau is a professor of cognitive psychology at the University of Ottawa.  He conducts research in the field of artificial intelligence and the process of classification of objects by man. <br><br>  Contact details: √âcole de psychologie, Universit√© d'Ottawa, 136, rue Jean-Jacques Lussier, Ottawa (ON), K1N 6N5, CANADA, e-mail: Denis.Cousineau@UOttawa.ca </div><p>Source: <a href="https://habr.com/ru/post/256345/">https://habr.com/ru/post/256345/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../256329/index.html">Play head</a></li>
<li><a href="../256331/index.html">Temporal relativistic ontological space</a></li>
<li><a href="../256333/index.html">The program of practical training in the field of information security: "Zero Security: A"</a></li>
<li><a href="../256337/index.html">Services on the conveyor. How is the information infrastructure of WebCanape?</a></li>
<li><a href="../256339/index.html">Doing yourself to open it up, or the Right to pre-edit</a></li>
<li><a href="../256347/index.html">Checking the Haiku operating system (BeOS family) with PVS-Studio. Part 1</a></li>
<li><a href="../256349/index.html">GSM module control with AVR</a></li>
<li><a href="../256351/index.html">Say a word about poor recursion, or all that you did not know and do not want to know about it</a></li>
<li><a href="../256353/index.html">Using the driver keys of the lower and upper levels of the IR2110 - an explanation and examples of schemes</a></li>
<li><a href="../256355/index.html">godebug - cross-platform debugger for Go</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>