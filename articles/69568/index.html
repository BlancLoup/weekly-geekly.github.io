<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Text at any cost: PDF</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue to parse text formats for text. So, the previously promised PDF. 

 With portable document format, everything is not as simple as DOCX or ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Text at any cost: PDF</h1><div class="post__text post__text-html js-mediator-article">  We continue to parse text formats for text.  So, the previously promised PDF. <br><br>  With portable document format, everything is not as simple as DOCX or ODT, which we considered <a href="http://habrahabr.ru/blogs/php/69417/">last time</a> , but still it is still originally a text, not a binary format.  Are you surprised?  Then let's look at what's inside.  <b>Next really a lot of text.</b> <br><br><a name="habracut"></a><img src="https://habrastorage.org/storage2/bed/6d7/b36/bed6d7b3655c562942aba321d97a5879.gif">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As you can see, we have before us quite a ‚Äútext‚Äù document, interspersed with binary data.  Of course, it‚Äôs not possible to read a pdf book in a notebook, but it‚Äôs quite possible to understand what is written and what will later be displayed on the screen.  I note in advance that the purpose of this article is not to describe the format of the data, so I‚Äôll tell you essentially: ‚ÄúWhere can I find the text?‚Äù For more information on the PDF format, see the links at the end of this short guide. <br><br><h4>  PDF data types </h4><br>  PDF supports several basic data types (to be exactly eight), some of which we need to work with are strings, arrays, dictionaries (distionaries), streams and objects (objects).  Let us dwell on each. <br><br>  <b>Strings</b> <br>  PDF lines inherited from PostScript, as a result, a line in .pdf is a sequence of 8-bit characters surrounded by parentheses.  String can be moved to the next line with a backslash, which is not part of the string and, among other things, escapes special characters: <br><br><pre>  (First line \
 First line \ n Second line with brackets \ (\)) </pre><br>  As a result, the output will be two lines: <br><br><pre>  First line First line
 Second line with brackets () </pre><br>  Because of its initial eight-bitness in PDF, there are several ways to insert text data, for example, in the same Unicode encoding.  We can use the insert on octal character codes ( <code>\053</code> ), using a separate two-byte hex ( <code>&lt;2B&gt;</code> ) or even their sequence ( <code>&lt;54776F20&gt;</code> ).  For example, the following lines are equivalent: <br><br><pre>  (Two + two = four.)
 (Two \ 053 two \ 075 four.)
 (Two &lt;2B&gt; two &lt;3D&gt; four.)
 (&lt;54776F202B2074776F203D20&gt; four.) </pre><br>  In the lines we will learn in the future to search for text data that contains a PDF-document. <br>  <b>Arrays</b> <br>  PDF arrays are enclosed in square brackets and are simply a sequence of grouped objects.  For example: <code>[(Hello,)10(world!)]</code> .  Arrays sometimes contain text strings. <br><br>  <b>Dictionaries</b> <br>  These are key-value pairs framed in &lt;&lt; and &gt;&gt;.  A dictionary is often used to endow an object that contains it with properties that are described in dictionary.  To us, this data will help determine how, for example, to decrypt a stream, find out its length, or, conversely, discard the current object as uninteresting (if it is an image).  Here is an example of a regular PDF dictionary: <br><br><pre>  &lt;&lt;
 / Length 681
 / Filter 
 / FlateDecode
 &gt;&gt; </pre><br>  After reading, my code will present it in the form: <br><br><blockquote>  <font color="#000088">$ dictionary</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <br>  <font color="#0000ff">"Length"</font> <font color="#339933">=&gt;</font> <font color="#0000ff">"681"</font> <font color="#339933">,</font> <br>  <font color="#0000ff">"Filter"</font> <font color="#339933">=&gt;</font> <font color="#009900">true</font> <br>  <font color="#0000ff">"FlateDecode"</font> <font color="#339933">=&gt;</font> <font color="#009900">true</font> <br>  <font color="#009900">)</font> <font color="#339933">;</font> </blockquote>  <b>Streams</b> <br>  The streams represent a sequence of eight-bit data between the <code>stream</code> and <code>endstream</code> .  Any binary data, be it compressed text, image, or embedded font, will be presented as a stream.  The stream is always inside the object (just below) and is characterized, at a minimum, by its length (the <code>/Length N</code> option in the dictionary) and very often by the compression method (for example, <code>/Filter /FlateDecode</code> ).  PDF supports a sufficient number of compression formats (including the encryption format <code>/CryptDecode</code> ), but we will be interested in only three: the most commonly used Flate (gzip-compression) and the rarer ASCII Hex (representing the data as a hexadecimal string with the final character <code>&gt;</code> ) and ASCII 85-based (compression, when the successive 4 characters of the source text are encoded with 5 characters from <code>!</code> to <code>y</code> in the ASCII table). <br><br>  In streams, we will search for the text we want to get from a PDF document.  An example of the stream you can find in the second half of the image, that at the beginning of this topic: <i>yes, yes, those quackers - this is it</i> . <br><br>  <b>Objects</b> <br>  Objects - this is the largest structure with which to work.  An object can contain within itself any other data type from a regular number to a stream, framed by the keywords <code>obj</code> and <code>endobj</code> .  The object has its ID inside the document by which it can be referenced.  First of all, we are interested in objects with streams inside of us (do not forget about the main subtask), which almost always contain a set of additional options in the form of a dictionary.  Here is a typical example of an object inside a PDF file (with uncompressed stream content): <br><br><pre>  2 0 obj
 &lt;&lt;
 / Length 9 2 R
 &gt;&gt;
 stream
 BT
 / F1 12 Tf
 72 712 Td (A short text stream.) Tj
 ET
 endstream
 endobj </pre><br>  Well, on this the introductory part of the internal presentation of the data is over, go to the "tasty" things - getting text from the stream, as well as getting dictionaries of internal character transformations (the implementation of which I have not seen before). <br><br><h4>  Where to search for text? </h4><br>  We formulate the problem: ‚ÄúWhere to look for text objects in a PDF document?‚Äù Everything is simple and more than once and not two are described in various forums: we will look for objects that have threads.  Usually meant, compressed gzip, streams, but the documentation tells us - then it may not be compressed at all or, conversely, there may be several compression ( <code>/Filter /FlateDecode /ASCIIHexDecode</code> ).  Well, we need some real example.  Please, a poem by Mikhail Yuryevich Lermontov ‚ÄúParus‚Äù in <a href="http://rembish.ru/i/parus.pdf">PDF-format</a> (the document was created on <a href="http://acrobat.com/">Acrobat.com</a> from the odt-file from the previous article). <br><br>  Find in this document some object and begin to disassemble it.  I‚Äôm getting a little bummed and take an object in which there is obviously textual data, but this is just for example - the script doesn‚Äôt have anything to work with: <br><br><img src="https://habrastorage.org/storage2/bfa/8a9/215/bfa8a9215ec8d062558652390ba1ab77.gif"><br><br>  Let's first understand what is before us, using the previously obtained knowledge about the types of data PDF.  Before us is an object with a dictionary of properties that say that the length of the data stream is 681 bytes ( <code>/Length 681</code> ), that the stream is compressed ( <code>/Filter</code> ) in gzip ( <code>/FlateDecode</code> ).  Already enough information to decompress the data stream - <code>gzuncompress</code> will <code>gzuncompress</code> : <br><br><pre>  0.1 w
 q 0 -0.1 612.1 792.1 re W * n
 q 0 0 0 RG
 0 0 0 rg
 BT
 2 Tr 0.59999 w
 56.8 716.6 Td / F1 18 Tf [&lt;01&gt; 17 &lt;02&gt; 10 &lt;03&gt; 10 &lt;04&gt; 17 &lt;05&gt;] TJ
 ET
 Q
 q 0 0 0 rg
 BT
 56.8 682.5 Td / F1 11 Tf [&lt;06&gt; 9 &lt;07&gt; 11 &lt;08&gt; 6 &lt;07&gt; 11 &lt;07&gt; 11 &lt;09&gt; 13 &lt;0A&gt; 4 &lt;0B&gt; 14 &lt;0C&gt; 11 &lt;0D&gt; 11 &lt;0E &gt; 9
 &lt;0F&gt; 9 &lt;0A&gt; 4 &lt;10&gt; 11 &lt;11&gt; 10 &lt;12&gt; 23 &lt;13&gt; 6 &lt;10&gt; 11 &lt;14&gt; 10 &lt;10&gt; 11 &lt;15&gt;] TJ
 ET
 ... a lot of text ... </pre><br>  Now let's take a little distraction from our example and find out a little more about the presentation of text in PDF.  We just need to remember a few things: <ul><li>  If the text is in the stream, it is contained between the ‚Äúmarker‚Äù of the beginning of the <code>BT</code> text (beginning of text) and the end of <code>ET</code> (end of text). </li><li>  PDF may or may not display text, depending on the presence of a market Tj (display text) or a marker <code>TJ</code> (display text taking into account individual character positioning).  These markers appear after a line of text or an array of lines, as in this case ( <code>[&lt;01&gt;17&lt;02&gt;10&lt;03&gt;10&lt;04&gt;17&lt;05&gt;]TJ</code> ). </li><li>  PDF supports individual positioning of characters, as I wrote above, which means that we can set an arbitrary and separate size of the distance between each pair of characters.  More on this later </li></ul>  This information is enough for us to select two lines from our example: <br><br><pre>  1. &lt;01&gt; 17 &lt;02&gt; 10 &lt;03&gt; 10 &lt;04&gt; 17 &lt;05&gt;
 2. &lt;06&gt; 9 &lt;07&gt; 11 &lt;08&gt; 6 &lt;07&gt; 11 &lt;07&gt; 11 &lt;09&gt; 13 &lt;0A&gt; 4 &lt;0B&gt; 14 &lt;0C&gt; 11 &lt;0D&gt; 11 &lt;0E&gt; 9
 &lt;0F&gt; 9 &lt;0A&gt; 4 &lt;10&gt; 11 &lt;11&gt; 10 &lt;12&gt; 23 &lt;13&gt; 6 &lt;10&gt; 11 &lt;14&gt; 10 &lt;10&gt; 11 &lt;15&gt; </pre><br><br>  The attentive reader, who has looked at the PDF of the example, may assume that we have the title ( <i>SAIL</i> ) and the first line of the poem ( <i>The sail is lonely</i> ).  And he will be right, but!  But you do not find that the hex texts are very strange in this text: <ul><li>  <code></code> is encoded as <code>01 02 03 04 05</code> </li><li>  <code> <u></u>  <u></u> </code> - like <code>06 <u>07</u> 08 <u>07</u> <u>07</u> 09</code> ... </li></ul>  Very similar to the fact that there is some kind of correspondence table, isn't it?  Well, you're right again, let's look for ... <br><br><h4>  Conversion table </h4><br>  The previous example would have saved most of the functions of obtaining text from PDF, which you can find in the public domain on the Internet.  Let's try to figure out what's what.  So, we are interested in <i>ToUnicode CMaps</i> , which are described in the subsection on getting the text of the description of the PDF format from Adobe.  Let's look for them in our file.  I‚Äôm cheating again and offer the reader a ‚Äúknowingly correct piece‚Äù: <br><br><img src="https://habrastorage.org/storage2/1df/529/cb8/1df529cb8cd2c411927aaacce7d69528.gif"><br><br>  Decipher it: <br><br><pre>  / CIDInit / ProcSet findresource begin
 12 dict begin
 begincmap
 / CIDSystemInfo &lt;&lt;
 / Registry (Adobe)
 / Ordering (UCS)
 / Supplement 0
 &gt;&gt; def
 / CMapName / Adobe-Identity-UCS def
 / CMapType 2 def
 1 begincodespacerange
 &lt;00&gt; 
 endcodespacerange
 45 beginbfchar
 &lt;01&gt; &lt;041F&gt;
 &lt;02&gt; &lt;0410&gt;
 &lt;03&gt; &lt;0420&gt;
 &lt;04&gt; &lt;0423&gt;
 &lt;05&gt; &lt;0421&gt;
 &lt;06&gt; &lt;0411&gt;
 &lt;07&gt; &lt;0435&gt;
 &lt;08&gt; &lt;043B&gt;
 &lt;09&gt; &lt;0442&gt;
 ... many lines of transformations ...
 endbfchar
 endcmap
 CMapName currentdict / CMap defineresource pop
 end
 end </pre><br>  Familiar numbers <code>&lt;01&gt;</code> , <code>&lt;02&gt;</code> and so on?  No wonder - we saw them a bit earlier in text lines.  Suppose we have to replace <code>01</code> with <code>041F</code> , take a look at what this number is hiding behind it.  Hooray!  <code>#x041F</code> = <code></code> !  We found the transformation of one character into another, now let's turn to the documentation and find out a little more. <br><br>  <b>bfchar</b> <br>  The conversion between <code>beginbfchar</code> and <code>endbfchar</code> is the simplest <code>endbfchar</code> .  It assigns to the first code another one.  For example, in the example above, we learned that <code>01</code> hides the code of the symbol <code></code>  But this is only a special case of the operation of this conversion - it is possible to assign a whole line to a code of up to 512 characters (that is, up to 128 characters in Unicode). <br><br>  <b>bfrange</b> <br>  There is another more complex conversion, framed by <code>beginbfrange</code> and <code>endbfrange</code> .  It works no longer with individual characters, but with their ranges.  Conversion supports two versions of its work: <ul><li>  <code>&lt;0000&gt; &lt;005E&gt; &lt;0020&gt;</code> - we work with a range from 0000 to 005E, each value of which is converted into values ‚Äã‚Äãfrom the interval 0020 and 007E.  Noticed the principle?  0000 is converted to 0020, 0001 to 0021, 0002 to 0022, and so on; </li><li>  <code>&lt;005F&gt; &lt;0061&gt; [&lt;00660066&gt; &lt;00660069&gt; &lt;00660066006C&gt;]</code> - each value between 005F and 0061 (i.e., another 0060) is replaced with the corresponding array sequence in square brackets: 005F will be replaced with 0066 00 66 (i.e., on <code>ff</code> ), 0060 on <code>fi</code> , and 0061 on <code>ffl</code> . </li></ul><br><br><h4>  Algorithm and Code </h4><br>  Using our knowledge, we can read our "ill-fated" verse about the sail.  Well time to present the most interesting pieces of code and a link to the full source: <br><br><blockquote><ol><li>  <font color="#000000">function</font> pdf2text <font color="#009900">(</font> <font color="#000088">$ filename</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#666666">// Read the data from the pdf-file into a string, taking into account that the file may contain</font> </li><li>  <font color="#666666">// binary streams.</font> </li><li>  <font color="#000088">$ infile</font> <font color="#339933">=</font> <font color="#339933">@</font> <font color="#990000">file_get_contents</font> <font color="#009900">(</font> <font color="#000088">$ filename</font> <font color="#339933">,</font> FILE_BINARY <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#990000">empty</font> <font color="#009900">(</font> <font color="#000088">$ infile</font> <font color="#009900">)</font> <font color="#009900">)</font> </li><li>  <font color="#b1b100">return</font> <font color="#0000ff">""</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666">// Pass the first.</font>  <font color="#666666">We need to get all the text data from the file.</font> </li><li>  <font color="#666666">// In the 1st pass, we get only the "dirty" data, with positioning,</font> </li><li>  <font color="#666666">// with hex inserts and so on.</font> </li><li>  <font color="#000088">$ transformations</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#000088">$ texts</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666">// First we get a list of all the objects from the pdf-file.</font> </li><li>  <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"#obj (. *) endobj # ismU"</font> <font color="#339933">,</font> <font color="#000088">$ infile</font> <font color="#339933">,</font> <font color="#000088">$ objects</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#000088">$ objects</font> <font color="#339933">=</font> <font color="#339933">@</font> <font color="#000088">$ objects</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666">// Let's start bypassing what was found - in addition to the text, we can get caught</font> </li><li>  <font color="#666666">// a lot of interesting and not always "tasty", for example, the same fonts.</font> </li><li>  <font color="#b1b100">for</font> <font color="#009900">(</font> <font color="#000088">$ i</font> <font color="#339933">=</font> <font color="#cc66cc">0</font> <font color="#339933">;</font> <font color="#000088">$ i</font> <font color="#339933">&lt;</font> <font color="#990000">count</font> <font color="#009900">(</font> <font color="#000088">$ objects</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$ i</font> <font color="#339933">++</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#000088">$ currentObject</font> <font color="#339933">=</font> <font color="#000088">$ objects</font> <font color="#009900">[</font> <font color="#000088">$ i</font> <font color="#009900">]</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666">// Check if there is a data stream in the current object, it is almost always</font> </li><li>  <font color="#666666">// compressed with gzip.</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#990000">preg_match</font> <font color="#009900">(</font> <font color="#0000ff">"#stream (. *) endstream # ismU"</font> <font color="#339933">,</font> <font color="#000088">$ currentObject</font> <font color="#339933">,</font> <font color="#000088">$ stream</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#000088">$ stream</font> <font color="#339933">=</font> <font color="#990000">ltrim</font> <font color="#009900">(</font> <font color="#000088">$ stream</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666">// Read the parameters of this object, we are only interested in text</font> </li><li>  <font color="#666666">// data, so we do minimal clipping to speed up</font> </li><li>  <font color="#666666">// run</font> </li><li>  <font color="#000088">$ options</font> <font color="#339933">=</font> getObjectOptions <font color="#009900">(</font> <font color="#000088">$ currentObject</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#009900">(</font> <font color="#990000">empty</font> <font color="#009900">(</font> <font color="#000088">$ options</font> <font color="#009900">[</font> <font color="#0000ff">"Length1"</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#339933">&amp;&amp;</font> <font color="#990000">empty</font> <font color="#009900">(</font> <font color="#000088">$ options</font> <font color="#009900">[</font> <font color="#0000ff">"Type"</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#339933">&amp;&amp;</font> <font color="#990000">empty</font> <font color="#009900">(</font> <font color="#000088">$ options</font> <font color="#009900">[</font> <font color="#0000ff">"Subtype"</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">)</font> </li><li>  <font color="#b1b100">continue</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666">// So, we have a "possible" text, decrypt it from the binary</font> </li><li>  <font color="#666666">// representation.</font>  <font color="#666666">After this action, we deal only with plain text.</font> </li><li>  <font color="#000088">$ data</font> <font color="#339933">=</font> getDecodedStream <font color="#009900">(</font> <font color="#000088">$ stream</font> <font color="#339933">,</font> <font color="#000088">$ options</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#990000">strlen</font> <font color="#009900">(</font> <font color="#000088">$ data</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#666666">// So, we need to find a text container in the current thread.</font> </li><li>  <font color="#666666">// If successful, the found "dirty" text will go to the rest</font> </li><li>  <font color="#666666">// found before</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#990000">preg_match_all</font> <font color="#009900">(</font> <font color="#0000ff">"#BT (. *) ET # ismU"</font> <font color="#339933">,</font> <font color="#000088">$ data</font> <font color="#339933">,</font> <font color="#000088">$ textContainers</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#000088">$ textContainers</font> <font color="#339933">=</font> <font color="#339933">@</font> <font color="#000088">$ textContainers</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> </li><li>  getDirtyTexts <font color="#009900">(</font> <font color="#000088">$ texts</font> <font color="#339933">,</font> <font color="#000088">$ textContainers</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#666666">// Otherwise, we are trying to find character transformations,</font> </li><li>  <font color="#666666">// which we will use in the second step.</font> </li><li>  <font color="#009900">}</font> <font color="#b1b100">else</font> </li><li>  getCharTransformations <font color="#009900">(</font> <font color="#000088">$ transformations</font> <font color="#339933">,</font> <font color="#000088">$ data</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#666666">// At the end of the initial parsing of the pdf document, we start the analysis of the received</font> </li><li>  <font color="#666666">// text blocks with character transformations.</font>  <font color="#666666">At the end, we return</font> </li><li>  <font color="#666666">// received result.</font> </li><li>  <font color="#b1b100">return</font> getTextUsingTransformations <font color="#009900">(</font> <font color="#000088">$ texts</font> <font color="#339933">,</font> <font color="#000088">$ transformations</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li></ol></blockquote>  You can get the code with comments on <a href="https://github.com/rembish/TextAtAnyCost">GitHub</a> . <br><br><h4>  Conclusion </h4><br>  Well, this code is not the crown of creation, it does not parse all the pdf-files offered to it.  There are <a href="http://rembish.ru/i/chastushki_koi8_with_yo.pdf">documents</a> in which, for example, Russian fonts are implemented that transform from the characters of the English alphabet into a display of Russian letters. <br><br>  This code does not work with individual character positioning.  The task is feasible and not difficult, I place its decision on the shoulders of the reader. <br><br>  This code is not ideal in terms of reading a PDF file according to its internal standards for presenting information: it does not search for pages, it will not work with versions of the document (PDF maintains a history of changes), it is even possible that it doesn‚Äôt ideally read the information it can process. <br><br>  It's worth noting that nobody canceled <code>$content = shell_exec('/usr/local/bin/pdftotext '.$filename.' -');</code>  .  But in this case, the task was to read PDF under any platform and on any platform. <br><br>  I hope you are interested in this article, the purpose of which is to acquaint the community with a PDF device, the ability to read it under PHP, and also to find starting points for obtaining data in difficult cases. <br><br>  Depending on the activity and interest in the problem, I will either continue the story about PDF (document internal structure, positioning, fonts, internal links), or return to the topic ‚ÄúText at any cost‚Äù using the example of RTF.  Thanks for attention! <br><br>  <b>References:</b> <ul><li>  <a href="http://www.mactech.com/articles/mactech/Vol.15/15.09/PDFIntro/">www.mactech.com/articles/mactech/Vol.15/15.09/PDFIntro</a> </li><li>  <a href="http://www.adobe.com/devnet/acrobat/pdfs/PDF32000_2008.pdf">www.adobe.com/devnet/acrobat/pdfs/PDF32000_2008.pdf</a> </li><li>  <a href="http://habrahabr.ru/blogs/php/69417/">Text at any cost: DOCX and ODT</a> </li><li>  <a href="http://habrahabr.ru/blogs/php/70119/">Text at any cost: RTF</a> </li><li>  <a href="http://habrahabr.ru/blogs/php/72745/">Text at any cost: WCBFF and DOC</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/69568/">https://habr.com/ru/post/69568/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../69563/index.html">Multitouch revolution with Atmel maXTouch</a></li>
<li><a href="../69564/index.html">Want!!! Russian interface on foreign web projects ... At all!</a></li>
<li><a href="../69565/index.html">In Mail.Ru came a man from Russian Google</a></li>
<li><a href="../69566/index.html">Mini-ITX Compact Case Overview</a></li>
<li><a href="../69567/index.html">We use the Membership API in the existing Database</a></li>
<li><a href="../69574/index.html">Steve Ballmer publicly confiscated the iPhone from a Microsoft VS employee. IBM banned 360,000 employees from using Microsoft Office.</a></li>
<li><a href="../69577/index.html">Copy Cyrillic links in Firefox</a></li>
<li><a href="../69578/index.html">TechCrunch50 opens today</a></li>
<li><a href="../69580/index.html">MonoTouch 1.0 Final Release</a></li>
<li><a href="../69583/index.html">New features of Photoshop and Flash CS5</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>