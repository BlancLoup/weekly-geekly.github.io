<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Client-server work with tabular data for beginners</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Instead of a start. 
 Recently I had to start writing an application for work. Previously, I worked exclusively with PHP and web snouts, but there was...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Client-server work with tabular data for beginners</h1><div class="post__text post__text-html js-mediator-article"><h5>  Instead of a start. </h5><br>  Recently I had to start writing an application for work.  Previously, I worked exclusively with PHP and web snouts, but there was a requirement to make a full-fledged windows-application with authorization, using forms and other parsley.  I am writing this article on an abstract abstract example with the goal of making mana accessible and simple.  Actually, the course of action itself is important here, rather than the application itself. <br><br>  The task was to work with the tabular data received from the server without a web interface.  Available tools: Apache + PHP + MySQL web server and C # application on the client side. <br><br>  Professionals are unlikely to be interesting.  But for beginners, it seems to me, it can be useful.  I really hope that I did not overthink the embodiment of the idea. <br>  Who is interested in the implementation of the bundle - please under the cat. <br><a name="habracut"></a><br>  To begin, I will describe the part of the code that provides data exchange with the server, as well as work with strings in the messages sent and received. <br>  I have implemented this in ready-made classes, but here I will give only the necessary methods, and not the entire listings of all classes. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The client, I remind you, is written in C #.  From WPF it was necessary to refuse, since in our office more than the standard version with Windows Forms.  The server part was created in PHP, because it simply turned out to be faster than writing a full-fledged CGI client for Mono Complete, although in the future we plan to abandon <s>the fucking</s> PHP in favor of a demon written in C #. <br><br>  I want to say that this is my first experience with VisualStudio (using VS2013 with ReSharper) and C #.  Therefore, if somewhere it was possible to make it more convenient, do not judge strictly - I‚Äôm happy to read the comments and take it into account in further developments. <br><h5>  Data encryption </h5><br>  Based on the Base-64 format because of its versatility on various platforms. <br><pre><code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//    Base64  public static string Base64Encode(string inputString) { return Convert.ToBase64String(Encoding.UTF8.GetBytes(inputString)); }</span></span></code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//    Base64  public static string Base64Decode(string inputString) { return Encoding.UTF8.GetString(Convert.FromBase64String(inputString)); }</span></span></code> </pre><br><h5>  Request to server </h5><br>  For work you will need the library " <b>Newtonsoft.Json</b> ".  Add it to the project References, otherwise it will not work.  Just want to note that the server is running Debian Squeeze and UTF-8 encoding is used everywhere.  Therefore, the code provides strings for compatibility.  Nobody wants a grunt.  I don‚Äôt see any point in commenting on such a code as it‚Äôs obvious. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Dictionary&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">, </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Response</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> handlerString, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> inputString = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">""</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">//    var requestString = (inputString.Length &gt; 0) ? "handler=" + handlerString + "&amp;args=" + Base64Encode(inputString) : "handler=" + handlerString; //       HttpWebRequest. ,      -  ,       . // *   Properties.Settings.Default    ,        ,   , IMHO.         ,        . // Properties.Settings.Default.handlerUri = (string) "http://__/handler.php" var request = (HttpWebRequest) WebRequest.Create(Properties.Settings.Default.handlerUri); // Properties.Settings.Default.httpMethod = (string) "POST" request.Method = Properties.Settings.Default.httpMethod; request.Credentials = CredentialCache.DefaultCredentials; var encoding = new UTF8Encoding(); var bytes = encoding.GetBytes(requestString); // Properties.Settings.Default.httpContentType = (string) "application/x-www-form-urlencoded" request.ContentType = Properties.Settings.Default.httpContentType; request.ContentLength = bytes.Length; using (var newStream = request.GetRequestStream()) { newStream.Write(bytes, 0, bytes.Length); newStream.Close(); } var response = (HttpWebResponse) request.GetResponse(); var streamReader = new StreamReader(response.GetResponseStream(), Encoding.UTF8); var responseString = streamReader.ReadToEnd().Trim(); //    JSON-,     Base-64   . ...     ,       .Trim('"').   ,    . return JsonConvert.DeserializeObject&lt;Dictionary&lt;string, string&gt;&gt;( Base64Decode(responseString.Trim('"'))); } catch (Exception exception) { //     ,     -   . // Properties.Settings.Default.errorMessageServerHandlerBug = (string) ",      .        .". // Properties.Settings.Default.msgboxCaptionError = (string) "". MessageBox.Show( Properties.Settings.Default.errorMessageServerHandlerBug + Convert.ToChar("\n") + exception.Message, Properties.Settings.Default.msgboxCaptionError, MessageBoxButtons.OK, MessageBoxIcon.Error); //       ,     -     , ..        . Application.Exit(); //    , VS    return',    .  , ,        :) return JsonConvert.DeserializeObject&lt;Dictionary&lt;string, string&gt;&gt;("{\"type\":\"error\",\"data\":\"-1\"}"); } }</span></span></code> </pre><br><br>  We now turn to the main topic of the article. <br>  Let's look at the example of a <s>useless</s> contact table. <br><br>  Let the fields (column headings) of the table be as follows: <br><br><ul><li>  Id </li><li>  Title </li><li>  Phonenumber </li><li>  Email </li><li>  Messengers </li></ul><br><br>  To begin, I will describe the part in PHP (server side). <br><br><pre> <code class="php hljs">define(<span class="hljs-string"><span class="hljs-string">"DB_HOST"</span></span>, <span class="hljs-string"><span class="hljs-string">"localhost"</span></span>); define(<span class="hljs-string"><span class="hljs-string">"DB_USER"</span></span>, <span class="hljs-string"><span class="hljs-string">"__"</span></span>); define(<span class="hljs-string"><span class="hljs-string">"DB_PASS"</span></span>, <span class="hljs-string"><span class="hljs-string">"__"</span></span>); define(<span class="hljs-string"><span class="hljs-string">"DB_NAME"</span></span>, <span class="hljs-string"><span class="hljs-string">"___"</span></span>); define(<span class="hljs-string"><span class="hljs-string">"DB_CHARSET"</span></span>, <span class="hljs-string"><span class="hljs-string">"utf8"</span></span>); define(<span class="hljs-string"><span class="hljs-string">"ANSWER_SUCCESS"</span></span>, <span class="hljs-string"><span class="hljs-string">"success"</span></span>); define(<span class="hljs-string"><span class="hljs-string">"ANSWER_ERROR"</span></span>, <span class="hljs-string"><span class="hljs-string">"error"</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">make_answer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($type, $data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> base64_encode(json_encode([ <span class="hljs-string"><span class="hljs-string">"type"</span></span> =&gt; $type, <span class="hljs-string"><span class="hljs-string">"data"</span></span> =&gt; $data ])); <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>();<span class="hljs-comment"><span class="hljs-comment">//       . } $db = new PDO("mysql:host=".DB_HOST.";dbname=".DB_NAME, DB_USER, DB_PASS); $db-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION); $db-&gt;exec("SET NAMES '".DB_CHARSET."'"); $query = $db-&gt;query("SELECT `Id`,`Title`,`PhoneNumber`,`Email`,`Messengers` FROM `contacts` WHERE 1"); $query-&gt;execute(); $query-&gt;setFetchMode(PDO::FETCH_ASSOC); $result = []; while ($current = $query-&gt;fetch()) { $result[] = [ "Id" =&gt; base64_encode($current["Id"]), "Title" =&gt; base64_encode($current["Title"]), "PhoneNumber" =&gt; base64_encode($current["PhoneNumber"]), "Email" =&gt; base64_encode($current["Email"]), "Messengers" =&gt; base64_encode($current["Messengers"]) ]; } if (count($result) &gt; 0) { make_answer(ANSWER_SUCCESS, $result); } make_answer(ANSWER_ERROR, "  ");</span></span></code> </pre><br><br>  In outline.  Here we connect to the database, get the necessary data (PDO is used) and form the answer in the form of an array.  If there are no records, we return an error message. <br><br>  The data array has the format: <br><br>  <i>Array [</i> <i><br></i>  <i>0 =&gt; array ["Id" =&gt; "value", "Title" =&gt; "value", "PhoneNumber" =&gt; "value", "Email" =&gt; "value", "Messengers" =&gt; "value"] ,</i> <i><br></i>  <i>1 =&gt; array ["Id" =&gt; "value", "Title" =&gt; "value", "PhoneNumber" =&gt; "value", "Email" =&gt; "value", "Messengers" =&gt; "value"] ,</i> <i><br></i>  <i>...</i> <i><br></i>  <i>N =&gt; array ["Id" =&gt; "value", "Title" =&gt; "value", "PhoneNumber" =&gt; "value", "Email" =&gt; "value", "Messengers" =&gt; "value"]</i> <i><br></i>  <i>]</i> <br><br>  In the future, I consider this form most convenient for working with databases and sets of two-dimensional data of the ‚Äúkey-value‚Äù type. <br><br>  The data exchange takes place via the HTTP protocol; therefore, the usual output ‚Äúon the screen‚Äù of the received data and the completion of the script are sufficient. <br>  The value of each field is encoded in Base-64 format, and the entire data array is converted to JSON-format and again encoded in Base-64.  Enough safe and convenient for parsing in the client part of the application. <br><br>  Now we analyze the client side. <br><br>  I used a combination of the <b>dataSet</b> and <b>dataGridView components</b> . <br><br>  There are two (to begin with) components on the form: dataSetContactsTable, dataGridViewContactsTable. <br><br>  <i>I advise you to immediately give all the components clear names - otherwise, then such a mess in the code will begin, that it is easier to write the software again than to refactor it.</i> <br><br>  When adding a dataSet component, I selected the ‚ÄúUntyped dataset‚Äù option. <br>  Now configure the dataSet component.  In the properties I set to him: <br><br><ul><li>  Name = dataSetContactsTable </li><li>  DataSetName = DataSetContactsTable </li><li>  Tables = <i>(see further on what was created)</i> </li></ul><br><br>  Click the button ‚ÄúAdd‚Äù and set up the created table.  Here are the parameters that I set: <br><br><ul><li>  Columns = <i>(I will describe the columns below)</i> </li><li>  TableName = TableContactsView </li><li>  Name = dataTableContactsView </li><li>  Modifiers = Public </li></ul><br><br>  The columns of the table should correspond to the data arriving from the server.  Therefore, it was done like this: <br><br><ul><li>  <b>(ID - Caption - ColumnName - ReadOnly - Name)</b> </li><li>  0 - ID - ColumnId - true - dataColumnId </li><li>  1 - Contact - ColumnTitle - true - dataColumnTitle </li><li>  2 - Phone - ColumnPhoneNumber - true - dataColumnPhoneNumber </li><li>  3 - E-mail - ColumnEmail - true - dataColumnEmail </li><li>  4 - Speakers - ColumnMessengers - true - dataColumnMessengers </li></ul><br><br>  It may be asked why all the columns are set to read only mode.  This is due to the features of the softphone, when a double-click on a line should bring up a separate window in which work with the selected entry is performed. <br><br>  Let's proceed to setting up the dataGrid component.  And first I will describe those changes in the properties that I made for him. <br><br>  Apparently, it does not make sense to describe the designer part of the config - everyone can have their own.  I will touch only the question of columns and binding to the dataSet component. <br><br><ul><li>  DataMember = TableContactsView </li><li>  DataSource = dataSetContactsTable </li><li>  Columns = <i>(see below)</i> </li></ul><br><br>  All table fields, except the record ID, must be displayed to the application user.  Therefore, the Id field is the only one that has the ‚ÄúVisible‚Äù parameter set to ‚ÄúFalse‚Äù.  The rest of the settings are similar. <br><br><ul><li>  <b>HeaderText - DataPropertyName</b> </li><li>  Id - ColumnUserId </li><li>  Contact - ColumnTitle </li><li>  Phone - ColumnPhoneNumber </li><li>  Email - ColumnEmail </li><li>  Speakers - ColumnMessengers </li></ul><br><br>  Everything.  Mouse work is completed, you can now go to the code. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FormContacts_Load</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, EventArgs e</span></span></span><span class="hljs-function">)</span></span> { LoadContactsTable(); }</code> </pre><br><br>  For further work, we will immediately create a class that will help us parse the JSON array arriving from the server. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ContactsList</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Title { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> PhoneNumber { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Email { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Messengers { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br><br>  Now you need to create a method that clears and reloads the data into a table on the form (it was already mentioned above in the FormContacts_Load code). <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//      ,    ,   - .       . public void LoadContactsTable(string args = "") { //   , ..        //    ,     -     . dataTableContactsView.Clear(); //     var contactsResponse = Response("getContactsTable", args); //  ,    -       if (contactsResponse["type"].Trim() == "success") { //      ContactsList,   var contactsJsonList = (List&lt;ContactsList&gt;) JsonConvert.DeserializeObject(contactsResponse["data"].Trim(), typeof (List&lt;ContactsList&gt;)); foreach (var key in contactsJsonList) { //      var row = dataTableContactsView.NewRow(); row[0] = Base64Decode(key.Id); row[1] = Base64Decode(key.Title); row[2] = Base64Decode(key.PhoneNumber); row[3] = Base64Decode(key.Email); row[4] = Base64Decode(key.Messengers); dataTableContactsView.Rows.Add(row); } } //   ,   ,    else { MessageBox.Show(contactsResponse["data"].Trim(), @"", MessageBoxButtons.OK, MessageBoxIcon.Error); } }</span></span></code> </pre><br><br>  That's basically it.  Under all successful conditions (there is a server, a handler is written for the request, there is a response from the server, there is data in the database) the form will display the data we need. <br><br>  By a similar principle, you can build any other table application.  Look like that's it.  I hope that I have not forgotten anything to describe and that the material is described fairly accessible and simple. <br><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/236029/">https://habr.com/ru/post/236029/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../236009/index.html">Startup Country</a></li>
<li><a href="../236011/index.html">Reprinting books from the New Science series</a></li>
<li><a href="../236021/index.html">Analysis of rendering through Skia Debugger: how to find the most expensive elements to draw</a></li>
<li><a href="../236023/index.html">Fujitsu Improves Protection and Quality Management of Disk Arrays</a></li>
<li><a href="../236027/index.html">Marketing: what is not taught in school</a></li>
<li><a href="../236031/index.html">Group order of printed circuit boards - myths and reality</a></li>
<li><a href="../236033/index.html">The third annual Russian AI Cup championship has begun.</a></li>
<li><a href="../236035/index.html">Game "life", Chaos, "black swan", ethnogenesis and how it all is connected</a></li>
<li><a href="../236037/index.html">Entity Framework Code First in practice</a></li>
<li><a href="../236039/index.html">Exhibition 3D PrintShow in London. Industry - a gold mine or a ghost hunt?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>