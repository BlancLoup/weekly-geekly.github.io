<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SharePoint 2013/2016 Monitoring: Key Performance Counters</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! My name is Lyubov Volkova, I am a systems architect in the business solutions development department. My main specialization is implementation,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SharePoint 2013/2016 Monitoring: Key Performance Counters</h1><div class="post__text post__text-html js-mediator-article">  Hello!  My name is Lyubov Volkova, I am a systems architect in the business solutions development department.  My main specialization is implementation, development of solutions, technical support for corporate SharePoint portals.  Years of experience allows us to identify the main patterns that affect the performance of servers that are part of a typical farm. <br><br>  The purpose of this post is to help the administrators of the corporate SharePoint portals in developing effective server maintenance plans.  The text below summarizes the performance counters that we recommend for inclusion in the daily maintenance plans for the SharePoint 2013/2016 farm servers, as well as practical examples.  You can use meter data to manually configure and analyze indicators of the express monitoring dashboard, as well as automate the receipt of notifications if the counters exceed threshold values ‚Äã‚Äãduring a period of time depending on the requirements and standards adopted by the organization. <br><br><img src="https://habrastorage.org/files/de9/d01/552/de9d015521504872956943a180793d54.jpg"><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  <font color="#2e74b5">System counters</font> </h2><br>  There are several universal performance counters that should be monitored for any server system that is part of a SharePoint farm. <br><br><h3>  <font color="#2e74b5">CPU</font> </h3><br><h4>  <font color="#1f4d78">% Processor Time (_Total) \% Processor Time</font> </h4><br>  The amount of time the processor spends processing all command streams, except idle.  This value is equal to the difference between 100% and the percentage of time that the processor spends on the idle thread.  (An idle instruction flow takes up processor working time in the absence of other instruction flows.) This counter is the main indicator of processor utilization.  It shows the average processor occupancy during the measurement interval. <br><br>  It is necessary to monitor performance and maintain the load of all processors at a level no higher than 75%.  At higher levels of workload, the system will not be able to cope with sudden bursts of activity.  It will also avoid the domino effect when a failure of one component causes a failure of other components.  For example, if you have three web servers, you need to make sure that the average CPU usage on all servers is less than 60% so that in case of failure of one of them, the other two processors can handle the additional load. <br><br><h4>  <font color="#1f4d78">Interrupts / sec (Interrupts / sec)</font> </h4><br>  The average speed, in events per second, at which the processor receives and maintains hardware interrupts.  This value does not include pending procedure calls, which are counted separately.  This value is an indirect indicator of the activity of devices that form hardware interrupts, such as the system timer, mouse, disk drivers, data lines, network adapters and other peripheral devices.  These devices usually interrupt the processor when it completes its work or when it is necessary to process a request.  In this case, the normal execution of the command stream is suspended.  The system timer typically interrupts the processor every 10 milliseconds, creating a 'background' of hardware interrupts.  Therefore, this value represents the difference between the values ‚Äã‚Äãof the last two samples divided by the duration of the sample interval. <br><br>  Counter readings are processor dependent;  A suitable starting value is 1,000 interrupts per second.  A significant increase in the value of this counter without a corresponding increase in system activity indicates the presence of problems and may be associated with the operation of a network adapter, disk, or other equipment causing an interrupt. <br><br><h3>  <font color="#2e74b5">System</font> </h3><br><h4>  <font color="#1f4d78">Processor Queue Length</font> </h4><br>  The current length of the processor queue, as measured by the number of waiting threads.  All processors use one common queue, in which threads are waiting to receive processor cycles.  This counter does not include threads that are currently running.  For CPU time, there is one queue even on computers with multiple processors.  Therefore, if a computer has several processors, you need to divide this value by the number of processors that serve the load. <br><br>  This counter reflects the current value and is not an average value over a certain time interval. <br><br>  A continuous processor queue of less than five threads per processor is generally acceptable, and also depends on the workload.  Values ‚Äã‚Äãabove the threshold typically indicate processor overload. <br><br><h3>  <font color="#2e74b5">Process</font> </h3><br><h4>  <font color="#1f4d78">Working Set for _Total instance</font> </h4><br>  Shows the current cache size of the working set of the process (in bytes).  A working set is a set of memory pages that were recently used by process threads.  If the amount of free memory on the computer exceeds the threshold, unused pages are stored in the working set of the process event.  When the amount of free memory falls below the threshold, the pages are removed from the working sets.  If they are required, they will be transferred to the working set when resolving the RAM error, before being unloaded from the RAM. <br><br>  This counter can indicate system-wide problems as well as problems associated with a specific process.  A significant increase or decrease in the size of working sets leads to paging. <br><br>  The recommended setting for the paging file is ‚ÄúRAM + 10‚Äù. <br><br>  If deletion from the working sets occurs, you need to add the Process (*) \ Work Set counter to find out which processes are affected by the problem. <br><br>  It is recommended to additionally compare the readings of this counter with the value of the ‚ÄúMemory \ Resident Bytes of the System Cache‚Äù counter to determine whether system-wide deletion of pages from working sets does not occur. <br><br><h4>  <font color="#1f4d78">% Processor Time (% Processor Time) for SharePoint Processes</font> </h4><br>  The readings of this counter must be analyzed together with the data of the CPU \% Processor Processor counter for the _Total object.  If the load of all processors exceeds the threshold values, then the ASP.Net process load data will determine if this process is the source of the problem. <br><br>  SharePoint processes that are recommended to include in monitoring: <br><br><ul><li>  w3wp; </li><li>  mssearch; </li><li>  noderunner; </li><li>  miiserver. </li></ul><br><h4>  <font color="#1f4d78">Private Bytes for SharePoint Processes</font> </h4><br>  Shows the current number of bytes allocated to a process that cannot be shared with other processes. <br><br>  This counter can be used to detect memory leaks for processes. <br><br>  For SharePoint processes, the value of this counter is compared with the cache size for these same processes to determine if there is a memory leak.  The increase in the number of bytes of exclusive use for the process, accompanied by the same increase in its cache, indicates the correct behavior (memory leaks do not occur). <br><br><h4>  <font color="#1f4d78">Virtual Bytes for SharePoint Processes</font> </h4><br>  Shows the amount of virtual address space (in bytes) that the process is currently using. <br><br>  It is used to determine if processes use a large amount of virtual memory. <br><br><h4>  <font color="#1f4d78">Thread count (Handle Count) for w3wp process</font> </h4><br>  The number of threads in this process that are currently active.  Values ‚Äã‚Äãabove 2000 require increased attention from the system administrator, and 10,000 is a threshold value at which there can already be a noticeable decline in IIS performance, and as a result, the work of the corporate portal. <br><br><h3>  <font color="#2e74b5">Network adapter</font> </h3><br><h4>  <font color="#1f4d78">Bytes Total / sec (Bytes Total / Sec)</font> </h4><br>  The speed of sending and receiving data through the network adapter.  If this rate exceeds 40-50 percent of network bandwidth, additional clarification of the reasons may be required. <br><br><h3>  <font color="#2e74b5">Logical drive (Disk)</font> </h3><br><h4>  <font color="#1f4d78">Average disk queue length (Avg. Disk Queue Length)</font> </h4><br>  Average queue length for disk requests.  Displays the number of disk requests waiting to be processed within a specified time interval.  A normal queue is considered to be no more than 2 for a single disk.  If there are more than two requests in the queue, then the disk is probably overloaded and does not have time to process incoming requests.  To clarify exactly what operations the disk cannot cope with, you can use the counters ‚ÄúAverage number of read requests‚Äù and ‚ÄúAverage length of the write queue to disk‚Äù. <br><br><h4>  <font color="#1f4d78">Average disk read queue length (Avg. Disk Read Queue Length)</font> </h4><br>  The average number of read requests that were queued for the corresponding disk during the measurement interval. <br><br><h4>  <font color="#1f4d78">Avg. Disk Write Queue Length (Avg. Disk Write Queue Length)</font> </h4><br>  The average number of write requests that were queued for the corresponding disk during the measurement interval. <br><br><h4>  <font color="#1f4d78">Disk read speed (bytes / sec) (Disk Reads / sec)</font> </h4><br>  The speed at which data is transferred from this disk when performing read operations. <br><br><h4>  <font color="#1f4d78">Disk Write Speed ‚Äã‚Äã(Bytes / sec) (Disk Writes / sec)</font> </h4><br>  The speed at which data is transferred to this disk during write operations. <br><br><h4>  <font color="#1f4d78">An example of meter reading on the disk subsystem</font> </h4><br><table><tbody><tr><th>  Average disk queue length </th><th>  The average length of the disk read queue </th><th>  The average length of the write queue to disk </th><th>  Disk read speed (bytes / s) </th><th>  Disk write speed (byte / s) </th></tr><tr><td>  0.015 </td><td>  0,004 </td><td>  0.011 </td><td>  0.723 </td><td>  9,578 </td></tr></tbody></table><br>  Based on the values ‚Äã‚Äãof the counters, it can be concluded that the load on the disk system is minimal and is not a bottleneck of the system. <br><br><h3>  <font color="#2e74b5">Memory</font> </h3><br><h4>  <font color="#1f4d78">Available MB (Available Mbytes)</font> </h4><br>  This counter shows the amount of physical memory available for allocation.  If there is not enough memory, the page file will be used more intensively, and the number of page errors per second will increase.  If the value of this counter is less than 2 GB on the web server, you need to kill the memory. <br><br><h4>  <font color="#1f4d78">% utilization of allocated memory (% committed bytes in use)</font> </h4><br>  The percentage of committed memory (committed bytes) to the committed memory limit (committed limit).  This value reflects the actual amount of available virtual memory.  Please note that the limit of allocated memory can be changed if the paging file (page file) is increased.  This value is a specific current value, and is not an average value over a certain time interval. <br><br>  Threshold: 70% for warning, more than 90% is critical.  At elevated values, it is enough to increase the amount of memory. <br><br><h4>  <font color="#1f4d78">Page errors / sec (Page Faults / sec)</font> </h4><br>  The counter shows the average number of page faults per second.  Measured by the number of failed page reads per second.  Page errors occur in the case when the process of requesting a page in memory occurs, and then the system cannot find it in the requested location.  If the requested page is not found in memory, this error is called <i>soft page fault</i> .  If the requested page needs to be restored from disk, this error is called a <i>hard page fault</i> . <br><br><h4>  <font color="#1f4d78">Input Pages / sec (Pages Input / sec)</font> </h4><br>  Input pages / sec is the number of pages read from the disk when resolving links to pages that are not in memory at the time the link is processed.  A page error occurs when a thread refers to a virtual memory page that is not in the working set of RAM.  This counter also takes into account the paging (page exchange) performed by the system cache to access data requested by applications.  This is an important source of information for identifying excessive load on memory and the resulting excessive paging.  The recommended warning threshold is 1000. <br><br><h4>  <font color="#1f4d78">Read pages / sec (Page Reads / sec)</font> </h4><br>  The counter value shows how many reads per unit of time, regardless of the pages, were done while processing page breaks.  This counter indicates that the working set of the process is too large for physical memory, and paging occurs with the disk.  Displays only the number of reads, excluding the number of pages extracted for each operation.  Large readings indicate a memory bottleneck.  Excessive pumping can lead to slower response and instability. <br><br>  Counters Input pages / sec and Read pages / sec should be considered together.  The first one contains the number of pages read from the disk, and the second the number of read operations performed during swapping.  These counters take into account Hard Page Faults - memory access operations, in which the page of data you are looking for is not in physical memory.  Thus, if the Exchange Pages / sec, Reading pages / sec, Page Entry / sec are constantly at a high level, it can be assumed that the operating system is actively working with the paging file, which, in turn, indicates a lack of memory.  Input of pages / sec. Value of this counter must be higher or equal to the value of Read pages / sec. <br><br><h4>  <font color="#1f4d78">Cache Faults / Cache Errors</font> </h4><br>  This counter shows the frequency of errors when searching for a page in the file system cache.  This may be a software error if the page is found in memory, or a hardware error if the page is on disk. <br><br>  Active use of the cache for read and write operations can greatly affect server performance.  It is necessary to monitor the increase in the number of cache errors, which is indicated by a decrease in the value of <b>Asynchronous fast reads / s</b> or <b>Forward Readings / s</b> . <br><br><h4>  <font color="#1f4d78">Exchange pages / sec (Pages / sec)</font> </h4><br>  The speed of reading and writing pages to disk to resolve serious page failures.  This value is the sum of the Input pages / sec and Page output / sec values.  Counter readings are the main indicator of the types of failures that cause delays in the entire system.  It shows the number of pages received to compensate for page failures in the file system cache.  These pages are usually required by applications.  The value of this counter must not exceed 10. <br><br><h4>  <font color="#1f4d78">Byte in non-paged pool (Pool Nonpaged Bytes)</font> </h4><br>  The size (in bytes) of the non-paged pool.  A non-paged pool is a virtual memory area used for objects that cannot be written to disk and must remain in physical memory for the duration of its existence.  This counter reflects only the current, not the average. <br><br>  Requests for the allocation of space in a special system memory, where the components of the operating system request the space they need to function.  The pages of a non-paged page pool cannot be uploaded to the paging file (page file) on the disk and remain in RAM for the entire period of their use.  This counter reflects the current value, and is not an average value over a certain time interval. <br><br>  Counter readings should not exceed the minimum of two values ‚Äã‚Äã- 2x RAM and 128 GB. <br><br><h4>  <font color="#1f4d78">General recommendations for the analysis of indicators of memory counters</font> </h4><br>  If \ Memory \ Exchange pages / s, \ Memory \ Read pages / s, Memory \ Pages input / s are always at a high level, and \ Memory \ Cache errors / c on a low level, then we can assume that the operating system is active works with the page file, which, in turn, indicates a lack of memory.  However, if \ Memory \ Cache Errors / s is also high, then, most likely, the situation is caused by active work with large files being mapped to memory.  Usually it does not take much time. <br><br><h4>  <font color="#1f4d78">Example of indications of memory counters</font> </h4><br><table><tbody><tr><th>  MB available </th><th>  % used <br>  assignment of selected <br>  of memory </th><th>  Page errors <br>  /with </th><th>  Entering pages <br>  /with </th><th>  Reading pages <br>  /with </th><th>  Page Exchange <br>  /with </th><th>  Byte in un- <br>  load- <br>  eme pool </th></tr><tr><td>  6312,758 </td><td>  65 </td><td>  605,378 </td><td>  15,936 </td><td>  1,105 </td><td>  15.995 </td><td>  115352406 </td></tr></tbody></table><br>  Indicators of the average amount of physical memory is normal.  Indications to increase its volume is not.  The average percentage of the used physical memory is normal (65%), but approaches the threshold value of 70%. <br><br>  Relatively high error rates are observed when accessing memory pages in combination with a small number of read operations performed during swapping.  Counter reading Page input / sec is normal and well below the threshold value.  The counter values ‚Äã‚ÄãExchange pages / sec (15+) exceed the threshold value 10. It can be assumed that the system periodically actively uses the paging file.  One of the most common reasons for this behavior of the system is uploading large volumes of files to the portal. <br><br><h3>  <font color="#2e74b5">Page file</font> </h3><br><h4>  <font color="#1f4d78">% of use (% Used)</font> </h4><br>  The percentage of paging file (page file) currently used. <br><br><h4>  <font color="#1f4d78">% use (peak) (% Used Peak)</font> </h4><br>  Maximum use of the paging file (page file) in percent. <br><br>  The server paging file, also known as the paging file, contains ‚Äúvirtual‚Äù memory addresses on the disk.  Page errors occur when the process needs to be stopped and wait until the necessary ‚Äúvirtual‚Äù resources are copied from disk to memory.  They will be more if the amount of physical memory is not enough. <br><br>  Note that for SharePoint it is recommended to configure the paging file size to be 150% of the RAM.  The absolute minimum should be the value of RAM + 1 MB. <br><br>  Track the amount of physical memory available for allocation.  If there is not enough memory, the page file will be used more intensively, and the number of page errors per second will increase. <br><br><h2>  <font color="#2e74b5">Performance counters on SharePoint servers</font> </h2><br><h3>  <font color="#2e74b5">ASP.Net and ASP.Net Application</font> </h3><br><h4>  <font color="#1f4d78">ASP.Net.</font>  <font color="#1f4d78">Application Restarts</font> </h4><br>  The number of times the application has restarted during the lifetime of the web server.  The value of this counter increases after each occurrence of the Application_OnEnd event (shutdown of the web application).  Restarting an application can occur as a result of changes in the Web.config file, changes in assemblies in the \ Bin directory of the application, or a large number of changes to the web form pages.  An unexpected increase in this value may be due to the fact that the shutdown of the web application occurred as a result of unforeseen circumstances.  In this case, it is necessary to analyze the causes of the problems as soon as possible.  The value of this counter should tend to zero. <br><br><h4>  <font color="#1f4d78">ASP.Net.</font>  <font color="#1f4d78">Requests Rejected</font> </h4><br>  The total number of requests rejected because the request queue was full.  Rejection of requests is often performed due to lack of server resources to process them.  This value corresponds to the number of HTTP error codes returned 503, meaning that the server is busy.  Examples of the causes of resource deficiencies: a large number of requests to the web server, a large number of slow requests (non-optimized) to the DBMS, do not correctly work out the components of the solutions written by third-party developers.  Thus, in order to identify the cause of the shortage of resources on the server and eliminate it, you need to carry a more detailed analysis of the web server using additional tools. <br><br><h4>  <font color="#1f4d78">ASP.Net.</font>  <font color="#1f4d78">Requests Queued</font> </h4><br>  The MS SharePoint web application provides standard blocks for HTML pages that are displayed in the user's browser via HTTP and require prior data acquisition and processing (web parts, user controls, etc.).  To prepare the final result of data processing, which is provided to the user on the corporate portal's web page, one or several requests to the database, file system, etc. may be required. This counter shows the number of requests waiting to be processed.  The maximum default value for this counter is 5000. You can change this setting in the Machine.config file.  The value of this counter should not exceed 70-75% of the threshold value, i.e.  3500-3750. <br><br><h4>  <font color="#1f4d78">ASP.Net.</font>  <font color="#1f4d78">Worker Process Restarts</font> </h4><br>  The number of restarts in the server workflow.  The workflow can be restarted when an unexpected error occurs or during deliberate actions.  The same reasons for restarting the workflow can be: high memory consumption by the application and CPU load, restarting is defined in the application pool settings.  In the case of frequent workflow reloads, the response of the web resource, when the user accesses, will take a long time. <br><br>  The value of this counter should tend to zero. <br><br><h4>  <font color="#1f4d78">ASP.Net.</font>  <font color="#1f4d78">Request Wait Time</font> </h4><br>  The last request waiting in the queue for processing in milliseconds.  As the number of wait events increases, users will notice a decrease in performance when displaying web pages.  As the number of wait events increases, users will notice a decrease in performance when pages are displayed. <br><br><h4>  <font color="#1f4d78">ASP.Net application.</font>  <font color="#1f4d78">Requests / Sec (Requests / Sec)</font> </h4><br>  The number of queries executed per second.  Represents the current application bandwidth.  At constant load, this number should remain in a certain range, prohibiting other server work (such as garbage collection, cache flush stream, external server facilities, etc.). <br><br><h4>  <font color="#1f4d78">Example of ASP.Net meter readings and ASP.Net Application</font> </h4><br><table><tbody><tr><th>  Application restarts </th><th>  Requests Rejected </th><th>  Requests Queued </th><th>  Worker Process Restarts </th><th>  Request Wait Time </th><th>  Requests / Sec </th></tr><tr><td>  2.175 </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  0.153 </td></tr></tbody></table><br>  Data indicators of almost all ASP.Net counters tend to zero in combination with small values ‚Äã‚Äãof the number of requests per second.  You should pay attention to the high number of restarts of the web application (Application Restarts counter).  It can be assumed that users periodically experience problems with the availability of a web resource, so the administrator of the corporate portal needs to find out and eliminate the causes of frequent failures in the operation of the web application. <br><br><h3>  <font color="#2e74b5">Memory CLR .Net (Memory CLR .Net)</font> </h3><br><h4>  <font color="#1f4d78">Garbage fees</font> </h4><br>  Generation 0 garbage collection (# Gen 0 Collections) is the number of extraction of generation 0 objects (i.e. last added objects) by the garbage collector since the application started. <br><br>  Generation 1 garbage collection (# Gen 1 Collections) is the number of generation 1 objects retrieved by the garbage collector since the application started. <br><br>  Generation 2 garbage collection (# Gen 2 Collections) is the number of generation 2 objects retrieved by the garbage collector since the application started.  This counter is incremented by 1 after trash collection for generation 2 is completed (also called full garbage collection). <br><br>  When monitoring, it is necessary to pay attention to the ratio of ‚Äúgarbage collection for generation 0: garbage collection for generation 1: garbage collection for generation 2‚Äù, ensure that the number of garbage collection for generation 2 does not greatly exceed the number of collection fees for generation 0. The optimal ratio is 2 <br><br><h4>  <font color="#1f4d78">% time in GC (% Time in GC)</font> </h4><br>  Displays the percentage of time spent collecting garbage from the last garbage collection cycle.  This counter usually indicates the work done by the garbage collector to extract and compress memory on behalf of an application.  This counter is updated only at the end of each garbage collection.  This counter shows not the average, but the last observed value.  In normal mode, the counter value should not exceed 5%. <br><br><h3>  <font color="#2e74b5">CLR.Net Exceptions (Microsoft .NET CLR Exceptions)</font> </h3><br><h4>  <font color="#1f4d78">The number of exceptions.sec (Exceps thrown / sec)</font> </h4><br>  The number of exceptions generated per second.  This counter counts both processed and unhandled exceptions.  It is assumed that exceptions occur only in rare cases and do not occur during the normal course of the program;  This counter was introduced to signal potential performance problems in cases where the frequency of exception generation is too large (&gt; 100).  This counter does not provide averaging over time;  it shows the ratio of the difference between the values ‚Äã‚Äãobserved in the last two measurements to the interval between measurements. <br><br>  The value of this counter should tend to zero. <br><br><h4>  <font color="#1f4d78">Web Service</font> </h4><br>  The readings of the counters from this group are considered in relation to a specific object instance, the corporate portal web application, for example, ‚ÄúSharePoint - 80‚Äù. <br><br><img src="https://habrastorage.org/files/e84/228/790/e842287903c745e8b70a114ddb42896c.png"><br><br><h4>  <font color="#1f4d78">Number of current connections</font> </h4><br>  The number of connections to the web service that are currently installed.  The higher the value, the greater the load on the SharePoint server. <br><br><h4>  <font color="#1f4d78">Number of ISAPI Extension Requests Per Second (ISAPI Extension Requests / sec)</font> </h4><br>  <b>ISAPI</b> (Internet Server Application Programming Interface) is a set of interfaces provided by the MS IIS (Internet Information Services) web server for writing applications that interact with this server and expand its capabilities.  ISAPI applications are dynamic link libraries (Dynamic Link Library, DLL) that interact directly with the IIS API.  ISAPI applications are loaded and executed in the IIS address space, so the server does not need to create a new process for each HTTP request.  Since Windows loads the dynamic link library once the first time the function is called in the DLL, the ISAPI application remains loaded and is not deleted until the web server is stopped / turned off (if ISAPI caching is enabled) or the application is not explicitly unloaded (if turned off). <br><br>  The meter reading provides an indication of the frequency of ISAPI extension requests received by the web service. <br><br><h3>  <font color="#2e74b5">SharePoint Foundation Counters</font> </h3><br><h4>  <font color="#1f4d78">SQL Query Executing time</font> </h4><br>  The counter shows the average execution time of SQL queries.  The return value should be as low as possible.  The readings of this counter are significantly affected by the data on the load on the basic subsystems and their physical characteristics (memory, processor, network, disk devices).  The readings of this meter are also affected: <br><br><ol><li>  Non-optimized execution plans for T-sql queries that may be involved in the solution code; </li><li>  Calling the stored procedures with the help of which various activities can be generated for the portal user; </li><li>  The degree of index performance optimization. </li></ol><br><h4>  <font color="#1f4d78">Executing SQL Queries</font> </h4><br>  The counter returns the number of currently running SQL queries.  The value of the counter essentially depends on the specifics of the functionality implemented on the portal.  The analysis of values ‚Äã‚Äãmust necessarily be carried out taking into account the specifics of processing the content: working with base lists and libraries, using groupings and filters in data representation, substitution fields, accessing lists with external data, processing requests to external data sources or processing lists with large numbers elements and more. <br><br><h4>  <font color="#1f4d78">Executing Time / Page Request</font> </h4><br>  The counter returns the average execution time (in ms) of requests for web pages that were processed during data collection.  Statistics includes data about the request for dynamic web pages, the construction of which is provided by ASP.Net. <br><br><h4>  <font color="#1f4d78">Current Page Requests</font> </h4><br>  The counter value indicates the number of current requests that are being processed.  They can differ significantly in different periods and depend on the current number of calls to the SharePoint portal.  The most important is the analysis of readings during peak hours in combination with indicators of the average execution of web page requests (Executing Time / Page Request) and data on the number of currently running SQL queries. <br><br><h4>  <font color="#1f4d78">Reject Page Requests Rate</font> </h4><br>  The percentage of pages that were rejected when they were requested.  The return value should be as low as possible, because  indicates that the pages were not requested from the cache and required the execution of a full cycle of the request for a web page on the server. <br><br><h4>  <font color="#1f4d78">Incoming Page Requests Rate</font> </h4><br>  The counter value displays the number of incoming requests in the last second.  Similar to Current Page Requests in relation to a strictly defined time interval - 1s. <br><br><h4>  <font color="#1f4d78">Active threads</font> </h4><br>  The counter returns the number of threads currently running in the SharePoint code.  Indicators depend on many factors: the processor and its characteristics, indicators on the basic subsystems (memory, processor, network, disk devices), the current load on the portal.  The initiation of additional streams can be initiated programmatically in the code as part of solutions for the SharePoint platform. <br><br><h4>  <font color="#1f4d78">Example of SharePoint Foundation Counters</font> </h4><br><table><tbody><tr><th>  SQL Query Executing time </th><th>  Executing SQL Queries </th><th>  Executing Time / Page Requests </th><th>  Current Page Request </th><th>  Reject Page Requests Rate </th><th>  Incoming Page Requests Rate </th><th>  IActive Threads </th></tr><tr><td>  0.048 </td><td>  0.051 </td><td>  0.197 </td><td>  1,581 </td><td>  0 </td><td>  0.396 </td><td>  1,595 </td></tr></tbody></table><br>  Based on the average readings from the SharePoint Foundation counters, it can be assumed that during the operation of the corporate portal, there is no high load associated with user access to the web server. <br><br><h2>  <font color="#2e74b5">SQL Server Monitoring</font> </h2><br><h3>  <font color="#2e74b5">Disk Subsystem Monitoring</font> </h3><br>  Microsoft SQL Server uses calls to the system I / O functions of the Microsoft Windows Server operating system to perform disk read and write operations.  SQL Server determines when and how to perform disk I / O operations, but the basic I / O operations are performed by the Windows operating system. <br>  The following describes the minimum set of counters that we recommend monitoring in daily service plans. <br><br><h4>  <font color="#1f4d78">Physical Disk \ Average Disk Read Time (Physical Disk \ Avg. Disk sec / read)</font> </h4><br>  The time in seconds spent on average per disk read operation.  Shows the average time to complete a disk read operation.  Basic indicators of this counter should not exceed 15 ms.  If the reading time on average exceeds this value for quite a long time, this may indicate that there are problems in the I / O device. <br><br><h4>  <font color="#1f4d78">Physical Disk \ Average Disk Write Time (Physical Disk \ Avg. Disk sec / write)</font> </h4><br>  The average recording time on a disk is the time in seconds spent on average per one operation of writing data to a disk.  Basic indicators of this counter should not exceed 15 ms. <br><br>  The Counters ‚ÄúAverage Disk Read Time‚Äù and ‚ÄúAverage Disk Write Time‚Äù measure wait times directly in the software add-on where the storage device disks are accessible to the operating system.  They allow you to accurately measure how much time the disks and hardware environment spent on servicing I / O requests, regardless of what hardware and software were involved. <br><br>  For OLTP systems, the average value should be less than 15 ms with valid peaks up to 25 ms.  The less time it takes to read or write data, the faster the system will function. <br><br><h3>  <font color="#2e74b5">CPU Control</font> </h3><br>  Controlling an instance of Microsoft SQL Server allows you to determine whether CPU utilization levels are in standard ranges.  A consistently high level of CPU usage may indicate the need for a CPU upgrade or the need to add multiple processors.  Optimizing application performance can reduce CPU utilization.  The processor system is most loaded with operations: <br><br><ul><li>  compiling and recompilation of execution plans; </li><li>  sorting; </li><li>  hashing. </li></ul><br>  Below is a description of meters that we recommend monitoring in daily service plans. <br><br><h4>  <font color="#1f4d78">&lt;SQL Server Instance&gt; SQL Statistics \ SQL Compilations / sec</font> </h4><br>  SQL compilations done in seconds.  Specifies the number of times the code compilation path was entered.  Includes compilation operations caused by instruction-level recompilation in SQL Server.  The SQL Server SQL Statistics in Microsoft SQL Server object provides counters to monitor the compilation and types of queries sent to an instance of SQL Server.  Monitoring the number of compilations and re-compilations of queries and the number of batches received by an instance of SQL Server gives an idea of ‚Äã‚Äãhow quickly SQL Server responds to users and how efficiently the query optimizer processes them.  Compilation takes a significant amount of time in processing a request.  To save on compilation costs, the Database Engine stores the compiled query plan in the query cache.  The purpose of caching is to reduce the number of compilations by storing already compiled queries for further reuse, eliminating the need to recompile similar queries that may come later.  However, each unique query must be compiled at least once.  Compiling queries can be caused by the following factors: <br><br><ul><li>  Changes to the schema, including basic changes (adding columns or indexes to a table) or a statistical diagram (inserting or deleting a significant number of rows in the table); </li><li>  Environment change (SET instruction).  Changes to session parameters (for example, recompiling a query may result in the ANSI_PADDING or ANSI_NULLS clause). </li></ul><br><h4>  <font color="#1f4d78">&lt;SQL Server Instance&gt; SQL Statistics \ Batch Requests / sec</font> </h4><br>  The counter indicates the number of streams received from the operating system schedulers (not from the SQL schedulers) to perform operations for other threads in the idle state.   ¬´Batch Requests/sec¬ª   ,   5000      .               . <br><br><h4> <font color="#1f4d78">&lt; SQL Server&gt;SQL Statistics\SQL ReCompilations/sec</font> </h4><br>     .     ,  . <br><br><h4> <font color="#1f4d78">&lt; SQL Server&gt;Access Methods\Workfiles Created/sec. Workfiles</font> </h4><br> Workfiles ‚Äî     ,     SQL Server. SQL Server   Workfiles         .    Workfiles      ,    SQL Server     ,          .    Workfiles Created/sec  Batch Requests/sec    20%. Workfiles       ,        . <br><br><h4> <font color="#1f4d78">\   (Processor\Processor Queue Length)</font> </h4><br>   ,    .   SQL Server       ,         .   SQL Server   ,          .  ,     ,   SQL Server,     . <br><br><h4> <font color="#1f4d78">    </font> </h4><br><table><tbody><tr><th> Batch Requests <br> /sec </th><th> SQL Compilations <br> /sec </th><th> SQL ReCompilations <br> /sec </th><th> Workfiles Created <br> /sec </th><th> Processor Queue Length </th></tr><tr><td> 19,998 </td><td> 0,675 </td><td> 0,006 </td><td> 1,267 </td><td> 0,151 </td></tr></tbody></table><br>  ,          : <br><br><ul><li>   SQL Compilations/sec  Batch Requests/sec <br> 0,6/19 = 0.03 <br> ,   3%       .    ,        .   SQL Compilations/sec    10%   Batch Requests/sec.    . </li><li>   SQL ReCompilations/sec  SQL Compilations/sec <br> 0,006/0,6 = 0.01 <br> ,   1%       .   SQL Recompilations/sec    10%   SQL Compilations/sec.    . </li><li>   Workfiles Created/sec  Batch Requests/sec <br> 1/19 = 0.05 <br>    . </li></ul><br><table><tbody><tr><th> Batch Requests/sec </th><th>  SQL Compilations/sec  Batch Requests/sec </th><th>  SQL ReCompilations/sec  SQL Compilations/sec </th><th>  Workfiles Created/sec  Batch Requests/sec </th></tr><tr><td>         </td><td> 0,034 </td><td>  0.01 </td><td>  0.06 </td></tr><tr><td>    </td><td>   0.1 </td><td>   0.1 </td><td>   0.2 </td></tr><tr><td>      </td><td>  Yes </td><td>  Yes </td><td>  Yes </td></tr></tbody></table><br><h3> <font color="#2e74b5">  </font> </h3><br><h4> <font color="#1f4d78">   </font> </h4><br>  , SQL Server      ,     . <br><br>  SQL Server   ,      ,  ,     ,   .   SQL Server    ,   ,      .      ,      Memory: Available Bytes  100...50 MB Windows    (trimming)   ,   ,         .              Min Server Memory  Max Server Memory. <br><br>           SQL Server,    SQL,        SharePoint. <br><br>   b6s SQL  2147483647 Mb,   SQL Server     ‚Äì 96 GB. <br><br><img src="https://habrastorage.org/files/70d/7b9/1f9/70d7b91f98e44dba9e3474de05a50e46.png"><br><br>   Max Server Memory   (   SQL Server) : <br><br> <b>SQL   </b> = <b>TotalPhyMem</b> ‚Äî ( <b>NumOfSQLThreads</b> * <b>ThreadStackSize</b> ) ‚Äî (1GB * ( <b>NumOfCores</b> /4)) ‚Äî <b>RAMOSReserve</b> d ‚Äî <b>RAMForOtherApps</b> , : <br><br><ul><li> <b>TotalPhyMem</b> ‚Äì      . </li><li> <b>NumOfCores</b> ‚Äì -  . </li><li> <b>NumOfSQLThreads</b> ‚Äì - ,         .  -   4  NumOfSQLThreads     256.  -   4    : NumOfSQLThreads = 256 + (NumOfCores- 4) * 8. </li><li> <b>ThreadStackSize</b> = 2   x64.   IA64 ThreadStackSize=4. </li><li> <b>RAMOSReserved</b> ‚Äì    . 20%    TotalPhyMem   15   12,5%   . </li><li> <b>RAMForOtherApps</b> ‚Äì     SQL-  . </li></ul><br><img src="https://habrastorage.org/files/42b/cd8/71d/42bcd871d016426c974c0bf7fca1fc50.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> You can get information about the processors and the amount of physical memory on the server using the following script: </font></font><br><br><pre><script type="text/javascript">function gtElInit() {var lib = new google.translate.TranslateService();lib.translatePage('ru', 'en', function () {});}</script><script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=gtElInit&amp;client=wt"></script><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> cpu_count <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Logical</span></span> CPU <span class="hljs-keyword"><span class="hljs-keyword">Count</span></span>] , hyperthread_ratio <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Hyperthread Ratio] , cpu_count / hyperthread_ratio <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Physical</span></span> CPU <span class="hljs-keyword"><span class="hljs-keyword">Count</span></span>] , osi.physical_memory_kb / <span class="hljs-number"><span class="hljs-number">1024</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Physical</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Memory</span></span> (MB)] , sqlserver_start_time <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.dm_os_sys_info <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> osi;</code> </pre> <br>  For b6s, the calculations will be as follows: <br><br><ul><li>  <b>TotalPhyMem</b> = 98276 MB. </li><li>  <b>NumOfCores</b> = 32. </li><li>  <b>NumOfSQLThreads</b> = 256 + ( <b>32-4</b> ) * 8 = 480. </li><li>  <b>ThreadStackSize</b> = 2 MB. </li><li>  <b>RAMOSReserve</b> d = 12.5% ‚Äã‚Äã* 98276 MB = 11793 MB. </li><li>  <b>RAMForOtherApps</b> - Customer must determine this value by himself.  In the current calculations, we assume a value of 8,000 MB per second instance of SQL. </li></ul><br>  <b>SQL The maximum size of the RAM</b> = 98276 Mb - (480 * 2 Mb) - (1GB * ROUNDUP (32/4)) - 11793 Mb - 8000 Mb = 98276 Mb - 960 Mb - 8192 Mb - 11793 Mb - 8000 Mb = 69331 Mb. <br><br>  Thus, the size of the buffer pool (with the corresponding value of ‚ÄúMax Server Memory‚Äù) can grow to 69,331 MB, thereby, without affecting the operation of the operating system. <br><br>  The following is a description of counters for monitoring memory used by SQL Server, monitoring of which is recommended to be included in daily monitoring. <br><br><h4>  <font color="#1f4d78">&lt;SQL Server Instance&gt; Memory Node \ Target Server Memory</font> </h4><br>  The meter data provides information about the ideal amount of memory required by the server. <br><br><h4>  <font color="#1f4d78">&lt;SQL Server Instance&gt; Memory Node \ Total Server Memory</font> </h4><br>  The counter data provides information about the amount of memory allocated to the server by the memory manager.  If Total Server Memory is less than Target Server Memory is a sign of low memory. <br><br><h4>  <font color="#1f4d78">&lt;SQL Server instance&gt; Buffer Manager \ Buffer cache hit ratio</font> </h4><br>  The proportion of pages found in the buffer cache without reading from the disk.  This value is defined as the total number of hits in the cache divided by the number of refine cache requests for the last several thousand page access operations.  After a long period, this ratio changes very little.  Since reading from the cache is much faster than from disk, you should strive for the highest value of this indicator. <br><br><h4>  <font color="#1f4d78">&lt;SQL Server Instance&gt; Buffer Manager \ Page Life Expectancy</font> </h4><br>  Specifies the average lifetime of pages in the buffer pool.  The threshold is at least 300 seconds. <br><br><h4>  <font color="#1f4d78">&lt;SQL Server Instance&gt; Memory Manager \ Memory Grants Pending</font> </h4><br>  Indicates the total number of processes awaiting the working memory memory. <br><br><h4>  <font color="#1f4d78">Example of indications of memory usage monitoring counters</font> </h4><br><table><tbody><tr><th>  Target Server Memory (KiV) </th><th>  Total Server Memory (KiV) </th><th>  Buffer cache hit ratio </th><th>  Page Life Expectancy </th><th>  Lazy writes <br>  / sec </th><th>  Memory Grants Pending </th></tr><tr><td>  5312958 </td><td>  3683571 </td><td>  99.92% </td><td>  9,905,712 </td><td>  10,739 </td><td>  0,018 </td></tr></tbody></table><br>  Values ‚Äã‚Äãare within the norm, but it should be noted that Total Server Memory is less than Target Server Memory.  This is usually a sign of low memory, but in this case the situation is different, as SQL Server requests memory as needed.  If the memory requirements are minor, then Total Server Memory will remain much lower than Target Server Memory.  SQL Server Memory Requirements for MS SharePoint Foundation 2013 - 8-16 GB for use in a production environment in a single-server farm ( <a href="https://technet.microsoft.com/en-us/library/cc262485.aspx">more details here</a> ).  Thus, at this time, an increase in memory on the database server is not required. <br><br>  If you get to the end of the text, it means that you are really digging deep into the administration theme of SharePoint Server.  You may have questions that are beyond the scope of this text.  Feel free to ask them in the comments. </div><p>Source: <a href="https://habr.com/ru/post/322940/">https://habr.com/ru/post/322940/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../322930/index.html">Ideal catalog, architecture sketch</a></li>
<li><a href="../322932/index.html">Amazon S3 about three or four hours worked intermittently, Medium, Slack, Coursera, Trello lay</a></li>
<li><a href="../322934/index.html">Competition for the best domain for CDN from King Servers (Updated)</a></li>
<li><a href="../322936/index.html">Four key Linux skills in 2017</a></li>
<li><a href="../322938/index.html">How IT professionals work. Alexander Kozlov, team leader of SimbirSoft</a></li>
<li><a href="../322942/index.html">Open online courses from ITMO University: March version</a></li>
<li><a href="../322944/index.html">Diagnostics servers FirstDEDIC</a></li>
<li><a href="../322946/index.html">How custom solutions helped save on network infrastructure</a></li>
<li><a href="../322950/index.html">So, we made a 150 GB JVM dump. What's next?</a></li>
<li><a href="../322952/index.html">Translation of an interview with Julian Dragos (Scala)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>