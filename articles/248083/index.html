<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How does the exchange test itself?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We all watched the December events. High market volatility, sharp movements in currency rates, stock prices and futures on them were accompanied by an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How does the exchange test itself?</h1><div class="post__text post__text-html js-mediator-article">  We all watched the December events.  High market volatility, sharp movements in currency rates, stock prices and futures on them were accompanied by another factor - the very high activity of the exchange's clients.  Under these conditions, the key task of the exchange is to ensure the continuity of trading and the maximum resiliency of the systems.  We coped with these tasks.  And how are we preparing for peak loads?  Together with market participants, we perform load testing on a regular basis. <a name="habracut"></a><br><br>  Load testing is an opportunity, both for the exchange and for market participants, to determine the maximum permissible loads on the existing technological infrastructure.  The main components of the infrastructure are software and hardware, communication channels, architectural solutions, management processes, support and modernization. <br><br>  On ordinary days, trading volumes, activity of participants, the number of transactions / orders - the level of market data flows and its intensity - change quite smoothly, within well predictable limits.  But sometimes, there are bursts of activity on the market that disrupt the normal course of events.  For example, with the release of important economic news, the number of applications increases by several times, as the market demonstrated in the fall of 2014.  In such cases of abnormal loads, together with the bidders, we must have an adequate margin for the performance of the trading system and the capacity of the communication channels. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The main objectives of testing are formulated as follows: <br>  ‚Ä¢ Simulate peak loads and their influence on the software and hardware complex of the exchange and the participant. <br>  ‚Ä¢ Confirm the ability of the entire complex to process data flow in intensity that exceeds average market indicators by 2-3 times.  That is, to ensure the "margin of safety" of the entire system by 2-3 times. <br>  ‚Ä¢ Align the entire ‚Äúexchange participant‚Äù infrastructure, including the ‚Äúexchange participant‚Äù, ‚Äúexchange provider‚Äù and ‚Äúparticipant provider‚Äù interfaces. <br><br>  Load testing allows you to estimate the approximate amount of data that bidders will receive from us over the coming year.  Brokers, like the stock exchange, based on the analysis of test results, are able to prepare their infrastructure for design loads in a timely manner, adjust further work to optimize the network and trade architecture, and get answers to the questions: ‚ÄúWhere are the bottlenecks?  What infrastructure components need upgrading?  What is the budget for it to allocate?  It is to the solution of the last question that the testing time is tied - autumn. <br><br>  <b>Load, schedule, script</b> <br><br>  The load during testing is created by our own robotic systems created specifically for testing the trading platforms of the exchange.  These simulators are able to create a load profile that corresponds to the real trading, both in the ratio of the bid and bid orders, and in the fluctuations of the price band and other market parameters.  In reality, more than 90% of orders are removed by the clients themselves within milliseconds - this is the reality of algorithmic trading, but the load on the system from the order that does not lead to a transaction does not disappear anywhere.  ‚ÄúThis is how robots torture us with their garbage, no profit, and everyone has to modernize the infrastructure because of them,‚Äù our IT scoffs. <br><br>  Similar machines are being prepared for testing by brokers and vendors of trading software.  This year, the load ratio was 50 to 50 between the exchange and bidders.  In total, more than 70 professional market participants and vendors took part in testing this year. <br><br>  The total duration of testing is 4 hours - in which the schedule of the real trading day fully complies with a break in the clearing session.  Target numbers of orders for each market exceed the current average daily values ‚Äã‚Äãof 1.5-2 times.  Three markets are tested on two technology platforms with the maximum number of applications per session: <br>  ‚Ä¢ Stock Market (ASTS) - 30 000 000 <br>  ‚Ä¢ Foreign exchange market (ASTS) - 30 000 000 <br>  ‚Ä¢ Derivatives market (SPECTRA) - 60 000 000 <br><br>  Before testing, all access servers are connected to the trading platforms.  And as the load increases, servers that are unable to cope with it are registered in the test. <br><br>  During testing, the load is created 2-3 times higher than the peak frequency of applications of the real market in seconds intervals, but not reaching the limits of the trading platforms.  Direct measurement of the marginal performance of the platforms and their subsystems is carried out briefly at the final stage of the test, so that the results obtained by measuring the delays are not distorted by the resulting queues for processing applications. <br><br>  In addition to the trading platforms themselves, services and subsystems that are critical to loads and actively used by trading participants and their clients are tested: <br><br>  ‚Ä¢ Index servers. <br>  ‚Ä¢ Website and related information services. <br>  ‚Ä¢ FIX udp multicast marketdata servers. <br>  ‚Ä¢ FIX transactional servers. <br><br>  In testing, switching to backup systems and communication channels is simulated, which is also important for bidders.  They can work out these procedures and, if necessary, localize bottlenecks on their side. <br><br>  <b>Important</b> <br><br>  Exchange - a huge conglomerate of networks with complex architecture.  Currently, the hardware and software complex of the exchange is distributed between two data centers. <br>  ‚Ä¢ Main - M1 - located on Warsaw highway; <br>  ‚Ä¢ Reserve - in the Stock Exchange building in Kislovsky Lane. <br>  We understand how it works ... <br><br><img src="https://habrastorage.org/files/e80/183/5b3/e801835b3c0440f8a411525b3da218ff.png" alt="image"><br><br>  There are 6 typical connection schemes to the exchange (shown in Fig. ‚ÄúConnection diagram‚Äù) and participants of all schemes are tested.  With such a diversity, the main part of the market participants (brokers, banks, providers, vendors) is connected according to a <a href="http://moex.com/a1160">universal scheme</a> .  <a href="http://moex.com/a388">7 authorized telecom operators</a> specifically for the exchange organized private networks (L3 VPN), to which, together with the participants, the main and backup data centers are connected. <br><br>  Each bidder is recommended to use a fault-tolerant connection to the exchange - at least two communication channels, which is necessary for the purpose of reservation and load redistribution to prevent traffic congestion during periods of peak activity of the trading session. <br><br>  One of the ‚Äúbottlenecks‚Äù of the technological infrastructure detected, including during the testing process, is the ‚Äúlast mile‚Äù of the participant‚Äôs connection to the operator‚Äôs network.  The recommended minimum bandwidth of a dedicated communication channel without using FAST UDP multicast marketdata technology is 10 Mbps.  Using FAST UDP multicast marketdata - 30 Mbit / s for the stock market, 20 Mbit / s for the currency market and 15 Mbit / s for the urgent market (in case of receiving data from several markets, the numbers are summed up). <br><br>  From the point of view of load testing and processing of results, the most representative for us are the data on the output switches from the exchange to the colocation zone, when customers receive data directly from the exchange, without using a telecom operator.  Customers put their equipment (servers) in the data center of the exchange.  The servers are located next to the hardware complex, and the connection goes directly to the trading platforms with network cables at a speed of 100 Mbit / s, 1 Gbit / s or 10 Gbit / s. <br><br>  It is here that the struggle begins for every microsecond in data transfer speed.  On the collocation, as a rule, there are servers of high-frequency traders (HFT - high frequency trading, they are also GTA - hyperactive vending machines), for which it is important to receive / send data at maximum speed and with minimal spread.  Measurements on collocations allow us to most accurately measure all delays, eliminating the influence of networks independent of us. <br><br>  <b>General scheme of load testing</b> <br>  The general scheme of load testing is as follows: <br><br><img src="https://habrastorage.org/files/8a1/465/6aa/8a14656aa4b349d6b8f1868f8d1e6325.png" alt="image"><br><br>  In these areas, we measure the main indicators: <br><br>  - <b><i>Disposal of local networks: utilization of the processor on a network device.</i></b>  We measure in order to check the capacity of our own local network: traffic must be free to go from one point to another.  In the trading network all connections at 10 Gb / s. <br><br>  - <b><i>CPU utilization</i></b> : the load level of network devices, which should not exceed 60-70% for their normal operation.  Excess results in the switch failing to cope with the volume of traffic, which leads to packet loss. <br><br>  - <b><i>Latency</i></b> : the time between receiving a network message with an order for placing / withdrawing / changing an application on any switch in the path between the access server and the client and receiving a response to the order.  Measurements on different switches allow you to evaluate all the components of the delays, including communication channels and software components of the complex <br><br>  - <b><i>Jitter</i></b> : statistical variation of delay values ‚Äã‚Äã(latency).  Persistence latency - an important indicator for all categories of clients.  As a rule, maximum response times are measured for the best 50% (median), 80%, 90%, 99% of orders.  The ratio of these values ‚Äã‚Äãgives a good idea of ‚Äã‚Äãthe spread of the values ‚Äã‚Äãof delays. <br><br><img src="https://habrastorage.org/files/82f/c22/188/82fc221882eb4994933ed685139a0a85.png" alt="image"><br><br>  <b>What is measured?</b> <br><br>  In our arsenal there are several measurement tools. <br>  - Adopted by us generally accepted solutions, for example, Network Node Management from HP, with which the utilization of communication channels is measured. <br>  - Internal means of event logging with microsecond accuracy in our software, as well as the good old tcpdump. <br>  ‚ÄúIn 2014, for the first time, we used the capabilities of the Corvil precision measuring system - to control the parameters of latency and jitter in a collocation zone sensitive to microsecond delays.  This system is used, including the world's largest stock exchanges such as the NASDAQ and the NYSE. <br>  See the example of uploading data from Corvil below. <br><br><img src="https://habrastorage.org/files/133/19f/a9e/13319fa9e05f4437afa2cd4a42b4b507.png" alt="image"><br><br>  <b>What happened - a brief summary</b> <br><br>  Detailed results of testing all exchange systems, access servers, gateways, etc.  can be found in the detailed <a href="http://fs.moex.com/f/2954/itogi-nagruzochnogo-testirovanija-20092014.pdf">report</a> , but for clarity, we present some numbers: <br>  <b>Stock market</b> <br><table><tbody><tr><th></th><th>  Values ‚Äã‚Äãachieved (pcs.) </th><th>  Maximum processing speed (units per second) </th></tr><tr><td>  Applications </td><td>  40 599 733 </td><td>  9621 </td></tr><tr><td>  Deals </td><td>  2,992,713 </td><td>  1318 </td></tr><tr><td>  Transactions </td><td>  80 537 469 </td><td>  19,100 </td></tr></tbody></table><br>  <b>Currency market</b> <br>  Load testing was characterized by high activity in frequency and number of transactions, 25 times higher than typical values ‚Äã‚Äãfor normal trading. <br><table><tbody><tr><th></th><th>  Values ‚Äã‚Äãachieved (pcs.) </th><th>  Maximum processing speed (units per second) </th></tr><tr><td>  Applications </td><td>  32,994,049 </td><td>  5700 </td></tr><tr><td>  Deals </td><td>  747 539 </td><td>  700 </td></tr><tr><td>  Transactions </td><td>  65,568,622 </td><td>  11324 </td></tr></tbody></table><br>  <b>Derivatives Market</b> <br>  The introduction in July 2014 of a new version of TKS SPECTRA with optimized matching, as well as the allocation of a separate data replication branch with accelerated distribution, increased the performance of the TKS core to 52,000 transactions per second and stabilized the latency RTT application.  In the course of load testing, according to plan, clearing and intermediate clearing were carried out, and, despite the large volumes of orders and transactions, both procedures were carried out on a regular basis within the planned time interval. <br><table><tbody><tr><th></th><th>  Values ‚Äã‚Äãachieved (pcs.) </th><th>  Maximum processing speed (units per second) </th></tr><tr><td>  Applications </td><td>  63,815,090 </td><td>  36,000 </td></tr><tr><td>  Deals </td><td>  3,787,105 </td><td>  4,953 </td></tr></tbody></table><br>  It should be noted that both systems (ASTS and SPECTRA) do not have technological limitations on the number of orders and transactions per trading day, the figures achieved are due to the time and testing program. <br><br>  We want to thank customers, telecom operators, vendors and all specialists for their active participation in testing, which makes the test results more accurate and fair. </div><p>Source: <a href="https://habr.com/ru/post/248083/">https://habr.com/ru/post/248083/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../248071/index.html">Inherited class for the WinRT component written using WRL</a></li>
<li><a href="../248073/index.html">Centos 7 convert to software RAID 1</a></li>
<li><a href="../248075/index.html">Mind games, or how we intellect were measured</a></li>
<li><a href="../248079/index.html">Auto Balcony Lighting for Arduino</a></li>
<li><a href="../248081/index.html">Monkey Do - an unusual task manager</a></li>
<li><a href="../248085/index.html">The tenth Luxin LTS webinar: Nicholas Frenkel "How to improve your tests with the help of mutation testing"</a></li>
<li><a href="../248087/index.html">10 important lessons that I learned during my project A Year of Productivity (year of productivity)</a></li>
<li><a href="../248089/index.html">Vulnerability MS14-063 in the FastFat driver in Windows OS. Debriefing</a></li>
<li><a href="../248091/index.html">02 Links for UX-specialists</a></li>
<li><a href="../248093/index.html">How we build a message handling system</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>