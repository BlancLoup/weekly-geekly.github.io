<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Testing in Openshift: Openstack Integration</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, dear members of the IT community. This material is an unplanned continuation of a series of articles ( first article , second article , third a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Testing in Openshift: Openstack Integration</h1><div class="post__text post__text-html js-mediator-article"><p>  Hello, dear members of the IT community.  This material is an unplanned continuation of a series of articles ( <a href="https://habrahabr.ru/post/332994/">first article</a> , <a href="https://habrahabr.ru/post/333012/">second article</a> , <a href="https://habrahabr.ru/post/333014/">third article</a> ), which are devoted to software testing in <a href="https://habrahabr.ru/post/333014/">Openshift Origin</a> .  This article will cover aspects of integrating containers and virtual machines through Openshift and <a href="http://openstack.org/">Openstack</a> . </p><br><p>  What goals I pursued integrating Openshift with Openstack: </p><br><ol><li>  Add the ability to run containers and virtual machines on a single network ( <a href="https://en.wikipedia.org/wiki/OSI_model">L2</a> , no nested networks). </li><li>  Add the ability to use published services in Openshift virtual machines. </li><li>  Add the ability to integrate a physical network segment with a network of containers / virtual machines. </li><li>  Have the ability to mutually allow <a href="https://en.wikipedia.org/wiki/Fully_qualified_domain_name">FQDN</a> for containers and virtual machines. </li><li>  Have the ability to embed the deployment process of hybrid environments (containers, virtual machines) into an existing <a href="https://en.wikipedia.org/wiki/Continuous_integration">CI</a> / <a href="https://en.wikipedia.org/wiki/Continuous_delivery">CD</a> . </li></ol><br><p>  <em>Note: this article will not talk about the automatic scaling of the cluster and the provision of data warehouses.</em> </p><a name="habracut"></a><br><p>  In your own words about the software that contributed to the achievement of the goals: </p><br><ol><li><p>  Openstack - the operating system for creating cloud services.  A powerful designer who has collected many projects and vendors for his start.  In my personal opinion, there are simply no Openstack competitors in the <a href="https://en.wikipedia.org/wiki/Cloud_computing">private cloud</a> market.  Openstack installations can be very flexible and multi-element, with support for various hypervisors and services.  Jenkins plugins are available <a href="https://wiki.jenkins.io/display/JENKINS/Openstack%2BCloud%2BPlugin">[1]</a> <a href="https://wiki.jenkins.io/display/JENKINS/Openstack%2BHeat%2BPlugin">[2]</a> .  Supported <a href="https://wiki.openstack.org/wiki/Heat">orchestration</a> , <a href="https://wiki.openstack.org/wiki/Mistral">workflow</a> , <a href="https://wiki.openstack.org/wiki/HierarchicalMultitenancy">multi tenancy</a> , <a href="https://www.mirantis.com/blog/the-first-and-final-word-on-openstack-availability-zones/">zoning</a> , etc. </p><br></li><li><p>  Openshift Origin - standalone solution from Red Hat (as opposed to <a href="https://en.wikipedia.org/wiki/OpenShift">Openshift Online and Openshift Dedicated</a> ) designed to orchestrate containers.  The solution is based on <a href="https://en.wikipedia.org/wiki/Kubernetes">Kubernetes</a> , but has several advantages / additions that provide convenience and efficiency of work. </p><br></li><li><p>  <a href="https://wiki.openstack.org/wiki/Kuryr">Kuryr</a> is a young Openstack project (a big plus is that the development is carried out in the Openstack ecosystem), which allows integrating containers (nested, baremetal) into the <a href="https://wiki.openstack.org/wiki/Neutron">Neutron</a> network in various ways.  It is a simple and reliable solution with far-reaching plans for expanding the functionality.  Currently, there are many <a href="https://en.wikipedia.org/wiki/Network_function_virtualization">NFV</a> / <a href="https://en.wikipedia.org/wiki/Software-defined_networking">SDN</a> solutions on the market (Kuryr is not), most of which can be excluded as not supported by Openstack / Openshift natively, but even significantly reducing the list of solutions that are very rich in functionality, but they are quite complex in terms of integration and maintenance ( <a href="http://www.opencontrail.org/">OpenContrail</a> , <a href="https://www.midonet.org/">MidoNet</a> , <a href="https://www.projectcalico.org/">Calico</a> , <a href="https://contiv.github.io/">Contiv</a> , <a href="https://www.weave.works/">Weave</a> ).  Kuryr, on the other hand, allows integrating Openshift containers ( <a href="https://github.com/containernetworking/cni">CNI</a> plugin) into the Neutron network (classic scripts with <a href="http://openvswitch.org/">OVS</a> ) without too much difficulty. </p><br></li></ol><br><h4 id="tipovye-shemy-integracii">  Typical integration schemes: </h4><br><p>  <strong>1. Openshift cluster is located in the Openstack cloud</strong> </p><br><p><img src="https://habrastorage.org/webt/59/d7/22/59d7223162d12820132795.png"></p><br><p>  The integration scheme, when all elements are located in the Openstack cloud, is very attractive and convenient, but the main disadvantage of this scheme is that containers run in virtual machines and all speed advantages are reduced to nothing. </p><br><p><img src="https://habrastorage.org/webt/59/d7/22/59d72231a1687327390548.png"></p><br><p>  With this integration scheme, the working nodes of Openshift are assigned a <a href="https://wiki.openstack.org/wiki/Neutron/TrunkPort">TRUNK</a> port, which contains a certain amount of SUBPORT.  Each SUBPORT contains a <a href="https://en.wikipedia.org/wiki/Virtual_LAN">VLAN</a> identifier.  If the TRUNK port is on the same network, then the SUBPORT is on the other.  SUBPORT should be viewed as a bridge between two networks.  When an Ethernet frame arrives in TRUNK with a VLAN tag (which corresponds to no one SUBPORT), then such a frame will be sent to the corresponding SUBPORT.  From all this it follows that a normal VLAN is created on the working node of Openshift, which is placed in the container's <a href="https://en.wikipedia.org/wiki/Linux_namespaces">network namespace</a> . </p><br><p>  <strong>2. The working nodes of the Openshift cluster are physical servers, the master is located in the Openstack cloud</strong> </p><br><p><img src="https://habrastorage.org/webt/59/d7/22/59d7223193c10069302387.png"></p><br><p>  The integration scheme, when the containers are running on dedicated servers, is not more complicated than the scheme with all the elements located in the Openstack cloud.  <a href="https://en.wikipedia.org/wiki/Virtual_Extensible_LAN">VXLAN</a> allows <a href="https://en.wikipedia.org/wiki/Virtual_Extensible_LAN">you</a> to organize virtual networks without the need for segmentation of an enterprise network. </p><br><p><img src="https://habrastorage.org/webt/59/d7/22/59d722310847e809665630.png"></p><br><p>  With this integration scheme, an <a href="https://docs.openstack.org/liberty/networking-guide/scenario-classic-ovs.html">Open vSwitch Agent</a> runs on Openshift work nodes, which is integrated with Neutron.  The launched container is assigned a <a href="https://lwn.net/Articles/232688/">VETH</a> device that works directly with the Open vSwitch bridge, that is, the container is integrated into the Neutron network directly.  Subsequently, the Open vSwitch Agent initiates the VXLAN connection to the Neutron Router for subsequent packet routing. </p><br><p>  <strong>The role of Kuryr in all variants comes down to:</strong> </p><br><ol><li>  When creating the container, the kuryr CNI plugin will be used, which will send a request (all communications are carried out via the standard Openshift / Kubernetes API) kuryr-controller for network connectivity. </li><li>  kuryr-controller, upon receiving a request, will "ask" Neutron to allocate a port.  After the port is initialized, the kuryr-controller will transfer the network configuration back to the CNI plugin, which will be applied to the container. </li></ol><br><h4 id="integraciya-fizicheskogo-segmenta-seti-c-setyu-konteynerov-i-virtualnyh-mashin">  Integration of the physical network segment with the network of containers and virtual machines: </h4><br><p><img src="https://habrastorage.org/webt/59/d7/22/59d7223200f27949836636.png"></p><br><p>  In the simplest version, the development participants have a routable access to the network of containers and virtual mice via the Neutron Router; for this, it is enough to register the gateway address for the required subnet on the workstations.  This possibility is difficult to overestimate from the point of view of testing, since the standard mechanisms ( <a href="http://alesnosek.com/blog/2017/02/14/accessing-kubernetes-pods-from-outside-of-the-cluster/">hostNetwork, hostPort, NodePort, LoadBalancer, Ingress</a> ) Openshift / Kubernetes are clearly limited in capabilities, as is the <a href="https://wiki.openstack.org/wiki/Neutron/LBaaS">LBaaS</a> in Openstack. </p><br><p>  It is especially difficult to overestimate the opportunity to deploy and have access to the necessary applications, the catalog of which is available through the Openshift web interface (if projects such as <a href="https://github.com/kubernetes-helm/monocular">Monocular</a> began to appear relatively recently, then this functionality is present in Openshift from the first versions).  Any contributor can deploy an available application without wasting time learning <a href="http://docker.io/">Docker</a> , Kubernetes, the application itself. </p><br><h4 id="razreshenie-fqdn-konteynerov-i-virtualnyh-mashin">  Allow FQDN of containers and virtual machines: </h4><br><p>  In the case of containers, everything is very simple, for each published service, a FQDN record is created in the internal DNS server as follows: </p><br><p><code>&lt;service&gt;.&lt;pod_namespace&gt;.svc.cluster.local</code> </p> <br><p>  In the case of virtual machines, the <a href="https://docs.openstack.org/mitaka/networking-guide/config-dns-int.html">dns</a> extension for <a href="https://wiki.openstack.org/wiki/Neutron/ML2">ml2</a> plugin is used: </p><br><p> <code>extension_drivers = port_security,dns</code> </p> <br><p>  When creating a port in Neutron, the dns_name attribute is set, which forms the FQDN: </p><br><pre> <code class="plaintext hljs">[root@openstack ~]# openstack port create --dns-name hello --network openshift-pod hello +-----------------------+---------------------------------------------------------------------------+ | Field | Value | +-----------------------+---------------------------------------------------------------------------+ | admin_state_up | UP | | allowed_address_pairs | | | binding_host_id | | | binding_profile | | | binding_vif_details | | | binding_vif_type | unbound | | binding_vnic_type | normal | | created_at | 2017-10-04T15:25:21Z | | description | | | device_id | | | device_owner | | | dns_assignment | fqdn='hello.openstack.local.', hostname='hello', ip_address='10.42.0.15' | | dns_name | hello | | extra_dhcp_opts | | | fixed_ips | ip_address='10.42.0.15', subnet_id='4e82d6fb-9613-4606-a3ae-79ed8de42eea' | | id | adfa0aab-82c6-4d1e-bec3-5d2338a48205 | | ip_address | None | | mac_address | fa:16:3e:8a:94:38 | | name | hello | | network_id | 050a8277-e4b3-4927-9762-d74274d9c8ff | | option_name | None | | option_value | None | | port_security_enabled | True | | project_id | 2823b3394572439c804d56186cc82abb | | qos_policy_id | None | | revision_number | 6 | | security_groups | 3d354277-2aec-4bfb-91ac-d320bfb6c90f | | status | DOWN | | subnet_id | None | | updated_at | 2017-10-04T15:25:21Z | +-----------------------+---------------------------------------------------------------------------+</code> </pre> <br><p>  The FQDN for the virtual machine can be resolved using a DNS server that serves <a href="https://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol">DHCP</a> for the network. </p><br><p>  It remains only to place the DNS resolver on Openshift master (or in any other place), which will resolve <code>*.cluster.local</code> using <a href="https://docs.openshift.org/latest/architecture/networking/networking.html">SkyDNS Openshift</a> , and <code>*.openstack.local</code> using the DNS server of the Neutron network. </p><br><h4 id="demonstraciya">  Demonstration: </h4><br><iframe width="560" height="315" src="https://www.youtube.com/embed/3YyKv9AAl5o" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h4 id="zaklyuchenie">  Conclusion: </h4><br><ol><li>  I would like to thank the development teams: Openshift / Kubernetes, Openstack, Kuryr. </li><li>  The solution was as simple as possible, but it remained flexible and functional. </li><li>  Thanks to Openstack, the opportunity to organize testing on such processor architectures as ARM and MIPS has opened. </li></ol><br><h4 id="interesnoe">  Interesting: </h4><br><ol><li>  <a href="https://www.youtube.com/watch%3Fv%3DB0qqnnmcb9w">Openshift and Windows Containers</a> </li><li>  <a href="http://cri-o.io/">CRI-O supports Clear Containers</a> </li></ol></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/339474/">https://habr.com/ru/post/339474/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../339460/index.html">When did Phoenix kill Reils?</a></li>
<li><a href="../339464/index.html">Photogrammetry research</a></li>
<li><a href="../339468/index.html">Google Chrome distribution knows who downloaded it</a></li>
<li><a href="../339470/index.html">Root worse Mikhalkov</a></li>
<li><a href="../339472/index.html">Large list of telegram channels for designers, product managers and analysts</a></li>
<li><a href="../339476/index.html">Let them in passwords</a></li>
<li><a href="../339478/index.html">GDG community at Google Developer Days</a></li>
<li><a href="../339480/index.html">XSLT Web Vulnerability: Server Side Injection</a></li>
<li><a href="../339482/index.html">How to kill your network with Ansible</a></li>
<li><a href="../339484/index.html">Traffic Sign Recognition Using CNN: Spatial Transformer Networks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>