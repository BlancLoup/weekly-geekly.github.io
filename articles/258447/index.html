<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We manage AB400S Wireless Switch socket without remote control</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, I had 3 sockets AB400S Wireless Switch controlled by radio 433 MHz. The console from them was lost and the owner did not need them. As alway...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We manage AB400S Wireless Switch socket without remote control</h1><div class="post__text post__text-html js-mediator-article">  Recently, I had 3 sockets AB400S Wireless Switch controlled by radio 433 MHz.  The console from them was lost and the owner did not need them.  As always, the inspection began with a parsing on the components. <br>  Here, in fact, the kind of viscera of this outlet.  The blue wires and the 1.2kŒ© resistor were soldered by me, but more on that later. <br><br><img src="https://habrastorage.org/files/d6f/e13/52b/d6fe1352b6574a18b3e484f9746669b4.jpg" alt="image"><br><a name="habracut"></a><br>  From the top you can immediately see the capacitor power supply and 24V relay, below the signal receiver with a filter at the op-amp and the decoder of the received signal HX2272-L2 itself.  To the right of him are the legs from the switch (DIP switch), which is set to the "address" of the outlet. <br><br>  I set out to connect it with an ATmega8 microcontroller and try to turn on the relay.  I'm not a fan of capacitor power supplies, especially when the board will lie on the table in front of the nose.  For the power supply, I used the 5V source, from which my microcontroller runs, inserted into the brainboard (on the mock-up board with plug-in contacts). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I had a 433 MHz transmitter from another device.  In order to exclude the inactivity of the radio channel when testing the program transmitting data to the decoder, I decided to connect the microcontroller to the decoder directly.  Solder the wires to the VCC (18), GND (9) and DIN (14) terminals.  I soldered them not specifically to the legs of the chip, but just on these lines where it was convenient. <br><br><img src="https://habrastorage.org/files/5d0/8f2/2de/5d08f22de38b49c287566bde9e4ce8c9.png" alt="image"><br><br>  From the <a href="http://www.princeton.com.tw/Portals/0/Product/PT2272.pdf">description of the chip,</a> it follows that the information transmitted to the decoder consists of one word (word) consisting of 12 bits, followed by a sync bit.  Specifically for our decoder, it looks like this: <br><br><img src="https://habrastorage.org/files/0e4/ad6/430/0e4ad643034b4ee1a3d95e7478fdcd17.png" alt="image"><br><br>  The value of the bits is set by the voltage level at the inputs A0-A9, bits D0-D1 correspond to the same outputs.  If the received address bits match the values ‚Äã‚Äãset on the switch, then the outputs D0 and D1 accept the values ‚Äã‚Äãof the received bits D0 and D1.  The bit can be 0, 1 or f (floating).  In the case of "floating" input is not connected.  On the outlet board, you can use 0 and "floating".  There is no possibility to set the unit, since there is no pull-up resistor.  In the program, I used all three options, so a resistor of 1.2 kOhm was soldered to A0 to check the performance. <br><br>  The bits are encoded as follows: <br><br><img src="https://habrastorage.org/files/70e/29a/2e6/70e29a2e63274bbfac7080efd85687c7.png" alt="image"><br><br>  Each bit consists of two pulses.  For 1 and 0, the first and second pulses are the same, and ‚Äúfloating‚Äù in the first cycle has the sequence ‚Äú0‚Äù, in the second ‚Äú1‚Äù.  Œ± is the period of the decoder clock generator.  Its value is set by the resistor connected to the legs of OSC1 and OSC2.  In our version of the board, it has a value of 1 MŒ©. <br><br>  According to the above graphs, you can determine the frequency at which the decoder operates.  The frequency scale is logarithmic and 10 kHz offset.  From the figure it follows that the frequency of the clock generator is approximately equal to 35 kHz. <br><br><img src="https://habrastorage.org/files/fbf/5f0/d6a/fbf5f0d6a6824221a997b4124ba079b1.png" alt="image"><br><br>  Check the oscilloscope.  To do this, we put the oscilloscope probe on the OSC2 foot. <br><br><img src="https://habrastorage.org/files/4f5/73e/4fe/4f573e4fef7d4ee6ba8914efb2d2b158.PNG" alt="image"><br><br>  We take a more accurate value.  For the decoder, Œ± will be equal to 1 / 34.26 kHz = 29.19 Œºs.  From the description it follows that the decoder operates at a frequency of 2.5 ... 8 times greater than the device that forms the incoming signal on the DIN leg.  This means that for encoding the signal Œ± of the transmitter, it can be, for example, 29.19 Œºs / 4 = 7.3 Œºs. <br><br>  <i>About the code I will make a reservation right away that I am not a programmer.</i>  <i>If you have any suggestions how to make it better, I will be happy for your advice.</i> <br><br>  The data to be sent is stored in a vector.  Bits A0 ... A9 correspond to the values ‚Äã‚Äãset on the switch.  (Standard combination from the instruction manual) A relay is connected to the D0 output of the decoder through a transistor.  The port to which the decoder input is connected is configured for output and is immediately turned on during initialization. When the microcontroller is flashed, the relay should switch on immediately according to the data in the vector. <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">short</span></span> sendVector[<span class="hljs-number"><span class="hljs-number">12</span></span>] = {<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>}; <span class="hljs-comment"><span class="hljs-comment">// A0 A1 A2 A3 A4 A5 A6 A7 A8 A9 D1 D0 // BIT0 =0; BIT1 =1; BITf =2</span></span></code> </pre> <br>  The transmission cycle of the same data is repeated 3 times.  Pressing the button inverts the last bit (on / off function) and resets the number of transmissions (transmitNum).  I used a timer that calls a function (rf_function) every 7.3 ¬µs if the button connected to the microcontroller was pressed. <br><br><div class="spoiler">  <b class="spoiler_title">rf_function</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rf_function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> alphaCounter = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    static short bitCounter = 0; //    static short cycle = 0; //    if (bitCounter &lt; 12) //  12  { alphaCounter++; if (cycle == 0) { if ((alphaCounter == 4) &amp;&amp; (sendVector[bitCounter] != 1)) // BIT0  BITf  { togglePin('C', _PIN0); //  } if ( (alphaCounter == 12) &amp;&amp; (sendVector[bitCounter] == 1)) { togglePin('C', _PIN0); } } else { if ((alphaCounter == 4) &amp;&amp; (sendVector[bitCounter] == 0)) // BIT1  BITf  { togglePin('C', _PIN0); //  } if ( (alphaCounter == 12) &amp;&amp; (sendVector[bitCounter] != 0)) { togglePin('C', _PIN0); } } if (alphaCounter == 16) //    { togglePin('C', _PIN0); cycle++; alphaCounter = 0; //     } if (cycle == 2) //        2  { cycle = 0; bitCounter++; } } else //   { alphaCounter++; if (alphaCounter == 4) { togglePin('C', _PIN0); } if (alphaCounter == 128) { togglePin('C', _PIN0); bitCounter = 0; //      alphaCounter = 0; //    transmitNum++; //      } } }</span></span></code> </pre><br></div></div><br>  Each time the function is called, the counter Œ± is incremented by one.  If the number of passed Œ± corresponds to the required number of cycles for the formation of one or another bit, then the pin value is inverted.  After 16Œ± (time of one cycle), the counter Œ± is reset and the cycle counter increases by one.  The operation is repeated again.  After two cycles, a new bit is taken from the vector and the operation is repeated until 12 bits are transmitted.  Then a sync pulse is sent.  It has other temporal characteristics. <br><br><img src="https://habrastorage.org/files/150/cb6/d5c/150cb6d5cece44909230f46370cc9795.PNG" alt="image"><br><br>  At the stage of the test with the disassembled socket, it was possible to judge about the program‚Äôs performance by the illuminated LED (the indicator of the socket activation), since  power was supplied to 5V, and the relay was rated at 24V. <br><br>  After successful testing and connection of the transmitter (433 MHz), the socket immediately began to be controlled via radio. <br><br>  The next goal is to connect the microcontroller with a smartphone and control three sockets.  But that's another story. </div><p>Source: <a href="https://habr.com/ru/post/258447/">https://habr.com/ru/post/258447/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../258437/index.html">Dagaz: Kicks to common sense (part 7)</a></li>
<li><a href="../258439/index.html">The new issue of the magazine "Radio Annual" number 35 (2015)</a></li>
<li><a href="../258441/index.html">Dynamic Meta Objects (part 1, study)</a></li>
<li><a href="../258443/index.html">Kubernetes Basics</a></li>
<li><a href="../258445/index.html">Keeping recordings of conversations in mp3 in FreePBX / Asterisk</a></li>
<li><a href="../258449/index.html">How I hacked Starbucks for unlimited coffee</a></li>
<li><a href="../258451/index.html">Two opposite directions VIDEO ANALYTICS: "hard" and "flexible", who is stronger?</a></li>
<li><a href="../258457/index.html">TLS Logjam - FREAK with DH vulnerability</a></li>
<li><a href="../258459/index.html">Subscribe to 72 well-known PHP developers with one click</a></li>
<li><a href="../258461/index.html">Logjam - new TLS vulnerability</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>