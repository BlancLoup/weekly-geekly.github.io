<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>An example of the implementation of methods for processing and recognition of images on Android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Being engaged in the development of applications for the Android OS, interesting ideas arise that you want to try, or there is some kind of theoretica...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>An example of the implementation of methods for processing and recognition of images on Android</h1><div class="post__text post__text-html js-mediator-article">  Being engaged in the development of applications for the Android OS, interesting ideas arise that you want to try, or there is some kind of theoretical knowledge and you want to put it into practice, from the combination of these factors and the idea of ‚Äã‚Äãthe described project emerged. <br><br>  There are many articles about text recognition, computer vision, and individual recognition algorithms.  The same publication demonstrates an attempt to implement a task related to finding a keyword in a text image, which may allow, for example, finding the necessary place to read any text in DjVu without recognizing the text itself. <br><br>  An example of implementation is presented as an Android application, and the source image is a screenshot of the text, with the keyword entered, to solve the problem, various algorithms for image processing and recognition are used. <br><a name="habracut"></a><br><h4>  Task </h4><br>  Suppose we have an image of some text, it can be a photo, a scanned image or a screenshot, and in this image you need to find some phrase or word as soon as possible in order to quickly extract the necessary part of the information, algorithms come to our aid image processing and recognition. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Details of the stages of creating Android applications will not be described here, as well as a detailed theoretical description of the algorithms will not be presented.  With a minimal application test interface, the main objectives of the following are: <br><br><ul><li>  Acquaintance with some methods of image processing and pattern recognition; </li><li>  Acquaintance with the possibilities and complexity of the implementation of these methods for Android. </li></ul><br><h4>  Image acquisition </h4><br>  To obtain the image under study, we create an Activity in which there will be only three elements: <br><br>  1. EditText - to enter a keyword; <br>  2. TextView - to display the text in which you need to find this word; <br>  3. Button to take a screenshot and go to another screen. <br><br>  <i>!</i>  <i>All code is only demonstrative in nature and is not a correct instruction for action.</i> <br><br><div class="spoiler">  <b class="spoiler_title">XML code for 1 and 2 points</b> <div class="spoiler_text"><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:app</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:tools</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/tools"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/main_content_layout"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#ddd"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:orientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingBottom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/activity_vertical_margin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingLeft</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/activity_horizontal_margin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingRight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/activity_horizontal_margin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/activity_vertical_margin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_behavior</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/appbar_scrolling_view_behavior"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tools:context</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".MainActivity"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tools:showIn</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@layout/activity_main"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EditText</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fill_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"40dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:singleLine</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textColor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#000"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/main_text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textColor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#000"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:ellipsize</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"end"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Layout with a button that includes a link to the above layout</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">android.support.design.widget.CoordinatorLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:app</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:tools</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/tools"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:fitsSystemWindows</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tools:context</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".MainActivity"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">android.support.design.widget.AppBarLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:theme</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@style/AppTheme.AppBarOverlay"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">android.support.v7.widget.Toolbar</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/toolbar"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"?attr/actionBarSize"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"?attr/colorPrimary"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:popupTheme</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@style/AppTheme.PopupOverlay"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">android.support.design.widget.AppBarLayout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">layout</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@layout/content_main"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">android.support.design.widget.FloatingActionButton</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/fab"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_gravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"bottom|end"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/fab_margin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@android:drawable/ic_menu_camera"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">android.support.design.widget.CoordinatorLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  It looks like this: <br><br><img src="https://habrastorage.org/files/db0/68a/f69/db068af6935c47cbbae96d59c52b1bc0.png"><br><br>  To search, for example, we introduce the word "dreams": <br><br><img src="https://habrastorage.org/files/2b4/154/e9f/2b4154e9faea4f61aa3ea07e0078ee77.png"><br><br>  This way we get a single keyword, followed by the text below.  It is worth paying attention to the fact that the keyword and the text itself have a different font size (to complicate the task, let's say so). <br><br>  Click on the button and get a screenshot of the area with the keyword and text. <br><br><div class="spoiler">  <b class="spoiler_title">Method for taking a screenshot, called by clicking on the button</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">takeScreenshot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      Date now = new Date(); // /   android.text.format.DateFormat.format("yyyy-MM-dd_hh:mm:ss", now); try { //        String path = Environment.getExternalStorageDirectory().toString() + "/" + now + ".jpg"; File imageFile = new File(path); //  layout'a,        View v1 = findViewById(R.id.main_content_layout); //  v1.setDrawingCacheEnabled(true); Bitmap bitmap = Bitmap.createBitmap(v1.getDrawingCache()); v1.setDrawingCacheEnabled(false); //    FileOutputStream outputStream = new FileOutputStream(imageFile); int quality = 100; bitmap.compress(Bitmap.CompressFormat.PNG, quality, outputStream); outputStream.flush(); outputStream.close(); //   Activity openScreenshotActivity(now); } catch (Throwable e) { e.printStackTrace(); } }</span></span></code> </pre><br></div></div><br>  The resulting screenshot opens in a new Activity, where the functions of sequential actions are collected in NavigationDrawer.  In a real application, some of the operations can be combined into one to eliminate unnecessary passes through the image. <br><br><h4>  Pre-processing the resulting image </h4><br>  First you need to translate the resulting color image into a grayscale. <br><br><h5>  Image transfer from color to halftone </h5><br>  For translation, the RGB to YUV scheme is used. <br><br>  In our case, only the intensity (brightness) is necessary, and you can get it by the forum: <br><br>  Y = 0.299 * R + 0.587 * G + 0.114 * B, where R, G, B are red, green and blue channels, respectively. <br><br>  Strangely enough, the Color class is useful for working with colors and, in particular, its red, green and blue static methods, in which bit-shifted operations are implemented to highlight the desired color channel from the pixel's color value. <br><br>  Sample code to convert a color pixel to brightness: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//     pixels (size =   = width*height ) for (int i = 0; i &lt; size; i++) { int color = pixels[i]; //    int r = Color.red(color); //    int g = Color.green(color); //    int b = Color.blue(color); //      RGB to YUV double luminance = (0.299 * r + 0.0f + 0.587 * g + 0.0f + 0.114 * b + 0.0f); }</span></span></code> </pre><br>  It is not much easier to perform segmentation on a halftone image than on a color one, so the next step is to convert the halftone image into a binary one (the brightness values ‚Äã‚Äãof the pixels have only two values ‚Äã‚Äã0 and 1). <br><br><h5>  Halftone binarization </h5><br>  In this problem, for binarization of a rather elementary threshold method, with a default threshold of 128. <br><br>  In the future, to adjust the results, the threshold can be selected experimentally (the application has the ability to set the threshold by the user). <br><br>  To obtain a binary brightness value, a check of the previously obtained gray tone brightness is performed: <br><br><pre> <code class="java hljs"> pixels[i] = luminance &gt; threshold ? Color.WHITE : Color.BLACK;</code> </pre><br>  Where threshold is a threshold, Color.WHITE and Color.BLACK are constants for convenience, so as not to be confused with 0 and 1. <br><br>  After the translation into halftone and further binarization, we get the following result: <br><br><img src="https://habrastorage.org/files/2ae/cdb/237/2aecdb237fd54e989b10fa036a61d0ae.png"><br><br>  Since these two image processing methods are very close, they are combined into one method. <br><br><div class="spoiler">  <b class="spoiler_title">An example of a method that translates into a halftone and binarization of an image</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * imagePath -    * threshold -   */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">binarizeByThreshold</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String imagePath, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> threshold)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     Bitmap bitmap = BitmapFactory.decodeFile(imagePath); //   int width = bitmap.getWidth(); int height = bitmap.getHeight(); int size = width * height; //    int[] pixels = new int[size]; bitmap.getPixels(pixels, 0, width, 0, 0, width, height); bitmap.recycle(); //     ,          for (int i = 0; i &lt; size; i++) { int color = pixels[i]; int r = Color.red(color); int g = Color.green(color); int b = Color.blue(color); double luminance = (0.299 * r + 0.0f + 0.587 * g + 0.0f + 0.114 * b + 0.0f); pixels[i] = luminance &gt; threshold ? Color.WHITE : Color.BLACK; } Utils.saveBitmap(imagePath, width, height, pixels); }</span></span></code> </pre><br></div></div><br><h4>  Segmentation </h4><br>  To find a keyword, it is necessary after binarization to perform several segmentation stages, which consist in searching for lines in text, searching for words in lines and assigning the found words to the words of applicants by the number of letters (to narrow the range of words for recognition). <br><br><h5>  String segmentation </h5><br>  To determine the lines of text, it is necessary to find the parts of the histogram with the number of black pixels greater than zero, which are between the parts of the histogram with zero number of pixels.  For this, a histogram of the number of black pixels in each one-pixel line of the image is compiled, after which it is processed to obtain the vertical coordinates of the lines (essentially the line numbers in the histogram).  Knowing this coordinate and the overall size of the image, you can select the area containing the string with words. <br><br>  "Inline" histogram for clarity (left) looks, for example, like this: <br><br><img src="https://habrastorage.org/files/5f3/fd3/d50/5f3fd3d50fcd4229b9f4d78f0ab06f76.png"><br><br><div class="spoiler">  <b class="spoiler_title">Method to get row histogram</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ArrayList&lt;GystMember&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRowsGystogram</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String imagePath)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ,       Bitmap bitmap = BitmapFactory.decodeFile(imagePath); int width = bitmap.getWidth(); int height = bitmap.getHeight(); int size = width * height; int[] pixels = new int[size]; bitmap.getPixels(pixels, 0, width, 0, 0, width, height); bitmap.recycle(); ArrayList&lt;GystMember&gt; gystogram = new ArrayList&lt;&gt;(); //  for (int x = 0; x &lt; height; x++) { gystogram.add(new GystMember(x)); for (int y = 0; y &lt; width; y++) { int color = pixels[y + x * width]; if (color == Color.BLACK) { gystogram.get(x).add(); } } } return gystogram; } /*,             */ public class GystMember implements Serializable { public int grayValue; public int count; public GystMember(int grayValue) { this.grayValue = grayValue; this.count = 0; } public void add() { count++; } }</span></span></code> </pre><br></div></div><br><br>  For ease of display, the histogram is normalized. <br><br><div class="spoiler">  <b class="spoiler_title">An example of normalization of the histogram in onDraw custom View</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mGystogram != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> max = Integer.MIN_VALUE; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (GystMember gystMember : mGystogram) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gystMember.count &gt; max) { max = gystMember.count; } } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pixelSize = getWidth(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> coef = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) (max / pixelSize); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (coef == <span class="hljs-number"><span class="hljs-number">0</span></span>){ coef = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (GystMember gystMember : mGystogram) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value = gystMember.count; canvas.drawLine(<span class="hljs-number"><span class="hljs-number">0</span></span>, y, value / coef, y, mPaint); y++; } }</code> </pre><br></div></div><br>  When you know the location of the lines on the image, you can proceed to search for words. <br><br><h5>  Word segmentation </h5><br>  In order to understand where the words and where are just neighboring characters, it is necessary to determine which distances between characters to be considered as distances between words, and which distances between characters within a single word.  Here the mod method comes to the rescue, or rather its adapted version, because most often this method is found in binarization, but its essence can also be applied in this situation. <br><br>  For a start, as for the lines, we similarly construct a histogram inside the line (in fact, it was vertical, now horizontal), it is necessary to understand where the characters are, and where the white gaps are. <br><br>  <i>An example of obtaining such a histogram below is similar to the previous one.</i> <br><br>  Processing this histogram, you can get a new histogram - the intervals between black pixels, i.e., its first gradation will be the number of ‚Äúgaps‚Äù 1 pixel wide, the second gradation is the number of ‚Äúgaps‚Äù 2 pixels wide, and so on. <br><br><div class="spoiler">  <b class="spoiler_title">An example of obtaining the histogram of the intervals</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ArrayList&lt;GystMember&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSpacesInRowsGystogram</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String imagePath, ArrayList&lt;GystMember&gt; rowsGystogram)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ,       Bitmap bitmap = BitmapFactory.decodeFile(imagePath); int width = bitmap.getWidth(); int height = bitmap.getHeight(); int size = width * height; int[] pixels = new int[size]; bitmap.getPixels(pixels, 0, width, 0, 0, width, height); bitmap.recycle(); //     GystMember,     . ArrayList&lt;GystMember&gt; oneRowGystogram = new ArrayList&lt;&gt;(); ArrayList&lt;Integer&gt; spaces = new ArrayList&lt;&gt;(); ArrayList&lt;GystMember&gt; spacesInRowsGystogram = new ArrayList&lt;&gt;(); int yStart = 0, yEnd = 0, yIter = -1; boolean inLine = false; //   for (GystMember gystMember : rowsGystogram) { yIter++; //    (    ),  " " if (gystMember.count &gt; 0 &amp;&amp; !inLine) { inLine = true; yStart = yIter; } else if (gystMember.count == 0 &amp;&amp; inLine) { //    (  ), " " inLine = false; yEnd = yIter; //   ,    for (int x = 0; x &lt; width; x++) { GystMember member = new GystMember(x); for (int y = yStart; y &lt; yEnd; y++) { int color = pixels[x + y * width]; if (color == Color.BLACK) { member.add(); } } oneRowGystogram.add(member); } int xStart = 0, xEnd = 0, xIter = -1; boolean inRow = false; //    for (GystMember oneRowMember : oneRowGystogram) { xIter++; //     if (oneRowMember.count == 0 &amp;&amp; !inRow) { inRow = true; xStart = xIter; } else if ((oneRowMember.count &gt; 0 || xIter == oneRowGystogram.size()-1) &amp;&amp; inRow) { inRow = false; xEnd = xIter; //           int xValue = xEnd - xStart; spaces.add(xValue); } } } } //      Collections.sort(spaces); int lastSpace = -1; GystMember gystMember = null; for (Integer space : spaces) { if (space &gt; lastSpace) { if (gystMember != null) { spacesInRowsGystogram.add(gystMember); } gystMember = new GystMember(space); } gystMember.add(); lastSpace = space; } return spacesInRowsGystogram; }</span></span></code> </pre><br></div></div><br>  Get something like this: <br><br><img src="https://habrastorage.org/files/f45/f8a/1e9/f45f8a1e90aa4066bff50627c08b692f.png"><br><br>  Based on the logic of the mode method, we find two pronounced peaks (in the image above they are obvious), and all that is near one peak - the distance between the characters inside the word, and the second - the distance between the words. <br><br>  Having such information about the "spaces" and the histogram of the line, you can select the image areas where the words are located, as well as count how many characters are contained in these words. <br><br>  <i>The full code of this process, see the source.</i> <br><br>  For a visual assessment of the work of the above set of algorithms, words in the text are colored in alternating colors, and the words applicants (remember, those whose number of characters matches the number of characters in the keyword) remain black: <br><br><img src="https://habrastorage.org/files/18f/d65/ef7/18fd65ef769340aca26b7bfe4c79929b.png"><br><br>  And so, at this stage there are pieces of images (more precisely, the coordinates of these pieces), which contain the keyword and the words applicants based on the number of characters, you can try to find the keyword among the applicants. <br><br><h4>  Recognition </h4><br>  I draw your attention to the fact that here recognition means the recognition of a keyword among the applicants, while recognizing which characters they consist of is out of the question. <br><br>  For recognition, a set of informative features is selected: it can be the number of end points, anchor points, as well as the number of pixels with 3, 4 and 5 black pixels-neighbors, and others.  It has been experimentally established that a large number of signs lose their meaning, since they ‚Äúoverlap‚Äù each other. <br><br>  At this stage we will focus on the number of end points, taking into account their location (at the top and bottom of the image - for each part, the signs are considered separately). <br><br>  For each word, the number of features is counted, after which the nearest neighbors method is searched based on the Euclidean distance. <br><br><div class="spoiler">  <b class="spoiler_title">An example of the formation of a structure with counted signs</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateRecognizeMembers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ mRecognizeMembers.clear(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (PartImageMember pretendent : mPretendents) { RecognizeMember recognizeMember = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RecognizeMember(pretendent); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pretendentWidth = pretendent.endX - pretendent.startX; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pretendentHeight = pretendent.endY - pretendent.startY; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[][] workPixels = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[pretendentWidth][pretendentHeight]; <span class="hljs-comment"><span class="hljs-comment">//        for (int pY = pretendent.startY, py1 = 0; pY &lt; pretendent.endY; pY++, py1++) for (int pX = pretendent.startX, px1 = 0; pX &lt; pretendent.endX; pX++, px1++) { workPixels[px1][py1] = mImagePixels[pX + pY * mImageWidth]; } int half = pretendentHeight / 2; //   for (int ly = 0; ly &lt; pretendentHeight; ly++) { //   for (int lx = 0; lx &lt; pretendentWidth; lx++) { int currentColor = workPixels[lx][ly]; //        . if (currentColor != Color.WHITE) { // 33     int[][] pixelNeibours = Utils.fill3x3Matrix(pretendentWidth, pretendentHeight, workPixels, ly, lx); int[] pixelsLine = Utils.getLineFromMatrixByCircle(pixelNeibours); //     ,     int A4 = getA4(pixelsLine); int A8 = getA8(pixelsLine); int B8 = getB8(pixelsLine); int C8 = getC8(pixelsLine); int Nc4 = A4 - C8; int CN = A8 - B8; recognizeMember.A4.add(A4); recognizeMember.A8.add(A8); recognizeMember.Cn.add(CN); //       if (A8 == 1 &amp;&amp; Nc4 == 1 &amp;&amp; CN == 1) { if (ly &lt; half) { recognizeMember.endsCount++; } else { recognizeMember.endsCount2++; } } } } } mRecognizeMembers.add(recognizeMember); } } private int getA4(int[] pixelsLine) { int result = 0; for (int k = 1; k &lt; 5; k++) { result += pixelsLine[2 * k - 2]; } return result; } private int getA8(int[] pixelsLine) { int result = 0; for (int k = 1; k &lt; 9; k++) { result += pixelsLine[k - 1]; } return result; } private int getB8(int[] pixelsLine) { int result = 0; for (int k = 1; k &lt; 9; k++) { result += pixelsLine[k - 1] * pixelsLine[k]; } return result; } private int getC8(int[] pixelsLine) { int result = 0; for (int k = 1; k &lt; 5; k++) { result += pixelsLine[2 * k - 2] * pixelsLine[2 * k - 1] * pixelsLine[2 * k]; } return result; }</span></span></code> </pre><br></div></div><br>  <i>All characteristic numbers such as A4, A8, etc.</i>  <i>You can find additional information.</i> <br><br><div class="spoiler">  <b class="spoiler_title">Direct recognition code based on Euclidean distance</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">recognize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   ( ) generateRecognizeMembers(); mResultPartImageMembers.clear(); ArrayList&lt;Double&gt; keys = new ArrayList&lt;&gt;(); //     RecognizeMember firstMember = mRecognizeMembers.get(0); mRecognizeMembers.remove(firstMember); for (RecognizeMember recognizeMember : mRecognizeMembers) { if (recognizeMember.getPretendent() != firstMember.getPretendent()) { double keyR = firstMember.equalsR(recognizeMember); recognizeMember.R = keyR; keys.add(keyR); } } //   Collections.sort(mRecognizeMembers, new Comparator&lt;RecognizeMember&gt;() { @Override public int compare(RecognizeMember lhs, RecognizeMember rhs) { return (int) Math.round(lhs.R - rhs.R); } }); //    ,   (  )     double firstKey = -1; double secondKey = -1; for (RecognizeMember member : mRecognizeMembers) { double key = member.R; if (firstKey == -1) { firstKey = key; mResultPartImageMembers.add(member.getPretendent()); } else if (key == firstKey) { mResultPartImageMembers.add(member.getPretendent()); } else if (secondKey == -1) { secondKey = key; mResultPartImageMembers.add(member.getPretendent()); } else if (secondKey == key) { mResultPartImageMembers.add(member.getPretendent()); } } } &lt;...&gt; //          (2)   public double equalsR(RecognizeMember o) { return Math.sqrt(Math.pow(this.endsCount - o.endsCount, 2) + Math.pow(this.endsCount2 - o.endsCount2, 2)); } &lt;...&gt;</span></span></code> </pre><br></div></div><br>  Given the repeatability of words and errors, as a result, you can get 2-3 closest neighbors, among which will be found a keyword (in the figure highlighted in red). <br><br><img src="https://habrastorage.org/files/b38/7f9/a4a/b387f9a4ae194d71af4eeadb2dbeeeb3.png"><br><br>  Also in the picture you can see that among the red words there is a search word ‚Äúdreams‚Äù. <br><br>  To improve the quality of recognition, you can try to pick up a different binarization threshold, as well as select other informative features, adding, for example, probes to them. <br><br><h4>  Conclusion </h4><br>  The goals were achieved, some methods of processing and recognition of images were tested, while their implementation under Android does not impose any additional difficulties, you just need to take into account the memory consumption and not to store several large Bitmap at the same time. <br><br>  I hope the information will be useful for beginners on their way to solving problems of working with images for Android. <br><br>  A description of all algorithms used, counting characteristic numbers, etc.  can be easily found in the public domain both at habrahabr and in numerous textbooks and online resources. <br><br>  Fully available project on <a href="https://github.com/iHandy/MROCourse">github</a> <br><br>  PS: The given implementation of the algorithms is not optimal, and requires further development and optimization, serves only as the minimum necessary example for familiarizing, visualizing and evaluating the work of the above methods on Android. </div><p>Source: <a href="https://habr.com/ru/post/274323/">https://habr.com/ru/post/274323/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../274313/index.html">Compare incomparable: json in PostgreSQL vs Mysql vs Mongodb</a></li>
<li><a href="../274315/index.html">JOIN the dark side of the SQL</a></li>
<li><a href="../274317/index.html">Sinon.js - mock-library for JavaScript</a></li>
<li><a href="../274319/index.html">How to migrate to Oracle Java Cloud in 1.5 hours?</a></li>
<li><a href="../274321/index.html">We are looking for errors in MonoDevelop</a></li>
<li><a href="../274325/index.html">Mobile Applications and PA-DSS</a></li>
<li><a href="../274327/index.html">Useful add-ons to ReSharper</a></li>
<li><a href="../274329/index.html">Printf Oriented Programming</a></li>
<li><a href="../274333/index.html">How to create a convincing mechanics of death and not screw it up</a></li>
<li><a href="../274335/index.html">AI, BigData & HPC Digest # 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>