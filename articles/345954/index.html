<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simplify the work with RecyclerView</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On Habr√© is already full of articles on this topic, all of them basically offer solutions for convenient reuzing cells in RecyclerView . Today we will...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simplify the work with RecyclerView</h1><div class="post__text post__text-html js-mediator-article">  On Habr√© is already full of articles on this topic, all of them basically offer solutions for convenient reuzing cells in <i>RecyclerView</i> .  Today we will go a little further and get closer to simplicity comparable to <i>DataBinding</i> . <br><br><img src="https://habrastorage.org/webt/gt/qa/32/gtqa32-cpsgqtgiploa2qqkvni0.png"><br><br>  If you are not using <i>DataBinding</i> for lists (a <a href="https://habrahabr.ru/post/337110/">good example</a> ) and do it the old-fashioned way, then this article is for you. <br><a name="habracut"></a><br><h3>  Introduction </h3><br>  To quickly dive into the context of the article, let's look at what we now have when using the universal adapter from previous articles: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  <a href="https://habrahabr.ru/post/323862/">Easy work with lists - RendererRecyclerViewAdapter</a> </li><li>  <a href="https://habrahabr.ru/post/337774/">Easy work with lists - RendererRecyclerViewAdapter (part 2)</a> </li></ol><br>  To implement the simplest list using the <i>RendererRecyclerViewAdapter</i> <i>v2.xx,</i> you need: <br><br>  In order for each cell model to implement an empty <i>ViewModel</i> interface: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">YourModel</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewModel</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getYourText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... } }</code> </pre> <br>  Make the classic <i>ViewHolder</i> implementation: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/yourTextView"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"50dp"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">YourViewHolder</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecyclerView</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewHolder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> TextView yourTextView; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RectViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> View itemView)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(itemView); yourTextView = (TextView) itemView.findViewById(R.id.yourTextView); } ... }</code> </pre><br>  Implement <i>ViewRenderer</i> : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">YourViewRenderer</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewRenderer</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">YourModel</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">YourViewHolder</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">YourViewRenderer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Class&lt;YourModel&gt; type, Context context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(type, context); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bindView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(YourModel model, YourViewHolder holder)</span></span></span><span class="hljs-function"> </span></span>{ holder.yourTextView.setText(model.getYourText()); ... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> YourViewHolder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ViewGroup parent)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> YourViewHolder(inflate(R.layout.your_layout, parent)); } }</code> </pre><br>  Initialize the adapter and transfer the necessary data to it: <br><br><pre> <code class="java hljs">... RendererRecyclerViewAdapter adapter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RendererRecyclerViewAdapter(); adapter.registerRenderer(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> YourViewRenderer(YourModel.class, getContext())); adapter.setItems(getYourModelList()); ...</code> </pre><br>  Knowing about the <i>DataBinding</i> and its ease of implementation, the question arises - why so much extra code, because the main thing is binding - comparing the model data with a leyout, from which there is no way to go. <br><br>  In the classical implementation, we use the <i>bindView ()</i> method, everything else is just a preparation for it (implementation and initialization of <i>ViewHolder</i> ). <br><br><h3>  What is a ViewHolder and why is it needed? </h3><br>  We often use this pattern in fragments, activites and recyclers, so why do we need it?  What are the pros and cons of him? <br><br>  Pros: <br><br><ul><li>  No need to use <i>findViewById</i> every time and specify an ID; </li><li>  You do not need to spend CPU time each time searching for a specific ID in xml; </li><li>  It is convenient to access the element anywhere through the created field. </li></ul><br>  Minuses: <br><br><ul><li>  it is necessary to write an additional class; </li><li>  it is necessary for each ID in xml to create a field with a similar name; </li><li>  when changing the ID, you must also rename the field in the viewholder. </li></ul><br>  Third-party libraries such as <a href="https://github.com/JakeWharton/butterknife">ButterKnife</a> do an excellent job with some drawbacks, but in the case of <i>RecyclerView</i> this will not help us much - we will not get rid of <i>ViewHolder</i> itself.  In <i>DataBinding,</i> we can create a universal viewholder, since this responsibility of the binding lies in the xml itself.  What can we do? <br><br><h3>  We create default ViewHolder </h3><br>  If we use the standard implementation of <i>RecyclerView.ViewHolder</i> as a stub in the <i>createViewHolder ()</i> method, then every time in <i>bindView ()</i> we will have to use the <i>findViewById</i> method, let's sacrifice the pluses and still see what happens. <br><br>  Since the class is abstract, we add an empty implementation of the new default viewholder: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewHolder</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecyclerView</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewHolder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View itemView)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(itemView); } }</code> </pre><br>  <i>Replace the</i> viewholder in our ViewRender: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">YourViewRenderer</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewRenderer</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">YourModel</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewHolder</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">YourViewRenderer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Class&lt;YourModel&gt; type, Context context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(type, context); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bindView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(YourModel model, ViewHolder holder)</span></span></span><span class="hljs-function"> </span></span>{ ((TextView)holder.itemView.findViewById(R.id.yourTextView)).setText(model.getYourText()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ViewHolder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ViewGroup parent)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ViewHolder(inflate(R.layout.your_layout, parent)); } }</code> </pre><br>  The resulting benefits: <br><br><ul><li>  no need to implement a <i>ViewHolder</i> for each cell; </li><li>  The implementation of the <i>createViewHolder</i> method can be put into the base class. </li></ul><br>  Now let's analyze the lost advantages.  Since we view the <i>ViewHolder</i> in the <i>RecyclerView</i> framework, we will only access it in the <i>bindView ()</i> method, respectively, the first and third points are not very useful to us: <br><br><ul><li>  <s>No need to use <i>findViewById</i> every time and specify an ID;</s> </li><li>  You do not need to spend CPU time each time searching for a specific ID in xml; </li><li>  <s>It is convenient to access the element anywhere through the created field.</s> </li></ul><br>  But we can not sacrifice performance, so let's solve something.  The implementation of the viewholder allows us to "cache" the views found.  So let's add this to the default viewholder: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewHolder</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecyclerView</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewHolder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> SparseArray&lt;View&gt; mCachedViews = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SparseArray&lt;&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View itemView)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(itemView); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> &lt;T extends View&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ID)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (T) findViewById(ID); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> View </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findViewById</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ID)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> View cachedView = mCachedViews.get(ID); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cachedView != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cachedView; } <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> View view = itemView.findViewById(ID); mCachedViews.put(ID, view); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> view; } }</code> </pre><br>  Thus, after the first call to <i>bindView (), the</i> viewholder will know about all of its views and subsequent calls will use cached values. <br><br>  Now we‚Äôll take out all the <i>extras</i> in the base <i>ViewRender</i> , add a new parameter to the constructor for transmitting the Leuute ID and see what happens: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">YourViewRenderer</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewRenderer</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">YourModel</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewHolder</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">YourViewRenderer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> layoutID, Class&lt;YourModel&gt; type, Context context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(layoutID, type, context); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bindView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(YourModel model, ViewHolder holder)</span></span></span><span class="hljs-function"> </span></span>{ ((TextView)holder.find(R.id.yourTextView)).setText(model.getYourText()); } }</code> </pre><br>  In terms of the amount of code, it looks much better, there is only one constructor, which is always the same.  Do we need to create a new <i>ViewRenderer</i> every time for the sake of one method?  I think not, we solve this problem through delegation and an additional parameter in the constructor, we look: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewBinder</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">M</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewModel</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewRenderer</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">M</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewHolder</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Binder mBinder; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ViewBinder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> layoutID, Class&lt;M&gt; type, Context context, Binder&lt;M&gt; binder)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(layoutID, type, context); mBinder = binder; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bindView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(M model, ViewHolder holder)</span></span></span><span class="hljs-function"> </span></span>{ mBinder.bindView(model, holder); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Binder</span></span></span><span class="hljs-class"> &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">M</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bindView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(M model, ViewHolder holder)</span></span></span></span>; } }</code> </pre><br>  Adding a cell is reduced to: <br><br><pre> <code class="java hljs">... adapter.registerRenderer(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ViewBinder&lt;&gt;( R.layout.your_layout, YourModel.class, getContext(), (model, holder) -&gt; { ((TextView)holder.find(R.id.yourTextView)).setText(model.getYourText()); } )); ...</code> </pre><br>  We list the advantages of this solution: <br><br><ul><li>  You do not need to create a <i>ViewHolder</i> every time and create variables for views; </li><li>  You do not need to create a <i>ViewRenderer</i> every time and write extra code; </li><li>  no need to rename anything when changing the view ID; </li><li>  all the view data (layoutID, concreteViewID, cast) are in one place. </li></ul><br><h3>  Conclusion </h3><br>  Having sacrificed insignificant advantages, we got a fairly simple solution for adding new cells, this will undoubtedly simplify the work with <i>RecyclerView</i> . <br><br>  The article provides only a simple example for understanding, the current implementation allows you to: <br><br><div class="spoiler">  <b class="spoiler_title">Work with nested RecyclerView</b> <div class="spoiler_text"><pre> <code class="java hljs">adapter.registerRenderer( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CompositeViewBinder&lt;&gt;( R.layout.nested_recycler_view, <span class="hljs-comment"><span class="hljs-comment">// ID   RecyclerView    R.id.recycler_view, // ID RecyclerView   DefaultCompositeViewModel.class, //     getContext(), ).registerRenderer(...) //      Nested RecyclerView );</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Save and restore cell state when scrolling</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//    scrollState  RecyclerView,   Play Market adapter.registerRenderer( new CompositeViewBinder&lt;&gt;( R.layout.nested_recycler_view, R.id.recycler_view, YourCompositeViewModel.class, getContext(), new CompositeViewStateProvider&lt;YourCompositeViewModel, CompositeViewHolder&gt;() { public ViewState createViewState(CompositeViewHolder holder) { return new CompositeViewState(holder); //   } public int createViewStateID(YourCompositeViewModel model) { return model.getID(); // ID       } }).registerRenderer(...) ); ... public static class YourCompositeViewModel extends DefaultCompositeViewModel { private final int mID; public StateViewModel(int ID, List&lt;? extends ViewModel&gt; items) { super(items); mID = ID; } private int getID() { return mID; } } ... public class CompositeViewState &lt;VH extends CompositeViewHolder&gt; implements ViewState&lt;VH&gt; { protected Parcelable mLayoutManagerState; public &lt;VH extends CompositeViewHolder&gt; CompositeViewState(VH holder) { mLayoutManagerState = holder.getRecyclerView().getLayoutManager().onSaveInstanceState(); } public void restore(VH holder) { holder.getRecyclerView().getLayoutManager().onRestoreInstanceState(mLayoutManagerState); } }</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Work with Payload when using DiffUtil</b> <div class="spoiler_text"><pre> <code class="java hljs">adapter.setDiffCallback(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> YourDiffCallback()); adapter.registerRenderer(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ViewBinder&lt;&gt;( R.layout.item_layout, YourModel.class, getContext(), (model, holder, payloads) -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(payloads.isEmpty()) { <span class="hljs-comment"><span class="hljs-comment">//    } else { //    Object yourPayload = payloads.get(0); } } }</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Add progress bar when loading data</b> <div class="spoiler_text"><pre> <code class="java hljs">adapter.registerRenderer(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LoadMoreViewBinder(R.layout.item_load_more, getContext())); recyclerView.addOnScrollListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> YourEndlessScrollListener() { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onLoadMore</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ adapter.showLoadMore(); <span class="hljs-comment"><span class="hljs-comment">//     } });</span></span></code> </pre><br></div></div><br>  More detailed examples can be found on the <a href="https://github.com/vivchar/RendererRecyclerViewAdapter">link</a> . <br><br><h3>  Poll </h3><br>  The design of the binding looks a bit "ugly": <br><br><pre> <code class="java hljs">... (model, holder) -&gt; { ((TextView)holder.find(R.id.textView)).setText(model.getText()); ((ImageView)holder.find(R.id.imageView)).setImageResource(model.getImage()); } ...</code> </pre><br>  As a test, I added a couple of methods to the default <i>ViewHolder</i> : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewHolder</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecyclerView</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewHolder</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ViewHolder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ID, CharSequence text)</span></span></span><span class="hljs-function"> </span></span>{ ((TextView)find(ID)).setText(text); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } }</code> </pre><br>  Result: <br><br><pre> <code class="java hljs">... (model, holder) -&gt; holder .setText(R.id.textView, model.getText()) .setImageResource(R.id.imageView, ...) .setVisibility(...) ...</code> </pre></div><p>Source: <a href="https://habr.com/ru/post/345954/">https://habr.com/ru/post/345954/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../345942/index.html">A couple of ways to send notifications to your smartphone from your server</a></li>
<li><a href="../345944/index.html">Simula - 50 years of OOP</a></li>
<li><a href="../345946/index.html">Objective-C compliant "Swift" code</a></li>
<li><a href="../345948/index.html">Enterprise Architecture vs alchemy enterprises. Part 2. Nowhere is easier: simple framework and simple enterprise.</a></li>
<li><a href="../345950/index.html">Welcome to the era of deep neuroevolution</a></li>
<li><a href="../345956/index.html">History 3 places Russian AI Cup 2017</a></li>
<li><a href="../345958/index.html">How I wrote the game in 6 days</a></li>
<li><a href="../345960/index.html">ICA (state machine) for teapots on the example of the class "button" in the arduino</a></li>
<li><a href="../345962/index.html">Coding with the withdrawal of information. Part 2, Mathematical</a></li>
<li><a href="../345964/index.html">On the question of the principles of asynchronous solutions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>