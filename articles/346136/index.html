<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>L√ñVE Development</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The purpose of the post is to describe the main stages of development in the simplest possible way using the L√ñVE framework, using the classic Asteroi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>L√ñVE Development</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/hb/mz/ru/hbmzruswzl6kxefu6_mcnlxbfl8.png" alt="image"></div><br>  The purpose of the post is to describe the main stages of development in the simplest possible way using the <a href="https://love2d.org/">L√ñVE</a> framework, using the classic <a href="https://ru.wikipedia.org/wiki/Asteroids">Asteroids</a> atari machine game as an example. <br><a name="habracut"></a><br><h3>  Pochemuchuk </h3><br>  What is L√ñVE and why exactly this? <br><br>  L√ñVE is a framework for two-dimensional games.  It is not an engine, only an interlayer between Lua and SDL2, with additional nice features, such as clean syntax, a minimum of additional gestures to get OpenGL to work, and a set of libraries (like Box2d) that allow you to do something funny, and places to pick what came out.  But, moreover, L√ñVE is distinguished by a minimum of gag and a low level of interaction with iron, which allows you to make your engine around the framework (for self-study / further use) or to immediately hardcod a toy. <br><br>  The simplicity of the framework allows you to write simple prototypes or even mini-games for those who are not programmers, concentrating on the programming process, and not on the development of a specific engine technology.  My practice has shown that students aged 14-17 years old, are much more pleased to develop simple games than they do classical laboratory work to calculate the roots of quadratic equations or calculating credit rates, and some students begin to go deeper into the material, after which, sometimes become good programmers. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Why Lua?  The language is <a href="http://tylerneylon.com/a/learn-lua/">quite simple</a> to learn, simpler than JavaScript and Python, but it is enough to simply switch from it to both the above and to the low level (C / C ++).  He is also quite popular in the development of video games, as part of something larger (cryEngine, GMod, OpenComputers in Minecraft, etc), and if there is modding in some game - with a very high probability, he uses Lua. <br>  Let the poverty of the standard library not frighten, for most of the tasks there are third-party developments (so popular as to become practically the standard of the language), but in poverty there is a downside, such as the speed of development and the ability to push the language interpreter into the microcontroller, which <a href="http://www.nodemcu.com/index_en.html">some</a> with all the advantages and disadvantages of scripts. <br><br>  Plus L√ñVE by default comes with a LuaJIT virtual machine that speeds up execution many times (critical for games), and allows you to use FFI: connecting C libraries, initializing and using C-structures, which, with metatables, can be turned into lua objects, and which save creation time / memory, etc. <br><br><h3>  Slightly closer to the point </h3><br><br>  For further work, we will need to perform the following set of actions: <br><ol><li>  Download the latest version of L√ñVE from the <a href="https://love2d.org/">official site</a> ; </li><li>  We configure the launch of the current project in L√ñVE, the standard test run method is to open the directory with the main.lua file in the executable love file.  Also, you can pack the contents of the directory with the main.lua file into a zip archive, and either drag and drop onto the executable file, or rename .zip to .love and set up file associations.  I believe that it is easier to configure shortcuts for the current editor, notepad ++ is, for example: <pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Command</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">...</span></span></span><span class="hljs-tag">&gt;</span></span>path/to/love.exe $(CURRENT_DIRECTORY)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Command</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre>  Examples for sublime can be found in the <a href="https://habrahabr.ru/post/202540/">next article</a> ; </li><li>  Create an empty directory and add a file named main.lua to it.  It is desirable that there are no gaps and Cyrillic characters on the way, or some people write spaces, and then complain, but to get around you can change the shortcut or the launch method; </li><li>  Open in our favorite editor our clean and untainted file main.lua, and <a href="https://love2d.org/wiki">L√ñVE-Wiki</a> in your favorite browser. </li></ol><br><h3>  Closer, but not quite </h3><br>  The first thing to know is that the framework functions through a set of callbacks that we write to the global table of love, which is already declared: <br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(arg)</span></span></span></span> <span class="hljs-comment"><span class="hljs-comment">--    love.load    , --     . end function love.update(dt) --   update  draw    , -- ,   : -- "-&gt;-&gt;-&gt;-&gt;" --       . end function love.draw() --       - --     love. love.graphics.print('Hello dear Love user!', 100, 100) end</span></span></code> </pre><br>  After running this code, you should feel enlightened and proceed to the next stage: something that remotely resembles something useful. <br><br><h3>  Already something like a case </h3><br>  Lua, by default, does not have a ‚Äúnormal OOP‚Äù, so this material will have a rather complicated construction for beginners <a href="http://tylerneylon.com/a/learn-lua/">from here</a> , point 3.2, although if you are unfamiliar with the tables, you should read the entire third paragraph. <br><br>  First of all, since we are doing the Asteroids, we want to get the boat, which is highly desirable and more steer. <br><br>  Next, we want to shoot something and targets that can be reached. <br>  Similarly, I would like to count points and manipulate everything in a row. <br><br>  Further there will be a lot of code, but I hope the comments will be quite informative. <br><br><pre> <code class="lua hljs"><span class="hljs-comment"><span class="hljs-comment">--      ,  , --       . local Ship, Bullet, Asteroid, Field Ship = {} --   ,    ship, --       ship. Ship.__index = Ship --       ,     Ship.type = 'ship' --  -        'self'. function Ship:new(field, x, y) -- ,   self,   Ship. --  self   , self   Ship   . self = setmetatable({}, self) --       ,   . self.field = field -- : self.x = x or 100 -- 100 -  self.y = y or 100 --   : self.angle = 0 --    : --  : self.vx = 0 self.vy = 0 -- , /: self.acceleration = 200 --  : self.rotation = math.pi --   : self.shoot_timer = 0 self.shoot_delay = 0.3 -- ,  : self.radius = 30 --   ,    : self.vertexes = {0, -30, 30, 30, 0, 20, -30, 30} --[[  - ,   : /\ / \ /_/\_\ ]] --   . return self end function Ship:update(dt) --  ,   ,     , ? -- dt -  ,      . self.shoot_timer = self.shoot_timer - dt -- : -- "     " -   . if love.keyboard.isDown('x') and self.shoot_timer &lt; 0 then self.field:spawn(Bullet:new(self.field, self.x, self.y, self.angle)) --   ,         , --    . self.shoot_timer = self.shoot_delay end if love.keyboard.isDown('left') then --  ,   dt -   1, -- ,  ,     Pi, --   -  ,    . self.angle = self.angle - self.rotation * dt end if love.keyboard.isDown('right') then self.angle = self.angle + self.rotation * dt end if love.keyboard.isDown('up') then --   ,      . local vx_dt = math.cos(self.angle) * self.acceleration * dt local vy_dt = math.sin(self.angle) * self.acceleration * dt --      . self.vx = self.vx + vx_dt self.vy = self.vy + vy_dt end --         . self.x = self.x + self.vx * dt self.y = self.y + self.vy * dt --    ,       : --    ,   . --    - --   ,   . self.vx = self.vx - self.vx * dt self.vy = self.vy - self.vy * dt --      : --       , --       . local screen_width, screen_height = love.graphics.getDimensions() if self.x &lt; 0 then self.x = self.x + screen_width end if self.y &lt; 0 then self.y = self.y + screen_height end if self.x &gt; screen_width then self.x = self.x - screen_width end if self.y &gt; screen_height then self.y = self.y - screen_height end end function Ship:draw() --   , --        . love.graphics.setColor(255,255,255) --     , --  ,     . --     . love.graphics.push() --       . love.graphics.translate (self.x, self.y) --      . --  Pi/2 ,      --      , ,   --       . love.graphics.rotate (self.angle + math.pi/2) --   , line - , fill -  . love.graphics.polygon('line', self.vertexes) -- , ,      -- ( love.graphics.push()). love.graphics.pop() --    , --  /  : --     ,     --      /. --          . --       , end -- "!   ! ? ,   !" --    . --  ,   ,    . --        : Bullet = {} Bullet.__index = Bullet --  -      , --         , --      : Bullet.type = 'bullet' Bullet.speed = 300 function Bullet:new(field, x, y, angle) self = setmetatable({}, self) --    self.field = field self.x = x self.y = y self.radius = 3 --   self.life_time = 5 --     --       : self.vx = math.cos(angle) * self.speed self.vy = math.sin(angle) * self.speed --     self   speed, --        -- __index   return self end function Bullet:update(dt) --   : self.life_time = self.life_time - dt if self.life_time &lt; 0 then --      , --    . self.field:destroy(self) return end --    self.x = self.x + self.vx * dt self.y = self.y + self.vy * dt --         local screen_width, screen_height = love.graphics.getDimensions() if self.x &lt; 0 then self.x = self.x + screen_width end if self.y &lt; 0 then self.y = self.y + screen_height end if self.x &gt; screen_width then self.x = self.x - screen_width end if self.y &gt; screen_height then self.y = self.y - screen_height end end function Bullet:draw() love.graphics.setColor(255,255,255) --    . -- , ,      love.graphics.circle('fill', self.x, self.y, self.radius) end --   ?   , . Asteroid = {} Asteroid.__index = Asteroid Asteroid.type = 'asteroid' function Asteroid:new(field, x, y, size) self = setmetatable({}, self) --   . --      , --        . self.field = field self.x = x self.y = y --     1-N. self.size = size or 3 --    -   . self.vx = math.random(-20, 20) self.vy = math.random(-20, 20) self.radius = size * 15 --   --    , --       --   .    . --   ,      : self.hp = size + math.random(2) --      . self.color = {math.random(255), math.random(255), math.random(255)} return self end --   ,     function Asteroid:applyDamage(dmg) --     -   dmg = dmg or 1 self.hp = self.hp - 1 if self.hp &lt; 0 then --   -   self.field.score = self.field.score + self.size * 100 self.field:destroy(self) if self.size &gt; 1 then --    . for i = 1, 1 + math.random(3) do self.field:spawn(Asteroid:new(self.field, self.x, self.y, self.size - 1)) end end --    ,  true,     . return true end end --         local function collide(x1, y1, r1, x2, y2, r2) --       : local distance = (x2 - x1) ^ 2 + (y2 - y1) ^ 2 --        -  . --          . local rdist = (r1 + r2) ^ 2 return distance &lt; rdist end function Asteroid:update(dt) self.x = self.x + self.vx * dt self.y = self.y + self.vy * dt --          , --        : for object in pairs(self.field:getObjects()) do --      . if object.type == 'bullet' then if collide(self.x, self.y, self.radius, object.x, object.y, object.radius) then self.field:destroy(object) --    -  true. if self:applyDamage() then --     -    return end end elseif object.type == 'ship' then if collide(self.x, self.y, self.radius, object.x, object.y, object.radius) then --  messagebox   . --   ,     . local head = 'You loose!' local body = 'Score is: '..self.field.score..'\nRetry?' local keys = {"Yea!", "Noo!"} local key_pressed = love.window.showMessageBox(head, body, keys) --     "Noo!": if key_pressed == 2 then love.event.quit() end self.field:init() return end end end --   - ,    ! local screen_width, screen_height = love.graphics.getDimensions() if self.x &lt; 0 then self.x = self.x + screen_width end if self.y &lt; 0 then self.y = self.y + screen_height end if self.x &gt; screen_width then self.x = self.x - screen_width end if self.y &gt; screen_height then self.y = self.y - screen_height end end function Asteroid:draw() --    : love.graphics.setColor(self.color) -- , ,      love.graphics.circle('line', self.x, self.y, self.radius) end -- ,      : Field = {} Field.type = 'Field' --   ,       , --    __index  ,    , --      . --   /  -   . function Field:init() self.score = 0 --       self.objects = {} local ship = Ship:new(self, 100, 200) print(ship) self:spawn(ship) end function Field:spawn(object) --     : --        . self.objects[object] = object end function Field:destroy(object) --   . self.objects[object] = nil end function Field:getObjects() return self.objects end function Field:update(dt) --     ,    . --      . local asteroids_count = 0 for object in pairs(self.objects) do --     if object.update then object:update(dt) end if object.type == 'asteroid' then asteroids_count = asteroids_count + 1 end end if asteroids_count == 0 then for i = 1, 3 do --       local y = math.random(love.graphics.getHeight()) self:spawn(Asteroid:new(self, 0, y, 3)) end end end function Field:draw() for object in pairs(self.objects) do if object.draw then object:draw() end end love.graphics.print('\n Score: '..self.score) end --  :        : function love.load() Field:init() end function love.update(dt) Field:update(dt) end function love.draw() Field:draw() end</span></span></code> </pre><br>  When trying to copy-paste and first run the above sheet, we can get something similar to the classic asteroids. <br><br><img src="https://habrastorage.org/webt/10/xb/_i/10xb_ignzxvs7thdhfcvasurqvo.png" alt="image"><br><br>  It looks good, but you can do better: <br><br>  1. Spatial indexing, to speed up the calculation of objects; <br>  2. Better organization of the manager, with key identifiers; <br>  3. All the same, apply inheritance in classes of game objects, inherit them from the ‚Äúspherical in vacuum‚Äù (literally) object having coordinates and radius, etc. <br><br>  The implementation of these items will remain the homework of those who still decide to unearth the sheet and slightly deepen. <br><br>  Yes, this material was written for version L√ñVE 0.10.2. <br>  For people from the future who will find versions 0.11.X and older: in this source code, you need to correct the color table by changing the values ‚Äã‚Äãfrom the range 0-255 to the corresponding proportions 0-1, i.e.  eg: <br><br><pre> <code class="lua hljs"> <span class="hljs-comment"><span class="hljs-comment">--   : color = {0, 127, 255} --   -  : color = {0, 0.5, 1}</span></span></code> </pre><br>  PS: I will be happy with feedback and answers to the topic ‚Äúwill the articles about the creation of small toys and / or tools for this framework be valuable‚Äù. </div><p>Source: <a href="https://habr.com/ru/post/346136/">https://habr.com/ru/post/346136/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346126/index.html">Tachometer or speedometer: The flow of thoughts about measuring the frequency in the Arduino</a></li>
<li><a href="../346128/index.html">February 31</a></li>
<li><a href="../346130/index.html">So why aren't you participating in the development of open source software?</a></li>
<li><a href="../346132/index.html">Stimulus 1.0: a modest JavaScript HTML framework that you already have</a></li>
<li><a href="../346134/index.html">Genetic algorithm for constructing algorithms</a></li>
<li><a href="../346138/index.html">Game Design Techniques: Mixing</a></li>
<li><a href="../346140/index.html">Results of the development of computer vision in one year</a></li>
<li><a href="../346142/index.html">Hot reboot of components in React</a></li>
<li><a href="../346144/index.html">Mobile devices from the inside. Memory markup, file structure description and markup memory</a></li>
<li><a href="../346146/index.html">Python, under the pirate flag</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>