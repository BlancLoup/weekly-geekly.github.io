<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to make framework-independent controllers?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Controllers are generally considered to be the most related classes in an application. As a rule, based on the request data, they receive or save the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to make framework-independent controllers?</h1><div class="post__text post__text-html js-mediator-article">  Controllers are generally considered to be the most related classes in an application.  As a rule, based on the request data, they receive or save the data in a database, then convert the data or the result of saving into HTML, which acts as a response to the client who made the request. <br><br>  It turns out that the controllers are everywhere, they connect those parts of the application that are usually quite independent of each other.  This greatly increases the connectedness of the controllers: among their dependencies is the Doctrine entity manager, Twig template engine, the base controller from the FrameworkBundle, and so on. <br><br>  In this post I will show that this level of connectedness is completely unnecessary.  I'll show you how to significantly reduce connectivity by taking just a few simple steps.  As a result, we get a controller that can be reused in different types of applications, for example, based on Silex or even Drupal. <br><a name="habracut"></a><br><h4>  Part I: Do not use standard controllers. </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Excessive Connectivity: Inheritance from the Base Controller </h5><br>  Basically, the controller classes that I come across inherit from the Controller class from the FrameworkBundle: <br><br><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Bundle</span></span>\<span class="hljs-title"><span class="hljs-title">FrameworkBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ ... }</code> </pre> <br><br>  The base controller class adds several useful shortcuts, such as createNotFoundException () and redirect ().  It also automatically makes your controller the successor of ContainerAware (‚Äúaware‚Äù of the container), as a result of which the Dependency Injection Container (DIC) will be automatically injected into the controller.  From the container you can get any service you need. <br><br><h5>  Do not use helper methods! </h5><br>  All this, of course, seems very convenient, but if a little less lazy, you can significantly reduce connectivity.  There is nothing wrong with throwing out these auxiliary methods: the bodies of most of them still consist of just one line (look at the basic controller to see what is really happening there!).  You can easily replace calls to these methods with a code of them: <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">someAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// : throw $this-&gt;createNotFoundException($message); // : throw new NotFoundHttpException($message); } }</span></span></code> </pre><br><br><h5>  Use dependency injection </h5><br>  If you no longer use helper methods from the parent class of the controller, then you can take another step to get rid of this unnecessary inheritance.  Instead of getting the dependencies from the container, inject them manually in the constructor: <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">someAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;get(<span class="hljs-string"><span class="hljs-string">'doctrine'</span></span>)-&gt;getManager(...)-&gt;persist(...); } } <span class="hljs-comment"><span class="hljs-comment">//  : use Doctrine\Common\Persistence\ManagerRegistry; class MyController extends Controller { public function __construct(ManagerRegistry $doctrine) { $this-&gt;doctrine = $doctrine; } public function someAction() { $this-&gt;doctrine-&gt;getManager(...)-&gt;persist(...); } }</span></span></code> </pre><br><br><h5>  Make your controller a service. </h5><br>  You also need to make sure that the new controller service is assembled not just by calling the new operator, as the ControllerResolver normally does, and all dependencies of your controller are correctly injected.  To do this, you need to declare the service: <br><br><pre> <code class="ruby hljs"><span class="hljs-symbol"><span class="hljs-symbol">services:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">my_controller:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyController</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">arguments</span></span></span><span class="hljs-class">: - @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">doctrine</span></span></span></span></code> </pre><br>  And the routing settings also need to be corrected.  If you use annotations: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Route</span></span></span><span class="hljs-comment">(service="my_controller") */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ ... }</code> </pre><br>  And if your routing is saved in a YML configuration file: <br><br><pre> <code class="ruby hljs"><span class="hljs-symbol"><span class="hljs-symbol">my_action:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">path:</span></span> /some/path <span class="hljs-symbol"><span class="hljs-symbol">defaults:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">_controller:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">my_controller:</span></span>someAction</code> </pre><br><br>  Finally, it is no longer necessary to inherit from the standard symphony controller, we also do not need the controller to know anything about the DI container, since all its dependencies are injected into the arguments of the constructor.  And we are no longer dependent on the helper methods of the base class, which means that now we can finally remove the extends Controller along with the use-expression from the class declaration of our controller: <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyController</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre><br><br>  This is how we get a lot of bonus points for unlinked code! <br><br>  In the <a href="http://habrahabr.ru/post/227787/">next post</a> we will talk about annotations and how our code will become even less related if we get rid of them. </div><p>Source: <a href="https://habr.com/ru/post/227781/">https://habr.com/ru/post/227781/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../227763/index.html">Payoneer and Ball To All - a ball for each child</a></li>
<li><a href="../227767/index.html">Configuring OpenVPN in the Mikrotik / Ubuntu bundle</a></li>
<li><a href="../227769/index.html">Include Node.js in your solution for Microsoft Azure</a></li>
<li><a href="../227775/index.html">Acronis True Image for Mac - why and for whom?</a></li>
<li><a href="../227777/index.html">Educational startup Coursmos attracted an investment of $ 530,000</a></li>
<li><a href="../227783/index.html">Starting a nuclear reactor looks cooler than you think.</a></li>
<li><a href="../227785/index.html">Level 80 Watchmaker</a></li>
<li><a href="../227787/index.html">Get rid of annotations in your controllers!</a></li>
<li><a href="../227789/index.html">A quick look at the new tablets from Samsung</a></li>
<li><a href="../227791/index.html">Creating audio plugin, part 11</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>