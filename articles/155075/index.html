<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to get rid of ORA-01410 by isolating intact data</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At one time, I seriously got my hand on what task - on a number of tables, several lines were beaten as a result of compression and an Oracle bug. As ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to get rid of ORA-01410 by isolating intact data</h1><div class="post__text post__text-html js-mediator-article">  At one time, I seriously got my hand on what task - on a number of tables, several lines were beaten as a result of compression and an Oracle bug.  As a result, users with Fulskane received ORA-01410 according to such tables. <br>  Consider the most difficult case - when there are no backups or indexes (in this case, the indexed columns can be obtained by scanning the index).  In this case, the only option is to find the problematic ROWID and ‚Äúgo around‚Äù it from two sides, isolating the intact data. <br><a name="habracut"></a><br>  First, let's remove the trace by the problematic request in order to get the initial data: <br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">session</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> db_file_multiblock_read_count=<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">session</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">events</span></span> <span class="hljs-string"><span class="hljs-string">'immediate trace name trace_buffer_on level 1048576'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">session</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">events</span></span> <span class="hljs-string"><span class="hljs-string">'10200 trace name context forever, level 1'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">session</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">events</span></span> <span class="hljs-string"><span class="hljs-string">'1410 trace name errorstack forever, level 10'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">session</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> tracefile_identifier=<span class="hljs-string"><span class="hljs-string">'ORA1410'</span></span>;</code> </pre> <br><br>  and run the problem query <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> test.testtable;</code> </pre><br>  We find in record a record like this: <br><pre> <code class="cpp hljs">ktrget2(): started <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> block &lt;<span class="hljs-number"><span class="hljs-number">0x0645</span></span> : <span class="hljs-number"><span class="hljs-number">0x3ce2c85b</span></span>&gt; objd: <span class="hljs-number"><span class="hljs-number">0x00f842bb</span></span> env: (scn: <span class="hljs-number"><span class="hljs-number">0x0a21</span></span><span class="hljs-number"><span class="hljs-number">.9</span></span>a61c1d8 xid: <span class="hljs-number"><span class="hljs-number">0x0000</span></span><span class="hljs-number"><span class="hljs-number">.000</span></span><span class="hljs-number"><span class="hljs-number">.00000000</span></span> uba: <span class="hljs-number"><span class="hljs-number">0x00000000</span></span><span class="hljs-number"><span class="hljs-number">.0000</span></span><span class="hljs-number"><span class="hljs-number">.00</span></span> statement num=<span class="hljs-number"><span class="hljs-number">0</span></span> parent xid: xid: <span class="hljs-number"><span class="hljs-number">0x0000</span></span><span class="hljs-number"><span class="hljs-number">.000</span></span><span class="hljs-number"><span class="hljs-number">.00000000</span></span> scn: <span class="hljs-number"><span class="hljs-number">0x0000</span></span><span class="hljs-number"><span class="hljs-number">.00000000</span></span> <span class="hljs-number"><span class="hljs-number">96</span></span>sch: scn: <span class="hljs-number"><span class="hljs-number">0x0000</span></span><span class="hljs-number"><span class="hljs-number">.00000000</span></span> mascn: (scn: <span class="hljs-number"><span class="hljs-number">0x0a1f</span></span>.ccec0b27) OBJD MISMATCH typ=<span class="hljs-number"><span class="hljs-number">6</span></span>, seg.obj=<span class="hljs-number"><span class="hljs-number">16270011</span></span>, diskobj=<span class="hljs-number"><span class="hljs-number">16268354</span></span>, dsflg=<span class="hljs-number"><span class="hljs-number">100001</span></span>, dsobj=<span class="hljs-number"><span class="hljs-number">16270011</span></span>, tid=<span class="hljs-number"><span class="hljs-number">16270011</span></span>, cls=<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br><br>  By the obtained value we get Block_number and Relative_fno: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> dbms_utility.data_block_address_file(to_number(<span class="hljs-string"><span class="hljs-string">'3ce2c85b'</span></span>, <span class="hljs-string"><span class="hljs-string">'xxxxxxxx'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">file</span></span><span class="hljs-comment"><span class="hljs-comment">#, dbms_utility.data_block_address_block(to_number('3ce2c85b', 'xxxxxxxx')) block# from dual; FILE# BLOCK# 243 2279515</span></span></code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Additionally, we find the data_object_id of the problem object: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> data_object_id <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dba_objects <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> owner = <span class="hljs-string"><span class="hljs-string">'test'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> object_name = <span class="hljs-string"><span class="hljs-string">'testtable'</span></span>; data_object_id <span class="hljs-comment"><span class="hljs-comment">---------------------- 16402245</span></span></code> </pre><br><br>  Based on the obtained values, we form a ROWID: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> dbms_rowid.rowid_create(rowid_type =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>,object_number =&gt; <span class="hljs-number"><span class="hljs-number">16402245</span></span>,relative_fno =&gt; <span class="hljs-number"><span class="hljs-number">243</span></span>,block_number =&gt; <span class="hljs-number"><span class="hljs-number">2279515</span></span>,row_number =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dual; ROWID=AA+kdFADzAAIshbAAA</code> </pre><br>  Well and, actually, what I mentioned at the beginning - we go around the problem line from all sides: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> test.testtable_nocorrupt <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-comment"><span class="hljs-comment">/*parallel(8)*/</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> test.testtable <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-keyword"><span class="hljs-keyword">rowid</span></span>&lt;<span class="hljs-string"><span class="hljs-string">'AA+EK7ADzAAIshbAAA'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> test.testtable_nocorrupt <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-comment"><span class="hljs-comment">/*parallel(8)*/</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> test.testtable <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-keyword"><span class="hljs-keyword">rowid</span></span>&gt;=<span class="hljs-string"><span class="hljs-string">'AA+EK7ADzAAIshcAAA'</span></span>;</code> </pre><br><br>  I would like to note that such problems would most likely have been avoided by having the DB parameters set to db_block_checking / db_block_checksum = 'Full' or db_ultra_safe = 'data_and_index', which would load the processor somewhat (~ 5%, although this is discussed), but gave would be extra reliability. <br><br>  <u>Used notes Metalink:</u> <br>  <a href="">Extracting Data from a Corrupt Table using ROWID Range Scans in Oracle8 and higher [ID 61685.1]</a> <br>  <a href="">OERR: ORA-8103 "object no longer exists" / Troubleshooting, Diagnostic and Solution [ID 8103.1]</a> <br></div><p>Source: <a href="https://habr.com/ru/post/155075/">https://habr.com/ru/post/155075/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../155063/index.html">Release of the new version of the modLivestreet 0.3.0-rc module</a></li>
<li><a href="../155067/index.html">Carmageddon did come out!</a></li>
<li><a href="../155069/index.html">The first stable SDK for Dart</a></li>
<li><a href="../155071/index.html">Rambler-Kart API Widgets</a></li>
<li><a href="../155073/index.html">Internet Explorer for Xbox</a></li>
<li><a href="../155077/index.html">Google introduced the ‚ÄúDisavow links‚Äù feature to selectively remove the influence of spamming external links.</a></li>
<li><a href="../155079/index.html">Foresight "Cloud services - myth or reality?"</a></li>
<li><a href="../155081/index.html">Supermarket chain in China is going to open augmented reality stores</a></li>
<li><a href="../155083/index.html">Updated Windows Azure Mobile Services: iOS support and more</a></li>
<li><a href="../155085/index.html">Color theory</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>