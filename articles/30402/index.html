<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>flash video on web pages and php</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is a reprint of an article dated November 16, 2007 from my blog, the link to which can be found in my own profile - but, since it so happ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>flash video on web pages and php</h1><div class="post__text post__text-html js-mediator-article">  This article is a reprint of an article dated November 16, 2007 from my blog, the link to which can be found in my own profile - but, since it so happened that this topic seems to be still interesting to many, besides not so long ago I read a report on this topic at the PHPConf conference ... well, judge for yourself. <br><br><h2>  Introduction </h2><br>  Recently, the technology of broadcasting videos via the web is becoming more and more widespread - without the need to download media content to the user's machine, with viewing directly from the browser.  Thus, you can view a fairly large number of different video formats, however, this requires the presence of certain plug-ins on the user's side.  Obviously, the most common such plugin is <em>flash-player</em> (well, well, well: to be precise, it cannot, of course, play video by itself - but it makes it easy to create an application that can play video content).  A striking example of this approach is <a href="http://youtube.com/">youtube.com</a> .  I will try to talk about how to independently organize flash video broadcasts on my web page and what are the approaches to this problem. <br><br><a name="habracut"></a><br>  It should be noted that the article does not claim to be any innovative at all and is pure compilation from sources available in open form.  I hope, nevertheless, that this compilation will give many the necessary minimum knowledge of the subject of the report, which will lay the foundation for its own development and research. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  1. About FLV format </h2><br>  So, <em>flash-player</em> plays video in FLV format, does not understand other formats. <br>  More information about the format itself can be found, for example, here: <a href="http://en.wikipedia.org/wiki/FLV">en.wikipedia.org/wiki/FLV</a> , as well as, of course, on the website of Adobe, the manufacturer of <em>flash-player</em> .  As part of this report, we will not need detailed knowledge of the format, and those that are needed are listed below. <br>  An FLV file consists of a title and the actual movie itself. <br>  The title contains certain meta-information about the film: duration, size, etc., etc. In fact, we are interested in this meta-information only in one circumstance - namely, that it contains data on key frames of the film (their position on the time and byte scale).  Meta-information itself is an arbitrary nesting associative array, serialized into AMF format, which is one of the accepted standards when developing applications on flash. <br>  <em>Note</em> : for PHP, there are several libraries that allow (de) serialization to / from AMF. <br><br><h2>  2. How to organize the translation of FLV-files on web pages </h2><br>  In order to consider the broadcast successful, two conditions must be met: the server successfully showed the content, and the client looked at it no less successfully.  Accordingly, two parts of the application are needed - the server and the client.  The client is a <em>flash</em> application that can play a video stream from the specified URL.  There are many similar programs, and we will not dwell on them here.  Let's talk about the server side.  So, what are the possible ways of implementation? <br><br><h3>  2.1.  Download - Download </h3><br>  This is the easiest way.  It requires a simple client that simply requests a video stream at a given URL and reproduces it. The server only needs to process the HTTP request and issue the corresponding content.  No specific software needed. <br>  ‚ÄúThen why are there any other other ways?‚Äù - such a question is difficult not to ask.  However, not everything is so smooth with this method ... The fact is that if it is great for showing small video clips, up to 2-3 minutes long, then films cannot be longer than that: for a user to watch any a piece of film, it is necessary that this piece has already downloaded to his computer.  In other words, being at the beginning of the film, we cannot move the ‚Äúslider‚Äù of the timer to the end and see the final credits.  This method also does not provide any opportunities to protect video content from downloading. <br><br><h3>  2.2.  Streaming - streaming video </h3><br>  This method is perhaps the most advanced.  Here there is the possibility of rewinding to an arbitrary place in the stream, certain content protection mechanisms (frankly speaking, these mechanisms only make it difficult to obtain content, being, in fact, protected only from an incompetent cracker).  Also useful feature - the organization of "live" video broadcasts.  If you need live broadcasts - you need to stream, you have no other way out. <br>  Well, the same question arises as with the previous method: ‚Äúif streaming is so good, then why are there any other other ways?‚Äù.  Streaming is good, but not everyone can afford it.  For a media server (for example, "Flash Media Server") will have to pay a tidy sum.  However, there are also open source solutions, for example, <em>ffserver</em> (which, however, does not quite fit the topic of the report, because it does not know how to stream files), as well as <em>Red5</em> , which is written in <em>Java</em> and therefore also not suitable for everyone. <br><br><h3>  2.3.  HTTP streaming (streaming video over HTTP) </h3><br>  From the name you can make a guess that the third method is a combination of the first two.  In some approximation, we can assume that this is so.  As we have already noted, a big disadvantage of the 1st method (download) is the impossibility of rewinding to an arbitrary place of the film.  In HTTP-streaming, this problem is solved as follows: when rewinding to a place that has not yet been downloaded to the user's machine, the current download stops and a new request is sent to the server, containing a pointer to where to start downloading from the movie.  There are certain subtleties that we will discuss in more detail in the next chapter.  As for the advantages and disadvantages of this approach ... In my opinion, to translate files is the best option.  It is simple enough to implement it in any language (scripting like PHP or Ruby - or compiled as C), so you can decide what to use based on the requirements for speed of development, speed of the resulting application, existing Software and other, other.  Also for such popular fast web servers as <em>Nginx</em> and <em>Lighttpd</em> there are ready-made modules for broadcasting FLV files written in C and working very fast. <br>  In this way I will dwell a little more ... <br><br><h2>  3.Http-streaming </h2><br>  So, let's take a closer look at the option of broadcasting flash videos using Http-streaming.  As we have already said, in order to play a movie from an arbitrary location, the client sends an HTTP request to the server containing the ‚Äúcoordinate‚Äù of the location from which the video stream should be output.  well, for example: <a href="http://localhost/flv/film.php%3Fstart%3DXXXXX">localhost / flv / film.php? start = XXXXX</a> .  What is this coordinate?  This is just the byte number from which the desired frame begins.  By the way, you should always start playing the FLV file from the key frame. <br>  ‚ÄúHowever, let me!  Where does the client know this byte number from which the frame starts?  yes even the key? " <br>  I answer.  Remember, at the beginning, when I briefly talked about what the FLV file consists of, I mentioned the meta information that is contained in the header?  This meta-information contains data about the key frames of the film (their positions on the time and byte scale).  Thus, the client can always find the closest key frame to the position in the stream that the user requested - and translate it into bytes, and send them to the server. <br>  And what about the server?  Well, actually, his task is now minimal: process the request, read the parameter value (in our case it is the $ _GET ['start'] variable), and issue the required video file starting with the requested byte.  It's almost like that.  Almost, but not quite.  The FLV file must contain a header.  If the byte requested by the user is not zero, then before outputting the contents of the file, starting with this byte, you need to insert the minimum possible header (to be honest, I did not understand in detail what it is, but I guess it is an empty array or object, serialized to AMF and prefixed with ‚ÄúFLV‚Äù characters). <br><br><h3>  3.1.  Ready solutions: <em>lighttpd</em> , <em>nginx + http_flv_module</em> , <em>flv4php</em> . </h3><br>  Http-streaming support is implemented in the popular <em>lighttpd</em> and <em>nginx</em> web servers.  In the case of using these solutions, you only need to put the FLV files in a place accessible to the web server, everything else is a server and client affair, there is no need to write any program code for the server part.  The client will have to request FLV files by adding the ‚Äústart‚Äù GET parameter to the URL, for example, <a href="">local-nginx / sample.flv? Start = 12345</a> . <br>  There is also a free solution (possibly more of them) based on PHP - <em>flv4php</em> .  Its big plus is that in this project there is a ready player - a client for HTTP-streaming.  The disadvantage is that this solution is rather heavy, and, according to my tests on my working machine, it is very processor-intensive (a strange phenomenon, which we did not find an adequate explanation, however, away from sin, we rushed to refuse to use the server part of <em>flv4php</em> and they limited themselves to borrowing a player from them, which, after being modified for our needs, began to serve us faithfully).  Another drawback is that the first frame of the film is used as a ‚Äúthumbs‚Äù (picture that the user sees when opening the page on the player‚Äôs screen), and this behavior is not customized.  I admit the idea that <em>flv4php</em> can be configured in the best way, and get him to do what he needs without wild workloads on the processor.  Nevertheless, a small fragment of the PHP code below does almost the same thing as <em>flv4php</em> - and is guaranteed to have good performance :) <br><br><h3>  3.2.  Do it yourself or everything just seems complicated. </h3><br> <code>&lt;?php <br> <br> $start = (int) filter_input(INPUT_GET, 'position', FILTER_VALIDATE_INT); <br> if ($start &lt; 0) die("Incorrect request"); <br> // open file for reading <br> $fp = fopen('sample.flv', 'r'); <br> $fsize = filesize($file); <br> if ($start &gt; 0) <br> { <br> // seek to requested position <br> fseek($fp, $start); <br> // FLV header for the movie part. Magic. Trust me ;) <br> // Header code is completely taken from flv4php project <br> $header = "FLV" . pack('C', 1 ) . pack('C', 5 ) . pack('N', 9 ) . pack('N', 9 ); <br> header("Content-Length: " . (strlen($header) + $fsize - $start)); <br> echo $header; <br> } else { <br> header("Content-Length: " . $fsize); <br> } <br> while(!feof($fp)) { <br> print(fread($fp, 1024)); <br> } <br> fclose($fp); <br> <br> ?&gt; <br></code> <br><br>  As you can see, everything is extremely simple, I think, explanations are superfluous. <br><br><h2>  4. Conversion to FLV from other formats.  Basics of <em>ffmpeg</em> &amp; <em>mencoder</em> .  Meta-information and how to shove it into the FLV-file. </h2><br><br>  Whew, practically, we are done.  In this chapter, I will talk a little about how to convert video content into FLV format and how to stuff meta-information into ready-made movies that is necessary for implementing HTTP-streaming.  I will not dwell on software available under MS Windows, instead focus on * nix-solutions (it‚Äôs no secret that most web projects run on servers running * nix / Linux / FreeBSD, and this information may be useful). <br>  The most famous and powerful projects are <em>ffmpeg</em> and <em>mencoder</em> .  Both programs work with most currently known video formats, have an extensive codec base and / or the ability to connect custom codecs.  Both work with good speed (however, you understand that video processing is a thankless task and takes a lot of resources and time). <br>  To convert an existing movie to FLV format, you need to run about the following commands: <br>  <strong>ffmpeg</strong> : <br> <code>$ ffmpeg -i sample.avi sample.flv</code> <br>  (see <em>ffmpeg</em> documentation - <a href="http://ffmpeg.mplayerhq.hu/ffmpeg-doc.html">ffmpeg.mplayerhq.hu/ffmpeg-doc.html</a> for more options) <br>  <strong>mencoder</strong> : <br> <code>$ mencoder sample.avi -of lavf -lavfopts i_certify_that_my_video_stream_does_not_use_b_frames -ovc lavc -lavcopts vcodec=flv:vbitrate=500:mbd=2:mv0:trell:v4mv:cbp:last_pred=3 -oac mp3lame -lameopts abr:br=56 -srate 44100 -o sample.flv</code> <br>  (See the <em>mencoder</em> documentation - <a href="http://www.mplayerhq.hu/DOCS/HTML/en/index.html">www.mplayerhq.hu/DOCS/HTML/en/index.html</a> for more options.) <br>  And again about the meta-information. <br>  Neither <em>ffmpeg</em> nor <em>mencoder</em> insert meta information about key frames into the header of the resulting FLV file.  Meanwhile, this information is absolutely necessary in order to organize HTTP-streaming.  How to be?  To the aid of the developers they come again - open-source products :).  For example, a small program called <em>Yamdi</em> (Yet Another Meta-Data Injector): <a href="http://sourceforge.net/projects/yamdi/">sourceforge.net/projects/yamdi</a> .  With its help, even large FLV-files (well, say, in gigabytes) can be provided with the necessary meta-data in a very short time. <br><br><h2>  Literature and links: </h2><br>  <strong>flv streaming with lighttpd</strong> : <a href="httpd">blog.lighttpd.net/articles/2006/03/09/flv-streaming-with-lighttpd</a> <br>  <strong>Flash Video Streaming with Nginx</strong> : <br>  <a href="http://blog.kovyrin.net/2006/10/14/flash-video-flv-streaming-nginx/">blog.kovyrin.net/2006/10/14/flash-video-flv-streaming-nginx</a> <br><br>  This section is not completely complete, in fact, of course, I had to sort out a little more :) </div><p>Source: <a href="https://habr.com/ru/post/30402/">https://habr.com/ru/post/30402/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../304004/index.html">‚ÄúWhy did I quit algorithmic trading for web startups?‚Äù: The story of a US developer</a></li>
<li><a href="../304008/index.html">Installing Firebird on D-Link DNS-325</a></li>
<li><a href="../30401/index.html">GPS - new standard feature of mobile phones</a></li>
<li><a href="../304014/index.html">We investigate protection and restore arcades Namco System ES1</a></li>
<li><a href="../304016/index.html">Business processes: the good, the bad and the ugly</a></li>
<li><a href="../304020/index.html">Why did not Pied Piper take off: our analysis of the 9th series of the 3rd season of the series ‚ÄúSilicon Valley‚Äù</a></li>
<li><a href="../304024/index.html">"Cut the Gordian knot" or overcoming the problems of encrypting information in Windows</a></li>
<li><a href="../304026/index.html">JSON and PostgreSQL 9.5: with even more powerful tools</a></li>
<li><a href="../304028/index.html">In St. Petersburg to be: reports of the "confrontation" NeoQUEST-2016</a></li>
<li><a href="../304030/index.html">Testing. Errors in certification or ISTQB I really need</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>