<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Approach to designing an internet distribution platform using templates</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habravchane! 
 I want to talk about the project Agora, which is engaged in our team. 
 Agora is a platform that allows you to organize the distrib...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Approach to designing an internet distribution platform using templates</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habravchane! <br>  I want to talk about the project Agora, which is engaged in our team. <br>  Agora is a platform that allows you to organize the distribution of goods via the Internet.  The platform integrates with the distributor's ERP and automates the taking of orders, viewing balances, receiving acts of mutual settlements and much more.  The user works in the web interface of the platform and all his actions are reflected in the distributor's ERP. <br><a name="habracut"></a><br>  In the article <a href="http://centrobit.ru/blog/2011/12/20/kak-ya-napisal-draft-sistemyi-v2v/">‚ÄúHow I wrote the‚Äú draft ‚Äùof the B2B system‚Äù</a> in the blog of our company, I described some of the problems we encountered while creating our platform.  At first, the task did not seem to be difficult for us, smarty was chosen as a template engine on the site side, we did not think about the object model, because  wrote single business modules each for their own purposes.  For example: catalog, reserve, order, search, finance, etc. <br>  As a result, with the expansion of the initial T.Z.  the code became non-scalable and some functions or whole blocks had to be used in several places.  The functions were copied and the question arose of redoing everything anew. <br><br>  <i>When designing the system again, we encountered a number of problems:</i> <br>  1. How to generate different sets of objects depending on the specific situation? <br>  These sets of objects should be more or less ‚Äútransparent‚Äù to other components of the system.  For example, from 1C, the object ‚Äúbuyer‚Äôs order‚Äù is given to us, we need to generate the corresponding object in Agora or update its status. <br><br>  2. How to define the boundaries between classes, especially as they develop along with the system being created? <br>  For example, an order and an invoice are very similar objects.  They both contain the articles of goods, quantity, price and VAT.  But each object has its own properties and methods. And many enterprises have their own ‚Äúchips‚Äù with these 2 objects.  In addition to the standard order, one still has an ‚Äúorder-by-order‚Äù order, while the other has invoices that still have ‚Äúfictitious invoices‚Äù, etc. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      3. How to abstract business logic in objects and separate them from database operations? <br>  For example, one distributor has an order with additional fields in the database, while other such fields do not.  If we write direct queries to the database, we need to correct them each time, and this is not convenient. <br><br>  The questions that arise make us think about pattern design.  We will not delve into the definitions and terms.  They can be found on the Internet. <br>  Perhaps you think that templates are a powerful way to transfer information, or vice versa, that this is just a ‚Äúsoap bubble‚Äù that maliciously ‚Äúacademic‚Äù developers use.  In our case, template design helps a lot. <br><br>  What we got in the end (below was a list of some of the main classes that implement the templates on which the platform objects are built): <br><br> <a href="http://photo.qip.ru/users/328801551/200699250/208723991/"><img hspace="5" vspace="5" src="https://habrastorage.org/getpro/habr/post_images/e71/c31/9aa/e71c319aa019ba20890d37c6d60de5e6.jpg"></a> <br><br>  In general, the main idea is as follows: <br><ul><li>  Object classes inherit from the AgoraDomainObject class.  The AgoraMapper class (data mapper) interacts with the database. </li><li>  The AgoraDomainObjectFactory class generates an object from the mapper. </li><li>  Many objects are controlled by the AgoraDeferredCollection / AgoraCollection classes. </li><li>  The states of the objects (creation, change, mark for deletion) are monitored by AgoraObjectWatcher. </li><li>  The AgoraHelperFactory utility class returns Mapper or Collection. </li><li>  The AgoraPersistenceFactory helper class coordinates Domain, Collection, Mapper objects. </li><li>  All system parameters (including the description of tables in the database) are stored in ini files and loaded 1 time using the AgoraLoader class. </li></ul><br><br>  The diagram below shows the organization of the display of a Product object built on the basis of templates: <br> <a href="http://photo.qip.ru/users/328801551/200699250/208724343/"><img hspace="5" vspace="5" src="https://habrastorage.org/getpro/habr/post_images/a78/a2c/ddb/a78a2cddb6c27b62bbe5f05a5e761a58.jpg"></a> <br><br>  As a result, we give third-party developers an API for working with objects.  The developer does not need to know which SQL queries to execute and which tables.  It is more important to him the fundamental API functions on which he will build his modules. <br><br>  Here is an example of working with goods: <br>  <i>$ id = array (....);</i>  <i>// array id</i> <i><br></i>  <i>$ productMapper = new productMapper ();</i>  <i>// create mapper</i> <i><br></i>  <i>$ productCollection = new productCollection ();</i>  <i>// create collection</i> <i><br></i>  <i>for ($ i = 0; $ i &lt;count ($ id); $ i ++) {</i> <i><br></i>  <i>$ product = $ productMapper-&gt; find ($ id [$ i]);</i>  <i>// product search by id</i> <i><br></i>  <i>$ productCollection-&gt; add ($ product);</i>  <i>// add to collection</i> <i><br></i>  <i>}</i> <i><br></i>  <i>$ product = $ productMapper-&gt; find (1);</i>  <i>// search product number 1</i> <i><br></i>  <i>echo $ product-&gt; toJson ();</i>  <i>// show in json</i> <i><br></i>  <i>echo $ productCollection-&gt; toXML ();</i>  <i>// upload XML collection</i> <br><br>  In the following articles I will tell you more about the technical implementation of Agora. <br>  To be continued‚Ä¶ </div><p>Source: <a href="https://habr.com/ru/post/139263/">https://habr.com/ru/post/139263/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../139254/index.html">Whois history in action or mystery WikiLeaks.org :)</a></li>
<li><a href="../139255/index.html">Design services in the fight against trifles</a></li>
<li><a href="../139256/index.html">Notch gives its employees $ 3,000,000 dividends for 2011</a></li>
<li><a href="../139258/index.html">Canonical creates its own mobile platform.</a></li>
<li><a href="../139259/index.html">Run projects created in Visual Studio 2011 at Visual Studio 2010</a></li>
<li><a href="../139264/index.html">Kanobuvosti, 133rd edition</a></li>
<li><a href="../139265/index.html">Synchronous and asynchronous download images from the network with subsequent processing</a></li>
<li><a href="../139267/index.html">Public services are transparent, but not quality</a></li>
<li><a href="../139268/index.html">Lync and Avaya IPO integration</a></li>
<li><a href="../139270/index.html">Virtual hosting Django, model N</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>