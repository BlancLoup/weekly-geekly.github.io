<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a gulp-plugin on the example of building a dependency graph for Angular JS modules</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Foreword 
 In this article I will share with you the experience of how to create simple plugins for gulp quickly and painlessly. The article is focuse...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a gulp-plugin on the example of building a dependency graph for Angular JS modules</h1><div class="post__text post__text-html js-mediator-article"><h2>  Foreword </h2><br>  In this article I will share with you the experience of how to create simple plugins for gulp quickly and painlessly.  The article is focused on the same teapots as me.  For those who have so far only used the ready-made fruits of the gulp, tearing them off from the great Tree of Knowledge NPM, and have not had much experience with Node JS and its streams. <br><br>  I will not answer questions like "Why create your own plugins if everything is already written that is possible?".  The time will come, and in half an hour you will need to write something very specific to your project.  Break all npm, you will find one abandoned plugin with poor functionality, the author of which is not available, the code is terrible, and so on.  Or maybe it will be such a specific task that you will find absolutely nothing. <br><br>  Such a task for me was the visualization of a large project using Angular JS.  There was a huge amount of angular modules, the connections between which were no longer so obvious to me.  Plus, I wanted to see ‚Äúsaboteurs‚Äù - modules that somehow violated the overall concept of the project (for example, we climbed into another module not directly through the provider, but directly). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Searching, I found <a href="https://github.com/carlo-colombo/grunt-angular-modules-graph">this solution to</a> my problem.  In principle, running grunt plugins in gulp is quite simple, but the implementation in this plugin didn‚Äôt impress me too much.  I did not want to use third-party programs, namely graphviz, as a graph visualization tool.  Plus, who knows what I need more, and dependence on third-party libraries always imposes restrictions. <br><br>  If the reader is only interested in this plugin, and not the article itself, then here is a link to the project on <a href="https://github.com/k-makarov/gulp-ng-graph">github</a> and on <a href="https://www.npmjs.com/package/gulp-ng-graph">npm</a> .  Everyone else - welcome under cat. <br><a name="habracut"></a><br><h2>  Where to begin? </h2><br>  Gulp developers kindly help us in our endeavors by creating wiki documentation for novice plugin developers <a href="">here</a> .  For successful development it is enough to read the title and <a href="">guideline</a> .  You can do without the latter, but if in the future you plan to lay out your module in a public npm, then in order not to collect bricks on your head, I advise you not to go past the guidelines. <br><br>  A brief synopsis of gulp-plugins philosophy: <br><ul><li>  your plugin always accepts a set of Vinyl objects </li><li>  Your plug-in should always give away a set of Vinyl objects (you can not do this, but it will be impossible for other plug-ins to work with the result of your plug-in. This will definitely shoot) </li><li>  what kind of vinyl?  Vinyl file object - in common the simple file.  The path property stores the filename ‚Äî the full path to the file; the contents property ‚Äî a buffer or stream with the contents of the file. </li><li>  never write plugins that will do the same thing as existing node packages.  You will be in the <a href="">blacklist</a> .  And quite rightly </li></ul><br>  Plus, developers are advised to familiarize themselves with well-written simple plugins.  I would advise you to look at the <a href="">gulp-replace</a> code <a href="">.</a> <br><br><h2>  We implement our ideas </h2><br>  I will provide the most well-established gulp plugin template that is used in most good plugins.  A detailed description of the implementation of my task is not the goal of this article.  The main goal is that everyone can quickly "enter" with an example and go to create their own plugin. <br><br>  So, let's begin.  It is assumed that node js is already in the system globally. <br><pre><code class="javascript hljs">npm init</code> </pre> <br>  Main project file let it be index.js.  After filling out the basic information, set the following <br><pre> <code class="javascript hljs">npm install --save through2 gulp-util vinyl</code> </pre> <br>  The first plugin will greatly simplify the processing of vinyl-streams.  The second is useful for generating errors by the plugin.  The third one is useful if you create new vinyl files based on input files.  In my task, it is useful. <br><br>  Let's design.  So, I want to get two files.  The first is a description of a graph in dot format to support graphviz, if that happens.  The second is the html file, having opened which I will see a beautiful graph drawn with the help of d3.  Total in my task there are 3 main actions: <br><ol><li>  get an array of all the angular modules declared in the files that the plugin will take </li><li>  create a .dot graph file based on an array of modules </li><li>  create a visual representation of the graph (html file with d3-script) </li></ol><br>  Create index.js, clean as a canvas, and throw more colors onto it: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> through = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'through2'</span></span>), gutil = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-util'</span></span>), <span class="hljs-comment"><span class="hljs-comment">//    - ModulesReader = require('./lib/modules-reader'), //    GraphBuilder = require('./lib/graph-builder'), //    GraphVisualizer = require('./lib/graph-visualizer'); // ,     gulp,     module.exports = function(options) { //#section  var modulesReader; var graphBuilder; var graphVisualizer; options = options || {}; if (!modulesReader) { modulesReader = new ModulesReader(); } if (!graphBuilder) { graphBuilder = new GraphBuilder(); } if (!graphVisualizer) { graphVisualizer = new GraphVisualizer(); } //#endsection  //,    through    function bufferContents(file, enc, callback) { if (file.isStream()) { //    gulp-util this.emit('error', new gutil.PluginError('gulp-ng-graph', 'Streams are not supported!')); return callback(); } if (file.isBuffer()) { //        modulesReader.read(file.contents, enc); } callback(); } //     function endStream(callback) { var modules = modulesReader.getModules(); if (!modules || !modules.length) { return; } // dot     var builderData = graphBuilder.build({ modules: modules, dot: options.dot || 'ng-graph.dot', }); // html      var htmlFile = graphVisualizer.render({ graph: builderData.graph, html: options.html || 'ng-graph.html', }); //    this.push(builderData.dotFile); this.push(htmlFile); callback(); } return through.obj(bufferContents, endStream); };</span></span></code> </pre><br><br>  It is important to remember that if you plan to return processed input files, you need to call this.push (file) in the bufferContents function after manipulating the contents of the file.  But if you plan (as in my task) to generate new files based on input files, then you definitely need the endStream function, where the stream is not yet closed and you can add your files to an empty stream. <br><br>  Since the main purpose of the article is to learn how to write gulp plugins with a specific example, I will not give here the implementation of <a href="">ModulesReader</a> , <a href="">GraphBuilder</a> and <a href="">GraphVisualizaer</a> , which are specific to my specific task.  If someone is interested in their implementation, then welcome to the <a href="https://github.com/k-makarov/gulp-ng-graph">github</a> <br><br>  The result of the plug-in is such a nice graph of the project on d3 with the possibility of zooming. <br><br><img src="https://habrastorage.org/files/1b1/e51/f54/1b1e51f542344bc1829377f5753f786e.png"><br></div><p>Source: <a href="https://habr.com/ru/post/257275/">https://habr.com/ru/post/257275/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../257259/index.html">VMware's Virtual Volumes - Can't I Deploy?</a></li>
<li><a href="../257261/index.html">Website under the microscope: a new analysis of search queries</a></li>
<li><a href="../257269/index.html">Changing the partitioning scheme for a rented VPS</a></li>
<li><a href="../257271/index.html">3D pen: prototyping or not?</a></li>
<li><a href="../257273/index.html">High-performance DEFLATE compression with optimized genomic data sets</a></li>
<li><a href="../257279/index.html">STM32. We connect ISO7816 smart cards</a></li>
<li><a href="../257281/index.html">We spread PHP</a></li>
<li><a href="../257283/index.html">What prepares us for C # 7 (Part 2. Pattern matching)</a></li>
<li><a href="../257285/index.html">Cards, money, two stars</a></li>
<li><a href="../257287/index.html">Head Unit - as a target for a hacker</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>