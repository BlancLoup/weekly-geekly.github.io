<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Interpreter from gateways</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If your education is over after the second class, if vocabulary is limited, and speech is not clear, if you are just stupid, you do not know these inc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Interpreter from gateways</h1><div class="post__text post__text-html js-mediator-article">  If your education is over after the second class, if vocabulary is limited, and speech is not clear, if you are just stupid, you do not know these incomprehensible Latin letters, but you still want to become a programmer, our bydloyazyk Yoba will help you.  Yoba is a language for real guys! <br><br>  But seriously, somehow we have at work someone jokingly suggested writing a gop-language so that anyone could feel himself a programmer.  Starting construction with the word "cho" and all that.  It should be noted here that, having not met computer science education in my life, I missed all those interesting courses on building compilers, formal grammars and other goodies that normal students like in their second or third year.  Wirth's book on building compilers, although I added knowledge of all sorts of clever terms like BNF, but I didn‚Äôt bring any practical benefit ‚Äî I never wrote a single compiler.  Therefore, the task turned out to be quite interesting for me. <br>  If you are over 18, adequately perceive the obscene vocabulary of our native language and you are wondering where to start, welcome under cat. <br><a name="habracut"></a><br>  Of all the tools for working with grammar, I have met only a few mentions.  Firstly, it‚Äôs of course lex, flex, yacc, bison and antlr, which are used primarily for C / C ++ compilers.  Secondly, it is ocamllex and ocamlyacc - which are intended for the development of a compiler, as it is easy to guess, on a scale.  And thirdly, it is fslexx and fsyacc - the same, only for the F # language, which is copied from ocaml a little less than completely, but later it was overgrown with a rather large number of buns.  F # I dismissed as missing in my system, and all plus funds - because of their multiplicity.  Yes, sometimes a rich choice is also bad, I was afraid to get lost in all these lexers and parsers. <br><br>  By the way, it was a rather strange and unpleasant discovery for me that it turns out that the analysis of any language consists of two separate stages that are performed by different tools, it seemed to me that why not do everything in one.  But alas. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Types of language </h5><br>  I will not lie, I did not immediately think through the entire architecture of the language and finished the features gradually.  But to reduce the size of the material (and to quickly go through the path that I took six beautiful morning Sunday hours), we pretend that everything was planned in advance.  Each instruction of our language is, let's say, an object.  In C ++, it could be represented as one of the descendants of a certain base class Instruction, or as a complex structure, or even as a union.  Fortunately, okaml allows us to do everything as simple as possible.  Our first file, yobaType.ml, which describes all possible types of instructions, is as simple as possible: <br><blockquote><code>type action = <br> DoNothing <br> | AddFunction of string * action list <br> | CallFunction of string <br> | Stats <br> | Create of string <br> | Conditional of int * string * action * action <br> | Decrement of int * string <br> | Increment of int * string;;</code> </blockquote> <br>  Each language construct will be cast to one of these types.  DoNothing is just a NOP operator, it doesn‚Äôt do anything.  Create creates a variable (we always have integers), Decrement and Increment, respectively, decrease and increase the specified variable by a certain number.  In addition, there are Stats for displaying statistics on all created variables and Conditional is our if implementation, which can check if a given variable has a required value (or large).  At the very end, I added AddFunction and CallFunction - the ability to create and call your own functions, which are in fact very procedures. <br><br><h5>  Grammar language </h5><br>  The next stage we will describe the grammar, those constructions of our language, which will be transformed into instructions of one of the types. <br><br>  Before showing the code, I will tell you how our language works.  Any construction other than requesting statistics (this is our service team, as it were) and the creation of a function begins and ends with keywords.  Because of this, we can safely arrange any line breaks and indents.  In addition to this (we are working with the Russian language), I specifically created a pair of instructions for the cases when it is necessary to pass both a variable and a value.  Later you will see why it was needed.  So, our file yobaParser.mly: <br><blockquote> <code>%{ <br> open YobaType <br> %} <br> <br> %token &lt;string&gt; ID <br> %token &lt;int&gt; INT <br> <br> %token RULEZ <br> %token GIVE TAKE <br> %token WASSUP DAMN <br> %token CONTAINS THEN ELSE <br> %token FUCKOFF <br> %token STATS <br> %token MEMORIZE IS <br> %token CALL <br> <br> %start main <br> %type &lt;YobaType.action&gt; main <br> <br> %% <br> <br> main: <br> expr                                          { $1 } <br> expr: <br> fullcommand                                   { $1 } <br> | MEMORIZE ID IS fullcommandlist DAMN           { AddFunction($2, $4) } <br> fullcommandlist: <br> fullcommand                                   { $1 :: [] } <br> | fullcommand fullcommandlist                   { $1 :: $2 } <br> fullcommand: <br> WASSUP command DAMN                           { $2 } <br> | STATS                                         { Stats } <br> command: <br> FUCKOFF                                       { DoNothing } <br> | GIVE ID INT                                   { Increment($3, $2) } <br> | GIVE INT ID                                   { Increment($2, $3) } <br> | TAKE ID INT                                   { Decrement($3, $2) } <br> | TAKE INT ID                                   { Decrement($2, $3) } <br> | RULEZ ID                                      { Create($2) } <br> | CALL ID                                       { CallFunction($2) } <br> | CONTAINS ID INT THEN command ELSE command     { Conditional($3, $2, $5, $7) } <br> | CONTAINS INT ID THEN command ELSE command     { Conditional($2, $3, $5, $7) } <br> %%</code> </blockquote> <br>  First we insert the header - the opening of the YobaType module, which contains our type of action, described at the very beginning.  For numbers and strings that are not keywords of the language (variables), we declare two special types, which indicate what they contain.  For each of the keywords using the% token directive, we also create our own type, which will identify this word in the grammar.  It would be possible to indicate all of them at least in one line, just such a record groups everything according to the types of instructions.  Keep in mind that all the tokens we create are exactly the wildcard types by which the grammar parser determines what to do.  You can call them as you please, how they will look in the language itself, we will describe later.  We indicate that the input point for the grammar is main, and that it must always return an object of type action ‚Äî the instruction for the interpreter.  Finally, after two %% signs, we describe the grammar itself: <br><ul><li>  The instruction consists of either a command (fullcommand) or a function creation. </li><li>  The function, in turn, consists of a list of commands (fullcommandlist). </li><li>  A command can be either service (STATS) or normal (command), in which case it should be wrapped in keywords. </li><li>  With an ordinary team, everything is simple, I will not even paint. </li></ul><br>  In curly brackets, we indicate what to do if the string matches this option, and $ N denotes the Nth member of the construct.  For example, if we meet ‚ÄúCALL ID‚Äù (ID is a string, do not forget), then we create a CallFunction instruction, with which we pass $ 2 as a parameter (just ID) - the name of the function being called. <br><br><h5>  Lexer - turn language into keywords </h5><br>  We reached at the same time almost the simplest and most dreary part.  It is simple, because it only describes the transformation of the words of a language into our tokens.  And it's dreary, because lexers (and maybe only Oklalovsky lexer) are poorly designed to work with the Russian language, so you can work with Russian characters only as with strings.  Since I wanted to make the keywords of the language register-independent, this added a bunch of hemorrhoids - instead of simply writing ‚Äúgive‚Äù, it was necessary to paint the variant of writing each letter.  In general, see for yourself the file yobaLexer.mll: <br><blockquote><ol><li>  <font color="#6c6">{</font> </li><li>  <font color="#06c"><b>open</b></font> YobaParser </li><li>  <font color="#06c"><b>exception</b></font> Eof </li><li>  <font color="#6c6">}</font> </li><li>  rule token <font color="#a52a2a">=</font> parse </li><li>  <font color="#6c6">(</font> <font color="#3cb371">"and"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"And"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"d"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"D"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"and"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"And"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#a52a2a">'</font> <font color="#a52a2a">'</font> <font color="#6c6">)</font> <font color="#a52a2a">+</font> </li><li>  <font color="#6c6">(</font> <font color="#3cb371">"n"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"H"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"a"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"A"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"x"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"X"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"y"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"Y"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"y"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"Y"</font> <font color="#6c6">)</font> <font color="#6c6">{</font> FUCKOFF <font color="#6c6">}</font> </li><li>  <font color="#a52a2a">|</font>  <font color="#6c6">(</font> <font color="#3cb371">"b"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"B"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"a"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"A"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"l"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"L"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"a"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"A"</font> <font color="#6c6">)</font> </li><li>  <font color="#6c6">(</font> <font color="#3cb371">"n"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"H"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"c"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"C"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#a52a2a">'</font> <font color="#a52a2a">'</font> <font color="#6c6">)</font> <font color="#a52a2a">+</font> </li><li>  <font color="#6c6">(</font> <font color="#3cb371">"n"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"H"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"a"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"A"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"x"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"X"</font> <font color="#6c6">)</font> <font color="#6c6">{</font> STATS <font color="#6c6">}</font> </li><li>  <font color="#a52a2a">|</font>  <font color="#6c6">[</font> <font color="#a52a2a">'</font> <font color="#a52a2a">'</font> <font color="#a52a2a">'</font> \ t <font color="#a52a2a">'</font> <font color="#a52a2a">'</font> \ n <font color="#a52a2a">'</font> <font color="#a52a2a">'</font> \ r <font color="#a52a2a">'</font> <font color="#6c6">]</font> <font color="#6c6">{</font> token lexbuf <font color="#6c6">}</font> </li><li>  <font color="#a52a2a">|</font>  <font color="#6c6">[</font> <font color="#a52a2a">'</font> <font color="#c6c">0</font> <font color="#a52a2a">' - '</font> <font color="#c6c">9</font> <font color="#a52a2a">'</font> <font color="#6c6">]</font> <font color="#a52a2a">+</font> <font color="#6c6">{</font> INT <font color="#6c6">(</font> int_of_string <font color="#6c6">(</font> Lexing <font color="#a52a2a">.</font> <font color="#060">Lexeme</font> lexbuf <font color="#6c6">)</font> <font color="#6c6">)</font> <font color="#6c6">}</font> </li><li>  <font color="#a52a2a">|</font>  <font color="#6c6">(</font> <font color="#3cb371">"d"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"D"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"a"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"A"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"y"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"Y"</font> <font color="#6c6">)</font> <font color="#6c6">{</font> GIVE <font color="#6c6">}</font> </li><li>  <font color="#a52a2a">|</font>  <font color="#6c6">(</font> <font color="#3cb371">"n"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"H"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"a"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"A"</font> <font color="#6c6">)</font> <font color="#6c6">{</font> TAKE <font color="#6c6">}</font> </li><li>  <font color="#a52a2a">|</font>  <font color="#6c6">(</font> <font color="#3cb371">"h"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"H"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"o"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"O"</font> <font color="#6c6">)</font> <font color="#6c6">{</font> WASSUP <font color="#6c6">}</font> </li><li>  <font color="#a52a2a">|</font>  <font color="#6c6">(</font> <font color="#3cb371">"y"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"Y"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"o"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"O"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"b"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"B"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"a"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"A"</font> <font color="#6c6">)</font> <font color="#6c6">{</font> DAMN <font color="#6c6">}</font> </li><li>  <font color="#a52a2a">|</font>  <font color="#6c6">(</font> <font color="#3cb371">"l"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"l"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"yu"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"yu"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"b"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"b"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"l"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"</font> <font color="#3cb371">l</font> <font color="#3cb371">"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"u"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"yu"</font> <font color="#6c6">)</font> <font color="#6c6">{</font> RULEZ <font color="#6c6">}</font> </li><li>  <font color="#a52a2a">|</font>  <font color="#6c6">(</font> <font color="#3cb371">""</font> <font color="#a52a2a">|</font> <font color="#3cb371">""</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">""</font> <font color="#a52a2a">|</font> <font color="#3cb371">""</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"t"</font> <font color="#a52a2a">|</font> <font color="#3cb371">""</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">""</font> <font color="#a52a2a">|</font> <font color="#3cb371">""</font> <font color="#6c6">)</font> <font color="#6c6">{</font> CONTAINS <font color="#6c6">}</font> </li><li>  <font color="#a52a2a">|</font>  <font color="#6c6">(</font> <font color="#3cb371">"t"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"T"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"a"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"A"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"d"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"D"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"a"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"A"</font> <font color="#6c6">)</font> <font color="#6c6">{</font> <font color="#06c"><b>THEN</b></font> <font color="#6c6">}</font> </li><li>  <font color="#a52a2a">|</font>  <font color="#6c6">(</font> <font color="#3cb371">"and"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"And"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"l"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"L"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"and"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"And"</font> <font color="#6c6">)</font> <font color="#6c6">{</font> <font color="#06c"><b>ELSE</b></font> <font color="#6c6">}</font> </li><li>  <font color="#a52a2a">|</font>  <font color="#6c6">(</font> <font color="#3cb371">"y"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"y"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"c"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"c"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"e"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"e"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"k"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"k"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"and"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"and"</font> <font color="#6c6">)</font> <font color="#6c6">{</font> MEMORIZE <font color="#6c6">}</font> </li><li>  <font color="#a52a2a">|</font>  <font color="#6c6">(</font> <font color="#3cb371">"e"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"e"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"t"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"t"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"o"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"o"</font> <font color="#6c6">)</font> <font color="#6c6">{</font> IS <font color="#6c6">}</font> </li><li>  <font color="#a52a2a">|</font>  <font color="#6c6">(</font> <font color="#3cb371">"x"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"X"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"y"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"Y"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"y"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"Y"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"n"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"H"</font> <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#3cb371">"and"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"And"</font> <font color="#6c6">)</font> <font color="#6c6">{</font> CALL <font color="#6c6">}</font> </li><li>  <font color="#a52a2a">|</font> </li><li>  <font color="#6c6">(</font> <font color="#3cb371">"a"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"b"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"in"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"g"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"d"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"e"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"e"</font> <font color="#a52a2a">|</font> <font color="#3cb371">"g"</font> </li><li>  <font color="#a52a2a">|</font>  <font color="#3cb371">"h"</font> <font color="#a52a2a">|</font>  <font color="#3cb371">"and"</font> <font color="#a52a2a">|</font>  <font color="#3cb371">"y"</font> <font color="#a52a2a">|</font>  <font color="#3cb371">"to"</font> <font color="#a52a2a">|</font>  <font color="#3cb371">"l"</font> <font color="#a52a2a">|</font>  <font color="#3cb371">"m"</font> <font color="#a52a2a">|</font>  <font color="#3cb371">"n"</font> <font color="#a52a2a">|</font>  <font color="#3cb371">"about"</font> </li><li>  <font color="#a52a2a">|</font>  <font color="#3cb371">"p"</font> <font color="#a52a2a">|</font>  <font color="#3cb371">"p"</font> <font color="#a52a2a">|</font>  <font color="#3cb371">"with"</font> <font color="#a52a2a">|</font>  <font color="#3cb371">"t"</font> <font color="#a52a2a">|</font>  <font color="#3cb371">"y"</font> <font color="#a52a2a">|</font>  <font color="#3cb371">"f"</font> <font color="#a52a2a">|</font>  <font color="#3cb371">"x"</font> <font color="#a52a2a">|</font>  <font color="#3cb371">"c"</font> </li><li>  <font color="#a52a2a">|</font>  <font color="#3cb371">"h"</font> <font color="#a52a2a">|</font>  <font color="#3cb371">"sh"</font> <font color="#a52a2a">|</font>  <font color="#3cb371">"u"</font> <font color="#a52a2a">|</font>  <font color="#3cb371">""</font> <font color="#a52a2a">|</font>  <font color="#3cb371">"s"</font> <font color="#a52a2a">|</font>  <font color="#3cb371">""</font> <font color="#a52a2a">|</font>  <font color="#3cb371">"e"</font> <font color="#a52a2a">|</font>  <font color="#3cb371">"yu"</font> <font color="#a52a2a">|</font>  <font color="#3cb371">"i"</font> <font color="#6c6">)</font> <font color="#a52a2a">+</font> <font color="#6c6">{</font> id <font color="#6c6">(</font> Lexing <font color="#a52a2a">.</font> <font color="#060">lexeme</font> lexbuf <font color="#6c6">)</font> <font color="#6c6">}</font> </li><li>  <font color="#a52a2a">|</font>  eof <font color="#6c6">{</font> <font color="#06c"><b>raise</b></font> Eof <font color="#6c6">}</font> </li></ol></blockquote><br>  I just note that this code cannot be shown to children and people with fragile mental organization, because all obscene language of the language is described here.  In addition, at the beginning we open the module of our parser, in which all types are defined (STATS, GIVE, TAKE, etc.) and create an exception that will be thrown when the input is completed.  Pay attention to the 11th line, it indicates that spaces and other garbage need to be ignored, while it specifically comes after those instructions that contain spaces.  The 12th and 25-28th lines handle the numbers and names of variables, and the 29th line throws the very exception that marks the end of the file. <br><br><h5>  Interpreter </h5><br>  The last part remains - the interpreter itself, which processes our language constructs.  First the code, then the explanation: <br><blockquote><ol><li>  <font color="#06c"><b>open</b></font> YobaType </li><li></li><li>  <font color="#06c"><b>let</b></font> identifiers <font color="#a52a2a">=</font> Hashtbl <font color="#a52a2a">.</font>  <font color="#060">create</font> <font color="#c6c">10</font> <font color="#a52a2a">;;</font> </li><li>  <font color="#06c"><b>let</b></font> funcs <font color="#a52a2a">=</font> Hashtbl <font color="#a52a2a">.</font>  <font color="#060">create</font> <font color="#c6c">10</font> <font color="#a52a2a">;;</font> </li><li></li><li>  <font color="#06c"><b>let</b></font> print_stats <font color="#6c6">(</font> <font color="#6c6">)</font> <font color="#a52a2a">=</font> </li><li>  <font color="#06c"><b>let</b></font> print_item id amount <font color="#a52a2a">=</font> </li><li>  Printf <font color="#a52a2a">.</font>  <font color="#060">printf</font> <font color="#3cb371">"&gt;&gt; Yo! You have% s:% d"</font> id amount <font color="#a52a2a">;</font> </li><li>  print_newline <font color="#6c6">(</font> <font color="#6c6">)</font> <font color="#a52a2a">;</font> </li><li>  <font color="#06c"><b>flush</b></font> <font color="#06c"><b>stdout</b></font> <font color="#06c"><b>in</b></font> </li><li>  Hashtbl <font color="#a52a2a">.</font>  <font color="#060">iter</font> print_item identifiers <font color="#a52a2a">;;</font> </li><li></li><li>  <font color="#06c"><b>let</b></font> arithm id op value <font color="#6c6">(</font> <font color="#6c6">)</font> <font color="#a52a2a">=</font> </li><li>  <font color="#06c"><b>try</b></font> </li><li>  Hashtbl <font color="#a52a2a">.</font>  <font color="#060">replace</font> identifiers id <font color="#6c6">(</font> op <font color="#6c6">(</font> Hashtbl <font color="#a52a2a">.</font> <font color="#060">find</font> identifiers id <font color="#6c6">)</font> value <font color="#6c6">)</font> <font color="#a52a2a">;</font> </li><li>  Printf <font color="#a52a2a">.</font>  <font color="#060">printf</font> <font color="#3cb371">"&gt;&gt; shit issue \ n"</font> <font color="#a52a2a">;</font>  <font color="#06c"><b>flush</b></font> <font color="#06c"><b>stdout</b></font> </li><li>  <font color="#06c"><b>with</b></font> Not_found <font color="#a52a2a">-&gt;</font> Printf <font color="#a52a2a">.</font>  <font color="#060">printf</font> <font color="#3cb371">"&gt;&gt; X @ # on, you don't love% s \ n"</font> id <font color="#a52a2a">;</font>  <font color="#06c"><b>flush</b></font> <font color="#06c"><b>stdout</b></font> <font color="#a52a2a">;;</font> </li><li></li><li>  <font color="#06c"><b>let</b></font> <font color="#06c"><b>rec</b></font> cond amount id act1 act2 <font color="#6c6">(</font> <font color="#6c6">)</font> <font color="#a52a2a">=</font> </li><li>  <font color="#06c"><b>try</b></font> </li><li>  <font color="#06c"><b>if</b></font> Hashtbl <font color="#a52a2a">.</font>  <font color="#060">find</font> identifiers id <font color="#a52a2a">&gt; =</font> amount <font color="#06c"><b>then</b></font> process_action act1 <font color="#6c6">(</font> <font color="#6c6">)</font> <font color="#06c"><b>else</b></font> process_action act2 <font color="#6c6">(</font> <font color="#6c6">)</font> </li><li>  <font color="#06c"><b>with</b></font> Not_found <font color="#a52a2a">-&gt;</font> </li><li>  Printf <font color="#a52a2a">.</font>  <font color="#060">printf</font> <font color="#3cb371">"&gt;&gt; more often?! \ n"</font> <font color="#a52a2a">;</font> </li><li>  <font color="#06c"><b>flush</b></font> <font color="#06c"><b>stdout</b></font> </li><li>  <font color="#06c"><b>and</b></font> process_action <font color="#a52a2a">=</font> <font color="#06c"><b>function</b></font> </li><li>  <font color="#a52a2a">|</font>  Create <font color="#6c6">(</font> id <font color="#6c6">)</font> <font color="#a52a2a">-&gt;</font> <font color="#6c6">(</font> <font color="#06c"><b>function</b></font> <font color="#6c6">(</font> <font color="#6c6">)</font> <font color="#a52a2a">-&gt;</font> Hashtbl <font color="#a52a2a">.</font> <font color="#060">Add</font> identifiers id <font color="#c6c">0</font> <font color="#6c6">)</font> </li><li>  <font color="#a52a2a">|</font>  Decrement <font color="#6c6">(</font> amount, id <font color="#6c6">)</font> <font color="#a52a2a">-&gt;</font> arithm id <font color="#6c6">(</font> <font color="#a52a2a">-</font> <font color="#6c6">)</font> amount </li><li>  <font color="#a52a2a">|</font>  Increment <font color="#6c6">(</font> amount, id <font color="#6c6">)</font> <font color="#a52a2a">-&gt;</font> arithm id <font color="#6c6">(</font> <font color="#a52a2a">+</font> <font color="#6c6">)</font> amount </li><li>  <font color="#a52a2a">|</font>  Conditional <font color="#6c6">(</font> amount, id, act1, act2 <font color="#6c6">)</font> <font color="#a52a2a">-&gt;</font> cond amount id act1 act1 </li><li>  <font color="#a52a2a">|</font>  DoNothing <font color="#a52a2a">-&gt;</font> <font color="#6c6">(</font> <font color="#06c"><b>function</b></font> <font color="#6c6">(</font> <font color="#6c6">)</font> <font color="#a52a2a">-&gt;</font> <font color="#6c6">(</font> <font color="#6c6">)</font> <font color="#6c6">)</font> </li><li>  <font color="#a52a2a">|</font>  Stats <font color="#a52a2a">-&gt;</font> print_stats </li><li>  <font color="#a52a2a">|</font>  AddFunction <font color="#6c6">(</font> id, funclist <font color="#6c6">)</font> <font color="#a52a2a">-&gt;</font> <font color="#6c6">(</font> <font color="#06c"><b>function</b></font> <font color="#6c6">(</font> <font color="#6c6">)</font> <font color="#a52a2a">-&gt;</font> Hashtbl <font color="#a52a2a">.</font> <font color="#060">Add</font> funcs id funclist <font color="#6c6">)</font> </li><li>  <font color="#a52a2a">|</font>  CallFunction <font color="#6c6">(</font> id <font color="#6c6">)</font> <font color="#a52a2a">-&gt;</font> callfun id </li><li>  <font color="#06c"><b>and</b></font> callfun id <font color="#6c6">(</font> <font color="#6c6">)</font> <font color="#a52a2a">=</font> </li><li>  <font color="#06c"><b>let</b></font> f <font color="#a52a2a">:</font> YobaType <font color="#a52a2a">.</font>  <font color="#060">action</font> list <font color="#a52a2a">=</font> Hashtbl <font color="#a52a2a">.</font>  <font color="#060">find</font> funcs id <font color="#06c"><b>in</b></font> </li><li>  List  <font color="#060">iter</font> <font color="#6c6">(</font> <font color="#06c"><b>function</b></font> x <font color="#a52a2a">-&gt;</font> process_action x <font color="#6c6">(</font> <font color="#6c6">)</font> <font color="#6c6">)</font> f </li><li>  <font color="#a52a2a">;;</font> </li><li></li><li>  <font color="#06c"><b>while</b></font> <font color="#06c"><b>true</b></font> <font color="#06c"><b>do</b></font> </li><li>  <font color="#06c"><b>try</b></font> </li><li>  <font color="#06c"><b>let</b></font> lexbuf <font color="#a52a2a">=</font> Lexing <font color="#a52a2a">.</font>  <font color="#060">from_channel</font> <font color="#06c"><b>stdin</b></font> <font color="#06c"><b>in</b></font> </li><li>  process_action <font color="#6c6">(</font> YobaParser <font color="#a52a2a">.</font> <font color="#060">main</font> YobaLexer <font color="#a52a2a">.</font> <font color="#060">token</font> lexbuf <font color="#6c6">)</font> <font color="#6c6">(</font> <font color="#6c6">)</font> </li><li>  <font color="#06c"><b>with</b></font> </li><li>  YobaLexer <font color="#a52a2a">.</font>  <font color="#060">Eof</font> <font color="#a52a2a">-&gt;</font> </li><li>  print_stats <font color="#6c6">(</font> <font color="#6c6">)</font> <font color="#a52a2a">;</font> </li><li>  exit <font color="#c6c">0</font> </li><li>  <font color="#a52a2a">|</font>  Parsing <font color="#a52a2a">.</font>  <font color="#060">Parse_error</font> <font color="#a52a2a">-&gt;</font> </li><li>  Printf <font color="#a52a2a">.</font>  <font color="#060">printf</font> <font color="#3cb371">"&gt;&gt; Nee @ # I don‚Äôt understand b @ #! \ n"</font> <font color="#a52a2a">;</font> </li><li>  <font color="#06c"><b>flush</b></font> <font color="#06c"><b>stdout</b></font> </li><li>  <font color="#a52a2a">|</font>  Failure <font color="#6c6">(</font> _ <font color="#6c6">)</font> <font color="#a52a2a">-&gt;</font> </li><li>  Printf <font color="#a52a2a">.</font>  <font color="#060">printf</font> <font color="#3cb371">"&gt;&gt; Nee @ # I don‚Äôt understand b @ #! \ n"</font> <font color="#a52a2a">;</font> </li><li>  <font color="#06c"><b>flush</b></font> <font color="#06c"><b>stdout</b></font> </li><li>  <font color="#06c"><b>done</b></font> </li></ol></blockquote><br>  First we create two hashtables - for variables and for functions.  The initial size of 10 is taken from the lantern, we have the same training language, why do we need many functions at once. <br>  Then we will declare two small functions: one for outputting statistics, the second for increment / decrement of variables. <br><br>  Then comes a group of three functions at once: cond processes conditional constructs (our if), callfun is responsible for calling functions, and process_action is responsible for processing the instruction that came to the input as such.  I hope, why all three functions depend on each other, it is not necessary to explain. <br><br>  Note that all options in process_action do not perform an action, but merely return the function that will execute it.  Initially, this was not the case, but it was this small change that allowed me to easily and easily add support for user functions to the language. <br><br>  Finally, the last part of the code reads and processes the result of the parser until the blue in the loop. <br><br>  Add to this Makefile and you can play: <br><blockquote> <code>all: <br> ocamlc -c yobaType.ml <br> ocamllex yobaLexer.mll <br> ocamlyacc yobaParser.mly <br> ocamlc -c yobaParser.mli <br> ocamlc -c yobaLexer.ml <br> ocamlc -c yobaParser.ml <br> ocamlc -c yoba.ml <br> ocamlc -o yoba yobaLexer.cmo yobaParser.cmo yoba.cmo <br> <br> clean: <br> rm -f *.cmo *.cmi *.mli yoba yobaLexer.ml yobaParser.ml</code> </blockquote> <br><h5>  Language check </h5><br>  And now attention, why did I support different order of values ‚Äã‚Äãand variables?  The fact is that the language is very, um, natural, the interpreter literally speaks to you.  Therefore, I myself constantly confused in what order what to write: <br><blockquote> <code>$ ./yoba <br>     <br>     <br>    <br>   3   <br>   4   <br>    2  <br>  <br>  @#   <br> &gt;&gt;   <br> &gt;&gt;   <br> &gt;&gt;   <br>   <br> &gt;&gt; !    : 7 <br> &gt;&gt; !    : -2 <br>   4    1    @#  <br> &gt;&gt;   <br>   <br> &gt;&gt; !    : 7 <br> &gt;&gt; !    : -1 <br>   4   @#   @#   <br> &gt;&gt;   <br> &gt;&gt;   <br> &gt;&gt;   <br>   <br> &gt;&gt; !    : 14 <br> &gt;&gt; !    : -3</code> </blockquote> <br>  Among the shortcomings, it can be noted that when a function is called, comments about the successful increment / decrement by the number of these operations are obtained. <br><br>  I hope it was interesting.  All interpreter code can be downloaded <a href="http://narod.ru/disk/8599716001/yoba.tar.gz.html">here (2kb)</a> . <br>  If more experienced people share comments on the code, I will be grateful. </div><p>Source: <a href="https://habr.com/ru/post/116301/">https://habr.com/ru/post/116301/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../116294/index.html">Tracking memory leaks in Android applications</a></li>
<li><a href="../116297/index.html">Create a Wi-Fi hotspot for Linux from a USB modem</a></li>
<li><a href="../116298/index.html">We organize view models in ASP.NET MVC</a></li>
<li><a href="../116299/index.html">Google Launches AdWords Video Player</a></li>
<li><a href="../116300/index.html">Where do NaNs come from?</a></li>
<li><a href="../116305/index.html">As I watched Formula 1 on the BBC live via the Internet</a></li>
<li><a href="../116308/index.html">We are writing the viewer of the MS Exchange mail database (part 1)</a></li>
<li><a href="../116309/index.html">Feature of work of class AsyncTask</a></li>
<li><a href="../116311/index.html">Watching video without leaving the site</a></li>
<li><a href="../116313/index.html">Yandex with taste of Intel</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>