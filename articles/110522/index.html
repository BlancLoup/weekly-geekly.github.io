<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>u-nebula: first date</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Just want to apologize for the delay with the review article on the engine and thank you for your support and comments to the previous post . Deviatio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>u-nebula: first date</h1><div class="post__text post__text-html js-mediator-article">  Just want to apologize for the delay with the review article on the engine and thank you for your support and comments to the previous <a href="http://habrahabr.ru/blogs/gdev/105454/">post</a> .  Deviation from previous commitments was caused by fussing with <a href="http://3doors.com/ru/download.php">our art</a> and the desire to make an introductory article using <a href="http://ecls.sf.net/">Lisp</a> .  Unfortunately, Lisp support is still very raw for us, so that we use reliable <a href="http://tcl.tk/">Tcl</a> .  At the end of the way, we should get a visualization of the meditative-relaxing plan (to apply in case of winter depression). <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/EwPxw_UaXzA%3Ffeature%3Doembed&amp;xid=25657,15700021,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhj8InMijHRfLdXzEqeKuQDv4St51Q" frameborder="0" allowfullscreen=""></iframe><br>  Under the cut text, code and pictures. <br><a name="habracut"></a><br><h5>  Part I. Earth </h5><br>  First you need to download and install the latest <a href="http://code.google.com/p/u-nebula/downloads/detail%3Fname%3DuNebula-setup.10.12.exe">SDK</a> .  You do not need to install into Program Files, since much is generated on the fly in scenes and you may have problems with access rights. <br><br>  For those who want to independently assemble the engine from source, there is a <a href="http://code.google.com/p/u-nebula/wiki/HowToStart">reminder</a> , but there is no need for it - everything can be done in a running demonstration of CityGen. <br>  What may be useful from the memo is the generation of documentation for the engine commands, for this you need to run autodoc.py from the bin folder and open index.html in the doc / autodoc folder (hereafter all folders will be specified relative to the nebula folder defined during installation) . <br><br>  Let's get started  Perhaps it's about time. <br>  Launch CityGen from the start menu and see a picture with a landscape generated on the go.  Yes, the landscape let us down a little, but this is student work and its purpose is to test what we have built up, so sour facial expressions, in this case, need nothing. <br><img src="http://www.3doors.com/community/tutorials/0/citygen.jpg" alt="Generated town"><br>  Now we have 2 ways to work / experiment: <br>  1. Call the console by pressing Esc.  It will appear on the background of the picture. <br>  2. Click on F2 to call nbrowser.  Here is what it looks like: <br><img src="http://www.3doors.com/community/tutorials/0/nbrowser.jpg" alt="nbrowser - running engine guide"><br>  We will not describe nbrowser in this article (it has a fairly simple interface and, if it‚Äôs willing, we will jot down a short post describing its capabilities), and therefore we will use the built-in console. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So fearlessly press Esc and get, after various logs, a command line like this: <b>/ usr / scene&gt;</b> <br><br>  It should be noted that in nebul all objects of the engine are instances of C ++ classes, heirs of the nroot class, and during execution are organized into a hierarchical tree-like system with paths like file systems.  Paths can be both absolute and relative.  The tree node with which the rendering begins (rendering)  the root of the scene, in nebul, is traditionally located in / usr / scene, where we are, judging by the promp, and we are.  Commands (functions), with the exception of a few basic ones, are calls to the original methods of the original classes and can be given to both the current node and an arbitrary object with the specified path. <br>  As an example, glamorous ladies can change the color of the letters of the console to pink: <br><br><pre><code class="python hljs">/sys/servers/console.seticolor <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span></code> </pre> <br><br>  After we enjoyed the picturesque view of the current scene, let's erase it quickly, just carefully so as not to remove the excess (for example, the user's camera will collapse without it). <br><br>  To find out what we have in the current node, use the <b>dir</b> command. <br><br><pre> <b><code class="python hljs">/usr/scene&gt;dir cam skybox sun city landscape lights machine</code></b> </pre><br><br>  We will probably leave the camera, the sun and the light, and the rest will be destroyed with a hand that does not tremble: <br><pre> <b><code class="python hljs">delete machine delete city delete landscape delete skybox</code></b> </pre><br><br>  And we deleted the sky and the earth ... and it became empty ... (but it's light because the light was left). <br><br>  Well, now you can create something.  Only here we begin with music - mood, type, and everything else.  Let's go to the folder where the prepared in advance (because their creation lies outside of this article) meshes, textures and music.  To navigate through the current file system, tcl uses the usual cd command.  We need to get into the tutorials folder. <br><br><pre> <b><code class="python hljs">cd ../tutorials</code></b> </pre><br><br>  Create a sound node: <br><pre> <b><code class="python hljs">new nsoundnode music sel music .setlooping <span class="hljs-number"><span class="hljs-number">1</span></span> .setfile Souls_of_Gaia_V<span class="hljs-number"><span class="hljs-number">.2</span></span>_Sotano_Sellado.ogg sel ..</code></b> </pre><br>  In order not to enter into the console a difficult-long sound file name, you can use the technical trick - <b>.setfile [glob * .ogg]</b> , since  * .ogg file we have only one - no problems foreseen. <br><br>  For the above commands, a small explanation is required.  Going through the nodes of the tree is done using <b>sel</b> (from select) in the same way as the cd command; accordingly, <b>sel ..</b> will rise to the level up.  With the <b>new nsoundnode music command,</b> we created a sound node called music.  <b>new</b> takes the class as the first argument, in this case, <b>nsoundnode</b> , the second is the path, it is the name of the object, in this case, local <b>music</b> and returns the created object, in the case of tcl, it is a string with a path.  The current node is returned by the <b>psel</b> command.  <b>With the .setlooping 1</b> command, we asked the music not to leave us while the appliqu√© is running.  And finally, the <b>.setfile</b> command indicated which sound file we want to play (ogg / vorbis and wav formats are supported). <br><br>  So we have fun.  Thanks to the author <i><b>PeerGynt Lobogris</b></i> and <a href="http://www.jamendo.com/">the jamendo website</a> for this work and encouraged to go ahead. <br>  It would not hurt to somehow begin to orient in the emptiness and blackness that we have put together, and of course the grid will help us in this, for the creation of which we have a ready-made team: <br><pre> <b><code class="python hljs">::visual_debug::create_grid <span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-number"><span class="hljs-number">60</span></span></code></b> </pre><br>  the first parameter (30) - sets the size of the grid plane; <br>  the second (60) is the number of cells; <br>  Additionally, you can set the color, for example: <br><pre> <b><code class="python hljs">::visual_debug::create_grid <span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-number"><span class="hljs-number">60</span></span> {<span class="hljs-number"><span class="hljs-number">0.75</span></span> <span class="hljs-number"><span class="hljs-number">0.3</span></span> <span class="hljs-number"><span class="hljs-number">0.0</span></span> <span class="hljs-number"><span class="hljs-number">1.0</span></span>}</code></b> </pre><br>  Spatial navigation takes place using the AWSD gaming keys, arrows (with the console turned off) and the mouse with the left pressed, to move with a drag, or the right, for turns, with buttons (available to setup enthusiasts in the script / cityviewer / input.tcl).  Turn off the console (Esc).  Looking around ... <br><img src="http://www.3doors.com/community/tutorials/0/console-grid.jpg" alt="Grid console"><br><br>  It's time for us to return the sky.  And again the ready command comes to the rescue: <br><pre> <b><code class="python hljs">create_skybox stars1</code></b> </pre><br>  The sky is created - on the line Earth.  This case is more serious, there will be more teams ( <b>;</b> and, of course, it is not necessary to enter the comments following it): <br><pre> <b><code class="python hljs">sel [new n3dnode shape] ; <span class="hljs-comment"><span class="hljs-comment">#-       n3dnode   shape. .tz -10; # -        0, 0, -10    [new nmeshnode mesh].setfilename sphere.n3d ; # -    shape    ( ,  ). sel [new nshadernode shader]; #- ,   ,    .setnumstages 1; #-    .setcolorop 0 "replace tex"; #-   ,     .begintunit 0; #-     .settexcoordsrc "uv0"; #-       0 (    ) .endtunit; #-      sel ..; #-    [new ntexarraynode tex].settexture 0 "globe.jpg" none; #-         ,  </span></span></code></b> </pre><br>  Well, it should be somewhere here - we are looking on the grid, mouse, buttons, we are looking for everyone.  If we do not find, do not despair, press the spacebar.  And here we have the Earth (in the window, the Earth in the window is visible, aaaa). <br><img src="http://www.3doors.com/community/tutorials/0/earth.jpg" alt="And here we have the Earth"><br>  What have we actually done?  We look at the code: <br>  <b>sel [new n3dnode shape]</b> - create and immediately select a node of type n3dnode with the name shape. <br>  In general, the visible object in our engine is a subtree, the root of which is the node containing the geometric transformation, relative to the parent.  Such a node belongs to a class of type n3dnode or its heirs.  Methods of this class can be found on the page of documentation that we generated at the beginning.  Now we need only one <b>.tz -10</b> command, which will put our object at the point with coordinates 0, 0, -10 relative to the parent node, i.e.  scenes. <br>  The following command <b>[new nmeshnode mesh] .setfilename sphere.n3d</b> will create a node with a <b>mesh</b> under the <b>shape</b> node (a geometric model defined by triangles).  In this case, we use an object of the <b>nmeshnode</b> class with the name <b>mesh</b> and immediately assign to it a file with a sphere model - sphere.n3d.  A file of type .n3d is a readable file in ASCII format.  There is also a binary .nvx format. <br>  <b>sel [new nshadernode shader]</b> is the next subnode of the <b>shape</b> node, describes the parameters of the material, lighting, and texturing of our model for a fixed conveyor (our engine also supports software shaders).  For simplicity, here is the most basic and "poor" shader, without the parameters of lighting and material. <br>  Finally, the texture node <b>[new ntexarraynode tex] .settexture 0 ‚Äúglobe.jpg‚Äù none</b> , the last subnode of our <b>shape</b> . <br>  And so we repeat once again the model of a visible object in general: <br>  <b>T</b> - transformation relative to the parent - <b>n3dnode</b> , with subnodes: <br>  <b>| - M</b> - geometric model, static or dynamic - <b>nmeshnode, nmeshcluster, nmeshipol</b> , etc. <br>  <b>| - S</b> (optional) - shader, simple or software - <b>nshadernode, nshaderprogramnode</b> <br>  <b>| - T</b> (optional) - texture, <b>ntexarraynode, pdtexarraynode</b> <br><br>  Stop!  Something is clearly not enough.  What is there Galileo muttering on the commission ...? <br>  Make sure that we are still in the <b>shape</b> node <br><pre> <b><code class="python hljs">sel /usr/scene/shape sel [new nipol rot] .connect ry .addkey1f <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> .addkey1f <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">360</span></span> sel ..</code></b> </pre><br>  Yes, here, now ‚Äúit turns‚Äù! <br><br>  Let's save the result of our work: <br><pre> <b><code class="python hljs">sel /usr/scene .saveas earth</code></b> </pre><br>  Now in the data / tutorials folder you can find a Tcl script called earth.n.  You can read it.  To make sure that everything is preserved, we erase our creation with a firm hand: <br><pre> <b><code class="python hljs">delete shape</code></b> </pre><br>  And load it again, but as a file: <br><pre> <b><code class="python hljs">.parse earth.n</code></b> </pre><br><br>  In principle, one could stop at this and, after thanking the patient reader-experimenter for his attention, modestly leave the stage, but the New Year is on its way, and no one has canceled a small holiday miracle.  So let's create it. <br><br><h5>  Part II.  Not earth </h5><br><br>  Shake the dust of the earth, already familiar teams: <br><pre> <b><code class="python hljs">sel /usr/scene delete shape</code></b> </pre><br>  We are again waiting for a lot of work, but do not rush to enter all the commands from the console - at the end we will write how to download this tutorial, part 1 or 2, without typing all the text manually. <br><br><pre> <b><code class="python hljs">set mesh_files [glob *.n3d];<span class="hljs-comment"><span class="hljs-comment"># -      set meshes {};# -      foreach m $mesh_files { lappend meshes [file rootname [file tail $m]] ;# -       } sel [new n3dnode shape];# -      .txyz 0 1 -10;# -    sel [new nspriterender sr];# -      sel [new nstaticmeshemitter me];# -           sel [new nmeshipol mesh];# -      () # -              #    foreach   ; -   ,  foreach m $meshes { new nmeshnode $m; $m.setfilename $m.n3d; $m.setreadonly true; # -  ,    ,   ,   ; } .setreadonly true;# -     set i 0 .beginkeys [expr [llength $meshes] * 2 + 1];# -  , ""   #     ;    foreach foreach m $meshes { .setkey $i [expr $i*3] $m; # -     3 ,   3     incr i; .setkey $i [expr $i*3] $m; incr i; } .setkey $i [expr $i*3] [lindex $meshes 0];# -   1 ,     .endkeys;# -  ""  .setupdatecoord true;# -    .setupdatenorm true;# -    .setupdateuv0 true;# -   0  sel ..;# -     .setlifetime 10;# -    .setmeshnode mesh;# -  ""     sel ..;# -     set sz 0.075;# -   set bn 0.025;# -  .beginkeys 4;# -   .setkey 0 $sz $bn 1 1 1 1 .setkey 1 $sz 0 1 1 1 1 .setkey 2 $sz 0 1 1 1 1 .setkey 3 $sz 0 1 1 1 1 .endkeys .setemitter "me";# -  ""    sel ..;# -   shape sel [new nshadernode shader];# -     .setnumstages 1;# -    .setcolorop 0 "mul tex const";# -       .setalphaop 0 "replace tex";# -     .setconst 0 1 1 1 1;# - ,     .begintunit 0;# -    .setminmagfilter "linear_mipmap_nearest" "linear" .settexcoordsrc "uv0" .endtunit .setlightenable false;# -      .setalphaenable true;# -    .setzwriteenable false;# -    z-buffer .setcullmode "none";# -   ""  sel [new nipol ipol];# -     -    .connect setconst0 ;# -    setconst0 .addkey4f 0 1 0 0 1; # red .addkey4f 1 1 1 0 1; # yellow .addkey4f 2 0 1 0 1; # green .addkey4f 3 0 1 1 1; # cyan .addkey4f 4 0 0 1 1; # blue .addkey4f 5 1 0 1 1; # magenta .addkey4f 6 1 1 1 1; # white sel .. sel .. [new ntexarraynode tex].settexture 0 "lib:textures/glow-flat-a.png" "none";# -  sel [new nipol rot];# -    Y .connect ry .addkey1f 0 0 .addkey1f 15 360 sel .. sel ..</span></span></code></b> </pre><br><br>  A little explanation to this part.  The morph that we got as a result uses pre-generated meshes.  A necessary condition for morphing is the same number of vertices.  The rest of the code is left for self-study.  Questions of course welcome! <br><br>  In order to download the first part of the article, just type: <br><pre> <b><code class="python hljs">cd ../tutorials source tutorial0.tcl</code></b> </pre><br>  Then to run the 2nd part: <br><pre> <b><code class="python hljs">part2</code></b> </pre><br><br>  Well that's all! <br><img src="http://3doors.com/community/tutorials/0/result.jpg" alt="That's what happened."><br><br>  :) Congratulations to all Habr's readers, Happy New Year! <br><br>  PS If you suddenly have problems at startup, then try one of the following options: <br>  1. update DirectX (we use the June SDK) <br>  2. Run CityGen-GL to use OpenGL engine. </div><p>Source: <a href="https://habr.com/ru/post/110522/">https://habr.com/ru/post/110522/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../110514/index.html">Huawei Ideos S7 Tablet Video Review from MTS</a></li>
<li><a href="../110515/index.html">Experience of static analysis of a Qt program using PVS-Studio</a></li>
<li><a href="../110517/index.html">What is important for you when choosing a PBX?</a></li>
<li><a href="../110520/index.html">The story of creating one social flash game</a></li>
<li><a href="../110521/index.html">Snowballs with HTML5 multiplayer</a></li>
<li><a href="../110523/index.html">FCC accepts trade-offs for network neutrality</a></li>
<li><a href="../110524/index.html">MTS, default settings as a means of extracting additional profits</a></li>
<li><a href="../110526/index.html">Vector Icons on HTML5 + JS</a></li>
<li><a href="../110527/index.html">Tree.io: anti-startup rules</a></li>
<li><a href="../110531/index.html">Skype does not work</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>