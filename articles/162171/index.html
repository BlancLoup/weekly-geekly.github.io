<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cross-compiling and debugging C ++ Windows applications for Linux</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently I showed an interesting application for which you can develop plugins. The application turned out to be very useful for scientific work, but ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cross-compiling and debugging C ++ Windows applications for Linux</h1><div class="post__text post__text-html js-mediator-article">  Recently I showed an interesting application for which you can develop plugins.  The application turned out to be very useful for scientific work, but here's the bad luck - the application was developed under Windows, I have Ubuntu.  Windows for development for this application from the lab has not yet been obtained.  In order not to waste time, I decided to master the cross-compilation and debugging of this application. <br><br>  Total available: <br>  Ubuntu 12.10 x64 <br>  Non-Unicode Graph-Models Workshop (MGM) application (In console commands, gmw.exe will be called) <br><br>  Need to: <br>  Develop and debug plug-ins (dll-libraries) without installing Windows. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And then Wine, Code :: Blocks, ported GDB, and boost will help us. <br><a name="habracut"></a><br><h4>  Wine, not unicode application, Ubuntu English interface and Russian language </h4><br>  When trying to open a non-unicode application under Wine <br><pre><code class="bash hljs">wine gmw.exe</code> </pre> <br>  zyuki of the following form are obtained: <br><img src="https://habrastorage.org/storage2/e30/820/a5c/e30820a5cacb55f81596c692628656e1.png"><br><br>  The Internet very quickly gives the following <a href="http://ubuntuforums.org/showthread.php%3Ft%3D665485">hint to</a> this problem: <br><pre> <code class="bash hljs">LC_ALL=ru_RU.UTF-8 wine gmw.exe</code> </pre><br>  In my case, this approach did not improve the situation one iota. <br>  As it turned out, no Russian locales were added to the system ( <a href="http://dynamic-ubuntu.blogspot.fr/2012/07/ubuntu-utf-8.html">tyts</a> ). <br><pre> <code class="bash hljs">sudo <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"ru_RU.UTF-8 UTF-8"</span></span> &gt;&gt; /var/lib/locales/supported.d/ru sudo locale-gen ru</code> </pre><br>  Now run with the above hint <br><pre> <code class="bash hljs">LC_ALL=ru_RU.UTF-8 wine gmw.exe</code> </pre><br>  And, voila, the application with readable Russian text is launched: <br><img src="https://habrastorage.org/storage2/3bc/686/ef2/3bc686ef2d9f8f7c0815f2751ac01a65.png"><br><br><h4>  Configuring IDE Code :: Blocks for cross-compiling and debugging </h4><br><h5>  Installing Code :: Blocks </h5><br>  In the future, for debugging, we need to change the code of the debugging plug-in, so it is better to immediately take the Code :: Blocks version from under svn. <br>  Install svn: <br><pre> <code class="bash hljs">sudo apt-get install subversion</code> </pre><br>  Using svn, we get the code C :: B, for this we go to the folder where we want to save the code C :: B, where we type: <br><pre> <code class="bash hljs">svn checkout svn://svn.berlios.de/codeblocks/trunk</code> </pre><br>  Go to the resulting folder 'trunk'. <br><br>  C :: B is compiled using g ++, autotools, automake and some other utilities that need to be installed: <br><pre> <code class="bash hljs">sudo apt-get install libtool autotools-dev automake autoconf g++ libhunspell-dev libgtk2.0-dev libgamin-dev libboost-dev</code> </pre><br>  In addition, Code :: Blocks depends on wxWidgets: <br><pre> <code class="bash hljs">sudo apt-get install libwxgtk2.8-dev</code> </pre><br>  Adjust the installer for the computer (you can run it once): <br><pre> <code class="bash hljs">sudo ./bootstrap</code> </pre><br>  And then, install the codeblocks itself (the --prefix key can be missed to use the default settings): <br><pre> <code class="bash hljs">sudo ./configure --prefix={   } --with-contrib-plugins=all sudo make sudo make install</code> </pre><br>  More details can be viewed at the <a href="http://wiki.codeblocks.org/index.php%3Ftitle%3DInstalling_Code::Blocks_from_source_on_Linux">link</a> . <br><br><h5>  Compile and link setup </h5><br>  We carry out points 1 through 5 from the Code :: Blocks <a href="http://forums.codeblocks.org/index.php/topic,3343.0.html">forum</a> .  After that, compilation of programs should work if linking to platform-dependent libraries is not used (linking with boost :: regexp will be discussed later). <br>  (*) In the new Code :: Blocks, the menu has slightly changed compared to the instructions.  Settings you need to look in 'Settings-&gt; Compiler ...'.  For the old Code :: Blocks (10.05), point 5 needs to be fully completed; for the new one (12.11), we will not touch the setting relating to gdb in paragraph 5. <br><br>  If boost is used, it is better to put it separately from / usr / include, since  At this address there are many linux-specific header files that we do not want to include in the project when compiling under Windows. <br><br>  <i><b>UPD:</b> When setting up a link in the ‚ÄúOther Linker Options‚Äù field, it makes sense to add the option ‚Äú-Wl, - subsystem, windows, - kill-at‚Äù, which indicates that this is a real Windows DLL and, most importantly, prohibits the use decorating characters (--kill-at) when exporting functions with the __stdcall calling convention.</i>  <i>More <a href="http://www.transmissionzero.co.uk/computing/building-dlls-with-mingw/">here</a> and <a href="http://www.transmissionzero.co.uk/computing/advanced-mingw-dll-topics/">here</a> .</i> <br><br>  Starting from point 7 on the link above, cross-debugging is described, but, unfortunately, insight.exe, mentioned in the instructions, cannot be found.  So let's go our own way. <br><br><h5>  Cross-debugging in Code :: Blocks &amp; MingW32 gdb for Windows </h5><br>  gdb, which is native to Linux, partially can debug Windows applications, although it can only dwell on exceptions and almost always ignores breakpoints.  To deal with these problems, download gdb in the mingw32 package under Windows.  To do this, <a href="http://sourceforge.net/projects/mingw/files/Installer/mingw-get/">download</a> and then unpack and go to the 'bin' subfolder.  Install gdb under Windows: <br><pre> <code class="bash hljs">wine mingw-get.exe install gdb</code> </pre><br>  Now the gdb.exe file has appeared in the same bin folder, which is what we need. <br><br>  Create a script to simulate the usual gdb for this in the file / usr / bin / i586-mingw32msvc-gdb <br><pre> <code class="bash hljs">sudo gedit /usr/bin/i586-mingw32msvc-gdb</code> </pre><br>  Enter the following lines: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh wine {Path to mingw}/bin/gdb.exe $@</span></span></code> </pre><br>  For the old C :: B everything is already configured, for the new debugger you need to configure it additionally.  In the 'Settings-&gt; Debugger' item, click on the 'GDB / CDB debugger' then on 'Create Config'.  In the new config, we change the debugger launch command to '/ usr / bin / i586-mingw32msvc-gdb', other settings as desired.  After that, go to 'Settings-&gt; Compiler ... ", in the' Selected Compiler 'section, select the compiler that you set up before and then on the' Toolchain executables' tab, change 'Debugger' to our newly created config. Now the debugger will stop at breakpoints, although it will not be able to stop the program at an arbitrary moment (this problem has not yet been resolved.) However, when trying to debug, C :: B gives the following error: <br><pre> <code class="bash hljs">The program has stopped on a breakpoint but the breakpoint format is not recognized: 0x1A0x1AZ:{}/SamplePlugin.cpp:48:948:beg:0x68087599</code> </pre><br>  This error indicates that the debugger plugin in C :: B does not understand the issue of the gdb.exe debugger.  As it turned out, upon closer inspection, the debugger plugin has a platform-specific code, and this is where you need to remember that we have the source code C :: B.  We are now slightly correcting the code of this plugin.  It will be necessary to change the code of only one file '{Path to svn code of Code :: Blocks} /src/plugins/debuggergdb/gdb_driver.cpp' <br>  To do this, go to the root of the C :: B project (from where the ./bootstrap commands were run), by default it is the 'trunk' folder.  And <a href="https://www.dropbox.com/s/vu8qvf5bujef5z8/gdb_driver.cpp.patch">patch the patch</a> : <br><pre> <code class="bash hljs">patch --unified --strip=0 --forward --input=gdb_driver.cpp.patch</code> </pre><br>  Well, rebuild Code :: Blocks: <br><pre> <code class="bash hljs">sudo ./configure --prefix={   } --with-contrib-plugins=all sudo make sudo make install</code> </pre><br>  And almost everything is ready, it remains only to create a project.  Steps 12-13 <a href="http://forums.codeblocks.org/index.php/topic,3343.0.html">here</a> .  If you want to create a project dll-library, then specify the creation of a dynamic library in the wizard and rename the extension to dll. <br>  Check that the selected compiler-linker-debugger chain is in the project settings.  '{Right key to the project} -Build Options ...' item 'Selected compiler', and you can enjoy and debug.  Let me remind you that for some reason the debugger cannot be interrupted during execution, i.e.  All debugging actions can be applied only during program shutdown.  In particular, you can not put a new breakpoint, if the program is not at any other breakpoint ... <br><br><h4>  Linking static boost library </h4><br>  The boost library is basically a set of header files, and therefore no problems with linking usually arise.  But for some parts of a boost, you need to link to a static library, for example, boost :: regex.  We try to build a project and get: <br><pre> <code class="bash hljs">{...}/boost/regex/v4/cpp_regex_traits.hpp|1059|undefined reference to `boost::scoped_static_mutex_lock::scoped_static_mutex_lock(boost::static_mutex&amp;, bool)<span class="hljs-string"><span class="hljs-string">'</span></span></code> </pre><br>  The error occurs because we are trying to link to the linux library in order to build a windows application. <br>  To link you need to compile boost :: regex using MingW32 ( <a href="http://www.boost.org/boost-build2/doc/html/bbv2/tasks/crosscompile.html">about cross-compiling</a> ).  Download boost, unpack and go to the folder with unpacked <a href="http://www.boost.org/users/download/">boost</a> .  Create a user-config.jam file in the root of your home directory: <br><pre> <code class="bash hljs">gedit ~/user-config.jam</code> </pre><br>  With the following content: <br><pre> <code class="bash hljs">using gcc : : i586-mingw32msvc-g++ ;</code> </pre><br>  Further we set up assembly and we collect: <br><pre> <code class="bash hljs">sudo ./bootstrap.sh --with-libraries=regex --without-icu sudo ./b2</code> </pre><br>  After executing the last command, I had ‚Äúfailed updating 1 target‚Äù errors, which, however, does not interfere with programming. <br><br>  As a result, we have a fully prepared environment for writing, building and debugging Windows applications or Windows libraries from under Linux.  Now you can get to work ... </div><p>Source: <a href="https://habr.com/ru/post/162171/">https://habr.com/ru/post/162171/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../162157/index.html">How to understand if your project is good for an investor: checklist of a standard start-up rake</a></li>
<li><a href="../162159/index.html">Pseudo 3D or parallax with javascript</a></li>
<li><a href="../162161/index.html">Free book ‚ÄúHTML5. Developer's Guide ¬ª</a></li>
<li><a href="../162163/index.html">OSPF Area Types</a></li>
<li><a href="../162169/index.html">AWS Insight: RDS Parameter Groups - what it is and why</a></li>
<li><a href="../162173/index.html">Christmas sales Samurai-s!</a></li>
<li><a href="../162175/index.html">How does cellular operator billing work?</a></li>
<li><a href="../162177/index.html">Megaphone launched the UMS service (Unified Messaging Solution), and the beta version of the client on Google Play. New competitor Whatsapp, Joyn, and IMO.IM?</a></li>
<li><a href="../162179/index.html">A billion-dollar high-tech software company is created in the USA every 3 months.</a></li>
<li><a href="../162181/index.html">Monitoring messages and calls to Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>