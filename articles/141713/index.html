<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>1-wire smart home network and FreeBSD</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There are a great many articles about ‚Äúsmart home‚Äù and 1-wire technology. I want to write how it is done ‚Äúfrom scratch‚Äù and not on Linux (as in most i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>1-wire smart home network and FreeBSD</h1><div class="post__text post__text-html js-mediator-article"> There are a great many articles about ‚Äúsmart home‚Äù and <a href="http://ru.wikipedia.org/wiki/1-Wire">1-wire</a> technology.  I want to write how it is done ‚Äúfrom scratch‚Äù and not on Linux (as in most instructions and articles on the web), but on FreeBSD. <br><br>  Why this OS?  Because there are people who have their own routers deployed at home on FreeBSD, which has some differences from Linux in configuring certain services and services.  I am writing the article as a novice, i.e. it is, in its own way, an attempt to share my own experience. <br><a name="habracut"></a><br>  Not much is written about building a 1-wire network on FreeBSD, and, as a rule, there is no comprehensive information anywhere on the ‚Äúbasics‚Äù of a novice homeowner.  Usually on the forums they are greeted with the phrase ‚Äúread man‚Äù, ‚Äúteach a materiel‚Äù, ‚Äúeverything is elementary‚Äù, etc., essentially no one gives a hint or help. <br><br>  We will do everything ourselves.  To begin with, let's try to deploy something simple, such as a network with a temperature sensor.  What we need. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      1. Tools <br>  - Soldering iron.  It will be necessary to solder the two wiring, so you do not need special skills for owning a soldering iron.  Not yet needed. <br>  - A knife or something that can remove the insulation. <br><br>  2. Hardware <br>  - Our router / gateway / server with FreeBSD (I have 9 RELEASE) <br>  - DS9490R controller for 1-wire network <br><img src="https://habrastorage.org/getpro/geektimes/post_images/953/6c7/5f9/9536c75f9b7e3ceb8058783d03363ce4.jpg" alt="image"><br>  - DS1820 + PAR temperature sensor.  ‚ÄúPAR‚Äù tells us that the sensor has enough ‚Äúparasitic‚Äù current for operation.  It will be very useful to us if we build a small autonomous network.  The scale of the apartment is enough.  The specification for the sensor can be read <a href="http://datasheets.maxim-ic.com/en/ds/DS18S20.pdf">here (PDF)</a> . <br><img src="https://habrastorage.org/getpro/geektimes/post_images/9b4/f5d/e69/9b4f5de6974555848c6a185872db0241.jpg" alt="image"><br>  - Cable, for example, a twisted pair of category 5. For the test, I used a piece of ordinary telephone cable, but at home everything is better to be done properly. <br><br>  3. Software <br>  - owfs.  A set of utilities for working with a 1-wire network controller. <br><br>  Let's get started <br>  First install the auxiliary software. <br>  Install fuse-kmod.  I put all the software through the portmaster utility, which is installed from: <br> <code>/usr/ports/ports-mgmt/portmaster</code> <br>  whom the religion does not allow, can be set from the ports manually. <br>  Execute the command: <br> <code>portmaster sysutils/fusefs-kmod</code> <br>  If the question "Do the automatic configuration", then put a tick.  Otherwise, we will have to manually add the following line to the <b>/etc/rc.conf</b> file: <br> <code>fusefs_enable="YES"</code> <br>  and team <br> <code>/usr/local/etc/rc.d/fusefs start</code> <br>  run fuse. <br><br>  Next, put: <br> <code>portmaster devel/swig13</code> <br>  and execute the commands: <br> <code>echo 'vfs.usermount=1' &gt;&gt; /etc/sysctl.conf <br> /etc/rc.d/sysctl restart</code> <br> <br>  Now the owfs package.  There were some difficulties.  From the official website of owfs.org, the current version (at the time of this writing) 2.8p14 refused to be placed.  More precisely refused to compile.  Having rummaged in the buggy, I found an official patch that fixed the compilation error that occurred, but spawned another.  On the forum site <a href="http://www.lissyara.su/">www.lissyara.su,</a> someone wrote that he had the same problem back in version 8.2 and one friend posted his build on the network, which was successfully installed on FreeBSD.  Having glanced on its ftp, I found the assembly and for the current version. <br><br>  You can <a href="">get</a> it from here: <a href="">ftp://hi.dp.ua/unix/owfs/owfs-2.8p14.tar.gz</a> <br>  Just in case, if for some reason the server goes down, I put the archive in an alternative repository: <br>  <a href="http://ifolder.ru/29766619">http://ifolder.ru/29766619</a> <br><br>  Download the archive and unpack: <br> <code>fetch ftp:// hi.dp.ua/unix/owfs/owfs-2.8p14.tar.gz <br> tar -zxvf owfs-2.8p14.tar.gz <br> cd owfs-2.8p14</code> <br>  Team: <br> <code>chmod +x insta.sh</code> <br>  make the script executable and run: <br> <code>./insta.sh</code> <br>  By the way, <b>insta.sh</b> is not my typo, it is a typo of the author of the assembly.  I did not begin to rename the file and repack the archive, so that the checksum from the original server coincided with what I posted on iFolder. <br><br>  When the script runs to the <b>/ usr / local</b> address, the ‚Äúowfs‚Äù directory appears - this is what we will work with. <br><br>  Now with glands. <br><br>  We take our telephone cable and plug it into the controller with one end, and cut off the connector from the other end and remove the insulation from the two wires. <br>  The telephone (RJ-11) connector has 6 pins, and the wiring is in 3 and 4 pins.  My 3rd contact was green, and the 4th was red. <br>  We take our "tripod", but not this: <br><img src="https://habrastorage.org/getpro/geektimes/post_images/410/dc2/13e/410dc213e1ea58b362bed263f855cbb8.jpg" alt="image"><br>  and the one that has a temperature sensor. <br>  Legs ‚Ññ1 and ‚Ññ3 are joined together (we solder) and we solder the red wiring to them, we solder green to the remaining ‚Ññ2 leg.  At work, in the absence of a soldering iron, I did everything on my knee with twists: <br><img src="https://habrastorage.org/getpro/geektimes/post_images/069/214/c3e/069214c3ef77c83bb4424c9aae7a72fb.jpg" alt="image"><br>  at home, of course, everything has to be soldered properly, so that nothing superfluous sticks out anywhere and looks beautiful. <br>  We stick the controller into the USB connector of our server.  Create the directory " <b>/ mnt / 1wire</b> ": <br> <code>mkdir /mnt/1wire</code> <br>  and execute the command: <br> <code>/usr/local/owfs/bin/owfs -C -u /mnt/1wire</code> <br>  A message should be displayed containing something like: <br> <code>Opened USB DS9490 bus master at</code> <br>  Great, the controller is working.  Now check if the temperature sensor is working. <br><br>  Check the contents of the <b>/ mnt / 1wire directory</b> : <br><img src="https://habrastorage.org/getpro/geektimes/post_images/b59/2d9/61d/b592d961dc927777a95106d1eee75922.jpg" alt="image"><br>  There are files and directories.  I have a directory starting with "81." - this is the controller itself, but starting with "10." is already a temperature sensor.  Let's see what it contains: <br><img src="https://habrastorage.org/getpro/geektimes/post_images/0b3/907/3d8/0b39073d882969b0f125b5ae2e61988a.jpg" alt="image"><br>  Aha  There is a file called "temperature".  Most likely this is what we need.  Print the contents of this file: <br><img src="https://habrastorage.org/getpro/geektimes/post_images/ed6/3bb/c5c/ed63bbc5cb99dc4571d3fc25b3509a73.jpg" alt="image"><br>  Well, we saw the current temperature.  Then you can use this data anywhere, at least in PERL, at least in PHP, at least in BASH - who likes what. <br><br>  Well, these are the very basics.  They have mastered it - the rest will follow itself, if we do it by analogy. <br>  Now these ‚Äúsnot‚Äù can be disassembled, lay a common tire from a normal cable around the house and hang in series as many sensors as needed.  All sensors can be interrogated by some samopisny script - it all depends on the tasks. <br><br>  I hope this material will help those who are just starting to master 1-wire with the server running FreeBSD. </div><p>Source: <a href="https://habr.com/ru/post/141713/">https://habr.com/ru/post/141713/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../141706/index.html">The free and free Cuprum font is now available in four styles (regular, italic, bold, bold italic)</a></li>
<li><a href="../141707/index.html">Maps in the browser without a network</a></li>
<li><a href="../141709/index.html">Plesiochronous digital hierarchy and E1 stream</a></li>
<li><a href="../141710/index.html">Cleaning infected site files from malicious code</a></li>
<li><a href="../141712/index.html">The correct keyboard for information terminals</a></li>
<li><a href="../141714/index.html">We write your php framework for the evening</a></li>
<li><a href="../141715/index.html">Setup of data exchange between WebAsyst and 1C UT 11</a></li>
<li><a href="../141717/index.html">Once again about the responsibility of providers for violation of intellectual rights</a></li>
<li><a href="../141718/index.html">Once again about the templates</a></li>
<li><a href="../141719/index.html">Creating msi-packages and installing any software by means of Windows group policies</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>