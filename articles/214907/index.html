<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Digital Termenvox based on Leap Motion (powered by .NET)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Since the advent of the Kinect for Windows sensor, I have had a quiet passion for programming such kind of devices - this is a magical feeling when a ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Digital Termenvox based on Leap Motion (powered by .NET)</h1><div class="post__text post__text-html js-mediator-article">  Since the advent of the Kinect for Windows sensor, I <a href="http://www.techdays.ru/videos/7330.html">have had a quiet passion</a> for programming such kind of devices - this is a magical feeling when a program written by you responds to human movements from a distance!  Today I will tell you about the programming of another similar device - <a href="https://www.leapmotion.com/">Leap Motion</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c3d/b35/6ae/c3db356aee33e19639f6e23f1e363f8f.jpg"><img src="https://habrastorage.org/getpro/habr/post_images/e37/394/458/e37394458b03a53c4b7fb65d9c90e30a.jpg"><br><br>  In essence, Leap Motion is a small Kinect that can recognize the position of the hands.  According to the creators (well reflected in <a href="http://www.youtube.com/watch%3Fv%3D_d6KuiuteIA">this video</a> ), it can be used to control a computer in many different scenarios.  In this post, we will look at how Leap Motion is programmed (on the .NET platform), and how you can create a simple musical instrument, the <a href="http://ru.wikipedia.org/wiki/%25D0%25A2%25D0%25B5%25D1%2580%25D0%25BC%25D0%25B5%25D0%25BD%25D0%25B2%25D0%25BE%25D0%25BA%25D1%2581">theremin,</a> on the basis of it.  Here is this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/cNwDKULhAsw%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700190,15700253&amp;usg=ALkJrhho45GVpFSNdimMgfPL4BX3oW837A" frameborder="0" allowfullscreen=""></iframe><br><a name="habracut"></a><br><h3>  Leap Motion for the programmer </h3><br>  From the point of view of the programmer, Leap Motion provides a set of convenient APIs ( <a href="https://developer.leapmotion.com/documentation/csharp/index.html">documented here</a> ) that allow you to: <br><ul><li>  With a high frequency (more than 60-100 frames per second) get a model of space, which includes the coordinates and speeds of fingers, normal palms, position and speed of various ‚Äútools‚Äù (Leap Motion well recognizes pencils and pens) </li><li>  Recognize basic gestures: circle, swipe, press </li><li>  Emulate the touch surface, i.e.  touching some virtual surface in front of the screen </li><li>  Recognize the basic movements of the hands and fingers (motions), translating them into transformations of rotation, movement or scaling. </li></ul><br>  Unlike Kinect, Leap Motion does not provide access to 3D data obtained from the camera. <br><br>  You can program Leap Motion in a variety of languages ‚Äã‚Äãand platforms, including .NET.  In this article, we will look at using the first opportunity ‚Äî accessing a hand model. <br><br><h3>  We track the simplest movements </h3><br>  For our experiments in <a href="http://www.visualstudio.com/downloads/download-visual-studio-vs">Visual Studio,</a> we will create an empty WPF project and add a colored circle to the main screen.  Our first step is to learn how to move this circle around the screen with your finger.  So, the markup of the main page (XAML) will look like this: <br><br><div class="spoiler">  <b class="spoiler_title">WPF-markup page MainPage.xaml</b> <div class="spoiler_text"><pre><code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Window</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"LeapVoxSample.MainWindow"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MainWindow"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"768"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1024"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Black"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Canvas</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Ellipse</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ptr"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Fill</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Yellow"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"30"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"30"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Canvas</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Window</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></div></div><br><br>  To use Leap Motion, you need to <a href="https://developer.leapmotion.com/downloads">download the Leap Motion SDK</a> and connect the link to <strong>LeapCSharp.NET4.0.dll</strong> to the project.  However, this is not all - Leap SDK also requires the <strong>Leap.dll</strong> and <strong>LeapCSharp.dll libraries</strong> , which should be located in the same directory as the project executable file.  Therefore, locate these files in the <strong>LeapSDK \ lib \ x86</strong> directory (in the directory where the Leap SDK is installed), drag them to the Visual Studio project and set the properties ‚Äúactions on compilation = content, copy to the output directory = copy if newer‚Äù. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4d2/234/2a3/4d22342a39b535581b8a2f2f68f8fe05.png"><img src="https://habrastorage.org/getpro/habr/post_images/6e7/0f1/5e6/6e70f15e61f9857dd069607a21c2f5b2.png"><br><br>  All communication with the Leap controller is conducted through the <strong>Controller</strong> object.  Create such an object in our main file MainWindows.xaml.cs: <br><br><pre> <code class="hljs cs">Controller Leap = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Controller();</code> </pre><br><br>  Now Leap Motion is ready to provide us with images of hand position data.  You can receive frames in two ways: <br><ul><li>  Pass an instance of the Listener class to the Controller object, in which the OnFrame method will be overloaded.  This method will be automatically invoked by the Leap Motion SDK at the highest possible frame rate. </li><li>  Create your own method that will periodically poll the Controller class and receive the current frame from it.  This should be done, there is already a natural loop in the program, or if we want to execute the code in the UI thread of execution. </li></ul><br>  In our case, to create a controller poll cycle, we use DispatcherTimer, which will be triggered 30 times per second: <br><br><div class="spoiler">  <b class="spoiler_title">Controller polling cycle organization</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">DispatcherTimer dt = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> DispatcherTimer() { <span class="hljs-type"><span class="hljs-type">Interval</span></span> = TimeSpan.FromSeconds(<span class="hljs-number"><span class="hljs-number">1</span></span> / <span class="hljs-number"><span class="hljs-number">30</span></span>) }; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> MainWindow() { InitializeComponent(); dt.Tick += dt_Tick; dt.<span class="hljs-keyword"><span class="hljs-keyword">Start</span></span>(); }</code> </pre><br></div></div><br>  The dt_Tick method will focus the basic logic of motion tracking.  We get the current frame (Frame), and if the fingers are visible in this frame, we take the first one of them and use its coordinates to change the position of the circle: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dt_Tick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, EventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fr = Leap.Frame(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fr!=<span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; fr.Fingers.Count&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> f = fr.Fingers[<span class="hljs-number"><span class="hljs-number">0</span></span>]; Canvas.SetLeft(ptr, <span class="hljs-number"><span class="hljs-number">512</span></span> + f.TipPosition.x); Canvas.SetTop(ptr, <span class="hljs-number"><span class="hljs-number">768</span></span>-f.TipPosition.y); } }</code> </pre><br><br>  We have achieved that we can move the circle on the screen by moving your finger over the Leap Motion controller.  Sample code at this stage can be <a href="https://github.com/shwars/LeapVoxSample/tree/Step2">viewed on GitHub</a> . <br><br><h3>  Software generation of sound of various heights </h3><br><br>  For software generation of sound of different heights, we use the <strong>NAudio</strong> library.  The easiest way to add NAudio support to a project is to use <strong>Nuget by</strong> typing package manager in the console: <br><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">install</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">package</span></span> NAudio</code> </pre> <br>  The process of generating a variable pitch sound is <a href="http://msdn.microsoft.com/ru-ru/magazine/ee309883.aspx">described in</a> detail <a href="http://msdn.microsoft.com/ru-ru/magazine/ee309883.aspx">in the article by Charles Petzold on MSDN</a> .  In short, we create a class that generates a sine wave of sound, and pass it to the input to the NAudio method, which reproduces this wave.  In this case, there are a number of subtleties: in order for the sound to change more smoothly, it is necessary to smoothly change the frequency of the sound, and at the same time take into account the delay in audio buffering.  All these subtleties are taken into account in the class <a href="">PortamentoSineWaveOscillator.cs</a> , which must be placed in the project. <br><br>  To generate a sound, we create an object of type <strong>WaveOut</strong> and initialize it, passing an instance of the oscillator we created: <br><br><pre> <code class="hljs cs">WaveOut WaveGen = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WaveOut(); PortamentoSineWaveOscillator Osc = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PortamentoSineWaveOscillator(<span class="hljs-number"><span class="hljs-number">44100</span></span>,<span class="hljs-number"><span class="hljs-number">120</span></span>);</code> </pre><br>  We carry out initialization in the page constructor: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">WaveGen</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Init</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">Osc</span></span>); <span class="hljs-selector-tag"><span class="hljs-selector-tag">WaveGen</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Play</span></span>();</code> </pre><br>  Now we just need to change the <strong>Osc.Pitch</strong> property to change the pitch accordingly, and <strong>Osc.Amplitude</strong> to change the volume.  Let the horizontal movement of the fingers are responsible for the volume, and the vertical - for the pitch.  The coefficients are chosen empirically to achieve a comfortable sound: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dt_Tick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, EventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fr = Leap.Frame(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fr!=<span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; fr.Fingers.Count&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> f = fr.Fingers[<span class="hljs-number"><span class="hljs-number">0</span></span>]; ... <span class="hljs-comment"><span class="hljs-comment">//    var p = Math.Abs(f.TipPosition.y / 2); var a = 255 - Math.Abs(f.TipPosition.x); if (p &gt;= 0 &amp;&amp; p &lt;= 150) Osc.Pitch = p; if (a &gt;= 0 &amp;&amp; a &lt;= 255) Osc.Amplitude = (short)a; } }</span></span></code> </pre><br>  A version of the project at this stage can be <a href="https://github.com/shwars/LeapVoxSample/tree/Step3">obtained here</a> . <br><br><h3>  Finishing touches </h3><br>  To make the project a little more beautiful, instead of the usual circle moving around the screen, you can add special effects based on a particle system (Particle Systems).  I took <a href="http://www.codeproject.com/Articles/21010/Particle-Effects-in-WPF">this article</a> as a basis <a href="http://www.codeproject.com/Articles/21010/Particle-Effects-in-WPF">on CodeProject</a> , where the source code of the WPF control, which is a source of particles, is given.  Replacing them with the circle added in the first step, we get the final project, the source code of which <a href="">is available on GitHub</a> . <br><br><h3>  Homework </h3><br>  If you want to continue the experiments, the scope for creativity is almost unlimited!  In particular, you can: <br><ul><li>  Add support for polyphony and control with multiple fingers </li><li>  Experiment with other methods of controlling the pitch, for example, to take as a basis not the position of the finger, but its speed </li><li>  Add support for gestures to extract special sounds (samples) </li></ul><br>  If you are interested in this topic (write in the comments), then I will continue the series of articles, adding various additional interesting things related to Leap Motion, Kinect and the unexpected use of mobile devices.  What would you like to hear?  For example, this video shows what else you can do with Leap Motion in a couple of hours: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/jsn0Ch3KLbY%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700190,15700253&amp;usg=ALkJrhgY8jIeTdMHTItt1rwgAZNtWYGMVQ" frameborder="0" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/214907/">https://habr.com/ru/post/214907/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../214893/index.html">Highscreen Alpha Tab: tablet phone on Android 4.2 with a diagonal of 8.1 inches</a></li>
<li><a href="../214897/index.html">Samsung introduced new Exynos processors, CMOS image sensors, third generation NFC chip and mobile Wi-Fi module</a></li>
<li><a href="../214899/index.html">Captain ... Brava? Ah, wonderful new world ...</a></li>
<li><a href="../214901/index.html">Using SPI from Python on Raspberry Pi</a></li>
<li><a href="../214903/index.html">Declassified Satosi Nakamoto's personality</a></li>
<li><a href="../214911/index.html">Turn Git's boring logs into exciting animations.</a></li>
<li><a href="../214913/index.html">Play! Lift! Srsly?</a></li>
<li><a href="../214915/index.html">Sound attack</a></li>
<li><a href="../214917/index.html">Magic Circle: CSS Puzzle</a></li>
<li><a href="../214919/index.html">One year in the life of the project. Answers@Mail.ru</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>