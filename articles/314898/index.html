<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Alarm for fridge. Not life, but ‚Äúraspberry‚Äù with RaspberryPi 3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dusted for a month on my shelf Raspberry Pi 3 with integrated Wi-Fi. The resources of the processor and the amount of memory are already enough to run...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Alarm for fridge. Not life, but ‚Äúraspberry‚Äù with RaspberryPi 3</h1><div class="post__text post__text-html js-mediator-article">  Dusted for a month on my shelf Raspberry Pi 3 with integrated Wi-Fi.  The resources of the processor and the amount of memory are already enough to run demanding programs.  How to quickly develop and run on it your program consisting of just one small file with sending a photo to the mail and a web monitoring server? <br><br><img src="https://habrastorage.org/files/6da/4de/d2d/6da4ded2d6204916b13b43870a9f5a31.jpg"><br><br>  We will assemble a simple system for protecting the refrigerator against unauthorized entry with photo registration and integration into the Internet via smtp.  We will arrange a real Internet of things in the kitchen! <br><a name="habracut"></a><br>  The same function will be useful for losing weight.  The system will take photographs of the intruder of the kitchen calm and the moment of <i>possible</i> offense.  Opening the refrigerator will be detected using a reed switch, video recording using a conventional web camera in the light of an open refrigerator.  So that the violator doesn‚Äôt get away from the answer, we will send a series of his photos to the mailbox. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Summary of the article </h2><br><ul><li>  Hardware </li><li>  Software part </li><li>  On groovy </li><li>  In java </li><li>  How to live on with this knowledge? </li></ul><br><h2>  Hardware </h2><br>  Reed switch - any for the security system. <br>  Webcam - I have a Logitech C310, any supported Video4Linux subsystem will do. <br>  Raspberry Pi 3 Model B - there is a built-in WiFi and no USB hub is needed. <br><br>  The reed switch must be connected between contact No. 17 and No. 15 - i.e.  between GPIO3 and + 3.3V <a href="http://pi4j.com/pins/model-3b-rev1.html">according to the scheme</a> . <br><br><h2>  Software part </h2><br>  In the open source framework, <a href="http://camel.apache.org/">Apache Camel</a> and its components, Rhiot for JVM did a lot to find the use of a single-board computer gathering dust in the closet.  It is enough, using its language to describe the configuration, to assemble the ‚Äúroute‚Äù signals / data components in the system from the ready components and Camel will turn it into an application. <br><br>  In my last article on the development of the Internet of things in the JVM, I <a href="https://habrahabr.ru/post/310784/">promised an example</a> for Camel and today I keep my promise!  The idea of ‚Äã‚Äãthis project is inspired by the example of <a href="http://www.bitreactive.com/intruder-detection-with-raspberry-pi/">‚ÄúIntruder detection with Raspberry-Pi‚Äù</a> .  Only the reed switch is more accessible and programmatically to work with it as well as with the usual button - no need for I2C protocol. <br><br>  Using RouteBuilder create a route.  Sources and receivers of data in camel are described as a URL and for each component / protocol the description of the format of any component can be read on the <a href="http://camel.apache.org/components.html">page</a> . <br><br><ul><li>  <b>controlbus</b> is a component for managing routes.  In our case, with the help of it we start and stop photographing. </li><li>  <b>pi4j-gpio</b> - uses the <a href="http://pi4j.com/">pi4j</a> library to receive signals from the raspberry GPIO. </li><li>  <b>webcam</b> - receives a frame from a web camera at intervals determined by the component-timer. </li><li>  <b>smtps</b> - send email. </li></ul><br>  camelContext.start () initializes the components and starts the route.  It is very simple to react to the opening of the contact of the reed switch: <br><br><img src="https://habrastorage.org/files/b79/dcb/53a/b79dcb53a5104e82872dc1807272335d.png"><br><br><div class="spoiler">  <b class="spoiler_title">Visualization of the reaction to the reed switch in hawt.io</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/745/486/6d6/7454866d67da4e9dbe508ebbfed9c05b.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">The route is the same photo registration with sending a snapshot to the mail in hawt.io</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/0cf/bc7/417/0cfbc741776b40e18c3c1bdf3f2008a7.png"><br></div></div><br>  addEventNotifier () allows us to intercept route events.  We will respond to starting and stopping the route and send a message about the status of the alarm to the mailbox. <br><br>  If your mail is not on the mail.ru server, then find the smtp host, port for your mail and enter them instead of "smtps: //smtp.mail.ru: 465". <br><br>  I also tried to look for the face on the photo in the same Camel route, but even the Raspberry PI 3 model B slows down on this task. <br><br>  The code snippet runs the <a href="http://hawt.io/">hawt.io</a> web console to monitor and manage the application: <br><br><pre><code class="java hljs">MavenClassLoader.usingCentralRepo() .forMavenCoordinates(<span class="hljs-string"><span class="hljs-string">'io.hawt:hawtio-app:2.0.0'</span></span>).loadClass(<span class="hljs-string"><span class="hljs-string">'io.hawt.app.App'</span></span>) Thread.currentThread().setContextClassLoader(hawtIoConsole.getClassLoader()) hawtIoConsole.main(<span class="hljs-string"><span class="hljs-string">'--port'</span></span>,<span class="hljs-string"><span class="hljs-string">'10090'</span></span>)</code> </pre> <br>  If the functionality of almost two hundred components is not enough for you, then developing your own new component for Apache Camel is quite easy.  I recently did this in the <a href="https://github.com/igor-suhorukov/camel-gcode">camel-gcode project</a> for <a href="https://habrahabr.ru/post/314462/">sending commands to a CNC machine</a> running LinuxCNC from a program in the JVM. <br><br><h3>  On groovy </h3><br>  <a href="https://github.com/igor-suhorukov/alarm-system/blob/master/AlarmSystem.groovy">AlarmSystem.groovy</a> <br><pre> <code class="hljs pgsql">@Grab(<span class="hljs-string"><span class="hljs-string">'org.apache.camel:camel-groovy:2.18.0'</span></span>) @Grab(<span class="hljs-string"><span class="hljs-string">'org.apache.camel:camel-core:2.18.0'</span></span>) @Grab(<span class="hljs-string"><span class="hljs-string">'org.apache.camel:camel-mail:2.18.0'</span></span>) @Grab(<span class="hljs-string"><span class="hljs-string">'io.rhiot:camel-webcam:0.1.4'</span></span>) @Grab(<span class="hljs-string"><span class="hljs-string">'io.rhiot:camel-pi4j:0.1.4'</span></span>) @Grab(<span class="hljs-string"><span class="hljs-string">'org.slf4j:slf4j-simple:1.6.6'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.camel.builder.RouteBuilder <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.camel.impl.DefaultAttachment <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.camel.impl.DefaultCamelContext <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.camel.management.event.CamelContextStartedEvent <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.camel.management.event.CamelContextStoppedEvent <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.camel.support.EventNotifierSupport <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.mail.util.ByteArrayDataSource <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.github.igorsuhorukov.smreed.dropship.MavenClassLoader def <span class="hljs-keyword"><span class="hljs-keyword">login</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.properties[<span class="hljs-string"><span class="hljs-string">'login'</span></span>] def <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.properties[<span class="hljs-string"><span class="hljs-string">'password'</span></span>] def camelContext = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> DefaultCamelContext() camelContext.setName(<span class="hljs-string"><span class="hljs-string">'Alarm system'</span></span>) def mailEndpoint = camelContext.getEndpoint("smtps://smtp.mail.ru:465?username=${login}&amp;password=${password}&amp;contentType=text/html&amp;debugMode=true") camelContext.addRoutes(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> RouteBuilder() { def <span class="hljs-type"><span class="hljs-type">void</span></span> configure() { <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>(<span class="hljs-string"><span class="hljs-string">'pi4j-gpio://3?mode=DIGITAL_INPUT&amp;pullResistance=PULL_DOWN'</span></span>).routeId(<span class="hljs-string"><span class="hljs-string">'GPIO read'</span></span>) .choice() .<span class="hljs-keyword"><span class="hljs-keyword">when</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">header</span></span>(<span class="hljs-string"><span class="hljs-string">'CamelPi4jPinState'</span></span>).isEqualTo("LOW")) .<span class="hljs-keyword"><span class="hljs-keyword">to</span></span>("controlbus:route?routeId=RaspberryPI Alarm&amp;action=resume") .otherwise() .<span class="hljs-keyword"><span class="hljs-keyword">to</span></span>("controlbus:route?routeId=RaspberryPI Alarm&amp;action=suspend"); <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>("timer://capture_image?delay=200&amp;period=5000") .routeId(<span class="hljs-string"><span class="hljs-string">'RaspberryPI Alarm'</span></span>) .<span class="hljs-keyword"><span class="hljs-keyword">to</span></span>("webcam:spycam?resolution=HD720") .setHeader(<span class="hljs-string"><span class="hljs-string">'to'</span></span>).<span class="hljs-keyword"><span class="hljs-keyword">constant</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">login</span></span>) .setHeader(<span class="hljs-string"><span class="hljs-string">'from'</span></span>).<span class="hljs-keyword"><span class="hljs-keyword">constant</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">login</span></span>) .setHeader(<span class="hljs-string"><span class="hljs-string">'subject'</span></span>).<span class="hljs-keyword"><span class="hljs-keyword">constant</span></span>(<span class="hljs-string"><span class="hljs-string">'alarm image'</span></span>) .process{ def attachment = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> DefaultAttachment(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ByteArrayDataSource(it.<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>.body, <span class="hljs-string"><span class="hljs-string">'image/jpeg'</span></span>)); it.<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>.setBody("&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;img src=\"cid:alarm-image.jpeg\" /&gt; ${new Date()}&lt;/body&gt;&lt;/html&gt;"); attachment.addHeader("Content-ID", <span class="hljs-string"><span class="hljs-string">'&lt;alarm-image.jpeg&gt;'</span></span>); it.<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>.addAttachmentObject("alarm-image.jpeg", attachment); //<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> CL <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> avoid javax.activation.UnsupportedDataTypeException: <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> DCH <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> MIME <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> multipart/mixed Thread.currentThread().setContextClassLoader( getClass().getClassLoader() ); } .<span class="hljs-keyword"><span class="hljs-keyword">to</span></span>(mailEndpoint) } }) registerLifecycleActions(camelContext, mailEndpoint, <span class="hljs-keyword"><span class="hljs-keyword">login</span></span>) camelContext.<span class="hljs-keyword"><span class="hljs-keyword">start</span></span>() def hawtIoConsole = MavenClassLoader.usingCentralRepo() .forMavenCoordinates(<span class="hljs-string"><span class="hljs-string">'io.hawt:hawtio-app:2.0.0'</span></span>).loadClass(<span class="hljs-string"><span class="hljs-string">'io.hawt.app.App'</span></span>) Thread.currentThread().setContextClassLoader(hawtIoConsole.getClassLoader()) hawtIoConsole.main(<span class="hljs-string"><span class="hljs-string">'--port'</span></span>,<span class="hljs-string"><span class="hljs-string">'10090'</span></span>) <span class="hljs-type"><span class="hljs-type">void</span></span> registerLifecycleActions(camelContext, mailEndpoint, <span class="hljs-keyword"><span class="hljs-keyword">login</span></span>) { camelContext.getManagementStrategy().addEventNotifier(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> EventNotifierSupport() { <span class="hljs-type"><span class="hljs-type">boolean</span></span> isEnabled(EventObject event) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> event instanceof CamelContextStartedEvent | event instanceof CamelContextStoppedEvent } <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">notify</span></span>(EventObject event) throws <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> { def status = event instanceof CamelContextStartedEvent ? <span class="hljs-string"><span class="hljs-string">'up'</span></span> : <span class="hljs-string"><span class="hljs-string">'down'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">'up'</span></span> == status){ def suspendEndpoint = camelContext.getEndpoint("controlbus:route?routeId=RaspberryPI Alarm&amp;action=suspend") suspendEndpoint.createProducer().process(suspendEndpoint.createExchange()) } def message = mailEndpoint.createExchange(); message.<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>.setHeader(<span class="hljs-string"><span class="hljs-string">'to'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">login</span></span>) message.<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>.setHeader(<span class="hljs-string"><span class="hljs-string">'from'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">login</span></span>) message.<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>.setHeader(<span class="hljs-string"><span class="hljs-string">'subject'</span></span>, "Alarm system is ${status}") message.<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>.setBody("System is ${status}: ${new Date()}"); mailEndpoint.createProducer().process(message) } }) addShutdownHook { camelContext.stop() } }</code> </pre><br><h3>  In java </h3><br>  To do the same on java it took more letters, files and of course the Reflection API. <br><br><div class="spoiler">  <b class="spoiler_title">Class com.github.igorsuhorukov.alarmsys.AlarmSystem:</b> <div class="spoiler_text">  <a href="">AlarmSystem.java</a> <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.github.igorsuhorukov.alarmsys; <span class="hljs-comment"><span class="hljs-comment">//dependency:mvn:/com.github.igor-suhorukov:mvn-classloader:1.8 //dependency:mvn:/org.apache.camel:camel-core:2.18.0 //dependency:mvn:/org.apache.camel:camel-mail:2.18.0 //dependency:mvn:/io.rhiot:camel-webcam:0.1.4 //dependency:mvn:/io.rhiot:camel-pi4j:0.1.4 //dependency:mvn:/org.slf4j:slf4j-simple:1.6.6 import com.github.igorsuhorukov.smreed.dropship.MavenClassLoader; import org.apache.camel.Endpoint; import org.apache.camel.Exchange; import org.apache.camel.Processor; import org.apache.camel.builder.RouteBuilder; import org.apache.camel.impl.DefaultAttachment; import org.apache.camel.impl.DefaultCamelContext; import org.apache.camel.management.event.CamelContextStartedEvent; import org.apache.camel.management.event.CamelContextStoppedEvent; import org.apache.camel.support.EventNotifierSupport; import javax.mail.util.ByteArrayDataSource; import java.lang.reflect.Method; import java.util.Date; import java.util.EventObject; class AlarmSystem { public static void main(String[] args) throws Exception{ String login = System.getProperty("login"); String password = System.getProperty("password"); DefaultCamelContext camelContext = new DefaultCamelContext(); camelContext.setName("Alarm system"); Endpoint mailEndpoint = camelContext.getEndpoint(String.format("smtps://smtp.mail.ru:465?username=%s&amp;password=%s&amp;contentType=text/html&amp;debugMode=true", login, password)); camelContext.addRoutes(new RouteBuilder() { @Override public void configure() throws Exception { from("pi4j-gpio://3?mode=DIGITAL_INPUT&amp;pullResistance=PULL_DOWN").routeId("GPIO read") .choice() .when(header("CamelPi4jPinState").isEqualTo("LOW")) .to("controlbus:route?routeId=RaspberryPI Alarm&amp;action=resume") .otherwise() .to("controlbus:route?routeId=RaspberryPI Alarm&amp;action=suspend"); from("timer://capture_image?delay=200&amp;period=5000") .routeId("RaspberryPI Alarm") .to("webcam:spycam?resolution=HD720") .setHeader("to").constant(login) .setHeader("from").constant(login) .setHeader("subject").constant("alarm image") .process(new Processor() { @Override public void process(Exchange it) throws Exception { DefaultAttachment attachment = new DefaultAttachment(new ByteArrayDataSource(it.getIn().getBody(byte[].class), "image/jpeg")); it.getIn().setBody(String.format("&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;img src=\"cid:alarm-image.jpeg\" /&gt; %s&lt;/body&gt;&lt;/html&gt;", new Date())); attachment.addHeader("Content-ID", "&lt;alarm-image.jpeg&gt;"); it.getIn().addAttachmentObject("alarm-image.jpeg", attachment); //set CL to avoid javax.activation.UnsupportedDataTypeException: no object DCH for MIME type multipart/mixed Thread.currentThread().setContextClassLoader( getClass().getClassLoader() ); } }).to(mailEndpoint); } }); registerLifecycleActions(camelContext, mailEndpoint, login); camelContext.start(); Class&lt;?&gt; hawtIoConsole = MavenClassLoader.usingCentralRepo() .forMavenCoordinates("io.hawt:hawtio-app:2.0.0").loadClass("io.hawt.app.App"); Thread.currentThread().setContextClassLoader(hawtIoConsole.getClassLoader()); Method main = hawtIoConsole.getMethod("main", String[].class); main.setAccessible(true); main.invoke(null, (Object) new String[]{"--port","10090"}); } private static void registerLifecycleActions(final DefaultCamelContext camelContext, final Endpoint mailEndpoint, final String login) { camelContext.getManagementStrategy().addEventNotifier(new EventNotifierSupport() { public boolean isEnabled(EventObject event) { return event instanceof CamelContextStartedEvent | event instanceof CamelContextStoppedEvent; } public void notify(EventObject event) throws Exception { String status = event instanceof CamelContextStartedEvent ? "up" : "down"; if ("up".equals(status)){ Endpoint suspendEndpoint = camelContext.getEndpoint("controlbus:route?routeId=RaspberryPI Alarm&amp;action=suspend"); suspendEndpoint.createProducer().process(suspendEndpoint.createExchange()); } Exchange message = mailEndpoint.createExchange(); message.getIn().setHeader("to", login); message.getIn().setHeader("from", login); message.getIn().setHeader("subject", "Alarm system is "+status); message.getIn().setBody("System is "+status+": "+new Date()); mailEndpoint.createProducer().process(message); } }); Runtime.getRuntime().addShutdownHook(new Thread(){ @Override public void run(){ try { camelContext.stop(); } catch (Exception e) { System.exit(-1); } } }); } }</span></span></code> </pre><br></div></div><br>  To build the need: <br><br><div class="spoiler">  <b class="spoiler_title">pom.xml with project dependencies</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span>4.0.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.github.igor-suhorukov<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>alarm-system<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span>jar<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0-SNAPSHOT<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.source</span></span></span><span class="hljs-tag">&gt;</span></span>1.8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.source</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.target</span></span></span><span class="hljs-tag">&gt;</span></span>1.8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.target</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.github.igor-suhorukov<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>mvn-classloader<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.apache.camel<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>camel-core<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.18.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.apache.camel<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>camel-mail<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.18.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>io.rhiot<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>camel-webcam<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>0.1.4<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>io.rhiot<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>camel-pi4j<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>0.1.4<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.slf4j<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>slf4j-simple<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.6.6<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br><h2>  Run the result on the Raspberry Pi 3 Model B </h2><br>  The linux Raspbian build on the SD card already miraculously contains Java 8 from Oracle.  Configure the connection to the Internet via WiFi or connect with a patchcord and configure the access to the Internet via the ethernet network via the RJ-45 connector on the board. <br><br>  So the whole installation will consist of simple commands: <br><br><pre> <code class="bash hljs">wget https://repo1.maven.org/maven2/com/github/igor-suhorukov/groovy-grape-aether/2.4.5.4/groovy-grape-aether-2.4.5.4.jar wget https://raw.githubusercontent.com/igor-suhorukov/alarm-system/master/AlarmSystem.groovy</code> </pre><br>  And run the program: <br><br><pre> <code class="bash hljs">java -Dlogin=..._...@mail.ru -Dpassword=******* -jar groovy-grape-aether-2.4.5.4.jar AlarmSystem.groovy</code> </pre><br>  Or you can simply enter your username and password in the script, so as not to shine them in the command history: <br><br><pre> <code class="hljs scala"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">login</span></span></span><span class="hljs-function"> </span></span>= ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">password</span></span></span><span class="hljs-function"> </span></span>= ...</code> </pre><br>  Immediately after launching the script, the ‚ÄúGPIO read‚Äù route waits for a signal from the reed switch and is launched, and the second route ‚ÄúRaspberryPI Alarm‚Äù with a webcam is paused. <br><br><div class="spoiler">  <b class="spoiler_title">This can be viewed in the web console ...</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/ce6/4b0/e3b/ce64b0e3b2ce4455947f247278b93b47.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">You can also put jconsole aside.</b>  <b class="spoiler_title">After all flows and metrics of jvm can be looked in hawt.io</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/ff8/6ec/0db/ff86ec0db1ff4cfd837126a674363878.png"><br><img src="https://habrastorage.org/files/7fa/0f8/7cb/7fa0f87cb1b446419780729c339d165b.png"><br></div></div><br>  This monitoring console is available at http: // ADDRESS_MALINA: 10090 / hawtio / <br><br>  Java version needs to be built using maven.  Or you can go to the trick and run a Java program as a script with dynamic dependency resolution as follows: <br><br><blockquote>  java -Dlogin = ... YOUR_EMAIL ... @ mail.ru -Dpassword = ******* -DscriptPath = https: //raw.githubusercontent.com/igor-suhorukov/alarm-system/master/src/ main / java / com / github / igorsuhorukov / alarmsys / AlarmSystem.java -jar <a href="">java-as-script-1.0.jar</a> </blockquote><br>  About how java-as-script-1.0.jar works and what else you can do with it will be a separate article. <br><br><h2>  How to live on with this knowledge? </h2><br><br>  Apache Camel turned out to be an excellent tool for rapid prototyping, since there are many ready-made components for various peripherals and Internet services.  Although it is usually used in enterprise applications for integration, but even on modern single-board computers and solutions for the ‚ÄúInternet of things‚Äù, it will give odds to other approaches for developing systems.  Just "break it out" and you will like it, especially with Groovy! <br><br>  The project is available in the github repository <a href="https://github.com/igor-suhorukov/alarm-system">alarm-system</a> and appeared on the official Apache Camel website in the <a href="http://camel.apache.org/articles">‚ÄúCamel and the IoT (Internet of Things)‚Äù section</a> . </div><p>Source: <a href="https://habr.com/ru/post/314898/">https://habr.com/ru/post/314898/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../314886/index.html">Development based on the COREmanager framework. How our partners created a solution for outsourcing technical support</a></li>
<li><a href="../314888/index.html">Desktop virtualization: what's new, what are the trends and where are we going?</a></li>
<li><a href="../314892/index.html">You can download materials from the Nanometer ASIC workshop (RUSNANO / MISiS / Imagination Technologies) - educational program for all chips</a></li>
<li><a href="../314894/index.html">Many JS packages in one repository</a></li>
<li><a href="../314896/index.html">Mobile Antifraud Overview</a></li>
<li><a href="../314900/index.html">Typical backup errors and how to avoid them</a></li>
<li><a href="../314902/index.html">Hammer, termite and magnetic field for quick data destruction</a></li>
<li><a href="../314904/index.html">Using MS Cognitive Services to analyze your Instagram profile</a></li>
<li><a href="../314906/index.html">Designing a large project on the example of Alibaba.com analogue</a></li>
<li><a href="../314908/index.html">Not your problem</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>