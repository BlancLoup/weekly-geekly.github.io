<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Save health% username%: sports search engine</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Any IT specialist spends a significant part of his life sitting in front of a computer (hello KO!). Especially hard to those who work remotely or free...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Save health% username%: sports search engine</h1><div class="post__text post__text-html js-mediator-article">  Any IT specialist spends a significant part of his life sitting in front of a computer (hello KO!).  Especially hard to those who work remotely or freelance.  You don‚Äôt need to go to work, and there are days when you don‚Äôt leave the house for several days. <br><br>  <a href="http://ru.wikipedia.org/wiki/%25D0%2593%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B4%25D0%25B8%25D0%25BD%25D0%25B0%25D0%25BC%25D0%25B8%25D1%258F">Wikipedia</a> and <a href="http://scholar.google.ru/scholar%3Fhl%3Den%26q%3DSedentary%2Blifestyle%26btnG%3D%26as_sdt%3D1%252C5%26as_sdtp%3D">research</a> suggests that you have to pay for everything.  If you sit at a computer for 12-14 hours a day, by the age of 50 (or maybe even earlier) your quality of life may drop significantly. <br><br><div class="spoiler">  <b class="spoiler_title">I do not want to frighten, but the list of possible consequences really looks frightening:</b> <div class="spoiler_text"><ul><li>  <a href="http://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25BE%25D1%2581%25D1%2582%25D0%25B0%25D1%2582%25D0%25B8%25D1%2582">Prostatitis</a> </li><li>  <a href="http://ru.wikipedia.org/wiki/%25D0%259F%25D0%25BE%25D1%2587%25D0%25B5%25D1%2587%25D0%25BD%25D0%25BE%25D0%25BA%25D0%25B0%25D0%25BC%25D0%25B5%25D0%25BD%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25B1%25D0%25BE%25D0%25BB%25D0%25B5%25D0%25B7%25D0%25BD%25D1%258C">Kidney disease</a> </li><li>  <a href="http://ru.wikipedia.org/wiki/%25D0%259E%25D1%2581%25D1%2582%25D0%25B5%25D0%25BE%25D0%25BF%25D0%25BE%25D1%2580%25D0%25BE%25D0%25B7">Osteoporosis</a> </li><li>  <a href="http://ru.wikipedia.org/wiki/%25D0%2597%25D0%25BB%25D0%25BE%25D0%25BA%25D0%25B0%25D1%2587%25D0%25B5%25D1%2581%25D1%2582%25D0%25B2%25D0%25B5%25D0%25BD%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BD%25D0%25BE%25D0%25B2%25D0%25BE%25D0%25BE%25D0%25B1%25D1%2580%25D0%25B0%25D0%25B7%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5_%25D1%2582%25D0%25BE%25D0%25BB%25D1%2581%25D1%2582%25D0%25BE%25D0%25B3%25D0%25BE_%25D0%25BA%25D0%25B8%25D1%2588%25D0%25B5%25D1%2587%25D0%25BD%25D0%25B8%25D0%25BA%25D0%25B0_%25D0%25B8_%25D0%25BF%25D1%2580%25D1%258F%25D0%25BC%25D0%25BE%25D0%25B9_%25D0%25BA%25D0%25B8%25D1%2588%25D0%25BA%25D0%25B8">Malignant neoplasm of colon and rectum</a> </li><li>  <a href="http://ru.wikipedia.org/wiki/%25D0%25A2%25D1%2580%25D0%25BE%25D0%25BC%25D0%25B1%25D0%25BE%25D0%25B7_%25D0%25B3%25D0%25BB%25D1%2583%25D0%25B1%25D0%25BE%25D0%25BA%25D0%25B8%25D1%2585_%25D0%25B2%25D0%25B5%25D0%25BD">Deep vein thrombosis</a> </li></ul></div></div><br>  The solution - breaks in work and physical activity.  Plus, if you work at home, and not in a team, then for a vigorous mental state it would be nice if the chosen type of physical activity is grouped and involves social interactions.  But finding someone and where to play football is not such an easy task. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/94a/a8d/dea/94aa8ddeadbfab05658773d238699438.jpg"><br><br>  We decided to create a <a href="http://ru.trytopic.com/">site</a> where all football, basketball, volleyball and hockey games will be collected.  Try using technology to make life easier for both players and game organizers.  Under Habrokat I'll talk about the essence of the project, the architecture and the technologies used. <br><a name="habracut"></a><br><br><h2>  To the players </h2><br>  For players, the <b>location of the sports ground</b> is critical.  If you have to spend an hour and a half on the way to the gym, then work on that day will not be so easy.  Therefore, on the main page of the site there is a google-map with game location markers and their list.  The list of games is sorted by date. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/da5/130/991/da51309913225892d15e0b11227da36d.jpg"><br><br>  Search for games is conducted by sports and on the edges of the map viewport.  Viewport - the visible area of ‚Äã‚Äãthe google maps map.  Now only pre-moderated games are displayed in the search, for which the Trusted flag is set in the database. <br><br>  Equally important is the <b>level of players</b> .  If you are good at playing, it will not be interesting with newbies.  In your profile, you can set the level of the game from 1 to 10, for each game indicated the estimated level, so you can navigate. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/95d/e7c/57d/95de7c57dca00ce1e0136efb54ee1578.jpg"><br><br><h2>  To the organizers </h2><br>  For organizers, the main problem is those who <b>declare and do not come</b> .  We give the organizer the opportunity to collect prepayment for the hall from the players.  She is a guarantee that the person will come.  If the player decides earlier than 12 hours before the game to refuse to participate, then the prepayment is returned to his account.  If there are less than 12 hours left before the game, the prepayment leaves the organizer. <br><br>  The organizer has a personal account with a list of his games, marked by status.  In addition, the organizer sees a list of players who viewed the game's payment page, but encountered some problems and did not pay. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b89/25b/50a/b8925b50a9439a10d95f44d2e63c499d.jpg"><br><br><h3>  Game statuses </h3><br>  Depending on the three main parameters, the game has a number of states.  Each parameter takes one of three values: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f05/502/7ec/f055027ec7133588481548f4a52e39cb.gif"><br><br>  The organizer creates a recurring series of games: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/77d/c45/2f2/77dc452f2d38d570d783416a5a26113a.jpg"><br><br>  Every day, based on the records of the created repetitive game series, games are created for a week ahead by cron.  The Stripe.com payment system used by us can keep money in uncaptured status for only 7 days, after which it either makes a refund or seizes money.  Therefore, we do not immediately create games for the long term. <br><br>  The newly created game has statuses: <br>  MONEY_NOT_YET - as long as we have not made a request for refund or capture of prepaid money <br>  LESS_THEN_MIN_PLAYERS - until the minimum number of players has reached <br>  BEFORE_LOCKPERIOD - there are still more than 12 hours left to play <br><br>  If the organizer has indicated that the game will take place, with at least 8 players enrolling, then as soon as 8 players are recruited, LESS_THEN_MIN_PLAYERS changes to ALREADY_MIN_NOT_MAX_PLAYERS <br><br>  The next important stage is the onset of lockperiod 12 hours before the start of the game.  If at this moment we have the status ALREADY_MIN_NOT_MAX_PLAYERS or MAX_PLAYERS, then the game will take place, send stripe.com a request for capture of prepayments, and the game changes its status to: CAPTURED, ALREADY_MIN_NOT_MAX_PLAYERS, LOCKPERIOD.  In the opposite case - we do refund and send notifications by SMS and mail that the game will not take place. <br><br><h3>  Subscriptions </h3><br>  The main thing is to overcome laziness and practice regularly.  To do this, we have added the possibility of buying subscriptions - bought and not wriggle out.  You play regularly - higher efficiency at work, and the joy in life will be much more, not up to depression. <br>  Subscriptions make each lesson for players cheaper, and the games of the organizers are more stable. <br><br>  The database stores the cost of N games for a specific series of games.  If a player buys a subscription for 8 games starting on Tuesday, then we record it in the database on Tuesday, marking that he still has 8-1 = 7 games.  We are looking for the next game in this series, if there is one, then we write it down and mark that it still has 7-1 = 6 games and so on. <br><br>  When creating a new game of this series using cron, we are looking for subscription records in the last game.  If they are, then we transfer them to a new game, reducing by one the player‚Äôs remaining number of games. <br><br><h3>  Chat </h3><br>  So that the players could find out the details, and the organizer could answer their questions with minimal effort, it was necessary to make an internal messaging system.  Honestly, the chat is still unstable (as well as some other features), but it allows us to solve the problems of users, and we can deal with its instability. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/587/7dc/275/5877dc2750177becae77804fc316aaec.jpg"><br><br>  Implemented fairly trivial, all the functionality in php, as the data warehouse uses a database.  To speed up the work applied cache.  The cache works as follows: when creating new messages and rooms, other users except the author himself write an entry about the new event in the cache.  This allows us once again not to pull the database to receive new events for the user. <br><br>  In the frontend, too, everything is simple - ajax requests for rooms, sending messages and other things.  At a certain time interval, a request is made to the ‚Äúobserver‚Äù script, which notifies of new messages.  In the future, the chat will most likely use the node.js interlayer. <br><br><h3>  Technology and architecture </h3><br>  It so happened that the very first version of <a href="http://ru.trytopic.com/">Topika</a> was written on Livestreet cms.  This was the legacy of our previous project, a fairly large blog site.  The basic hypothesis was easier to test while continuing to develop on Livestreet. <br><br>  But Livestreet is sharpened for completely different tasks and the development speed left much to be desired, the development of new features took considerable time.  Therefore, as soon as we realized that the project was flying slowly, we decided to switch to something more suitable. <br><br>  The choice fell on Yii2.  Development using the namespace and all the buns of php 5.4 is much more efficient and interesting.  The alpha version of the framework has its drawbacks and risks, you need to constantly be aware of changes in api, sometimes rewriting some parts of the code when refactoring the framework.  But we were well aware of these risks and decided to make a choice in favor of performance and interesting development. <br><br>  As a basis for the application, the <a href="https://packagist.org/packages/yiisoft/yii2-app-advanced">advanced application template is used</a> .  Split into 4 main parts of the site, frontend, admin, console and api.  The template has a common base namespace.  In his folder are models with minimal functionality for use in parts of the application, basic modules, components and extensions.  It also stores the basic configuration of the entire site, common to all parts. <br><br>  Almost all the functionality is divided into modules, this is a very common practice, but if the module requires its own unique functionality of the basic models and components, they are expanded in the context of the module. <br><br>  As a test, the unit and acceptance tests are used in the codeception environment through the layer-extension yii2 - to correctly reproduce the framework environment, work with fixtures, and so on.  You can read more about testing in yii2 <a href="https://github.com/yiisoft/yii2/tree/master/extensions/codeception">here</a> and <a href="">here</a> .  In general, the framework already has a very detailed, although in some places, inaccurate <a href="https://github.com/yiisoft/yii2/tree/master/docs/guide">documentation</a> on the basic API. <br><br><h3>  Feedback </h3><br>  We recently started working on this concept, much more needs to be done and polished, but there is already a positive feedback from users and the first revenue. <br><br>  I want to ask the distinguished community to express my opinion, what would you like to have in such a service?  What obstacles can stop you from organizing your game / from joining such a game?  And what can push? <br><br>  I urge everyone to try to <a href="http://ru.trytopic.com/center/create/step-1">add a platform</a> near their home and try <a href="http://ru.trytopic.com/campaign">to assemble the game</a> already for this weekend, and we will do our best to help.  We will be very happy if it is possible to revive the good tradition of <a href="http://habrahabr.ru/search/%3Fq%3D%25D0%25A5%25D0%25B0%25D0%25B1%25D1%2580%25D0%25B0%25D1%2584%25D1%2583%25D1%2582%25D0%25B1%25D0%25BE%25D0%25BB">habrafutbola</a> . <br><br>  <b>UPD</b> <a href="http://ru.trytopic.com/profile/dmitriy">Dmitry is</a> up to Habrobasketball in St. Petersburg.  Who wants to join - write to him or me in a personal <br>  <b>UPD2</b> Habrabetballball / habrafootball / habravoleball is planned in Voronezh, write to <a href="http://ru.trytopic.com/profile/andrey.fedotov">Andrey</a> </div><p>Source: <a href="https://habr.com/ru/post/211266/">https://habr.com/ru/post/211266/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../211248/index.html">Moto G Review: The Last True "Motor"</a></li>
<li><a href="../211256/index.html">Baboom: Kim Dotcom New Project</a></li>
<li><a href="../211260/index.html">Example of jQuery UI + PHP and GD. Application of the image</a></li>
<li><a href="../211262/index.html">HP will pay a record $ 150K for an exploit at Pwn2Own 2014</a></li>
<li><a href="../211264/index.html">Counting Hamming distances on a large dataset</a></li>
<li><a href="../211270/index.html">NERSC launches Edison supercomputer with 2.4 petaflops performance</a></li>
<li><a href="../211272/index.html">Part 3. Meet - laser called Amaris. Moving and first awakening of VisuMax</a></li>
<li><a href="../211278/index.html">Utopia replace Silk Road?</a></li>
<li><a href="../211282/index.html">Difficulties of choice</a></li>
<li><a href="../211284/index.html">We fix the hanstunnel on openwrt (calculation of the checksum of the network packet)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>