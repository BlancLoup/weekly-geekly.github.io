<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>JAVA + Swing in 2013. Is it worth it?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On Habr√© Swing do not like. A search for ‚ÄúSwing‚Äù gives either neutral or negative references. Here are some of them: 


- "Java applets (developed to ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>JAVA + Swing in 2013. Is it worth it?</h1><div class="post__text post__text-html js-mediator-article">  On Habr√© Swing do not like.  <a href="http://habrahabr.ru/search/%3Ftarget_type%3Dposts%26q%3Dswing%26order_by%3Ddate">A search</a> for ‚ÄúSwing‚Äù gives either neutral or negative references.  Here are some of them: <br><ul><li>  "Java applets (developed to a fatal disease called Swing)" </li><li>  ‚ÄúSwing - to put it mildly, not the most optimal UI framework‚Äù </li><li>  "Swing was terrible" </li></ul><br>  I do not take the claim that Swing is ideal.  It is not true.  However, I will try to describe the pros and cons that I had to face. <a name="habracut"></a><br><br><h4>  Why swing </h4><br>  I have been working with Swing intermittently for a couple of years.  Mostly in the evenings.  I am writing a <a href="http://www.visualwatermark.com/">Visual Watermark</a> program for group photo protection.  I had a Java version in 2011. I wanted to make a Mac port and lick the interface, but I did not have any opportunity to write a separate program for each platform. <br><br>  At the beginning of 2011, the UI libraries for cross-platform development were in this state: <br><ul><li>  <b>QML</b> was all in bugs: the menu appeared under the components, the demo was falling, there was no support in QtCreator.  Accelerated rendering only appeared in Qt5 last fall. </li><li>  <b>Qt</b> did not fit, because  It was entirely on ‚Äúnative‚Äù components, and often it was necessary to change the drawing somewhere. </li><li>  <b><a href="http://www.juce.com/">Juce was</a></b> suitable for functionality, not buggy and did not fall.  Cost acceptable money and even with open code.  Scared me off with C ++.  This is a wonderful language in which a huge number of smartest people write.  Given my small experience and task size, the complexity of C ++ is overkill.  Plus, it turned out that Xcode cannot refactor C ++. </li><li>  <b>Adobe Air</b> does not support multi-threading. </li><li>  <b>Mono + GTK</b> It seems to me that this combination could solve my problems.  At that moment, the obvious shoal with broken hotkeys in GTK scared off.  Judging by MonoDevelop, it is still not fixed. </li><li>  <b>JavaFX was</b> not under Mac. </li><li>  <b>SWT is</b> much easier than Swing and is generally good.  I didn‚Äôt write to SWT because I was watching it last.  A lot of time was already spent and I finished the experiments on the first available bug (the buttons on the toolbar ‚Äúfloated‚Äù on the height). </li></ul><br>  At that time, Java was part of Mac OS X, had a great Native Look &amp; Feel, and JRE for Windows weighed only 12 megabytes.  I was naively confident of success.  As a result, after 2 or 3 months of work, I ended up with the first version of the Java Swing program. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>To date, the described problems have been fixed in QML and JavaFX.</i>  <i>Therefore, if you are ready to work with the stage graph, then you should take them for a test drive.</i> <br><br>  <i>Qt came under the wing of Digia.</i>  <i>The release of the beta version for iPhone and Android gives hope for the further development of the library.</i> <br><br>  <i>JavaFX became an open source library in February of this year.</i>  <i>Its compatibility with OpenJDK <a href="http://openjdk.java.net/projects/openjfx/">is planned</a> for JDK 9. When it comes out 9ka is unknown.</i>  <i>Release 8th version is scheduled for early 2014.</i> <br><br><h4>  Oh good </h4><br>  I'll start with the good.  Suddenly you think that I also signed up for Swing-haters ?! <br><br>  <b>All hardware-accelerated rendering.</b>  Any Swing application is drawn on the GPU, nothing is required of the developer.  This makes animation possible in the application.  Including when the application is full-screen or deployed on a 24 "monitor. <br><br>  <b>MVC.</b>  Swing is criticized for being massive: each component consists of a view, a controller, and a model.  At the same time, this makes it possible to quickly add the desired feature to an existing component.  Everything is very flexible. <br><br>  <b>Java is managed code.</b>  You get rid of a heap of possible bugs that are ‚Äúavailable‚Äù only for C ++ developers.  The risk of Access Violation is minimized.  Although this does not mean that you will not have other bugs.  Memory leaks, for example. <br><br>  <b>Excellent development environment.</b>  Eclipse, Intellij IDEA, NetBeans - a huge choice.  Everywhere there are refactorings, code formatting, auto-complete, support for unit tests, <br><br>  <b>A lot of libraries.</b>  LayoutManager, working with native objects, strings, web - just do not list.  This is a huge trump card Java as a platform. <br><br>  <b>A lot of answers to questions.</b>  For example, here is the <a href="http://hewgill.com/~greg/stackoverflow/stack_overflow/tags/">share of questions</a> on StackOverflow for each of the UI libraries. <br><br><img src="https://habrastorage.org/storage2/280/f47/6e6/280f476e6a9ef8c55a7648e3b4f45abb.png"><br><br>  About every hundredth question on StackOverflow is a question about Swing.  In practice, this means that most problems have already been solved.  Most likely, you will not be left alone with a problem. <br><br><h4>  About bad </h4><br>  The previous part is like a sweet press release.  Correct.  This is what you may encounter. <br><br>  <b>Do not fix critical bugs.</b>  File.exists <a href="https://java.net/jira/browse/MACOSX_PORT-165">does not work</a> since the release of JDK7 and there is no fix until now.  Even if the bug is critical, you can wait for fixes for years. <br><br>  The situation may become worse if you plan to use the native code.  I was faced with a situation where the use of modal windows (for example, opening an OpenFileDialog) causes hangs on some computers.  Given that Java Native Foundation is used according to examples in the documentation.  And the bounty on StackOverflow didn't help me :-) <br><br>  A bug with file.exists can be bypassed using classes from java.nio.  This is a new API that was designed to solve performance problems with spreading folders. <br><br>  What should be done: <br><ol><li> Run the application with the parameter <code>‚ÄìDfile.encoding=UTF-8</code> </li><li>  Instead of File.exists, use <code>Files.exists(Paths.get(fileName))</code> </li><li>  Instead of File.listFiles we use <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> (DirectoryStream&lt;Path&gt; ds = Files.newDirectoryStream(folder)) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Path file : ds) { <span class="hljs-comment"><span class="hljs-comment">// do something } } catch (IOException e) { e.printStackTrace(); }</span></span></code> </pre> </li></ol><br>  Or fix this bug yourself and push the bookmark through a series of reviews. <br><br>  <b>Swing - only hardware accelerated.</b>  This means your application will not work in VMware, Parallels or via remote desktop.  If you are not ready to put up with it, then look towards SWT. <br><br>  <b>No 32-bit Mac builds.</b>  The official build is only 64 bits.  Unfortunately, I do not know the reason for this decision.  I can only guess what the matter is in some bugs. <br><br>  For a while, Henri Gomez supported 32-bit and universal builds.  Finished builds can be downloaded from his page on code.google.com.  To my regret, the lack of time and the new work forced Henry to curtail this project.  After saying goodbye, he put his build scripts on GitHub: <br>  <a href="https://github.com/hgomez/obuildfactory">https://github.com/hgomez/obuildfactory</a> <br><br>  With their help, you can build OpenJDK for Mac and Linux.  Great, but not quite.  <i>With these scripts, the 32-bit version for Mac is not going to.</i>  Inside the JDK is a huge amount of configuration files in which the build of a strictly 64-bit version for Mac is wired.  Change the key in the main file and get an inoperable build.  How Henri Gomez collected 32-bit builds is unknown to me. <br><br>  <b>Include the JRE in the distribution.</b>  Oracle executives opinion on application distribution: ‚ÄúThe standalone self-contained installer with a bundled JRE for the target platform is a better application distribution model‚Äù ( <a href="http://habrahabr.ru/post/178889/">source</a> ).  The most likely reason for this decision is a huge number of vulnerabilities in applets: Java has adopted the sieve banner from Flash. <br><br>  This restriction is most strongly supported by Apple, which removed Java in Mac OS 10.7 Lion.  They also forcibly disable it when installing new system updates. <br><br>  JRE 7 weighs about 100 MB.  The archive gets about 50. Unfortunately, the size of the JRE from update to update is growing and we have to solve the problem of the swollen distribution. <br><br>  <b>Not all BufferedImage objects use hardware acceleration.</b>  Only for BufferedImage.TYPE_INT_ *.  Therefore, starting with JDK7, working with TYPE_4BYTE *, TYPE_3BYTE is inconsistent. <br><br>  <b>When accessing the data of the BufferedImage raster, the picture ceases to be drawn through the GPU.</b>  Why this is done is clear: the user changes the data, there is no ‚Äúfinished change‚Äù method and it is not clear when to re-fill them into video memory.  At least this is logical. <br><br>  In Visual Watermark, I used the C ++ library to load images and needed to turn the resulting pixels into a BufferedImage object.  Changing one pixel one by one very slowly and I had to write directly to the raster buffer of the image.  As soon as I called getData () on the raster, all my pictures stopped accelerating.  Rummaging through the DataBufferInt code, I found a solution to this problem using reflection and wrote a small helper class: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.awt.*; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.awt.image.*; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.lang.reflect.Field; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sun.awt.image.SunWritableRaster; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sun.java2d.StateTrackableDelegate; <span class="hljs-comment"><span class="hljs-comment">// Standard library prevents image acceleration once getData() method is called // This class provides a workaround to modify data quickly and still get hw-accel graphics public class AcceleratedImage { // Returns data object not preventing hardware image acceleration public static int[] getDataBuffer(DataBufferInt dataBuffer) { try { Field field = DataBufferInt.class.getDeclaredField("data"); field.setAccessible(true); int[] data = (int[])field.get(dataBuffer); return data; } catch (Exception e) { return null; } } // Marks the buffer dirty. You should call this method after changing the data buffer public static void markDirty(DataBufferInt dataBuffer) { try { Field field = DataBuffer.class.getDeclaredField("theTrackable"); field.setAccessible(true); StateTrackableDelegate theTrackable = (StateTrackableDelegate)field.get(dataBuffer); theTrackable.markDirty(); } catch (Exception e) { } } // Checks whether current image is in acceleratable state public static boolean isAcceleratableImage(BufferedImage img) { try { Field field = DataBuffer.class.getDeclaredField("theTrackable"); field.setAccessible(true); StateTrackableDelegate trackable = (StateTrackableDelegate)field.get(img.getRaster().getDataBuffer()); if (trackable.getState() == sun.java2d.StateTrackable.State.UNTRACKABLE) return false; field = SunWritableRaster.class.getDeclaredField("theTrackable"); field.setAccessible(true); trackable = (StateTrackableDelegate)field.get(img.getRaster()); return trackable.getState() != sun.java2d.StateTrackable.State.UNTRACKABLE; } catch(Exception e) { return false; } } public static BufferedImage convertToAcceleratedImage(Graphics _g, BufferedImage img) { if(!(_g instanceof Graphics2D)) return img; // We cannot obtain required information from Graphics object Graphics2D g = (Graphics2D)_g; GraphicsConfiguration gc = g.getDeviceConfiguration(); if (img.getColorModel().equals(gc.getColorModel()) &amp;&amp; isAcceleratableImage(img)) return img; BufferedImage tmp = gc.createCompatibleImage(img.getWidth(), img.getHeight(), img.getTransparency()); Graphics2D tmpGraphics = tmp.createGraphics(); tmpGraphics.drawImage(img, 0, 0, null); tmpGraphics.dispose(); img.flush(); return tmp; } }</span></span></code> </pre><br><br>  You need to use it like this: <br><pre> <code class="java hljs">DataBufferInt dataBuffer = (DataBufferInt)bufferedImage.getRaster().getDataBuffer(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] data = AcceleratedImage.getDataBuffer(dataBuffer); <span class="hljs-comment"><span class="hljs-comment">//   AcceleratedImage.markDirty(dataBuffer);</span></span></code> </pre><br>  <i>I did not check this code for images that have already been displayed.</i> <br><br>  <b>There is no built-in animation and semi-transparency.</b>  The javax.swing.Timer object does two things: <br><ol><li>  You can make animation components. </li><li>  Because of the simplicity of the class, doing it for a very long time. </li></ol><br>  There is a <a href="https://java.net/projects/timingframework">Timing Framework</a> library that makes creating animations easier.  Animation can be done like this: <br><br><pre> <code class="java hljs">Animator viewAnimator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Animator.Builder() .setDuration(duration, TimeUnit.MILLISECONDS) <span class="hljs-comment"><span class="hljs-comment">//    .setStartDirection(Direction.FORWARD) .setInterpolator(new AccelerationInterpolator(0.3, 0.7)) //     .setRepeatCount(1).addTarget(new TimingTargetAdapter() { @Override public void timingEvent(Animator source, double fraction) { //   repaint(); } @Override public void end(Animator source) { //  -    } }).build(); viewAnimator.start();</span></span></code> </pre><br>  The most commonly used animation is position and semi-transparency.  If everything is OK with position control in Swing, standard components do not support semi-transparency.  The problem is not the capabilities of the graphics engine, but that the components do not have the getAlpha / setAlpha property. <br><br>  <b>The Java application will not run in Mountain Lion due to GateKeeper.</b>  To solve this problem you need to sign up for Mac Developer for $ 99 / year.  In return, Apple will give you a certificate to sign the code and the problem will go away. <br>  You can sign a bundle with the application like this: <br> <code>codesign ‚Äìs ‚ÄúDeveloper ID‚Äù ‚Äìf ‚Äúpath-to-my-app.app‚Äù</code> <br> <br><h4>  In total </h4><br>  In my opinion, the main disadvantage of Swing is uncertainty about the future of the platform, because critical bugs remain open.  Only vulnerabilities in browser plugins are waiting for their fixes.  One gets the feeling that the library was abandoned.  All other problems are not so important. <br><br>  And I will be very sad if this is true.  Because writing a desktop application on Swing is fast, simple, and around a huge amount of ready-made and free code. <br><br>  While I still have hope that developers in Oracle will have time to solve system problems. <br><br>  <b>UPDATE: I</b> found out from comments that customization of controls in Qt is possible: <br><img src="https://habrastorage.org/storage2/d1e/2e2/dfe/d1e2e2dfe106a09032be2794912aee7c.jpg"><br>  Thanks to <a href="https://habrahabr.ru/users/silvansky/" class="user_link">silvansky</a> <br>  <b>UPDATE: The</b> user <a href="https://habrahabr.ru/users/skyggedans/" class="user_link">Skyggedans</a> noticed that there was support for multi-threading in Air.  It is done through additional SWF files with which you can customize communication. </div><p>Source: <a href="https://habr.com/ru/post/179459/">https://habr.com/ru/post/179459/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../179443/index.html">Quantum teleportation: is data transfer faster than the speed of light?</a></li>
<li><a href="../179447/index.html">ASUS VivoTab ME400CL: Baby with an Atomic Heart</a></li>
<li><a href="../179449/index.html">What is an IT service? If you combine ISO 20000 (ITIL \ ITSM) and ISO 9000 (QMS, TQM)</a></li>
<li><a href="../179451/index.html">Course lectures "Startup". Peter Thiel. Stanford 2012. Session 13</a></li>
<li><a href="../179455/index.html">Discussion "What is web design in Russia?"</a></li>
<li><a href="../17946/index.html">RDF for dummies</a></li>
<li><a href="../179463/index.html">Tronsmart MK908 - a new generation of mini-computers on a 4-core Rockchip RK3188 chip</a></li>
<li><a href="../179465/index.html">Google Glass in action (video)</a></li>
<li><a href="../179467/index.html">Author Hydra, Amap and SuSEFirewall to Speak at PHDays</a></li>
<li><a href="../179469/index.html">Megatrade: presentation on NetApp FAS storage</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>