<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Testing in Yandex. How to make a fault-tolerant grid of thousands of browsers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Any specialist involved in testing web applications knows that the majority of routine actions on services can do the Selenium framework. In Yandex, m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Testing in Yandex. How to make a fault-tolerant grid of thousands of browsers</h1><div class="post__text post__text-html js-mediator-article">  Any specialist involved in testing web applications knows that the majority of routine actions on services can do the <a href="http://docs.seleniumhq.org/">Selenium</a> framework.  In Yandex, millions of autotests are performed per day, using Selenium to work with browsers, so we need thousands of different browsers that are available simultaneously 24/7.  And here begins the most interesting. <br><br> <a href="http://habrahabr.ru/company/yandex/blog/268309/"><img src="https://habrastorage.org/files/173/930/c0e/173930c0ec244ae8afa229966e0453d3.png"></a> <br><br>  Selenium with a large number of browsers has many problems with scaling and fault tolerance.  After several attempts, we got an elegant and easy-to-maintain solution, and we want to share it with you.  Our <b>gridrouter</b> project allows <b>you</b> to organize a fault-tolerant Selenium-grid from any number of browsers.  The code is laid out in open-source and is available on <a href="https://github.com/seleniumkit/gridrouter">Github</a> .  Under the cut, I will tell you what disadvantages of Selenium we paid attention to, how you came to our decision, and explain how to configure it. <br><a name="habracut"></a><br><h2>  Problem </h2><br>  Selenium has changed dramatically since its inception, the current architecture, called Selenium Grid, works like this. <br><img src="https://habrastorage.org/files/7cc/c5a/828/7ccc5a82857d493d9c2dac705e704e6d.png"><br>  A cluster consists of two applications: a <b>hub</b> (hub) and a <b>node</b> (node).  <u>A hub</u> is an API that accepts user requests and sends them to nodes.  <u>A node</u> is a requestor that launches browsers and performs test steps in them.  Theoretically, an infinite number of nodes can be connected to a single hub, each of which can run any of the supported browsers.  And what about in practice? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  <b>There is a weak spot.</b>  The hub is the only point of access to browsers.  If for some reason the hub process stops responding, then all browsers become inaccessible.  It is clear that the service also stops working if the data center where the hub is located has a network or power failure. </li><li>  <b>Selenium Grid doesn‚Äôt scale well.</b>  Our long-term experience of operating Selenium on different equipment shows that under load one hub is able to work with no more than several dozen connected nodes.  If you continue to add nodes, then at peak load the hub may stop responding over the network or it processes requests too slowly. </li><li>  <b>No quoting.</b>  You cannot create users and specify which browser versions which user can use. </li></ul><br><h2>  Decision </h2><br>  In order not to suffer in the fall of one hub, you can raise several.  But the usual libraries to work with Selenium are designed to work with only one hub, so you have to teach them to work with a distributed system. <br><br><h4>  Client balancing </h4><br>  Initially, we solved the problem of working with several hubs using a small library that was used in the test code and performed balancing on the client side. <br><img src="https://habrastorage.org/files/a32/5ac/a11/a325aca11dba405da9ff98aaf5cf3f68.png"><br>  Here's how it works: <br><br><ol><li>  Information about hosts with hubs and browser versions available on them is saved to the configuration file. </li><li>  The user connects the library in their tests and requests the browser. </li><li>  A host is randomly selected from the list and an attempt is made to get a browser. </li><li>  If the attempt is successful, the browser is given to the user and the tests begin. </li><li>  If the browser could not be obtained, then again the next host is randomly selected, etc. Since different hubs may have different number of browsers available, different weights can be assigned to the hubs in the configuration file, and a random selection is made taking these weights into account.  This approach allows to achieve a uniform load distribution. </li><li>  The user receives an error only if the browser could not get on any of the hubs. </li></ol><br>  The implementation of this algorithm is simple, but requires integration with each library to work with Selenium.  Suppose in your tests the browser is obtained with the following code: <br><br><pre><code class="java hljs">WebDriver driver = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RemoteWebDriver(SELENIUM_SERVER_URL, capabilities);</code> </pre> <br>  Here <a href="">RemoteWebDriver</a> is the standard class for working with Selenium in Java.  To work in our infrastructure, you will have to wrap it in our own code with the choice of a hub: <br><br><pre> <code class="java hljs">WebDriver driver = SeleniumHubFinder.find(capabilities);</code> </pre> <br>  The test code no longer contains the URL to Selenium, it is contained in the library configuration.  This also means that the test code is now tied to <b>SeleniumHubFinder</b> and will not run without it.  In addition, if you have tests not only in Java, but also in other languages, you will have to write a client balancer for them all, and this can be expensive.  It is much easier to put the balance code on the server and specify its address in the test code. <br><br><h4>  Server balancing </h4><br>  When designing the server, we laid down the following natural requirements: <br><br><ol><li>  The server must implement the Selenium API ( <a href="https://code.google.com/p/selenium/wiki/JsonWireProtocol">JsonWire</a> protocol) in order for the tests to work with it, as with a regular Selenium hub. </li><li>  You can place as many server heads as you want in any data centers and balance them with an iron or software balancer (SLB). </li><li>  The heads of the server are completely independent of each other and do not store the shared state. </li><li>  A server out of the box provides quoting, that is, independent work of several users. </li></ol><br><img src="https://habrastorage.org/files/c4c/050/ebc/c4c050ebce704b60abf224e1e4fd5730.png"><br><br>  Architecturally obtained solution looks like this: <br><br><ul><li>  The load balancer (SLB) scatters requests from users to one of the N heads with the server listening on the standard port (4444). </li><li>  Each of the heads stores in the form of a configuration information about all the available Selenium-hubs. </li><li>  When a request is received by the browser, the server uses the balancing algorithm described in the previous section and receives the browser. </li><li>  Each running browser in the standard Selenium gets its unique identifier, called the <b>session ID</b> .  This value is transmitted by the client to the hub with any request.  When a browser is received, the server replaces the real session ID with a new one, which additionally contains information about the hub on which this session was received.  The resulting session with the extended ID is given to the client. </li><li>  For further requests, the server retrieves the host address with the hub from the session ID and proxies requests to this host.  Since all the information needed by the server is in the request itself, there is no need to synchronize the state of the heads - each of them can work independently. </li></ul><br><h2>  Gridrouter </h2><br>  We called the <b>server a gridrouter</b> and decided to share its code with everyone.  The server is written in Java using the <a href="http://spring.io/">Spring Framework</a> .  Project sources can be viewed at the <a href="https://github.com/seleniumkit/gridrouter">link</a> .  We also prepared <a href="https://github.com/seleniumkit/gridrouter-deb">Debian packages</a> that install the server. <br><br>  At the moment, the gridrouter is installed as a combat server used by various Yandex teams.  The total number of available browsers in this grid is more than three thousand.  At peak loads, we serve about the same number of user sessions. <br><br><h4>  How to set up a gridrouter </h4><br>  In order to configure the gridouter, you need to set a <b>list of users</b> and <b>quotas</b> for each user.  We did not set a goal to make a super-secure authentication with hash functions and salt, so we use <a href="http://tools.ietf.org/html/rfc2617">basic basic HTTP authentication</a> , and store logins and passwords in clear text in the <b>/etc/grid-router/users.properties</b> text file: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">user</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">password</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> user2:password2, <span class="hljs-keyword"><span class="hljs-keyword">user</span></span></code> </pre><br>  Each line contains the login and password through a colon, as well as the role, which is currently the same, - <b>user</b> .  As for quotas, everything is also very simple.  Each quota is a separate XML file <b>/etc/grid-router/quota/&lt;login&gt;.xml</b> , where <b>&lt;login&gt;</b> is the name of the user.  Inside the file looks like this: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">qa:browsers</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:qa</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"urn:config.gridrouter.qatools.ru"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">browser</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"firefox"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">defaultVersion</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"33.0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">number</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"33.0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">region</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"us-west"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"my-firefox33-host-1.example.com"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">port</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4444"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">count</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">region</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">region</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"us-east"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"my-firefox33-host-2.example.com"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">port</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4444"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">count</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">region</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">number</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"38.0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">region</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"us-west"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"my-firefox38-host-1.example.com"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">port</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4444"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">count</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"my-firefox38-host-2.example.com"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">port</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4444"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">count</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">region</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">region</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"us-east"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"my-firefox38-host-3.example.com"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">port</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4444"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">count</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">region</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">browser</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">browser</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"chrome"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">defaultVersion</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"42.0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">number</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"42.0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">region</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"us-west"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"my-chrome42-host-1.example.com"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">port</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4444"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">count</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">region</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">region</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"us-east"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"my-chrome42-host-2.example.com"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">port</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4444"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">count</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"my-chrome42-host-3.example.com"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">port</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4444"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">count</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"3"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">region</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">browser</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">qa:browsers</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  It can be seen that the names and versions of the available browsers are determined, which should exactly coincide with those indicated on the hubs.  For each browser version, one or several regions are defined, that is, different data centers, each of which contains a host, a port, and the number of available browsers (this is the weight).  The name of the region can be arbitrary.  Information about the regions is needed in cases where one of the data centers becomes unavailable.  In this case, the gridrouter, after one unsuccessful attempt to obtain a browser in a certain region, is trying to get a browser from another region.  Such an algorithm greatly increases the likelihood of a quick browser acquisition. <br><br><h4>  How to run tests </h4><br>  Although we mainly write in Java, we tested our server with Selenium tests in other programming languages.  Usually in tests, the hub URL is indicated something like this: <br><br><pre> <code class="hljs objectivec">http:<span class="hljs-comment"><span class="hljs-comment">//example.com:4444/wd/hub</span></span></code> </pre><br>  Since we use basic HTTP authentication, the following links should be used when working with the gridrouter: <br><br><pre> <code class="hljs objectivec">http:<span class="hljs-comment"><span class="hljs-comment">//username:password@example.com:4444/wd/hub</span></span></code> </pre><br>  If you have any problems with the configuration, please contact us, get an issue on <a href="https://github.com/seleniumkit/gridrouter/issues">Github</a> . <br><br><h4>  Recommendations for configuring hubs and nodes </h4><br>  We conducted experiments with different configurations of hubs and nodes and concluded that from the point of view of ease of operation, reliability and ease of scaling, the following approach is most practical.  Usually they install one hub to which many nodes are connected, because the entry point must be one. <br><br><img src="https://habrastorage.org/files/803/d24/285/803d24285c214cd6a19d6dab81429b95.png"><br><br>  When using the gridrouter, you can install as many hubs as you like, so the easiest way is to configure one hub and several nodes connected to <b>localhost: 4444</b> on one machine.  It is especially convenient to do this if everything is deployed in virtual machines.  For example, we found that the combination of a hub and five nodes is optimal for a virtual machine with two VCPUs and 4 GB of memory.  We install only one browser version per virtual machine, since in this case it is easy to measure memory consumption and convert the number of virtual machines to the number of available browsers. </div><p>Source: <a href="https://habr.com/ru/post/268309/">https://habr.com/ru/post/268309/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../268297/index.html">Export Terrain from WorldMachin to Unity3D</a></li>
<li><a href="../268299/index.html">A series of webinars about the new features of RAD Studio 10 Seattle</a></li>
<li><a href="../268303/index.html">Failures on the Moscow Stock Exchange: Problems and Solutions</a></li>
<li><a href="../268305/index.html">Vulnerability in Platius: access to any account</a></li>
<li><a href="../268307/index.html">Adaptation of complex applications for Material Design: an approach from Aviary</a></li>
<li><a href="../268311/index.html">Flussonic video streamer features review</a></li>
<li><a href="../268313/index.html">Using Remote API in the V-REP Robosimulator</a></li>
<li><a href="../268315/index.html">How to make a fuel plugin (for example, NFS). Part 2</a></li>
<li><a href="../268317/index.html">We invite you to RAD Studio 10 Seattle webinars and slides for performances in Moscow and Almaty</a></li>
<li><a href="../268319/index.html">Two tasks HeadHunter on Data Science Week: try to solve it yourself</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>