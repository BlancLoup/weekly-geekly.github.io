<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Digital elevation model using SRTM data</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When creating a map server, I needed to create high-altitude terrain profiles. I decided to use SRTM (NASA Shuttle Radar Topography Mission) as a data...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Digital elevation model using SRTM data</h1><div class="post__text post__text-html js-mediator-article">  When creating a map server, I needed to create high-altitude terrain profiles.  I decided to use SRTM (NASA Shuttle Radar Topography Mission) as a data for a digital elevation model.  Although there are <a href="http://vterrain.org/Elevation/global.html">alternative data sets</a> , SRTM is the most common and quite satisfied me in accuracy. <a name="habracut"></a>  The data is supplied in several versions - a grid with a cell size of 1 arc-second and 3 arc-seconds.  More accurate one-second data (SRTM1) is available on the territory of the United States, only three-second data (SRTM3) is available on the rest of the earth‚Äôs surface (between 60 degrees north latitude and 54 degrees south latitude).  The files are a matrix of 1201x1201 (or 3601x3601 for the one-second version) values. <br>  For convenient downloading of data from an <a href="http://dds.cr.usgs.gov/srtm/version2_1/SRTM3">official source, a</a> small script is sketched. <div class="spoiler">  <b class="spoiler_title">srtm_download</b> <div class="spoiler_text">  #! / bin / bash <br><br>  usage () { <br>  echo "Usage:" $ 0 "-region -lat_semisphere -lon_semisphere -min_lat -max_lat -min_lon -max_lon" <br>  echo "Region one of: Africa Australia Eurasia Islands North_America South_America" <br>  echo "Example: srtm_download Eurasia NE 43 53 21 142" <br>  exit 1 <br>  } <br><br>  if (("$ #" &lt;7));  then <br>  usage <br>  else <br>  REGION = $ 1 <br>  LATITUDE_SEMISPHERE = $ 2 <br>  LONGITUDE_SEMISPHERE = $ 3 <br>  MIN_LATITUDE = $ 4 <br>  MAX_LATITUDE = $ 5 <br>  MIN_LONGITUDE = $ 6 <br>  MAX_LONGITUDE = $ 7 <br>  SERVER_ADDRESS = " <a href="http://dds.cr.usgs.gov/srtm/version2_1/SRTM3/">dds.cr.usgs.gov/srtm/version2_1/SRTM3</a> $ {REGION}" <br>  mkdir srtm <br>  for i in $ (seq $ MIN_LATITUDE $ MAX_LATITUDE) <br>  do <br>  for j in $ (seq $ MIN_LONGITUDE $ MAX_LONGITUDE) <br>  do <br>  wget -P srtm -nv "$ SERVER_ADDRESS / $ LATITUDE_SEMISPHERE $ i $ LONGITUDE_SEMISPHERE`printf% 03d $ j`" ". hgt.zip" <br>  done <br>  done <br>  fi </div></div><br>  All available files with DEM will be saved in the srtm folder. <br>  The construction of high-altitude profiles was based on the <a href="http://wiki.openstreetmap.org/wiki/Route_altitude_profiles_SRTM">project of the</a> Dutch osm-user <a href="http://wiki.openstreetmap.org/wiki/User:Sjors">Sjors Provoost</a> . <br>  I started with the installation of an osm server tiles.  Under Ubuntu 12.04 there is a convenient and fast <a href="http://wiki.openstreetmap.org/wiki/Ubuntu_tile_server">way to</a> do without manually assembling all the necessary components.  Build under Debian, too, did not cause any problems.  How to do this can be found <a href="http://switch2osm.org/serving-tiles/manually-building-a-tile-server-12-04/">here</a> and <a href="http://habrahabr.ru/post/144675/">here</a> . <br>  PostgreSQL is used to store and work with these sets.  First we need to create a user in PostgreSQL and a database named srtm 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code>sudo -u postgres -i</code> <br> <code>createuser username # answer yes for superuser (although this isn't strictly necessary)</code> <br> <code>createdb -E UTF8 -O username srtm</code> <br> <code>exit</code> <br> <br>  It is convenient to use psycopg2 (PostgreSQL adapter for Python) to create and populate the table, and GDAL library for reading SRTM.  A small python script that needs to be run in the SRTM folder that was previously created and filled with data. <br><div class="spoiler">  <b class="spoiler_title">srtm2pgsql</b> <div class="spoiler_text">  #! / usr / bin / python <br><br>  import pg, psycopg2 <br><br>  from osgeo import gdal, gdal_array <br>  import os <br><br>  import zipfile <br><br>  import re <br>  import sys <br><br>  from math import sqrt <br><br>  def getLatLonFromFileName (name): <br>  # Split up in lat and lon: <br>  p = re.compile ('[NSEW] \ d *') <br>  [lat_str, lon_str] = p.findall (name) <br><br>  # North or south? <br>  if lat_str [0] == "N": <br>  lat = int (lat_str [1:]) <br>  else: <br>  lat = -int (lat_str [1:]) <br><br>  # East or west? <br>  if lon_str [0] == "E": <br>  lon = int (lon_str [1:]) <br>  else: <br>  lon = -int (lon_str [1:]) <br><br>  return [lat, lon] <br><br>  def loadTile (filename): <br>  # Unzip it <br>  zf = zipfile.ZipFile (filename + ".hgt.zip") <br>  for name in zf.namelist (): <br>  outfile = open (name, 'wb') <br>  outfile.write (zf.read (name)) <br>  outfile.flush () <br>  outfile.close () <br><br>  # Read it <br>  srtm = gdal.Open (filename + '.hgt') <br><br>  # Clean up <br>  os.remove (filename + '.hgt') <br><br>  return gdal_array.DatasetReadAsArray (srtm) <br><br>  def posFromLatLon (lat, lon): <br>  return (lat * 360 + lon) * 1200 * 1200 <br><br>  class DatabasePg: <br>  def __init __ (self, db_name, db_user, db_pass): <br>  self.db = pg.DB (dbname = db_name, host = 'localhost', user = db_user, passwd = db_pass) <br><br>  def createTableAltitude (self): <br>  tables = self.db.get_tables () <br><br>  if not ('public.altitude' in tables): <br>  self.db.query ("\ <br>  CREATE TABLE altitude (\ <br>  pos bigint NOT NULL, \ <br>  alt int NULL, \ <br>  PRIMARY KEY (pos) \ <br>  );  \ <br>  ") <br>  return true <br><br>  class DatabasePsycopg2: <br>  def __init __ (self, db_name, db_user, db_pass): <br>  self.db_name = db_name <br><br>  conn = psycopg2.connect ("dbname = '" + db_name + "' host = 'localhost' user = '" + db_user + "' password = '" + db_pass + "'" ") <br>  self.cursor = conn.cursor () <br><br>  def insertTile (self, tile, lat0, lon0): <br>  # I use the Psycopg2 connection, with its copy_to and <br>  # copy_from commands, which use the more efficient COPY command. <br>  # This method requires a temporary file. <br><br>  # Calculate begin position <br>  begin = posFromLatLon (lat0, lon0) <br><br>  # First we write the data into a temporary file. <br>  f = open ('/ tmp / tempcopy', 'w') <br>  # We drop the top row and right column. <br>  for row in range (1, len (tile)): <br>  for col in range (0, len (tile) - 1): <br>  f.write (str (\ <br>  begin + (row-1) * 1200 + col \ <br>  ) + "\ t" + str (tile [row] [col]) + "\ n") <br><br>  f.close () <br><br>  # Now we read the data file. <br>  # altitude table. <br><br>  f = open ('/ tmp / tempcopy', 'r') <br><br>  import subprocess <br>  psqlcmd = "/ usr / bin / psql" <br><br>  p = subprocess.Popen ('psql' + self.db_name + '-c "COPY altitude FROM STDIN;"', stdin = f, shell = True); <br>  p.wait () <br><br>  f.close <br><br>  def main (): <br>  if len (sys.argv)! = 2: <br>  print ‚ÄúError!  \ nUsage: strm2pgsql username " <br>  sys.exit () <br>  else: <br>  db_pg = DatabasePg ('srtm', sys.argv [1], '') <br>  db_psycopg2 = DatabasePsycopg2 ('srtm', sys.argv [1], '') <br><br>  db_pg.createTableAltitude () <br><br>  for file in os.listdir ('.'): <br>  if (re.search ('hgt', file)): <br>  tilename = file.split ('.') [0] <br>  print "Load tile" + tilename + "to srtm database" <br>  [lat, lon] = getLatLonFromFileName (tilename) <br>  tile = loadTile (tilename) <br>  db_psycopg2.insertTile (tile, lat, lon) <br><br>  if __name__ == '__main__': <br>  main () </div></div><br>  I used Qt to create a high profile directly.  Create a connection with the database (you may need a <a href="http://doc.qt.digia.com/stable/sql-driver.html">driver to access the database</a> ) <br><pre> <code class="cpp hljs">db = QSqlDatabase::addDatabase(<span class="hljs-string"><span class="hljs-string">"QPSQL"</span></span>); db.setHostName(<span class="hljs-string"><span class="hljs-string">"localhost"</span></span>); db.setDatabaseName(<span class="hljs-string"><span class="hljs-string">"srtm"</span></span>); db.setUserName(<span class="hljs-string"><span class="hljs-string">"user"</span></span>); db.setPassword(<span class="hljs-string"><span class="hljs-string">"pass"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> ok = db.open();</code> </pre><br>  The route whose high-altitude profile we want to create consists of GeoPoint points that store latitude, longitude and height <br><div class="spoiler">  <b class="spoiler_title">geopoint.h</b> <div class="spoiler_text">  class GeoPoint <br>  { <br>  public: <br>  GeoPoint (); <br>  GeoPoint (double latitude, double longitude, double altitude); <br><br>  double latitude (); <br>  double longitude (); <br>  double altitude (); <br><br>  void setLatitude (double latitude); <br>  void setLongitude (double longitude); <br>  void setAltitude (double altitude); <br><br>  private: <br>  double m_latitude; <br>  double m_longitude; <br>  double m_altitude; <br>  }; </div></div><br>  To obtain the required number of points, you need to interpolate and get a height estimate for each point of the route. <br><pre> <code class="cpp hljs">interpolateRoute(route, numberRoutePoint); foreach (GeoPoint point, route) { point.setAltitude(altitude(db, point.latitude(), point.longitude())); }</code> </pre><br>  For interpolation I find the total length of the route (using the <a href="http://en.wikipedia.org/wiki/Vincenty%27s_formulae">Vincenti's</a> formula) and add the required number of new points to the route. <br><div class="spoiler">  <b class="spoiler_title">Interpolation</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">interpolateRoute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(QVector&lt;GeoPoint&gt; &amp;route, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> number)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     double length = routeLength(route); double minRes = length / number; //        : int i = 0; while (i &lt; route.size() - 1) { QPair&lt;GeoPoint, GeoPoint&gt; pair = qMakePair(route[i], route[i+1]); int number = numberExtraPoints(pair, minRes); addPointsToRoute(route, i, number); i = i + number + 1; } } double routeLength(const QVector&lt;GeoPoint&gt; &amp;route) { double length = 0; Geo geo; for (int i=0; i&lt;route.size() - 1; i++) { GeoPoint origin = route[i]; GeoPoint destination = route[i+1]; length += geo.distance(origin, destination); } return length; } int numberExtraPoints(QPair&lt;GeoPoint, GeoPoint&gt; pair, double minRes) { Geo geo; double length = geo.distance(pair.first, pair.second); return qMax(int(floor(length / minRes) - 1), 0); } void addPointsToRoute(QVector&lt;GeoPoint&gt; &amp;route, int index, int number) { double lat1 = route[index].latitude(); double lat2 = route[index+1].latitude(); double lon1 = route[index].longitude(); double lon2 = route[index+1].longitude(); double latRes = (lat2 - lat1) / number; double lonRes = (lon2 - lon1) / number; for (int i=0; i&lt;number; i++) { lat1 += latRes; lon1 += lonRes; GeoPoint point(lat1, lon1, 0); route.insert(index + i, point); } } float WGS84MajorAxis = 6378.137; // km float WGS84MinorAxis = 6356.7523142; // km float WGS84Flattering = 1 / 298.257223563; double distance(GeoPoint origin, GeoPoint destination) { double lat1 = origin.latitude(); double lat2 = destination.latitude(); double lng1 = origin.longitude(); double lng2 = destination.longitude(); double major = WGS84MajorAxis; double minor = WGS84MinorAxis; double f = WGS84Flattering; double deltaLng = lng2 - lng1; double reducedLat1 = atan((1 - f) * tan(lat1)); double reducedLat2 = atan((1 - f) * tan(lat2)); double sinReduced1 = sin(reducedLat1); double sinReduced2 = sin(reducedLat2); double cosReduced1 = cos(reducedLat1); double cosReduced2 = cos(reducedLat2); double lambdaLng = deltaLng; double lambdaPrime = 2 * M_PI; double iterLimit = 20; double sinSigma = 0; double cosSigma = 0; double cos2SigmaM = 0; double sigma = 0; double cosSqAlpha = 0; while ((abs(lambdaLng - lambdaPrime) &gt; 10e-12) &amp;&amp; (iterLimit &gt; 0)) { double sinLambdaLng = sin(lambdaLng); double cosLambdaLng = cos(lambdaLng); sinSigma = sqrt((cosReduced2*sinLambdaLng) * (cosReduced2*sinLambdaLng) + (cosReduced1*sinReduced2 - sinReduced1*cosReduced2*cosLambdaLng) * (cosReduced1*sinReduced2 - sinReduced1*cosReduced2*cosLambdaLng)); if (sinSigma == 0) return 0; //   cosSigma = sinReduced1*sinReduced2 + cosReduced1*cosReduced2*cosLambdaLng; sigma = atan2(sinSigma, cosSigma); double sinAlpha = cosReduced1*cosReduced2*sinLambdaLng/sinSigma; cosSqAlpha = 1 - sinAlpha*sinAlpha; cos2SigmaM = 0.; //   if (cosSqAlpha != 0) { cos2SigmaM = cosSigma - 2*(sinReduced1*sinReduced2/cosSqAlpha); } double C = f / 16. * cosSqAlpha * (4 + f * (4 - 3 * cosSqAlpha)); lambdaPrime = lambdaLng; lambdaLng = (deltaLng + (1 - C)*f*sinAlpha*(sigma + C * sinSigma * (cos2SigmaM + C * cosSigma *(-1 + 2*cos2SigmaM*cos2SigmaM)))); --iterLimit; } if (iterLimit == 0) { return 0; log-&gt;info() &lt;&lt; "Geo, calculate distance: Vincenty formula failed to converge!"; } double uSq = cosSqAlpha * (major*major - minor*minor) / (minor*minor); double A = 1 + uSq / 16384. * (4096 + uSq * (-768 + uSq *(320 - 175 * uSq))); double B = uSq / 1024. * (256 + uSq * (-128 + uSq * (74 - 47 * uSq))); double deltaSigma = (B * sinSigma *(cos2SigmaM + B / 4. *(cosSigma * (-1 + 2 * cos2SigmaM*cos2SigmaM) - B / 6. * cos2SigmaM * (-3 + 4 * sinSigma*sinSigma)*(-3 + 4 * cos2SigmaM*cos2SigmaM)))); return minor * A * (sigma - deltaSigma); }</span></span></code> </pre><br></div></div><br>  To obtain an estimate of the height of each point of the route, we find the four nearest points in the database and perform <a href="http://ru.wikipedia.org/wiki/%25D0%2591%25D0%25B8%25D0%25BB%25D0%25B8%25D0%25BD%25D0%25B5%25D0%25B9%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25B8%25D0%25BD%25D1%2582%25D0%25B5%25D1%2580%25D0%25BF%25D0%25BE%25D0%25BB%25D1%258F%25D1%2586%25D0%25B8%25D1%258F">bilinear interpolation</a> <br><div class="spoiler">  <b class="spoiler_title">Height estimate</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">altitude</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PostgreSqlDatabase db, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> latitude, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> longitude)</span></span></span><span class="hljs-function"> </span></span>{ qulonglong tl, tr, bl, br; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> a, b; posFromLatLon(latitude, longitude, tl, tr, bl, br, a, b); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> atl = db.fetchAltitude(tl); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> atr = db.fetchAltitude(tr); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> abl = db.fetchAltitude(bl); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> abr = db.fetchAltitude(br); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bilinearInterpolation(atl, atr, abl, abr, a, b); } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> PostgreSqlDatabase::fetchAltitude(qulonglong pos) { QSqlQuery query; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (query.exec(<span class="hljs-string"><span class="hljs-string">"SELECT * FROM altitude WHERE pos = "</span></span> + QString::number(pos))) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (query.next()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> query.value(<span class="hljs-number"><span class="hljs-number">1</span></span>).toInt(); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Geo::undefinedAltitude; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">posFromLatLon</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;latitude, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;longitude, qulonglong &amp;tl, qulonglong &amp;tr, qulonglong &amp;bl, qulonglong &amp;br, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;b)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> lat0 = <span class="hljs-built_in"><span class="hljs-built_in">floor</span></span>(latitude); <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> lon0 = <span class="hljs-built_in"><span class="hljs-built_in">floor</span></span>(longitude); qulonglong pos0 = (lat0*<span class="hljs-number"><span class="hljs-number">360</span></span> + lon0) * <span class="hljs-number"><span class="hljs-number">1200</span></span>*<span class="hljs-number"><span class="hljs-number">1200</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> latPos = (<span class="hljs-number"><span class="hljs-number">1199.</span></span>/<span class="hljs-number"><span class="hljs-number">1200</span></span> - (latitude - lat0)) * <span class="hljs-number"><span class="hljs-number">1200</span></span>*<span class="hljs-number"><span class="hljs-number">1200</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> lonPos = (longitude - lon0) * <span class="hljs-number"><span class="hljs-number">1200</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> latPosTop = <span class="hljs-built_in"><span class="hljs-built_in">floor</span></span>(latPos / <span class="hljs-number"><span class="hljs-number">1200</span></span>) * <span class="hljs-number"><span class="hljs-number">1200</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> latPosBottom = <span class="hljs-built_in"><span class="hljs-built_in">ceil</span></span>(latPos / <span class="hljs-number"><span class="hljs-number">1200</span></span>) * <span class="hljs-number"><span class="hljs-number">1200</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> lonPosLeft = <span class="hljs-built_in"><span class="hljs-built_in">floor</span></span>(lonPos); <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> lonPosRight = <span class="hljs-built_in"><span class="hljs-built_in">ceil</span></span>(lonPos); a = (latPos - latPosTop) / <span class="hljs-number"><span class="hljs-number">1200</span></span>; b = (lonPos - lonPosLeft); tl = qulonglong(pos0 + latPosTop + lonPosLeft); tr = qulonglong(pos0 + latPosTop + lonPosRight); bl = qulonglong(pos0 + latPosBottom + lonPosLeft); br = qulonglong(pos0 + latPosBottom + lonPosRight); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bilinearInterpolation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;tl, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;tr, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;bl, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;br, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;b)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> b1 = tl; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> b2 = bl - tl; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> b3 = tr - tl; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> b4 = tl - bl - tr + br; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> b1 + b2*a + b3*b + b4*a*b; }</code> </pre></div></div><br><br>  Thus at the exit we will have a set of route points with an estimate of their height. <br>  If the topic of using STRM data is interesting to the community, in the next article I can share with you how I made a color relief substrate for use with osm data. </div><p>Source: <a href="https://habr.com/ru/post/161201/">https://habr.com/ru/post/161201/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../161181/index.html">Yii 1.1.13 RC</a></li>
<li><a href="../161183/index.html">Sales of iPhone 5 in Russia will begin on December 14</a></li>
<li><a href="../161185/index.html">Course lectures "Startup". Peter Thiel. Stanford 2012. Session 8</a></li>
<li><a href="../161195/index.html">Simplest triangulation in java</a></li>
<li><a href="../161197/index.html">Site conversion. Turn visitors into buyers</a></li>
<li><a href="../161203/index.html">MSP430 Launchpad as a signaling of the state of server hardware</a></li>
<li><a href="../161205/index.html">Likbez on typing in programming languages</a></li>
<li><a href="../161207/index.html">Building a social network graph using Drupal and Feeds</a></li>
<li><a href="../161209/index.html">Quantitative assessment of the clarity of the code</a></li>
<li><a href="../161213/index.html">Notes after meeting with Sergey Belousov</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>