<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Basics of Elasticsearch</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Elasticsearch is a search engine with json rest api using Lucene and written in Java. Description of all the advantages of this engine is available on...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Basics of Elasticsearch</h1><div class="post__text post__text-html js-mediator-article"><p>  Elasticsearch is a search engine with json rest api using Lucene and written in Java.  Description of all the advantages of this engine is available on the <a href="https://www.elastic.co/products/elasticsearch">official website</a> .  Further in the text we will call Elasticsearch as ES. </p><br><p>  Similar engines are used for complex search in the database of documents.  For example, search taking into account the morphology of the language or search by geo coordinates. </p><br><p>  In this article I will talk about the basics of ES on the example of indexing blog posts.  I will show you how to filter, sort and search for documents. </p><a name="habracut"></a><br><p>  In order not to depend on the operating system, I will do all requests to ES using CURL.  There is also a plugin for google chrome called <a href="https://chrome.google.com/webstore/detail/sense-beta/lhjgkmllcaadmopgmanpapmpjgmfcfig%3Fhl%3Dru">sense</a> . </p><br><p>  The text links to documentation and other sources.  At the end there are links for quick access to the documentation.  Definitions of unfamiliar terms can be found in the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/glossary.html">glossary</a> . <br></p><br><h1>  ES installation </h1><br><p>  To do this, we first need Java.  Developers <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/setup.html">recommend</a> installing Java versions newer than Java 8 update 20 or Java 7 update 55. </p><br><p> The ES distribution is available on <a href="https://www.elastic.co/downloads/elasticsearch">the developer‚Äôs website</a> .  After unpacking the archive, you need to run <code>bin/elasticsearch</code> .  <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/setup-repositories.html">Packages for apt and yum</a> are also available.  There is an <a href="https://hub.docker.com/_/elasticsearch/">official image for docker</a> .  <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/_installation.html">Read more about installation</a> . </p><br><p>  After installation and launch we will check the performance: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#       #export ES_URL=$(docker-machine ip dev):9200 export ES_URL=localhost:9200 curl -X GET $ES_URL</span></span></code> </pre> <br><p>  We will receive approximately the following answer: </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"Heimdall"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"cluster_name"</span></span> : <span class="hljs-string"><span class="hljs-string">"elasticsearch"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span> : { <span class="hljs-attr"><span class="hljs-attr">"number"</span></span> : <span class="hljs-string"><span class="hljs-string">"2.2.1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"build_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"d045fc29d1932bce18b2e65ab8b297fbf6cd41a1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"build_timestamp"</span></span> : <span class="hljs-string"><span class="hljs-string">"2016-03-09T09:38:54Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"build_snapshot"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"lucene_version"</span></span> : <span class="hljs-string"><span class="hljs-string">"5.4.1"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"tagline"</span></span> : <span class="hljs-string"><span class="hljs-string">"You Know, for Search"</span></span> }</code> </pre> <br><h1>  Indexing </h1><br><p>  Add a post to ES: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   c id 1  post   blog. # ?pretty ,     -. curl -XPUT "$ES_URL/blog/post/1?pretty" -d' { "title": " ", "content": "&lt;p&gt;   &lt;p&gt;", "tags": [ "", " " ], "published_at": "2014-09-12T20:44:42+00:00" }'</span></span></code> </pre><br><p>  server response: </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"_index"</span></span> : <span class="hljs-string"><span class="hljs-string">"blog"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_type"</span></span> : <span class="hljs-string"><span class="hljs-string">"post"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_id"</span></span> : <span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_version"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_shards"</span></span> : { <span class="hljs-attr"><span class="hljs-attr">"total"</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">"successful"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"failed"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"created"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span> }</code> </pre><br><p>  ES automatically created blog <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/glossary.html">index</a> and post <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/glossary.html">type</a> .  You can make a conditional analogy: an index is a database, and a type is a table in this database.  Each type has its own <a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/glossary.html">mapping</a> scheme, as well as a relational table.  Mapping is generated automatically when the document is indexed: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  mapping    blog curl -XGET "$ES_URL/blog/_mapping?pretty"</span></span></code> </pre> <br><p>  In the server's response, I added in the comments the field values ‚Äã‚Äãof the indexed document: </p><br><pre> <code class="hljs erlang-repl">{ <span class="hljs-string"><span class="hljs-string">"blog"</span></span> : { <span class="hljs-string"><span class="hljs-string">"mappings"</span></span> : { <span class="hljs-string"><span class="hljs-string">"post"</span></span> : { <span class="hljs-string"><span class="hljs-string">"properties"</span></span> : { /* <span class="hljs-string"><span class="hljs-string">"content"</span></span>: <span class="hljs-string"><span class="hljs-string">"&lt;p&gt;   &lt;p&gt;"</span></span>, */ <span class="hljs-string"><span class="hljs-string">"content"</span></span> : { <span class="hljs-string"><span class="hljs-string">"type"</span></span> : <span class="hljs-string"><span class="hljs-string">"string"</span></span> }, /* <span class="hljs-string"><span class="hljs-string">"published_at"</span></span>: <span class="hljs-string"><span class="hljs-string">"2014-09-12T20:44:42+00:00"</span></span> */ <span class="hljs-string"><span class="hljs-string">"published_at"</span></span> : { <span class="hljs-string"><span class="hljs-string">"type"</span></span> : <span class="hljs-string"><span class="hljs-string">"date"</span></span>, <span class="hljs-string"><span class="hljs-string">"format"</span></span> : <span class="hljs-string"><span class="hljs-string">"strict_date_optional_time||epoch_millis"</span></span> }, /* <span class="hljs-string"><span class="hljs-string">"tags"</span></span>: [<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>] */ <span class="hljs-string"><span class="hljs-string">"tags"</span></span> : { <span class="hljs-string"><span class="hljs-string">"type"</span></span> : <span class="hljs-string"><span class="hljs-string">"string"</span></span> }, /* <span class="hljs-string"><span class="hljs-string">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">" "</span></span> */ <span class="hljs-string"><span class="hljs-string">"title"</span></span> : { <span class="hljs-string"><span class="hljs-string">"type"</span></span> : <span class="hljs-string"><span class="hljs-string">"string"</span></span> } } } } } }</code> </pre> <br><p>  It is worth noting that ES does not distinguish between a single value and an array of values.  For example, the title field contains just a title, and the tags field contains an array of strings, although they are represented equally in the mapping. <br>  We'll talk more about mapping later. <br></p><br><h1>  Requests </h1><br><h2>  Extract a document by its id: </h2><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#    id 1  post   blog curl -XGET "$ES_URL/blog/post/1?pretty"</span></span></code> </pre> <br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"_index"</span></span> : <span class="hljs-string"><span class="hljs-string">"blog"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_type"</span></span> : <span class="hljs-string"><span class="hljs-string">"post"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_id"</span></span> : <span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_version"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"found"</span></span> : <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_source"</span></span> : { <span class="hljs-attr"><span class="hljs-attr">"title"</span></span> : <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"content"</span></span> : <span class="hljs-string"><span class="hljs-string">"&lt;p&gt;   &lt;p&gt;"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"tags"</span></span> : [ <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"published_at"</span></span> : <span class="hljs-string"><span class="hljs-string">"2014-09-12T20:44:42+00:00"</span></span> } }</code> </pre> <br><p>  New keys appeared in the answer: <code>_version</code> and <code>_source</code> .  In general, all keys starting with <code>_</code> are service. </p><br><p>  The <code>_version</code> key shows the document version.  It is needed for the operation of the mechanism of optimistic locks.  For example, we want to change a document that has version 1. We send a modified document and indicate that it is editing a document with version 1. If someone else also edited a document with version 1 and sent the changes before us, then ES will not accept our changes, because  it stores a document with version 2. </p><br><p>  The <code>_source</code> key contains the document we indexed.  ES does not use this value for search operations, because  indexes are used for the search.  To save space, ES stores a compressed source document.  If we need only an id, and not the entire source document, then we can disable storage of the source. </p><br><p>  If we do not need additional information, you can only get the content of _source: </p><br><pre> <code class="bash hljs">curl -XGET <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ES_URL</span></span></span><span class="hljs-string">/blog/post/1/_source?pretty"</span></span></code> </pre> <br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"title"</span></span> : <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"content"</span></span> : <span class="hljs-string"><span class="hljs-string">"&lt;p&gt;   &lt;p&gt;"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"tags"</span></span> : [ <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"published_at"</span></span> : <span class="hljs-string"><span class="hljs-string">"2014-09-12T20:44:42+00:00"</span></span> }</code> </pre><br><p>  You can also select only specific fields: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#    title curl -XGET "$ES_URL/blog/post/1?_source=title&amp;pretty"</span></span></code> </pre> <br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"_index"</span></span> : <span class="hljs-string"><span class="hljs-string">"blog"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_type"</span></span> : <span class="hljs-string"><span class="hljs-string">"post"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_id"</span></span> : <span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_version"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"found"</span></span> : <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_source"</span></span> : { <span class="hljs-attr"><span class="hljs-attr">"title"</span></span> : <span class="hljs-string"><span class="hljs-string">" "</span></span> } }</code> </pre> <br><p>  Let's index some more posts and execute more complex queries. </p><br><pre> <code class="bash hljs">curl -XPUT <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ES_URL</span></span></span><span class="hljs-string">/blog/post/2"</span></span> -d<span class="hljs-string"><span class="hljs-string">' { "title": " ", "content": "&lt;p&gt;   &lt;p&gt;", "tags": [ "", " " ], "published_at": "2014-08-12T20:44:42+00:00" }'</span></span></code> </pre> <br><pre> <code class="bash hljs">curl -XPUT <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ES_URL</span></span></span><span class="hljs-string">/blog/post/3"</span></span> -d<span class="hljs-string"><span class="hljs-string">' { "title": "    ", "content": "&lt;p&gt;      &lt;p&gt;", "tags": [ "" ], "published_at": "2014-07-21T20:44:42+00:00" }'</span></span></code> </pre> <br><h2>  Sorting </h2><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#          title  published_at curl -XGET "$ES_URL/blog/post/_search?pretty" -d' { "size": 1, "_source": ["title", "published_at"], "sort": [{"published_at": "desc"}] }'</span></span></code> </pre> <br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"took"</span></span> : <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-attr"><span class="hljs-attr">"timed_out"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_shards"</span></span> : { <span class="hljs-attr"><span class="hljs-attr">"total"</span></span> : <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-attr"><span class="hljs-attr">"successful"</span></span> : <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-attr"><span class="hljs-attr">"failed"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"hits"</span></span> : { <span class="hljs-attr"><span class="hljs-attr">"total"</span></span> : <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"max_score"</span></span> : <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">"hits"</span></span> : [ { <span class="hljs-attr"><span class="hljs-attr">"_index"</span></span> : <span class="hljs-string"><span class="hljs-string">"blog"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_type"</span></span> : <span class="hljs-string"><span class="hljs-string">"post"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_id"</span></span> : <span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_score"</span></span> : <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_source"</span></span> : { <span class="hljs-attr"><span class="hljs-attr">"title"</span></span> : <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"published_at"</span></span> : <span class="hljs-string"><span class="hljs-string">"2014-09-12T20:44:42+00:00"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"sort"</span></span> : [ <span class="hljs-number"><span class="hljs-number">1410554682000</span></span> ] } ] } }</code> </pre> <br><p>  We chose the last post.  <code>size</code> limits the number of documents in the issue.  <code>total</code> shows the total number of documents matching the request.  <code>sort</code> in output contains an array of integers by which sorting is performed.  Those.  The date is converted to an integer.  More information about sorting can be found in the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-sort.html">documentation</a> . <br></p><br><h2>  Filters and queries </h2><br><p>  ES since version 2 does not distinguish between filters and queries, instead the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-filter-context.html">concept of contexts is introduced</a> . <br>  The context of the request differs from the context of the filter in that the request generates _score and is not cached.  What is _score I will show later. <br></p><br><h2>  Filter by date </h2><br><p>  Use the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-range-query.html">range</a> request in the context of filter: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  ,  1    curl -XGET "$ES_URL/blog/post/_search?pretty" -d' { "filter": { "range": { "published_at": { "gte": "2014-09-01" } } } }'</span></span></code> </pre> <br><h2>  Tag filtering </h2><br><p>  Use the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-term-query.html">term query</a> to find the id of the documents containing the specified word: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   ,   tags    '' curl -XGET "$ES_URL/blog/post/_search?pretty" -d' { "_source": [ "title", "tags" ], "filter": { "term": { "tags": "" } } }'</span></span></code> </pre> <br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"took"</span></span> : <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-attr"><span class="hljs-attr">"timed_out"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_shards"</span></span> : { <span class="hljs-attr"><span class="hljs-attr">"total"</span></span> : <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-attr"><span class="hljs-attr">"successful"</span></span> : <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-attr"><span class="hljs-attr">"failed"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"hits"</span></span> : { <span class="hljs-attr"><span class="hljs-attr">"total"</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">"max_score"</span></span> : <span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"hits"</span></span> : [ { <span class="hljs-attr"><span class="hljs-attr">"_index"</span></span> : <span class="hljs-string"><span class="hljs-string">"blog"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_type"</span></span> : <span class="hljs-string"><span class="hljs-string">"post"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_id"</span></span> : <span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_score"</span></span> : <span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_source"</span></span> : { <span class="hljs-attr"><span class="hljs-attr">"title"</span></span> : <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"tags"</span></span> : [ <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span> ] } }, { <span class="hljs-attr"><span class="hljs-attr">"_index"</span></span> : <span class="hljs-string"><span class="hljs-string">"blog"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_type"</span></span> : <span class="hljs-string"><span class="hljs-string">"post"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_id"</span></span> : <span class="hljs-string"><span class="hljs-string">"3"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_score"</span></span> : <span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_source"</span></span> : { <span class="hljs-attr"><span class="hljs-attr">"title"</span></span> : <span class="hljs-string"><span class="hljs-string">"    "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"tags"</span></span> : [ <span class="hljs-string"><span class="hljs-string">""</span></span> ] } } ] } }</code> </pre> <br><h2>  Full text search </h2><br><p>  Our three documents contain the following in the content field: </p><br><ul><li> <code>&lt;p&gt;   &lt;p&gt;</code> </li> <li> <code>&lt;p&gt;   &lt;p&gt;</code> </li> <li> <code>&lt;p&gt;      &lt;p&gt;</code> </li> </ul><br><p>  Use <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query.html">match query</a> to find the id of documents containing the given word: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># source: false ,     _source   curl -XGET "$ES_URL/blog/post/_search?pretty" -d' { "_source": false, "query": { "match": { "content": "" } } }'</span></span></code> </pre> <br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"took"</span></span> : <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-attr"><span class="hljs-attr">"timed_out"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_shards"</span></span> : { <span class="hljs-attr"><span class="hljs-attr">"total"</span></span> : <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-attr"><span class="hljs-attr">"successful"</span></span> : <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-attr"><span class="hljs-attr">"failed"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"hits"</span></span> : { <span class="hljs-attr"><span class="hljs-attr">"total"</span></span> : <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"max_score"</span></span> : <span class="hljs-number"><span class="hljs-number">0.11506981</span></span>, <span class="hljs-attr"><span class="hljs-attr">"hits"</span></span> : [ { <span class="hljs-attr"><span class="hljs-attr">"_index"</span></span> : <span class="hljs-string"><span class="hljs-string">"blog"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_type"</span></span> : <span class="hljs-string"><span class="hljs-string">"post"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_id"</span></span> : <span class="hljs-string"><span class="hljs-string">"2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_score"</span></span> : <span class="hljs-number"><span class="hljs-number">0.11506981</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"_index"</span></span> : <span class="hljs-string"><span class="hljs-string">"blog"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_type"</span></span> : <span class="hljs-string"><span class="hljs-string">"post"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_id"</span></span> : <span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_score"</span></span> : <span class="hljs-number"><span class="hljs-number">0.11506981</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"_index"</span></span> : <span class="hljs-string"><span class="hljs-string">"blog"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_type"</span></span> : <span class="hljs-string"><span class="hljs-string">"post"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_id"</span></span> : <span class="hljs-string"><span class="hljs-string">"3"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_score"</span></span> : <span class="hljs-number"><span class="hljs-number">0.095891505</span></span> } ] } }</code> </pre> <br><p>  However, if you search for "stories" in the content field, then we will not find anything, because  The index contains only original words, not their bases.  In order to make a quality search, you need to configure the analyzer. </p><br><p>  The <code>_score</code> field shows <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/relevance-intro.html">relevancy</a> .  If the request is executed in the filter context, then the value of _score will always be 1, which means full compliance with the filter. <br></p><br><h1>  Analyzers </h1><br><p>  <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis.html">Analyzers</a> are needed to convert the source code into a set of tokens. <br>  Analyzers consist of one <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-tokenizers.html">Tokenizer</a> and several optional <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-tokenfilters.html">TokenFilters</a> .  Tokenizer may precede multiple <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-charfilters.html">CharFilters</a> .  Tokenizer breaks the source string into tokens, for example, by spaces and punctuation.  TokenFilter can change tokens, delete or add new ones, for example, leave only the stem of a word, remove prepositions, add synonyms.  CharFilter - changes the source string entirely, for example, cuts html tags. </p><br><p>  There are several <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-analyzers.html">standard analyzers</a> in ES.  For example, the analyzer <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-lang-analyzer.html">russian</a> . </p><br><p>  Let's use <a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/indices-analyze.html">api</a> and see how standard and russian analyzers transform the string "Funny stories about kittens": </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   standard #     ASCII  curl -XGET "$ES_URL/_analyze?pretty&amp;analyzer=standard&amp;text=%D0%92%D0%B5%D1%81%D0%B5%D0%BB%D1%8B%D0%B5%20%D0%B8%D1%81%D1%82%D0%BE%D1%80%D0%B8%D0%B8%20%D0%BF%D1%80%D0%BE%20%D0%BA%D0%BE%D1%82%D1%8F%D1%82"</span></span></code> </pre> <br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"tokens"</span></span> : [ { <span class="hljs-attr"><span class="hljs-attr">"token"</span></span> : <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"start_offset"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"end_offset"</span></span> : <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span> : <span class="hljs-string"><span class="hljs-string">"&lt;ALPHANUM&gt;"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"position"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"token"</span></span> : <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"start_offset"</span></span> : <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-attr"><span class="hljs-attr">"end_offset"</span></span> : <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span> : <span class="hljs-string"><span class="hljs-string">"&lt;ALPHANUM&gt;"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"position"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"token"</span></span> : <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"start_offset"</span></span> : <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-attr"><span class="hljs-attr">"end_offset"</span></span> : <span class="hljs-number"><span class="hljs-number">19</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span> : <span class="hljs-string"><span class="hljs-string">"&lt;ALPHANUM&gt;"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"position"</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"token"</span></span> : <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"start_offset"</span></span> : <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-attr"><span class="hljs-attr">"end_offset"</span></span> : <span class="hljs-number"><span class="hljs-number">25</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span> : <span class="hljs-string"><span class="hljs-string">"&lt;ALPHANUM&gt;"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"position"</span></span> : <span class="hljs-number"><span class="hljs-number">3</span></span> } ] }</code> </pre> <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   russian curl -XGET "$ES_URL/_analyze?pretty&amp;analyzer=russian&amp;text=%D0%92%D0%B5%D1%81%D0%B5%D0%BB%D1%8B%D0%B5%20%D0%B8%D1%81%D1%82%D0%BE%D1%80%D0%B8%D0%B8%20%D0%BF%D1%80%D0%BE%20%D0%BA%D0%BE%D1%82%D1%8F%D1%82"</span></span></code> </pre> <br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"tokens"</span></span> : [ { <span class="hljs-attr"><span class="hljs-attr">"token"</span></span> : <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"start_offset"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"end_offset"</span></span> : <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span> : <span class="hljs-string"><span class="hljs-string">"&lt;ALPHANUM&gt;"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"position"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"token"</span></span> : <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"start_offset"</span></span> : <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-attr"><span class="hljs-attr">"end_offset"</span></span> : <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span> : <span class="hljs-string"><span class="hljs-string">"&lt;ALPHANUM&gt;"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"position"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"token"</span></span> : <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"start_offset"</span></span> : <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-attr"><span class="hljs-attr">"end_offset"</span></span> : <span class="hljs-number"><span class="hljs-number">25</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span> : <span class="hljs-string"><span class="hljs-string">"&lt;ALPHANUM&gt;"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"position"</span></span> : <span class="hljs-number"><span class="hljs-number">3</span></span> } ] }</code> </pre> <br><p>  The standard analyzer broke the line in spaces and translated everything into lower case, the Russian analyzer removed not meaningful words, translated it into lower case and left the basis of words. </p><br><p>  Let's see which Tokenizer, TokenFilters, CharFilters uses the russian analyzer: </p><br><pre> <code class="hljs objectivec">{ <span class="hljs-string"><span class="hljs-string">"filter"</span></span>: { <span class="hljs-string"><span class="hljs-string">"russian_stop"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"stop"</span></span>, <span class="hljs-string"><span class="hljs-string">"stopwords"</span></span>: <span class="hljs-string"><span class="hljs-string">"_russian_"</span></span> }, <span class="hljs-string"><span class="hljs-string">"russian_keywords"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"keyword_marker"</span></span>, <span class="hljs-string"><span class="hljs-string">"keywords"</span></span>: [] }, <span class="hljs-string"><span class="hljs-string">"russian_stemmer"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"stemmer"</span></span>, <span class="hljs-string"><span class="hljs-string">"language"</span></span>: <span class="hljs-string"><span class="hljs-string">"russian"</span></span> } }, <span class="hljs-string"><span class="hljs-string">"analyzer"</span></span>: { <span class="hljs-string"><span class="hljs-string">"russian"</span></span>: { <span class="hljs-string"><span class="hljs-string">"tokenizer"</span></span>: <span class="hljs-string"><span class="hljs-string">"standard"</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* TokenFilters */</span></span> <span class="hljs-string"><span class="hljs-string">"filter"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"lowercase"</span></span>, <span class="hljs-string"><span class="hljs-string">"russian_stop"</span></span>, <span class="hljs-string"><span class="hljs-string">"russian_keywords"</span></span>, <span class="hljs-string"><span class="hljs-string">"russian_stemmer"</span></span> ] <span class="hljs-comment"><span class="hljs-comment">/* CharFilters  */</span></span> } } }</code> </pre> <br><p>  We describe our analyzer based on russian, which will cut html tags.  Let's call it default, because  the analyzer with this name will be used by default. </p><br><pre> <code class="hljs objectivec">{ <span class="hljs-string"><span class="hljs-string">"filter"</span></span>: { <span class="hljs-string"><span class="hljs-string">"ru_stop"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"stop"</span></span>, <span class="hljs-string"><span class="hljs-string">"stopwords"</span></span>: <span class="hljs-string"><span class="hljs-string">"_russian_"</span></span> }, <span class="hljs-string"><span class="hljs-string">"ru_stemmer"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"stemmer"</span></span>, <span class="hljs-string"><span class="hljs-string">"language"</span></span>: <span class="hljs-string"><span class="hljs-string">"russian"</span></span> } }, <span class="hljs-string"><span class="hljs-string">"analyzer"</span></span>: { <span class="hljs-string"><span class="hljs-string">"default"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">/*   html  */</span></span> <span class="hljs-string"><span class="hljs-string">"char_filter"</span></span>: [<span class="hljs-string"><span class="hljs-string">"html_strip"</span></span>], <span class="hljs-string"><span class="hljs-string">"tokenizer"</span></span>: <span class="hljs-string"><span class="hljs-string">"standard"</span></span>, <span class="hljs-string"><span class="hljs-string">"filter"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"lowercase"</span></span>, <span class="hljs-string"><span class="hljs-string">"ru_stop"</span></span>, <span class="hljs-string"><span class="hljs-string">"ru_stemmer"</span></span> ] } } }</code> </pre> <br><p>  First, all html tags will be deleted from the source line, then it will be broken into tokens standard tokens, the received tokens will go to lower case, insignificant words will be removed and the remaining tokens will remain the basis of the word. <br></p><br><h1>  Create index </h1><br><p>  Above, we described the default analyzer.  It will apply to all string fields.  Our post contains an array of tags, respectively, the tags will also be processed by the analyzer.  Since  we are looking for posts for exact matching the tag, it is necessary to disable the analysis for the tags field. </p><br><p>  Create a blog2 index with an analyzer and a mapping in which the analysis of the tags field is disabled: </p><br><pre> <code class="bash hljs">curl -XPOST <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ES_URL</span></span></span><span class="hljs-string">/blog2"</span></span> -d<span class="hljs-string"><span class="hljs-string">' { "settings": { "analysis": { "filter": { "ru_stop": { "type": "stop", "stopwords": "_russian_" }, "ru_stemmer": { "type": "stemmer", "language": "russian" } }, "analyzer": { "default": { "char_filter": [ "html_strip" ], "tokenizer": "standard", "filter": [ "lowercase", "ru_stop", "ru_stemmer" ] } } } }, "mappings": { "post": { "properties": { "content": { "type": "string" }, "published_at": { "type": "date" }, "tags": { "type": "string", "index": "not_analyzed" }, "title": { "type": "string" } } } } }'</span></span></code> </pre> <br><p>  Add the same 3 posts to this index (blog2).  I will omit this process because  it is similar to adding documents to the blog index. <br></p><br><h1>  Full-text search with expressions support </h1><br><p>  Let's get acquainted with another type of query: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  ,     '' # query -&gt; simple_query_string -&gt; query    #  title   3 #  tags   2 #  content   1 #      curl -XPOST "$ES_URL/blog2/post/_search?pretty" -d' { "query": { "simple_query_string": { "query": "", "fields": [ "title^3", "tags^2", "content" ] } } }'</span></span></code> </pre> <br><p>  Since  we use an analyzer with Russian stemming, then this query will return all documents, although they only contain the word 'history'. </p><br><p>  The request may contain special characters, for example: </p><br><pre> <code class="hljs pgsql">"\"fried eggs\" +(eggplant | potato) -frittata"</code> </pre> <br><p>  Query syntax: </p><br><pre> <code class="hljs smalltalk">+ signifies <span class="hljs-type"><span class="hljs-type">AND</span></span> operation | signifies <span class="hljs-type"><span class="hljs-type">OR</span></span> operation - negates a single token <span class="hljs-comment"><span class="hljs-comment">" wraps a number of tokens to signify a phrase for searching * at the end of a term signifies a prefix query ( and ) signify precedence ~N after a word signifies edit distance (fuzziness) ~N after a phrase signifies slop amount</span></span></code> </pre> <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#     '' curl -XPOST "$ES_URL/blog2/post/_search?pretty" -d' { "query": { "simple_query_string": { "query": "-", "fields": [ "title^3", "tags^2", "content" ] } } }' #  2   </span></span></code> </pre> <br><h1>  Links </h1><br><ul><li>  <a href="https://www.elastic.co/">Elasctic.co</a> </li><li>  <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html">Reference</a> </li><li>  <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/index.html">Guide</a> </li><li>  <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/glossary.html">Glossary</a> </li><li>  <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/_installation.html">Installation</a> </li><li>  <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docs.html">Manipulations with documents</a> </li><li>  <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices.html">Index operations</a> </li><li>  <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html">Request list</a> <br></li></ul><br><h1>  PS </h1><br><p>  If such articles are interesting, there are ideas for new articles or there are proposals for cooperation, I will be glad to post in PM or email m.kuzmin+habr@darkleaf.ru. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/280488/">https://habr.com/ru/post/280488/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../280474/index.html">Glitter and poverty Big Data</a></li>
<li><a href="../280476/index.html">Automation of paperwork</a></li>
<li><a href="../280480/index.html">Birth Chargeback</a></li>
<li><a href="../280482/index.html">Tips for writing libraries on Rust</a></li>
<li><a href="../280486/index.html">Math on the fingers: arduino of the brain or linear-quadratic regulator to control the electric motor</a></li>
<li><a href="../280490/index.html">Google Analytics in Telegram</a></li>
<li><a href="../280492/index.html">Xubuntu: I propose to vote for the inclusion of a dark visual theme in the distribution</a></li>
<li><a href="../280494/index.html">Cloud Digest # 3: Data Storage, Security and WordPress</a></li>
<li><a href="../280496/index.html">As I wrote skad. Part Seven</a></li>
<li><a href="../280498/index.html">How to wind the counter Google Analytics or Google hates Kazakhstan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>