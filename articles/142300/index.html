<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What do static analysis and search engines have in common? Good top!</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The developers of search engines like Google / Yandex and the developers of static code analysis tools solve in a certain sense a very similar task. B...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What do static analysis and search engines have in common? Good top!</h1><div class="post__text post__text-html js-mediator-article">  The developers of search engines like Google / Yandex and the developers of <a href="http://www.viva64.com/ru/t/0046/">static code analysis tools</a> solve in a certain sense a very similar task.  Both those and others should provide the user with some sample with resources that ‚Äúmeet‚Äù the wishes of the user.  No, of course, ideally, search engine developers would like to limit themselves to the ‚ÄúI'm Feeling Lucky!‚Äù Button (I'm Feeling Lucky).  And developers of code analysis tools want to give only a list of real errors in the code.  But the reality as always imposes restrictions.  Want to find out how we are fighting a cruel reality when developing PVS-Studio? <br><br><a name="habracut"></a><br><br><h2>  Introduction </h2><br>  So how in the conditions of the existing restrictions the task of search engines looks?  Without claiming to be complete, I will say that the search engine should give the user to his request (indicated explicitly) several answers.  That is, to issue several sites that may be of interest to the user.  In this case, you can still show him advertising. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      From the point of view of code analyzers, the task looks almost the same.  To the already implicit user question (‚ÄúSmart program, show me where I have errors in the code?‚Äù) The tool should point out the code fragments in the program that are most likely to interest the user. <br><br>  Those who used static code analyzers (no matter for which language) understand that any tool has false positives.  This is a situation where, ‚Äúformally‚Äù by code, there is an error from the point of view of the tool, but the person sees that there is no error.  And then the human perception comes into play.  So imagine a situation. <br><br>  The man downloaded the trial version of the code analyzer, launched it.  She even (about a miracle!) Did not fall and somehow worked.  And she gave him a list of several tens / hundreds / thousands of messages.  If there are several dozen messages, then he will view them all.  Find something interesting - think about the constant use of the tool and its purchase.  Will not find - quickly forgets.  But if the list contains hundreds or thousands of messages, the user will view only a few of them.  And on the basis of what he saw will already be concluded about the tool.  Therefore, it is very important that the user can immediately get "eyes" on interesting diagnostic messages.  Therein lies the similarity in the approaches to the "right top (top)" among the developers of search engines and static code analysis tools. <br><br><h2>  How to ensure the "correct issue" for static analysis? </h2><br>  In order for the PVS-Studio users to see the most interesting posts first of all, we have a few tricks. <br><br>  First, all messages are divided at the level similar to the Compiler Warning Level.  And by default, when you first start, only messages of the first and second levels are shown, and the third level is turned off. <br><br>  Secondly, our diagnostics are divided into the classes ‚ÄúGeneral Analysis‚Äù, ‚Äú64-bit diagnostics‚Äù, ‚ÄúOpenMP diagnostics‚Äù.  At the same time, again, by default, OpenMP and 64-bit diagnostics are disabled, and the user does not see them.  This does not mean that they are bad, stupid and generally buggy.  It's just that the probability to meet the most interesting errors among the errors of the General Analysis category is much higher.  And if the user has found something interesting there, then, most likely, he will turn on other diagnostics, and will work with them if he needs them, of course. <br><br>  Thirdly, we constantly struggle with false positives. <br><br><h2>  So how do you do it all? </h2><br>  We have an internal tool that allows you to do a statistical (not to be confused with ‚Äústatic‚Äù!) Analysis of the results of our code analyzer.  It allows you to evaluate three parameters: <br><ul><li>  The share of errors in the project - the prevalence of errors (by code) at the project level (Project Level Share). </li><li>  Average error density is the ratio of the number of errors of one type to the number of files in which this type of errors occurs (Average Density (project level)). </li><li>  Distribution of errors of one type by project files in comparison with their average density (Errors count on file). </li></ul><br>  Let's take a look at the example of the Miranda IM project, and see how we use this internal tool. <br><br>  Immediately I will say that this post is not about the errors found in Miranda IM.  Who wants to look at the errors - refer to <a href="http://www.viva64.com/ru/a/0070/">this</a> note. <br><br>  So, we open the test result (plog-file) in our internal tool, turn off the 3rd level of errors and leave only the GA analyzer (General Analysis).  As a result, the distribution of errors will be as in Figure 1. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/996/706/b6f/996706b6f7283be3372d308625253bb8.png" alt="Figure 1 - The distribution of errors in the project Miranda IM."></a> <br>  Figure 1 - The distribution of errors in the project Miranda IM. <br><br>  The colored sectors are more than 2.5% of the ‚Äúresponses‚Äù of a particular diagnosis of the total number of problems detected.  Black - less than 2.5%.  It can be seen that the most common errors were with codes V547, V595 and V560.  Remember these codes. <br><br>  Figure 2 shows the average number of errors of each type per project file (i.e., their average density per project). <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/111/c1a/bbf/111c1abbf22dd6c241e93547f2944a4b.png" alt="Figure 2 - The average density of errors in the project Miranda IM."></a> <br>  Figure 2 - The average density of errors in the project Miranda IM. <br><br>  This graph shows that errors with V547, V595 and V560 codes occur approximately 1.5 to 2.5 times per file.  This is, in fact, a normal indicator and there is probably no reason to ‚Äúfight‚Äù these errors in terms of false positives.  But finally this can confirm the third graph for these errors, shown in Figures 3,4,5. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/9bb/196/52a/9bb19652a66a81351158496dd8e3e9fc.png" alt="Figure 3 - Distribution of errors V547 in the project Miranda IM in comparison with their average density."></a> <br>  Figure 3 - Distribution of errors V547 in the project Miranda IM in comparison with their average density. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/d0f/4ca/086/d0f4ca086b21a7bd78d369f92f0cd98e.png" alt="Figure 4 - Distribution of errors V595 in the project Miranda IM in comparison with their average density."></a> <br>  Figure 4 - Distribution of errors V595 in the project Miranda IM in comparison with their average density. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/54b/add/dd3/54badddd3a6e45daa74d3bb4d42c8a35.png" alt="Figure 5 - The distribution of errors V560 in the project Miranda IM in comparison with their average density."></a> <br>  Figure 5 - The distribution of errors V560 in the project Miranda IM in comparison with their average density. <br><br>  In Figures 3-5, the names of individual files go horizontally, the number of times this or that error was issued for a specific file, vertically.  Red columns are files in which the error was issued more than the average (blue dots) of the number of times for this type of error. <br><br><h2>  And what to do with these charts? </h2><br>  Then we look into these ‚Äúred‚Äù files and make a decision - if there is a false positive, and it happens quite often in other projects, then we fight with it.  If there really is a mistake, and besides with the help of copy-paste technology that has been rapidly multiplied, then there is nothing to ‚Äúimprove‚Äù here. <br><br>  In this note, I deliberately do not cite examples of code for which the analyzer swore, so as not to clutter the text. <br><br>  In other words, by building a bunch of similar graphs and analyzing them, we can easily see where our analyzer misses, and correct these places.  This confirms the old truth that the visual presentation of the "boring" data allows you to better see the problem you are looking for. <br><br><h2>  And what is this OP button in the pictures? </h2><br>  The attentive reader noticed in the pictures, in addition to the three standard analyzer buttons (GA, 64, MP), another OP button - short for ‚Äúoptimization‚Äù.  In PVS-Studio 4.60 we introduced a new group of diagnostic rules related to micro-optimizations.  Diagnosing possible micro-optimizations is a rather ambiguous feature of our analyzer.  Someone is very happy to find a place where a large object is transferred to a function not by reference, but by copying ( <a href="http://www.viva64.com/ru/d/0135/">V801</a> ).  Someone significantly saves memory by reducing the size of structures for large arrays of objects ( <a href="http://www.viva64.com/ru/d/0150/">V802</a> ).  And someone thinks all this is stupidity and premature optimization.  It all depends on the type of project. <br><br>  In any case, analyzing the issue of our instrument, we came to the need: <br><ul><li>  select optimization diagnostics in a separate group so that they can be easily hidden / shown; </li><li>  by default, disable them, as they can ‚Äúfill in‚Äù the list of errors with those diagnostics that not everyone likes. </li></ul><br>  This is how a new OP button appeared in the PVS-Studio Output Window (Figure 6): <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/0e4/bc1/675/0e4bc1675736c55785b2f754be51984b.png" alt="Figure 6 - The OP button (optimization) appeared in PVS-Studio 4.60."></a> <br>  Figure 6 - The OP button (optimization) appeared in PVS-Studio 4.60. <br><br>  By the way, in the same version, we significantly reduced the number of false positives for analyzing 64-bit problems. <br><br>  I suggest that you <a href="http://www.viva64.com/ru/pvs-studio-download/">download the</a> new version of PVS-Studio and check how well recommendations for micro-optimization are issued for your code. <br><br><h2>  Conclusion </h2><br>  The developers of static code analyzers, as well as the developers of search engines, are interested in the adequate output of the work.  Both those, and others apply many receptions for this, including methods of the statistical analysis.  In this post, I showed how we do it while developing PVS-Studio. <br><br><h2>  Question from the audience </h2><br>  I have a small question for those who have used (or at least played) PVS-Studio or any other code analyzer.  Do you think the end user of the code analyzer needs the graphs provided in the article in the form of an end-user tool?  Or, in another way, if your code analyzer contained such diagrams, would you be able to learn something from them?  Or is it exclusively an ‚Äúfor internal needs‚Äù tool?  Please share your opinion by writing to <a href="http://www.viva64.com/ru/about-feedback/">us</a> or here in the comments. </div><p>Source: <a href="https://habr.com/ru/post/142300/">https://habr.com/ru/post/142300/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../142295/index.html">Beeline protects SMS fraudsters?</a></li>
<li><a href="../142296/index.html">Appcelerator / IDC: Mobile Development: 1Q 2012</a></li>
<li><a href="../142297/index.html">HP helps Alfa-Bank to transfer storage network to 16-gigabit Fiber Channel</a></li>
<li><a href="../142298/index.html">Video Course Fundamentals of Magento development</a></li>
<li><a href="../142299/index.html">How to use smoothing and increasing the frequency of video in LCD TVs when connected to a PC</a></li>
<li><a href="../142301/index.html">TodoMVC - "Hello, world" on steroids</a></li>
<li><a href="../142302/index.html">We are friends with Thinstation 5.0 and VMWare View 5.0 client with full USB-redirect</a></li>
<li><a href="../142303/index.html">Editing GRUB on Ext4 from under Windows</a></li>
<li><a href="../142304/index.html">Integration of CKEditor into SonataAdminBundle</a></li>
<li><a href="../142306/index.html">Ya.Subbotnik in Kiev</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>