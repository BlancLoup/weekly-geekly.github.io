<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Friday JS: reqyire.js and ochepyatko-oriented programming</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="And again, I welcome the respected habrizhitel in his not so constant, but repetitive heading. Today we will talk about how to become a more effective...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Friday JS: reqyire.js and ochepyatko-oriented programming</h1><div class="post__text post__text-html js-mediator-article">  And again, I welcome the respected habrizhitel in his not so constant, but repetitive heading.  Today we will talk about how to become a more effective programmer under Node.js.  And also, as you might guess from the title, about typos and their role in this process.  Some code to attract attention. <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reqyire = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"reqyire"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> http = reqyire(<span class="hljs-string"><span class="hljs-string">"htpp"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> server = http.creteServer(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) =&gt;</span></span> { res.statusCode = <span class="hljs-number"><span class="hljs-number">200</span></span>; res.setHeader(<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>, <span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>); res.end(<span class="hljs-string"><span class="hljs-string">'Hello World\n'</span></span>); }); server.listem(<span class="hljs-number"><span class="hljs-number">3000</span></span>, <span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>);</code> </pre> <a name="habracut"></a><br>  Perhaps it would not be an exaggeration to say that typos are the scourge and plague of programming.  A huge amount of resources goes to fight them.  Wool code ingenious static analyzers, spending precious seconds of working time;  IDE autocompletion, mercilessly devouring processor cycles, prompts the correct, in his opinion, options.  The compiler refuses to compile, and the interpreter refuses to interpret the code where some pitiful letter is missing or replaced.  Even a no-brainer that "creteServer" is "createServer" with the missing letter "a".  But the V8 engine is not a hedgehog, and it swears at this harmless slip of its merciless "undefined is not a function". <br><br><a name="sarcasm-sign"></a>  <abbr title="Plate &quot;Sarcasm&quot;">And</abbr> once I wondered: maybe we are doing something wrong?  Perhaps, what we are fighting with as an enemy can become our ally and servant?  The result of these reflections was the library <b>reqyire.js</b> , which, I hope, will forever change the world of server-side JS programming. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Instructions for use </h3><br>  To begin with, of course, you need to install the library: <br><br><pre> <code class="bash hljs">npm install reqyire</code> </pre> <br>  After that, at the beginning of each file where you plan to use it, write: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reqyire = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"reqyire"</span></span>);</code> </pre> <br>  In the future, use <b>reqyire</b> instead of <b>require</b> when there are concerns that you can make a typo in the module name.  That is always.  No more will you have to see endless ‚ÄúError: cannot find module‚Äù - <b>reqyire</b> will definitely find you a module.  The following code: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reqyire = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"reqyire"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> path = reqyire(<span class="hljs-string"><span class="hljs-string">"pah"</span></span>), fs = reqyire(<span class="hljs-string"><span class="hljs-string">"fds"</span></span>), util = reqyire(<span class="hljs-string"><span class="hljs-string">"./disrt/ytil.js"</span></span>);</code> </pre> <br>  - will work, and work as it should, and not as written. <br><br>  If you have a fairly recent version of Node.js (or not quite fresh, but launched with the --harmony-proxies flag), then wonders will not end there.  Thanks to the magic of fresh JavaScript standards, all objects requested through <b>reqyire</b> also become comprehensible and allow you to make typos in the names of their properties.  This intelligence is also passed to child objects, and even to objects returned by functions: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> path = reqyire(<span class="hljs-string"><span class="hljs-string">"pat"</span></span>), fs = reqyire(<span class="hljs-string"><span class="hljs-string">"fd"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> folder = path.win33.dirmame(<span class="hljs-string"><span class="hljs-string">".\\Works\\perfectly\\correct\\index.js"</span></span>); fs.stasSync(folder).isDyrectori(); <span class="hljs-comment"><span class="hljs-comment">// true</span></span></code> </pre><br>  If some object does not have the happiness of being called through <b>reqyire</b> , but you still want to make him understand, <b>reqyire.wrap</b> comes to the <b>rescue</b> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj = {<span class="hljs-attr"><span class="hljs-attr">prop</span></span>: <span class="hljs-string"><span class="hljs-string">"The internet is for"</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wrappedObj = reqyire.wrap(obj); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(wrappedObj.porn, <span class="hljs-string"><span class="hljs-string">"porn"</span></span>);</code> </pre><br>  Also <b>reqyire.wrop</b> , <b>reqyire.warp</b> , and indeed any method name, even remotely similar to wrap, will do. <br><br>  Now that you have <b>reqyire.js</b> , you can spend less time correcting typos.  This will allow you to write more lines of code per day and, obviously, make you a more effective programmer. <br><br><h3>  Disclaimer </h3><br>  Have you noticed <a href="https://habr.com/ru/post/336906/">the Sarcasm sign</a> ?  Of course, the words about improving efficiency, like the library itself, in principle, are not serious.  Anyone who decides to use <i>it</i> in production will be cold in the ice hell of Helheim. <br><br><h3>  How it works? </h3><br>  It is unlikely that this question has arisen in experienced professionals, but the answer may come in handy to less sophisticated readers.  Well, I'll be happy to explain everything, and don't even try to stop me. <br><br>  <b>Fuzzy search</b> <br><br>  The heart of the whole library is the function <b>fuzzySearch (arrayOfStrings, string)</b> .  It finds in the array of strings the one between which and the second argument is the lowest <a href="https://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B0%25D1%2581%25D1%2581%25D1%2582%25D0%25BE%25D1%258F%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%259B%25D0%25B5%25D0%25B2%25D0%25B5%25D0%25BD%25D1%2588%25D1%2582%25D0%25B5%25D0%25B9%25D0%25BD%25D0%25B0">Levenshtein distance</a> , i.e.  which requires the smallest number of operations to add, delete, or change a character to turn one into another.  This is done using a slightly modified <a href="https://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B0%25D1%2581%25D1%2581%25D1%2582%25D0%25BE%25D1%258F%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%259B%25D0%25B5%25D0%25B2%25D0%25B5%25D0%25BD%25D1%2588%25D1%2582%25D0%25B5%25D0%25B9%25D0%25BD%25D0%25B0">Wagner-Fisher algorithm</a> .  Instead of honestly counting the distance for each pair of lines, we memorize the smallest distance already found and stop the algorithm if the distance for a new line is obviously greater. <br><br>  Generally speaking, Levenshtein distance is not the most appropriate metric.  According to the mind, it would be worthwhile to use the <a href="https://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B0%25D1%2581%25D1%2581%25D1%2582%25D0%25BE%25D1%258F%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%2594%25D0%25B0%25D0%25BC%25D0%25B5%25D1%2580%25D0%25B0%25D1%2583_%25E2%2580%2594_%25D0%259B%25D0%25B5%25D0%25B2%25D0%25B5%25D0%25BD%25D1%2588%25D1%2582%25D0%25B5%25D0%25B9%25D0%25BD%25D0%25B0">distance of Damerau-Levenshtein</a> , which is better suited to the nature of typos made by man.  But, as the anecdote wrote in his course hero: "... I took wooden electrodes, because no one will read it anyway." <br><br>  <b>Search for modules</b> <br><br>  In order to use fuzzy search, you must first get an array of options from somewhere.  First we look at the name of the requested module.  According to the <a href="https://nodejs.org/api/modules.html">specification of the</a> ‚Äúnative‚Äù function <b>require</b> , if the name starts with "/", "./" or "../", then this is the path to the file, otherwise it is the name of the installed module.  Let's start with the second case, it's easier. <br><br>  Installed modules are of three types: local, global and embedded.  The list of the first and second can be obtained using console commands: <br><br><pre> <code class="bash hljs">npm ls -json npm ls -g -json</code> </pre> <br>  For the third category, to my convenience, a suitable <a href="https://github.com/sindresorhus/builtin-modules">library</a> was found.  Combining these lists, we cache the result (the first two teams work long enough) and go through it with a fuzzy search. <br><br>  <b>File search</b> <br><br>  In the case of the file path there are two problems, obvious and less obvious.  An obvious problem: the system may have (and most likely will) an astronomical number of files.  Collecting an array of their locations, and then doing a fuzzy search on it is a very expensive operation.  Thinking over my head, I came up with the following solution: we divide the path into elementary fragments (a sequence of directory names and a file name at the end) and we will not clearly search for each of these fragments, gradually forming the final path.  Thus, <b>reqyire ("./ jd / sctipr.js")</b> will find the file "./js/script.js", but not the file "./jdsctipr.js". <br><br>  A less obvious (perhaps only for me) problem was relative paths.  To resolve an absolute path in the way that would have required, reqyire.js must know the absolute path to the script from which <b>reqyire</b> was called.  It is impossible to recognize it using standard JS tools.  I was about to give up, but, fortunately, I found a <a href="https://github.com/felixge/node-stack-trace">dirty hack</a> related to the features of the V8 engine and allowing me to pull out the path to the calling script from the glasstrack. <br><br>  <b>Healing Wraps</b> <br><br>  As you might guess, the "intelligibility" is achieved using the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy">ES6 Proxy</a> .  By wrapping an object in Proxy, you can intercept calls to its properties, call it as a function, and also many other amazing things, which, however, are less interesting for us now.  The wrapper written by me produces a fuzzy search in the properties of the object if the property with the exact name does not exist.  If the return result is an object, it is packaged in the same wrapper.  The result of the function call is also packed. <br><br><h3>  Conclusion </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/7bf/f07/3c1/7bff073c15139acda19c5c8a1ccd0b74.gif" alt="image"><br><br>  Despite the practical uselessness of this library, its development was not useless.  In the process, I learned a lot of new and interesting.  I hope for you this post also proved to be informative.  I will take my leave. </div><p>Source: <a href="https://habr.com/ru/post/336906/">https://habr.com/ru/post/336906/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../336894/index.html">Building effective communication "client-agency"</a></li>
<li><a href="../336896/index.html">My favorite conference on embedded technology and the Internet of things</a></li>
<li><a href="../336898/index.html">To increase the reliability and security of banking software, use PVS-Studio</a></li>
<li><a href="../336900/index.html">Disguise UDP traffic in TCP / ICMP using udp2raw</a></li>
<li><a href="../336902/index.html">Nuxt.js: Framework for the Vue.js framework</a></li>
<li><a href="../336908/index.html">Create your own physical 2D engine. Part 1: fundamentals and resolution of impulses of force</a></li>
<li><a href="../336910/index.html">Simple work with Steamworks</a></li>
<li><a href="../336912/index.html">PCI DSS in version 3.2 - what's new and how to respond?</a></li>
<li><a href="../336916/index.html">Reviving Dinosaurs: TDD vs Test-Last</a></li>
<li><a href="../336918/index.html">Product design digest, August 2017</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>