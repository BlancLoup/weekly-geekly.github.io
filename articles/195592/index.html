<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Running and using OpenWrt in VirtualBox</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I will talk about how to run OpenWrt in the emulator and configure it to work on the network, as well as touch on the use of vi, ssh a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Running and using OpenWrt in VirtualBox</h1><div class="post__text post__text-html js-mediator-article"><img align="right" src="https://habrastorage.org/getpro/habr/post_images/d8f/094/3df/d8f0943df1ace00237a427e9372e4732.jpg" alt="Screenshot list of virtual machines">  In this article I will talk about how to run OpenWrt in the emulator and configure it to work on the network, as well as touch on the use of vi, ssh and scp clients.  I consider the main reason for all this action to be the opportunity to touch the firmware with my hands without fear of remaining without the Internet, in case of problems with the router.  This article is intended for people who are not familiar with Linux. <br>  Wikipedia suggests that OpenWrt is a Linux-based firmware for home routers.  In fact, this is a whole family of firmware.  OpenWrt along with DD-Wrt and Gargoyle are available for a huge number of routers on different hardware platforms.  The repository is available at <a href="http://downloads.openwrt.org/">downloads.openwrt.org</a> .  In addition to the main branch (having several implementations within the platform), called attitude_adjustment, backfire and kamikaze versions are common. <br><br><h2>  Software installation </h2><a name="habracut"></a><br>  First of all, <a href="https://www.virtualbox.org/wiki/Downloads" title="Download VirtualBox">install the VirtualBox emulator</a> if you don‚Äôt have it.  To be able to execute commands outside the console of the emulator window, you will need an SSH client.  <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html" title="Download Putty">For example, Putty</a> .  At the same time you will be available to the home system clipboard.  For convenient access to the file system of the "router" you need a graphical SCP client.  For example, <a href="http://winscp.net/eng/download.php" title="Download WinSCP">WinSCP for Windows</a> .  For Linux, the built-in file manager will suffice.  For example, Krusader, Dolphin, Nautilus. <br><br><h2>  Select firmware </h2><br>  Emulation requires firmware for x86 platform, preferably with Ext2 or Ext4 file system. <br>  Although the <a href="http://wiki.openwrt.org/doc/howto/virtualbox">official wiki advises</a> to install a <a href="http://downloads.openwrt.org/attitude_adjustment/12.09/x86/generic/">version of attitude_adjustment</a> , I had problems with it: it refused to start, reporting kernel panic.  So it's easier to stay on one of the two remaining.  Choosing the firmware, look in the options for downloading the finished .vdi file. <br><img src="https://habrastorage.org/getpro/habr/post_images/91d/ee4/116/91dee4116f36976b46895b6ada4bd88c.png" alt=".vdi firmware image"><br>  Link for backfire version 10.03.1: <a href="">http://downloads.openwrt.org/backfire/10.03.1/x86_generic/openwrt-x86-generic-combined-ext2.vdi</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If the firmware you are interested in is available only as a raw image (img.gz, image.gz, bin) you will need to use the converter included in the VirtualBox kit.  For Windows, save the following text file in the VirtualBox folder (you may need administrator rights) and give it the extension .bat or .cmd: <br><blockquote><pre>  "% ~ dp0VBoxManage.exe" convertfromraw --format VDI% 1 "% ~ dpn1.vdi"
 pause </pre></blockquote><br>  After that, unpack the downloaded firmware image and drag it onto this script.  The resulting .vdi image can be connected to a virtual machine. <br><br><h2>  Configure VirtualBox </h2><br>  Create a new virtual machine.  Type - Linux, version - Linux 2.6.  Refuse at this stage to connect the drive - this will be done later. <br>  Open the properties of the new virtual machine (the "Configure" button) and go to the Network section.  Instead of the NAT mode, select Network Bridge (Bridged) - this will allow access to the virtual machine from other devices on the network.  If you do not have a home network (at least a router), leave the NAT and add the second adapter "Virtual Host Adapter". <br>  Then in the COM ports section, be sure to check the box to enable port emulation.  Otherwise, OpenWrt will not be able to load. <br>  Finally, in the Media section, add the OpenWrt firmware image to the IDE controller as a hard disk.  If devices are connected to the SATA controller, delete them. <br>  Click OK, saving the settings. <div class="spoiler">  <b class="spoiler_title">In case of difficulty, look at the screenshots</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/98e/dc8/9e1/98edc89e15d31bf7a49da514a9d47f5f.png" alt="OS selection"><br><img src="https://habrastorage.org/getpro/habr/post_images/e71/703/c9e/e71703c9e616ac5e582c90517bdbcfe3.png" alt="Carriers"><br><img src="https://habrastorage.org/getpro/habr/post_images/06e/8c9/f66/06e8c9f66448bc3b457fef4312ab974b.png" alt="Network settings"><br><img src="https://habrastorage.org/getpro/habr/post_images/617/93b/381/61793b38162356b07368658fdb4e6b29.png" alt="COM port"><br></div></div><br><br><h2>  Network configuration </h2><br>  Start the virtual machine.  When the download is complete, press Enter.  The console will be available. <br><div class="spoiler">  <b class="spoiler_title">Screenshot on the download end</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/244/1d5/0f0/2441d50f0e77a64f030f9fac5c0656a1.png" alt="First start"></div></div><br>  First, set the administrator password by entering <strong>passwd</strong> and a new password in response to the prompt. <br>  By default, OpenWrt creates its own subnet, ignoring the existing ones and gets the address 192.168.1.1 in it.  You can try to connect to the virtual machine at this address by setting your computer (network card or virtual host adapter, depending on the VirtualBox settings made) static address on the 192.168.1. * Subnet.  But it is more convenient option when the emulated "router" connects to the existing network, gaining access to the Internet and to devices on your network.  Using the built-in vi text editor, you can edit configuration files.  Type <strong>vi / etc / config / network</strong> to change network settings.  The cursor in vi is controlled by arrows, to delete a line, you can press <strong>dd</strong> , you can enter edit mode by pressing the <strong>i</strong> button, return to the command mode by <strong>Esc</strong> .  Bring this file to the following form (change option proto from <b>static</b> to <b>dhcp</b> ): <br><blockquote><pre>     # Copyright (C) 2006 OpenWrt.org

 config interface loopback
         option ifname lo
         option proto static
         option ipaddr 127.0.0.1
         option netmask 255.0.0.0

 config interface lan
         option ifname eth0
         option proto dhcp
</pre></blockquote><br>  Then, using Esc, go to command mode and type <strong>: wq</strong> and Enter to save and exit the editor.  To exit without saving, type the command <strong>: q!</strong>  .  These settings mean that the emulated "router" will try to get an available ip address.  If you do not have a real router and the ability to get more than one address, select the Virtual Host Adapter mode in the VirtualBox network settings. <br><br>  To apply the new settings, restart the virtual machine or enter <strong>/etc/init.d/network restart</strong> . <br><br>  After loading, look up the virtual machine address by typing <strong>ifconfig</strong> in the inet addr field of eth0: <br><blockquote><pre>  root @ OpenWrt: ~ # ifconfig
 eth0 Link encap: Ethernet HWaddr 08: 00: 27: 13: 00: 42
           inet addr: 192.168.1.23 Bcast: 192.168.1.255 Mask: 255.255.255.0
           UP BROADCAST RUNNING MULTICAST MTU: 1500 Metric: 1
           RX packets: 91 errors: 0 dropped: 0 overruns: 0 frame: 0
           TX packets: 65 errors: 0 dropped: 0 overruns: 0 carrier: 0
           collisions: 0 txqueuelen: 1000
           RX bytes: 10016 (9.7 KiB) TX bytes: 7749 (7.5 KiB)

 lo Link encap: Local Loopback
           inet addr: 127.0.0.1 Mask: 255.0.0.0
           UP LOOPBACK RUNNING MTU: 16436 Metric: 1
           RX packets: 48 errors: 0 dropped: 0 overruns: 0 frame: 0
           TX packets: 48 errors: 0 dropped: 0 overruns: 0 carrier: 0
           collisions: 0 txqueuelen: 0
           RX bytes: 3888 (3.7 KiB) TX bytes: 3888 (3.7 KiB)

 root @ OpenWrt: ~ #
</pre></blockquote><br><br>  Congratulations, OpenWrt is running and accessible over the network.  Keep in mind: this address (192.168.1.23 in my case) is temporary and may change after restarting the emulator or after some time (several hours).  Start Putty and try to connect to the virtual machine at this address.  Login to connect - root, the password you set when you first boot. <br><br><h2>  File system access </h2><br>  Run WinSCP (or equivalent) and connect to the virtual machine. <br><img src="https://habrastorage.org/getpro/habr/post_images/b46/a29/dc1/b46a29dc1cf638c0a497990042da40e3.png" alt="Connection window screenshot"><br>  You will see the standard two-pane file manager.  Now you can edit configuration files in a convenient graphical mode.  It is also possible to copy files to the "router" and back.  Try to go to the right side of the root ( <strong>/</strong> ), and then in <strong>/ etc / config /</strong> and run the <strong>network</strong> . <br><img src="https://habrastorage.org/getpro/habr/post_images/e49/1b7/3b4/e491b73b465e2b2067b5285619dfe5f6.png" alt="Editing Configs"><br>  If desired, make changes and save the result. <br><br><h2>  Package installation </h2><br>  First, update the list of components available in the repository by entering <strong>opkg update</strong> , then try to install, for example, openvpn by entering <strong>opkg install openvpn</strong> .  You can check the presence of a component and clarify its name with the <strong>opkg list command</strong> .  You can also install packages without access to the Internet.  Using WinSCP, transfer the packages to a writeable directory, such as <strong>/ tmp /</strong> or to a USB flash drive, if available, and enter the command opkg install_path.  You can use the Tab button to not type the name completely.  For example, download the Russian language pack for LuCI at <a href="">http://downloads.openwrt.org/backfire/10.03.1/x86_generic/packages/luci-i18n-russian_0.10.0-1_x86.ipk</a> , rewrite it using WinSCP in / tmp / and in the emulator console, terminal, or Putty (see the WinSCP toolbar buttons after Synchronize), type <strong>opkg install /tmp/luci-i18n-russian_0.10.0-1-1_x86.ipk</strong> <br><blockquote><pre>  root @ OpenWrt: ~ # opkg install /tmp/luci-i18n-russian_0.10.0-1_x86.ipk
 Installing luci-i18n-russian (0.10.0-1) to root ...
 Configuring luci-i18n-russian.
 root @ OpenWrt: ~ #
</pre></blockquote><br>  Keep in mind that the architecture of your firmware and the package to be installed must match. <br><br><h2>  Web interface </h2><br>  Most versions of OpenWrt initially include the LuCI web shell.  LuCI stands for Lua Configuration Interface.  Navigate to the browser address of your ‚Äúrouter‚Äù in the browser, enter the password specified at the beginning and you can experiment with LuCI. <br><img src="https://habrastorage.org/getpro/habr/post_images/cde/659/25a/cde65925af14605046cf76a65f2f0801.png" alt="LuCI login window"><br>  Russian translation is available.  To install, go to the System - Software section, type the word ‚Äúrussian‚Äù in the Filter field, and on the Available packages (russian) tab, install the luci-i18n-russian package.  Or, install it using opkg as described above, and then select a language in the System - System - Language and Style - Language section. <br><br><h2>  Links </h2><br>  <a href="http://downloads.openwrt.org/">OpenWrt repository</a> <br>  <a href="http://wiki.openwrt.org/ru/doc/start">OpenWRT Project Wiki</a> <br>  <a href="https://ru.wikipedia.org/wiki/OpenWrt">Wikipedia about OpenWrt</a> <br>  <a href="http://habrahabr.ru/post/128451/">Network configuration in OpenWRT</a> <br>  <a href="http://habrahabr.ru/post/191990/">OpenWRT, or What else can you do with your router?</a> </div><p>Source: <a href="https://habr.com/ru/post/195592/">https://habr.com/ru/post/195592/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../195582/index.html">See the invisible, or a little about the secrets of mail.ru</a></li>
<li><a href="../195584/index.html">The author of scientific articles Clive Thompson does not think that technology makes us sillier.</a></li>
<li><a href="../195586/index.html">RailsClub'Moscow 2013. The conference has begun!</a></li>
<li><a href="../195588/index.html">[UPD] Chain.js: link synchronous and asynchronous functions in the chain</a></li>
<li><a href="../195590/index.html">Two hares - SOPA and IP4, one solution</a></li>
<li><a href="../195594/index.html">Autonomous monitoring system with a small budget</a></li>
<li><a href="../195596/index.html">We test and monitor MSTP in a heterogeneous network</a></li>
<li><a href="../195598/index.html">Curiosity found water!</a></li>
<li><a href="../195604/index.html">Charging station from used batteries</a></li>
<li><a href="../195608/index.html">The main mistakes in the design of the main menu of the game</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>