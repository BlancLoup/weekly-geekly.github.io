<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Search engine job dataflow</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In continuation of the article How to start a search engine, or a few thoughts about the crawler 

 In the previous article, I briefly discussed the e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Search engine job dataflow</h1><div class="post__text post__text-html js-mediator-article">  In continuation of the article <a href="http://habrahabr.ru/blogs/search_engines/123703/">How to start a search engine, or a few thoughts about the crawler</a> <br><br>  In the previous article, I briefly discussed the experiments with the intensity of the load and the work of the Crawler, in general terms I will describe the project's DataFlow before building the index, so that it is clear what I am writing about.  I will try to describe each step in detail in the corresponding article. <br><br>  So, the downloaded page first gets to highlight links.  New links from the current site are placed in the local queue for download in the current session, and all other sites are added to the common Crawler queue.  This queue contains only the main pages of sites. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      After collecting a sufficient number of pages of one site, the analyzer is launched, the patterns that are present on most pages of the site are highlighted, and they are cut. <br>  At the exit we get the texts of the pages without everything superfluous and grouped by sites. <br><a name="habracut"></a><br>  I put all the finished pages of a site into a directory that goes to the indexer.  The indexer creates a small version of the "direct" index, consisting of several (10-1000) sites prepared in the previous step - parsing HTML, matches words, packages, counts metrics word by word.  The direct index is a table where, by the document ID, I can get a list of words and all the information about their entries in the document.  Also, a database of words (built from this small number of documents) and references (still not added to the general index and therefore not having an ID) are attached to it.  Links go to the PR recalculation module (words and their weights participate in the links information), the rest is for updating the inverse index.  The volume of the piece that the indexer prepared is usually 100-300Mb per hour.  And this is without the texts of the pages. <br><br>  Counting PR and various metrics is done by a separate module.  The funny thing is that for PR calculation it is more convenient to store links as strings, and not as IDs because  not all links will get into the final index - it‚Äôs rather silly to fill the link storage structure with unnecessary information.  Because of this feature, it is easier to write this part in Perl or a similar language that quickly works with strings, or you will have to organize a system for storing a large number of strings in a structural language. <br><br>  At the output of the indexer we get a packed piece of a direct index.  But we need to build a reverse index so that we can quickly search.  The reverse index is a table in which each word is associated with a list of documents sorted by relevance or PR (like Google‚Äôs) in which this word exists.  It is clear that just taking a direct index and overtaking it in the reverse will take years when the base grows, therefore all the time the reverse index is incrementally increased and a couple dozen pieces of the direct index prepared at the previous stage are combined and then sorted.  Technically, this happens at the same time - sorted insertion into a sorted list.  There are many moments how to arrange a database so that it can withstand it, how to do it so that it is not necessary to copy the files to a hundred gigs each time, how to put the necessary piece into memory and so on. <br>  A database of words, metrics and everything else is pre-prepared, also incrementally connecting the previous version with new information.  ID words in a small direct index on the move are replaced by those that correspond to the full version of the database, and the rest of the information is similar. <br>  When building a reverse index, a separate database storing URLs is also added - this is a separate large structure, too many records need to be stored and have quick access by ID, access for sequential reading within one site, quickly check for the existence of links, in the description of database structures I will cut this question. <br><br>  At the stage of rebuilding the inverse index, we need data on PR, page metrics and everything else that helps sort the results.  In fact, you only need to have the first couple of hundreds of thousands of results guaranteed to be sorted - if it comes to the rest - then this will be the work of the ranking function. <br><br>  The built inverse index can already be used for searching - we select lists of words from the query, we are looking for an intersection - we count the coefficients, the distance between the found words, well, we sort them based on the ranking function. <br><br>  A little more from morphology - first, on the basis of the morphological dictionary of Zaliznyak, we choose the largest base, cut off the ending, substitute the 1st dictionary form.  This whole process is assembled into a tree for quick parsing, the final leaves contain variants of endings.  We run along the word, parallelly descending the tree on the basis of the met letter, until we reach the lowest possible sheet - there, proceeding from the endings, we substitute the normalized one. <br>  If no normal form was found, then we apply stemming - based on the text of the books downloaded from lib.ru, I built a table of the frequency of occurrence of the endings, looking for the most common of the suitable (also a tree) and replacing it with the normal form.  Stemming works well, if the word was not in the language another 5-10 years ago - it will easily disassemble ‚Äúcrawlers‚Äù into ‚Äúcrawler‚Äù <br><br>  The full content and list of my articles on the search engine will be updated here: <a href="http://habrahabr.ru/blogs/search_engines/123671/">http://habrahabr.ru/blogs/search_engines/123671/</a> </div><p>Source: <a href="https://habr.com/ru/post/123805/">https://habr.com/ru/post/123805/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../123793/index.html">JavaScript libraries for working with SVG</a></li>
<li><a href="../123797/index.html">IIS + .NET + Json. We write the Application Server</a></li>
<li><a href="../123799/index.html">Asus Eee Pad Transformer Review</a></li>
<li><a href="../123802/index.html">Facebook is testing a new home page design.</a></li>
<li><a href="../123804/index.html">Mash of flags: how to find out more about an exotic country</a></li>
<li><a href="../123808/index.html">Attackers have access to data from users of the Washington Post</a></li>
<li><a href="../123810/index.html">Flash drive cryptex for lovers of design and cryptography</a></li>
<li><a href="../123812/index.html">Writing Your ASP.NET Session Store Provider Using Redis</a></li>
<li><a href="../123813/index.html">Textile printer do it yourself - continued</a></li>
<li><a href="../123816/index.html">Fixed point math in Marmalade SDK</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>