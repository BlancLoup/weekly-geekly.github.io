<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>CAPWAP State Machine in the Cisco Unified Wireless Implementation: Discovery State</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The Unified Wireless Network architecture assumes centralized management of all access points (TD) from a single interface - a wireless network contro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>CAPWAP State Machine in the Cisco Unified Wireless Implementation: Discovery State</h1><div class="post__text post__text-html js-mediator-article"><p>  The Unified Wireless Network architecture assumes centralized management of all access points (TD) from a single interface - a wireless network controller, to which access points must pre-register. </p><br><p>  Understanding the CAPWAP State Machine (state transition sequence) when interacting with an access point and a controller is very helpful in quickly troubleshooting a wireless network.  The CAPWAP State Machine is described in the RFC 5415 standard (CAPWAP Protocol Specification).  This article details the states of Discovery in a Cisco Unified Wireless implementation.  In subsequent articles, the Join, Failover, and Fallback states in the Cisco Unified Wireless implementation will be described. </p><br><h2 id="capwap-discovery-phase-ipv4-v-cisco-wireless-aireos">  CAPWAP Discovery Phase IPv4 on Cisco Wireless AireOS </h2><br><p><img src="https://habrastorage.org/files/994/f19/17b/994f1917b8a5440f8625aa215034a5a8.png" alt="image"></p><br><p>  Registering an access point to a specific controller consists of the following steps: </p><br><ol><li>  Discovery Phase (detection phase); <br><ul><li>  The access point sends a CAPWAP Discovery Request to all known controllers; </li><li>  Each controller that receives a CAPWAP Discovery Request responds with a CAPWAP Discovery Response message; </li></ul></li><li>  Join Phase <br><ul><li>  Based on the data collected in the CAPWAP Discovery Response packets, the access point selects which controller to connect to and sends it a CAPWAP Join request </li><li>  The controller checks the access point and sends a CAPWAP Join response </li><li>  The access point is checking the controller. </li></ul></li></ol><br><a name="habracut"></a><br><p>  CAPWAP discovery request is sent to the IP address of the Management interface of the controller. <br>  In order for the access point to determine where to send the CAPWAP discovery request, several tools are provided, but to start the search mechanisms, the access point needs to obtain an IP address.  This can be done via DHCP or set it manually.  Then the search mechanisms start working.  The access point sends a CAPWAP discovery request to all controllers that it succeeded in detecting and forms a list of controllers from which it already selects which specific controller to connect to (send a CAPWAP Join Request). </p><br><ol><li>  The TD sends a third-level broadcast request (layer 3 local broadcast to address 255.255.255.255; </li><li>  TD looks to the local list of controllers stored on NVRAM; </li><li>  AP when requesting a DHCP address looks in DHCP Option 43 in the DHCP offer message; </li><li>  The access point tries to resolve DNS names CISCO-CAPWAP-CONTROLLER.local-domain or CISCO-LWAPP-CONTROLLER.local-domain </li></ol><br><h3 id="rabota-mehanizmov-capwap-discovery-phase-ipv4">  Work mechanisms CAPWAP Discovery Phase IPv4 </h3><br><p>  You can view the current TD settings through the console using the command: </p><br><pre><code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">show</span></span> capwap <span class="hljs-keyword"><span class="hljs-keyword">client</span></span> config</code> </pre> <br><p>  If any changes were made on the access point, you can restore the original configuration by deleting the private-config and IP address settings. </p><br><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">clear</span></span> capwap private-config <span class="hljs-keyword"><span class="hljs-keyword">clear</span></span> capwap ap ip address <span class="hljs-keyword"><span class="hljs-keyword">clear</span></span> capwap ap ip <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-gateway</code> </pre> <br><p>  In the current tests, the clear capwap private-config command was always enough, but in the book Deploying and Troubleshooting Cisco Wireless LAN Controllers, the author recommends that the TD just forget all known controllers to use the erase / all nvram command: for which, in turn, you need to activate debugging / troubleshooting mode with the debug capwap console cli command. </p><br><pre> <code class="hljs dos">debug capwap console cli <span class="hljs-built_in"><span class="hljs-built_in">erase</span></span> /all nvram:</code> </pre> <br><p>  Next, restart the access point. </p><br><pre> <code class="hljs">reload</code> </pre> <br><p>  After the reboot, you can make sure (if the DHCP service is not started) that until the access point has received an IP address, it cannot start the Discovery Phase: </p><br><pre> <code class="hljs vbscript">%CAPWAP<span class="hljs-number"><span class="hljs-number">-3</span></span>-ERRORLOG: <span class="hljs-keyword"><span class="hljs-keyword">Not</span></span> sending discovery <span class="hljs-built_in"><span class="hljs-built_in">request</span></span> AP does <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> have an Ip !!</code> </pre> <br><pre> <code class="hljs pgsql">%CAPWAP<span class="hljs-number"><span class="hljs-number">-3</span></span>-DHCP_RENEW: Could <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> discover WLC <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> DHCP IP. Renewing DHCP IP.</code> </pre> <br><p>  In order to start Discovery Phase, the access point needs to issue an address via DHCP or set statically via the console using the commands: </p><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">capwap</span></span> ap ip address ip mask capwap ap ip <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-gateway ip</code> </pre> <br><h3 id="1-layer-3-local-broadcast">  1) Layer 3 local broadcast </h3><br><p>  The access point sends a broadcast Discovery request to the address 255.255.255.255 on the UPD port 5246. Discovery request is processed by the Management interface of the controller.  If the Management interface of the controller and the TD interface are in the same VLAN, then the controller will process this request and send a Discovery response. </p><br><p>  After the access point receives an address, it activates all possible search mechanisms and as a result receives a Discovery response due to the Discovery request broadcast. </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">delphi</span></span> %<span class="hljs-selector-tag"><span class="hljs-selector-tag">DHCP-6-ADDRESS_ASSIGN</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">Interface</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BVI1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">assigned</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">DHCP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">address</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.191</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.7</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">mask</span></span> 255<span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">hostname</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">AP001b</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.d542</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1d2c</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">AP001b</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.d542</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1d2c</span></span># <span class="hljs-selector-tag"><span class="hljs-selector-tag">Translating</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">CISCO-CAPWAP-CONTROLLER</span></span>"..<span class="hljs-selector-class"><span class="hljs-selector-class">.domain</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">server</span></span> (255<span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">AP001b</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.d542</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1d2c</span></span># *<span class="hljs-selector-tag"><span class="hljs-selector-tag">Dec</span></span> 28 02<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:26</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:04.306</span></span>: %<span class="hljs-selector-tag"><span class="hljs-selector-tag">CAPWAP-3-ERRORLOG</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">Did</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">not</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">get</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">log</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">server</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">settings</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">from</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">DHCP</span></span>. <span class="hljs-selector-tag"><span class="hljs-selector-tag">Translating</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">CISCO-LWAPP-CONTROLLER</span></span>"..<span class="hljs-selector-class"><span class="hljs-selector-class">.domain</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">server</span></span> (255<span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span>) *<span class="hljs-selector-tag"><span class="hljs-selector-tag">Dec</span></span> 28 02<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:26</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:13.307</span></span>: %<span class="hljs-selector-tag"><span class="hljs-selector-tag">CAPWAP-3-ERRORLOG</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">Could</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Not</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">resolve</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">CISCO-CAPWAP-CONTROLLER</span></span> *<span class="hljs-selector-tag"><span class="hljs-selector-tag">Dec</span></span> 28 02<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:26</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:22.308</span></span>: %<span class="hljs-selector-tag"><span class="hljs-selector-tag">CAPWAP-3-ERRORLOG</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">Could</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Not</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">resolve</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">CISCO-LWAPP-CONTROLLER</span></span> *<span class="hljs-selector-tag"><span class="hljs-selector-tag">Dec</span></span> 28 02<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:26</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:32.309</span></span>: %<span class="hljs-selector-tag"><span class="hljs-selector-tag">CAPWAP-3-ERRORLOG</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">Go</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">join</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">capwap</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">controller</span></span> *<span class="hljs-selector-tag"><span class="hljs-selector-tag">Mar</span></span> 16 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:18</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:26.000</span></span>: %<span class="hljs-selector-tag"><span class="hljs-selector-tag">CAPWAP-5-DTLSREQSEND</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">DTLS</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">connection</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">request</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">sent</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">peer_ip</span></span>: 10<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.191</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.4</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">peer_port</span></span>: 5246 *<span class="hljs-selector-tag"><span class="hljs-selector-tag">Mar</span></span> 16 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:18</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:28.500</span></span>: %<span class="hljs-selector-tag"><span class="hljs-selector-tag">CAPWAP-5-DTLSREQSUCC</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">DTLS</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">connection</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">created</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">sucessfully</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">peer_ip</span></span>: 10<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.191</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.4</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">peer_port</span></span>: 5246 *<span class="hljs-selector-tag"><span class="hljs-selector-tag">Mar</span></span> 16 10<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:18</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:28.502</span></span>: %<span class="hljs-selector-tag"><span class="hljs-selector-tag">CAPWAP-5-SENDJOIN</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sending</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Join</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Request</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.191</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.4</span></span></code> </pre> <br><p>  Now we will try to place the access point in another VLAN, having previously reset its configuration.  Connection does not occur. </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">delphi</span></span> *<span class="hljs-selector-tag"><span class="hljs-selector-tag">Dec</span></span> 28 01<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:55</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:27.942</span></span>: %<span class="hljs-selector-tag"><span class="hljs-selector-tag">DHCP-6-ADDRESS_ASSIGN</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">Interface</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BVI1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">assigned</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">DHCP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">address</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">mask</span></span> 255<span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">hostname</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">AP001b</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.d542</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1d2c</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Translating</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">CISCO-CAPWAP-CONTROLLER</span></span>"..<span class="hljs-selector-class"><span class="hljs-selector-class">.domain</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">server</span></span> (255<span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span>) *<span class="hljs-selector-tag"><span class="hljs-selector-tag">Dec</span></span> 28 01<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:55</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:32.817</span></span>: %<span class="hljs-selector-tag"><span class="hljs-selector-tag">CAPWAP-3-ERRORLOG</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">Did</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">not</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">get</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">log</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">server</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">settings</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">from</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">DHCP</span></span>. <span class="hljs-selector-tag"><span class="hljs-selector-tag">Translating</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">CISCO-LWAPP-CONTROLLER</span></span>"..<span class="hljs-selector-class"><span class="hljs-selector-class">.domain</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">server</span></span> (255<span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span>) *<span class="hljs-selector-tag"><span class="hljs-selector-tag">Dec</span></span> 28 01<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:55</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:41.817</span></span>: %<span class="hljs-selector-tag"><span class="hljs-selector-tag">CAPWAP-3-ERRORLOG</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">Could</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Not</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">resolve</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">CISCO-CAPWAP-CONTROLLER</span></span> *<span class="hljs-selector-tag"><span class="hljs-selector-tag">Dec</span></span> 28 01<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:55</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:50.818</span></span>: %<span class="hljs-selector-tag"><span class="hljs-selector-tag">CAPWAP-3-ERRORLOG</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">Could</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Not</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">resolve</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">CISCO-LWAPP-CONTROLLER</span></span>*<span class="hljs-selector-tag"><span class="hljs-selector-tag">Dec</span></span> 28 01<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:56</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:36.324</span></span>: %<span class="hljs-selector-tag"><span class="hljs-selector-tag">CAPWAP-3-DHCP_RENEW</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">Could</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">not</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">discover</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">WLC</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">using</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">DHCP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span>. <span class="hljs-selector-tag"><span class="hljs-selector-tag">Renewing</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">DHCP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span>.</code> </pre> <br><p>  The broadcast request does not fall on the Management interface of the controller, since the access point is in a different VLAN. </p><br><p>  In this case, you can forcibly redirect the broadcast request to the Management interface of the controller.  To do this, it is necessary to activate the redirection of broadcast traffic on UDP port 5246 using the command </p><br><pre> <code class="hljs swift">forward-<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">udp</span></span></span><span class="hljs-class"> 5246</span></span></code> </pre> <br><p>  and prescribe on the third level interface </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">ip</span></span> helper-address [ ]</code> </pre> <br><p>  In the switch configuration, it looks like this: </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">CAT2</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">config</span></span>)<span class="hljs-selector-id"><span class="hljs-selector-id">#ip</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">forward-protocol</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">udp</span></span> 5246 <span class="hljs-selector-tag"><span class="hljs-selector-tag">CAT2</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">config</span></span>)<span class="hljs-selector-id"><span class="hljs-selector-id">#int</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">vlan</span></span> 192 <span class="hljs-selector-tag"><span class="hljs-selector-tag">CAT2</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">config-if</span></span>)<span class="hljs-selector-id"><span class="hljs-selector-id">#ip</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">helper-address</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.191</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.4</span></span></code> </pre> <br><p>  Then the broadcast request will also go to the controller and the point will connect to the controller. </p><br><h3 id="2-lokalnyy-spisok-nvram">  2) Local NVRAM list </h3><br><p>  The access point looks at its own list of controllers, which is stored in NVRAM non-volatile memory.  The following information is stored in NVRAM.  Primary, Secondary and Tertiary controller, pre-configured on the access point.  These settings can be set both on the access point itself through the CLI, and, if the access point is connected to the controller, through the controller (via the CLI or the web).  The last connected controller and its mobility members are in the same group.  There are some minor discrepancies in the documentation, which will be discussed below in the appropriate section. </p><br><h4 id="primary-secondary-i-tertiary-kontroller">  Primary, Secondary and Tertiary controller </h4><br><p>  At the access point information about the controller can be set by two commands.  One of them is capwap ap controller ip address. </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">delphi</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">AP001b</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.d542</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1d2c</span></span><span class="hljs-selector-id"><span class="hljs-selector-id">#capwap</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ap</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">controller</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ip</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">address</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.191</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.4</span></span> *<span class="hljs-selector-tag"><span class="hljs-selector-tag">Dec</span></span> 28 01<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:57</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:11.888</span></span>: %<span class="hljs-selector-tag"><span class="hljs-selector-tag">CAPWAP-3-ERRORLOG</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">Go</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">join</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">capwap</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">controller</span></span></code> </pre> <br><p>  The action of this command is displayed in two conclusions: </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">delphi</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">AP001b</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.d542</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1d2c</span></span><span class="hljs-selector-id"><span class="hljs-selector-id">#sh</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">capwap</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ip</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">config</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">LWAPP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Static</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Configuration</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Address</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.102</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">netmask</span></span> 255<span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Default</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Gateway</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Primary</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Controller</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.191</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span></code> </pre> <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">delphi</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">AP001b</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.d542</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1d2c</span></span><span class="hljs-selector-id"><span class="hljs-selector-id">#sh</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">capwap</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cli</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">con</span></span> ... <span class="hljs-selector-tag"><span class="hljs-selector-tag">mwarName</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mwarIPAddress</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.191</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.4</span></span></code> </pre> <br><p>  That is, on the one hand, the controller writes it into the static IP configuration, on the other hand, it sets it as Primary.  If tricky manipulations leave or in one place or another, it still connects to this controller. </p><br><p>  Primary, Secondary or Tertiary on the access point can be set using the commands: </p><br><pre> <code class="hljs pgsql">capwap ap <span class="hljs-keyword"><span class="hljs-keyword">primary</span></span>-base [wlc_sysname] [IP]; capwap ap secondary-base [wlc_sysname] [IP]; capwap ap tertiary-base [wlc_sysname] [IP]; delphi AP001b.d542<span class="hljs-number"><span class="hljs-number">.1</span></span>d2c#capwap ap <span class="hljs-keyword"><span class="hljs-keyword">primary</span></span>-base wlc2504 <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.191</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span> *<span class="hljs-type"><span class="hljs-type">Dec</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">57</span></span>:<span class="hljs-number"><span class="hljs-number">44.901</span></span>: %CAPWAP<span class="hljs-number"><span class="hljs-number">-3</span></span>-ERRORLOG: Selected MWAR <span class="hljs-string"><span class="hljs-string">'wlc2504'</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>). *<span class="hljs-type"><span class="hljs-type">Dec</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">57</span></span>:<span class="hljs-number"><span class="hljs-number">44.901</span></span>: %CAPWAP<span class="hljs-number"><span class="hljs-number">-3</span></span>-ERRORLOG: Go <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> a capwap controller AP001b.d542<span class="hljs-number"><span class="hljs-number">.1</span></span>d2c#sh capwap client config .. mwarName wlc2504 mwarIPAddress <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.191</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span></code> </pre> <br><p>  It is not necessary to specify Primary, you can only specify Secondary: </p><br><pre> <code class="hljs pgsql">delphi AP001b.d542<span class="hljs-number"><span class="hljs-number">.1</span></span>d2c#capwap ap secondary-base wlc2504 <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.191</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span> *<span class="hljs-type"><span class="hljs-type">Dec</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">57</span></span>:<span class="hljs-number"><span class="hljs-number">04.097</span></span>: %CAPWAP<span class="hljs-number"><span class="hljs-number">-3</span></span>-ERRORLOG: Selected MWAR <span class="hljs-string"><span class="hljs-string">'wlc2504'</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>). *<span class="hljs-type"><span class="hljs-type">Dec</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">57</span></span>:<span class="hljs-number"><span class="hljs-number">04.097</span></span>: %CAPWAP<span class="hljs-number"><span class="hljs-number">-3</span></span>-ERRORLOG: Go <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> a capwap controller</code> </pre> <br><p>  Primary, Secondary, Tertiary controllers can also be registered not only through the console of the access point, but also through the CLI or the web interface of the controller (if the point is already connected to some controller). </p><br><pre> <code class="hljs css">(<span class="hljs-selector-tag"><span class="hljs-selector-tag">Cisco</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Controller</span></span>) &gt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">config</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ap</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">secondary-base</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">wlc2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">AP001b</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.d542</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1d2c</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.191</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.5</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">delphi</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">AP001b</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.d542</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1d2c</span></span><span class="hljs-selector-id"><span class="hljs-selector-id">#sh</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">capwap</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cli</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">con</span></span> .. <span class="hljs-selector-tag"><span class="hljs-selector-tag">mwarName</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">wlc2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mwarIPAddress</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.191</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.5</span></span></code> </pre> <br><h4 id="posledniy-podklyuchennyy-kontroller-i-ego-mobility-members-v-toy-zhe-gruppe">  The last connected controller and its mobility members are in the same group. </h4><br><p>  As described above, there are small differences on this item.  For example </p><br><ul><li>  In the <a href="http://www.cisco.com/c/en/us/td/docs/wireless/controller/8-0/configuration-guide/b_cg80/b_cg80_chapter_011110.html">Configuration Guide,</a> software version 8.0 is not written about this, only about Primary, Secondary or Tertiary controllers, as well as in <a href="http://www.cisco.com/c/en/us/support/docs/wireless/5500-series-wireless-controllers/119286-lap-notjoin-wlc-tshoot.html">Troubleshooting Technote</a> </li><li>  if you look at another <a href="http://www.cisco.com/c/en/us/support/docs/wireless-mobility/wireless-lan-wlan/70333-lap-registration.html">Troubleshooting Technote</a> and the previously mentioned book "Deploying and Troubleshooting Cisco Wireless LAN Controllers", it says that NVRAM stores information about the last connected controller and its Mobilibty Members in the same group. </li><li>  in another <a href="http://www.cisco.com/c/en/us/support/docs/wireless-mobility/wireless-mobile/71963-apload-apfall-uwn.html">document</a> it is written that the access point forgets when rebooting all the information about mobilibty members, but remembers the last connected controller: "Remember that the AP forgets the mobility members across reboots." <br>  To begin with, with the help of tests, I tried to find out whether the access point forgets about all mobility members when it reboots. </li></ul><br><p>  Mobility members are displayed in the "Configured Switch X" construction of the show capwap client config output: </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">delphi</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">AP001b</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.d542</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1d2c</span></span><span class="hljs-selector-id"><span class="hljs-selector-id">#sh</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">capw</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cli</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">con</span></span> ... <span class="hljs-selector-tag"><span class="hljs-selector-tag">Configured</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Switch</span></span> 1 <span class="hljs-selector-tag"><span class="hljs-selector-tag">Addr</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.191</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.4</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Configured</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Switch</span></span> 2 <span class="hljs-selector-tag"><span class="hljs-selector-tag">Addr</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.193</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.4</span></span></code> </pre> <br><p>  Pre-access points were placed in an isolated VLAN and all Discovery mechanisms, except through NVRAM excluded (including Primary, Secondary and Tertiary).  Tests were conducted on software 8.0.140.0 (15.3 (3) JA10). </p><br><p>  The access point was connected to the controller 10.0.193.4, on which the controller 10.0.191.4 was registered in the same Mobilibty Group.  When rebooting, the access point was connected to the controller 10.0.191.4 (the point was in a different VLAN and broadcast discovery could not work). </p><br><p>  That is, in these tests, the information from the header was confirmed: the access point, at least in this version of the software, stores in NVRAM information about the mobility members of the same group and sends them discovery request. </p><br><p>  The last controller to which the access point is connected, technically, is also the mobility member of the same group.  During the tests, the access point saved the data about the last connected controller in the "Configured Switch 1" entry. </p><br><h3 id="3-dhcp-option-43">  3) DHCP Option 43 </h3><br><p>  The most commonly used method in installations is to transfer the controller's address in the 43rd option of the DHCP offer package, along with the IP address. </p><br><p>  The controller address is written as follows (in hexadecimal form): </p><br><pre> <code class="hljs markdown">f1[<span class="hljs-string"><span class="hljs-string">  * 4</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">IP  ()</span></span>]</code> </pre> <br><p>  For example, for controllers 10.0.191.4 and 10.0.191.5, option 43 looks like this: </p><br><pre> <code class="hljs">f1080a00bf040a00bf05</code> </pre> <br><p>  For the switch, the syntax is: </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">CAT2</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">dhcp-config</span></span>)<span class="hljs-selector-id"><span class="hljs-selector-id">#option</span></span> 43 <span class="hljs-selector-tag"><span class="hljs-selector-tag">hex</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">f108</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0a00</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.bf04</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0a00</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.bf05</span></span></code> </pre> <br><p>  Output from the access point: </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">delphi</span></span> *<span class="hljs-selector-tag"><span class="hljs-selector-tag">Dec</span></span> 28 01<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:56</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:13.045</span></span>: %<span class="hljs-selector-tag"><span class="hljs-selector-tag">DHCP-6-ADDRESS_ASSIGN</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">Interface</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BVI1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">assigned</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">DHCP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">address</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">mask</span></span> 255<span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">hostname</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">AP001b</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.d542</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1d2c</span></span> *<span class="hljs-selector-tag"><span class="hljs-selector-tag">Dec</span></span> 28 01<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:56</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:23.945</span></span>: %<span class="hljs-selector-tag"><span class="hljs-selector-tag">CAPWAP-5-DHCP_OPTION_43</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">Controller</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">address</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.191</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.4</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">obtained</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">through</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">DHCP</span></span> *<span class="hljs-selector-tag"><span class="hljs-selector-tag">Dec</span></span> 28 01<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:56</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:23.945</span></span>: %<span class="hljs-selector-tag"><span class="hljs-selector-tag">CAPWAP-5-DHCP_OPTION_43</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">Controller</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">address</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.191</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.5</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">obtained</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">through</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">DHCP</span></span> *<span class="hljs-selector-tag"><span class="hljs-selector-tag">Dec</span></span> 28 01<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:56</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:51.950</span></span>: %<span class="hljs-selector-tag"><span class="hljs-selector-tag">CAPWAP-3-ERRORLOG</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">Go</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">join</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">capwap</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">controller</span></span></code> </pre> <br><p>  If you configure only option 43, then in this case it will be returned to everyone, without exception, not only to access points. </p><br><p>  If you want this option to be returned only to Cisco access points, then there is the possibility of checking the VCI (Vendor class identifier) ‚Äã‚Äãin DHCP discover.  Each model of the access point transmits a specific VCI to DHCP discover.  If you prescribe Option 60 on the DHCP server with the corresponding VCI, then option 43 will be issued only to those clients who send exactly the same VCI in the request. </p><br><p>  The idea is to not pass the 43rd option to those who do not need it.  But there is another point.  If there are access points of two different series in the same pool, not all DHCP servers support the ability to specify multiple VCIs, this should be checked first. </p><br><h3 id="4-dns">  4) DNS </h3><br><p>  The access point attempts to resolve DNS names CISCO-CAPWAP-CONTROLLER.local-domain or CISCO-LWAPP-CONTROLLER.local-domain. </p><br><p>  To do this, on the access point (in the DHCP pool) you need to register a DNS server and domain.  Configure the DNS server accordingly. </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">CAT2</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">dhcp-config</span></span>)<span class="hljs-selector-id"><span class="hljs-selector-id">#dns-server</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.191</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.8</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">CAT2</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">dhcp-config</span></span>)<span class="hljs-selector-id"><span class="hljs-selector-id">#domain</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">test</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.local</span></span></code> </pre> <br><p>  After receiving the address, the controller can resolve the name and use the IP address in Discovery Phase. </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">delphi</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Translating</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">CISCO-CAPWAP-CONTROLLER</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.test</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.local</span></span>"..<span class="hljs-selector-class"><span class="hljs-selector-class">.domain</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">server</span></span> (10<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.191</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.4</span></span>) <span class="hljs-selector-attr"><span class="hljs-selector-attr">[OK]</span></span></code> </pre> <br><p>  After searching for all controllers, sending them a Discovery request, receiving a Discovery response, a list of controllers is formed, on the basis of which it is decided which controller to try to connect to (send a Join Request). </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/325196/">https://habr.com/ru/post/325196/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../325186/index.html">Integrating XML data is another way.</a></li>
<li><a href="../325188/index.html">Fake promises, aggressive ads, trojan downloaders and other Google Play surprises</a></li>
<li><a href="../325190/index.html">I write as I want, or All for a meeting with ruHaskell in Kaspersky Lab</a></li>
<li><a href="../325192/index.html">Video review service HostTracker</a></li>
<li><a href="../325194/index.html">Passing configuration parameters to Autofac modules in ASP.NET Core</a></li>
<li><a href="../325198/index.html">Qt: Embedded World 2017 and roadmap</a></li>
<li><a href="../325200/index.html">Employee conversations with the company: how and why?</a></li>
<li><a href="../325202/index.html">Reincarnation of the PIX graphics debugger for DirectX 12</a></li>
<li><a href="../325204/index.html">Using code blocks from Objective-C to Delphi on macOS: how we built bridges</a></li>
<li><a href="../325206/index.html">Recommender systems in online education. Adaptive learning</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>