<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Evolution of malicious extensions: from amateur handicrafts to steganography. Experience team Yandex. Browser</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Extensions are a great tool for adding new features to the browser. And with their help they secretly embed advertising, steal data, send spam and eve...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Evolution of malicious extensions: from amateur handicrafts to steganography. Experience team Yandex. Browser</h1><div class="post__text post__text-html js-mediator-article">  Extensions are a great tool for adding new features to the browser.  And with their help they secretly embed advertising, steal data, send spam and even mine-cryptocurrencies.  Today we will share with you our experience in dealing with such extensions, you will learn about the main distribution channels of dubious developments and how to disguise the malicious entity from moderators and scanners. <br><br><img src="https://habrastorage.org/webt/wq/11/zu/wq11zuu1wygmhtal2cdkcchd5he.png"><br><br>  Yandex.Browser initially supported the installation of extensions for Chromium, but at first the earning industry on add-ons was still in its infancy, so there were no special problems.  Malicious samples, of course, met: we either found them ourselves, or found out about them from support calls.  The unique identifiers (IDs) of such developments were blacklisted on the server, which Yandex.Browser accessed via the API and blocked the installation of potentially dangerous extensions.  And the extensions themselves were very rarely camouflaged: all their capabilities were almost always explicitly described in HTML and JS without trying to hide something.  But then everything changed. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>  The rapid growth of popularity of Chromium and the ability to automatically install any extensions without confirmation from the user played a cruel joke.  Developers of dangerous add-ons did not need to even publish to the Web Store and promote their creation there.  It was enough to disguise the extension for a useful utility, a popular game or a new film that had not even reached the cinema.  The users themselves found, downloaded and launched exe-files that threw crx-extensions into the browser profile.  How do we know about this?  Very simple: about a third of the appeals in support began to contain complaints about low-quality and shocking advertisements that floated on top of their favorite sites in the Browser. <br><br>  Something like this for some users started to look like YouTube.  This is a fresh screenshot, but over the years the symptoms have changed little.  Count how many foreign ad units are there: <br><br><img src="https://habrastorage.org/webt/vb/aq/lr/vbaqlrcotd4md6t_a2ry6_o4j5g.png"><br><br><div class="spoiler">  <b class="spoiler_title">Other terrible examples</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/gr/b1/tr/grb1tr8rxty4iffrdozgkoaeuma.png"><br><br><img src="https://habrastorage.org/webt/lh/cc/oa/lhccoa3icfcukvwm4dlecis8ltu.png"><br><br><img src="https://habrastorage.org/webt/ar/-r/ea/ar-reamplfgmzi8vagbgt_-1xgo.png"><br><br><img src="https://habrastorage.org/webt/qo/es/ct/qoesctuzdtxusp_vjli3jvi7mpe.png"><br><br><img src="https://habrastorage.org/webt/k4/ky/hm/k4kyhm-szgjiioiz9wkfuryjyjw.png"><br></div></div><br><br>  Most of the affected users did not know anything about any extensions, blamed us and deleted Yandex.Browser.  Quiet time is over. <br><br>  <b>From blacklist to hashing</b> <br><br>  Soon enough, we found an opportunity to slow down the growth of the threat.  First of all, they turned off support for those documented Chromium mechanisms that simplified the work for developers of bad extensions.  In the usual version of the Browser, we restricted the ability to install extensions through <a href="https://developer.chrome.com/extensions/external_extensions">the registry key</a> and forbade the use of corporate <a href="https://support.google.com/chrome/a/answer/188453">policies</a> , which, by the way, were especially popular with Malvari developers, because they did not allow users to delete extensions. <br><br><img src="https://habrastorage.org/webt/sv/xh/3l/svxh3l5cxksz9ryrdfntsq03hg4.png"><br><br>  We also created a ‚Äúheadquarters‚Äù to combat the new threat, which in real-time received information about extensions distributed among Browser users, could quickly check suspicious ones and block them by ID.  And for a while this solved the problem. <br><br>  Lovers of easy money, who lost convenient installation methods and time advantages, tensed and struck back.  In the Windows operating system, any application can interfere with the operation of any other application, which they started using against Yandex Browser.  Doubtful programs have learned to throw extensions directly into the browser profile folder, making changes to the settings files.  But this is not the most interesting. <br><br>  The cunning ones understood that we learned about such extensions very quickly, so we found a simple but effective way to prevent blocking by ID.  They just started using the same ID as the popular extensions.  For example, we could not disable a bad extension with the identifier pioclpoplcdbaefihamjohnefbikjilc, because then a good Evernote Web Clipper would stop working.  Cleverly.  As a result, we beat off this blow, but at what cost. <br><br>  The solution was found in comparing the hash of the installed extension with the hash of the original Stora extension.  If they do not match, then overwrite the folder with a safe copy.  The problem is that the method worked only for those supplements that were published in Store.  All the others simply have nothing to compare.  Therefore, in 2014 we allowed to install extensions only from trusted sources, which included the Web Store, Opera Addons and our own catalog.  With this decision we managed to drive the majority of malicious extensions into Stores, where, as we hoped, the harsh rules and moderation would bring their numbers to a historic minimum.  But we were wrong. <br><br>  5 dollars.  That is how much it costs to have a developer account in the Web Store catalog.  But professionals on the other side of the barricades are ready to spend money on the generation of accounts and clones of dubious extensions.  And then they can only find the source of users.  And there are several such methods. <br><br>  <b>Mimicry</b> <br><br>  You can copy the name, design and even code from a popular extension to get into the search results in the Web Store.  Unfortunately, this method flourishes due to the lack of pre-moderation in the directory.  For example, recently there was a <a href="https://twitter.com/SwiftOnSecurity/status/917446126382526464">case</a> with a fake AdBlock Plus, which installed 37 thousand users.  By the time this tweet appeared on Twitter, it was already blocked in our Browser.  And not only that.  The media wrote about one case, but in reality there were about 10 copies of a fake ad blocker.  They behaved relatively modestly: they allegedly did not steal anything, but suddenly opened tabs with advertising.  For example, the tab with the address settingsbrowser.online, which redirects to the advertised services and applications. <br><br><img src="https://habrastorage.org/webt/kh/q6/kd/khq6kdi8nhtv8-1oklcywkddthw.png"><br><br>  <b>Distribution via third-party programs</b> <br><br>  You take a popular utility and repack it so that the installer not only installs the utility itself, but also throws your extension into the profile folder.  Then you create a fake official website, which users get through spam.  Although now few people are so bother.  It is much easier to use one of the affiliate programs, to which the developers of free applications for monetization are connected.  Usually this method is easily recognized by the speed of distribution of the add-on among users of the browser. <br><br>  There is another way to understand that we have disabled the useless extension with malicious features - neither users nor developers almost do not come to us with complaints.  Some, however, try to cheat and add an exception to the code for Yandex. Browser.  It works like this.  If the user has Yandex Browser, then he receives no bad surprises, unlike Google Chrome users.  It would seem that this is a problem of other Chromium based browsers, but no.  We consider this behavior a hoax and do not remove blocking. <br><br><img src="https://habrastorage.org/webt/p6/q7/td/p6q7tdj4si_9ei_nhjer2a0omek.png"><br><br>  <b>Inline installation</b> <br><br>  Any site has the ability to distribute its official extension, published in the Chrome Web Store.  Just click on the button in the pop-up panel, and the add-on will be in the browser.  It remains only to persuade the person to click.  For example, a site can go to full-screen mode and simulate a browser lock, which can only be removed using an extension (a <a href="http://spycompany.ru/chrome/">live example</a> ). <br><br><img src="https://habrastorage.org/webt/3p/c5/ar/3pc5arodtqq87llqnnr-cto_t-g.png"><br><br>  Or consider another real-life example, which our colleagues talked about last year at <a href="https://www.botconf.eu/wp-content/uploads/2016/11/PR03-Browser-based-Malware-Evolution-and-Prevention-KOVALEV-SIDOROV.pdf">Botconf 2016</a> , but the epidemic continues to this day (these are dozens of clones blocked by us). <br><br>  Facebook user receives a personal message from his friend, which contains a link to the video. <br><br><img src="https://habrastorage.org/webt/hb/4v/qz/hb4vqzuuubfxzodcmfopg0ozvf8.png"><br><br>  After clicking on the link, a page opens ( <a href="https://docs.google.com/file/d/0B7rArSLkL3A-dk9ZNVp1NzRUWjg/preview">example</a> , <a href="https://docs.google.com/file/d/0BzsMb9bHTqCpSUxzTzVPdzVfMDQ/preview">another example</a> ), created on the basis of an authoritative free file storage service, where instead of a video is a regular screenshot. <br><br><img src="https://habrastorage.org/webt/yb/00/kb/yb00kbdtfymoexunf8qntwz_hdy.png"><br><br>  This is a layer between spam on Facebook and those sites where extensions are ‚Äúoffered‚Äù or other ads are posted.  It is needed for the following reasons.  Firstly, social networks and antiviruses do not block all addresses on authoritative domains using a mask.  Secondly, generating pages on free services is easier and faster than registering a new site and linking it to an extension.  Thirdly, such links look safe, and users are more likely to click on them. <br><br>  The user clicks on the fake screenshot and gets on the <a href="https://video-yiu.blogspot.com/">site</a> , which simulates the appearance of YouTube and is based on the service for blogs.  Any attempt to start the video will be prompted to install the extension. <br><br>  An important clarification: right now the page on docs.google.com can redirect not to the specified site, but to another advertisement, because the extension has just been blocked in the catalog, and the author needs to spend time creating a new site-extension bundle.  We have already disabled more than 50 extensions from this family, but they continue to appear. <br><br><img src="https://habrastorage.org/webt/jp/e3/hd/jpe3hdvx4e3kfzmnwgurxxhjgtc.png"><br><br>  If a person agrees, now he will, against his will, become a source of spam on Facebook. <br><br>  Moreover, extensions from this family are able to protect themselves.  Pay attention to the review: <br><br><img src="https://habrastorage.org/webt/g1/gf/nn/g1gfnnr4ody66psmusxo_dzjyaw.png"><br><br>  It says that the extension does not allow you to open the chrome: // extensions service page in Chromium (immediately closes it).  Using this page is usually recommended to check the list of extensions and remove suspicious.  At one time, we also encountered this trick, so in the Yandex Browser the browser: // tune page is isolated from extensions. <br><br>  <b>Partnership programs</b> <br><br>  You can not bother with the creation of their extensions, pages and spam, but simply buy a ready-made popular extension and roll out a new version with a surprise (users will not find out about the sale or the release of the new version).  Or even create an affiliate program for developers who, in exchange for money, will add your script to their extensions.  On average, in the hospital, partners earn 100 rubles per day for every 1500 users.  Finding affiliate programs is not difficult.  By the way, it is very pleasant to read <a href="https://searchengines.guru/showpost.php%3Fp%3D15291534%26postcount%3D322">similar</a> comments on the forums of such programs.  No wonder we are working;) <br><br><img src="https://habrastorage.org/webt/i1/2_/-c/i12_-csmksscoagy0qkhrdj9gcw.png"><br><br>  The owners of the affiliate program are ready not only to give their library, but also to create a ready-made extension.  The partner will only be required to publish and find traffic. <br><br>  As you understand, I want to discourage any investment of funds, so the developers of questionable scripts work not only on quantity, but also on ‚Äúquality‚Äù, where by the latter we mean the ability to hide our essence from moderators and automated scanners.  The harder it is to find evidence, the longer the expansion will work and the more money it will bring.  And in this area for several years there was a significant jump. <br><br>  <b>From concatenation to steganography</b> <br><br>  It all started with a primitive concatenation, when a deliberately dangerous code was broken into separate letter fragments.  Approximately as in the screenshot.  It was naive, but the first inventors might have helped. <br><br><img src="https://habrastorage.org/webt/qh/xr/qe/qhxrqeniz-mztuwpkagpqsjcnfa.png"><br><br>  We should also say about obfuscation.  There is a myth that obfuscation can disguise any logic, but it works exactly the opposite.  In reality, this is the most inept way to disguise, because it attracts almost everyone‚Äôs attention: antiviruses swear at it, users get scared, moderators check such extensions first.  Want to get you out of Stora as quickly as possible?  Use code obfuscation. <br><br>  Far smarter are those who maintain the visibility of a decent code, but carry its malicious parts across different modules, confuse the tracks, communicate with themselves using localStorage.  Some parts can even be loaded from an external server.  And not for all countries (to attract the attention of moderators somewhere in the USA is easier than in Russia), not for all browsers (again, exceptions for Yandex Browser, as in the example above), not in the first days of the extension (to make it harder manual check). <br><br>  In April of this year, among the developers of dubious extensions, a new fashion began to emerge.  Take a look at this picture: <br><br><img src="https://habrastorage.org/webt/ti/m4/vv/tim4vvsxdvlu1z_w0_ujjxdxdrc.png"><br><br>  Noticed anything unusual except compression artifacts?  And now let's look through the debugger on the work of the extension that contains this image: <br><br><img src="https://habrastorage.org/webt/kt/bg/ks/ktbgks6rli4n_soncdpehprxff0.png"><br><br>  The extension extracts part of the code from the image.  This technique is called "steganography", and it is well known for viruses for Windows, but it only reached extensions in the spring.  Now this method is combined with all the above, and it is found in dozens of extensions ( <a href="https://chrome.google.com/webstore/detail/do-it/eppncnmppghbndacgkideegigaminkfg">71 thousand users</a> , <a href="https://chrome.google.com/webstore/detail/zaycevmusic-player/pjnpodlfabdamphbfolfmfbcaphhjhhf">11 thousand users</a> ).  According to our assessment, all these extensions use a script from one author, or rather from one affiliate program, which we are now closely watching.  Of course, we catch and disable these extensions, because we do not rely only on our eyes and hands. <br><br>  <b>Machine learning</b> <br><br>  We managed to establish a semi-automatic process to identify questionable extensions and disable them.  It works approximately as follows.  As soon as any new extension appears, and it is started to be installed in the Yandex Browser, the analysis process starts on our servers.  We use machines that are constantly trained in already known bad samples to assess the degree of danger of new ones.  Explicit abuses are blocked automatically.  Questionable pass through manual control. <br><br>  We have learned how to catch not only those projects that steal passwords, redirect to phishing pages or secretly change / add their advertising to the pages.  We also do not miss extensions, secretly replacing links on pages (including for earnings on affiliate programs) and unexpectedly opening tabs with advertised sites.  We do not approve of the extraction of cryptocurrency, if the user has not given his explicit consent.  We prohibit imitating clicks and other user actions (for example, to cheat likes or send spam on social networks). <br><br>  For obvious reasons, we cannot disclose the details of the work of our scanners and the factors used in machine learning (we say hello to talented developers of dubious scripts).  We can only say that thanks to this process, most malicious add-ons are disabled in the Yandex Browser 1-3 days after the start of their life.  This is more than a hundred unique extensions per month and tens of thousands of protected users. <br><br>  <b>What's next?</b> <br><br>  No matter how surprising it may have sounded, but it is in RuNet that new methods of cheating users and browsers are being introduced, which are then ‚Äúexported‚Äù further.  Now we are opposed not by amateurs, but by a whole industry of creators and distributors of dangerous extensions, who sooner or later will find another way to surprise us.  We believe that we will find something to answer them, but there is no perfect protection, therefore, there will always be malicious extensions that we have not disabled yet.  And here the help of the whole community will be useful.  If you come across such developments, you can safely send information to our team (both through <a href="https://browser.yandex.ru/feedback/">support</a> and in a personal on Habr√©).  We will also be grateful for any ideas and information that will help protect users from unpleasant surprises. </div><p>Source: <a href="https://habr.com/ru/post/341382/">https://habr.com/ru/post/341382/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../341372/index.html">C ++ User Group News</a></li>
<li><a href="../341374/index.html">6 IT infrastructure trends: forecast for 2018</a></li>
<li><a href="../341376/index.html">Pebble Kombat. Javascript Watch Game Development History</a></li>
<li><a href="../341378/index.html">DotNext 2017 Moscow: the return of hardcore</a></li>
<li><a href="../341380/index.html">CarPrice in Japan: features of the national auto auction</a></li>
<li><a href="../341384/index.html">Talk with ghosts: Ada Lovelace</a></li>
<li><a href="../341386/index.html">Introducing loghouse - an open source system for working with logs in Kubernetes</a></li>
<li><a href="../341390/index.html">Bid optimization: the relationship between the cost per click and the set rate</a></li>
<li><a href="../341392/index.html">HEIF - a new standard format for storing images in iOS and MacOS</a></li>
<li><a href="../341394/index.html">Announcement of Moscow Spark # 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>