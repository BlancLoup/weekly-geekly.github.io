<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Warp9 is another reactive js library. At this time composable and without leaks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The article is outdated, look for current information on the site Warp9'a 



 There are many reactive and near-reactive libraries for creating a grap...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Warp9 is another reactive js library. At this time composable and without leaks</h1><div class="post__text post__text-html js-mediator-article">  The article is outdated, look for current information on the site <a href="http://rystsov.github.io/warp9/">Warp9'a</a> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/309/65f/2cb/30965f2cba56caa521adf76817ee4782.png"><br><br>  There are many reactive and near-reactive libraries for creating a graphical interface on js: Angular, Knockout, React, RxJS ... One wonders why write another one.  It turns out that in all of them, in addition to the fatal flaw, there are a few more. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><table><tbody><tr><th></th><th>  AngularJS </th><th>  Knockout </th><th>  React </th><th>  Elm </th><th>  RxJS, Bacon </th><th>  ReactiveCoffee </th><th>  Warp9 </th></tr><tr><td>  <a href="https://habr.com/ru/post/198158/">template based</a> </td><td>  yes / no <a href="https://habr.com/ru/post/198158/">[1]</a> </td><td>  yes </td><td>  no </td><td>  no </td><td></td><td>  no </td><td>  no </td></tr><tr><td>  <a href="https://habr.com/ru/post/198158/">controls composability</a> </td><td>  no <a href="https://habr.com/ru/post/198158/">[2]</a> <a href="https://habr.com/ru/post/198158/">[3]</a> </td><td>  no <a href="https://habr.com/ru/post/198158/">[2]</a> </td><td>  yes </td><td>  yes </td><td></td><td>  yes </td><td>  yes </td></tr><tr><td>  <a href="https://habr.com/ru/post/198158/">modularization of controls</a> </td><td>  yes / no <a href="https://habr.com/ru/post/198158/">[4]</a> </td><td>  no </td><td>  yes </td><td>  maybe </td><td></td><td>  yes </td><td>  yes </td></tr><tr><td>  <a href="https://habr.com/ru/post/198158/">2 way binding</a> </td><td>  yes / no <a href="https://habr.com/ru/post/198158/">[5]</a> </td><td>  yes </td><td>  no </td><td>  yes </td><td>  yes </td><td>  yes </td><td>  yes </td></tr><tr><td>  <a href="https://habr.com/ru/post/198158/">accidental memory leaks</a> </td><td>  no </td><td>  yes </td><td>  no </td><td>  no </td><td>  no </td><td>  yes </td><td>  no </td></tr><tr><td>  <a href="https://habr.com/ru/post/198158/">todomvc</a> </td><td>  yes </td><td>  yes </td><td>  yes </td><td>  no </td><td>  maybe </td><td>  yes / no <a href="https://habr.com/ru/post/198158/">[6]</a> </td><td>  yes </td></tr><tr><td>  <a href="https://habr.com/ru/post/198158/">headless</a> </td><td>  no </td><td>  yes </td><td>  no </td><td>  no </td><td>  yes </td><td>  yes </td><td>  yes </td></tr><tr><td>  <a href="https://habr.com/ru/post/198158/">pure js</a> </td><td>  yes </td><td>  yes </td><td>  yes <a href="https://habr.com/ru/post/198158/">[7]</a> </td><td>  no </td><td>  yes </td><td>  no </td><td>  yes </td></tr><tr><td>  <a href="https://habr.com/ru/post/198158/">mixing markup and logic</a> </td><td>  yes / no <a href="https://habr.com/ru/post/198158/">[8]</a> </td><td>  no </td><td>  yes </td><td>  yes </td><td></td><td>  yes </td><td>  yes </td></tr><tr><td>  <a href="https://habr.com/ru/post/198158/">simplicity</a> </td><td>  no </td><td>  yes </td><td>  yes </td><td>  yes </td><td>  yes </td><td>  yes </td><td>  yes </td></tr><tr><td>  <a href="https://habr.com/ru/post/198158/">rich reactive list</a> </td><td>  no </td><td>  no </td><td></td><td>  yes </td><td>  no </td><td>  no </td><td>  yes </td></tr></tbody></table>  Since RxJS and Bacon.js are libraries for event management, and do not provide primitives to facilitate the creation of interfaces, some questions simply do not apply to them.  In principle, taking them as a basis for designing a GUI is a bit ridiculous, but I still included them in the table, as there is a big chance that someone will mention them in the comments. <br><br><h3>  Decoding Legends and Remarks </h3><br><a name="template_based"></a>  <b>template based</b> <br>  Are templates a basic technique for building interfaces? <br><br><a name="ref_1"></a>  <b>[1]</b> in many tutorials and examples, the interface is really created only on the basis of templates, in spite of that AngularJS supports the creation of interfaces through custom directives. <br><br><a name="controls_composability"></a>  <b>controls composability</b> <br>  Does the library provide a mechanism for the consciousness of controls through the composition of existing (the principle of divide and conquer). <br><br><a name="ref_2"></a>  <b>[2]</b> In AngularJS and Knockout there are mechanisms for including templates (ng-include, template-binding), besides templates can be put into different files, but this does not follow the support of the composition of controls and modularity.  The problem is that a complex JS application is not only a template, but also logic, and the logic in AngularJS is separated from templates (in templates, we must always remember about logic (face effect), but if so, divide and conquer the principle does not work, therefore, the composition does not give us advantages, therefore it is not. <br><br>  Summary, <i>you can‚Äôt say that templates are linked, if logic is connected with them and it is separated from them.</i> I‚Äôm not the only one who noticed this, the creators of React write: <blockquote>  ‚ÄúReact doesn't use templates ... ... React is a library for building composable user interfaces.‚Äù </blockquote>  If you are still in doubt, think about why there are so few template engines for creating desktop, iOS or Android applications. <br><br><a name="ref_3"></a>  <b>[3]</b> If you create applications using only (!) Custom directives, then AngularJS supports both controls composability and modularization of controls. <br><br><a name="modularization_of_controls"></a>  <b>modularization of controls</b> <br>  Is it possible to arrange controls so that they are self-sufficient and can be distributed independently of the application.  Since there is only javascript (requirejs, commonjs) in the web of the distribution system, this question should be read as follows: can controls be wrapped in requirejs or commonjs. <br><br><a name="ref_4"></a>  <b>[4]</b> Only if AngularJS controls are issued as custom directives. <br><br><a name="2_way_binding"></a>  <b>2 way binding</b> <br>  Is it possible to link two variables or a variable and a control so that when the variable changes, the second (or control) changes, and vice versa. <br><br><a name="ref_5"></a>  <b>[5]</b> In AngularJS, there is a possible binding between controls and variables, but not between variables and variables. <br><br><a name="accidental_memory_leaks"></a>  <b>accidental memory leaks</b> <br>  Is it easy to run into memory leaks in an application written using this library?  It so happened that the answer ‚Äúyes‚Äù also means that the code with leaks looks much simpler than the equivalent code without leaks, which means that if you use these libraries correctly, they lose some of their elegance. <br><br>  I wrote a simple application on Knockout and ReactiveCoffee to demonstrate how easy it is to prevent leaks when using them, in fact, the <a href="http://rystsov.github.io/warp9/pages/competitors/leaks/knockout.html">application on Knockout</a> and the <a href="http://rystsov.github.io/warp9/pages/competitors/leaks/reactive_coffee.html">application on ReactiveCoffee</a> . And, of course, the control <a href="http://rystsov.github.io/warp9/pages/competitors/leaks/warp9.html">application without leaks on Warp9</a> . <br><br><a name="todomvc"></a>  <b>todomvc</b> <br>  TodoMVC is a standard hello world for a variety of gui libraries on js, it is considered a good tone rule to have its own application implementation in the arsenal of examples. <br><br><a name="ref_6"></a>  <b>[6]</b> TodoMVC on ReactiveCoffee is only partially implemented: there is no tab switching (All, Active, Completed) and there is no work with local storage. <br><br><a name="headless"></a>  <b>headless</b> <br>  Is it possible to use the library without reference to building interfaces, for example, on the server side for working with events. <br><br><a name="pure_js"></a>  <b>pure js</b> <br>  Was it supposed by the library author that the main language that will use the library will be js. <br><br><a name="ref_7"></a>  <b>[7]</b> The creators of React propose to use the javascript dialect with support for embedded html-like markup (like xml support in scala) and compile it in js.  It is possible to use pure js. <br><br><a name="mixing_markup_and_logic"></a>  <b>mixing markup and logic</b> <br>  Are you supposed to mix markup and code to write an application? <br><br>  It is believed that this is not very good, and therefore, it is necessary to separate them.  But such an approach, while developing at least some meaningful applications, introduces more problems than it solves. <br><br>  Behavior is described both by markup and by code, so logically they are inseparable: when changing the markup, we need to remember which code uses it, and vice versa, thus, by storing them separately, we create the side effect ourselves.  If we still separate them, then with the growth of the application, we need funds both for composition / modularity (distribution) of the code, and for composition / modularity of markup;  and the count of entities doubles. <br><br>  There is another way to deal with complexity - we select independent behavior (markup + logic) in the control (abstraction) and, using the means of composition, we collect from the already existing controls all the more complex, up to our application.  Drawing an analogy with the estimation of the complexity of algorithms, the division into logic and markup reduces the complexity by half (n -&gt; n / 2), while the abstraction / composition reduces it from n to ln (n). <br><br>  It's funny that if you look at the table again, it is clear that those libraries that encourage mixing provide composition and modularity. <br><br><a name="ref_8"></a>  <b>[8]</b> When developing guidelines in AngularJS, you are confronted with the need to mix logic and presentation. <br><br><a name="simplicity"></a>  <b>simplicity</b> <br>  Who knows the number of entities that the library introduces. <br><br>  This is a very subjective opinion, but it seems to me that the number of entities in AngularJS is too large.  React developers <a href="http://www.quora.com/Pete-Hunt/Posts/Facebooks-React-vs-AngularJS-A-Closer-Look">share</a> this opinion: <blockquote>  <b>Number of concepts to learn</b> <br><ul><li>  React: <b>2</b> (everything is a component, some components have state).  As your app grows, there's more to learn;  just build more modular components. </li><li>  AngularJS: <b>6</b> (modules, controllers, directives, scopes, templates, linking functions).  As your app grows, you'll need to learn more concepts. </li></ul></blockquote><br><a name="rich_reactive_list"></a>  <b>rich reactive list</b> <br>  Virtually all reactive libraries provide primitives for reactive variables, such as creating a new reactive variable associated with another reactive variable.  In knockout, you can do it like this: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = ko.observable(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = ko.compute(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a() + <span class="hljs-number"><span class="hljs-number">2</span></span> });</code> </pre> <br>  And in warp9 like this: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Cell(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = a.lift(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a+<span class="hljs-number"><span class="hljs-number">2</span></span>; });</code> </pre> <br>  As for the lists, the support in Knockout and ReactiveCoffee is very scarce; in fact, they view the reactive list as a simple list contained in the reactive variable, which is updated when the list is updated.  Thus, if you need to count the unit from the list and you want it to be reactive, then for each change in the list you need to recalculate it.  In addition, if the list contains reactive values, then the logic of counting the aggregate becomes much more complicated and lies entirely on your shoulders. <br><br>  Warp9 provides a richer interface for working with lists and uses clever data structures under the hood to recalculate values ‚Äã‚Äãas quickly as possible.  The user can calculate the jet unit as follows: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> list = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List([<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Cell(<span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Cell(<span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Cell(<span class="hljs-number"><span class="hljs-number">2</span></span>)]); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sum = list.reduce(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a,b</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a + b; });</code> </pre> <br>  Now that we have seen that in many libraries there are indeed flaws and that it was not only the desire to entertain my CSW that caused me to create warp9, we now turn to the description of the library. <br><br><h2>  Warp9 </h2><br>  At the heart of warp9 is a very simple idea: let's take the reactive model, apply the transformation to it and get the reactive DOM associated with the model.  If the transformation is a simple js function, then we get the usual means of composition (composition of functions) and distribution (requirejs) out of the box. <br><br>  An example of displaying a reactive model in a reactive DOM - <a href="http://rystsov.github.io/warp9/articles/habr/examples/reactive_dom.html">application</a> ( <a href="https://github.com/rystsov/warp9/blob/gh-pages/articles/habr/examples/reactive_dom.html">source</a> ): <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//    (   ) var model = new List(); //     DOM var dom = TRANSFORM(model); //   DOM warp9.ui.renderer.render(placeholder, dom); //   //      model.add("React.js"); model.add("Warp9"); function TRANSFORM(model) { var hasItems = model.count().when(function(count) { return count&gt;0 }, true); return hasItems.when(true, ["div", ["div", "Reactive libraries:"], ["div", {"css/margin-left": "10px"}, model.lift(function(item){ return ["div", item] })] ]); }</span></span></code> </pre> <br><h3>  Reactive primitives </h3><br>  Let's start with warp9 with reactive primitives, on the basis of which the GUI part of the library was created.  In the presentation of a rather detailed description of them. <br><br><div class="slideshow"><iframe src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.slideshare.net/slideshow/embed_code/27451134&amp;xid=17259,15700023,15700043,15700186,15700191,15700253&amp;usg=ALkJrhjtRCd7WoHFkFbiWGYA6b9sc0aLHw" width="425" height="355" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe></div><br>  All examples from slides are available on <a href="">github</a> . <br><br><h4>  Subscriptions and Leaks </h4><br>  The reactive model (observer pattern, publish-subscribe) is very convenient in some places, but you should not think that solving some problems it does not introduce others.  One of the Achilles' heels of reactivity is memory leaks.  If we go to the wiki to read about <a href="http://en.wikipedia.org/wiki/Memory_leak">memory leaks</a> , among other things, we will see: <blockquote>  It is the responsibility of the driver to keep up references after use ... </blockquote>  This problem applies to many implementations of observer.  She <a href="http://martinfowler.com/eaaDev/OrganizingPresentations.html">is mentioned by</a> Martin Fowler, <a href="http://www.codeproject.com/Articles/16182/Observable-property-pattern-memory-leaks-and-weak">articles are</a> devoted to her. <br><br>  I believe that if in the application code that uses the library, errors of the same type occur systematically, then the problem is not the application code, but the library;  the fact that these cases are described in the instructions for it is not an excuse for the library author.  Therefore, the basic principle in the design of warp9 was the idea that the code that <b>can</b> flow <b>should</b> look suspicious or not work. <br><br>  Let's see how this principle is implemented in practice.  Take a look at the following code: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cell = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Cell(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lifted = cell.lift(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x+<span class="hljs-number"><span class="hljs-number">1</span></span>; });</code> </pre> <br>  This code looks completely normal, so it‚Äôs natural to expect that the cell does not contain a reference to lifted and when all references to lifted are lost, the object will be collected by the garbage collector.  In warp9 this is true, and now look at the knockout: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cell = ko.observable(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lifted = ko.computed(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell() + <span class="hljs-number"><span class="hljs-number">1</span></span>; });</code> </pre> <br>  Here the cell will contain a link to lifted, which is counterintuitive.  Consider the code more difficult <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cell = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Cell(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lifted = cell.lift(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x+<span class="hljs-number"><span class="hljs-number">1</span></span>; }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dispose = lifted.onEvent(Cell.handler({ <span class="hljs-attr"><span class="hljs-attr">set</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.info(‚Äúset: ‚Äù + value); }, <span class="hljs-attr"><span class="hljs-attr">unset</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.info(‚Äúunset‚Äù); } })); cell.set(<span class="hljs-number"><span class="hljs-number">3</span></span>); cell.set(<span class="hljs-number"><span class="hljs-number">5</span></span>); cell.unset(); dispose(); cell.set(<span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre> <br>  It would be natural to expect from him. <br><br><pre> <code class="hljs bash"> <span class="hljs-built_in"><span class="hljs-built_in">unset</span></span> &gt; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>: 4 &gt; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>: 6 &gt; <span class="hljs-built_in"><span class="hljs-built_in">unset</span></span></code> </pre> <br>  But such ‚Äúnatural‚Äù behavior would require that the cell contain a reference to lifted, and this does not suit us, since it is a potential leak.  Therefore, a choice was made - let better code that looks good does not work, than it works, but contains a leak;  since it <i>is possible to detect inoperative code much faster than detecting a leak</i> . <br><br>  To make the code above work ‚Äî you need to insert a ‚Äúhint‚Äù to the reader that it can flow: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cell = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Cell(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lifted = cell.lift(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x+<span class="hljs-number"><span class="hljs-number">1</span></span>; }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dispose = lifted.onEvent(Cell.handler({ <span class="hljs-attr"><span class="hljs-attr">set</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.info(‚Äúset: ‚Äù + value); }, <span class="hljs-attr"><span class="hljs-attr">unset</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.info(‚Äúunset‚Äù); } })); lifted.leak(); cell.set(<span class="hljs-number"><span class="hljs-number">3</span></span>); cell.set(<span class="hljs-number"><span class="hljs-number">5</span></span>); cell.unset(); dispose(); lifted.seal(); cell.set(<span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre> <br>  We added <code>lifted.leak()</code> and <code>lifted.seal()</code> , the code began to look suspicious and, in a magical way, it worked.  Actually, calling a <code>leak</code> not magic, but activation of a reactive variable.  When activated, you subscribe to your dependencies and activate them.  Thus, by causing a leak for one object (a variable or a list), we transitively activate all its dependencies.  After we have finished working with the object that has been activated by us, we must leave it in the state in which we got it - call the <code>seal</code> method. <br><br>  Repeat the <code>leak</code> does not lead to re-activation, but only incriminates the internal counter.  If the <code>leak</code> was called n times, then the <code>seal</code> must also be called n times;  each <code>seal</code> call will decriminate an internal counter and when it reaches 0, actual deactivation will occur.  This was done so that you do not think in what condition the object is transferred to you - call <code>leak</code> and <code>seal</code> pairs and everything will be fine. <br><br>  You could already guess that cyclic dependencies are not allowed - we are limited to DAG. <br><br>  Based on the example above, it was possible to guess that when subscribing to a variable, we can expect set and unset events, they are different from the list: data, add, remove <br><br><pre> <code class="hljs pgsql">var list = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List(); list.leak(); list.onEvent(List.<span class="hljs-keyword"><span class="hljs-keyword">handler</span></span>({ data: <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(items) { //     ,  items -   //      ;   , //  " ,  ,    " // items -   { key: key, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> }  <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> - //    ,  key -  (id),   //       }, <span class="hljs-keyword"><span class="hljs-keyword">add</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(item) { // ,     , item   // {key: key, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>}, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> -  , key -   }, remove: <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(key) { //    , key -   } }));</code> </pre> <br><h3>  Markup </h3><br>  Consider the classic hello world application - the user enters his name, for example, Denis and sees the reaction ‚ÄúHello, Denis!‚Äù.  In order to demonstrate more features, I also added a button that clears the input field. <br><br>  The live application is available by <a href="http://rystsov.github.io/warp9/articles/habr/examples/name.html">reference</a> (its <a href="https://github.com/rystsov/warp9/blob/gh-pages/articles/habr/examples/name.html">source</a> ). <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//&lt;html&gt; //&lt;body&gt; // &lt;div id="placeholder"&gt;&lt;/div&gt; //&lt;/body&gt; //&lt;script src="../../../lib/warp9/warp9.js"&gt;&lt;/script&gt; //&lt;script language="javascript" type="text/javascript"&gt; var Cell = warp9.reactive.Cell; warp9.ui.renderer.render(placeholder, NAME(new Cell("Denis"))); function NAME(name) { var hello = name.when( function(name) { return name.length &gt; 0; }, function(name) { return "Hello, " + name + "!"; } ); return ["div", ["div", ["input-text", { "css/background": hello.isSet().when(false, "red") }, name], ["button", {"!click": function() { name.unset(); }}, "clear"]], hello.lift(function(hello) { return ["div", hello]; }) ]; } //&lt;/script&gt; //&lt;/html&gt;</span></span></code> </pre> <br>  From the example, it can be seen that the NAME function maps the model (reactive variable) to some description of the object model, which is then rendered inside the div with id "placeholder".  The description itself is very similar to s-expression lisp, but instead of parentheses we use square ones, you can make jokes and name them z-expression (‚Äúz‚Äù refers to ‚Äús‚Äù as well as "[" refer to "("). <br><br>  The grammar of z-expression is approximately as follows: <br><br><pre> explicitChildren = '["' TAG_NAME '"' (',' ATTR)?  (',' child) * ']'
 implicitChildren = '["' TAG_NAME '"' (',' ATTR)?  (reactive-list-of node) "]
 child = node |  '"' STRING '"' |  Int |
                    (reactive-variable-of node) |
                    (reactive-variable-of STRING) |
                    (reactive-variable-of INT)
 node = explicitChildren |  implicitChildren </pre><br>  where TAG_NAME is the name of the ‚Äúhtml‚Äù tag (in quotes because you can define your own tags), STRING is any string, INT is any integer, ATTR is an object describing tag attributes, css and events. <br><br>  The properties of the ATTR object are mapped to the attributes of the constructed DOM element, the value can be reactive variables (except, of course, the id attribute - it must be constant).  Another exception are properties starting with "!"  - they must be functions and displayed on the element's events.  The css properties also require special relationships, they can be written in two ways - as in the example above: <br><br><pre> <code class="javascript hljs">[<span class="hljs-string"><span class="hljs-string">"input-text"</span></span>, { <span class="hljs-string"><span class="hljs-string">"css/background"</span></span>: name.isSet().when(<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"red"</span></span>) }, name]</code> </pre> <br>  or through the creation of a separate object: <br><br><pre> <code class="hljs pgsql">["input-text", { "css": { "background": <span class="hljs-type"><span class="hljs-type">name</span></span>.isSet().<span class="hljs-keyword"><span class="hljs-keyword">when</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, "red") } }, <span class="hljs-type"><span class="hljs-type">name</span></span>]</code> </pre> <br>  In addition to these exceptions, there is another one - custom attributes and custom events; they contain ":" in the name.  You can guess that they are doing something custom and by default they are not associated with attributes or events of the DOM element. <br><br>  I hope now the example above has now become obvious.  Let's complicate it: we wanted a camper ‚Äî for a given list, to show as many hello worlds as there are elements in it, and use the values ‚Äã‚Äãfrom this list as default values.  I used to say that warp9 uses composition as a basic technique when designing interfaces, so this is not a problem.  Add new feature <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NAMES</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">names</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">"div"</span></span>, names.lift(NAME)]; }</code> </pre> <br>  and replace <br><br><pre> <code class="hljs pgsql">warp9.ui.renderer.render(placeholder, <span class="hljs-type"><span class="hljs-type">NAME</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Cell("Denis")));</code> </pre> <br>  on <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> names = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List(); warp9.ui.renderer.render(placeholder, NAMES(names)); names.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Cell(<span class="hljs-string"><span class="hljs-string">"Denis"</span></span>)); names.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Cell(<span class="hljs-string"><span class="hljs-string">"Lisa"</span></span>));</code> </pre> <br>  We saw how the principles of composition work, but beyond that, warp9 provides excellent support for modularity.  However, when creating warp9, not a single line of code was written to realize this, in fact, the modularity of warp9 was opened after the library was written.  The fact is that the representation in warp9 is described by the code, this implies automatic support for modularity available for js files;  it turns out, we can easily use, for example, AMD for distributing individual controls.  As an illustration, I rewrote the previous example with a list of names using AMD: the <a href="http://rystsov.github.io/warp9/articles/habr/examples/modularized.html">application</a> itself and its <a href="https://github.com/rystsov/warp9/blob/gh-pages/articles/habr/examples/modularized.html">sources</a> . <br><br><h3>  Custom attributes </h3><br>  While the mechanism of custom attributes is not fully thought out and warp9 provides a few hard-hardened ones. <br><br>  <b>! key: enter</b> <br>  An element event corresponding to the ‚Äúinput-text‚Äù tag occurs when the user presses enter. <br><br>  <b>warp9: role</b> and <b>! warp9: changed</b> <br>  Attributes element corresponding to the tag "input-check".  The warp9: changed event occurs when the checkbox state changes, the current value (true / false) is passed in the argument.  If warp9: role is equal to ‚Äúview‚Äù, then when the checkbox state changes, the element does not try to change the passed-in reactive variable (but the state itself changes after the variable). <br><br>  <b>! warp9: draw</b> <br>  Each element has an event that is triggered when the element is drawn on the screen. <br><br><h3>  TodoMVC </h3><br>  If you understood everything that I wrote above, then you already have enough knowledge to understand the <a href="https://github.com/rystsov/warp9/blob/gh-pages/examples/todomvc/todomvc.html">sources of</a> TodoMVC on warp9, by the way, a link to a live <a href="http://rystsov.github.io/warp9/examples/todomvc/todomvc.html">application</a> . <br><br><h3>  Conclusion </h3><br>  Now Warp9 has no version, it is a working concept, demonstrating: <ul><li>  Compatibility as the basic principle of building UI </li><li>  Modularity through distribution through requirejs </li><li>  Lean on memory leaks </li></ul>  This set seems to me quite unique.  It would be great to hear different opinions to bring this concept to mind. </div><p>Source: <a href="https://habr.com/ru/post/198158/">https://habr.com/ru/post/198158/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../198144/index.html">How I stopped worrying and fell in love with Hyper-V Server</a></li>
<li><a href="../198148/index.html">FreeBSD auto configuration</a></li>
<li><a href="../198150/index.html">Getting to know Go, part 2: writing a grabber of images with a balancer and perversions</a></li>
<li><a href="../198152/index.html">Bitcoin users may have discovered Ross Ulbricht‚Äôs personal wallet</a></li>
<li><a href="../198154/index.html">Localization of Node.js applications Part 2: Toolkit and Process</a></li>
<li><a href="../198160/index.html">Google shares for the first time reached $ 1000</a></li>
<li><a href="../198162/index.html">Send Hyper-V Server 2012 R2 and Windows Server 2012 R2</a></li>
<li><a href="../198164/index.html">New type of DDoS attack: TCP bug found in Windows</a></li>
<li><a href="../198166/index.html">The mathematical model predicts the outcome of the Kickstarter campaign with 76% confidence 4 hours after its start.</a></li>
<li><a href="../198170/index.html">New US Navy Destroyer Running Linux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>