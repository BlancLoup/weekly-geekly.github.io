<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Programmable hardware TOTP keys with the ability to synchronize time</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We are pleased to announce a new line of programmable hardware TOTP keys from TOKEN2. The main innovation is the ability to synchronize the system clo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Programmable hardware TOTP keys with the ability to synchronize time</h1><div class="post__text post__text-html js-mediator-article"><img width="345" src="https://habrastorage.org/webt/eh/0f/m0/eh0fm0sn94_iiap-4frff3vyxwe.jpeg" align="right">  We are pleased to announce a new line of programmable hardware TOTP keys from TOKEN2.  The main innovation is the ability to synchronize the system clock hardware keys via the NFC API using special applications - at the moment is preparing a release for Android and Windows 10. <br><a name="habracut"></a><br>  <i>There are no applications for iOS yet: despite the fact that NFC chips are physically present on the latest iPhone models, Apple does not yet provide a public API for their use.</i> <i><br></i> <br><br><h4>  What is it for? </h4><br>  Unlike mobile TOTP applications, hardware keys do not have the ability to synchronize time over NTP, over a cellular network or radio signal: the hardware keys of the device are completely isolated and autonomous, and use a clock on their board as a source of accurate time.  In 1933-1934  physicists Scheibe and Adelsberger of the imperial Physics and Technology Institute in Berlin took up the possibilities of using the piezoelectric effect to measure time.  It is this effect that underlies the system clock of the hardware keys.  The accuracy of such hours varies from ¬± 0.3 to ¬± 1.1 s / day, depending on the quality.  If for an ordinary wristwatch this accuracy is sufficient, in hardware keys the difference in time more than a certain limit may lead to a failure in activation and / or authentication.  This limit depends on the specific system (for example, Microsoft Azure MFA allows up to 600 seconds bias to both sides) when it comes to first registering the hardware key.  Further, the process of synchronizing the bias during the use of the key for entry is already clearly described in <a href="https://tools.ietf.org/html/rfc6238">RFC 6238</a> <br><br><div class="spoiler">  <b class="spoiler_title">RFC 6238 / 6. Resynchronization</b> <div class="spoiler_text">  Clock drifts <br>  server, we set that a validator <br>  ‚Äúout of synch‚Äù before <br>  being rejected. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This limit can be set both forward and backward from the calculated <br>  time step on receipt of the OTP value.  If the time step is <br>  30 seconds as recommended <br>  two time steps backward, then the maximum elapsed time drift would be <br>  around 89 seconds, ie, 29 seconds in the calculated time step and <br>  60 seconds for two backward time steps. <br><br>  It is a validator against the <br>  backward step <br>  (for a total of 3 validations).  Upon successful validation, the <br>  drift for the token <br>  in terms of the number of time steps.  When a new OTP is received <br>  after this step, you can validate the OTP with the current <br>  timestamp adjusted with clock drifts <br>  for the token. <br><br>  Also, it‚Äôs not important. <br>  (potentially) the <br>  accumulated clock drift between the prover and the verifier.  In such <br>  cases, the automatic resynchronization <br>  if the drift exceeds the allowed threshold.  Additional <br>  authentication measures should not be used <br>  prover and explicitly resynchronize the clock drift between the <br>  prover and the validator. <br></div></div><br>  That is, if the authentication server complies with all RFC prescriptions, and if the key is used for authentication is not too rare, for example, at least a couple of times a year (the exact number can be calculated using an oscillator that takes into account the accuracy and the time offset allowed by the server) on the server side and problems should arise.  When using keys in such conditions, the time synchronization function is basically not needed. <br><br>  However, the time synchronization function can be useful in the following cases: <br><br><ul><li>  If the server implementation of TOTP does not follow RFC6238 recommendation # 6.  One example of such an implementation is <a href="https://help.duo.com/s/article/2112%3Flanguage%3Den_US">DUO</a> : <blockquote>  TOTP token drift and resynchronization are not supported.  It is not necessary to work with the system to ensure that it can be verified. </blockquote></li></ul><br><ul><li>  If a batch of hardware keys was purchased a long time ago, but they had to be activated only after some time - in this case there is simply no synchronization mechanism in many systems. </li><li>  If the hardware key is used to log in less often than needed for synchronization.  For example, if a user wants to ‚Äúcopy‚Äù the same TOTP profile (or rather the secret key - shared secret) to two devices: a) to the mobile application on the phone for everyday use and b) to the programmable hardware key as a backup for a rainy day .  Thus, if this rainy day comes in 3-4 years, the hardware token will no longer be used precisely because of the time difference.  And the battery on the token, which has not been turned on for a long time, almost does not lose capacity.  Consequently, in this case, it is enough just to ‚Äúset‚Äù the clock on them in order to return them to the system. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Security analysis</b> <div class="spoiler_text">  As always, this kind of innovation is always based on a balance of comfort / convenience and level of security.  Programmable keys with the ability to synchronize time, from attacks over the network (phishing, a man in the middle, etc. - in most cases our clients use TOTP tokens to protect against such attacks) are not an exception, they will certainly protect to the full, but This feature assumes a minor and purely <i>theoretical</i> probability of an attack by replay (attack) with the condition that attackers can: <br><br><ol><li>  Get the first factor (password). </li><li>  Have physical access to the hardware key <i>without the knowledge of the owner</i> for quite a long time (see step 3.). </li><li>  Using the application, through NFC, transfer the time on the key forward to a specific date, and record a sufficient number of generated codes.  The script will not implement this, since to generate codes, you need to press a physical button, and the current code is only peeked on the screen (it is not transmitted via NFC). </li><li>  Return time back ( <i>so that the owner did not guess anything</i> ). </li><li>  And finally, log in using the password (step 1) and one of the codes obtained in step 3. </li></ol><br>  This risk, as we see, can arise only if there is a physical access to the device, for example, the attack can be carried out by a colleague sitting next to and for some reason also knowing the password.  But under these conditions, using classic TOTP tokens will lead to the same risk.  By the way, the risk of compromising tokens with the time synchronization function is comparable to the risk of fido u2f devices - if an attacker temporarily and imperceptibly got access to the u2f key while having a password, he can log in with this key and add another (his) key and then, also imperceptibly, return the initial key to the owner ‚Äî according to the specification, one account can have more than one u2f key, and any one can be used for parallel input.  Factors like <a href="https://www.grc.com/ppp.htm">Perfect paper passwords</a> are subject to the same risk. <br>  As you can see, the attack is quite complex and unlikely, and in general, the risk level of using such tokens can be compared to using an application like Google Authenticator on a smartphone without a pin code, not having access to the network and which the user always carries with them. <br>  For customers who still consider even this risk to be big enough, our recommendations on this matter are as follows: <br><ol><li>  Restricting physical access to this type of keys is approximately the same as to bank cards (by the way, our keys are in the format of bank cards). </li><li>  Use programmable keys without time synchronization ( <a href="https://www.token2.com/shop/category/programmable-without-time-sync">miniOTP-1</a> ) </li><li>  Use programmable keys with the function of time synchronization, combined with the removal of the secret key.  That is, when the time of the token changes, the seed will be reset and you will need to re-enter it (miniOTP-3, the model release date will be announced later) </li></ol><br><br></div></div><div class="spoiler">  <b class="spoiler_title">Where can one buy?</b> <div class="spoiler_text">  <a href="https://www.token2.com/shop/product/token-miniotp-2-card">Pre-order is</a> open on our website.  Use promo code <i><u>HABR2019</u></i> for a 10% discount (the number of coupons is limited).  Delivery by regular mail (SwissPost or La Poste France).  Delivery to the CIS countries has not yet arisen. <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/435858/">https://habr.com/ru/post/435858/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../435842/index.html">Creating gaming 3D models for the poor: the indie way</a></li>
<li><a href="../435846/index.html">Conferences and hackathons for schoolchildren and students: 11 thematic events</a></li>
<li><a href="../435848/index.html">New devices and technologies from CES 2019 from Microsoft and partners</a></li>
<li><a href="../435854/index.html">Notes phytochemist. Radio banana</a></li>
<li><a href="../435856/index.html">What antiviruses are used in modern firewalls</a></li>
<li><a href="../435862/index.html">Hall of Fame Consumer Electronics: Stories of the Best Gadgets of the Last 50 Years, Part 4</a></li>
<li><a href="../435864/index.html">Mapping Netty Requests</a></li>
<li><a href="../435866/index.html">Release IT: a new platform for launching products and services at the SXSW 2019 festival</a></li>
<li><a href="../435868/index.html">Slush 2018. Day preview</a></li>
<li><a href="../435870/index.html">Cybernetic orchestra. Orchestration of Docker containers with .NET Core applications in the cloud</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>