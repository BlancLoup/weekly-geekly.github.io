<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Npm features and storage of node_modules in git</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="To manage dependencies in a project, node.js, like many other platforms, provides its own package manager, npm. And despite the fact that it looks sim...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Npm features and storage of node_modules in git</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/8b1/1e3/e2d/8b11e3e2d40972731edd00452f786b57.png"><br><br>  To manage dependencies in a project, node.js, like many other platforms, provides its own package manager, npm.  And despite the fact that it looks similar, for example, to Ruby Gems, and seems to perform the same functions, npm has some features that should be considered when developing applications for node.js.  One of these features is the way the node_modules directory is stored in the project.  Many, by analogy with other systems, leave in the project only package.json with fixed versions of modules, and node_modules are added to .gitignore.  Such a strategy is not always correct, if we turn to the <a href="https://npmjs.org/doc/faq.html">FAQ</a> at <a href="https://npmjs.org/">npmjs.org</a> , we will see the following there: <br><blockquote>  <strong>Q: Should I store node_modules in git?</strong> <br>  A: Mikeal Rogers answered this question very well: <br>  <a href="http://www.mikealrogers.com/posts/nodemodules-in-git.html">http://www.mikealrogers.com/posts/nodemodules-in-git.html</a> <br>  tl; dr <br><ul><li>  Store node_modules in git for projects you want to deploy, such as websites and applications. </li><li>  Add node_modules to .gitignore for libraries and reusable modules. </li><li>  Use npm to manage dependencies in the dev environment, but not in the scripts used for deployment. </li></ul><br></blockquote><br>  Under the cut translation of the article Mikeal Rogers, which describes in detail what is connected with this unusual approach. <br><a name="habracut"></a><br>  One of the problems that required rethinking in the node.js world is the issue of dependency management of an application. <br><br>  One of the big changes that came with node 0.4.0 was support for node_modules.  This change had serious consequences.  It raised the priority of local modules in a local directory over modules installed globally.  At the same time, npm changed the default setting from global to local and we saw an almost unanimous transition to local modules. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Switching from global to local modules is what distinguishes a node from previous generation platforms.  Ruby and Python have completely failed in this area, and the fact that development has become a standard practice and deployed in an isolated sandbox for the entire platform (virtualenv, rvm) is a recognition of failure. <br><br>  But the situation is improving.  Support for local modules in a node allows you to achieve what none, known to me, the platform has not yet done, it allows two dependencies to connect completely different versions of the same module, without any conflicts and unintended consequences.  This required some advanced logic in the kernel in order to resolve module names locally and recursively.  But the most important condition for such support was that no one should ever expect that dependencies at the module level will be global for the entire node process, although this approach has been imposed by the community for some time. <br><br>  Now we have become accustomed to local modules, have become accustomed, despite some nagging at an early stage.  And yet we hold on to the old habits that we have from the old global days. <br><br>  When we dealt with global installations, and especially with the advantage of global modules over local ones when resolving name conflicts, storing dependencies in a version control system was a very bad idea.  This is bad mainly due to the fact that it is an open lie.  The presence of a dependency code does not mean that it will be used if the same module is installed globally.  We developed heavy deployment tools to make sure that when the code is deployed in one place, and a week later the same code is deployed in another place, both installations will receive the same set of dependencies.  All these tools are clumsy, because the problem itself is clumsy. <br><br>  But now it is no longer Ruby or Python, it is node.js, and we made the modules much better.  If you have an application that you deploy, place all dependencies in the node_modules directory in the version control system.  If you want to use npm for deployment, connect these modules <strong>only</strong> to bundleDependencies.  If you have any dependencies that need to be compiled, don't forget to commit their code and just run npm rebuild if it is not complete. <br><br>  Everyone to whom I told this told me that I was an idiot, and then, after a couple of weeks, they said that I was right, and that placing node_modules in git was a blessing for deployment and development.  This is objectively better, but here are a few questions / complaints that arise: <br><br>  <strong>Why don't I just fix the versions to ensure that all installations get the same dependencies?</strong> <br><br>  A version fix can only fix versions on top-level dependencies.  You fix the express of a specific version and unfold on the machine three weeks later, npm will resolve the express dependencies again and may get a new version of connect with minor changes that will break your application in the most unpleasant and difficult to debug way, as you learn about This is only when the requests go to the new machine.  It will become a nightmare, do not do so. <br><br>  <strong>Why don't we encourage library maintainers to also fix versions of our dependencies?</strong> <br><br>  As of today, there are approximately 5,500 packages in the npm registry ( <i>Translator‚Äôs Note: data for December 2011, now there are almost 34,000 of them</i> ).  Over the past month, more than 600 new packages have been added and more than 5,000 have been updated.  For some packages, several updates were released during the week.  As a community, we must distribute part of the integration testing.  It is impossible for most maintainers to sit and test your package with all the updates that come with package dependencies.  That is why library developers should not fix versions and should not commit their dependencies to the repository.  We need new people to update dependencies locally and send bug reports.  We need to keep the community moving forward and stay on top of the latest versions and new packages. <br><br>  Only applications requiring deployment should store node_modules in the repository.  Package maintainers must continue to define acceptable version limits for their dependencies.  This is the only way to keep the community in shape with the amount of changes and improvements that we see in node.js. <br><br>  <strong>Does storing node_modules in the repository create too much unrelated garbage in the source tree?</strong> <br><br>  No, you are mistaken, this code is used by your application, it is part of your application, if you pretend that this is not the case, it will lead to problems.  You depend on the code of other people, and they make mistakes and produce new bugs, at least you, maybe even more often.  Storing all the code in the repository gives you the opportunity to keep track of every line that has ever changed in your application.  This will allow you to use git bisect locally and be sure that the result will be the same in production and that all the machines in production are identical.  There is no longer any need to keep track of unknown changes in dependencies; all changes, in each line, are available through the version control system. <br><br>  <strong>Ok, great, what do we do now?</strong> <br><br>  We summarize. <br><br><ul><li>  <strong>Store node_modules in the repository for the applications that you deploy, but not for the libraries that you support.</strong> </li><li>  <strong>All compiled dependencies should store the source code in the repository, not the result of the compilation, and should be collected using npm rebuild if it is fully deployed.</strong> </li></ul><br>  You all who have added node_modules to your .gitignore, delete this sucks <strong>today</strong> .  This is a relic of an era that we are too happy to leave behind.  The era of global modules is dead. </div><p>Source: <a href="https://habr.com/ru/post/185200/">https://habr.com/ru/post/185200/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../185184/index.html">The main errors of the applicant at the interview</a></li>
<li><a href="../185186/index.html">Comparative test-review of the flagships of 2013: Sony Xperia Z, OPPO Find 5, Samsung Galaxy S IV and HTC One</a></li>
<li><a href="../185194/index.html">Two hundred Nokia video wall</a></li>
<li><a href="../185196/index.html">Analyzing the new orders of the FSTEC of Russia No. 17 and No. 21</a></li>
<li><a href="../185198/index.html">On this special day - the updated Yandex.Subscription API</a></li>
<li><a href="../185202/index.html">Who is a ‚Äúfull stack‚Äù developer?</a></li>
<li><a href="../185210/index.html">ChartJS - JavaScript data visualization library</a></li>
<li><a href="../185212/index.html">QtDbus - darkness, covered with mystery. Part 1</a></li>
<li><a href="../185214/index.html">We pump over virtual reality. Virtual Holograms / NettleBox</a></li>
<li><a href="../185216/index.html">How does AntiSpam service work on email marketing service?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>