<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We meet the service from Cloudflare at addresses 1.1.1.1 and 1.0.0.1, or ‚Äúthe public DNS regiment has arrived!‚Äù</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cloudflare company presented public DNS to the following addresses: 


- 1.1.1.1 
- 1.0.0.1 
- 2606: 4700: 4700 :: 1111 
- 2606: 4700: 4700 :: 1001 

...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We meet the service from Cloudflare at addresses 1.1.1.1 and 1.0.0.1, or ‚Äúthe public DNS regiment has arrived!‚Äù</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/getpro/habr/post_images/474/0eb/36b/4740eb36b807f0bde15897462ea88151.png" alt="1.1.1.1"></p><br><p>  Cloudflare company <a href="https://blog.cloudflare.com/announcing-1111/">presented</a> public DNS to the following addresses: </p><br><ul><li>  1.1.1.1 </li><li>  1.0.0.1 </li><li>  2606: 4700: 4700 :: 1111 </li><li>  2606: 4700: 4700 :: 1001 </li></ul><br><p>  It is alleged that the privacy first policy is being used, so that users can rest assured about the content of their requests. </p><br><p>  The service is interesting because besides the usual DNS it provides the ability to use the <strong>DNS-over-TLS</strong> and <strong>DNS-over-HTTPS</strong> technologies, which will greatly prevent the providers from listening in on the request paths of your requests - and collecting statistics, monitoring, managing the advertisement.  Cloudflare claims that the date of the announcement (April 1, 2018, or 04/01 in American notation) was not chosen by chance: on what day of the year should we present the ‚Äúfour units‚Äù? </p><a name="habracut"></a><br><p>  As the audience of Habr is technically savvy, the traditional section "why do we need DNS?"  I will put it at the end of the post, and here I will explain more practical things: </p><br><h2 id="kak-ispolzovat-novyy-servis">  How to use the new service? </h2><br><p>  The simplest thing is to specify the addresses of the DNS servers listed above in your DNS client (or as upstream in the settings of your local DNS server).  Does it make sense to replace the usual values ‚Äã‚Äãof <a href="https://developers.google.com/speed/public-dns/">Google DNS</a> (8.8.8.8, etc.), or slightly less common <a href="https://dns.yandex.ru/">Yandex public DNS servers</a> (77.88.8.8 and others like them) with Cloudflare servers - they will decide for you, but the speed <a href="https://www.dnsperf.com/">chart</a> says for a beginner answers, according to which Cloudflare is running faster than all competitors (to clarify: the measurements were made by the external service, and the speed to a specific client, of course, may differ). </p><br><p><img src="https://habrastorage.org/webt/yi/2c/jm/yi2cjmmj8jgqdktzbkh0gffhi7e.png" alt="public DNS speed"></p><br><p>  It is much more interesting to work with new modes in which the request flies to the server via an encrypted connection (in fact, the answer is returned via it), mentioned DNS-over-TLS and DNS-over-HTTPS.  Unfortunately, they are not supported out of the box (the authors believe that this is for now), but it‚Äôs easy to organize in their software (or even on their hardware): </p><br><h3 id="dns-over-https-doh">  DNS over HTTPs (DoH) </h3><br><p>  As the name implies, the conversation goes over the HTTPS channel, which implies </p><br><ol><li>  the presence of a touchdown point (endpoint) - it is located at <a href="https://cloudflare-dns.com/dns-query">https://cloudflare-dns.com/dns-query</a> , and </li><li>  a client who can send requests and receive responses. </li></ol><br><p>  Requests can be either in the Wireformat DNS format defined in <a href="https://tools.ietf.org/html/rfc1035">RFC1035</a> (sent using the HTTP POST and GET methods), or in JSON format (using the HTTP GET method).  For me personally, the idea of ‚Äã‚Äãmaking DNS requests through HTTP requests seemed unexpected, but there is a rational grain: this request will pass many traffic filtering systems, parsing answers is quite simple, and making requests is even easier.  The customary libraries and protocols are responsible for security. </p><br><p>  Examples of requests, directly from the documentation: </p><br><p>  <strong>GET request in the format of DNS Wireformat</strong> </p><br><pre><code class="bash hljs">$ curl -v <span class="hljs-string"><span class="hljs-string">"https://cloudflare-dns.com/dns-query?ct=application/dns-udpwireformat&amp;dns=q80BAAABAAAAAAAAA3d3dwdleGFtcGxlA2NvbQAAAQAB"</span></span> | hexdump * Using HTTP2, server supports multi-use * Connection state changed (HTTP/2 confirmed) * Copying HTTP/2 data <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> stream buffer to connection buffer after upgrade: len=0 * Using Stream ID: 1 (easy handle 0x7f968700a400) GET /dns-query?ct=application/dns-udpwireformat&amp;dns=q80BAAABAAAAAAAAA3d3dwdleGFtcGxlA2NvbQAAAQAB HTTP/2 Host: cloudflare-dns.com User-Agent: curl/7.54.0 Accept: */* * Connection state changed (MAX_CONCURRENT_STREAMS updated)! HTTP/2 200 date: Fri, 23 Mar 2018 05:14:02 GMT content-type: application/dns-udpwireformat content-length: 49 cache-control: max-age=0 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>-cookie: \__cfduid=dd1fb65f0185fadf50bbb6cd14ecbc5b01521782042; expires=Sat, 23-Mar-19 05:14:02 GMT; path=/; domain=.cloudflare.com; HttpOnly server: cloudflare-nginx cf-ray: 3ffe69838a418c4c-SFO-DOG { [49 bytes data] 100 49 100 49 0 0 493 0 --:--:-- --:--:-- --:--:-- 494 * Connection <span class="hljs-comment"><span class="hljs-comment">#0 to host cloudflare-dns.com left intact 0000000 ab cd 81 80 00 01 00 01 00 00 00 00 03 77 77 77 0000010 07 65 78 61 6d 70 6c 65 03 63 6f 6d 00 00 01 00 0000020 01 c0 0c 00 01 00 01 00 00 0a 8b 00 04 5d b8 d8 0000030 22 0000031</span></span></code> </pre> <br><p>  <strong>POST request in Wireformat DNS format</strong> </p><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> -n <span class="hljs-string"><span class="hljs-string">'q80BAAABAAAAAAAAA3d3dwdleGFtcGxlA2NvbQAAAQAB'</span></span> | base64 -D | curl -H <span class="hljs-string"><span class="hljs-string">'Content-Type: application/dns-udpwireformat'</span></span> --data-binary @- https://cloudflare-dns.com/dns-query -o - | hexdump { [49 bytes data] 100 49 100 49 0 0 493 0 --:--:-- --:--:-- --:--:-- 494 * Connection <span class="hljs-comment"><span class="hljs-comment">#0 to host cloudflare-dns.com left intact 0000000 ab cd 81 80 00 01 00 01 00 00 00 00 03 77 77 77 0000010 07 65 78 61 6d 70 6c 65 03 63 6f 6d 00 00 01 00 0000020 01 c0 0c 00 01 00 01 00 00 0a 8b 00 04 5d b8 d8 0000030 22 0000031</span></span></code> </pre><br><p>  <strong>The same, but using JSON</strong> </p><br><pre> <code class="bash hljs">$ curl <span class="hljs-string"><span class="hljs-string">'https://cloudflare-dns.com/dns-query?ct=application/dns-json&amp;name=example.com&amp;type=AAAA'</span></span> { <span class="hljs-string"><span class="hljs-string">"Status"</span></span>: 0, <span class="hljs-string"><span class="hljs-string">"TC"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"RD"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"RA"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"AD"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"CD"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"Question"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"example.com."</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: 1 } ], <span class="hljs-string"><span class="hljs-string">"Answer"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"example.com."</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: 1, <span class="hljs-string"><span class="hljs-string">"TTL"</span></span>: 1069, <span class="hljs-string"><span class="hljs-string">"data"</span></span>: <span class="hljs-string"><span class="hljs-string">"93.184.216.34"</span></span> } ] }</code> </pre> <br><p>  Obviously, a rare (if any) home router can work with DNS this way, but this does not mean that support will not appear tomorrow - and, interestingly, here we can fully implement the work with DNS in our application (as it is <a href="https://groups.google.com/forum/">about to do Mozilla</a> , just on Cloudflare servers). </p><br><h3 id="dns-over-tls">  DNS over TLS </h3><br><p>  By default, DNS queries are transmitted without encryption.  DNS over TLS is a way to send them over a secure connection.  Cloudflare supports DNS over TLS on the standard port 853, as prescribed by <a href="https://tools.ietf.org/html/rfc7858">RFC7858</a> .  It uses a certificate issued for the host cloudflare-dns.com, TLS 1.2 and TLS 1.3 are supported. </p><br><p>  The establishment of communication and work on the protocol goes something like this: </p><br><ul><li>  Until a DNS connection is established, the client saves the base64 SHA256-encoded hash of the TLS certificate cloudflare-dns.com's (called SPKI) </li><li>  DNS client establishes a TCP connection with cloudflare-dns.com:853 </li><li>  DNS client initiates TLS handshake procedure </li><li>  During the TLS handshake process, the host cloudflare-dns.com presents its TLS certificate. </li><li>  Once the TLS connection is established, the DNS client can send DNS requests on top of the secure channel, which prevents eavesdropping and forging requests and responses. </li><li>  All DNS queries sent via a TLS connection must comply with the specification for <a href="https://tools.ietf.org/html/rfc1035">sending DNS over TCP</a> . </li></ul><br><p>  <strong>Sample request via DNS over TLS:</strong> </p><br><pre> <code class="bash hljs">$ kdig -d @1.1.1.1 +tls-ca +tls-host=cloudflare-dns.com example.com ;; DEBUG: Querying <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> owner(example.com.), class(1), <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>(1), server(1.1.1.1), port(853), protocol(TCP) ;; DEBUG: TLS, imported 170 system certificates ;; DEBUG: TLS, received certificate hierarchy: ;; DEBUG: <span class="hljs-comment"><span class="hljs-comment">#1, C=US,ST=CA,L=San Francisco,O=Cloudflare\, Inc.,CN=\*.cloudflare-dns.com ;; DE</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">BUG:</span></span></span><span class="hljs-comment"> SHA-256 PIN: yioEpqeR4WtDwE9YxNVnCEkTxIjx6EEIwFSQW+lJsbc= ;; DE</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">BUG:</span></span></span><span class="hljs-comment"> #2, C=US,O=DigiCert Inc,CN=DigiCert ECC Secure Server CA ;; DE</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">BUG:</span></span></span><span class="hljs-comment"> SHA-256 PIN: PZXN3lRAy+8tBKk2Ox6F7jIlnzr2Yzmwqc3JnyfXoCw= ;; DE</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">BUG:</span></span></span><span class="hljs-comment"> TLS, skipping certificate PIN check ;; DE</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">BUG:</span></span></span><span class="hljs-comment"> TLS, The certificate is trusted. ;; TLS session (TLS1.2)-(ECDHE-ECDSA-SECP256R1)-(AES-256-GCM) ;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY; status: NOERROR; id: 58548 ;; Flags: qr rd ra; QUERY: 1; ANSWER: 1; AUTHORITY: 0; ADDITIONAL: 1 ;; EDNS PSEUDOSECTION: ;; Version: 0; flags: ; UDP size: 1536 B; ext-rcode: NOERROR ;; PADDING: 408 B ;; QUESTION SECTION: ;; example.com. IN A ;; ANSWER SECTION: example.com. 2347 IN A 93.184.216.34 ;; Received 468 B ;; Time 2018-03-31 15:20:57 PDT ;; From 1.1.1.1@853(TCP) in 12.6 ms</span></span></code> </pre> <br><p>  This option seems to be better suited for local DNS servers serving the needs of the local network or a single user.  True, with the support of the standard is not very good, but - let's hope! </p><br><h3 id="dva-slova-poyasneniy-o-chyom-razgovor">  Two words of explanation, what is the conversation </h3><br><p>  The DNS abbreviation stands for Domain Name Service (so saying "DNS service" is somewhat redundant, the abbreviation already has the word "service"), and is used to solve a simple task - to understand what IP address a particular host name is.  Every time a person clicks a link, or enters an address in the address bar of the browser (say, something like " <a href="https://habrahabr.ru/post/346430/">https://habrahabr.ru/post/346430/</a> "), the person‚Äôs computer tries to figure out which server to send a request to. to get the page content.  In the case of habrahabr.ru, the response from the DNS will indicate the IP address of the web server: 178.248.237.68, and then the browser will already try to contact the server with the specified IP address. </p><br><p>  In turn, the DNS server, after receiving the request ‚Äúwhat is the IP address of the host named habrahabr.ru?‚Äù, Determines whether it knows something about the specified host.  If not, he makes a request to other DNS servers in the world, and, step by step, tries to figure out the answer to the question asked.  As a result, after finding the final answer, the found data is sent to the still waiting client, plus stored in the cache of the DNS server itself, which will allow to answer such a question much faster next time. </p><br><p>  The usual problem is that, firstly, the data of DNS queries are transmitted in open form (which gives everyone who has access to the traffic flow, isolate DNS queries and the received responses, and then analyze them for their own purposes; this gives The ability to target advertising with accuracy for the DNS client, which is quite a lot!).  Secondly, some Internet providers (we will not point with a finger, but not the smallest) tend to display ads instead of one or another of the requested pages (which is implemented very simply: instead of the specified IP address for a request by the host name habranabr.ru, to a person the address of the web server of the provider, where the page containing the advertisement is given, is returned.  Third, there are Internet access providers that implement the mechanism for fulfilling the requirements for blocking individual sites by substituting the correct DNS responses for the IP addresses of blocked web resources to the IP address of their server containing stub pages (as a result, access to such sites becomes much more complicated), or to the address of your proxy server that performs filtering. </p><br><p>  Here, you probably need to put a picture from the site <a href="http://1.1.1.1/">http://1.1.1.1/</a> , which is used to describe the connection to the service.  The authors, as you can see, are quite confident in the quality of the work of their DNS (however, it is difficult to expect another from Cloudflare) </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/275/889/64d/27588964d75b074c95d3c43d71d7be81.jpg" alt="image"></p><br><p>  One can fully understand Cloudflare, the creator of the service: they earn their bread by supporting and developing one of the most popular CDN networks in the world (whose functions include not only content distribution, but also hosting DNS zones), and, by virtue of the desire of those <em>who do not really understand</em> , to teach those <em>whom they do not know</em> , <em>where to go</em> in the global network, quite often suffers from address blocking of their servers from the <em>outside, we will not tell anyone</em> - so the presence of the DNS, which is not influenced by "shouts, whistles and pisulek ", for the company means less harm to their bi  znesu.  And the technical advantages (a trifle, but nice: in particular, for the clients of the free DNS Cloudflare, the update of the DNS records of resourses hosted on the company's DNS servers will be instant) make using the service described in the post even more interesting. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/352654/">https://habr.com/ru/post/352654/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../352644/index.html">GitLab 10.6 released: CI / CD for GitHub and in-depth integration with Kubernetes</a></li>
<li><a href="../352646/index.html">3CX voice application development: an introduction for beginners</a></li>
<li><a href="../352648/index.html">TeamLead Conf review: 2 days with 2 tracks, 25 reports, 474 participants, the pain is immeasurable</a></li>
<li><a href="../352650/index.html">DZ Online Tech: Postgres Professional</a></li>
<li><a href="../352652/index.html">Igor Sheludko, FSPro Labs: ‚ÄúWorking as a tracker, I see the evolution of many ideas</a></li>
<li><a href="../352656/index.html">Digital events in Moscow from April 2 to 8</a></li>
<li><a href="../352658/index.html">Conference DEFCON 22. "Alone at home with an automatic protection system." Chris Littlebury</a></li>
<li><a href="../352662/index.html">Startups and Microsoft: Venture, Hubs, and That's All</a></li>
<li><a href="../352664/index.html">Gradient text length limit</a></li>
<li><a href="../352666/index.html">Use of arbitrary DataFlash of the 25th series instead of expensive Altera FPGA configurators without additional hardware</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>