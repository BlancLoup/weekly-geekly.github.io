<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Our experience of using photogrammetry in the development of a computer game (Part 2)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today we will continue the story of our research in the field of photogrammetry, but using the example of creating materials. Let me remind you that l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Our experience of using photogrammetry in the development of a computer game (Part 2)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/a1d/629/d52/a1d629d5295edf7406ab6646c56cc920.jpg" alt="image"><br><br>  Today we will continue the story of our research in the field of photogrammetry, but using the example of creating materials.  Let me remind you that <a href="https://habrahabr.ru/post/279591/">last time</a> we began to tell you about this discipline and its experience in using content for creating a three-dimensional computer game in the Half-Life universe. <a name="habracut"></a>  Well, let's get down to business right away. <br><br><h3>  Shooting and processing </h3><br>  After our first forays into the nearest forest parks, it became clear that in order to efficiently use the time allotted for shooting on location, we need to find a place with the maximum concentration of interesting objects and a diverse landscape.  In the urban forest park, for example, you will not find old fallen trees, huge boulders and rocky cliffs.  After a brief search, we found a suitable place - the federal reserve ‚Äúnot far‚Äù from the city. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Without hesitation, we packed up and went for one day on a small 130 km long expedition, and found ourselves in a real fairy tale! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a92/6d8/b56/a926d8b569d363c0a9c5d25c7cb023cf.jpg" alt="image"><br><br>  Shooting surfaces to create materials was fraught with its features and difficulties.  In order to finally get an interesting material with a variety of details, you need to capture a sufficiently large surface - at least 3x3 meters.  At the same time, in order to obtain high detail of the material, it is necessary to take pictures from a short distance and ensure that adjacent images intersect, i.e.  so that in the adjacent images 50-60% of the frame occupy the same surface area (this intersection will be used in the process of photogrammetry). <br><br>  In view of the above, when shooting, one has to slowly move through the intended area and take a huge number of shots in a row (150, or even all 200 photos) at a time in a bent, uncomfortable position.  If you take a break, then the risk of losing the exact place where you stopped, or to get a change in lighting, if the sun has time to go out from behind a cloud while you are resting.  Another nuance that you should constantly follow is where you step.  The branch that you accidentally did not notice and moved in the middle of the shooting can spoil all the work, and the prints of your shoes or forgotten things can migrate to the final material in the game, which is very undesirable. <br><br>  Although it seemed to us that shooting various surfaces for creating materials is more difficult (at least physically) than shooting objects, but in time it came out, on the contrary, faster.  In one day, we managed to shoot six natural materials, a lot of photo-references of the forest, a couple of models and even brick material on the way back, which was not originally in our plans.  The brick material, however, was very useful to us. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/704/8f7/eae/7048f7eaeb14dacc222c9a4ee78ad97a.jpg" alt="image"><br><br>  Processing photos to create materials in general is no different from what we described in the previous part of the diary, except that this time the models had a little more polygons.  The results of photogrammetry you see above are high poly models of surfaces (from 11 to 16 million triangles), each with an albedo map of 16 384 pixels in size. <br><br><h3>  Tiling </h3><br>  Since we conceived the use of photogrammetry primarily for landscape materials (earth, grass, rocks), we inevitably faced the problem of tiling.  Tiling is a technique for optimization in 3D graphics, in which only one texture is superimposed on polygons to fill in large areas, which is repeated in all directions and fills all the specified space.  In order for such a texture on the surface to look best, it must be prepared so that its edges smoothly continue to each other. <br><br>  It is obvious that as a result of photogrammetry we do not get any smooth transitions at the edges of high-poly models.  Alternatively, you can try to dock nine copies of the model obtained as a result of photogrammetry and with the help of special software manually change the shape of the polygonal mesh to get smooth transitions.  Unfortunately, a lot of time is spent in such a case, and for each new material the models have to be joined from scratch.  This method is clearly not suitable for quick processing of photogrammetry results.  Therefore, we have chosen a different path. <br><br>  We decided to work with the texture maps already received from the high-poly model and prepare them for tiling in one of the programs used to create procedural materials.  The beauty of such a program is that it allowed us to create our own templates using graph-schemes, which will save us a lot of time when creating similar materials in the future. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/86a/dde/ee2/86addeee26390048cb8d8a5ad804cd67.jpg" alt="image"><br><br>  We have created two large templates (see image above), consisting of dozens of operations.  One is designed for materials with a chaotic structure (grass, soil, moss, stone surface and other natural materials), the other for materials with a kind of repeating pattern (brick, tile, and other handmade materials).  However, both templates are united by the fact that they allow you to extract and customize all additional texture maps to create a full-fledged material, as well as to obtain, without loss of quality, material prepared for tiling. <br><br>  In order to avoid losing the quality resulting from photogrammetry during the preparation of the material for tiling, we had to radically alter the graph-scheme for tiling already built into the program.  Our new graph-scheme allows you to use when mixing different tiles (copies of the original texture map) information about the height above one or another part on the texture (you can see in the image below how individual leaves and sticks appear on a flat surface of the ground). <br><br>  The standard graph scheme simply mixed the edges of texture map tiles.  This method may be acceptable when preparing for the albedo tiling of cards, but when using with normal maps, information is lost at the junction of tiles.  That is why we abandoned the standard graph scheme.  You yourself can compare the result when preparing normal maps in the image below (different tiles were deployed and painted in different colors for greater clarity). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/314/5d0/1e8/3145d01e85ae1c7e5b2f056c88486bc7.jpg" alt="image"><br><br>  Based on a homemade graph scheme, we were able to create another new graph scheme to prepare for the tiling of materials with a pattern, where we added more settings for the blending mask and the deformation of the tile.  The new graph-scheme, in turn, has developed into a second pattern. <br><br>  Thus, after we received the first finished material, we had a template left on our hands that allowed us to create each subsequent natural material in just two days (without taking into account the time for the shooting).  And the brick material, which successfully turned up on the way home, allowed us to create a second template, which, of course, will also greatly reduce our time for creating various handmade materials with a pattern in the future. <br><br><h3>  results </h3><br>  Well, it's time to sum up.  But what can tell about the results of photogrammetry better than the images of the final results?  That's right, nothing!  Therefore, renders of the final materials are waiting for you below. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9f2/b37/ee7/9f2b37ee7e512a98b59b6237890363eb.jpg" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/fc5/507/bc7/fc5507bc702d7e4a4b5d91fa0a6f7b79.jpg" alt="image"><br><br>  We also prepared a small scene on the test map to show the new models and materials as they will appear in the game itself.  In addition, in a small ‚Äúvideo‚Äù you can follow all the changes on the map that occurred to her in a couple of days while we were preparing her for display in this diary.  Let us know if you are interested in this format. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/856/933/f07/856933f07fa831539b26d1f272b6589d.jpg" alt="image"><br><br><iframe src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://gfycat.com/ifr/GreatDirectHuia&amp;xid=17259,15700019,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhjpCGreyj-VgbUg43l_I6relEIXA" frameborder="0" scrolling="no" width="560" height="315" style="-webkit-backface-visibility: hidden;-webkit-transform: scale(1);"></iframe><br><br>  Note that this is not the final type of natural locations, we still have to deal with new trees, grass and other vegetation, as well as the sky.  Perhaps about some of this, we will tell in the following development diaries of the game. <br><br>  And a little more screenshots in the end, to see everything in more detail. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fe1/2bf/8ae/fe12bf8ae9b31afc7e4960d282d05790.jpg" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/e6e/3f3/9a2/e6e3f39a24f781045012e26ce655c264.jpg" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/638/a31/41a/638a3141ab1a23e7da1c8e421c032644.jpg" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/b3e/cc7/a55/b3ecc7a55362eed7f7b3eca80bd366ac.jpg" alt="image"><br><br>  Now back to the results in text form.  Our experiment with photogrammetry, as we believe, was completely successful.  We not only learned a lot, but also developed a ready-made chain of techniques for working with this technology. <br><br>  Photogrammetry has fully justified itself as a powerful and reliable tool for a developer who is able to solve a number of difficult tasks in Spartan conditions in a small team of igrodelov, and we gladly took this tool into service.  We will definitely make a few more forays for new surveys of natural objects and materials, and besides, we are thinking about forays into industrial zones for interesting man-made materials (and maybe objects).  Wait, it won't be boring. <br><br>  Well, on this we have so far everything.  Stay with us and do not forget to share your opinion on the development diaries and the development of ‚ÄúLost Story: The Last Days of Earth‚Äù as a whole. </div><p>Source: <a href="https://habr.com/ru/post/280119/">https://habr.com/ru/post/280119/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../280105/index.html">NetApp FlexClone: ‚Äã‚ÄãHow technology accelerates development</a></li>
<li><a href="../280107/index.html">Qt for mobile cross-platform development</a></li>
<li><a href="../280111/index.html">15 free online programming courses</a></li>
<li><a href="../280113/index.html">Visualize training data with the DevExpress Dashboard.</a></li>
<li><a href="../280117/index.html">Theory and Practice of AOP. How we do it in Yandex</a></li>
<li><a href="../280125/index.html">REM vs EM - Great Controversy</a></li>
<li><a href="../280127/index.html">IBM Watson understands human emotions and responds knowing the user feels.</a></li>
<li><a href="../280129/index.html">Dotted underlining of links with a normal distance between the text and the line</a></li>
<li><a href="../280131/index.html">Audit SKZI and crypto keys</a></li>
<li><a href="../280133/index.html">Search code in Bitbucket Server</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>