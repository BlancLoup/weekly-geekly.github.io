<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Disruptor - a new paradigm for multi-threaded programming</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Last week, LMAX , where I work, received the 2011 Java Duke's Choice Award for the Disruptor framework. Previously, Martin Fowler wrote about this tec...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Disruptor - a new paradigm for multi-threaded programming</h1><div class="post__text post__text-html js-mediator-article">  Last week, <a href="http://goo.gl/u95uj">LMAX</a> , where I work, received the <a href="http://goo.gl/bsOaY">2011</a> Java <a href="http://goo.gl/bsOaY">Duke's Choice Award</a> for the Disruptor framework.  Previously, <a href="http://martinfowler.com/articles/lmax.html">Martin Fowler wrote</a> about this technology, known to many readers by publications about object programming. <br><br>  In this article I would like to briefly tell about this technology, as well as about a specific problem that this technology solves in the company LMAX. <br><br><a name="habracut"></a>  LMAX provides a trading platform for CFD and Forex, characterized by very low latency and high bandwidth. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To achieve execution speeds of more than 10,000 operations per second, LMAX developed the Disruptor pattern.  This is a completely new and very unconventional approach to solving parallel programming problems.  Disruptor is a multi-threaded parallel transaction processing framework featuring high bandwidth and very low latency.  Disruptor LMAX replaces java.util.concurrent.ArrayBlockingQueue and surpasses it in performance up to 80 times. <br><br><h4>  The problem of multi-threaded programming </h4><br>  Performance testing has shown that using queues to transfer data between parts of the system results in latency.  Locking threads and semaphores is difficult to understand and test, and often using them takes more time to debug than to solve a real problem.  Also testing of multi-threaded programming has shown that the use of multiple threads often not only does not lead to high performance, but also lowers it. <br><br>  The table illustrates the costs of increasing the 64-bit counter 500 million times using different techniques on the 2.4Ghz Nehalem processor (strayed from a <a href="http://goo.gl/DKPkv">colleague's blog</a> ). <br><table><tbody><tr><td>  Method <br></td><td>  Time (ms) <br></td></tr><tr><td>  One thread <br></td><td>  300 <br></td></tr><tr><td>  Single Stream with Memory Barrier <br></td><td>  4,700 <br></td></tr><tr><td>  Single stream with CAS <br></td><td>  5,700 <br></td></tr><tr><td>  Two streams with CAS <br></td><td>  30,000 <br></td></tr><tr><td>  Single thread with lock <br></td><td>  10,000 <br></td></tr><tr><td>  Two threads with lock <br></td><td>  224,000 <br></td></tr></tbody></table><br><br><h4>  LMAX approach </h4><br>  Let's use a simple example to illustrate.  Imagine that you order a pack of sweets and pay them by credit card.  A simple retailer will take your order information, use the credit card verification service to check the card number, and then confirm your order ‚Äî all in one transaction.  The stream processing your order will be blocked while waiting for credit card verification, but this block will not be very long for the user, and the server will always be able to run another thread on the processor. <br><br>  In the LMAX architecture, this operation will be divided into two parts.  The first operation is to collect information about the order, which will end with an event (credit card verification request) for the credit card company.  The business logic processor will then continue to process events for other customers until it receives a credit card verification event in the input event stream.  After processing this event, the order will be confirmed. <br><br>  Disruptor is a very high-speed, low-latency way of exchanging messages between threads.  It's like a lineup on steroids (on large quantities of steroids!) And it is one of the main innovations of the LMAX exchange.  Disruptor includes manufacturer, consumer and circular buffer.  Each producer and consumer knows the sequence number ‚Äî the cell in the buffer that he is currently processing.  Each producer and consumer writes his number into the counter, and can read other counters.  Thus, the consumer can read the manufacturer‚Äôs counter to make sure that the cell in which he wants to write is available.  Also, the consumer can verify that he processes the message only after the other consumer has finished processing. <br><br><img src="http://inraidotrading.com/wp-content/uploads/2011/10/Disruptor.png" alt="Disruptor to LMAX"><br><br>  The advantage of Disruptor is that consumers can quickly catch up with the rest if they fall behind.  If the message converter (un-marshaller) encountered a problem on cell 15, and realized this when the recipient is on cell 31, he can read the data from cells 16-30 in one go and quickly catch up.  The ability to read large blocks helps lagging consumers quickly catch up on others, thereby reducing latency. <br><br>  The business logic processor manages all business logic using a single-threaded Java program that responds to method calls and produces output events.  It works completely in RAM, without a database or other permanent storage. <br><br>  Although business logic is carried out in one thread, a number of tasks should be carried out before calling a business object.  The incoming message from the network needs to be unmarshall in a format convenient for business logic, it is necessary to save to a reliable drive in order to be able to recover data in case of an accident. <br><br>  These tasks are solved by input and output disruptors.  Unlike the business logic processor, these are parallel components, as they include I / O operations that are slow and independent. <br><br><img src="http://inraidotrading.com/wp-content/uploads/2011/10/Disruptor2.png" alt="image"><br><br>  Since the input event stream is stored in a reliable storage (this is one of the tasks of the input disruptor), you can always restore the current state of the business logic processor by replaying input events - just like in the version control system, having a sequence of changes, you can get the final version of the document . <br><br><h4>  Conclusions and resources </h4><br>  Disruptor is not a universal solution for every development, but if used correctly it can show a noticeable increase in the speed of software systems. <br>  Often, financial companies do not spread about their technology.  LMAX not only speaks openly about its developments (see <a href="http://goo.gl/X9Spf">blogs</a> ), but also released the <a href="http://goo.gl/MSKvb">Disruptor</a> code <a href="http://goo.gl/MSKvb">in Open Source</a> . <br><br>  See also - <a href="http://goo.gl/R2muI">LMAX official website</a> and <a href="http://goo.gl/R2muI">LMAX</a> <a href="http://inraidotrading.ru/">partner website in Russian</a> . <br><br>  PS Add that this framework is at the heart of the LMAX trading platform, launched a year ago, and successfully processing thousands of transactions per second. <br><habracut></habracut></div><p>Source: <a href="https://habr.com/ru/post/130113/">https://habr.com/ru/post/130113/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../130104/index.html">The first startup incubator in Moldova - ‚ÄúSimpals Garage‚Äù</a></li>
<li><a href="../130105/index.html">How I sent spam</a></li>
<li><a href="../130108/index.html">Residents of the richest Chinese village built a skyscraper</a></li>
<li><a href="../130109/index.html">Impossible task</a></li>
<li><a href="../130112/index.html">Universal Binary JSON - another binary JSON</a></li>
<li><a href="../130114/index.html">Lisp music programming</a></li>
<li><a href="../130115/index.html">Golden T Game Engine (GTGE) - first acquaintance</a></li>
<li><a href="../130117/index.html">Secondary account authentication on the site</a></li>
<li><a href="../130118/index.html">Video review of Android applications and games - kedDroid</a></li>
<li><a href="../130120/index.html">Characteristic features of the Dart language</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>