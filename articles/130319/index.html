<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Background upload lists</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When downloading large lists from a slow source (for example, an HTTP request), it makes no sense to download the entire list at once, especially if t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Background upload lists</h1><div class="post__text post__text-html js-mediator-article">  When downloading large lists from a slow source (for example, an HTTP request), it makes no sense to download the entire list at once, especially if the user needs only a small amount of data (search results, news articles).  In this case, it is advisable to implement paginal upload list.  This article shows a simple way using the <strong>ListView</strong> <strong>footer view</strong> .  It is implied that we already have a list and its adapter, which loads the elements (even the first few, or all) using for example an asynchronous HTTP request.  It is more convenient to make a request for data in a separate class in which to add the ability to load the next page. <br><br><h2>  Action plan </h2><br><ol><li>  Prepare layout for the boot process message item. </li><li>  Preparing a <strong>ListView</strong> control </li><li>  Add the following page startup code to the list adapter </li><li>  Processing the result of loading the next page </li></ol><br><a name="habracut"></a><br><h2>  Prepare layout for the boot process message item. </h2><br>  Create a layout xml with two <strong>ProgressBar</strong> elements with the <strong>indeterminateOnly</strong> flag set and a <strong>TextView</strong> with the text ‚ÄúLoading ...‚Äù.  Put them in a horizontal LinearLayout.  You can also use a ready-made layout for an empty list for boot information. <br><br><h2>  Preparing ListView </h2><br>  Load the prepared layout and set it as a basement for our ListView.  This must be done before calling the setAdapter method.  Do not forget to save the link to the item to delete when you reach the end of the list. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> LinearLayout mLoadingFooter; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ ... LayoutInflater layoutInflater = (LayoutInflater) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getSystemService(Context.LAYOUT_INFLATER_SERVICE); mLoadingFooter = (LinearLayout) layoutInflater.inflate(R.layout.loading, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); mList = (ListView) findViewById(R.id.list); mList.addFooterView(mLoadingFooter); ... }</code> </pre> <br><br><h2>  Add the following page startup code to the list adapter </h2><br>  To start loading the next page, we use the <strong>list</strong> adapter's <strong>getView</strong> method: if the last element of the list is requested, then it is time to load the next page.  The download process is conveniently removed in a separate thread and then throw Intent into the current activation.  Do not forget to call <strong>notifyDataSetInvalidated</strong> if during loading the data accessed by the adapter will change. <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> View </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position, View convertView, ViewGroup parent)</span></span></span><span class="hljs-function"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (position == getCount() - <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; hasNextPage()) { loadNextPage(); } }</code> </pre><br>  <b>UPD:</b> <a href="http://habrahabr.ru/users/grishkaa/" class="user_link">grishkaa</a> recommended a more correct way using <strong>AbsListView.OnScrollListener</strong> : <br><br><pre> <code class="java hljs"> mList.setOnScrollListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OnScrollListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onScrollStateChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AbsListView arg0, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> arg1)</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onScroll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AbsListView view, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> firstVisibleItem, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> visibleItemCount, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> totalItemCount)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (visibleItemCount &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; firstVisibleItem + visibleItemCount == totalItemCount &amp;&amp; hasNextPage()) { loadNextPage(); } } });</code> </pre><br><h2>  Processing the result of loading the next page </h2><br>  Intent can be intercepted by anonymous <strong>BroadcastReceiver</strong> and sent to <strong>Handler</strong> (to execute in a UI thread).  All that remains is to call the adapter's <strong>notifyDataSetChanged</strong> method and remove the basement element if the last page is loaded. <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!hasNextPage() &amp;&amp; mList.getFooterViewsCount() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { mList.removeFooterView(mLoadingFooter); } mAdapter.notifyDataSetChanged();</code> </pre></div><p>Source: <a href="https://habr.com/ru/post/130319/">https://habr.com/ru/post/130319/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../130313/index.html">Google+ now supports real-time search and hashtags</a></li>
<li><a href="../130314/index.html">Google+ has instant search and support # hashtags</a></li>
<li><a href="../130316/index.html">Intel HD Graphics P3000 Workstation - Comparison and Application</a></li>
<li><a href="../130317/index.html">Mobile and tablet future of Flash looks less and less radiant</a></li>
<li><a href="../130318/index.html">Memory barriers and non-blocking synchronization in .NET</a></li>
<li><a href="../130320/index.html">Configuring Replication in SQL 2008</a></li>
<li><a href="../130321/index.html">We're saving ourselves from the paper flood, or how to spend the International Day without paper.</a></li>
<li><a href="../130323/index.html">"Bloated code" in commercial software development</a></li>
<li><a href="../130325/index.html">9 rules how to protect your Asterisk!</a></li>
<li><a href="../130326/index.html">Developing games with Intel: autumn webinar series</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>