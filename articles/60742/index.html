<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Memcached under OpenSolaris faster than under Linux</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Using our previous experience in memcached performance testing on SunFire X2270 (server based on Intel Xeon (Nehalem) processors) with OpenSolaris, we...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Memcached under OpenSolaris faster than under Linux</h1><div class="post__text post__text-html js-mediator-article">  Using our previous experience in <a href="http://blogs.sun.com/shanti/entry/multi_instance_memcached_performance">memcached performance testing</a> on SunFire X2270 (server based on Intel Xeon (Nehalem) processors) with OpenSolaris, we decided to run the same tests on the same server, but using RHEL5.  We have already noted in the post with the <a href="http://blogs.sun.com/shanti/entry/memcached_on_nehalem1">first test results</a> that in order to achieve the highest possible performance, we used Intel Oplin 10GbE network cards.  As it turned out, to use this card under Linux, we had to work a bit on the drivers and rebuild the kernel. <a name="habracut"></a><ul><li>  With the default ixgb driver from the RedHat distribution (version 1.3.30-k2 in kernel 2.6.18), the network interface just hung while running the test. </li><li>  So we had to download the driver from the Intel site (1.3.56.11-2-NAPI) and rebuild it.  With it, everything worked and the maximum throughput we received was 232K operations / second on the same kernel version 2.6.18.  However, this version of the kernel does not support multi-stream data transfer ( <i>note of the translator</i> - in the original multiply rings). </li><li>  Kernel version 2.6.29 includes multithreaded data transfer, but still does not include the latest version of the ixgb driver - 1.3.56-2-NAPI.  Therefore, we downloaded, compiled and installed new kernel and driver versions.  It worked and after a little tuning gave us the maximum throughput of 280K oper. / Sec. </li></ul><h3>  results </h3>  As we already <a href="http://blogs.sun.com/shanti/entry/memcached_on_nehalem1">reported</a> , the system with OpenSolaris and memcached 1.3.2 gave us a maximum throughput of about 350K ops.  On the same server with RHEL5 (with kernel 2.6.29) and the same version of memcached, we received 280K ops / sec.  It turns out that OpenSolaris bypasses Linux by 25%! <br><br><h4>  Linux tuning </h4>  The following system values ‚Äã‚Äãwere used to maximize performance. <pre>  net.ipv4.tcp_timestamps = 0
 net.core.wmem_default = 67108864
 net.core.wmem_max = 67108864
 net.core.optmem_max = 67108864
 net.ipv4.tcp_dsack = 0
 net.ipv4.tcp_sack = 0
 net.ipv4.tcp_window_scaling = 0
 net.core.netdev_max_backlog = 300000
 net.ipv4.tcp_max_syn_backlog = 200000 </pre>  The following parameters specific to the ixgb driver were set (2 queues to receive and 2 to send) <pre>  RSS = 2.2 InterruptThrottleRate = 1600.1600 </pre><br><h4>  OpenSolaris tuning </h4>  In / etc / system we set the following parameters for MSI-X ( <i>note of the translator</i> is in the original MSIX, but the parameters refer specifically to MSI-X): <pre>  set ddi_msix_alloc_limit = 4
 set pcplusmp: apic_intr_policy = 1 </pre>  For the ixgbe interface, the 4th transfer queue and the 4th reception, gave us the best performance: <pre>  tx_queue_number = 4, rx_queue_number = 4 </pre>  And besides, we allocated separate processor cores to the network interface: <pre>  dladm set-linkprop -p cpus = 12,13,14,15 ixgbe0 </pre><br>  <b>Upd</b> : The answer is Shanti why they used 2x2: Basically, we tried various settings.  On Linux, we got the best results with 2 + 2 rings.  On OpenSolaris, it was 4 + 4.  We are not performing well yet (it is relatively new). <br>  <i>Short translation:</i> because gladiolus <br></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/60742/">https://habr.com/ru/post/60742/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../60728/index.html">How are you crazy server from overheating</a></li>
<li><a href="../60729/index.html">LHC will work even in winter</a></li>
<li><a href="../60731/index.html">interesting bug in win xp</a></li>
<li><a href="../60733/index.html">RubyMine 1.1 release</a></li>
<li><a href="../60734/index.html">Rate the usefulness of the idea: online FB2Reader</a></li>
<li><a href="../60743/index.html">Chrome 3.0 dev</a></li>
<li><a href="../60749/index.html">Electronic elections to the European Parliament in the screenshots</a></li>
<li><a href="../60750/index.html">Bing - a new search engine officially announced</a></li>
<li><a href="../60752/index.html">Fear of change</a></li>
<li><a href="../60756/index.html">Unofficial iPhone client for accessing Yandex Traffic</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>