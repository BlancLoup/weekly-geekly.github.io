<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automation of fishing for World of Warcraft</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I got acquainted with World of Warcraft for a very long time and I love it all, but one thing that most haunted me was fishing. This is a tedious repe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automation of fishing for World of Warcraft</h1><div class="post__text post__text-html js-mediator-article">  I got acquainted with World of Warcraft for a very long time and I love it all, but one thing that most haunted me was fishing.  This is a tedious repetitive action, where you just press the fishing button and poke on the float every 5-15 seconds.  My development skill grew, and the fishing situation did not improve every year that I played, so I decided to kill two birds with one stone - start learning python and still make a bot for myself. <br><a name="habracut"></a><br>  I have already seen bots that know how to fish, working in the minimized mode without intercepting computer control.  I also know how ruthless blizzard on bans cheaters.  Changing data in RAM is easily detected by the built-in anti-cheat.  And finally - I did not find a single bot on the poppy. <br><br>  So I decided to close all these issues at once and make a bot that will intercept the mouse control, throw a float, and poke it on the screen when necessary.  As I thought, python has a wide selection of tools for automating such pieces, and it was not a mistake. <br><br>  A little google, I found <a href="http://opencv.org/">OpenCV</a> , in which there is a search for a template with a <a href="http://docs.opencv.org/trunk/d4/dc6/tutorial_py_template_matching.html">simple guide</a> .  With it, we will look for our float on the screen. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      First we have to get the picture itself with a float.  We search and find the pyscreenshot library with a <a href="https://pypi.python.org/pypi/pyscreenshot">guide</a> how to take screenshots, edit it a little bit: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pyscreenshot <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ImageGrab screen_size = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> screen_start_point = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> screen_end_point = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-comment"><span class="hljs-comment">#               def check_screen_size(): print "Checking screen size" img = ImageGrab.grab() # img.save('temp.png') global screen_size global screen_start_point global screen_end_point #            grab   bbox,       2.        x1=100, y1=100, x2=200, y2=200),    200200 (sic!),    2 coefficient = 2 screen_size = (img.size[0] / coefficient, img.size[1] / coefficient) #       . screen_start_point = (screen_size[0] * 0.35, screen_size[1] * 0.35) screen_end_point = (screen_size[0] * 0.65, screen_size[1] * 0.65) print ("Screen size is " + str(screen_size)) def make_screenshot(): print 'Capturing screen' screenshot = ImageGrab.grab(bbox=(screen_start_point[0], screen_start_point[1], screen_end_point[0], screen_end_point[1])) #  ,      OpenCV screenshot_name = 'var/fishing_session_' + str(int(time.time())) + '.png' screenshot.save(screenshot_name) return screenshot_name def main(): check_screensize() make_screenshot()</span></span></code> </pre> <br>  We get about the following picture: <br><br><img src="https://habrastorage.org/web/675/daa/26d/675daa26d87547e28eed731787164ed7.png"><br><br>  Next - find a float.  To do this, we must have the template of the float itself, which we are looking for.  After hundreds of attempts, I still picked up the ones that OpenCV defines best.  Here they are: <br><br><img src="https://habrastorage.org/web/9ec/0d0/51b/9ec0d051baf64f0d922bf0f23f84424b.png"><img src="https://habrastorage.org/web/987/bb8/490/987bb8490d9d47529ce5f7e8485981d1.png"><img src="https://habrastorage.org/web/a3f/04f/5e5/a3f04f5e579446b5bcf33aaf17efcfc0.png"><img src="https://habrastorage.org/web/65f/0d3/613/65f0d36138244b1da5d49eeaf38eb5a7.png"><img src="https://habrastorage.org/web/8b6/1d7/e35/8b61d7e35a9540d381254c5d1106ab6f.png"><img src="https://habrastorage.org/web/1ac/6f5/853/1ac6f5853f334421918ad1cb29322b43.png"><img src="https://habrastorage.org/web/9a2/4d9/1d2/9a24d91d22d246918ff06be90b81e508.png"><img src="https://habrastorage.org/web/7ce/8e7/497/7ce8e7497e214f09a00ff45ef43eb17d.png"><br><br>  Take the code from the <a href="http://docs.opencv.org/trunk/d4/dc6/tutorial_py_template_matching.html">link</a> above, add the loop and our templates: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cv2 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> matplotlib <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pyplot <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> plt <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_float</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(screenshot_name)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">'Looking for a float'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>): <span class="hljs-comment"><span class="hljs-comment">#   template = cv2.imread('var/fishing_float_' + str(x) + '.png', 0) #        src_rgb = cv2.imread(screenshot_name) src_gray = cv2.cvtColor(src_rgb, cv2.COLOR_BGR2GRAY) #      w, h = template.shape[::-1] #  OpenCV,        res = cv2.matchTemplate(src_gray, template, cv2.TM_CCOEFF_NORMED) #       0.8  0.6,           ,     ,         threshold = 0.6 # numpy      loc = np.where( res &gt;= threshold) #     for pt in zip(*loc[::-1]): cv2.rectangle(src_rgb, pt, (pt[0] + w, pt[1] + h), (0,0,255), 2) #      ,       if loc[0].any(): print 'Found float at ' + str(x) cv2.imwrite('var/fishing_session_' + str(int(time.time())) + '_success.png', src_rgb) return (loc[1][0] + w / 2) / 2, (loc[0][0] + h / 2) / 2 #    ,     ?      2 def main(): check_screensize() img_name = make_screenshot() find_float(img_name)</span></span></code> </pre><br>  So, we have the coordinates of the float, <a href="https://github.com/msanders/autopy/">autopy</a> can literally move the mouse cursor with a single line, we substitute our coordinates: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> autopy <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_mouse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(place)</span></span></span><span class="hljs-function">:</span></span> x,y = place[<span class="hljs-number"><span class="hljs-number">0</span></span>], place[<span class="hljs-number"><span class="hljs-number">1</span></span>] print(<span class="hljs-string"><span class="hljs-string">"Moving cursor to "</span></span> + str(place)) autopy.mouse.smooth_move(int(screen_start_point[<span class="hljs-number"><span class="hljs-number">0</span></span>]) + x , int(screen_start_point[<span class="hljs-number"><span class="hljs-number">1</span></span>]) + y) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> check_screensize() img_name = make_screenshot() cords = find_float(img_name) move_mouse(cords)</code> </pre><br>  The cursor on the float and now the most interesting - how do you know when to press?  Indeed, in the game itself, the float jumps up and makes a sound like something flops into the water.  After the image search tests, I noticed that OpenCV has to think half a second before it returns the result, and the float jumps even faster and we can hardly determine the change of the image using OpenCV, then we will listen to the sound.  For this task, I had to dig into different solutions and stopped here above <a href="https://gist.github.com/spadgenske/9162330">this</a> - an example of using Google for voice recognition, from there we take a code that reads sound. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pyaudio <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> wave <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> audioop <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> collections <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> deque <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> math <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">listen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">'Listening for loud sounds...'</span></span> CHUNK = <span class="hljs-number"><span class="hljs-number">1024</span></span> FORMAT = pyaudio.paInt16 CHANNELS = <span class="hljs-number"><span class="hljs-number">2</span></span> RATE = <span class="hljs-number"><span class="hljs-number">18000</span></span> <span class="hljs-comment"><span class="hljs-comment">#  ,     THRESHOLD = 1200 #   ,   ,        SILENCE_LIMIT = 1 #  ,       ,     #   p = pyaudio.PyAudio() stream = p.open(format=FORMAT, channels=CHANNELS, rate=RATE, # output=True, #       output,       &lt;a href="https://github.com/RogueAmoeba/Soundflower-Original"&gt;Soundflower&lt;/a&gt;,     output  input,          input=True, frames_per_buffer=CHUNK) cur_data = '' rel = RATE/CHUNK slid_win = deque(maxlen=SILENCE_LIMIT * rel) #      20  (     ),   . success = False listening_start_time = time.time() while True: try: cur_data = stream.read(CHUNK) slid_win.append(math.sqrt(abs(audioop.avg(cur_data, 4)))) if(sum([x &gt; THRESHOLD for x in slid_win]) &gt; 0): print 'I heart something!' success = True break if time.time() - listening_start_time &gt; 20: print 'I don\'t hear anything during 20 seconds!' break except IOError: break #    stream.close() p.terminate() return success def main(): check_screensize() img_name = make_screenshot() cords = find_float(img_name) move_mouse(cords) listen()</span></span></code> </pre><br>  The last thing left is to catch the fish itself, when we hear the sound, we use autopy again: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">snatch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">'Snatching!'</span></span>) autopy.mouse.click(autopy.mouse.RIGHT_BUTTON) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> check_screensize() img_name = make_screenshot() cords = find_float(img_name) move_mouse(cords) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> listen(): snatch()</code> </pre><br>  According to my tests, that I left the bot to fish at night, during the week of such an abuse, he made about 7,000 throws and <s>caught</s> about 5,000 fish.  The error of 30% is caused by the fact that sometimes it is impossible to catch the sound or to find a float due to lighting or turning the float.  But I am satisfied with the result - I tried python for the first time, made a bot and saved myself a lot of time. <br><br>  The full code can be viewed <a href="https://github.com/kioltk/wow-fishipy">here</a> , but I strongly advise you not to use phishing for an abuse, because automating the processes of the game <b>violates the user agreement</b> and you can get a ban. <br><br>  I would welcome any comments. </div><p>Source: <a href="https://habr.com/ru/post/335580/">https://habr.com/ru/post/335580/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../335570/index.html">New Safari tools for debugging WebRTC</a></li>
<li><a href="../335572/index.html">Record of the webinar "How to securely protect the company from unknown threats and cryptographers"</a></li>
<li><a href="../335574/index.html">Do-it-yourself chat bot: the story of one bike</a></li>
<li><a href="../335576/index.html">Digital economy and ecosystem R</a></li>
<li><a href="../335578/index.html">DLP and the Law: how to properly arrange the introduction of a system to protect against leaks</a></li>
<li><a href="../335584/index.html">What's new in PHP 7.2?</a></li>
<li><a href="../335586/index.html">Visualization of Moscow Exchange data using InterSystems DeepSee</a></li>
<li><a href="../335588/index.html">Planetary landscape</a></li>
<li><a href="../335590/index.html">Social Organism - as a form of effective team interaction. Part 2</a></li>
<li><a href="../335592/index.html">Cisco Digital Network Architecture: Key Features of the New Platform</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>