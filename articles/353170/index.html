<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The book "Clean Architecture. The art of software development</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚ÄúPerfect Programmer‚Äù and ‚ÄúClean Code‚Äù - Robert Martin's legendary bestsellers - tell you how to achieve the heights of professionalism. ‚ÄúPure architec...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The book "Clean Architecture. The art of software development</h1><div class="post__text post__text-html js-mediator-article"> <a href="https://habrahabr.ru/company/piter/blog/353170/"><img src="https://habrastorage.org/webt/3l/ne/kr/3lnekrbjvi-k2_i70juv-hxmrag.jpeg" align="left" alt="image"></a>  ‚ÄúPerfect Programmer‚Äù and ‚ÄúClean Code‚Äù - Robert Martin's legendary bestsellers - tell you how to achieve the heights of professionalism.  ‚ÄúPure architecture‚Äù continues this theme, but does not offer several options in the ‚Äúsolve it yourself‚Äù style, but explains what exactly should be done, for what reason, and why exactly such a decision will become crucial for your success. <br><br>  Robert Martin gives direct and concise answers to key questions of architecture and design.  "Pure architecture" must be read by developers of all levels, system analysts, architects and every programmer who wants to climb the career ladder or at least influence the people who are engaged in this work.  All architectures follow the same rules!  Robert Martin (Uncle Bob) <br><a name="habracut"></a><br><h3>  Proficiency Test </h3><br>  Why are so many software turning into firmware?  It seems that the main reason is the desire to get a valid embedded code and almost no attention is paid to its structuring to increase the service life.  Kent Beck describes three steps in creating software (the words of Kent are quoted in quotes and my comments are in italics): <br><br><ol><li>  "First make it work."  You will remain out of work if it does not work. </li><li>  "Then rewrite it correctly."  Reorganize the code so that you and others can understand and develop it when you need to change or understand something. </li><li>  "Then make it work fast."  Reorganize the code to achieve the "necessary" performance. </li></ol><br>  Most of the embedded systems that I had to see seemed to be written with a single thought in my head: ‚ÄúMake it work,‚Äù and sometimes with an obsessive idea: ‚ÄúMake it work fast,‚Äù embodied by introducing micro-optimizations at every opportunity.  In his book <a href="https://en.wikipedia.org/wiki/The_Mythical_Man-Month">The Mythical Man-Month,</a> Fred Brooks proposes "to plan on giving up the first version."  Kent and Fred advise almost the same thing: find out how it works and find the best solution. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Embedded software is no different with respect to these problems.  Many non-embeddable applications are brought only to the ‚Äúworking‚Äù stage, and little is done to make the code correct and serve for a long time. <br><br>  Getting a working application is what I call a proficiency test for a programmer.  A programmer who develops software, whether embedded or not, who only cares about getting a working application, harms his products and his employer.  Programming is more than the ability to write working applications. <br><br>  As an example, take a look at the following functions that are in the same file of a small embedded system, written in the course of passing a proficiency test: <br><br><pre><code class="hljs cs">ISR(TIMER1_vect) { ... } ISR(INT2_vect) { ... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn_Handler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span></span><span class="hljs-function">)</span></span> { ... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calc_RPM</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span></span><span class="hljs-function">)</span></span> { ... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Read_RawData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span></span><span class="hljs-function">)</span></span> { ... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Do_Average</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span></span><span class="hljs-function">)</span></span> { ... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get_Next_Measurement</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span></span><span class="hljs-function">)</span></span> { ... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Zero_Sensor_1</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span></span><span class="hljs-function">)</span></span> { ... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Zero_Sensor_2</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span></span><span class="hljs-function">)</span></span> { ... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dev_Control</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Activation</span></span></span><span class="hljs-function">)</span></span> { ... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load_FLASH_Setup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span></span><span class="hljs-function">)</span></span> { ... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save_FLASH_Setup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span></span><span class="hljs-function">)</span></span> { ... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Store_DataSet</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span></span><span class="hljs-function">)</span></span> { ... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bytes2float</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bytes[</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">4</span></span></span></span><span class="hljs-function"><span class="hljs-params">]</span></span></span><span class="hljs-function">)</span></span> { ... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Recall_DataSet</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span></span><span class="hljs-function">)</span></span> { ... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Sensor_init</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span></span><span class="hljs-function">)</span></span> { ... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uC_Sleep</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span></span><span class="hljs-function">)</span></span> { ... }</code> </pre> <br>  In this order, the functions were declared in the source file.  And now we divide them and group them by the tasks to be solved: <br><br>  functions that implement the subject logic: <br><br>  ‚Ä¢ float calc_RPM (void) {...} <br>  ‚Ä¢ void Do_Average (void) {...} <br>  ‚Ä¢ void Get_Next_Measurement (void) {...} <br>  ‚Ä¢ void Zero_Sensor_1 (void) {...} <br>  ‚Ä¢ void Zero_Sensor_2 (void) {...} <br><br>  functions serving the hardware platform: <br><br>  ‚Ä¢ ISR (TIMER1_vect) {...} * <br>  ‚Ä¢ ISR (INT2_vect) {...} <br>  ‚Ä¢ void uC_Sleep (void) {...} <br><br>  functions that respond to button presses: <br><br>  ‚Ä¢ void btn_Handler (void) {...} <br>  ‚Ä¢ void Dev_Control (char Activation) {...} <br><br>  function that reads data from an analog-to-digital hardware converter: <br><br>  ‚Ä¢ static char Read_RawData (void) {...} <br><br>  functions writing values ‚Äã‚Äãto long-term storage: <br><br>  ‚Ä¢ char Load_FLASH_Setup (void) {...} <br>  ‚Ä¢ void Save_FLASH_Setup (void) {...} <br>  ‚Ä¢ void Store_DataSet (void) {...} <br>  ‚Ä¢ float bytes2float (char bytes [4]) {...} <br>  ‚Ä¢ void Recall_DataSet (void) {...} <br><br>  a function that does not do what its name implies: <br><br>  ‚Ä¢ void Sensor_init (void) {...} <br><br>  Looking into the other files of this application, I found many obstacles hindering the understanding of the code.  I also found that organizing files implies the only way to test this code directly inside the target device.  Virtually every bit of this code knows what is related to a specialized microprocessor architecture using the ‚Äúextended‚Äù C1 language constructs that tie the code to a specific set of tools and the microprocessor.  This code does not have the slightest chance to serve for a long time if it is decided to transfer the product to another hardware platform. <br><br>  The application works: the engineer passed the test for professional suitability.  But it cannot be said that it has a clean embedded architecture. <br><br><h3>  Binding to equipment - a bottleneck </h3><br>  There are a lot of special problems faced by developers of embedded systems and not familiar to the developers of conventional software.  For example, limited memory, time constraints on operations, limited I / O capabilities, unconventional user interfaces, and the presence of sensors and contacts connecting to the outside world.  In most cases, hardware develops in parallel with software and firmware.  As an engineer who develops code for this type of system, you may not have a place to run the code.  But this is not the worst - the resulting equipment may have its own drawbacks, which slows down the development of software more than usual. <br><br>  Yes, embedded software has its own characteristics, and embedded system engineers are special people.  But the development of embedded systems is not so special that the principles described in this book cannot be applied to embedded systems. <br><br>  One of the special problems of embedded systems is the close dependency on hardware.  When embedded code is structured without applying the principles and techniques of a clean architecture, one often comes across a scenario where the code can be tested only on target hardware.  If this equipment is the only place where testing is possible, such a close relationship begins to slow you down. <br><br><h3>  Net Embedded Architecture - Testing Supporting Architecture </h3><br>  Let's take a look at how some architectural principles apply to embedded software and firmware, and how they can help get rid of tight hardware bindings. <br><br>  <b>Levels</b> <br><br>  The division into levels can be done in different ways.  Let's begin with the three-level organization shown in Fig.  29.1.  Below is the level of equipment.  As Doug warns, due to improved technology and according to Moore's law, equipment will change.  Some components become obsolete, and they are replaced by new components that consume less electricity, or have better performance, or are cheaper.  Regardless of the reasons, I, as an embedded systems engineer, would not like to do more than is necessary when the inevitable change in equipment finally occurs. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ix/6q/gn/ix6qgnipekwla8fk-rh_i8egpma.png" alt="image"></div><br>  The separation between the equipment and the rest of the system is an objective reality, at least after the equipment has been defined (fig. 29.2).  This is where problems often arise when trying to pass a proficiency test.  Nothing prevents hardware knowledge from infecting the entire code.  If you do not take care when structuring the code and do not limit the leakage of information about one module to another, the code will be difficult to change.  I speak not only about the case when the equipment changes, but also about the situation when you need to correct the error or make a change at the user's request. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vy/6r/ao/vy6raoedqbbk1m26duf-0yy13zs.png" alt="image"></div><br>  Mixing software and firmware is an anti-pattern.  Code demonstrating this anti-pattern will resist changes.  In addition, changes are fraught with hazards, often leading to unintended consequences.  Even minor changes require complete regression testing of the system.  If you have not created tests with external equipment, prepare to do manual testing and then wait for new error messages. <br><br>  <b>Equipment is a detail</b> <br><br>  The line between software and firmware is usually not as clearly visible as the line separating code and hardware (Fig. 29.3). <br><br>  One of the tasks of the developer of embedded software is to strengthen this line.  The boundary between software and firmware (Figure 29.4) is called the Hardware Abstraction Layer (HAL).  This is not a new idea: it was implemented in personal computers in the pre-Windows era. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tp/sp/1b/tpsp1b378kz1jkdqynrwktrpb5g.png" alt="image"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/_2/wc/re/_2wcretw_exlqgh9qbeyf9wscki.png" alt="image"></div><br>  The HAL layer exists for the software above it, and its API must adapt to the needs of this software.  For example, the firmware can store bytes and arrays of bytes in flash memory, and the application needs to store and read name / value pairs using some kind of storage mechanism.  Software should not care about the details of storing name / value pairs in flash memory, on a rotating disk, in the cloud or in main memory.  The hardware abstraction layer (HAL) provides a service and does not disclose to the software how it works.  Flash support implementation is a part that should be hidden from software. <br><br>  Another example: LED control is tied to a GPIO bit.  The firmware can provide access to the GPIO bits, and the HAL layer can have the Led_TurnOn (5) function.  This is a fairly low-level layer of hardware abstraction.  Let's see how to raise the level of abstraction in terms of software / product.  What information does the LED report?  Suppose that the inclusion of the LED indicates a low battery.  At some level, the firmware (or platform support package) may provide the Led_TurnOn (5) function, and the HAL layer may provide the Indicate_LowBattery () function.  In this way, the HAL layer expresses the purpose of the service for the application.  In addition, levels may contain sublevels.  This is more like a repeating fractal pattern than a limited set of predefined levels.  The purpose of the GPIO I / O is the details that should be hidden from the software. <br><br>  ¬ªMore information about the book can be found on <a href="https://www.piter.com/collection/all/product/chistaya-arhitektura-iskusstvo-razrabotki-programmnogo-obespecheniya">the publisher's website.</a> <br>  ¬ª <a href="https://storage.piter.com/upload/contents/978544610772/978544610772_X.pdf">Table of Contents</a> <br>  ¬ª <a href="https://storage.piter.com/upload/contents/978544610772/978544610772_p.pdf">Excerpt</a> <br><br>  For Habrozhiteley a discount of 20% on the coupon - <b>Pure architecture</b> </div><p>Source: <a href="https://habr.com/ru/post/353170/">https://habr.com/ru/post/353170/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../353160/index.html">Proof-of-Proof-of-Work on the fingers. On the way to a sensible blockchain</a></li>
<li><a href="../353162/index.html">Phone + CRM: The Benefits of Collaboration</a></li>
<li><a href="../353164/index.html">Where does a quality strategy begin and why is it needed in product management?</a></li>
<li><a href="../353166/index.html">And we will have a real cosmonaut! On Imagine Cup 2018</a></li>
<li><a href="../353168/index.html">Store data in the cloud</a></li>
<li><a href="../353172/index.html">Three microservice stories, or MSA for Enterprise</a></li>
<li><a href="../353174/index.html">Overview of ECMAScript 2016, 2017, and 2018 with examples</a></li>
<li><a href="../353176/index.html">Fintech Digest: Rockefellers and Soros are invested in cryptocurrencies, the Central Bank is looking for the dissatisfied in social networks, Bitcoin is getting cheaper</a></li>
<li><a href="../353182/index.html">Features of using real x86 architecture registers</a></li>
<li><a href="../353184/index.html">[Peter] JUG.ru meeting with Dmitry Alexandrov - Java on GPU</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>