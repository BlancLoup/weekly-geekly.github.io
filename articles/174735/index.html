<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automated integration testing of an ASP.NET application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I want to share the experience of creating an infrastructure for integration testing of a web application. The application is built on...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automated integration testing of an ASP.NET application</h1><div class="post__text post__text-html js-mediator-article">  In this article I want to share the experience of creating an infrastructure for integration testing of a web application.  The application is built on the .Net platform and consists of an ASP.NET MVC application and a database in MSSQL <br><br>  The task of integration testing was formulated as follows: automate the deployment of the application and the execution of user interface tests so that you can quickly verify that the installed version of the application successfully processes all the necessary test scenarios. <br><br>  In other words, we need to quickly check what will happen when we install the new version to the customer and start working with it.  Since the result of these tests is an indicator of the quality of the application being created, we will always know the quality of our application, and therefore the situation in which we are. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Since integration testing will allow simulating user actions, it can be said that it will allow verification of the fact that such TK item was successfully completed.  If we create tests for each item of the technical assignment (we get the program and testing methodology - PMI :) and automate them, then the number of successfully completed tests will mean real information about the percentage of technical tests performed.  Otherwise, the assessment of the state of the system will be as follows: <br>  - Well, how is our system today, if in one word? <br>  - If in one word, then ... it works. <br>  - And if in two words? <br>  - And if in a nutshell, it does not work. <br><br>  What should be checked with this testing: <br>  - Compiling and building the application <br>  - The procedure for installing or updating the application: <br>  - Install new or update existing database <br>  - Installing a new ASP.NET application <br>  - Execution of test scenarios in each of which: <br>  - The system is prepared to run the script.  Since each scenario has preconditions, it is necessary to adjust the system to these conditions.  For example, if for a script it is necessary that the user in the system creates three orders, you must somehow get the user data in the database and three of his orders. <br>  - Runs a test script by emulating user actions in the browser. <br>  - The system returns to the state it was in before the script was executed, actually to the state immediately after installing the application <br>  - Reporting the quality of the application <br>  - Build an installation package containing applications of known quality. <br><br><a name="habracut"></a><br><br>  This process is shown in the diagram below. <br><img src="https://habrastorage.org/storage2/375/17f/454/37517f454028f58920280406aad8bb81.png"><br>  I want to note that this scheme allows you to play on the developer‚Äôs machine and on Continues Integration Server the same actions that will be performed on an industrial environment during and after installing the updated application there. <br><br><h4>  Basic configurations </h4><br>  Below you can see how the configurations should be deployed in different environments for integration testing and industrial use.  I want to immediately note that the interaction with the application in all environments is the same.  The interaction with the application occurs through the browser, the database is updated in the form of execution of the database update script, and the ASP.NET application is updated via the standard Deployment. <br><br><h5>  Configuration on the developer machine </h5><br><img src="https://habrastorage.org/storage2/267/616/565/267616565a75333297537a1cabdb033c.png"><br>  In the developer's configuration, Visual Studio is used as the main tool. <br><br>  In this configuration, it is supposed to use the DBMS on the developer's machine.  I think this option is better than the option when all developers use one common database.  On the one hand, the common database is cheaper to maintain and each developer always has the latest version of the database.  But on the other hand, in such databases, you can easily get a violation of data integrity, for example, you can enter several incorrect orders, because the developer forgot to do some kind of checking.  He will, of course, check later, and more incorrect orders will not be created in the system.  But another developer can continue to debug his functionality on the wrong orders and make a lot of hidden errors. <br><br>  In the case of a personal database, the task of creating complete data becomes clear and easier to solve.  This is written below in the "Little Tricks" section. <br><br>  Before the integration test, the developer must restore the working database from the industrial server to the integration testing database.  Of course, it is impossible to get a working base from an industrial stand, but still there must be some kind of database as close as possible to it in order to correctly check the process of updating the database.  As an option, the working database can be depersonalized, that is, a copy of the working database is made, and then the names of customers and contract amounts change in it, so that the commercial information does not reach the developers and testers. <br><br>  The first stage of the test will be to check the deployment of the database, that is, the developer will perform the publication of the database.  To do this, the developer publishes the Database Project to the target database.  During the project build, Visual Studio will climb into the target database, compare it with the scripts of the current project, and make a difference script, which will be executed.  Already errors can occur here, for example, you forgot to create a field referenced by the secondary key, or when you insert the initial data, a conflict of primary keys occurred.  It turns out that the developer finds and corrects all these errors at the testing stage and not at the implementation stage, I think everyone knows how much it saves nerves. <br><br>  The next step, the developer runs the tests through the Visual Studio Test Runner.  The integration tests fill the database with the data required for the test, and thus meet the preliminary requirements of the tests, then the test, via the Selenium RC Server, calls the browser and simulates the user's actions.  The result of the test is checked again through the browser, you can also get data from the database for comparison with the reference. <br><br>  After the test, the database returns to its original state. <br><br>  As a result, after running the tests, you can see the general state of the system. <br><br><h5>  Configuration on Continues integration server </h5><br><img src="https://habrastorage.org/storage2/c45/25e/a8f/c4525ea8f059952ae814095a7c740395.png"><br>  Here, instead of Visual Studio, the Continues integration server is used, but all actions are similar to those on the developer‚Äôs machine. <br><br><h5>  Configuration on industrial environment </h5><br><img src="https://habrastorage.org/storage2/86f/1da/a9f/86f1daa9f4cfc62d4fd17d6976e1443a.png"><br>  On an industrial environment, an update is installed through an installer that works with an industrial environment in the same way as it was in integration tests.  Users also work with the system as it was tested in tests.  There should be no unpleasant surprises. <br><br><h4>  Required Tools </h4><br><br>  To create the necessary infrastructure, the following tools are needed: <br><br>  Visual Studio Solution, which contains several projects: <br>  - Project "SQL Server Database Project".  As you know, such a project allows you to store all DDL and SQL scripts that are needed to develop the structure and initial filling of the database.  The main advantage of this project is that it can generate a differential script to update an existing database to the latest version.  This allows you to install updates without deleting existing data.  Moreover, this operation can be automated through MSBuild and performed on the Continues Integration server. <br>  - Project with ASP.NET application.  Contains the application itself.  The same project is used to check the deployment of a web application to the server, again automatically using MSBuild. <br>  - A project containing integration tests.  This is an MSTest or NUnit project.  This project will be used to run tests and create a test report. <br><br>  This is the minimum set of projects that is necessary for the organization of automated integration testing. <br><br>  Of course, Solution is stored in a version control system, such as SVN. <br><br>  In addition, the solution contains the nuGet package "Selenuim Remote Contol".  Unfortunately, the Selenim IDE does not fully support the new ‚ÄúSelenium WebDriver‚Äù, so you can export test scripts from Selenim IDE to C # code only for Remote Contol.  Otherwise, part of the steps will not be exported to C # and you will have to write them with your hands, which is much slower than through export from Selenim IDE. <br><br>  For "Selenuim Remote Contol" you need java application "selenium-server-standalone-xxxjar" <br><br>  For quick and easy test recording, you will need FireFox with the Selenim IDE add-on installed. <br><br>  You also need a Continues Integration server to continuously get the latest version from SVN and run tests. <br><br><h4>  Environment setup </h4><br>  I will show how to install and configure the products described above on various stands. <br><br><h5>  database project </h5><br>  Let's start with the database project.  Database project can have several publish.xml files in each of which it is described where and how the database will be published.  Since each developer‚Äôs database is located at his own address, these files must be removed from the version control system and configured by each developer separately. <br><br>  To publish the database, right-click on this file in Visual Studio and select "Publish".  The publication is similar to the deployment (Deploy), except that the deployment settings are stored in the project properties, and the publication settings in publish.xml. <br><br>  To publish the database from the command line, you need to call the following command: <br>  &gt; MSBuild / t: Publish /p:SqlPublishProfilePath= mymypublishfile.publish.xml ¬ªDBProject.sqlproj <br><br><h5>  Web application </h5><br>  An ASP.NET application in Visual Studio can be launched using the ‚ÄúRun‚Äù command or deployed using standard Visual Studio tools.  On Continues Integration Server, this can also be done in various ways, for example, through xCopy.  I will not dwell on this in more detail, because it is, on the one hand, a large enough material, and on the other hand, it is easy to find on the Internet. <br><br><h5>  Selenium Server </h5><br><br>  You also need a Selenium RC server, which can be downloaded here: <a href="http://docs.seleniumhq.org/download/">docs.seleniumhq.org/download</a> <br><br>  Starts the server with the command <br>  &gt; java -jar c: \ selenium \ selenium-server.jar -multiwindow <br><br>  When the server is running, you can run tests. <br><br><h5>  Test project with integration tests </h5><br>  This can be an MSTest project or a NUnit project. <br>  First you need to install the nuGet Selenium.RC package into it. <br><img src="https://habrastorage.org/storage2/3d5/29d/5e6/3d529d5e6ade92001876383855725f68.png"><br><br>  As mentioned at the beginning of each test, you need to run a SQL script that fills the database with data for the test.  Since I often work with scripts created in SQL Server Management Studio, the ‚ÄúGO‚Äù command is always found in them.  To execute such scripts, the smo library is used, these are several assemblies that can be installed as part of the MSSQL Server SDK and found for example in "C: \ Program Files (x86) \ Microsoft SQL Server \ 110 \ SDK \ Assemblies", but you should take into account that they are compiled for .Net 2.0 and just make them work in .Net 4.0 and later fail.  Therefore, a test application, I usually configure for .Net 3.5 <br><br>  After this, you can make such an auxiliary class in the test project: <br><br><pre><code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TestDBHelper</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExecScript</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">String scriptName</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> sqlConnectionString = System.Configuration.ConfigurationManager.ConnectionStrings[<span class="hljs-string"><span class="hljs-string">"TestDBConnection"</span></span>].ConnectionString; FileInfo file = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInfo(Path.Combine(<span class="hljs-string"><span class="hljs-string">"SQL"</span></span>, scriptName)); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> script = file.OpenText().ReadToEnd(); SqlConnection conn = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SqlConnection(sqlConnectionString); Server server = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Server(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServerConnection(conn)); server.ConnectionContext.ExecuteNonQuery(script); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BackupBeforeTest</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { TestDBHelper.ExecScript(<span class="hljs-string"><span class="hljs-string">"BackupBeforeTest.sql"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RestoreAfterTest</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { TestDBHelper.ExecScript(<span class="hljs-string"><span class="hljs-string">"RestoreAfterTest.sql"</span></span>); } }</code> </pre> <br><br>  I have all the SQL scripts in the same test project in the ‚ÄúSQL‚Äù folder, and for each script the ‚ÄúCopy to Output directory‚Äù property is set to ‚ÄúCopy if newer‚Äù <br><br>  What is in the scripts "BackupBeforeTest.sql" and "RestoreAfterTest.sql" is written below. <br><br>  As a result, the test looks something like this: <br><br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">TestClass</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SimpleTest</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ISelenium selenium; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> StringBuilder verificationErrors; [TestInitialize] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Init</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { TestDBHelper.BackupBeforeTest(); TestDBHelper.ExecScript(<span class="hljs-string"><span class="hljs-string">"CreateTestUser.sql"</span></span>); selenium = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultSelenium(<span class="hljs-string"><span class="hljs-string">"localhost"</span></span>, <span class="hljs-number"><span class="hljs-number">4444</span></span>, <span class="hljs-string"><span class="hljs-string">"*chrome"</span></span>, <span class="hljs-string"><span class="hljs-string">"http://localhost:12945/"</span></span>); selenium.Start(); verificationErrors = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); } [TestCleanup] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CleanUp</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { selenium.Stop(); TestDBHelper.RestoreAfterTest(); } [TestMethod] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestLogin</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (selenium.IsElementPresent(<span class="hljs-string"><span class="hljs-string">"link=  []"</span></span>)) { selenium.Click(<span class="hljs-string"><span class="hljs-string">"link=  []"</span></span>); selenium.WaitForPageToLoad(<span class="hljs-string"><span class="hljs-string">"30000"</span></span>); } selenium.Open(<span class="hljs-string"><span class="hljs-string">"/"</span></span>); selenium.Click(<span class="hljs-string"><span class="hljs-string">"link="</span></span>); selenium.WaitForPageToLoad(<span class="hljs-string"><span class="hljs-string">"30000"</span></span>); selenium.Type(<span class="hljs-string"><span class="hljs-string">"id=UserName"</span></span>, <span class="hljs-string"><span class="hljs-string">"TestUser"</span></span>); selenium.Type(<span class="hljs-string"><span class="hljs-string">"id=Password"</span></span>, <span class="hljs-string"><span class="hljs-string">"123456"</span></span>); selenium.Click(<span class="hljs-string"><span class="hljs-string">"css=input.btn"</span></span>); selenium.WaitForPageToLoad(<span class="hljs-string"><span class="hljs-string">"30000"</span></span>); Assert.IsFalse(selenium.IsElementPresent(<span class="hljs-string"><span class="hljs-string">"css=div.validation-summary-errors &gt; ul &gt; li"</span></span>), <span class="hljs-string"><span class="hljs-string">"  "</span></span>); Assert.IsTrue(selenium.IsElementPresent(<span class="hljs-string"><span class="hljs-string">"link=  []"</span></span>), <span class="hljs-string"><span class="hljs-string">"  "</span></span>); } }</code> </pre> <br><br>  This simple test verifies user login. <br>  Before executing the test, the Backup database is done and the ‚ÄúCreateTestUser.sql‚Äù script is executed, which creates the user with the necessary parameters. <br>  After the test is completed, the database is restored from the backup in order to clear the database of the data remaining after the test. <br><br>  Unfortunately, integration tests cannot be completely isolated from each other, in particular, using the Seleniun tool, you cannot remove the ‚ÄúASP.NET_Session‚Äù cookie from the browser, because it is marked as HTTPOnly.  Because of this, you have to check whether the user is logged in from the past test or not, and if you‚Äôre left, you have to simulate the user's logout, and thus reset the session state. <br><br>  The rest of the test course is fairly obvious.  A login and password is entered and it is checked that there is no error message, and a link to logout appears.  How to write such a test using Selenium IDE, see below. <br><br><h5>  Firefox and Selenium IDE.  Creating tests </h5><br>  Selenium allows you to run tests on many browsers, but for quick creation you need to use FireFox with the ‚ÄúSelenium IDE‚Äù add-on installed. <br><br>  Why is this ‚ÄúSelenium IDE‚Äù so good? <br>  Firstly, it is very convenient for quick writing tests.  You can turn on the recording mode and start working with the web application, and selenium will record all your actions.  But I‚Äôll say right away that in the case of an AJAX application, this does not work out because you have to constantly wait for the server's response, and this ‚ÄúSelenium IDE‚Äù does not automatically do.  Nevertheless, even in this case, it is possible to add such expectation to the test process. <br><br><img src="https://habrastorage.org/storage2/d5f/061/1f1/d5f0611f17cb3621d870f4c389257337.png"><br><br>  The illustration shows a test that will check the change records in the directory.  This page is implemented using the DevExpress MVC Extension and contains a lot of AJAX code, so steps like ‚ÄúWaitFor ...‚Äù have been added, which are just waiting for the necessary updates to appear in the browser. <br><br>  It is also a great advantage that the test can be quickly debugged through the ‚ÄúSelenium IDE‚Äù.  Just click the "Run Test" button and check that everything works. <br><br>  After the test has been debugged, it can be saved into the c # file, using the ‚ÄúExport Test Sute As‚Äù / ‚ÄúC # / NUnit / Remote Control‚Äù command, and copying the contents of the test methods into the test project.  All this significantly increases the speed of creating tests compared to the option when you immediately write a test in C #, and debug it by running it through MSTest or NUnit. <br><br>  And the most remarkable feature of ‚ÄúSelenium IDE‚Äù is the fact that testers can write these tests for their own purposes, and if a test is very important, it can be transferred to developers and they will add it to the list of integration tests.  The result is that testers help write tests, although of course you should not forget that testers cannot write SQL scripts that will prepare the database for the test, and this is an essential part of the test. <br><br><h4>  Little tricks </h4><br><h5>  Creating and loading test data in the database </h5><br>  The data for the test is needed to bring the system to the state described in the precondition to the test.  For example, there must be a buyer who placed three orders.  The easiest way to create a buyer and orders through the user interface.  Next, you need to unload data from the required tables into SQL scripts in the form of SQL Dump.  And then use this script when running the test. <br><br>  An example of such a script: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> IDENTITY_INSERT [dbo].[<span class="hljs-keyword"><span class="hljs-keyword">User</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> [dbo].[<span class="hljs-keyword"><span class="hljs-keyword">User</span></span>] ([UserId], [<span class="hljs-keyword"><span class="hljs-keyword">Login</span></span>], [<span class="hljs-keyword"><span class="hljs-keyword">Password</span></span>], [DisplayName]) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1000001</span></span>, N<span class="hljs-string"><span class="hljs-string">'TestUser'</span></span>, N<span class="hljs-string"><span class="hljs-string">'7dHZDOYgwADlGdinx9u/c4Cmhtc='</span></span>, N<span class="hljs-string"><span class="hljs-string">' '</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> IDENTITY_INSERT [dbo].[<span class="hljs-keyword"><span class="hljs-keyword">User</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> IDENTITY_INSERT [dbo].[<span class="hljs-keyword"><span class="hljs-keyword">Order</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> [dbo].[<span class="hljs-keyword"><span class="hljs-keyword">Order</span></span>] ([OrderId], [UserId], [Description], [Price]) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1000001</span></span>, <span class="hljs-number"><span class="hljs-number">1000001</span></span>, N<span class="hljs-string"><span class="hljs-string">' ‚Ññ1'</span></span>, <span class="hljs-number"><span class="hljs-number">100.0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> [dbo].[<span class="hljs-keyword"><span class="hljs-keyword">Order</span></span>] ([OrderId], [UserId], [Description], [Price]) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1000002</span></span>, <span class="hljs-number"><span class="hljs-number">1000001</span></span>, N<span class="hljs-string"><span class="hljs-string">' ‚Ññ2'</span></span>, <span class="hljs-number"><span class="hljs-number">200.0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> [dbo].[<span class="hljs-keyword"><span class="hljs-keyword">Order</span></span>] ([OrderId], [UserId], [Description], [Price]) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1000003</span></span>, <span class="hljs-number"><span class="hljs-number">1000001</span></span>, N<span class="hljs-string"><span class="hljs-string">' ‚Ññ3'</span></span>, <span class="hljs-number"><span class="hljs-number">300.0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> IDENTITY_INSERT [dbo].[<span class="hljs-keyword"><span class="hljs-keyword">Order</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span></code> </pre> <br><br>  This script can be obtained through programs like ‚ÄúSQL Dumper‚Äù or through SQL Server Management Studio, which has a good wizard for generating scripts on database objects, including table data. <br><br>  - [Manage ID records in the database] - <br><br>  I think you have already noticed that identifiers, in data creation scripts, start with 1,000,000, not 1. <br>  This is due to the fact that when you have a combat database, identifiers with small values ‚Äã‚Äãare probably already used, and if you try to insert these values ‚Äã‚Äãinto the script, you will get a violation of the uniqueness of identifiers. <br><br>  To avoid this, it is necessary to immediately set the initial value for the generator of identifiers in a million or even a billion in the development and test databases. <br><br><h5>  Clearing the database after the test </h5><br>  The simplest and most effective way would be to use transactions, but in our configuration, the test and the application are executed in different processes and it is not possible to easily use one transaction in both processes. <br>  However, you can use a simple and fast mechanism for DataBase backups.  But we must remember that creating and restoring a normal backup is a relatively long process, but there is a Snapshot backup, it is designed to quickly create and restore a database. <br><br>  so before each test I create a backup script from the file ‚ÄúBackupBeforeTest.sql‚Äù <br><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">master</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.databases <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> = N<span class="hljs-string"><span class="hljs-string">'MyDataBase_Spanpshot'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> MyDataBase_Spanpshot <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> MyDataBase_Spanpshot <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> = <span class="hljs-string"><span class="hljs-string">'DataBase_data_File'</span></span>, FILENAME = <span class="hljs-string"><span class="hljs-string">'C:\MyDataBase_TestBU.SNP'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SNAPSHOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OF</span></span> MyDataBase;</code> </pre> <br><br>  and after the test I restore it with the following script from ‚ÄúRestoreAfterTest.sql‚Äù: <br><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">master</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @DatabaseName <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> @DatabaseName = N<span class="hljs-string"><span class="hljs-string">'MyDataBase'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">max</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(@<span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>) + <span class="hljs-string"><span class="hljs-string">' BEGIN TRY Kill '</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">Convert</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>, SPId) + <span class="hljs-string"><span class="hljs-string">'; END TRY BEGIN CATCH END CATCH;'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> MASTER..SysProcesses <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> DBId = DB_ID(@DatabaseName) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> SPId &lt;&gt; @@SPId EXEC(@<span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">RESTORE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> MyDataBase_Spanpshot <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> DATABASE_SNAPSHOT = <span class="hljs-string"><span class="hljs-string">'MyDataBase_Spanpshot'</span></span>; GO IF EXISTS (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.databases <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> = N<span class="hljs-string"><span class="hljs-string">'MyDataBase_Spanpshot'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> MyDataBase_Spanpshot <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span></code> </pre> <br><br>  As you can see, before restoring, you need to disable all users who remain connected after the test.  Otherwise, it is impossible to restore the database. <br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Organization of SQL scripts for incremental database filling before a test </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I mentioned several times that before executing the script, it is necessary to prepare a database for it. </font><font style="vertical-align: inherit;">But if you dig deeper, it will be seen that these scripts have dependencies on each other. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's start from the zero level: reference data is created as part of the initial database deployment, many entities in the system refer to this reference data. </font><font style="vertical-align: inherit;">Further there are users, on them too many who refers. </font><font style="vertical-align: inherit;">As further examples, you can take a catalog of products, and orders that refer to products, users, and reference books. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obviously, when preparing test data for an order, it is reasonable to use already existing data to create users and a product catalog, this will at least save time.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But in fact, there are even more advantages. Let us recall an example that I mentioned above when one developer, for example, working on a product catalog, forgot to implement a rule and created several incorrect data, including test ones. Another developer who deals with orders, made his code using incorrect data about the goods. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the case of dependent test data, as soon as the first developer corrects his code and his test data, the second developer will drop his tests if this rule is important for them. Thus, the first developer, while debugging the test data for the catalog with a product, in fact also debugs the test data for orders, thereby errors in orders are detected faster.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This principle works the other way. If the order developer needs new test data for products that are not yet available, he should prepare such data for himself and drive his test order for this new product. But it also means that this new product must successfully pass all tests related to the product catalog. If a test in the product catalog does not pass with a new product, it means that the order developer found an error in the code of the product catalog developer. Again, it turns out that errors in the product catalog are detected earlier, compared to the case when each developer prepares all the test data for himself.</font></font><br><br><h4>  Conclusion </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The described method of organizing automated integration testing allows you to automatically assess the quality of the created Web application at all stages of development, and not only at the stage of stabilization. </font><font style="vertical-align: inherit;">The sooner mistakes are found, the cheaper it is to correct them, and most importantly, immediately, and not only on stabilization, the amount of work remaining is visible, which allows project managers to plan their work more precisely. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Of course, maintaining the described infrastructure requires certain costs, but I think that these costs pay off due to lower costs for manual testing.</font></font></div><p>Source: <a href="https://habr.com/ru/post/174735/">https://habr.com/ru/post/174735/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../174723/index.html">Installing VMware vShield Manager for VMware vCloud Director</a></li>
<li><a href="../174727/index.html">Successful mobile art: puzzle of small parts</a></li>
<li><a href="../174729/index.html">Ukrainian laws in the new ipLex application for Windows Phone 8</a></li>
<li><a href="../174731/index.html">Developing a game running WP8 using Netduino</a></li>
<li><a href="../174733/index.html">How to count on fingers up to 3600</a></li>
<li><a href="../174737/index.html">Ultra-high-speed optical communications set a new energy efficiency record</a></li>
<li><a href="../174739/index.html">Update KB2670838 causes problems in Firefox</a></li>
<li><a href="../174741/index.html">Rusmode - a solution to the problem with the Russian layout</a></li>
<li><a href="../174743/index.html">Installing applications with .EXE installers using GPO</a></li>
<li><a href="../174745/index.html">You can not just take and look at the background page</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>