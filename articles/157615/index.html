<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Implementing a Singleton design pattern for PHP 5.4</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It would seem, of all the design patterns, what could be simpler than the well-known singleton. In many classical examples of implementation in differ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Implementing a Singleton design pattern for PHP 5.4</h1><div class="post__text post__text-html js-mediator-article">  It would seem, of all the design patterns, what could be simpler than the well-known singleton.  In many classical examples of implementation in different programming languages, it can take only a couple of dozen lines, and even less. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f06/aab/289/f06aab2894f5a88705de068a3ac696f2.png" alt="image" align="right">  It so happened that I have been implementing this template for the second year since the first release of PHP 5.3 in 2009.  At that time, its predecessor, version 5.2, did not have late static binding, and in order to create an instance of a class, it was necessary to transfer its name to the method, which seemed archine-friendly to me. <br><br>  With the release of PHP 5.4, having looked once again at the old implementation and at the new language features, I rewrote this pattern once again by getting - as it seemed to me then and it seems now - the final version. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Implementation details below. <br><a name="habracut"></a><br>  I would like to immediately note the main features: <br><br><ul><li>  <b>Parametric generation</b> .  Allows you to create instances of classes using the method call of the <i>:: getInstance</i> method.  Each signature will have its own class instance.  By default, this type of spawning is disabled.  Included in child classes by overriding the <i>:: useParametricInstantiation</i> method. </li><li>  <b>Getting a child by its parent class name</b> .  Allows you to refer to child classes from the parent as well as from other classes without knowing their name. </li><li>  <b>Creating a child class by the name of the parent class</b> .  Similar to the second paragraph, only if the child was not <br>  * Trait TSingleton. <br>  * An implementation of the Singleton design pattern. <br>  * / <br>  namespace Traits; <br>  / ** <br>  * <a href="https://habrahabr.ru/users/var/" class="user_link">var</a> array variable holding all created objects. <br>  * / <br>  $ objectPool = []; <br><br>  trait TSingleton <br>  { <br><br>  / ** <br>  * Do not allow to create an object. <br>  * <br>  * <a href="https://habrahabr.ru/users/final/" class="user_link">final</a> <br>  * <a href="https://habrahabr.ru/users/access/" class="user_link">access</a> private <br>  * <a href="https://habrahabr.ru/users/return/" class="user_link">return</a> void <br>  * / <br>  function __construct () {} <br><br>  / ** <br>  * Do not allow cloning object. <br>  * <br>  * <a href="https://habrahabr.ru/users/final/" class="user_link">final</a> <br>  * <a href="https://habrahabr.ru/users/access/" class="user_link">access</a> private <br>  * <a href="https://habrahabr.ru/users/return/" class="user_link">return</a> void <br>  * / <br>  private function __clone () {} <br><br>  / ** <br>  * Called when class is being instantiated. <br>  * <br>  * <a href="https://habrahabr.ru/users/access/" class="user_link">access</a> protected <br>  * <a href="https://habrahabr.ru/users/return/" class="user_link">return</a> void <br>  * / <br>  protected function onCreate () {} <br><br>  / ** <br>  * User-level initialization routine. <br>  * <br>  * <a href="https://habrahabr.ru/users/return/" class="user_link">return</a> void <br>  * / <br>  protected function init () {} <br><br>  / ** <br>  * Returns true if child class has been specified by the mask. <br>  * <br>  * <a href="https://habrahabr.ru/users/param/" class="user_link">param</a> string $ child <br>  * <a href="https://habrahabr.ru/users/param/" class="user_link">param</a> string $ parentMask <br>  * <a href="https://habrahabr.ru/users/final/" class="user_link">final</a> <br>  * <a href="https://habrahabr.ru/users/static/" class="user_link">static</a> <br>  * <a href="https://habrahabr.ru/users/access/" class="user_link">access</a> public <br>  * <a href="https://habrahabr.ru/users/return/" class="user_link">return</a> boolean <br>  * / <br>  static function hasParentClass ($ child, $ parentMask) <br>  { <br>  $ currentClass = get_parent_class ($ child); <br>  if (! $ currentClass) <br>  return false; <br>  do <br>  { <br>  if (strpos ($ currentClass, $ parentMask)! == false) <br>  return true; <br>  } <br>  while ($ currentClass = get_parent_class ($ currentClass)); <br><br>  return false; <br>  } <br><br>  / ** <br>  * Returns instance of child class using its parent 'class name specified <br>  * by the mask.  Always returns an array. <br>  * <br>  * <a href="https://habrahabr.ru/users/param/" class="user_link">param</a> string $ parentMask Any substring of parent's fully qualified class name. <br>  * <a href="https://habrahabr.ru/users/final/" class="user_link">final</a> <br>  * <a href="https://habrahabr.ru/users/static/" class="user_link">static</a> <br>  * <a href="https://habrahabr.ru/users/access/" class="user_link">access</a> public <br>  * <a href="https://habrahabr.ru/users/return/" class="user_link">return</a> array | null <br>  * / <br>  static function getObjectByParent ($ parentMask) <br>  { <br>  global $ objectPool; <br><br>  foreach ($ objectPool as $ class =&gt; $ container) <br>  if (self :: hasParentClass ($ class, $ parentMask)) <br>  return array_values ‚Äã‚Äã($ container); <br><br>  return null; <br>  } <br><br>  / ** <br>  * Finds object (s) of their (their) parent's class name.  If not <br>  * found the method will create it.  Always returns an array. <br>  * <br>  * <a href="https://habrahabr.ru/users/param/" class="user_link">param</a> string $ parentMask <br>  * <a href="https://habrahabr.ru/users/param/" class="user_link">param</a> array $ initArgs <br>  * <a href="https://habrahabr.ru/users/final/" class="user_link">final</a> <br>  * <a href="https://habrahabr.ru/users/static/" class="user_link">static</a> <br>  * <a href="https://habrahabr.ru/users/access/" class="user_link">access</a> public <br>  * <a href="https://habrahabr.ru/users/return/" class="user_link">return</a> array | null <br>  * / <br>  static function getObjectByParentSafe ($ parentMask, $ initArgs = []) <br>  { <br>  $ child = self :: getObjectByParent ($ parentMask); <br>  if ($ child! == null) <br>  return $ child; <br><br>  // Look up all declared classes. <br>  $ result = []; <br>  foreach (get_declared_classes () as $ class) <br>  { <br>  if (self :: hasParentClass ($ class, $ parentMask)) <br>  { <br>  $ result [] = call_user_func_array (($ class. ':: getInstance'), $ initArgs); <br>  } <br>  } <br><br>  return count ($ result)?  $ result: null; <br>  } <br><br>  / ** <br>  * Returns child object (s) of the parent class. <br>  * <br>  * <a href="https://habrahabr.ru/users/see/" class="user_link">see</a> TSingleton :: getObjectByParent <br>  * <a href="https://habrahabr.ru/users/final/" class="user_link">final</a> <br>  * <a href="https://habrahabr.ru/users/static/" class="user_link">static</a> <br>  * <a href="https://habrahabr.ru/users/access/" class="user_link">access</a> public <br>  * <a href="https://habrahabr.ru/users/return/" class="user_link">return</a> array | null <br>  * / <br>  static function getMyChild () <br>  { <br>  return self :: getObjectByParent (get_called_class ()); <br>  } <br><br>  / ** <br>  * Safe variant of :: getMyChild. <br>  * <br>  * <a href="https://habrahabr.ru/users/see/" class="user_link">see</a> TSingleton :: getObjectByParentSafe <br>  * <a href="https://habrahabr.ru/users/final/" class="user_link">final</a> <br>  * <a href="https://habrahabr.ru/users/static/" class="user_link">static</a> <br>  * <a href="https://habrahabr.ru/users/access/" class="user_link">access</a> public <br>  * <a href="https://habrahabr.ru/users/return/" class="user_link">return</a> array <br>  * / <br>  static function getMyChildSafe () <br>  { <br>  $ initArgs = func_get_args (); <br>  return self :: getObjectByParent (get_called_class (), $ initArgs); <br>  } <br><br>  / ** <br>  * Returns class instance. <br>  * <br>  * <a href="https://habrahabr.ru/users/static/" class="user_link">static</a> <br>  * <a href="https://habrahabr.ru/users/final/" class="user_link">final</a> <br>  * <a href="https://habrahabr.ru/users/access/" class="user_link">access</a> public <br>  * <a href="https://habrahabr.ru/users/return/" class="user_link">return</a> TSingleton <br>  * / <br>  static function getInstance () <br>  { <br>  global $ objectPool; <br><br>  $ argsArray = func_get_args (); <br>  $ class = get_called_class (); <br><br>  if (static :: useParametricInstantiation () &amp;&amp; count ($ argsArray)) <br>  { <br>  $ fingerprint = "; <br>  foreach ($ argsArray as $ arg) <br>  $ fingerprint. = serialize ($ arg); <br>  $ key = md5 ($ class. $ fingerprint); <br>  } <br>  else // Use class name as a key. <br>  $ key = $ class; <br><br>  if (! isset ($ objectPool [$ class])) <br>  $ objectPool [$ class] = [];  // Init class objects container. <br><br>  if (isset ($ objectPool [$ class] [$ key])) <br>  return $ objectPool [$ class] [$ key]; <br><br>  $ instance = new $ class (); <br><br>  // Add instance to the objects pool. <br>  $ objectPool [$ class] [$ key] = $ instance; <br><br>  call_user_func_array ([$ instance, 'onCreate'], $ argsArray); <br>  $ instance-&gt; init (); <br><br>  return $ instance; <br>  } <br><br>  / ** <br>  * Enables or disables the parametric class instantiation.  Disabled by default. <br>  * <br>  * <a href="https://habrahabr.ru/users/access/" class="user_link">access</a> public <br>  * <a href="https://habrahabr.ru/users/static/" class="user_link">static</a> <br>  * <a href="https://habrahabr.ru/users/return/" class="user_link">return</a> boolean <br>  * / <br>  static function useParametricInstantiation () <br>  { <br>  return false; <br>  } <br>  } <br></li>  : <br>  All created objects are now stored in one variable.  The scope of this variable (at the request of the working masses) is limited by the admixture. <br><br>  In order not to tear the templates with a non-standard template, a singleton with parametric generation is now called a multiton (Multiton). </ul></div><p>Source: <a href="https://habr.com/ru/post/157615/">https://habr.com/ru/post/157615/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../157605/index.html">Taming the triceps dragon or how authentication in Bacula works</a></li>
<li><a href="../157607/index.html">Control of mobile expenses within the organization</a></li>
<li><a href="../157609/index.html">EPAM IT Share # 2: Can you Kanban? Fault tolerance</a></li>
<li><a href="../157611/index.html">NVIDIA turned to Linux</a></li>
<li><a href="../157613/index.html">So how to delete millions of files from one folder?</a></li>
<li><a href="../157617/index.html">MongoDb for developers. Week 2</a></li>
<li><a href="../157619/index.html">Real-time identification and positioning technologies</a></li>
<li><a href="../157621/index.html">PyGA: using Google Analytics tracking in a backend written in Python</a></li>
<li><a href="../157627/index.html">ScrollUP buttons. Fast scrolling on any site</a></li>
<li><a href="../157631/index.html">Overview of Corporate Training Services</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>