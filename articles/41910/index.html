<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple things: Uploading HTML code via AJAX that contains JavaScript.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When developing CMS S. Builder, our team actively used AJAX . Now they decided to share their experiences. Let's start with this habratopik. 

 I will...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple things: Uploading HTML code via AJAX that contains JavaScript.</h1><div class="post__text post__text-html js-mediator-article"> When developing <b>CMS <font color="#AA0000">S.</font> Builder,</b> our team actively used <b>AJAX</b> .  Now they decided to share their experiences.  Let's start with this habratopik. <br><br>  I will not touch upon various frameworks and libraries here.  Its code is always more familiar.  The sbAJAX library is written for working with AJAX in <a href="">S.Builder</a> .  You can download and use :).  This file has a function <b>sbEvalJS</b> .  For those who do not know, I will explain.  When loading via AJAX and inserting HTML-code containing JavaScript on the page, JavaScript will not be executed or bugs will be useful.  This function just solves the problem. <br><br><a name="habracut"></a>  After loading, the resulting code is passed to the function, it cuts out everything that is between the <code>&lt;script ‚Ä¶&gt; ‚Ä¶ &lt;/script&gt;</code> tags <code>&lt;script ‚Ä¶&gt; ‚Ä¶ &lt;/script&gt;</code> and, if it is not rendered in the JavaScript file, runs it through eval (), or loads the file containing JavaScript, and runs via eval () received code.  It's simple.  The function code is shown below: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">function</font> sbExecScript (text) </li><li>  { </li><li>  <font color="#0000ff">if</font> (! text) </li><li>  <font color="#0000ff">return</font> ; </li><li></li><li>  <font color="#0000ff">if</font> (window.execScript) </li><li>  { </li><li>  window.execScript (text); </li><li>  } </li><li>  <font color="#0000ff">else</font> </li><li>  { </li><li>  <font color="#0000ff">var</font> script = <font color="#0000ff">document</font> .createElement ( <font color="#A31515">'script'</font> ); </li><li>  script.setAttribute ( <font color="#A31515">'type'</font> , <font color="#A31515">'text / javascript'</font> ); </li><li>  script.setAttribute ( <font color="#A31515">'language'</font> , <font color="#A31515">'JavaScript'</font> ); </li><li>  <font color="#0000ff">if</font> (_isIE) </li><li>  script.text = text; </li><li>  <font color="#0000ff">else</font> </li><li>  script.appendChild ( <font color="#0000ff">document</font> .createTextNode (text)); </li><li></li><li>  <font color="#0000ff">var</font> head = <font color="#0000ff">document</font> .getElementsByTagName ( <font color="#A31515">"head"</font> ) [0] ||  <font color="#0000ff">document</font> .documentElement; </li><li>  head.insertBefore (script, head.firstChild); </li><li>  head.removeChild (script); </li><li>  } </li><li></li><li>  <font color="#0000ff">return</font> ; </li><li>  } </li><li></li><li>  <font color="#0000ff">var</font> sbEvalJSSrcs = []; </li><li>  <font color="#0000ff">function</font> sbEvalJS (s) </li><li>  { </li><li>  <font color="#0000ff">var</font> js_ScriptFragment = <font color="#A31515">'(?: &lt;script. *?&gt;) (((\ n | \ r |.) *?) (?: &lt;\ / script&gt;)'</font> ; </li><li>  <font color="#0000ff">var</font> js_ScriptSrcFragment = <font color="#A31515">'&lt;script. + (src [] * = [] * \' (. *?) \ '| src [] * = [] * "(. *?)"). +'</font> ; </li><li></li><li>  <font color="#0000ff">var</font> matchAll = <font color="#0000ff">new</font> RegExp (js_ScriptFragment, <font color="#A31515">'img'</font> ); </li><li>  <font color="#0000ff">var</font> matchOne = <font color="#0000ff">new</font> RegExp (js_ScriptFragment, <font color="#A31515">'im'</font> ); </li><li>  <font color="#0000ff">var</font> matchSrc = <font color="#0000ff">new</font> RegExp (js_ScriptSrcFragment, <font color="#A31515">'im'</font> ); </li><li></li><li>  <font color="#0000ff">var</font> arr = s.match (matchAll) ||  []; </li><li>  <font color="#0000ff">var</font> JSCode = []; </li><li></li><li>  <font color="#0000ff">for</font> ( <font color="#0000ff">var</font> i = 0; i &lt;arr.length; i ++) </li><li>  { </li><li>  <font color="#0000ff">var</font> srcMt = arr [i] .match (matchSrc); </li><li>  <font color="#0000ff">if</font> (srcMt) </li><li>  { </li><li>  <font color="#0000ff">if</font> (srcMt.length&gt; 3) </li><li>  srcMt = srcMt [3]; </li><li>  <font color="#0000ff">else</font> </li><li>  srcMt = srcMt [2]; </li><li></li><li>  <font color="#0000ff">if</font> (srcMt! = <font color="#A31515">''</font> ) </li><li>  { </li><li>  <font color="#0000ff">var</font> found = <font color="#0000ff">false</font> ; </li><li>  <font color="#0000ff">for</font> ( <font color="#0000ff">var</font> j = 0; j &lt;sbEvalJSSrcs.length; j ++) </li><li>  { </li><li>  <font color="#0000ff">if</font> (sbEvalJSSrcs [j] == srcMt) </li><li>  { </li><li>  found = <font color="#0000ff">true</font> ; </li><li>  <font color="#0000ff">break</font> ; </li><li>  } </li><li>  } </li><li></li><li>  <font color="#0000ff">if</font> (found) </li><li>  <font color="#0000ff">continue</font> ; </li><li></li><li>  sbEvalJSSrcs [sbEvalJSSrcs.length] = srcMt; </li><li>  <font color="#0000ff">var</font> res = sbLoadSync (srcMt); </li><li>  <font color="#0000ff">if</font> (res) </li><li>  JSCode [JSCode.length] = res; </li><li>  } </li><li>  } </li><li></li><li>  <font color="#0000ff">var</font> mtCode = arr [i] .match (matchOne); </li><li>  <font color="#0000ff">if</font> (mtCode &amp;&amp; mtCode [1]! = <font color="#A31515">''</font> ) </li><li>  JSCode [JSCode.length] = mtCode [1]; </li><li>  } </li><li></li><li>  s = s.replace (matchAll, <font color="#A31515">''</font> ); </li><li></li><li>  <font color="#0000ff">for</font> ( <font color="#0000ff">var</font> i = 0; i &lt;JSCode.length; i ++) </li><li>  sbExecScript (JSCode [i]); </li><li></li><li>  <font color="#0000ff">return</font> s; </li><li>  } </li><li></li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  The function returns HTML code without JavaScript, and paste it in the right place on the page to avoid re-running scripts under IE, for example. <br><br>  If you use our library, then the following functions may be useful to you: <br>  <b>sbLoadSync (url)</b> - synchronously loads the contents of the specified URL and returns it. <br><br>  <b>sbLoadAsync (url, pfunction)</b> - asynchronously loads the contents of the specified URL and passes it as a parameter to the pfunction function. <br><br>  <b>sbSendForm (form)</b> - synchronously sends form data with a POST request and returns the result of the script specified in the action form. <br><br>  <b>sbSendFormAsync (form, pfunction)</b> - asynchronously sends form data with a POST request and passes the result of the script specified in the action form as a parameter to the pfunction function. <br><br>  I note that for all functions, <b>sbEvalJS</b> is called immediately upon receiving a response from the server, and the result returned by them does not contain JavaScript.  If the logic needs to be changed, remove everywhere <b>return sbEvalJS (res);</b>  . <br><br>  The library was tested in IE 6, IE 7, FireFox 2, FireFox 3, Opera 9.5, Safari 3.0, Google Chrome 0.3. <br><br>  Well, that's all, for the first time enough :). <br></div><p>Source: <a href="https://habr.com/ru/post/41910/">https://habr.com/ru/post/41910/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../419089/index.html">How to cheat when playing dice - tips game expert</a></li>
<li><a href="../41909/index.html">Presidential candidate is a secret Opera fan;)</a></li>
<li><a href="../419091/index.html">Radioactive items among us</a></li>
<li><a href="../419095/index.html">We write CSS better and more beautiful</a></li>
<li><a href="../419099/index.html">WebSockets in Angular. Part 2. Product Solutions</a></li>
<li><a href="../419103/index.html">Writing a simple Lisp translator - I</a></li>
<li><a href="../419105/index.html">Link to the broadcast Slurm (intense by Kubernetes)</a></li>
<li><a href="../419107/index.html">Overview of the Dell EMC Unity File Part and Configuration Examples</a></li>
<li><a href="../419109/index.html">"Clarify for bangs" in Android P. What to do with Android Cutout?</a></li>
<li><a href="../419111/index.html">Digest of grocery design, July 2018</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>