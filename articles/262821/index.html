<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Intel Edison. Using Intel Cloud on the example of distance sensor implementation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nowadays, rather high demands are made on modern devices and gadgets. And I‚Äôm not only talking about surfing the Internet to read my favorite newslett...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Intel Edison. Using Intel Cloud on the example of distance sensor implementation</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/b09/edd/0cf/b09edd0cf0f74e56a6b7b0e79741fb55.jpg"><br><br>  Nowadays, rather high demands are made on modern devices and gadgets.  And I‚Äôm not only talking about surfing the Internet to read my favorite newsletter, check email or chat with friends in the social network.  People want much more, in the modern world it is just necessary to control and monitor devices remotely.  It is natural to manage these devices through the Internet.  At the moment there is a huge amount of cloud solutions, in this article we will consider a cloud solution from Intel on a practical example. <br><br>  First, let's look at the new cloud for Internet-of-Things. <br><a name="habracut"></a><br>  Analytical Cloud IoT Analytics includes resources for collecting and analyzing data collected from various sensors connected to Intel Galileo and Intel Edison.  Using this service, the developer can easily store and process data without investing additional resources in it, instead focusing on creating projects for the above mentioned fees. <br>  Consider the concept of using IoT Analytics cloud. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/7dd/7ea/f15/7dd7eaf151ad4f8ea8b83bf897aab28e.png"><br><br>  To start using the IoT Analytics cloud, you need to create an admin account with which you can register devices, manage alerts, create accounts and perform other tasks on the site.  Go to the use of IoT Analytics Dashboard can <a href="https://dashboard.us.enableiot.com/ui/auth">link</a> .  Basic concepts and elementary examples of using this cloud are described <a href="http://habrahabr.ru/post/257621/">here</a> . <br><br>  In order to demonstrate the interaction with the cloud, let's continue the work on the example from the article <a href="http://habrahabr.ru/company/intel/blog/260471/">‚ÄúUsing the integrated microcontroller in Intel Edison‚Äù</a> , in which the HC-SR04 distance measurement sensor is connected to the Intel Edison board and the measured distance is displayed on the LCD display.  Take the described example of measuring the distance and add the automatic download of the data received from the sensor, straight to the cloud. <br><br><img src="https://habrastorage.org/files/329/03b/640/32903b64037b43b58679102dde14e3eb.jpg"><br><br>  First register our distance sensor.  To do this, fill in all the required fields. <br><br><img src="https://habrastorage.org/files/b28/d40/6fa/b28d406faf98443b91a4dd97a84d21ae.png"><br><br>  We will use the integer type, set the value range from -1 (error) to 100 centimeters. <br>  Next, you need to register a sensor for Intel Edison.  Use the following command: <br><pre><code class="hljs pgsql"># iotkit-<span class="hljs-keyword"><span class="hljs-keyword">admin</span></span> register dist distance.v1<span class="hljs-number"><span class="hljs-number">.0</span></span> # iotkit-<span class="hljs-keyword"><span class="hljs-keyword">admin</span></span> catalog</code> </pre> <br>  Now our sensor is registered and assigned to this device. <br><br><img src="https://habrastorage.org/files/ba4/165/4b9/ba41654b972249569f317e3c2b8c3aec.png"><br><br>  Sending data to cloud can be done in several ways. <br>  One of the most simple: <br><br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta"># iotkit-admin observation dist 10</span></span></code> </pre><br><br>  But, as you understand, this is not the most convenient way to send data to the cloud.  As a rule, this command is used for testing. <br>  There are two other ways to transfer data to the cloud: <br><ul><li>  Configure the REST interface on the client (Configuration Documentation). <br></li><li>  Sending UDP packets to the agent raised on the board.  The agent converts packets to REST calls and sends requests. <br></li></ul><br>  To start the agent on the board, use the following command: <br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta"># systemctl start iotkit-agent</span></span></code> </pre><br>  It is possible to send UDP messages through localhost to port 41234 (UDP: // localhost: 41234).  To do this, you need to create a JSON file (JavaScript Object Notation): <br><pre> <code class="hljs json">{<span class="hljs-attr"><span class="hljs-attr">"n"</span></span>: <span class="hljs-string"><span class="hljs-string">"&lt;sensor name&gt;"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"v"</span></span>: <span class="hljs-string"><span class="hljs-string">"&lt;value&gt;"</span></span> }</code> </pre><br>  where ‚Äún‚Äù is the name of the measurement being taken, and ‚Äúv‚Äù is the value. <br>  For example: <br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"n"</span></span>: <span class="hljs-string"><span class="hljs-string">"dist"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"v"</span></span>: <span class="hljs-number"><span class="hljs-number">17</span></span> } { <span class="hljs-attr"><span class="hljs-attr">"n"</span></span>: <span class="hljs-string"><span class="hljs-string">"dist"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"v"</span></span>: <span class="hljs-number"><span class="hljs-number">24</span></span>}</code> </pre><br>  I have described how to send data to the IoT Analytics cloud via iotkitagent.  Developers can also send data using programming languages ‚Äã‚Äãsuch as C / C ++, JavaScript, or Python.  In <a href="http://habrahabr.ru/post/257621/">one</a> of the articles mentioned at the beginning, an example of publishing data using C / C ++ is implemented.  Since I prefer the concept of faster and more convenient programming, in this article I will write a small example using my favorite Python language. <br><br><div class="spoiler">  <b class="spoiler_title">Script IoTCloudManager.py:</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> uuid <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pyupm_i2clcd host = <span class="hljs-string"><span class="hljs-string">"dashboard.us.enableiot.com"</span></span> proxies = { <span class="hljs-comment"><span class="hljs-comment">#   } username = "email@gmail.com" password = "*********" account_name = "account_name" #  id ,      device_id = "***************************************" observations_per_hour = 1 days_of_data = 1 verify = True api_root = "/v1/api" base_url = "https://{0}{1}".format(host, api_root) device_name = "Device-{0}".format(device_id) g_user_token = "" g_device_token = "" def main(): global g_user_token, g_device_token #     API  g_user_token = get_token(username, password) #  user_id  Intel IoT Analytics Platform uid = get_user_id() print "UserId: {0}".format(uid) aid = get_account_id(uid, account_name) print "AccountId: {0}".format(aid) #      create_device(aid, device_id, device_name) #    ac = generate_activation_code(aid) print "Activation code: {0}".format(ac) #   g_device_token = activate(aid, device_id, ac) #     "Distance.v1.0".    component_id (cid) cid = create_component(aid, device_id, "Distance.v1.0", "Dist") print "ComponentID (cid): {0}".format(cid) lcd = pyupm_i2clcd.Jhd1313m1(6, 0x3E, 0x62) with open('/dev/ttymcu0', 'w+t') as f: while True: f.write('get_distance\n') # Send command to MCU f.flush() line = f.readline() # Read response from MCU, -1 = ERROR value = int(line.strip('\n\r\t ')) #     create_observations(aid, device_id, cid, value) #    o = get_observations(aid, device_id, cid) print_observation_counts(o) lcd.clear() if value == -1: lcd.setColor(255, 0, 0) # RED lcd.write('ERROR') else: lcd.setColor(0, 255, 0) # GREEN lcd.write('%d cm' % (value,)) time.sleep(1) def get_user_headers(): headers = { 'Authorization': 'Bearer ' + g_user_token, 'content-type': 'application/json' } return headers def get_device_headers(): headers = { 'Authorization': 'Bearer ' + g_device_token, 'content-type': 'application/json' } #print "Headers = " + str(headers) ( ) return headers def check(resp, code): if resp.status_code != code: print "Expected {0}. Got {1} {2}".format(code, resp.status_code, resp.text) sys.exit(1) def get_token(username, password): url = "{0}/auth/token".format(base_url) headers = {'content-type': 'application/json'} payload = {"username": username, "password": password} data = json.dumps(payload) resp = requests.post(url, data=data, headers=headers, proxies=proxies, verify=verify) check(resp, 200) js = resp.json() token = js['token'] return token def get_user_id(): url = "{0}/auth/tokenInfo".format(base_url) resp = requests.get(url, headers=get_user_headers(), proxies=proxies, verify=verify) check(resp, 200) js = resp.json() user_id = js["payload"]["sub"] return user_id def get_account_id(user_id, account_name): url = "{0}/users/{1}".format(base_url, user_id) resp = requests.get(url, headers=get_user_headers(), proxies=proxies, verify=verify) check(resp, 200) js = resp.json() if 'accounts' in js: accounts = js["accounts"] for k, v in accounts.iteritems(): if 'name' in v and v["name"] == account_name: return k print "Account name {0} not found.".format(account_name) print "Available accounts are: {0}".format([v["name"] for k, v in accounts.iteritems()]) return None def create_device(account, device_id, device_name): url = "{0}/accounts/{1}/devices".format(base_url, account) device = { "deviceId": str(device_id), "gatewayId": str(device_id), "name": device_name, "tags": ["Russia", "Moscow", "RoadShow"], "attributes": { "vendor": "intel", "platform": "x86", "os": "linux" } } data = json.dumps(device) resp = requests.post(url, data=data, headers=get_user_headers(), proxies=proxies, verify=verify) check(resp, 201) return resp def generate_activation_code(account_id): url = "{0}/accounts/{1}/activationcode/refresh".format(base_url, account_id) resp = requests.put(url, headers=get_user_headers(), proxies=proxies, verify=verify) check(resp, 200) js = resp.json() activation_code = js["activationCode"] return activation_code def activate(account_id, device_id, activation_code): url = "{0}/accounts/{1}/devices/{2}/activation".format(base_url, account_id, device_id) activation = { "activationCode": activation_code } data = json.dumps(activation) resp = requests.put(url, data=data, headers=get_user_headers(), proxies=proxies, verify=verify) check(resp, 200) js = resp.json() if "deviceToken" in js: token = js["deviceToken"] return token else: print js sys.exit(1) def create_component(account_id, device_id, component_type_name, name): url = "{0}/accounts/{1}/devices/{2}/components".format(base_url, account_id, device_id) component = { "type": component_type_name, "name": name, "cid": str(uuid.uuid4()) } data = json.dumps(component) resp = requests.post(url, data=data, headers=get_device_headers(), proxies=proxies, verify=verify) check(resp, 201) js = resp.json() return js["cid"] def create_observations(account_id, device_id, cid, val): url = "{0}/data/{1}".format(base_url, device_id) body = { "accountId": account_id, "data": [] } o = { "componentId": cid, "value": str(val), "attributes": { "i": i } } body["data"].append(o) data = json.dumps(body) resp = requests.post(url, data=data, headers=get_device_headers(), proxies=proxies, verify=verify) check(resp, 201) def get_observations(account_id, device_id, component_id): url = "{0}/accounts/{1}/data/search".format(base_url, account_id) search = { "from": 0, "targetFilter": { "deviceList": [device_id] }, "metrics": [ { "id": component_id } ] } data = json.dumps(search) resp = requests.post(url, data=data, headers=get_user_headers(), proxies=proxies, verify=verify) check(resp, 200) js = resp.json() return js def print_observation_counts(js): if 'series' in js: series = js["series"] series = sorted(series, key=lambda v: v["deviceName"]) for v in series: print "Device: {0} Count: {1}".format(v["deviceName"], len(v["points"])) if __name__ == "__main__": main()</span></span></code> </pre><br></div></div><br><br>  Now let's see what happened on the graph for a certain number of measurements.  The graph shows the data (in centimeters) measurements from the sensor at different points in time. <br><img src="https://habrastorage.org/files/7a4/536/524/7a45365249b9476e9719ea6d55a0699b.png"><br>  Thus, it is easy enough to upload data to the cloud. <br>  Now let's try to determine the maximum and minimum distance of the distance (cm) that we sent to the cloud.  We get the following picture. <br><img src="https://habrastorage.org/files/5d1/7f0/c84/5d17f0c84f604086a85be80e650f892e.png"><br>  As a conclusion, I would like to note that IoT Analytics cloud is a simple and convenient tool for storing and analyzing data received from sensors connected to the boards. </div><p>Source: <a href="https://habr.com/ru/post/262821/">https://habr.com/ru/post/262821/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../262809/index.html">How can artificial intelligence be used to solve SEO problems?</a></li>
<li><a href="../262813/index.html">How to make beautiful documentation for the Web API, for which it will not be a shame</a></li>
<li><a href="../262815/index.html">Design for Dyslexics, Part One</a></li>
<li><a href="../262817/index.html">Overview of authentication methods and protocols in web applications</a></li>
<li><a href="../262819/index.html">Mail Protocol Diagnostics</a></li>
<li><a href="../262823/index.html">2 years of burry reviews - the history of the amateur show Old-Hard</a></li>
<li><a href="../262827/index.html">Testing password policies of the largest web services</a></li>
<li><a href="../262831/index.html">Unreal real estate developers, or why years of experience do not say anything</a></li>
<li><a href="../262833/index.html">Star rating on CSS with font-awesome font icons</a></li>
<li><a href="../262835/index.html">vCloud Director for the smallest (part 4): everything about working with virtual machine templates</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>