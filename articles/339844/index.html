<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cisco IOS Archive functionality</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I will not write a great introduction, just say Archive is a handy tool that was introduced in iOS 12.3 (4) and can serve to solve several problems: 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cisco IOS Archive functionality</h1><div class="post__text post__text-html js-mediator-article">  I will not write a great introduction, just say Archive is a handy tool that was introduced in iOS 12.3 (4) and can serve to solve several problems: <br><br><ol><li>  Auto save configuration </li><li>  Logging each command entered in configuration mode </li><li>  Compare and Rollback Configurations </li></ol><a name="habracut"></a><br><h2>  Auto save configuration </h2><br><h4>  1. Configuration storage path.  Rotation </h4><br>  You can specify the storage path for archive configurations as follows: <br><br><pre><code class="hljs pgsql">SW1#conf t Enter <span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span> commands, one per <span class="hljs-type"><span class="hljs-type">line</span></span>. <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> CNTL/Z. SW1(config)#archive SW1(config-archive)#<span class="hljs-type"><span class="hljs-type">path</span></span> tftp://<span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/ SW1(config-archive)#<span class="hljs-keyword"><span class="hljs-keyword">end</span></span> SW1#</code> </pre> <br>  You can store, of course, on the local storage (flash :, disk0: sup-bootflash: nvram :), but how then can you restore the configuration in the event of the device dying? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Now try to create the archive manually: <br><br><pre> <code class="hljs objectivec">SW1<span class="hljs-meta"><span class="hljs-meta">#archive config ! SW1#</span></span></code> </pre> <br>  <u><b>ATTENTION:</b></u> the ‚Äúarchive config‚Äù command archives the current device configuration (running-config), and does not save the running-config in the startup-config. <br><br>  It turned out a file with the same name: <br><br><img src="https://habrastorage.org/webt/59/dd/e7/59dde7845d085500469363.png"><br><br>  Why so?  Because the default file name of the configuration archive is ‚Äú <b>[string] - &lt;timestamp&gt; -‚Ññ</b> ‚Äù: <br><br><pre> <code class="hljs vhdl">SW1#show archive The maximum archive configurations allowed <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>. The <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> archive <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> will be named tftp://<span class="hljs-number"><span class="hljs-number">10.0</span></span>.<span class="hljs-number"><span class="hljs-number">5.1</span></span>/-&lt;timestamp&gt;-<span class="hljs-number"><span class="hljs-number">1</span></span> Archive # Name <span class="hljs-number"><span class="hljs-number">1</span></span> tftp://<span class="hljs-number"><span class="hljs-number">10.0</span></span>.<span class="hljs-number"><span class="hljs-number">5.1</span></span>/-Jan-<span class="hljs-number"><span class="hljs-number">11</span></span>-<span class="hljs-number"><span class="hljs-number">15</span></span>-<span class="hljs-number"><span class="hljs-number">44</span></span>-<span class="hljs-number"><span class="hljs-number">33.695</span></span>-<span class="hljs-number"><span class="hljs-number">0</span></span> &lt;- Most Recent <span class="hljs-number"><span class="hljs-number">2</span></span> ...... <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre><br>  If you still decide to use local storage to archive configuration files, then it makes sense to limit the number of files.  The maximum can be 14. In my example, I use unix storage: due to the fact that I use IOU / IOL in UnetLAB: <br><br><pre> <code class="hljs lua">SW1(<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>-archive)#<span class="hljs-built_in"><span class="hljs-built_in">path</span></span> unix: SW1(<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>-archive)#maximum <span class="hljs-number"><span class="hljs-number">5</span></span></code> </pre><br>  In this case, after changing the archiving path to the local one and setting the limit to 5 files, when trying to create the 6th archive, the oldest archive file will be deleted. <br><br>  But if I tried to limit the number of stored archive configurations on a remote TFTP server: <br><br><pre> <code class="hljs pgsql">SW1(config-archive)#maximum <span class="hljs-number"><span class="hljs-number">3</span></span> Cannot <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> maximum <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> backing up <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> network <span class="hljs-type"><span class="hljs-type">path</span></span></code> </pre><br>  If the archiving path is networked, then the restriction cannot be set ‚Äî it should be limited to the means of the server where the files are being sent. <br><br><h4>  2. Automatic archiving.  Kron </h4><br>  With the way everything is clear, but you need to do the archives automatically.  The ‚Äúwrite-memory‚Äù command in the context of ‚Äúarchive‚Äù will enable automatic archiving while saving the running-config to the startup-config: <br><br><pre> <code class="hljs lua">SW1(<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>-archive)#<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>-memory SW1(<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>-archive)#<span class="hljs-keyword"><span class="hljs-keyword">end</span></span> SW1#<span class="hljs-built_in"><span class="hljs-built_in">write</span></span> mem Building configuration... Compressed configuration from <span class="hljs-number"><span class="hljs-number">1177</span></span> bytes to <span class="hljs-number"><span class="hljs-number">843</span></span> bytes[OK]! SW1#copy <span class="hljs-built_in"><span class="hljs-built_in">running</span></span>-<span class="hljs-built_in"><span class="hljs-built_in">config</span></span> startup-<span class="hljs-built_in"><span class="hljs-built_in">config</span></span> Destination filename [startup-<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>]? Building configuration... Compressed configuration from <span class="hljs-number"><span class="hljs-number">1177</span></span> bytes to <span class="hljs-number"><span class="hljs-number">843</span></span> bytes[OK]! SW1#</code> </pre><br>  No matter what to use: ‚Äúwr mem‚Äù or ‚Äúcopy run start‚Äù - the archive will be created.  In this example, after using the commands, 2 files were created. <br><br>  Archiving when copying running-config to startup-config is good, but if we need regular backups?  You can use the ‚Äútime period‚Äù command with an indication of the interval of minutes that will be archived.  For example, you can use the value 10080 for archiving every week.  Here is the result of auto-archiving every minute: <br><br><pre> <code class="hljs lisp">SW1(<span class="hljs-name"><span class="hljs-name">config</span></span>)#archive SW1(<span class="hljs-name"><span class="hljs-name">config-archive</span></span>)#time-period <span class="hljs-number"><span class="hljs-number">1</span></span> SW1(<span class="hljs-name"><span class="hljs-name">config-archive</span></span>)<span class="hljs-meta"><span class="hljs-meta">#! SW1(config-archive)#end SW1#</span></span></code> </pre><br><img src="https://habrastorage.org/webt/59/dd/ea/59ddead6a5068422523980.png"><br><br>  What if you want to archive not at a certain time interval, but at a certain time?  The answer is <b>kron</b> .  Kron is determined by policy and sheduler.  The syntax is intuitive, so it's easier to show with an example. <br><br>  Let's set the policy: <br><br><pre> <code class="hljs lisp">SW1(<span class="hljs-name"><span class="hljs-name">config</span></span>)#kron policy-list CONFIG_BACKUP SW1(<span class="hljs-name"><span class="hljs-name">config-kron-policy</span></span>)#cli wr mem SW1(<span class="hljs-name"><span class="hljs-name">config-kron-policy</span></span>)#exit</code> </pre><br>  ^ this is the command that will be executed <br><br>  An important point to note is that kron does not support interactive commands on the cli command, which require some dialogue.  For example, ‚Äúcopy run start‚Äù will ask for the name of the file to save, so it will not work in kron.  Therefore, you need to use wr mem. <br><br>  Assign sheduler: <br><br><pre> <code class="hljs vbscript">SW1(config)#kron occurrence CONFIG_BACKUP_SCHED ? at <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span> of kron occurrence eg. <span class="hljs-number"><span class="hljs-number">14</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span> Feb <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Delta <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> kron occurrence SW1(config)#kron occurrence CONFIG_BACKUP_SCHED at ? hh:mm <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> of <span class="hljs-built_in"><span class="hljs-built_in">day</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> occurrence (hh:min eg. <span class="hljs-number"><span class="hljs-number">14</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span>) SW1(config)#kron occurrence CONFIG_BACKUP_SCHED at <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> ? &lt;<span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-number"><span class="hljs-number">-31</span></span>&gt; <span class="hljs-built_in"><span class="hljs-built_in">Day</span></span> of <span class="hljs-built_in"><span class="hljs-built_in">month</span></span> <span class="hljs-built_in"><span class="hljs-built_in">DAY</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Day</span></span> of Week eg mon, tue, etc <span class="hljs-built_in"><span class="hljs-built_in">MONTH</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Month</span></span> of <span class="hljs-built_in"><span class="hljs-built_in">year</span></span> eg jan, feb, etc oneshot Schedule kron occurrence exactly once recurring Schedule kron occurrence repeatedly SW1(config)#kron occurrence CONFIG_BACKUP_SCHED at <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> recurring Clock currently <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> it reads <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">25</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span> UTC Wed Jan <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span> SW1(config-kron-occurrence)#policy-list CONFIG_BACKUP SW1(config-kron-occurrence)#<span class="hljs-keyword"><span class="hljs-keyword">end</span></span> SW1#</code> </pre><br>  Where: <br><br>  <b>CONFIG_BACKUP_SCHED</b> ‚Äî <b>Scheduler</b> name; <br>  <b>at</b> and <b>in</b> - obviously, performing at a certain time or at a certain interval, respectively.  In the case of at, the time is specified as follows: {hh: mm [month] [day of month] [day of week]}.  In my example, doing daily; <br>  <b>oneshot</b> , <b>recurring</b> - perform once or regularly, respectively.  The documentation seems to have seen that in some versions of IOS, the system-startup option is also available, i.e.  execution at the start of the device; <br>  <b>policy-list CONFIG_BACKUP</b> - an indication of the policy with which to work. <br><br>  Thus, in my example, the ‚Äúwr mem‚Äù command will be executed daily at 10:00, and this will entail the archiving of the configuration (according to the archive setting). <br><br>  Something like this will be the kron configuration: <br><br><pre> <code class="hljs pgsql">SW1#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> running-config | section kron kron occurrence CONFIG_BACKUP_SCHED at <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> recurring <span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>-list CONFIG_BACKUP kron <span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>-list CONFIG_BACKUP cli wr mem</code> </pre><br><h4>  3. Variables in the configuration archive name.  Timestamp </h4><br>  The file name of the archive does not seem to be very talking.  I mentioned above that the file name is formed like this: ‚Äú- &lt;timestamp&gt; -‚Ññ‚Äù.  If you disassemble: <br><br><img src="https://habrastorage.org/webt/59/dd/ec/59ddec6ecb02e512097698.png"><br><br>  Not a very readable name, and a millisecond is clearly not needed.  This is due to: <br><br><pre> <code class="hljs pgsql">SW1#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> running-config | section <span class="hljs-type"><span class="hljs-type">timestamp</span></span> service timestamps <span class="hljs-keyword"><span class="hljs-keyword">debug</span></span> datetime msec service timestamps <span class="hljs-keyword"><span class="hljs-keyword">log</span></span> datetime msec</code> </pre><br>  To set up a readable display of the file, you need to correct the timestamp format (we also specify the time zone): <br><br><pre> <code class="hljs lisp">SW1(<span class="hljs-name"><span class="hljs-name">config</span></span>)#clock timezone Golf <span class="hljs-number"><span class="hljs-number">+7</span></span> SW1(<span class="hljs-name"><span class="hljs-name">config</span></span>)#service timestamps log datetime year localtime show-timezone</code> </pre><br>  Now the file looks like this: <br><br><img src="https://habrastorage.org/webt/59/dd/ec/59ddecd002921118967533.png"><br><br>  Those.  ‚ÄúMonth-day-year-hour-minute-second-hour-belt-file-number‚Äù. <br>  From the format of the ‚Äúservice timestamps‚Äù command it is quite clear how to remove, for example, a year or a time zone. <br><br>  What's up with the hostname?  You can use this form for clarity: <br><br><pre> <code class="hljs lua">SW1(<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>)#archive SW1(<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>-archive)#<span class="hljs-built_in"><span class="hljs-built_in">path</span></span> tftp://<span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/SW1 SW1(<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>-archive)#<span class="hljs-keyword"><span class="hljs-keyword">end</span></span> SW1#show archive The maximum archive configurations allowed is <span class="hljs-number"><span class="hljs-number">10.</span></span> The <span class="hljs-built_in"><span class="hljs-built_in">next</span></span> archive file will be named tftp://<span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/SW1-&lt;timestamp&gt;<span class="hljs-number"><span class="hljs-number">-0</span></span> .....</code> </pre><br>  Then, as you can see, the file name will consist of the text ‚ÄúSW1‚Äù and a temporary stamp.  It will be clear from which device the configuration is.  But if the host name changes, you will have to manually change this setting in the archive.  You can use the <b>$ h</b> variable, which stores the host name.  By the way, the <b>$ t</b> variable stores the timestamp, but now it does not make sense to use it, in IOS 15 &lt;timestamp&gt; is automatically substituted into the file name.  On IOS 12, you would have to use the entry ‚Äúpath tftp: //10.0.5.1/$h-$t‚Äù, now quite enough: <br><br><pre> <code class="hljs lua">SW1(<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>)#archive SW1(<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>-archive)#<span class="hljs-built_in"><span class="hljs-built_in">path</span></span> tftp://<span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/$h SW1(<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>-archive)#<span class="hljs-keyword"><span class="hljs-keyword">end</span></span> SW1#</code> </pre><br>  And the result: <br><br><img src="https://habrastorage.org/webt/59/dd/ed/59dded5dc3006023126923.png"><br><br><h2>  Logging commands entered </h2><br>  The ‚ÄúArchive‚Äù function allows not only to archive configuration files, but also to archive the entered configuration commands, i.e.  those commands that have changed the device configuration and also the ‚Äúenable‚Äù command (i.e. if someone enters the privileged mode, this will also be logged). <br><br>  The difference from ‚Äúshow history‚Äù is obvious (history only lists my personal commands).  But it is better to show an example: <br><br><pre> <code class="hljs lisp">SW1(<span class="hljs-name"><span class="hljs-name">config</span></span>)#archive SW1(<span class="hljs-name"><span class="hljs-name">config-archive</span></span>)#log config SW1(<span class="hljs-name"><span class="hljs-name">config-archive-log-cfg</span></span>)#logging enable SW1(<span class="hljs-name"><span class="hljs-name">config-archive-log-cfg</span></span>)#logging size <span class="hljs-number"><span class="hljs-number">200</span></span> SW1(<span class="hljs-name"><span class="hljs-name">config-archive-log-cfg</span></span>)#hidekeys</code> </pre><br>  logging enable - enables logging of configuration commands; <br>  logging size - the maximum number of stored commands; <br>  hidekeys - hide passwords when viewing logged commands. <br><br>  How it all looks like: <br><br><pre> <code class="hljs pgsql">SW1#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> archive <span class="hljs-keyword"><span class="hljs-keyword">log</span></span> config <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> idx sess <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>@<span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Logged</span></span> command <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> mark@console | logging <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> mark@console | logging size <span class="hljs-number"><span class="hljs-number">200</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> mark@console | hidekeys <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> mark@console |username greg privilege <span class="hljs-number"><span class="hljs-number">1</span></span> secret ***** <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> mark@console |!config: <span class="hljs-keyword"><span class="hljs-keyword">USER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> MODIFIED <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> greg@vty0 |!exec: <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span></code> </pre><br>  Those.  we see the user name (in my case, mark and greg), the line with which actions were performed, we see even the ‚Äúenable‚Äù command, but we do NOT see the password of the created greg (as it was intended). <br><br><pre> <code class="hljs pgsql">SW1(config-archive-<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>-cfg)#<span class="hljs-keyword"><span class="hljs-keyword">notify</span></span> syslog</code> </pre><br>  It will also notify the syslog server (if it is configured, well, or it will pour into the console and monitor) with the following messages: <br><br><pre> <code class="hljs pgsql">*Jan <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span> Golf: %<span class="hljs-keyword"><span class="hljs-keyword">PARSER</span></span><span class="hljs-number"><span class="hljs-number">-5</span></span>-CFGLOG_LOGGEDCMD: <span class="hljs-keyword"><span class="hljs-keyword">User</span></span>:mark <span class="hljs-keyword"><span class="hljs-keyword">logged</span></span> command:interface Ethernet0/<span class="hljs-number"><span class="hljs-number">3</span></span> *Jan <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span> Golf: %<span class="hljs-keyword"><span class="hljs-keyword">PARSER</span></span><span class="hljs-number"><span class="hljs-number">-5</span></span>-CFGLOG_LOGGEDCMD: <span class="hljs-keyword"><span class="hljs-keyword">User</span></span>:mark <span class="hljs-keyword"><span class="hljs-keyword">logged</span></span> command:<span class="hljs-keyword"><span class="hljs-keyword">no</span></span> shutdown</code> </pre><br>  You can also view information on each user by session: <br><br><img src="https://habrastorage.org/webt/59/dd/ee/59ddee8229973705003171.png"><br><br>  But here it is necessary to take into account that the session in this context is the session of entering the configure terminal.  Those.  3 sessions does not mean at all that mark has logged out, it only means that he was leaving the configuration mode. <br><br>  And a couple of examples: <br><br><img src="https://habrastorage.org/webt/59/dd/ee/59ddeece901e2420099644.png"><br><br><h2>  Comparison of configurations.  Configuration rollback </h2><br><h4>  1. Comparison of configurations </h4><br>  Together with the Archive function in IOS, a useful feature for comparing configurations appeared.  For example, compare startup-config with a config on a tftp server: <br><br><pre> <code class="hljs pgsql">SW1#$<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> archive config differences nvram:startup-config tftp://<span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/SW1-Jan<span class="hljs-number"><span class="hljs-number">-13</span></span><span class="hljs-number"><span class="hljs-number">-2017</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-00</span></span><span class="hljs-number"><span class="hljs-number">-00</span></span>-Golf<span class="hljs-number"><span class="hljs-number">-3</span></span> Loading SW1-Jan<span class="hljs-number"><span class="hljs-number">-13</span></span><span class="hljs-number"><span class="hljs-number">-2017</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-00</span></span><span class="hljs-number"><span class="hljs-number">-00</span></span>-Golf<span class="hljs-number"><span class="hljs-number">-3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> (via Vlan1): ! [OK - <span class="hljs-number"><span class="hljs-number">1483</span></span> bytes] !Contextual Config Diffs: +service timestamps <span class="hljs-keyword"><span class="hljs-keyword">log</span></span> datetime <span class="hljs-built_in"><span class="hljs-built_in">localtime</span></span> <span class="hljs-keyword"><span class="hljs-keyword">show</span></span>-timezone year +username greg secret <span class="hljs-number"><span class="hljs-number">4</span></span> WGWXTgqyMqk91MhF3Gz5CQdMnLHU4clSthRczGfB2dY +clock timezone Golf <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> +archive +<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> config +logging <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> +logging size <span class="hljs-number"><span class="hljs-number">200</span></span> +hidekeys +<span class="hljs-type"><span class="hljs-type">path</span></span> tftp://<span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/$h +<span class="hljs-keyword"><span class="hljs-keyword">write</span></span>-memory +kron occurrence CONFIG_BACKUP_SCHED at <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> recurring +<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>-list CONFIG_BACKUP +kron <span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>-list CONFIG_BACKUP +cli wr mem -service timestamps <span class="hljs-keyword"><span class="hljs-keyword">log</span></span> datetime msec</code> </pre><br>  <b>+</b> means that the line is in the second specified configuration file (that is, in SW1-Jan-13-2017-10-00-00-Golf-3), but it is not in the first (that is, in startup-config ); <br><br>  <b>-</b> means that the line is in the first configuration file (in the startup-config), but it is not in the second (in SW1-Jan-13-2017-10-00-00-Golf-3). <br><br>  To compare running-config with the same configuration file on a remote tftp server, the command will be used: <br><br><pre> <code class="hljs lua">SW1#show archive <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> differences system:<span class="hljs-built_in"><span class="hljs-built_in">running</span></span>-<span class="hljs-built_in"><span class="hljs-built_in">config</span></span> tftp://<span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/SW1-Jan<span class="hljs-number"><span class="hljs-number">-13</span></span><span class="hljs-number"><span class="hljs-number">-2017</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-00</span></span><span class="hljs-number"><span class="hljs-number">-00</span></span>-Golf<span class="hljs-number"><span class="hljs-number">-3</span></span></code> </pre><br>  To compare running-config with startup-config, just use a short entry: <br><br><pre> <code class="hljs kotlin">SW1#show archive config differences !Contextual Config Diffs: <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ethernet0</span></span></span><span class="hljs-class">/3 -</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">shutdown</span></span></span></span></code> </pre><br>  In fact, this is the ‚Äú <b>show archive config differences system: running-config nvram: startup-config</b> ‚Äù <b>command</b> . <br>  Well, in this case, it is clear that run differs from start only in that the interface eth0 / 3 is administratively disabled in the current configuration. <br><br>  The ‚Äúshow archive config incremental-diffs‚Äù command with the configuration file will show which lines will be added to the running-config during the copy operation from this file to run: <br><br><pre> <code class="hljs pgsql">SW1#$ <span class="hljs-keyword"><span class="hljs-keyword">show</span></span> archive config incremental-diffs tftp://<span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/SW1-Jan<span class="hljs-number"><span class="hljs-number">-13</span></span><span class="hljs-number"><span class="hljs-number">-2017</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-00</span></span><span class="hljs-number"><span class="hljs-number">-00</span></span>-Golf<span class="hljs-number"><span class="hljs-number">-3</span></span> Loading SW1-Jan<span class="hljs-number"><span class="hljs-number">-13</span></span><span class="hljs-number"><span class="hljs-number">-2017</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-00</span></span><span class="hljs-number"><span class="hljs-number">-00</span></span>-Golf<span class="hljs-number"><span class="hljs-number">-3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> (via Vlan1): ! [OK - <span class="hljs-number"><span class="hljs-number">1483</span></span> bytes] !List <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> Commands: service timestamps <span class="hljs-keyword"><span class="hljs-keyword">log</span></span> datetime <span class="hljs-built_in"><span class="hljs-built_in">localtime</span></span> <span class="hljs-keyword"><span class="hljs-keyword">show</span></span>-timezone year username greg secret <span class="hljs-number"><span class="hljs-number">4</span></span> WGWXTgqyMqk91MhF3Gz5CQdMnLHU4clSthRczGfB2dY clock timezone Golf <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> archive <span class="hljs-keyword"><span class="hljs-keyword">log</span></span> config logging <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> logging size <span class="hljs-number"><span class="hljs-number">200</span></span> hidekeys <span class="hljs-type"><span class="hljs-type">path</span></span> tftp://<span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/$h <span class="hljs-keyword"><span class="hljs-keyword">write</span></span>-memory kron occurrence CONFIG_BACKUP_SCHED at <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> recurring <span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>-list CONFIG_BACKUP kron <span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>-list CONFIG_BACKUP cli wr mem <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  But it is worth remembering that <b>copy for running-config is not at all the same as configure replace</b> . <br><br>  If you look, for example, startup-config: <br><br><pre> <code class="hljs pgsql">SW1#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> archive config differences !Contextual Config Diffs: interface Ethernet0/<span class="hljs-number"><span class="hljs-number">3</span></span> -shutdown SW1#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> archive config incremental-diffs nvram:startup-config !List <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> Commands: <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> !<span class="hljs-keyword"><span class="hljs-keyword">No</span></span> changes were <span class="hljs-built_in"><span class="hljs-built_in">found</span></span></code> </pre><br>  Those.  ‚ÄúDifferences‚Äù indicates that eth0 / 3 is disabled in run, but incremental-diffs says that nothing will be added to the current configuration when copying ‚Äúcopy start run‚Äù.  Those.  With this command, we will not roll back to the startup-config. <br><br><h4>  2. Rollback configuration </h4><br>  When working through vty, some use the ‚Äúreload in [min]‚Äù command so that if errors are made in the current configuration and access to the device is lost, the device automatically reboots after a certain time interval and changes are rolled back to startup-config. <br><br>  Archive allows you to solve such problems without rebooting the device - a delayed rollback running-config. <br><br>  <b>ATTENTION:</b> to use rollbacks, configuration archiving must be configured.  For example: <br><br><pre> <code class="hljs lua">SW1#show <span class="hljs-built_in"><span class="hljs-built_in">running</span></span>-<span class="hljs-built_in"><span class="hljs-built_in">config</span></span> | section archive archive <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> logging enable logging size <span class="hljs-number"><span class="hljs-number">200</span></span> hidekeys <span class="hljs-built_in"><span class="hljs-built_in">path</span></span> tftp://<span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/$h <span class="hljs-built_in"><span class="hljs-built_in">write</span></span>-memory</code> </pre><br>  <b>a.</b>  <b>Rollback after a certain time interval</b> <br><br>  Getting to the hardware configuration.  Pre-set the rollback timer with ‚Äúconfigure terminal revert timer‚Äù: <br><br><pre> <code class="hljs pgsql">SW1#configure terminal revert timer <span class="hljs-number"><span class="hljs-number">20</span></span> !<span class="hljs-keyword"><span class="hljs-keyword">Rollback</span></span> Confirmed Change: Backing up <span class="hljs-keyword"><span class="hljs-keyword">current</span></span> running config <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> tftp://<span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/SW1-Jan<span class="hljs-number"><span class="hljs-number">-13</span></span><span class="hljs-number"><span class="hljs-number">-2017</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span><span class="hljs-number"><span class="hljs-number">-30</span></span>-Golf<span class="hljs-number"><span class="hljs-number">-1</span></span> Enter <span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span> commands, one per <span class="hljs-type"><span class="hljs-type">line</span></span>. <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> CNTL/Z. SW1(config)# *Jan <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span> Golf: %ARCHIVE_DIFF<span class="hljs-number"><span class="hljs-number">-5</span></span>-ROLLBK_CNFMD_CHG_BACKUP: Backing up <span class="hljs-keyword"><span class="hljs-keyword">current</span></span> running config <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> tftp://<span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/SW1-Jan<span class="hljs-number"><span class="hljs-number">-13</span></span><span class="hljs-number"><span class="hljs-number">-2017</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span><span class="hljs-number"><span class="hljs-number">-30</span></span>-Golf<span class="hljs-number"><span class="hljs-number">-1</span></span> *Jan <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span> Golf: %ARCHIVE_DIFF<span class="hljs-number"><span class="hljs-number">-5</span></span>-ROLLBK_CNFMD_CHG_START_ABSTIMER: <span class="hljs-keyword"><span class="hljs-keyword">User</span></span>: mark: Scheduled <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">rollback</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> config tftp://<span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/SW1-Jan<span class="hljs-number"><span class="hljs-number">-13</span></span><span class="hljs-number"><span class="hljs-number">-2017</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span><span class="hljs-number"><span class="hljs-number">-30</span></span>-Golf<span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> minutes</code> </pre><br>  As you can see, the running-config was archived at <a href="">10.0.5.1/SW1-Jan-13-2017-16-16-30-Golf-1</a> and the rollback to this file was delayed by 20 minutes. <br><br>  Now for an example, we make changes (disable eth0 / 3): <br><br><pre> <code class="hljs lua">SW1(<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>)#interface ethernet <span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">3</span></span> SW1(<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>)#shutdown SW1(<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>)#<span class="hljs-keyword"><span class="hljs-keyword">end</span></span> SW1#show <span class="hljs-built_in"><span class="hljs-built_in">running</span></span>-<span class="hljs-built_in"><span class="hljs-built_in">config</span></span> | section interface ..... interface Ethernet0/<span class="hljs-number"><span class="hljs-number">3</span></span> shutdown duplex auto .....</code> </pre><br>  Time passes when 1 minute remains before the rollback, IOS warns me: <br><br><pre> <code class="hljs vhdl">SW1#Rollback Confirmed Change: Rollback will <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> one minute. Enter <span class="hljs-string"><span class="hljs-string">"configure confirm"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> you wish <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> keep what you<span class="hljs-symbol"><span class="hljs-symbol">'ve</span></span> configured *Jan <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">26</span></span>:<span class="hljs-number"><span class="hljs-number">38</span></span> Golf: %ARCHIVE_DIFF-<span class="hljs-number"><span class="hljs-number">5</span></span>-ROLLBK_CNFMD_CHG_WARNING_ABSTIMER: System will rollback <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> config tftp://<span class="hljs-number"><span class="hljs-number">10.0</span></span>.<span class="hljs-number"><span class="hljs-number">5.1</span></span>/SW1-Jan-<span class="hljs-number"><span class="hljs-number">13</span></span>-<span class="hljs-number"><span class="hljs-number">2017</span></span>-<span class="hljs-number"><span class="hljs-number">16</span></span>-<span class="hljs-number"><span class="hljs-number">16</span></span>-<span class="hljs-number"><span class="hljs-number">30</span></span>-Golf-<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> one minute. Enter <span class="hljs-string"><span class="hljs-string">"configure confirm"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> you wish <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> keep what you<span class="hljs-symbol"><span class="hljs-symbol">'ve</span></span> configured</code> </pre><br>  The minute expires and rolls back (in fact, "configure replace"): <br><br><pre> <code class="hljs erlang-repl">     (  configure replace): SW1#Rollback Confirmed Change: rolling to:tftp://<span class="hljs-number"><span class="hljs-number">10.0</span></span>.<span class="hljs-number"><span class="hljs-number">5.1</span></span>/SW1-Jan-<span class="hljs-number"><span class="hljs-number">13</span></span>-<span class="hljs-number"><span class="hljs-number">2017</span></span>-<span class="hljs-number"><span class="hljs-number">16</span></span>-<span class="hljs-number"><span class="hljs-number">16</span></span>-<span class="hljs-number"><span class="hljs-number">30</span></span>-Golf-<span class="hljs-number"><span class="hljs-number">1</span></span> Loading SW1-Jan-<span class="hljs-number"><span class="hljs-number">13</span></span>-<span class="hljs-number"><span class="hljs-number">2017</span></span>-<span class="hljs-number"><span class="hljs-number">16</span></span>-<span class="hljs-number"><span class="hljs-number">16</span></span>-<span class="hljs-number"><span class="hljs-number">30</span></span>-Golf-<span class="hljs-number"><span class="hljs-number">1</span></span> from <span class="hljs-number"><span class="hljs-number">10.0</span></span>.<span class="hljs-number"><span class="hljs-number">5.1</span></span> (via Vlan1): ! [OK - <span class="hljs-number"><span class="hljs-number">1483</span></span> bytes] Loading SW1-Jan-<span class="hljs-number"><span class="hljs-number">13</span></span>-<span class="hljs-number"><span class="hljs-number">2017</span></span>-<span class="hljs-number"><span class="hljs-number">16</span></span>-<span class="hljs-number"><span class="hljs-number">16</span></span>-<span class="hljs-number"><span class="hljs-number">30</span></span>-Golf-<span class="hljs-number"><span class="hljs-number">1</span></span> from <span class="hljs-number"><span class="hljs-number">10.0</span></span>.<span class="hljs-number"><span class="hljs-number">5.1</span></span> (via Vlan1): ! [OK - <span class="hljs-number"><span class="hljs-number">1483</span></span> bytes] !Pass <span class="hljs-number"><span class="hljs-number">1</span></span> !List of Rollback Commands: interface Ethernet0/<span class="hljs-number"><span class="hljs-number">3</span></span> no shutdown end Total number of passes: <span class="hljs-number"><span class="hljs-number">1</span></span> Rollback Done</code> </pre><br>  Checking: <br><br><pre> <code class="hljs kotlin">SW1#sh run | section <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> ..... </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ethernet0</span></span></span><span class="hljs-class">/3 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">duplex</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auto</span></span></span><span class="hljs-class"> .....</span></span></code> </pre><br>  Eth0 / 3 is not disabled, i.e.  rollback successful. <br><br>  <b>b.</b>  <b>How much time is left.</b>  <b>Instant Rollback</b> <br><br>  Information about how much time is left before a rollback can be obtained using the ‚Äúshow archive config rollback timer‚Äù command: <br><br><pre> <code class="hljs pgsql">SW1#configure terminal revert timer <span class="hljs-number"><span class="hljs-number">10</span></span> !<span class="hljs-keyword"><span class="hljs-keyword">Rollback</span></span> Confirmed Change: Backing up <span class="hljs-keyword"><span class="hljs-keyword">current</span></span> running config <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> tftp://<span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/SW1-Jan<span class="hljs-number"><span class="hljs-number">-13</span></span><span class="hljs-number"><span class="hljs-number">-2017</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span><span class="hljs-number"><span class="hljs-number">-40</span></span><span class="hljs-number"><span class="hljs-number">-36</span></span>-Golf<span class="hljs-number"><span class="hljs-number">-2</span></span> Enter <span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span> commands, one per <span class="hljs-type"><span class="hljs-type">line</span></span>. <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> CNTL/Z. SW1(config)#<span class="hljs-keyword"><span class="hljs-keyword">end</span></span> SW1#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> archive config <span class="hljs-keyword"><span class="hljs-keyword">rollback</span></span> timer <span class="hljs-type"><span class="hljs-type">Time</span></span> configured(<span class="hljs-keyword"><span class="hljs-keyword">or</span></span> reconfigured): <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span> Golf Fri Jan <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span> Timer <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: absolute timer Timer <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span> min <span class="hljs-keyword"><span class="hljs-keyword">User</span></span>: mark</code> </pre><br>  How much time is left is not shown, but the time is shown when the interval has been configured and the length of the interval itself, i.e.  you can count. <br><br>  How to change the interval - reduce or increase?  With the command ‚Äúconfigure revert timer‚Äù: <br><br><pre> <code class="hljs pgsql">SW1#configure revert timer <span class="hljs-number"><span class="hljs-number">5</span></span> SW1# *Jan <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">43</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span> Golf: %ARCHIVE_DIFF<span class="hljs-number"><span class="hljs-number">-5</span></span>-ROLLBK_CNFMD_CHG_RESET_ABSTIMER: <span class="hljs-keyword"><span class="hljs-keyword">User</span></span>: mark: <span class="hljs-keyword"><span class="hljs-keyword">Reset</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Rollback</span></span> Confirmed Change timer(absolute) <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> minute SW1#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> archive config <span class="hljs-keyword"><span class="hljs-keyword">rollback</span></span> timer <span class="hljs-type"><span class="hljs-type">Time</span></span> configured(<span class="hljs-keyword"><span class="hljs-keyword">or</span></span> reconfigured): <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">43</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span> Golf Fri Jan <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span> Timer <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: absolute timer Timer <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span> min <span class="hljs-keyword"><span class="hljs-keyword">User</span></span>: mark</code> </pre><br>  In fact, this command adds nothing and does not reduce, but simply sets a new interval from the current moment. <br><br>  How to make an instant rollback?  With the ‚Äúconfigure revert now‚Äù command: <br><br><pre> <code class="hljs erlang-repl">SW1#configure revert now Rollback Confirmed Change: rolling to:tftp://<span class="hljs-number"><span class="hljs-number">10.0</span></span>.<span class="hljs-number"><span class="hljs-number">5.1</span></span>/SW1-Jan-<span class="hljs-number"><span class="hljs-number">13</span></span>-<span class="hljs-number"><span class="hljs-number">2017</span></span>-<span class="hljs-number"><span class="hljs-number">16</span></span>-<span class="hljs-number"><span class="hljs-number">40</span></span>-<span class="hljs-number"><span class="hljs-number">36</span></span>-Golf-<span class="hljs-number"><span class="hljs-number">2</span></span> Loading SW1-Jan-<span class="hljs-number"><span class="hljs-number">13</span></span>-<span class="hljs-number"><span class="hljs-number">2017</span></span>-<span class="hljs-number"><span class="hljs-number">16</span></span>-<span class="hljs-number"><span class="hljs-number">40</span></span>-<span class="hljs-number"><span class="hljs-number">36</span></span>-Golf-<span class="hljs-number"><span class="hljs-number">2</span></span> from <span class="hljs-number"><span class="hljs-number">10.0</span></span>.<span class="hljs-number"><span class="hljs-number">5.1</span></span> (via Vlan1): ! [OK - <span class="hljs-number"><span class="hljs-number">1483</span></span> bytes] Loading SW1-Jan-<span class="hljs-number"><span class="hljs-number">13</span></span>-<span class="hljs-number"><span class="hljs-number">2017</span></span>-<span class="hljs-number"><span class="hljs-number">16</span></span>-<span class="hljs-number"><span class="hljs-number">40</span></span>-<span class="hljs-number"><span class="hljs-number">36</span></span>-Golf-<span class="hljs-number"><span class="hljs-number">2</span></span> from <span class="hljs-number"><span class="hljs-number">10.0</span></span>.<span class="hljs-number"><span class="hljs-number">5.1</span></span> (via Vlan1): ! [OK - <span class="hljs-number"><span class="hljs-number">1483</span></span> bytes] Total number of passes: <span class="hljs-number"><span class="hljs-number">0</span></span> Rollback Done</code> </pre><br>  Well, I had no changes in this case.  This is the same as ‚Äúconfigure replace‚Äù, only the config that needs to be rolled back cannot be specified. <br><br>  <b>c.</b>  <b>How to undo a rollback</b> <br><br>  Suppose we set a rollback interval, make changes, and the current configuration suits us.  How to undo a running-config rollback?  With the ‚Äúconfigure confirm‚Äù command: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">SW1</span></span><span class="hljs-selector-id"><span class="hljs-selector-id">#configure</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">confirm</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SW1</span></span># *<span class="hljs-selector-tag"><span class="hljs-selector-tag">Jan</span></span> 13 2017 16<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:48</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:42</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Golf</span></span>: %<span class="hljs-selector-tag"><span class="hljs-selector-tag">ARCHIVE_DIFF-5-ROLLBK_CNFMD_CHG_CONFIRM</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">User</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mark</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">Confirm</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">the</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">configuration</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">change</span></span></code> </pre><br>  It should be clearly understood that ‚Äúconfigure confirm‚Äù is not saving run to start, it is just undoing rollback. <br><br>  <u><b>ATTENTION:</b></u> after confirming the configuration, i.e.  Cancel rollback MUST check ‚Äúshow archive config rollback timer‚Äù.  The answer should be: <br><br><pre> <code class="hljs pgsql">SW1#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> archive config <span class="hljs-keyword"><span class="hljs-keyword">rollback</span></span> timer %<span class="hljs-keyword"><span class="hljs-keyword">No</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Rollback</span></span> Confirmed Change pending</code> </pre><br>  <b>PS</b> throughout the article I mentioned it more than once, but finally I will repeat it again: rollback, as well as configure replace, is a roll-out of running-config and no other file. </div><p>Source: <a href="https://habr.com/ru/post/339844/">https://habr.com/ru/post/339844/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../339834/index.html">Who left: three stories of alumni of the HeadHunter School of Programmers</a></li>
<li><a href="../339836/index.html">Teamwork and electronic document management. University study experience</a></li>
<li><a href="../339838/index.html">Reverse engineering game Strike Commander</a></li>
<li><a href="../339840/index.html">When it is better not to use deep learning</a></li>
<li><a href="../339842/index.html">Unusual mitap about Java in St. Petersburg on October 30</a></li>
<li><a href="../339846/index.html">Golang Moscow: meeting in Avito</a></li>
<li><a href="../339848/index.html">Progressive degradation</a></li>
<li><a href="../339850/index.html">How does it feel to work in a customer's office?</a></li>
<li><a href="../339852/index.html">How trick helps</a></li>
<li><a href="../339854/index.html">W3C or WHATWG</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>