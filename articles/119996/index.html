<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Oracle functions returning a table</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Those who came to Oracle from MSSQL, probably faced (as I do) with a lot of surprises. 

 create function Foo1 (param1 nvarchar, param2 decimal(18,2))...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Oracle functions returning a table</h1><div class="post__text post__text-html js-mediator-article"> Those who came to Oracle from MSSQL, probably faced (as I do) with a lot of surprises. <br><a name="habracut"></a><br> <code>create function Foo1 (param1 nvarchar, param2 decimal(18,2)) <br> return table ( <br> id number, <br> nn nvarchar(50) <br> ) <br> as <br> ...</code> <br> <br>  Familiar, is not it?  If this function perfectly returned ADO Recordset from MS SQL, then in Oracle there is no such freebie.  However, obtaining data sets from functions through ADO is simply necessary if we want to adhere to a competent object model structure. <br><br>  Create two tables - employees and departments. <br><br> <code>--   <br> create tablespace ALEX_DATA datafile 'C:\oracle\user_data\tblsp_alexdata.dat' <br> size 10M REUSE AUTOEXTEND ON NEXT 2M MAXSIZE 200M; <br> create tablespace ALEX_INDEX datafile 'C:\oracle\user_data\tblsp_alexix.dat' <br> size 1M REUSE AUTOEXTEND ON NEXT 1M MAXSIZE 200M; <br> / <br> --  <br> create table ALEX.T_EMPLOYEES( <br> id number(5) not null, <br> id_department number(5) not null, <br> empinfo nvarchar2(50) not null <br> ) tablespace ALEX_DATA; <br> create table ALEX.T_DEPARTMENTS( <br> id number(5) not null, <br> depinfo nvarchar2(50) not null <br> ) tablespace ALEX_DATA; <br> / <br> --  <br> create index IXPK_T_EMPLOYEES on ALEX.T_EMPLOYEES(id) <br> tablespace ALEX_INDEX; <br> create index IXPK_T_DEPARTMENTS on ALEX.T_DEPARTMENTS(id) <br> tablespace ALEX_INDEX; <br> / <br> --   <br> alter table ALEX.T_DEPARTMENTS <br> add constraint PK_T_DEPARTMENTS primary key (ID) using index IXPK_T_DEPARTMENTS; <br> / <br> alter table ALEX.T_EMPLOYEES <br> add constraint PK_T_EMPLOYEES primary key (ID) using index IXPK_T_EMPLOYEES <br> add constraint FK_T_DEPARTMENTS foreign key (id_department) <br> references ALEX.T_DEPARTMENTS(id); <br> / <br> --- <br> insert into ALEX.T_DEPARTMENTS (ID, DEPINFO) <br> values (1, ' '); <br> insert into ALEX.T_DEPARTMENTS (ID, DEPINFO) <br> values (2, ' '); <br> insert into ALEX.T_DEPARTMENTS (ID, DEPINFO) <br> values (3, ''); <br> <br> commit; <br> <br> insert into ALEX.T_EMPLOYEES (ID, ID_DEPARTMENT, EMPINFO) <br> values(1, 1, ''); <br> insert into ALEX.T_EMPLOYEES (ID, ID_DEPARTMENT, EMPINFO) <br> values(2, 1, ''); <br> insert into ALEX.T_EMPLOYEES (ID, ID_DEPARTMENT, EMPINFO) <br> values(3, 2, ''); <br> insert into ALEX.T_EMPLOYEES (ID, ID_DEPARTMENT, EMPINFO) <br> values(4, 3, ''); <br> insert into ALEX.T_EMPLOYEES (ID, ID_DEPARTMENT, EMPINFO) <br> values(5, 3, ''); <br> <br> commit;</code> <br> <br>  Our goal is to write a function that returns a list of department employees, whose <i>id</i> is passed as a parameter. <br>  First we need to describe the data type returned by the table. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code>--  ,  <i>GetEmployees</i> <br> type rowGetEmployees is record( <br> l_empinfo ALEX.T_EMPLOYEES.EMPINFO%TYPE, --    empinfo <br> l_depinfo ALEX.T_DEPARTMENTS.DEPINFO%TYPE <br> );</code> <br> <br>  This is the string data type.  The <i>TYPE</i> attribute declares a type for a variable that is identical to the specified field.  Create a second type: <br><br> <code>type tblGetEmployees is table of rowGetEmployees;</code> <br> <br>  This is a table of rows of type <i>rowGetEmployees</i> .  A variable of this type will be returned by our function: <br><br> <code>function GetEmployees <br> (prm_depID number default null) <br> return tblGetEmployees <br> pipelined;</code> <br> <br>  If the parameter is not passed, we will return a list of all employees.  The <i>pipelined</i> attribute means that the function is a pipelined function, the result is returned to the client immediately when the <i>pipe row</i> directive is called, therefore the <i>return statement is</i> optional.  In fact, according to the result set from the query, the cursor passes in the function body, which at each iteration adds the current line to the recordset. <br>  Put the data types and function in the package.  At the exit we have <br><br> <code>create or replace package ALEX.P_MY1 is <br> --  ,  GetEmployees <br> type rowGetEmployees is record( <br> l_empinfo ALEX.T_EMPLOYEES.EMPINFO%TYPE, --    empinfo <br> l_depinfo ALEX.T_DEPARTMENTS.DEPINFO%TYPE <br> ); <br> --     rowGetEmployees <br> type tblGetEmployees is table of rowGetEmployees; <br> -- <br> function GetEmployees <br> (prm_depID number default null) <br> return tblGetEmployees <br> pipelined; <br> <br> end P_MY1; <br> <br> create or replace package body ALEX.P_MY1 is <br> function GetEmployees <br> (prm_depID number default null) <br> return tblGetEmployees <br> pipelined <br> is <br> begin <br> if prm_depID is null then <br> for curr in <br> ( <br> select emp.empinfo, dep.depinfo <br> from ALEX.T_DEPARTMENTS dep inner join <br> ALEX.T_EMPLOYEES emp on dep.id = emp.id_department <br> ) loop <br> pipe row (curr); <br> end loop; <br> else <br> for curr in <br> ( <br> select emp.empinfo, dep.depinfo <br> from ALEX.T_DEPARTMENTS dep inner join <br> ALEX.T_EMPLOYEES emp on dep.id = emp.id_department <br> where dep.id = prm_depID <br> ) loop <br> pipe row (curr); <br> end loop; <br> end if; <br> end GetEmployees; <br> <br> end P_MY1;</code> <br> <br>  Make a call: <br><br> <code>SQL&gt; select * from TABLE(ALEX.P_MY1.GetEmployees); <br> <br> L_EMPINFO L_DEPINFO <br> ---------------- -------------------------------- <br>  -----------------   <br>  -----------------   <br>  -----------------   <br>  -----------------  <br>  -----------------  <br> <br> SQL&gt; select * from TABLE(ALEX.P_MY1.GetEmployees(1)); <br> <br> L_EMPINFO L_DEPINFO <br> --------------------------------------------------- <br>  -----------------   <br>  -----------------  </code> </div><p>Source: <a href="https://habr.com/ru/post/119996/">https://habr.com/ru/post/119996/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../119986/index.html">Your first budget Android tablet</a></li>
<li><a href="../119988/index.html">Sudden Documents</a></li>
<li><a href="../119990/index.html">Experience moving to SSD</a></li>
<li><a href="../119991/index.html">Firefox and Chrome make an interface without an address bar</a></li>
<li><a href="../119993/index.html">Twitter confirmed the acquisition of TweetDeck</a></li>
<li><a href="../119997/index.html">SSD on the chart hot / crazy</a></li>
<li><a href="../119998/index.html">Live broadcast of DevCon'11 reports. The first day</a></li>
<li><a href="../119999/index.html">Flamp makes people write reviews!</a></li>
<li><a href="../120000/index.html">Refactoring syndrome</a></li>
<li><a href="../120001/index.html">Kazakhstanis are sent to the App Store or How to make an application in a week</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>