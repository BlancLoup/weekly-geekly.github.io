<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Checking JSON using decorators in TypeScript</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I really like static types, so TypeScript has become an indispensable helper when working with NodeJS or browser-based JS. 

 On duty, you have to hav...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Checking JSON using decorators in TypeScript</h1><div class="post__text post__text-html js-mediator-article">  I really like static types, so TypeScript has become an indispensable helper when working with NodeJS or browser-based JS. <br><br>  On duty, you have to have a lot of things to do with JSON, and here the TypeScript type system does not help anything, it even hinders, because the compiler reports that there are no errors, JSON.parse returns the type Any.  In addition, TypeScript does not support reflection, due to the specifics of the work, which means that it is not possible to check the type based on the already existing code.  Also, until recently, there were no tools for meta-programming at all. <br><br>  Often, checking the correctness of the incoming JSON object is wrapped in huge code in class constructors, or in the same configuration files.  But finally <a href="https://github.com/Microsoft/TypeScript/issues/2249">, decorators appeared</a> in <a href="http://habrahabr.ru/company/microsoft/blog/254867/">TypeScript 1.5</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Decorators allow you to perform certain manipulations with a class, method, property, or parameter during their <b>declaration</b> , while it is possible to transfer additional information about the object being decorated.  This I took advantage of. <a name="habracut"></a><br><br>  It looks like this: <br><br><pre><code class="hljs scala"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">X</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Model</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@prop</span></span>({ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">PropType</span></span>.<span class="hljs-type"><span class="hljs-type">Array</span></span>, arrayProp: { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">PropType</span></span>.<span class="hljs-type"><span class="hljs-type">Number</span></span> } }) a; } enum <span class="hljs-type"><span class="hljs-type">Enum1</span></span> { <span class="hljs-type"><span class="hljs-type">V1</span></span>, <span class="hljs-type"><span class="hljs-type">V2</span></span>, <span class="hljs-type"><span class="hljs-type">V3</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyClass</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Model</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@prop</span></span>({ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">PropType</span></span>.<span class="hljs-type"><span class="hljs-type">Object</span></span>, <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">X</span></span> }) prop1; <span class="hljs-meta"><span class="hljs-meta">@prop</span></span>({ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">PropType</span></span>.<span class="hljs-type"><span class="hljs-type">String</span></span> }) propString; <span class="hljs-meta"><span class="hljs-meta">@prop</span></span>({ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">PropType</span></span>.<span class="hljs-type"><span class="hljs-type">Enum</span></span>, <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Enum1</span></span> }) b: <span class="hljs-type"><span class="hljs-type">Enum1</span></span>; } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestString</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Model</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@prop</span></span>({ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">PropType</span></span>.<span class="hljs-type"><span class="hljs-type">String</span></span> }) prop: string; }</code> </pre> <br>  It turned out a little duplication when specifying the type, but it is much less evil than describing the class system separately, purely for type checking. <br><br><h4>  Task </h4><br>  We need to get from the JSON object a full TypeScript object with no errors in the fields, with hierarchical support for nested objects (with its own types).  I did not implement working with JSON, in the root of which is not a plain-object;  there was no need. <br><br>  The main types I wanted to get at the output of JSON: <br><ul><li>  String </li><li>  Number </li><li>  Boolean </li><li>  Object </li><li>  Array </li><li>  Enum </li><li>  Any </li></ul><br><h4>  Decision </h4><br>  To implement, I created a property decorator and a special Model class that all classes whose fields we want to check must inherit.  When defining a class, information about all fields declared with the decorator (type, mandatory, etc.) is entered in a special field.  By the way, you can not use inheritance, but create a class decorator (for example, @jsonable). <br><br>  String - just checked on the actual JS-object String.  Number and Boolean have the ability to specify the isCasting parameter, in which case it is checked whether the value can be converted to a number or perhaps any value for Boolean. <br><br>  Object - checks whether the object is plain-object and if a special <i>class</i> parameter is specified, then an instance is created, and if the class inherits the Model, then its fields are also checked. <br>  Array - check for JS-Array + ability to specify the type of enumerated values.  Each value is checked for type separately. <br>  Enum - if the <i>class</i> parameter is specified (in this case, a reference to enum), then it is checked whether the necessary value exists in this enumeration.  In JSON, specified by text (as in the definition of enum). <br><br>  I will not give the code here, it is quite simple, I <a href="https://github.com/arvitaly/typescript-json-check">put it on github</a> .  Here is an example of use for the classes described in the listing above: <br><br><pre> <code class="hljs java"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyClass({ propString: <span class="hljs-string"><span class="hljs-string">"test1"</span></span>, prop1: { a: [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>] }, b: <span class="hljs-string"><span class="hljs-string">"V1"</span></span> }); console.<span class="hljs-keyword"><span class="hljs-keyword">assert</span></span>(a.prop1 <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> X); console.<span class="hljs-keyword"><span class="hljs-keyword">assert</span></span>(ab === Enum1.V1, <span class="hljs-string"><span class="hljs-string">"Invalid JSON"</span></span>); console.<span class="hljs-keyword"><span class="hljs-keyword">assert</span></span>(a.propString === <span class="hljs-string"><span class="hljs-string">"test1"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TestString({ prop: <span class="hljs-number"><span class="hljs-number">123</span></span> }); console.<span class="hljs-keyword"><span class="hljs-keyword">assert</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-string"><span class="hljs-string">"Not check string field"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) { } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyClass({}); console.<span class="hljs-keyword"><span class="hljs-keyword">assert</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-string"><span class="hljs-string">"Not check required field"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) { }</code> </pre><br>  As I have already said, this is only a prototype so far, I have not participated in the combat mode, but it gives rise to similar solutions or the possibility of using decorators. <br><br>  PS Recently on Habr√© was published an article about the simplicity of Go - <a href="http://habrahabr.ru/post/261339/">"It is difficult about the simplicity of Go</a> . <a href="http://habrahabr.ru/post/261339/">"</a>  So, the new key character @ in TypeScript has already allowed me to reduce the amount of code at times, and I remembered it right away.  And how happy I was with the arrow-function!  I look forward to async / await (yes, yes, 2 new words) that will get rid of tons of then, when, resolve, reject, etc. </div><p>Source: <a href="https://habr.com/ru/post/262105/">https://habr.com/ru/post/262105/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../262093/index.html">Gangbang, protein window and poker with ballerinas: Robots Office Dictionary</a></li>
<li><a href="../262095/index.html">7 steps to launch gh-pages for AngularJS projects created using Yeoman</a></li>
<li><a href="../262097/index.html">Algorithms of attack and protection of mobile advertising network</a></li>
<li><a href="../262101/index.html">Advanced Exim and Dovecot configuration with OpenLDAP binding</a></li>
<li><a href="../262103/index.html">Why we encrypt</a></li>
<li><a href="../262113/index.html">Insane experiences on the "implementation" of Windows 3.11 continues</a></li>
<li><a href="../262115/index.html">Icinga2 and agentless monitoring of Windows servers using WMI</a></li>
<li><a href="../262117/index.html">We improve the form of payment with the help of design and animation</a></li>
<li><a href="../262119/index.html">My vision of road events</a></li>
<li><a href="../262121/index.html">Effective logo design, part 3: The influence of geometry on logo design</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>