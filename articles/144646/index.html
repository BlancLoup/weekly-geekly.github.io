<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Javascript: OOP, prototypes, closures, Timer.js "class"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, programmers are beginners, complete, and all sympathizers. As you know, nothing is cognized as well as on personal experience. The main thing t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Javascript: OOP, prototypes, closures, Timer.js "class"</h1><div class="post__text post__text-html js-mediator-article">  Hello, programmers are beginners, complete, and all sympathizers.  As you know, nothing is cognized as well as on personal experience.  The main thing that experience was useful.  And in the continuation of this simple thought, I want to suggest doing several useful things at once: <br><ul><li>  To talk about "OOP with a human face." </li><li>  Understand the prototypes in javascript, briefly and angrily! </li><li>  Recall that the "closure" is not only <s>valuable fur</s> ... electric shock. </li><li>  Write on javascript class Timer - a sort of event scheduler to run animations, events, any functions. </li><li>  Have fun! </li></ul><br>  A warning!  If you do not expect anything fun from the article ... then you are mistaken.  People with a reduced sense of humor to read ... even more recommended!  Well, let's get started ... <br><a name="habracut"></a><br>  I note that at the time of writing this article (hello, apocalyptic-glamorous 2012!), There is no real OOP in javascript, but there are tricks with which you can implement the basic principles of object-oriented programming.  For those who are just discovering this insanely interesting topic, I will explain in my own words the specificity of this method. <br><br><h4>  Part 1. OOP with a human face. </h4><br>  Briefly: OOP is not at all a sacred mantra, but in fact, simply a method of organizing applications, structuring code, centralizing methods, and combining entities into a single hierarchical family.  Just as submarines and airplanes were built, adopting buoyancy and volatility experience from nature, OOP applications also use the perception of software entities as certain ‚Äúliving‚Äù objects, adopting characteristics and properties known to us from the real world. . <br><br>  In other words, a certain entity is created, which not only has its own properties and methods, but also knows how to generate descendants and evolve!  This is called an extension.  As if a careful parent, an object passes the property by inheritance, or gains the experience of generations, being a descendant of another parent entity - parent.  Thus, a single tree of generations is created, in which it is convenient to navigate and massively manage, unlike disparate libraries, a procedural method. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As you can see, everything is just like that of people!  With the difference that the developer is the god of this system and can be transferred by generations, making changes in the root, or in individual branches of development.  War and conflict we eliminate!  New knowledge - add!  Or on the contrary, we break everything ... It's hard to be a god!  However, the principle of OOP obliges the developer to structure the application according to the rules, and not as it is necessary, which facilitates and systematizes its support, and that, however, does not interfere if you want to confuse the code even in this case ... :) <br><br>  In my opinion, it is precisely such a ‚Äúhuman‚Äù perception of principles that helps the development of the PLO.  For example, as in life, there are strict parents who force children to be able to do anything that they themselves consider necessary!  They are called Abstract classes - abstract.  Remember how parents forced you to play the piano or teach poetry? .. So, the Abstract classes as well as many parents do not even know what this offspring child will need, and how he will use it, but we are sure that MUST!  Those.  such classes contain abstract methods, which are a declaration of a method without the implementation itself, like a candy wrapper without candy, thereby obliging the descendant to implement this method.  As in life, where parents often lay their unrealized dreams on children ... <br><br>  Here, in such a jokingly serious form, we touched on the topic of abstract classes and family relationships, as a way to understand ... both of them? .. But seriously, it goes without saying that there should be no random methods in programming, and any methods and properties are part of A well-thought class hierarchy, which as a family tree, can provide opportunities to extend functionality from generation to generation.  And abstract classes, and even more abstract ones ‚Äî interfaces (the interface ‚Äî contains no implementations at all), help the programmer not to lose, not to forget to realize the common skills necessary for all descendants in life, without which the individual will die, and with it the application. <br><br>  In addition to jokes, from the practical side, when designing application elements such as goods in a store, an object representation allows them to be brought closer to the properties of real objects, which, like in life, encapsulate (i.e. contain in themselves) all the necessary attributes: price, quantity , weight, shelf life and other necessary qualities.  But since goods can be different, their class model can branch and develop, inheriting or redefining common properties. <br><br>  Inheritance is perhaps the most important feature of OOP.  If a new stage of evolution is required, the programmer creates a new class that expands the skills of his parent, and sometimes implements in a new way, i.e.  overlapping parent methods - override.  After all, each generation has its own concepts in life ... If a programmer needs ‚Äúexperience and concepts‚Äù of previous generations, he appeals to them.  Nothing is lost in this structure, so it is extremely important to be able to use it. <br><br>  And while there is not a full-fledged OOP specification for javascript, the ability to follow the principles of OOP is, and now we will use this convenience.  Of course, in this article we will only touch on the basics of understanding, but as you know - the first step was the first step, the main thing is to catch on ... <br><br>  So, our goal now is to write some managed entity, which will trigger the processes we need by timer.  ‚ÄúManaged‚Äù - it means such an entity, or conventionally, a class will contain - as they say encapsulate, methods for management and properties containing the necessary data.  Life example: <br>  ‚Ä¢ properties are what the object knows (name, eye color, multiplication table), <br>  ‚Ä¢ methods - this is what the object can (sleep, eat, build a synchrophasotron). <br><br>  Important!  If the reader does not yet know what the object in javascript is, then I recommend to read about it in any directory beforehand, otherwise there will be difficulties in understanding. <br>  The creation of the object will occur through a function that is called with the new directive.  It is the new directive that determines that this function is not ordinary at all, but a special function - the Constructor, which creates and returns an object.  Before she returns it, we can assign to this object everything that the soul wishes: knowledge and skills. <br><br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Timer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*    ‚Ä¶ */</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> timer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Timer();</code> </pre> <br><br>  So, we created a timer object of class Timer.  But as creative people, we may want to give our object some properties when creating it, or not to give it ... Ie  we want universality, so that if we wish we could set ‚Äúknowledge and skills‚Äù or not, but the object would not die in agony without knowing how to breathe for example ... We are not animals, but how can we do it? <br>  For this, the first thing we put in our class are the default properties that the object would accept from nature.  And the processing unit. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Timer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> options </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//public var defaultOptions = { delay: 20 //     ,   -   ,stopFrame: 0 //   ,loop: true //    ,frameElementPrefixId: 'timer_' //   ID ,  -  } for(var option in defaultOptions) this[option] = options &amp;&amp; options[option]!==undefined ? options[option] : defaultOptions[option]; /*   ‚Ä¶ */ };</span></span></code> </pre> <br><br>  Also in the function signature, we have the options parameter, this is an object.  You know what an object is? .. After the comment <br> <code>//public</code> <br>  we also have a defaultOptions object, which contains properties necessary for life, and a block of code behind it, which goes through all the defaultOptions properties by name, checks whether they are passed through options, and if not, sets the value from defaultOptions. <br>  To assign a value to an object, we use this, which points to the current one created inside the function - the Constructor (remember new?).  Thus, we can create our object like this: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> timer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Timer( {<span class="hljs-attr"><span class="hljs-attr">delay</span></span>: <span class="hljs-number"><span class="hljs-number">500</span></span>, <span class="hljs-attr"><span class="hljs-attr">loop</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> } );</code> </pre> <br><br>  ... and the specified properties will be recorded, and the missing ones will be taken from defaultOptions.  The object is saved!  Versatility and flexibility obtained! <br><br>  Pay attention to the comments <code>//public</code> <br>  of course, it has here a conditional meaning (like all OOP conventions in javascript, including the notion of a class), but its essence is in the mark of Public properties, i.e.  available from outside.  These properties can be accessed directly through the object: <br><pre> <code class="javascript hljs">alert( timer.delay );</code> </pre><br><br>  As an example from life, these are obvious properties of an object that do not need concealment: the length of a cat's tail. <br><br>  There are also Personal properties - private, and Protected - protected.  To access Personal, if it is allowed at all, you need to use special methods in which the programmer determines what and how and to whom you can return.  Protected - protected, it is a little less personal, because  available for both the class itself and its heirs, in the ‚Äúfamily‚Äù circle, so to speak.  This is done for the stability of the application, because not all the rubbish is better to endure their huts ... <br><br>  Let us and we add Personal properties - private, this is done by creating internal variables inside the function, so their scope is limited (or otherwise closed) by the function itself - ‚ÄúI won‚Äôt tell anyone if I don‚Äôt want it‚Äù!  We'll talk more about closures ... In the meantime, insert further into the Timer function: <br><br><pre> <code class="javascript hljs"> <span class="hljs-comment"><span class="hljs-comment">//private var busy = false, //  ""  " !" currentTime = 0 //   ,frame = 1 //   ,task = {} // ! !         ,   ,keyFrames=[] //    , ..      ; /*   ‚Ä¶ */</span></span></code> </pre><br>  to such properties, if we want, we will allow to access through public methods as: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getKeyFrames = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> keyFrames; }</code> </pre> <br>  Note that this method is public, because  through this it is assigned to the property of the object, which can then be accessed through a point (let's not forget about the brackets at the end, if we call the action): <br><br><pre> <code class="javascript hljs">timer.getKeyFrames();</code> </pre> <br><br>  if we need a private method, then it is similar to private variables, it is also created by a ‚Äúnormal‚Äù declaration of an internal function: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">somePrivateMethod</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* some code... */</span></span> }</code> </pre> <br><br>  It turned out a service function that the Constructor can call for personal purposes.  But from the object created by the constructor, this function will be unavailable, since  is not his property. <br><br>  Again, in javascript all these conventions that help to follow the principles of OOP, but do not always provide an exact implementation.  For example, with the implementation of protected in javascript is very tight!  The fact is that protected partially combines the properties and private- for inaccessibility from an object, and public- for access from other classes, which in javascript contradicts each other, as it is provided by the scope - the closure.  Alternatively, you can create a public method and check inside it if the object that is calling it is a successor of the method owner, etc.  There is no perfect solution, everything is within the framework of conventions. <br><br>  Well, sort of, with the organization of access a bit sorted out.  What about inheritance, because this is the most important quality in the PLO - the ability to learn and develop the skills and knowledge of their parents?  And here we come to an important feature of javascript - prototype inheritance.  This topic often causes difficulties of understanding, and then I will make my attempt to ‚Äúexplain everything once and for all‚Äù in a simple, human language. <br><br><h4>  Part 2. Prototypes in javascript. </h4><br>  So, in javascript there is a concept prototype, a hidden link [[prototype]] of an object, it is __proto__, and a property of the prototype function.  To stop being confused in these concepts, let's sort them one by one: <br><br><ul><li>  the prototype of the current object is called some other object, from which the current object draws the missing methods and properties. </li><li>  the hidden link [[prototype]] points to the prototype of the current object and is not available for development by specification.  But in some browsers that violate the specification, it is open as a property of the __proto__ object, which, however, does not make sense to use it directly.  because  It is not cross-browser and not correct. </li><li>  prototype is a property of the function!  I repeat, it is the functions that are used to transfer the value of the [[prototype]] link to the object being created. </li></ul><br><br>  Any self-respecting javascript object has a hidden [[prototype]] link that links it to the parent object, which in turn is with its own, etc.  At the top of this whole chain is a built-in javascript object, a sort of supreme progenitor, object adam, which has all the necessary built-in methods, such as toString, valueOf, hasOwnProperty, etc.  Because of this, all descendant objects also have this minimally necessary set of methods, which allows them to survive in an uneasy javascript environment. <br><br>  flow_object2 - [[prototype]] -&gt; flow_object1 - [[prototype]] -&gt; ... {toString: ..., valueOf: ..., hasOwnProperty: ..., ...} <br><br>  Those.  even if you simply create an empty var obj = {} object that does not have methods and properties and refer to the standard method, then by the [[prototype]] reference chain (in this case the minimum short chain), it will take this method from the built-in javascript object: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj = {}; <span class="hljs-comment"><span class="hljs-comment">//  obj.toString(); //      "[object Object]"</span></span></code> </pre> <br><br>  This is how prototype inheritance in javascript is implemented, via the [[prototype]] link chain.  All properties available through the prototype chain will be discovered by descendants, as a storehouse of knowledge and skills, which allows you to build a real evolving class tree! <br><br>  Note that the prototype properties of each object are not stored in it, but as if in an intermediate link in the chain of prototypes, between the current object and the embedded javascript object "at the beginning of time".  This root object requires respect, and disturbing its peace is not quite decent, so to create your own prototypical properties, it is better to create and embed your own objects in the chain with the [[prototype]] link. <br><br>  But, as we remember, [[prototype]] is a closed link, how can we build our chain without access to it?  Here we are helped by the familiar constructor function, with the new keyword, and the prototype property, which is quite open to itself.  The fact is that an object created through the Constructor receives a [[prototype]] reference with the value specified in the prototype property of this Constructor!  Initially, any function has in its prototype property a reference to an almost empty object (with a single constructor property pointing back to the function itself), <br><br>  self_function.prototype -&gt; {constructor: -&gt; self_function} <br><br>  but we can replace the prototype property by passing our parent class.  Those.  creating a Constructor function, we simply assign a reference to the object with the properties we need in its prototype property, and the new object being created will receive a [[prototype]] reference to this object with the properties we need. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   "" var Foo = function() {}; //  prototype      Foo.prototype = { hi: 'Hello!', sayHi: function(){ alert( this.hi ) } }; //   "" var obj = new Foo(); //  ,    obj.sayHi();</span></span></code> </pre> <br><br>  In the example above, the hidden reference [[prototype]] of obj received a pointer to an object having the property hi and the method sayHi.  Thus the object obj inherits this knowledge and skill. <br>  To simplify this procedure, a function is invented. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">extend</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Child, Parent</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> F = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ } F.prototype = Parent.prototype Child.prototype = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> F() Child.prototype.constructor = Child Child.superclass = Parent.prototype }</code> </pre> <br><br>  See javascript.ru for an example of its use. <br>  <a href="http://javascript.ru/tutorial/object/inheritance">javascript.ru/tutorial/object/inheritance#svoystvo-prototype-i-prototip</a> <br><br>  It takes in the arguments two constructor functions, Descendant and Parent, and does what we have already mentioned: <br><ul><li>  creates a service function to transfer a prototype </li><li>  writes parent's prototype property to its prototype property </li><li>  passes the prototype property of the Child to an intermediate object, a new link in the chain, with a [[prototype]] reference to the prototype of the Parent </li><li>  writes the Child function to the constructor (instead of the original constructor of the service F) </li><li>  writes a reference to the Parent in the superclass property, in case it is possible to refer to its constructor and other original methods, if they are redefined in the descendant. </li></ul><br><br>  It may be asked why we need the first three lines, why not immediately make the assignment to Child.prototype = Parent.prototype, without any new F (), and that‚Äôs the end ?! <br><br>  The fact is that with such an assignment a new intermediate link in the chain of inheritance will not be created!  In Child.prototype, Parent.prototype is recorded, not an intermediate storage object with further reference to Parent.prototype, and when we try to write anything in Child.prototype, we will rush into Parent territory, violating respect for elders and succession of generations.  By calling the constructor new F (), we create our own area for storing prototype knowledge for Child, which it can pass on to its descendants. <br><br>  It is possible to add separate properties to the prototype of the Constructor as follows: <br><br><pre> <code class="javascript hljs">Child.prototype.someProperty = <span class="hljs-string"><span class="hljs-string">"someProperty"</span></span>;</code> </pre> <br><br>  And by the way, do not try to access prototype as a property of an object - an instance of a class. <br>  <b>The object has no prototype property, there is a hidden link [[prototype]], and the prototype property is not!</b> <br>  Of course, it can be created, but there is no sense in it from inheritance.  The sense is only from the prototype property of the Constructor function, due to its ability to pass a pointer to the [[prototype]] reference of the object being created. <br><br>  That's all about prototype inheritance.  Really simple? <br>  But prototype inheritance is not the only possible scheme.  I also want to mention the method of calling the superclass constructor, i.e.  parent class, it‚Äôs not for nothing that we took care of its entry in the properties of the prototype (see function extend). <br><br>  In the Timer constructor of our forgotten example, we assign some properties to the object through this.  To pass these properties to subsequent generations, it is necessary to make a call to the parent constructor in the context of the descendant, ie: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerPlayer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ TimerPlayer.superclass.constructor.apply( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span> ); }</code> </pre> <br><br>  Here it is important to remember that you cannot call through this.superclass.constructor.apply, namely through the name of the current constructor (here TimerPlayer), because otherwise, if the parent constructor also uses this, it calls this.superclass.constructor.apply (this, arguments), this will turn into a closed call to apply in the context of this as a descendant, which will cause an error. <br><br>  Calling the parent constructor in the context of a descendant will create and assign all its properties and methods to the descendant.  Moreover, the private properties of the parent, declared through var, and not through this, can be accessed only if there are parent public methods that allow them to be read. <br>  This is the way we continue to build our Timer. <br><br><h4>  Part 3. Javascript class Timer and its legacy. </h4><br>  So, we already have a class, something knowing, but not knowing how, so it's time to add skills to it!  What do we want to teach our class?  Let's do something like a player: <br>  ‚Ä¢ start <br>  ‚Ä¢ pause <br>  ‚Ä¢ stop <br>  ‚Ä¢ rewind <br>  ‚Ä¢ setToFrame <br>  And some less important methods.  Imagine that we have already written them ... So, we insert further into the Timer function: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.start = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( busy ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.console ) <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log (<span class="hljs-string"><span class="hljs-string">'start: .currentTime='</span></span>+currentTime+<span class="hljs-string"><span class="hljs-string">'; frame='</span></span>+frame); busy = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; timer.call( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> ); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.pause = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.console ) <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log (<span class="hljs-string"><span class="hljs-string">'pause: currentTime='</span></span>+currentTime+<span class="hljs-string"><span class="hljs-string">'; frame='</span></span>+frame); clearInterval( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.intervalId ); busy = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stop = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.console ) <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log (<span class="hljs-string"><span class="hljs-string">'stop: currentTime='</span></span>+currentTime+<span class="hljs-string"><span class="hljs-string">'; frame='</span></span>+frame); clearInterval( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.intervalId ); busy = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; currentTime = <span class="hljs-number"><span class="hljs-number">0</span></span>; frame = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clearFrameLine(); } <span class="hljs-comment"><span class="hljs-comment">/* highlighting -   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clearFrameLine = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">1</span></span>, str=<span class="hljs-string"><span class="hljs-string">''</span></span>; i&lt;<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stopFrame+<span class="hljs-number"><span class="hljs-number">1</span></span>; i++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( elFr = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.frameElementPrefixId+i ) ) removeClass( elFr, <span class="hljs-string"><span class="hljs-string">'active'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setActiveFrameElement = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> frameNumber </span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( elFr = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.frameElementPrefixId+frameNumber ) ) addClass(elFr, <span class="hljs-string"><span class="hljs-string">'active'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.toString = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*  ,   alert(),    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> str = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> option <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> ) str+= option+<span class="hljs-string"><span class="hljs-string">': '</span></span>+( (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[option]==<span class="hljs-string"><span class="hljs-string">'function'</span></span>) ? <span class="hljs-string"><span class="hljs-string">'function'</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[option] )+<span class="hljs-string"><span class="hljs-string">'\n'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'{\n'</span></span>+str+<span class="hljs-string"><span class="hljs-string">'}'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setTask = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> new_task </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*   ,       */</span></span> task = new_task; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stopFrame = <span class="hljs-number"><span class="hljs-number">0</span></span>; keyFrames.length = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> frInd <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> task) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( (+<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stopFrame)&lt; (+frInd) ) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stopFrame=(+frInd); keyFrames.push( +frInd ); } } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getKeyFrames = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*    keyFrames */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> keyFrames; } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getTask = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*    task */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> task; } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setToFrame = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> toFrame </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(toFrame&gt;<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stopFrame) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; frame=toFrame; currentTime=(frame<span class="hljs-number"><span class="hljs-number">-1</span></span>)*<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.delay; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> frInd <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> task) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( (+frInd)&gt;(+toFrame) ) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> taskList = task[ frInd ]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;taskList.length; i++ ){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> taskItem; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( taskItem = taskList[i] )taskItem.run(); } } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clearFrameLine(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setActiveFrameElement( toFrame ); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rewind = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> amount </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* !  !      :))))))))) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( amount&lt;<span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.intervalId ) amount--;<span class="hljs-comment"><span class="hljs-comment">/*    setInterval */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> toFrame = frame+amount; toFrame = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.max( <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.min( toFrame, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stopFrame), <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setToFrame(toFrame); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">timer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*  ,  setInterval      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> this_ = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*         */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.intervalId = setInterval( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*    setInterval    this.delay */</span></span> <span class="hljs-comment"><span class="hljs-comment">//console.log ('currentTime='+currentTime+'; frame='+frame+';'+task); if( task[ frame ] ) { /*       ,  ... */ var taskList = task[ frame ] /* ...   -   */ for(var i=0; i&lt;taskList.length; i++ ){ /*     -    - run... */ var taskItem; if( taskItem = taskList[i] ) taskItem.run(); /* ...     */ } } /* highlighting */ this_.setActiveFrameElement( frame ); /*   */ currentTime+=this_.delay; /*      */ frame++; if( this_.stopFrame &amp;&amp; frame&gt;this_.stopFrame ) { /*  stopFrame       ... */ if( this_.loop ) this_.setToFrame( 1 ); /*    - ,    ,   ,  , */ else this_.stop(); /*   ! */ } }, this.delay ); }</span></span></code> </pre> <br><br>  All done with the designer. <br>  In general, I think everything is clear: do you need a start method?  Writing a public start method!  Where‚Ä¶ <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.start = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( busy ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*    ,  ! */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   ,     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.console ) <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log (<span class="hljs-string"><span class="hljs-string">'start: .currentTime='</span></span>+currentTime+<span class="hljs-string"><span class="hljs-string">'; frame='</span></span>+frame); busy = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*  ,   */</span></span> timer.call( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> ); <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> }</code> </pre> <br><br>  I commented on the timer function in detail.  In general, the idea is simple: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">timer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> this_ = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.intervalId = setInterval(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*    ,  this_   this! */</span></span> }, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.delay ); }</code> </pre> <br><br>  First, we save the reference to the context of our object into a variable, since  inside the function called in setInterval, the context will be lost, and the variable will remain in the closure, that is, in the local scope.  Perhaps for understanding, you should repeat (or find out) about closures, and we'll talk about them below ... Next, we assign the intervalId property to our object, which is returned by the setInterval method, this identifier will allow us to stop the execution of setInterval during pause or stop, see these methods. <br><br>  Separate analysis requires task property, because it is there that we in some form store tasks for execution.  Its structure is as follows: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-number"><span class="hljs-number">1</span></span>:[ { <span class="hljs-attr"><span class="hljs-attr">run</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{} } ], <span class="hljs-number"><span class="hljs-number">5</span></span>:[ {},{},{} <span class="hljs-comment"><span class="hljs-comment">/*...*/</span></span> ], <span class="hljs-comment"><span class="hljs-comment">/*...*/</span></span> }</code> </pre> <br><br>  Object of arrays of objects.  Oh, it would be better not to say, but then he himself was confused ... <br>  But everything is simple, in the task object under the necessary frame number there is an array of tasks-objects with the run property.  This property must be assigned a function, which will be called when the desired frame.  If necessary, each task object, you can add another property, and then he and the object. <br><br>  Also, if necessary, you can add a new object to the array using the standard methods of the arrays push, unshift, splice. <br>  Well, of course, the task object itself can be assigned a property by the desired frame number! <br><br>  Thus, filling in the task and assigning our class to the setTask method, we determine what and when to do it.  How can this be used?  Perform various dynamic scenarios on the website or on the client off-line, create animations, create ‚Äúlive‚Äù tutorials or time-bound tests, remind of important events (the kettle has boiled!), Get users pop-up advertisements (nasty and nasty joke!).  Or just display the watch in the corner of the page! <br><br>  Moreover, we have already organized the simplest interface, a kind of small API to manage our timer and visualization, and now we use it by building a control panel similar to the player!  We paste into the html page the code, beloved and dear: <br><br><pre> <code class="javascript hljs">&lt;button onclick=<span class="hljs-string"><span class="hljs-string">"timer.rewind(-50);"</span></span>&gt;rewind <span class="hljs-number"><span class="hljs-number">-50</span></span>&lt;<span class="hljs-regexp"><span class="hljs-regexp">/button&gt; &lt;button onclick="timer.start();"&gt;start&lt;/</span></span>button&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"timer.pause();"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">pause</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;button onclick=<span class="hljs-string"><span class="hljs-string">"timer.stop();"</span></span>&gt;stop&lt;<span class="hljs-regexp"><span class="hljs-regexp">/button&gt; &lt;button onclick="timer.rewind(+50);"&gt;rewind +50&lt;/</span></span>button&gt;</code> </pre> <br><br>  on the onclick event, buttons of the timer object are hung on the buttons.  Of course, before calling which object should not forget to create.  Remember how?  - through the constructor function: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> timer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Timer();</code> </pre><br><br>  However, it would not be bad now to create a script, what to manage, and otherwise - what did you fight for? .. <br>  Let's try to create a simple animation, we will move the image on the page, well, a kind of ‚Äúhello world‚Äù in the animation world.  We will move the picture <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ball"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.smayli.ru/data/smiles/transporta-854.gif"</span></span></span><span class="hljs-tag"> &gt;</span></span></code> </pre><br><img src="http://www.smayli.ru/data/smiles/transporta-854.gif"><br><br>  Let me remind you that the task of our timer to cause an action, what action we want, while he himself is not responsible for this action.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Therefore, WHAT exactly to do is our task, and we will solve it now by writing a simple function of moving an element, by which the element itself is transmitted by ID and its two coordinates: </font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moveElem</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> elem, top, left </span></span></span><span class="hljs-function">)</span></span>{ elem.style.cssText = <span class="hljs-string"><span class="hljs-string">'position:relative;top:'</span></span>+top+<span class="hljs-string"><span class="hljs-string">'px;left:'</span></span>+left+<span class="hljs-string"><span class="hljs-string">'px'</span></span>; }</code> </pre> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So, now this function needs to be assigned to the run property of the task object in arrays with the numbers of the necessary frames of the task object, watch your thought? </font><font style="vertical-align: inherit;">So, we create a script object, and define its first frame as an array, in this frame we put the initial position of the image element:</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> frames = {}; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> frames[<span class="hljs-number"><span class="hljs-number">1</span></span>]=[]; frames[<span class="hljs-number"><span class="hljs-number">1</span></span>].push( { <span class="hljs-attr"><span class="hljs-attr">run</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ moveElem( ball, <span class="hljs-number"><span class="hljs-number">600</span></span>, <span class="hljs-number"><span class="hljs-number">600</span></span> ); } } );</code> </pre> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Why it is impossible to write run: moveElem (ball, 600, 600)? This is wrong, because the syntax ... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">moveElem (); </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... means calling a function, but we don‚Äôt need to call it here and now, but rather we need to put it in the body of the property of the run function that will make the call. Otherwise, we would have crammed the result of moveElem () - undefined into run, because it returns nothing, and we would have torn our picture for nothing.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And voila! </font><font style="vertical-align: inherit;">To the first frame we added an action that places our picture (balloon) in a certain lower position of the page. </font><font style="vertical-align: inherit;">Now, to begin to rise, we need to change this state frame by frame, i.e. </font><font style="vertical-align: inherit;">reduce the top coordinate, well, the left - adjusted for the wind. </font><font style="vertical-align: inherit;">:) To fill the necessary frames use the cycle. </font><font style="vertical-align: inherit;">If you wish, by the way, you can write your own Timer class method - which would add frames, and actions, and distribute the changing parameters of actions across frames ... In the meantime, for example, fill the loop with frames 2 through 600.</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">2</span></span>; i&lt;<span class="hljs-number"><span class="hljs-number">601</span></span>; i++) frames[i] = [ { <span class="hljs-attr"><span class="hljs-attr">run</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">i</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ moveElem( ball, <span class="hljs-number"><span class="hljs-number">600</span></span>-i, <span class="hljs-number"><span class="hljs-number">600</span></span>-i ); } }(i) } ];</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here we must also pay attention to the use of closures. </font><font style="vertical-align: inherit;">The fact is that for the transfer of dynamic i, wrapping in a functional expression is used here, which is called on the spot:</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">i</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*    i    */</span></span> }(i) ;</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> If we just used: </font></font><br><br><pre> <code class="javascript hljs">run: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ moveElem( ball, <span class="hljs-number"><span class="hljs-number">600</span></span>-i, <span class="hljs-number"><span class="hljs-number">600</span></span>-i ); }</code> </pre> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Then, when calling moveElem () i would be taken from the global scope, i.e. </font><font style="vertical-align: inherit;">the one that is declared and worked out in the for loop (var i = 2; i &lt;601; i ++), i.e. </font><font style="vertical-align: inherit;">a ‚Äúwaste‚Äù variable i equal to 600 would be called, and not at all a dynamic i, which should gradually increase, changing the coordinates of the ball soaring. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Therefore, we use the CLOSING on javascript, which defines the scope, i.e. </font><font style="vertical-align: inherit;">when performing a function</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">i</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*    i    */</span></span> }(i) ;</code> </pre> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... inside it, its own variable i was created as an argument to this function itself, and the call is in place (repeat if forgotten), performs the function body, where the return (return) of our function already takes place. </font><font style="vertical-align: inherit;">And again:</font></font><br>  not <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> moveElem( ball, <span class="hljs-number"><span class="hljs-number">600</span></span>-i, <span class="hljs-number"><span class="hljs-number">600</span></span>-i );</code> </pre> <br><br>  but <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ moveElem( ball, <span class="hljs-number"><span class="hljs-number">600</span></span>-i, <span class="hljs-number"><span class="hljs-number">600</span></span>-i ); }</code> </pre> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">because, in the first case, it is not the function call that returns, but the result of calling moveElem (ball, 600-i, 600-i), which will be executed right there! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And now we have a script. Now you can assign it and run it:</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> timer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Timer( ); timer.setTask( frames ); timer.start(); <span class="hljs-comment"><span class="hljs-comment">/*   start */</span></span></code> </pre> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In general, frame-by-frame management provides ample opportunities for creating interesting and complex scenarios. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On the demo page </font></font><a href="http://denis-or-love.narod.ru/portf/timer/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">denis-or-love.narod.ru/portf/timer,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> I also implemented an example of a time-frame line like TimeLine in Adobe Flash :) - the drawFrameLine button. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It should be noted that a large number of elements on the page can greatly slow down the browser when redrawing their positions, this is clearly seen in the visual IE, if you click drawFrameLine with parameter 1 - each frame. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If desired, you can write a whole interface for creating scripts, with expandable features and other amenities. Here, as they say, who is in that much ... </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/05c/a26/9f0/05ca269f09ea9f5a2663e6195004657a.png" alt="image"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And now, let's </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">do the Inheritance</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> !</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Having built the base class Timer, we will expand it by creating a more advanced class TimerPlayer. </font><font style="vertical-align: inherit;">We will limit the example of advancement to a simple example - our child class, taking the skills of the parent, will be able to create a control panel of our timer, like a player. </font><font style="vertical-align: inherit;">To do this, we do three things:</font></font><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> call parent constructor </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adding new methods </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> passing inheritance through the extend function </font></font></li></ol><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  function TimerPlayer( options ) { //    TimerPlayer.superclass.constructor.apply(this, arguments); //   this.drawPanel = function( panelId, objName ) { var objName = objName || 'timer'; var template ='&lt;button onclick="'+objName+'.rewind(-50);"&gt;rewind -50&lt;/button&gt;'+ '&lt;button onclick="'+objName+'.start();"&gt;start&lt;/button&gt;'+ '&lt;button onclick="'+objName+'.pause();"&gt;pause&lt;/button&gt;'+ '&lt;button onclick="'+objName+'.stop();"&gt;stop&lt;/button&gt;'+ '&lt;button onclick="'+objName+'.rewind(+50);"&gt;rewind +50&lt;/button&gt;'; document.getElementById( panelId ).innerHTML = template; } } // extend extend(TimerPlayer, Timer);</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And although here we do not have prototype inheritance, extend we need to build a chain for the future (and suddenly we want to add prototype properties to the parent ...), and to write the superclass and constructor. </font><font style="vertical-align: inherit;">The new drawPanel method takes the string id of the element inside which to place the buttons, and the string the name of the object to substitute into the HTML template.</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   var timerPlayer = new TimerPlayer(); timerPlayer.setTask( frames2 ); timerPlayer.drawPanel( 'controlPanel', 'timerPlayer' );</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So we finished, and maybe we just started our Timer class and its descendant. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I want to thank </font></font><a href="https://habrahabr.ru/users/devote/" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devote</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for the patient advice and assistance in writing the article. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Until new meetings and pleasant programming.</font></font></div><p>Source: <a href="https://habr.com/ru/post/144646/">https://habr.com/ru/post/144646/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../144641/index.html">FBI set up an Internet communications control unit</a></li>
<li><a href="../144642/index.html">Enable syntax highlighting for less files in Notepad ++</a></li>
<li><a href="../144643/index.html">Neurology in video games: Deus Ex: Human Revolution</a></li>
<li><a href="../144644/index.html">An open letter to the editors of "Journal Hacker"</a></li>
<li><a href="../144645/index.html">Department of Database Logic (Attempt # 2)</a></li>
<li><a href="../144648/index.html">Bachelor's degree in LaTeX, or DSTU 3008-95 in 150 lines</a></li>
<li><a href="../144649/index.html">Released free professional video editor Lightworks</a></li>
<li><a href="../144651/index.html">Groupon is testing its own mobile payment terminal.</a></li>
<li><a href="../144652/index.html">How to write articles about programming for beginners</a></li>
<li><a href="../144653/index.html">Loop Sequencer for Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>