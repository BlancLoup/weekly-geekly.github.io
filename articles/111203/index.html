<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MODx - Accounting visitors and schedule visits</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Like many programmers, I suffer some degree of suspicion towards other services, and I prefer to do everything myself. 
 Others services, in particula...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MODx - Accounting visitors and schedule visits</h1><div class="post__text post__text-html js-mediator-article">  Like many programmers, I suffer some degree of suspicion towards other services, and I prefer to do everything myself. <br>  Others services, in particular, include liveinternet and other visitor counters.  I don't trust them like that, you know. <br><br>  Now I will tell you (and show) how easy it is to register visitors to your site using modx. <br><img src="https://habrastorage.org/storage/44f5061c/094ea03a/3e75bb21/a8dabf1a.png"><br><a name="habracut"></a><br><h4>  Stage 1. We write a log. </h4><br>  First we need to create a table to store visits.  Make a sql query at your convenience.  For example, in phpmyadmin. <br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> <span class="hljs-string"><span class="hljs-string">`modx_visitors_log`</span></span> ( <span class="hljs-string"><span class="hljs-string">`index`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`ip`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_unicode_ci <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`host`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_unicode_ci <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`url`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_unicode_ci <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`datetime`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT_TIMESTAMP</span></span>, <span class="hljs-string"><span class="hljs-string">`referer`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_unicode_ci <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`browser`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`index`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`ip`</span></span> (<span class="hljs-string"><span class="hljs-string">`ip`</span></span>,<span class="hljs-string"><span class="hljs-string">`host`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=MyISAM <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8 <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span>=utf8_unicode_ci AUTO_INCREMENT=<span class="hljs-number"><span class="hljs-number">1</span></span> ;</code> </pre> <br>  The table is ready, now we need a plugin to record visits. <br><br>  Most users know about snippets and chunks in modx, but plugins are usually not up to date.  I tell you: a plug-in in modx, if in a simple way, is a snippet that works without a call from the document, itself, reacting to system events, of which quite a lot is provided in the engine.  We are interested in the <b>OnLogPageHit</b> event. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We go to <br> <code>-&gt; -&gt;-&gt;  <br></code> <br>  We call the new <b>dbLog</b> plugin and insert the following code into it: <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> <span class="hljs-comment"><span class="hljs-comment">//        modx_visitors_log $db = '`modx_visitors_log`'; //      IP.    -     $not_log_ip = array('192.168.100.1', '192.168.100.2'); $not_log_user = array('bezumkin'); /*   */ //   $login = $_SESSION['webShortname']; //       .   -   . $ip = $_SERVER['REMOTE_ADDR']; // IP  .    . $host = ''; //    ,  IP .   . $url = $_SERVER['REQUEST_URI']; //  . $referer = urlencode($_SERVER['HTTP_REFERER']); //   ,   . $browser = mysql_real_escape_string($_SERVER['HTTP_USER_AGENT']); //  .    browscap,    .     . //    if (!in_array($ip, $not_log_ip) and !in_array($login, $not_log_login)) { $modx-&gt;db-&gt;query("INSERT INTO $db (`login`, `ip`, `host`, `url`, `referer`,`browser`) VALUES ('$login','$ip','$host', '$url','$referer','$browser')"); }</span></span></code> </pre><br>  Switch the <b>System events</b> tab and set <b>OnLogPageHit</b> , then click save.  <i>Please note: when creating a plugin in the admin editor there should not be &lt;? Php at the beginning and?&gt; At the end</i> .  Snippets should, but plug-ins should not.  I do not know why this is done, but when writing my first pagin, I used to swear a lot. <br>  Everything, the plugin should already record all your visitors.  If you, of course, were not mistaken anywhere! <br><br>  By the way, there is another option to hang the plug-in on the <b>OnWebPageComplete</b> event.  Then it will be necessary to enable ‚ÄúRegister visits‚Äù in the admin settings and it will work the same tyrchik in the properties of the documents.  Also not a bad option, but I have not yet run in it.  More information about the events <a href="http://wiki.modxcms.com/index.php/API:Template_Service_Events">can be found here</a> . <br><br>  If you want to find out the names of the hosts that are registered on your visitors' ip, you can make another snippet ( <b>Ip2Host</b> ) and run it on a schedule. <br>  Why is that?  This will save the server power, because if you recognize the user's host with each page request, the load will be serious.  It is better to run once a day, at night. <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $db = <span class="hljs-string"><span class="hljs-string">'`modx_visitors_log`'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   ,    host $sql = $modx-&gt;db-&gt;query("SELECT `ip` FROM $db WHERE `host` = '' GROUP BY `ip`"); $arr = $modx-&gt;db-&gt;makeArray($sql); //    foreach ($arr as $v) { $ip = $v['ip']; //   nslookup.     Windows, -,   ,  - -      - . $host = `nslookup "$ip" | grep 'name =' | awk '{print $4}'`; //      - ,    ,        . if (empty($host)) {$host = 'unknown';} //   . $modx-&gt;db-&gt;query("UPDATE $db SET `host` = '$host' WHERE `ip` = '$ip' AND `host` = '';"); } </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br>  You need to place a call on some hidden page from outsiders: <br> <code>[!Ip2Host!] <br></code> <br>  and pull it with a cron ªom: <br> <code>10 2 * * * * user wget localhost/secret_page.html <br></code> <br><br><h4>  Stage Two.  Log output to the screen. </h4><br>  In principle, your visits are already in the database, and you can get them from there as conveniently as possible.  Personally, I am pleased to observe this in the form of a nice chart and a separate plate with numbers. <br><br>  So do. <br><br>  We write a snippet to collect data from the database and output them to a clear table, the schedule will be done later.  Comments as usual, inside the code. <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($db)) {$db = <span class="hljs-string"><span class="hljs-string">'`modx_visitors_log`'</span></span>;} <span class="hljs-comment"><span class="hljs-comment">//     if (empty($days)) {$days = 14;} // -     if (empty($daysText)) {$daysText = '';} //   -   ,   if (empty($tpl)) {$tpl = 'visitStat.tpl';} //    if (empty($act)) {$act = 'graph';} //   ,   , graph &amp; table if (empty($dateFormat)) {$dateFormat = '%d.%m';} //  ,  strftime() if (empty($int)) {$int = 2;} //      graph.   -  . /*   */ // ,      $cur = time(); $end = date("Ymd"); $start = strftime("%Y-%m-%d", ($cur - ($days * 86400))); //  $sql = $modx-&gt;db-&gt;query("SELECT DATE(`datetime`) as `date`, COUNT(distinct `ip`) as `host`, COUNT(`ip`) as `hit` FROM $db WHERE DATE(`datetime`) BETWEEN '$start' AND '$end' GROUP BY DATE(`datetime`) ORDER BY `datetime` ASC"); $result = $modx-&gt;db-&gt;makeArray($sql); //    3  , ,    foreach($result as $v) { $date[] = $v['date']; $host[] = $v['host']; $hit[] = $v['hit']; } //   graph   $int ,    -   $i = 1; foreach ($date as $v) { if ($act == 'graph') { if ($i == $int) { $i = 0; $date2 .= '&lt;th&gt;&lt;/th&gt;'; } else { $date2 .= '&lt;th&gt;'.strftime($dateFormat, strtotime($v)).'&lt;/th&gt;'; } $i++; } else if ($act == 'table') { $date2 .= '&lt;th&gt;'.strftime($dateFormat, strtotime($v)).'&lt;/th&gt;'; } } foreach ($host as $v) { $host2 .= '&lt;td&gt;'.$v.'&lt;/td&gt;'; } foreach ($hit as $v) { $hit2 .= '&lt;td&gt;'.$v.'&lt;/td&gt;'; } $placeholders = array('[+stat.days+]','[+stat.days.text+]','[+stat.date+]','[+stat.host+]','[+stat.hit+]'); $values = array($days, $daysText, $date2, $host2, $hit2); $html = $modx-&gt;getChunk($tpl); echo str_replace($placeholders, $values, $html); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br>  Create a snippet, call it, for example, <b>generateStatGraph</b> , copy the code there and save. <br><br>  Now we need to somehow display the result of our turbulent activity. <br>  We need two chunk templates.  the first is just for the table, the second is more difficult for plotting.  They can be used independently of each other. <br><br>  The first template to display the table (tpl.StatTable). <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'margin: auto;text-align: center;'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'chart_table'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">caption</span></span></span><span class="hljs-tag">&gt;</span></span>     [+stat.days+] [+stat.days.text+]<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">caption</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">thead</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span>[+stat.date+]<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">thead</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>[+stat.host+]<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>[+stat.hit+]<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  The second template for plotting (tpl.StatGraph). <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'text/css'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'stylesheet'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'[(site_url)]inc/css/visualize.css'</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'text/javascript'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'[(site_url)]inc/js/visualize.jquery.js'</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'text/javascript'</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> $(</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">).ready(</span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>)</span></span></span><span class="javascript">{ $(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#chart'</span></span></span><span class="javascript">).visualize({ </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">type</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'area'</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">width</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'570'</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">height</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'300'</span></span></span><span class="javascript"> }); }); </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'margin: auto;'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'chart'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'display: none;'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">caption</span></span></span><span class="hljs-tag">&gt;</span></span>     [+stat.days+] [+stat.days.text+]<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">caption</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">thead</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span>[+stat.date+]<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">thead</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>[+stat.host+]<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>[+stat.hit+]<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  As you can see, these two templates are distinguished by the presence in the second connection of a wonderful jquery <a href="http://www.filamentgroup.com/lab/update_to_jquery_visualize_accessible_charts_with_html5_from_designing_with/">jQuery Visualize</a> plugin, which allows us to build graphs from tables.  As well as the design of this schedule. <br>  Graph rendering is started with the following code (for more details on jquery.visualize parameters, as well as design examples, click the link above): <br><pre> <code class="html hljs xml">$(document).ready(function(){ $('#chart').visualize({ type: 'area', width: '570', height: '300' }); });</code> </pre><br>  Ufff ... Already almost everything. <br><br><h4>  Stage 3. Start! </h4><br>  Create a new modx document and run a snippet in it (separate table and chart). <br><pre> <code class="html hljs xml">[!generateStatGraph? &amp;days=`20` &amp;tpl=`tpl.StatTable` &amp;act=`table` &amp;dateFormat=`%d <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">i</span></span></span><span class="hljs-tag">&gt;</span></span>%b<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">i</span></span></span><span class="hljs-tag">&gt;</span></span>` !] [!generateStatGraph? &amp;days=`20` &amp;daysText=`` &amp;tpl=`tpl.StatGraph` &amp;act=`graph` &amp;dateFormat=`%d` !]</code> </pre><br><br>  <i>I would like to note that here we considered only the display of anonymous statistics of visits, and in the database we have information about ip, time of visits, user browsers, and so on.</i>  <i>You can view this information either directly from the database, or write a simple snippet + design chunk for output to the site, to a protected section.</i> <br><br><h4>  Application. </h4><br>  To whom it is curious - it is possible to <a href="http://old.webstartpage.ru/stat.html">look at result in work</a> , at the same time personally check out habraeffekt. <br>  By the way, one can see the non-acidic difference in statistics that I collect, and which is shown by liveinternet on the counter at the bottom of each page. <br><br>  Parameters for generateStatGraph snippet: <br>  &amp; db <br> <code> : `modx_visitors_log` <br> : [string] <br> :   ,     (`modx`.`modx_log`).</code> <br>  &amp; dateFormat <br> <code> : '%d %b %Y %H:%M' <br> :  strftime() <br> :  .</code> <br>  &amp; days <br> <code> : 14 <br> : [int] <br> :      .</code> <br>  &amp; $ daysText <br> <code> : '' <br> : [string] <br> :    -  ,  ,    .</code> <br>  &amp; tpl <br> <code> : 'tpl.StatGraph' <br> :    modx <br> :    .</code> <br>  &amp; act <br> <code> : 'graph' <br> : graph, table <br> :     . graph  .</code> <br>  &amp; int <br> <code> : 2 <br> : [int] <br> :  &amp;act=`graph`, &amp;int ,    .   -  .</code> <br> <br>  Snippet placeCollers eventsCalendar: <br>  [+ stat.days +] <br> <code>  </code> <br>  [+ stat.days.text +] <br> <code>  .</code> <br>  [+ stat.date +] <br> <code>   .</code> <br>  [+ stat.host +] <br> <code>     ().</code> <br>  [+ stat.hit +] <br> <code>      ().</code> <br> <br><br>  References to the necessary sites. <br><ul><li>  <a href="http://www.jquery.com/">jQuery</a> </li><li>  <a href="http://www.filamentgroup.com/lab/update_to_jquery_visualize_accessible_charts_with_html5_from_designing_with">jQuery visualize</a> </li></ul><br><br>  Send bugreports to bezumkin@yandex.ru, or leave them in this thread. </div><p>Source: <a href="https://habr.com/ru/post/111203/">https://habr.com/ru/post/111203/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../111197/index.html">How to please the bride programmer</a></li>
<li><a href="../111199/index.html">About hatred for C ++</a></li>
<li><a href="../111200/index.html">VLC based video player. Part 1</a></li>
<li><a href="../111201/index.html">Google Chrome Voice Search</a></li>
<li><a href="../111202/index.html">PHP and Dropbox. Remote storage of user files</a></li>
<li><a href="../111204/index.html">Using HDAPS in ThinkPad Linux Laptops when needed</a></li>
<li><a href="../111205/index.html">Drupal module for working with Yandex.Mail</a></li>
<li><a href="../111207/index.html">Track Changes in SQL Server 2008</a></li>
<li><a href="../111208/index.html">Review of an inexpensive dual-core netbook, Packard Bell DOT SE W-301RU</a></li>
<li><a href="../111210/index.html">Some ideas of writing an artificial intellect for chess</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>