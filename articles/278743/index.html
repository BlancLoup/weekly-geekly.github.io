<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>django-controlcenter</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello everyone, I want to share my small development - django-controlcenter . This is an application for creating dashboards for your django project. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>django-controlcenter</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/111/ba0/3a0/111ba03a0ef340589937512b6292bd1c.png" alt="django-controlcenter"><br><br>  Hello everyone, I want to share my small development - <a href="https://github.com/byashimov/django-controlcenter">django-controlcenter</a> .  This is an application for creating dashboards for your django project. <br><a name="habracut"></a><br><h2>  purpose </h2><br>  <a href="https://docs.djangoproject.com/en/1.9/ref/contrib/admin/">Django-admin</a> is a great example of <a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> and an incredibly useful application.  You connect the model, and then see the plate with all the records in the database.  Then make the second, and then the third and so on.  Over time, you have a lot of such plates: with orders, comments, requests, reviews - and you start running back and forth between all of them several times a day.  And sometimes you want all sorts of graphs. <br><br>  <a href="https://github.com/byashimov/django-controlcenter">Django-controlcenter</a> appeared just because of a similar situation, when it was required to regularly check several models for new records and ignore them, or change, or delete, and see the dynamics in the graphs. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Disclaimer </h3><br>  The current version does not use ajax, and in fact it is not even <a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> , it is only <em>Read</em> , but with advanced features. <br><br><h2>  Simple example </h2><br>  Let's start with a small example: <br><br><pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># project/dashboard.py from controlcenter import Dashboard, widgets from project.app.models import Model class ModelItemList(widgets.ItemList): model = Model list_display = ['pk', 'field'] class MyDashboard(Dashboard): widgets = ( ModelItemList, ) # project/settings.py CONTROLCENTER_DASHBOARDS = [ 'project.dashboards.MyDashboard' ]</span></span></code> </pre> <br>  This widget will display a label in two columns with the last 10 values ‚Äã‚Äã(by default <code>ItemList</code> limited in output so as not to tear the page down to you). <br><br><img src="https://habrastorage.org/files/eb8/0de/c2f/eb80dec2fa324f3bb807471a2d5ad03d.png" alt="itemlist"><br><br>  I used familiar terms;  In general, a widget is a mixture of <a href="http/views/">Views</a> and <a href="https://docs.djangoproject.com/en/1.9/ref/contrib/admin/">ModelAdmin</a> in terms of naming methods and attributes, and their behavior. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ModelItemList</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(widgets.ItemList)</span></span></span><span class="hljs-class">:</span></span> model = Model queryset = model.active_objects.all() list_display = (<span class="hljs-string"><span class="hljs-string">'pk'</span></span>, <span class="hljs-string"><span class="hljs-string">'field'</span></span>, <span class="hljs-string"><span class="hljs-string">'get_foo'</span></span>) list_display_links = (<span class="hljs-string"><span class="hljs-string">'field'</span></span>, <span class="hljs-string"><span class="hljs-string">'get_foo'</span></span>) template_name = <span class="hljs-string"><span class="hljs-string">'my_custom_template.html'</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'foo'</span></span> get_foo.allow_tags = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> get_foo.short_description = <span class="hljs-string"><span class="hljs-string">'Foo!'</span></span></code> </pre> <br>  As you can see, nothing new.  <em>Yet</em> . <br><br><h2>  Disclaimer </h2><br>  Then the documentation will go essentially, so if you prefer to sort out the examples, go straight to them. <br><br><h2>  Widgets </h2><br>  There are only three main widgets: <code>Widget</code> , <code>ItemList</code> and <code>Chart</code> .  There is also a <code>Group</code> , but this is not a widget, but a wrapper.  Let's start with it. <br><br><h3>  Group </h3><br>  Widgets can be assembled into groups, then they will be switched by clicking on the title.  For grouping, widgets are indicated by a list / card or a special wrapper is used - <code>Group</code> . <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyDashboard</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Dashboard)</span></span></span><span class="hljs-class">:</span></span> widgets = ( Foo, (Bar, Baz), Group((Egg, Spam), width=widgets.LARGE, height=<span class="hljs-number"><span class="hljs-number">300</span></span>, attrs={<span class="hljs-string"><span class="hljs-string">'class'</span></span>: <span class="hljs-string"><span class="hljs-string">'my_class'</span></span>, <span class="hljs-string"><span class="hljs-string">'data-foo'</span></span>: <span class="hljs-string"><span class="hljs-string">'foo'</span></span>}), )</code> </pre> <br>  <code>Group</code> takes three optional arguments: <code>width</code> , <code>height</code> , <code>attrs</code> . <br>  Important point: such a "composite" widget gets the height of the "highest" in the group, because the design is adaptive and uses <a href="http://masonry.desandro.com/">Masonry</a> - if you do not fix the dimensions of the block, there is a chance to get a funny effect when switching between the widgets of the group, you will have to rebuild the whole board. <br><br><h4>  Group.width </h4><br>  The dashboard grid is adaptive: up to <code>768px</code> widgets occupy the entire width, then <code>50%</code> or <code>100%</code> .  From <code>1000px</code> used 6-column grid.  For convenience, the values ‚Äã‚Äãare stored in the <code>widgets</code> module: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># controlcenter/widgets.py MEDIUM = 2 # 33%  [x] + [x] + [x] LARGE = 3 # 50%  [ x ] + [ x ] LARGER = 4 # 66%  [ x ] + [x] LARGEST = 6 # 100%  [ x ]</span></span></code> </pre> <br>  Intermediate values ‚Äã‚Äãare not particularly useful, but nobody prohibits their use. <br><br><h4>  Group.height </h4><br>  Initially <code>None</code> , but having received an integer, set this value to the widget as <code>max-height</code> and an optional scroll appears. <br>  Widgets also have a <code>width</code> and <code>height</code> , in case these values ‚Äã‚Äãare not specified in the <code>Group</code> , the maximum value is taken from the widgets in this group. <br><br><h4>  Group.attrs </h4><br>  Anything you want to write in the widget as an <code>html</code> attribute.  You can even set the <code>id</code> . <br><br><h3>  Widget </h3><br>  Basic widget.  Virtually nothing can.  But it has one utility: at the time of creation, it wraps the <code>values</code> method (and <code>series</code> , <code>labels</code> , <code>legend</code> for charts) in the <a href="https://docs.djangoproject.com/en/1.9/ref/utils/">cached_property</a> descriptor.  Accordingly, values ‚Äã‚Äãare available as when accessing an attribute (without calling), and data is cached.  This is just a small convenience, as you often need to refer to these methods.  For example, the following is done for charts: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">labels</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [x <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x, y <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.values] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">series</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [y <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x, y <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.values] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">values</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.get_queryset().values_list(<span class="hljs-string"><span class="hljs-string">'label'</span></span>, <span class="hljs-string"><span class="hljs-string">'series'</span></span>)</code> </pre> <br>  A dozen times this will be asked in the templates, so it is better to cache everything at once. <br><br><h4>  Widget.title </h4><br>  The title of the widget.  If not specified, formed from the class name. <br><br><h4>  Widget.width and Widget.height </h4><br>  The behavior is similar to the <code>Group</code> (see above). <br><br><h4>  Widget.model </h4><br>  Accepts <a href="https://docs.djangoproject.com/en/1.9/topics/db/models/">django.db.models.Model</a> . <br><br><h4>  Widget.get_queryset </h4><br>  Behavior is similar to <a href="http/views/">django.generic.views</a> : <br><br><ul><li>  if there is a <code>queryset</code> , it will return. </li><li>  if there is a <code>model</code> , it will return its default manager. </li></ul><br><h4>  Widget.values ‚Äã‚Äãand Widget.limit_to </h4><br>  Calls <code>get_queryset</code> . <br>  Therefore, if you have data somewhere out there, rewrite this method and forget about <code>get_queryset</code> .  At least from the file read.  Also limits the queriset to <code>limit_to</code> if it is not <code>None</code> , like this: <code>self.get_queryset()[:self.limit_to]</code> . <br><br><h4>  Widget.template_name_prefix </h4><br>  Directory with templates. <br><br><h4>  Widget.template_name </h4><br>  Template name. <br><br><h4>  Widget.get_template_name </h4><br>  Returns <code>Widget.template_name_prefix</code> + <code>Widget.template_name</code> . <br><br><h3>  Itemlist </h3><br>  This is the most complex widget and at the same time the easiest.  Simple, because it chews everything that does not work: models, dictionaries, sheets, <a href="https://docs.python.org/2/library/collections.html">namedtuple</a> - everything that can be iterated or has access by key / attribute.  However, there are features. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ModelItemList</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(widgets.ItemList)</span></span></span><span class="hljs-class">:</span></span> model = Model queryset = model.objects.all() list_display = [<span class="hljs-string"><span class="hljs-string">'pk'</span></span>, <span class="hljs-string"><span class="hljs-string">'field'</span></span>]</code> </pre> <br><h4>  ItemList.list_display </h4><br>  During template rendering, values ‚Äã‚Äãfrom elements in <code>values</code> are taken from the keys of <code>list_display</code> (for models, dictionaries and namedtuple), for sequences the key index is equal to the value index, roughly speaking <code>zip(list_display, values)</code> . <br><br><h5>  Line numbering </h5><br>  Add <code>#</code> to <code>list_display</code> and get line numbering.  Also, the "grid" can be replaced with another symbol by setting it as a value in <code>settings.CONTROLCENTER_SHARP</code> . <br><br><h4>  ItemList.list_display_links </h4><br>  The behavior is similar to django's <a href="https://docs.djangoproject.com/en/1.9/ref/contrib/admin/">list_display_links</a> . <br><br><h4>  Link to edit object </h4><br>  <code>ItemList</code> tries to hang a link to the object editing page in the admin panel, for this it needs an object class and a primary key.  Therefore, the widget will search for this data everywhere: if <code>values</code> return the model instance, it will pull everything out of it.  If <code>values</code> returns a dictionary, a list or a <a href="https://docs.python.org/2/library/collections.html">namedtuple</a> , then you will need to specify <code>ItemList.model</code> , because, of course, no longer where.  In all cases, the widget will try to find <code>pk</code> or <code>id</code> its own, but in the case of sequences, this will not work, so the widget will look for these keys in <code>list_display</code> matching its index with the index of sequence values. <br>  By the way, the widget understands <code>deferred</code> models, so you can write like this: <code>queryset = Model.obejcts.defer('field')</code> . <br>  For this feature to work, the model must be registered with <a href="https://docs.djangoproject.com/en/1.9/ref/contrib/admin/">django-admin</a> . <br><br><h4>  Model changelist link </h4><br>  Sometimes it is not enough to look at the last 10 values ‚Äã‚Äãand you need to go to the model page.  <code>ModelAdmin</code> builds such paths on its own.  But in the widget you can substitute anything in the <code>queryset</code> , so you have to help.  There are several options: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ModelItemList</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(widgets.ItemList)</span></span></span><span class="hljs-class">:</span></span> model = Model <span class="hljs-comment"><span class="hljs-comment">#    changelist_url = model #   ,      changelist_url = model, {'status__exact': 0, 'o': '-7.-1'} #      changelist_url = model, 'status__exact=0&amp;o=-7.-1' #   changelist_url = '/admin/model/' changelist_url = 'http://www.yandex.ru'</span></span></code> </pre> <br>  For this feature to work, the model must be registered with <a href="https://docs.djangoproject.com/en/1.9/ref/contrib/admin/">django-admin</a> . <br><br><h4>  ItemList.sortable </h4><br>  In order to sort the label, it is enough to specify <code>sortable=True</code> , but remember that janga sorts in the database, and the widget on the client side, so incidents can occur, for example, if the dates in the column are in the <code>dd.mm</code> format.  The <a href="http://github.hubspot.com/sortable/docs/welcome/">sortable.js</a> library is <a href="http://github.hubspot.com/sortable/docs/welcome/">used</a> . <br><br><h4>  ItemList.method.allow_tags and ItemList.method.short_description </h4><br>  Behavior is similar to Jung's <a href="https://docs.djangoproject.com/en/1.9/ref/contrib/admin/">allow_tags</a> and <a href="https://docs.djangoproject.com/en/1.9/ref/contrib/admin/">short_description</a> . <br><br><h4>  ItemList.empty_message </h4><br>  Displays this value if <code>values</code> returns an empty list. <br><br><h4>  ItemList.limit_to </h4><br>  The default value is <code>10</code> , so you don't shoot yourself in the leg. <br><br><h3>  Chart </h3><br>  <a href="http://gionkunz.github.io/chartist-js/">Chartist</a> is used for <a href="http://gionkunz.github.io/chartist-js/">charts</a> - it is a small library ... with its own features.  It is very fast, just instant, I just could not pass by. <br><br>  There are three types of charts: <code>LINE</code> , <code>BAR</code> , <code>PIE</code> ;  and their respective classes: <code>LineChart</code> , <code>BarChart</code> , <code>PieChart</code> .  Plus a few extras, more on that later. <br><br>  <code>Chart</code> defines three additional methods: <code>legend</code> , <code>lables</code> , <code>series</code> , which are also cached.  All three methods must return a json-serializable object that does not include generators. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyChart</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(widgets.Chart)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">legend</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">labels</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">series</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> []</code> </pre> <br><h4>  Chart.legend </h4><br>  Out of the box, <a href="http://gionkunz.github.io/chartist-js/">Chartist</a> does not know how to show a legend, but without it there is no way, since the Chartist still does not draw the values ‚Äã‚Äãon the chart (yes, there is such a moment).  Legend will help in such cases. <br><br><h4>  Chart.labels </h4><br>  Values ‚Äã‚Äãon the <code>x</code> axis.  Should return a sequence, in no case do not pass the generator. <br><br><h4>  Chart.series </h4><br>  Values ‚Äã‚Äãon the <code>y</code> axis.  Must return a list of lists, since there may be multiple data in the graphs.  Again, no generators.  There is a small ‚ÄúGotcha‚Äù here, for the type <code>BAR</code> with one type of value, the ‚Äúflat‚Äù list is transferred, i.e.  not nested, this sets an additional option for the Chartist.  The easiest way to use <code>SingleBarChart</code> - everything is set up in it. <br><br><h4>  Chart.Chartist </h4><br>  <code>Chart</code> is a widget with an additional <code>Chartist</code> class inside in <code>Meta</code> or <code>Media</code> style in jang. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyChart</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Chart)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Chartist</span></span></span><span class="hljs-class">:</span></span> klass = widgets.LINE point_lables = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> options = { <span class="hljs-string"><span class="hljs-string">'reverseData'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">'axisY'</span></span>: { <span class="hljs-string"><span class="hljs-string">'onlyInteger'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, }, <span class="hljs-string"><span class="hljs-string">'fullWidth'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, }</code> </pre> <br>  The only difference is that when using <code>Chartist</code> not necessary to inherit the parent class, i.e.  this is not the classic python inheritance: you write <code>class Chartist:</code> not <code>class Chartist(Parent.Chartist):</code> - fields are inherited automatically.  In the inheriting class, all fields are rewritten, except <code>options</code> , which is glued to the parent, i.e.  in the child class, you can write only new key / value pairs, not <code>Parent.Chartist.options.copy().update({'foo': 'bar'})</code> .  Of course, this method has a downside: the default values, if necessary, will have to be rewritten. <br><br>  Important!  <code>LineChart</code> set to <code>'reverseData': True</code> , which reverses the values ‚Äã‚Äãof <code>labels</code> and <code>series</code> on the client.  Most often, this type of charts is used to display the latest data, and so that you do not have to do it manually in every first chart, this option is enabled by default. <br><br><h5>  Chart.Chartist.klass </h5><br>  Specifies the type of charts: <code>widgets.LINE</code> , <code>widgets.BAR</code> , <code>widgets.PIE</code> . <br><br><h5>  Chart.Chartist.point_lables </h5><br>  The plug-in is connected to the <code>Chartist</code> , which <code>Chartist</code> the values ‚Äã‚Äãon the chart.  This is strange, but the default Chartist does without values ‚Äã‚Äãon the chart itself.  Unfortunately, this thing only works with <code>widgets.LINE</code> .  In other cases, the <code>legend</code> method will help. <br><br><h5>  Chart.Chartist.options </h5><br>  The dictionary, which is sent entirely to Json and is transmitted to the Chartist structure.  All options are described <a href="http://gionkunz.github.io/chartist-js/">on the site</a> . <br><br><h4>  Additional classes </h4><br>  In the <code>widgets</code> module, several more auxiliary classes are <code>SingleLineChart</code> : <code>SingleLineChart</code> , <code>SingleBarChart</code> , <code>SinglePieChart</code> - for simple use cases. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BlogsChart</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(widgets.SingleBarChart)</span></span></span><span class="hljs-class">:</span></span> model = Blog values_list = (<span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-string"><span class="hljs-string">'score'</span></span>)</code> </pre> <br>  Well, sobsno, and all.  The <code>name</code> values ‚Äã‚Äãwill go to the <code>x</code> axis, and the <code>score</code> to the <code>y</code> axis. <br><br><h2>  Dashboard </h2><br>  The application supports up to 10 "panels", which are available at: <code>/admin/dashboards/[pk]/</code> - where <code>pk</code> index in the list of <code>settings.CONTROLCENTER_DASHBOARDS</code> . <br><br><h3>  Dashboard.widgets </h3><br>  Accepts a list of widgets. <br><br><h3>  Dashboard.title </h3><br>  Arbitrary title  If not specified, it will be formed from the class name. <br><br><h3>  Dashboard.Media </h3><br>  <a href="https://docs.djangoproject.com/en/1.9/topics/forms/media/">Media</a> class from jungle. <br><br><h2>  Settings </h2><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#   CONTROLCENTER_DASHBOARDS = [] #      `ItemList` CONTROLCENTER_SHARP = '#' #   .    `Chartist`, #        `Material Design`, #  `material`. CONTROLCENTER_CHARTIST_COLORS = 'default'</span></span></code> </pre> <br><h2>  Examples! </h2><br>  Let's do the same thing as in the screenshot. <br>  Create a project, call it <code>pizzeria</code> , add the <code>pizza</code> application to it. <br><br><h3>  pizzeria.pizza.models </h3><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> __future__ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> unicode_literals <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.db <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> models <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Pizza</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(models.Model)</span></span></span><span class="hljs-class">:</span></span> name = models.CharField(max_length=<span class="hljs-number"><span class="hljs-number">100</span></span>, unique=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__str__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.name <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Restaurant</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(models.Model)</span></span></span><span class="hljs-class">:</span></span> name = models.CharField(max_length=<span class="hljs-number"><span class="hljs-number">100</span></span>, unique=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) menu = models.ManyToManyField(Pizza, related_name=<span class="hljs-string"><span class="hljs-string">'restaurants'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__str__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.name <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Order</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(models.Model)</span></span></span><span class="hljs-class">:</span></span> created = models.DateTimeField(auto_now_add=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) restaurant = models.ForeignKey(Restaurant, related_name=<span class="hljs-string"><span class="hljs-string">'orders'</span></span>) pizza = models.ForeignKey(Pizza, related_name=<span class="hljs-string"><span class="hljs-string">'orders'</span></span>)</code> </pre> <br><h3>  Installation </h3><br><pre> <code class="bash hljs">pip install django-controlcenter</code> </pre> <br>  <code>pizzeria.settings</code> applications to <code>pizzeria.settings</code> <br><br><pre> <code class="python hljs">INSTALLED_APPS = ( ... <span class="hljs-string"><span class="hljs-string">'controlcenter'</span></span>, <span class="hljs-string"><span class="hljs-string">'pizza'</span></span>, ) <span class="hljs-comment"><span class="hljs-comment">#   CONTROLCENTER_DASHBOARDS = ( 'pizzeria.dashboards.MyDashboard' )</span></span></code> </pre> <br>  Add <code>pizzeria.urls</code> to <code>pizzeria.urls</code> <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.conf.urls <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> url <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.contrib <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> admin <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> controlcenter.views <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> controlcenter urlpatterns = [ url(<span class="hljs-string"><span class="hljs-string">r'^admin/'</span></span>, admin.site.urls), url(<span class="hljs-string"><span class="hljs-string">r'^admin/dashboard/'</span></span>, controlcenter.urls), ]</code> </pre> <br><h3>  Widgets </h3><br>  In the <code>pizzeria.dashboards</code> file <code>pizzeria.dashboards</code> create widgets: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> datetime <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> collections <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> defaultdict <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> controlcenter <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> app_settings, Dashboard, widgets <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> controlcenter.widgets.core <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> WidgetMeta <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.db.models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Count <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.utils <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> timezone <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.utils.timesince <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> timesince <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> .pizza.models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Order, Pizza, Restaurant <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MenuWidget</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(widgets.ItemList)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#     ,   #    .     #  ,      . model = Pizza list_display = ['name', 'ocount'] list_display_links = ['name'] # -,  ItemList  , #          . limit_to = None #     300,   height = 300 def get_queryset(self): #         restaurant = super(MenuWidget, self).get_queryset().get() today = timezone.now().date() return (restaurant.menu .filter(orders__created__gte=today) .order_by('-ocount') .annotate(ocount=Count('orders'))) class LatestOrdersWidget(widgets.ItemList): #    20  #    model = Order queryset = (model.objects .select_related('pizza') .filter(created__gte=timezone.now().date()) .order_by('pk')) #  `#`    list_display = [app_settings.SHARP, 'pk', 'pizza', 'ago'] list_display_links = ['pk'] #        sortable = True #   20 limit_to = 20 #     height = 300 #   def ago(self, obj): return timesince(obj.created) RESTAURANTS = [ 'Mama', 'Ciao', 'Sicilia', ] #  -,   . # , ,       . # ,    : #  ,  ,  menu_widgets = [WidgetMeta('{}MenuWidget'.format(name), (MenuWidget,), {'queryset': Restaurant.objects.filter(name=name), #   'title': name + ' menu', #   `changelist`   GET  'changelist_url': ( Pizza, {'restaurants__name__exact': name})}) for name in RESTAURANTS] latest_orders_widget = [WidgetMeta( '{}LatestOrders'.format(name), (LatestOrdersWidget,), {'queryset': (LatestOrdersWidget .queryset .filter(restaurant__name=name)), 'title': name + ' orders', 'changelist_url': ( Order, {'restaurant__name__exact': name})}) for name in RESTAURANTS] class RestaurantSingleBarChart(widgets.SingleBarChart): #  -    title = 'Most popular restaurant' model = Restaurant class Chartist: options = { # -, Chartist   # float   ,     'onlyInteger': True, #    --  'chartPadding': { 'top': 24, 'right': 0, 'bottom': 0, 'left': 0, } } def legend(self): #      `y`, # , Chartist       return self.series def values(self): queryset = self.get_queryset() return (queryset.values_list('name') .annotate(baked=Count('orders')) .order_by('-baked')[:self.limit_to]) class PizzaSingleBarChart(RestaurantSingleBarChart): #   , , #     ,    model = Pizza limit_to = 3 title = 'Most popular pizza' class Chartist: #    klass = widgets.PIE class OrderLineChart(widgets.LineChart): #      #   7  title = 'Orders this week' model = Order limit_to = 7 #    width = widgets.LARGER class Chartist: #   --  options = { 'axisX': { 'labelOffset': { 'x': -24, 'y': 0 }, }, 'chartPadding': { 'top': 24, 'right': 24, } } def legend(self): #      return RESTAURANTS def labels(self): #   `x`  today = timezone.now().date() labels = [(today - datetime.timedelta(days=x)).strftime('%d.%m') for x in range(self.limit_to)] return labels def series(self): #     `labels`,    ,    #   , ,  -   #       series = [] for restaurant in self.legend: #   ,     #   ,    0 item = self.values.get(restaurant, {}) series.append([item.get(label, 0) for label in self.labels]) return series def values(self): #      limit_to = self.limit_to * len(self.legend) queryset = self.get_queryset() #       `GROUP BY`   : #    . # Order.created  datetime,     , #   `DATE` (sqlite3)  . #  , ORM   ,   #       queryset = (queryset.extra({'baked': 'DATE(created)'}) .select_related('restaurant') .values_list('restaurant__name', 'baked') .order_by('-baked') .annotate(ocount=Count('pk'))[:limit_to]) #  -- ,  --  :_ values = defaultdict(dict) for restaurant, date, count in queryset: # DATE  Sqlite3   YYYY-MM-DD #       DD-MM day_month = '{2}.{1}'.format(*date.split('-')) values[restaurant][day_month] = count return values</span></span></code> </pre> <br><h3>  Dashbarda </h3><br>  <a href="https://github.com/byashimov/django-controlcenter">django-controlcenter</a> supports up to 10 lowboards.  But we will create one in <code>pizzeria.dashboards</code> <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleDashboard</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Dashboard)</span></span></span><span class="hljs-class">:</span></span> widgets = ( menu_widgets, latest_orders_widget, RestaurantSingleBarChart, PizzaSingleBarChart, OrderLineChart, )</code> </pre> <br>  That's it, open <code>/admin/dashboard/0/</code> . <br><br><h2>  Compatibility </h2><br>  Tests were conducted on python 2.7.9, 3.4.3, 3.5.0 and django 1.8, 1.9. <br><br><pre> <code class="hljs markdown">Name Stmts Miss Cover ---------------------------------------------------------------------- controlcenter/<span class="hljs-strong"><span class="hljs-strong">__init__</span></span>.py 1 0 100% controlcenter/app<span class="hljs-emphasis"><span class="hljs-emphasis">_settings.py 27 0 100% controlcenter/base.py 10 0 100% controlcenter/dashboards.py 27 0 100% controlcenter/templatetags/_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_init_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_.py 0 0 100% controlcenter/templatetags/controlcenter_</span></span>tags.py 109 0 100% controlcenter/utils.py 16 0 100% controlcenter/views.py 39 0 100% controlcenter/widgets/<span class="hljs-strong"><span class="hljs-strong">__init__</span></span>.py 2 0 100% controlcenter/widgets/charts.py 67 0 100% controlcenter/widgets/core.py 93 0 100% ---------------------------------------------------------------------- TOTAL 391 0 100% <span class="hljs-strong"><span class="hljs-strong">_____</span></span><span class="hljs-strong"><span class="hljs-strong">_____</span></span><span class="hljs-strong"><span class="hljs-strong">_____</span></span><span class="hljs-strong"><span class="hljs-strong">_____</span></span><span class="hljs-strong"><span class="hljs-strong">_____</span></span><span class="hljs-strong"><span class="hljs-strong">_____</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_ summary _</span></span><span class="hljs-strong"><span class="hljs-strong">_____</span></span><span class="hljs-strong"><span class="hljs-strong">_____</span></span><span class="hljs-strong"><span class="hljs-strong">_____</span></span><span class="hljs-strong"><span class="hljs-strong">_____</span></span><span class="hljs-strong"><span class="hljs-strong">_____</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">___</span></span>_ py27-django18: commands succeeded py27-django19: commands succeeded py34-django18: commands succeeded py34-django19: commands succeeded py35-django18: commands succeeded py35-django19: commands succeeded</code> </pre> <br>  The same application is great friends with <a href="https://github.com/sehmaschine/django-grappelli">django-grappelli</a> . <br><br><h2>  Documentation </h2><br>  This article can be considered as such, I will complete the translation into clumsy English in the near future, as soon as I deal with sphinx. <br><br>  PS I decided to do OSP for the first time and, I must admit, I spent more time on the proceedings with the distribution than on the code itself, and nevertheless I am not completely sure that I did everything correctly, so I would appreciate any feedback. <br><br>  PPS Thanks to the designers of Habr for the fact that the headings can not be distinguished from the text, and the inline code does not stand out.  I will try to write the docks as quickly as possible, because the article cannot be read. <br></div><p>Source: <a href="https://habr.com/ru/post/278743/">https://habr.com/ru/post/278743/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../278729/index.html">Kibana-mother or Why do you need logs at all?</a></li>
<li><a href="../278731/index.html">Choosing a library to work with WebGL</a></li>
<li><a href="../278735/index.html">Ruby on Rails. Passenger quickstart</a></li>
<li><a href="../278737/index.html">The story about cunning ... Indian, encrypted procedures, DAC and "God mode"</a></li>
<li><a href="../278741/index.html">Gorgeous Six: girls who had a thermonuclear blast counted</a></li>
<li><a href="../278745/index.html">FLIF - free image compression format</a></li>
<li><a href="../278747/index.html">Sublime Text: syntax validation, autocompletion (v.1.1)</a></li>
<li><a href="../278749/index.html">Extortionist KeRanger for OS X: our analysis</a></li>
<li><a href="../278751/index.html">Work with private repositories and other updates of the FlyElephant platform</a></li>
<li><a href="../278755/index.html">Asynchronous parallel execution in PHP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>