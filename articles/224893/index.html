<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Geodesy: on the field on the "python"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good time, Habr! 
 A bit of history: in the course of studying programming, I was looking for a real task for myself, but one that would be useful. Fo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Geodesy: on the field on the "python"</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/543/cf9/421/543cf9421fe824832409148ae3fc5fe4.png" alt="image"><br><br>  Good time, Habr! <br>  A bit of history: in the course of studying programming, I was looking for a real task for myself, but one that would be useful.  Found.  Saw as a familiar surveyor, at work, considers the volume of land.  Very long and tedious ... <br><br>  Geodetic calculation of volumes: <br>  The construction of residential buildings, high-tech premises, roads and railways, as well as in order to determine the volume of building materials and calculate the volume of excavation work, requires the assistance of surveyors.  They ‚Äúshoot‚Äù the territory, breaking the entire area into a so-called <a href="http://ru.wikipedia.org/wiki/%25D0%2593%25D0%25B5%25D0%25BE%25D1%2581%25D0%25B5%25D1%2582%25D0%25BA%25D0%25B0">geogrid</a> , then the points from the device are unloaded into autoCAD and calculate the volume of the entire territory.  Below is an example of a <a href="http://ru.wikipedia.org/wiki/%25D0%2593%25D0%25B5%25D0%25BE%25D1%2581%25D0%25B5%25D1%2582%25D0%25BA%25D0%25B0">geogrid</a> : 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/ca4/646/69a/ca464669af483644d5c364a4122d863c.png" alt="image"><br><a name="habracut"></a><br>  Each point has its coordinates (x, y, z-height) relative to the Baltic Sea.  Four points are taken in order as shown in the previous image and the volume of the ground is calculated from the coordinates of these points, this is how all the volumes obtained on the grid are calculated, plus, and as a result we have the volume of the whole territory. <br><br>  The work is very painstaking, and since I already wrote, I wanted to take on a real project, in exchange for experience.  Therefore, I didn‚Äôt even consider the option that everything has been before me for a long time. <br><br>  A few days I was confused on the algorithm for finding neighbors, as a result, it was not exactly what I was waiting for, the algorithm worked as I wanted due to the fact that the grid was not even as in theory, but the curve as a surveyor‚Äôs assistant walked around the field and made marks, then I realized that AutoCAD very simply sorts by point creation time.  Then, having turned on AutoCAD a bit, I noticed an interesting order of uploading points to an XML file, and found the possibility of assigning each point ID, now we assigned each point a name from the left corner to the right edge and also being understood in the series above, we called all points (this is where it is faster than two days to count the volume of an area of ‚Äã‚Äã500x700 meters).  Below is an example of such a finished file with points named in order: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/711/7ef/c2e/7117efc2e061a923387fa0acec057d3e.png" alt="image"><br><br>  In theory, volumes are counted according to Pythagoras, but the figures are completely different and, as practice shows, squares and rectangles are very rare.  Therefore, I resorted to the formula of Gerona in my calculations.  That is, the principle of software that I wrote is: I read an XML file, collect points, then an array with arrays of four squares, get all the figures that need to calculate the volume, now I check the sides of the figures (vector) and the corners of the rectangle and square before calculating the volume (a great rarity, in the case of our geodesist in particular, that there will be any, and if there is, then I use Pythagoras) and I just take figures like trapezoid, parallelepiped and others for the unknown four gon and consider them according to Heron‚Äôs formula, I divide the diagonally figure by two tracks  olnika think of their area in the space (consider the height), height, whichever is the highest of the 4 points (as explained to me by my colleague surveyor) and plyusuya area of ‚Äã‚Äãthe two triangles below I based on the total area of ‚Äã‚Äãthe figure get its volume. <br><br>  Plus, all these volumes and I get in 0.2 seconds the result to which it takes a couple of days, checked on three projects until the data converges, the program turns out even more accurate volume.  We continue to test it.  Now the other day I decided to tie this code to the user-friendly interface, with PyQt4, my first experience with writing graphics, below I will publish code that applies only to the GUI. <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> PyQt4 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> QtGui <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cvgLeicaXmlReader <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cvgMath <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">myWindow</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(QtGui.QMainWindow)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, parent=None)</span></span></span><span class="hljs-function">:</span></span> QtGui.QWidget.__init__(self, parent) self.setWindowTitle(<span class="hljs-string"><span class="hljs-string">'CVG2014'</span></span>) self.setFixedSize(<span class="hljs-number"><span class="hljs-number">350</span></span>, <span class="hljs-number"><span class="hljs-number">350</span></span>) self.setWindowIcon(QtGui.QIcon(<span class="hljs-string"><span class="hljs-string">'static/Icon.png'</span></span>)) self.setStyleSheet(<span class="hljs-string"><span class="hljs-string">"QMainWindow {background-image: url(static/background.png);}"</span></span>) self.directory = <span class="hljs-string"><span class="hljs-string">''</span></span> self.file = <span class="hljs-string"><span class="hljs-string">''</span></span> self.labelFilename = QtGui.QLabel(<span class="hljs-string"><span class="hljs-string">'Select .XML file with points'</span></span>, self) self.labelFilename.setFixedWidth(<span class="hljs-number"><span class="hljs-number">300</span></span>) self.labelFilename.setFixedHeight(<span class="hljs-number"><span class="hljs-number">25</span></span>) self.labelFilename.move(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>) self.labelFilename.setStyleSheet(<span class="hljs-string"><span class="hljs-string">"QLabel { background-color: white; \ border: 1px solid grey; \ color: grey;}"</span></span>) self.SB_WidthOfXAxis = QtGui.QSpinBox(self) self.SB_WidthOfXAxis.move(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">35</span></span>) self.SB_WidthOfXAxis.setFixedWidth(<span class="hljs-number"><span class="hljs-number">50</span></span>) self.SB_WidthOfXAxis.setMaximum(<span class="hljs-number"><span class="hljs-number">9999</span></span>) self.labelPointsWidth = QtGui.QLabel(<span class="hljs-string"><span class="hljs-string">'Length of points on X axis'</span></span>, self) self.labelPointsWidth.setFixedWidth(<span class="hljs-number"><span class="hljs-number">250</span></span>) self.labelPointsWidth.setFixedHeight(<span class="hljs-number"><span class="hljs-number">25</span></span>) self.labelPointsWidth.move(<span class="hljs-number"><span class="hljs-number">65</span></span>, <span class="hljs-number"><span class="hljs-number">47.5</span></span>) self.SB_HeightAboveSeaLevel = QtGui.QDoubleSpinBox(self) self.SB_HeightAboveSeaLevel.move(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">75</span></span>) self.SB_HeightAboveSeaLevel.setFixedWidth(<span class="hljs-number"><span class="hljs-number">50</span></span>) self.SB_HeightAboveSeaLevel.setRange(<span class="hljs-number"><span class="hljs-number">-9999.99</span></span>, <span class="hljs-number"><span class="hljs-number">9999.99</span></span>) self.labelPointsSeaLevel = QtGui.QLabel(<span class="hljs-string"><span class="hljs-string">'Height above sea level'</span></span>, self) self.labelPointsSeaLevel.setFixedWidth(<span class="hljs-number"><span class="hljs-number">250</span></span>) self.labelPointsSeaLevel.setFixedHeight(<span class="hljs-number"><span class="hljs-number">25</span></span>) self.labelPointsSeaLevel.move(<span class="hljs-number"><span class="hljs-number">65</span></span>, <span class="hljs-number"><span class="hljs-number">87</span></span>) self.buttonOpenFile = QtGui.QPushButton(<span class="hljs-string"><span class="hljs-string">'...'</span></span>, self) self.buttonOpenFile.setFixedWidth(<span class="hljs-number"><span class="hljs-number">30</span></span>) self.buttonOpenFile.setFixedHeight(<span class="hljs-number"><span class="hljs-number">27</span></span>) self.buttonOpenFile.move(<span class="hljs-number"><span class="hljs-number">311</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>) self.buttonOpenFile.clicked.connect(self.getXmlFile) self.buttonGetVolume = QtGui.QPushButton(<span class="hljs-string"><span class="hljs-string">'RUN'</span></span>, self) self.buttonGetVolume.setFixedWidth(<span class="hljs-number"><span class="hljs-number">52</span></span>) self.buttonGetVolume.setFixedHeight(<span class="hljs-number"><span class="hljs-number">35</span></span>) self.buttonGetVolume.move(<span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">115</span></span>) self.buttonGetVolume.clicked.connect(self.getVolume) self.showVolume = QtGui.QLabel(<span class="hljs-string"><span class="hljs-string">'Get Vol'</span></span>, self) self.showVolume.setFixedWidth(<span class="hljs-number"><span class="hljs-number">140</span></span>) self.showVolume.setFixedHeight(<span class="hljs-number"><span class="hljs-number">32</span></span>) self.showVolume.move(<span class="hljs-number"><span class="hljs-number">72</span></span>, <span class="hljs-number"><span class="hljs-number">117</span></span>) self.showVolume.setStyleSheet(<span class="hljs-string"><span class="hljs-string">"QLabel { background-color: white; \ border: 1px solid grey; \ color: grey;}"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getVolume</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> xml_file = self.getFileName() points = cvgLeicaXmlReader.getPointsFromXmlFile(xml_file) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(xml_file <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> points): <span class="hljs-comment"><span class="hljs-comment"># length_of_points = len(points) QUANTITY_POINTS_AT_X_AXIS = self.SB_WidthOfXAxis.value() STATIC_HEIGHT = self.SB_HeightAboveSeaLevel.value() rows = cvgLeicaXmlReader.getRowsFromPoints(points, QUANTITY_POINTS_AT_X_AXIS) quads = cvgLeicaXmlReader.getAllQuads(rows) volumes = [] if (STATIC_HEIGHT or QUANTITY_POINTS_AT_X_AXIS) != 0: for quadrangle in quads: Quadrangle_type = cvgMath.getTypeQuadrangle(quadrangle) v = cvgMath.getVolumeQuadrangle(quadrangle, Quadrangle_type, STATIC_HEIGHT) volumes.append(v) else: volumes = 0 volumes = 0 if STATIC_HEIGHT == 0 else (round(sum(volumes), 3)) result = '-'+str(volumes) if STATIC_HEIGHT &lt; 0 else str(volumes) result = '0' if result == '-0' else result self.showVolume.setStyleSheet("QLabel { background-color: white; \ border: 1px solid grey; \ color: grey;}") self.showVolume.setText(result) else: self.showVolume.setText('Select the correct file!') self.showVolume.setStyleSheet("QLabel { background-color: white; \ border: 1px solid grey; \ color: red; \ font-weight: bold}") def getFileName(self): return self.file def getXmlFile(self): sender = self.sender() path = QtGui.QFileDialog.getOpenFileName(sender, 'Open Xml file with points', self.directory, 'XML *.xml') fileName = path[path.rfind('/')+1:] self.directory = path[:path.rfind('/')] if(len(path) &gt; 54): start = len(path)-54 pathSlice = path[start:] pathSlice = pathSlice[pathSlice.find('/'):] pathSlice = '..'+pathSlice else: pathSlice = path self.labelFilename.setText(pathSlice) print(len(path)) self.file = path if __name__ == '__main__': app = QtGui.QApplication(sys.argv) win = myWindow() win.show() app.exec_()</span></span></code> </pre> <br><br>  With other modules, anyone interested, can be found on the <a href="https://github.com/quas/CVG2014">githaba</a> <br>  I also downloaded a <a href="">.rar</a> archive with compiled code in exe for windows. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7dc/bbf/315/7dcbbf31534e9243d07f79b21b6f4fd4.png" alt="image"><br><br>  What is required of us: open an XML file with dots (two files for an example are also on a git (2 correct and one broken, for a test)), indicate the number of points along the field width, below indicate the height relative to sea level, and wait RUN button, we get the volume in the field to the right of the launch button. <br><br>  To be honest, I do not know whether it is possible to use this tool in production.  But I have satisfied my desire.  Thank you all for your attention. <br><br>  <a href="">File with 65 dots (13 dots width)</a> <br>  <a href="">File with 78 dots (13 dots width)</a> <br>  <a href="https://github.com/quas/CVG2014/blob/master/cvgLeicaXmlReader.py">XML file reader</a> <br>  <a href="https://github.com/quas/CVG2014/blob/master/cvgMath.py">Module with mathematical calculations</a> <br>  <a href="">Visual module</a> <br>  <a href="">Archive with compiled code in Exe</a> </div><p>Source: <a href="https://habr.com/ru/post/224893/">https://habr.com/ru/post/224893/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../224881/index.html">Case for increasing online store conversion by 14% with product reviews</a></li>
<li><a href="../224883/index.html">Kerio Control for Windows to Kerio Control Appliance Migration Guide</a></li>
<li><a href="../224889/index.html">Google maps clustering</a></li>
<li><a href="../22489/index.html">Flowplayer - Open source Flash player</a></li>
<li><a href="../224891/index.html">(May 25, Kiev) Fighters of the invisible front or the story of how to protect themselves from DDoS-attacks in a short time using Radware</a></li>
<li><a href="../224895/index.html">The main international standards and best practices for auditing information technology</a></li>
<li><a href="../224897/index.html">WebRTC or how I taught our CRM to call phones</a></li>
<li><a href="../2249/index.html">Microsoft introduces FrontPage replacement</a></li>
<li><a href="../224901/index.html">Automatic downloading of the list of prohibited sites from the Roskomnadzor service</a></li>
<li><a href="../224903/index.html">5 mistakes made when starting a startup</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>