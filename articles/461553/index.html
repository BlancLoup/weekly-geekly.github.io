<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Experience in automating regression visual testing in Java + Selenium Webdriver + aShot</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. 

 In this article, I would like to talk about my experience in automating visual regression testing. 

 Introduction 
 I decided to do automat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Experience in automating regression visual testing in Java + Selenium Webdriver + aShot</h1><div class="post__text post__text-html js-mediator-article">  Hello. <br><br>  In this article, I would like to talk about my experience in automating visual regression testing. <br><a name="habracut"></a><br><h2>  Introduction </h2><br>  I decided to do automation of visual testing after I accidentally discovered a small bug in the layout.  The project changed the design of one page, and the changes touched non-task pages. <br><br>  Having decided that manually checking the appearance of the site pages wasn‚Äôt an option, I took up automation. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We needed a simple solution with convenient reports.  To be able to write autotests without any restrictions, compare screenshots of pages and site elements and use different browsers. <br><br>  After a short search for a ready-made solution / framework, it was decided that it would be easier to write your own solution with the necessary functionality and format of reports.  Of the options I saw, only the Galen Framework seemed suitable, but I found it after I wrote my solution. <br><br>  After implementing and testing autotests, I decided to refine the tests a bit and create a separate project, so that I could use it later on other sites and projects. <br><br><h3>  about the project </h3><br>  <a href="https://github.com/predewill/VisualRegressionBoilerplate">VisualRegressionBoilerplate</a> is a relatively simple project with a specific structure. <br><br>  Something like a boilerplate template / project for visual autotests. <br><br>  The project is intended for small sites / projects.  For those who need a simple solution, without complex frameworks. <br><br><h3>  Opportunities </h3><br><ul><li>  Comparison of screenshots of site pages.  You can specify one or more ignored items. </li><li>  Comparison of screenshots of site elements. </li><li>  Tests can be run with different screen widths: <b>mobile</b> - 360px, <b>tablet</b> - 768px, <b>desktop</b> - 1920px </li><li>  By default, two browsers are available - <b>chrome</b> and <b>firefox</b> + the same browsers in <b>headless</b> mode. </li><li>  Report generator - 4 screenshots are created for each test - current, expected, difference, gif.  If there are no expected screenshots, actual screenshots will be saved as expected. </li></ul><br><img src="https://habrastorage.org/webt/4w/uz/x5/4wuzx5j7efs31fouutwixretvi0.png"><br><br><h3>  Used technologies </h3><br><ul><li>  Java </li><li>  Testng </li><li>  Maven </li><li>  Selenium webdriver </li><li>  aShot - a library for comparing images </li></ul><br><h3>  How to start working with a project </h3><br><ol><li>  Install java, maven, browsers. </li><li>  In the constructor of the <b>DriverWrapper</b> class, <b>you</b> can add or remove browsers if necessary </li><li>  The <b>TestConfig</b> class stores all project settings - browser, default browser window size, etc.  Here you can add or change settings. </li><li>  In the <b>BasePage</b> class, set the address of the tested site.  You can set a different address for different environments (dev, stage, prod).  <b>BasePage</b> and the rest of the classes in the <b>app</b> module are an example of the <b>page object</b> pattern.  Using it is optional. </li><li>  Examine the <b>TestExample</b> test class and create your own test classes as an example. </li><li>  Add new test classes to <b>testng.xml</b> </li><li>  Run tests with the necessary parameters through <b>maven</b> </li><li>  Check report in <b>report</b> folder </li></ol><br>  In the <b>README</b> project, everything is described in more detail. <br><br><h3>  How to write tests </h3><br>  In general, as you like.  There are no restrictions.  You can use the <b>page object</b> pattern or something else. <br><br>  All you need is to use the following functions to compare screenshots: <br><br>  <b>For pages:</b> <br><br>  Comparison of page screenshots: <br><br><pre><code class="java hljs">comparePageScreenshots(<span class="hljs-string"><span class="hljs-string">"index_page"</span></span>);</code> </pre> <br>  Comparison of page screenshots with ignoring one element: <br><br><pre> <code class="java hljs">comparePageScreenshots(<span class="hljs-string"><span class="hljs-string">"index_page_ignored_element"</span></span>, IndexPage.MACKBOOK_BLOCK);</code> </pre> <br>  Comparison of page screenshots with ignoring several elements: <br><br><pre> <code class="java hljs"> comparePageScreenshots(<span class="hljs-string"><span class="hljs-string">"index_page_ignored_element"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[]{<span class="hljs-string"><span class="hljs-string">"section.panel.features.dark"</span></span>, <span class="hljs-string"><span class="hljs-string">"div.macbook"</span></span>});</code> </pre> <br>  Comparison of page element screenshots - element can be searched by css locator <br><br><pre> <code class="java hljs">compareElementScreenshots(<span class="hljs-string"><span class="hljs-string">"index_page_element"</span></span>, IndexPage.FORGE_BLOCK);</code> </pre> <br>  Or you can pass an object of class <b>WebElement</b> <br><br><pre> <code class="java hljs">compareElementScreenshots(<span class="hljs-string"><span class="hljs-string">"index_page_element"</span></span>, driver.findElement(By.cssSelector(<span class="hljs-string"><span class="hljs-string">"a.full.forge"</span></span>)));</code> </pre> <br><h3>  Possible problems </h3><br><ul><li>  Tests may fail due to dynamic content on the page.  The problem is solved by ignoring elements with dynamic content. </li><li>  Tests may fail due to a few pixels difference.  You can <b>fix</b> this by editing the setting - <b>TestConfig.allowableDiffSize</b> . </li><li>  Sometimes all the images or some elements on the site do not have time to load.  To fix this, I wrote the <b>preparePageForScreenshot ()</b> function in which, using javaScript, the page scrolls up and down.  But this does not always help. </li></ul><br><h3>  Summary </h3><br>  At the moment, the project has about 50 tests - pages and different page elements. <br>  Through the bash script autotests are launched and the site is tested in three extensions at once (mobile, tablet, desktop). <br><br>  There are some problems due to dynamic content and due to the fact that some elements of the site do not always have time to load on time, but autotests can cope with their task. <br><br>  Any changes to the layout are immediately visible. <br><br>  Link to the project repository - <a href="https://github.com/predewill/VisualRegressionBoilerplate">VisualRegressionBoilerplate</a> </div><p>Source: <a href="https://habr.com/ru/post/461553/">https://habr.com/ru/post/461553/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../461535/index.html">C ++, FIX, Oracle and PL / SQL: what an IT specialist needs to know to get a job in finance + real job opportunities</a></li>
<li><a href="../461537/index.html">Parsing. How SOCKS proxies work: pros, cons, differences from other technologies</a></li>
<li><a href="../46154/index.html">‚ÄúChampionat.ru is designed for those who love sport‚Äù</a></li>
<li><a href="../461545/index.html">Texturing, or what you need to know to become a Surface Artist. Part 5. Material system</a></li>
<li><a href="../461547/index.html">Medical Information System (MIS) as a product</a></li>
<li><a href="../461555/index.html">Google Spreadsheets Visualizations</a></li>
<li><a href="../46156/index.html">ESET NOD32 in Japan</a></li>
<li><a href="../461561/index.html">Arduino timer</a></li>
<li><a href="../461563/index.html">Lightsaber Homemade Copper Vapor Laser - Part 3, Final</a></li>
<li><a href="../461565/index.html">The 5 Commandments of TypeScript Developer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>