<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Materials from the #RuPostgres meeting - videos, presentations, quiz screening and photo report</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On September 15, Avito hosted a mitap, where we talked about scaling applications on PostgreSQL. Today I want to share materials from him - videos, pr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Materials from the #RuPostgres meeting - videos, presentations, quiz screening and photo report</h1><div class="post__text post__text-html js-mediator-article"><p>  On September 15, Avito hosted a mitap, where we talked about scaling applications on PostgreSQL.  Today I want to share materials from him - videos, presentations from speakers, show photos.  Also under the cut publish the analysis of the <a href="https://habr.com/company/avito/blog/422841/">quiz</a> questions that we conducted here on Habr√©, in front of the mitap.  And I talk about my impressions of the meeting. </p><br><p><img src="https://habrastorage.org/webt/tq/w8/ff/tqw8ffbp5stottfooubdrhw_yje.jpeg"></p><a name="habracut"></a><br><h1 id="doklady">  Reports </h1><br><h3 id="raspredelennye-tranzakcii-i-puteshestviya-vo-vremeni-stas-kelvich-postgres-professional">  Distributed transactions and time travel.  Stas Kelvich, Postgres Professional </h3><br><p>  Stas told about distributed transactions and time travel. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/DFLEkWi-vRc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  <a href="https://github.com/avito-tech/avitotech-presentations/blob/master/RuPostgres%2520%25E2%2580%2594%25D0%259C%25D0%25B0%25D1%2581%25D1%2588%25D1%2582%25D0%25B0%25D0%25B1%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5%2520%25D0%25BF%25D1%2580%25D0%25B8%25D0%25BB%25D0%25BE%25D0%25B6%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B8%25CC%2586%2520%25D0%25BD%25D0%25B0%2520PostgreSQL/%25D0%25A0%25D0%25B0%25D1%2581%25D0%25BF%25D1%2580%25D0%25B5%25D0%25B4%25D0%25B5%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25BD%25D1%258B%25D0%25B5%2520%25D1%2582%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B7%25D0%25B0%25D0%25BA%25D1%2586%25D0%25B8%25D0%25B8%2520%25D0%25B8%2520%25D0%25BF%25D1%2583%25D1%2582%25D0%25B5%25D1%2588%25D0%25B5%25D1%2581%25D1%2582%25D0%25B2%25D0%25B8%25D1%258F%2520%25D0%25B2%25D0%25BE%2520%25D0%25B2%25D1%2580%25D0%25B5%25D0%25BC%25D0%25B5%25D0%25BD%25D0%25B8.pdf">Presentation</a> </p><br><p>  Reviews: </p><br><blockquote>  Stas and his team did an excellent job!  I hope their decision will be approved by the community and we will see this solution in the new Postgres version. </blockquote><br><h3 id="masshtabirovanie-prilozheniya-na-postgresql-v-avito-tips-and-tricks-konstantin-evteev-avito">  Scaling an application to PostgreSQL in Avito: tips and tricks.  Konstantin Evteev, Avito </h3><br><p>  I gave a talk about scaling the application on PostgreSQL in Avito and shared our tips and tricks. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/78UNk0UfrRg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  <a href="https://github.com/avito-tech/avitotech-presentations/blob/master/RuPostgres%2520%25E2%2580%2594%25D0%259C%25D0%25B0%25D1%2581%25D1%2588%25D1%2582%25D0%25B0%25D0%25B1%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5%2520%25D0%25BF%25D1%2580%25D0%25B8%25D0%25BB%25D0%25BE%25D0%25B6%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B8%25CC%2586%2520%25D0%25BD%25D0%25B0%2520PostgreSQL/%25D0%259C%25D0%25B0%25D1%2581%25D1%2588%25D1%2582%25D0%25B0%25D0%25B1%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5%2520%25D0%25BF%25D1%2580%25D0%25B8%25D0%25BB%25D0%25BE%25D0%25B6%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F%2520%25D0%25BD%25D0%25B0%2520PostgreSQL%2520%25D0%25B2%2520%25D0%2590%25D0%25B2%25D0%25B8%25D1%2582%25D0%25BE.pdf">Presentation</a> </p><br><p>  Reviews: </p><br><blockquote>  An interesting approach: in which Kostantin very fascinatingly and intelligibly explained what problems can be encountered when working with data in the microservice architecture, and also suggested ways to solve when scaling an IP.  Saga remembered :) </blockquote><br><h3 id="logicheskaya-replikaciya-i-urovni-izolyacii-tranzakciy-postgresql-mihail-tyurin">  Logical replication and PostgreSQL transaction isolation levels.  Mikhail Tyurin </h3><br><p>  Michael prepared a report on logical replication and PostgreSQL transaction isolation levels. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/5i07k-uvxXY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  <a href="https://github.com/avito-tech/avitotech-presentations/blob/master/RuPostgres%2520%25E2%2580%2594%25D0%259C%25D0%25B0%25D1%2581%25D1%2588%25D1%2582%25D0%25B0%25D0%25B1%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5%2520%25D0%25BF%25D1%2580%25D0%25B8%25D0%25BB%25D0%25BE%25D0%25B6%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B8%25CC%2586%2520%25D0%25BD%25D0%25B0%2520PostgreSQL/%25D0%259B%25D0%25BE%25D0%25B3%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B0%25D1%258F%2520%25D1%2580%25D0%25B5%25D0%25BF%25D0%25BB%25D0%25B8%25D0%25BA%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F%2520%25D0%25B8%2520%25D1%2583%25D1%2580%25D0%25BE%25D0%25B2%25D0%25BD%25D0%25B8%2520%25D0%25B8%25D0%25B7%25D0%25BE%25D0%25BB%25D1%258F%25D1%2586%25D0%25B8%25D0%25B8%2520%25D1%2582%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B7%25D0%25B0%25D0%25BA%25D1%2586%25D0%25B8%25D0%25B8%25CC%2586%2520PostgreSQL.pdf">Presentation</a> </p><br><p>  Reviews: </p><br><blockquote>  Michael highlighted the subtle moments of transactions that are not immediately visible not only to beginners.  Everyone needs to know about it. </blockquote><br><h3 id="ozo--asinhronnaya-tipobezopasnaya-header-only-biblioteka-klient-postgresql-dlya-c17-sergey-handrikov-yandeks">  OZO is an asynchronous type-safe header-only PostgreSQL client library for C ++ 17.  Sergey Khandrikov, Yandex </h3><br><p>  Sergey told the audience about the structure of OZO, an asynchronous type-safe header-only PostgreSQL client library for C ++ 17, and invited a contributor to it. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/7Kq_sNSuolw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  <a href="https://github.com/avito-tech/avitotech-presentations/blob/master/RuPostgres%2520%25E2%2580%2594%25D0%259C%25D0%25B0%25D1%2581%25D1%2588%25D1%2582%25D0%25B0%25D0%25B1%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5%2520%25D0%25BF%25D1%2580%25D0%25B8%25D0%25BB%25D0%25BE%25D0%25B6%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B8%25CC%2586%2520%25D0%25BD%25D0%25B0%2520PostgreSQL/OZO%2520%25E2%2580%2594%2520%25D0%25B0%25D1%2581%25D0%25B8%25D0%25BD%25D1%2585%25D1%2580%25D0%25BE%25D0%25BD%25D0%25BD%25D0%25B0%25D1%258F%2520%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B1%25D0%25B5%25D0%25B7%25D0%25BE%25D0%25BF%25D0%25B0%25D1%2581%25D0%25BD%25D0%25B0%25D1%258F%2520header-only%2520%25D0%25B1%25D0%25B8%25D0%25B1%25D0%25BB%25D0%25B8%25D0%25BE%25D1%2582%25D0%25B5%25D0%25BA%25D0%25B0%2520%25D0%25BA%25D0%25BB%25D0%25B8%25D0%25B5%25D0%25BD%25D1%2582%2520PostgreSQL%2520%25D0%25B4%25D0%25BB%25D1%258F%2520C%252B%252B17.pdf">Presentation</a> </p><br><p>  Reviews: </p><br><blockquote>  The author, in my opinion, managed in a very short time to sufficiently review problems in existing libraries and solutions in new C ++ libraries.  Therefore, I will be glad if these libraries will be developed in opensource, all the more basic things have already been implemented, which is good news. </blockquote><br><h1 id="otvety-na-voprosy-viktoriny">  Answers to quiz questions </h1><br><p>  Before the mitap, we suggested you answer questions about Postgres.  Today I want to show the correct answers.  They are under the spoilers (just in case). </p><br><p>  <strong>There is an empty table with no users ("UserId" int, "balance" int) records.</strong>  <strong>What will be returned as a result of the request?</strong> </p><br><pre><code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> ins <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> gs, gs * <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> generate_series(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>) gs <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> gs%<span class="hljs-number"><span class="hljs-number">2</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span>;</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Answer</b> <div class="spoiler_text"><p>  Nothing. </p></div></div><br><p>  <strong>That returns the query</strong> <code>select * from users where UserId = 10;</code>  <strong>when accessing the users table after the previous task?</strong> </p><br><div class="spoiler">  <b class="spoiler_title">Answer</b> <div class="spoiler_text"><p>  ERROR: column "userid" does not exist. </p></div></div><br><p>  <strong>Enum CREATE TYPE status AS ENUM ('wait', 'init', 'run', 'stop') is defined;</strong>  <strong>Which command can remove the value of 'init'?</strong> </p><br><div class="spoiler">  <b class="spoiler_title">Answer</b> <div class="spoiler_text"><p>  There is no standard way to remove a value from enum. </p></div></div><br><p>  <strong>How can I get a list of functions in PostgreSQL?</strong> </p><br><div class="spoiler">  <b class="spoiler_title">Answer</b> <div class="spoiler_text"><p>  select * From pg_proc; </p></div></div><br><p>  <strong>What will be returned as a result of the request?</strong> </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>::<span class="hljs-type"><span class="hljs-type">smallint</span></span>::<span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>::<span class="hljs-type"><span class="hljs-type">bigint</span></span> &gt; <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Answer</b> <div class="spoiler_text"><p>  ERROR: cant be cast type smallint to boolean. </p></div></div><br><p>  <strong>Junior developer Vasya was instructed to write a query that displays all entries from the <code>parent</code> table for which there are no entries in the <code>child</code> table.</strong> </p><br><p>  <strong>Data scheme:</strong> </p><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span> (parent_id <span class="hljs-built_in"><span class="hljs-built_in">serial</span></span> primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span>, payload <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-keyword"><span class="hljs-keyword">child</span></span> (child_id <span class="hljs-built_in"><span class="hljs-built_in">serial</span></span> primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span>, parent_id <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unique</span></span> <span class="hljs-keyword"><span class="hljs-keyword">references</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span> (parent_id));</code> </pre> <br><p>  <strong>Vasya tried very hard and did not want to lose his face, so he invented eight different requests to solve the problem:</strong> </p><br><pre> <code class="hljs cs">-- <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> p.parent_id, p.<span class="hljs-function"><span class="hljs-function">payload </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">from</span></span></span><span class="hljs-function"> parent p </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">where</span></span></span><span class="hljs-function"> not </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">exists</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">select</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">from</span></span></span></span><span class="hljs-function"><span class="hljs-params"> child c </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">where</span></span></span></span><span class="hljs-function"><span class="hljs-params"> c.parent_id = p.parent_id</span></span></span><span class="hljs-function">)</span></span>; -- <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> p.parent_id, p.<span class="hljs-function"><span class="hljs-function">payload </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">from</span></span></span><span class="hljs-function"> parent p </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">where</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">array[p.parent_id] &amp;&amp; array(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">select</span></span></span></span><span class="hljs-function"><span class="hljs-params"> c.parent_id </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">from</span></span></span></span><span class="hljs-function"><span class="hljs-params"> child c</span></span></span><span class="hljs-function">))</span></span>; -- <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> distinct p.parent_id, p.<span class="hljs-function"><span class="hljs-function">payload </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">from</span></span></span><span class="hljs-function"> parent p full </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">join</span></span></span><span class="hljs-function"> child c </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">c.parent_id = p.parent_id</span></span></span><span class="hljs-function">) </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">where</span></span></span><span class="hljs-function"> c.parent_id </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">is</span></span></span><span class="hljs-function"> </span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-literal">null</span></span></span></span>; -- <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> p.parent_id, p.payload <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> parent p <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> p.<span class="hljs-function"><span class="hljs-function">parent_id not </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">in</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">select</span></span></span></span><span class="hljs-function"><span class="hljs-params"> c.parent_id </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">from</span></span></span></span><span class="hljs-function"><span class="hljs-params"> child c</span></span></span><span class="hljs-function">)</span></span>; -- <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> p.parent_id, p.<span class="hljs-function"><span class="hljs-function">payload </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">from</span></span></span><span class="hljs-function"> parent p left </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">join</span></span></span><span class="hljs-function"> child c </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">c.parent_id = p.parent_id</span></span></span><span class="hljs-function">) </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">where</span></span></span><span class="hljs-function"> c.parent_id </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">is</span></span></span><span class="hljs-function"> </span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-literal">null</span></span></span></span>; -- <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-function"><span class="hljs-function">with w_child_with_parents </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">as</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">select</span></span></span></span><span class="hljs-function"><span class="hljs-params"> c.parent_id, ( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">select</span></span></span></span><span class="hljs-function"><span class="hljs-params"> count(*</span></span></span><span class="hljs-function">) </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">from</span></span></span><span class="hljs-function"> parent p </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">where</span></span></span><span class="hljs-function"> c.parent_id</span></span> = p.parent_id) = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> parent_exists <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> child c) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> p.parent_id, p.payload <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> parent p <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> p.<span class="hljs-function"><span class="hljs-function">parent_id </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">in</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">select</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pc.parent_id </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">from</span></span></span></span><span class="hljs-function"><span class="hljs-params"> w_child_with_parents pc </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">where</span></span></span></span><span class="hljs-function"><span class="hljs-params"> not pc.parent_exists</span></span></span><span class="hljs-function">)</span></span>; -- <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> p.parent_id, p.<span class="hljs-function"><span class="hljs-function">payload </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">from</span></span></span><span class="hljs-function"> parent p full </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">join</span></span></span><span class="hljs-function"> child c </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">c.parent_id = p.parent_id</span></span></span><span class="hljs-function">) </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">group</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">by</span></span></span><span class="hljs-function"> p.parent_id, p.payload having </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">count</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">c</span></span></span><span class="hljs-function">)</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; -- <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> p.parent_id, p.payload <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> parent p <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> p.<span class="hljs-function"><span class="hljs-function">parent_id </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">in</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">select</span></span></span></span><span class="hljs-function"><span class="hljs-params"> p2.parent_id </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">from</span></span></span></span><span class="hljs-function"><span class="hljs-params"> parent p2 except all </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">select</span></span></span></span><span class="hljs-function"><span class="hljs-params"> c2.parent_id </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">from</span></span></span></span><span class="hljs-function"><span class="hljs-params"> child c2</span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br><p>  <strong>Vasya presented his options to you so that you could help him choose the best one.</strong>  <strong>He claims that all requests work in the same way: tables are placed in memory and the performance difference is not significant (or even invisible).</strong>  <strong>However, you, as a more experienced developer, have noticed that perhaps not all requests solve the problem.</strong>  <strong>List the requests that do not solve the problem (and explain why).</strong> </p><br><div class="spoiler">  <b class="spoiler_title">Short answer</b> <div class="spoiler_text"><p>  The assigned task is not solved by requests 2, 3 and 5 (in some cases also request 1). </p></div></div><br><div class="spoiler">  <b class="spoiler_title">The answer to the result of the experiment</b> <div class="spoiler_text"><h3 id="testovye-dannye">  Test data: </h3><br><p>  The ‚Äúincorrectness‚Äù of behavior manifests itself when there are entries in the child table with parent_id is null. </p><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span> (parent_id, payload) <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'payload 1'</span></span>), (<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'payload 2'</span></span>), (<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'payload 3'</span></span>), (<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'payload 4'</span></span>), (<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">'payload 5'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> <span class="hljs-keyword"><span class="hljs-keyword">child</span></span> (child_id, parent_id) <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>), (<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>), (<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>);</code> </pre> <br><h3 id="na-privedennyh-testovyh-dannyh">  On the above test data </h3><br><ul><li>  Request 1 depending on whether the intarray extension is installed may work or not work. </li><li>  Query 2 returns an extra string (null, null). </li><li>  Queries 3 and 5 return an empty resaltset. </li></ul><br><h3 id="interpretaciya-rezultatov-eksperimenta">  Interpretation of experimental results </h3><br><p>  Request 1: if the intarray extension is installed in the database ( <a href="https://www.postgresql.org/docs/current/static/intarray.html">https://www.postgresql.org/docs/current/static/intarray.html</a> ), the request crashes with the error "ERROR: array must not contain nulls".  This behavior is due to the fact that the extension overrides the standard operators and changes the behavior for arrays containing null-elements. </p><br><p>  The documentation says the following: </p><br><blockquote>  It should be noted that the operators &amp;&amp;, @&gt; and &lt;@  This restriction makes it possible for many operators. </blockquote><p>  Request 2: due to full join, an extra string (null, null) appears in the result. </p><br><p>  Query 3: returns an empty resultset due to the fact that in the set formed by the subquery there are null elements. </p><br><p>  Documentation ( <a href="https://www.postgresql.org/docs/current/static/functions-subquery.html">https://www.postgresql.org/docs/current/static/functions-subquery.html#FUNCTIONS-SUBQUERY-NOTIN</a> ): </p><br><blockquote>  If you‚Äôre not a lane, you‚Äôll not be able to make it.  This is in accordance with the SQL rules for the Boolean combinations of null values. </blockquote><p>  Request 5: returns an empty resultset because the w_child_with_parents section is run, the child and parent_id are empty or are not reflected in the section at all from the child table. </p></div></div><br><p>  Three quiz questions correctly answered all the quiz questions.  One we handed the prize at the mitap, two more sets of souvenirs went by mail. </p><br><p><img src="https://habrastorage.org/webt/jd/3f/20/jd3f207khh7jg6oy9lg0cm_rul8.jpeg"></p><br><h1 id="posleslovie">  Afterword </h1><br><p>  More than a hundred people came to the mitap.  It was very nice to meet such an audience.  According to the survey, more than 60% of guests of the mitap have more than five years of experience working with databases.  And it is very nice when reports receive such a lively response from the audience: </p><br><p><img src="https://habrastorage.org/webt/lu/gd/6e/lugd6eme6c-_m6f1vunleyq58ys.jpeg"></p><br><p>  On the sidelines of the meeting they talked a lot about the fact that PostgreSQL is becoming an increasingly common tool.  It really is.  Taking this opportunity, I will say that we in Avito plan to expand the DBA team, and if you are interested in ambitious tasks on a large project, take a look <a href="https://moikrug.ru/vacancies/1000045845">at the vacancy on My Circle</a> or write to me. </p><br><p><img src="https://habrastorage.org/webt/1y/2x/dm/1y2xdm33_9kqv36tu2rdplca27w.jpeg"></p><br><p>  And in conclusion, I want to thank my colleagues from Yandex, Postgres Professional and, of course, Avito, for the wonderful presentations we have heard.  Thanks to the guests who came to us on this Saturday day and live viewers.  And of course, the #RuPostgres community for their trust. </p><br><p>  Playlist with all reports <a href="https://www.youtube.com/playlist%3Flist%3DPLknJ4Vr6efQEqkMNcHizMczhn9lGsFC10">here</a> . <br>  Photo reports we posted <a href="https://www.facebook.com/pg/AvitoTech/photos/%3Ftab%3Dalbum%26album_id%3D1080870245423656">on Facebook</a> and <a href="https://vk.com/album-152990965_256636654">VKontakte</a> . </p><br><p><img src="https://habrastorage.org/webt/ve/lb/ja/velbjat75n66wq_-rgvbeois4pg.jpeg"></p><br><p>  See you again! </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/424249/">https://habr.com/ru/post/424249/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../424239/index.html">IBM's Autumn Seminars - Containers, Computer Vision, Digital Transformation</a></li>
<li><a href="../424241/index.html">Print your world</a></li>
<li><a href="../424243/index.html">5 easy ways to improve communication with customers</a></li>
<li><a href="../424245/index.html">Write a Telegram client - easy</a></li>
<li><a href="../424247/index.html">KotlinConf 2018 Live - see the broadcast on October 4-5</a></li>
<li><a href="../424251/index.html">We consider the statistics on the experiments on hh.ru</a></li>
<li><a href="../424255/index.html">How to use static analysis correctly</a></li>
<li><a href="../424257/index.html">Hexagon Cards in Unity: Parts 1-3</a></li>
<li><a href="../424259/index.html">Security Week 36: Telnet should be closed</a></li>
<li><a href="../424261/index.html">How to solve any programming problem</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>