<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>HP Thin Client as a home router and file server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Since the publication of the first part of the article on Geektimes, something has changed. I updated the thin client on the HP t610 Plus and switched...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>HP Thin Client as a home router and file server</h1><div class="post__text post__text-html js-mediator-article">  Since the publication of the <a href="http://geektimes.ru/post/250630/">first part of the</a> article on Geektimes, something has changed.  I updated the thin client on the <b>HP t610 Plus</b> and switched to <b>CentOS 7</b> .  Therefore, I am publishing this article not as a continuation of the previous one, but as a new one. <br><img src="https://habrastorage.org/files/6f2/000/c70/6f2000c702c9410282eef17066019b7d.jpg"><br><a name="habracut"></a><br>  <b>The tasks for the home server are as follows:</b> <br><ul><li>  distribute internet over ethernet and wifi </li><li>  cut ad banners on adblock lists </li><li>  view Tor resources </li><li>  perform the file server function (NFS and SAMBA) </li><li>  raise the tunnel to my work </li><li>  download files using different protocols </li></ul><br>  I'll tell you a little about iron.  The thin client is built on an AMD Dual-Core T56N 1.65 GHz processor and a Radeon HD 6320 video chip. Also, the big advantages of this model are: a full PCI Express 16x slot and a compartment for installing a hard disk (now you don‚Äôt have to reinvent the wheel). <br><br>  <b>The complete server configuration is:</b> <br><ul><li>  AMD Dual-Core T56N 1.65 GHz Processor </li><li>  AMD A55E Chipset </li><li>  Video card Radeon HD 6320 </li><li>  2 x 2Gb SO-DIMM 1600Mhz PC3-12800 Elpida DDR3EBJ20UF8BDU0-GN-F Memory </li><li>  Broadcom BCM57781 Gigabit Ethernet First Ethernet Adapter </li><li>  Intel's second Ethernet adapter 82574L Gigabit Ethernet </li><li>  Intel Advanced-N 6230 Wireless WiFi Adapter </li><li>  Seagate ST500LT012-9WS142 Hard Drive </li></ul><br>  Anticipating comments like "Yes, he's expensive!", I will give a list of all the components that were purchased and indicate their cost.  Everything was acquired, on all known, a site of free announcements. <br><br><ul><li>  HP t610 Plus Thin Client - <b>3500 rub.</b> </li><li>  Memory 2 x 2Gb SO-DIMM 1600Mhz - <b>1500 rub.</b> </li><li>  Intel Advanced-N 6230 WiFi Adapter - <b>300 rub.</b> </li><li>  Intel Ethernet adapter 82574L - <b>400 rub.</b> </li></ul><br>  <b>TOTAL: 5700 rubles.</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Below are some photos. <br><div class="spoiler">  <b class="spoiler_title">A photo</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/8d8/da0/cbe/8d8da0cbeeb043d5be6222a9497f882c.jpg"><img src="https://habrastorage.org/files/406/6a3/c4b/4066a3c4b87842c59accbb9367bd7acc.jpg"><br><br><img src="https://habrastorage.org/files/eb9/787/862/eb97878625cd4c149ca5c57c1ece8ae2.jpg"><img src="https://habrastorage.org/files/695/be4/e36/695be4e3665d4c76832ce0a023adb99a.jpg"><br></div></div><br>  I will not describe the installation of the operating system, there are a lot of detailed manuals on the Internet, so let's get down to the setup right away. <br><br><h1>  Network configuration </h1><br>  Disable NetworkManager so that it does not overwrite the settings. <br><pre><code class="bash hljs">systemctl stop NetworkManager systemctl mask NetworkManager systemctl stop NetworkManager-wait-online.service systemctl mask NetworkManager-wait-online.service</code> </pre> <br>  We check which interfaces are defined in the system and are available for customization. <br><pre> <code class="bash hljs">ip a</code> </pre><br>  I have 4 interfaces: enp5s0, wlp2s0, enp1s0, and wwp6s0u1i1.  Interfaces enp5s0 and wlp2s0 will be merged into br0 and look into the local network.  The enp1s0 and wwp6s0u1i1 interfaces look outward. <br><br>  We create and configure our bridge interface. <br><pre> <code class="bash hljs">vi /etc/sysconfig/network-scripts/ifcfg-br0</code> </pre><br><pre> <code class="bash hljs">DEVICE=<span class="hljs-string"><span class="hljs-string">"br0"</span></span> NAME=<span class="hljs-string"><span class="hljs-string">"br0"</span></span> TYPE=<span class="hljs-string"><span class="hljs-string">"Bridge"</span></span> ONBOOT=<span class="hljs-string"><span class="hljs-string">"yes"</span></span> BOOTPROTO=<span class="hljs-string"><span class="hljs-string">"static"</span></span> BROADCAST=192.168.2.255 IPADDR=192.168.2.1 NETMASK=255.255.255.0 NETWORK=192.168.2.0 NM_CONTROLLED=<span class="hljs-string"><span class="hljs-string">"no"</span></span> IPV6INIT=<span class="hljs-string"><span class="hljs-string">"no"</span></span> NOZEROCONF=<span class="hljs-string"><span class="hljs-string">"yes"</span></span> ZONE=<span class="hljs-string"><span class="hljs-string">"internal"</span></span></code> </pre><br>  We configure the Ethernet interface that looks into the local network and add it to our bridge. <br><pre> <code class="bash hljs">vi /etc/sysconfig/network-scripts/ifcfg-enp5s0</code> </pre><br><pre> <code class="bash hljs">DEVICE=<span class="hljs-string"><span class="hljs-string">"enp5s0"</span></span> NAME=<span class="hljs-string"><span class="hljs-string">"enp5s0"</span></span> TYPE=<span class="hljs-string"><span class="hljs-string">"Ethernet"</span></span> ONBOOT=<span class="hljs-string"><span class="hljs-string">"yes"</span></span> BOOTPROTO=<span class="hljs-string"><span class="hljs-string">"none"</span></span> HWADDR=<span class="hljs-string"><span class="hljs-string">"XX:XX:XX:XX:XX:XX"</span></span> NM_CONTROLLED=<span class="hljs-string"><span class="hljs-string">"no"</span></span> DEFROUTE=<span class="hljs-string"><span class="hljs-string">"yes"</span></span> PEERDNS=<span class="hljs-string"><span class="hljs-string">"yes"</span></span> PEERROUTES=<span class="hljs-string"><span class="hljs-string">"yes"</span></span> IPV4_FAILURE_FATAL=<span class="hljs-string"><span class="hljs-string">"no"</span></span> IPV6INIT=<span class="hljs-string"><span class="hljs-string">"no"</span></span> BRIDGE=<span class="hljs-string"><span class="hljs-string">"br0"</span></span></code> </pre><br>  Configure WiFi interface. <br><pre> <code class="bash hljs">vi /etc/sysconfig/network-scripts/ifcfg-wlp2s0</code> </pre><br><pre> <code class="bash hljs">DEVICE=<span class="hljs-string"><span class="hljs-string">"wlp2s0"</span></span> NAME=<span class="hljs-string"><span class="hljs-string">"wlp2s0"</span></span> TYPE=<span class="hljs-string"><span class="hljs-string">"Ethernet"</span></span> ONBOOT=<span class="hljs-string"><span class="hljs-string">"yes"</span></span> BOOTPROTO=<span class="hljs-string"><span class="hljs-string">"none"</span></span> HWADDR=<span class="hljs-string"><span class="hljs-string">"XX:XX:XX:XX:XX:XX"</span></span> NM_CONTROLLED=<span class="hljs-string"><span class="hljs-string">"no"</span></span> DEFROUTE=<span class="hljs-string"><span class="hljs-string">"yes"</span></span> PEERDNS=<span class="hljs-string"><span class="hljs-string">"yes"</span></span> PEERROUTES=<span class="hljs-string"><span class="hljs-string">"yes"</span></span> IPV4_FAILURE_FATAL=<span class="hljs-string"><span class="hljs-string">"no"</span></span> IPV6INIT=<span class="hljs-string"><span class="hljs-string">"no"</span></span> BRIDGE=<span class="hljs-string"><span class="hljs-string">"br0"</span></span></code> </pre><br>  Customize the interface that looks to the Internet. <br><pre> <code class="bash hljs">vi /etc/sysconfig/network-scripts/ifcfg-enp1s0</code> </pre><br><pre> <code class="bash hljs">DEVICE=<span class="hljs-string"><span class="hljs-string">"enp1s0"</span></span> TYPE=<span class="hljs-string"><span class="hljs-string">"Ethernet"</span></span> HWADDR=<span class="hljs-string"><span class="hljs-string">"XX:XX:XX:XX:XX:XX"</span></span> NM_CONTROLLED=<span class="hljs-string"><span class="hljs-string">"no"</span></span> BOOTPROTO=<span class="hljs-string"><span class="hljs-string">"dhcp"</span></span> DNS1=127.0.0.1 DNS2=127.0.0.1 DNS3=127.0.0.1 ONBOOT=<span class="hljs-string"><span class="hljs-string">"yes"</span></span> IPV4_FAILURE_FATAL=<span class="hljs-string"><span class="hljs-string">"no"</span></span> IPV6INIT=<span class="hljs-string"><span class="hljs-string">"no"</span></span> NOZEROCONF=<span class="hljs-string"><span class="hljs-string">"yes"</span></span> ZONE=<span class="hljs-string"><span class="hljs-string">"external"</span></span></code> </pre><br>  Install bridge-utils to support bridge. <br><pre> <code class="bash hljs">yum install bridge-utils</code> </pre><br>  Restart the network management service. <br><pre> <code class="bash hljs">systemctl restart network.service</code> </pre><br><div class="spoiler">  <b class="spoiler_title">4G Internet</b> <div class="spoiler_text">  Now I don‚Äôt have the opportunity to use wired internet, so for access I use 4G modem Huawei stitched in STICK. <br>  For his work, you must install the following packages. <br><br><pre> <code class="bash hljs">yum install usb_modeswitch usb_modeswitch-data</code> </pre><br>  Configure 4G interface. <br><pre> <code class="bash hljs">vim /etc/sysconfig/network-scripts/ifcfg-wwp6s0u1i1</code> </pre><br><pre> <code class="bash hljs">DEVICE=<span class="hljs-string"><span class="hljs-string">"wwp6s0u1i1"</span></span> NAME=<span class="hljs-string"><span class="hljs-string">"wwp6s0u1i1"</span></span> TYPE=<span class="hljs-string"><span class="hljs-string">"Ethernet"</span></span> ONBOOT=<span class="hljs-string"><span class="hljs-string">"yes"</span></span> BOOTPROTO=<span class="hljs-string"><span class="hljs-string">"dhcp"</span></span> HWADDR=<span class="hljs-string"><span class="hljs-string">"XX:XX:XX:XX:XX:XX"</span></span> NM_CONTROLLED=<span class="hljs-string"><span class="hljs-string">"no"</span></span> DNS1=127.0.0.1 DNS2=127.0.0.1 DNS3=127.0.0.1 NOZEROCONF=<span class="hljs-string"><span class="hljs-string">"yes"</span></span> IPV4_FAILURE_FATAL=<span class="hljs-string"><span class="hljs-string">"no"</span></span> IPV6INIT=<span class="hljs-string"><span class="hljs-string">"no"</span></span> ZONE=<span class="hljs-string"><span class="hljs-string">"external"</span></span></code> </pre><br>  We create scripts to activate and deactivate the Internet when the interface is turned on or off. <br><pre> <code class="bash hljs">vim /sbin/ifup-pre-local</code> </pre><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash # PREUP="/etc/sysconfig/network-scripts/pre-up-${1:6}" if [ -x $PREUP ]; then exec $PREUP fi</span></span></code> </pre><br><pre> <code class="bash hljs">vim /sbin/ifdown-pre-local</code> </pre><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash # PREDOWN="/etc/sysconfig/network-scripts/pre-down-$1" if [ -x $PREDOWN ]; then exec $PREDOWN fi</span></span></code> </pre><br><pre> <code class="bash hljs">vim /etc/sysconfig/network-scripts/pre-up-wwp6s0u1i1</code> </pre><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash # echo -en 'AT^NDISDUP=1,1,"internet.yota"\r\n' &gt; /dev/ttyUSB0</span></span></code> </pre><br><pre> <code class="bash hljs">vim /etc/sysconfig/network-scripts/pre-down-wwp6s0u1i1</code> </pre><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash # echo -en 'AT^NDISDUP=1,0,"internet.yota"\r\n' &gt; /dev/ttyUSB0</span></span></code> </pre><br>  Raise the interface and check. <br><pre> <code class="bash hljs">ifup wwp6s0u1i1 ip a</code> </pre><br></div></div><br><br><h1>  DNSMasq </h1><br>  We configure DHCP and DNS server. <br><pre> <code class="bash hljs">vi /etc/dnsmasq.conf</code> </pre><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">log</span></span>-queries <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>-dhcp <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>-facility=/var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/dnsmasq.log conf-dir=/etc/dnsmasq.d</code> </pre><br>  We configure DHCP. <br><pre> <code class="bash hljs">vi /etc/dnsmasq.d/dhcp.conf</code> </pre><br><pre> <code class="bash hljs">dhcp-authoritative dhcp-option=1,255.255.255.0 dhcp-option=2,192.168.2.1 dhcp-option=28,192.168.2.255 dhcp-option=42,192.168.2.1 dhcp-range=192.168.2.11,192.168.2.254,24h dhcp-host=2c:35:f8:41:6e:68,192.168.2.2,PC</code> </pre><br>  Configure the DNS. <br><pre> <code class="bash hljs">vi /etc/dnsmasq.d/dns.conf</code> </pre><br><pre> <code class="bash hljs">listen-address=127.0.0.1,192.168.2.1 interface=br0 except-interface=enp1s0,wwp6s0u1i1, tun0 domain-needed bogus-priv strict-order no-resolv proxy-dnssec server=127.0.0.1<span class="hljs-comment"><span class="hljs-comment">#5353 #   DNSCrypt #server=77.88.8.88 server=/onion/127.0.0.1#5300 #   tor address=/router/192.168.2.1 #no-hosts addn-hosts=/etc/dnsmasq.hosts</span></span></code> </pre><br>  We block microsoft telemetry sites and advertisements in some applications. <br><pre> <code class="bash hljs">vi /etc/dnsmasq.hosts</code> </pre><br><div class="spoiler">  <b class="spoiler_title">dnsmasq.hosts</b> <div class="spoiler_text">  ############### microsoft spy ################ <br>  127.0.0.1 vortex.data.microsoft.com <br>  127.0.0.1 vortex-win.data.microsoft.com <br>  127.0.0.1 telecommand.telemetry.microsoft.com <br>  127.0.0.1 telecommand.telemetry.microsoft.com.nsatc.net <br>  127.0.0.1 oca.telemetry.microsoft.com <br>  127.0.0.1 oca.telemetry.microsoft.com.nsatc.net <br>  127.0.0.1 sqm.telemetry.microsoft.com <br>  127.0.0.1 sqm.telemetry.microsoft.com.nsatc.net <br>  127.0.0.1 watson.telemetry.microsoft.com <br>  127.0.0.1 watson.telemetry.microsoft.com.nsatc.net <br>  127.0.0.1 redir.metaservices.microsoft.com <br>  127.0.0.1 choice.microsoft.com <br>  127.0.0.1 choice.microsoft.com.nsatc.net <br>  127.0.0.1 df.telemetry.microsoft.com <br>  127.0.0.1 reports.wes.df.telemetry.microsoft.com <br>  127.0.0.1 wes.df.telemetry.microsoft.com <br>  127.0.0.1 services.wes.df.telemetry.microsoft.com <br>  127.0.0.1 sqm.df.telemetry.microsoft.com <br>  127.0.0.1 telemetry.microsoft.com <br>  127.0.0.1 watson.ppe.telemetry.microsoft.com <br>  127.0.0.1 telemetry.appex.bing.net <br>  127.0.0.1 telemetry.urs.microsoft.com <br>  127.0.0.1 telemetry.appex.bing.net:443 <br>  127.0.0.1 settings-sandbox.data.microsoft.com <br>  127.0.0.1 vortex-sandbox.data.microsoft.com <br>  127.0.0.1 survey.watson.microsoft.com <br>  127.0.0.1 watson.live.com <br>  127.0.0.1 watson.microsoft.com <br>  127.0.0.1 statsfe2.ws.microsoft.com <br>  127.0.0.1 corpext.msitadfs.glbdns2.microsoft.com <br>  127.0.0.1 compatexchange.cloudapp.net <br>  127.0.0.1 cs1.wpc.v0cdn.net <br>  127.0.0.1 a-0001.a-msedge.net <br>  127.0.0.1 statsfe2.update.microsoft.com.akadns.net <br>  127.0.0.1 sls.update.microsoft.com.akadns.net <br>  127.0.0.1 fe2.update.microsoft.com.akadns.net <br>  127.0.0.1 65.55.108.23 <br>  127.0.0.1 65.39.117.230 <br>  127.0.0.1 23.218.212.69 <br>  127.0.0.1 134.170.30.202 <br>  127.0.0.1 137.116.81.24 <br>  127.0.0.1 diagnostics.support.microsoft.com <br>  127.0.0.1 corp.sts.microsoft.com <br>  127.0.0.1 statsfe1.ws.microsoft.com <br>  127.0.0.1 pre.footprintpredict.com <br>  127.0.0.1 204.79.197.200 <br>  127.0.0.1 23.218.212.69 <br>  127.0.0.1 i1.services.social.microsoft.com <br>  127.0.0.1 i1.services.social.microsoft.com.nsatc.net <br>  127.0.0.1 feedback.windows.com <br>  127.0.0.1 feedback.microsoft-hohm.com <br>  127.0.0.1 feedback.search.microsoft.com <br>  ############### skype &amp; yuotube ############### <br>  127.0.0.1 pubads.g.doubleclick.net <br>  127.0.0.1 static.doubleclick.net <br>  127.0.0.1 devads.skypeassets.net <br>  127.0.0.1 devapps.skype.net <br>  127.0.0.1 qawww.skypeassets.net <br>  127.0.0.1 qaapi.skype.net <br>  127.0.0.1 preads.skypeassets.net <br>  127.0.0.1 preapps.skype.net <br>  127.0.0.1 static.skypeassets.com <br>  127.0.0.1 serving.plexop.net <br>  127.0.0.1 preg.bforex.com <br>  127.0.0.1 ads1.msads.net <br>  127.0.0.1 flex.msn.com <br>  127.0.0.1 apps.skype.com <br>  127.0.0.1 api.skype.com <br>  127.0.0.1 cdn.mbstatic.org <br>  127.0.0.1 marathonbet.com <br>  127.0.0.1 megogo.net <br>  127.0.0.1 adselector.ru <br>  127.0.0.1 pluso.ru <br>  127.0.0.1 flash.begun.ru <br>  127.0.0.1 ad.adriver.ru <br></div></div><br><pre> <code class="bash hljs">vim /etc/resolv.conf</code> </pre><br><pre> <code class="bash hljs">nameserver 127.0.0.1</code> </pre><br>  We activate and restart the dnsmasq service. <br><pre> <code class="bash hljs">systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> dnsmasq.service systemctl start dnsmasq.service</code> </pre><br><h1>  DNSCrypt </h1><br>  I use DNSCrypt, coupled with Tor, to help simplify life. <br><pre> <code class="bash hljs">yum localinstall https://dl.dropboxusercontent.com/u/2709550/HP%20t610%20PLUS/dnscrypt-proxy-1.6.0-1.el7.centos.x86_64.rpm</code> </pre><br>  In the configuration file, change the port number to the one that was specified in the dnsmasq configuration. <br><pre> <code class="bash hljs">vim /etc/sysconfig/dnscrypt-proxy</code> </pre><br><pre> <code class="bash hljs">DNSCRYPT_LOCALPORT=5353</code> </pre><br>  We activate and restart the dnscrypt service <br><pre> <code class="bash hljs">systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> dnscrypt-proxy.service systemctl start dnscrypt-proxy.service</code> </pre><br><h1>  EPEL </h1><br>  We connect an additional repository EPEL. <br><pre> <code class="bash hljs">yum localinstall http://mirror.yandex.ru/epel/7/x86_64/e/epel-release-7-5.noarch.rpm yum update</code> </pre><br>  Install additional packages. <br><pre> <code class="bash hljs">yum install bash-completion vim mc iftop wget smartmontools hdparm tmux</code> </pre><br>  Create a new user. <br><pre> <code class="bash hljs">useradd -G wheel user passwd user</code> </pre><br>  We include forwarding in the core. <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"net.ipv4.ip_forward=1"</span></span> &gt; /etc/sysctl.d/forwarding.conf sysctl --system</code> </pre><br>  Change seltico poltiku. <br><pre> <code class="bash hljs">vim /etc/selinux/config SELINUX=permissive</code> </pre><br>  Paint the console. <br><pre> <code class="bash hljs">vim /root/.bashrc</code> </pre><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># .bashrc # User specific aliases and functions alias rm='rm -i' alias cp='cp -i' alias mv='mv -i' alias tmuxx='tmux attach || tmux new' # Source global definitions if [ -f /etc/bashrc ]; then . /etc/bashrc fi NORMAL="\[\e[0m\]" RED="\[\e[1;31m\]" GREEN="\[\e[1;32m\]" BLUE="\[\e[1;34m\]" export PS1="[$GREEN\u$RED@$BLUE\H]$NORMAL\w# "</span></span></code> </pre><br>  Configure tmux. <br><pre> <code class="bash hljs">vim ~/.tmux.conf</code> </pre><br><pre> <code class="bash hljs">setw -g c0-change-trigger 10 setw -g c0-change-interval 250 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> -g <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>-titles on <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> -g <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>-titles-string <span class="hljs-string"><span class="hljs-string">"tmux.#I.#W"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> -g base-index 1 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> -g <span class="hljs-built_in"><span class="hljs-built_in">history</span></span>-limit 5000 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> -g bell-action any setw -g monitor-activity on <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> -g visual-activity on <span class="hljs-built_in"><span class="hljs-built_in">bind</span></span>-key k confirm <span class="hljs-built_in"><span class="hljs-built_in">kill</span></span>-window <span class="hljs-built_in"><span class="hljs-built_in">bind</span></span>-key K confirm <span class="hljs-built_in"><span class="hljs-built_in">kill</span></span>-server <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> -g terminal-overrides <span class="hljs-string"><span class="hljs-string">'xterm*:smcup@:rmcup@'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> -g display-time 2000</code> </pre><br>  Eliminate long SSH login. <br><pre> <code class="bash hljs">vim /etc/ssh/sshd_config</code> </pre><br><pre> <code class="bash hljs">GSSAPIAuthentication no UseDNS no</code> </pre><br>  We activate rc.local and disable hibernation on the hard disk (prolong its service life). <br><pre> <code class="bash hljs">chmod a+x /etc/rc.local vim /etc/rc.d/rc.local hdparm -B 255 /dev/sda hdparm -S 0 /dev/sda</code> </pre><br>  Create additional directories. <br><pre> <code class="bash hljs">mkdir /home/store mkdir /home/www mkdir /home/backup</code> </pre><br><h1>  NTP </h1><br>  We configure time synchronization on NTP. <br><pre> <code class="bash hljs">yum install ntp</code> </pre><br><pre> <code class="bash hljs">vim /etc/sysconfig/ntpd SYNC_HWCLOCK=yes</code> </pre><br><pre> <code class="bash hljs">driftfile /var/lib/ntp/drift logfile /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/ntp.log restrict 127.0.0.1 restrict ::1 restrict 192.168.2.0 mask 255.255.255.0 nomodify notrap server ntp1.stratum2.ru iburst server ntp2.stratum2.ru iburst server ntp3.stratum2.ru iburst server ntp4.stratum2.ru iburst server ntp5.stratum2.ru iburst</code> </pre><br><pre> <code class="bash hljs">systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> ntpd.service</code> </pre><br><pre> <code class="bash hljs">systemctl start ntpd.service</code> </pre><br>  Synchronize time. <br><pre> <code class="bash hljs">systemctl stop ntpd.service &amp;&amp; ntpdate ntp1.stratum2.ru &amp;&amp; systemctl start ntpd.service</code> </pre><br><h1>  Hostapd </h1><br>  We install Hostapd, for the organization of WiFI.  This package is compiled with <a href="https://projects.archlinux.org/svntogit/community.git/tree/hostapd/repos/community-i686/hostapd-2.3-noscan.patch%3Fid%3D13b8f3fdf956c0e81b59fdde0ffc7f6fb17a251c">noscan.patch</a> . <br><pre> <code class="bash hljs">yum localinstall https://dl.dropboxusercontent.com/u/2709550/HP%20t610%20PLUS/Hostapd/hostapd-2.4-3.el7.centos.x86_64.rpm</code> </pre><br>  Here we specify: interfaces, SSID and password. <br><pre> <code class="bash hljs">vim /etc/hostapd/hostapd.conf</code> </pre><br><div class="spoiler">  <b class="spoiler_title">hostapd.conf</b> <div class="spoiler_text"><pre> <code class="bash hljs">interface=wlp2s0 bridge=br0 driver=nl80211 logger_syslog=-1 logger_syslog_level=2 logger_stdout=-1 logger_stdout_level=2 ctrl_interface=/var/run/hostapd ctrl_interface_group=wheel <span class="hljs-comment"><span class="hljs-comment">##### IEEE 802.11 related configuration ####################################### ssid=Home country_code=RU hw_mode=g channel=5 macaddr_acl=0 auth_algs=1 ignore_broadcast_ssid=0 wmm_enabled=1 ##### IEEE 802.11n related configuration ###################################### ieee80211n=1 ht_capab=[HT40-][HT40+][SHORT-GI-40][DSSS_CCK-40] noscan=1 ##### WPA/IEEE 802.11i configuration ########################################## wpa=2 wpa_passphrase=qwerty1234 wpa_key_mgmt=WPA-PSK #wpa_pairwise=CCMP rsn_pairwise=CCMP #wpa_group_rekey=600</span></span></code> </pre><br></div></div><br>  Activate and run the service. <br><pre> <code class="bash hljs">systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> hostapd.service systemctl start hostapd.service</code> </pre><br><h1>  Transmission </h1><br>  Install the torrent client transmission. <br><pre> <code class="bash hljs">yum install transmission-daemon transmission-cli</code> </pre><br><pre> <code class="bash hljs">systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> transmission-daemon.service systemctl start transmission-daemon.service systemctl stop transmission-daemon.service</code> </pre><br>  We set up access to the web-interface and directories for downloading files.  All changes must be made when the service is stopped, otherwise the settings will not be saved. <br><br><pre> <code class="bash hljs">vim /var/lib/transmission/.config/transmission-daemon/settings.json</code> </pre><br><div class="spoiler">  <b class="spoiler_title">settings.json</b> <div class="spoiler_text"><pre> <code class="bash hljs">{ <span class="hljs-string"><span class="hljs-string">"alt-speed-down"</span></span>: 50, <span class="hljs-string"><span class="hljs-string">"alt-speed-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"alt-speed-time-begin"</span></span>: 540, <span class="hljs-string"><span class="hljs-string">"alt-speed-time-day"</span></span>: 127, <span class="hljs-string"><span class="hljs-string">"alt-speed-time-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"alt-speed-time-end"</span></span>: 1020, <span class="hljs-string"><span class="hljs-string">"alt-speed-up"</span></span>: 50, <span class="hljs-string"><span class="hljs-string">"bind-address-ipv4"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.0.0.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"bind-address-ipv6"</span></span>: <span class="hljs-string"><span class="hljs-string">"::"</span></span>, <span class="hljs-string"><span class="hljs-string">"blocklist-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"blocklist-url"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://www.example.com/blocklist"</span></span>, <span class="hljs-string"><span class="hljs-string">"cache-size-mb"</span></span>: 4, <span class="hljs-string"><span class="hljs-string">"dht-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"download-dir"</span></span>: <span class="hljs-string"><span class="hljs-string">"/home/store/ "</span></span>, <span class="hljs-string"><span class="hljs-string">"download-queue-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"download-queue-size"</span></span>: 5, <span class="hljs-string"><span class="hljs-string">"encryption"</span></span>: 1, <span class="hljs-string"><span class="hljs-string">"idle-seeding-limit"</span></span>: 30, <span class="hljs-string"><span class="hljs-string">"idle-seeding-limit-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"incomplete-dir"</span></span>: <span class="hljs-string"><span class="hljs-string">"/home/store/Torrent"</span></span>, <span class="hljs-string"><span class="hljs-string">"incomplete-dir-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"lpd-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"message-level"</span></span>: 2, <span class="hljs-string"><span class="hljs-string">"peer-congestion-algorithm"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"peer-id-ttl-hours"</span></span>: 6, <span class="hljs-string"><span class="hljs-string">"peer-limit-global"</span></span>: 200, <span class="hljs-string"><span class="hljs-string">"peer-limit-per-torrent"</span></span>: 50, <span class="hljs-string"><span class="hljs-string">"peer-port"</span></span>: 51413, <span class="hljs-string"><span class="hljs-string">"peer-port-random-high"</span></span>: 65535, <span class="hljs-string"><span class="hljs-string">"peer-port-random-low"</span></span>: 49152, <span class="hljs-string"><span class="hljs-string">"peer-port-random-on-start"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"peer-socket-tos"</span></span>: <span class="hljs-string"><span class="hljs-string">"default"</span></span>, <span class="hljs-string"><span class="hljs-string">"pex-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"port-forwarding-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"preallocation"</span></span>: 1, <span class="hljs-string"><span class="hljs-string">"prefetch-enabled"</span></span>: 1, <span class="hljs-string"><span class="hljs-string">"queue-stalled-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"queue-stalled-minutes"</span></span>: 30, <span class="hljs-string"><span class="hljs-string">"ratio-limit"</span></span>: 2, <span class="hljs-string"><span class="hljs-string">"ratio-limit-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"rename-partial-files"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"rpc-authentication-required"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"rpc-bind-address"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.0.0.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"rpc-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"rpc-password"</span></span>: <span class="hljs-string"><span class="hljs-string">"  "</span></span>, <span class="hljs-string"><span class="hljs-string">"rpc-port"</span></span>: 9091, <span class="hljs-string"><span class="hljs-string">"rpc-url"</span></span>: <span class="hljs-string"><span class="hljs-string">"/transmission/"</span></span>, <span class="hljs-string"><span class="hljs-string">"rpc-username"</span></span>: <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"rpc-whitelist"</span></span>: <span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"rpc-whitelist-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"scrape-paused-torrents-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"script-torrent-done-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"script-torrent-done-filename"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"seed-queue-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"seed-queue-size"</span></span>: 10, <span class="hljs-string"><span class="hljs-string">"speed-limit-down"</span></span>: 100, <span class="hljs-string"><span class="hljs-string">"speed-limit-down-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"speed-limit-up"</span></span>: 100, <span class="hljs-string"><span class="hljs-string">"speed-limit-up-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"start-added-torrents"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"trash-original-torrent-files"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"umask"</span></span>: 0, <span class="hljs-string"><span class="hljs-string">"upload-slots-per-torrent"</span></span>: 14, <span class="hljs-string"><span class="hljs-string">"utp-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }</code> </pre><br></div></div><br><pre> <code class="bash hljs">systemctl start transmission-daemon.service</code> </pre><br><h1>  Aria2 </h1><br>  Installing a multi-protocol download manager. <br><pre> <code class="bash hljs">yum install aria2.x86_64</code> </pre><br><pre> <code class="bash hljs">mkdir /etc/aria2 touch /etc/aria2/aria2.conf touch /etc/aria2/session.lock touch /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/aria2.log &amp;&amp; chown nobody:nobody /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/aria2.log chown nobody:nobody /etc/aria2 -R</code> </pre><br>  We create service for systemd. <br><pre> <code class="bash hljs">vim /lib/systemd/system/aria2.service</code> </pre><br><pre> <code class="bash hljs">[Unit] Description=Aria2 User Service by %u After=network.target [Service] Type=forking User=nobody Group=nobody ExecStart=/usr/bin/aria2c --conf-path=/etc/aria2/aria2.conf --<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>=/var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/aria2.log [Install] WantedBy=multi-user.target</code> </pre><br>  Let's edit the settings file, set the directories for downloads and the RPC key for remote control. <br><pre> <code class="bash hljs">vim /etc/aria2/aria2.conf</code> </pre><br><pre> <code class="bash hljs">daemon=<span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-built_in"><span class="hljs-built_in">continue</span></span>=<span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-rpc rpc-allow-origin-all=<span class="hljs-literal"><span class="hljs-literal">true</span></span> rpc-listen-all=<span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-comment"><span class="hljs-comment">#     openssl rand -hex 15 rpc-secret=616d343b1465b51ca65675b2bfef98 dir=/home/store/Download save-session=/etc/aria2/session.lock input-file=/etc/aria2/session.lock dht-file-path=/etc/aria2/dht.dat disable-ipv6=true log-level=warn</span></span></code> </pre><br>  Create a preset for firewalld. <br><pre> <code class="bash hljs">vim /etc/firewalld/services/aria2.xml</code> </pre><br><pre> <code class="bash hljs">&lt;?xml version=<span class="hljs-string"><span class="hljs-string">"1.0"</span></span> encoding=<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>?&gt; &lt;service&gt; &lt;short&gt;aria2&lt;/short&gt; &lt;description&gt;aria2 <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>-line download utility&lt;/description&gt; &lt;port protocol=<span class="hljs-string"><span class="hljs-string">"tcp"</span></span> port=<span class="hljs-string"><span class="hljs-string">"6800"</span></span>/&gt; &lt;/service&gt;</code> </pre><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /etc/firewalld/services restorecon aria2.xml chmod 640 aria2.xml</code> </pre><br>  We activate and start the service. <br><pre> <code class="bash hljs">systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> aria2.service systemctl start aria2.service</code> </pre><br><h1>  Aria2 webui </h1><br>  Install and configure the web-interface for aria2. <br><pre> <code class="bash hljs">wget https://codeload.github.com/ziahamza/webui-aria2/zip/master -O webui-aria2.zip &amp;&amp; unzip webui-aria2.zip -d /home/www/ &amp;&amp; mv /home/www/webui-aria2-master /home/www/webui-aria2 &amp;&amp; chown nobody:nobody /home/www/webui-aria2 -R</code> </pre><br><pre> <code class="bash hljs">vim /home/www/webui-aria2/configuration.js</code> </pre><br><div class="spoiler">  <b class="spoiler_title">configuration.js</b> <div class="spoiler_text"><pre> <code class="bash hljs">angular .module(<span class="hljs-string"><span class="hljs-string">'webui.services.configuration'</span></span>, []) .constant(<span class="hljs-string"><span class="hljs-string">'$name'</span></span>, <span class="hljs-string"><span class="hljs-string">'Aria2 WebUI'</span></span>) // name used across the entire UI .constant(<span class="hljs-string"><span class="hljs-string">'$titlePattern'</span></span>, <span class="hljs-string"><span class="hljs-string">'active: {active} - waiting: {waiting} - stopped: {stopped} ‚Äî {name}'</span></span>) .constant(<span class="hljs-string"><span class="hljs-string">'$pageSize'</span></span>, 11) // number of downloads shown before pagination kicks <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> .constant(<span class="hljs-string"><span class="hljs-string">'$authconf'</span></span>, { // default authentication configuration, never fill it <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> the webui is hosted <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> public IP as it can be compromised host: <span class="hljs-string"><span class="hljs-string">'192.168.2.1'</span></span>, path: <span class="hljs-string"><span class="hljs-string">'/jsonrpc'</span></span>, port: 6800, encrypt: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, auth: { // either add the token field or the user and pass field, not both. token: <span class="hljs-string"><span class="hljs-string">'616d343b1465b51ca65675b2bfef98'</span></span> /*-----------------------------*/ // user: <span class="hljs-string"><span class="hljs-string">'*YOUR_USERNAME*'</span></span>, // pass: <span class="hljs-string"><span class="hljs-string">'*YOUR_SECRET_PASS*'</span></span> }, directURL: <span class="hljs-string"><span class="hljs-string">''</span></span> // If supplied, links will be created to <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> direct download from the aria2 server, requires appropriate webserver to be configured }) .constant(<span class="hljs-string"><span class="hljs-string">'$enable'</span></span>, { torrent: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, // bittorrent support only enabled <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> supported by aria2 build, <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> to <span class="hljs-literal"><span class="hljs-literal">false</span></span> otherwise to permanently <span class="hljs-built_in"><span class="hljs-built_in">disable</span></span> it metalink: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, // metalink support only enabled <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> supported by aria2 build, <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> to <span class="hljs-literal"><span class="hljs-literal">false</span></span> to permanently <span class="hljs-built_in"><span class="hljs-built_in">disable</span></span> it sidebar: { // configuration related to the sidebar next to the list of downloads show: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, // <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> to <span class="hljs-literal"><span class="hljs-literal">false</span></span> to completely hide the sidebar. Other elements inside will be automatically hidden stats: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, // <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> to <span class="hljs-literal"><span class="hljs-literal">false</span></span> to hide the global statistic section (contains the speed graph <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> now) filters: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, // <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> to <span class="hljs-literal"><span class="hljs-literal">false</span></span> to hide the Download Filters starredProps: <span class="hljs-literal"><span class="hljs-literal">true</span></span> // only shown when at least one property is added to the starred list, <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> to <span class="hljs-literal"><span class="hljs-literal">false</span></span> to permanently hide the Quick Access Settings inside the sidebar } }) .constant(<span class="hljs-string"><span class="hljs-string">'$starredProps'</span></span>, [ // default list of Quick Access Properties. Can be overridden by making modification through the Global Settings dialog // go to Global Settings dialog to see their description <span class="hljs-string"><span class="hljs-string">'dir'</span></span>, <span class="hljs-string"><span class="hljs-string">'conf-path'</span></span>, <span class="hljs-string"><span class="hljs-string">'auto-file-renaming'</span></span>, <span class="hljs-string"><span class="hljs-string">'max-connection-per-server'</span></span> ]) .constant(<span class="hljs-string"><span class="hljs-string">'$downloadProps'</span></span>, [ // Similar to starred Quick Access properties but <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> adding new downloads. // go to Advance Download Options when adding a new download to view the list of possible options <span class="hljs-string"><span class="hljs-string">'http-user'</span></span>, <span class="hljs-string"><span class="hljs-string">'http-passwd'</span></span>, <span class="hljs-string"><span class="hljs-string">'pause'</span></span>, <span class="hljs-string"><span class="hljs-string">'dir'</span></span>, <span class="hljs-string"><span class="hljs-string">'max-connection-per-server'</span></span> ]) .constant(<span class="hljs-string"><span class="hljs-string">'$globalTimeout'</span></span>, 1000) // interval to update the individual downloads ;</code> </pre><br></div></div><br><pre> <code class="bash hljs">vim /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/aria2-webui</code> </pre><br><div class="spoiler">  <b class="spoiler_title">aria2-webui</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python import os import posixpath import urllib import BaseHTTPServer from SimpleHTTPServer import SimpleHTTPRequestHandler # modify this to add additional routes ROUTES = ( ## [url_prefix , directory_path] ['', '/home/www/webui-aria2'], # empty string for the 'default' match # ['/media', '/var/www/media'] ) class RequestHandler(SimpleHTTPRequestHandler): def translate_path(self, path): """translate path given routes""" # set default root to cwd root = os.getcwd() # look up routes and set root directory accordingly for pattern, rootdir in ROUTES: if path.startswith(pattern): # found match! path = path[len(pattern):] # consume path up to pattern len root = rootdir break # normalize path and prepend root directory path = path.split('?',1)[0] path = path.split('#',1)[0] path = posixpath.normpath(urllib.unquote(path)) words = path.split('/') words = filter(None, words) path = root for word in words: drive, word = os.path.splitdrive(word) head, word = os.path.split(word) if word in (os.curdir, os.pardir): continue path = os.path.join(path, word) return path if __name__ == '__main__': BaseHTTPServer.test(RequestHandler, BaseHTTPServer.HTTPServer)</span></span></code> </pre><br>  The code is taken <a href="httpserver/">here</a> . <br></div></div><br><pre> <code class="bash hljs">chmod 755 /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/aria2-webui</code> </pre><br>  We create systemd service. <br><pre> <code class="bash hljs">vim /lib/systemd/system/aria2-webui.service</code> </pre><br><pre> <code class="bash hljs">[Unit] Description=Aria2 WebUI After=network.target After=aria2.service [Service] Type=simple User=nobody Group=nobody ExecStart=/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/aria2-webui [Install] WantedBy=multi-user.target</code> </pre><br>  We activate and start the service. <br><pre> <code class="bash hljs">systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> aria2-webui.service systemctl start aria2-webui.service</code> </pre><br>  Create a preset for firewalld. <br><pre> <code class="bash hljs">vim /etc/firewalld/services/aria2-webui.xml</code> </pre><br><pre> <code class="bash hljs">&lt;?xml version=<span class="hljs-string"><span class="hljs-string">"1.0"</span></span> encoding=<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>?&gt; &lt;service&gt; &lt;short&gt;Aria2-WebUI&lt;/short&gt; &lt;description&gt;WebUI <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Aria2&lt;/description&gt; &lt;port protocol=<span class="hljs-string"><span class="hljs-string">"tcp"</span></span> port=<span class="hljs-string"><span class="hljs-string">"8000"</span></span>/&gt; &lt;/service&gt;</code> </pre><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /etc/firewalld/services restorecon aria2-webui.xml chmod 640 aria2-webui.xml</code> </pre><br><h1>  Openvpn </h1><br>  If necessary, install and configure openvpn. <br><pre> <code class="bash hljs">yum install openvpn</code> </pre><br><pre> <code class="bash hljs">vim /etc/openvpn/client.conf</code> </pre><br><pre> <code class="bash hljs">client dev tun proto tcp remote xxx.xxx.xxx.xxx 1194 resolv-retry infinite nobind tun-mtu 1500 tun-mtu-extra 32 mssfix 1450 persist-key persist-tun ca /etc/openvpn/keys/ca.crt cert /etc/openvpn/keys/home.crt key /etc/openvpn/keys/home.key <span class="hljs-comment"><span class="hljs-comment">#tls-auth /etc/openvpn/keys/ta.key 1 #comp-lzo verb 3</span></span></code> </pre><br><pre> <code class="bash hljs">systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> openvpn@client systemctl start openvpn@client systemctl status -l openvpn@client</code> </pre><br><h1>  Nfs </h1><br>  Install and configure nfs support for access from linux machines. <br><pre> <code class="bash hljs">yum install nfs-utils</code> </pre><br><pre> <code class="bash hljs">vim /etc/idmapd.conf</code> </pre><br><pre> <code class="bash hljs">Domain = router.local</code> </pre><br><pre> <code class="bash hljs">vim /etc/exports</code> </pre><br><pre> <code class="bash hljs">/home/store 192.168.2.0/24(rw,sync,no_root_squash,no_subtree_check)</code> </pre><br>  We activate and start the service. <br><pre> <code class="bash hljs">systemctl start rpcbind nfs-server systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> rpcbind nfs-server</code> </pre><br>  We are checking. <br><pre> <code class="bash hljs">exportfs</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Bonus</b> <div class="spoiler_text">  These are scripts for automatic mounting of nfc balls when loading a TV set-top box on Android. <br>  Android 4.4 <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/system/bin/sh S_MOUNT="NFS" T_MOUNT="store" IP="192.168.2.1" # Make sure networking is up before mounting while : do check_if_up=($(netcfg | grep -e eth0 -e wlan0 | busybox awk '{print $2}')) if [[ (${check_if_up[0]} = UP) || (${check_if_up[1]} = UP) ]]; then break fi sleep 1 done sleep 1 if [ ! -d /data/media/0/${S_MOUNT} ] ; then mkdir /data/media/0/${S_MOUNT} fi sleep 30 su --mount-master -c busybox mount -o rw,nosuid,nodev,nolock,rsize=32768,wsize=32768,intr,noatime -t nfs ${IP}:/home/${T_MOUNT} /data/media/0/${S_MOUNT}</span></span></code> </pre><br>  Android 4.2 <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/system/bin/sh S_MOUNT="NFS" T_MOUNT="store" IP="192.168.2.1" # Make sure networking is up before mounting while : do check_if_up=($(netcfg | grep -e eth0 -e wlan0 | busybox awk '{print $2}')) if [[ (${check_if_up[0]} = UP) || (${check_if_up[1]} = UP) ]]; then break fi sleep 1 done sleep 1 if [ ! -d /mnt/${S_MOUNT} ] ; then mkdir /mnt/${S_MOUNT} fi sleep 30 busybox mount -o rw,nolock ${IP}:/home/${T_MOUNT} /mnt/${S_MOUNT}</span></span></code> </pre><br></div></div><br><h1>  Samba </h1><br>  Install and configure samba support for access from windows machines. <br><pre> <code class="bash hljs"> yum install samba mv /etc/samba/smb.conf /etc/samba/smb.conf.orig</code> </pre><br><pre> <code class="bash hljs">vim /etc/samba/smb.conf</code> </pre><br><div class="spoiler">  <b class="spoiler_title">smb.conf</b> <div class="spoiler_text"><pre> <code class="bash hljs">[global] workgroup = WORKGROUP server string = ROUTER netbios name = ROUTER interfaces = lo br0 hosts allow = 127. 192.168.2. <span class="hljs-built_in"><span class="hljs-built_in">bind</span></span> interfaces only = yes security = USER map to guest = Bad User guest account = nobody encrypt passwords = <span class="hljs-literal"><span class="hljs-literal">true</span></span> passdb backend = tdbsam load printers = no show add printer wizard = no printcap name = /dev/null <span class="hljs-built_in"><span class="hljs-built_in">disable</span></span> spoolss = yes unix charset = UTF8 socket options = TCP_NODELAY IPTOS_LOWDELAY SO_RCVBUF=65536 SO_SNDBUF=65536 [store] comment = all path = /home/store browseable = no <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> only = no guest ok = yes writable = yes create mask = 0777 directory mask = 0777 available = yes public = yes</code> </pre><br></div></div><br>  We activate and start the service. <br><pre> <code class="bash hljs"> systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> smb.service systemctl start smb.service</code> </pre><br><h1>  Squid </h1><br>  Install and configure squid proxy caching server. <br>  The squid is compiled with a patch for bio.cc and allows transparent HTTPS resources to be filtered without replacing certificates. <br>  More details can be found <a href="http://habrahabr.ru/post/272733/">here</a> . <br>  Also on the squid we will cut advertising and wrap up requests to some sites through tor. <br>  We add the Squid repository but prohibit the installation of squid squid-helpers packages. <br><pre> <code class="bash hljs">vim /etc/yum.repos.d/Squid.repo</code> </pre><br><pre> <code class="bash hljs">[squid] name=Squid repo <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> CentOS Linux - <span class="hljs-variable"><span class="hljs-variable">$basearch</span></span> <span class="hljs-comment"><span class="hljs-comment">#IL mirror baseurl=http://www1.ngtech.co.il/repo/centos/$releasever/$basearch/ failovermethod=priority enabled=1 gpgcheck=0 # Exclude=squid squid-helpers</span></span></code> </pre><br><pre> <code class="bash hljs">yum update</code> </pre><br>  Download and install Squid. <br><pre> <code class="bash hljs">yum localinstall https://dl.dropboxusercontent.com/u/2709550/HP%20t610%20PLUS/Squid/squid-3.5.8-4.el7.centos.x86_64.rpm yum localinstall https://dl.dropboxusercontent.com/u/2709550/HP%20t610%20PLUS/Squid/squid-helpers-3.5.8-4.el7.centos.x86_64.rpm</code> </pre><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /etc/squid mkdir ssl_cert chown squid:squid ssl_cert chmod 700 ssl_cert <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ssl_cert openssl req -new -newkey rsa:1024 -days 365 -nodes -x509 -keyout squidCA.pem -out squidCA.pem</code> </pre><br><pre> <code class="bash hljs">/usr/lib64/squid/ssl_crtd -c -s /var/lib/ssl_db chown squid:squid -R /var/lib/ssl_db</code> </pre><br><pre> <code class="bash hljs">vim /etc/squid/squid.conf</code> </pre><br><div class="spoiler">  <b class="spoiler_title">squid.conf</b> <div class="spoiler_text"><pre> <code class="bash hljs">visible_hostname router.local <span class="hljs-comment"><span class="hljs-comment">#---------------------------------------------------------------- mime_table /etc/squid/mime.conf global_internal_static on icon_directory /usr/share/squid/icons #---------------------------------------------------------------- acl localnet src 192.168.2.0/24 acl office_hours time 00:00-24:00 #---------------------------------------------------------------- acl SSL_ports port 443 # https acl SSL_ports port 563 # snews acl SSL_ports port 873 # rsync #---------------------------------------------------------------- acl Safe_ports port 21 # ftp acl Safe_ports port 25 # smtp acl Safe_ports port 70 # gopher acl Safe_ports port 80 # http acl Safe_ports port 210 # wais acl Safe_ports port 280 # http-mgmt acl Safe_ports port 443 # https acl Safe_ports port 488 # gss-http acl Safe_ports port 591 # filemaker acl Safe_ports port 631 # cups acl Safe_ports port 777 # multiling http acl Safe_ports port 873 # rsync acl Safe_ports port 901 # SWAT acl Safe_ports port 1025-65535 # unregistered ports acl purge method PURGE acl CONNECT method CONNECT #---------------------------------------------------------------- acl windowsupdate dstdomain windowsupdate.microsoft.com acl windowsupdate dstdomain .update.microsoft.com acl windowsupdate dstdomain download.windowsupdate.com acl windowsupdate dstdomain redir.metaservices.microsoft.com acl windowsupdate dstdomain images.metaservices.microsoft.com acl windowsupdate dstdomain c.microsoft.com acl windowsupdate dstdomain www.download.windowsupdate.com acl windowsupdate dstdomain wustat.windows.com acl windowsupdate dstdomain crl.microsoft.com acl windowsupdate dstdomain sls.microsoft.com acl windowsupdate dstdomain productactivation.one.microsoft.com acl windowsupdate dstdomain ntservicepack.microsoft.com #----------------------------------------------------------------- acl onion_domain dstdomain .onion acl tor_url dstdom_regex -i "/etc/squid/tor.url" #----------------------------------------------------------------- cache_peer 127.0.0.1 parent 8118 0 no-query no-digest default cache_peer_access 127.0.0.1 allow onion_domain cache_peer_access 127.0.0.1 allow tor_url cache_peer_access 127.0.0.1 deny all #----------------------------------------------------------------- http_access allow windowsupdate localnet #----------------------------------------------------------------- never_direct allow onion_domain never_direct allow tor_url always_direct deny onion_domain always_direct deny tor_url always_direct allow all #---------------------------------------------------------------- sslproxy_cert_error allow all sslproxy_flags DONT_VERIFY_PEER acl blocked ssl::server_name "/etc/squid/denied_https.conf" acl step1 at_step SslBump1 ssl_bump peek step1 ssl_bump terminate blocked ssl_bump splice all sslcrtd_program /usr/lib64/squid/ssl_crtd -s /var/lib/ssl_db -M 4MB #---------------------------------------------------------------- acl js urlpath_regex -i \.js(\?.*)?$ acl adblock-android dstdomain "/etc/squid/adblock-android.conf" acl adblock url_regex "/etc/squid/adblock.acl" acl badsites dstdomain "/etc/squid/denied-sites.conf" #---------------------------------------------------------------- http_access deny !Safe_ports http_access deny CONNECT !SSL_ports http_access deny localnet adblock-android http_access deny localnet adblock http_access allow localhost localnet Safe_ports #---------------------------------------------------------------- http_access allow localnet CONNECT http_access allow localnet office_hours #---------------------------------------------------------------- deny_info TCP_RESET adblock js deny_info http://192.168.2.1:3128/squid-internal-static/icons/null.gif adblock #---------------------------------------------------------------- http_access deny all #---------------------------------------------------------------- icp_access allow localnet icp_access deny all #---------------------------------------------------------------- http_port 192.168.2.1:3127 options=NO_SSLv3:NO_SSLv2 http_port 192.168.2.1:3128 intercept options=NO_SSLv3:NO_SSLv2 https_port 192.168.2.1:3129 intercept ssl-bump options=ALL:NO_SSLv3:NO_SSLv2 connection-auth=off cert=/etc/squid/ssl_cert/squidCA.pem #---------------------------------------------------------------- access_log stdio:/var/log/squid/access.log squid cache_log /var/log/squid/cache.log cache_store_log stdio:/var/log/squid/store.log pid_filename /var/run/squid.pid debug_options ALL,1 #---------------------------------------------------------------- refresh_pattern ^ftp: 1440 20% 10080 refresh_pattern ^gopher: 1440 0% 1440 refresh_pattern -i (/cgi-bin/|\?) 0 0% 0 refresh_pattern (Release|Package(.gz)*)$ 0 20% 2880 refresh_pattern . 0 20% 4320 acl shoutcast rep_header X-HTTP09-First-Line ^ICY\s[0-9] acl apache rep_header Server ^Apache #---------------------------------------------------------------- hosts_file /etc/hosts coredump_dir /var/spool/squid error_directory /usr/share/squid/errors/ru-ru cache_mgr wmlex@yandex.ru cache_dir ufs /var/spool/squid 2000 48 256 shutdown_lifetime 5 seconds</span></span></code> </pre><br></div></div><br>  Downloading ad blocking files <br><pre> <code class="bash hljs">wget -P /etc/squid/ https://dl.dropboxusercontent.com/u/2709550/HP%20t610%20PLUS/Squid/adblock-android.conf wget -P /etc/squid/ https://dl.dropboxusercontent.com/u/2709550/HP%20t610%20PLUS/Squid/adblock.acl wget -P /usr/share/squid/icons/ https://dl.dropboxusercontent.com/u/2709550/HP%20t610%20PLUS/Squid/null.gif touch /etc/squid/denied_https.conf touch /etc/squid/tor.url</code> </pre><br><pre> <code class="bash hljs">vim /etc/squid/tor.url</code> </pre><br><pre> <code class="bash hljs">config.privoxy.org check.torproject.org/?lang=ru</code> </pre><br><pre> <code class="bash hljs">vim /etc/squid/mime.conf</code> </pre><br><pre> <code class="bash hljs">null.gif$ image/gif null.gif - image +download +view</code> </pre><br><pre> <code class="bash hljs">systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> squid.service squid -z systemctl restart squid.service</code> </pre><br><pre> <code class="bash hljs">vim /etc/firewalld/services/squid.xml</code> </pre><br><pre> <code class="bash hljs">&lt;?xml version=<span class="hljs-string"><span class="hljs-string">"1.0"</span></span> encoding=<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>?&gt; &lt;service&gt; &lt;short&gt;Suid&lt;/short&gt; &lt;description&gt;Squid caching proxy server&lt;/description&gt; &lt;port protocol=<span class="hljs-string"><span class="hljs-string">"tcp"</span></span> port=<span class="hljs-string"><span class="hljs-string">"3127"</span></span>/&gt; &lt;port protocol=<span class="hljs-string"><span class="hljs-string">"tcp"</span></span> port=<span class="hljs-string"><span class="hljs-string">"3128"</span></span>/&gt; &lt;port protocol=<span class="hljs-string"><span class="hljs-string">"tcp"</span></span> port=<span class="hljs-string"><span class="hljs-string">"3129"</span></span>/&gt; &lt;/service&gt;</code> </pre><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /etc/firewalld/services restorecon squid.xml chmod 640 squid.xml</code> </pre><br><h1>  Tor </h1><br>  Install tor, to access .onion domains and other sites.  It is also necessary to install and configure privoxy, as tor will not be able to work directly with squid. <br><br><pre> <code class="bash hljs">vim /etc/yum.repos.d/torproject.repo</code> </pre><br><pre> <code class="bash hljs">[tor] name=Tor repo enabled=1 baseurl=https://deb.torproject.org/torproject.org/rpm/el/7/<span class="hljs-variable"><span class="hljs-variable">$basearch</span></span>/ gpgcheck=1 gpgkey=https://deb.torproject.org/torproject.org/rpm/RPM-GPG-KEY-torproject.org.asc repo_gpgcheck=1 [tor-source] name=Tor <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> repo enabled=0 autorefresh=0 baseurl=https://deb.torproject.org/torproject.org/rpm/el/7/SRPMS gpgcheck=1 gpgkey=https://deb.torproject.org/torproject.org/rpm/RPM-GPG-KEY-torproject.org.asc repo_gpgcheck=1</code> </pre><br><pre> <code class="bash hljs">vim /etc/yum.repos.d/epel.repo</code> </pre><br>  Exclude the installation of the package from the epel repository. <br><pre> <code class="bash hljs">Exclude=tor</code> </pre><br><pre> <code class="bash hljs">yum update yum install tor privoxy</code> </pre><br><pre> <code class="bash hljs">vim /etc/tor/tor-rpm-defaults-torrc</code> </pre><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># You probably want to edit torrc file instead of this one. # These are just fallback variables for --defaults-torrc Tor option. # DataDirectory /var/lib/tor PidFile /var/run/tor/tor.pid RunAsDaemon 1 User _tor SocksPort 9050 SocksListenAddress 127.0.0.1 #ControlSocket /var/run/tor/control #ControlSocketsGroupWritable 1 CookieAuthentication 1 Log notice file /var/log/tor/tor.log ExcludeNodes {ru}, {ua}, {by} VirtualAddrNetworkIPv4 10.192.0.0/10 DNSPort 5300 DNSListenAddress 127.0.0.1 AutomapHostsOnResolve 1</span></span></code> </pre><br>  Customize privoxy. <br><pre> <code class="bash hljs">vim /etc/privoxy/config</code> </pre><br><pre> <code class="bash hljs">confdir /etc/privoxy logdir /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/privoxy logfile privoxy.log actionsfile match-all.action <span class="hljs-comment"><span class="hljs-comment"># Actions that are applied to all sites and maybe overruled later on. actionsfile default.action # Main actions file actionsfile user.action # User customizations filterfile default.filter filterfile user.filter # User customizations listen-address 127.0.0.1:8118 forward-socks5t / 127.0.0.1:9050 . max-client-connections 4096 toggle 1 enable-remote-toggle 0 enable-remote-http-toggle 0 enable-edit-actions 0 enforce-blocks 0 buffer-limit 4096 enable-proxy-authentication-forwarding 0 forwarded-connect-retries 0 accept-intercepted-requests 0 allow-cgi-request-crunching 0 split-large-forms 0 keep-alive-timeout 5 tolerate-pipelining 1 socket-timeout 300</span></span></code> </pre><br>  We activate and start services. <br><pre> <code class="bash hljs">systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> tor systemctl restart tor systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> privoxy.service systemctl start privoxy.service</code> </pre><br><h1>  Rsync </h1><br>  Configure rsync as a backup tool.  Backups will be stored on an external hard drive. <br>  Install rsync <br><pre> <code class="bash hljs">yum install rsync</code> </pre><br>  Determine the UUID of our external drive. <br><pre> <code class="bash hljs">ls -l /dev/disk/by-uuid lrwxrwxrwx. 1 root root 10  12 15:22 2ae0e5f5-6db7-4934-8c57-b02116349d44 -&gt; ../../dm-0 lrwxrwxrwx. 1 root root 10  12 15:22 8848008a-f651-4d8f-b46c-0a7e727b52e3 -&gt; ../../sda1 lrwxrwxrwx. 1 root root 10  12 15:22 a597c3c3-4ste-42a7-b559-d75ea9de2e5f -&gt; ../../sdb1 lrwxrwxrwx. 1 root root 10  12 15:22 bc63643a-929b-4a59-b13a-5ba1873e9022 -&gt; ../../dm-1 lrwxrwxrwx. 1 root root 10  12 15:22 e3727ab9-2256-4954-b8ff-3109bb720231 -&gt; ../../dm-2</code> </pre><br>  Adding an entry to fstab <br><pre> <code class="bash hljs">vim /etc/fstab</code> </pre><br><pre> <code class="bash hljs">UUID=a597c3c3-4ste-42a7-b559-d75ea9de2e5f /home/backup ext3 defaults 0 0</code> </pre><br>  Create folders for storing backup files <br><pre> <code class="bash hljs">mkdir /home/backup/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> mkdir /home/backup/remote</code> </pre><br>  Configuring rsyncd <br><pre> <code class="bash hljs">vim /etc/rsyncd.conf</code> </pre><br>  In the configuration, we define two virtual directories remote and local.  The local directory will only be accessed from the local machine, and remote access from the 10.10.3.0/24 network will require authorization. <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># /etc/rsyncd: configuration file for rsync daemon mode # See rsyncd.conf man page for more options. # configuration example: uid = nobody gid = nobody use chroot = yes max connections = 2 pid file = /var/run/rsyncd.pid exclude = lost+found/ transfer logging = yes timeout = 900 ignore nonreadable = yes dont compress = *.gz *.tgz *.zip *.z *.Z *.rpm *.deb *.bz2 [remote] path = /home/backup/remote comment = Rsync file storage log file = /var/log/rsyncd/remote.log hosts allow = 10.10.3.0/24 read only = no list = yes auth users = remote secrets file = /etc/rsyncd.secrets [local] path = /home/backup/local comment = Rsync file storage log file = /var/log/rsyncd/local.log hosts allow = localhost read only = no list = yes</span></span></code> </pre><br>  Create a password to access the remote directory <br><pre> <code class="bash hljs">vim /etc/rsyncd.secrets</code> </pre><br><pre> <code class="bash hljs">remote:backup</code> </pre><br>  We set the necessary rights <br><pre> <code class="bash hljs">chown root.root /etc/rsyncd.* chmod 600 /etc/rsyncd.* chown nobody.nobody /home/backup -R</code> </pre><br>  We activate and start the service <br><pre> <code class="bash hljs">systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> rsyncd.service systemctl start rsyncd.service</code> </pre><br>  Create a rule in cron <br><pre> <code class="bash hljs">crontab -e</code> </pre><br>  Based on this rule, all the contents of the ‚Äústore‚Äù folder, except for the ‚ÄúDownload‚Äù folder, will be synchronized with the ‚Äúlocal‚Äù folder every day at 23:00 <br><pre> <code class="bash hljs">0 23 * * * rsync -av --delete --exclude=<span class="hljs-string"><span class="hljs-string">'Download/'</span></span> /home/store/ localhost::<span class="hljs-built_in"><span class="hljs-built_in">local</span></span></code> </pre><br><h1>  Firewalld </h1><br>  We configure firewall. <br><pre> <code class="bash hljs">firewall-cmd --<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>-default-zone=internal firewall-cmd --permanent --zone=external --add-icmp-block=<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>-reply firewall-cmd --permanent --zone=external --add-icmp-block=destination-unreachable firewall-cmd --permanent --zone=external --add-icmp-block=<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>-request firewall-cmd --permanent --zone=external --add-icmp-block=time-exceeded firewall-cmd --permanent --zone=external --add-icmp-block=parameter-problem firewall-cmd --permanent --zone=external --change-interface=enp1s0 firewall-cmd --permanent --zone=external --add-masquerade <span class="hljs-comment"><span class="hljs-comment">#    4G firewall-cmd --direct --permanent --passthrough ipv4 -t mangle -A POSTROUTING -o wwp6s0u1i1 -j TTL --ttl-set 64 firewall-cmd --permanent --zone=external --change-interface=wwp6s0u1i1 firewall-cmd --permanent --zone=internal --change-interface=br0 firewall-cmd --permanent --zone=internal --add-masquerade firewall-cmd --permanent --zone=internal --add-port=9091/tcp firewall-cmd --permanent --zone=internal --add-service=samba firewall-cmd --permanent --zone=internal --add-service=dns firewall-cmd --permanent --zone=internal --add-service=dhcp firewall-cmd --permanent --zone=internal --add-service=tftp firewall-cmd --permanent --zone=internal --add-service=rsyncd firewall-cmd --permanent --zone=internal --add-service=nfs firewall-cmd --permanent --zone=internal --add-service=ntp firewall-cmd --permanent --zone=internal --add-service=mountd firewall-cmd --permanent --zone=internal --add-service=rpc-bind firewall-cmd --permanent --zone=internal --add-service=ssh firewall-cmd --permanent --zone=internal --add-service=aria2 firewall-cmd --permanent --zone=internal --add-service=aria2-webui firewall-cmd --permanent --zone=internal --add-service=squid firewall-cmd --permanent --zone=internal --add-forward-port=port=80:proto=tcp:toport=3128:toaddr=192.168.2.1 firewall-cmd --permanent --zone=internal --add-forward-port=port=443:proto=tcp:toport=3129:toaddr=192.168.2.1 firewall-cmd --reload</span></span></code> </pre><br><pre> <code class="bash hljs">firewall-cmd --list-all-zones</code> </pre><br><pre> <code class="bash hljs">systemctl restart network.service systemctl restart firewalld.service</code> </pre><br><br> <b>UPD</b> <a href="https://habrahabr.ru/post/275551/">   .</a> </div><p>Source: <a href="https://habr.com/ru/post/273547/">https://habr.com/ru/post/273547/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../273533/index.html">Translation: What I learned by developing an API for the Microsoft cloud platform</a></li>
<li><a href="../273535/index.html">How we switched from Scala to Go</a></li>
<li><a href="../273537/index.html">The digest of interesting materials for the mobile # 134 developer (December 14-20)</a></li>
<li><a href="../273543/index.html">Simple Blender. Part 5, final</a></li>
<li><a href="../273545/index.html">Quick start in 5 minutes with Angular 2 beta</a></li>
<li><a href="../273549/index.html">Creating applications for Firebird with the use of various components and drivers: FireDac</a></li>
<li><a href="../273553/index.html">Comparison of css-frameworks / libraries on a live example. Part 1</a></li>
<li><a href="../273555/index.html">Forgotten word: environment</a></li>
<li><a href="../273557/index.html">The digest of interesting materials from the world of web development and IT for the last week No. 190 (December 13 - 20, 2015)</a></li>
<li><a href="../273559/index.html">The future of p2p payments: when the smartphone replaces cash</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>