<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Five ways to speed up Facebook API requests in practice</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It's no secret to anyone that HTTP requests to external servers are most often the bottleneck of web applications. Thus, the load time of the API requ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Five ways to speed up Facebook API requests in practice</h1><div class="post__text post__text-html js-mediator-article">  It's no secret to anyone that HTTP requests to external servers are most often the bottleneck of web applications.  Thus, the load time of the API request data is much longer than the time required to execute most of the most complex web application scripts. <br><br>  While working with the Facebook API, I have accumulated several recipes for query optimization: how to increase the speed of scripts, reduce their number and resource intensity. <br><br><img src="https://habrastorage.org/storage1/3da3ebed/72043ad6/8f917454/6ff9672b.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The methods outlined in this article only work with the Facebook API.  But I do not exclude that they may be applicable in other services that provide API. <br><a name="habracut"></a><br><h4>  Introduction </h4><br>  You probably have an idea for a web application that works with user data and its social graph Facebook.  And you have already opened the <a href="https://developers.facebook.com/docs">documentation</a> more than once and even managed to write a couple of scripts.  Let this be a ‚Äúbirthday present‚Äù application, and the first thing you should do is get a list of the user's friends and their birth dates. <br><br>  It's simple, you think: <br><ol><li>  <a href="https://developers.facebook.com/docs/authentication">I authorize the</a> user (I get the user <i>id</i> and <i>access_token</i> , which I use in further requests); </li><li>  <a href="https://developers.facebook.com/docs/reference/api/user">I get a list of</a> his friends (on exit I have an array with <i>id</i> and <i>name of</i> friends); </li><li>  for each id, I make a <a href="https://developers.facebook.com/docs/reference/api/user">request for user data</a> (in order to get <i>birthday</i> data, during authorization you need to <a href="https://developers.facebook.com/docs/authentication">request</a> <i>friends_birthday</i> permission). </li></ol><br>  Since your script runs on the server side, you should get all the data before they are output to the user.  And here you are faced with the first and most important problem: one request to the API takes 1-2 seconds.  So, just to get a list of all friends you need 2-4 seconds (depending on the number of friends). <br><br>  Let's try to calculate how long the script that displays the birthdays of 10 friends will run. <br><blockquote><pre> <code class="hljs bash">&lt;?php <span class="hljs-variable"><span class="hljs-variable">$start</span></span> = microtime(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-variable"><span class="hljs-variable">$app_id</span></span> = <span class="hljs-string"><span class="hljs-string">"YOUR_APP_ID"</span></span>; <span class="hljs-variable"><span class="hljs-variable">$app_secret</span></span> = <span class="hljs-string"><span class="hljs-string">"YOUR_APP_SECRET"</span></span>; <span class="hljs-variable"><span class="hljs-variable">$my_url</span></span> = <span class="hljs-string"><span class="hljs-string">"YOUR_URL"</span></span>; session_start(); <span class="hljs-variable"><span class="hljs-variable">$code</span></span> = <span class="hljs-variable"><span class="hljs-variable">$_REQUEST</span></span>[<span class="hljs-string"><span class="hljs-string">"code"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(empty(<span class="hljs-variable"><span class="hljs-variable">$code</span></span>)) {  <span class="hljs-variable"><span class="hljs-variable">$_SESSION</span></span>[<span class="hljs-string"><span class="hljs-string">'state'</span></span>] = md5(uniqid(rand(), TRUE)); //CSRF protection  <span class="hljs-variable"><span class="hljs-variable">$dialog_url</span></span> = <span class="hljs-string"><span class="hljs-string">'https://www.facebook.com/dialog/oauth?client_id='</span></span>    . <span class="hljs-variable"><span class="hljs-variable">$app_id</span></span> . <span class="hljs-string"><span class="hljs-string">'&amp;redirect_uri='</span></span> . urlencode(<span class="hljs-variable"><span class="hljs-variable">$my_url</span></span>) . <span class="hljs-string"><span class="hljs-string">'&amp;scope=user_birthday,friends_birthday&amp;state='</span></span> . <span class="hljs-variable"><span class="hljs-variable">$_SESSION</span></span>[<span class="hljs-string"><span class="hljs-string">'state'</span></span>];  <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>(<span class="hljs-string"><span class="hljs-string">"&lt;script&gt; top.location.href='"</span></span> . <span class="hljs-variable"><span class="hljs-variable">$dialog_url</span></span> . <span class="hljs-string"><span class="hljs-string">"'&lt;/script&gt;"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-variable"><span class="hljs-variable">$_REQUEST</span></span>[<span class="hljs-string"><span class="hljs-string">'state'</span></span>] == <span class="hljs-variable"><span class="hljs-variable">$_SESSION</span></span>[<span class="hljs-string"><span class="hljs-string">'state'</span></span>]) {  <span class="hljs-variable"><span class="hljs-variable">$token_url</span></span> = <span class="hljs-string"><span class="hljs-string">'https://graph.facebook.com/oauth/access_token?'</span></span>    . <span class="hljs-string"><span class="hljs-string">'client_id='</span></span> . <span class="hljs-variable"><span class="hljs-variable">$app_id</span></span> . <span class="hljs-string"><span class="hljs-string">'&amp;redirect_uri='</span></span> . urlencode(<span class="hljs-variable"><span class="hljs-variable">$my_url</span></span>)    . <span class="hljs-string"><span class="hljs-string">'&amp;client_secret='</span></span> . <span class="hljs-variable"><span class="hljs-variable">$app_secret</span></span> . <span class="hljs-string"><span class="hljs-string">'&amp;code='</span></span> . <span class="hljs-variable"><span class="hljs-variable">$code</span></span>;  <span class="hljs-variable"><span class="hljs-variable">$response</span></span> = file_get_contents(<span class="hljs-variable"><span class="hljs-variable">$token_url</span></span>);  <span class="hljs-variable"><span class="hljs-variable">$params</span></span> = null;  parse_str(<span class="hljs-variable"><span class="hljs-variable">$response</span></span>, <span class="hljs-variable"><span class="hljs-variable">$params</span></span>);  <span class="hljs-variable"><span class="hljs-variable">$graph_url</span></span> = <span class="hljs-string"><span class="hljs-string">"https://graph.facebook.com/me?access_token="</span></span> . <span class="hljs-variable"><span class="hljs-variable">$params</span></span>[<span class="hljs-string"><span class="hljs-string">'access_token'</span></span>];  <span class="hljs-variable"><span class="hljs-variable">$user</span></span> = json_decode(file_get_contents(<span class="hljs-variable"><span class="hljs-variable">$graph_url</span></span>));  <span class="hljs-variable"><span class="hljs-variable">$uid</span></span> = <span class="hljs-variable"><span class="hljs-variable">$user</span></span>-&gt;id;  //      <span class="hljs-variable"><span class="hljs-variable">$graph_url</span></span> = <span class="hljs-string"><span class="hljs-string">'https://graph.facebook.com/'</span></span>.<span class="hljs-variable"><span class="hljs-variable">$uid</span></span>.<span class="hljs-string"><span class="hljs-string">'/friends?limit=10&amp;access_token='</span></span> . <span class="hljs-variable"><span class="hljs-variable">$params</span></span>[<span class="hljs-string"><span class="hljs-string">'access_token'</span></span>];  <span class="hljs-variable"><span class="hljs-variable">$friends</span></span> = json_decode(file_get_contents(<span class="hljs-variable"><span class="hljs-variable">$graph_url</span></span>));  <span class="hljs-variable"><span class="hljs-variable">$time</span></span> = microtime(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) - <span class="hljs-variable"><span class="hljs-variable">$start</span></span>;  <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">'     %.4F .&lt;br/&gt;'</span></span>, <span class="hljs-variable"><span class="hljs-variable">$time</span></span>);  <span class="hljs-variable"><span class="hljs-variable">$n</span></span> = sizeof(<span class="hljs-variable"><span class="hljs-variable">$friends</span></span>-&gt;data);  <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-variable"><span class="hljs-variable">$i</span></span> = 0; <span class="hljs-variable"><span class="hljs-variable">$i</span></span> &lt; <span class="hljs-variable"><span class="hljs-variable">$n</span></span>; <span class="hljs-variable"><span class="hljs-variable">$i</span></span>++) {    <span class="hljs-variable"><span class="hljs-variable">$graph_url</span></span> = <span class="hljs-string"><span class="hljs-string">'https://graph.facebook.com/'</span></span> . <span class="hljs-variable"><span class="hljs-variable">$friends</span></span>-&gt;data[<span class="hljs-variable"><span class="hljs-variable">$i</span></span>]-&gt;id . <span class="hljs-string"><span class="hljs-string">'?access_token='</span></span> . <span class="hljs-variable"><span class="hljs-variable">$params</span></span>[<span class="hljs-string"><span class="hljs-string">'access_token'</span></span>];    <span class="hljs-variable"><span class="hljs-variable">$friend_data</span></span> = file_get_contents(<span class="hljs-variable"><span class="hljs-variable">$graph_url</span></span>);    //  json        //<span class="hljs-variable"><span class="hljs-variable">$friend</span></span> = json_decode(<span class="hljs-variable"><span class="hljs-variable">$friend_data</span></span>);    //<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>(<span class="hljs-variable"><span class="hljs-variable">$i</span></span>.<span class="hljs-string"><span class="hljs-string">' '</span></span>.<span class="hljs-variable"><span class="hljs-variable">$friend</span></span>-&gt;name.<span class="hljs-string"><span class="hljs-string">' - '</span></span>.<span class="hljs-variable"><span class="hljs-variable">$friend</span></span>-&gt;birthday);  } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {  <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>(<span class="hljs-string"><span class="hljs-string">"The state does not match. You may be a victim of CSRF."</span></span>); } <span class="hljs-variable"><span class="hljs-variable">$time</span></span> = microtime(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) - <span class="hljs-variable"><span class="hljs-variable">$start</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">'  %.4F .'</span></span>, <span class="hljs-variable"><span class="hljs-variable">$time</span></span>);</code> </pre></blockquote><br>  It took me 13 seconds for this!  Will your user wait so long?  I do not think.  And if the number of friends is measured in hundreds, or even a couple of thousand ... <br><br>  Let's start the optimization. <br><br><h4>  Method 1: We read only the required fields </h4><br>  When you request user data (the <a href="https://developers.facebook.com/docs/reference/api/user">User</a> object in the Graph API), Facebook defaults to you all the fields to which you have access.  You can get rid of redundant information by specifying which fields you need to return.  To do this, the request uses the <i>fields</i> parameter, in which the required fields are listed separated by commas.  For example, for our case it will be a query: <i>{user_id}? Fields = id, name, birthday</i> <br><ol><li>  Enable permissions in the <a href="https://developers.facebook.com/tools/explorer/%3Fmethod%3DGET%26path%3Dme">Graph API Explorer</a> by clicking <i>Get Access Token</i> and checking all the check boxes in <i>User Data Permissions</i> and <i>Friends Data Permissions</i> . </li><li>  Type <i>me</i> in the field after <i>https: graph.facebook.com/</i> </li><li>  Compare previous output with <i>me? Fields = id, name, birthday</i> </li></ol><br><img src="https://habrastorage.org/storage1/53f6a9d2/0fc5bdbb/a39cc20e/dce2fefb.png"><br><br>  Requests with the <i>fields</i> parameter are faster because they return only the necessary data.  They are faster transmitted over the network, as they are smaller.  They are also processed faster and use less memory. <br><br>  Although this method of optimization in this program has almost no effect on the total execution time, but it is this that should never be forgotten.  Read only the required fields for each request! <br><br><h4>  Method 2: We request the data of several objects in one request </h4><br>  Using the <i>ids</i> parameter you can select several objects that you want to receive.  At the same time, you can use the <i>fields</i> parameter to limit only the required fields of objects (objects must be of the same type).  For example, the query <a href="https://developers.facebook.com/tools/explorer/%3Fmethod%3DGET%26path%3D%253Fids%253D4%252C501012028">? Ids = 4.501012028</a> will allow two users to receive open data at once;) <br><br>  The number of objects that you can specify, separated by commas, is limited only by the maximum long URL.  Do not forget that the size of the response to the request also increases.  Therefore, it is reasonable to limit the number of objects in a single request.  For example, here is the answer, if you use the first and second methods. <br><img src="https://habrastorage.org/storage1/e08aa78b/cb47fde3/50fb5297/6f05b836.png"><br><br>  To use this method in our example, you need to rewrite the script. <br><blockquote><pre> $ n = sizeof ($ friends-&gt; data);
 $ graph_url = 'https://graph.facebook.com/?ids=';

 for ($ i = 0; $ i &lt;$ n; $ i ++) {
 $ graph_url. = $ friends-&gt; data [$ i] -&gt; id.  ',';
 }

 $ graph_url = substr ($ graph_url, 0, -1);
 $ graph_url. = '&amp; access_token ='.  $ params ['access_token'];
 $ friend_data = file_get_contents ($ graph_url);
 // decode json response and output data </pre></blockquote><br>  Now, instead of 10 requests, we use only one, respectively, the script has decreased to 4-5 seconds.  But we still need to get the data of all friends, not just 10. <br><br><h4>  Method 3: Use filtering and pagination </h4><br>  Pagination is just a splitting of information into ‚Äúpages‚Äù.  Using the <i>limit</i> parameter, we only received information about 10 friends.  To get the same information about the others, there is an <i>offset</i> parameter.  For example, the first ten friends: <a href="https://developers.facebook.com/tools/explorer/%3Fmethod%3DGET%26path%3Dme%252Ffriends%253Flimit%253D10%2526offset%253D0">me / friends? Limit = 10 &amp; offset = 0</a> , the second ten friends: <a href="https://developers.facebook.com/tools/explorer/%3Fmethod%3DGET%26path%3Dme%252Ffriends%253Flimit%253D10%2526offset%253D10">me / friends? Limit = 10 &amp; offset = 10</a> , etc. <br><br>  You can optimize script performance as follows: <br><ol><li>  Write the client part with Ajax requests to the server. </li><li>  Get the data of the first 10 friends and display them. </li><li>  While the data is displayed on the screen, load the next ‚Äúportion‚Äù of data. </li></ol><br>  Now, to display information, you do not need to wait until all parts of requests are processed.  In this case, for the first batch, you will already receive a sufficient amount of data in one request. <br><br>  Let us turn to more serious ways, which allow to receive tens of times more data in one request (and maybe all at once). <br><br><h4>  Method 4: Build FQL Queries (Facebook Query Language) </h4><br>  <a href="https://developers.facebook.com/docs/reference/fql">FQL</a> gives you the ability to use the SQL-style interface for querying data.  With it, you can more easily implement some queries that are not available through the Graph API.  The query form is as follows: <i>SELECT [fields] FROM [table] WHERE [conditions]</i> .  But FQL has many limitations (if you compare it with SQL).  For example, in <i>FROM</i> only one table can be used.  But you can use subqueries.  In FQL, you can use logical operators, <i>ORDER BY</i> and <i>LIMIT</i> constructs, and some other operators. <br><br>  To get the name and date of birth of the user, you need to make an FQL query to the user table.  For example, in the Graph API Explorer this will be the query <a href="https://developers.facebook.com/tools/explorer/%3Fmethod%3DGET%26path%3Dfql%253Fq%253DSELECT%2520uid%252C%2520name%252C%2520birthday_date%2520FROM%2520user%2520WHERE%2520uid%2520%253D%2520me%2528%2529">fql? Q = SELECT uid, name, birthday_date FROM user WHERE uid = me ()</a> .  And in order to get a list of id friends, use the query to the <i>friend friend</i> <a href="https://developers.facebook.com/tools/explorer/%3Fmethod%3DGET%26path%3Dfql%253Fq%253DSELECT%2520uid2%2520FROM%2520friend%2520WHERE%2520uid1%2520%253D%2520me%2528%2529">table? Q = SELECT uid2 FROM friend WHERE uid1 = me ()</a> . <br><br>  Let's try to merge two queries into one using an embedded query.  It's simple: <a href="https://developers.facebook.com/tools/explorer/%3Fmethod%3DGET%26path%3Dfql%253Fq%253DSELECT%2520uid%252C%2520name%252C%2520birthday_date%2520FROM%2520user%2520WHERE%2520uid%2520IN%2520%2528SELECT%2520uid2%2520FROM%2520friend%2520WHERE%2520uid1%2520%253D%2520me%2528%2529%2529">fql? Q = SELECT uid, name, birthday_date FROM user WHERE uid IN (SELECT uid2 FROM friend WHERE uid1 = me ())</a> .  Instead of dozens of requests, we received all the information we need in just one! <br><img src="https://habrastorage.org/storage1/3ef29f14/0a7236bd/b68146f8/f78c03f4.png"><br><br><blockquote><pre> // get a list of the user's friends and their birthdays
 $ graph_url = 'https://graph.facebook.com/fql?q=SELECT uid, name, birthday_date FROM user WHERE uid IN (SELECT uid2 FROM friend WHERE uid1 ='. $ uid. ') &amp; access_token ='.  $ params ['access_token'];
 $ frnds = file_get_contents ($ graph_url);
 // decode json response and output data </pre></blockquote><br>  There are many ways to optimize FQL queries.  Examine all the tables in the documentation.  But FQL is not the top of query optimization. <br><br>  Imagine that you need to get a list of the user's latest posts, his news feed, all unread notifications and new messages.  And all this, and more, needs to be done quickly.  You can, of course, parallelize queries by making them asynchronous.  But this is not our way. <br><br><h4>  Method 5: Batch Requests </h4><br>  Using the Graph API, you can process the data of a single query, even if it is an FQL query.  Batch Request allows you to send to the server in one request - a pack of several different requests.  The only limitation is up to 20 requests in one batch call.  Requests can be GET, POST and DELETE. <br><br>  For example, here is such a ‚Äúpackage‚Äù of requests: <br><ul><li>  Send new status with link. </li><li>  Get information about the latest status (new is not considered). </li><li>  Like the last status and write a comment. </li></ul><br><blockquote><pre> $ batched_request = '[{"method": "POST", "relative_url": "me / feed", "body": "message = Soon new post &amp; link = http: //habrahabr.ru/"}}';
 $ batched_request. = ', {"method": "GET", "name": "get-post", "relative_url": "me / feed? limit = 1"}';
 $ batched_request. = ', {"method": "POST", "relative_url": "{result = get-post: $. data.0.id} / likes"}';
 $ batched_request. = ', {"method": "POST", "relative_url": "{result = get-post: $. data.0.id} / comments", "body": "message = New automatic comment" } ';

 $ batched_request. = ']';

 $ url = 'https://graph.facebook.com/';
 $ param = array ();
 $ param ['access_token'] = $ params ['access_token'];
 $ param ['batch'] = $ batched_request;

 $ ch = curl_init ();
 curl_setopt ($ ch, CURLOPT_URL, $ url);
 curl_setopt ($ ch, CURLOPT_RETURNTRANSFER, true);
 curl_setopt ($ ch, CURLOPT_POSTFIELDS, $ param);
 $ ret = curl_exec ($ ch);

 // response processing
 if ($ ret == 'false') echo '= false =';
 curl_close ($ ch);
</pre></blockquote><br>  Batch requests must be sent using the POST method, so cURL is involved in the code above.  It is also easier to work with possible errors. <br><br>  All uses of Batch Requests are not described in this article.  You can learn more about them in the <a href="https://developers.facebook.com/docs/reference/api/batch">documentation</a> . </div><p>Source: <a href="https://habr.com/ru/post/132794/">https://habr.com/ru/post/132794/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../132789/index.html">Contest entries in the LiveStreet CMS design competition</a></li>
<li><a href="../132790/index.html">What do you use for automated testing of iOS applications?</a></li>
<li><a href="../132791/index.html">How I got the opportunity to easily get up on a gloomy autumn-winter morning or a review of one interesting alarm clock</a></li>
<li><a href="../132792/index.html">LG SMART TV (review, content issues)</a></li>
<li><a href="../132793/index.html">New free online courses from Stanford</a></li>
<li><a href="../132795/index.html">Another ardent greetings to the masters of the pirate</a></li>
<li><a href="../132796/index.html">Introducing Evernote Clearly: reading from the screen is now convenient</a></li>
<li><a href="../132798/index.html">Quality Monitor - Increase Development Pleasure</a></li>
<li><a href="../132799/index.html">"Classic" friendly url in ASP.NET MVC</a></li>
<li><a href="../132800/index.html">Fakeroot, XCode and PackageMaker</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>