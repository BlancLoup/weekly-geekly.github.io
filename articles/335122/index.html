<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Speed ‚Äã‚Äãup your website using machine learning.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many of us are constantly thinking about the performance of web applications: they achieve 60 FPS on slow phones, load their assets in perfect order, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Speed ‚Äã‚Äãup your website using machine learning.</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/web/693/35e/986/69335e9861d54a1ab4f1a89befa044b8.png"></div><br>  Many of us are constantly thinking about the performance of web applications: they achieve 60 FPS on slow phones, load their assets in perfect order, cache everything they can, and a lot more. <br><br>  But isn't this idea of ‚Äã‚Äãweb application performance too limited?  From the user's point of view, all these actions are just a tiny piece of a big performance pie. <br><br>  In this article we will go through all the stages of using the site, as if an ordinary person did this by measuring the duration of each of them.  And we will pay special attention to a specific step on one particular site, which can be even more optimized.  I want to believe that the solution (which will be machine learning) can be used in many different cases on different sites. <br><a name="habracut"></a><br><h2>  Problem </h2><br>  As an example, let's take a site where some users can sell things that they don‚Äôt need, so that others can buy a new treasure. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      When a user registers a new product for sale, he selects a category, then the required advertising package, fills in the details, scans the advertisement, and then publishes it. <br><br>  Confuses the first step - the choice of category. <br><br>  First of all, there are 674 categories, and the user can get into a dead end, in which of them ‚Äúshove‚Äù, say, a broken kayak (Steve Krug perfectly said: <a href="https://www.amazon.com/Dont-Make-Me-Think-Usability/dp/0321344758">do not make me think</a> ). <br><br>  Secondly, even when it becomes clear which category / subcategory / subcategory a product belongs to, the process still takes about 12 seconds. <br><br>  If you say that you can reduce the page load time by 12 seconds, you would be expected to be surprised.  Well, why not go crazy enough to save 12 seconds elsewhere, eh? <br><br>  As Julius Caesar said: "12 seconds is 12 seconds, man." <br><br>  The first thing that comes to mind is that if you feed the title, description and price of a product with a properly trained machine learning model, it will determine which category the product belongs to. <br><br>  So instead of spending time choosing a category, a user could spend 12 extra seconds looking at homemade bunk beds on reddit. <br><br><h2>  Machine learning - why should you stop being afraid of him </h2><br>  What does a developer usually do who knows absolutely nothing about machine learning, except that programs on it can play video games and outperform the best chess players in the world? <br><br><ul><li>  Google Machine Learning. </li><li>  Click on the links. </li><li>  Discover Amazon Machine Learning. </li><li>  Understand that you don't need to know anything about machine learning. </li><li>  Relax. </li></ul><br><h2>  Process as it is </h2><br>  It is fully described in the Amazon <a href="https://aws.amazon.com/machine-learning/">ML documentation</a> .  If you are interested in this idea, then plan ~ 5 hours and read the documentation, here we will not consider it. <br><br>  After reading the documentation, we can formulate such a plan: <br><br><ul><li>  Write the data to a CSV file.  Each row must be an element (for example, a kayak), columns must be headings, descriptions, prices and categories. </li><li>  Download to AWS S3. </li><li>  ‚ÄúTrain‚Äù the machine on this data (everything is done with the help of a visual wizard with integrated help).  A small cloud robot must know how to predict a category based on name, description and price. </li><li>  Add the code to the frontend below, which takes the title / description / price entered by the user, sends them to the final prediction point (it is <b>automatically</b> created by Amazon) and shows the predicted category on the screen. </li></ul><br><h2>  Site example </h2><br>  You can take advantage of the beautiful form that mimics the key aspects of this process. <br><br>  These exciting results will not let you lose interest during the upcoming boring explanations.  Just believe that the proposed category was really predicted on the basis of machine learning. <br><br>  Let's try selling a fridge: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/8c8/ebe/260/8c8ebe260eae4d87acbb3974bb0cec33.png"></div><br><br>  How about the aquarium: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/854/e60/509/854e605093744d6ba53bc32d14eed665.png"></div><br><br>  A little cloud robot knows what an aquarium is! <br><br>  Very cool, right? <br><br>  (The form was created using React / Redux, jQuery, MobX, RxJS, Bluebird, Bootstrap, Sass, Compass, NodeJS, Express and Lodash. And a WebPack for building. The finished item is just over 1 MB - #perfwin). <br><br>  Good, and now about less impressive things. <br><br>  Since at the beginning there was just self-indulgence, now we need to get real data from somewhere.  For example, 10,000 items in several dozen categories.  A local trading site was taken, and a small parser was written that saved URLs and DOM to CSV.  It took about four hours: half the time spent on the whole machine learning experiment. <br><br>  The finished CSV was uploaded to S3 and passed through a wizard to set up and train the program.  The total CPU time for learning was 3 minutes. <br><br>  The interface works in real time, so you can check if it really returns me what you need if you pass certain parameters to it ,. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/07b/298/80b/07b29880b2eb414e9b59d15d2cdfd275.png"></div><br><br>  OK, it works. <br><br>  And now you do not want to pull the Amazon API directly from the browser so that it is not publicly available.  Therefore, remove it from the Node-server. <br><br><h2>  Backend code </h2><br>  The general approach is quite simple.  We transfer API identifier and data, and it sends the forecast. <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> AWS = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'aws-sdk'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> machineLearning = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AWS.MachineLearning(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> params = { <span class="hljs-attr"><span class="hljs-attr">MLModelId</span></span>: <span class="hljs-string"><span class="hljs-string">'some-model-id'</span></span>, <span class="hljs-attr"><span class="hljs-attr">PredictEndpoint</span></span>: <span class="hljs-string"><span class="hljs-string">'some-endpoint'</span></span>, <span class="hljs-attr"><span class="hljs-attr">Record</span></span>: {}, }; machineLearning.predict(params, (err, prediction) =&gt; { <span class="hljs-comment"><span class="hljs-comment">//    ! });</span></span></code> </pre> <br>  <code>record</code> , sorry, meaning <code>Record</code> , is a JSON object, where properties are what the model is trained on (name, description, and price). <br><br>  Not to leave the unfinished code in the article, here‚Äôs the entire server.js file that provides the end point <code>/predict</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> bodyParser = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'body-parser'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> AWS = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'aws-sdk'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> app = express(); app.use(express.static(<span class="hljs-string"><span class="hljs-string">'public'</span></span>)); app.use(bodyParser.json()); AWS.config.loadFromPath(<span class="hljs-string"><span class="hljs-string">'./private/aws-credentials.json'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> machineLearning = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AWS.MachineLearning(); app.post(<span class="hljs-string"><span class="hljs-string">'/predict'</span></span>, (req, res) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> params = { <span class="hljs-attr"><span class="hljs-attr">MLModelId</span></span>: <span class="hljs-string"><span class="hljs-string">'my-model-id'</span></span>, <span class="hljs-attr"><span class="hljs-attr">PredictEndpoint</span></span>: <span class="hljs-string"><span class="hljs-string">'https://realtime.machinelearning.us-east-1.amazonaws.com'</span></span>, <span class="hljs-attr"><span class="hljs-attr">Record</span></span>: req.body, }; machineLearning.predict(params, (err, data) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(err); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { res.json({ <span class="hljs-attr"><span class="hljs-attr">category</span></span>: data.Prediction.predictedLabel }); } }); }); app.listen(<span class="hljs-number"><span class="hljs-number">8080</span></span>);</code> </pre> <br>  And the contents of aws-credentials.json: <br><br><pre> <code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> express = <span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> bodyParser = <span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(<span class="hljs-string"><span class="hljs-string">'body-parser'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> AWS = <span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(<span class="hljs-string"><span class="hljs-string">'aws-sdk'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> app = express(); app.<span class="hljs-keyword"><span class="hljs-keyword">use</span></span>(express.<span class="hljs-keyword"><span class="hljs-keyword">static</span></span>(<span class="hljs-string"><span class="hljs-string">'public'</span></span>)); app.<span class="hljs-keyword"><span class="hljs-keyword">use</span></span>(bodyParser.json()); AWS.config.loadFromPath(<span class="hljs-string"><span class="hljs-string">'./private/aws-credentials.json'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> machineLearning = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AWS.MachineLearning(); app.post(<span class="hljs-string"><span class="hljs-string">'/predict'</span></span>, (req, res) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> params = { MLModelId: <span class="hljs-string"><span class="hljs-string">'my-model-id'</span></span>, PredictEndpoint: <span class="hljs-string"><span class="hljs-string">'https://realtime.machinelearning.us-east-1.amazonaws.com'</span></span>, Record: req.body, }; machineLearning.predict(params, (err, data) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) { console.log(err); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { res.json({ category: data.Prediction.predictedLabel }); } }); }); app.listen(<span class="hljs-number"><span class="hljs-number">8080</span></span>);</code> </pre> <br>  (Obviously, the <code>/private</code> directory is in <code>.gitignore</code> , so it will not be checked.) <br><br>  Fine, the backend is done. <br><br><h2>  Frontend code </h2><br>  The code responsible for the form is quite simple.  He does the following: <br><br><ul><li>  Listens for <code>blur</code> events in the corresponding fields. </li><li>  Gets values ‚Äã‚Äãfrom form elements. </li><li>  Sends them with a POST request to the endpoint <code>/predict</code> created in the above code. </li><li>  Places the prediction in the category field and shows the entire section. </li></ul><br><pre> <code class="javascript hljs">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> titleEl = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'title-input'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> descriptionEl = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'desc-input'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> priceEl = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'price-input'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> catSuggestionsEl = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'cat-suggestions'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> catSuggestionEl = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'suggested-category'</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">predictCategory</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fetchOptions = { <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-attr"><span class="hljs-attr">headers</span></span>: { <span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'application/json'</span></span>, }, <span class="hljs-attr"><span class="hljs-attr">body</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify({ <span class="hljs-attr"><span class="hljs-attr">title</span></span>: titleEl.value, <span class="hljs-attr"><span class="hljs-attr">description</span></span>: descriptionEl.value, <span class="hljs-attr"><span class="hljs-attr">price</span></span>: priceEl.value, }) }; fetch(<span class="hljs-string"><span class="hljs-string">'/predict'</span></span>, fetchOptions) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function"> =&gt;</span></span> response.json()) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">prediction</span></span></span><span class="hljs-function"> =&gt;</span></span> { catSuggestionEl.textContent = prediction.category; catSuggestionsEl.style.display = <span class="hljs-string"><span class="hljs-string">'block'</span></span>; }); } <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelectorAll(<span class="hljs-string"><span class="hljs-string">'.user-input'</span></span>).forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">el</span></span></span><span class="hljs-function"> =&gt;</span></span> { el.addEventListener(<span class="hljs-string"><span class="hljs-string">'blur'</span></span>, predictCategory); }); })();</code> </pre> <br>  That's all.  This is 100% of the code required for the cloud robot to use user data and predict the category the item belongs to. <br><br><h2>  Shut up and take my money </h2><br>  Keep your hats friends, all this magic does not come for free ... <br><br>  The model we used for the example (trained in 10,000 lines / 4 columns) takes 6.3 MB.  Since we have an endpoint waiting to receive requests, the memory consumption can be considered at 6.3 MB.  The cost is $ 0.0001 / hour.  Or about eight bucks a year.  For each forecast, a fee of $ 0.0001 is also charged.  So do not use predictions in vain. <br><br>  Of course, not only Amazon, offers such services.  Google has <a href="https://www.tensorflow.org/">TensorFlow</a> , but they have a completely destructive <a href="https://www.tensorflow.org/get_started/get_started">start-up guide</a> from the very first lines.  Microsoft also offers <a href="https://azure.microsoft.com/en-us/services/machine-learning/">a machine learning model</a> .  Microsoft Azure Machine Learning is far superior to Amazon.  Iteration is much faster because you can add / delete columns without reloading files.  Our training, which takes 11 minutes on Amazon, takes 23 seconds on Azure.  And, by the way, their ‚Äústudio‚Äù interface is a very well-made web application. <br><br><h2>  What's next? </h2><br>  The above example is definitely contrived.  And here a screenshot is not posted where the program took the toaster for the horse.  Still, it's pretty damn awesome.  An ordinary person can try machine learning and perhaps make some improvements for users. <br><br>  It would be possible to list all possible problems, but it will be much more interesting if you find them yourself.  So go, try, and succeed. </div><p>Source: <a href="https://habr.com/ru/post/335122/">https://habr.com/ru/post/335122/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../335106/index.html">Basics of working with LongPoll server VKontakte</a></li>
<li><a href="../335110/index.html">How the KOMPAS-3D math library turned into a C3D Toolkit for CAD developers ‚Üí part 2</a></li>
<li><a href="../335112/index.html">Model-View-Intent and Load / Update Indicator</a></li>
<li><a href="../335114/index.html">Interactive recommenders: how to create, how to work</a></li>
<li><a href="../335120/index.html">RailsClub 2017: we are waiting for all rubists on September 23 in Moscow</a></li>
<li><a href="../335128/index.html">Getting started with Wagtail CMS (Django) and GraphQL</a></li>
<li><a href="../335132/index.html">Dedicated servers based on Intel Xeon processors Skylake-SP</a></li>
<li><a href="../335134/index.html">WiFiBeat: We detect suspicious traffic in a wireless network</a></li>
<li><a href="../335136/index.html">Intelligent Automatic Pet Feeder Based on Arduino - STEP 1</a></li>
<li><a href="../335138/index.html">RequestQueueLimitPerSession and its distribution to older versions of .net</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>