<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The complexity of building Python3 + Qt5 applications under Windows</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently it took me to make a small program under Windows. Previously, I could not develop under it. 
 The program itself is simple, it was written re...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The complexity of building Python3 + Qt5 applications under Windows</h1><div class="post__text post__text-html js-mediator-article">  Recently it took me to make a small program under Windows.  Previously, I could not develop under it. <br>  The program itself is simple, it was written relatively quickly.  Much more time was taken away by its assembly under Windows.  It is clear that the selected tools (Python3 + Qt5) are not native, but universal, but it took me so much time to build. <br>  Accordingly, I want to share the practice, maybe someone else will have to knock his forehead on this wall. <br>  Under the cut, the instructions come out of how easy it is to build PyQt5 applications in single-file.exe that do not require an installer. <br><a name="habracut"></a><br>  The most well-known solutions for my task - assembling python applications in .exe are: py2exe, cx_freeze, and pyinstaller.  About each written a lot of things.  But very often the authors sin with a hack - the program is easily and quickly assembled and started ... on the same computer.  Needless to say that these are two big differences - the launch on the dev-environment and the user?  And so it will work for me without any assemblies and dances with a tambourine.  Also, which users will install Qt for themselves? <br><br>  For each tool there is a tutorial.  But each had its own problems: one did not start (the pyinstaller still supports the 3rd python in experimental mode), the other collected what it could not launch, the third didn‚Äôt collect anything for a long time, berating everything around. <br>  After a long battle, py2exe was chosen. <br><br>  The secret of success in the correct installation of components from the correct sources (I do not give direct links, since they are still obsolete, I write what to look for): <br><ul><li>  Win XP 32-bit (or another, which you take for the base - I specifically took the oldest system) </li><li>  Python 3.4 - install from <a href="http://www.python.ord/download">www.python.ord / download</a> Windows x86 msi installer.  You can immediately add C: \ Python34 \ to% PATH% </li><li>  PyWin32 - we put pywin32-219.win32.py3.4.exe with sf.net </li><li>  Qt5.5 - set from the official website qt.io.  At the same time, the mingw4.9.2 compiler is installed. </li><li>  After installation, add C: \ Qt \ Tools \ mingw492_32 \ bin to% PATH%. </li><li>  Git for Windows - we need it anyway, we install it from git-scm.com </li><li>  PyQt5 - download and install riverbankcomputing.co.uk win32 x86 installer </li><li>  SIP - I still did not understand why, but the same riverbankcomputing.co.uk did not bother to assemble the service module, so we download win files, unpack, it is convenient to continue working in the Git Bash console: </li><li>  python configure.py -p win32-g ++ </li><li>  mingw32-make.exe </li><li>  mingw32-make.exe install. </li><li>  Of course, the installation will not work (. Fortunately, we need to put only 3 files. We go with our hands to the sipgen / folder subfolder and copy sip.exe to C: \ Python34. </li><li>  Then go to ../siplib and </li><li>  copy sip.pyd c: \ python34 \ Lib \ site-packages </li><li>  strip /c/Python34/Lib/site-packages/sip.pyd </li><li>  Finally, copy the .h file: </li><li>  cp sip.h / c / Python34 / include / </li><li>  py2exe - install in the native way: python -m pip install py2exe </li><li>  pyreadline is the same: python -m pip install pyinstaller </li><li>  7-Zip - from the site 7-zip.org download x86 exe </li><li>  7-zip extra - useful add-ons we download from there, unpack it into the folder with the installed 7-zip folder.  On conflicts txt-files can be hammered. </li><li>  Resource Hacker - download angusj.com - however, if you are not going to replace the default program icon with your own, then you will not need it.  Or you can replace it with windres, which comes bundled with mingw - but I already had it done with RH. </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I share my setup.py: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> distutils.core <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> setup <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os, sys <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> py2exe <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> glob <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> glob <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PyQt5 NAME=<span class="hljs-string"><span class="hljs-string">"Proga"</span></span> qt_platform_plugins = [(<span class="hljs-string"><span class="hljs-string">"platforms"</span></span>, glob(PyQt5.__path__[<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-string"><span class="hljs-string">r'\plugins\platforms\*.*'</span></span>))] data_files.extend(qt_platform_plugins) msvc_dlls = [(<span class="hljs-string"><span class="hljs-string">'.'</span></span>, glob(<span class="hljs-string"><span class="hljs-string">r'C:\Windows\System32\msvc?100.dll'</span></span>))] data_files.extend(msvc_dlls) <span class="hljs-comment"><span class="hljs-comment"># print(data_files) sys.argv.append('py2exe') setup( data_files=data_files, windows=[ { "script": "pyftp1.py", "icon_resources": [(0, "resources/favicon.ico")] } ], # zipfile=None, options={ "py2exe": { "includes":["sip", "atexit",], #       atexit   , sip   -      # "packages": ['PyQt5'], "compressed": True, "dist_dir": "dist/" + NAME, # "bundle_files": 0, #   (          msvc*.dll # "zipfile": None, #   "optimize": 2, } } )</span></span></code> </pre> <br><br>  This is a minimum program.  Now you can build the application itself: <br><pre> <code class="python hljs">python setup.py py2exe</code> </pre><br><br>  At the output we get a folder with the finished prog in dist. <br>  This is good, but not always convenient for users.  You can set an installer creator on this folder, such as Inno Setup and get msi.  In my case, it was necessary to ensure the operation of the program with minimal user rights - precisely without the right to install lib. <br><br>  So I went ahead and packed into 1 file using 7-zip.  The scheme is as follows: create a 7z-archive and a special SFX-head and config are docked to it.  The head unpacks the archive into a temporary folder, looks into the config and launches the necessary exe-file.  Going like this: <br>  cat 7zS.sfx resources / config.txt Proga.7z&gt; Proga.exe <br><br>  You can specify <a href="http://7zsfx.info/en/">various options</a> in the config file, I set the minimum: <br><pre> <code class="hljs erlang-repl">;!@Install@!UTF-<span class="hljs-number"><span class="hljs-number">8</span></span>! Title=<span class="hljs-string"><span class="hljs-string">"Proga"</span></span> RunProgram=<span class="hljs-string"><span class="hljs-string">"Proga\\pyftp1.exe"</span></span> ;!@InstallEnd@!</code> </pre><br><br>  The only drawback is the ugly picture of the exe file - the standard unpacker.  This is where we replace the picture with the one we need: <br>  RESHACKER.exe -addoverwrite Proga.exe, Proga.exe, resources / favicon.ico, ICONGROUP, MAINICON, 0 <br><br>  In order not to suffer with this all in the console, I made a small Makefile: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># start settings DIST=dist # change NAME also in setup.py and resource/config.txt NAME=Proga EXT=exe # final name and location of the built program FINAL=$(DIST)/$(NAME).$(EXT) # external programs 7ZIPDIR="C:\Program Files\7-Zip" RESHACKER="/c/Program\ Files/Resource\ Hacker/ResourceHacker.exe" # intermediate steps # no icon version of program NOICON=$(DIST)/$(NAME)_no_icon.$(EXT) # name of .7z archive 7Z_BASENAME=$(NAME).7z 7Z=$(DIST)/$(7Z_BASENAME) # folder with ready .exe PROGDIR=$(DIST)/$(NAME) all: $(FINAL) $(FINAL): $(NOICON) # change icon "$(RESHACKER)" -addoverwrite $(NOICON), $(FINAL), resources/favicon.ico, ICONGROUP, MAINICON, 0 $(NOICON): $(7Z) #build autorunning sfx with default icon cat $(7ZIPDIR)/7zS.sfx resources/config.txt $(7Z) &gt; $(NOICON) $(7Z): exe # compress program folder to .7z cd $(DIST); $(7ZIPDIR)\\\7z.exe a $(7Z_BASENAME) $(NAME) exe: $(DIST) # build program itself python setup.py py2exe $(DIST): # create dist directory # echo $(DIST)/ clean: rm -rf $(DIST)/*</span></span></code> </pre><br><br>  Now you can very easily reassemble the program: <br><pre> <code class="bash hljs">mingw492-make.exe clean all</code> </pre><br><br>  Successes in assembly! <br>  Tell us about your experience! </div><p>Source: <a href="https://habr.com/ru/post/264233/">https://habr.com/ru/post/264233/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../264221/index.html">Oracle Exadata, or About the Use of Engineered Systems (Part 2)</a></li>
<li><a href="../264223/index.html">Simple plan-fact analysis in Power BI Desktop. Part Two - Visualization</a></li>
<li><a href="../264225/index.html">Parsim pod from Perl 5 with Perl 6</a></li>
<li><a href="../264227/index.html">Underground carders market. Translation of the book "KingPIN". Chapter 1. "Key"</a></li>
<li><a href="../264229/index.html">Calque - a calculator that is more convenient than the browser console</a></li>
<li><a href="../264235/index.html">Mobile phones for / against special services</a></li>
<li><a href="../264237/index.html">Bikes of field engineers - installation and service of VKS / KC</a></li>
<li><a href="../264239/index.html">Special SIM card plus Internet telephony or a "vulture with legs" for everyone</a></li>
<li><a href="../264241/index.html">Introduction to machine learning with scikit-learn (translation of documentation)</a></li>
<li><a href="../264243/index.html">CAD technology</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>