<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SQLite Optimization for iOS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚ÄúBut for a replacement for fopen ()‚Äù 
 - About SQLite 


 And also, most likely, under Android, BlackBerry and in the sandbox of browsers for web appl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SQLite Optimization for iOS</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/568/116/04a/56811604aab4a5c8155d881235783de7.png"><br><br><blockquote>  <i>‚ÄúBut for a replacement for fopen ()‚Äù</i> <br>  - About SQLite <br></blockquote><br><br>  And also, most likely, under Android, BlackBerry and in the sandbox of browsers for web applications, but I did not check. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  Why it may be necessary to work with SQLite directly? </h1>  Any experienced iOS developer immediately reproaches me for using SQLite directly (or rather, not directly, but through FmDb, but it's almost the same as directly).  He will say that you need to use CoreData, because  It does all sorts of nishtyakov automatically, such as Undo and Redo.  And in it you can draw beautiful schemes, which are then nice to show to the customer.  And in android, for example, there is OrmLite. <br><br>  And I agree - but until then, until you have the base has passed, say, for 10 tables of 500,000 entries in each.  And if there are 52 tables, and there are especially fat tables of a million and more?  And the database needs to be synchronized with the server through the third format, besides the customer is critical, will the synchronization last for an hour or five?  If you have met tasks of this size, welcome to the cut!  If you haven‚Äôt met it, it‚Äôs the same, because no one is immune from projects with big data, even if they are mobile and less. <a name="habracut"></a><br><br><h1>  Sequence of query operators </h1> The fact is that when we are taught to work with a database, in most cases we are taught to work with the best enterprise solutions.  For example, I was taught at the Institute on Oracle, someone - on MS SQL.  But SQLite is many times simpler - for example, it follows from the epigraph to an article taken from the <a href="http://www.sqlite.org/about.html">official site of</a> SQLite. <br><br>  Quite by chance I noticed that <br><br> <code>SELECT * FROM tablename WHERE col1 LIKE '%string%' AND col2 = 123456</code> <br> <br>  works 3-4 times slower than <br><br> <code>SELECT * FROM tablename WHERE col2 = 123456 AND col1 LIKE '%string%'</code> <br> <br>  on a table of, say, 300,000 records.  We just swapped the operators, and how the result has changed! <br><br>  In the textbooks on databases, most likely, they don‚Äôt even focus on such features, and they do it right - in all enterprise solutions there are query optimizers.  For example, on MS SQL Server 2008 Web Edition, there is no difference on the same data and the same requests. <br><br>  But on SQLite there is.  This needs to be remembered.  In the SQLite world, more ‚Äúsimple‚Äù operations should always go to the left of more ‚Äúcomplex‚Äù ones. <br><br><h1>  SQLite database can and should be indexed too </h1><br>  When thinking of SQLite as an alternative to fopen, a database without stored procedures, semaphores and users, you forget that it, like any normal database, supports indexes.  There is so much written about them that you should not focus on syntactic features - just remember that as soon as the size of the database exceeds 50,000 lines, it needs to be indexed.  And when using complex queries - before. <br><br>  I will allow myself only a small note - indexing is best done after the basic queries are written, based on their analysis.  When designing a database, when the developer does not know by heart the entire business logic of the application, he may be mistaken as to which field will most often search / select.  However, having SQL queries before your eyes, writing the correct index is worth nothing. <br><br><h1>  If you often do a selection of several tables, it makes sense to cache the data </h1>  On one of the projects, at the start of the application, it was necessary to ask the user to choose the car he wants to work with.  In order to create a complete description of the machine, it was necessary to refer to several tables: <ul><li>  Year of issue </li><li>  Manufacturer </li><li>  Model </li><li>  Equipment </li><li>  Some other technical characteristics that the customer wished to show when choosing a machine.  For example, MPG (miles per gallon, an analogue of our kilometers per liter). </li></ul><br>  Making a request on five tables and compiling a list of machines, we slowed down the iPhone to a response of 6-8 seconds on each picker.  There are two ways out - when you first start (in our case, when synchronizing), you can either create a view with all the possible data, or, if it is more convenient, save data objects directly to your hard disk.  Also once, at a convenient moment when the user knows about the delay and is ready to wait. <br><br>  It is more convenient to save objects if the presentation would have to include for each, say, a machine, several fields from the picking table.  In the database, this would lead to the inevitable duplication of lines (if you connect one-to-many to several lines of picking parameters, you would have to create several identical lines with the vehicle ID and other parameters), and in the object all data will be stored in one copy. <br><br><h1>  SQLite - single-threaded database </h1>  Not directly related to optimization, but this also should not be forgotten.  Accessing a SQLite database of two threads simultaneously will inevitably cause crash.  There are two ways out: <br><ul><li>  Synchronize calls with the @synchronized directive.  This is if it's too late to change the architecture, as I did; </li><li>  If the task is laid out at the design stage, start a query manager based on NSOperationQueue.  It insures against errors automatically, and what is done automatically is often done without errors. </li></ul>  In general, it is always better to access the database from minor threads, even if the UI thread does nothing except scrolling the wait indicator.  Time to write delegate methods and asynchronize business logic will more than pay for the positive user experience. <br><br><h1>  Conclusion </h1>  All that I have listed above, it was only a special case.  There is no universal optimization task that can be simulated in 1.5 days or 10% of the total project time.  This has to do as needed.  The main rule that has always helped me to choose the right way to optimize is that the <b>time spent on the sample should not increase with the size of the base, except in special cases</b> .  It should remain about the same as a hundred records, and a hundred thousand. <br><br>  And another rule, the favorite phrase of my boss - do not optimize what does not need optimization.  Often it does not matter to the user whether your code will be executed one millisecond or one hundred, and it is important for the customer whether you delayed the project for a day or passed it on time. </div><p>Source: <a href="https://habr.com/ru/post/135337/">https://habr.com/ru/post/135337/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../135332/index.html">Detection of elliptical particles on micrographs. New algorithm for finding ellipses in the image</a></li>
<li><a href="../135333/index.html">Sites of the Prime Minister and the Government of the Russian Federation have passed on the license Creative Commons</a></li>
<li><a href="../135334/index.html">Pop-up authorization VKontakte for OAuth 2.0</a></li>
<li><a href="../135335/index.html">Setting up and creating an application for publishing on Facebook timeline</a></li>
<li><a href="../135336/index.html">New style editor and 3D display of DOM-structure of the page in Firefox 11</a></li>
<li><a href="../135338/index.html">Rope like in ‚ÄúCut the Rope‚Äù</a></li>
<li><a href="../135339/index.html">Let css search or database in HTML 2</a></li>
<li><a href="../135340/index.html">The code in the style of "dump of the stream of consciousness"</a></li>
<li><a href="../135341/index.html">Create a lightbox effect with CSS3</a></li>
<li><a href="../135342/index.html">Simple sharing with Facebook and Twitter</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>