<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write and debug the component for GWT and Vaadin</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The Google Web Toolkit and Vaadin frameworks do quite well when you just use them. If suddenly you need to expand their functionality, then you have t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write and debug the component for GWT and Vaadin</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/fd4/dd9/aa0/fd4dd9aa0a874d7faa3ae6f7e9194719.png" alt="image"></div><br><br>  The Google Web Toolkit and Vaadin frameworks do quite well when you just use them.  If suddenly you need to expand their functionality, then you have to seriously sweat.  In this article I want to tell you how to write a simple component on GWT, add the Vaadin server part to it and use it in my application.  I will not create a completely empty GWT / Vaadin project and from the very beginning set up a GWT compilation, instead I will take an application based on the <a href="https://www.cuba-platform.com/">CUBA.Platform</a> , in which I implement the component itself, and then I will try it.  So it will be seen how well everything will fit into this application.  I would like to pay special attention to debugging the component, since it is non-trivial and always causes difficulties for developers. <br><br>  I want to warn you that not everything described in the article is related to GWT and Vaadin, some of the steps and techniques are applicable only in the context of using CUBA.Platform, due to this, setting up the environment and some routine actions are greatly simplified. <br><a name="habracut"></a><br><h2>  Environment preparation </h2><br>  We will use for the experiments an empty project created in <a href="https://www.cuba-platform.com/ru/download">CUBA Studio</a> .  CUBA is our platform for developing Java business applications, which allows you to quickly create a data model and application interface, define the logic of working with data and manage user rights.  At the core of the UI platform, the Vaadin web framework is actively used, which allows us to implement many interesting ideas. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To begin with, we will create a GWT module that will be compiled into JavaScript.  Perform the 'Create web toolkit module' action in Studio.  This is a simple auxiliary operation that does not make sense to perform manually.  Studio will generate the AppWidgetSet.gwt.xml module GWT descriptor, the directory for the module and an empty package, as well as add the necessary tasks to the build description. <br><br>  The next step is to run the 'Create or update IDE project files' action to generate IntelliJ IDEA project files, and go to write the component code to the IDE. <br><br>  To program the component itself, we don‚Äôt need any special IDE features besides highlighting Java code, so it‚Äôs not necessary to use IntelliJ Idea, with the same success we can use Eclipse or Netbeans.  Thanks to Google Web Toolkit, we can use familiar Java tools, and this is a great advantage when developing large-scale projects. <br><br><h2>  Writing a component </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a2e/5ae/7a8/a2e5ae7a84f84d8e9dc32d7e7402787a.png" alt="image"></div><br>  The component itself will be quite simple - the rating field in the form of 5 stars.  This is an input field in which the user selects a rating using the mouse.  It has a status on the server and the display should change when it changes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/d66/bd6/e29/d66bd6e2906e41b1ab666fe5a821f579.png" alt="image"></div><br>  This is what our new web-toolkit module looks like in the Idea project window.  The root package contains the GWT module descriptor. <br><div class="spoiler">  <b class="spoiler_title">AppWidgetSet.gwt.xml</b> <div class="spoiler_text"><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE module PUBLIC "-//Google Inc.//DTD Google Web Toolkit 1.7.0//EN" "http://google-web-toolkit.googlecode.com/svn/tags/1.7.0/distro-source/core/src/gwt-module.dtd"&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">inherits</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.haulmont.cuba.web.toolkit.ui.WidgetSet"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </div></div><br>  It inherits the base module CUBA.Platform and is the starting point of the entire client part of our application (the one that runs in the browser).  By default, GWT component implementations must be in the 'client' subpackage.  Create a client package and in it a subfield ratingfield. <br><br>  The first part of our component is the GWT widget.  The RatingFieldWidget class, which we will place in the web-toolkit module: <br><div class="spoiler">  <b class="spoiler_title">RatingFieldWidget.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.haulmont.ratingsample.web.toolkit.ui.client.ratingfield; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.gwt.dom.client.DivElement; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.gwt.dom.client.SpanElement; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.gwt.dom.client.Style.Display; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.gwt.user.client.DOM; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.gwt.user.client.Event; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.gwt.user.client.ui.FocusWidget; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.ArrayList; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.List; <span class="hljs-comment"><span class="hljs-comment">//  GWT  public class RatingFieldWidget extends FocusWidget { private static final String CLASSNAME = "ratingfield"; // API     public interface StarClickListener { void starClicked(int value); } protected List&lt;SpanElement&gt; stars = new ArrayList&lt;SpanElement&gt;(5); protected StarClickListener listener; protected int value = 0; public RatingFieldWidget() { DivElement container = DOM.createDiv().cast(); container.getStyle().setDisplay(Display.INLINE_BLOCK); for (int i = 0; i &lt; 5; i++) { SpanElement star = DOM.createSpan().cast(); //      DOM.insertChild(container, star, i); //    ONCLICK DOM.sinkEvents(star, Event.ONCLICK); stars.add(star); } setElement(container); setStylePrimaryName(CLASSNAME); } //       GWT @Override public void onBrowserEvent(Event event) { super.onBrowserEvent(event); switch (event.getTypeInt()) { //    ONCLICK case Event.ONCLICK: SpanElement element = event.getEventTarget().cast(); //      int index = stars.indexOf(element); if (index &gt;= 0) { int value = index + 1; //    setValue(value); //   if (listener != null) { listener.starClicked(value); } } break; } } //       primaryStyleName //        @Override public void setStylePrimaryName(String style) { super.setStylePrimaryName(style); for (SpanElement star : stars) { star.setClassName(style + "-star"); } updateStarsStyle(this.value); } //      public void setValue(int value) { this.value = value; updateStarsStyle(value); } //    private void updateStarsStyle(int value) { for (SpanElement star : stars) { star.removeClassName(getStylePrimaryName() + "-star-selected"); } for (int i = 0; i &lt; value; i++) { stars.get(i).addClassName(getStylePrimaryName() + "-star-selected"); } } }</span></span></code> </pre> </div></div><br>  A widget is an isolated class that is responsible for displaying and responding to events.  It does not need to know about the server part, it only defines the interfaces for working with it.  In our case, this is the setValue method and the StarClickListener interface. <br><br>  It is worth noting that throughout the widget code there is not a single JavaScript line, which is pretty good for large and complex components.  But do not forget that this Java code will be compiled into JavaScript and you may not have access to many parts of the standard Java library, such as reflection and I / O (for complete compatibility information, see here: <a href="http://www.gwtproject.org/doc/latest/RefJreEmulation.html">www.gwtproject.org/doc/latest/RefJreEmulation.html</a> ). <br><br><h2>  Determine the appearance </h2><br>  As you can see, in the widget code there are no references to the appearance, except for the assignment of style names to key elements.  This technique is constantly used in the development of components and allows you to determine the appearance in CSS based on combinations of styles. <br><br>  In order to determine the appearance of our component, first, create style files.  To do this, we can use the 'Create theme extension' action for the 'halo' theme.  This theme uses FontAwesome font glyphs instead of icons, which we will use.  Studio will create empty SCSS files for our experiments in the themes directory of the web module. <br><br>  The styles of each component can be divided into a separate file componentname.scss in the components / componentname directory in the SCSS impurity format: <br><div class="spoiler">  <b class="spoiler_title">ratingfield.scss</b> <div class="spoiler_text"><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">mixin</span></span> ratingfield($primary-stylename: ratingfield) { .#{$primary-stylename}<span class="hljs-selector-tag"><span class="hljs-selector-tag">-star</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-family</span></span>: FontAwesome; <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: $v-font-size--h2; <span class="hljs-attribute"><span class="hljs-attribute">padding-right</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">round</span></span>($v-unit-size/4); <span class="hljs-attribute"><span class="hljs-attribute">cursor</span></span>: pointer; &amp;:after { <span class="hljs-attribute"><span class="hljs-attribute">content</span></span>: <span class="hljs-string"><span class="hljs-string">'\f006'</span></span>; // 'fa-star-o' } } .#{$primary-stylename}<span class="hljs-selector-tag"><span class="hljs-selector-tag">-star-selected</span></span> { &amp;:after { <span class="hljs-attribute"><span class="hljs-attribute">content</span></span>: <span class="hljs-string"><span class="hljs-string">'\f005'</span></span>; // 'fa-star' } } .#{$primary-stylename} .#{$primary-stylename}<span class="hljs-selector-tag"><span class="hljs-selector-tag">-star</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:last-child</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">padding-right</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; } .#{$primary-stylename}<span class="hljs-selector-class"><span class="hljs-selector-class">.v-disabled</span></span> .#{$primary-stylename}<span class="hljs-selector-tag"><span class="hljs-selector-tag">-star</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">cursor</span></span>: default; } }</code> </pre> </div></div><br>  Then this file is connected in the main theme file. <br><div class="spoiler">  <b class="spoiler_title">halo-ext.scss</b> <div class="spoiler_text"><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"../halo/halo"</span></span>; @<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"components/ratingfield/ratingfield"</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* Define your theme modifications inside next mixin */</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">mixin</span></span> halo-ext { @<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> halo; @<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> ratingfield; }</code> </pre> </div></div><br>  A few words about SCSS.  This is a format for describing CSS styles, allowing you to use variables, impurities, and calculated values.  It is actively used in many web frameworks, in Vaadin 7 it is the basic format of the themes of the application.  In the CUBA.Platform application, we can simply use this format, since Studio takes on the dirty work of organizing the SCSS assembly. <br><br>  The format of the description as an impurity will help us if the component has heirs with another primary stylename.  We simply include ancestor styles with SCSS <a href="https://habrahabr.ru/users/include/" class="user_link">include</a> . <br><br>  For our stars, we use two FontAwesome glyphs - 'fa-star' and 'fa-star-o'.  CSS itself is pretty simple and includes only the symbols of the stars in two states and the mouse cursor for them. <br><br>  To switch the theme in the application, select halo on the Project Properties page in CUBA.Studio. <br><br><h2>  Add the server side </h2><br>  Up to this point we could use the widget we wrote in some GWT application, since it was not dependent on the server at all.  Now let's talk about the Vaadin framework and its server-oriented model.  It has a couple of features: <br><br>  - all state of the components and input fields are stored on the server and can be restored even after a full page refresh or the connection with the server is broken <br>  - all useful application code, with the exception of the client part, is executed on the server <br><br>  That is, the Vaadin components hide from the developer how they work in the browser and a careless Java developer never sees HTML / CSS (or almost never sees, and then suddenly write components). <br><br>  Create the com.haulmont.ratingsample.web.toolkit.ui package in the web module.  In it, we will place the code for our RatingField component.  We will inherit the class from the Vaadin AbstractField class, which defines the basic logic of the input fields. <br><br>  Key server components of the Vaadin component: <br><br>  1) The RatingField component class defines an API for server-side code, various get / set methods for working, event listeners and connecting data sources.  Application developers always use methods of this class in their code. <br><div class="spoiler">  <b class="spoiler_title">RatingField.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.haulmont.ratingsample.web.toolkit.ui; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.haulmont.ratingsample.web.toolkit.ui.client.RatingFieldServerRpc; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.haulmont.ratingsample.web.toolkit.ui.client.RatingFieldState; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.vaadin.ui.AbstractField; <span class="hljs-comment"><span class="hljs-comment">//       Integer public class RatingField extends AbstractField&lt;Integer&gt; { public RatingField() { //    ,        registerRpc(new RatingFieldServerRpc() { @Override public void starClicked(int value) { setValue(value, true); } }); } //    @Override public Class&lt;? extends Integer&gt; getType() { return Integer.class; } //      @Override protected RatingFieldState getState() { return (RatingFieldState) super.getState(); } @Override protected RatingFieldState getState(boolean markAsDirty) { return (RatingFieldState) super.getState(markAsDirty); } //   setValue       @Override protected void setInternalValue(Integer newValue) { super.setInternalValue(newValue); if (newValue == null) { newValue = 0; } getState().value = newValue; } }</span></span></code> </pre> </div></div><br>  2) The Status class RatingFieldState is responsible for what data will be sent between the client and the server.  It defines public fields that will be automatically serialized on the server and deserialized on the client. <br><div class="spoiler">  <b class="spoiler_title">RatingFieldState.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.haulmont.ratingsample.web.toolkit.ui.client; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.vaadin.shared.AbstractFieldState; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RatingFieldState</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractFieldState</span></span></span><span class="hljs-class"> </span></span>{ { <span class="hljs-comment"><span class="hljs-comment">//      primaryStyleName = "ratingfield"; } //      public int value = 0; }</span></span></code> </pre> </div></div><br>  3) RatingFieldServerRpc interface - defines the server API for the client part, its methods can be called from the client using the remote procedure call procedure built into Vaadin.  We implement this interface in the component itself, in this case simply call the setValue method of our field. <br><div class="spoiler">  <b class="spoiler_title">RatingFieldServerRpc.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.haulmont.ratingsample.web.toolkit.ui.client; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.vaadin.shared.communication.ServerRpc; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RatingFieldServerRpc</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServerRpc</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//       void starClicked(int value); }</span></span></code> </pre> </div></div><br>  The important point is that the status classes and rpc must be located in the 'client' subpackage, so the GWT compiler‚Äôs clinging hands will easily get to them to create their JavaScript representation for the client code.  In addition, classes should not use code that cannot be compiled by GWT. <br><br>  Now it is time to connect our client code with the server part.  This role in Vaadin is performed by connector classes.  They are placed next to the widget classes.  The connector class is annotated by <a href="https://habrahabr.ru/users/connect/" class="user_link">Connect</a> (ComponentName.class), and the client part is assigned to the server part: <br><div class="spoiler">  <b class="spoiler_title">RatingFieldConnector.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.haulmont.ratingsample.web.toolkit.ui.client.ratingfield; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.haulmont.ratingsample.web.toolkit.ui.RatingField; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.haulmont.ratingsample.web.toolkit.ui.client.RatingFieldServerRpc; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.haulmont.ratingsample.web.toolkit.ui.client.RatingFieldState; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.vaadin.client.communication.StateChangeEvent; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.vaadin.client.ui.AbstractFieldConnector; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.vaadin.shared.ui.Connect; <span class="hljs-comment"><span class="hljs-comment">//       RatingField //    AbstractField @Connect(RatingField.class) public class RatingFieldConnector extends AbstractFieldConnector { //     RatingFieldWidget @Override public RatingFieldWidget getWidget() { RatingFieldWidget widget = (RatingFieldWidget) super.getWidget(); if (widget.listener == null) { widget.listener = new RatingFieldWidget.StarClickListener() { @Override public void starClicked(int value) { getRpcProxy(RatingFieldServerRpc.class).starClicked(value); } }; } return widget; } //    - RatingFieldState @Override public RatingFieldState getState() { return (RatingFieldState) super.getState(); } //       @Override public void onStateChanged(StateChangeEvent stateChangeEvent) { super.onStateChanged(stateChangeEvent); //     ,   if (stateChangeEvent.hasPropertyChanged("value")) { getWidget().setValue(getState().value); } } }</span></span></code> </pre> </div></div><br><h2>  Trial run </h2><br>  To try all this in, let's do a few preparatory steps: <br><br>  1) Create a database for the application from the Studio menu: Run - Create database <br>  2) Create a screen to place the component in the web module: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/83a/a6a/884/83aa6a884e7145fd9df87b0f27146d32.png" alt="image"></div><br>  3) Add a screen to the application menu: Main menu - Edit <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/dfa/fc9/615/dfafc961516a4b5e9df2477bd97b7e7a.png" alt="image"></div><br>  4) Now let's move on to editing our screen in the IDE. <br>  We need a container for our component, let's declare it in an XML screen: <br><div class="spoiler">  <b class="spoiler_title">rating-screen.xml</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">window</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.haulmont.com/cuba/5.3/window.xsd"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">caption</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"msg://caption"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.haulmont.ratingsample.web.RatingScreen"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">messagesPack</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.haulmont.ratingsample.web"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">layout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">expand</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"container"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vbox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"container"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--       Vaadin --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vbox</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">layout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">window</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </div></div><br>  Open the RatingScreen.java screen controller class and add the code for placing our component on the screen: <br><div class="spoiler">  <b class="spoiler_title">RatingScreen.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.haulmont.ratingsample.web; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.haulmont.ratingsample.web.toolkit.ui.RatingField; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.haulmont.cuba.gui.components.AbstractWindow; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.haulmont.cuba.gui.components.BoxLayout; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.haulmont.cuba.web.gui.components.WebComponentsHelper; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.inject.Inject; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Map; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RatingScreen</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractWindow</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BoxLayout container; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Map&lt;String, Object&gt; params)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.init(params); <span class="hljs-comment"><span class="hljs-comment">//  API CUBA    Vaadin  : com.vaadin.ui.Layout containerLayout = WebComponentsHelper.unwrap(container); //       Vaadin : RatingField field = new RatingField(); field.setCaption("Rate this!"); containerLayout.addComponent(field); } }</span></span></code> </pre> </div></div><br>  The Web module perfectly supports the integration of Vaadin components, both third-party and self-written.  You can directly use them as if writing an application on pure Vaadin. <br><br>  Run the application from the Studio: Start application server, go to <a href="http://localhost:8080/app">http: // localhost: 8080 / app</a> to see the result: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/ebe/814/51d/ebe81451d83745828ffbadacb4024585.png" alt="image"></div><br>  We rejoice at the full-featured component, which we can now use from our Java code on the server.  All code is suitable for use in any Vaadin application. <br><br>  The full application code can be found here: <a href="">github.com/Haulmont/ratingsample.git</a> <br><br><h2>  Browser debugging </h2><br>  We will only consider debugging widget code, since debugging Java code on the server is quite simple. <br><br>  Debugging any GWT code is completely non-trivial and requires accuracy.  For debugging we will use the SuperDevMode mode.  It is imperative that your project be built with GWT 2.5.1 or later.  This mode assumes the use of matching Java code with JavaScript code in the browser (source-maps, see <a href="https://developer.chrome.com/devtools/docs/javascript-debugging">developer.chrome.com/devtools/docs/javascript-debugging#source-maps</a> ).  That is, you will see and debug Java code in the browser, but with some restrictions. <br><br>  The scheme of work is as follows: <br><ol><li>  You start the com.google.gwt.dev.codeserver.CodeServer server that gives the browser side a matching JS code and Java code, and also collects your widgetset when the page is updated </li><li>  Open the application with the parameters? Debug &amp; superdevmode </li><li>  Customize Developer Tools, F12, in the lower right corner there is a button for opening settings.  Mark the option Enable source maps </li><li>  Refresh the page, open the Sources tab in Developer Tools.  There all the Java classes of the GWT widgets should be shown.  In the Chrome debugger, you can set breakpoints, watch variables and execute expressions. </li><li>  When changing the widget code in the project, it is enough to refresh the page, the widgetset will be reassembled and picked up by the browser.  This allows you to see changes to the widget code on the fly, which significantly speeds up development. </li></ol><br>  We try to run everything in our project: <br>  1) To start this mode, we need to add the runtime servletApi dependency for the web-toolkit module in the build.gradle file: <br><div class="spoiler">  <b class="spoiler_title">build.gradle</b> <div class="spoiler_text"><pre> <code class="java hljs">... configure(webToolkitModule) { dependencies { ... runtime(servletApi) } ...</code> </pre> </div></div><br>  2) In Studio, execute the 'Create or update IDE project files' action so that Idea sees the new dependency. <br>  3) Create a new launch configuration in Idea with the type Application and the following parameters: <br><br>  <b>Main class:</b> com.google.gwt.dev.codeserver.CodeServer <br>  <b>VM options:</b> -Xmx512M <br>  <b>Use classpath of module:</b> app-web-toolkit <br>  <b>Program arguments:</b> -workDir C: \ Users \ yuriy \ work \ ratingsample \ build \ tomcat \ webapps \ app \ VAADIN \ widgetsets -src C: \ Users \ yuriy \ work \ ratingsample \ modules \ web \ src -src C: \ Users \ yuriy \ work \ ratingsample \ modules \ web-toolkit \ src com.haulmont.ratingsample.web.toolkit.ui.AppWidgetSet <br><br>  The paths to the build \ tomcat \ webapps \ app \ VAADIN \ widgetsets, modules \ web \ src and modules \ web-toolkit \ src directories must be replaced with their own. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/ef5/a17/2b3/ef5a172b36514f268d04757cf8561d4b.png" alt="image"></div><br>  4) Run in Studio: Run-Start application server <br>  5) Run the previously created GWT configuration in Idea <br>  6) Go to <a href="http://localhost:8080/app%3Fdebug%26superdevmode">http: // localhost: 8080 / app? Debug &amp; superdevmode</a> <br>  7) Open DevTools in Chrome and see your Java code: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/531/db5/e05/531db5e05c75454d968cd73ab2ff8fce.png" alt="image"></div><br>  The advantage of this method is that it does not require special support from the IDE, it works quickly and allows you to debug the code directly in the browser.  The disadvantages include the fact that you can‚Äôt execute Java code during debugging, as well as breakpoints with Java conditions, and it‚Äôs somehow unusual.  There is still a fat minus - old browsers are not able to source-maps at all, which makes normal debugging difficult. <br><br><h2>  Instead of conclusion </h2><br>  GWT is a very strong and developed web framework, in recent years it has been actively used by a large number of developers around the world.  Google does not forget about its offspring and actively applies it, most recently they released Gmail Inbox ( <a href="http://gmailblog.blogspot.ru/2014/11/going-under-hood-of-inbox.html">http://gmailblog.blogspot.ru/2014/11/going-under-hood-of-inbox.html</a> ), which GWT intensively uses for web interface. <br><br>  Vaadin is also not lagging behind and is now one of the best server-side options for GWT.  Server-oriented model allows you to develop faster, easier to maintain applications and less worried about data security.  The complexity of finalizing the GWT and Vaadin functional is rather isolated and you should not be afraid of it, the advantages of these technologies for development cover all their disadvantages. <br><br>  We have been actively using Vaadin for 5+ years and are confident in it.  I advise everyone to consider it as the main framework for building web applications, especially business. <br><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/248545/">https://habr.com/ru/post/248545/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../248531/index.html">Ubiquiti lightning protection. Recommendations for connecting devices without a grounding screw on the case</a></li>
<li><a href="../248535/index.html">10 reasons why you are not a tester</a></li>
<li><a href="../248539/index.html">Calculating the time of sunset and sunrise on the coordinates of the Android device using earthtools</a></li>
<li><a href="../248541/index.html">Spring MVC 3, Hibernate Annotations, MySQL. Integration Tutorial</a></li>
<li><a href="../248543/index.html">Systemd author - Lennart Pottering game</a></li>
<li><a href="../248547/index.html">(Tajikistan) Power and Efficiency: A New Generation of HP ProLiant Gen9 Servers</a></li>
<li><a href="../248553/index.html">How I wrote a game about SEO</a></li>
<li><a href="../248555/index.html">External IT resources - can not (,) refuse</a></li>
<li><a href="../248557/index.html">"Race robots" in the Ural Federal</a></li>
<li><a href="../248559/index.html">Selenium for Python. Chapter 1. Installation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>