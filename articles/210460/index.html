<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>OpenVZ in Proxmox, margin notes</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Perhaps this article does not pull on a full-fledged article, but I tried to collect here all the unusual moments I encountered when working with Open...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>OpenVZ in Proxmox, margin notes</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/2ac/d97/1b5/2acd971b5217ea5b0e1e9b52d2e1e02b.png"><br>  Perhaps this article does not pull on a full-fledged article, but I tried to collect here all the unusual moments I encountered when working with OpenVZ containers and the Proxmox hypervisor, to give ready-made recipes with examples, maybe someone will save time on finding solutions.  There will be little text, many examples, there will be no <s>seals</s> . <br><ul><li>  Summary to save time </li><li>  1. Forwarding various features and devices from the hypervisor to the OpenVZ container </li><li>  1.1.  Forwarding fuse </li><li>  1.2.  Forwarding NFS </li><li>  1.3.  Forwarding USB devices </li><li>  1.4.  Forwarding a sound card (both built-in and usb) </li><li>  1.5.  Forwarding X's </li><li>  1.6.  Forwarding a disk partition </li><li>  1.7.  Turn on tun / tap </li><li>  2. Fairvol </li><li>  3. Different things </li><li>  UPD-1: Forwarding vlan </li></ul><br><br>  And so it went: <br><a name="habracut"></a><br><h4>  1. Forwarding various features and devices from the hypervisor to the OpenVZ container </h4><br><h5>  1.1. Request fuse </h5><br>  <b>On the hypervisor:</b> <br>  Stop OpenVZ Container <br><pre><code class="bash hljs">vzctl stop [VEID]</code> </pre> <br>  perform <br><pre> <code class="bash hljs">vzctl <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> [VEID] --devices c:10:229:rw --save vzctl <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> [VEID] mknod /dev/fuse c 10 229</code> </pre><br>  Launch container <br><pre> <code class="bash hljs">vzctl start [VEID]</code> </pre><br>  where [VEID] is the container number, after which the mount in the container works. <br><br><h5>  1.2.  Forwarding NFS </h5><br>  <b>On the hypervisor:</b> <br>  Install nfs server <br><pre> <code class="bash hljs">aptitude install nfs-kernel-server</code> </pre><br>  rule nfs config <br><pre> <code class="bash hljs">nano /etc/exports</code> </pre><br>  for example, export / var / lib / vz for 10.1.1.2 <br><pre> <code class="bash hljs">/var/lib/vz 10.1.1.2(rw,sync,fsid=root,no_root_squash,crossmnt,no_subtree_check)</code> </pre><br>  restart nfs server <br><pre> <code class="bash hljs">/etc/init.d/nfs-kernel-server restart</code> </pre><br>  Add nfs support to container <br><pre> <code class="bash hljs">vzctl <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> [VEID] --features <span class="hljs-string"><span class="hljs-string">"nfs:on"</span></span> --save</code> </pre><br>  <b>Inside the container:</b> <br><pre> <code class="bash hljs">aptitude install nfs-common</code> </pre><br>  mount example <br><pre> <code class="bash hljs">mount -t nfs 10.1.1.1:/var/lib/vz/ /vz</code> </pre><br><h6>  1.3.  Forwarding USB devices </h6><br><blockquote>  <i>In all cases of device probros, if there are more than one device, it is better to edit the container configuration directly, rather than using vzctl, the fact is that if you did not put all the necessary devices on one line at once, vzctl will erase all previous probes and install only the last one.</i> </blockquote><br>  In general: <br><pre> <code class="bash hljs">vzctl <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> VEID --devices b|c:major:minor|all:[r|w|rw|none]</code> </pre><br>  where b is a block device, c is a character device.  major: minor need to look in / dev / bus / usb for a specific device. <br>  Forwarding by name <br><pre> <code class="bash hljs">vzctl <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> [VEID] --devnodes ttyUSB0:rw --save</code> </pre><br>  Code forwarding <br><pre> <code class="bash hljs">vzctl <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> [VEID] --devices c:189:all:rw --save</code> </pre><br>  Or editing the config: <br><pre> <code class="bash hljs">nano /etc/pve/openvz/[VEID].conf DEVNODES=<span class="hljs-string"><span class="hljs-string">"ttyUSB1:rw "</span></span> DEVNODES=<span class="hljs-string"><span class="hljs-string">"c:189:all:rw "</span></span></code> </pre><br>  To forward a USB device to a running container, you must: <br>  Mount from host to container <br><pre> <code class="bash hljs">mount -o <span class="hljs-built_in"><span class="hljs-built_in">bind</span></span> /dev/&lt;DEVNAME&gt; <span class="hljs-variable"><span class="hljs-variable">$VE_ROOT</span></span>/dev/&lt;DEVNAME&gt;</code> </pre><br><h6>  1.4.  Forwarding a sound card (both built-in and usb) </h6><br>  In many ways, it is similar to a conventional usb device, but with some differences. <br>  <b>On the hypervisor:</b> <br>  Put the kernel modules to work with sound <br><pre> <code class="bash hljs">modprobe snd_dummy <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"snd_dummy"</span></span> &gt;&gt; /etc/modules</code> </pre><br>  If USB is sound, then more <br><pre> <code class="bash hljs">modprobe snd_usb_audio <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"snd_usb_audio"</span></span> &gt;&gt; /etc/modules</code> </pre><br>  Make sure the modules are connected. <br><pre> <code class="bash hljs">lsmod | grep snd</code> </pre><br>  A list of all connected audio modules should be displayed. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Add to the config virtualka <br><pre> <code class="bash hljs">vzctl <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> [VEID] --devices c:116:all:rw --devices c:4:all:rw --save</code> </pre><br>  If this is not the first device to be forwarded, the command will overwrite the previous ones, then <br>  rule file <br><pre> <code class="bash hljs">/etc/pve/openvz/[VEID].conf</code> </pre><br>  add a line to it <br><pre> <code class="bash hljs">DEVICES=<span class="hljs-string"><span class="hljs-string">"c:116:all:rw c:4:all:rw "</span></span></code> </pre><br>  List all snd devices <br><pre> <code class="bash hljs">ls -la /dev/snd</code> </pre><br><pre> <code class="bash hljs">crw-rw---T 1 root audio 116, 6 Jan 25 19:19 controlC0 crw-rw---T 1 root audio 116, 9 Jan 27 09:52 controlC1 crw-rw---T 1 root audio 116, 5 Jan 25 19:19 pcmC0D0c crw-rw---T 1 root audio 116, 4 Jan 25 19:20 pcmC0D0p crw-rw---T 1 root audio 116, 8 Jan 27 09:52 pcmC1D0c crw-rw---T 1 root audio 116, 7 Jan 27 09:52 pcmC1D0p crw-rw---T 1 root audio 116, 3 Jan 25 17:47 seq crw-rw---T 1 root audio 116, 2 Jan 25 17:47 timer</code> </pre><br>  We go in the container <br><pre> <code class="bash hljs">vzctl enter [VEID]</code> </pre><br>  Vypolyan <br><pre> <code class="bash hljs">rm -r /dev/snd mkdir /dev/snd mknod /dev/snd/controlC0 c 116 6 mknod /dev/snd/controlC1 c 116 9 mknod /dev/snd/pcmC0D0c c 116 5 mknod /dev/snd/pcmC0D0p c 116 4 mknod /dev/snd/pcmC1D0c c 116 8 mknod /dev/snd/pcmC1D0p c 116 7 mknod /dev/snd/seq c 116 3 mknod /dev/snd/timer c 116 2 chmod 660 /dev/snd/* chown :audio /dev/snd/*</code> </pre><br>  (Please note that device numbers and names must match those on the hypervisor) <br><br>  We put alsa <br><pre> <code class="bash hljs">aptitude install alsa alsa-lib alsa-base alsa-util libdssialsacompat0</code> </pre><br>  Now we add the necessary container users to the audio group. <br><pre> <code class="bash hljs">adduser skype audio</code> </pre><br><h6>  1.5.  Forwarding X's </h6><br>  <b>We go in the container through vzctl (not SSH)</b> <br>  we do a symlink <br><pre> <code class="bash hljs">rm /dev/tty0 ln -s /dev/tty1 /dev/tty0</code> </pre><br>  Delete if nscd is installed <br><pre> <code class="bash hljs">aptitude remove nscd</code> </pre><br>  We put the right packages <br><pre> <code class="bash hljs">aptitude -R install xorg xserver-xorg-video-dummy xserver-xorg-input-kbd xserver-xorg-input-mouse alsa-base linux-sound-base libaudiofile0 dbus udev</code> </pre><br>  We <b>bring /etc/X11/xorg.conf</b> to the form <br><pre> <code class="bash hljs">Section <span class="hljs-string"><span class="hljs-string">"InputDevice"</span></span> Identifier <span class="hljs-string"><span class="hljs-string">"Dummy Input"</span></span> Driver <span class="hljs-string"><span class="hljs-string">"void"</span></span> EndSection Section <span class="hljs-string"><span class="hljs-string">"Device"</span></span> Identifier <span class="hljs-string"><span class="hljs-string">"Dummy Video"</span></span> Driver <span class="hljs-string"><span class="hljs-string">"dummy"</span></span> EndSection Section <span class="hljs-string"><span class="hljs-string">"Monitor"</span></span> Identifier <span class="hljs-string"><span class="hljs-string">"Configured Monitor"</span></span> EndSection Section <span class="hljs-string"><span class="hljs-string">"Screen"</span></span> Identifier <span class="hljs-string"><span class="hljs-string">"Default Screen"</span></span> Monitor <span class="hljs-string"><span class="hljs-string">"Configured Monitor"</span></span> Device <span class="hljs-string"><span class="hljs-string">"Dummy Video"</span></span> EndSection Section <span class="hljs-string"><span class="hljs-string">"ServerLayout"</span></span> Identifier <span class="hljs-string"><span class="hljs-string">"Default Layout"</span></span> Screen <span class="hljs-string"><span class="hljs-string">"Default Screen"</span></span> InputDevice <span class="hljs-string"><span class="hljs-string">"Dummy Input"</span></span> EndSection</code> </pre><br><br>  Starting Xy <br><pre> <code class="bash hljs">/usr/bin/X :&lt;DISPLAY<span class="hljs-comment"><span class="hljs-comment">#&gt;</span></span></code> </pre><br>  Where <br><pre> <code class="hljs perl"><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID <span class="hljs-string"><span class="hljs-string">"Skype"</span></span>: <br> su skype -c <span class="hljs-string"><span class="hljs-string">"echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.6.    </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     ,   sda4 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl set [VEID] --devnodes sda4:rw --save</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.7.  tun/tap </span></span><br><span class="hljs-string"><span class="hljs-string">     vpn  ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">lsmod | grep tun</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">modprobe tun echo "</span></span>tun<span class="hljs-string"><span class="hljs-string">" &gt;&gt; /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">          ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/vz/vz.conf</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    IPTABLES     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">IPTABLES="</span></span>ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp<span class="hljs-string"><span class="hljs-string">"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    VZ </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">/etc/init.d/vz restart</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,  ,      ( ,    ) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">      </span></span></b><span class="hljs-string"><span class="hljs-string"> #!/bin/sh </span></span><br><span class="hljs-string"><span class="hljs-string"> ### BEGIN INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # Provides: iptables.sh </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Start: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Stop: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Start: 2 3 4 5 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Stop: 0 1 6 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Short-Description: My firewall </span></span><br><span class="hljs-string"><span class="hljs-string"> # Description: Rico-X FIREWALL </span></span><br><span class="hljs-string"><span class="hljs-string"> ### END INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # /etc/init.d/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> IPT=/sbin/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> case "</span></span>$1<span class="hljs-string"><span class="hljs-string">" in </span></span><br><span class="hljs-string"><span class="hljs-string"> start) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Starting iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_synack_retries=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_fin_timeout=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_syncookies=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_intvl=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_probes=5 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_time=60 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.conf.default.rp_filter=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> #sysctl -w net.ipv4.ip_forward=0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     lo  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i lo -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i eth1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i vmbr1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     TCP-  SYN- </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #      </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       SSH (  4  ) </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #    netbios </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   ICMP  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state INVALID -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   DHCP   iptables. </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  - </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -N SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> stop) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Stopping iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -F </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -X </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> *) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Usage: <span class="hljs-regexp"><span class="hljs-regexp">/etc/init</span></span>.d/iptables {start|stop}<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 1 </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> esac </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.   </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"</span></span>Europe/Simferopol<span class="hljs-string"><span class="hljs-string">" /etc/localtime &amp;&amp; date</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         web-. </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><b><span class="hljs-string"><span class="hljs-string">/usr/share/pve-manager/ext4/pvemanagerlib.js</span></span></b><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status !== 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status == 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</span></span></b><span class="hljs-string"><span class="hljs-string">    , </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    (cluster not ready - no quorum),      , </span></span><br><span class="hljs-string"><span class="hljs-string">   ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">pvecm e (  )</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">  OpenVZ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  [VEID]  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl enter [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl restart [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl destroy [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzlist -a</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   -        ,     ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">UPD-1:  vlan</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       2 .     151,152,666 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">apt-get install vlan</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ifup vlan151 ifup vlan152 ifup vlan666</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">ifconfig</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    (network),   ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string">    ,     ,     debian </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces.tail</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  *.tail   ,          web ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    , -        -    ,   .</span></span></code></code> </pre> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <h6> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> </h6> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <pre> <code class="hljs perl"><code class="bash"><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID <span class="hljs-string"><span class="hljs-string">"Skype"</span></span>: <br> su skype -c <span class="hljs-string"><span class="hljs-string">"echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.6.    </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     ,   sda4 </span></span><br><span class="hljs-string"><span class="hljs-string"> vzctl set [VEID] --devnodes sda4:rw --save </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.7.  tun/tap </span></span><br><span class="hljs-string"><span class="hljs-string">     vpn  ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">lsmod | grep tun</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">modprobe tun echo "</span></span>tun<span class="hljs-string"><span class="hljs-string">" &gt;&gt; /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">          ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/vz/vz.conf</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    IPTABLES     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">IPTABLES="</span></span>ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp<span class="hljs-string"><span class="hljs-string">"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    VZ </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">/etc/init.d/vz restart</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,  ,      ( ,    ) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">      </span></span></b><span class="hljs-string"><span class="hljs-string"> #!/bin/sh </span></span><br><span class="hljs-string"><span class="hljs-string"> ### BEGIN INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # Provides: iptables.sh </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Start: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Stop: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Start: 2 3 4 5 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Stop: 0 1 6 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Short-Description: My firewall </span></span><br><span class="hljs-string"><span class="hljs-string"> # Description: Rico-X FIREWALL </span></span><br><span class="hljs-string"><span class="hljs-string"> ### END INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # /etc/init.d/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> IPT=/sbin/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> case "</span></span>$1<span class="hljs-string"><span class="hljs-string">" in </span></span><br><span class="hljs-string"><span class="hljs-string"> start) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Starting iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_synack_retries=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_fin_timeout=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_syncookies=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_intvl=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_probes=5 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_time=60 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.conf.default.rp_filter=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> #sysctl -w net.ipv4.ip_forward=0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     lo  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i lo -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i eth1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i vmbr1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     TCP-  SYN- </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #      </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       SSH (  4  ) </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #    netbios </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   ICMP  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state INVALID -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   DHCP   iptables. </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  - </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -N SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> stop) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Stopping iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -F </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -X </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> *) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Usage: <span class="hljs-regexp"><span class="hljs-regexp">/etc/init</span></span>.d/iptables {start|stop}<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 1 </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> esac </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.   </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"</span></span>Europe/Simferopol<span class="hljs-string"><span class="hljs-string">" /etc/localtime &amp;&amp; date</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         web-. </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><b><span class="hljs-string"><span class="hljs-string">/usr/share/pve-manager/ext4/pvemanagerlib.js</span></span></b><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status !== 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status == 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</span></span></b><span class="hljs-string"><span class="hljs-string">    , </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    (cluster not ready - no quorum),      , </span></span><br><span class="hljs-string"><span class="hljs-string">   ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">pvecm e (  )</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">  OpenVZ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  [VEID]  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl enter [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl restart [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl destroy [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzlist -a</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   -        ,     ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">UPD-1:  vlan</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       2 .     151,152,666 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">apt-get install vlan</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ifup vlan151 ifup vlan152 ifup vlan666</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">ifconfig</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    (network),   ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string">    ,     ,     debian </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces.tail</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  *.tail   ,          web ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    , -        -    ,   .</span></span></code></code> </pre> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <h5> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> </h5> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <pre> <code class="hljs perl"><code class="bash"><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID <span class="hljs-string"><span class="hljs-string">"Skype"</span></span>: <br> su skype -c <span class="hljs-string"><span class="hljs-string">"echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.6.    </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     ,   sda4 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl set [VEID] --devnodes sda4:rw --save</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.7.  tun/tap </span></span><br><span class="hljs-string"><span class="hljs-string">     vpn  ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> lsmod | grep tun </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">modprobe tun echo "</span></span>tun<span class="hljs-string"><span class="hljs-string">" &gt;&gt; /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">          ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/vz/vz.conf</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    IPTABLES     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">IPTABLES="</span></span>ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp<span class="hljs-string"><span class="hljs-string">"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    VZ </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">/etc/init.d/vz restart</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,  ,      ( ,    ) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">      </span></span></b><span class="hljs-string"><span class="hljs-string"> #!/bin/sh </span></span><br><span class="hljs-string"><span class="hljs-string"> ### BEGIN INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # Provides: iptables.sh </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Start: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Stop: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Start: 2 3 4 5 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Stop: 0 1 6 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Short-Description: My firewall </span></span><br><span class="hljs-string"><span class="hljs-string"> # Description: Rico-X FIREWALL </span></span><br><span class="hljs-string"><span class="hljs-string"> ### END INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # /etc/init.d/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> IPT=/sbin/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> case "</span></span>$1<span class="hljs-string"><span class="hljs-string">" in </span></span><br><span class="hljs-string"><span class="hljs-string"> start) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Starting iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_synack_retries=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_fin_timeout=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_syncookies=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_intvl=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_probes=5 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_time=60 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.conf.default.rp_filter=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> #sysctl -w net.ipv4.ip_forward=0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     lo  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i lo -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i eth1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i vmbr1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     TCP-  SYN- </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #      </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       SSH (  4  ) </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #    netbios </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   ICMP  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state INVALID -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   DHCP   iptables. </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  - </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -N SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> stop) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Stopping iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -F </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -X </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> *) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Usage: <span class="hljs-regexp"><span class="hljs-regexp">/etc/init</span></span>.d/iptables {start|stop}<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 1 </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> esac </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.   </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"</span></span>Europe/Simferopol<span class="hljs-string"><span class="hljs-string">" /etc/localtime &amp;&amp; date</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         web-. </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><b><span class="hljs-string"><span class="hljs-string">/usr/share/pve-manager/ext4/pvemanagerlib.js</span></span></b><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status !== 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status == 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</span></span></b><span class="hljs-string"><span class="hljs-string">    , </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    (cluster not ready - no quorum),      , </span></span><br><span class="hljs-string"><span class="hljs-string">   ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">pvecm e (  )</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">  OpenVZ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  [VEID]  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl enter [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl restart [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl destroy [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzlist -a</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   -        ,     ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">UPD-1:  vlan</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       2 .     151,152,666 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">apt-get install vlan</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ifup vlan151 ifup vlan152 ifup vlan666</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">ifconfig</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    (network),   ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string">    ,     ,     debian </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces.tail</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  *.tail   ,          web ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    , -        -    ,   .</span></span></code></code> </pre> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <pre> <code class="hljs perl"><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID <span class="hljs-string"><span class="hljs-string">"Skype"</span></span>: <br> su skype -c <span class="hljs-string"><span class="hljs-string">"echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.6.    </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     ,   sda4 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl set [VEID] --devnodes sda4:rw --save</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.7.  tun/tap </span></span><br><span class="hljs-string"><span class="hljs-string">     vpn  ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">lsmod | grep tun</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">modprobe tun echo "</span></span>tun<span class="hljs-string"><span class="hljs-string">" &gt;&gt; /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">          ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/vz/vz.conf</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    IPTABLES     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">IPTABLES="</span></span>ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp<span class="hljs-string"><span class="hljs-string">"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    VZ </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">/etc/init.d/vz restart</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,  ,      ( ,    ) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">      </span></span></b><span class="hljs-string"><span class="hljs-string"> #!/bin/sh </span></span><br><span class="hljs-string"><span class="hljs-string"> ### BEGIN INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # Provides: iptables.sh </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Start: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Stop: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Start: 2 3 4 5 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Stop: 0 1 6 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Short-Description: My firewall </span></span><br><span class="hljs-string"><span class="hljs-string"> # Description: Rico-X FIREWALL </span></span><br><span class="hljs-string"><span class="hljs-string"> ### END INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # /etc/init.d/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> IPT=/sbin/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> case "</span></span>$1<span class="hljs-string"><span class="hljs-string">" in </span></span><br><span class="hljs-string"><span class="hljs-string"> start) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Starting iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_synack_retries=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_fin_timeout=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_syncookies=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_intvl=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_probes=5 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_time=60 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.conf.default.rp_filter=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> #sysctl -w net.ipv4.ip_forward=0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     lo  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i lo -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i eth1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i vmbr1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     TCP-  SYN- </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #      </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       SSH (  4  ) </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #    netbios </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   ICMP  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state INVALID -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   DHCP   iptables. </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  - </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -N SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> stop) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Stopping iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -F </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -X </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> *) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Usage: <span class="hljs-regexp"><span class="hljs-regexp">/etc/init</span></span>.d/iptables {start|stop}<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 1 </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> esac </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.   </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"</span></span>Europe/Simferopol<span class="hljs-string"><span class="hljs-string">" /etc/localtime &amp;&amp; date</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         web-. </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><b><span class="hljs-string"><span class="hljs-string">/usr/share/pve-manager/ext4/pvemanagerlib.js</span></span></b><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status !== 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status == 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</span></span></b><span class="hljs-string"><span class="hljs-string">    , </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    (cluster not ready - no quorum),      , </span></span><br><span class="hljs-string"><span class="hljs-string">   ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">pvecm e (  )</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">  OpenVZ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  [VEID]  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl enter [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl restart [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl destroy [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzlist -a</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   -        ,     ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">UPD-1:  vlan</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       2 .     151,152,666 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">apt-get install vlan</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ifup vlan151 ifup vlan152 ifup vlan666</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">ifconfig</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    (network),   ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string">    ,     ,     debian </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces.tail</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  *.tail   ,          web ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    , -        -    ,   .</span></span></code> </pre> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <pre> <code class="hljs perl"><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID <span class="hljs-string"><span class="hljs-string">"Skype"</span></span>: <br> su skype -c <span class="hljs-string"><span class="hljs-string">"echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.6.    </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     ,   sda4 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl set [VEID] --devnodes sda4:rw --save</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.7.  tun/tap </span></span><br><span class="hljs-string"><span class="hljs-string">     vpn  ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">lsmod | grep tun</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">modprobe tun echo "</span></span>tun<span class="hljs-string"><span class="hljs-string">" &gt;&gt; /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">          ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/vz/vz.conf</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    IPTABLES     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">IPTABLES="</span></span>ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp<span class="hljs-string"><span class="hljs-string">"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    VZ </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">/etc/init.d/vz restart</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,  ,      ( ,    ) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">      </span></span></b><span class="hljs-string"><span class="hljs-string"> #!/bin/sh </span></span><br><span class="hljs-string"><span class="hljs-string"> ### BEGIN INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # Provides: iptables.sh </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Start: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Stop: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Start: 2 3 4 5 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Stop: 0 1 6 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Short-Description: My firewall </span></span><br><span class="hljs-string"><span class="hljs-string"> # Description: Rico-X FIREWALL </span></span><br><span class="hljs-string"><span class="hljs-string"> ### END INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # /etc/init.d/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> IPT=/sbin/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> case "</span></span>$1<span class="hljs-string"><span class="hljs-string">" in </span></span><br><span class="hljs-string"><span class="hljs-string"> start) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Starting iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_synack_retries=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_fin_timeout=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_syncookies=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_intvl=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_probes=5 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_time=60 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.conf.default.rp_filter=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> #sysctl -w net.ipv4.ip_forward=0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     lo  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i lo -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i eth1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i vmbr1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     TCP-  SYN- </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #      </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       SSH (  4  ) </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #    netbios </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   ICMP  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state INVALID -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   DHCP   iptables. </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  - </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -N SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> stop) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Stopping iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -F </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -X </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> *) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Usage: <span class="hljs-regexp"><span class="hljs-regexp">/etc/init</span></span>.d/iptables {start|stop}<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 1 </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> esac </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.   </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"</span></span>Europe/Simferopol<span class="hljs-string"><span class="hljs-string">" /etc/localtime &amp;&amp; date</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         web-. </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><b><span class="hljs-string"><span class="hljs-string">/usr/share/pve-manager/ext4/pvemanagerlib.js</span></span></b><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status !== 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status == 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</span></span></b><span class="hljs-string"><span class="hljs-string">    , </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    (cluster not ready - no quorum),      , </span></span><br><span class="hljs-string"><span class="hljs-string">   ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">pvecm e (  )</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">  OpenVZ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  [VEID]  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl enter [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl restart [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl destroy [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzlist -a</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   -        ,     ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">UPD-1:  vlan</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       2 .     151,152,666 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">apt-get install vlan</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ifup vlan151 ifup vlan152 ifup vlan666</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">ifconfig</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    (network),   ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string">    ,     ,     debian </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces.tail</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  *.tail   ,          web ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    , -        -    ,   .</span></span></code> </pre> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <h4> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> </h4> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <pre> <code class="hljs perl"><code class="bash"><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID <span class="hljs-string"><span class="hljs-string">"Skype"</span></span>: <br> su skype -c <span class="hljs-string"><span class="hljs-string">"echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.6.    </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     ,   sda4 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl set [VEID] --devnodes sda4:rw --save</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.7.  tun/tap </span></span><br><span class="hljs-string"><span class="hljs-string">     vpn  ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">lsmod | grep tun</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">modprobe tun echo "</span></span>tun<span class="hljs-string"><span class="hljs-string">" &gt;&gt; /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">          ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> nano /etc/vz/vz.conf </span></span><br><span class="hljs-string"><span class="hljs-string">    IPTABLES     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">IPTABLES="</span></span>ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp<span class="hljs-string"><span class="hljs-string">"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    VZ </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">/etc/init.d/vz restart</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,  ,      ( ,    ) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">      </span></span></b><span class="hljs-string"><span class="hljs-string"> #!/bin/sh </span></span><br><span class="hljs-string"><span class="hljs-string"> ### BEGIN INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # Provides: iptables.sh </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Start: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Stop: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Start: 2 3 4 5 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Stop: 0 1 6 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Short-Description: My firewall </span></span><br><span class="hljs-string"><span class="hljs-string"> # Description: Rico-X FIREWALL </span></span><br><span class="hljs-string"><span class="hljs-string"> ### END INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # /etc/init.d/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> IPT=/sbin/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> case "</span></span>$1<span class="hljs-string"><span class="hljs-string">" in </span></span><br><span class="hljs-string"><span class="hljs-string"> start) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Starting iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_synack_retries=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_fin_timeout=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_syncookies=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_intvl=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_probes=5 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_time=60 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.conf.default.rp_filter=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> #sysctl -w net.ipv4.ip_forward=0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     lo  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i lo -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i eth1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i vmbr1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     TCP-  SYN- </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #      </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       SSH (  4  ) </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #    netbios </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   ICMP  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state INVALID -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   DHCP   iptables. </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  - </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -N SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> stop) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Stopping iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -F </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -X </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> *) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Usage: <span class="hljs-regexp"><span class="hljs-regexp">/etc/init</span></span>.d/iptables {start|stop}<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 1 </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> esac </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.   </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"</span></span>Europe/Simferopol<span class="hljs-string"><span class="hljs-string">" /etc/localtime &amp;&amp; date</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         web-. </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><b><span class="hljs-string"><span class="hljs-string">/usr/share/pve-manager/ext4/pvemanagerlib.js</span></span></b><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status !== 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status == 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</span></span></b><span class="hljs-string"><span class="hljs-string">    , </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    (cluster not ready - no quorum),      , </span></span><br><span class="hljs-string"><span class="hljs-string">   ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">pvecm e (  )</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">  OpenVZ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  [VEID]  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl enter [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl restart [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl destroy [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzlist -a</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   -        ,     ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">UPD-1:  vlan</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       2 .     151,152,666 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">apt-get install vlan</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ifup vlan151 ifup vlan152 ifup vlan666</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">ifconfig</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    (network),   ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string">    ,     ,     debian </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces.tail</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  *.tail   ,          web ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    , -        -    ,   .</span></span></code></code> </pre> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <pre> <code class="hljs perl"><code class="bash"><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID <span class="hljs-string"><span class="hljs-string">"Skype"</span></span>: <br> su skype -c <span class="hljs-string"><span class="hljs-string">"echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.6.    </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     ,   sda4 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl set [VEID] --devnodes sda4:rw --save</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.7.  tun/tap </span></span><br><span class="hljs-string"><span class="hljs-string">     vpn  ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">lsmod | grep tun</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">modprobe tun echo "</span></span>tun<span class="hljs-string"><span class="hljs-string">" &gt;&gt; /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">          ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/vz/vz.conf</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    IPTABLES     </span></span><br><span class="hljs-string"><span class="hljs-string"> IPTABLES="</span></span>ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string">    VZ </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">/etc/init.d/vz restart</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,  ,      ( ,    ) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">      </span></span></b><span class="hljs-string"><span class="hljs-string"> #!/bin/sh </span></span><br><span class="hljs-string"><span class="hljs-string"> ### BEGIN INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # Provides: iptables.sh </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Start: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Stop: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Start: 2 3 4 5 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Stop: 0 1 6 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Short-Description: My firewall </span></span><br><span class="hljs-string"><span class="hljs-string"> # Description: Rico-X FIREWALL </span></span><br><span class="hljs-string"><span class="hljs-string"> ### END INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # /etc/init.d/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> IPT=/sbin/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> case "</span></span>$1<span class="hljs-string"><span class="hljs-string">" in </span></span><br><span class="hljs-string"><span class="hljs-string"> start) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Starting iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_synack_retries=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_fin_timeout=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_syncookies=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_intvl=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_probes=5 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_time=60 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.conf.default.rp_filter=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> #sysctl -w net.ipv4.ip_forward=0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     lo  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i lo -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i eth1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i vmbr1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     TCP-  SYN- </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #      </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       SSH (  4  ) </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #    netbios </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   ICMP  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state INVALID -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   DHCP   iptables. </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  - </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -N SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> stop) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Stopping iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -F </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -X </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> *) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Usage: <span class="hljs-regexp"><span class="hljs-regexp">/etc/init</span></span>.d/iptables {start|stop}<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 1 </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> esac </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.   </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"</span></span>Europe/Simferopol<span class="hljs-string"><span class="hljs-string">" /etc/localtime &amp;&amp; date</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         web-. </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><b><span class="hljs-string"><span class="hljs-string">/usr/share/pve-manager/ext4/pvemanagerlib.js</span></span></b><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status !== 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status == 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</span></span></b><span class="hljs-string"><span class="hljs-string">    , </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    (cluster not ready - no quorum),      , </span></span><br><span class="hljs-string"><span class="hljs-string">   ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">pvecm e (  )</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">  OpenVZ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  [VEID]  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl enter [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl restart [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl destroy [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzlist -a</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   -        ,     ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">UPD-1:  vlan</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       2 .     151,152,666 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">apt-get install vlan</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ifup vlan151 ifup vlan152 ifup vlan666</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">ifconfig</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    (network),   ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string">    ,     ,     debian </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces.tail</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  *.tail   ,          web ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    , -        -    ,   .</span></span></code></code> </pre> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <pre> <code class="hljs perl"><code class="bash"><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID <span class="hljs-string"><span class="hljs-string">"Skype"</span></span>: <br> su skype -c <span class="hljs-string"><span class="hljs-string">"echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.6.    </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     ,   sda4 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl set [VEID] --devnodes sda4:rw --save</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.7.  tun/tap </span></span><br><span class="hljs-string"><span class="hljs-string">     vpn  ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">lsmod | grep tun</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">modprobe tun echo "</span></span>tun<span class="hljs-string"><span class="hljs-string">" &gt;&gt; /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">          ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/vz/vz.conf</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    IPTABLES     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">IPTABLES="</span></span>ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp<span class="hljs-string"><span class="hljs-string">"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    VZ </span></span><br><span class="hljs-string"><span class="hljs-string"> /etc/init.d/vz restart </span></span><br><span class="hljs-string"><span class="hljs-string">         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,  ,      ( ,    ) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">      </span></span></b><span class="hljs-string"><span class="hljs-string"> #!/bin/sh </span></span><br><span class="hljs-string"><span class="hljs-string"> ### BEGIN INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # Provides: iptables.sh </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Start: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Stop: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Start: 2 3 4 5 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Stop: 0 1 6 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Short-Description: My firewall </span></span><br><span class="hljs-string"><span class="hljs-string"> # Description: Rico-X FIREWALL </span></span><br><span class="hljs-string"><span class="hljs-string"> ### END INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # /etc/init.d/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> IPT=/sbin/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> case "</span></span>$1<span class="hljs-string"><span class="hljs-string">" in </span></span><br><span class="hljs-string"><span class="hljs-string"> start) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Starting iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_synack_retries=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_fin_timeout=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_syncookies=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_intvl=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_probes=5 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_time=60 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.conf.default.rp_filter=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> #sysctl -w net.ipv4.ip_forward=0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     lo  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i lo -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i eth1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i vmbr1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     TCP-  SYN- </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #      </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       SSH (  4  ) </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #    netbios </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   ICMP  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state INVALID -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   DHCP   iptables. </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  - </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -N SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> stop) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Stopping iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -F </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -X </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> *) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Usage: <span class="hljs-regexp"><span class="hljs-regexp">/etc/init</span></span>.d/iptables {start|stop}<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 1 </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> esac </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.   </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"</span></span>Europe/Simferopol<span class="hljs-string"><span class="hljs-string">" /etc/localtime &amp;&amp; date</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         web-. </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><b><span class="hljs-string"><span class="hljs-string">/usr/share/pve-manager/ext4/pvemanagerlib.js</span></span></b><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status !== 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status == 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</span></span></b><span class="hljs-string"><span class="hljs-string">    , </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    (cluster not ready - no quorum),      , </span></span><br><span class="hljs-string"><span class="hljs-string">   ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">pvecm e (  )</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">  OpenVZ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  [VEID]  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl enter [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl restart [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl destroy [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzlist -a</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   -        ,     ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">UPD-1:  vlan</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       2 .     151,152,666 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">apt-get install vlan</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ifup vlan151 ifup vlan152 ifup vlan666</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">ifconfig</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    (network),   ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string">    ,     ,     debian </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces.tail</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  *.tail   ,          web ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    , -        -    ,   .</span></span></code></code> </pre> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <pre> <code class="hljs perl"><code class="bash"><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID <span class="hljs-string"><span class="hljs-string">"Skype"</span></span>: <br> su skype -c <span class="hljs-string"><span class="hljs-string">"echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.6.    </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     ,   sda4 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl set [VEID] --devnodes sda4:rw --save</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.7.  tun/tap </span></span><br><span class="hljs-string"><span class="hljs-string">     vpn  ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">lsmod | grep tun</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">modprobe tun echo "</span></span>tun<span class="hljs-string"><span class="hljs-string">" &gt;&gt; /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">          ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/vz/vz.conf</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    IPTABLES     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">IPTABLES="</span></span>ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp<span class="hljs-string"><span class="hljs-string">"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    VZ </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">/etc/init.d/vz restart</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,  ,      ( ,    ) </span></span><br><span class="hljs-string"><span class="hljs-string"> nano /etc/modules </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">      </span></span></b><span class="hljs-string"><span class="hljs-string"> #!/bin/sh </span></span><br><span class="hljs-string"><span class="hljs-string"> ### BEGIN INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # Provides: iptables.sh </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Start: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Stop: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Start: 2 3 4 5 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Stop: 0 1 6 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Short-Description: My firewall </span></span><br><span class="hljs-string"><span class="hljs-string"> # Description: Rico-X FIREWALL </span></span><br><span class="hljs-string"><span class="hljs-string"> ### END INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # /etc/init.d/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> IPT=/sbin/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> case "</span></span>$1<span class="hljs-string"><span class="hljs-string">" in </span></span><br><span class="hljs-string"><span class="hljs-string"> start) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Starting iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_synack_retries=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_fin_timeout=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_syncookies=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_intvl=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_probes=5 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_time=60 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.conf.default.rp_filter=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> #sysctl -w net.ipv4.ip_forward=0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     lo  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i lo -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i eth1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i vmbr1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     TCP-  SYN- </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #      </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       SSH (  4  ) </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #    netbios </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   ICMP  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state INVALID -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   DHCP   iptables. </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  - </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -N SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> stop) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Stopping iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -F </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -X </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> *) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Usage: <span class="hljs-regexp"><span class="hljs-regexp">/etc/init</span></span>.d/iptables {start|stop}<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 1 </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> esac </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.   </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"</span></span>Europe/Simferopol<span class="hljs-string"><span class="hljs-string">" /etc/localtime &amp;&amp; date</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         web-. </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><b><span class="hljs-string"><span class="hljs-string">/usr/share/pve-manager/ext4/pvemanagerlib.js</span></span></b><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status !== 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status == 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</span></span></b><span class="hljs-string"><span class="hljs-string">    , </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    (cluster not ready - no quorum),      , </span></span><br><span class="hljs-string"><span class="hljs-string">   ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">pvecm e (  )</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">  OpenVZ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  [VEID]  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl enter [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl restart [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl destroy [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzlist -a</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   -        ,     ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">UPD-1:  vlan</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       2 .     151,152,666 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">apt-get install vlan</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ifup vlan151 ifup vlan152 ifup vlan666</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">ifconfig</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    (network),   ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string">    ,     ,     debian </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces.tail</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  *.tail   ,          web ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    , -        -    ,   .</span></span></code></code> </pre> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <pre> <code class="hljs perl"><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID <span class="hljs-string"><span class="hljs-string">"Skype"</span></span>: <br> su skype -c <span class="hljs-string"><span class="hljs-string">"echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.6.    </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     ,   sda4 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl set [VEID] --devnodes sda4:rw --save</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.7.  tun/tap </span></span><br><span class="hljs-string"><span class="hljs-string">     vpn  ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">lsmod | grep tun</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">modprobe tun echo "</span></span>tun<span class="hljs-string"><span class="hljs-string">" &gt;&gt; /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">          ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/vz/vz.conf</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    IPTABLES     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">IPTABLES="</span></span>ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp<span class="hljs-string"><span class="hljs-string">"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    VZ </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">/etc/init.d/vz restart</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,  ,      ( ,    ) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">      </span></span></b><span class="hljs-string"><span class="hljs-string"> #!/bin/sh </span></span><br><span class="hljs-string"><span class="hljs-string"> ### BEGIN INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # Provides: iptables.sh </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Start: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Stop: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Start: 2 3 4 5 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Stop: 0 1 6 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Short-Description: My firewall </span></span><br><span class="hljs-string"><span class="hljs-string"> # Description: Rico-X FIREWALL </span></span><br><span class="hljs-string"><span class="hljs-string"> ### END INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # /etc/init.d/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> IPT=/sbin/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> case "</span></span>$1<span class="hljs-string"><span class="hljs-string">" in </span></span><br><span class="hljs-string"><span class="hljs-string"> start) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Starting iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_synack_retries=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_fin_timeout=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_syncookies=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_intvl=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_probes=5 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_time=60 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.conf.default.rp_filter=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> #sysctl -w net.ipv4.ip_forward=0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     lo  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i lo -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i eth1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i vmbr1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     TCP-  SYN- </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #      </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       SSH (  4  ) </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #    netbios </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   ICMP  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state INVALID -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   DHCP   iptables. </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  - </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -N SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> stop) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Stopping iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -F </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -X </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> *) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Usage: <span class="hljs-regexp"><span class="hljs-regexp">/etc/init</span></span>.d/iptables {start|stop}<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 1 </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> esac </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.   </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"</span></span>Europe/Simferopol<span class="hljs-string"><span class="hljs-string">" /etc/localtime &amp;&amp; date</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         web-. </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><b><span class="hljs-string"><span class="hljs-string">/usr/share/pve-manager/ext4/pvemanagerlib.js</span></span></b><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status !== 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status == 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</span></span></b><span class="hljs-string"><span class="hljs-string">    , </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    (cluster not ready - no quorum),      , </span></span><br><span class="hljs-string"><span class="hljs-string">   ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">pvecm e (  )</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">  OpenVZ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  [VEID]  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl enter [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl restart [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl destroy [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzlist -a</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   -        ,     ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">UPD-1:  vlan</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       2 .     151,152,666 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">apt-get install vlan</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ifup vlan151 ifup vlan152 ifup vlan666</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">ifconfig</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    (network),   ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string">    ,     ,     debian </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces.tail</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  *.tail   ,          web ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    , -        -    ,   .</span></span></code> </pre> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <div class="spoiler"> <code><b class="spoiler_title"><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br>        #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</b></code> <div class="spoiler_text"> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> </div></div> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <h4> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> </h4> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <pre> <code class="hljs perl"><code class="bash"><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID <span class="hljs-string"><span class="hljs-string">"Skype"</span></span>: <br> su skype -c <span class="hljs-string"><span class="hljs-string">"echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.6.    </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     ,   sda4 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl set [VEID] --devnodes sda4:rw --save</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.7.  tun/tap </span></span><br><span class="hljs-string"><span class="hljs-string">     vpn  ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">lsmod | grep tun</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">modprobe tun echo "</span></span>tun<span class="hljs-string"><span class="hljs-string">" &gt;&gt; /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">          ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/vz/vz.conf</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    IPTABLES     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">IPTABLES="</span></span>ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp<span class="hljs-string"><span class="hljs-string">"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    VZ </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">/etc/init.d/vz restart</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,  ,      ( ,    ) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">      </span></span></b><span class="hljs-string"><span class="hljs-string"> #!/bin/sh </span></span><br><span class="hljs-string"><span class="hljs-string"> ### BEGIN INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # Provides: iptables.sh </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Start: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Stop: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Start: 2 3 4 5 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Stop: 0 1 6 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Short-Description: My firewall </span></span><br><span class="hljs-string"><span class="hljs-string"> # Description: Rico-X FIREWALL </span></span><br><span class="hljs-string"><span class="hljs-string"> ### END INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # /etc/init.d/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> IPT=/sbin/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> case "</span></span>$1<span class="hljs-string"><span class="hljs-string">" in </span></span><br><span class="hljs-string"><span class="hljs-string"> start) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Starting iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_synack_retries=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_fin_timeout=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_syncookies=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_intvl=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_probes=5 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_time=60 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.conf.default.rp_filter=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> #sysctl -w net.ipv4.ip_forward=0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     lo  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i lo -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i eth1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i vmbr1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     TCP-  SYN- </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #      </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       SSH (  4  ) </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #    netbios </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   ICMP  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state INVALID -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   DHCP   iptables. </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  - </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -N SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> stop) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Stopping iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -F </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -X </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> *) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Usage: <span class="hljs-regexp"><span class="hljs-regexp">/etc/init</span></span>.d/iptables {start|stop}<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 1 </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> esac </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.   </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"</span></span>Europe/Simferopol<span class="hljs-string"><span class="hljs-string">" /etc/localtime &amp;&amp; date </span></span><br><span class="hljs-string"><span class="hljs-string">         web-. </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><b><span class="hljs-string"><span class="hljs-string">/usr/share/pve-manager/ext4/pvemanagerlib.js</span></span></b><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status !== 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status == 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</span></span></b><span class="hljs-string"><span class="hljs-string">    , </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    (cluster not ready - no quorum),      , </span></span><br><span class="hljs-string"><span class="hljs-string">   ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">pvecm e (  )</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">  OpenVZ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  [VEID]  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl enter [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl restart [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl destroy [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzlist -a</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   -        ,     ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">UPD-1:  vlan</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       2 .     151,152,666 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">apt-get install vlan</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ifup vlan151 ifup vlan152 ifup vlan666</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">ifconfig</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    (network),   ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string">    ,     ,     debian </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces.tail</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  *.tail   ,          web ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    , -        -    ,   .</span></span></code></code> </pre> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <pre> <code class="hljs perl"><code class="javascript"><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID <span class="hljs-string"><span class="hljs-string">"Skype"</span></span>: <br> su skype -c <span class="hljs-string"><span class="hljs-string">"echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.6.    </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     ,   sda4 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl set [VEID] --devnodes sda4:rw --save</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.7.  tun/tap </span></span><br><span class="hljs-string"><span class="hljs-string">     vpn  ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">lsmod | grep tun</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">modprobe tun echo "</span></span>tun<span class="hljs-string"><span class="hljs-string">" &gt;&gt; /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">          ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/vz/vz.conf</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    IPTABLES     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">IPTABLES="</span></span>ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp<span class="hljs-string"><span class="hljs-string">"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    VZ </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">/etc/init.d/vz restart</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,  ,      ( ,    ) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">      </span></span></b><span class="hljs-string"><span class="hljs-string"> #!/bin/sh </span></span><br><span class="hljs-string"><span class="hljs-string"> ### BEGIN INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # Provides: iptables.sh </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Start: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Stop: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Start: 2 3 4 5 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Stop: 0 1 6 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Short-Description: My firewall </span></span><br><span class="hljs-string"><span class="hljs-string"> # Description: Rico-X FIREWALL </span></span><br><span class="hljs-string"><span class="hljs-string"> ### END INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # /etc/init.d/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> IPT=/sbin/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> case "</span></span>$1<span class="hljs-string"><span class="hljs-string">" in </span></span><br><span class="hljs-string"><span class="hljs-string"> start) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Starting iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_synack_retries=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_fin_timeout=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_syncookies=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_intvl=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_probes=5 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_time=60 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.conf.default.rp_filter=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> #sysctl -w net.ipv4.ip_forward=0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     lo  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i lo -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i eth1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i vmbr1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     TCP-  SYN- </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #      </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       SSH (  4  ) </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #    netbios </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   ICMP  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state INVALID -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   DHCP   iptables. </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  - </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -N SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> stop) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Stopping iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -F </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -X </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> *) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Usage: <span class="hljs-regexp"><span class="hljs-regexp">/etc/init</span></span>.d/iptables {start|stop}<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 1 </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> esac </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.   </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"</span></span>Europe/Simferopol<span class="hljs-string"><span class="hljs-string">" /etc/localtime &amp;&amp; date</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         web-. </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><b><span class="hljs-string"><span class="hljs-string">/usr/share/pve-manager/ext4/pvemanagerlib.js</span></span></b><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> if (data.status !== 'Active') { </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status == 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</span></span></b><span class="hljs-string"><span class="hljs-string">    , </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    (cluster not ready - no quorum),      , </span></span><br><span class="hljs-string"><span class="hljs-string">   ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">pvecm e (  )</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">  OpenVZ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  [VEID]  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl enter [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl restart [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl destroy [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzlist -a</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   -        ,     ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">UPD-1:  vlan</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       2 .     151,152,666 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">apt-get install vlan</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ifup vlan151 ifup vlan152 ifup vlan666</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">ifconfig</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    (network),   ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string">    ,     ,     debian </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces.tail</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  *.tail   ,          web ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    , -        -    ,   .</span></span></code></code> </pre> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <pre> <code class="hljs perl"><code class="javascript"><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID <span class="hljs-string"><span class="hljs-string">"Skype"</span></span>: <br> su skype -c <span class="hljs-string"><span class="hljs-string">"echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.6.    </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     ,   sda4 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl set [VEID] --devnodes sda4:rw --save</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.7.  tun/tap </span></span><br><span class="hljs-string"><span class="hljs-string">     vpn  ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">lsmod | grep tun</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">modprobe tun echo "</span></span>tun<span class="hljs-string"><span class="hljs-string">" &gt;&gt; /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">          ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/vz/vz.conf</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    IPTABLES     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">IPTABLES="</span></span>ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp<span class="hljs-string"><span class="hljs-string">"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    VZ </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">/etc/init.d/vz restart</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,  ,      ( ,    ) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">      </span></span></b><span class="hljs-string"><span class="hljs-string"> #!/bin/sh </span></span><br><span class="hljs-string"><span class="hljs-string"> ### BEGIN INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # Provides: iptables.sh </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Start: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Stop: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Start: 2 3 4 5 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Stop: 0 1 6 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Short-Description: My firewall </span></span><br><span class="hljs-string"><span class="hljs-string"> # Description: Rico-X FIREWALL </span></span><br><span class="hljs-string"><span class="hljs-string"> ### END INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # /etc/init.d/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> IPT=/sbin/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> case "</span></span>$1<span class="hljs-string"><span class="hljs-string">" in </span></span><br><span class="hljs-string"><span class="hljs-string"> start) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Starting iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_synack_retries=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_fin_timeout=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_syncookies=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_intvl=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_probes=5 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_time=60 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.conf.default.rp_filter=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> #sysctl -w net.ipv4.ip_forward=0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     lo  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i lo -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i eth1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i vmbr1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     TCP-  SYN- </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #      </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       SSH (  4  ) </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #    netbios </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   ICMP  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state INVALID -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   DHCP   iptables. </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  - </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -N SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> stop) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Stopping iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -F </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -X </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> *) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Usage: <span class="hljs-regexp"><span class="hljs-regexp">/etc/init</span></span>.d/iptables {start|stop}<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 1 </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> esac </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.   </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"</span></span>Europe/Simferopol<span class="hljs-string"><span class="hljs-string">" /etc/localtime &amp;&amp; date</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         web-. </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><b><span class="hljs-string"><span class="hljs-string">/usr/share/pve-manager/ext4/pvemanagerlib.js</span></span></b><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status !== 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> if (data.status == 'Active') { </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</span></span></b><span class="hljs-string"><span class="hljs-string">    , </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    (cluster not ready - no quorum),      , </span></span><br><span class="hljs-string"><span class="hljs-string">   ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">pvecm e (  )</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">  OpenVZ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  [VEID]  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl enter [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl restart [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl destroy [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzlist -a</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   -        ,     ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">UPD-1:  vlan</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       2 .     151,152,666 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">apt-get install vlan</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ifup vlan151 ifup vlan152 ifup vlan666</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">ifconfig</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    (network),   ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string">    ,     ,     debian </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces.tail</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  *.tail   ,          web ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    , -        -    ,   .</span></span></code></code> </pre> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <pre> <code class="hljs perl"><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID <span class="hljs-string"><span class="hljs-string">"Skype"</span></span>: <br> su skype -c <span class="hljs-string"><span class="hljs-string">"echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.6.    </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     ,   sda4 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl set [VEID] --devnodes sda4:rw --save</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.7.  tun/tap </span></span><br><span class="hljs-string"><span class="hljs-string">     vpn  ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">lsmod | grep tun</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">modprobe tun echo "</span></span>tun<span class="hljs-string"><span class="hljs-string">" &gt;&gt; /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">          ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/vz/vz.conf</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    IPTABLES     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">IPTABLES="</span></span>ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp<span class="hljs-string"><span class="hljs-string">"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    VZ </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">/etc/init.d/vz restart</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,  ,      ( ,    ) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">      </span></span></b><span class="hljs-string"><span class="hljs-string"> #!/bin/sh </span></span><br><span class="hljs-string"><span class="hljs-string"> ### BEGIN INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # Provides: iptables.sh </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Start: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Stop: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Start: 2 3 4 5 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Stop: 0 1 6 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Short-Description: My firewall </span></span><br><span class="hljs-string"><span class="hljs-string"> # Description: Rico-X FIREWALL </span></span><br><span class="hljs-string"><span class="hljs-string"> ### END INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # /etc/init.d/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> IPT=/sbin/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> case "</span></span>$1<span class="hljs-string"><span class="hljs-string">" in </span></span><br><span class="hljs-string"><span class="hljs-string"> start) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Starting iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_synack_retries=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_fin_timeout=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_syncookies=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_intvl=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_probes=5 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_time=60 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.conf.default.rp_filter=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> #sysctl -w net.ipv4.ip_forward=0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     lo  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i lo -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i eth1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i vmbr1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     TCP-  SYN- </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #      </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       SSH (  4  ) </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #    netbios </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   ICMP  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state INVALID -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   DHCP   iptables. </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  - </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -N SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> stop) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Stopping iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -F </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -X </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> *) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Usage: <span class="hljs-regexp"><span class="hljs-regexp">/etc/init</span></span>.d/iptables {start|stop}<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 1 </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> esac </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.   </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"</span></span>Europe/Simferopol<span class="hljs-string"><span class="hljs-string">" /etc/localtime &amp;&amp; date</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         web-. </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><b><span class="hljs-string"><span class="hljs-string">/usr/share/pve-manager/ext4/pvemanagerlib.js</span></span></b><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status !== 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status == 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</span></span></b><span class="hljs-string"><span class="hljs-string">    , </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    (cluster not ready - no quorum),      , </span></span><br><span class="hljs-string"><span class="hljs-string">   ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">pvecm e (  )</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">  OpenVZ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  [VEID]  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl enter [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl restart [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl destroy [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzlist -a</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   -        ,     ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">UPD-1:  vlan</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       2 .     151,152,666 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">apt-get install vlan</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ifup vlan151 ifup vlan152 ifup vlan666</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">ifconfig</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    (network),   ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string">    ,     ,     debian </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces.tail</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  *.tail   ,          web ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    , -        -    ,   .</span></span></code> </pre> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <pre> <code class="hljs perl"><code class="bash"><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID <span class="hljs-string"><span class="hljs-string">"Skype"</span></span>: <br> su skype -c <span class="hljs-string"><span class="hljs-string">"echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.6.    </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     ,   sda4 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl set [VEID] --devnodes sda4:rw --save</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.7.  tun/tap </span></span><br><span class="hljs-string"><span class="hljs-string">     vpn  ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">lsmod | grep tun</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">modprobe tun echo "</span></span>tun<span class="hljs-string"><span class="hljs-string">" &gt;&gt; /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">          ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/vz/vz.conf</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    IPTABLES     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">IPTABLES="</span></span>ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp<span class="hljs-string"><span class="hljs-string">"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    VZ </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">/etc/init.d/vz restart</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,  ,      ( ,    ) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">      </span></span></b><span class="hljs-string"><span class="hljs-string"> #!/bin/sh </span></span><br><span class="hljs-string"><span class="hljs-string"> ### BEGIN INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # Provides: iptables.sh </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Start: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Stop: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Start: 2 3 4 5 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Stop: 0 1 6 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Short-Description: My firewall </span></span><br><span class="hljs-string"><span class="hljs-string"> # Description: Rico-X FIREWALL </span></span><br><span class="hljs-string"><span class="hljs-string"> ### END INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # /etc/init.d/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> IPT=/sbin/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> case "</span></span>$1<span class="hljs-string"><span class="hljs-string">" in </span></span><br><span class="hljs-string"><span class="hljs-string"> start) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Starting iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_synack_retries=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_fin_timeout=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_syncookies=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_intvl=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_probes=5 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_time=60 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.conf.default.rp_filter=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> #sysctl -w net.ipv4.ip_forward=0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     lo  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i lo -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i eth1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i vmbr1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     TCP-  SYN- </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #      </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       SSH (  4  ) </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #    netbios </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   ICMP  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state INVALID -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   DHCP   iptables. </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  - </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -N SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> stop) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Stopping iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -F </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -X </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> *) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Usage: <span class="hljs-regexp"><span class="hljs-regexp">/etc/init</span></span>.d/iptables {start|stop}<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 1 </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> esac </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.   </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"</span></span>Europe/Simferopol<span class="hljs-string"><span class="hljs-string">" /etc/localtime &amp;&amp; date</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         web-. </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><b><span class="hljs-string"><span class="hljs-string">/usr/share/pve-manager/ext4/pvemanagerlib.js</span></span></b><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status !== 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status == 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</span></span></b><span class="hljs-string"><span class="hljs-string">    , </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    (cluster not ready - no quorum),      , </span></span><br><span class="hljs-string"><span class="hljs-string">   ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> pvecm e (  ) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">  OpenVZ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  [VEID]  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl enter [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl restart [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl destroy [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzlist -a</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   -        ,     ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">UPD-1:  vlan</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       2 .     151,152,666 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">apt-get install vlan</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ifup vlan151 ifup vlan152 ifup vlan666</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">ifconfig</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    (network),   ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string">    ,     ,     debian </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces.tail</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  *.tail   ,          web ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    , -        -    ,   .</span></span></code></code> </pre> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <pre> <code class="hljs perl"><code class="bash"><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID <span class="hljs-string"><span class="hljs-string">"Skype"</span></span>: <br> su skype -c <span class="hljs-string"><span class="hljs-string">"echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.6.    </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     ,   sda4 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl set [VEID] --devnodes sda4:rw --save</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.7.  tun/tap </span></span><br><span class="hljs-string"><span class="hljs-string">     vpn  ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">lsmod | grep tun</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">modprobe tun echo "</span></span>tun<span class="hljs-string"><span class="hljs-string">" &gt;&gt; /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">          ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/vz/vz.conf</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    IPTABLES     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">IPTABLES="</span></span>ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp<span class="hljs-string"><span class="hljs-string">"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    VZ </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">/etc/init.d/vz restart</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,  ,      ( ,    ) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">      </span></span></b><span class="hljs-string"><span class="hljs-string"> #!/bin/sh </span></span><br><span class="hljs-string"><span class="hljs-string"> ### BEGIN INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # Provides: iptables.sh </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Start: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Stop: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Start: 2 3 4 5 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Stop: 0 1 6 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Short-Description: My firewall </span></span><br><span class="hljs-string"><span class="hljs-string"> # Description: Rico-X FIREWALL </span></span><br><span class="hljs-string"><span class="hljs-string"> ### END INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # /etc/init.d/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> IPT=/sbin/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> case "</span></span>$1<span class="hljs-string"><span class="hljs-string">" in </span></span><br><span class="hljs-string"><span class="hljs-string"> start) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Starting iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_synack_retries=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_fin_timeout=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_syncookies=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_intvl=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_probes=5 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_time=60 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.conf.default.rp_filter=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> #sysctl -w net.ipv4.ip_forward=0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     lo  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i lo -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i eth1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i vmbr1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     TCP-  SYN- </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #      </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       SSH (  4  ) </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #    netbios </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   ICMP  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state INVALID -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   DHCP   iptables. </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  - </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -N SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> stop) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Stopping iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -F </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -X </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> *) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Usage: <span class="hljs-regexp"><span class="hljs-regexp">/etc/init</span></span>.d/iptables {start|stop}<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 1 </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> esac </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.   </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"</span></span>Europe/Simferopol<span class="hljs-string"><span class="hljs-string">" /etc/localtime &amp;&amp; date</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         web-. </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><b><span class="hljs-string"><span class="hljs-string">/usr/share/pve-manager/ext4/pvemanagerlib.js</span></span></b><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status !== 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status == 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</span></span></b><span class="hljs-string"><span class="hljs-string">    , </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    (cluster not ready - no quorum),      , </span></span><br><span class="hljs-string"><span class="hljs-string">   ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">pvecm e (  )</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">  OpenVZ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  [VEID]  </span></span><br><span class="hljs-string"><span class="hljs-string"> vzctl start [VEID] </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl enter [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl restart [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl destroy [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzlist -a</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   -        ,     ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">UPD-1:  vlan</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       2 .     151,152,666 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">apt-get install vlan</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ifup vlan151 ifup vlan152 ifup vlan666</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">ifconfig</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    (network),   ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string">    ,     ,     debian </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces.tail</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  *.tail   ,          web ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    , -        -    ,   .</span></span></code></code> </pre> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <pre> <code class="hljs perl"><code class="bash"><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID <span class="hljs-string"><span class="hljs-string">"Skype"</span></span>: <br> su skype -c <span class="hljs-string"><span class="hljs-string">"echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.6.    </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     ,   sda4 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl set [VEID] --devnodes sda4:rw --save</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.7.  tun/tap </span></span><br><span class="hljs-string"><span class="hljs-string">     vpn  ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">lsmod | grep tun</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">modprobe tun echo "</span></span>tun<span class="hljs-string"><span class="hljs-string">" &gt;&gt; /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">          ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/vz/vz.conf</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    IPTABLES     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">IPTABLES="</span></span>ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp<span class="hljs-string"><span class="hljs-string">"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    VZ </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">/etc/init.d/vz restart</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,  ,      ( ,    ) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">      </span></span></b><span class="hljs-string"><span class="hljs-string"> #!/bin/sh </span></span><br><span class="hljs-string"><span class="hljs-string"> ### BEGIN INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # Provides: iptables.sh </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Start: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Stop: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Start: 2 3 4 5 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Stop: 0 1 6 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Short-Description: My firewall </span></span><br><span class="hljs-string"><span class="hljs-string"> # Description: Rico-X FIREWALL </span></span><br><span class="hljs-string"><span class="hljs-string"> ### END INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # /etc/init.d/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> IPT=/sbin/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> case "</span></span>$1<span class="hljs-string"><span class="hljs-string">" in </span></span><br><span class="hljs-string"><span class="hljs-string"> start) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Starting iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_synack_retries=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_fin_timeout=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_syncookies=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_intvl=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_probes=5 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_time=60 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.conf.default.rp_filter=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> #sysctl -w net.ipv4.ip_forward=0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     lo  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i lo -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i eth1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i vmbr1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     TCP-  SYN- </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #      </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       SSH (  4  ) </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #    netbios </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   ICMP  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state INVALID -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   DHCP   iptables. </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  - </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -N SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> stop) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Stopping iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -F </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -X </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> *) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Usage: <span class="hljs-regexp"><span class="hljs-regexp">/etc/init</span></span>.d/iptables {start|stop}<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 1 </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> esac </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.   </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"</span></span>Europe/Simferopol<span class="hljs-string"><span class="hljs-string">" /etc/localtime &amp;&amp; date</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         web-. </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><b><span class="hljs-string"><span class="hljs-string">/usr/share/pve-manager/ext4/pvemanagerlib.js</span></span></b><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status !== 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status == 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</span></span></b><span class="hljs-string"><span class="hljs-string">    , </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    (cluster not ready - no quorum),      , </span></span><br><span class="hljs-string"><span class="hljs-string">   ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">pvecm e (  )</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">  OpenVZ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  [VEID]  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> vzctl enter [VEID] </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl restart [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl destroy [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzlist -a</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   -        ,     ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">UPD-1:  vlan</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       2 .     151,152,666 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">apt-get install vlan</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ifup vlan151 ifup vlan152 ifup vlan666</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">ifconfig</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    (network),   ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string">    ,     ,     debian </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces.tail</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  *.tail   ,          web ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    , -        -    ,   .</span></span></code></code> </pre> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <pre> <code class="hljs perl"><code class="bash"><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID <span class="hljs-string"><span class="hljs-string">"Skype"</span></span>: <br> su skype -c <span class="hljs-string"><span class="hljs-string">"echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.6.    </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     ,   sda4 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl set [VEID] --devnodes sda4:rw --save</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.7.  tun/tap </span></span><br><span class="hljs-string"><span class="hljs-string">     vpn  ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">lsmod | grep tun</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">modprobe tun echo "</span></span>tun<span class="hljs-string"><span class="hljs-string">" &gt;&gt; /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">          ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/vz/vz.conf</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    IPTABLES     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">IPTABLES="</span></span>ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp<span class="hljs-string"><span class="hljs-string">"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    VZ </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">/etc/init.d/vz restart</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,  ,      ( ,    ) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">      </span></span></b><span class="hljs-string"><span class="hljs-string"> #!/bin/sh </span></span><br><span class="hljs-string"><span class="hljs-string"> ### BEGIN INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # Provides: iptables.sh </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Start: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Stop: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Start: 2 3 4 5 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Stop: 0 1 6 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Short-Description: My firewall </span></span><br><span class="hljs-string"><span class="hljs-string"> # Description: Rico-X FIREWALL </span></span><br><span class="hljs-string"><span class="hljs-string"> ### END INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # /etc/init.d/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> IPT=/sbin/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> case "</span></span>$1<span class="hljs-string"><span class="hljs-string">" in </span></span><br><span class="hljs-string"><span class="hljs-string"> start) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Starting iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_synack_retries=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_fin_timeout=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_syncookies=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_intvl=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_probes=5 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_time=60 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.conf.default.rp_filter=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> #sysctl -w net.ipv4.ip_forward=0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     lo  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i lo -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i eth1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i vmbr1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     TCP-  SYN- </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #      </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       SSH (  4  ) </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #    netbios </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   ICMP  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state INVALID -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   DHCP   iptables. </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  - </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -N SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> stop) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Stopping iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -F </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -X </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> *) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Usage: <span class="hljs-regexp"><span class="hljs-regexp">/etc/init</span></span>.d/iptables {start|stop}<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 1 </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> esac </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.   </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"</span></span>Europe/Simferopol<span class="hljs-string"><span class="hljs-string">" /etc/localtime &amp;&amp; date</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         web-. </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><b><span class="hljs-string"><span class="hljs-string">/usr/share/pve-manager/ext4/pvemanagerlib.js</span></span></b><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status !== 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status == 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</span></span></b><span class="hljs-string"><span class="hljs-string">    , </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    (cluster not ready - no quorum),      , </span></span><br><span class="hljs-string"><span class="hljs-string">   ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">pvecm e (  )</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">  OpenVZ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  [VEID]  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl enter [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> vzctl stop [VEID] </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl restart [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl destroy [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzlist -a</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   -        ,     ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">UPD-1:  vlan</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       2 .     151,152,666 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">apt-get install vlan</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ifup vlan151 ifup vlan152 ifup vlan666</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">ifconfig</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    (network),   ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string">    ,     ,     debian </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces.tail</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  *.tail   ,          web ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    , -        -    ,   .</span></span></code></code> </pre> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <pre> <code class="hljs perl"><code class="bash"><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID <span class="hljs-string"><span class="hljs-string">"Skype"</span></span>: <br> su skype -c <span class="hljs-string"><span class="hljs-string">"echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.6.    </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     ,   sda4 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl set [VEID] --devnodes sda4:rw --save</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.7.  tun/tap </span></span><br><span class="hljs-string"><span class="hljs-string">     vpn  ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">lsmod | grep tun</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">modprobe tun echo "</span></span>tun<span class="hljs-string"><span class="hljs-string">" &gt;&gt; /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">          ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/vz/vz.conf</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    IPTABLES     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">IPTABLES="</span></span>ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp<span class="hljs-string"><span class="hljs-string">"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    VZ </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">/etc/init.d/vz restart</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,  ,      ( ,    ) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">      </span></span></b><span class="hljs-string"><span class="hljs-string"> #!/bin/sh </span></span><br><span class="hljs-string"><span class="hljs-string"> ### BEGIN INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # Provides: iptables.sh </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Start: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Stop: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Start: 2 3 4 5 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Stop: 0 1 6 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Short-Description: My firewall </span></span><br><span class="hljs-string"><span class="hljs-string"> # Description: Rico-X FIREWALL </span></span><br><span class="hljs-string"><span class="hljs-string"> ### END INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # /etc/init.d/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> IPT=/sbin/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> case "</span></span>$1<span class="hljs-string"><span class="hljs-string">" in </span></span><br><span class="hljs-string"><span class="hljs-string"> start) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Starting iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_synack_retries=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_fin_timeout=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_syncookies=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_intvl=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_probes=5 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_time=60 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.conf.default.rp_filter=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> #sysctl -w net.ipv4.ip_forward=0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     lo  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i lo -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i eth1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i vmbr1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     TCP-  SYN- </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #      </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       SSH (  4  ) </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #    netbios </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   ICMP  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state INVALID -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   DHCP   iptables. </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  - </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -N SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> stop) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Stopping iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -F </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -X </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> *) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Usage: <span class="hljs-regexp"><span class="hljs-regexp">/etc/init</span></span>.d/iptables {start|stop}<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 1 </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> esac </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.   </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"</span></span>Europe/Simferopol<span class="hljs-string"><span class="hljs-string">" /etc/localtime &amp;&amp; date</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         web-. </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><b><span class="hljs-string"><span class="hljs-string">/usr/share/pve-manager/ext4/pvemanagerlib.js</span></span></b><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status !== 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status == 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</span></span></b><span class="hljs-string"><span class="hljs-string">    , </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    (cluster not ready - no quorum),      , </span></span><br><span class="hljs-string"><span class="hljs-string">   ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">pvecm e (  )</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">  OpenVZ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  [VEID]  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl enter [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> vzctl restart [VEID] </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl destroy [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzlist -a</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   -        ,     ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">UPD-1:  vlan</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       2 .     151,152,666 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">apt-get install vlan</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ifup vlan151 ifup vlan152 ifup vlan666</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">ifconfig</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    (network),   ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string">    ,     ,     debian </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces.tail</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  *.tail   ,          web ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    , -        -    ,   .</span></span></code></code> </pre> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <pre> <code class="hljs perl"><code class="bash"><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID <span class="hljs-string"><span class="hljs-string">"Skype"</span></span>: <br> su skype -c <span class="hljs-string"><span class="hljs-string">"echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.6.    </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     ,   sda4 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl set [VEID] --devnodes sda4:rw --save</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.7.  tun/tap </span></span><br><span class="hljs-string"><span class="hljs-string">     vpn  ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">lsmod | grep tun</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">modprobe tun echo "</span></span>tun<span class="hljs-string"><span class="hljs-string">" &gt;&gt; /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">          ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/vz/vz.conf</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    IPTABLES     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">IPTABLES="</span></span>ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp<span class="hljs-string"><span class="hljs-string">"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    VZ </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">/etc/init.d/vz restart</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,  ,      ( ,    ) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">      </span></span></b><span class="hljs-string"><span class="hljs-string"> #!/bin/sh </span></span><br><span class="hljs-string"><span class="hljs-string"> ### BEGIN INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # Provides: iptables.sh </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Start: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Stop: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Start: 2 3 4 5 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Stop: 0 1 6 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Short-Description: My firewall </span></span><br><span class="hljs-string"><span class="hljs-string"> # Description: Rico-X FIREWALL </span></span><br><span class="hljs-string"><span class="hljs-string"> ### END INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # /etc/init.d/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> IPT=/sbin/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> case "</span></span>$1<span class="hljs-string"><span class="hljs-string">" in </span></span><br><span class="hljs-string"><span class="hljs-string"> start) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Starting iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_synack_retries=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_fin_timeout=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_syncookies=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_intvl=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_probes=5 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_time=60 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.conf.default.rp_filter=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> #sysctl -w net.ipv4.ip_forward=0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     lo  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i lo -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i eth1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i vmbr1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     TCP-  SYN- </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #      </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       SSH (  4  ) </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #    netbios </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   ICMP  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state INVALID -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   DHCP   iptables. </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  - </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -N SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> stop) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Stopping iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -F </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -X </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> *) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Usage: <span class="hljs-regexp"><span class="hljs-regexp">/etc/init</span></span>.d/iptables {start|stop}<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 1 </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> esac </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.   </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"</span></span>Europe/Simferopol<span class="hljs-string"><span class="hljs-string">" /etc/localtime &amp;&amp; date</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         web-. </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><b><span class="hljs-string"><span class="hljs-string">/usr/share/pve-manager/ext4/pvemanagerlib.js</span></span></b><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status !== 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status == 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</span></span></b><span class="hljs-string"><span class="hljs-string">    , </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    (cluster not ready - no quorum),      , </span></span><br><span class="hljs-string"><span class="hljs-string">   ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">pvecm e (  )</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">  OpenVZ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  [VEID]  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl enter [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl restart [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> vzctl destroy [VEID] </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzlist -a</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   -        ,     ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">UPD-1:  vlan</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       2 .     151,152,666 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">apt-get install vlan</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ifup vlan151 ifup vlan152 ifup vlan666</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">ifconfig</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    (network),   ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string">    ,     ,     debian </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces.tail</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  *.tail   ,          web ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    , -        -    ,   .</span></span></code></code> </pre> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <pre> <code class="hljs perl"><code class="bash"><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID <span class="hljs-string"><span class="hljs-string">"Skype"</span></span>: <br> su skype -c <span class="hljs-string"><span class="hljs-string">"echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.6.    </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     ,   sda4 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl set [VEID] --devnodes sda4:rw --save</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.7.  tun/tap </span></span><br><span class="hljs-string"><span class="hljs-string">     vpn  ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">lsmod | grep tun</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">modprobe tun echo "</span></span>tun<span class="hljs-string"><span class="hljs-string">" &gt;&gt; /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">          ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/vz/vz.conf</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    IPTABLES     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">IPTABLES="</span></span>ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp<span class="hljs-string"><span class="hljs-string">"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    VZ </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">/etc/init.d/vz restart</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,  ,      ( ,    ) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">      </span></span></b><span class="hljs-string"><span class="hljs-string"> #!/bin/sh </span></span><br><span class="hljs-string"><span class="hljs-string"> ### BEGIN INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # Provides: iptables.sh </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Start: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Stop: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Start: 2 3 4 5 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Stop: 0 1 6 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Short-Description: My firewall </span></span><br><span class="hljs-string"><span class="hljs-string"> # Description: Rico-X FIREWALL </span></span><br><span class="hljs-string"><span class="hljs-string"> ### END INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # /etc/init.d/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> IPT=/sbin/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> case "</span></span>$1<span class="hljs-string"><span class="hljs-string">" in </span></span><br><span class="hljs-string"><span class="hljs-string"> start) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Starting iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_synack_retries=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_fin_timeout=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_syncookies=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_intvl=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_probes=5 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_time=60 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.conf.default.rp_filter=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> #sysctl -w net.ipv4.ip_forward=0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     lo  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i lo -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i eth1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i vmbr1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     TCP-  SYN- </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #      </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       SSH (  4  ) </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #    netbios </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   ICMP  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state INVALID -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   DHCP   iptables. </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  - </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -N SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> stop) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Stopping iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -F </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -X </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> *) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Usage: <span class="hljs-regexp"><span class="hljs-regexp">/etc/init</span></span>.d/iptables {start|stop}<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 1 </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> esac </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.   </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"</span></span>Europe/Simferopol<span class="hljs-string"><span class="hljs-string">" /etc/localtime &amp;&amp; date</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         web-. </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><b><span class="hljs-string"><span class="hljs-string">/usr/share/pve-manager/ext4/pvemanagerlib.js</span></span></b><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status !== 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status == 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</span></span></b><span class="hljs-string"><span class="hljs-string">    , </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    (cluster not ready - no quorum),      , </span></span><br><span class="hljs-string"><span class="hljs-string">   ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">pvecm e (  )</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">  OpenVZ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  [VEID]  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl enter [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl restart [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl destroy [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> vzlist -a </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   -        ,     ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">UPD-1:  vlan</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       2 .     151,152,666 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">apt-get install vlan</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ifup vlan151 ifup vlan152 ifup vlan666</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">ifconfig</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    (network),   ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string">    ,     ,     debian </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces.tail</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  *.tail   ,          web ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    , -        -    ,   .</span></span></code></code> </pre> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <div class="spoiler"> <code><b class="spoiler_title"><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br>  <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</b></code> <div class="spoiler_text"> <pre> <code class="hljs perl"><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID <span class="hljs-string"><span class="hljs-string">"Skype"</span></span>: <br> su skype -c <span class="hljs-string"><span class="hljs-string">"echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.6.    </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     ,   sda4 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl set [VEID] --devnodes sda4:rw --save</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.7.  tun/tap </span></span><br><span class="hljs-string"><span class="hljs-string">     vpn  ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">lsmod | grep tun</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">modprobe tun echo "</span></span>tun<span class="hljs-string"><span class="hljs-string">" &gt;&gt; /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">          ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/vz/vz.conf</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    IPTABLES     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">IPTABLES="</span></span>ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp<span class="hljs-string"><span class="hljs-string">"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    VZ </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">/etc/init.d/vz restart</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,  ,      ( ,    ) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">      </span></span></b><span class="hljs-string"><span class="hljs-string"> #!/bin/sh </span></span><br><span class="hljs-string"><span class="hljs-string"> ### BEGIN INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # Provides: iptables.sh </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Start: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Stop: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Start: 2 3 4 5 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Stop: 0 1 6 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Short-Description: My firewall </span></span><br><span class="hljs-string"><span class="hljs-string"> # Description: Rico-X FIREWALL </span></span><br><span class="hljs-string"><span class="hljs-string"> ### END INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # /etc/init.d/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> IPT=/sbin/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> case "</span></span>$1<span class="hljs-string"><span class="hljs-string">" in </span></span><br><span class="hljs-string"><span class="hljs-string"> start) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Starting iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_synack_retries=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_fin_timeout=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_syncookies=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_intvl=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_probes=5 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_time=60 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.conf.default.rp_filter=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> #sysctl -w net.ipv4.ip_forward=0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     lo  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i lo -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i eth1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i vmbr1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     TCP-  SYN- </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #      </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       SSH (  4  ) </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #    netbios </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   ICMP  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state INVALID -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   DHCP   iptables. </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  - </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -N SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> stop) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Stopping iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -F </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -X </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> *) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Usage: <span class="hljs-regexp"><span class="hljs-regexp">/etc/init</span></span>.d/iptables {start|stop}<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 1 </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> esac </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.   </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"</span></span>Europe/Simferopol<span class="hljs-string"><span class="hljs-string">" /etc/localtime &amp;&amp; date</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         web-. </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><b><span class="hljs-string"><span class="hljs-string">/usr/share/pve-manager/ext4/pvemanagerlib.js</span></span></b><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status !== 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status == 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</span></span></b><span class="hljs-string"><span class="hljs-string">    , </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    (cluster not ready - no quorum),      , </span></span><br><span class="hljs-string"><span class="hljs-string">   ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">pvecm e (  )</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">  OpenVZ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  [VEID]  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl enter [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl restart [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl destroy [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzlist -a</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   -        ,     ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">UPD-1:  vlan</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       2 .     151,152,666 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">apt-get install vlan</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ifup vlan151 ifup vlan152 ifup vlan666</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">ifconfig</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    (network),   ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string">    ,     ,     debian </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces.tail</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  *.tail   ,          web ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    , -        -    ,   .</span></span></code> </pre> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <pre> <code class="hljs perl"><code class="bash"><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID <span class="hljs-string"><span class="hljs-string">"Skype"</span></span>: <br> su skype -c <span class="hljs-string"><span class="hljs-string">"echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.6.    </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     ,   sda4 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl set [VEID] --devnodes sda4:rw --save</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.7.  tun/tap </span></span><br><span class="hljs-string"><span class="hljs-string">     vpn  ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">lsmod | grep tun</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">modprobe tun echo "</span></span>tun<span class="hljs-string"><span class="hljs-string">" &gt;&gt; /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">          ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/vz/vz.conf</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    IPTABLES     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">IPTABLES="</span></span>ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp<span class="hljs-string"><span class="hljs-string">"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    VZ </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">/etc/init.d/vz restart</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,  ,      ( ,    ) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">      </span></span></b><span class="hljs-string"><span class="hljs-string"> #!/bin/sh </span></span><br><span class="hljs-string"><span class="hljs-string"> ### BEGIN INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # Provides: iptables.sh </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Start: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Stop: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Start: 2 3 4 5 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Stop: 0 1 6 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Short-Description: My firewall </span></span><br><span class="hljs-string"><span class="hljs-string"> # Description: Rico-X FIREWALL </span></span><br><span class="hljs-string"><span class="hljs-string"> ### END INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # /etc/init.d/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> IPT=/sbin/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> case "</span></span>$1<span class="hljs-string"><span class="hljs-string">" in </span></span><br><span class="hljs-string"><span class="hljs-string"> start) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Starting iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_synack_retries=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_fin_timeout=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_syncookies=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_intvl=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_probes=5 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_time=60 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.conf.default.rp_filter=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> #sysctl -w net.ipv4.ip_forward=0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     lo  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i lo -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i eth1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i vmbr1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     TCP-  SYN- </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #      </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       SSH (  4  ) </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #    netbios </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   ICMP  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state INVALID -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   DHCP   iptables. </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  - </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -N SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> stop) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Stopping iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -F </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -X </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> *) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Usage: <span class="hljs-regexp"><span class="hljs-regexp">/etc/init</span></span>.d/iptables {start|stop}<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 1 </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> esac </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.   </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"</span></span>Europe/Simferopol<span class="hljs-string"><span class="hljs-string">" /etc/localtime &amp;&amp; date</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         web-. </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><b><span class="hljs-string"><span class="hljs-string">/usr/share/pve-manager/ext4/pvemanagerlib.js</span></span></b><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status !== 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status == 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</span></span></b><span class="hljs-string"><span class="hljs-string">    , </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    (cluster not ready - no quorum),      , </span></span><br><span class="hljs-string"><span class="hljs-string">   ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">pvecm e (  )</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">  OpenVZ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  [VEID]  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl enter [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl restart [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl destroy [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzlist -a</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   -        ,     ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">UPD-1:  vlan</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       2 .     151,152,666 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> apt-get install vlan </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ifup vlan151 ifup vlan152 ifup vlan666</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">ifconfig</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    (network),   ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string">    ,     ,     debian </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces.tail</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  *.tail   ,          web ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    , -        -    ,   .</span></span></code></code> </pre> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <pre> <code class="hljs perl"><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID <span class="hljs-string"><span class="hljs-string">"Skype"</span></span>: <br> su skype -c <span class="hljs-string"><span class="hljs-string">"echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.6.    </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     ,   sda4 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl set [VEID] --devnodes sda4:rw --save</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.7.  tun/tap </span></span><br><span class="hljs-string"><span class="hljs-string">     vpn  ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">lsmod | grep tun</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">modprobe tun echo "</span></span>tun<span class="hljs-string"><span class="hljs-string">" &gt;&gt; /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">          ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/vz/vz.conf</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    IPTABLES     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">IPTABLES="</span></span>ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp<span class="hljs-string"><span class="hljs-string">"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    VZ </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">/etc/init.d/vz restart</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,  ,      ( ,    ) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">      </span></span></b><span class="hljs-string"><span class="hljs-string"> #!/bin/sh </span></span><br><span class="hljs-string"><span class="hljs-string"> ### BEGIN INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # Provides: iptables.sh </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Start: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Stop: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Start: 2 3 4 5 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Stop: 0 1 6 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Short-Description: My firewall </span></span><br><span class="hljs-string"><span class="hljs-string"> # Description: Rico-X FIREWALL </span></span><br><span class="hljs-string"><span class="hljs-string"> ### END INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # /etc/init.d/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> IPT=/sbin/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> case "</span></span>$1<span class="hljs-string"><span class="hljs-string">" in </span></span><br><span class="hljs-string"><span class="hljs-string"> start) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Starting iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_synack_retries=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_fin_timeout=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_syncookies=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_intvl=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_probes=5 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_time=60 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.conf.default.rp_filter=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> #sysctl -w net.ipv4.ip_forward=0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     lo  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i lo -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i eth1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i vmbr1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     TCP-  SYN- </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #      </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       SSH (  4  ) </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #    netbios </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   ICMP  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state INVALID -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   DHCP   iptables. </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  - </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -N SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> stop) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Stopping iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -F </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -X </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> *) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Usage: <span class="hljs-regexp"><span class="hljs-regexp">/etc/init</span></span>.d/iptables {start|stop}<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 1 </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> esac </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.   </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"</span></span>Europe/Simferopol<span class="hljs-string"><span class="hljs-string">" /etc/localtime &amp;&amp; date</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         web-. </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><b><span class="hljs-string"><span class="hljs-string">/usr/share/pve-manager/ext4/pvemanagerlib.js</span></span></b><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status !== 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status == 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</span></span></b><span class="hljs-string"><span class="hljs-string">    , </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    (cluster not ready - no quorum),      , </span></span><br><span class="hljs-string"><span class="hljs-string">   ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">pvecm e (  )</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">  OpenVZ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  [VEID]  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl enter [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl restart [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl destroy [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzlist -a</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   -        ,     ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">UPD-1:  vlan</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       2 .     151,152,666 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">apt-get install vlan</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ifup vlan151 ifup vlan152 ifup vlan666</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">ifconfig</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    (network),   ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string">    ,     ,     debian </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces.tail</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  *.tail   ,          web ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    , -        -    ,   .</span></span></code> </pre> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> </div></div> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <div class="spoiler"> <code><b class="spoiler_title"><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br>     ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</b></code> <div class="spoiler_text"> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <pre> <code class="hljs perl"><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID <span class="hljs-string"><span class="hljs-string">"Skype"</span></span>: <br> su skype -c <span class="hljs-string"><span class="hljs-string">"echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.6.    </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     ,   sda4 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl set [VEID] --devnodes sda4:rw --save</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.7.  tun/tap </span></span><br><span class="hljs-string"><span class="hljs-string">     vpn  ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">lsmod | grep tun</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">modprobe tun echo "</span></span>tun<span class="hljs-string"><span class="hljs-string">" &gt;&gt; /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">          ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/vz/vz.conf</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    IPTABLES     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">IPTABLES="</span></span>ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp<span class="hljs-string"><span class="hljs-string">"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    VZ </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">/etc/init.d/vz restart</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,  ,      ( ,    ) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">      </span></span></b><span class="hljs-string"><span class="hljs-string"> #!/bin/sh </span></span><br><span class="hljs-string"><span class="hljs-string"> ### BEGIN INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # Provides: iptables.sh </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Start: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Stop: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Start: 2 3 4 5 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Stop: 0 1 6 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Short-Description: My firewall </span></span><br><span class="hljs-string"><span class="hljs-string"> # Description: Rico-X FIREWALL </span></span><br><span class="hljs-string"><span class="hljs-string"> ### END INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # /etc/init.d/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> IPT=/sbin/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> case "</span></span>$1<span class="hljs-string"><span class="hljs-string">" in </span></span><br><span class="hljs-string"><span class="hljs-string"> start) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Starting iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_synack_retries=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_fin_timeout=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_syncookies=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_intvl=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_probes=5 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_time=60 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.conf.default.rp_filter=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> #sysctl -w net.ipv4.ip_forward=0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     lo  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i lo -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i eth1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i vmbr1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     TCP-  SYN- </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #      </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       SSH (  4  ) </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #    netbios </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   ICMP  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state INVALID -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   DHCP   iptables. </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  - </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -N SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> stop) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Stopping iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -F </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -X </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> *) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Usage: <span class="hljs-regexp"><span class="hljs-regexp">/etc/init</span></span>.d/iptables {start|stop}<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 1 </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> esac </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.   </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"</span></span>Europe/Simferopol<span class="hljs-string"><span class="hljs-string">" /etc/localtime &amp;&amp; date</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         web-. </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><b><span class="hljs-string"><span class="hljs-string">/usr/share/pve-manager/ext4/pvemanagerlib.js</span></span></b><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status !== 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status == 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</span></span></b><span class="hljs-string"><span class="hljs-string">    , </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    (cluster not ready - no quorum),      , </span></span><br><span class="hljs-string"><span class="hljs-string">   ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">pvecm e (  )</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">  OpenVZ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  [VEID]  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl enter [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl restart [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl destroy [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzlist -a</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   -        ,     ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">UPD-1:  vlan</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       2 .     151,152,666 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">apt-get install vlan</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ifup vlan151 ifup vlan152 ifup vlan666</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">ifconfig</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    (network),   ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string">    ,     ,     debian </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces.tail</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  *.tail   ,          web ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    , -        -    ,   .</span></span></code> </pre> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> <pre> <code class="hljs perl"><code class="bash"><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID <span class="hljs-string"><span class="hljs-string">"Skype"</span></span>: <br> su skype -c <span class="hljs-string"><span class="hljs-string">"echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.6.    </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     ,   sda4 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl set [VEID] --devnodes sda4:rw --save</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 1.7.  tun/tap </span></span><br><span class="hljs-string"><span class="hljs-string">     vpn  ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">lsmod | grep tun</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">modprobe tun echo "</span></span>tun<span class="hljs-string"><span class="hljs-string">" &gt;&gt; /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">          ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/vz/vz.conf</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    IPTABLES     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">IPTABLES="</span></span>ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp<span class="hljs-string"><span class="hljs-string">"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    VZ </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">/etc/init.d/vz restart</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,  ,      ( ,    ) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">nano /etc/modules</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">      </span></span></b><span class="hljs-string"><span class="hljs-string"> #!/bin/sh </span></span><br><span class="hljs-string"><span class="hljs-string"> ### BEGIN INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # Provides: iptables.sh </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Start: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Required-Stop: $all </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Start: 2 3 4 5 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Default-Stop: 0 1 6 </span></span><br><span class="hljs-string"><span class="hljs-string"> # Short-Description: My firewall </span></span><br><span class="hljs-string"><span class="hljs-string"> # Description: Rico-X FIREWALL </span></span><br><span class="hljs-string"><span class="hljs-string"> ### END INIT INFO </span></span><br><span class="hljs-string"><span class="hljs-string"> # /etc/init.d/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> IPT=/sbin/iptables </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> case "</span></span>$1<span class="hljs-string"><span class="hljs-string">" in </span></span><br><span class="hljs-string"><span class="hljs-string"> start) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Starting iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_synack_retries=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_fin_timeout=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_syncookies=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_intvl=10 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_probes=5 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.tcp_keepalive_time=60 </span></span><br><span class="hljs-string"><span class="hljs-string"> sysctl -w net.ipv4.conf.default.rp_filter=1 </span></span><br><span class="hljs-string"><span class="hljs-string"> #sysctl -w net.ipv4.ip_forward=0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     lo  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i lo -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i eth1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -i vmbr1 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> #       </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     TCP-  SYN- </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #      </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #       SSH (  4  ) </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #    netbios </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp --dport 137:139 -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   ICMP  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #     </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state INVALID -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #   DHCP   iptables. </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  - </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> #  </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -N SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -A SYN_FLOOD -j DROP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> stop) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Stopping iptables<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -F </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -X </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P INPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P OUTPUT ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> $IPT -P FORWARD ACCEPT </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> *) </span></span><br><span class="hljs-string"><span class="hljs-string"> echo "</span></span>Usage: <span class="hljs-regexp"><span class="hljs-regexp">/etc/init</span></span>.d/iptables {start|stop}<span class="hljs-string"><span class="hljs-string">" </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 1 </span></span><br><span class="hljs-string"><span class="hljs-string"> ;; </span></span><br><span class="hljs-string"><span class="hljs-string"> esac </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> exit 0 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.   </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"</span></span>Europe/Simferopol<span class="hljs-string"><span class="hljs-string">" /etc/localtime &amp;&amp; date</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         web-. </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><b><span class="hljs-string"><span class="hljs-string">/usr/share/pve-manager/ext4/pvemanagerlib.js</span></span></b><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status !== 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">if (data.status == 'Active') {</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</span></span></b><span class="hljs-string"><span class="hljs-string">    , </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    (cluster not ready - no quorum),      , </span></span><br><span class="hljs-string"><span class="hljs-string">   ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">pvecm e (  )</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">  OpenVZ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  [VEID]  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl start [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl enter [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl stop [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl restart [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzctl destroy [VEID]</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">vzlist -a</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   -        ,     ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">UPD-1:  vlan</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       2 .     151,152,666 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">apt-get install vlan</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ifup vlan151 ifup vlan152 ifup vlan666</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><b><span class="hljs-string"><span class="hljs-string">ifconfig</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    (network),   ,     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"> :</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string">    ,     ,     debian </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">/etc/network/interfaces.tail</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces </span></span><br><span class="hljs-string"><span class="hljs-string">  *.tail   ,          web ,     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    , -        -    ,   .</span></span></code></code> </pre> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> </div></div> <code><code class="bash">  ,    ( ).  ,  X-       . <br> <br> ,   Skype ( Skypiax)      UID "Skype": <br> su skype -c "echo secret:password | DISPLAY=:1 /usr/bin/skype --pipelogin 2&gt;&gt;skype_errors.log &amp;¬ª</code> <br> <br> 1.6.    <br>   ,     ,   sda4 <br> <code class="bash">vzctl set [VEID] --devnodes sda4:rw --save</code> <br> 1.7.  tun/tap <br>     vpn  ,     . <br> <br>     <br> <code class="bash">lsmod | grep tun</code> <br>    <br> <code class="bash">modprobe tun echo "tun" &gt;&gt; /etc/modules</code> <br> <code class="bash">vzctl stop [VEID] vzctl set [VEID] --devices c:10:200:rw --save vzctl set [VEID] --capability net_admin:on --save vzctl start [VEID]</code> <br>   ,    -. <br> <br>  <br>          ,   . <br> <code class="bash">nano /etc/vz/vz.conf</code> <br>    IPTABLES     <br> <code class="bash">IPTABLES="ipt_owner ipt_REDIRECT ipt_recent ip_tables iptable_filter iptable_mangle ipt_limit ipt_multiport ipt_tos ipt_TOS ipt_REJECT ipt_TCPMSS ipt_tcpmss ipt_ttl ipt_LOG ipt_length ip_conntrack ip_conntrack_ftp ipt_state iptable_nat ip_nat_ftp"</code> <br>    VZ <br> <code class="bash">/etc/init.d/vz restart</code> <br>         . <br> <br>  ,  ,      ( ,    ) <br> <code class="bash">nano /etc/modules</code> <br> <code class="bash">ipt_MASQUERADE ipt_helper ipt_REDIRECT ipt_state ipt_TCPMSS ipt_LOG ipt_TOS iptable_nat ipt_length ipt_tcpmss iptable_mangle ipt_limit ipt_tos iptable_filter ipt_ttl ipt_REJECT loop</code> <br>     <br> <b class="spoiler_title">      </b> #!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: iptables.sh <br> # Required-Start: $all <br> # Required-Stop: $all <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: My firewall <br> # Description: Rico-X FIREWALL <br> ### END INIT INFO <br> # /etc/init.d/iptables <br> <br> IPT=/sbin/iptables <br> <br> case "$1" in <br> start) <br> echo "Starting iptables" <br> <br> sysctl -w net.ipv4.tcp_synack_retries=1 <br> sysctl -w net.ipv4.tcp_max_syn_backlog=4096 <br> sysctl -w net.ipv4.tcp_fin_timeout=10 <br> sysctl -w net.ipv4.tcp_syncookies=1 <br> sysctl -w net.ipv4.tcp_keepalive_intvl=10 <br> sysctl -w net.ipv4.tcp_keepalive_probes=5 <br> sysctl -w net.ipv4.tcp_keepalive_time=60 <br> sysctl -w net.ipv4.conf.default.rp_filter=1 <br> #sysctl -w net.ipv4.ip_forward=0 <br> <br> #     <br> $IPT -P INPUT DROP <br> $IPT -P FORWARD ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> <br> #     ,     <br> $IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br> <br> #     lo  <br> $IPT -A INPUT -i lo -j ACCEPT <br> <br> #       <br> $IPT -A INPUT -i eth1 -j ACCEPT <br> $IPT -A INPUT -i vmbr1 -j ACCEPT <br> #       <br> $IPT -A INPUT -m addrtype --dst-type MULTICAST -j ACCEPT <br> $IPT -A INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT <br> <br> #     TCP-  SYN- <br> $IPT -I INPUT -m conntrack --ctstate NEW -p tcp ! --syn -j DROP <br> <br> #      <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT ## SSH <br> $IPT -A INPUT -p tcp -m tcp --dport 5900:5999 -j ACCEPT ## VNC <br> $IPT -A INPUT -p tcp -m tcp --dport 8006 -j ACCEPT ## Proxmox panel <br> <br> #       SSH (  4  ) <br> $IPT -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 4 --rttl --name SSH -j DROP <br> <br> #    netbios <br> $IPT -A INPUT -p tcp --dport 137:139 -j DROP <br> $IPT -A INPUT -p udp --dport 137:139 -j DROP <br> <br> #   ICMP  <br> $IPT -A INPUT -p ICMP --icmp-type 8 -j ACCEPT <br> $IPT -A INPUT -p ICMP --icmp-type 11 -j ACCEPT <br> <br> #     <br> $IPT -A INPUT -m state --state INVALID -j DROP <br> <br> #   DHCP   iptables. <br> $IPT -A INPUT -p udp -m udp --dport 68 --sport 67 -j ACCEPT <br> <br> #  - <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL ALL -j DROP <br> $IPT -A INPUT -m state --state NEW -p tcp --tcp-flags ALL NONE -j DROP <br> <br> #  <br> $IPT -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP <br> $IPT -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP <br> $IPT -N SYN_FLOOD <br> $IPT -A INPUT -p tcp --syn -j SYN_FLOOD <br> $IPT -A SYN_FLOOD -m limit --limit 2/s --limit-burst 6 -j RETURN <br> $IPT -A SYN_FLOOD -j DROP <br> <br> ;; <br> stop) <br> echo "Stopping iptables" <br> <br> $IPT -F <br> $IPT -X <br> <br> $IPT -P INPUT ACCEPT <br> $IPT -P OUTPUT ACCEPT <br> $IPT -P FORWARD ACCEPT <br> ;; <br> *) <br> echo "Usage: /etc/init.d/iptables {start|stop}" <br> exit 1 <br> ;; <br> esac <br> <br> exit 0 <br> <br> 3.   <br>      <br> <code class="bash">mv /etc/localtime /etc/localtime_org &amp;&amp; ln -s /usr/share/zoneinfo/"Europe/Simferopol" /etc/localtime &amp;&amp; date</code> <br>         web-. <br>   <b>/usr/share/pve-manager/ext4/pvemanagerlib.js</b>   <br> <code class="javascript">if (data.status !== 'Active') {</code> <br>    <br> <code class="javascript">if (data.status == 'Active') {</code> <br>      <b>Proxmox: 'exit code 60‚Ä≤ ‚Äì corrupt quota file</b>    , <br>   . <br> <code class="bash">vzquota off [VEID] vzquota : (error) Quota is not running for id [VEID] vzquota : (warning) Repairing quota: it was incorrectly marked as running for id [VEID] vzquota on [VEID]</code> <br>    (cluster not ready - no quorum),      , <br>   ,      <br> <code class="bash">pvecm e (  )</code> <br> <b>  OpenVZ</b> <br>  [VEID]  <br> <code class="bash">vzctl start [VEID]</code> <br>    <br> <code class="bash">vzctl enter [VEID]</code> <br>  <br> <code class="bash">vzctl stop [VEID]</code> <br>  <br> <code class="bash">vzctl restart [VEID]</code> <br>  <br> <code class="bash">vzctl destroy [VEID]</code> <br>   <br> <code class="bash">vzlist -a</code> <br> <br>   -        ,     ,    . <br> <br> <b>UPD-1:  vlan</b> <br> <br>       2 .     151,152,666 <br> <b> :</b> <br>  <b>/etc/network/interfaces</b> <br> <b class="spoiler_title"></b> <code class="bash">auto vlan151 iface vlan151 inet manual vlan_raw_device eth0 auto vlan152 iface vlan152 inet manual vlan_raw_device eth0 auto vlan666 iface vlan666 inet manual vlan_raw_device eth0 auto vmbr151 iface vmbr151 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan151 bridge_stp off bridge_fd 0 auto vmbr152 iface vmbr152 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan152 bridge_stp off bridge_fd 0 auto vmbr666 iface vmbr666 inet static address 0.0.0.0 netmask 255.255.255.255 bridge_ports vlan666 bridge_stp off bridge_fd 0</code> <br>    <br> <code class="bash">apt-get install vlan</code> <br>    <br> <code class="bash">ifup vlan151 ifup vlan152 ifup vlan666</code> <br>      <b>ifconfig</b> <br> <br>      ,    (network),   ,     <br> <img src="https://habrastorage.org/getpro/habr/comment_images/421/900/493/42190049348f9298880c4d8ec5005b49.png"> <br>        . <br> <br> <br> <b> :</b> <br> <b class="spoiler_title"></b>    ,     ,     debian <br>  <b>/etc/network/interfaces.tail</b> <br> <code class="bash">auto eth1 iface eth1 inet static address 10.7.10.5 netmask 255.255.255.0</code> <br>  <br> <code class="bash">cat /etc/network/interfaces.tail &gt;&gt; /etc/network/interfaces</code> <br>  *.tail   ,          web ,     . <br> <br> <br>      ,    , -        -    ,   .</code> </div><p>Source: <a href="https://habr.com/ru/post/210460/">https://habr.com/ru/post/210460/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../210448/index.html">Modern technology for the benefit of</a></li>
<li><a href="../210450/index.html">Python on wheels</a></li>
<li><a href="../210452/index.html">Rule 3h when building a startup team Preply</a></li>
<li><a href="../210454/index.html">Sweet.js: Syntax JavaScript Extensions</a></li>
<li><a href="../210458/index.html">Transparent file encryption on the local computer using CyberSafe Files Encryption</a></li>
<li><a href="../210462/index.html">SharePoint collection site, managed paths, and can subdomains?</a></li>
<li><a href="../210464/index.html">Samsung and Google enter into patent agreements</a></li>
<li><a href="../210466/index.html">Dev Story: Raildale - a game about the railway for iOS and Mac</a></li>
<li><a href="../210468/index.html">Own chess (with tanks and helicopters)</a></li>
<li><a href="../210472/index.html">What to do if you got an Android with a broken touch screen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>