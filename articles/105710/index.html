<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Twitter: 1 billion queries per day and a new search engine</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At the moment, the load on Twitter servers has grown to 1000 TPS (tweets per second) and 12,000 QPS (requests per second) - more than 1 billion reques...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Twitter: 1 billion queries per day and a new search engine</h1><div class="post__text post__text-html js-mediator-article">  At the moment, the load on Twitter servers has grown to 1000 TPS (tweets per second) and 12,000 QPS (requests per second) - more than 1 billion requests per day.  The current infrastructure still stands up, but in order to create a reserve for several years to come, the company decided to update the backend for the search engine.  ‚ÄúIf we worked well, then you shouldn‚Äôt have noticed anything in recent weeks,‚Äù <a href="http://engineering.twitter.com/2010/10/twitters-new-search-architecture.html">according</a> to the Twitter blog. <br><br>  Until recently, the Twitter search backend was based on the old SQL system from Summize.  It was <a href="http://techcrunch.com/2008/07/15/confirmed-twitter-acquires-summize-search-engine/">bought</a> in July 2008 just for this purpose, and also took five out of six developers.  The need to upgrade Twitter became clear immediately after the presentation of the iPhone 3G, and then began cooperation with Summize.  But now it's time to be updated again. <br><br>  About six months ago, it was decided to develop a new, modern search architecture based on an effective inverted index instead of a relational database.  Since Twitter loves open source, we chose the <a href="http://lucene.apache.org/java/docs/index.html">Apache Lucene</a> search library, written in Java, as the starting point for the solution. <br><a name="habracut"></a><br>  Requirements for the new search engine consisted of good scalability and maximum indexing speed.  The task was set that from the moment of the publication of a tweet to the possibility of full-text search on it should take no more than 10 seconds.  Since the indexer is only a part of the whole conveyor on this way, it had to work as fast as possible (less than 1 second). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To achieve their goals, I had to redo Lucene a bit, because it is not very suitable for a search engine in real time.  The basic data structures in memory were rewritten, especially the post-lists, but at the same time the support of the standard Lucene API was preserved, so there was almost no need to redo the search part of the library.  Here are the key benefits resulting from the modification: <br><br>  * significantly improved garbage collection performance <br>  * data structures and non-blocking synchronization algorithms (lock-free) <br>  * post-lists that can be reversed <br>  * effective termination of requests at an early stage <br><br>  According to the developers themselves, some of the applied methods may be interesting and useful to other programmers (not only in the search area), so that in the future a more detailed discussion of the topic is possible. <br><br>  One way or another, all the modifications made to Lucene will be sent to Apache, and some are already included in the main Lucene code and its new branch for real-time search. <br><br>  As a result of the upgrade of the search infrastructure, the load on the backend was significantly reduced (now it is only 5% of the resources), so there is a good reserve for the future.  A new indexer can index about 50 times more tweets per second than is published today.  And the new search engine works absolutely stably, without any complaints. <br><br>  One of the unpleasant moments of the Twitter search engine has always been the inability to search the archive for tweets for more than a few days.  They <a href="http://searchengineland.com/twitter-hits-1-billion-queries-per-day-announces-new-search-tech-52417">explained</a> this by ‚Äúlack of space.‚Äù  To get around this limit, you have to use third-party search engines that independently index tweets, for example, <a href="http://topsy.com/">Topsy</a> . <br><br>  On January 14, 2010, Danny Sullivan <a href="http://searchengineland.com/where-have-all-the-old-tweets-gone-33579">checked the</a> search results with the word [today] and discovered the oldest tweet published 7 days ago. <br><br>  A similar test in mid-September showed that the index depth was reduced to 4 days. <br><br>  With the introduction of a new search, it was announced that the index would be doubled without any consequences for the speed of search queries.  Apparently, this is a return to the same seven-day limit. </div><p>Source: <a href="https://habr.com/ru/post/105710/">https://habr.com/ru/post/105710/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../105705/index.html">Dynamic programming method for counting the number of cycles on a rectangular lattice</a></li>
<li><a href="../105706/index.html">On the issue of ‚Äútheft‚Äù and ‚Äúlicense stickers‚Äù</a></li>
<li><a href="../105707/index.html">Beta testing of ABBYY Lingvo.Pro linguistic portal</a></li>
<li><a href="../105708/index.html">Publication of found vulnerabilities: pros and cons</a></li>
<li><a href="../105709/index.html">Habrafootball this sunday</a></li>
<li><a href="../105711/index.html">The new phone from HTC includes a chip that protects the firmware from modification</a></li>
<li><a href="../105713/index.html">Usability audits in the public domain (Epilogue of the ‚ÄúUsable Web Project‚Äù contest)</a></li>
<li><a href="../105714/index.html">That pixel is my face!</a></li>
<li><a href="../105716/index.html">Cheat Sheet: Caching Images, CSS and JS in NGINX</a></li>
<li><a href="../105717/index.html">Muz-TV is looking for startups about show business!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>