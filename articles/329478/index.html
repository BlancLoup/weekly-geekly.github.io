<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Survival Checklist</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, I somehow suspiciously often observe the most primitive, of the same type and rather easily solved problems on the most different web-projec...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">ğŸ”</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">ğŸ“œ</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">â¬†ï¸</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">â¬‡ï¸</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Survival Checklist</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/8b8/9d1/bba/8b89d1bba9794c68855b9560324499f5.png"><br><br>  Recently, I somehow suspiciously often observe the most primitive, of the same type and rather easily solved problems on the most different web-projects.  Different bases, different languages, different spheres of activity and monetization schemes.  One thing unites them all - the slogan â€œbusiness does not allow rewritingâ€.  The ongoing or just completed stage of the rapid development of a project that is growing and aggressively squeezing competitors' market share gave birth to a huge pile of so-called.  "Govnokoda".  Doubtful architectural solutions either bring a lot of problems, or promise them in the future, but they work.  The flow of new requirements does not give time to restore order, even in the infrastructure, not to mention the code.  If this situation is familiar to you, welcome to cut down, learn something new and / or teach us.  Whom to laugh, and to whom to cry. <br><br>  â€œThis is all only for Hyloda,â€ a thoughtful and insightful reader will say.  Bad is a web project that does not dream of becoming a popular high-end. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><h2>  Problems number 1: base. </h2><br>  The most unpleasant problems on any web-project are always connected with the database.  We can easily scale everything else - from DNS-balancing to the upstream directive in the nginx config.  â€œWhat about clustering?â€ The thoughtful reader will ask.  That's the problem.  I am watching a cluster of enforced databases for the third time.  Twice MySQL and once MongoDB.  Indexes are not configured, tables (collections - what's the difference?) Are not cleaned, but not cheap servers for the cluster are paid for.  And basically, these servers are busy digging out unindexed data and building unused indexes in the name of entropy. <br><br>  This group of problems is especially widespread in offices that practice the current trend of separating backend developers from admins / DevOps / NOC. <br><br>  Why is it scary to keep the base in tired condition?  Yes, because you lose the hell out of everything: orders, customers, SEO page rank.  And why should the hosting provider overpay? <br><br>  Personally, I, spoiled by the impoverished childhood, immediately have a cry from the heart: do not pay the hosting provider, pay me better. <br><br>  Another of the beautiful things: if there is a tired, stormy base under your feet, and as a result - a few seconds response from the web server on almost all pages - to perform a performance instrument, carefully not touching the base. <br><br><h3>  The "n + 1" problem </h3><br>  It turns out that there are two major types of rape base, although a couple of months ago I personally did not suspect this, the most ridiculous of them.  Have you heard of the "n + 1 problem"?  I kind of remember something like that in deep junior childhood.  In life, I would not have believed that something like that could break through on the sale of a commercial project.  The easiest problem can be characterized by pseudocode: <br><br><pre><code class="javascript">list = db.query('SELECT * FROM products;')
for (item in list){
      orders = db.query('SELECT * FROM orders WHERE product_id = ?;', {product_id: product.id});
      ...
}
</code></pre><br>
  .   access log -  query log        ,     .  50MB access log   20GB query log â€”  .    â€”    ,      - ,  -   .<br>
<br>
 : webdev â€”              . .<br>
<br>
    go-   .       ,  ,  ActiveRecord      .    php  js .<br>
<br>
     :<br>
<br>
<pre><code class="sql">SELECT p.*, ( SELECT count(*) FROM comments WHERE product_id = p.id) comment_count FROM products p WHERE author_id = ?;
</code></pre><br>
,  â€”   .   Â«n+1Â».    LIMIT.   JOIN (  GROUP BY) â€”   ,     â€”  .   â€”        . ,   ORM   .  â€”     .<br>
<br>
<h3>  </h3><br>
-  -         .<br>
<br>
   : , , <a href="https://dev.mysql.com/doc/mysql-utilities/1.5/en/mysqlindexcheck.html">dev.mysql.com/doc/mysql-utilities/1.5/en/mysqlindexcheck.html</a>  <a href="https://www.percona.com/doc/percona-toolkit/2.1/pt-duplicate-key-checker.html">www.percona.com/doc/percona-toolkit/2.1/pt-duplicate-key-checker.html</a>, ,      .    â€”    ,    .    â€”  unindexed query log (      ,   )   .      â€”           .            .<br>
<br>
        â€”      .  ,       ,    .  MySQL,    EXPLAIN SELECT   Â«ROWS examinedÂ»,    query log (long_query_time = 0).     ,     . , ,   sum(Rows Examined) â€”        .   â€”  95-    Â«Rows ExaminedÂ» vs Â«Rows SentÂ».         .       <a href="https://www.percona.com/doc/percona-toolkit/2.2/pt-query-digest.html">www.percona.com/doc/percona-toolkit/2.2/pt-query-digest.html</a>.       â€”         .      â€”   ,        ,    .<br>
       .     .     â€”   ,   , ,   Â«    RDB     â€”   RDB Â».   .      <br>
<pre><code class="sql"> SELECT FOR UPDATE ... SKIP LOCKED; </code></pre>     PostgreSQL,   .<br>
<br>
       php-.      â€”        Â«     Â»   PHP.<br>
<br>
<h3>  </h3><br>
  ,        â€”       ?      â€”    ,               .  â„–1                    . ,   -    . -  ,   , .  ,     .<br>
<br>
:     c  zip? ? mysqldump? backup?<br>
:   ,   -  Â« Â»,    ALTER TABLE -    .      ?            ?   ?<br>
<br>
<h3></h3><br>
  10              , . , ,    3-   â€”    .   -    .         -  .<br>
<br>
    - .      ,      error . ,          parent_id IN(  id).<br>
<br>
      -                    .    . ,  -  php         ?   ?    â€”   .<br>
<br>
<h3>   </h3><br>
    ,      -,  /    ,            .  â€”             .<br>
<br>
 Â«Â» -        â€” CPU, bandwidth, RAM.          ,   â€” munin/monit/sa+sar/htop /       â€”             .<br>
<br>
            -  .    â€”  .  UPDATE-      ,       SELECT    (    ,         ) , .  PostgreSQL   immutable tuples  UPDATE      .<br>
<b>UP1:  <a href="https://habr.com/post/329478/"></a> <a href="https://habrahabr.ru/users/terrier/" class="user_link">terrier</a> PostgeSQL   ,    . Uber   .     .      ? </b><br>
<br>
 MySQL       .          -  ,         .        ?<br>
<br>
:   products2,         . .   - -         â€”           .<br>
<br>
: ,   ,     ()   .   ,  ,  Â«   ,   Â».       â€”  bottleneck            / .<br>
<br>
:    ,   <br>
<br>
<h2> â„–2 â€” </h2><br>
         ,  ,     .   â€”  .<br>
<br>
,      â€”  . -  ,   -   .       â€” -      .<br>
<br>
         . CodeSniffer  code review    code quality    -  Â«Â» .<br>
<br>
 â€” :    -     code review.     over-pattern-usage.     ?    ,          .      â€”        . Dependency Injection â€”  ,      - /      ,   ZF 1.x.  â€” . Repository + Entity â€” driven db access  100%          legacy .      ,     stateless  â€”     .        ActiveRecord,        . <br>
 ,  ,       SOLID  .    SOLID â€”       OOP.  ,  -       .<br>
<br>
: ,       (,    ?)       .<br>
<br>
 :    â€”  .    ,  .<br>
<br>
 ,    .  ,     ?     â€”    ,  -. Webdev â€”           .        apache?        .htaccess- ? <br>
<br>
<h2> â„–3 â€” </h2><br>
    â€” .   this.   ,      -  â€”    / JQuery   c ExtJS, /  MVC ,      backbone.js.   â€”   ,     ,    .<br>
<br>
: , es2015 javscript.    ,     jQuery   .   .   ,   .      . , TypeScript    JS: ,      -.   .<br>
<br>
<h2> â„–4 â€” </h2><br>
    -        . ,  ,  ,  .  â€”    . ,   /  ,    /    .       .     ,     .<br>
<br>
        -  . ,         .       :       .          .<br>
<br>
        .      ?        ?<br>
<br>
       -.        ?   zero-time-deployment       .<br>
<br>
      zero-time-deployment.  ,    downtime ?<br>
<br>
        ,      . ,   Jenkins   ,       /  /   /  /        /  / ?         ? ,   .<br>
<br>
            -?     deny from all ?   ?<br>
<br>
      ,       .   !<br>
<br>
         .  â€¦<br>
<br>
<h2>  .</h2><br>
      ,  .<br>
<br>
<h3> â„–0: .</h3><br>
       .      ,  , CAP-   IT-.     .<br>
<br>
:      ,         ,         ,    .          â€”  ,     . ,  ,    â€”      .        Â«   ?Â».<br>
<br>
:     .   .<br>
<br>
<h3> â„–1: </h3><br>
     .    â€”    ,         ,     /  ,     ,     .       Â«     .   Â».<br>
<br>
 : . ,    .  .  â€”  ,      .<br>
<br>
      Â« Â» â€”         ,         .       .    bottleneck?<br>
<br>
: .<br>
<br>
 ,      â€”      sucks. Back in USSR,      .       .  .<br>
<br>
            â€”  .     -  .      â€” ,    JIRA / Redmine /    .<br>
<br>
  â€”   . , ,      â€”     .      ,   â€”   . , ,          Â«   Â»? <br>
<br>
   ,     /    â€”    .</div><p>Source: <a href="https://habr.com/ru/post/329478/">https://habr.com/ru/post/329478/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../329468/index.html">BDD - working method or TDD in a fashionable wrapper?</a></li>
<li><a href="../329470/index.html">Do-it-yourself phishing. Experience of the company "Aktiv", part one</a></li>
<li><a href="../329472/index.html">Basic storage protocols: use and prospects</a></li>
<li><a href="../329474/index.html">Intel provides access to clDNN [high-performance library for deep learning]</a></li>
<li><a href="../329476/index.html">Russian Code Cup - in the wake of the qualifying round</a></li>
<li><a href="../329480/index.html">The online store's productivity is sketchy or where to start improving it</a></li>
<li><a href="../329482/index.html">A selection of free veeam tools</a></li>
<li><a href="../329484/index.html">Autopilot on your own: sensor fusion from the phone and open training data</a></li>
<li><a href="../329488/index.html">Visual editor of letters on React + Redux. Overview, example of use and expansion</a></li>
<li><a href="../329492/index.html">Industrial mitap # 3: safe process automation is in focus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>