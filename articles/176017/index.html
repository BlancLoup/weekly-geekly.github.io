<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ASP NET.MVC Lesson 3. Working with the Database</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The purpose of the lesson : Learn the basic principles of working with a database. Brief description of the relational database model. Work with the d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ASP NET.MVC Lesson 3. Working with the Database</h1><div class="post__text post__text-html js-mediator-article">  <b>The purpose of the lesson</b> : Learn the basic principles of working with a database.  Brief description of the relational database model.  Work with the database (creating tables, links in VS 2012).  Commands INSERT, UPDATE, DELETE, SELECT.  Using LinqToSql and Linq.  Create a repository, IRepository, SqlRepository. <br><br><h5>  What is a DB? </h5><br>  A relational database is a database based on a relational data model.  Relationality is a relationship (connection) from the English.  relation. <br><a name="habracut"></a><br><h6>  Tables </h6><br>  This is the table: <br><img src="https://habrastorage.org/storage2/c96/f33/38e/c96f3338e7b4428a4b0e275a905d1d81.gif"><br><br>  The table consists of columns and rows.  Columns have properties - name, data type. <br>  Tables should have the following properties: <br><ul><li>  the table has a name (unique) </li><li>  no two lines are the same </li><li>  columns have different names (no two columns are the same) </li><li>  the order of the rows in the table is arbitrary (i.e. it is not necessary to take into account the order of the rows if sorting is not specified) </li></ul><br>  The structure of the table can be written in this form: <br><ul><li>  Column name </li><li>  The data type for this column </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h6>  Connections </h6><br>  Relationships exist between tables.  To establish a connection, you must have the following: <br><ul><li>  A primary key is a set of columns (attributes) of a table that uniquely identify the uniqueness of a row.  This is usually one field called ID.  It is auto-incremental, i.e.  when trying to add a record, 1, 2, 3, 4 ... n + 1 is automatically inserted there, where n is the value of the last added ID. </li><li>  A foreign key is a set of columns (attributes) of a table that uniquely determine the uniqueness of a row in another table.  Again, this is usually one field called the [Table Name] ID.  But it is not auto-increment. </li><li>  A link is established between the primary key and the foreign key. </li></ul><br><br>  Links are of three types: <br><ul><li>  <b>One to one.</b>  Those.  one row in the table corresponds to one row in another table.  It is rarely used, but used.  For example, in one table data about the user, and in another - additional data about the same user.  This option is necessary to manipulate, if necessary, a smaller amount of data. </li><li>  <b>One to many.</b>  One row in table A corresponds to one or more rows in table B. But only one row in table A corresponds to one row in table B. In this case, there is a foreign key in table B that uniquely identifies an entry in table A. </li><li>  <b>Many-to-many.</b>  One line in table A corresponds to one or several lines in table B, which is true in the opposite.  In this case, an additional table is created with its primary key, and two foreign keys to table A and B. </li></ul><br>  Now let's figure out how to do it. <br><br><h5>  Creating a simple schema in the database </h5><br>  Let's create a database in VS 2012: <br><br><img src="https://habrastorage.org/storage2/149/efd/c26/149efdc2641aeda850e3f375869804fd.jpg"><br><br>  Let's call it LessonProject, and add 3 tables Role User and UserRole. <br>  Create a Role table: <br><br><img src="https://habrastorage.org/storage2/455/6f5/f72/4556f5f72ce57b28359c29e10ee9b4fd.jpg"><br><br><img src="https://habrastorage.org/storage2/919/5db/c02/9195dbc022a87fa469104c26f9b2ba3e.jpg"><br><br>  For string values, we use the type nvarchar (n), where n is the maximum length of the string, usually between 50 and 500. For large text lines, nvarchar (MAX) is used. <br><br>  Install the primary key: <br><br><img src="https://habrastorage.org/storage2/be4/5cd/e77/be45cde770889a42b93fa93c00f88c9b.jpg"><br><br>  Set the ID autoincrement: <br><br><img src="https://habrastorage.org/storage2/9f6/5cf/52c/9f65cf52c4706e759043c69eda48a8d2.jpg"><br><br>  Similarly, create a User table: <br><table><tbody><tr><td>  <b>Field</b> </td><td>  <b>Field type</b> </td></tr><tr><td>  ID </td><td>  int </td></tr><tr><td>  Email </td><td>  nvarchar (150) </td></tr><tr><td>  Password </td><td>  nvarchar (50) </td></tr><tr><td>  AddedDate </td><td>  datetime </td></tr><tr><td>  Activateddate </td><td>  datetime (null) </td></tr><tr><td>  Activatedlink </td><td>  nvarchar (50) </td></tr><tr><td>  LastVisitDate </td><td>  datetime (null) </td></tr><tr><td>  Avatarpath </td><td>  nvarchar (150) (null) </td></tr></tbody></table><br><br>  Create a UserRole table: <br><table><tbody><tr><td>  <b>Field</b> </td><td>  <b>Field type</b> </td></tr><tr><td>  ID </td><td>  int </td></tr><tr><td>  Userid </td><td>  int </td></tr><tr><td>  RoleID </td><td>  int </td></tr></tbody></table><br><br>  Add links: <br><br><img src="https://habrastorage.org/storage2/977/523/7c7/9775237c7298fb756f72f2b1b65ada27.jpg"><br><br>  Add a new link by clicking Add.  Adding links occurs in the table where the foreign keys are located.  Expand the Tables and Columns tab and set the table with the primary key, and select the foreign key in the current UserRole table. <br><br><img src="https://habrastorage.org/storage2/d63/560/927/d6356092752310ea3112a40a3baca81d.jpg"><br><br>  In the properties of the INSERT And UPDATE Specification, we set the On Update / On Delete properties of the Cascade: <br><br><img src="https://habrastorage.org/storage2/ca3/1c3/0b1/ca31c30b160b97646259d5d91b05b230.jpg"><br><br>  This is necessary in order to change / delete a column from the Role table, all the rows of the UserRole table associated with this row must be changed or deleted. <br><br>  We establish a similar connection with the User table. <br><br>  Thus, the Role and User tables have many to many relationships through the UserRole table.  Those.  one user may have more than one role, and several users may have the same role. <br><br><h5>  SELECT, INSERT, UPDATE, DELETE. </h5><br>  Relational databases use SQL query language. <br><br>  There are 4 basic commands for manipulating data - SELECT, INSERT, UPDATE, DELETE <br><br>  SELECT - to select data and tables. <br>  Example: <br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">User</span></span></code> </pre> <br>  INSERT - Adding rows to a table <br>  Example: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Role</span></span> (Code, <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (‚Äú<span class="hljs-keyword"><span class="hljs-keyword">admin</span></span>‚Äù, ‚Äú‚Äù)</code> </pre><br>  UPDATE - change the values ‚Äã‚Äãin the table <br>  Example: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">User</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Password</span></span>=‚Äùpassword1‚Äù <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br>  DELETE - delete rows from a table. <br>  Example: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">User</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> =<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br><br>  <i>Note: You can learn more about SQL by reference:</i> <br>  <a href="http://www.w3schools.com/sql/">http://www.w3schools.com/sql/</a> <br>  <a href="http://codingcraft.ru/sql_queries.php">http://codingcraft.ru/sql_queries.php</a> <br><br><h5>  LinqToSQL and Linq. </h5><br>  Create a project LessonProject.Model to work with the database of type ClassLibrary. <br>  Add LINQ to SQL Classes type, call LessonProejctDb.dbml <br><br><img src="https://habrastorage.org/storage2/195/475/c0b/195475c0bd21d33c677474644617f589.jpg"><br><br>  Open the object, select all the tables and drag it to the canvas with the mouse: <br><br><img src="https://habrastorage.org/storage2/197/b26/686/197b26686844001ee91fbdf967dbcc21.jpg"><br><br>  Actually, with the help of such simple actions we get: <br><ul><li>  classes ready for use in working with the database </li><li>  visual display of tables and links </li></ul><br><br>  Add some data to the Role and User table: <br><br><table><tbody><tr><td>  one </td><td>  admin </td><td>  Admin </td></tr><tr><td>  2 </td><td>  customer </td><td>  Customer </td></tr></tbody></table><br><br><table><tbody><tr><td>  one </td><td>  chernikov@gmail.com </td><td>  123456 </td><td>  1/1/2012 12:00:00 AM </td><td>  Null </td><td>  123456 </td><td>  Null </td><td>  Null </td></tr><tr><td>  2 </td><td>  chernikov2@gmail.com </td><td>  123456 </td><td>  1/1/2012 12:00:00 AM </td><td>  Null </td><td>  123456 </td><td>  Null </td><td>  Null </td></tr></tbody></table><br><br>  And userole <br><br><table><tbody><tr><td>  <b>ID</b> </td><td>  <b>Userid</b> </td><td>  <b>RoleID</b> </td></tr><tr><td>  one </td><td>  one </td><td>  one </td></tr><tr><td>  2 </td><td>  one </td><td>  2 </td></tr><tr><td>  3 </td><td>  2 </td><td>  2 </td></tr></tbody></table><br><br>  Create a console project Lesson3 and connect LessonProject.Model.  Add the System.Configuration and System.Data.Linq assembly.  Initialize the context and display data about the roles: <br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> context = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LessonProjectDbDataContext(ConfigurationManager.ConnectionStrings[<span class="hljs-string"><span class="hljs-string">"ConnectionString"</span></span>].ConnectionString); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> roles = context.Roles.ToList(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> role <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> roles) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"{0} {1} {2}"</span></span>, role.ID, role.Code, role.Name); } Console.ReadLine(); } }</code> </pre><br><br>  To add a line to Role, do this: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newRole = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Role { Code = <span class="hljs-string"><span class="hljs-string">"manager"</span></span>, Name = <span class="hljs-string"><span class="hljs-string">""</span></span> }; context.Roles.InsertOnSubmit(newRole); context.Roles.Context.SubmitChanges();</code> </pre><br>  To delete a line in Role, do this: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> role = context.Roles.Where(p =&gt; p.Name == <span class="hljs-string"><span class="hljs-string">""</span></span>).FirstOrDefault(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (role != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { context.Roles.DeleteOnSubmit(role); context.Roles.Context.SubmitChanges(); }</code> </pre><br>  To change the data, do this: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> role = context.Roles.Where(p =&gt; p.Name == <span class="hljs-string"><span class="hljs-string">""</span></span>).FirstOrDefault(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (role != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { role.Name = <span class="hljs-string"><span class="hljs-string">""</span></span>; context.Roles.Context.SubmitChanges(); }</code> </pre><br>  Linq query language is used to manipulate data.  We will cover only some basic Linq functions.  Linq is used for types implementing IQueryable interface &lt;&gt; <br><br><ul><li>  <b>.Where ()</b> is the main filtering function.  Returns the type of IQueryable.  The condition inside must return a boolean value (bool). <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> roles = context.Roles.Where(p =&gt; p.Name == <span class="hljs-string"><span class="hljs-string">""</span></span>)</code> </pre><br></li><li>  <b>.FirstOrDefault () - .First (), .Single (), .SingleOrDefault ()</b> - get the first or only record.  If there is no entry, then FirstOrDefault () or SingleOrDefault () returns null (in fact, the default value of this type is [default (int)], for example). <br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> roles = context.Roles.Where(p =&gt; p.Name == <span class="hljs-string"><span class="hljs-string">""</span></span>).FirstOrDefault()</code> </pre>  - we receive the first (or we do not receive) the role named "Manager". <br></li><li>  <b>.Take ()</b> - selects N first records <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> roles = context.Roles.Where(p =&gt; p.Name == <span class="hljs-string"><span class="hljs-string">""</span></span>).Take(<span class="hljs-number"><span class="hljs-number">4</span></span>)</code> </pre>  - selects 4 first entries <br></li><li>  <b>.Skip ()</b> - skips the selection of the first N records <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> roles = context.Roles.Where(p =&gt; p.Name == <span class="hljs-string"><span class="hljs-string">""</span></span>). Skip(<span class="hljs-number"><span class="hljs-number">2</span></span>).Take(<span class="hljs-number"><span class="hljs-number">3</span></span>)</code> </pre>  - skip the first 2 and select the following 3 entries <br></li><li>  <b>.OrderBy ()</b> - sorts in ascending order.  And also OrderByDescending (), ThenBy (), ThenByDescending ().  The lambda expression must return the type int, by which the sorting will occur. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> roles = context.Roles.Where(p =&gt; p.Name == <span class="hljs-string"><span class="hljs-string">""</span></span>).OrderBy(p =&gt; p.ID)</code> </pre>  - sorts in order <br></li><li>  .Count () - gets the number of records <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rolesCount = context.Roles.Where(p =&gt; p.Name == <span class="hljs-string"><span class="hljs-string">""</span></span>).Count()</code> </pre>  - number of records <br></li><li>  <b>.Any ()</b> - there is one or more records for this condition <br>  var rolesExist = context.Roles.Where (p =&gt; p.Name == "Manager"). Any () - is there such a record <br></li><li>  <b>.</b>  <b>Select ()</b> - returns IQueryable of any type, maybe even dynamic: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> otherRole = context.Roles.Where(p =&gt; p.Name == <span class="hljs-string"><span class="hljs-string">""</span></span>).Select(p =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { ID = p.ID, Kod = p.Code})</code> </pre>  - we receive the dynamic type generated on the basis of Role. <br></li><li>  <b>.SelectMany ()</b> - returns the union of all IQueryable types within the sample: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> otherRole = context.Roles.Where(p =&gt; p.Name == <span class="hljs-string"><span class="hljs-string">""</span></span>).SelectMany(p =&gt; p.UserRoles)</code> </pre>  - we get all UserRole from the role named ‚ÄúManager‚Äù <br></li><li>  <b>.Distinct ()</b> - removes duplicates <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> managers = context.Roles.Where(p =&gt; p.Name == <span class="hljs-string"><span class="hljs-string">""</span></span>).SelectMany(p =&gt; p.UserRoles).Select(p =&gt; p.User).Distinct()</code> </pre>  - all users with a role called "Manager" <br></li></ul><br>  <i>Note: <code>First(), FirstOrDefault(), Single(), SingleOrDefault(), Any(), Count()</code> - can use the parameter corresponding to <code>Where()</code> , thus, you can reduce the record:</i> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> roles = context.Roles.FirstOrDefault(p =&gt; p.Name == <span class="hljs-string"><span class="hljs-string">""</span></span>)</code> </pre><br><br>  <i>More examples and uses of linq can be found:</i> <i><br></i>  <i><a href="http://code.msdn.microsoft.com/101-LINQ-Samples-3fb9811b">http://code.msdn.microsoft.com/101-LINQ-Samples-3fb9811b</a></i> <i><br></i> <br><br><h5>  Creating an IRepository, SqlRepository Repository. </h5><br><br>  Actually, we can already work with the database, only now we need to separate the data model from the concrete implementation, i.e.  Our controllers about context and System.Data.Linq should not know anything at all. <br><br>  To do this, create an interface IRepository, which will be given access to the data, and also deduced methods for creating, modifying and deleting this data. <br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IRepository</span></span> { IQueryable&lt;Role&gt; Roles { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateRole</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Role instance</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateRole</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Role instance</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveRole</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> idRole</span></span></span><span class="hljs-function">)</span></span>; ‚Ä¶ }</code> </pre><br><br>  The implementation is called the SqlRepository.  Since we don‚Äôt want to specifically link to this SqlRepository context, we will add a Ninject module to the LessonProject.Model project: <br><pre> <code class="bash hljs">Install-Package Ninject</code> </pre><br><br>  Create the SqlRepository class: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SqlRepository</span></span> : <span class="hljs-title"><span class="hljs-title">IRepository</span></span> { [Inject] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> LessonProjectDbDataContext Db { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IQueryable&lt;Role&gt; Roles { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NotImplementedException(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateRole</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Role instance</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NotImplementedException(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateRole</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Role instance</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NotImplementedException(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveRole</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> idRole</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NotImplementedException(); } }</code> </pre><br><br>  Before implementing access to all tables, creation, deletion and modification, we will think that this file will look huge and clumsy.  This code will be hard to manage physically.  So let's make a separate SqlRepository folder and the SqlRepository class will be partial, and in the folder we will create implementations of the IRepository interface, broken down into each table.  Name the file Role: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SqlRepository</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IQueryable&lt;Role&gt; Roles { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Db.Roles; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateRole</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Role instance</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (instance.ID == <span class="hljs-number"><span class="hljs-number">0</span></span>) { Db.Roles.InsertOnSubmit(instance); Db.Roles.Context.SubmitChanges(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveRole</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> idRole</span></span></span><span class="hljs-function">)</span></span> { Role instance = Db.Roles.FirstOrDefault(p =&gt; p.ID == idRole); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (instance != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Db.Roles.DeleteOnSubmit(instance); Db.Roles.Context.SubmitChanges(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } }</code> </pre><br><br>  A small project contains from 10 to 40 tables, a large project from 40, and I would like to automate all this.  Create several snippets for the IRepository and for the SqlRepository.  Snippets are ready-made code templates that are invoked with intelliSence and allow you to quickly create code. <br><br><h5>  Snipples </h5><br><br>  For IRepository tables, create a table.snippet: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CodeSnippets</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/VisualStudio/2005/CodeSnippet"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CodeSnippet</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Format</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0.0"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Header</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Title</span></span></span><span class="hljs-tag">&gt;</span></span> Table <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Shortcut</span></span></span><span class="hljs-tag">&gt;</span></span>Table<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Shortcut</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Header</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Snippet</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Declarations</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Literal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ID</span></span></span><span class="hljs-tag">&gt;</span></span>Table<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ID</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ToolTip</span></span></span><span class="hljs-tag">&gt;</span></span>Table name for create.<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ToolTip</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Default</span></span></span><span class="hljs-tag">&gt;</span></span>Table<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Default</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Literal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Declarations</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Code</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Language</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"CSharp"</span></span></span><span class="hljs-tag">&gt;</span></span> &lt;![CDATA[ #region $Table$ IQueryable&lt;$Table$&gt; $Table$s { get; } bool Create$Table$($Table$ instance); bool Update$Table$($Table$ instance); bool Remove$Table$(int id$Table$); #endregion ]]&gt; <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Code</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Snippet</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CodeSnippet</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CodeSnippets</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  For the SqlRepository, create a sqlTable.snippet snippet: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CodeSnippets</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/VisualStudio/2005/CodeSnippet"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CodeSnippet</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Format</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0.0"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Header</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Title</span></span></span><span class="hljs-tag">&gt;</span></span> Sql repository <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Shortcut</span></span></span><span class="hljs-tag">&gt;</span></span>sqltable<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Shortcut</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Header</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Snippet</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Declarations</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Literal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ID</span></span></span><span class="hljs-tag">&gt;</span></span>Table<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ID</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ToolTip</span></span></span><span class="hljs-tag">&gt;</span></span>Table name for create.<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ToolTip</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Default</span></span></span><span class="hljs-tag">&gt;</span></span>Table<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Default</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Literal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Declarations</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Code</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Language</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"CSharp"</span></span></span><span class="hljs-tag">&gt;</span></span> &lt;![CDATA[ public IQueryable&lt;$Table$&gt; $Table$s { get { return Db.$Table$s; } } public bool Create$Table$($Table$ instance) { if (instance.ID == 0) { Db.$Table$s.InsertOnSubmit(instance); Db.$Table$s.Context.SubmitChanges(); return true; } return false; } public bool Update$Table$($Table$ instance) { $Table$ cache = Db.$Table$s.Where(p =&gt; p.ID == instance.ID).FirstOrDefault(); if (cache != null) { //TODO : Update fields for $Table$ Db.$Table$s.Context.SubmitChanges(); return true; } return false; } public bool Remove$Table$(int id$Table$) { $Table$ instance = Db.$Table$s.Where(p =&gt; p.ID == id$Table$).FirstOrDefault(); if (instance != null) { Db.$Table$s.DeleteOnSubmit(instance); Db.$Table$s.Context.SubmitChanges(); return true; } return false; } ]]&gt; <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Code</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Snippet</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CodeSnippet</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CodeSnippets</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  To add a code-snippet.  open TOOLS -&gt; Code Snippet Manager ... (Ctrl-K, B).  In the window, click Import and import both snippets into My Code snippet: <br><br><img src="https://habrastorage.org/storage2/309/8db/cb9/3098dbcb9427a1421b6f99324c28edcd.jpg"><br><br>  Finish, OK. <br>  Use for tables User and UserRole. <br><br><img src="https://habrastorage.org/storage2/69d/040/b4b/69d040b4b66a0edf72a6620108019bc6.jpg"><br><br><img src="https://habrastorage.org/storage2/9e2/c66/479/9e2c6647903083b0f1183aade33b6319.jpg"><br><br>  It remains to register only the fields for <code>Update</code> [table name], but this is less work. <br><br><h5>  Proxy </h5><br>  As you can see, the classes that we use are partial, so you can add them.  Let's create, like SqlRepository, a folder Proxy, where we will allocate partial classes.  For example, for the User class, create a method that automatically generates the string required for user activation: <br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">User</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetActivateUrl</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Guid.NewGuid().ToString(<span class="hljs-string"><span class="hljs-string">"N"</span></span>); } }</code> </pre><br>  We use this: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateUser</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">User instance</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (instance.ID == <span class="hljs-number"><span class="hljs-number">0</span></span>) { instance.AddedDate = DateTime.Now; instance.ActivatedLink = User.GetActivateUrl(); Db.Users.InsertOnSubmit(instance); Db.Users.Context.SubmitChanges(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre><br><br><h5>  Using DB in asp.net mvc </h5><br>  Add the database access string to web.Config: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">connectionStrings</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ConnectionString"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">connectionString</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Data Source=SATURN-PC;Initial Catalog=LessonProject;Integrated Security=True;Pooling=False"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">providerName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"System.Data.SqlClient"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">connectionStrings</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Initialize the work with the database in Ninject: <br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RegisterServices</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IKernel kernel</span></span></span><span class="hljs-function">)</span></span> { kernel.Bind&lt;LessonProjectDbDataContext&gt;().ToMethod(c =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LessonProjectDbDataContext(ConfigurationManager.ConnectionStrings[<span class="hljs-string"><span class="hljs-string">"ConnectionString"</span></span>].ConnectionString)); kernel.Bind&lt;IRepository&gt;().To&lt;SqlRepository&gt;().InRequestScope(); }</code> </pre><br>  Apply InRequestScope ().  Those.  each query will use a separate SqlRepository object.  This will avoid collisions during execution. We declare the IRepository in the controller: <br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">HomeController</span></span> : <span class="hljs-title"><span class="hljs-title">Controller</span></span> { [Inject] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IRepository Repository { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Index</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> roles = Repository.Roles.ToList(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> View(roles); } }</code> </pre><br><br>  And update the View (/Views/Home/Index.cshtml): <br><pre> <code class="html hljs xml">@model IList<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LessonProject.Model.Role</span></span></span><span class="hljs-tag">&gt;</span></span> @{ ViewBag.Title = "LessonProject"; Layout = "~/Views/Shared/_Layout.cshtml"; } <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span>LessonProject<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> @foreach (var role in Model) { <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"item"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"id"</span></span></span><span class="hljs-tag">&gt;</span></span> @role.ID <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"name"</span></span></span><span class="hljs-tag">&gt;</span></span> @role.Name <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Code"</span></span></span><span class="hljs-tag">&gt;</span></span> @role.Code <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> } <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  We get a good result: <br><br><img src="https://habrastorage.org/storage2/7e4/890/daf/7e4890daf31d551343fb99e2e49cbdf5.jpg"><br><br>  All sources are located at <a href="https://bitbucket.org/chernikov/lessons">https://bitbucket.org/chernikov/lessons</a> </div><p>Source: <a href="https://habr.com/ru/post/176017/">https://habr.com/ru/post/176017/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../176001/index.html">ASP.NET MVC Lesson 1. Start</a></li>
<li><a href="../176005/index.html">Ultrabook Acer Aspire S7-191 video review</a></li>
<li><a href="../176007/index.html">ASP.NET MVC Lesson 2. Dependency Injection</a></li>
<li><a href="../176013/index.html">#FailOverConf - how it was, presentations and videos</a></li>
<li><a href="../176015/index.html">Whatsapp not for sale</a></li>
<li><a href="../176019/index.html">Rapid deployment of the telephone network to Asterisk + Cisco</a></li>
<li><a href="../176021/index.html">ASP.NET MVC Lesson 4. Routing</a></li>
<li><a href="../176023/index.html">ASP.NET MVC Lesson 5. Creating a Database Entry</a></li>
<li><a href="../176029/index.html">Xbox Durango may be submitted on May 21st (+ vote)</a></li>
<li><a href="../176033/index.html">Lionel Messi managed to score a goal for the robot only from the fourth time - video</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>