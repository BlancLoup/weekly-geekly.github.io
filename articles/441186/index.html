<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ASH Viewer: Reboot</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What to do if you need to work with data that is not Big data by volume, but already more than what fits in the computer's memory and for which Excel ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ASH Viewer: Reboot</h1><div class="post__text post__text-html js-mediator-article">  What to do if you need to work with data that is not Big data by volume, but already more than what fits in the computer's memory and for which Excel features are enough?  For lovers of cycling, the answer is obvious - you need to write something of your own (yes, we are not looking for easy ways). <br><br>  But what if the code you wrote in the past is terrible and does not give you the opportunity to develop the project?  To set aside old practices, to give way to the new, eternal and bright (yes, and here, too, with no options). <br><br><img src="https://habrastorage.org/webt/_8/wp/pk/_8wppkoos09wf_1f9jqucspdesm.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>A quote from the Matrix: ‚ÄúOne tablet is enough, Neo.‚Äù</i>  <i>Director: Wachowski brothers and sisters.</i>  <i>1999. United States</i> <br><a name="habracut"></a><br>  Already more than 10 years ago, I wrote the code for the ASH Viewer (for more information about my path <a href="https://habr.com/ru/company/jetinfosystems/blog/245507/">here</a> ), I first posted it on <a href="https://sourceforge.net/projects/ashv/">sourceforge.net</a> , and then on <a href="https://github.com/akardapolov/ASH-Viewer">github</a> so that people can connect and add functionality, correct errors.  The project was assembled with the help of Gradle, they solved the questions with graphs: an almost complete list of improvements <a href="">by reference</a> . <br><br>  However, I understood that the code written ten years ago is, to put it mildly, imperfect.  Outwardly, everything looked good, the functionality was developed, people actively used and thanked.  But inside the program contained all the errors of the first coding experience, and, of course, this greatly hampered the development of the project. <br><br>  To anyone who was ready to seriously begin work on the application (for example, <a href="https://habr.com/ru/users/dcvetkov/" class="user_link">dcvetkov</a> ), I said that the code requires complete rework.  And with each attempt to introduce any functionality or to fix errors, I was convinced of this.  I will report to you, rule the legacy-code - a terrible torture, especially your own :).  I hope that in the future, robots will learn to rewrite everything themselves, but for now, it was decided to start from scratch, taking into account the experience already gained in creating programs and writing code. <br><br>  Since the first release, ASH Viewer has been actively working in this direction.  There were 3 fairly large <a href="https://github.com/jfree/jfreechart">JfreeChart-</a> based <a href="https://github.com/jfree/jfreechart">projects</a> for data analysis.  In addition to these projects, I tried different approaches, paradigms and libraries.  As a result, I stopped at the fact that you need to write everything in pure Java, without using libraries specifically designed to create a graphical interface from scratch.  But still, it is quite acceptable to use third-party libraries for solving some highly specialized tasks - this will save the necessary level of flexibility and does not require a significant investment of time to fix bugs and develop the required functionality with your own hands. <br><br><h4>  How it all began </h4><br>  I was always worried, but is there an example in free access that would give the basics of correct writing applications of average complexity in Java Swing?  Of course, I was referred to the library itself or to some simple examples from textbooks.  And in some ways they were right. <br><br>  But I persistently searched for application code that could be used as an example of ‚Äúhow to do it right‚Äù in Java Swing.  And I wanted to have a working system in front of my eyes so that it could be ‚Äúfelt‚Äù. <br><br>  Began to study the source code of applications for Java Swing (all of them can not be counted).  Somewhere it was simple ToDo, somewhere too complex (for me at that time), in some quality failed, and sometimes it was both.  I read articles on Habr√©, wrote the code.  But still something was missing.  Perhaps, I was just then gaining a critical amount of knowledge to solve this problem. <br><br>  One day I found <a href="https://angryip.org/">Angon IP Scanner of the</a> respected Anton Cake <a href="https://habr.com/ru/users/antonkeks/" class="user_link">antonkeks</a> , looked at it and immediately understood - that's it!  Java Swing, simple functionality, clean code, modularity - nice to read!  In general, I used the approaches used in it as a basis for writing one of my previous projects, and then when rewriting ASH Viewer. <br><br><h3>  Software and libraries that helped improve the quality of the code and simplify the work </h3><br>  <a href="https://www.jetbrains.com/idea/">IDEA</a> : for five years now I have been using this IDE for programming in Java.  I confirm the opinion of the majority - this is a really useful program and a very convenient tool for writing code.  When I moved to it from Eclipse <a href="https://www.eclipse.org/ide/">www.eclipse.org/ide</a> (and the first version was written on this IDE), after a short training I realized IDEA leads you and tells you when you try to go to the dark side :).  Highlighting repeats in the code keeps you in good shape and does not allow you to engage in stupid copy-paste.  Ave JetBrains! <br><br>  <a href="https://java.com/ru/download/">Java 8</a> : lambda expressions that make it possible to write a shorter code, a new Time API, which allows you to cancel the use of the third-party Joda Time library. <br><br>  <a href="https://github.com/google/dagger">Dagger 2</a> : I didn‚Äôt use the Dependency injection framework before.  But somehow I saw how this library was used by Anton <a href="https://habr.com/ru/users/antonkeks/" class="user_link">antonkeks</a> , and began to do it in a pattern.  To divide the program into modules, where possible, use dependency injection.  Where this was <a href="https://stackoverflow.com/questions/37516736/dagger-2-injecting-user-inputted-parameter-into-object">not possible</a> , I used the creation of shell objects in advance, and then set the necessary attributes or simply did not use DI. <br><br>  <a href="https://maven.apache.org/">Maven</a> build system.  It is this build system that is de facto standard, so I decided to add libraries cleanly via pom.xml and use the Maven module system to work with the JFreeChart and Gantt code in one project. <br><br>  <a href="https://projectlombok.org/">Lombok</a> : is also an incredibly convenient library, in order not to write and not support the "wrappers" of uniform code (getters, setters, etc.).  True, in some cases I refused to use it, because I had to redefine equals and compareTo, but I did not find how quickly to do this. <br><br>  Logging: making the perfect Java program?  So, without modern means of logging anywhere.  Therefore, we take as a basis <a href="https://www.slf4j.org/">Simple Logging Facade for Java SLF4J</a> and <a href="https://logback.qos.ch/">Logback</a> . <br><br>  Layout Manager: I mainly use <a href="http://www.miglayout.com/">Miglayout</a> .  Rather difficult to master (in some places I use Swing layout managers in the old manner), but short.  Allows you to do these interesting <a href="">effects</a> , as in the Detail tab. <br><br>  <a href="https://mvnrepository.com/artifact/org.swinglabs/swingx">Swingx</a> from Swinglabs: a long-abandoned Java Swing UI tooklit.  I actively use JXTable.  Arbitrary selection of table columns and built-in search by cell contents facilitate detailed analysis of data from the history of active sessions. <br><br>  <a href="https://commons.apache.org/proper/commons-dbcp/">Commons-dbcp2</a> : useful for creating a connection pool connections to the database.  In the old version I used a modified implementation that I found on the Internet. <br><br><h4>  Libraries that have moved from the old version </h4><br>  <a href="https://www.oracle.com/technetwork/products/berkeleydb/downloads/index-098622.html">Oracle Berkeley DB Java Edition</a> v.  5.0.73: embedded key-value storage.  To store aggregated data history of active sessions. <br><br>  <a href="https://github.com/jfree/jfreechart">JFreeChart</a> : Thousands of data analysis projects written using this library.  Based on the experimental version, which is laid out on github and added it as a module.  This was done for the convenience of working with the code, since changes were <a href="">required</a> so that the Stacked Chart would display the graph as needed. <br><br>  <a href="https://github.com/akardapolov/ASH-Viewer/tree/4.0.0/egantt">E-Gantt</a> : a library for creating gantt graphs in Java Swing.  Traces of it now can not be found even on the Internet, alas.  Also posted a separate Maven module in the project. <br><br><h3>  Of the interesting in the code that you can pay attention </h3><br>  <b>Architectural changes:</b> <br><br><ol><li>  Now the settings are stored in a separate embedded database, not in plain text files.  Since there is little data, the advanced <a href="https://en.wikipedia.org/wiki/Entity%25E2%2580%2593attribute%25E2%2580%2593value_model">EAV</a> pattern is used to <a href="">store the</a> connection settings; </li><li>  To store the monitoring data I decided to <a href="">make a</a> similarity to the OLAP-engine.  First, to speed up the display of Gantt granularity for SQL_ID / SESSION_ID on the selected range.  Secondly, to be able to get quick details on SQL_ID / SESSION_ID on stacked and Gantt charts.  Thirdly, the formation in the future of viewing the history of active sessions (Top of expectations, detailing on expectations, detailing on SQL_ID / SESSION_ID).  Everything is stored in <a href="">one</a> entity (data by second, 15-second and, in perspective, by other extended intervals are physically separated); </li><li>  A side effect of clean architecture is the ability to support monitoring the history of active sessions of other databases.  Postgres support is currently available.  To connect other databases, you need either a ready-made interface to the data of the history of active sessions (which was <a href="https://postgrespro.ru/docs/postgrespro/9.5/monitoring-stats">added</a> to Postgres or such an <a href="https://habr.com/ru/post/416909/">implementation</a> ) or a self-configured collection of the history of active sessions into a separate table, which can later be accessed. <br><br><div class="spoiler">  <b class="spoiler_title">How to enable support for another database</b> <div class="spoiler_text"><ol><li>  Create a new class and implement the IProfile interface.  Do the same as for <a href="">Postgres;</a> </li><li>  Add to the loadProfile procedure of the ConnectToDbArea class and the enum Function of the <a href="">ConstantManager</a> class the implementation for the new database version; </li><li>  Connect and test the application. </li></ol></div></div></li></ol><br>
<h3>  Graphical interface </h3><br>  <b>Database Connection Form</b> <br><br>  Completely rewritten from scratch, used earlier developments c open project <a href="http://squirrel-sql.sourceforge.net/">Squirrel-sql</a> .  Now everything is in <a href="">one</a> file.  Beauty! <br><br><img src="https://habrastorage.org/webt/6j/kj/vk/6jkjvk8dmdrpguiqrkxmpwz8mes.png"><br><br><div class="spoiler">  <b class="spoiler_title">How to connect to the database</b> <div class="spoiler_text"><ol><li>  Create a new connection; </li><li>  Specify the name, URL (JDBC standard for Oracle: jdbc: oracle: thin: @host: port: SID, for Postgres: jdbc: postgresql: // host: port: database), username / password, profile, and select the jdbc library; </li><li>  For Oracle, everything works with ojdbc6.jar, for PostgresDB, work with postgresql-42.2.5 is checked </li></ol><br></div></div><br>  <b>Interface Top activity / Detail</b> <br><br>  Here, without significant changes, similarly as in the old version, only without viewing the history. <br><br><img src="https://habrastorage.org/webt/ft/np/8a/ftnp8ank8llw-eb7ejsqedcf2p0.png"><br><br>  <b>Drilling by SQL_ID / SESSION_ID</b> <br><br>  <b>SQL</b> <br><br><img src="https://habrastorage.org/webt/0k/os/ai/0kosaiukjfq27jhrazolitkcnsy.png"><br><br>  <b>ASH</b> : activity graph for a certain SQL_ID, caused by double clicking on the line with SQL_ID from the Gantt graph. <br>  <b>Sql text / plan</b> : for Oracle / Postgres it is possible to get the full text of the request.  Oracle-only provides query execution plans for all plan_hash_value. <br>  <b>Statistics</b> : tabulated data by SQL_ID: selection from V $ SQL.  In the code, it is possible to add more entities for which you can make a selection (see <a href="">implementation</a> ).  but you need to be very careful, as there may be performance problems: for example, sampling from <a href="">V $ SQLAREA</a> on loaded systems is very slow). <br><br>  <b>Session</b> <br><img src="https://habrastorage.org/webt/sk/7z/l3/sk7zl37lodapypgzivazt3q78vs.png"><br>  <b>ASH</b> : activity graph for session_id, similarly to SQL, invoked by double clicking on the session string from the gantt graph. <br>  <b>Statistics</b> : tabular data for SQL_ID: selection from V $ SESSION and V $ PROCESS.  In the code, it is possible to add more entities for which you can make a selection (see <a href="">implementation</a> ). <br><br><h3>  Future plans </h3><br><ol><li>  Fix API.  Conduct final code refactoring.  Implement dynamic <a href="">storage of the</a> initial monitoring data, which would not depend on the versions and types of databases; </li><li>  There are a lot of tests that check the key modules of the system, CI and other best practices. </li></ol><br>  Project code on <a href="">github</a> , <a href="">project files</a> ; <br>  Link to a group in Telegrams <a href="https://t.me/ashviewer">t.me/ashviewer</a> for information on the latest updates; <br><br>  PS Whoever decides to connect to the development - write in the LAN, without undue agiotage and without creating a crush, of course :). <br><br>  That's all.  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/441186/">https://habr.com/ru/post/441186/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../441172/index.html">As the 3D printing market grew in 2018 and what does this mean for business</a></li>
<li><a href="../441174/index.html">PLO is dead, long live PLO</a></li>
<li><a href="../441176/index.html">Yandex.Music was automatically installed on Windows 10 and replaced the standard MP3 application.</a></li>
<li><a href="../441180/index.html">Cloudy, Likely non-switchable ads on the starry sky</a></li>
<li><a href="../441182/index.html">Machine-synaesthetic approach to detecting network DDoS attacks. Part 2</a></li>
<li><a href="../441188/index.html">On Twitter, a protocol of administrative offense</a></li>
<li><a href="../441192/index.html">Using computational capabilities of R to test the equality hypothesis</a></li>
<li><a href="../441196/index.html">To whom and for what will messengers ‚Äúknock‚Äù</a></li>
<li><a href="../441198/index.html">Scrum and Graves' spiral dynamics: how not to fly on reefs</a></li>
<li><a href="../441202/index.html">Do service companies dream about their products? Conversation with maxilect</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>