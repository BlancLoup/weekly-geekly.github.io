<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Asm.js practice</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On this cool day, I was looking for algorithms and implementations for calculating the number pi. There were a myriad of algorithms, but here there wa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Asm.js practice</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/933/2ba/926/9332ba926b6a545af1f40c85f14120e0.png" alt="image"><br>  On this cool day, I was looking for algorithms and implementations for calculating the number pi.  There were a myriad of algorithms, but here there was a <a href="http://habrahabr.ru/post/179829/">post</a> describing the algorithm and its implementation on C. <br>  The algorithm impresses with its speed, although it gives a hex representation, but it just so happened that I needed the option on js.  The instant, practically, processing to normal js showed very poor statistics, the work on calculating the 1,000,000th sign took ... 48 seconds (4 GHz FF). <br>  How met with asmjs and what stones met it is possible to learn under a cat. <br><a name="habracut"></a><br><br>  For the impatient, the <a href="https://github.com/NightMigera/piHex">result is on a githaba</a> . <br><br>  After a cursory review, it became clear that we did not need to make work with the entire generation into the asm module, but only two functions were used: expm and series.  Since  expm is called inside a series, then we should export only series from the module. <br><div class="spoiler">  <b class="spoiler_title">Original functions</b> <div class="spoiler_text"><pre><code class="hljs vala"><span class="hljs-keyword"><span class="hljs-keyword">double</span></span> series (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> m, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id) <span class="hljs-comment"><span class="hljs-comment">/* This routine evaluates the series sum_k 16^(id-k)/(8*k+m) using the modular exponentiation technique. */</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> k; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> ak, eps, p, s, t; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> expm (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span> x, <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> y); #define eps <span class="hljs-number"><span class="hljs-number">1e-17</span></span> s = <span class="hljs-number"><span class="hljs-number">0.</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* Sum the series up to id. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (k = <span class="hljs-number"><span class="hljs-number">0</span></span>; k &lt; id; k++){ ak = <span class="hljs-number"><span class="hljs-number">8</span></span> * k + m; p = id - k; t = expm (p, ak); s = s + t / ak; s = s - (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) s; } <span class="hljs-comment"><span class="hljs-comment">/* Compute a few terms where k &gt;= id. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (k = id; k &lt;= id + <span class="hljs-number"><span class="hljs-number">100</span></span>; k++){ ak = <span class="hljs-number"><span class="hljs-number">8</span></span> * k + m; t = pow (<span class="hljs-number"><span class="hljs-number">16.</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>) (id - k)) / ak; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (t &lt; eps) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; s = s + t; s = s - (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) s; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> s; } <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> expm (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span> p, <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> ak) <span class="hljs-comment"><span class="hljs-comment">/* expm = 16^p mod ak. This routine uses the left-to-right binary exponentiation scheme. */</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i, j; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> p1, pt, r; #define ntp <span class="hljs-number"><span class="hljs-number">25</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> tp[ntp]; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tp1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* If this is the first call to expm, fill the power of two table tp. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tp1 == <span class="hljs-number"><span class="hljs-number">0</span></span>) { tp1 = <span class="hljs-number"><span class="hljs-number">1</span></span>; tp[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-number"><span class="hljs-number">1.</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt; ntp; i++) tp[i] = <span class="hljs-number"><span class="hljs-number">2.</span></span> * tp[i<span class="hljs-number"><span class="hljs-number">-1</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ak == <span class="hljs-number"><span class="hljs-number">1.</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0.</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* Find the greatest power of two less than or equal to p. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; ntp; i++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tp[i] &gt; p) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; pt = tp[i<span class="hljs-number"><span class="hljs-number">-1</span></span>]; p1 = p; r = <span class="hljs-number"><span class="hljs-number">1.</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* Perform binary exponentiation algorithm modulo ak. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j = <span class="hljs-number"><span class="hljs-number">1</span></span>; j &lt;= i; j++){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p1 &gt;= pt){ r = <span class="hljs-number"><span class="hljs-number">16.</span></span> * r; r = r - (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) (r / ak) * ak; p1 = p1 - pt; } pt = <span class="hljs-number"><span class="hljs-number">0.5</span></span> * pt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pt &gt;= <span class="hljs-number"><span class="hljs-number">1.</span></span>){ r = r * r; r = r - (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) (r / ak) * ak; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> r; }</code> </pre> </div></div><br><h2>  Basic pattern. </h2><br>  In essence, we create a black box with some interface, so all we can do is pass something to the module and get a set of methods and / or values ‚Äã‚Äãfrom it. <br>  In the codes I reviewed, the construction of the form was established: <br><pre> <code class="javascript hljs">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">window</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-string"><span class="hljs-string">"use strict"</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  var buffer = new ArrayBuffer(BUFFER_SIZE); //       var functionNameOrStuctureName = (function (stdlib, env, heap) { "use asm"; //  //   return { methodNameExport: methodNameInModule, methodName2Export: methodName2InModule, }; //   return methodNameInModule })( { //    (stdlib) Uint8Array: Uint8Array, Int8Array: Int8Array, Uint16Array: Uint16Array, Int16Array: Int16Array, Uint32Array: Uint32Array, Int32Array: Int32Array, Float32Array:Float32Array, Float64Array:Float64Array, Math: Math }, { //  (env) NTP:NTP }, buffer //  ,  ,    &gt; 4096    0 ); })(window); // wrapper end</span></span></code> </pre><br>  An error of the type <i>‚ÄúTypeError: asm.js type error: asm.js module fails return a statement statement‚Äù crashes</i> , make sure that the module returns something.  If it returns as expected, then you should make sure that the variable declarations are correct.  I had a mistake when after the declaration I tried to do something else with one intovy variable. <br>  I hope the basic things have already learned, but still: <br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f1</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">i, d</span></span></span><span class="hljs-function">) </span></span>{ i = i | <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">// integer ,  i   d = +d; // double ,  d     var char = new Uint8Array(heap); // ,       var i2 = 0; //    (     fixnum) var d2 = 0.0; //      i2 = i2 | 0; //  fixnum  integer return +d2; //    double     double }</span></span></code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Pitfall # 1: Variables and Module Functions </h2><br>  I used to first declare all variables, and only then assign values ‚Äã‚Äãto them.  In asm.js, everything is somewhat more cunning: first, we declare all the variables that we use through closures, and the functions of the mathematical library also need to be described here, and not called below. <br>  This is what happened: <br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta"> "use asm"</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  stdlib  var floor = stdlib.Math.floor; //       ,    var pow = stdlib.Math.pow; //    ,    var tp1 = 0; //     var tp = new stdlib.Float64Array(heap); //    var ntp = env.NTP | 0; //       env,   </span></span></code> </pre><br>  Functions cannot be created before initializing the variable and assigning it a function.  Therefore, functions follow. <br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">expm</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">p, ak</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  }</span></span></code> </pre><br><br><h2>  Pitfall # 2: variables in module functions. </h2><br>  But in the body of the module's functions, you must first specify the type of variables accepted at the input, then initialize the internal variables, if anything, if it is int, then var i = 0, if double, then var d = 0.0, if array, then through new and type msssiv with the transfer of heap into it, and after the initialization of the ints, I advise them to ‚Äúpre-initialize‚Äù by assigning the form i = i | 0.  <u>By the way:</u> initialization of variables in advance in the style of C is not required.  Numbers of the form 1e-17 give an error of overshooting, use 0.00000000000000001 <br>  At the exit: <br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">expm</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">p, ak</span></span></span><span class="hljs-function">) </span></span>{ p = +p; ak = +ak; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pt = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-comment"><span class="hljs-comment">// .... i = i | 0; ntp = ntp | 0; //  }</span></span></code> </pre><br><br><h2>  Pitfall number 3: comparisons and iterators </h2><br>  Frankly, I laughed for a long time, but <u>int and int cannot be compared</u> .  If you do something like i == k or i &lt;l, then compiling with an error like this will fall out <br>  <i>"TypeError: asm.js type error: arguments and a comparison must be signed, unsigned or doubles, int and int are given</i> . <i>"</i> <br>  A little more laughter was added by comparing int and integer (i == 0) <br>  <i>"TypeError: asm.js type error: arguments for a comparison must both be signed, unsigned or doubles, fixnum and int are given</i> . <i>"</i> <br>  Only floating point numbers are fine (for example, pt == 1.0). <br>  As a result, if you want to <b>compare the</b> int with another int.  it is necessary to declare a construction of the form (i | 0) &lt;(ntp | 0). <br>  As for the <b>iterators</b> , then simply ‚Äúcharm‚Äù: instead of all of us, the usual i ++, we have i = (i | 0) + 1 |  0 <br>  Result: <br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((tp1 | <span class="hljs-number"><span class="hljs-number">0</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// vars for (i = 1; (i | 0) &lt; (ntp | 0); i = (i | 0) + 1 | 0) { // surprise, read more) } }</span></span></code> </pre><br><br><h2>  Pitfall # 4: Mathematical and other external functions. </h2><br>  Everything is simple, if you want to use floor, sin, etc., then you need to declare them at the beginning of the module (immediately after ‚Äúuse asm‚Äù).  If I write stdlib.Math.floor in a function, I threw out a return type error.  Apparently because of the appeal to the properties of the object. <br><br><h2>  Reef 5: Buffers. </h2><br>  And here everything is very, very interesting.  What do we do when we want to get / set the value from / to the arr array with index i?  arr [i].  Suppose we do so, but then we get an error of the form. <br><pre> <code class="javascript hljs"> arr[i] = +<span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre><br>  <i>‚ÄúTypeError: asm.js type error: index expression isn't shifted;</i>  <i>must be an Int8 / Uint8 access ¬ª</i> <br>  We are subtly hinted that there must be a shift.  One <a href="">guru</a> I found a shift of 2 to the right. <br><pre> <code class="javascript hljs"> arr[i &gt;&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>] = +<span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre><br>  <i>"TypeError: asm.js type error: shift amount must be 3"</i> <br>  We are subtly hinted that he should be three. <br><pre> <code class="javascript hljs"> arr[i &lt;&lt; <span class="hljs-number"><span class="hljs-number">3</span></span> &gt;&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>] = +<span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre><br>  It turns out in the end.  Shift to the left, we compensated for the shift to the right.  It seems everything is the same, but it works. <br><br><div class="spoiler">  <b class="spoiler_title">The result of the works</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Created with JetBrains WebStorm. * User: louter * Date: 12.09.13 * Time: 17:49 */</span></span> (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">window</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-string"><span class="hljs-string">"use strict"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ihex; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> NTP = <span class="hljs-number"><span class="hljs-number">25</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> buffer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">ArrayBuffer</span></span>(<span class="hljs-number"><span class="hljs-number">1024</span></span> * <span class="hljs-number"><span class="hljs-number">1024</span></span> * <span class="hljs-number"><span class="hljs-number">8</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> series = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">stdlib, env, heap</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-string"><span class="hljs-string">"use asm"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> floor = stdlib.Math.floor; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pow = stdlib.Math.pow; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tp1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> stdlib.Float64Array(heap); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ntp = env.NTP | <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">expm</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">p, ak</span></span></span><span class="hljs-function">) </span></span>{ p = +p; ak = +ak; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> p1 = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pt = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> r = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-comment"><span class="hljs-comment">// float as double i = i | 0; j = j | 0; ntp = ntp | 0; if ((tp1 | 0) == 0) { tp1 = 1 | 0; tp[0] = +1; for (i = 1; (i | 0) &lt; (ntp | 0); i = (i | 0) + 1 | 0) { tp[(i &lt;&lt; 3) &gt;&gt; 2] = +(+2 * tp[((i - 1) &lt;&lt; 3) &gt;&gt; 3]); } } if (ak == 1.0) { return +0; } for (i = 0; (i | 0) &lt; (ntp | 0); i = (i | 0) + 1 | 0) { if (+tp[i &lt;&lt; 3 &gt;&gt; 3] &gt; p) { break; } } pt = +tp[(i - 1) &lt;&lt; 3 &gt;&gt; 3]; p1 = +p; r = +1; for (j = 0; (j | 0) &lt;= (i | 0); j = (j | 0) + 1 | 0) { if (p1 &gt;= pt) { r = +16 * r; r = r - (+(floor(r / ak))) * ak; p1 = p1 - pt; } pt = 0.5 * pt; if (pt &gt;= 1.) { r = r * r; r = r - (+(floor(r / ak))) * ak; } } return +r; } function series(m, id) { m = m | 0; id = id | 0; var k = 0; var ak = 0.0; var eps = 0.0; var p = 0.0; var s = 0.0; var t = 0.0; eps = 0.00000000000000001; k = 0 | 0; for (k; (k | 0) &lt; (id | 0); k = (k | 0) + 1 | 0) { ak = +8 * (+(k | 0)) + (+(m | 0)); p = (+(id | 0) - +(k | 0)); t = +expm(p, ak); s = s + t / ak; s = s - floor(s); } for (k = (id | 0); (k | 0) &lt;= ((id + 100) | 0); k = (k | 0) + 1 | 0) { ak = +8 * (+(k | 0)) + (+(m | 0)); t = pow(+16, +(id | 0) - (+(k | 0))) / +ak; if (t &lt; eps) break; s = s + t; s = s - floor(s); } return +s; } return series; })( { Uint8Array: Uint8Array, Int8Array: Int8Array, Uint16Array: Uint16Array, Int16Array: Int16Array, Uint32Array: Uint32Array, Int32Array: Int32Array, Float32Array:Float32Array, Float64Array:Float64Array, Math: Math }, { NTP:NTP }, buffer ); ihex = function (x, nhx, chx) { var i, y, hx = "0123456789ABCDEF"; y = Math.abs(x); for (i = 0; i &lt; nhx; i++) { y = 16. * (y - (y | 0)); chx[i] = hx[y | 0]; } }; window.pi = function (id) { var pid, s1, s2, s3, s4 , hex = []; s1 = series(1, id); s2 = series(4, id); s3 = series(5, id); s4 = series(6, id); pid = 4 * s1 - 2 * s2 - s3 - s4; pid = pid - (pid | 0) + 1; ihex(pid, 16, hex); return { hex: hex.join('').substr(0, 10), fraction:pid }; }; })(window);</span></span></code> </pre></div></div><br><br>  <b>PS</b> I don‚Äôt know who or what is wrong, but (!) For some reason the compiled program produced worse results than asm.js. <br><div class="spoiler">  <b class="spoiler_title">Namely</b> <div class="spoiler_text">  time ./pi 1,000,000 <br>  &gt;&gt; real 0m2.161s <br>  &gt;&gt; user 0m2.149s <br>  &gt;&gt; sys 0m0.001s <br><br>  console.time ('s'); <br>  pi (1,000,000); <br>  console.timeEnd ('s'); <br>  &gt;&gt; s: 1868.5ms <br><br>  And further: <br>  time ./pi 10,000,000 <br>  &gt;&gt; real 0m25.345s <br>  &gt;&gt; user 0m25.176s <br>  &gt;&gt; sys 0m0.019s <br><br>  console.time ('s'); <br>  pi (10,000,000); <br>  console.timeEnd ('s'); <br>  &gt;&gt; s: 22152.83ms <br></div></div><br>  Do not believe?  Check it out.  The source of the program in the above <a href="http://habrahabr.ru/post/179829/">post</a> .  My sources are also <a href="https://github.com/NightMigera/piHex">listed</a> above. <br><br>  <b>UPD:</b> <br>  I put testASM.js on github to check if asmjs is working or not.  After connecting, the window.asmjs (bool) variable appears.  <a href="">testASM.js</a> and <a href="">testASM.min.js</a> </div><p>Source: <a href="https://habr.com/ru/post/193642/">https://habr.com/ru/post/193642/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../193632/index.html">Time Management Love and Hate</a></li>
<li><a href="../193634/index.html">Tips for working with the ticket system</a></li>
<li><a href="../193636/index.html">Congratulations on the Programmer's Day!</a></li>
<li><a href="../193638/index.html">Roskomnadzor blocked the largest porn site</a></li>
<li><a href="../193640/index.html">Access control based on behavioral characteristics</a></li>
<li><a href="../193644/index.html">Homemade LED illuminator for photo and video</a></li>
<li><a href="../193646/index.html">Direct data transfer between FPGA Virtex-7 over the bus PCI Express</a></li>
<li><a href="../193650/index.html">How to buy a 3D printer in China, or Toy for $ 1000</a></li>
<li><a href="../193654/index.html">Application of EDS in SAP NetWeaver web templates</a></li>
<li><a href="../193658/index.html">Applying local binary patterns to solving face recognition tasks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>