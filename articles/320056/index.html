<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>New quick start with PHPixie: we build quote-by-commit commit</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Over the past year, many new features and several components have been added to PHPixie, and the standard bundle structure has slightly changed to low...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>New quick start with PHPixie: we build quote-by-commit commit</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/getpro/habr/post_images/7cd/47c/66c/7cd47c66c5df9f4b83f7886240a1cba2.png" alt="image" align="right">  Over the past year, many new features and several components have been added to PHPixie, and the standard bundle structure has slightly changed to lower the entry threshold for developers.  So it's time to create a new tutorial, and this time we will try to make it a little different.  Instead of just looking at the finished demo project with a description, we will go gradually, and at each iteration we will have a fully working site.  <strong>We will build a simple quote pad with login, registration, integration with social networks and console commands for statistics.</strong>  The complete <a href="https://github.com/PHPixie/Demo-Quickstart/commits/master">github history</a> . </p><a name="habracut"></a><br><h2 id="1-sozdanie-proekta">  1. Creating a project </h2><br><blockquote>  Before you start work, say "Hello" in our <a href="https://gitter.im/PHPixie/Hotline">chat</a> , 99% of the problems that you may encounter there are solved almost instantly. </blockquote><p>  We will need <a href="https://getcomposer.org/download/">Composer</a> , after its installation we run: </p><br><pre><code class="hljs sql">php composer.phar <span class="hljs-keyword"><span class="hljs-keyword">create</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">project</span></span> phpixie/<span class="hljs-keyword"><span class="hljs-keyword">project</span></span></code> </pre> <br><p>  This will create a <em>project</em> folder with the <em>project</em> skeleton and one 'app' bundle.  Bundles are modules code, templates, CSS, etc.  related to some part of the application.  They can be easily transferred from project to project using Composer.  We will work with only one bundle in which all the logic of our application will be. </p><br><p>  Next you need to create a virtual host and direct it to the <em>/ web</em> folder inside the project.  If everything went smoothly, going to <em><a href="http://localhost/">http: // localhost /</a></em> in the browser you will see a greeting.  Immediately check whether the routing works by going to <em><a href="http://localhost/greet">http: // localhost / greet</a></em> . </p><br><p>  If you are on Windows, you will most likely see an error when you run the <em>create-project</em> command, this is a consequence of the fact that <em>symlink ()</em> does not work on this PHP OS.  You can just ignore it, a little later I'll show you how to get around this problem. </p><br><p>  <strong><a href="https://github.com/PHPixie/Demo-Quickstart/tree/8702c5a5f732540d973770edb3604fa719aadef4">Project status at this stage (Commit 1)</a></strong> </p><br><h2 id="2-prosmotr-soobscheniy">  2. View messages </h2><br><p>  Let's start with the database connection, for this we edit <em>/assets/config/database.php</em> .  You can check the connection by running two console commands from the project folder: </p><br><pre> <code class="hljs pgsql">./console framework:<span class="hljs-keyword"><span class="hljs-keyword">database</span></span> <span class="hljs-keyword"><span class="hljs-keyword">drop</span></span> #      ./console framework:<span class="hljs-keyword"><span class="hljs-keyword">database</span></span> <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> #     </code> </pre> <br><p>  Next, create a migration with the table structure in <em>/assets/migrate/migrations/1_users_and_messages.sql</em> : </p><br><pre> <code class="php hljs">CREATE TABLE users( id INT NOT <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> PRIMARY KEY AUTO_INCREMENT, name VARCHAR(<span class="hljs-number"><span class="hljs-number">255</span></span>) NOT <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, email VARCHAR(<span class="hljs-number"><span class="hljs-number">255</span></span>) UNIQUE, passwordHash VARCHAR(<span class="hljs-number"><span class="hljs-number">255</span></span>) ); -- statement CREATE TABLE messages( id INT PRIMARY KEY AUTO_INCREMENT, userId INT NOT <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, text VARCHAR(<span class="hljs-number"><span class="hljs-number">255</span></span>) NOT <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, date DATETIME NOT <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, FOREIGN KEY (userId) REFERENCES users(id) );</code> </pre> <br><p>  Notice that we use <code>-- statement</code> to separate requests. </p><br><p>  We also immediately add some data to fill the database with something, for this we create files in <em>/ assets / migrate / seeds /</em> where the file name corresponds to the table name, for example: </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// /assets/migrate/seeds/messages.php return [ [ 'id' =&gt; 1, 'userId' =&gt; 1, 'text' =&gt; "Hello World!", 'date' =&gt; '2016-12-01 10:15:00' ], // .... ]</span></span></code> </pre> <br><p>  The full content of these files can be viewed on the githab.  Now we will launch two more console commands: </p><br><pre> <code class="hljs coffeescript">./<span class="hljs-built_in"><span class="hljs-built_in">console</span></span> framework:migrate <span class="hljs-comment"><span class="hljs-comment">#   ./console framework:seed #   </span></span></code> </pre> <br><p>  Now you can proceed to our first page.  First, we <em>look</em> at the <em>/bundles/app/assets/config/routeResolver.php</em> file in which the routes are configured, that is, it specifies which links correspond to which processors.  We are going to add a <em>messages</em> processor which will be responsible for displaying messages.  Let's write it as default and also immediately add a route for the main page: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'group'</span></span>, <span class="hljs-string"><span class="hljs-string">'defaults'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'action'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'default'</span></span>), <span class="hljs-string"><span class="hljs-string">'resolvers'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'action'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'path'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'&lt;processor&gt;/&lt;action&gt;'</span></span> ), <span class="hljs-string"><span class="hljs-string">'processor'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'path'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'(&lt;processor&gt;)'</span></span>, <span class="hljs-string"><span class="hljs-string">'defaults'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'processor'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'messages'</span></span>) ), <span class="hljs-comment"><span class="hljs-comment">//     'frontpage' =&gt; array( 'path' =&gt; '', 'defaults' =&gt; ['processor' =&gt; 'messages'] ) ) );</span></span></code> </pre> <br><p>  Let's start the layout by <em>changing the</em> parent template <em>/bundles/app/assets/template/layout.php</em> and adding Bootstrap 4 and your CSS to it. </p><br><pre> <code class="php hljs">&lt;!DOCTYPE html&gt; &lt;html lang=<span class="hljs-string"><span class="hljs-string">"en"</span></span>&gt; &lt;head&gt; &lt;!-- Bootstrap <span class="hljs-number"><span class="hljs-number">4</span></span> --&gt; &lt;meta charset=<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>&gt; &lt;meta name=<span class="hljs-string"><span class="hljs-string">"viewport"</span></span> content=<span class="hljs-string"><span class="hljs-string">"width=device-width, initial-scale=1, shrink-to-fit=no"</span></span>&gt; &lt;meta http-equiv=<span class="hljs-string"><span class="hljs-string">"x-ua-compatible"</span></span> content=<span class="hljs-string"><span class="hljs-string">"ie=edge"</span></span>&gt; &lt;link rel=<span class="hljs-string"><span class="hljs-string">"stylesheet"</span></span> href=<span class="hljs-string"><span class="hljs-string">"https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css"</span></span>&gt; &lt;!--   CSS,     --&gt; &lt;link rel=<span class="hljs-string"><span class="hljs-string">"stylesheet"</span></span> href=<span class="hljs-string"><span class="hljs-string">"/bundles/app/main.css"</span></span>&gt; &lt;!--         Quickstart --&gt; &lt;title&gt;<span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span>=$_(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;get(<span class="hljs-string"><span class="hljs-string">'pageTitle'</span></span>, <span class="hljs-string"><span class="hljs-string">'Quickstart'</span></span>))<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span>&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;!-- Navigation --&gt; &lt;nav <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">navbar</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">navbar</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">toggleable</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">md</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">navbar</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">light</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bg</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">faded</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">container</span></span></span><span class="hljs-class">"&gt; &lt;!--     --&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">navbar</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">brand</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mr</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auto</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">href</span></span></span><span class="hljs-class">="&lt;?=$</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">httpPath</span></span></span><span class="hljs-class">('</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">app</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">frontpage</span></span></span><span class="hljs-class">')?&gt;"&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Quickstart</span></span></span><span class="hljs-class">&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nav</span></span></span><span class="hljs-class">&gt; &lt;!--       --&gt; &lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">childContent</span></span></span><span class="hljs-class">(); ?&gt; &lt;!-- </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bootstrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dependencies</span></span></span><span class="hljs-class"> --&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">script</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">src</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">https</span></span></span><span class="hljs-class">://</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ajax</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">googleapis</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">com</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ajax</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">libs</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">jquery</span></span></span><span class="hljs-class">/3.1.1/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">jquery</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">min</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">js</span></span></span><span class="hljs-class">"&gt;&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">script</span></span></span><span class="hljs-class">&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">script</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">src</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">https</span></span></span><span class="hljs-class">://</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cdnjs</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cloudflare</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">com</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ajax</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">libs</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tether</span></span></span><span class="hljs-class">/1.3.7/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">js</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tether</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">min</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">js</span></span></span><span class="hljs-class">"&gt;&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">script</span></span></span><span class="hljs-class">&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">script</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">src</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">https</span></span></span><span class="hljs-class">://</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">maxcdn</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bootstrapcdn</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">com</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bootstrap</span></span></span><span class="hljs-class">/4.0.0-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">alpha</span></span></span><span class="hljs-class">.6/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">js</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bootstrap</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">min</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">js</span></span></span><span class="hljs-class">"&gt;&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">script</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">body</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">html</span></span></span><span class="hljs-class">&gt;</span></span></code> </pre> <br><p>  Where to create the <em>main.css</em> file?  Since all the necessary files are best kept inside the bundle, this will be the <em>/ bundles / app / web /</em> folder.  When you create a project with a composite to this folder, a simlink with <em>/ bundles / app / web</em> is automatically created, which makes these files accessible from the browser.  On Windows, instead of creating a shortcut, you have to copy the folder, which the command does: </p><br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta">#    web    /web/bundles ./console framework:installWebAssets --copy</span></span></code> </pre> <br><p>  Now create a new processor in <em>/bundles/app/src/HTTP/Messages.php</em> </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Project</span></span>\<span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">HTTP</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PHPixie</span></span>\<span class="hljs-title"><span class="hljs-title">HTTP</span></span>\<span class="hljs-title"><span class="hljs-title">Request</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *   */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Messages</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Processor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Request $request HTTP request * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> mixed */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">defaultAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($request)</span></span></span><span class="hljs-function"> </span></span>{ $components = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;components(); <span class="hljs-comment"><span class="hljs-comment">//    $messages = $components-&gt;orm()-&gt;query('message') -&gt;orderDescendingBy('date') -&gt;find(); //   return $components-&gt;template()-&gt;get('app:messages', [ 'messages' =&gt; $messages ]); } }</span></span></code> </pre> <br><p>  <strong>Important: do not forget to register it in /bundles/app/src/HTTP.php</strong> : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Project</span></span>\<span class="hljs-title"><span class="hljs-title">App</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTTP</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PHPixie</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DefaultBundle</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTTP</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//        protected $classMap = array( 'messages' =&gt; 'Project\App\HTTP\Messages' ); }</span></span></code> </pre> <br><p>  Almost done, it remains only to make up the <em>app: messages</em> template itself which uses the processor, this is the simplest part: </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//   $this-&gt;layout('app:layout'); //    //        $this-&gt;set('pageTitle', "Messages"); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;div class="container content"&gt; &lt;--   --&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> foreach($messages as $message): </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;blockquote class="blockquote"&gt; &lt;--     $_()    XSS --&gt; &lt;p class="mb-0"&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment">=$_($message-&gt;text)</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/p&gt; &lt;footer class="blockquote-footer"&gt; posted at </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment">=$this-&gt;formatDate($message-&gt;date, 'j MY, H:i')</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;/footer&gt; &lt;/blockquote&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> endforeach; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;/div&gt;</span></span></code> </pre> <br><p>  Everything is ready, now going to <a href="http://localhost/">http: // localhost /</a> we will see the full list of messages. </p><br><p>  <strong><a href="https://github.com/PHPixie/Demo-Quickstart/tree/361acb0dacfe5e3a89a58400420292dad2acbe3a">Project status at this stage (Commit 2)</a></strong> </p><br><h2 id="3-orm-svyazi-i-razbienie-na-stranicy">  3. ORM communication and pagination </h2><br><p>  In order to specify the user who created it under each message, it is necessary to prescribe the relationship between the tables.  In the migrations, we indicated that each message includes a mandatory <em>userId</em> field so that it will be a One-to-Many relationship. </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// bundles/app/assets/config/orm.php return [ 'relationships' =&gt; [ //      [ 'type' =&gt; 'oneToMany', 'owner' =&gt; 'user', 'items' =&gt; 'message' ] ] ];</span></span></code> </pre> <br><p>  Add a new route with the <em>page</em> parameter for splitting messages by pages: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// /bundles/app/assets/config/routeResolver.php return array( // .... 'resolvers' =&gt; array( 'messages' =&gt; array( 'path' =&gt; 'page(/&lt;page&gt;)', 'defaults' =&gt; ['processor' =&gt; 'messages'] ), // .... ) );</span></span></code> </pre> <br><p>  And we slightly change the Messages processor itself: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">defaultAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($request)</span></span></span><span class="hljs-function"> </span></span>{ $components = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;components(); <span class="hljs-comment"><span class="hljs-comment">//   $messageQuery = $components-&gt;orm()-&gt;query('message') -&gt;orderDescendingBy('date'); //         //          $pager = $components-&gt;paginateOrm() -&gt;queryPager($messageQuery, 10, ['user']); //        $page = $request-&gt;attributes()-&gt;get('page', 1); $pager-&gt;setCurrentPage($page); //    return $components-&gt;template()-&gt;get('app:messages', [ 'pager' =&gt; $pager ]); }</span></span></code> </pre> <br><p>  Now in the template we can use <code>$pager-&gt;getCurrentItems()</code> to get the messages on this page, and <code>$message-&gt;user()</code> to get the data about the author and catch up with the pager.  I will not copy the full page template here, it can be viewed in the repository. </p><br><p>  <strong><a href="https://github.com/PHPixie/Demo-Quickstart/tree/a3cd3aa05d79db09b54a1a9ff49feba998d51a88">Project status at this stage (Commit 3)</a></strong> </p><br><h2 id="4-avtorizaciya-polzovateley">  4. User authorization </h2><br><p>  Before you allow users to write their messages, you need to authorize them.  To do this, you need to specify and expand the user's identity and its repository.  Here it is important to understand the difference that an entity (Entity) represents a single user; the repository provides methods for searching and creating these entities.  For password authorization, we need to implement several interfaces, all this is quite simple. </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// /bundles/app/src/ORM/User.php namespace Project\App\ORM; use Project\App\ORM\Model\Entity; /**        */ use PHPixie\AuthLogin\Repository\User as LoginUser; /** *   */ class User extends Entity implements LoginUser { /** *     . *        'passwordHash'. * @return string|null */ public function passwordHash() { return $this-&gt;getField('passwordHash'); } }</span></span></code> </pre> <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Project</span></span>\<span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">User</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Project</span></span>\<span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>\<span class="hljs-title"><span class="hljs-title">Repository</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Project</span></span>\<span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">User</span></span>; <span class="hljs-comment"><span class="hljs-comment">/**        */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PHPixie</span></span>\<span class="hljs-title"><span class="hljs-title">AuthLogin</span></span>\<span class="hljs-title"><span class="hljs-title">Repository</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">LoginUserRepository</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *   */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Repository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoginUserRepository</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *     id * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> mixed $id * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> User|null */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getById</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;query() -&gt;in($id) -&gt;findOne(); } <span class="hljs-comment"><span class="hljs-comment">/** *    ,      email. *            *       . * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> mixed $login * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> User|null */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getByLogin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($login)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;query() -&gt;where(<span class="hljs-string"><span class="hljs-string">'email'</span></span>, $login) -&gt;findOne(); } }</code> </pre> <br><p>  <strong>Important: don't forget to register these classes in /bundles/app/src/ORM.php</strong> </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Project</span></span>\<span class="hljs-title"><span class="hljs-title">App</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *      */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ORM</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PHPixie</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DefaultBundle</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ORM</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $entityMap = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'user'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Project\App\ORM\User'</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $repositoryMap = [ <span class="hljs-string"><span class="hljs-string">'user'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Project\App\ORM\User\UserRepository'</span></span> ]; }</code> </pre> <br><p>  Let's write the authorization settings in <em>/assets/config/auth.php</em> : </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// /assets/config/auth.php return [ 'domains' =&gt; [ 'default' =&gt; [ //  ORM    'repository' =&gt; 'framework.orm.user', //         'providers' =&gt; [ //    'session' =&gt; [ 'type' =&gt; 'http.session' ], //   'password' =&gt; [ 'type' =&gt; 'login.password', //    ,     'persistProviders' =&gt; ['session'] ] ] ] ] ];</span></span></code> </pre> <br><p>  It remains only to add a login page, for this we create a new processor: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Project</span></span>\<span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">HTTP</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PHPixie</span></span>\<span class="hljs-title"><span class="hljs-title">AuthLogin</span></span>\<span class="hljs-title"><span class="hljs-title">Providers</span></span>\<span class="hljs-title"><span class="hljs-title">Password</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PHPixie</span></span>\<span class="hljs-title"><span class="hljs-title">HTTP</span></span>\<span class="hljs-title"><span class="hljs-title">Request</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PHPixie</span></span>\<span class="hljs-title"><span class="hljs-title">Validate</span></span>\<span class="hljs-title"><span class="hljs-title">Form</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Project</span></span>\<span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">User</span></span>\<span class="hljs-title"><span class="hljs-title">UserRepository</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PHPixie</span></span>\<span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">User</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *       */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Auth</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Processor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Request $request HTTP request * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> mixed */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">defaultAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($request)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    ,     if($this-&gt;user()) { return $this-&gt;redirect('app.frontpage'); } $components = $this-&gt;components(); //     $template = $components-&gt;template()-&gt;get('app:login', [ 'user' =&gt; $this-&gt;user() ]); $loginForm = $this-&gt;loginForm(); $template-&gt;loginForm = $loginForm; //         if($request-&gt;method() !== 'POST') { return $template; } $data = $request-&gt;data(); //      $loginForm-&gt;submit($data-&gt;get()); //           if($loginForm-&gt;isValid() &amp;&amp; $this-&gt;processLogin($loginForm)) { return $this-&gt;redirect('app.frontpage'); } //       return $template; } /** *   * * @param Form $loginForm * @return bool    */ protected function processLogin($loginForm) { //   $user = $this-&gt;passwordProvider()-&gt;login( $loginForm-&gt;email, $loginForm-&gt;password ); //        ,      if($user === null) { $loginForm-&gt;result()-&gt;addMessageError("Invalid email or password"); return false; } return true; } /** *  * @return mixed */ public function logoutAction() { //       $domain = $this-&gt;components()-&gt;auth()-&gt;domain(); $domain-&gt;forgetUser(); //     return $this-&gt;redirect('app.frontpage'); } /** *    * @return Form */ protected function loginForm() { $validate = $this-&gt;components()-&gt;validate(); $validator = $validate-&gt;validator(); //    //(        ) $document = $validator-&gt;rule()-&gt;addDocument(); //    $document-&gt;valueField('email') -&gt;required("Email is required"); $document-&gt;valueField('password') -&gt;required("Password is required"); //      return $validate-&gt;form($validator); } /** *       /assets/config/auth.php * @return Password */ protected function passwordProvider() { $domain = $this-&gt;components()-&gt;auth()-&gt;domain(); return $domain-&gt;provider('password'); } }</span></span></code> </pre> <br><p>  It remains only to make up the authorization form itself, so as not to copy all the code here, I will give an example of one field: </p><br><pre> <code class="php hljs">&lt;--   has-danger     --&gt; &lt;div <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">form</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">group</span></span></span><span class="hljs-class"> &lt;?=$</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class">($</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">loginForm</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fieldError</span></span></span><span class="hljs-class">('</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">email</span></span></span><span class="hljs-class">'), "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">has</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">danger</span></span></span><span class="hljs-class">")?&gt;"&gt; &lt;--        --&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">input</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">email</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">text</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class">="&lt;?=$</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">_</span></span></span><span class="hljs-class">($</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">loginForm</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fieldValue</span></span></span><span class="hljs-class">('</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">email</span></span></span><span class="hljs-class">'))?&gt;" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">form</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">control</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">placeholder</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Username</span></span></span><span class="hljs-class">"&gt; &lt;--      --&gt; &lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class">($</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">error</span></span></span><span class="hljs-class"> = $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">loginForm</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fieldError</span></span></span><span class="hljs-class">('</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">email</span></span></span><span class="hljs-class">')): ?&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">form</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">control</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">feedback</span></span></span><span class="hljs-class">"&gt;&lt;?=$</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">error</span></span></span><span class="hljs-class">?&gt;&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class">&gt; &lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">endif</span></span></span><span class="hljs-class">;?&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class">&gt;</span></span></code> </pre> <br><p>  We also add routes and links to login / logout to the header and ready, login works. </p><br><p>  <strong><a href="https://github.com/PHPixie/Demo-Quickstart/tree/92fc8e0e314a30424e2cfba616932c2d9a294faf">Project status at this stage (commit 4)</a></strong> </p><br><h2 id="5-registraciya">  5. Registration </h2><br><p>  The registration form is done in full analogy, consider the changes to the Auth processor: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** *   * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> Form */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">registerForm</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $validate = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;components()-&gt;validate(); $validator = $validate-&gt;validator(); $document = $validator-&gt;rule()-&gt;addDocument(); <span class="hljs-comment"><span class="hljs-comment">//          . //         . //     hidden  "register"      //     $document-&gt;allowExtraFields(); //   $document-&gt;valueField('name') -&gt;required("Name is required") -&gt;addFilter() -&gt;minLength(3) -&gt;message("Username must contain at least 3 characters"); // Email       $document-&gt;valueField('email') -&gt;required("Email is required") -&gt;filter('email', "Please provide a valid email"); //    8  $document-&gt;valueField('password') -&gt;required("Password is required") -&gt;addFilter() -&gt;minLength(8) -&gt;message("Password must contain at least 8 characters"); //    $document-&gt;valueField('passwordConfirm') -&gt;required("Please repeat your password"); //           $validator-&gt;rule()-&gt;callback(function($result, $value) { //      if($value['password'] !== $value['passwordConfirm']) { $result-&gt;field('passwordConfirm')-&gt;addMessageError("Passwords don't match"); } }); //      return $validate-&gt;form($validator); } /** *   * @param Form $registerForm * @return bool     */ protected function processRegister($registerForm) { /** @var UserRepository $userRepository */ $userRepository = $this-&gt;components()-&gt;orm()-&gt;repository('user'); //  email        if($userRepository-&gt;getByLogin($registerForm-&gt;email)) { $registerForm-&gt;result()-&gt;field('email')-&gt;addMessageError("This email is already taken"); return false; } //      $provider = $this-&gt;passwordProvider(); $user = $userRepository-&gt;create([ 'name' =&gt; $registerForm-&gt;name, 'email' =&gt; $registerForm-&gt;email, 'passwordHash' =&gt; $provider-&gt;hash($registerForm-&gt;password) ]); $user-&gt;save(); //    $provider-&gt;setUser($user); return true; }</span></span></code> </pre> <br><p>  The only thing that should be noted is that we have added a hidden <code>register</code> field to the HTML code of the form, by which we check the login or registration. </p><br><p>  <strong><a href="https://github.com/PHPixie/Demo-Quickstart/tree/7e3cf803c02f579ff6e29f6b64369d6ceb439970">Project status at this stage (commit 5)</a></strong> </p><br><h2 id="6-socialnyy-login">  6. Social login </h2><br><p>  Now connect the login from Facebook and Twitter.  Let's start by adding two <code>facebookId</code> and <code>twitterId</code> to the table of users by creating a new migration: </p><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">/* /assets/migrate/migrations/2_social_login.sql */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> twitterId <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AFTER</span></span> passwordHash; <span class="hljs-comment"><span class="hljs-comment">-- statement ALTER TABLE users ADD COLUMN facebookId VARCHAR(255) AFTER twitterId;</span></span></code> </pre> <br><p>  Now we need to create an application on these platforms and get <code>appId</code> and <code>appSecret</code> .  When registering, we specify the Callback Url correctly: <code>http://localhost.com/socialAuth/callback/twitter</code> for Twitter and <code>http://localhost.com/socialAuth/callback/twitter</code> for Facebook.  We will create these routes ourselves later, but for now let's set up the settings: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// /assets/config/social.php return [ 'facebook' =&gt; [ 'type' =&gt; 'facebook', 'appId' =&gt; 'YOUR APP ID', 'appSecret' =&gt; 'YOUR APP SECRET' ], 'twitter' =&gt; [ 'type' =&gt; 'twitter', 'consumerKey' =&gt; 'YOUR APP ID', 'consumerSecret' =&gt; 'YOUR APP SECRET' ] ];</span></span></code> </pre> <br><p>  And we will include support for a social login in the <code>auth.php</code> config already known to us: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// /assets/config/auth.php </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> return [ 'domains' =&gt; [ 'default' =&gt; [ // .... 'providers' =&gt; [ //..... //   'social' =&gt; [ 'type' =&gt; 'social.oauth', //       'persistProviders' =&gt; ['session'] ] ] ] ] ];</span></span></code> </pre> <br><p>  All finished with the settings, take up the code.  Remember how we had to implement the interface in the repository and user entity classes for a username with a password?  Now one more will be added there: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Project</span></span>\<span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">User</span></span>; <span class="hljs-comment"><span class="hljs-comment">// .... /**       */ use PHPixie\AuthSocial\Repository as SocialRepository; class UserRepository extends Repository implements LoginUserRepository, SocialRepository { // .... /** *         Social. *       null. * * @param SocialUser $socialUser * @return User|null */ public function getBySocialUser($socialUser) { //          id , //  twitterId or facebookId $providerName = $socialUser-&gt;providerName(); $field = $this-&gt;socialIdField($providerName); //       return $this-&gt;query()-&gt;where($field, $socialUser-&gt;id())-&gt;findOne(); } /** *      id. *         'Id'    * * @param string $providerName * @return string */ public function socialIdField($providerName) { return $providerName.'Id'; } }</span></span></code> </pre> <br><p>  And now, finally, the new authorization processor itself: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Project</span></span>\<span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">HTTP</span></span>\<span class="hljs-title"><span class="hljs-title">Auth</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PHPixie</span></span>\<span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">User</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PHPixie</span></span>\<span class="hljs-title"><span class="hljs-title">AuthSocial</span></span>\<span class="hljs-title"><span class="hljs-title">Providers</span></span>\<span class="hljs-title"><span class="hljs-title">OAuth</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">OAuthProvider</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PHPixie</span></span>\<span class="hljs-title"><span class="hljs-title">HTTP</span></span>\<span class="hljs-title"><span class="hljs-title">Request</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Project</span></span>\<span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">User</span></span>\<span class="hljs-title"><span class="hljs-title">UserRepository</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Project</span></span>\<span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">HTTP</span></span>\<span class="hljs-title"><span class="hljs-title">Processor</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PHPixie</span></span>\<span class="hljs-title"><span class="hljs-title">Social</span></span>\<span class="hljs-title"><span class="hljs-title">OAuth</span></span>\<span class="hljs-title"><span class="hljs-title">User</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">SocialUser</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *     */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Social</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Processor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *       *  Twitter  Facebook * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Request $request HTTP request * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> mixed */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">defaultAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($request)</span></span></span><span class="hljs-function"> </span></span>{ $provider = $request-&gt;attributes()-&gt;get(<span class="hljs-string"><span class="hljs-string">'provider'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    ,       if(empty($provider)) { return $this-&gt;redirect('app.processor', ['processor' =&gt; 'auth']); } //  URL       $callbackUrl = $this-&gt;buildCallbackUrl($provider); $url = $this-&gt;oauthProvider()-&gt;loginUrl($provider, $callbackUrl); return $this-&gt;responses()-&gt;redirect($url); } /** *    . *      http://localhost.com/socialAuth/callback/twitter *       . * * @param Request $request HTTP request * @return mixed */ public function callbackAction($request) { $provider = $request-&gt;attributes()-&gt;getRequired('provider'); //   URL  ,      $callbackUrl = $this-&gt;buildCallbackUrl($provider); $query = $request-&gt;query()-&gt;get(); //     //           . //             $userData $userData = $this-&gt;oauthProvider()-&gt;handleCallback($provider, $callbackUrl, $query); //  -   ,     //        if($userData === null) { return $this-&gt;redirect('app.processor', ['processor' =&gt; 'auth']); } //     ,     //            if($this-&gt;user() === null) { $user = $this-&gt;registerNewUser($userData); //      $this-&gt;oauthProvider()-&gt;setUser($user); } //    ,        return $this-&gt;redirect('app.frontpage'); } /** *      * * @param SocialUser $socialUser * @return mixed */ protected function registerNewUser($socialUser) { /** @var UserRepository $userRepository */ $userRepository = $this-&gt;components()-&gt;orm()-&gt;repository('user'); //       . //         , //      . $profileName = $this-&gt;getProfileName($socialUser); //        id $socialIdField = $userRepository-&gt;socialIdField($socialUser-&gt;providerName()); //    $user = $userRepository-&gt;create([ 'name' =&gt; $profileName, $socialIdField =&gt; $socialUser-&gt;id() ]); $user-&gt;save(); return $user; } /** *        * * @param SocialUser $socialUser * @return mixed */ protected function getProfileName($socialUser) { //    Twitter  Facebook   ,    . return $socialUser-&gt;loginData()-&gt;name; } /** *  URL  ,   *      . * * @param $provider * @return string */ protected function buildCallbackUrl($provider) { return $this-&gt;frameworkHttp()-&gt;generateUri('app.socialAuthCallback', [ 'provider' =&gt; $provider ])-&gt;__toString(); } /** *   OAuth  * * @return OAuthProvider */ protected function oauthProvider() { $domain = $this-&gt;components()-&gt;auth()-&gt;domain(); return $domain-&gt;provider('social'); } }</span></span></code> </pre> <br><p>  Next we register the routes and add the login links to our authorization form: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// /bundles/app/assets/templates/login.php </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> $url = $this-&gt;httpPath('app.socialAuth', ['provider' =&gt; 'twitter']); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;a class="btn btn-lg btn-primary btn-block" href="</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment">=$url</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">"&gt;Login with Twitter&lt;/a&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> $url = $this-&gt;httpPath('app.socialAuth', ['provider' =&gt; 'facebook']); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;a class="btn btn-lg btn-primary btn-block" href="</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment">=$url</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">"&gt;Login with Facebook&lt;/a&gt;</span></span></code> </pre> <br><p>  <strong><a href="https://github.com/PHPixie/Demo-Quickstart/tree/a34107cd33f0b56a249d299bd92788dac09d5294">Project status at this stage (Commit 6)</a></strong> </p><br><h2 id="7-dobavlenie-soobscheniy">  7. Adding messages </h2><br><p>  There is actually nothing interesting, another form, only this time through AJAX for a change.  Here the only thing to be noted <br>  so is the use of blocks in templates for adding scripts.  And so we add the <code>scripts</code> block to the parent template: </p><br><pre> <code class="php hljs">&lt;!-- /bundles/app/assets/templates/layout.php --&gt; &lt;!--         --&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;block(<span class="hljs-string"><span class="hljs-string">'scripts'</span></span>)<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br><p>  Now, in the <code>messages</code> template itself, we can add a script to this block: </p><br><pre> <code class="php hljs">&lt;!-- /bundles/app/assets/templates/messages.php --&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;startBlock(<span class="hljs-string"><span class="hljs-string">'scripts'</span></span>); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;script&gt; $(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Init the form handler </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> $url = $this-&gt;httpPath('app.action', ['processor' =&gt; 'messages', 'action' =&gt; 'post']);</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> $('#messageForm').messageForm("</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment">=$_($url)</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">"); }); &lt;/script&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> $this-&gt;endBlock(); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre> <br><p>         ,        .     , <br>         ,   : </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;startBlock(<span class="hljs-string"><span class="hljs-string">'test'</span></span>); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> Hello <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;endBlock(); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;startBlock(<span class="hljs-string"><span class="hljs-string">'test'</span></span>); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> World <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;endBlock(); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;block(<span class="hljs-string"><span class="hljs-string">'test'</span></span>)<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;!--  --&gt; Hello World</code> </pre> <br><pre> <code class="php hljs">&lt;!--    <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>    ,   startBlock()   <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>  . --&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;startBlock(<span class="hljs-string"><span class="hljs-string">'test'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>)): <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> Hello <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;endBlock();<span class="hljs-keyword"><span class="hljs-keyword">endif</span></span>; <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;startBlock(<span class="hljs-string"><span class="hljs-string">'test'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>)): <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> World <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;endBlock();<span class="hljs-keyword"><span class="hljs-keyword">endif</span></span>; <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;block(<span class="hljs-string"><span class="hljs-string">'test'</span></span>)<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;!--  --&gt; Hello</code> </pre> <br><p>        <code>Messages</code>       : </p><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($request)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// .... //  ORM    PHP . //  true          , //      . // //   PHPixie       JSON  . return $message-&gt;asObject(true); }</span></span></code> </pre> <br><p> ** <a href="https://github.com/PHPixie/Demo-Quickstart/tree/48edabf4d69ee848346432300d357e5e96656780">     ( 7)</a> </p><br><h2 id="8-konsolnye-komandy"> 8.   </h2><br><p>     .    : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Project</span></span>\<span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Console</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PHPixie</span></span>\<span class="hljs-title"><span class="hljs-title">Console</span></span>\<span class="hljs-title"><span class="hljs-title">Command</span></span>\<span class="hljs-title"><span class="hljs-title">Config</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PHPixie</span></span>\<span class="hljs-title"><span class="hljs-title">Slice</span></span>\<span class="hljs-title"><span class="hljs-title">Data</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *     */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Messages</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Command</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *   * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Config $config */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($config)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  $config-&gt;description("Print latest messages"); //      id  $config-&gt;option('userId') -&gt;description("Only print messages of this user"); //       $config-&gt;argument('limit') -&gt;description("Maximum number of messages to display, default is 5"); } /** * @param Data $argumentData * @param Data $optionData */ public function run($argumentData, $optionData) { //    $limit = $argumentData-&gt;get('limit', 5); //   $query = $this-&gt;components()-&gt;orm()-&gt;query('message') -&gt;orderDescendingBy('date') -&gt;limit($limit); //   userId      $userId = $optionData-&gt;get('userId'); if($userId) { $query-&gt;relatedTo('user', $userId); } //    $messages = $query-&gt;find(['user'])-&gt;asArray(); //     if(empty($messages)) { $this-&gt;writeLine("No messages found"); } //   foreach($messages as $message) { $dateTime = new \DateTime($message-&gt;date); $this-&gt;writeLine($message-&gt;text); $this-&gt;writeLine(sprintf( "by %s on %s", $message-&gt;user()-&gt;name, $dateTime-&gt;format('j MY, H:i') )); $this-&gt;writeLine(); } } }</span></span></code> </pre> <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Project</span></span>\<span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Console</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PHPixie</span></span>\<span class="hljs-title"><span class="hljs-title">Console</span></span>\<span class="hljs-title"><span class="hljs-title">Command</span></span>\<span class="hljs-title"><span class="hljs-title">Config</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PHPixie</span></span>\<span class="hljs-title"><span class="hljs-title">Database</span></span>\<span class="hljs-title"><span class="hljs-title">Driver</span></span>\<span class="hljs-title"><span class="hljs-title">PDO</span></span>\<span class="hljs-title"><span class="hljs-title">Connection</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PHPixie</span></span>\<span class="hljs-title"><span class="hljs-title">Slice</span></span>\<span class="hljs-title"><span class="hljs-title">Data</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *     */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Stats</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Command</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *   * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Config $config */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($config)</span></span></span><span class="hljs-function"> </span></span>{ $config-&gt;description(<span class="hljs-string"><span class="hljs-string">"Display statistics"</span></span>); } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Data $argumentData * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Data $optionData */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($argumentData, $optionData)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   Database $database = $this-&gt;components()-&gt;database(); /** @var Connection $connection */ $connection = $database-&gt;get(); //    $total = $connection-&gt;countQuery() -&gt;table('messages') -&gt;execute(); $this-&gt;writeLine("Total messages: $total"); //      $stats = $connection-&gt;selectQuery() -&gt;fields([ 'name' =&gt; 'u.name', // sqlExpression    SQL 'count' =&gt; $database-&gt;sqlExpression('COUNT(1)'), ]) -&gt;table('messages', 'm') -&gt;join('users', 'u') -&gt;on('m.userId', 'u.id') -&gt;groupBy('u.id') -&gt;execute(); foreach($stats as $row) { $this-&gt;writeLine("{$row-&gt;name}: {$row-&gt;count}"); } } }</span></span></code> </pre> <br><p>       <code>Project\App\Console</code> : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Project</span></span>\<span class="hljs-title"><span class="hljs-title">App</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Console</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PHPixie</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DefaultBundle</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Console</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Here we define console commands * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $classMap = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'messages'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Project\App\Console\Messages'</span></span>, <span class="hljs-string"><span class="hljs-string">'stats'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Project\App\Console\Stats'</span></span> ); }</code> </pre> <br><p> ,       : </p><br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta"># ./console Available commands: app:messages Print latest messages app:stats Display statistics # ....</span></span></code> </pre> <br><pre> <code class="hljs delphi"># ./console help app:messages app:messages [ --userId=VALUE ] [ LIMIT ] Print latest messages Options: userId Only print messages <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> this user Arguments: LIMIT Maximum number <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> messages <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> display, <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span></code> </pre> <br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta"># ./console help app:stats app:stats Display statistics</span></span></code> </pre> <br><p>    : </p><br><pre> <code class="hljs vbscript"># ./console app:messages <span class="hljs-number"><span class="hljs-number">2</span></span> Simplicity <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> the ultimate sophistication. -- Leonardo da Vinci by Trixie <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> Dec <span class="hljs-number"><span class="hljs-number">2016</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span> Simplicity <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> prerequisite <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> reliability. -- Edsger W. Dijkstra by Trixie <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> Dec <span class="hljs-number"><span class="hljs-number">2016</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span></code> </pre> <br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta"># ./console app:stats Total messages: 14 Pixie: 3 Trixie: 11</span></span></code> </pre> <br><p> <strong><a href="https://github.com/PHPixie/Demo-Quickstart/tree/df8d0e75aea57d0dfebf7deea23909b33513e352">     ( 8)</a></strong> </p><br><h2 id="9-ispolzovanie-parametrov-konfiguracii"> 9.    </h2><br><p>            ,   . <br>   ,   <code>/assets/parameters.php</code>    ,       . </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// /assets/parameters.php return [ 'database' =&gt; [ 'name' =&gt; 'phpixie', 'user' =&gt; 'phpixie', 'password' =&gt; 'phpixie' ], 'social' =&gt; [ 'facebookId' =&gt; 'YOUR APP ID', 'facebookSecret' =&gt; 'YOUR APP SECRET', 'twitterId' =&gt; 'YOUR APP ID', 'twitterSecret' =&gt; 'YOUR APP SECRET', ] ];</span></span></code> </pre> <br><p>     : </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// /assets/config/database.php return [ // Database configuration 'default' =&gt; [ //     /assets/parameters.php 'database' =&gt; '%database.name%', 'user' =&gt; '%database.user%', 'password' =&gt; '%database.password%', 'adapter' =&gt; 'mysql', 'driver' =&gt; 'pdo' ] ];</span></span></code> </pre> <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// /assets/config/social.php return [ 'facebook' =&gt; [ 'type' =&gt; 'facebook', 'appId' =&gt; '%social.facebookId%', 'appSecret' =&gt; '%social.facebookSecret%' ], 'twitter' =&gt; [ 'type' =&gt; 'twitter', 'consumerKey' =&gt; '%social.twitterId%', 'consumerSecret' =&gt; '%social.twitterSecret%' ] ];</span></span></code> </pre> <br><p>           .     PHP     <br>       <code>if</code>  <code>switch</code>        . </p><br><p> <strong><a href="https://github.com/PHPixie/Demo-Quickstart"> </a></strong> </p><br><h2 id="konec">  the end </h2><br><p>   ,      ,   .              ,    ,       . </p><br><p>              :) </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/320056/">https://habr.com/ru/post/320056/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../320044/index.html">Caching data in web applications. Using memcached</a></li>
<li><a href="../320046/index.html">Authorization in Laravel, through social networks (Ulogin). Simple, flexible and efficient.</a></li>
<li><a href="../320048/index.html">Summary building information model: a practical lesson on OpenBIM technology</a></li>
<li><a href="../320052/index.html">Android Shortcuts Review</a></li>
<li><a href="../320054/index.html">Conducting research in modern conditions</a></li>
<li><a href="../320058/index.html">Application Insights. About analytics and other new tools</a></li>
<li><a href="../320060/index.html">Security Week 03: the sunset of SHA-1 continues, a bug or feature in Whatsapp, vulnerabilities in routers are not repaired</a></li>
<li><a href="../320062/index.html">Where to move with Parse Push?</a></li>
<li><a href="../320064/index.html">Angular 2: why on TypeScript?</a></li>
<li><a href="../320066/index.html">ERP CRM Consultant ‚Äî Eternal Negotiator</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>