<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>RESTful API Design Approaches</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Author: Vyacheslav Mikhailov, Solutions Architect. 

 In this article I will share the experience of designing a RESTful API - I will show you with sp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>RESTful API Design Approaches</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/a02/1de/9f6/a021de9f60614f0199d148c7eace1961.png"><br>  Author: Vyacheslav Mikhailov, Solutions Architect. <br><br>  In this article I will share the experience of designing a RESTful API - I will show you with specific examples how to make at least simple services beautifully.  We will also talk about what an API is and why it is needed; let's talk about the basics of REST ‚Äî let's discuss how it can be implemented;  let's touch the main web practices that depend on and do not depend on this technology.  We will also learn how to make good documentation, spending a minimum of effort on this, and see what version numbering methods exist for the RESTful API. <br><br><h5>  <b>Part 1. Theory</b> </h5>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, as we all know, the API is an application programming interface, a set of rules and mechanisms by which one application or component interacts with others. <br><br>  <b>Why is a good API important?</b> <br><br><ul><li>  <b>Ease of use and support</b> .  A good API is easy to use and maintain. </li><li>  <b>Good conversion among developers</b> .  If everyone likes your API, new customers and users come to you. </li><li>  <b>Higher popularity of your service</b> .  The more users of the API, the higher the popularity of your service. </li><li>  <b>Better isolation of components</b> .  The better the API structure, the better the isolation of the components. </li><li>  <b>Good impression about the product</b> .  The API is like a UI for developers;  This is what the developers are paying attention to first and foremost when meeting with the product.  If the API is a curve, you as a technical expert will not recommend companies to use such a product, acquiring something third-party. </li></ul><br><br>  <b>Now let's see what kinds of APIs there are.</b> <br><br>  API types by implementation method: <br><ul><li>  Web service APIs <br><ul><li>  XML-RPC and JSON-RPC </li><li>  SOAP </li><li>  REST </li></ul><br></li><li>  WebSockets APIs </li><li>  Library-based APIs <br><ul><li>  Java script </li></ul><br></li><li>  Class-based APIs <br><ul><li>  C # API </li><li>  Java </li></ul><br></li></ul><br><br>  API types by application category: <br><br><ul><li>  OS function and routines <br><ul><li>  Access to file system </li><li>  Access to user interface </li></ul><br></li><li>  Object remoting APIs <br><ul><li>  CORBA </li><li>  .Net remoting </li></ul><br></li><li>  Hardware APIs <br><ul><li>  Video acceleration (OpenCL ...) </li><li>  Hard disk drives </li><li>  PCI bus </li><li>  ... </li></ul><br></li></ul><br><br><a name="habracut"></a><br>  As we can see, the Web API includes XML-RPC and JSON-RPC, SOAP and REST. <br><br>  RPC (remote procedure call - ‚Äúremote procedure call‚Äù) is a very old concept, combining ancient, middle, and modern protocols that allow calling a method in another application.  XML-RPC is a protocol that appeared in 1998 shortly after the appearance of XML.  It was initially supported by Microsoft, but soon Microsoft completely switched to SOAP, therefore in the .Net Framework we will not find classes to support this protocol.  Despite this, XML-RPC continues to live in different languages ‚Äã‚Äã(especially in PHP) - apparently, developers deserve the love of simplicity. <br><br>  SOAP also appeared in 1998 through the efforts of Microsoft.  It was announced as a revolution in the software world.  This is not to say that everything went according to Microsoft's plan: there was a huge amount of criticism due to the complexity and heavyness of the protocol.  At the same time, there were those who considered SOAP a real breakthrough.  The protocol continued to evolve and produce dozens of new and new specifications, until in 2003 the W3C approved SOAP 1.2 as a recommendation, which is the last one now.  The SOAP family turned out impressive: WS-Addressing, WS-Enumeration, WS-Eventing, WS-Transfer, WS-Trust, WS-Federation, Web Single Sign-On. <br><br>  Then, naturally, a really simple approach appeared - REST.  The abbreviation REST stands for representational state transfer - ‚Äútransfer of the presentation state‚Äù or, better to say, the presentation of data in a format convenient for the client.  The term ‚ÄúREST‚Äù was introduced by Roy Fielding in 2000. The main idea of ‚Äã‚ÄãREST is that each call to the service takes the client application to a new state.  In essence, REST is not a protocol or a standard, but an approach, an architectural style of API design. <br><br>  <b>What are the principles of REST?</b> <br><br><ul><li>  <b>Client-server architecture</b> - without this REST is unthinkable. </li><li>  <b>Any data is a resource</b> . </li><li>  <b>Any resource has an ID</b> by which data can be obtained. </li><li>  <b>Resources can be interconnected</b> - for this, either an ID is sent as part of the response, or, as is more often recommended, a link.  But I have not yet reached the point that everything is so good that links can be easily used. </li><li>  <b>Standard HTTP methods</b> (GET, POST, PUT, DELETE) are used - since they are already incorporated in the protocol, we can use them to build the framework for interaction with our server. </li><li>  <b>The server does not store the state</b> - this means the server does not separate one call from another, it does not save all sessions in memory.  If you have any scalable cloud, some farm of servers that implements your service, there is no need to ensure the consistency of the state of these services between all the nodes that you have.  This greatly simplifies scaling - when adding another node, everything works fine. </li></ul><br><br>  <b>What is REST good for?</b> <br><br><ul><li>  <b>He is very simple!</b> </li><li>  <b>We are re-using existing standards</b> that have been running for a very long time and are used on many devices. </li><li>  <b>REST is based on HTTP</b> =&gt; all the buns are available: <br><ul><li>  Caching </li><li>  Scaling. </li><li>  Minimum overhead. </li><li>  Standard error codes. </li></ul><br></li><li>  <b>Very good prevalence</b> (even IoT devices already know how to work on HTTP). </li></ul><br><br><h6>  <b>Best solutions (technology independent)</b> </h6><br>  What are the best solutions in the modern world that are not related to a specific implementation?  I advise you to use these solutions: <br><br><ul><li>  <b>SSL everywhere</b> is the most important thing in your service, since without SSL, authorization and authentication are meaningless. </li><li>  <b>Documentation and</b> service <b>version</b> - from the first day of work. </li><li>  <b>POST and PUT methods should return the</b> object that they have changed or created, this will reduce the time for accessing the service by half. </li><li>  <b>Support for filtering, sorting and paging</b> - it is very desirable that it be standard and work out of the box. </li><li>  <b>MediaType support</b> .  MediaType - a way to tell the server what format you want to get the content in.  If you take any standard web API implementation and go there from the browser, the API will give you XML, and if you go through some Postman, it will return JSON. </li><li>  <b>Prettyprint &amp; gzip</b> .  Do not minimize requests and do not compact for JSON (the answer that comes from the server).  The overhead of a prettyprint is a percent unit, which is obvious if you look at how many tabs take in relation to the total message size.  If you remove the tabs and send everything in one line, start with debugging.  As for gzip, it gives a gain at times.  T. h. I strongly advise using both prettyprint and gzip. </li><li>  <b>Use only the standard caching mechanism (ETag) and Last-Modified (last modified date)</b> - these two parameters are enough for the server so that the client understands that the content does not require updating.  There is no point in inventing something of your own. </li><li>  <b>Always use standard HTTP error codes</b> .  Otherwise, you will one day have to explain to someone why you decided that the client in your project needs to interpret error 419 exactly as you came up with for some reason.  This is inconvenient and ugly - the client will not thank you for that! </li></ul><br><br><h6>  <b>HTTP methods properties</b> </h6><br><img src="https://habrastorage.org/files/120/8ab/246/1208ab24645940f0b580397799e880eb.png"><br><br>  Today we will talk only about GET, POST, PUT, DELETE. <br><br>  If we talk briefly about the rest presented in the table, OPTIONS - getting security settings, HEAD - getting headers without message body, PATCH - partial content change. <br><br>  As you can see, all methods except POST, presented in the table, are idempotent.  Idempotency - the ability to perform the same access to the service several times, with the answer each time being the same.  In other words, it doesn't matter for what reason or how many times you performed this action.  Suppose you performed an action to modify an object (PUT), and you received an error.  You do not know what caused it and at what point, you do not know whether the object has changed or not.  But, thanks to idempotency, you are guaranteed to be able to perform this action again, because customers can be sure about the integrity of their data. <br><br>  ‚ÄúSafe‚Äù means that accessing the server does not change the content.  So, GET can be called many times, but it will not change any content.  If he changed the content, due to the fact that GET can be cached, you would have to deal with caching, invent some tricky parameters. <br><br><h5>  <b>Part 2. Practice</b> </h5><br><br><h6>  <b>Choosing technology</b> </h6><br><br>  Now that we understand how REST works, we can start writing a RESTful API of a service that meets the principles of REST.  Let's start with the choice of technology. <br><br>  The first option is <b>WCF Services</b> .  Everyone who has worked with this technology, usually no longer want to return to it - it has serious flaws and few advantages: <br>  - webHttpBinding only (and then why the others? ..). <br>  - Only HTTP Get &amp; POST (and all) are supported. <br>  + Different XML, JSON, ATOM formats. <br><br>  The second option is the <b>Web API</b> .  In this case, the advantages are obvious: <br>  + Very simple. <br>  + Open source. <br>  + All HTTP features. <br>  + All MVC features. <br>  + Easy. <br>  + Also supports a bunch of formats. <br><br>  Naturally, we choose the Web API.  Now we select the appropriate hosting for the Web API. <br><br>  <b>Choosing a hosting for the Web API</b> <br><br>  There are enough options: <br><ul><li>  ASP.NET MVC (good old). </li><li>  Azure (cloud structure). </li><li>  OWIN - Open Web Interface for .NET (fresh development from Microsoft). </li><li>  IIS </li><li>  Self-hosted </li></ul><br>  Owi <br>  <b>OWIN</b> is not a platform or a library, but a specification that eliminates the strong coherence of the web application with the server implementation.  It allows you to run applications on any platform that supports OWIN, without changes.  In fact, the specification is very simple - it is just a ‚Äúdictionary‚Äù of parameters and their values.  Basic parameters are defined in the specification. <br><br>  OWIN comes down to a very simple design: <br><br><img src="https://habrastorage.org/files/e42/a2a/e5f/e42a2ae5fda040dc8c8c0ef0fcb55f9f.png"><br><br>  According to the scheme, we see that there is a host on which there is a server that supports a very simple ‚Äúdictionary‚Äù consisting of a list of ‚Äúparameter - value‚Äù.  All modules that connect to this server are configured this way.  A server supporting this contract tied to a specific platform can recognize all these parameters and initialize the infrastructure accordingly.  It turns out that if you write a service that works with OWIN, you can freely, without changing the code, transfer it between platforms and use the same on other OSs. <br><br>  <b>Katana</b> is an OWIN implementation from Microsoft.  It allows you to place OWIN assemblies in IIS.  This is how it looks, very simple: <br><br><pre><code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">assembly: OwinStartup(typeof (Startup))</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">RestApiDemo</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Startup</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Configuration</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IAppBuilder app</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> config = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpConfiguration(); config.MapHttpAttributeRoutes(); app.UseWebApi(config); } } }</code> </pre> <br><br>  You specify which class you have in Startup.  This is a simple dll that rises IIS.  Called the configurator.  This code is enough to make it work. <br><br><h6>  <b>We design the interface</b> </h6><br>  Now we will design the interface and see how everything should look and what rules to comply with.  All resources in REST are nouns, something that you can touch and touch. <br><br>  As an example, take a simple model with a train schedule at the stations.  Here are examples of simplest REST requests: <br><br><ul><li>  Root (independent) API entities: <br><ul><li>  GET / stations - get all the stations. </li><li>  GET / stations / 123 - get information on the station with ID = 123. </li><li>  GET / trains - the schedule of all trains. </li></ul><br></li><li>  Dependent (on root) entities: <br><ul><li>  GET / stations / 555 / departures - trains leaving from station 555. </li></ul><br></li></ul><br><br>  Next, I will tell you more about DDD, why we are doing just that. <br><br><h6>  <b>Controller</b> </h6><br><br>  So, we have stations, and now we need to write the simplest controller: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">RoutePrefix(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"stations"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RailwayStationsController</span></span> : <span class="hljs-title"><span class="hljs-title">ApiController</span></span> { [HttpGet] [Route] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IEnumerable&lt;RailwayStationModel&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetAll</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> testData; } RailwayStationModel[] testData = <span class="hljs-comment"><span class="hljs-comment">/*initialization here*/</span></span> }</code> </pre><br><br>  This is attribute based routing.  Here we indicate the name of the controller and ask to give the list (in this case, random test data). <br><br><h6>  <b>OData (www.odata.org)</b> </h6><br><br>  Now imagine that you have more data than you need on the client (more than stealing hardly makes sense).  At the same time, of course, I don‚Äôt want to write any pagination myself.  Instead, there is a simple way to use the lightweight version of <a href="http://www.odata.org/">OData</a> , which is supported by the Web API. <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">RoutePrefix(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"stations"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RailwayStationsController</span></span> : <span class="hljs-title"><span class="hljs-title">ApiController</span></span> { [HttpGet] [Route] [EnableQuery] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IQueryable&lt;RailwayStationModel&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetAll</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> testData.AsQueryable(); } RailwayStationModel[] testData = <span class="hljs-comment"><span class="hljs-comment">/*initialization here*/</span></span> }</code> </pre><br><br>  IQueryable allows you to use several simple but effective filtering and data management mechanisms on the client side.  The only thing that needs to be done is to connect the OData assembly from NuGet, specify EnableQuery and return the iQueryable interface. <br><br>  The main difference between this lightweight version and the full version is that there is no controller that returns metadata.  A full OData slightly changes the answer (wraps the model you are going to return in a special wrapper) and knows how to return the associated tree of objects that you want to give to it.  Also, the lightweight version of OData can't do things like join, count, etc. <br><br><h6>  <b>Request Options</b> </h6><br><br>  But what you can do: <br><br><img src="https://habrastorage.org/files/bbe/fe8/282/bbefe828204d4e5a8e9a4478f64c922b.png"><br><br><ul><li>  $ filter - filter, by name, for example.  All functions can be viewed <a href="http://www.odata.org/">on the OData website</a> - they are very helpful and can significantly limit the selection. </li><li>  $ select is a very important thing.  If you have a large collection and all objects are thick, but at the same time you need to create some kind of dropdown, in which there is nothing except the ID and the name you want to display, this function will help you, which will simplify and speed up the interaction with the server. </li><li>  $ orderby - sorting. </li><li>  $ top and $ skip - restriction on samples. </li></ul><br><br>  This is enough to not reinvent the wheel yourself.  All this is able standard JS-library like Breeze. <br><br><h6>  <b>EnableQuery Attribute</b> </h6><br>  In fact, OData is such a thing that you can easily shoot yourself in the foot.  If you have millions of records in the table, and you need to pull them from the server to the client, it will be hard, and if there are many such requests, it will be deadly. <br><br>  For such cases, the EnableQuery attribute (see code above) has such a set of parameters that can be used to limit a lot: not to give more lines than necessary, not to let join, arithmetic operations, etc. At the same time, write yourself do not need anything. <br><br><ul><li>  AllowedArithmeticOperators </li><li>  AllowedFunctions </li><li>  AllowedLogicalOperators </li><li>  AllowedOrderByProperties </li><li>  AllowedQueryOptions </li><li>  EnableConstantParameterization </li><li>  EnsureStableOrdering </li><li>  HandleNullPropagation </li><li>  MaxAnyAllExpressionDepth </li><li>  MaxExpansionDepth </li><li>  MaxNodeCount </li><li>  MaxOrderByNodeCount </li><li>  MaxSkip </li><li>  Maxtop </li><li>  PageSize </li></ul><br><br>  <b>Dependent controller</b> <br>  So here are some simplest REST requests: <br><br><ul><li>  GET / stations - get all stations </li><li>  GET / trains - all train schedules </li><li>  GET / stations / 555 / arrivals </li><li>  GET / stations / 555 / departures </li></ul><br><br>  Suppose we have station 555, and we want to receive all of its departures and arrivals.  Obviously, an entity should be used here that depends on the essence of the station.  But how to do it in controllers?  If we do all this by routing attributes and put them into one class, it is clear that in this example, like us, there are no problems.  But if you have a dozen nested entities and the depth grows even further, all this will grow into an unsupported format. <br><br>  And there is a simple solution - in the routing attributes in the controllers, you can make variables: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">RoutePrefix(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"stations/{station}/departures"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TrainsFromController</span></span> : <span class="hljs-title"><span class="hljs-title">TrainsController</span></span> { [HttpGet] [Route] [EnableQuery] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IQueryable&lt;TrainTripModel&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetAll</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> station</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetAllTrips().Where(x =&gt; x.OriginRailwayStationId == station); } }</code> </pre><br><br>  Respectively, you take out all dependent entities in the separate controller.  How many of them - it does not matter, since they live separately.  From the point of view of the Web API, they will be perceived by different controllers - the system itself does not seem to know that they are dependent, despite the fact that in the URL they look so. <br><br>  The only problem arises - here we have ‚Äústations‚Äù, and before that there were ‚Äústations‚Äù.  If you change something in one place and change nothing in another, nothing will work.  However, there is a simple solution - using <b>constants for routing</b> : <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TrainsFromControllerRoutes</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> BasePrefix = RailwayStationsControllerRoutes.BasePrefix + <span class="hljs-string"><span class="hljs-string">"/{station:int}/departures"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> GetById = <span class="hljs-string"><span class="hljs-string">"{id:int}"</span></span>; }</code> </pre><br><br>  Then the dependent controller will look like this: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">RoutePrefix(TrainsFromControllerRoutes.BasePrefix)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TrainsFromController</span></span> : <span class="hljs-title"><span class="hljs-title">TrainsController</span></span> { [HttpGet] [Route] [EnableQuery] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IQueryable&lt;TrainTripModel&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetAll</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> station</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetAll().Where(x =&gt; x.OriginRailwayStationId == station); } }</code> </pre><br><br>  You can do the simplest operations for dependent controllers - you just take and calculate the route yourself, and then you can‚Äôt go wrong.  In addition, these things are useful in testing.  If you want to write a test and then want to control it, rather than run every time through all the millions of your tests and correct all the lines where these relative URLs are indicated, then you can also use these constants.  When you change them, your data changes everywhere.  It is very convenient. <br><br><h6>  <b>CRUD</b> </h6><br>  So, we discussed with you how the simplest GET operations can look.  Everyone understands how to make a single GET.  But besides him, we need to discuss three more operations. <br><br><ul><li>  POST - create a new entity <br><ul><li>  POST / Stations - JSON description of the entity as a whole.  The action adds a new entity to the collection. </li><li>  Returns the created entity (firstly, so that there are no double trips to the server, secondly, in order, if necessary, to return server-side parameters that were considered in this object and you need on the client). </li></ul><br><br></li><li>  PUT - change entity <br><ul><li>  PUT / Stations / 12 - Change entity with ID = 12. The JSON that comes in the parameter will be overwritten. </li><li>  Returns the modified entity.  A path that has been applied many times must bring the system to the same state. </li></ul><br></li><li>  DELETE <br><ul><li>  DELETE / Stations / 12 - delete an entity with ID = 12. </li></ul><br></li></ul><br><br>  More CRUD examples: <br><br><ul><li>  POST / Stations - add the station. </li><li>  POST / Stations / 1 / Departures - add information about the departure from the station 1. </li><li>  DELETE / Stations / 1 / Departures / 14 - delete the record of the departure from the station 1. </li><li>  GET / Stations / 33 / Departures / 10 / Tickets ‚Äî list of tickets sold for departure 10 from train station 33. </li></ul><br><br>  It is important to understand that nodes are necessarily some entities, something that can be ‚Äútouched‚Äù (a ticket, a train, the fact of a train departure, etc.). <br><br><h6>  <b>Anti-patterns</b> </h6><br>  Here are some examples of how not to do it: <br><br><ul><li>  <strong>GET / Stations /? Op = departure &amp; train = 11</strong> <br>  Here query string is used not only for data transfer, but also for actions. </li><li>  <strong>GET / Stations / DeleteAll</strong> <br>  This is a real life example.  Here we do GET to this address, and he, in theory, should remove all entities from the collection - as a result, he behaves very unpredictably because of caching. </li><li>  <strong>POST / GetUserActivity</strong> <br>  Actually here is GET, which is written as POST.  POST was needed because of the parameters of the request in the body, but you cannot transfer anything to the body of GET - you can only transfer GET to the query string.  GET does not even support body as standard. </li><li>  <strong>POST / Stations / Create</strong> <br>  Here the action is specified in the URL - this is redundant. </li></ul><br><br><h6>  <b>Designing API</b> </h6><br>  Suppose you have an API that you want to offer to people, and there is a domain model.  How are API entities related to the domain model?  Yes, they are not related, in fact.  There is no need for this: what you do in the API is not related to your internal domain model. <br><br>  The question may arise how to design an API if it is not a CRUD?  To do this, we record any actions as commands for change.  We save, read, delete a command, GET, check the status of this command.  GET from a collection of commands - you get a list of all the commands that you sent for a particular entity. <br><br><h6>  <b>Domain model</b> </h6><br>  We will talk about the connection of the domain model with objects.  In the example we have a hotel (Hotel), there are reservations (Reservation), rooms (Room) and devices (Device) attached to them.  In our project, this allowed us to manage the rooms through these devices. <br><br><img src="https://habrastorage.org/files/f44/caf/456/f44caf45648c40ce91da28b7d0c049ed.png"><br><br>  But here's the bad luck: the device - the essence that lives its own life, and it is not clear how to separate it from the hotel.  But to divide the hotel and the device is, in fact, very simple - DDD will help.  First of all, you need to figure out where the boundaries of the domain areas and where the boundaries of the entities responsible for the consistency of the system. <br><br><h6>  <b>Bounded context (BC)</b> </h6><br>  Bounded context (isolated subdomain) - in fact, sets of objects that are independent of each other and have completely independent models (different).  In the example, we can take and pull apart hotels and devices on two different BCs - they are not interconnected, but there is duplication.  There is an additional entity (AttachedDevice): <br><br><img src="https://habrastorage.org/files/0b0/7f1/17b/0b07f117bac7441d8618432531d8d2cc.png"><br><br>  Here we have different representations of the same device, and there is nothing to worry about. <br><br>  In DDD, aggregate route is an entity that owns all descendants.  This is the top of our tree (Hotel);  something for which you can pull out everything else.  You can't take an AttachedDevice like this - it doesn't exist, and it doesn't make any sense.  Likewise, the Room and Reservation classes make no sense being separated from the Hotel.  Therefore, access to all these classes is exclusively through the root nature, through the Hotel, in this case.  Device is another route from the very beginning, another tree with a different set of fields. <br><br>  So, if you understand that one entity is playing in two different domains, just cut it - and this will be just a projection of the master entity.  In AttachedDevice there will be, for example, fields with a room number, while in Device such fields are not needed. <br><br>  Here are some <b>examples of queries</b> , how they might look in such a domain model: <br><br><ul><li>  PUT / hotels / 555 / rooms / 105 / attachedDevices ‚Äî replace the entire collection of attached devices with a new one. </li><li>  POST / hotels / 555 / rooms / 105 / attachedDevices - attach another device. </li><li>  DELETE / hotels / 12 - delete hotel description with ID = 12. </li><li>  POST / hotels / 123 / reservations - create a new reservation at the hotel ID = 123. </li></ul><br><br><h6>  <b>CQRS - Command Query Responsibility Segregation</b> </h6><br><br>  I will not talk about architecture now, but I want to briefly describe what its principle of operation is.  The CQRS architecture is based on the separation of data streams. <br><br><img src="https://habrastorage.org/files/68c/9ae/814/68c9ae81408147a5ac38b5972e980b26.png"><br><br>  We have one stream through which the user sends to the server a command to change the domain.  However, it‚Äôs not a fact that the change will really happen - the user does not operate on data directly.  So, after the user sends a command to change the entity, the server processes it and puts it into some model that is optimized for reading - the UI reads this. <br><br>  This approach will allow you to follow the principles of REST very easily.  If there is a command, then there is an entity ‚Äúlist of commands‚Äù. <br><br><h6>  <b>REST without PUT</b> </h6><br>  In the simple CRUD world, PUT is the thing that changes objects.  But if we strictly follow the principle of CQRS and do everything through commands, the PUT is lost, because we cannot change objects.  Instead, we can only send a change command to the object.  At the same time, you can monitor the execution status, cancel commands (DELETE), store changes history easily, and the user does not change anything, but simply reports intentions. <br><br>  The REST without PUT paradigm is still controversial and not fully tested, but for some cases it is really well applicable. <br><br><h6>  <b>Fine-grained VS coarse-grained</b> </h6><br>  Imagine that you are doing a great service, a big object.  Here you have two approaches: the fine-grained API and the coarse-grained API ("fine-grained" and "coarse-grained" API). <br><br>  Fine-grained API: <br><ul><li>  Many small objects. </li><li>  Business logic goes to the client. </li><li>  Need to know how objects are connected. </li></ul><br><br>  Coarse-grained API: <br><br><ul><li>  Create more entities. </li><li>  Difficult to make local changes, for example <br><ul><li>  POST / blogs / {id} / likes. </li></ul><br></li><li>  It is necessary to track the status on the client. </li><li>  Large objects cannot be partially saved. </li></ul><br><br>  For a start, I advise you to design a fine-grained API: every time you create an object, send it to the server.  For each action on the client side, a call is made to the server.  However, it is easier to work with small entities than with large ones: if you write a large entity, it will be difficult for you to cut it later, it will be difficult to make small changes and pull out independent pieces from it.  T. h. It is better to start with small entities and gradually enlarge them. <br><br><h6>  <b>Version Numbering</b> </h6><br>  It so happened that the contracts in our industry are very relaxed.  For some reason, people think that if they took and made an API, this is their API, with which they can do anything.  But it is not.  If you once wrote an API and gave it to at least one counterparty, all is version 1.0.  Any changes should now lead to a version change.  After all, people will bind their code to the version that you gave them. <br><br>  On the past, the project had to roll back the API several times simply because it was given to the client - we changed the error codes, but the client had already managed to get used to the old codes. <br><br>  What are the currently known options for numbering versions of the Web API? <br><br><img src="https://habrastorage.org/files/9e9/e1e/b7b/9e9e1eb7bfad465a960513dc51fb485f.png"><br><br>  The simplest is to specify the version in the URL. <br><br>  Here are the ready options when you don‚Äôt have to do anything yourself: <br><br><ul><li>  <a href="http://aspnet.codeplex.com/SourceControl/latest">aspnet.codeplex.com/SourceControl/latest#Samples/WebApi/NamespaceControllerSelector</a> </li><li>  <a href="http://aspnet.codeplex.com/SourceControl/latest">aspnet.codeplex.com/SourceControl/latest#Samples/WebApi/RoutingConstraintsSample</a> </li><li>  <a href="http://www.strathweb.com/2015/10/global-route-prefixes-with-attribute-routing-in-asp-net-web-api/">www.strathweb.com/2015/10/global-route-prefixes-with-attribute-routing-in-asp-net-web-api</a> </li><li>  <a href="http">github.com/climax-media/climax-web-http</a> </li></ul><br><br>  <b><a href="http">Climax.Web.Http library</a></b> <br><br>  Here is one interesting finished option. <br><br>  This is just routing attributes with constraint - if you did any serious objects, you probably did constraint.  By the version number in this attribute, the guys just implemented constraint.  Accordingly, one and the same attribute with different versions, but with the same controller name, you hang on two different classes and specify different versions.  Everything works out of the box ... <br><br><pre> <code class="cs hljs">VersionedRoute(<span class="hljs-string"><span class="hljs-string">"v2/values"</span></span>, Version = <span class="hljs-number"><span class="hljs-number">2</span></span>)]&lt;br&gt; &lt;br&gt; config.ConfigureVersioning(&lt;br&gt;            versioningHeaderName: <span class="hljs-string"><span class="hljs-string">"version"</span></span>, vesioningMediaTypes: <span class="hljs-literal"><span class="hljs-literal">null</span></span>);&lt;br&gt; &lt;br&gt; config.ConfigureVersioning(&lt;br&gt;            versioningHeaderName: <span class="hljs-literal"><span class="hljs-literal">null</span></span>,           &lt;br&gt;            vesioningMediaTypes: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> [] { <span class="hljs-string"><span class="hljs-string">"application/vnd.model"</span></span>});&lt;source lang=<span class="hljs-string"><span class="hljs-string">"cs"</span></span>&gt; &lt;h6&gt;&lt;b&gt;&lt;/b&gt;&lt;/h6&gt;   open-source-,     - Swagger.       ‚Äî Swashbuckle. &lt;ul&gt; &lt;li&gt;http:<span class="hljs-comment"><span class="hljs-comment">//swagger.io/ &lt;/li&gt; &lt;li&gt;https://github.com/domaindrivendev/Swashbuckle&lt;/li&gt; &lt;/ul&gt; Swashbuckle: &lt;source lang="cs"&gt;httpConfiguration .EnableSwagger(c =&gt; c.SingleApiVersion("v1", ‚ÄùDemo API")) .EnableSwaggerUi(); public static void RegisterSwagger(this HttpConfiguration config) { config.EnableSwagger(c =&gt; { c.SingleApiVersion("v1", "DotNextRZD.PublicAPI") .Description("DotNextRZD Public API") .TermsOfService("Terms and conditions") .Contact(cc =&gt; cc .Name("Vyacheslav Mikhaylov") .Url("http://www.dotnextrzd.com") .Email("vmikhaylov@dataart.com")) .License(lc =&gt; lc.Name("License").Url("http://tempuri.org/license")); c.IncludeXmlComme nts(GetXmlCommentFile()); c.GroupActionsBy(GetControllerGroupingKey); c.OrderActionGroupsBy(new CustomActionNameComparer()); c.CustomProvider(p =&gt; new CustomSwaggerProvider(config, p)); }) .EnableSwaggerUi( c =&gt; { c.InjectStylesheet(Assembly.GetExecutingAssembly(), "DotNextRZD.PublicApi.Swagger.Styles.SwaggerCustom.css"); }); } }</span></span></code> </pre><br><br>  As you can see, Swagger pulled out all that we have, pulled out XML comments. <br><br><img src="https://habrastorage.org/files/e90/777/4fa/e907774faec544d88a0c2fa873ecb30a.png"><br><br>  Below is a complete description of the GET model.  If you click on a button, it will actually execute it and return the result. <br><br><img src="https://habrastorage.org/files/1d0/138/6de/1d01386dede14fa3b8ac151ddcc55ec9.png"><br><br>  And here is the POST documentation, the first part: <br><br><img src="https://habrastorage.org/files/407/b64/747/407b64747d3d4d398d5b649a5eda4654.png"><br><br>  Here is the second part: <br><br><img src="https://habrastorage.org/files/f69/1a2/941/f691a294111945328a4a29e83481bd25.png"><br><br>  Everything that was written in the XML comments is here. <br><br><h5>  <b>Sources</b> </h5><br><br><ul><li>  <a href="http://www.vinaysahni.com/best-practices-for-a-pragmatic-restful-api">www.vinaysahni.com/best-practices-for-a-pragmatic-restful-api</a> </li><li>  <a href="http://www.strathweb.com/2015/10/global-route-prefixes-with-attribute-routing-in-asp-net-web-api/">www.strathweb.com/2015/10/global-route-prefixes-with-attribute-routing-in-asp-net-web-api</a> </li><li>  <a href="https://www.thoughtworks.com/insights/blog/rest-api-design-resource-modeling">www.thoughtworks.com/insights/blog/rest-api-design-resource-modeling</a> </li><li>  <a href="https://jacobian.org/writing/rest-worst-practices/">jacobian.org/writing/rest-worst-practices</a> </li><li>  <a href="http://piwik.org/blog/2008/01/how-to-design-an-api-best-practises-concepts-technical-aspects/">piwik.org/blog/2008/01/how-to-design-an-api-best-practises-concepts-technical-aspects</a> </li><li>  <a href="http://www.toptal.com/api-developers/5-golden-rules-for-designing-a-great-web-api">www.toptal.com/api-developers/5-golden-rules-for-designing-a-great-web-api</a> </li><li>  <a href="http://www.odata.org/">www.odata.org</a> </li><li>  <a href="http://owin.org/">owin.org</a> </li><li>  <a href="http://pietschsoft.com/post/2014/06/15/cqrs-command-query-responsibility-segregation-design-pattern">pietschsoft.com/post/2014/06/15/cqrs-command-query-responsibility-segregation-design-pattern</a> </li><li>  <a href="https://blog.pivotal.io/pivotal-labs/labs/api-versioning">blog.pivotal.io/pivotal-labs/labs/api-versioning</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/277419/">https://habr.com/ru/post/277419/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../277407/index.html">Evaluation and optimization of computing performance on multi-core systems</a></li>
<li><a href="../277411/index.html">I have an idea: Android data protection with eCryptfs</a></li>
<li><a href="../277413/index.html">Creating ontology in Prot√©g√© 5.0</a></li>
<li><a href="../277415/index.html">Welcome to the ice rink</a></li>
<li><a href="../277417/index.html">Introducing ReactOS 0.4</a></li>
<li><a href="../277421/index.html">From actions on matrices to understanding their essence ...</a></li>
<li><a href="../277423/index.html">Connecting SQLite to an iOS mobile app via FMDB on Xcode using Swift</a></li>
<li><a href="../277425/index.html">Symantec Backup Exec: Recover Oracle installed on Linux</a></li>
<li><a href="../277427/index.html">Specialization in machine learning on Coursera from PhyTech and Yandex</a></li>
<li><a href="../277429/index.html">You never finish your game</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>