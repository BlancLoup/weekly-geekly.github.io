<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Can I rely on data retrieved by the WMI classes?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Using the example of several WMI classes Win32_xxxx, it is shown that at least some of the object properties returned by the specified classes do not ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Can I rely on data retrieved by the WMI classes?</h1><div class="post__text post__text-html js-mediator-article">  <i>Using the example of several WMI classes Win32_xxxx, it is shown that at least some of the object properties returned by the specified classes do not correspond at all to the real values ‚Äã‚Äãof these properties.</i> <br><a name="habracut"></a><br>  Below are examples of WMI classes issuing Win32_CDROMDrive, Win32_DiskDrive, Win32_DiskPartition, Win32_LogicalDisk, Win32_Volume and demonstrate that the output is, to put it mildly, not true or is issued in a very inconvenient format or simply omitted.  The program ScriptomaticV2.hta, developed by the ‚ÄúScripting Guy‚Äù development team from Microsoft, is used as a stand for performing WQL queries to WMI classes.  ScriptomaticV2.hta supports VBS, JS, Perl, Python.  Due to the absence of the latter two, only the outputs of JS and VBS were used.  Therefore, I apologize in advance to the developers of the mentioned WMI classes if Perl and / or Python provide the correct information.  In addition, I hope that using the same WMI classes in C #, C ++ programs ensures that results are output correctly. <br><br>  1. <b>Invalid or omitted date of creation or mounting of an object.</b> <br><br>  All the classes listed above in the property list contain a property called ‚ÄúInstallDate‚Äù.  This property in the Windows Registry corresponds to REG_QWORD.  On Windows 8.1+ (8.1 and all Windows 10 builds) CDROMDrive, DiskDrive, this value is stored in the InitialTimeStamp addressable 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      HKLM \ SYSTEM \ CurrentControlSet \ Enum \ SCSI \ \ Device Parameters \ StorPort <br><br>  The InitialTimeStamp value MAY take a NULL value, but in most cases it contains a very real date in a format that is beautifully described in the Microsoft documentation: <br><br>  <i>‚ÄúUnique value that indicates the time when an event is generated.</i> <i><br></i>  <i>This is a 64-bit FILETIME value that represents the number of 100-nanosecond intervals after January 1, 1601. This information is in the Coordinated Universal Time (UTC) format.</i>  <i>This property is inherited from __Event.</i>  <i>SetFileTime and GetFileTime. ‚Äù</i> <br><br>  Apparently the developers of the Win32-WMI classes did not want to use SWbemDateTime methods, and therefore issuing the JS code in the InstallDate field always substitutes null date, issuing a VBS code ‚Äî this field is modestly omitted.  But after all, no methods are needed to convert a 64-bit QWORD number of the above format into a number representing the date in milliseconds, on the basis of which you can create a Date object.  This will require elementary arithmetic. <br><br>  2. <b>Conflicting data, error in the InterfaceType field, Win32_DiskDrive</b> <br><br>  Index: 0 <br>  InstallDate: null date <i>should be Sun Jul 19 08:12:08 UTC + 0300 2015</i> <br>  InterfaceType: IDE <br>  ... <br>  Model: ST9320423AS <br>  Name: \\. \ PHYSICALDRIVE0 <br>  ... <br>  PNPDeviceID: SCSI \ DISK &amp; VEN_ &amp; PROD_ST9320423AS \ 4 &amp; 3516B3B5 &amp; 0 &amp; 000000 <br><br>  Someone can give a reasonable explanation for the InterfaceType field value, which directly contradicts the PNPDeviceID listed below and the fact that since Windows 8.1, HKLM \ SYSTEM \ CurrentControlSet \ Enum \ IDE is completely missing from Windows 8.1 and last time it was present only in Windows 7 ? <br><br>  3. <b>Negative values ‚Äã‚Äãin the fields SerialNumber, Signature by the classes Win32_DiskDrive, Win32_Volume</b> <br><br>  SerialNumber: Hitachi HT100219FCC400NEJTBU5G <br>  Signature: -1498719820 <br>  ... <br>  Purpose: null <br>  QuotasEnabled: false <br>  QuotasIncomplete: false <br>  QuotasRebuilding: false <br>  SerialNumber: -1408044882 <br><br>  This is generally the favorite "chip", the issuance of very important information in a completely indigestible format.  Both SerialNumber and Signature are all used to reading in the 16th form. <br><br>  4. <b>Incorrect partition indexing for Gpt-formatted disks, Win32_DiskPartition class</b> <br><br>  Caption: Disk # 3, Partition # 0 <br>  ... <br>  Description: GPT: Basic Data <br><br>  Well, explain to me, the Gpt-formatted partition of the type ‚ÄúBasic Data‚Äù has acquired the index 0, which rightfully belongs to the MSR-section?  Naturally, the MSR-section of the Win32_DiskPartition in the list of sections is generally coldly ignored. <br><br>  5. <b>Presence of fields containing NULL for JS or empty for VBS for all objects in a WQL query</b> <br><br>  As an example, I can give the values ‚Äã‚Äãof the Access and Description properties for the Win32_Volume class.  I have 9 mounted devices, including two internal disks, a pair of virtual DVD-ROMs, several VHDs with Gpt-formatted partitions, a USB disk, an SD card and a flash drive, 16 volumes are located and all of them contain the specified fields or NULL for JS -discharge or empty for VBS-issue.  The question is what should be the device on which the device is located so that for him at least one of the specified properties would be significant?  And if this can not be, then why bother to include these properties in the output? <br>  I decided to check with PS and ‚Äúgwmi win32_volume‚Äù for all the volumes I gave out empty values ‚Äã‚Äãfor the Access, Description properties. <br><br>  <b>Conclusion</b> <br><br>  The main point of this short, perhaps overly emotional publication is to attract the attention of all those who use WMI classes in their code, critically evaluate the extracted data, recheck them from other sources.  Immediately I will add that MSFT-classes, similar to the Win32-classes described above, always give out correct information, although they also sin by issuing negative numbers in the Signature fields. </div><p>Source: <a href="https://habr.com/ru/post/264717/">https://habr.com/ru/post/264717/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../264701/index.html">Work with Zip and 7z archives</a></li>
<li><a href="../264705/index.html">Glitches when drawing border-radius in Windows 10</a></li>
<li><a href="../264707/index.html">Writing a Telegram bot in Ruby in 10 lines</a></li>
<li><a href="../264709/index.html">Preparing for publication post with formulas</a></li>
<li><a href="../264713/index.html">Microsoft released a set of updates for its products, August 2015</a></li>
<li><a href="../264719/index.html">jQuery Video Extend - extending the capabilities of HTML5 video player</a></li>
<li><a href="../264723/index.html">Cryptocurrency developers - who are they? [Interview]</a></li>
<li><a href="../264725/index.html">ReactPHP speeds up PHPixie 8 times</a></li>
<li><a href="../264727/index.html">Security Week 33: Doors Without Locks, Microsoft Invulnerability, Disassembler and Pain</a></li>
<li><a href="../264731/index.html">Systemd logging control</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>