<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Updating Windows Phone Silverlight 8.0 application to Windows Phone Silverlight 8.1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue the series of articles on updating Windows Phone 8.0 applications to version 8.1. Today we will look at the new features of Silverlight 8....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Updating Windows Phone Silverlight 8.0 application to Windows Phone Silverlight 8.1</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/d41/554/608/d41554608fffc3c0808a9b4ce685dc6c.png"><br>  We continue the series of articles on updating Windows Phone 8.0 applications to version 8.1.  Today we will look at the new features of Silverlight 8.1 and the process of upgrading Windows Phone Silverlight 8.0 applications to version 8.1. <br><a name="habracut"></a><br><h5>  Short review </h5><br>  The new version of Windows Phone Silverlight 8.1 provides mobile application developers with access to the features of Windows Phone 8.1 <a href="http://msdn.microsoft.com/ru-ru/library/windows/apps/dn632424.aspx">WinRT</a> without significantly changing the code of an existing Silverlight application. <br><br>  Silverlight 8.1 is a continuation of technology for Silverlight developers. <br><br>  Upgrading an application to Silverlight 8.1 is very simple using the built-in tool in Visual Studio 2013: <br><img src="https://habrastorage.org/getpro/habr/post_images/907/bbe/e5f/907bbee5fe23948982be62e92f576193.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It should be noted that Silverlight 8.1 applications work only on Windows Phone 8.1 devices.  If you want to keep the application running on previous versions of the operating system, it is recommended that the store also distribute the old version of the application to Silverlight 8.0. <br><br>  If you are just starting to develop for Windows Phone and would like to have a version of the application for the PC, then it is recommended to start development on the new Windows Phone 8.1 ( <a href="http://msdn.microsoft.com/ru-ru/library/windows/apps/dn632424.aspx">WinRT</a> or <a href="http://msdn.microsoft.com/ru-ru/library/windows/apps/dn632432.aspx">WinJS</a> ), which provide the possibility of creating <a href="http://habrahabr.ru/company/microsoft/blog/218441/">universal applications</a> for phones, tablets and PCs.  Unfortunately, the application on Silverlight 8.1 cannot be expanded to universal. <br><br>  How to choose the right technology to develop your mobile application, you can read <a href="http://msdn.microsoft.com/ru-ru/library/windowsphone/develop/dn655121(v%3Dvs.105).aspx">here</a> . <br><br><h5>  New features of Windows Phone Silverlight 8.1 </h5><br>  Many of the tools and APIs available for Silverlight 8.0 applications will also be available for Silverlight 8.1.  Some differences in usage are described in the following <a href="http://msdn.microsoft.com/ru-ru/library/windowsphone/develop/dn642084(v%3Dvs.105).aspx">article</a> . <br><br>  Below are some of the new features available for Silverlight 8.1 applications: <br><ul><li>  API extension, i.e.  in addition to the WinRT APIs available in Silverlight 8.0, when upgrading to Silverlight 8.1, XAML 8.1 WinRT APIs will also be available; </li><li>  Bonuses for graphics, text, etc.  with D2D / DWrite / WIC / ...; </li><li>  An application on Silverlight 8.1, if necessary, will be able to act as a photo provider; </li><li>  Updated "seamless" integration of VoIP service for audio-video calls over the Internet; </li></ul><br>  Features available only for Windows Phone 8.1 applications, but also supported for Silverlight 8.1 applications: <br><ul><li>  New tools for testing the application; </li><li>  Work with files; </li><li>  Expanded storage, backup, data recovery; </li><li>  SD card support; </li><li>  Sharing data between applications; </li><li>  Tiles, event indicators, Push notifications using the new Windows Push Notification Service (WNS); </li><li>  Performing tasks and transferring data in the background; </li><li>  Creation of network applications and the possibility of unified authorization on different services for users, using the new ability to store user authentication data; </li><li>  Support Bluetooth and WiFi Direct services, device discovery; </li><li>  Update NFC payment tools; </li><li>  Intellectual input panel; </li><li>  Sending letters and attachments; </li><li>  Access to contacts and calendar; </li><li>  Position sensors devices in space; </li><li>  Geographical location and geolocation; </li><li>  Possibilities of working with photo, video, audio materials, saving, editing media content; </li></ul><br>  A more detailed list and information about new features in Silverlight 8.1 is located on <a href="http://msdn.microsoft.com/ru-ru/library/windowsphone/develop/dn642080(v%3Dvs.105).aspx">MSDN</a> . <br><br><h5>  How to upgrade from Windows Phone Silverlight 8.0 to Silverlight 8.1 </h5><br>  Consider the process of upgrading a Windows Phone application Silverlight 8.0 to 8.1 in the following example.  Take the content application - "Cooking book."  It sorts recipes by country, each recipe consists of several pages: description, ingredients, photos.  The application, in addition to displaying recipes, allows you to add photos of your own dishes and fix your favorite recipe on the phone's start screen. <br><br>  What you need to develop: <br><ul><li>  <a href="http://windows.microsoft.com/ru-ru/windows/home">Windows Phone 8.1 operating system</a> </li><li>  <a href="http://www.visualstudio.com/ru-ru/downloads/download-visual-studio-vs">Microsoft Visual Studio 2013</a> Update 2; </li><li>  Windows Phone Silverlight 8.0 application. </li></ul><br>  The process of upgrading Silverlight 8.0 applications to 8.1: <br><ol><li>  Do not forget to backup the ported application; </li><li>  Open the solution (.sln extension file) in Visual Studio 2013; </li><li>  Right-click the context menu: <br><img src="https://habrastorage.org/getpro/habr/post_images/4ac/b67/d23/4acb67d23ff0d572e23048aef1e34b39.png"></li><li>  Next, click Yes: <br><img src="https://habrastorage.org/getpro/habr/post_images/2cc/835/79e/2cc83579e6b6bd50db827aa911b53880.png"></li><li>  We get the solution in the Windows Phone Silverlight 8.1 browser: <br><img src="https://habrastorage.org/getpro/habr/post_images/86d/95a/fd4/86d95afd48f9a3fc1205b7f2e46f336b.png"></li></ol><br>  The main icon is in place, but it looks like the images now require much more for comfortable work of the updated application. <br><br>  Learn more about the requirements for Windows Phone Silverlight 8.1 application images written in this <a href="http://msdn.microsoft.com/ru-ru/library/windowsphone/design/jj662929.aspx">article</a> . <br><br>  We solve this problem simply by creating the necessary images and placing them in the Assets folder of the current application: <br><img src="https://habrastorage.org/getpro/habr/post_images/169/01e/de7/16901ede732d1b3d6d8de8a4295ce48b.png"><br><br><h5>  Testing a ported Windows Phone application Silverlight 8.1 </h5><br>  Run the emulator and open the application: <br><ul><li>  List of countries - List of recipes for each country - Recipe: <br><img src="https://habrastorage.org/getpro/habr/post_images/713/415/f3e/713415f3e6ee2405f0ccaef0c1468909.png"></li><li>  We simulate the situation of switching to another application from the current recipe, for example, to ‚ÄúMessages‚Äù: <br><img src="https://habrastorage.org/getpro/habr/post_images/986/16e/3cf/98616e3cfef9d80be879060b676220ef.png"></li><li>  We return to the application through the menu: <br><img src="https://habrastorage.org/getpro/habr/post_images/e1b/ae7/229/e1bae7229104a0864867db3a8f90cd66.png"></li><li>  We get an error in the behavior of the application. </li></ul><br>  The application did not open a new copy of the previously launched application, as it did in Silverlight 8.0, in the case of c returning to work with the application the following happened: the screen blinked, the application threw the user onto the start page and stopped displaying any data, and the current copy of the application was expected to start where it was interrupted. <br><br>  This behavior is associated with a change in the life cycle of a Windows Phone application.  Let's try to fix it. <br><br><h5>  Fix bugs in the ported application </h5><br><ol><li>  In the solution browser open the app.xaml.cs file: <br><img src="https://habrastorage.org/getpro/habr/post_images/a13/416/0d3/a134160d387855431eb869869e9e10db.png"><br><br>  Check the FAR - Fast app resume (quick resume) feature that allows you to open the copy of the application that is in memory. <br><br>  Here in the Phone Application Initialization area we see that the template FAR processing code is available and everything should work correctly: <br><pre><code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> Phone application initialization // Avoid double-initialization private bool phoneApplicationInitialized = false; // Do not add any additional code to this method private void InitializePhoneApplication() { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (phoneApplicationInitialized) return; // Create the frame but don't set it as RootVisual yet; this allows the splash // screen to remain active until the application is ready to render. RootFrame = new TransitionFrame(); RootFrame.Navigated += CompleteInitializePhoneApplication; // Handle navigation failures RootFrame.NavigationFailed += RootFrame_NavigationFailed; // Handle reset requests for clearing the backstack RootFrame.Navigated += CheckForResetNavigation; // Ensure we don't initialize again phoneApplicationInitialized = true; } // Do not add any additional code to this method private void CompleteInitializePhoneApplication(object sender, NavigationEventArgs e) { // Set the root visual to allow the application to render </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (RootVisual != RootFrame) RootVisual = RootFrame; // Remove this handler since it is no longer needed RootFrame.Navigated -= CompleteInitializePhoneApplication; } private void CheckForResetNavigation(object sender, NavigationEventArgs e) { // If the app has received a 'reset' navigation, then we need to check // on the next navigation to see </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> the page stack should be reset </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (e.NavigationMode == NavigationMode.Reset) RootFrame.Navigated += ClearBackStackAfterReset; } private void ClearBackStackAfterReset(object sender, NavigationEventArgs e) { // Unregister the event so it doesn't get called again RootFrame.Navigated -= ClearBackStackAfterReset; // Only clear the stack for 'new' (forward) and 'refresh' navigations </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (e.NavigationMode != NavigationMode.New &amp;&amp; e.NavigationMode != NavigationMode.Refresh) return; // For UI consistency, clear the entire page stack while (RootFrame.RemoveBackEntry() != null) { ; // do nothing } } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span></span></code> </pre> <br>  Let's check what is happening with the display of data. </li><li>  Open MainPage.xaml.cs and observe the following: <br>  In the OnNavigatedTo method, the condition is checked whether the list of recipes is loaded now: <br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNavigatedTo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">‚Ä¶</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!App.Recipes.IsLoaded) { pi = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Microsoft.Phone.Shell.ProgressIndicator(); pi.IsIndeterminate = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; pi.Text = <span class="hljs-string"><span class="hljs-string">"Loading data, please wait..."</span></span>; pi.IsVisible = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; Microsoft.Phone.Shell.SystemTray.SetIsVisible(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); Microsoft.Phone.Shell.SystemTray.SetProgressIndicator(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, pi); App.Recipes.RecipesLoaded += Recipes_RecipesLoaded; App.Recipes.LoadLocalDataAsync(); } <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnNavigatedTo(e); }</code> </pre><br>  When you call the same application again, the method determines the list of recipes as already loaded and does not perform the actions specified by this condition. <br>  Add an alternative treatment condition: <br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.NavigationMode == NavigationMode.New) { lstGroups.DataContext = App.Recipes; }</code> </pre><br>  Check to make sure everything works correctly. </li><li>  Errors were discovered when opening files responsible for the application interface. <br>  Open any file, for example MainPage.xaml, and we get the lack of displaying elements in the designer: <br><img src="https://habrastorage.org/getpro/habr/post_images/c1d/7e3/34b/c1d7e334bf0a73f4c1a67ea00b9efb55.png"><br><br>  To solve the problem with the form designer, you need to pay attention to the following error: <br>  <b>The member "Instance" is not accessible.</b> <br>  Error means that the property is no longer supported. <br><br>  Further in the text of the file we find the line: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"LayoutRoot"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Transparent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">d:DataContext</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{d:DesignData /SampleData/RecipeDataSourceSampleData.xaml, Instance={x:Null}}"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  We bring it to this form: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"LayoutRoot"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Transparent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">d:DataContext</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{d:DesignData /SampleData/RecipeDataSourceSampleData.xaml}"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  The visual designer is fine: <br><img src="https://habrastorage.org/getpro/habr/post_images/647/bc9/fe7/647bc9fe72d24e90ae0f1dc6d4860a1a.png"></li></ol><br>  Also, the compiler reports errors related to the toolkit items: <br><img src="https://habrastorage.org/getpro/habr/post_images/a26/178/5bd/a261785bd119ba47e514187cf414416e.png"><br><br>  The new WinRT platform includes both old controls and many new ones.  Therefore, the Windows Phone Toolkit library is no longer needed for mobile applications.  Comment out or replace them with new ones. <br><br>  Please note when updating the application for differences in the namespace and classes. <br><br>  For example, in this application, the ListView class was used, which no longer exists in Windows Phone Silverlight 8.1 and in the application we replaced it with ListBox. <br>  The LongListSelector class is also no longer supported, and we use the option of replacing it: <br>  It was: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phone:LongListSelector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"IngredientsListBox"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ItemsSource</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Ingredients}"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre><br>  It became: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ListBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"IngredientsListBox"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ItemsSource</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Ingredients}"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"12,0,0,0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Mode=OneWay}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0,0,0,12"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ListBox</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br><h5>  Adding new features </h5><br>  One of the new features for Silverlight 8.1 is the ability to share data with other applications, including images. <br><br>  Our application can create and store photos of a cooked dish, try to teach it to ‚Äúshare‚Äù using the new API features: <br><ol><li>  In the Solution Explorer, open the RecipeDetailPage.xaml file: <br><img src="https://habrastorage.org/getpro/habr/post_images/a2f/e56/54d/a2fe5654de1e3f3a93aafd7b4a6f23a3.png"><br></li><li>  For the Application Bar element, add a new ‚ÄúShare‚Äù button: <br><ul><li>  Using the Properties window (Properties) for ApplicationBar, find the Buttons button collection, add the AppBarButton button, select the standard icon icon = share.png and specify its text = ‚Äùshare‚Äù name: <br><img src="https://habrastorage.org/getpro/habr/post_images/a8f/8b5/982/a8f8b59822b618bcf341cfbdbb1b9e77.png"></li><li>  Create and write a handler for the Share button: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShareButton_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, EventArgs e</span></span></span><span class="hljs-function">)&lt;/li&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item.UserImages == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || item.UserImages.Count == <span class="hljs-number"><span class="hljs-number">0</span></span>) { MessageBox.Show(<span class="hljs-string"><span class="hljs-string">"You must take a picture first!"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { DataTransferManager.ShowShareUI(); } }</code> </pre></li></ul><br></li><li>  In the OnNavigatedTo method, add a DataRequested event: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNavigatedTo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">NavigationEventArgs e</span></span></span><span class="hljs-function">)</span></span> { ... DataTransferManager.GetForCurrentView().DataRequested += RecipeDetailPage_DataRequested; <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnNavigatedTo(e); }</code> </pre><br>  Create a function to handle this event: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RecipeDetailPage_DataRequested</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DataTransferManager sender, DataRequestedEventArgs args</span></span></span><span class="hljs-function">)</span></span></code> </pre></li><li>  Create and override the OnNavigatedFrom method: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNavigatedFrom</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">NavigationEventArgs e</span></span></span><span class="hljs-function">)</span></span> { DataTransferManager.GetForCurrentView().DataRequested -= RecipeDetailPage_DataRequested; }</code> </pre></li><li>  Add the code to the RecipeDetailPage_DataRequested function to handle the DataRequested event: <br><pre> <code class="cs hljs">{ DataRequest request = args.Request; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> deferral = args.Request.GetDeferral(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Uri photoFileUri = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(<span class="hljs-string"><span class="hljs-string">"ms-appdata:///local/"</span></span> + item.UserImages[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> photoFile = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> StorageFile.GetFileFromApplicationUriAsync(photoFileUri); request.Data.Properties.Title = <span class="hljs-string"><span class="hljs-string">"I've been baking!"</span></span>; request.Data.Properties.Description = <span class="hljs-string"><span class="hljs-string">"This was my attempt at making "</span></span> + item.ShortTitle; <span class="hljs-comment"><span class="hljs-comment">// It's recommended to use both SetBitmap and SetStorageItems for sharing a single image // since the target app may only support one or the other. List&lt;IStorageItem&gt; imageItems = new List&lt;IStorageItem&gt;(); imageItems.Add(photoFile); request.Data.SetStorageItems(imageItems); RandomAccessStreamReference imageStreamRef = RandomAccessStreamReference.CreateFromFile(photoFile); // It is recommended that you always add a thumbnail image any time you're sharing an image request.Data.Properties.Thumbnail = imageStreamRef; request.Data.SetBitmap(imageStreamRef); // Set Text to share for those targets that can't accept images request.Data.SetText("I just made " + item.ShortTitle + " from Contoso Cookbook!"); } finally { deferral.Complete(); }</span></span></code> </pre><br>  In order for the code to use all the functions used, let's connect: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Windows.ApplicationModel.DataTransfer; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Windows.Storage; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Windows.Storage.Streams;</code> </pre><br></li><li>  We check our innovations.  Open the application.  We reproduce the process of creating a photo and press the "Share" button: <br><img src="https://habrastorage.org/getpro/habr/post_images/759/a3e/65b/759a3e65b4eb85604a43747fe6b45707.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/b54/6b5/80a/b546b580a0262b90509123a353f003f2.png"><br>  Open services in which you can share a photo. </li></ol><br><h5>  Conclusion </h5><br>  Silverlight 8.1 is not only a continuation of the previous version of Silverlight 8.0, but also combines new features offered by Windows Phone 8.1 technology and WinRT.  And the transition to Silverlight 8.1 from applications of the previous version is not a long and laborious process. <br><br><h5>  useful links </h5><br>  <a href="http://habrahabr.ru/company/microsoft/blog/229727/">New Windows Phone 8.1.</a>  <a href="http://habrahabr.ru/company/microsoft/blog/229727/">What should an application developer do?</a> <br>  <a href="http://habrahabr.ru/company/microsoft/blog/229931/">Update Windows Phone 8.0 application to Windows Phone 8.1 (XAML)</a> <br>  <a href="http://habrahabr.ru/company/microsoft/blog/230303/">We turn the Windows Store application into a universal</a> <br>  <a href="http://channel9.msdn.com/Series/Building-Apps-for-Windows-Phone-8-1">Tutorial: Building Apps for windows Phone 8.1</a> <br>  <a href="http://msdn.microsoft.com/ru-ru/library/windowsphone/develop/dn642080(v%3Dvs.105).aspx">MSDN Library: Supported features for Windows Phone Silverlight 8.1 apps</a> <br>  <a href="http://www.microsoftvirtualacademy.com/">Microsoft Virtual Academy (MVA) Training Courses</a> <br>  <a href="http://aka.ms/getvsrus">Download free or trial Visual Studio 2013</a> <br>  <a href="http://aka.ms/wpstartrus">Become a Windows Phone Application Developer</a> <br>  <a href="http://1drv.ms/1zEX11P">Download the sample application on Silverlight 8.1 from this article.</a> <br>  <a href="http://code.msdn.microsoft.com/wpapps/Windows-Phone-81-samples-08631ca7">Download code samples with basic features of Windows Phone 8.1 (c #, c ++, javascript)</a> </div><p>Source: <a href="https://habr.com/ru/post/230015/">https://habr.com/ru/post/230015/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../230001/index.html">Attracting investment in a startup - the book of Feld and Mendelssohn</a></li>
<li><a href="../230003/index.html">Syndrome of a step and a cut of attendance of Habr</a></li>
<li><a href="../230007/index.html">Hackathon @ JetBrains 2014</a></li>
<li><a href="../230009/index.html">Hedgehog in fractal fog</a></li>
<li><a href="../230011/index.html">Mobile phone-based air pollution detector: developed from Germany</a></li>
<li><a href="../230019/index.html">How to prepare for a technical report</a></li>
<li><a href="../230021/index.html">InfoboxCloud - a public Russian ‚Äúcloud‚Äù in a data center that has received TIER III Facility & Design certification</a></li>
<li><a href="../230023/index.html">Effective personalized access to network infrastructure. An example implementation from HP</a></li>
<li><a href="../230027/index.html">MediaTek MT6795 chipset released: ‚Äúfirst‚Äù, ‚Äúeight-core‚Äù, ‚Äú64-bit‚Äù</a></li>
<li><a href="../230029/index.html">Google Noto: free fonts for all languages ‚Äã‚Äãof the world</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>