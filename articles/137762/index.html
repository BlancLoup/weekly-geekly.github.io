<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>3D Rose by Monte Carlo</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, Roman Cortes hopes to inspire readers interested in computer graphics to experiment and have fun with various visualization technique...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>3D Rose by Monte Carlo</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://js1k.com/2012-love/demo/1022"><img src="https://habrastorage.org/storage2/475/bec/e40/475bece40b41675d1d8e9472cdbfe8b2.jpg"></a> <br><br>  In this article, Roman Cortes hopes to inspire readers interested in computer graphics to experiment and have fun with various visualization techniques. <br><br>  <a href="http://www.romancortes.com/blog/1k-rose/">Roman Cortes</a> for <a href="http://js1k.com/2012-love/">the love contest 2012 js1k</a> made a 3D rose on javascript (canvas) using the Monte Carlo method. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Briefly about the Monte Carlo method </h4><br>  <a href="http://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B5%25D1%2582%25D0%25BE%25D0%25B4_%25D0%259C%25D0%25BE%25D0%25BD%25D1%2582%25D0%25B5-%25D0%259A%25D0%25B0%25D1%2580%25D0%25BB%25D0%25BE">The Monte-Karlo method</a> is a general name for a group of numerical methods based on obtaining a large number of realizations of a stochastic (random) process, which is formed in such a way that its probabilistic characteristics coincide with similar values ‚Äã‚Äãof the problem being solved.  It is used to solve problems in various fields of physics, chemistry, mathematics, economics, optimization, control theory, etc. <br><a name="habracut"></a><br><h4>  Surface rendering </h4><br><br>  To determine the shape of a rose, we will use several surfaces.  In total, there are 31 surfaces: 24 petals, 4 sepals (thin leaves around the petals), 2 leaves and 1 rose stalk. <br><br>  2d example of a surface detection function: <br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">surface</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a, b</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// I'm using a and b as parameters ranging from 0 to 1. return { x: a*50, y: b*50 }; // this surface will be a square of 50x50 units of size }</span></span></code> </pre> <br><br>  Drawing code: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> canvas = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.appendChild(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">"canvas"</span></span>)), context = canvas.getContext(<span class="hljs-string"><span class="hljs-string">"2d"</span></span>), a, b, position; <span class="hljs-comment"><span class="hljs-comment">// Now I'm going to sample the surface at .1 intervals for a and b parameters: for (a = 0; a &lt; 1; a += .1) { for (b = 0; b &lt; 1; b += .1) { position = surface(a, b); context.fillRect(position.x, position.y, 1, 1); } }</span></span></code> </pre> <br><br>  Result: <br><img src="http://habrastorage.org/storage2/686/e9f/8f7/686e9f8f7108bc3cf82492109cf73b08.gif"><br><br>  Now we will reduce the interval of these pixels for a more dense image. <br><img src="http://habrastorage.org/storage2/b60/a42/b48/b60a42b4852461f6f9e606bbaf4768ec.gif"><br><br>  This allows you to override the surface function for drawing a circle.  There are several ways to do this, but we will use the following formula: (x-x0) ^ 2 + (y-y0) ^ 2 &lt;radius ^ 2, where (x0, y0) is the center of the circle: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">surface</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a, b</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = a * <span class="hljs-number"><span class="hljs-number">100</span></span>, y = b * <span class="hljs-number"><span class="hljs-number">100</span></span>, radius = <span class="hljs-number"><span class="hljs-number">50</span></span>, x0 = <span class="hljs-number"><span class="hljs-number">50</span></span>, y0 = <span class="hljs-number"><span class="hljs-number">50</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((x - x0) * (x - x0) + (y - y0) * (y - y0) &lt; radius * radius) { <span class="hljs-comment"><span class="hljs-comment">// inside the circle return { x: x, y: y }; } else { // outside the circle return null; } }</span></span></code> </pre> <br><br>  In order not to draw points outside the circle, add a condition: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (position = surface(a, b)) { context.fillRect(position.x, position.y, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); }</code> </pre><br><br>  We get: <br><img src="http://habrastorage.org/storage2/780/88d/e9b/78088de9b216c59d4637617301fd8b39.gif"><br><br>  As already mentioned, there are various ways to define a circle, and we need to show it only in one direction: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">surface</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a, b</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Circle using polar coordinates var angle = a * Math.PI * 2, radius = 50, x0 = 50, y0 = 50; return { x: Math.cos(angle) * radius * b + x0, y: Math.sin(angle) * radius * b + y0 }; }</span></span></code> </pre> <br><br>  The following function allows us to deform a circle to make it look like a petal: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">surface</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a, b</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = a * <span class="hljs-number"><span class="hljs-number">100</span></span>, y = b * <span class="hljs-number"><span class="hljs-number">100</span></span>, radius = <span class="hljs-number"><span class="hljs-number">50</span></span>, x0 = <span class="hljs-number"><span class="hljs-number">50</span></span>, y0 = <span class="hljs-number"><span class="hljs-number">50</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((x - x0) * (x - x0) + (y - y0) * (y - y0) &lt; radius * radius) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">x</span></span>: x, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: y * (<span class="hljs-number"><span class="hljs-number">1</span></span> + b) / <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-comment"><span class="hljs-comment">// deformation }; } else { return null; } }</span></span></code> </pre><br><br><img src="http://habrastorage.org/storage2/f27/423/a2c/f27423a2c162f05fcae18243a191dab2.gif"><br><br>  I want to add some color: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">surface</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a, b</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = a * <span class="hljs-number"><span class="hljs-number">100</span></span>, y = b * <span class="hljs-number"><span class="hljs-number">100</span></span>, radius = <span class="hljs-number"><span class="hljs-number">50</span></span>, x0 = <span class="hljs-number"><span class="hljs-number">50</span></span>, y0 = <span class="hljs-number"><span class="hljs-number">50</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((x - x0) * (x - x0) + (y - y0) * (y - y0) &lt; radius * radius) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">x</span></span>: x, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: y * (<span class="hljs-number"><span class="hljs-number">1</span></span> + b) / <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">r</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor((<span class="hljs-number"><span class="hljs-number">1</span></span> - b) * <span class="hljs-number"><span class="hljs-number">155</span></span>), <span class="hljs-comment"><span class="hljs-comment">// this will add a gradient g: 50, b: 50 }; } else { return null; } } for (a = 0; a &lt; 1; a += .01) { for (b = 0; b &lt; 1; b += .001) { if (point = surface(a, b)) { context.fillStyle = "rgb(" + point.r + "," + point.g + "," + point.b + ")"; context.fillRect(point.x, point.y, 1, 1); } } }</span></span></code> </pre> <br><br><img src="http://habrastorage.org/storage2/e26/fbd/458/e26fbd4584eb3f8ecdd60e8a8033d439.jpg"><br><br>  Petals are ready! <br><br><h4>  3D surface and perspective projection </h4><br><br>  Making a 3D surface is very simple: just add az properties to the surface.  As an example, let's make a pipe / cylinder: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">surface</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a, b</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> angle = a * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI * <span class="hljs-number"><span class="hljs-number">2</span></span>, radius = <span class="hljs-number"><span class="hljs-number">100</span></span>, length = <span class="hljs-number"><span class="hljs-number">400</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">x</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.cos(angle) * radius, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.sin(angle) * radius, <span class="hljs-attr"><span class="hljs-attr">z</span></span>: b * length - length / <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-comment"><span class="hljs-comment">// by subtracting length/2 I have centered the tube at (0, 0, 0) r: 0, g: Math.floor(b * 255), b: 0 }; }</span></span></code> </pre> <br><br>  To add perspective to the projection, you must determine the position of the camera. <br><img src="http://habrastorage.org/storage2/1fc/f15/f40/1fcf15f409ee30fac502680af13ba8da.gif"><br><br>  We will make the camera at the point (0, 0, cameraZ), it will be called ‚Äúperspective‚Äù - the distance from the camera to the canvas.  The center will be at the point (0, 0, cameraZ + perspective).  Now each point will be projected on the canvas: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pX, pY, <span class="hljs-comment"><span class="hljs-comment">// projected on canvas x and y coordinates perspective = 350, halfHeight = canvas.height / 2, halfWidth = canvas.width / 2, cameraZ = -700; for (a = 0; a &lt; 1; a += .001) { for (b = 0; b &lt; 1; b += .01) { if (point = surface(a, b)) { pX = (point.x * perspective) / (point.z - cameraZ) + halfWidth; pY = (point.y * perspective) / (point.z - cameraZ) + halfHeight; context.fillStyle = "rgb(" + point.r + "," + point.g + "," + point.b + ")"; context.fillRect(pX, pY, 1, 1); } } }</span></span></code> </pre> <br><br>  Result: <br><img src="http://habrastorage.org/storage2/a5f/957/fb8/a5f957fb8936ee80bebbbe9a2d657947.jpg"><br><br><h4>  Z-buffer </h4><br><br>  Z-buffer is a fairly common technology in the field of computer graphics to account for the distance of image elements. <br><br><img src="http://habrastorage.org/storage2/907/dda/3bd/907dda3bdc3fa4899d835d1007de1feb.jpg"><br><br>  This can be seen on the Z-buffer of the rose: the black element is far from the camera, white is close to it. <br><br>  Implementation: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> zBuffer = [], zBufferIndex; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (a = <span class="hljs-number"><span class="hljs-number">0</span></span>; a &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>; a += <span class="hljs-number"><span class="hljs-number">.001</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (b = <span class="hljs-number"><span class="hljs-number">0</span></span>; b &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>; b += <span class="hljs-number"><span class="hljs-number">.01</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (point = surface(a, b)) { pX = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor((point.x * perspective) / (point.z - cameraZ) + halfWidth); pY = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor((point.y * perspective) / (point.z - cameraZ) + halfHeight); zBufferIndex = pY * canvas.width + pX; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> zBuffer[zBufferIndex] === <span class="hljs-string"><span class="hljs-string">"undefined"</span></span>) || (point.z &lt; zBuffer[zBufferIndex])) { zBuffer[zBufferIndex] = point.z; context.fillStyle = <span class="hljs-string"><span class="hljs-string">"rgb("</span></span> + point.r + <span class="hljs-string"><span class="hljs-string">","</span></span> + point.g + <span class="hljs-string"><span class="hljs-string">","</span></span> + point.b + <span class="hljs-string"><span class="hljs-string">")"</span></span>; context.fillRect(pX, pY, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); } } } }</code> </pre> <br><br><h4>  Cylinder rotation </h4><br><br>  You can use any method of rotation vector.  In the case of the rose, but here we use the <a href="http://ru.wikipedia.org/wiki/%25D0%25A2%25D0%25B5%25D0%25BE%25D1%2580%25D0%25B5%25D0%25BC%25D0%25B0_%25D0%25B2%25D1%2580%25D0%25B0%25D1%2589%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F_%25D0%25AD%25D0%25B9%25D0%25BB%25D0%25B5%25D1%2580%25D0%25B0">Euler rotation theorem</a> .  Let's implement rotation around the Y axis: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">surface</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a, b</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> angle = a * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI * <span class="hljs-number"><span class="hljs-number">2</span></span>, radius = <span class="hljs-number"><span class="hljs-number">100</span></span>, length = <span class="hljs-number"><span class="hljs-number">400</span></span>, x = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.cos(angle) * radius, y = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.sin(angle) * radius, z = b * length - length / <span class="hljs-number"><span class="hljs-number">2</span></span>, yAxisRotationAngle = <span class="hljs-number"><span class="hljs-number">-.4</span></span>, <span class="hljs-comment"><span class="hljs-comment">// in radians! rotatedX = x * Math.cos(yAxisRotationAngle) + z * Math.sin(yAxisRotationAngle), rotatedZ = x * -Math.sin(yAxisRotationAngle) + z * Math.cos(yAxisRotationAngle); return { x: rotatedX, y: y, z: rotatedZ, r: 0, g: Math.floor(b * 255), b: 0 }; }</span></span></code> </pre> <br><br>  Result: <br><img src="http://habrastorage.org/storage2/28a/9c2/8c4/28a9c28c488c52936e0edb70e5dede8b.jpg"><br><br><h4>  Monte Carlo method </h4><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i; <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">10000</span></span>; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (point = surface(<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random(), <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random())) { pX = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor((point.x * perspective) / (point.z - cameraZ) + halfWidth); pY = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor((point.y * perspective) / (point.z - cameraZ) + halfHeight); zBufferIndex = pY * canvas.width + pX; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> zBuffer[zBufferIndex] === <span class="hljs-string"><span class="hljs-string">"undefined"</span></span>) || (point.z &lt; zBuffer[zBufferIndex])) { zBuffer[zBufferIndex] = point.z; context.fillStyle = <span class="hljs-string"><span class="hljs-string">"rgb("</span></span> + point.r + <span class="hljs-string"><span class="hljs-string">","</span></span> + point.g + <span class="hljs-string"><span class="hljs-string">","</span></span> + point.b + <span class="hljs-string"><span class="hljs-string">")"</span></span>; context.fillRect(pX, pY, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); } } } }, <span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre> <br><br><h4>  Conclusion </h4><br>  To complete the rose, I had to add a third parameter for the function that selects a part of the rose.  In the case of petals, we use rotations and extensions / deformations.  All this is done by mixing, which are described in this article. <br><br>  The choice of Monte Carlo / Z-buffering fell for artistic purposes.  Not a very innovative and not very useful script, but it fits very well into the js1k context, where simplicity and minimal sizes are desirable. <br><br>  I can not believe that the whole rose can be in <a href="http://forum.xeksec.com/habr/rose/">this</a> code: <br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!doctype html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>JS1k, 1k demo submission [1022]<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">canvas</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"c"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">canvas</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> b = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.body; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> c = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.getElementsByTagName(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'canvas'</span></span></span><span class="javascript">)[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">]; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> a = c.getContext(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'2d'</span></span></span><span class="javascript">); </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.body.clientWidth; </span><span class="hljs-comment"><span class="javascript"><span class="hljs-comment">// fix bug in webkit: http://qfox.nl/weblog/218 </span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> </span><span class="hljs-comment"><span class="actionscript"><span class="hljs-comment">// start of submission // with(m=Math)C=cos,S=sin,P=pow,R=random;c.width=c.height=f=500;h=-250;function p(a,b,c){if(c&gt;60)return[S(a*7)*(13+5/(.2+P(b*4,4)))-S(b)*50,b*f+50,625+C(a*7)*(13+5/(.2+P(b*4,4)))+b*400,a*1-b/2,a];A=a*2-1;B=b*2-1;if(A*A+B*B&lt;1){if(c&gt;37){n=(j=c&amp;1)?6:4;o=.5/(a+.01)+C(b*125)*3-a*300;w=b*h;return[o*C(n)+w*S(n)+j*610-390,o*S(n)-w*C(n)+550-j*350,1180+C(B+A)*99-j*300,.4-a*.1+P(1-B*B,-h*6)*.15-a*b*.4+C(a+b)/5+P(C((o*(a+1)+(B&gt;0?w:-w))/25),30)*.1*(1-B*B),o/1e3+.7-o*w*3e-6]}if(c&gt;32){c=c*1.16-.15;o=a*45-20;w=b*b*h;z=o*S(c)+w*C(c)+620;return[o*C(c)-w*S(c),28+C(B*.5)*99-b*b*b*60-z/2-h,z,(b*b*.3+P((1-(A*A)),7)*.15+.3)*b,b*.7]}o=A*(2-b)*(80-c*2);w=99-C(A)*120-C(b)*(-hc*4.9)+C(P(1-b,7))*50+c*2;z=o*S(c)+w*C(c)+700;return[o*C(c)-w*S(c),B*99-C(P(b, 7))*50-c/3-z/1.35+450,z,(1-b/1.2)*.9+a*.1, P((1-b),20)/4+.05]}}setInterval('for(i=0;i&lt;1e4;i++)if(s=p(R(),R(),i%46/.74)){z=s[2];x=~~(s[0]*f/zh);y=~~(s[1]*f/zh);if(!m[q=y*f+x]|m[q]&gt;z)m[q]=z,a.fillStyle="rgb("+~(s[3]*h)+","+~(s[4]*h)+","+~(s[3]*s[3]*-80)+")",a.fillRect(x,y,1,1)}',0) // end of submission // </span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre></div><p>Source: <a href="https://habr.com/ru/post/137762/">https://habr.com/ru/post/137762/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../137750/index.html">Live Wallpaper - Pros and Cons</a></li>
<li><a href="../137751/index.html">The development of service live</a></li>
<li><a href="../137756/index.html">What should I do to ensure that projects do not take 2-3 times longer than planned? Part 1</a></li>
<li><a href="../137759/index.html">Anticipating the questions "What happened to the rutraker?", I will immediately answer them</a></li>
<li><a href="../137760/index.html">Open source Symantec pcAnywhere sources</a></li>
<li><a href="../137764/index.html">Sociological aspect of the problems associated with copyright</a></li>
<li><a href="../137765/index.html">Practical advice on how to arrange a MMORPG in real life - or why you will need to buy a TV again soon</a></li>
<li><a href="../137766/index.html">Shannon-Fano algorithm</a></li>
<li><a href="../137767/index.html">Interview with Evernote Food product manager Naomi Pilosof</a></li>
<li><a href="../137769/index.html">Ukraine proposes to prohibit by law to close sites with illegal content</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>