<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>(Archive) Matreshka.js v0.1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The article is outdated. See current version history . 



- Introduction 
- Inheritance 
- MK.Object 
- MK.Array 
- Matreshka.js v0.1 
- Matreshka.js...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>(Archive) Matreshka.js v0.1</h1><div class="post__text post__text-html js-mediator-article">  <b>The article is outdated.</b>  <b>See <a href="http://ru.matreshka.io/">current version history</a> .</b> <br><br><ul><li>  <a href="http://habrahabr.ru/post/196146/">Introduction</a> </li><li>  <a href="http://habrahabr.ru/post/200078/">Inheritance</a> </li><li>  <a href="http://habrahabr.ru/post/196886/">MK.Object</a> </li><li>  <a href="http://habrahabr.ru/post/198212/">MK.Array</a> </li><li>  <b>Matreshka.js v0.1</b> </li><li>  <a href="http://habrahabr.ru/post/231333/">Matreshka.js v0.2</a> </li><li>  <a href="http://habrahabr.ru/post/231347/">Implement TodoMVC</a> </li></ul><br>  (All previous articles updated to current status) <br>  <a href="https://github.com/finom/matreshka">Repository</a> <br><br>  <a href="http://finom.github.io/matreshka/">Site (ibid, and documentation)</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <a href="http://finom.github.io/matreshka/"><img src="https://habrastorage.org/getpro/habr/post_images/9f5/4dc/499/9f54dc4994b78eb1e9e1583c935fa80c.png" height="210" align="left" alt="Matreshka Logo" title="Matreshka Logo"></a>  Hello.  5 months have passed since the last publication of the series of articles on the Matryoshka.  Since then, a small number of bugs was fixed, several handy features appeared, including under the influence of your comments, the project found a sponsor in the face of <a href="http://www.shooju.com/">Shooju</a> , received a logo and a normal, non-bootstrap site. <br><br><a name="habracut"></a><br><br><div class="spoiler">  <b class="spoiler_title">Let me remind you, Matryoshka is a general purpose framework in which the importance of data dominates the appearance, and the interface is automatically updated when the data is updated.</b> <div class="spoiler_text">  Matryoshka allows you to quite simply connect data and presentation elements (for example, a property of an object and the value of an input field), without worrying about further synchronization of data and presentation.  For example, the simplest binding looks like this: <br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">select</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"my-select"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">option</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">option</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">option</span></span></span><span class="hljs-tag">&gt;</span></span>2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">option</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">option</span></span></span><span class="hljs-tag">&gt;</span></span>3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">option</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">select</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Create an instance: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mk = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Matreshka();</code> </pre><br>  Associate the x property with the <code>.my-select</code> element: <br><pre> <code class="javascript hljs">mk.bindElement( <span class="hljs-string"><span class="hljs-string">'x'</span></span>, <span class="hljs-string"><span class="hljs-string">'.my-select'</span></span> );</code> </pre><br>  Change data <br><pre> <code class="javascript hljs">mk.x = <span class="hljs-number"><span class="hljs-number">2</span></span>;</code> </pre><br>  After we assign a different value to property x, the state of the element changes accordingly. <br>  <a href="http://jsbin.com/vidawequ/7/edit">Take a look at a live example.</a> <br><br>  Another important feature of nesting dolls are events (including custom ones).  For example, the Matryoshka can catch a change in the value of a property: <br><pre> <code class="javascript hljs">mk.on( <span class="hljs-string"><span class="hljs-string">'change:x'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> evt </span></span></span><span class="hljs-function">) </span></span>{ alert( <span class="hljs-string"><span class="hljs-string">'x   '</span></span> + evt.value ); });</code> </pre><br>  The code will print <code>"x   "</code> : <br><pre> <code class="javascript hljs">mk.x = <span class="hljs-string"><span class="hljs-string">''</span></span>;</code> </pre><br>  For more information about these and other features, see the links above. <br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">A little bit about the design of the article</b> <div class="spoiler_text">  I will use the jsdoc syntax to denote methods and properties, in particular - the grid (#) for example, <code>MK#addDependence</code> means that I‚Äôm talking about the <code>addDependence</code> method, an instance of the <code>MK</code> class. </div></div><br><br><h1>  Most delicious </h1><br><h2>  Dependencies ( <a href="http://finom.github.io/matreshka/docs/Matreshka.html">MK</a> method <a href="http://finom.github.io/matreshka/docs/Matreshka.html"># addDependence</a> ) </h2><br>  This coolest method allows you to set the dependence of some data from others.  The first argument is the key of the dependent property, the second is the array of keys that the property depends on (or a string with the keys listed separated by spaces), the third is the handler function, which must return a new value for the property.  This is a kind of replacement for the getter, with the difference that the getter is called every time you get a property, and <code>addDependence</code> calculates the value of the property in advance, when you change the data on which the property depends.  You need to work very carefully with the getter, since relatively heavy calculations can greatly affect the performance of your code.  ‚ÄúDependencies,‚Äù in turn, are no different in terms of resource consumption from the usual processing of data change events and are, in fact, syntactic sugar over them.  In addition, the method is another step towards self-documenting code. <br><br>  Let's say we need the property <code>f</code> always be the sum of the properties <code>a, b, c, d, e</code> . <br>  Here is the code based on pure events: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on( <span class="hljs-string"><span class="hljs-string">'change:a change:b change:c change:d change:e'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.a + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.b + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.c + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.d + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.e; });</code> </pre><br>  Now compare it with this: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addDependence( <span class="hljs-string"><span class="hljs-string">'f'</span></span>, <span class="hljs-string"><span class="hljs-string">'abcd e'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.a + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.b + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.c + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.d + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.e; });</code> </pre><br>  Or even with this: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addDependence( <span class="hljs-string"><span class="hljs-string">'f'</span></span>, <span class="hljs-string"><span class="hljs-string">'abcd e'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> a, b, c, d, e </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a + b + c + d + e; });</code> </pre><br><habracut text="..."><br>  <b>First</b> , we have to make fewer gestures (no need for <code>'change:'</code> heaps) <br>  <b>Secondly</b> , by the name of the method and the arguments we understand well why the corresponding lines of code were created.  Translating into human language, the first method can be voiced like this: ‚Äúwhen changing the properties of <code>a, b, c, d, e</code> do something,‚Äù and the second way: ‚Äúadd the dependence of property <code>f</code> on properties of <code>a, b, c, d, e</code> ".  Feel the difference? <br>  <b>Third</b> , if one of the properties on which another property depends is changed with the <code>silent</code> flag, the first option will not work. <br><br>  For example, there is the task of calculating the perimeter. <br><br>  Option 1, on events: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on( <span class="hljs-string"><span class="hljs-string">'change:a change:b'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.p = ( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.a + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.b ) * <span class="hljs-number"><span class="hljs-number">2</span></span>; });</code> </pre><br>  Option 2, using dependencies: <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  2 this.addDependence( 'p', 'a b', function() { return ( this.a + this.b ) * 2; });</span></span></code> </pre><br>  Now, if we call: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.set({ <span class="hljs-attr"><span class="hljs-attr">a</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">b</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">silent</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> });</code> </pre>  ... then in the first version, <code>p</code> will not change, in the second, it will change. <br><br>  Note that if you hooked the event handler to change <code>p</code> , and one of the properties that <code>p</code> depends on changed with the <code>silent</code> flag, then, as expected, the change handler <code>p</code> will not be called. <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on( <span class="hljs-string"><span class="hljs-string">'change:p'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } ); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.set( <span class="hljs-string"><span class="hljs-string">'a'</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, { <span class="hljs-attr"><span class="hljs-attr">silent</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }); <span class="hljs-comment"><span class="hljs-comment">//   "p"    ""</span></span></code> </pre><br>  In the next version, it is planned to add a dependency of a property on data from other classes (a common problem in applications where data dominates appearance).  This is already implemented, but not documented due to limitations in the syntax of the language.  It is assumed that dependence on other classes will look like this: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addDependence( <span class="hljs-string"><span class="hljs-string">'a'</span></span>, [ instance1, <span class="hljs-string"><span class="hljs-string">'bc d'</span></span>, instance2, <span class="hljs-string"><span class="hljs-string">'ef g'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">'hij'</span></span> ], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> });</code> </pre><br>  Where the odd element of the array from the second argument is an instance, even is the list of keys.  Looks specifically, I will be glad to other options. <br><br>  On the examples page, you can see <a href="http://finom.github.io/matreshka/examples/">how the method works live</a> . <br><br>  Regarding the <a href="http://habrahabr.ru/post/196886/">comment</a> <a href="https://habrahabr.ru/users/rendol/" class="user_link">Rendol</a> : mapping can be implemented using dependencies. <br><br><h2>  Mediators (intermediaries) </h2><br><h3>  <a href="http://finom.github.io/matreshka/docs/Matreshka.html">MK</a> method <a href="http://finom.github.io/matreshka/docs/Matreshka.html"># setMediator</a> </h3><br>  Quite often, the task of validating and converting data is embedded.  Let's say in your class there is a property <code>a</code> , which should always be a string and nothing else.  Let's try to solve this problem using the standard toolkit: <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// - this.on( 'change:a', function() { if( typeof this.a !== 'string' ) { this.a = String( this.a ); } }); // - 1 this.on( 'change:a', function() { if( typeof this.a === 'string' ) { /* ... */ } }); // - 2 this.on( 'change:a change:b', function() { if( typeof this.a === 'string' ) { /* ... */ } }); //   this.a = 123;</span></span></code> </pre><br>  See what's going on here?  The first handler converts <code>a</code> to a string, and the last two handlers are forced to check whether <code>a</code> is <code>a</code> string, since the converter handler starts all the handlers (including itself) again.  Wandering around in search of a solution, such as the event <code>beforechange:%%</code> , it was decided to introduce a new concept into the framework - ‚Äúintermediary‚Äù. <br><br>  The mediator (or mediator) changes the value of the property before any event associated with a change in this property is triggered. <br><br>  The syntax of the <code>MK#setMediator</code> is simple: the first argument is the key for which you want to set the mediator, the second argument is the function that should return the new value of the property.  Alternative syntax: a key-mediator object is passed to the method in case you want to attach several mediators to a class at once. <br><br>  For example, the property <code>a</code> should always be a string, and the property <code>b</code> should always be an integer (or <code>NaN</code> ) <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setMediator( <span class="hljs-string"><span class="hljs-string">'a'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> value </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>( value ); }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setMediator( <span class="hljs-string"><span class="hljs-string">'b'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> value </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>( value ); });</code> </pre><br>  And for those who know Javascript well: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setMediator( <span class="hljs-string"><span class="hljs-string">'a'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setMediator( <span class="hljs-string"><span class="hljs-string">'b'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span> );</code> </pre><br>  Mediators are not limited to such simple features.  Nothing forbids performing any calculations, but only carefully, so as not to harm the performance of the application. <br><br>  The method is mega-friendly and cool, including when the server accepts any particular type of value.  There can be only one mediator.  The next call to <code>MK#setMediator</code> with the same property will block the old pick.  In order to remove the "intermediary", instead of the function, you can pass <code>null</code> . <br><br>  <a href="http://finom.github.io/matreshka/examples/">Take a look at a live example</a> from the examples page. <br><pre> <code class="javascript hljs">mk.setMediator({ <span class="hljs-attr"><span class="hljs-attr">percentageValue</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> v </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> v &gt; <span class="hljs-number"><span class="hljs-number">100</span></span> ? <span class="hljs-number"><span class="hljs-number">100</span></span> : v &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> ? <span class="hljs-number"><span class="hljs-number">0</span></span> : v; }, <span class="hljs-attr"><span class="hljs-attr">stringValue</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-attr"><span class="hljs-attr">integerValue</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span> });</code> </pre><br>  We have established mediators for three properties.  The first is the percentage property: the value of the property can be from 0 to 100, then what goes beyond this range is automatically converted to a valid value (if less than 0, then the value becomes 0, if greater than 100, then the value becomes 100).  The second value is a string, the property must always be a string.  The third must always be an integer (or <code>NaN</code> ).  Developing a thought, you can create a property that is always true or false, you can create a property that will always be an instance of some class ... <br><br><h3>  <a href="http://finom.github.io/matreshka/docs/Matreshka.Array.html">MK.Array</a> method <a href="http://finom.github.io/matreshka/docs/Matreshka.Array.html"># setItemMediator</a> </h3><br>  There is another type of mediator: an array element mediator.  When installing such a mediator, it transforms each added element as you want.  Take a look at an example from the documentation: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mkArray = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MK.Array( <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span> ); mkArray.setItemMediator( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> value </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>( value ); }); mkArray.push( <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span> ); mkArray.unshift( <span class="hljs-literal"><span class="hljs-literal">true</span></span>, {} );</code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log( mkArray.toJSON() ); <span class="hljs-comment"><span class="hljs-comment">// [ "true", "[object Object]", "1", "2", "3", "4", "5", "6", "7" ]</span></span></code> </pre><br>  Here you create a typed array: an array of strings.  Yes, of course, such a typed array differs in performance from the built-in typed arrays for the worse.  But the possibilities for validation and data conversion now have no boundaries. <br><br>  Do not forget that the mediator of an array element can be the only one for the whole class.  And you can remove a mediator by setting it to <code>null</code> . <br><pre> <code class="javascript hljs">mkArray.setItemMediator( <span class="hljs-literal"><span class="hljs-literal">null</span></span> );</code> </pre><br>  By the way, the example above can be fixed for advanced programmers: <br><pre> <code class="javascript hljs">mkArray.setItemMediator( <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> );</code> </pre><br>  Cool? <br><br><h1>  "By numerous requests" </h1><br>  After the publication of the first series of articles, habrauys criticized some of the features of the Nested doll.  The criticism was reasonable, and it was decided to reconsider controversial points and make corrections.  Here are some of them: <br><br>  1. <a href="http://finom.github.io/matreshka/docs/Matreshka.Array.html">MK.Array # pop</a> and <a href="http://finom.github.io/matreshka/docs/Matreshka.Array.html">MK.Array # shift</a> return the deleted item, instead of ‚Äúitself‚Äù.  <a href="https://habrahabr.ru/users/starfall/" class="user_link">Starfall</a> : <a href="http://habrahabr.ru/post/198212/">Comment on the article</a> , <a href="https://habrahabr.ru/users/winbackgo/" class="user_link">winbackgo</a> : <a href="http://habrahabr.ru/post/198212/">Comment on the article</a> <br>  2. Default binders for <code>input[type="text"]</code> and <code>textarea</code> now listening to the <code>'paste'</code> event, not just the <code>'keyup'</code> .  <a href="https://habrahabr.ru/users/safron/" class="user_link">safron</a> : <a href="http://habrahabr.ru/post/200078/">article comment</a> <br>  3. Default binders for <code>input[type="checkbox"]</code> and <code>input[type="radio"]</code> now listening to the <code>'keyup'</code> event.  This means that you can work with these elements from the keyboard when you bind data to them (the same comment). <br><br><img align="right" src="http://the-legends.ru/uploads/images/4/balalayka/balalaika.jpg" alt="Balalaika" title="Balalaika" height="180"><br><h2>  Balalaika </h2><br>  In addition, it was decided to remove the hard dependency on <code>jQuery</code> .  In my opinion, <code>jQuery</code> is a great library, but it loses its relevance in new browsers.  Now, if there is no <code>jQuery</code> on the page, it replaces the mini library, which I called ‚ÄúBalalaika‚Äù (note: only if it is missing; if <code>jQuery</code> connected, then <code>jQuery</code> is still used). <br><br>  Balalaika inherits <code>Array.prototype</code> , so the developer has access to all the methods that the array has, plus <code>jQuery</code> compatible methods for working with classes ( <code>addClass</code> , <code>removeClass</code> , <code>hasClass</code> ), events ( <code>on</code> , <code>off</code> ), parsing HTML ( <code>parseHTML</code> ) and others. <br><br>  To use the Balalaika directly, the global variable <a href="http://finom.github.io/matreshka/docs/global.html">$ b is used</a> : <br><pre> <code class="javascript hljs">$b( <span class="hljs-string"><span class="hljs-string">'div'</span></span> ).forEach( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } ); $b( <span class="hljs-string"><span class="hljs-string">'.blah-blah'</span></span>, context ).is( <span class="hljs-string"><span class="hljs-string">'div'</span></span> ); $b( <span class="hljs-string"><span class="hljs-string">'input[type="text"]'</span></span> ).on( <span class="hljs-string"><span class="hljs-string">'keydown'</span></span>, handler );</code> </pre><br><br>  (It is planned to write a separate post about Balalaika) <br><br>  <a href="https://habrahabr.ru/users/banzalik/" class="user_link">banzalik</a> : <a href="http://habrahabr.ru/post/196146/">Comment with the wish</a> <br>  <a href="https://habrahabr.ru/users/jmas/" class="user_link">jMas</a> : <a href="http://habrahabr.ru/post/196886/">Another comment</a> <br><br><h1>  Other innovations </h1><br><h2>  <a href="http://finom.github.io/matreshka/docs/Matreshka.html">MK</a> method <a href="http://finom.github.io/matreshka/docs/Matreshka.html"># select</a> </h2><br>  Selects the first available element corresponding to the selector inside bound to <code>this</code> (key <code>"__this__"</code> , see previous articles).  The method was created for simplified work with individual elements, but not with collections of elements. <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.select( <span class="hljs-string"><span class="hljs-string">'.blah-blah'</span></span> );</code> </pre><br><br><h2>  <a href="http://finom.github.io/matreshka/docs/Matreshka.html">MK</a> method <a href="http://finom.github.io/matreshka/docs/Matreshka.html"># selectAll</a> </h2><br>  Selects all elements that match the selector within the bound to <code>this</code> .  Does the same thing as the <code>$</code> method (dollar sign).  <code>MK#selectAll</code> created for completeness of the set of methods: if there is a ‚Äúselect‚Äù method ( <code>MK#select</code> ), then there must be a ‚Äúselect all‚Äù method. <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.selectAll( <span class="hljs-string"><span class="hljs-string">'.blah-blah'</span></span> ); <span class="hljs-comment"><span class="hljs-comment">//   ,   this.$( '.blah-blah' );</span></span></code> </pre><br><br><h2>  <a href="http://finom.github.io/matreshka/docs/Matreshka.Array.html">MK.Array</a> method <a href="http://finom.github.io/matreshka/docs/Matreshka.Array.html"># pull</a> </h2><br>  Deletes and returns the item with the specified index. <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.pull( <span class="hljs-number"><span class="hljs-number">3</span></span> );</code> </pre><br>  It is syntactic sugar over <code>splice</code> . <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.splice( <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span> )[ <span class="hljs-number"><span class="hljs-number">0</span></span> ];</code> </pre><br><br><h2>  The <a href="http://finom.github.io/matreshka/docs/Matreshka.html">isMK</a> , <a href="http://finom.github.io/matreshka/docs/Matreshka.html">isMKArray</a> and <a href="http://finom.github.io/matreshka/docs/Matreshka.html">isMKObject properties</a> </h2><br>  Properties that are always <code>true</code> in instances of the corresponding classes <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mkObject = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MK.Object(); alert( mkObject.isMK &amp;&amp; mkObject.isMKObject ); <span class="hljs-comment"><span class="hljs-comment">// true</span></span></code> </pre><br><br><h1>  Fixes </h1><br>  In addition, several bugs were fixed.  Here is a list of fixes: <br><ul><li>  Do nothing if the argument to the methods <a href="http://finom.github.io/matreshka/docs/Matreshka.Object.html">MK.Object # addJSONKeys</a> and <a href="http://finom.github.io/matreshka/docs/Matreshka.Object.html">MK.Object # removeJSONKeys is</a> <code>undefined</code> (or nothing is passed). </li><li>  You can use numbers in the methods <a href="http://finom.github.io/matreshka/docs/Matreshka.Object.html">MK.Object # addJSONKeys</a> , <a href="http://finom.github.io/matreshka/docs/Matreshka.Object.html">MK.Object # removeJSONKeys</a> , <a href="http://finom.github.io/matreshka/docs/Matreshka.html">MK # remove</a> </li><li>  <a href="http://finom.github.io/matreshka/docs/Matreshka.html">MK # once</a> method fixed </li></ul><br><br><h1>  Renamed methods and properties </h1><br>  Following the recommendations of semver.org, outdated methods and properties will not be removed until release 1.0, but warnings and requests to use new methods will be displayed in the console. <br><ul><li>  MK.elementProcessors -&gt; <a href="http://finom.github.io/matreshka/docs/Matreshka.html">MK.</a>  <a href="http://finom.github.io/matreshka/docs/Matreshka.html"><strong>defaultBinders</strong></a> </li><li>  MK # el -&gt; <a href="http://finom.github.io/matreshka/docs/Matreshka.html">MK # <strong>bound</strong></a> </li><li>  MK # $ el -&gt; <a href="http://finom.github.io/matreshka/docs/Matreshka.html">MK # <strong>boundAll</strong></a> </li><li>  MK.htmlp -&gt; <a href="http://finom.github.io/matreshka/docs/Matreshka.binders.html">MK.</a>  <a href="http://finom.github.io/matreshka/docs/Matreshka.binders.html"><strong>binders.innerHTML ()</strong></a> </li><li>  MK.classp () -&gt; <a href="http://finom.github.io/matreshka/docs/Matreshka.binders.html">MK.</a>  <a href="http://finom.github.io/matreshka/docs/Matreshka.binders.html"><strong>binders.className ()</strong></a> </li></ul><br><br><h1>  Smart array </h1><br>  The <code>MK.Array</code> plug-in was <code>MK.DOMArray</code> , which was mentioned in the article about <code>MK.Array</code> .  That is, the functionality that reflected the "attention drawing" gif works out of the box.  Let me remind you that the <code>MK.DOMArray</code> plugin changes the DOM automatically when the array is changed (add, delete, sort ...). <br><br>  Take a look at <a href="http://finom.github.io/matreshka/examples/">an example from the site of Matryoshka</a> .  A more detailed description of the smart array is planned a little later. <br><br><h1>  "Road map" </h1><br><ul><li>  Implement a replaceable <code>Model</code> property (which will be similar to the <code>model</code> from <code>Backbone</code> ).  This feature will be syntactic sugar over the mediator of the array element. </li><li>  Lazy initialization.  Now, with inheritance, you must always call the <code>initMK</code> method.  Not kosher. </li><li>  Rewrite the event engine.  The basis may be taken DOM interface <code>EventTarget</code> . </li><li>  Update the <code>MK#addDependence</code> for dependencies on other instances of classes (as described above). </li><li>  Optimize code for minifikator. </li><li>  Correct texts on the site.  The site, as you can see, is in English, and there are errors in the text.  You can help correct errors using the Ctrl + Enter combination after highlighting text in which there is an error (so as not to make a pool of requests).  I'll be very grateful. </li></ul><br><br>  In version 1.0 (which is planned approximately in a year) it is planned, first, to remove outdated methods, and secondly, to remove support for the eighth Donkey.  All kittens inteta will be happy when no one else will support IE8. <br><br><h1>  In conclusion </h1><br>  Despite the apparent silence around the project, Matryoshka is developing.  All features are not only thoroughly tested, but also work in live applications. <br><br>  Another goal of the Matryoshka is to make the developer using the framework a ‚Äúdata god‚Äù who completely, 100% control what happens in the model, of course, not caring about the interface.  For example, it is planned to implement an ascent of a data change event on a tree of objects and arrays, and this will be very cool.  Further more‚Ä¶ <br><br>  The space that the Matryoshka core provides, based on accessors (getters and setters), provides the widest field for programmer creativity.  Agree, the idea of ‚Äã‚Äãintermediaries and dependencies lay on the surface.  Say, for an input property, the <code>value</code> property is always a string, so that we don‚Äôt put it there, the <code>valueAsNumber</code> property <code>valueAsNumber</code> always a number that depends on the string value ... <br><br>  Thank you for reading (or scrolling) the post to the end.  All the rays of good. </habracut></div><p>Source: <a href="https://habr.com/ru/post/217241/">https://habr.com/ru/post/217241/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../217215/index.html">"What is proof?": A look from theoretical informatics</a></li>
<li><a href="../217225/index.html">MakeHuman: release after 12 years of development</a></li>
<li><a href="../217235/index.html">Australian shark warns of its approach to shore via Twitter</a></li>
<li><a href="../217237/index.html">Internet Archive began digitizing 40,000 VHS and Betamax video tapes</a></li>
<li><a href="../217239/index.html">A set of bike Yii developer</a></li>
<li><a href="../217243/index.html">Foodini 1000 euro food 3D printer raises funds on Kickstarter</a></li>
<li><a href="../217245/index.html">Installing php5.5 + php-fpm + mysql + nginx on Mac OS X Mavericks</a></li>
<li><a href="../217247/index.html">The long-awaited update of Google Music</a></li>
<li><a href="../217251/index.html">Quick Mozilla debugger with recording and playback</a></li>
<li><a href="../217253/index.html">Making a remake of "Chopper Duel" on Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>