<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How do we use the data processing infrastructure at Sports.ru and Tribuna.com?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A year ago, we abandoned all public meters in favor of private services and our own data processing infrastructure. Collecting 10 million hits per day...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How do we use the data processing infrastructure at Sports.ru and Tribuna.com?</h1><div class="post__text post__text-html js-mediator-article">  A year ago, we abandoned all public meters in favor of private services and our own data processing infrastructure.  Collecting 10 million hits per day at the Olympics, we felt the limit of Google Analytics kindness, for which free service is no longer possible.  But now we have our own lunapark with convolution and graphs, so we can easily reduce the intensity of GA use, while retaining only audit functions.  How we collect data and how we use it in our work - in a sheet with funny pictures inside. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/aeb/579/8ff/aeb5798ffb953d6db70af6857982b5a7.jpg" alt="          .         NOC Wallmart.     )" title="We do not have such a room with monitors and nice bearded guys. This picture is found on the Internet and taken in NOC Wallmart. Guys can afford)"><br><a name="habracut"></a><br><blockquote>  ‚ÄúI don‚Äôt notice the code at all.  I see blondes, brunettes, redheads.  By the way, do you want a drink? ‚Äù </blockquote><br>  This is not to say that we knew what we were doing at the beginning.  We assumed that the data would add a little more meaning to our intuitive creativity.  And we really wanted a lot of beautiful graphs and more understanding than our users live.  We didn‚Äôt expect that we would build a full data processing system in a year, and the company would start breathing in the rhythm of Data Driven. <br><br>  And we really had a place to turn: every day, 700 News and 500 texts appear on <a href="http://www.sports.ru/">Sports.ru</a> and <a href="http://by.tribuna.com/">Tribuna.com</a> sites (of which 97% are custom), and under them there are 30 thousand comments, 120 thousand ratings and 2 thousand statuses.  This whole shaft of content settles not only on sites with their 750 thousand unik and 5 million hits per day, but also scatters through 100 thousand tags on 160 mobile applications (where 200 thousand unik make 8 million hits per day) and on 1200 subject groups in social networks. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">Sorry, I could not resist, but throwing numbers - my horse!</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/871/d09/4ce/871d094ce4dfd3b86582b7c02840f5db.jpg" alt=",   ,   ‚Ää‚Äî‚Ää !" title="Sorry, I could not resist, but throwing numbers - my horse!"></div></div><br><br>  So, these are our normal numbers.  Paranormal numbers become in the tight days of sporting events, as they are now happening in Sochi.  Every Olympic day we break the 1 million unik mark.  Instant traffic can jump 10 times, and the total volume of hits per day grows 1.5-2 times. <br><br>  We knew that we would have to process a lot of data: in the first months of operating the data processing infrastructure, we accumulated 500 gigabytes of raw material and aggregates.  But to immediately fit into your Hadoop cluster or computing processor would be too risky, and we didn‚Äôt have such an opportunity - so we got out. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/919/ab1/4cd/919ab14cd571aeda61d737690b39fe18.gif" alt="      -,  -  ,      " title="Turquoise components are marked in our own IT infrastructure, orange is all that we use as an external service."><br><blockquote>  At the beginning of last year, we did not even know half of the words on this scheme. </blockquote><br><br>  We did everything simply: data about page impressions is collected using the <a href="http://piwik.org/">Piwik</a> open-source counter, more precisely using its front-end part ‚Äî on the backend we have a nginx cluster, whose nodes access access.log from this counter.  Raw data from the logs is uploaded via <a href="http://aws.amazon.com/s3/">Amazon S3</a> to <a href="http://aws.amazon.com/redshift/">Amazon Redshift</a> , where client sessions are calculated from ClickStream hits.  Additionally, Redshift unloads data from the site‚Äôs SQL storage necessary to enrich the structures being created.  A plan of SQL queries has been developed over the created structures, which is used for generating graphs and reports in <a href="https://chartio.com/">Chart.io</a> , as well as for Adhoc data analysis. <br><br>  In addition, we register individual user actions in the NoSQL repository to quickly calculate the matrix of recommendations for our users, process access.log access to the site pages using <a href="http://okmetric.com/">Okmeter</a> agents, and use them to analyze user content from the SQL repositories.  As a result, we did not do the whole complex part of BigData (data storage, complex calculations, plotting graphs and reports) in the form of our own equipment farm and software collection, but completely carried it out to SaaS.  We left only the collection of raw data and the final consumption of aggregates. <br><br><div class="spoiler">  <b class="spoiler_title">Who is boiling?</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/1e1/8f2/ae0/1e18f2ae0ad64768d175f847b6530634.png" alt="  ?" title="Who is boiling?"></div></div><br><br>  We hope to tell the details of the technical implementation of the entire analytical infrastructure in a separate post, but now we want to share with you how we managed to improve our product and business by adding only a small portion of data. <br><br><h4>  Recommendations for users </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/581/e16/6b5/581e166b5d912cec93c3680f15115a77.jpg" alt=" ,     " title="Taking this opportunity, we give this illustration to hi perfectionists."><br>  We now know very much about our readers and not only what they tell us during registration ‚Äî which teams and athletes like or dislike - but also what we learn about them from the behavioral profile: from which fan sites or search queries users They come to Sports.ru and Tribuna.com, with what tags they read and comment, which posts and comments are added, and which are negative, which is interesting to friends.  Forming the matrix of preferences of each visitor, we impose on it a matrix of recommendations and give each relevant tips. <br><br><h4>  Business Metrics Monitoring </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/dc2/ecb/e2a/dc2ecbe2aaf41aa0d6a45ec30a020185.jpg" alt="  -    ,   ,     ‚Äî     " title="When we still get tired of watching how fire burns, water flows and colleagues work ‚Äî we watch these charts"><br><br>  To make a big PCO with monitors, graphics and nice bearded guys is the most obvious thing that comes to mind after the launch of the data processing infrastructure.  We did the charts, but we didn‚Äôt involve the monitors and the bearded ones: we definitely do not need emergency response teams. <br><br>  But we hung up some business metrics alerts using Okmeter.  Although this service is designed more to monitor technical metrics (uptime, traffic, system indicators, etc.), its functionality allows you to build metrics from any data from any SQL storage.  During the six months of operation, the service twice notified us that comments had ceased to appear on the site: on New Year's Eve, and when the curve banner appeared on the site, blocking Javascript on pages. <br><br>  But the coolest in Okmeter is the Play mode, in which you can work with the graph (add metrics, functions on data, change display parameters) in real time. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/252/090/5d1/2520905d110d3ba175f4a4284ba7da27.gif" alt="         " title="Draw the speed of the number of comments on the site in real time"><br><br><blockquote>  The service is made by great guys from Russia, while it is closed for registration, but you can ask for an invite on the site <a href="http://okmetric.com/">okmetric.com</a> </blockquote><br><br><h4>  Distribution and production of content </h4><br><br><img src="https://habrastorage.org/getpro/habr/post_images/3c6/424/0a7/3c64240a7eb23611ccda3e197d5c51b8.jpg" alt=" " title="Incomprehensible graphics"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/965/c85/f2f/965c85f2f4ecff7d7be538a557d7d8aa.jpg" alt=" " title="Incomprehensible tables"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/8e0/a3a/acc/8e0a3aacc7d18b7a94b8a2efa1380fb8.jpg" alt="   " title="One more incomprehensible table"><br><br>  We, of course, spy on what our users are writing, how they react to materials, news, looking for popular comments and photos, and the best thing is taking them to the work of the editorial board.  The user community, in a sense, is a Petri dish, in which cool jokes and biting replicas are born (we notice these facts by a sharp surge of pluses or minuses), we also test our editorial and social hypotheses, and distribute the best to all our channels: applications, social networks, tag flows. <br><br>  At first glance, this activity is similar to the insolent exploitation of the population and overt crowdsourcing, and this is true.  But!  The same mechanism allows young and unknown authors of the Tribune to become popular.  We notice really bright characters and take them into circulation in the social editorial office: we post posts to the main page, we scatter links by stream, we give them tips on design and submission. <a name="adhoc"></a><br><br><h4>  Adhoc analysis </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/4e8/978/188/4e8978188b61a078e7ab8e192741eb65.gif" alt="        ,     " title="We don‚Äôt have a lot of funny pictures about analytics, so we start posting cats"><br><blockquote>  We don‚Äôt have a lot of funny pictures about analytics, so we start posting cats </blockquote><br><br>  With the BigData infrastructure, we finally have a tool with which we can reliably answer the questions: ‚ÄúWhy did this happen?‚Äù, ‚ÄúHow can the product be improved?‚Äù, ‚ÄúWhat color does the button work best here?‚Äù And so on. P.  Every day we use the magic of numbers to estimate, search for dependencies and correlations. <br><br>  For example, we recently launched a personalized coercion to register: in various ways we learn about which team a visitor is interested in, select a popular player from this team, post a photo of this athlete on an invitation to register, and show this visitor a special block.  We have already figured out that such a personalized treatment works many times more efficiently than cute cats or Guus Hiddink.  But to choose the text for such an invitation, we decided to simple ABCD-test.  This is how the test variants look at experimental Alexandra Amisulashvili from Krylya Sovetov: <br><img src="https://habrastorage.org/getpro/habr/post_images/584/313/40e/58431340e37eaa1f83f08e615b143ae0.jpg" alt="image"><br><br>  Try to guess for yourself the best option and compare it with our results (a sample of 100,000 impressions was made). <br><br><div class="spoiler">  <b class="spoiler_title">CTR results to them.</b>  <b class="spoiler_title">A. Amisulashvili</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/eaa/49e/0c5/eaa49e0c55c91ccd43d1c36b617d332c.jpg" alt=" CTR . . " title="CTR results to them. A. Amisulashvili"></div></div><br><br><h4>  Mailing Lists </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/340/fe8/256/340fe8256d1a9596514f84e23f8b810f.jpg" alt="       BigData, ,  " title="For such mailings once a week, no BigData, of course, is needed"><br><br>  You can measure the effectiveness of email newsletters without special skills and funds.  We use the data infrastructure for the campaign: a sample of users to send them personalized messages.  We identify users who have not visited the site for several weeks to tell them via email that we have something interesting, while they were not.  We remind players of their Fantasy team or the prediction tournament they have scored.  We invite fans to thematic forums of interest. <br><br><h4>  Business analytics </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/82c/4b9/186/82c4b9186cf0494e846c151597f67388.jpg" title="Secret data"><br><div class="spoiler">  <b class="spoiler_title">Peek at the full weekly Sports.ru report</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/4dd/097/416/4dd097416b484123beb3de9577acc5ea.jpg" alt="-!" title="Haha"></div></div><br><br>  Once a week, heads of all departments of <a href="http://www.sports.ru/">Sports.ru</a> and <a href="http://by.tribuna.com/">Tribuna.com</a> gather for a retrospective of the past week and discuss plans for the current one.  Each participant talks about his field of activity, based on the data in the report, which is generated weekly from the data collected in our infrastructure.  We discuss the traffic structure, sales, competitors and the market as a whole, editorial and SMM activities, development, product, finance, IT.  The value of these meetings is solely in the synchronization of knowledge and priorities at the level of the whole company - no bureaucratic reporting under the peak. <br><br><hr><br>  ... And this is only a small part of what we already have in BigData.  We showed you our infrastructure through a keyhole with only one purpose - to inspire you to process data in your project.  This is really not as scary and expensive as it seems at first glance: we did without capital expenditures in the equipment at the start, although we spent 4 man-months of development.  We spend no more than 60 thousand rubles a month for renting servers and paying for external services.  And we assure you - the epiphany is worth it. <br><br><div class="spoiler">  <b class="spoiler_title">Pfff!</b>  <b class="spoiler_title">A post about BigData and not a single mention of MapReduce or at least the word PETABITE.</b>  <b class="spoiler_title">Cats dump from here</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bb6/e24/2cc/bb6e242cc910a395c3d480f242d03981.gif" alt="" title="Uiiiii"></div></div></div><br>  Dare! <br><br>  UPD: continuation and technical part of the post here <a href="http://habrahabr.ru/company/sports_ru/blog/216229/">http://habrahabr.ru/company/sports_ru/blog/216229/</a> </div><p>Source: <a href="https://habr.com/ru/post/212863/">https://habr.com/ru/post/212863/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../212851/index.html">We look at closed profiles in LinkedIn</a></li>
<li><a href="../212855/index.html">How would the story turn: Samsung could buy Android first</a></li>
<li><a href="../212857/index.html">Interview with Dean Hall on the DayZ development process</a></li>
<li><a href="../212859/index.html">New level of Chinese fake chips - FT232RL</a></li>
<li><a href="../212861/index.html">Scientists have been able to explain where the Martian ‚Äúwandering stone‚Äù came from</a></li>
<li><a href="../212865/index.html">Xperia Z1 Compact Review</a></li>
<li><a href="../212867/index.html">Report on the course "Data Visualization"</a></li>
<li><a href="../212869/index.html">Published rating agencies of contextual advertising from CMS Magazine</a></li>
<li><a href="../212871/index.html">Masking the class under the Boost graph. Part 3: Finding the Way</a></li>
<li><a href="../212873/index.html">Mobile application development. Why is this business?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>