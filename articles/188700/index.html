<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>"Kranik", or an algorithm for finding digits of Pi</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! Recently faced with the task of counting the number of Pi to the character whose number the user will choose. Immediately I went to Wikipedi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>"Kranik", or an algorithm for finding digits of Pi</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr!  Recently faced with the task of counting the number of Pi to the character whose number the user will choose.  Immediately I went to <a href="http://en.wikipedia.org/wiki/Pi">Wikipedia</a> , to read what kind of beast it is, this is Pi, and how to find it with a given accuracy.  Formulas describing the number of Pi, a lot.  But to solve my problem, everything in these formulas rests on either the accuracy and length of the basic language types (I chose Java), or (to solve the previous problem) in a long arithmetic, which I didn‚Äôt really want to realize. <a name="habracut"></a>  I wanted to find some kind of algorithm that allows finding the Pi number up to a given sign, and exactly up to this sign, rather than finding a long number, and then cutting it to give the user what he asked for. <br><br>  And I found such an algorithm, the very <a href="http://en.wikipedia.org/wiki/Spigot_algorithm">algorithm of "tap"</a> .  The word tap sounds strange here, but I have not found a better way to translate the name of this algorithm from English, how to translate it literally.  In general, in the original it sounds like ‚ÄúA Spigot Algorithm for the Digits of Pi‚Äù.  The authors of the algorithm and their names are the American mathematicians Stanley Rabinowitz (Stanley Rabinowitz) and Stan Wagon.  The two comrades in 1995 created their own algorithm for finding the digits of Pi.  The very idea of ‚Äã‚Äãthe algorithm came from the pen of a certain Sale (Sale) back in 1968, and that algorithm was designed to find the digits of the number e. <br><br>  In general, English-Russian dictionaries provide a translation of the word spigot as ‚Äúsleeve‚Äù.  This translation of clarity does not give any.  Therefore, I translated this word as ‚Äútap‚Äù, since spigot in English is described as a mechanism regulating the flow of fluid.  The idea of ‚Äã‚Äãthe algorithm lies in the fact that in one iteration we get exactly one digit of Pi and then we don‚Äôt use it.  That is, the figures seem to follow from the algorithm, like water from a tap. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Now the algorithm itself.  I will not get into all the mathematics (which I actually did not do when analyzing the algorithm), you can read more about it <a href="http://www.mathpropress.com/stan/bibliography/spigot.pdf">here</a> .  By the way, under this link, there is also an implementation of the algorithm for finding 1000 digits of Pi in Pascal, which I decided to use immediately because of my laziness.  Rewrote in Java, but no - it did not work.  Deduced by some incomprehensible to me rubbish.  I also threw this business, since you yourself know how to debug a code you do not know how to extinguish burning oil with water.  Therefore, I decided to sort out the algorithm myself. <br>  To find n characters of pi, you need an array of length <i>[10 * n / 3]</i> .  And integers.  The peculiarity of the algorithm is that only integer arithmetic is used.  Initialize all the cells in the array with the number <b>2</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4b4/09b/6e1/4b409b6e1ef94946a85b0dd21edcb580.jpg" alt="image"><br><br>  Further, in order to find one digit of Pi, it is necessary to go through all the cells of the array from the end to the beginning and perform simple actions.  On the example of the table, we will consider everything in order.  Suppose we want to find 3 digits of Pi.  To do this, we need to reserve <i>3 * 10/3 = 10</i> cells of integer type.  Fill them all with the number 2. Now let's start searching for the first digit ... <br><br>  We start at the end of the array.  We take the last element (number 9, if we start the score from 0. We will call this number the numerator, and the one below it in the table is the denominator) - it is 2. We multiply it by <b>10</b> <i>(2 * 10 = 20)</i> .  To the resulting number 20 we add the number from the ‚ÄúTransfer‚Äù cell - the number that is transferred from the more right-hand operation.  Of course, to the right we did not count anything, so this number is equal to 0. The result is written in the "amount".  In the "remainder" we write the remainder of dividing the sum by the denominator: <i>20 mod 19 = 1</i> .  And now we consider the ‚Äútransfer‚Äù for the next step.  It will be equal to the result of dividing the sum by the denominator multiplied by the numerator: <i>(20/19) * 9 = 9</i> .  And write the resulting number in the cell with the "transfer", standing to the left of the current column.  We perform the same actions with each element of the array (multiply by 10, calculate the sum, the remainder and transfer to the next step) until we reach the element with number 0. Here the actions are slightly different.  So, let's see what we have in the table.  Under zero, the array element is 2, and the transfer from the previous step is 10. As in the previous steps, we multiply the array element by 10 and add the transfer to it.  In total, we received 30. And now we divide the sum not by the denominator, but by <b>10</b> (!).  As a result, we get <i>30/10 = 3 + 0</i> (where 0 is the remainder).  The resulting number 3 will be the cherished first digit of Pi.  And the remainder 0 is written to the cell assigned to it.  What were the leftovers for?  They need to be used in the next iteration - to find the next digit of Pi.  Therefore, it is reasonable to store the residuals in our initial array of size <i>10 * n / 3</i> .  Thus, it is clear that the capabilities of the algorithm rest on the size of this array.  Therefore, the number of digits found is limited by the available memory of the computer or the language in which you implement the algorithm (of course, language limitations can be circumvented). <br><br>  But that's not all.  There is one nuance.  At the end of each iteration, an overflow situation may occur.  Those.  in the zero column in the "sum" we get a number greater than 100 (this situation occurs quite rarely).  Then the next number Pi is 10. Strange, yes?  After all, the numbers in the decimal number system are only from 0 to 9. In this case, instead of 10, you need to write 0, and increase the previous number by 1 (and standing before the last one, if the latter is 9, etc.).  Thus, the appearance of one ten, can change one or more of the previously found numbers.  How to track such situations?  It is necessary to consider the found new digit initially invalid.  To do this, it is enough to have one variable that will count the number of invalid digits.  Found one digit - increased the number of invalid digits by 1. If the next digit found is neither 9 nor 10, then we begin to consider the numbers found earlier (and marked as invalid) as real, i.e.  we reset the number of invalid digits to 0, and we begin to consider the found new digit as invalid (that is, we can immediately reset to 1).  If the next digit found is 9, then we increase the number of invalid digits by 1. If the next digit is 10, then we increment all invalid digits by 1, instead of 10, we write 0 and this 0 is considered invalid.  If these situations are not monitored, then single incorrect numbers (or more) will appear. <br><br>  That's the whole algorithm, which the authors compared with the crane.  Below is the code for a method implemented in Java that returns a string with the number Pi. <br><br><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">piSpigot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//        StringBuilder StringBuilder pi = new StringBuilder(n); int boxes = n * 10 / 3; //   int reminders[] = new int[boxes]; //    for (int i = 0; i &lt; boxes; i++) { reminders[i] = 2; } int heldDigits = 0; //     for (int i = 0; i &lt; n; i++) { int carriedOver = 0; //     int sum = 0; for (int j = boxes - 1; j &gt;= 0; j--) { reminders[j] *= 10; sum = reminders[j] + carriedOver; int quotient = sum / (j * 2 + 1); //      reminders[j] = sum % (j * 2 + 1); //       carriedOver = quotient * j; // j -  } reminders[0] = sum % 10; int q = sum / 10; //     //    if (q == 9) { heldDigits++; } else if (q == 10) { q = 0; for (int k = 1; k &lt;= heldDigits; k++) { int replaced = Integer.parseInt(pi.substring(i - k, i - k + 1)); if (replaced == 9) { replaced = 0; } else { replaced++; } pi.deleteCharAt(i - k); pi.insert(i - k, replaced); } heldDigits = 1; } else { heldDigits = 1; } pi.append(q); //    } if (pi.length() &gt;= 2) { pi.insert(1, '.'); //      3 } return pi.toString(); }</span></span></code> </pre> <br><br>  For the sake of interest, I conducted a test of the performance of the algorithm depending on the value of n (the number of digits to be found).  This is the result: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/930/50c/3f3/93050c3f32ed895b37418bd9cb0ccb15.png" alt="image"><br><br>  It took more than eight and a half hours to find a million digits.  I conducted tests without printing the results and used not a StringBuilder, but a byte array. <br><br>  So summarize.  The main advantages of the algorithm are its simplicity (you can count without problems and hands), as well as the use of integer arithmetic only, which speeds up the calculation process and adds accuracy.  But the main drawback I consider the limitations of the algorithm (memory). <br><br>  PS: The algorithm based on <a href="http://en.wikipedia.org/wiki/Bailey%25E2%2580%2593Borwein%25E2%2580%2593Plouffe_formula">the Bailey ‚Äì Borwein ‚Äì Plouffe formula</a> from the ‚ÄúKranikovykh‚Äù category was previously discussed at Habr√© in <a href="http://habrahabr.ru/post/179829/">this article</a> . <br><br>  <a href="http://en.wikipedia.org/wiki/Pi">http://en.wikipedia.org/wiki/Pi</a> <br>  <a href="http://en.wikipedia.org/wiki/Spigot_algorithm">http://en.wikipedia.org/wiki/Spigot_algorithm</a> <br>  <a href="http://www.mathpropress.com/stan/bibliography/spigot.pdf">http://www.mathpropress.com/stan/bibliography/spigot.pdf</a> <br>  <a href="http://www.pi314.net/eng/goutte.php">http://www.pi314.net/eng/goutte.php</a> <br>  <a href="http://en.wikipedia.org/wiki/Bailey%25E2%2580%2593Borwein%25E2%2580%2593Plouffe_formula">http://en.wikipedia.org/wiki/Bailey%E2%80%93Borwein%E2%80%93Plouffe_formula</a> <br>  <a href="http://habrahabr.ru/post/179829/">http://habrahabr.ru/post/179829/</a> </div><p>Source: <a href="https://habr.com/ru/post/188700/">https://habr.com/ru/post/188700/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../188690/index.html">The contract for the development of the site: so and not otherwise</a></li>
<li><a href="../188692/index.html">Introduction to the theory of magic</a></li>
<li><a href="../188694/index.html">What is missing indie developer?</a></li>
<li><a href="../188696/index.html">Server platform SuperMicro SYS-5017A-EF or atomic virtualization (Part 1)</a></li>
<li><a href="../188698/index.html">Beautiful background textures in iOS</a></li>
<li><a href="../188702/index.html">Convenient web server on Virtualbox</a></li>
<li><a href="../188704/index.html">Tale of a clustered index</a></li>
<li><a href="../188708/index.html">JavaScript tracing, debugging, profiling - filling gaps</a></li>
<li><a href="../188710/index.html">We write applications for Google Glass</a></li>
<li><a href="../188712/index.html">ARM assembler (continued)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>