<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Moving web portal: from monolith to microservice architecture</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We share the experience of modernizing the architecture of a web portal, which made it possible to make the product convenient, stable and fault-toler...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Moving web portal: from monolith to microservice architecture</h1><div class="post__text post__text-html js-mediator-article">  We share the experience of modernizing the architecture of a web portal, which made it possible to make the product convenient, stable and fault-tolerant: attendance increased from 350,000 to 7 million users!  The story will be useful to those who are planning to expand their product.  To begin with, let's look at what factors may hinder the work and development of the web portal: <a name="habracut"></a><br><br><ul><li>  <b>Moral obsolescence.</b>  The approach to usability, adaptation to different devices, elementary appearance and structure with time cease to respond to the needs of the audience. </li><li>  <b>Technological obsolescence.</b>  Web standards and technologies are constantly being improved.  Changes affect both developer tools (for example, frameworks, databases, other software), and the fundamentals of the web.  From the relatively recent - a massive transition from http to https and the rejection of support for outdated DNS. <br></li><li>  <b>Errors and failures.</b>  Developers may be imperfect to cope with their task and to allow flaws.  As a result, violations of the site can occur - starting with the fact that the buttons do not work the first time, until complete failure of the systems. <br></li></ul><br>  <b>Case</b> <br><br>  We were approached by a client whose web portal needed further development.  At a certain point, a ceiling of 350,000 unique visitors was reached monthly.  This seemed to be insufficient - the project clearly had prospects, and we had to figure out exactly what was in the way of further scaling the resource. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Audit</b> <br><br>  It turned out that the old Bitrix engine was not adapted to the loads and scaling.  Every one of the components of the system closely intersected and depended on each other.  Constantly eliminating errors was such a painful exercise that we proposed a flexible and understandable microservice architecture.  In them, each component is sufficiently independent that the errors inside it do not ‚Äútouch‚Äù the other elements of the system. <br><br>  The basis of the architecture remained Bitrix - at least, authorization is tied to it, but where it was possible and promised greater efficiency, we transferred the functionality to microservices.  They became the cornerstone of the project. <br><br>  The new combined architecture has provided us with a stable, faster operation of the systems and the almost complete absence of errors on some modules.  It also served as the basis for the effective work of marketers.  Thanks to the improved architecture, promotion specialists managed to increase the resource traffic by 20 times. <br><br><img src="https://habrastorage.org/webt/7d/bt/kv/7dbtkvfsxywcnuakaw_wdu92ebs.jpeg"><br><br>  <b>Microservices</b> <br><br>  In standalone microservices, we have allocated such modules as the file downloader, the search and the news feed.  In addition to these understandable to the user and the obvious things, in the form of microservices many other functional elements were implemented: <br><br><ul><li>  Uploading, storing and managing data from open source projects; </li><li>  Dynamic creation of RSS feeds; </li><li>  Dynamic creation of a system of blocks, the layout of materials of any services into structural blocks; </li><li>  Adding additional data to service materials; </li><li>  Technical support service; </li><li>  Single catalog of various data. </li></ul><br>  In addition to all of the above, we have created many microservices for convenient work with the admin panel. <br><br><img src="https://habrastorage.org/webt/mx/7t/e-/mx7te-grrfkdfydja2xll-yjc-w.png"><br><br>  Each functional block of the site has become a fairly autonomous unit.  A dedicated process is used for loading and rendering, minimizing intersection with other services. <br><br>  Agree that when a user makes a payment, he will not want to wait long for the script to download, which is responsible for playing the video it does not need in another part of the page.  Indeed, in monolithic systems this is the case ‚Äî side functionalities sometimes impede the work of truly important components. <br><br>  We took the first step and made life easier for both users and developers, releasing more than 20 new services in a year.  As a result: <br><br><ul><li>  Solved the problem of scaling. </li><li>  Implemented a more efficient development process by distributed teams. </li><li>  Set up dynamic resource management for smooth and fast system operation. </li></ul><br><br>  <b>Technology stack upgrade</b> <br><br>  In parallel, we have updated the technology stack.  If the portal was originally based on php 5.6 and MySQL 5.6, then in the course of improving the engine we translated it to php 7.0 and MySQL 5.7.  Implemented framework Yii2, provided caching memcache. <br><br><img src="https://habrastorage.org/webt/zc/zb/6b/zczb6baxnrskcroqim0i0ry1dt8.jpeg"><br><br>  <b>Task queue</b> <br><br>  In order to better parallelize the tasks, we transferred the web workers - internal processors - to the RabbitMQ queue.  It optimizes the sequence of launching events, which reduces the load on the system.  Work with the site has become much faster and more comfortable. <br><br>  <b>Continuous integration</b> <br><br>  Transparent and manageable development process supported by GitLab CI.  This is a really continuous seamless development, which leaves programmers and testers more time for important questions instead of patching holes. <br><br>  In order to minimize errors, we introduced additional development contours.  The chain consists of several contours for testing the application and the infrastructure: pre-release, where the latest build testing (pre-prod) takes place, combat (prod), several test contours for testing several builds at once, as well as a circuit for developers. <br><br>  <b>Build system</b> <br><br>  At the initial stage, builds are created from project sources.  Instead of a separate set of classes, styles, and handlers, merged entities are used ‚Äî each wrapped in a single executable file.  The assembly contains only the necessary constructions for the execution of events on the page.  This additionally provides the flexibility and speed of the site. <br><br>  <b>Error monitoring</b> <br><br>  GitLab CI gives you advanced code validation and automated testing.  At the slightest non-compliance of assemblies with the specified parameters, the system notifies developers and does not allow starting the further process of component implementation before correcting errors.  Additionally, we installed Sentry - a complete error monitoring tool. <br><br><img src="https://habrastorage.org/webt/it/ut/p8/itutp8xvbdiiouv1swb1idprlxe.png"><br><br>  <b>Process optimization</b> <br><br>  To maintain the system in a state of high performance, we have consistently optimized business processes and infrastructure.  Shared libraries and prototypes of services became the basis for the rapid introduction of new functions - we take ready-made templates and after a short time we get a working product. <br><br>  <b>Monitoring and operation</b> <br><br>  All processes - in full view.  The monitoring of the status of each node is provided by Zabbix - a comprehensive tracking system.  We got the opportunity to look into the very core of the project structure and see it compactly. <br><br>  We also connected the Grafana platform, which turns dry data into a visual dashboard for the convenience of the customer‚Äôs employees. <br><br>  <b>Stabilization and refactoring</b> <br><br>  As required, we refactored the system ‚Äî the code is simplified and concise.  At the same time, there is always room for growth, since regular finishing of systems speeds up the site.  As a result, the resource has become more search engine and user friendly. <br><br>  <b>New architecture - the basis for growth</b> <br><br>  At the start of the work, the resource had a modest potential for promotion and was not convenient enough for customers, which slowed down the company's business processes.  To improve the process of user interaction with the site, we almost completely updated the portal architecture and its structure, created a flexible mechanism that integrates with a large number of services and applications, thanks to our own API.  Many services have been working optimally for more than a year, without requiring intervention - the number of errors in their work has dropped to almost zero. <br><br>  The new site is a powerful business development tool with potential for further scaling.  Using the updated architecture of the web application, the project marketers were able to implement their range of promotional activities and increase traffic from 350,000 unique visitors per month to more than 7 million.  At the same time, after a multiple increase in the audience, the portal continues to function stably. </div><p>Source: <a href="https://habr.com/ru/post/449538/">https://habr.com/ru/post/449538/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../449526/index.html">Introducing Tartiflette: an open source implementation of GraphQL for Python 3.6+</a></li>
<li><a href="../449528/index.html">On the decomposition of the multichannel system response in "pseudo-specific" forms of oscillations</a></li>
<li><a href="../449532/index.html">ok.tech: Cassandra meetup</a></li>
<li><a href="../449534/index.html">SLA technology concept car: how it is done in China</a></li>
<li><a href="../449536/index.html">iOS digest number 4 (April 5 - April 26)</a></li>
<li><a href="../44954/index.html">Blog promotion: 50 simple ways to attract new RSS subscribers. Part 1 (1-25)</a></li>
<li><a href="../449540/index.html">Doodle shader effect</a></li>
<li><a href="../449542/index.html">Medicine moves to web, chat, and mobile apps. Talk with BestDoctor</a></li>
<li><a href="../449544/index.html">The modern world rests on the API</a></li>
<li><a href="../449546/index.html">V8: one year with Specter</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>