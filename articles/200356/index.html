<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Development of client-server infrastructure in javascript (part 2 - server and location)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, in this article I will talk about the server part and describe the process of placing the application on the openshift cloud hosting. 

 Develo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Development of client-server infrastructure in javascript (part 2 - server and location)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/c8c/465/1b0/c8c4651b03cb9d0789cd33ed8b057440.png" alt="image" align="left">  Hello, in this article I will talk about the server part and describe the process of placing the application on the openshift cloud hosting. <br><a name="habracut"></a><br>  <a href="http://habrahabr.ru/post/200192/">Development of client-server infrastructure in javascript (part 1 - client)</a> <br><br>  The server is written in nodejs using swagger-node-express.  This gives the advantage of <a href="http://myconference.php.poltava.ua/docs/">autodocumentation</a> .  I want to note that the server was created, rather, in support of the client side, so some checks and optimizations were intentionally omitted and left for the future. <br><br>  The server consists of a set of modules.  In the main file, all modules are initialized. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"express"</span></span>), swagger = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"./swagger"</span></span>), orm = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./orm'</span></span>), auth = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./auth'</span></span>), config = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./config'</span></span>), static_files = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./static'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> app = express(); app.use(express.bodyParser()); auth.init(app); orm.init(app); swagger(app); static_files(app); app.listen(config.listen, config.ipaddr);</code> </pre> <br>  Core modules.  For authentication, the http header is used, its name can be set in the parameters.  Sesia is stored in memcached, it is just matching api_key -&gt; user_id.  User verification code. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> memcache.Client(cfg.memcache.port, cfg.memcache.host); ... app.use(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res, next</span></span></span><span class="hljs-function">)</span></span>{ client.get( req.headers[cfg.header.toLowerCase()], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error, result</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(result){ req.user = result; } next(); } ); req.memcache = client; });</code> </pre><br>  To work with the database, node-orm2 is used.  I note that in package.json, add only the database driver that you will use. <br>  Connection with base and example of model description. <br><br><pre> <code class="javascript hljs">app.use(orm.express(config.db, { <span class="hljs-attr"><span class="hljs-attr">define</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">db, models</span></span></span><span class="hljs-function">) </span></span>{ db.define(<span class="hljs-string"><span class="hljs-string">"users"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">id</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>, <span class="hljs-attr"><span class="hljs-attr">email</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-attr"><span class="hljs-attr">password</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-attr"><span class="hljs-attr">twitter</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>, <span class="hljs-attr"><span class="hljs-attr">facebook</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>, <span class="hljs-attr"><span class="hljs-attr">google</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>, <span class="hljs-attr"><span class="hljs-attr">linkedin</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">validations</span></span>: { <span class="hljs-attr"><span class="hljs-attr">email</span></span>: [ orm.enforce.unique(<span class="hljs-string"><span class="hljs-string">"Email already taken!"</span></span>), orm.enforce.unique({ <span class="hljs-attr"><span class="hljs-attr">ignoreCase</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }), orm.enforce.notEmptyString() ], <span class="hljs-attr"><span class="hljs-attr">password</span></span>: orm.enforce.notEmptyString() }, <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-attr"><span class="hljs-attr">autoFetch</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> } ); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Conferences = db.define(<span class="hljs-string"><span class="hljs-string">"conferences"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">id</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>, <span class="hljs-attr"><span class="hljs-attr">title</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-attr"><span class="hljs-attr">description</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-attr"><span class="hljs-attr">datetime</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>, <span class="hljs-attr"><span class="hljs-attr">place</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-attr"><span class="hljs-attr">location</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-attr"><span class="hljs-attr">site</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-attr"><span class="hljs-attr">logo</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-attr"><span class="hljs-attr">facebook</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-attr"><span class="hljs-attr">twitter</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-attr"><span class="hljs-attr">telephone</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-attr"><span class="hljs-attr">cost</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-attr"><span class="hljs-attr">file</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> },{ <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-attr"><span class="hljs-attr">autoFetch</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> } ); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Decisions = db.define(<span class="hljs-string"><span class="hljs-string">"decisions"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">id</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>, <span class="hljs-attr"><span class="hljs-attr">decision</span></span> : [<span class="hljs-string"><span class="hljs-string">'go'</span></span>, <span class="hljs-string"><span class="hljs-string">'not go'</span></span>, <span class="hljs-string"><span class="hljs-string">'favorite'</span></span>], <span class="hljs-attr"><span class="hljs-attr">user</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>, <span class="hljs-attr"><span class="hljs-attr">conference_id</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span> },{ <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-attr"><span class="hljs-attr">cache</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">autoFetch</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> } ); Decisions.hasOne(<span class="hljs-string"><span class="hljs-string">'conference'</span></span>, Conferences, {<span class="hljs-attr"><span class="hljs-attr">reverse</span></span>: <span class="hljs-string"><span class="hljs-string">'decision'</span></span>}); } }));</code> </pre><br>  Locally and on my VPS for statics, nginx is used, but in the case of PaaS, nodejs gives the statics itself, so I created a separate handler for it.  It is necessary to give the documentation and the client himself. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> static_handler = express.static(__dirname + <span class="hljs-string"><span class="hljs-string">'/../static/'</span></span>); app.get(<span class="hljs-regexp"><span class="hljs-regexp">/^\/static(\/.*)?$/</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res, next</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (req.url === <span class="hljs-string"><span class="hljs-string">'/static'</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// express static barfs on root url w/o trailing slash res.writeHead(302, { 'Location' : req.url + '/' }); res.end(); return; } req.url = req.url.substr('/static'.length); return static_handler(req, res, next); }); var main_handler = express.static(__dirname + '/../client/www/'); app.get(/^\/(.*)$/, function(req, res, next) { if(req.url == '/cordova.js'){ return res.send(''); } if(!req.url){ req.url = 'index.html'; } return main_handler(req, res, next); });</span></span></code> </pre><br>  The cordova.js file is created by phonegap, containing functions for communicating with hardware and other platform-specific features.  The browser is simply given a stub, so the client knows that he cannot use the OS functions. <br>  Now you need to initialize the server itself. <br><br><pre> <code class="javascript hljs">app.use(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res, next</span></span></span><span class="hljs-function">) </span></span>{ res.header(<span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Origin'</span></span>, <span class="hljs-string"><span class="hljs-string">'*'</span></span>); res.header(<span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Methods'</span></span>, <span class="hljs-string"><span class="hljs-string">'GET,PUT,POST,DELETE'</span></span>); res.header(<span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Headers'</span></span>, cfg.header+<span class="hljs-string"><span class="hljs-string">', Content-Type'</span></span>); res.header(<span class="hljs-string"><span class="hljs-string">'Access-Control-Expose-Headers'</span></span>, cfg.header+<span class="hljs-string"><span class="hljs-string">', Content-Type'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (req.method == <span class="hljs-string"><span class="hljs-string">'OPTIONS'</span></span>) { res.send(<span class="hljs-number"><span class="hljs-number">200</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { next(); } }); swagger.setAppHandler(app); swagger.addModels(models); controllers.init(swagger); swagger.configure(cfg.basePath, <span class="hljs-string"><span class="hljs-string">"0.1"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Serve up swagger ui at /docs via static route var docs_handler = express.static(__dirname + '/../documentation/swagger/'); app.get(/^\/docs(\/.*)?$/, function(req, res, next) { if (req.url === '/docs') { // express static barfs on root url w/o trailing slash res.writeHead(302, { 'Location' : req.url + '/' }); res.end(); return; } // take off leading /docs so that connect locates file correctly req.url = req.url.substr('/docs'.length); return docs_handler(req, res, next); });</span></span></code> </pre><br>  That from the browser it was possible to freely use the API are given to cross-origin resource sharing headers.  Then the initialization of the swagger.  Here you need to pay attention to <br><br><pre> <code class="javascript hljs">swagger.addModels(models); controllers.init(swagger);</code> </pre><br>  These models, which are given, it is possible to say, the analogue ViewModel and Ninkak do not belong to the models described in orm.js.  In controllers.js, action handlers are written.  Example. <br><br><pre> <code class="javascript hljs">swagger.addGET(conferences.get); swagger.addGET(conferences.list); swagger.addPOST(conferences.decision); swagger.addDELETE(conferences.reject);</code> </pre><br>  How action is described.  I will sign an example of the handler for receiving the conference by id. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> get = { <span class="hljs-string"><span class="hljs-string">'spec'</span></span>: { <span class="hljs-string"><span class="hljs-string">"description"</span></span> : <span class="hljs-string"><span class="hljs-string">"Get conference by id"</span></span>, <span class="hljs-string"><span class="hljs-string">"path"</span></span> : <span class="hljs-string"><span class="hljs-string">"/conferences.{format}/{id}"</span></span>, <span class="hljs-string"><span class="hljs-string">"notes"</span></span> : <span class="hljs-string"><span class="hljs-string">"Get conference"</span></span>, <span class="hljs-string"><span class="hljs-string">"summary"</span></span> : <span class="hljs-string"><span class="hljs-string">"Get conference"</span></span>, <span class="hljs-string"><span class="hljs-string">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"GET"</span></span>, <span class="hljs-string"><span class="hljs-string">"responseClass"</span></span> : <span class="hljs-string"><span class="hljs-string">"Conference"</span></span>, <span class="hljs-string"><span class="hljs-string">"nickname"</span></span> : <span class="hljs-string"><span class="hljs-string">"conference"</span></span> }, <span class="hljs-string"><span class="hljs-string">'action'</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req,res</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!req.params.id) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> swagger.errors.invalid(<span class="hljs-string"><span class="hljs-string">'id'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> id = <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(req.params.id); req.db.models.conferences.get(id, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, conference</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(err){ res.send(<span class="hljs-number"><span class="hljs-number">500</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify({<span class="hljs-attr"><span class="hljs-attr">code</span></span>: <span class="hljs-number"><span class="hljs-number">500</span></span>, <span class="hljs-attr"><span class="hljs-attr">header</span></span>: <span class="hljs-string"><span class="hljs-string">'Internal Server Error'</span></span>, <span class="hljs-attr"><span class="hljs-attr">message</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(err)})); }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(conference){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(conference.file){ conference.file = <span class="hljs-string"><span class="hljs-string">'/static/'</span></span> + conference.file; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(req.user){ conference.getDecision({<span class="hljs-attr"><span class="hljs-attr">user</span></span>: req.user}, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, decision</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(err){ res.send(<span class="hljs-number"><span class="hljs-number">500</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(err)); }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ conference.decision = decision.pop(); res.send(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(conference)); } }); }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ res.send(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(conference)); } }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> swagger.errors.notFound(<span class="hljs-string"><span class="hljs-string">'conference'</span></span>); } } }); } };</code> </pre><br>  The ‚Äúspec‚Äù is mostly documentation information, but here is the ‚Äúpath‚Äù, that is, the url on which the handler will call express.  The main part is action.  Checks for the presence of parameters and a query to the database.  Who doesn‚Äôt like it when callbacks grow in breadth, I‚Äôll say right away that node-orm2 allows you to build chains of both request and handlers.  If files are attached to the conference, a path is generated for them.  If the user is logged in, his decision regarding the conference is sought.  This is done to save http requests, but I‚Äôll tell you honestly that I don‚Äôt know how best and more correct from the point of view of REST: attach the has-one model to the parent or return the id, and let the client send another request if he needs it. <br><br>  On this, I think, the description of work with swagger-node-express is finished.  As soon as the project began to take on a finished look, I wondered where to place it.  At first he lived on my VPS, but I‚Äôve been there all the time, so it was decided to post it on PaaS.  Because the clouds are fashionable, and more fun.  By the way, many cloud hosting offer free accounts, and many of them without time limits.  Thus, you can freely host with a dozen projects. <br><br>  Although I describe openshift in this article, I myself don‚Äôt belong to them at all and the procedures for hosting on other hosts will be very similar (it all comes down to git push).  I chose this particular hosting completely by accident. <br><br>  So first you need to register if you haven't done it yet.  Then create a project, in their documentation it is described in detail.  Especially I want to draw your attention to some things.  First of all, if you are thinking of hosting a project in the cloud, then it is better to immediately select exactly where and sharpen the project for this particular hosting.  Thus, you will get rid of reworking the project before deployment, for example, I needed to rename the main file to server.js, give support for the statics of the client application, and use an external memcached server. <br>  I moved client / www to server / www and added a directory with statics attached to conferences and swager to the same place.  Here's what the new static.js looks like. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> static_handler = express.static(__dirname + <span class="hljs-string"><span class="hljs-string">'/www/static/'</span></span>); app.get(<span class="hljs-regexp"><span class="hljs-regexp">/^\/static(\/.*)?$/</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res, next</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (req.url === <span class="hljs-string"><span class="hljs-string">'/static'</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// express static barfs on root url w/o trailing slash res.writeHead(302, { 'Location' : req.url + '/' }); res.end(); return; } // take off leading /docs so that connect locates file correctly req.url = req.url.substr('/docs'.length); return static_handler(req, res, next); }); var main_handler = express.static(__dirname + '/www/'); app.get(/^\/(.*)$/, function(req, res, next) { if(req.url == '/cordova.js'){ return res.send(''); } if(!req.url){ req.url = 'index.html'; } return main_handler(req, res, next); });</span></span></code> </pre><br>  Secondly, ask about SQL / no-SQL databases, because in some databases they are separate, and in some, openshift, for example, occupy a whole slot, and there are so few of them.  I gave Memcached to another service <a href="http://garantiadata.com/">garantiadata.com</a> , where I also created a trial account.  I have 2 slots left, by the way, yesterday the second instance of the node was also launched, which pleased me, since I was not sure that autoscaling would succeed. <br>  And yes, warmth itself. <br><br><pre> <code class="bash hljs">git add --all; git commit -m <span class="hljs-string"><span class="hljs-string">'commit'</span></span>; git push origin master</code> </pre><br>  Do not forget to add the origin, which can be obtained on the application page in openshift.  Also indicate to your application the correct host / port for service. <br><br><pre> <code class="javascript hljs">exports.listen = process.env.OPENSHIFT_NODEJS_PORT || <span class="hljs-number"><span class="hljs-number">8080</span></span>; exports.ipaddr = process.env.OPENSHIFT_NODEJS_IP || <span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>;</code> </pre><br>  The state can be <a href="http://myconfs-peinguin.rhcloud.com/haproxy-status/">monitored</a> , with git push you get a log.  And also you can go by ssh and see tail_all. <br>  Via ssh, you can also connect to the database, first looking at the connection string. <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$OPENSHIFT_POSTGRESQL_DB_URL</span></span></code> </pre><br>  That's all, the project is in the cloud, everyone is happy.  As always, I welcome criticism and suggestions. </div><p>Source: <a href="https://habr.com/ru/post/200356/">https://habr.com/ru/post/200356/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../200346/index.html">Hypervisor Vulnerabilities - Threat to Virtual Infrastructure and Cloud</a></li>
<li><a href="../200348/index.html">pacemaker: how to finish off lying</a></li>
<li><a href="../200350/index.html">Cognitive and MISiS held a school competition</a></li>
<li><a href="../200352/index.html">RESTful web API</a></li>
<li><a href="../200354/index.html">Custom Annotation Preprocessor - the creation of Android-based applications and configuration in IntelliJ IDEA</a></li>
<li><a href="../200358/index.html">Mobile Internet in Russia and the world: platforms, consumption, trends</a></li>
<li><a href="../200362/index.html">Moving to Fusion Drive (Mac OS X Mavericks)</a></li>
<li><a href="../200364/index.html">Experience from Yandex. How to make your report for autotests</a></li>
<li><a href="../200366/index.html">Selecting and editing custom primitives in MultiCAD.NET</a></li>
<li><a href="../200376/index.html">Publish Ruby, Python, Node.js, Perl and Java web applications to Azure Cloud Services</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>