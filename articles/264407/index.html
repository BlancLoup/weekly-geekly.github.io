<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Buying the best apartment with R</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many people are faced with the issue of buying or selling real estate, and an important criterion here is how not to buy more expensive or not to sell...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Buying the best apartment with R</h1><div class="post__text post__text-html js-mediator-article">  Many people are faced with the issue of buying or selling real estate, and an important criterion here is how not to buy more expensive or not to sell cheaper relative to other, comparable options.  The simplest method is comparative, focusing on the average price of a meter in a particular place and expertly adding or reducing the percentage of the cost for the advantages and disadvantages of a particular apartment. <img src="https://habrastorage.org/files/4cc/064/1a4/4cc0641a44204c7e9080db19654da76a.jpg" alt="image" align="left">  But this approach is laborious, inaccurate and will not allow to take into account the diversity of the differences of apartments from each other.  Therefore, I decided to automate the process of choosing a property using data analysis by predicting the ‚Äúfair‚Äù price.  This publication describes the main stages of this analysis, selected the best predictive model from eighteen tested models based on three quality criteria, and the best (undervalued) apartments are immediately marked on the map, all using one web application created with R. <br><br><a name="habracut"></a><br><br><h4>  <b>Data collection</b> </h4><br>  With the formulation of the problem it is clear, the question arises, where do you get the data, there are several main real estate search sites in the Russian Federation, and there is a WinNER database, which in a fairly user-friendly interface contains the maximum number of ads and allows you to upload in csv format.  But if earlier this base allowed time-based access (minutes, hours, days), then now the minimum is only 3 months access, which is somewhat redundant for an ordinary buyer or seller (although if seriously approached, then these costs can be incurred).  With this option it would be quite simple, so let's go the other way, by parsing from some real estate site.  Of the several options, I chose the most convenient well-known <i>cian.ru.</i>  At that time, the display of the data was presented in a simple tabular form, but when I tried to parse all the data on R, then I had a failure.  In some cells, the data could be underfilled, but with the standard means of the R functions I could not catch hold of anchor words or symbols, and I had to either use cycles (which is wrong for this task in R) or use regular expressions with which I am not at all familiar so I had to use an alternative.  This alternative was a great service <i>import.io</i> , which allows you to extract information from pages (or sites), has its own REST API and gives the result to JSON.  And R can and request to API to carry out and JSON to sort. <br>  Quickly accustomed to this service, I created an extractor on it, which extracts all the required information (all parameters of each apartment) from one page.  And R already goes through all the pages, calling this API for each and gluing the received JSON data into a single table.  Although <i>import.io</i> allows <i>you</i> to make a completely autonomous API, which would pass through all pages, I thought it was logical that I could not do (parsing one page) correctly put on a third-party API, and continue to do everything else in R. So, The data source is selected, now about the limitations of the future model: <br><ol><li>  Moscow city </li><li>  One type of apartment per model (that is, one-room or two-room or three-room) </li><li>  Within one metro station (as geocoding is used, and the distance to the nearest metro) </li><li>  Secondary (since the new buildings are all fundamentally different, and qualitatively differ from each other, and in the ads it either does not say, or something is written in the comments, but neither one nor the other, does not allow creating an adequate model) </li></ol>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  <b>Data overview</b> </h4><br>  As is often the case, data may contain outliers, omissions, or simply deception, when new buildings are issued as a secondary housing, or they sell land in general. <br>  Therefore, initially it is necessary to bring all the data to a "neat" form. <br><br><h5>  <i>Cheating</i> </h5><br>  Here, the main focus on the description of the announcement, if there are words clearly not related to the sample I need, these observations are excluded, this is verified by the function R <i>grep</i> .  And since in R the computations are vector, this function immediately returns the vector of valid observation values, applying it, we filter the sample. <br><br><h5>  <i>Check for missing values</i> </h5><br>  The missing values ‚Äã‚Äãare quite rare (and mainly in the "left" ads, with new buildings and land, which by this time have already been excluded), but with those that remain, it is necessary to do something.  There are two options, in general, to exclude such observations or to replace these missing values.  Since I did not want to sacrifice observations, but on the assumption that the data is not filled on the basis of the principle ‚Äúthat it is filled in, and so it is clear that this is like everything around,‚Äù I decided to replace the qualitative variables with the mode of their values, and median values.  Of course, this is not entirely correct, and it would be entirely correct to conduct a correlation relationship between observations, and fill in the gaps according to the results, but for this task I considered this to be redundant, moreover, there were few such observations. <br><br><h5>  <i>Emission check</i> </h5><br>  Emissions are even less common, and can only be quantitative, namely by price and by area.  Here, it was based on the assumption that the buyer (I) specifically knows at what price and about what footage his apartment should be, therefore, by setting the initial values ‚Äã‚Äãof the upper and lower prices, by limiting the footage, we automatically get rid of emissions.  But even if this is not the case (not to make restrictions), then upon receiving the result or by looking at the scatterplot and seeing that there is an outlier, you can make a request with updated data, thereby removing these observations, which will improve the model. <br><br><h5>  <i>Basic assumptions of the Gauss-Markov theorem</i> </h5><br><div class="spoiler">  <b class="spoiler_title">more</b> <div class="spoiler_text">  So, we have eliminated incorrect observations, further, before carrying out the analysis, we will evaluate them on the basic premises of the Gauss-Markov theorem. <br>  Looking ahead, I will say that from the model we do not want to get an interpretation of the coefficients, or a correct assessment of their confidence intervals, we need it to predict the ‚Äútheoretical‚Äù price, so some prerequisites are not critical for us. <br><ol><li>  The data model is correctly specified.  In general, yes, by eliminating outliers, incorrect declarations, replacing missing values, the model is quite adequate.  Some lax multicollinearity may be present (for example, a five-story building and there is no elevator or area - common / residential), but as I wrote above, this is not critical for prediction, moreover, it does not violate the basic premises.  For the purpose of building test models, all values ‚Äã‚Äãwere translated into dummy variables correctly, strict multicollinearity is excluded. </li><li>  All regressors are deterministic and not equal.  Yes, that's right too. </li><li>  Errors are not systematic.  True, since the OLS uses the free term, which equalizes the errors. </li><li>  The error variance is the same (homoscedasticity).  Since restrictions on the size of regressors and the dependent variable are used (the scale is comparable), heteroscedasticity is minimal, and it is again not critical for prediction (standard errors are untenable, but they are not interesting for us) </li><li>  Errors are uncorrelated (endogeneity).  There is no here, endogeneity is likely to exist (for example, apartments are ‚Äúneighbors‚Äù from one site or porch), there is some external unaccounted factor, but again for prediction, recording with endogeneity is not critical, moreover, we do not know this unaccounted factor. </li></ol><br>  The data is generally consistent with the assumptions, so you can build models. <br></div></div><br><br><h4>  <b>Set of regressors</b> </h4><br>  In addition to the variables (obtained directly from the site), I decided to add additional regressors, namely, a five-story house or not (since this is usually a very qualitative difference), and the distance to the nearest metro station (similarly).  The Google geocoding service API is used to determine the distance (I chose it as the most accurate, loyal to restrictions, and there is a ready function in R), first the addresses of apartments and subways are geocoded, the <i>geocode</i> function from the <i>ggmap</i> package.  And the distance is determined by the formula of haversinus, the finished function <i>distHaversine</i> from the package <i>geosphere</i> . <br>  The total number of regressors was 14 pieces: <br><ol><li>  Distance to metro </li><li>  total area </li><li>  Living space </li><li>  Kitchen area </li><li>  House type </li><li>  Availability and types of elevators </li><li>  Availability and types of balconies </li><li>  Number and types of bathrooms </li><li>  Where the windows go </li><li>  Phone availability </li><li>  Type of sale </li><li>  Ground floor </li><li>  Top floor </li><li>  Five-story building </li></ol><br><br><h4>  <b>Tested Predictive Analysis Models</b> </h4><br><div class="spoiler">  <b class="spoiler_title">more</b> <div class="spoiler_text">  In addition to practical personal value, it was also interesting to test different models, then I decided to choose the best model, test different samples for all simple regression models that I know, namely, the following models were tested: <br><br>  1. OLS for all regressors <br>  2. MNC with logarithmization (different options: logarithm of price and / or area and / or distance to the metro) <br>  3. OLS with inclusion and exclusion of regressors <br>  a) successive step-by-step exclusions of regressors <br>  b) direct search algorithm <br>  4. Models with fines (to reduce the influence of heteroscedasticity) <br>  a) Lasso-regression (with 2 ways to determine the parameter of fractionation - minimizing the Mallow Cp-criterion and cross-checking) <br>  b) Ridge regression (with 3 ways to find the penalty parameter - using the HKB method, LW method and cross-checking) <br>  5. The main component method <br>  a) with all regressors <br>  b) with step-by-step exclusion of regressors <br>  6. Quantile (median) regression (to reduce the effect of heteroscedasticity) <br>  7. Random Forest Algorithm <br>  The total number of models tested was 18 pieces. <br><br>  In the process of preparing the models, materials were partially used: <br>  Mastitsky S.E., Shitikov V.K.  (2014) Statistical analysis and data visualization with R. <br>  - E-book access address: <a href="http://r-analytics.blogspot.com/">r-analytics.blogspot.com</a> <br></div></div><br><br><h4>  <b>Model performance criteria</b> </h4><br><div class="spoiler">  <b class="spoiler_title">more</b> <div class="spoiler_text">  All models are fundamentally different in nature, and for many of them there is no likelihood function, therefore, internal quality criteria cannot be determined, and it is not entirely correct to rely on them to select an effective model, since they serve primarily to assess the adequacy of the model.  Therefore, we will focus on assessing the quality of models on the average difference of empirical and predicted values.  And in order to make it more interesting, and to determine the benefits (cost-effectiveness), the root-mean-square error will not always be indicative (as some observations may distort it), I used not only the usual RMSE ‚Äî the root-mean-square error, but the MAE ‚Äî and MPE - a percentage error. <br></div></div><br><br><h4>  <b>Model test results</b> </h4><br><div class="spoiler">  <b class="spoiler_title">more</b> <div class="spoiler_text">  Since the models are evaluated by different functions and the syntax of the predicted values ‚Äã‚Äãis also different, simply indicating that part of the regressors is factorial is not suitable for all models, so an additional data frame was created in which all qualitative variables were transformed into dummy variables and in this form built models.  This allows you to uniformly evaluate all models, predict new prices, and identify errors. <br>  On various random test samples (different metro stations, different type of apartments, other parameters), all of the above models were evaluated according to 3 performance criteria.  And the absolute (92%) winner by all 3 criteria turned out to be the random forest algorithm.  Also, on different samples, according to some criteria, median regression, OLS with log-price, full OLS, and sometimes Ridge with Lasso showed good results.  The results are somewhat surprising, since I thought that models with fines might turn out better than full OLS, but this was not always the case.  So a simple model (OLS) can is a better alternative than more complex ones.  Due to the fact that on different samples, according to different criteria of a place starting from the second, different models occupied, and the random forest remained the winner, I decided to use it for further work. <br>  Since one model is already used, there is no need to explicitly specify dummy variables, so we return to the original frame, indicating that the qualitative variables are factorial, this will simplify the subsequent interpretation in the diagram, and the algorithm will be simpler (although in fact ).  For the test simulation, the <i>randomForest</i> function (from the package of the same name) was used with default values, trying to change the basic complexity parameters of the <i>nodesize</i> , <i>maxnodes</i> , <i>nPerm trees</i> , determined that a slightly better minimization of forecast errors for different samples was achieved by changing the <i>nodesize</i> parameter (minimum number of nodes) to 1. So, the model is selected. <br></div></div><br><br><h4>  <b>Map Display</b> </h4><br>  The winner is determined (random forest), this model predicts ‚Äútheoretical‚Äù prices for all observations with minimal errors.  Now you can calculate the absolute, relative underestimation and output the result in the form of a sorted table, but in addition to the table view, you immediately want information, so we will display some of the best results on the map immediately.  And for this purpose in R there is a <i>googleVis</i> package intended for integration with Google mapping system (however, there is a package for Leaflet too).  I continued to use Google as well, since the obtained coordinates from their geocoding are forbidden to be displayed on other maps.  The display on the map is carried out by a single function <i>gvisMap</i> from the <i>googleVis</i> package. <br><div class="spoiler">  <b class="spoiler_title">map display code</b> <div class="spoiler_text">  <i>output $ view &lt;- renderGvis ({#view is the htmlOutput output element</i> <i><br></i>  <i>if ((err ()! = "")) return (NULL)</i> <i><br><br></i>  <i>formap3 &lt;-formap ()</i> <i><br></i>  <i>formap3 $ desc &lt;-paste0 (row.names (formap3),</i> <i><br></i>  <i>". No."</i> <i><br></i>  <i>formap3 $ number,</i> <i><br></i>  <i>"",</i> <i><br></i>  <i>formap3 $ address,</i> <i><br></i>  <i>"undervalued by",</i> <i><br></i>  <i>format (-formap3 $ abs.discount, big.mark = ""),</i> <i><br></i>  <i>"rubles (",</i> <i><br></i>  <i>as.integer (formap3 $ otn.discount),</i> <i><br></i>  <i>"%)")</i> <i><br></i>  <i>gvisMap (formap3, "coord", "desc", options = list (</i> <i><br></i>  <i>mapType = 'normal',</i> <i><br></i>  <i>enableScrollWheel = TRUE,</i> <i><br></i>  <i>showTip = TRUE))</i> <i><br><br></i>  <i>})</i> <br></div></div><br><br><h4>  <b>Web GUI</b> </h4><br>  Transferring all the required parameters via the console is slow and inconvenient, so I wanted to do everything automatically.  And traditionally, for this, you can again use R with the <i>shiny</i> , and <i>shinydashboard frameworks</i> , which have sufficient I / O controls. <br><div class="spoiler">  <b class="spoiler_title">full client-side interface code</b> <div class="spoiler_text">  <i>dashboardPage (</i> <i><br></i>  <i>dashboardHeader (title = "Mining Property v0.9"),</i> <i><br><br></i>  <i>dashboardSidebar (</i> <i><br></i>  <i>sidebarMenu (</i> <i><br><br></i>  <i>menuItem ("Source data", tabName = "Source"),</i> <i><br></i>  <i>menuItem ("Summary", tabName = "Summary"),</i> <i><br></i>  <i>menuItem ("Raw data", tabName = "Raw"),</i> <i><br></i>  <i>menuItem ("Tidy data", tabName = "Tidy"),</i> <i><br></i>  <i>menuItem ("Predict data", tabName = "Predict"),</i> <i><br></i>  <i>menuItem ("Plots", tabName = "Plots"),</i> <i><br></i>  <i>menuItem ("Result map", tabName = "Map")</i> <i><br></i>  <i>)</i> <i><br></i>  <i>),</i> <i><br></i>  <i>dashboardBody (</i> <i><br></i>  <i>tags $ head (tags $ style (HTML ('. box {overflow: auto;}')))</i> <i><br><br></i>  <i>tabItems (</i> <i><br><br></i>  <i>tabItem ("Source",</i> <i><br><br><br><br><br><br></i>  <i>box (width = 12,</i> <i><br><br><br><br><br></i>  <i>fluidRow (</i> <i><br></i>  <i>column (width = 4,</i> <i><br><br><br></i>  <i>selectInput ("Metro", "Metro", "", width = '60% '),</i> <i><br></i>  <i># br (),</i> <i><br></i>  <i>hr ()</i> <i><br><br></i>  <i>#checkboxInput ("Kind.home0", "all", TRUE),</i> <i><br></i>  <i>checkboxGroupInput ("Kind.home", "Type of house", c (</i> <i><br></i>  <i>"Panel" = 1,</i> <i><br></i>  <i>"Stalin" = 7,</i> <i><br></i>  <i>‚ÄúShield‚Äù = 8,</i> <i><br></i>  <i>‚ÄúBrick‚Äù = 2,</i> <i><br></i>  <i>"Monolithic" = 3,</i> <i><br></i>  <i>"Brick-monolithic" = 4,</i> <i><br></i>  <i>‚ÄúBlock‚Äù = 5,</i> <i><br></i>  <i>"Wooden" = 6), selected = c (1,2,3,4,5,6,7,8)),</i> <i><br></i>  <i>hr ()</i> <i><br></i>  <i>sliderInput ("Etag", "Floor", min = 0, max = 100, value = c (0, 100), step = 1),</i> <i><br></i>  <i>checkboxInput ("EtagP", "not last"),</i> <i><br></i>  <i>sliderInput ("Etagn", "In the house of floors", min = 0, max = 100, value = c (0, 100), step = 1)</i> <i><br><br><br></i>  <i>,</i> <i><br><br><br></i>  <i>submitButton (‚ÄúAnalyze‚Äù, icon (‚Äúrefresh‚Äù))</i> <i><br><br><br></i>  <i>),</i> <i><br><br></i>  <i>column (width = 4,</i> <i><br></i>  <i>selectInput ("Rooms", "Rooms", c</i> <i><br></i>  <i>("",</i> <i><br></i>  <i>"1" = "&amp; room1 = 1",</i> <i><br></i>  <i>"2" = "&amp; room2 = 1",</i> <i><br></i>  <i>"3" = "&amp; room3 = 1"), width = '45% ')</i> <i><br></i>  <i># br (),</i> <i><br></i>  <i>hr ()</i> <i><br></i>  <i># br (),</i> <i><br></i>  <i>selectInput ("Balcon", "Balcony",</i> <i><br></i>  <i>c ("can be without a balcony" = "0",</i> <i><br></i>  <i>"Only with a balcony" = "&amp; minbalkon = 1",</i> <i><br></i>  <i>"Only without a balcony" = "&amp; minbalkon = -1"),</i> <i><br></i>  <i>width = '45% '),</i> <i><br><br></i>  <i>br ()</i> <i><br></i>  <i>hr ()</i> <i><br></i>  <i>br ()</i> <i><br></i>  <i>#br ()</i> <i><br></i>  <i>sliderInput ("KitchenM", "Kitchen Area", min = 0, max = 25, value = c (0, 25), step = 1),</i> <i><br></i>  <i>sliderInput ("GilM", "Living space", min = 0, max = 100, value = c (0, 100), step = 1),</i> <i><br></i>  <i>sliderInput ("TotalM", "Total. area", min = 0, max = 150, value = c (0, 150), step = 1)</i> <i><br><br><br><br><br></i>  <i>),</i> <i><br><br></i>  <i>column (width = 4,</i> <i><br><br><br></i>  <i>sliderInput ("Price", "Price", min = 0, max = 50000000, value = c (0, 50000000), step = 100000, sep = ""),</i> <i><br></i>  <i># hr (),</i> <i><br></i>  <i>selectInput ("Deal", "type of transaction",</i> <i><br></i>  <i>c ("any" = "0",</i> <i><br></i>  <i>"Free." = "&amp; Sost_type = 1",</i> <i><br></i>  <i>"Alternative" = "&amp; sost_type = 2"),</i> <i><br></i>  <i>width = '45% '),</i> <i><br></i>  <i>br ()</i> <i><br></i>  <i>hr ()</i> <i><br></i>  <i>#br ()</i> <i><br></i>  <i># br (),</i> <i><br></i>  <i># br (),</i> <i><br></i>  <i>radioButtons ("wc", "Bathroom",</i> <i><br></i>  <i>c ("no matter" = "",</i> <i><br></i>  <i>‚ÄúSplit‚Äù = "&amp; minsu_r = 1",</i> <i><br></i>  <i>"Combined" = "&amp; minsu_s = 1")),</i> <i><br><br></i>  <i>hr ()</i> <i><br></i>  <i>selectInput ("Lift", "Lifts (minimum)",</i> <i><br></i>  <i>c ("0" = 0,</i> <i><br></i>  <i>"1" = "&amp; minlift = 1",</i> <i><br></i>  <i>"2" = "&amp; minlift = 2",</i> <i><br></i>  <i>"3" = "&amp; minlift = 3",</i> <i><br></i>  <i>"4" = "&amp; minlift = 4"</i> <i><br><br></i>  <i>),</i> <i><br></i>  <i>width = '45% '),</i> <i><br></i>  <i>hr ()</i> <i><br></i>  <i>selectInput ("obs", "Display apartments on the map:", c (1:10), selected = 5, width = 250),</i> <i><br></i>  <i>textOutput ("flat")</i> <i><br><br><br></i>  <i>)</i> <i><br><br></i>  <i>),</i> <i><br></i>  <i>fluidRow (htmlOutput ("hyperf1")),</i> <i><br></i>  <i>fluidRow (textOutput ("testOutput"))</i> <i><br></i>  <i>)</i> <i><br><br><br><br><br></i>  <i>),</i> <i><br></i>  <i>tabItem ("Raw", box (dataTableOutput ("Raw"), width = 12, height = 600)),</i> <i><br></i>  <i>tabItem ("Summary", box (verbatimTextOutput ("Summary"), width = 12, height = 600)),</i> <i><br></i>  <i>tabItem ("Tidy", box (dataTableOutput ("Tidy"), width = 12, height = 600)),</i> <i><br></i>  <i>tabItem ("Predict", box (dataTableOutput ("Predict"), width = 12, height = 600)),</i> <i><br></i>  <i>tabItem ("Plots", box (width = 12, plotOutput ("RFplot", height = 275), plotOutput ("r2", height = 275))),</i> <i><br></i>  <i>tabItem ("Map", box (width = 12, htmlOutput ("view"), DT :: dataTableOutput ("formap2"), height = 600))</i> <i><br><br></i>  <i>)</i> <i><br></i>  <i>)</i> <i><br><br></i>  <i>)</i> <br></div></div><br><br>  The result of all this becomes a convenient GUI application, with actually two (the remaining items for control) the main items on the side menu - the first and the last.  In the first ( <i>Source data</i> ) item of the side menu (Fig. 1), all required parameters are set (similar to cian) for searching and evaluating apartments. <br><br><img src="https://habrastorage.org/files/e1d/ddb/ad7/e1dddbad79a445559c0d789a7ff7ddb4.png" alt="image"><br>  Fig.1 Window of the selected menu <i>Source data</i> <br><br>  The remaining items on the side menu display: <br><ul><li>  Summary Report on Regressors </li><li>  data tables ( <i>Raw</i> ( <i>Raw data</i> ) - original after parsing, neat ( <i>Tidy data</i> ) - after adjusting the parameters to a neat look and adjusting the parameters and adding geolocation, and the final ( <i>Predict data</i> ) table with the predicted prices) </li><li>  three diagrams ( <i>Plots</i> ) (Fig. 2) ‚Äîthe accuracy of the model and the importance of the regressors in the random forest algorithm (almost always all the regressors are important) and the scatter diagram of the original and predicted prices. </li></ul><br><br><img src="https://habrastorage.org/files/638/683/596/6386835967f246b1b00a68bb6e48f70f.png" alt="image"><br>  Fig.2 Window of the selected menu <i>Plots</i> <br><br>  Well, in the last paragraph ( <i>Result map</i> ) (Fig. 3), this is the reason for which everything was started, a map with the best results selected and a table with the calculated predicted price and the main characteristics of the apartments. <br><br><img src="https://habrastorage.org/files/fd8/6a8/14d/fd86a814d755492aa2ae0fe21f5643de.png" alt="image"><br>  Fig.3 Window of the selected menu <i>Result map</i> <br><br>  Also in this table immediately there is a link (*) to go to this ad.  This integration (the inclusion of JS elements in the table) allows you to make a package <i>DT</i> . <br><br><h4>  <b>Conclusion</b> </h4><br>  Summarizing all the above, how does it all work: <br><ol><li>  On the first page using the controls set the original request </li><li>  Based on the selection of these input elements, a query string is formed (also indicated as a hyperlink for verification) </li><li>  This line with the page is passed to the <i>import.io</i> API (in the process of creating all of this, cian began to change the output interface, thanks to <i>import.io,</i> I retrained the extractor within literally 5 minutes) </li><li>  Processing received JSON from API </li><li>  All pages are scrolled (in the process of work, the status bar by processes is displayed) </li><li>  Tables are glued together, checked (incorrect values ‚Äã‚Äãare eliminated, missing values ‚Äã‚Äãare replaced), are given in a uniform form suitable for analysis </li><li>  Geocoding addresses and determining distances </li><li>  Model is built using random forest algorithm. </li><li>  Predicted prices, absolute, relative deviations are determined. </li><li>  The best results are displayed on the map and in the table below (the number of apartments to be displayed is indicated on the first page) </li></ol><br>  The entire operation of the application (from the beginning of the request to display on the map) is performed in less than a minute (most of the time is spent on geolocation, the restriction of Google for residential use). <br><br>  This publication wanted to show how for simple domestic needs, in the framework of one application, we managed to solve many small, but fundamentally different interesting subtasks: <br><ul><li>  crawling </li><li>  parsing </li><li>  integration with third-party API </li><li>  JSON processing </li><li>  geocoding </li><li>  working with different regression models </li><li>  evaluation of their effectiveness in different ways </li><li>  geolocation </li><li>  map display </li></ul><br>  Everything else is implemented in a convenient graphical application, which can be both local and hosted on the network, and all this is done on one R (not counting <i>import.io</i> ), with a minimum of lines of code with a simple and elegant syntax.  Of course, something is not taken into account, for example, the house near the highway or the condition of the apartment (since there is no such thing in the ads), but the final, ranked list of options immediately displayed on the map and referring to the original ad itself, greatly facilitate the choice of apartments, Well, plus to everything I learned a lot of new things in R. </div><p>Source: <a href="https://habr.com/ru/post/264407/">https://habr.com/ru/post/264407/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../264395/index.html">Debugging the rules of RewriteRule, or a little about the intimate life of mod_rewrite</a></li>
<li><a href="../264397/index.html">Pipeline with spark.ml</a></li>
<li><a href="../264399/index.html">The digest of interesting materials for the mobile # 115 developer (August 2-9)</a></li>
<li><a href="../264401/index.html">IBM Launches 50 Projects for the Open Source Developer Community</a></li>
<li><a href="../264405/index.html">Ministry of Defense accused of sending sensitive information through public postal services</a></li>
<li><a href="../264409/index.html">Min-plus polynomials, cyclic games, and Hilbert's theorem on zeros</a></li>
<li><a href="../264411/index.html">The rhythm of the gameplay - why do we need a base</a></li>
<li><a href="../264415/index.html">Implementing web consoles in the jvm process using the SonarQube example</a></li>
<li><a href="../264417/index.html">Proper use of Exception in PHP</a></li>
<li><a href="../264419/index.html">Method of Lyapunov functions in the problem of the Janibekov effect</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>