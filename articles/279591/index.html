<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Our experience of using photogrammetry in the development of a computer game (Part 1)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article will discuss photogrammetry and its use in creating content for a three-dimensional computer game in the Half-Life universe, which we hav...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Our experience of using photogrammetry in the development of a computer game (Part 1)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/a1d/629/d52/a1d629d5295edf7406ab6646c56cc920.jpg" alt="image"><br><br>  This article will discuss photogrammetry and its use in creating content for a three-dimensional computer game in the Half-Life universe, which we have been developing for more than a year. <a name="habracut"></a><br><br><h3>  Introduction </h3><br>  First, a little theory for those who have come across this term for the first time.  Photogrammetry is a scientific and technical discipline that determines the shape, size, position and other characteristics of objects from their photographic images.  There are two main areas in photogrammetry: the creation of maps and plans of the Earth (and other space objects) from photographs (phototopography), and the solution of applied problems in architecture, construction, medicine, criminology, etc.  (ground, applied photogrammetry). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the case of 3D graphics, this term usually implies the process of obtaining a three-dimensional model of the object and information about the color of the diffuse reflection from it (or simply about the color of the object) on the basis of many photographs of this object taken from different angles.  As a rule, the process itself is carried out automatically in several stages with the help of special programs, but the final quality largely depends on how skillfully the original photos were taken. <br><br><h3>  Why did we decide to use photogrammetry? </h3><br>  If only because it is interesting.  Plus, we have already conducted several experiments on photogrammetry of various subjects and even gained little experience, but we wanted to unleash the full potential of this technology for creating content. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/071/8cf/4eb/0718cf4eb7a7eb02a651b3c153835f71.jpg" alt="image"><br><br>  We will tell about the main reason in more detail.  The action of the game ‚ÄúLost Story: The Last Days of Earth‚Äù will unfold over a vast territory, the player will have to overcome dozens of kilometers, and from the very beginning it became clear to us that open spaces and natural locations will take at least half of this journey. <br><br>  The appearance of natural locations consists of several main components: the texture of the sky above your head, the texture of the earth under your feet and the models of animate and inanimate nature that surround you.  We faced a problem - how to implement all these components by a small team and at the same time get the best quality environment at the output?  About the sky, we will talk separately in the following diaries, but now we will focus on the other components. <br><br>  So, we began to sort out the options.  The creation of ordinary low-poly models and the use of photo-textures - quickly, but the result is very low quality, especially in natural objects.  Creating a high-poly model by hand for each stump, stone and tree trunk - qualitatively, but incredibly long for a small team - these are dozens of models that have to be painstakingly done manually. <br><br>  As a result, we decided to experiment - to use photogrammetry in order to create several natural textures and models from beginning to end and find out all the pitfalls of this method.  In addition, check whether he really allows you to create content of the highest level, using a minimum of command resources. <br><br><h3>  Shooting on location </h3><br>  We began our shooting with a few test forays into the nearby forest parks.  We tried to choose cloudy days to get suitable diffused lighting.  Of course, it is impossible to completely get rid of shadows in kind and a small shading of the object on the border with the ground is permissible. <br><br>  But what really should be avoided when shooting for photogrammetry is strong variations of bright and dark areas on the surface of the subject.  This variation is obtained in clear and sunny weather and clear shadows, and ultimately leads to the fact that all the shadows and highlights appear on the texture in the game, and the subject will be almost impossible to fit into the scene with a different lighting. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/486/971/753/48697175324ce26d565567c936c7c9b1.jpg" alt="image"><br><br>  In general, shooting on location does not cause any particular difficulties, and one person can capture 4-5 objects in one working day, and if you work in a pair, you can have more than 10, which is quite impressive.  In addition to dependence on the weather, there was only one more unpleasant moment - in order to find interesting objects you sometimes climb into the thicket of the forest.  There, as a rule, it is impossible to work even with monopods and you have to work wonders of acrobatics and stretching. <br><br>  After several of our raids, we now know exactly how the famous action movie actor 90x trained in the photo above. <br><br><h3>  Shooting in the "studio" </h3><br>  On the shooting in the "studio" we thought, when it became clear that the stones shot on location, is not too convenient to use to create levels.  The fact is that most of the boulders sit deep in the ground and in the final model one of the six sides will be completely absent.  Because of this, it is difficult to work with such boulders when creating a location.  The ‚Äúhole‚Äù at the base of such a stone limits the angles of rotation, which in turn prevents the use of copies of models close to each other - it is very noticeable that this is the same model.  For all these reasons, it was decided to collect several small stones with an interesting texture and shoot them in the ‚Äústudio‚Äù. <br><br>  Why do I write ‚Äústudio‚Äù in quotes?  Yes, because the shooting was done at home, where we created an improvised ‚Äústudio‚Äù from scrap materials!  For high-quality shooting you need a lot of light, which of course is not enough in an ordinary apartment, so you had to go shopping.  After visiting a couple of photo shops and putting a mean male tear on the price tags of professional lighting equipment, we did not lose heart and decided to act differently. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a55/2d6/3fb/a552d63fb3126bf1c94bfd0b70ba6c8b.jpg" alt="image"><br><br>  After a couple of days and several trips to the construction stores, the ‚Äústudio‚Äù was ready.  With the help of our crazy hands: six white sheets turned into Aladdin's tent - he is a soft box to scatter light;  plugs for the socket, convenient switches and supports were added to the powerful street lamps;  from three metal legs, a small tabletop and fabric turned out to be a comfortable stand. <br><br>  Well, the final touch was a homemade pedestal with ‚Äúfamous‚Äù fifteen-centimeter self-tapping screws, which allows you to get uniform diffused lighting, shoot the object from all sides and, as a result, get a completely closed model without holes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/486/229/c5a/486229c5a2637f55b5c9e5c2d1219567.jpg" alt="image"><br><br>  Shooting in the "studio" go slower, because  the light is much smaller than outside and you have to use a tripod.  Nevertheless, in one working day you can shoot 3-4 objects.  The main difficulty is the monotony of the process, but we did manage and shot a dozen stones, as well as several other items. <br><br><h3>  Photo processing </h3><br>  The next step after the shooting is photogrammetry itself.  We additionally process all photos before loading into the program for photogrammetry, trying to remove the remnants of shadows and highlights.  The process itself takes place in several stages, each of which requires a special adjustment, which can take sufficient time if you have little experience or if the original photos are of poor quality.  We already had a little experience, so the whole process of processing one object took about 2 hours on a regular gaming computer of last year‚Äôs assembly. <br><br>  As a result of processing, we received models with polygons from 9 to 13 million triangles and an albedo map of 16,384 pixels for each model (presented below). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/62d/b65/0a7/62db650a7515e6a39d2bdc8755e2d7b0.jpg" alt="image"><br><br>  At the same time, as you can see, with those stones that we shot in the ‚Äústudio‚Äù we managed to achieve complete isolation of the polygonal mesh, and thanks to the use of masks for photographs, no trace remains of the screws that held the stones. <br><br><h3>  results </h3><br>  After obtaining high-poly models, the process is not much different from the process of creating high-quality content for games using conventional methods, there are only small nuances.  First, on some high-poly models, small relief defects were corrected, then low poly models were created for the game engine on the basis of high-poly models in the retopology process. <br><br>  It is worth noting, however, that due to the fact that natural objects have a chaotic surface, the retopology was carried out almost completely in automatic mode.  Another small difference: after creating a UV sweep, from a high-poly model besides the usual information (relief, shading, bending of a surface, etc.), the albedo map was transferred to the texture coordinates of the low-poly model. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/949/045/74d/94904574d0c5cd4f9f77a5f3ee35a65f.jpg" alt="image"><br><iframe src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://gfycat.com/ifr/BackAlarmedKagu&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjIuaQa_6379HOI3b-G3HGIAP1jFA" frameborder="0" scrolling="no" width="560" height="315" style="-webkit-backface-visibility: hidden;-webkit-transform: scale(1);"></iframe><br><br>  The final stage of the work was the preparation of materials and models for the engine and setting the color of the albedo map so that all models would better fit each other and fit into the environment.  But that is not all!  In the final, we had another small experiment. <br><br>  Our stone models have a closed geometry, which means that we can position them at any angle.  At the same time, there is no moss on the texture of our stones, but we have a separate material of moss, also obtained using photogrammetry (for details, see the second part for details).  Thus, we can impose moss from any side of our stones and get even more variations on how they will look! <br><br>  ‚ÄúBut the moss must be fluffy!‚Äù - you will say.  Right!  It was here that we remembered the Play Station 2 method of the times, namely, the multilayer geometry with the alpha channel.  The result was quite satisfactory for us: it looks great, but it almost does not require resources!  So, working on photogrammetry, we have a method for creating fluffy materials, be it moss, nap or even wool. <br><br>  The final low poly models you can see above and below.  Their render is as close as possible to how they will look in the game.  Screenshots of the same game with the final models are waiting for you in the second part of this diary, which will be published a little later. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e55/e13/edd/e55e13eddfb09738b413057e13c1cc5e.jpg" alt="image"><br><iframe src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://gfycat.com/ifr/AnguishedTameIridescentshark&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgtMp57Gbbltlo7ps5aHBeCWrlUKA" frameborder="0" scrolling="no" width="560" height="315" style="-webkit-backface-visibility: hidden;-webkit-transform: scale(1);"></iframe><br><br>  In conclusion, I would like to note that according to our calculations, it took us an average of 2-3 days to get one final model from the photos (not taking into account the time for shooting).  In this case, only one 3D artist was engaged in this, and this is impressive, considering the final quality. <br><br>  I hope the first part of the article was interesting.  Do not forget to share your opinions in the comments and expect the <a href="https://habrahabr.ru/post/280119/">second part of the diary</a> . </div><p>Source: <a href="https://habr.com/ru/post/279591/">https://habr.com/ru/post/279591/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../279577/index.html">Why did Citrix not become the ‚Äúnew Red Hat‚Äù in the virtualization market? Part 1</a></li>
<li><a href="../279579/index.html">XData Studio Assist - autocompletion in XData blocks of InterSystems Cach√© classes</a></li>
<li><a href="../279585/index.html">Full-text fuzzy search using the Wagner-Fisher algorithm</a></li>
<li><a href="../279587/index.html">Game Industry Digest: February</a></li>
<li><a href="../279589/index.html">Free Cluster (Proxmox + Nexenta)</a></li>
<li><a href="../279595/index.html">L10n lines in applications (javascript)</a></li>
<li><a href="../279597/index.html">The best technological videos of Channel 9 of this week, March 18</a></li>
<li><a href="../279601/index.html">Setting up LaTeX templates for Jupyter notebook</a></li>
<li><a href="../279603/index.html">ICQ Contest. The results of the competition for the redesign of the mobile application</a></li>
<li><a href="../279607/index.html">HabroStatistics - at what time is it better to publish an article on Habr√©?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>