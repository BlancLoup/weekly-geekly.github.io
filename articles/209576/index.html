<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Translation of Henrik Knberg's article ‚ÄúATDD from Trenches‚Äù (ATDD with advanced)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Original: www.infoq.com/articles/atdd-from-the-trenches 

 ATDD with advanced 
 Development through acceptance testing for beginners 


 If you have e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Translation of Henrik Knberg's article ‚ÄúATDD from Trenches‚Äù (ATDD with advanced)</h1><div class="post__text post__text-html js-mediator-article">  Original: <a href="http://www.infoq.com/articles/atdd-from-the-trenches">www.infoq.com/articles/atdd-from-the-trenches</a> <br><br><h4>  ATDD with advanced </h4><br><h5>  Development through acceptance testing for beginners </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/b3f/8e3/756/b3f8e37562e6d7f8daa6b78951c58002.png" alt="image"><br><br>  If you have ever been in such a situation: <br><img src="https://habrastorage.org/getpro/habr/post_images/c6c/88c/88f/c6c88c88f60cb0095ad6ed9e856e638c.png"><br>  Then this article is for you - a concrete example of how to start development through acceptance tests (Acceptance-test driven development) in existing projects with legacy code.  It describes one of the ways to <a href="http://blog.crisp.se/2013/07/12/henrikkniberg/the-solution-to-technical-debt">solve the technical debt problem</a> . <br>  This is an example from a real project, with all the flaws and flaws, and not a polished exercise from the book.  So wear your berets.  I will use Java and JUnit, without any fashionable third-party libraries (which, as a rule, are abused). <br>  <b>Warning:</b> I am not claiming that this is the only Right Path, there are many other ATDD ‚Äústyles‚Äù.  Also in this article there is not much of something new and innovative; here, well-proven approaches and first-hand experience are described well. <br><a name="habracut"></a><br><h5>  What i wanted to do </h5><br>  A few days ago I started doing password protection for <a href="http://webwhiteboard.com/">webwhiteboard.com</a> (my project is a hobby).  Users have long been asking to add the ability to password protect virtual whiteboards, so it's time to do it. <br>  It sounds simple in words, but in fact there are quite a few design changes to be made.  So far, it was assumed that webwhiteboards.com is used by anonymous users, without any logins and passwords.  Who should be able to protect the board with a password?  Who can access it?  What if I forget my password?  How to implement it in a simple, but at the same time reliable enough way? <br>  The webwhiteboard code is well covered by unit tests and integration tests. <br>  But acceptance tests, that is, tests that pass through all layers from the end user's point of view, are completely absent. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Consider the design </h5><br>  The main purpose of webwhiteboard design is simplicity: minimize the need to enter a password, not create accounts, fewer other stimuli.  So I set two limits on a password-protected board: <br><ul><li>  An anonymous user cannot protect the board with a password.  But he can open an already protected board.  He will not need to log into the system, but only need to enter the password of the protected board. </li><li>  Manage logins and passwords will be the external OpenId / Oauth component, originally intended by Google.  Thus, the user does not have to create another account. </li></ul><br><br><h5>  Implementation approach </h5><br>  There is a lot of uncertainty.  I did not know how this should work, let alone how to implement it.  Here is what I decided to do (actually ATDD): <br><ul><li>  <b>Step 1.</b> Document the expected process. </li><li>  <b>Step 2.</b> Turn it into a run acceptance test </li><li>  <b>Step 3.</b> Run the acceptance test, make sure that it fell </li><li>  <b>Step 4.</b> Repair the acceptance test </li><li>  <b>Step 5.</b> Clean the code </li></ul><br>  These steps are repeated many times.  At each step, I may need to go back and correct the previous step (which I did quite often). <br><br><h5>  Step 1: Document the Expected Process </h5><br>  Imagine that the functionality is Ready.  Like an angel came down from heaven and did everything while I slept.  Sounds too good to be true!  How can I check that the work has been done?  Which script to check first?  Let's get this one: <br><ol><li>  I create a new board </li><li>  I set a password on it </li><li>  Joe is trying to open my board, the system asks for a password. </li><li>  Joe enters the wrong password, access denied </li><li>  Joe tries again, enters the correct password and gains access.  (You have to understand that ‚ÄúJoe‚Äù is me, just from another browser). </li></ol><br>  Having written this small test script, I realized that there are still many alternative scenarios that need to be taken into account.  But this is the main scenario and if I get it to work, I will take a big step forward. <br><br><h5>  Step 2: Turn it into a run acceptance test </h5><br>  It is not so easy.  There are no other acceptance tests, so where should I start?  The new functionality will interact with some external component responsible for authentication (I first decided to use Janrain).  There will also be a database and a bunch of complicated web stuff with pop-up dialog boxes, tokens, transitions between pages and all that.  Uff. <br>  It's time to take a step back.  Before solving the problem ‚Äúhow do I write an acceptance test‚Äù, I need to solve a simpler problem ‚Äúhow do I write acceptance tests with existing code‚Äù? <br>  To answer this question, I will first write a test for the ‚Äúsimplest scenario‚Äù of those that are already in the system. <br><br><h5>  Step 2.1 Write the easiest automatic acceptance test </h5><br>  Here is the script I started with: <br><ol><li>  Try to open a non-existent board </li><li>  Check that I can't see her </li></ol><br>  How to write such a test?  With what framework?  What kind of tools?  Should I test through the user interface or not?  Should I include client code in testing or directly call the service? <br>  A bunch of questions.  Trick: do not answer them!  Just pretend that everything is already magically done and just write a test on pseudocode.  For example: <br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AcceptanceTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openWhiteboardThatDoesntExist</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//1.     //2. ,       } }</span></span></code> </pre> <br>  I launched it and it passed!  Hooray!  Um, but wait, this is wrong!  The first step in the TDD triangle (‚ÄúRed - Green - Refactoring‚Äù) is Red.  So I need to first make the test fall, to prove that this requirement has not yet been implemented. <br><img src="https://habrastorage.org/getpro/habr/post_images/907/cbe/445/907cbe445a74d5d1243a4ccb8a796288.png"><br>  Perhaps I'll start by writing some real code.  But nevertheless, pseudocode helped me take a step in the right direction. <br><br><h5>  Step 2.2 Make the simplest automatic acceptance test Red </h5><br>  To do this, I invented the AcceptanceTestClient class and pretended that it magically solved all the problems and provides me with an excellent high-level interface for running my acceptance tests.  How easy it is to use it: <br>  client.openWhiteboard ("xyz"); <br>  assertFalse (client.hasWhiteboard ()); <br>  As soon as I wrote this code, I actually came up with the interface that best suits the script of my test.  There should be about as many lines of code in the test as there were in the pseudocode. <br>  Next, using the Eclipse hotkeys, I automatically generated an empty AcceptanceTestClient class and the methods I need: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AcceptanceTestClient</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openWhiteboard</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String string)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// TODO Auto-generated method stub } public boolean hasWhiteboard() { // TODO Auto-generated method stub return false; } }</span></span></code> </pre><br>  This is how the test class looks like: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AcceptanceTest</span></span></span><span class="hljs-class"> </span></span>{ AcceptanceTestClient client; <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openWhiteboardThatDoesntExist</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//1.     client.openWhiteboard("xyz"); //2. ,       assertFalse(client.hasWhiteboard()); } }</span></span></code> </pre><br>  The test starts, but crashes (because the client is null).  Good! <br>  What have I achieved?  Not to say much.  But this is the beginning.  Now I have an embryo helper class for acceptance tests - AcceptanceTestClient. <br><br><h5>  Step 2.3.  Make the simplest automatic acceptance test green </h5><br>  The next step is to make the acceptance test green. <br><img src="https://habrastorage.org/getpro/habr/post_images/c41/af3/e2b/c41af3e2b65449340c3000ce6f625342.png"><br>  Now I need to solve a much simpler problem.  I do not need to worry about authentication, nor about several users, about anything like that.  I can add tests for these scripts later. <br>  As for AcceptanceTestClient, its implementation was pretty standard - a fake (mock) database (I already had the code for this) and launching a version of the entire webwhiteboard system in memory. <br>  Here is the setting: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/524/2bb/42a/5242bb42a2e62336ed9d8549e4ab3a88.jpg"></a> <br>  (Click on the picture to enlarge) <br>  Technical details: Web Whiteboard uses the GWT (Google Web Toolkit).  Everything is written in Java, but GWT automatically translates client code into javascript, and magically inserts RPC (Remote Procedure Calls) calls to hide all the low-level details of the implementation of asynchronous client-server interaction. <br>  Before running the acceptance test, I ‚Äúclose‚Äù the system directly and cut out all the frameworks, external components and network interaction. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/b4f/59b/cf1/b4f59bcf15acdcaa2c571ce076f6a1a2.jpg"></a> <br>  (Click on the picture to enlarge) <br>  So I create AcceptanceTestClient, which talks to the webwhiteboard service in the same way as real client code would.  The differences are hidden behind the curtains: <br><ul><li>  The real client communicates with the web whiteboard service interface, which runs in the GWT environment, which automatically turns calls into RPC and sends them to the server. </li><li>  The acceptance test also communicates with the web interface of the web whiteboard service, but it directly calls the service implementation, without RPC and, therefore, GWT is not used during the test run. </li></ul><br>  In addition, AcceptanceTestClient in its configuration replaces the real mongo database (cloud NoSQL database) with a fake that stores data in RAM. <br>  The main reason for replacing all dependencies is to simplify the environment, speed up the execution of tests, and make sure that the tests cover business logic in isolation from all components and network connections. <br>  It may seem that all this configuration is too complicated, but in fact it is just one init method, consisting of only 3 lines of code. <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AcceptanceTest</span></span></span><span class="hljs-class"> </span></span>{ AcceptanceTestClient client; <span class="hljs-meta"><span class="hljs-meta">@Before</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initClient</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ WhiteboardStorage fakeStorage = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FakeWhiteboardStorage(); WhiteboardService service = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WhiteboardServiceImpl(fakeStorage); client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AcceptanceTestClient(service); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openWhiteboardThatDoesntExist</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ client.openWhiteboard(<span class="hljs-string"><span class="hljs-string">"xyz"</span></span>); assertFalse(client.hasWhiteboard()); } }</code> </pre><br>  WhiteboardServiceImpl is a real implementation of the webwhiteboard service. <br>  Notice that the AcceptanceTestClient constructor now accepts a WhiteboardService instance (the ‚Äúdependency injection‚Äù design pattern).  This gives us an additional side effect: it does not care about the configuration.  The same AcceptanceTestClient class can also be used to test this system by simply passing it an instance of the WhiteboardService configured on a real base. <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AcceptanceTestClient</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> WhiteboardService service; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> WhiteboardEnvelope envelope; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AcceptanceTestClient</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(WhiteboardService service)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.service = service; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openWhiteboard</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String whiteboardId)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> createIfMissing = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.envelope = service.getWhiteboard(whiteboardId, createIfMissing); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasWhiteboard</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> envelope != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } }</code> </pre><br>  To summarize, AcceptanceTestClient behaves the same as a real webwhiteboard web client, while at the same time providing a high-level interface for acceptance tests. <br>  You may ask ‚Äúwhy do we need AcceptanceTestClient if we already have a WhiteboardService that we can call directly?‚Äù.  There are 2 reasons for this: <br><ul><li>  The interface of the WhiteboardService service is lower.  AcceptanceTestClient provides exactly those methods that are needed for acceptance tests, and it is in the form that will make the tests as clear as possible. </li><li>  AcceptanceTestClient hides all sorts of little things that are not important to the test - for example, the concept of WhiteboardEnvelope, boolean createIfMissing, and other low-level details.  In fact, other services are used in our script, such as UserService and WhiteboardSyncService. </li></ul><br>  I'm not going to bore you with the details of the AcceptanceTestClient implementation, since this article is not about the webwhiteboard device.  Suffice it to say that AcceptanceTestClient connects the needs of the acceptance test and low-level details of the implementation of interaction with the service interface.  It was easy to write because the real client code serves as a hint how-to-interact-with-service. <br>  In any case, now our Easiest acceptance test passes! <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openWhiteboardThatDoesntExist</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ myClient.openWhiteboard(<span class="hljs-string"><span class="hljs-string">"xyz"</span></span>); assertFalse(myClient.hasWhiteboard()); }</code> </pre><br>  The next step is to tidy up a bit. <br><img src="https://habrastorage.org/getpro/habr/post_images/fe6/7cb/722/fe67cb722b4a5e1ffb6f31921d7d3c77.png"><br>  In fact, I have not yet written a single line of product code (since this functionality is already present and working), it was only the code of the test framework.  Nevertheless, I spent a few minutes to clean it up, remove duplication, give the methods more understandable names, etc. <br>  Finally, I added another test, just for the sake of completeness, and also because it was easy: o) <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createNewWhiteboard</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ client.createNewWhiteboard(); assertTrue(client.hasWhiteboard()); }</code> </pre><br>  Hurray, we have a test framework!  And without any fashionable third-party libraries.  Only Java and Junit. <br><br><h5>  Step 2.4 Write an Acceptance Test for Password Protection </h5><br>  Now it's time to add a password protection test. <br>  I begin by describing the ‚Äúspecification‚Äù of my pseudo-code test: <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">passwordProtect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//1.     //2.     //3.     ,     //4.          //5.   ,       }</span></span></code> </pre><br><br>  And now, as before, I am writing a test code, pretending that the AcceptanceTestClient class already has everything I need.  This technique is extremely useful. <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">passwordProtect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//1.     myClient.createNewWhiteboard(); String whiteboardId = myClient.getCurrentWhiteboardId(); //2.      myClient.protectWhiteboard("bigsecret"); //3.     ,     try { joesClient.openWhiteboard(whiteboardId); fail("Expected WhiteboardProtectedException"); } catch (WhiteboardProtectedException err) { //  } assertFalse(joesClient.hasWhiteboard()); //4.          try { joesClient.openProtectedWhiteboard(whiteboardId, "wildguess"); fail("Expected WhiteboardProtectedException"); } catch (WhiteboardProtectedException err) { //  } assertFalse(joesClient.hasWhiteboard()); //5.   ,       joesClient.openProtectedWhiteboard(whiteboardId, "bigsecret"); assertTrue(joesClient.hasWhiteboard()); }</span></span></code> </pre><br>  I only spent a few minutes writing this code, because I was just inventing what I needed as I was writing.  Almost none of these methods are in the AcceptanceTestClient class (yet). <br>  While I was writing the code, I already had to make several decisions.  No need to think too hard, just do what the first thing comes to mind.  The best is the enemy of the good, and now all I want is to get a fairly good result, that is, a test that can be run and that will fall.  Later, when the test turns green, I‚Äôll refactor my code and think more carefully about how to improve its design. <br>  There is a big temptation to start brushing code right now, especially refactoring these terrible try / catch statements.  But one of the laws of TDD is to make the test green before refactoring starts, tests will protect you when you refactor.  So I decided to wait a little with combing the code. <br><br><h5>  Step 3 - Ensure that the acceptance test starts and falls </h5><br>  Following the testing triangle, my next step is to make my test run and crash. <br><img src="https://habrastorage.org/getpro/habr/post_images/a87/141/d85/a87141d85c845bc9574b66ba0bfba9a3.png"><br>  I use the Eclipse hotkeys again to create empty methods.  Fine.  We start the test and voila, it is Red! <br><br><h5>  Step 4: Make the acceptance test green </h5><br>  Now I have to write a grocery code.  I add several new entities to the system.  Sometimes the code I added was rather nontrivial, so it needed to be covered with unit tests.  I did this with TDD.  This is the same as ATDD, but on a smaller scale. <br>  This is how ATDD and TDD work together.  Consider ATDD to be an outer loop: <br><img src="https://habrastorage.org/getpro/habr/post_images/7f1/070/753/7f1070753c5286a473e080350eb42b42.png"><br>  For each cycle of writing an acceptance test (at the level of new functionality), we do several cycles of writing unit tests (at the level of classes and methods). <br><img src="https://habrastorage.org/getpro/habr/post_images/abc/f03/455/abcf0345503f82b2f49e91041b83a03f.gif"><br>  So, although at a high level I‚Äôm focused on making my acceptance test Green (which may take a few hours), on a low level I‚Äôm busy doing, for example, making my next unit test Red (which usually takes a few minutes). <br>  This is not really hardcore ‚ÄúTDD with a leather whip‚Äù.  This is more like ‚Äúat least make sure that the unit tests and the production code are checked together‚Äù.  And such a check occurs several times per hour.  Call it ‚ÄúTDD like‚Äù: o). <br><br><h5>  Step 5 Clean the code </h5><br>  As usual, as soon as the acceptance test turned green, it‚Äôs time to clean up.  Never save on it!  This is about washing dishes after a meal - it is better to do it right away. <br><img src="https://habrastorage.org/getpro/habr/post_images/dd4/7e4/6e4/dd47e46e4ceaf5f890300971705d7f15.gif"><br>  I clean not only the production code, but also the test code.  For example, I selected dirty try-catch as an auxiliary method, and I got a clean and tidy test method: <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">passwordProtect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ myClient.createNewWhiteboard(); String whiteboardId = myClient.getCurrentWhiteboardId(); myClient.protectWhiteboard(<span class="hljs-string"><span class="hljs-string">"bigsecret"</span></span>); assertCantOpenWhiteboard(joesClient, whiteboardId); assertCantOpenWhiteboard(joesClient, whiteboardId, <span class="hljs-string"><span class="hljs-string">"wildguess"</span></span>); joesClient.openProtectedWhiteboard(whiteboardId, <span class="hljs-string"><span class="hljs-string">"bigsecret"</span></span>); assertTrue(joesClient.hasWhiteboard()); }</code> </pre><br>  My goal is to make the acceptance test so short, clean and readable that comments become superfluous.  The initial pseudocode and comments perform only the role of a template - ‚Äúthat's how clean the code should be!‚Äù.  Removing comments gives the feeling of victory, and as a bonus, makes the method even shorter! <br><br><h5>  What's next? </h5><br>  Repeat.  As soon as I received the first working test, I thought about what else is missing.  For example, at the beginning I said that only a logged in user can protect the board with a password.  So I added a test for it, made it red, then green, and then cleaned the code.  And so on. <br>  Here is a complete list of tests that I did for this functionality (for now): <br><ul><li>  passwordProtectionRequiresAuthentication </li><li>  protectWhiteboard </li><li>  passwordOwnerDoesntHaveToKnowThePassword </li><li>  changePassword </li><li>  removePassword </li><li>  whiteboardPasswordCanOnlyBeChangedByThePersonWhoSetIt </li></ul><br>  Surely I will add a few more tests later if I find bugs or invent new usage scenarios. <br>  All in all, it took about 2 days of coding.  Most of the time I spent, returning to the previously written code and design, and not at all as linear as it may seem, reading this article. <br><br><h5>  How about manual testing? </h5><br>  Of course, I did a lot of manual testing after I received the green acceptance tests.  But since automatic acceptance tests cover both the core functionality and many special cases, I could focus on more subjective and exploratory testing.  How about a general user experience?  Does this sequence of actions make sense?  Is it easy to understand?  Where better to add explanatory text?  Is the design aesthetically good?  I'm not going to win any design awards, but I don‚Äôt want something monumental and ugly. <br>  A powerful set of automated acceptance tests eliminates the boring monotonous manual testing (known as ‚Äúmonkey testing‚Äù), and frees up time for a more interesting and meaningful type of manual testing. <br>  Ideally, I should start with automatic acceptance tests from the very beginning, so in part I returned some technical debt. <br><br><h5>  Key points </h5><br>  I hope this example was useful to you!  He demonstrates a rather typical situation - ‚ÄúI want to add a new feature, and it would be cool to write an automatic acceptance test on it, but there is not a single acceptance test in the project, and I don‚Äôt know which framework to use and where to start.‚Äù <br>  I really love this template, it allowed me to get off the ground many times.  Eventually: <br><ol><li>  Pretend that you already have an excellent framework encapsulated in a really convenient helper class (in my case AcceptanceTestClient). </li><li>  Write a very simple acceptance test for what is already working today (for example, simply opening your application).  Use this test to write classes like AcceptanceTestClient and the associated test binding (such as replacing a real database or other external services). </li><li>  Write an acceptance test for your new functionality.  Get it to run, but fall. </li><li>  Make the test green.  As you write code, write unit tests for any more or less complex code. </li><li>  Refactor.  And, maybe, write a few more unit tests in order to improve the metric, or vice versa - remove unnecessary tests or code.  Keep the code clean like a cat's eggs! </li></ol><br>  Once you have done this, you have overcome the most difficult barrier.  You started using ATDD! <br><br><h5>  about the author </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/a73/a89/55c/a73a8955c9a75fbce5551cb2bd4f4cb0.jpg"><br>  Henrik Kniberg is an Agile / Lean consultant from <a href="http://www.crisp.se/">Crisp</a> in Stockholm, mainly working for <a href="http://www.spotify.com/">Spotify</a> .  He enjoys helping companies achieve success in both the technical and human aspects of software development, as described in his popular books ‚Äú <a href="http://www.crisp.se/ScrumAndXpFromTheTrenches.html">Scrum and XP from the Trenches</a> ‚Äù, ‚Äú <a href="http://www.infoq.com/minibooks/kanban-scrum-minibook">Kanban and Scrum, making the most of both</a> ‚Äù and ‚Äú <a href="http://pragprog.com/book/hklean/lean-from-the-trenches">Lean from the Trenches</a> ‚Äú. <br><br>  Alexander Andronov (@ alex4Zero), Anton Bevzyuk (@bevzuk) and Dmitry Pavlov translated <br>  <a href="http://www.smartstepgrp.com/">Smart Step Group</a> . </div><p>Source: <a href="https://habr.com/ru/post/209576/">https://habr.com/ru/post/209576/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../209554/index.html">The effectiveness of personal recommendations: a contextual approach</a></li>
<li><a href="../209566/index.html">CERN and the collider through the eyes of a tourist</a></li>
<li><a href="../209568/index.html">ActiveRecord vs DAO - Test memory consumption and query execution speed</a></li>
<li><a href="../209572/index.html">Optimize your wireless connection or iwconfig can all</a></li>
<li><a href="../209574/index.html">News digest from the world of mobile development for the last week ‚Ññ37 (January 13-19, 2014)</a></li>
<li><a href="../209578/index.html">A little introduction to Scalatest</a></li>
<li><a href="../209580/index.html">Riddle of elementary arithmetic</a></li>
<li><a href="../209584/index.html">Procurement for data schema with tests, CI, without preference</a></li>
<li><a href="../209586/index.html">Results of the past year: Dark energy has become even more confusing</a></li>
<li><a href="../209588/index.html">Mobius: conference about mobile hardcore</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>