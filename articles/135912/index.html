<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Super cheap camera with control - do it yourself</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As a preamble, I‚Äôll say that since such an article was already there, I was not going to write about the camera in the first place. 
 The camera was m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Super cheap camera with control - do it yourself</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/5a7/fbf/36f/5a7fbf36fd94e96fd5489eee1798502e.jpg"><br>  As a preamble, I‚Äôll say that since such an article was already there, I was not going to write about the camera in the first place. <br>  The camera was made, just for the sake of interest, training skills and working out the technology of remote control of physical objects. <br>  A little later, I used this system as a vivid example accompanying the review on another resource (and in fact, as a cheat to pull up the votes).  It was a real beta test, which revealed a bunch of flaws.  For this many thanks to all those who are not indifferent, who helped someone with advice, and who helped with a piece of code. <br><br>  At the same time, the visitors who played with the camera, in addition to not having passed the hour so that they didn‚Äôt remember Habr, also began to be actively interested in the device of the whole thing, technical details, software implementation and of course cost. <br><br>  This is what made me an article.  And so as not to repeat, I decided to focus on the cost, because  the author of the previous topic on this topic, as I recall, the final cost resulted in something in the region of 5000r. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      About the cost of my crafts: <a name="habracut"></a>  read below. <br><br>  So, "how to call a ship, so it will float," once wrote the headline about cheapness - I will match the prose, so that the details - then, and first about the cost. <br><br><h4>  Let's go on prices * </h4><br>  * All prices are given with discounts.  About discounts - separately, later. <br><br>  <b>Required kit</b> : <br><ul><li>  Arduino Uno (or nano) - $ 15.29 </li><li>  Servo (steering) SG90 2x2.37 $ = 4.74 $ </li><li>  Webcam 3.01 $ </li></ul>  <b>Total</b> : $ 23.04 (about <b>750r</b> , at the moment) <br><br>  <b>Additional set</b> (laziness + buns): <br><ul><li>  The screen from Nokia 5110 is 250r (complete with Nokia itself and the power supply unit, bought a couple of years ago, we will assume that it is for this purpose that one can actually be found twice cheaper, or even for free) </li><li>  MegaShield v4 to Arduino - $ 5.86 </li><li>  Wiring connectors - $ 2.86 (40 pieces for this price, actually used 7) </li><li>  Ultrabright superb blue light for the backlight of the screen - 5p / pc (preferably 4 pcs., I have done wrong) </li></ul>  <b>Total</b> : approximately <b>550r</b> <br><br>  <b>Total: 1300r</b> <br><br><h4>  About implementation </h4><br>  Everything was done from scratch.  I didn‚Äôt repeat what I already had, firstly because of training considerations, and secondly I didn‚Äôt have an Ethernet module at that time, I decided that it was all too difficult (MySQL was tied there) and this solution is for me definitely not suitable. <br><br>  <b>About tasks</b> <br>  Tasks I have identified the following: <br><ul><li>  See picture / video </li><li>  Have the ability to control the camera </li><li>  To be able to control the size and quality of the video or image, and not ‚Äúalready on the client side‚Äù, but ‚Äústill on the server side, at the client‚Äôs command‚Äù.  Such a need arose due to the fact that ‚Äúlarge and wide intyrnet‚Äù is not available to me everywhere. </li><li>  Provide an acceptable "realtime" </li><li>  Have a reserve for the future - load control 220V, etc.  Actually for the sake of it all was started, because  ready-made solutions or terribly expensive, or do not provide such an opportunity. </li></ul><br>  <b>About problems</b> <br>  During the implementation of the questions have such a plan: <br><ul><li>  The video either loads the processor in case of multiple users, or it gives a delay of 5-10, i.e.  does not provide ‚Äúrealtime‚Äù, which is why it is impossible to immediately determine the adequacy and overall performance of the management </li><li>  Using the broadcast service, although it greatly relieves the server in the case of a large online, does not provide the necessary reliability, and, again, gives a delay </li><li>  A special server for broadcasting a video stream requires certain skills that I do not yet have </li><li>  Using the display by changing images does not provide high fps, and also constantly refers to the hard disk, which, with a large number of users, can cause picture lags not because of the processor load, but because of the disk access </li></ul><br>  <b>About solutions</b> <br><ul><li>  It was decided to use as a display - pictures </li><li>  To exclude a hard drive from the process of issuing pictures, RamDisk is installed, on which the webcam image ‚Äúlays down‚Äù twice per second </li><li>  For issuing pictures decided to use php and gdlib </li><li>  Updating the image is initiated by the client via javascript and ajax, and occurs without updating the page itself. </li></ul><br><br><h4>  Pretty lyrics! </h4><br><h5>  How does it look </h5><br>  <b>Everything looks more than modest</b> <br><br>  It works like this: <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/4_d8yC1V9h8%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700191,15700253,15700256,15700259&amp;usg=ALkJrhgLfB_P5tUNwUEChETUtjm6LtkVLg" frameborder="0" allowfullscreen=""></iframe><br><br>  Arduin, if anyone has not seen <br><img src="https://habrastorage.org/storage2/48e/35c/e19/48e35ce19eb4c0ca26560ef60cffe923.jpg"><br><br>  Megasheed with wiring <br><img src="https://habrastorage.org/storage2/0ff/d3c/fd9/0ffd3cfd921f282008e72067251e572a.jpg"><br><br>  "Sandwich" in profile <br><img src="https://habrastorage.org/storage2/3ef/bc7/284/3efbc7284c210d024b9545fa4a3153f1.jpg"><br><br>  "Sandwich" full face <br><img src="https://habrastorage.org/storage2/478/eeb/505/478eeb50554840ea5bdb957762d4da1a.jpg"><br><br>  Lcd <br><img src="https://habrastorage.org/storage2/4cb/070/257/4cb070257e07af91d85c129bf33acdf9.jpg"><br><br>  She's the back view (pins and conder) <br><img src="https://habrastorage.org/storage2/2a6/bf7/a80/2a6bf7a80e9a0786824fcaa09b98ee78.jpg"><br><br>  In the collection <br><img src="https://habrastorage.org/storage2/836/0e5/d75/8360e5d7585d6a34308b0289b4763f76.jpg"><br><br>  Assembly 2 <br><img src="https://habrastorage.org/storage2/0dc/54e/be4/0dc54ebe4bf0503c5a7db9f91f2c3ef9.jpg"><br><br>  Collective farm - wiring system and strings (camera mount) <br><img src="https://habrastorage.org/storage2/1bc/f95/2f1/1bcf952f10aa08d9494511a05fca0c0b.jpg"><br><img src="https://habrastorage.org/storage2/743/0a3/65d/7430a365d0c8380ebad3acd564c77bc9.jpg"><br><img src="https://habrastorage.org/storage2/e10/f69/792/e10f69792920f9775bbcab9f1b005393.jpg"><br><img src="https://habrastorage.org/storage2/3e2/883/654/3e288365493951f7b3678fc3c618fc96.jpg"><br><br>  Where do without him <br><img src="https://habrastorage.org/storage2/4c8/bb6/fed/4c8bb6fedba8467267d421f13e65ac7a.jpg"><br><br><h5>  How does the hardware </h5><br>  The webcam is connected via USB to the computer. <br>  Arduino is also connected to the computer via USB. <br>  All external devices, due to the exceptionally low current consumption, are connected directly to the Arduino, it has been working <b>around the clock</b> for a month and a half, with 10 users online at the moment of the lowest load. <br><br><h5>  How software works </h5><br>  <b>On the client side, a</b> clean web interface, without any plug-ins and lotions.  Only html, css, and javascript (+ ajax). <br><br>  <b>Server side</b> <br><ul><li>  The server itself is Apache </li><li>  Script Handler - php </li><li>  Accepting images from the camera - any of the easiest available, free or self-made program for saving images from a webcam </li><li>  Picture storage - RamDisk, utility for creating a disk partition in RAM (Russian version of RAMDisk "Enterprise" is free for localized systems) </li><li>  In order not to register direct local paths in php, a folder with a picture is mounted in the www folder using juction (Mark Russinovich's free utility) </li><li>  The transfer of control from the Internet to Arduino is implemented using a proxy program as follows: the php script creates a UDP socket and sends a datagram to a specific port, then the proxy program listens to this port and receives incoming messages and sends them to the Arduino COM port (you can even without processing).  The choice of UDP is called solely to simplify the system; UDP does not require any acknowledgments and checks about the delivery-sending, either from the client side or from the server side. </li></ul><br>  <b>On the side of the Arduino</b> <br><ul><li>  Itself (why "itself"? Because "payment") Arduino </li><li> Sketch inside it - standard examples from the standard set of arduino-0022 servo and serial + library found on the Internet for the display, modified to an acceptable form (in terms of Cyrillic and Latin at the same time) </li><li>  At the moment, the megashild is a plus, purely because of the convenience and cultural appearance - in this embodiment I did not solder any wiring (except for the board to the display) </li></ul><br><br>  The system withstood all the invasions and raids, as well as more than 120 users online. <br>  There were cases of management failure that occurred due to my flaws in the proxy program, in particular due to insufficient error handling, while the software part of Apache and Arduino was held up with dignity. <br><br><h4>  Be attentive to the little things </h4><br>  I want to note the problems with the software part that happened because of my own carelessness / lack of information / lack of observation: <br><ul><li>  The first thing I was seriously tormented with was that the Arduino receives the first byte from the line sent to its virtual COM port separately and everything else separately.  What sophistries I just did not try - and with arrays and with a bunch of checks ... Though you kill yourself.  Solution to the problem?  It came unexpectedly and suddenly, at the moment when I did not think about it: Sleep 2 after reading each byte.  EVERYTHING! </li><li>  The second problem - a serious load on the server, it would seem, out of nothing, arose because the update of the picture was done on a timer, without waiting for the actual fact of loading the picture (or download error).  This way a bunch of "extra" requests were sent. </li><li>  Third: FireFox turned out to be the most correct and capricious browser, and made me learn to write valid code.  For example, the OnClick event on the Option element should not work.  And it works, everywhere except for firestone. </li><li>  The fourth, completely implicit and rarely pop up: periodically the picture ‚Äúbroke‚Äù.  As it turned out, this happened at the time when the file was busy writing.  Those.  check file_exists () passed, and the file remained locked.  Checking is_writable () didn't help either.  I had to organize a cycle by the presence of an error and inside it to work out the reading of the file ‚Äúto the bitter end‚Äù. </li></ul><br><br><h4>  Remaining flaws </h4><br>  There are some. <br><ul><li>  Firstly, these are the ‚Äúleft‚Äù symbols described in the letters, sometimes appearing at the end of the message on the screen.  In fact, these are management teams.  The ears of this bug grow from the fact that if you actively spam or press buttons, the com-port buffer does not have time to read Arduina completely and subsequent messages fall to the end of the buffer.  The solution is, but not yet made. </li><li>  Secondly, this is a periodic drop in a UDP socket in a proxy program with large online.  What is the reason - I do not know.  It does not appear immediately.  Dies and does not "otkiss".  Helps close the socket and bind in a new way.  Perhaps the curve is guilty species windsock.ocx.  To rewrite this business on API in a BASIC, somehow laziness.  So far, one of the ‚Äúclumsy‚Äù solutions is seeing the reset and socket rebind on the timer, every, say, half an hour. </li></ul><br><br><h4>  About discounts </h4><br>  It is well known that in China - cheaper.  The main thing is to know the places <i>where it is</i> cheaper, and how to get an additional discount. <br>  It makes no sense to write here - too much text with pictures, besides, known to the majority. <br>  Therefore, in order not to provoke ardent opponents of the fight against spam and other ‚Äúreferrals‚Äù, I‚Äôll note the necessary minimum - this is a 15% discount on BiC, consisting of a one-time coupon by 10% and a discount for the first purchase of 5% when entering a recommender + hint, how to use this system repeatedly. <br>  All interested, can familiarize with the full information under the link on a page with, actually, the camera. <br><br><h4>  Links </h4><br>  <a href="http://cyberkot.ru/webcam">Camera, working copy</a> , for those who have not yet seen and not played enough <br>  <a href="http://habrahabr.ru/blogs/DIY/135351/">The topic</a> in which the link to the camera was leaked to Habr ahead of time <br>  <a href="http://ramdisk.nm.ru/ramdiskent-rus.htm">Ramdisk</a> <br>  <a href="http://technet.microsoft.com/ru-ru/sysinternals/bb896768.aspx">juction</a> <br>  <a href="">Sources</a> (simplified, in order to avoid) client part, server (php) and web-arduino-proxy program (VB 6.0) <br><br>  Apache, php, or some combination builds, etc.  - to your taste. </div><p>Source: <a href="https://habr.com/ru/post/135912/">https://habr.com/ru/post/135912/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../135900/index.html">Parse KCaptcha, reassemble ... under .NET</a></li>
<li><a href="../135902/index.html">Packaging of Python-program in APK format</a></li>
<li><a href="../135904/index.html">Project management system with blackjack and addons</a></li>
<li><a href="../135908/index.html">Django Admin Bootstrap Theme</a></li>
<li><a href="../135909/index.html">Comprehensive course on site development: prerequisites, dreams and plans</a></li>
<li><a href="../135913/index.html">Unicode for Dummies</a></li>
<li><a href="../135914/index.html">The interaction of the circuit in Proteus with the outside world</a></li>
<li><a href="../135915/index.html">Backdoor in Active Directory # 2</a></li>
<li><a href="../135916/index.html">Manual: Pyramid for People - Table of Contents</a></li>
<li><a href="../135917/index.html">New C ++ World Map from Alenacpp</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>