<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Lori Timesheets - time tracking on the CUBA platform</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚ÄúTime is the capital of a knowledge worker.‚Äù 
 Honore de Balzac 

 It often happens that people give preference to old and familiar things, ignoring n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Lori Timesheets - time tracking on the CUBA platform</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img width="50%" src="https://habrastorage.org/files/11b/b7a/3c4/11bb7a3c43e64dc1b09d1923e3156662.png"></div><br><br><blockquote>  <i>‚ÄúTime is the capital of a knowledge worker.‚Äù</i> <i><br></i>  <i><b>Honore de Balzac</b></i> </blockquote><br><br>  It often happens that people give preference to old and familiar things, ignoring new ones, even to their own detriment.  So, for a long time, we persistently used the time accounting system, which did not meet our requirements and constantly created problems for literally everyone - from programmers to accounting. <br><img src="https://habrastorage.org/files/6aa/244/d70/6aa244d704354f4383fe9b0b05bdafdf.png" align="right"><br>  The general torment of the time tracking system, due to the lack of time (see figure), did not become a weighty reason for developing its own system.  The idea of ‚Äã‚Äãsaving a real application saved the situation to demonstrate the capabilities of our CUBA platform.  Combining business with pleasure, time tracking system has become the first candidate. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      At the moment, development is completed, the application is implemented in our company, and we are ready to <a href="https://www.cuba-platform.ru/solutions">share</a> it with everyone. <br><br>  In this article I will tell how we in a short time (&lt;1 month), with limited forces (man and another half person) developed this application. <br><a name="habracut"></a><br><h1>  The first steps </h1><br>  According to the established practice, starting the development of the system, we describe the subject area, defining the entities that will appear in the system.  Such an approach makes it possible to estimate in advance (albeit not accurately) the supposed complexity of the future system. <br><br>  Let's think about what entities we need in the time tracking system. <br><ul><li>  User - it is clear where to without a user.  Fortunately, such an entity is already in the platform, we use it. </li><li>  The client is the one who pays the money. </li><li>  The project - for what they pay money. </li><li>  Task - a specific type of work. </li><li>  Record time - how much time the user spent on a specific task on a particular day. </li></ul><br><br>  It would seem that this is enough.  This is the set of entities we had in the old system.  For our convenience, we had to add something. <br><br><ul><li>  The role on the project - there are many projects, the same user can be the manager of one project and the developer on another (this is how it happens with us). </li><li>  A project participant is a project and user connection; it contains references to them and a role in this project. </li><li>  Task type is a feature by which several tasks can be combined.  For example, the type of tasks ‚ÄúTesting‚Äù will allow us to understand how much time we spend on testing within the company, and to compare this figure for different projects. </li><li>  Type of activity - a sign by which you can combine multiple time records.  For example, as part of the task of developing a mobile application, we do analysis, write code, write tests, fix bugs.  If necessary, adding to the project the appropriate types of activity, we will be able to track how much time was spent on each item. </li><li>  Non-working days - so that people do not make mistakes, filling in time-sheets on holidays, we highlight such days in the system using the specified non-working days. </li><li>  Tags are weakly structured tags that can be added to time entries. </li><li>  Tag types are a feature by which certain tags are grouped. </li></ul><br><br>  We will not describe the properties of each entity in the article; you can see them yourself by looking at <a href="https://github.com/Haulmont/platform-sample-timesheets">the project code</a> . <br><br>  Having decided on the object model, we started working in the CUBA studio.  To begin with, we created the corresponding entities.  After that, we took advantage of the wonderful opportunity of code autogeneration in the studio, getting SQL scripts to create a database, as well as standard screens (entity list screen and individual entity editing screen) with CRUD actions.  For 80% of entities, standard screens were enough.  Those screens that needed improvement, we edited using the WYSIWYG screen editor. <br><br>  Then we set up the main menu of the application so that users have convenient access to the necessary entities. <br>  At that moment, the application could already start and work with entities of the object model (create / edit / delete). <br><br>  <b>In just a few hours,</b> we created a really working, fully functional prototype of the time tracking system. <br><br><h1>  Making the interface more friendly </h1><br>  We got a working prototype, but it was very far from a working application. <br>  Let's see what we wanted to achieve: <br><ol><li>  The speed and convenience of filling timeshits </li><li>  Easy system setup </li><li>  Nice appearance </li></ol><br><br><h2>  Entering timeshits per week </h2><br>  The first thing we needed was a convenient weekly fill in of timesheets.  In the old system there was such a screen and we decided to make a similar one.  That's what we did. <br><br><img src="https://habrastorage.org/files/ff4/ffc/d15/ff4ffcd15bca47e49fa8570e5aa73661.png"><br><br>  As you may remember, there is no ‚ÄúWeekly Report‚Äù entity in the object model.  It would be possible to implement this screen without any bindings to entities at all, but it is much more convenient to create an intermediate non-persistent entity that is not connected to the database directly, but the entire set of components works with it as with a conventional entity.  This technique allows you to abstract from the structure of the database and create screens that are more understandable to the user.  Such an entity looks very simple: <br><br><pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@MetaClass</span></span>(name = <span class="hljs-string"><span class="hljs-string">"ts$WeeklyReportEntry"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WeeklyReportEntry</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractNotPersistentEntity</span></span></span><span class="hljs-class"> </span></span>{ ..... <span class="hljs-meta"><span class="hljs-meta">@MetaProperty</span></span>(mandatory = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Project project; <span class="hljs-meta"><span class="hljs-meta">@MetaProperty</span></span>(mandatory = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Task task; ..... }</code> </pre> <br>  In this case, the WeeklyReportEntry is 1 row in the table. <br><br>  We made the table editable to make it easier to fill in the clock for each day of the week.  In addition, we added counting the hours in the columns, as well as highlighting the potentially incorrectly filled days.  Then, at the request of users, we added the ability to group records in a table by project and by task.  All this was done using the standard mechanisms of the CUBA platform. <br><br><h2>  Entering timesheets from the calendar </h2><br>  The next most important for us was the screen for entering timesheets from the calendar.  Unfortunately, at the moment there is no ‚ÄúCalendar‚Äù component in the platform.  However, it is in the Vaadin framework, which we use to render the web client.  Having inherited it and slightly modified it (described below), we used it in our application.  In the calendar, we also added the validation of potentially incorrectly filled timesheets, highlighting holidays and weekends, summing up hours by week and month. <br><br><img src="https://habrastorage.org/files/cf7/9ae/370/cf79ae37009b436b949cd040706d2885.png"><br><br><h2>  Setting up projects and tasks </h2><br>  Another goal for us was the simplicity of setting up projects and tasks.  Despite the fact that we had basic project screens and tasks, we decided to make a special screen that would make the tincture easy and enjoyable.  The key requirements were: the ability to quickly switch between projects, the ability to quickly add people and tasks to different projects.  It was decided to make the screen in the form of 3 related tables: projects, tasks and project participants. <br><br>  When a project is selected, the records corresponding to this project are shown in the tables of tasks and participants.  The CUBA platform allows you to create related data sources for tables, so no special code was required for this.  In fact, from 3 standard screens (list of projects, list of tasks, list of project participants), we collected one, replacing all 3. <br><br><img src="https://habrastorage.org/files/f80/2e6/7e4/f802e67e44854fa4bd1b0d15adc149cf.png"><br><br><h2>  "Command line" </h2><br>  Another innovation that we decided to implement was the so-called command line.  It allows you to fill in the timesheets in a week or even a whole month by entering a simple text command.  It looks like this: <br><br><img src="https://habrastorage.org/files/a0e/859/281/a0e859281c1b40349858fe54ba17f7f5.png"><br><br>  Also, using the Vaadin component, which is called <b>AceEditor</b> , we taught the command line to do hints.  We will tell about it below. <br><br>  It should be noted that we have seen this remarkable concept in the <b>Everhour</b> system, slightly <b>modifying</b> it to fit our needs. <br><br><h1>  Rapid development </h1><br>  Naturally, all these screens were not developed by us at one time. <br>  As usual, bringing the UI to the mind took much longer than creating its first version.  Here we were greatly helped by the mechanism of ‚Äúhot loading‚Äù of changes to the server implemented in the CUBA platform.  Thanks to him, about 90% (~) of changes in the UI do not need to restart the server.  Moreover, it is possible to reboot the core logic (services and bins).  This mechanism is described in more detail in our <a href="http://habrahabr.ru/company/haulmont/blog/248981/">article</a> . <br><br><h1>  Expanding client-side components </h1><br><h2>  Add a calendar </h2><br>  As mentioned above, we needed a calendar.  Fortunately, it was found in the Vaadin component list.  Now I will tell you how we added it. <br><br>  Vaadin is built on GWT, but the Vaadin component exists on both the client and the server.  Usually, there is also an intermediate part that is used to connect the client and the server.  Thus, in order to expand the calendar, we will have to work with both server and GWT code. <br><br>  The calendar has a com.vaadin.shared.ui.calendar.CalendarState state.  We want the state to keep, among other things, the days that are considered days off (this is configured in the system), and holidays.  For this, we inherit this class. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TimeSheetsCalendarState</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CalendarState</span></span></span><span class="hljs-class"> </span></span>{ ..... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Set&lt;Integer&gt; weekends = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Set&lt;String&gt; holidays = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;&gt;(); .... }</code> </pre><br>  Now we need to inherit the com.vaadin.ui.Calendar server class to populate new properties. <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TimeSheetsCalendar</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Calendar</span></span></span><span class="hljs-class"> </span></span>{ .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimeSheetsCalendar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CalendarEventProvider eventProvider)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(eventProvider); getState().weekends = getWeekends(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">beforeClientResponse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> initial)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.beforeClientResponse(initial); getState().holidays = getHolidays(); } .... }</code> </pre><br>  After that, we can inherit the widget com.vaadin.client.ui.VCalendar and make it change the style of the cell depending on whether it is a holiday or not. <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TimeSheetsCalendarWidget</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VCalendar</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Set&lt;Integer&gt; weekends = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;Integer&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Set&lt;String&gt; holidays = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;String&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isWeekend</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dayNumber)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> weekends.contains(dayNumber); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isHoliday</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String date)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> holidays.contains(date); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setCellStyle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Date today, List&lt;CalendarDay&gt; days, String date, SimpleDayCell cell, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> columns, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pos)</span></span></span><span class="hljs-function"> </span></span>{ CalendarDay day = days.get(pos); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isWeekend(day.getDayOfWeek()) || isHoliday(date)) { cell.addStyleName(<span class="hljs-string"><span class="hljs-string">"holiday"</span></span>); cell.setTitle(date); } }</code> </pre><br>  It remains only to extend the com.vaadin.client.ui.calendar.CalendarConnector class so that it copies the holiday and weekend data from the state to the widget. <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Connect</span></span>(value = TimeSheetsCalendar.class, loadStyle = Connect.LoadStyle.LAZY) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TimeSheetsCalendarConnector</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CalendarConnector</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> TimeSheetsCalendarWidget </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getWidget</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (TimeSheetsCalendarWidget) <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.getWidget(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> TimeSheetsCalendarState </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (TimeSheetsCalendarState) <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.getState(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onStateChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StateChangeEvent stateChangeEvent)</span></span></span><span class="hljs-function"> </span></span>{ getWidget().setWeekends(getState().weekends); getWidget().setHolidays(getState().holidays); <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onStateChanged(stateChangeEvent); } }</code> </pre><br>  As a result, we can add TimeSheetsCalendar to any screen created on the CUBA platform. <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CalendarScreen</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractWindow</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> BoxLayout calBox; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> TimeSheetsCalendar calendar; .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initCalendar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ .... calendar = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TimeSheetsCalendar(dataSource); .... AbstractOrderedLayout calendarLayout = WebComponentsHelper.unwrap(calBox); calendarLayout.addComponent(calendar); }</code> </pre><br><h2>  Add hints to the ‚Äúcommand line‚Äù </h2><br>  To make it convenient for users to use the ‚Äúcommand line‚Äù, we decided that it should suggest input options. <br><br>  Vaadin has an AceEditor component that can do this.  It is used in the platform (WebSourceCodeEditor) to give hints in JPQL queries (for example, when editing a query in a report). <br>  We decided to simplify our life and instead of writing a new component based on AceEditor, we expanded WebSourceCodeEditor. <br><br>  First of all, we expanded org.vaadin.aceeditor.SuggestionExtension, registering an RPC service in it that should process the command line application. <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommandLineSuggestionExtension</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SuggestionExtension</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Runnable applyHandler; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CommandLineSuggestionExtension</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Suggester suggester)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(suggester); registerRpc(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CommandLineRpc() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyHandler != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { applyHandler.run(); } } }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setApplyHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Runnable applyHandler)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.applyHandler = applyHandler; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Runnable </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getApplyHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> applyHandler; } }</code> </pre><br>  Then came the turn of the platform class com.haulmont.cuba.web.gui.components.WebSourceCodeEditor. <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebCommandLine</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebSourceCodeEditor</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommandLine</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setSuggester</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Suggester suggester)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.suggester = suggester; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (suggester != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; suggestionExtension == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { suggestionExtension = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CommandLineSuggestionExtension(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CommandLineSourceCodeEditorSuggester()); suggestionExtension.extend(component); suggestionExtension.setShowDescriptions(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommandLineSourceCodeEditorSuggester</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SourceCodeEditorSuggester</span></span></span><span class="hljs-class"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> CommandLineSuggestionExtension </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSuggestionExtension</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (CommandLineSuggestionExtension) suggestionExtension; } }</code> </pre><br>  Finally, the client-side class is org.vaadin.aceeditor.client.SuggesterConnector. <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Connect</span></span>(CommandLineSuggestionExtension.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommandLineSuggesterConnector</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SuggesterConnector</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> CommandLineRpc commandLineRpc = RpcProxy.create( CommandLineRpc.class, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Command </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleKeyboard</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(JavaScriptObject data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hashId, String keyString, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> keyCode, GwtAceKeyboardEvent e)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (suggesting) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> keyPressWhileSuggesting(keyCode); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Command.DEFAULT; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keyCode == <span class="hljs-number"><span class="hljs-number">13</span></span>) {<span class="hljs-comment"><span class="hljs-comment">//Enter commandLineRpc.apply(); return Command.NULL;//ignore enter } else if ((keyCode == 32 &amp;&amp; e.isCtrlKey())) {//Ctrl+Space startSuggesting(); return Command.NULL; } else if ((keyCode == 50 &amp;&amp; e.isShiftKey())//@ || (keyCode == 51 &amp;&amp; e.isShiftKey())//# || (keyCode == 52 &amp;&amp; e.isShiftKey())//$ || (keyCode == 56 &amp;&amp; e.isShiftKey())) {//* startSuggestingOnNextSelectionChange = true; widget.addSelectionChangeListener(this); return Command.DEFAULT; } return Command.DEFAULT; } }</span></span></code> </pre><br>  In it, we redefined the editor's behavior - hints should appear besides Ctrl-Space when pressing @, #, $, * (hint for projects, tasks, tags, activity types).  Pressing Enter should use the command line (fill in the timesheets). <br><br><h1>  Expanding platform functionality </h1><br>  As you may remember, we decided to use the User class provided by the platform.  We wanted the user to keep a record of the required working hours per week.  This is necessary to validate the entered data (if a person has indicated in the timesheets more or less than it should).  We had a choice - to create a new entity that would refer to a system user, or to expand the platform entity.  In order to save effort, we decided to go through expansion, because this mechanism is quite simple (in terms of use) and works fine.  Now I will show how we implemented this extension. <br><br>  First, it was necessary to make the heir of the com.haulmont.cuba.security.entity.User class and add a new field there. <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Inheritance</span></span>(strategy = InheritanceType.SINGLE_TABLE) <span class="hljs-meta"><span class="hljs-meta">@DiscriminatorValue</span></span>(<span class="hljs-string"><span class="hljs-string">"Ext"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Entity</span></span>(name = <span class="hljs-string"><span class="hljs-string">"ts$ExtUser"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Extends</span></span>(User.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExtUser</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> </span></span>{ .... <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"WORK_HOURS_FOR_WEEK"</span></span>, nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> BigDecimal workHoursForWeek; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> BigDecimal </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getWorkHoursForWeek</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> workHoursForWeek; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setWorkHoursForWeek</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BigDecimal workHoursForWeek)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.workHoursForWeek = workHoursForWeek; } .... }</code> </pre><br>  Then we created a screen that extends the user editing screen, and registered it in the system. <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">window</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.haulmont.com/cuba/window.xsd"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">caption</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"msg://editCaption"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.haulmont.timesheets.gui.extuser.ExtUserEdit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">extends</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/com/haulmont/cuba/gui/app/security/user/edit/user-edit.xml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">messagesPack</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.haulmont.timesheets.gui.extuser"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:ext</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.haulmont.com/cuba/window-ext.xsd"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">layout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"propertiesBox"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h4</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h4</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">grid</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"propertiesGrid"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rows</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">row</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"propertiesRow"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fieldGroup</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fieldGroupRight"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">column</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"workHoursForWeek"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">caption</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"msg://com.haulmont.timesheets.entity/ExtUser.workHoursForWeek"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ext:index</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">column</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fieldGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">row</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rows</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupBox</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">layout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">window</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Now, instead of the User entity, ExtUser is present in the system and the editing screen contains the workHoursForWeek field. <br><br>  This is the simplest example of extending functionality, if you want to learn more about extensions - read our <a href="http://habrahabr.ru/company/haulmont/blog/214787/">article</a> . <br><br><h1>  Making a distribution kit with your own hands </h1><br>  From the very beginning we planned to make this system a product that will be used by other people.  In order to install and start the system to be simple, we decided to do something like a distribution kit. <br><br>  Our ‚Äúdistribution kit‚Äù is a zip-file that contains a folder with the Tomcat servlet container and scripts for starting / stopping the system. <br><br>  Since Gradle is used to build projects on the platform, it is easy to build such a ‚Äúdistribution kit‚Äù. <br><pre> <code class="hljs pgsql">def distribDir="./distrib" def scriptsDir="./scripts" task cleanTomcatLogs &lt;&lt; { def dir = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> File(tomcatDir, <span class="hljs-string"><span class="hljs-string">'/logs/'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dir.isDirectory()) { ant.<span class="hljs-keyword"><span class="hljs-keyword">delete</span></span>(includeemptydirs: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { fileset(dir: dir, includes: <span class="hljs-string"><span class="hljs-string">'**/*'</span></span>) } } } task copyTomcat(<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Copy</span></span>, dependsOn: [<span class="hljs-string"><span class="hljs-string">'setupTomcat'</span></span>,<span class="hljs-string"><span class="hljs-string">':app-core:deploy'</span></span>, <span class="hljs-string"><span class="hljs-string">':app-web:deploy'</span></span>, <span class="hljs-string"><span class="hljs-string">':app-web-toolkit:deploy'</span></span>, <span class="hljs-string"><span class="hljs-string">'cleanTomcatLogs'</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> file("$tomcatDir/..") <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "tomcat/**" <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> "$distribDir" } task copyLoriScripts(<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Copy</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> file("$scriptsDir") <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "*lori.*" <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> "$distribDir" } task copyTomcatScripts(<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Copy</span></span>, dependsOn: <span class="hljs-string"><span class="hljs-string">'copyTomcat'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> file("$scriptsDir") <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "*classpath.*" <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> "$distribDir/tomcat/bin/" } task buildDistributionZip(<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: Zip, dependsOn: [<span class="hljs-string"><span class="hljs-string">'copyLoriScripts'</span></span>, <span class="hljs-string"><span class="hljs-string">'copyTomcatScripts'</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> "$distribDir" <span class="hljs-keyword"><span class="hljs-keyword">exclude</span></span> "*.zip" baseName = <span class="hljs-string"><span class="hljs-string">'lori'</span></span> version= "$artifactVersion" destinationDir = file("$distribDir") } task distribution(dependsOn: buildDistributionZip) &lt;&lt; { }</code> </pre><br>  The only problem came with tomcat.  He desperately did not want to start on a system where the JAVA_HOME system variable was not set. <br><br>  To force it to ignore the absence of this variable, we had to replace the setclasspath.sh and setclasspath.bat scripts with simpler ones. <br><br><h1>  Conclusion </h1><br>  There are a lot of products for accounting of working time, so the question probably arises, why did we write another one?  There are several reasons.  The main thing is that we wanted the product to be as convenient as possible in our field of activity (software development).  In addition, we needed to ensure ease of integration with other systems and improvements to changing processes.  Well, finally, we wanted to create a useful application that would become a good example of development on the CUBA platform. <br><br>  <a href="https://www.cuba-platform.ru/solutions">The application is</a> free, its <a href="https://github.com/Haulmont/platform-sample-timesheets">code</a> is available on github.  To modify Lori Timesheets, you need a commercial license <a href="https://www.cuba-platform.ru/development-tools">CUBA Studio</a> , because the application uses <a href="https://www.cuba-platform.ru/add-ons">premium add-ons</a> . <br><br>  We hope that Lori Timesheets will benefit not only us, but also someone else.  Open source and extension mechanism will allow you to easily adapt the application for yourself. </div><p>Source: <a href="https://habr.com/ru/post/272231/">https://habr.com/ru/post/272231/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../272213/index.html">Visual tests with the Galen Framework. Improving code readability</a></li>
<li><a href="../272215/index.html">I believe - I do not believe in indie development. Part 1</a></li>
<li><a href="../272223/index.html">Google Chrome web browser provided another security enhancement</a></li>
<li><a href="../272227/index.html">Java 9 will be postponed for half a year</a></li>
<li><a href="../272229/index.html">Why are our high-level languages ‚Äã‚Äãstill not so high-level?</a></li>
<li><a href="../272233/index.html">2D shadows on WebGL in 4 easy steps</a></li>
<li><a href="../272235/index.html">Data Modeling and Databases for a Freshman</a></li>
<li><a href="../272237/index.html">Master class by Boris Wolfson. Agile basics</a></li>
<li><a href="../272239/index.html">Bug with GPU and Canvas in Google Chrome under Windows</a></li>
<li><a href="../272241/index.html">Elasticweb - the first adaptive virtual hosting</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>