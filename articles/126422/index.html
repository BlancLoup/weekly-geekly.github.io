<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating an application on the Cocos2d framework for iOS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 My first game was written by an iPhone SDK about a peeing boy, it was very slow on 3G and 3GS. I did the second one with less CPU load, and ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating an application on the Cocos2d framework for iOS</h1><div class="post__text post__text-html js-mediator-article"> Hello! <br><br>  My first game was written by an iPhone SDK about a peeing boy, it was very slow on 3G and 3GS.  I did the second one with less CPU load, and I already heard about cocos2d, after reading the documentation about it, I decided not to return to the SDK, and started programming for this platform.  In this article I will not describe how to install cocos2d, it is described <a href="http://habrahabr.ru/blogs/macosxdev/122383/">here</a> , I will try not to repeat with this post.  I can only add there is a stable 1.0.1 <a href="http://www.cocos2d-iphone.org/download">version</a> .  In this article I will explain how to create a menu, animation, and transition between layers. <br><br>  So, to the point. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Create a project on cocos2d, orient it to an iPad, go to the HelloWorldLayer.m file and in the (id) init method create a sprite for the background: <br><br><pre> <code class="hljs ruby"><code class="java">-(id) init { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( (<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>=[<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> init])) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    ,     CGSize size = [[CCDirector sharedDirector] winSize]; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> backgroung CCSprite * background = [CCSprite <span class="hljs-symbol"><span class="hljs-symbol">spriteWithFile:</span></span>@<span class="hljs-string"><span class="hljs-string">"clean bg.png"</span></span>]; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     background.position = ccp(size.width/<span class="hljs-number"><span class="hljs-number">2</span></span>, size.height/<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    CCLayer        , <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   <span class="hljs-symbol"><span class="hljs-symbol">z:</span></span>-<span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> <span class="hljs-symbol"><span class="hljs-symbol">addChild:</span></span>background <span class="hljs-symbol"><span class="hljs-symbol">z:</span></span>-<span class="hljs-number"><span class="hljs-number">1</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>; }</code></code> </pre><br>  I can add that when we add our sprite to the layer, you can add a tag: <code>[self addChild:background z:-1 tag:100];</code>  this is done so that you can find a sprite on a tag in another method or class, this is done like this: <code>CCSprite *spr = (CCSprite *)[self getChildByTag:100];</code>  then do what you want with this sprite. <br><br>  Further, here we create a menu: <br><br><pre> <code class="hljs ruby"><code class="java">/<span class="hljs-regexp"><span class="hljs-regexp">/   /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   CCMenuItemImage * image = [CCMenuItemImage itemFromNormalImage:@"new_game.png" selectedImage:@"new_game.png" target:self selector:@selector(perehod_v_igru)]; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    (   , /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/     ) image.position = ccp(0, 50); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  font CCMenuItemFont * font = [CCMenuItemFont itemFromString:@"" target:self selector:@selector(options)]; font.position = ccp(0, -50); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/     CCMenu * menu = [CCMenu menuWithItems:image, font, nil]; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   menu.position = ccp(size.width /</span></span><span class="hljs-number"><span class="hljs-number">2</span></span> , size.height/<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> <span class="hljs-symbol"><span class="hljs-symbol">addChild:</span></span>menu];</code></code> </pre> <br><br>  The cocos2d menu is an alternative to the iPhone SDK buttons, here we looked at 2 types of cells (a picture and an inscription), as you see, they refer to certain methods, in our case these are transitions to other layers: <br><br><pre> <code class="hljs lua"><code class="java">-(void)perehod_v_igru { //        <span class="hljs-string"><span class="hljs-string">[[CCDirector sharedDirector] replaceScene:[CCTransitionPageTurn transitionWithDuration:1 scene:[Game node]]</span></span>]; }</code></code> </pre> <br><br>  <code>CCTransition</code> is responsible for the transition effect from one layer to another for a certain time. <br><br><pre> <code class="hljs lua"><code class="java">-(void)options { //     <span class="hljs-string"><span class="hljs-string">[[CCDirector sharedDirector] pushScene:[Options node]]</span></span>; }</code></code> </pre> <br><br>  In this case, <code>pushScene</code> is used to temporarily overlay a layer. <br><br>  Create Options files, press the + N commands: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7c8/7bc/072/7c87bc072c676508d47602c23742cdeb.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/b19/0dd/298/b190dd298cbe2e956080256a088643a4.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/081/543/8e2/0815438e2180d2a10705d3375b49fb22.png" alt="image"><br><br>  as seen on the last screenshot, we create a custom layer, by default it is black, but after playing in RGB you can set any color. <br><br>  Next, create a CCMenu and a method that returns a return to the main menu: <br><br><pre> <code class="hljs ruby"><code class="java">-(id) init { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> RGB     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> = [<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> <span class="hljs-symbol"><span class="hljs-symbol">initWithColor:</span></span>ccc4(<span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">155</span></span>)])) { CGSize size = [[CCDirector sharedDirector] winSize]; CCMenuItemFont * font = [CCMenuItemFont <span class="hljs-symbol"><span class="hljs-symbol">itemFromString:</span></span>@<span class="hljs-string"><span class="hljs-string">" "</span></span> <span class="hljs-symbol"><span class="hljs-symbol">target:</span></span><span class="hljs-keyword"><span class="hljs-keyword">self</span></span> <span class="hljs-symbol"><span class="hljs-symbol">selector:</span></span>@selector(backItem)]; font.position = ccp(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); CCMenu * menu = [CCMenu <span class="hljs-symbol"><span class="hljs-symbol">menuWithItems:</span></span> font, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; menu.position = ccp(size.width /<span class="hljs-number"><span class="hljs-number">2</span></span> , size.height/<span class="hljs-number"><span class="hljs-number">2</span></span>); [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> <span class="hljs-symbol"><span class="hljs-symbol">addChild:</span></span>menu]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>; } -(void)backItem{ <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     [[CCDirector sharedDirector] popScene]; }</code></code> </pre> <br><br>  popScene removes the current layer.  Be careful under this layer should be any other, as stated above, we just impose a layer, otherwise it will generate an error. <br><br>  Next, create a Game layer: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7c8/7bc/072/7c87bc072c676508d47602c23742cdeb.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/cc8/b8d/977/cc8b8d977e24c87364cc27a10b314adb.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a6f/71a/d60/a6f71ad603b4adcb76178799ca03b808.png" alt="image"><br><br>  Create a background and set a delay before creating another sprite in the Game.m file: <br><br><pre> <code class="hljs ruby"><code class="java">-(id) init { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( (<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>=[<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> init])) { CGSize size = [[CCDirector sharedDirector] winSize]; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> background CCSprite * background = [CCSprite <span class="hljs-symbol"><span class="hljs-symbol">spriteWithFile:</span></span>@<span class="hljs-string"><span class="hljs-string">"clean bg.png"</span></span>]; <span class="hljs-regexp"><span class="hljs-regexp">//anchor</span></span>Point        ,   /<span class="hljs-regexp"><span class="hljs-regexp">/background.anchorPoint = ccp(0.5f,0.5f);       /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/     anchorPoint = ccp(1, 1);      /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  ,  (0, 0)    background.anchorPoint = ccp(1, 1); background.position = ccp(size.width, size.height); [self addChild:background z:-1]; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/     0,5  [self performSelector:@selector(sozdanie_CCSprite) withObject:self afterDelay:0.5]; } return self; }</span></span></code></code> </pre> <br><br>  here I applied anchorPoint, then we will see its real use: <br><br><pre> <code class="hljs ruby"><code class="java">-(void)sozdanie_CCSprite { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>      background CCSprite * tarakan = [CCSprite <span class="hljs-symbol"><span class="hljs-symbol">spriteWithFile:</span></span>@<span class="hljs-string"><span class="hljs-string">"tarakan0.png"</span></span>]; tarakan.position = ccp(<span class="hljs-number"><span class="hljs-number">512</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>); tarakan.anchorPoint = ccp(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>); [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> <span class="hljs-symbol"><span class="hljs-symbol">addChild:</span></span>tarakan]; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>Actions /<span class="hljs-regexp"><span class="hljs-regexp">/           id move = [CCMoveBy actionWithDuration:2 position:ccp(0, 500)]; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/     id accel = [CCEaseInOut actionWithAction:move rate:5]; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  id rotate = [CCRotateBy actionWithDuration:2.0f angle:360]; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  [tarakan runAction:[CCSequence actions:accel, rotate, nil]]; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  [self performSelector:@selector(animation) withObject:self afterDelay:3.5]; }</span></span></code></code> </pre> <br><br>  here we apply different actions on the cockroach.  When we compile and see that the cockroach moves with acceleration, and then rotates, while the point of rotation is the lower left corner, this is the anchorPoint to which we specified (0, 0).  We specified the movement of the cockroach, CCMoveBy is responsible for the movement, CCEaseInOut is responsible for the smoothness of acceleration and deceleration during the movement, CCRotateBy is responsible for the rotation.  Also here we see the use of CCSequence, this command is used to ensure that the actions on the sprite go in turn. <br><br>  And finally, create the animation after the delay: <br><br><pre> <code class="hljs ruby"><code class="java">-(void)animation { CGSize size = [[CCDirector sharedDirector] winSize]; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> plist       [[CCSpriteFrameCache sharedSpriteFrameCache] <span class="hljs-symbol"><span class="hljs-symbol">addSpriteFramesWithFile:</span></span>@<span class="hljs-string"><span class="hljs-string">"tarakan.plist"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">textureFile:</span></span>@<span class="hljs-string"><span class="hljs-string">"tarakan.png"</span></span>]; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>CCSpriteBatchNode     cocos2d,       /<span class="hljs-regexp"><span class="hljs-regexp">/    /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/       CCSpriteBatchNode * bowSheet = [CCSpriteBatchNode batchNodeWithFile:@"tarakan.png"]; NSString *topbird = @"tarakan"; NSMutableArray *walkAnimFrames = [NSMutableArray array]; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    for(int i = 1; i &lt;= 4; ++i) { CCSpriteFrame *frame = [[CCSpriteFrameCache sharedSpriteFrameCache] spriteFrameByName: topbird stringByAppendingString:[ NSString stringWithFormat:@"%d.png", i]]]; [walkAnimFrames addObject:frame]; } /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/          CCAnimation *walkAnim = [CCAnimation animationWithFrames:walkAnimFrames delay:0.1f]; NSString *bowFrame = [topbird stringByAppendingString:@"1.png"]; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/     CCSprite * bow = [CCSprite spriteWithSpriteFrameName:bowFrame]; bow.position = ccp(size.width/</span></span><span class="hljs-number"><span class="hljs-number">2</span></span> , -<span class="hljs-number"><span class="hljs-number">100</span></span>); [bowSheet <span class="hljs-symbol"><span class="hljs-symbol">addChild:</span></span>bow]; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>CCAnimate    CCAnimation /<span class="hljs-regexp"><span class="hljs-regexp">/        CCAnimate CCAnimate * bowAnim = [[CCAnimate actionWithAnimation:walkAnim restoreOriginalFrame:YES] retain]; [self addChild:bowSheet]; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   id walkAction = [CCRepeat actionWithAction:bowAnim times:5]; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  id da = [CCMoveBy actionWithDuration:2 position:ccp(0, 600)]; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/     [bow runAction:[CCSpawn actions:da, walkAction, nil]]; }</span></span></code></code> </pre> <br><br>  I commented most of it, add the texture I created with <a href="http://zwoptexapp.com/flashversion">zwoptexapp.com</a> , it's free, I got the plist and png files, dragged them into the project.  This is the <code>tarakan.plist</code> file: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6bd/b8e/9b9/6bdb8e9b90dc3eec209620ebcbd921b5.png" alt="image"><br><br>  and so <code>tarakan.png</code> file: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/374/868/afa/374868afaed65a4ec68edc63a0dd77b3.png" alt="image"><br><br>  You can also see that when applying an action instead of CCSequence, CCSpawn was applied, this command is used to ensure that actions on the sprite go at the same time. <br><br>  Often I see problems on the forums with the creation of animation on cocos2d, so I included it in this article.  I hope this article will be useful to someone. <br><br>  The project can be downloaded <a href="">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/126422/">https://habr.com/ru/post/126422/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../126416/index.html">Results of the competition Part 3. Quiz</a></li>
<li><a href="../126417/index.html">Social graph</a></li>
<li><a href="../126418/index.html">How to avoid collisions when writing to Memcache from PHP</a></li>
<li><a href="../126419/index.html">PS3 steering wheel overview</a></li>
<li><a href="../126421/index.html">Amazing near or how to make fun of stock analysts (using Excel)</a></li>
<li><a href="../126423/index.html">Mouse over translation in Lingvo x5</a></li>
<li><a href="../126425/index.html">NuGet - download packages from the Internet during the build process</a></li>
<li><a href="../126427/index.html">Creating an operating system based on the linux kernel. From scratch</a></li>
<li><a href="../126428/index.html">‚ÄúWhat is your name in my name?‚Äù - a stupid manual on choosing a startup name</a></li>
<li><a href="../126431/index.html">VHDL delay element</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>