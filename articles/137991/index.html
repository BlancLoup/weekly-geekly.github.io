<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>gem the_sortable_tree</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TheSortableTree is a heme that implements Drag & Drop functionality for trees constructed on the basis of awesome_nested_set or nested_set gems. 



 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>gem the_sortable_tree</h1><div class="post__text post__text-html js-mediator-article">  TheSortableTree is a heme that implements Drag &amp; Drop functionality for trees constructed on the basis of awesome_nested_set or nested_set gems. <br><br><img src="https://habrastorage.org/storage2/184/b60/f25/184b60f25c22a1f90d4d412526c1f6bd.jpg"><br><br>  In 2008, when we were doing our first social program on the tracks, I first encountered the better_nested_set gem.  The heme was beautiful (I mean, in fact, not by code, the implementation was still lame) and, perhaps, it was just enough to convince me to forget PHP programming like a bad dream. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We used heme to form a multi-level comment tree.  But there was one thing ... At that moment there was not a single helper who would allow to draw these trees.  Because of this, I had to invent my bikes.  I made my bike too. <br><br>  No, I am not inclined to dramatize and complicate the implementation process.  Each of us has our own preferences.  Therefore, I did the most common recursion, which draws a tree with parsers. <br><br>  Yes, I was criticized - it is slowly drawn, it will not work on a tree of 10,000 elements, it should be different and in general ... <br><br>  However, since 2008, I have not seen anything else, more accessible, fast and simple.  Perhaps I was looking bad. <br><br>  And here I am, looking down and nervously fiddling with a handkerchief in my hands, I present to you the reincarnation of my helper in the form of a heme based on Rails Engines. <br><br>  I am sure, for drawing small trees (up to 100 elements) and creating small CMS, where you want to manage a tree by simple dragging, my helper will fit perfectly. <br><br>  <a href="https://github.com/the-teacher/the_sortable_tree">https://github.com/the-teacher/the_sortable_tree</a> <br><br><a name="habracut"></a><br><br>  At the moment, there are two options for drawing: <br><br><ol><li>  Sortable tree (Administrative Interface) </li><li>  Normal Tree (User Interface) </li></ol><br><br>  This is how a tree looks like for a user. <br><br><img src="https://habrastorage.org/storage2/e56/308/f07/e56308f07db37226a878193a46bc3ddd.jpg"><br><br>  It is very easy to install the gem and start using it <br><br>  Complete your gemfile.  We need HAML, Awesome nested set and the_sortable_tree drawing helper itself. <br><br><pre><code class="ruby hljs">gem <span class="hljs-string"><span class="hljs-string">'haml'</span></span> gem <span class="hljs-string"><span class="hljs-string">'awesome_nested_set'</span></span> <span class="hljs-comment"><span class="hljs-comment"># gem 'nested_set' gem 'the_sortable_tree'</span></span></code> </pre> <br><br>  I deliberately removed the hard dependency on HAML so that ERB or SLIM fans could also use a helper, but you guys will have to convert the views from Hamla yourself. <br><br>  Check that all JS libraries are connected <br><br>  <b>app / assets / javascripts / application.js</b> <br><br><pre> <code class="ruby hljs">/<span class="hljs-regexp"><span class="hljs-regexp">/= require jquery /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/= require jquery-ui /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/= require jquery_ujs</span></span></code> </pre><br><br>  Consider the use of heme on the example of the Page model. <br><br>  Add an Osprey Model <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Page</span></span></span><span class="hljs-class"> &lt; ActiveRecord::Base </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">acts_as_nested_set</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">include</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TheSortableTree::Scopes</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br><br>  Add a tree rebuild function to the controller. <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PagesController</span></span></span><span class="hljs-class"> &lt; ApplicationController </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">include</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TheSortableTreeController::Rebuild</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br><br>  If you use a reverse tree (sometimes you need an inverted tree, for example, to create a list of news), then use another one. <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PagesController</span></span></span><span class="hljs-class"> &lt; ApplicationController </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">include</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TheSortableTreeController::ReversedRebuild</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br><br>  Complete routes. <br><br>  We need one action to display the tree.  What you call it is not important.  I have this <b>: manage</b> . <br><br>  <b>rebuild</b> - a method that moves a tree element from one position to another.  This method is sewn into heme - it is required. <br><br><pre> <code class="ruby hljs">resources <span class="hljs-symbol"><span class="hljs-symbol">:pages</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> collection <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> get <span class="hljs-symbol"><span class="hljs-symbol">:manage</span></span> post <span class="hljs-symbol"><span class="hljs-symbol">:rebuild</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br><br>  Finish the controller code. <br><br>  Get the whole tree (direct sample order) <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PagesController</span></span></span><span class="hljs-class"> &lt; ApplicationController </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">include</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TheSortableTreeController::Rebuild</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">manage</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pages</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Page</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nested_set</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">all</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br><br>  Reverse sample order <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PagesController</span></span></span><span class="hljs-class"> &lt; ApplicationController </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">include</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TheSortableTreeController::ReversedRebuild</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">manage</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pages</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Page</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">reversed_nested_set</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">all</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br><br>  Let's draw the tree for the administrator by placing the code in the view. <br><br><pre> <code class="ruby hljs">- content_for <span class="hljs-symbol"><span class="hljs-symbol">:css</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> = stylesheet_link_tag <span class="hljs-string"><span class="hljs-string">'the_sortable_tree'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:media</span></span> =&gt; <span class="hljs-symbol"><span class="hljs-symbol">:screen</span></span> - content_for <span class="hljs-symbol"><span class="hljs-symbol">:js</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> = javascript_include_tag <span class="hljs-string"><span class="hljs-string">'jquery.ui.nestedSortable'</span></span> = sortable_tree @pages, <span class="hljs-symbol"><span class="hljs-symbol">:new_url</span></span> =&gt; new_page_path, <span class="hljs-symbol"><span class="hljs-symbol">:max_levels</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span></code> </pre><br><br>  Or we will draw a tree for the user. <br><br><pre> <code class="ruby hljs">- content_for <span class="hljs-symbol"><span class="hljs-symbol">:css</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> = stylesheet_link_tag <span class="hljs-string"><span class="hljs-string">'the_sortable_tree_min'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:media</span></span> =&gt; <span class="hljs-symbol"><span class="hljs-symbol">:screen</span></span> = sortable_tree @pages, <span class="hljs-symbol"><span class="hljs-symbol">:new_url</span></span> =&gt; new_page_path, <span class="hljs-symbol"><span class="hljs-symbol">:path</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'the_sortable_tree_min'</span></span></code> </pre><br><br>  To make <b>content_for: css</b> and <b>content_for: js</b> work, add in <i>layouts / application.xxx</i> <b>yield (: js)</b> and <b>yield (: css)</b> . <br><br>  Of course, how you connect js and css is your business. <br><br>  Everything!  The tree should be displayed and dragged. <br><br>  If something does not work out - download and run <a href="https://github.com/the-teacher/the_sortable_tree_test_app">LiveDemo</a> . <br><br><h5>  Customization display </h5><br><br>  Start the view generator and give it the name of the controller. <br><br><pre> <code class="ruby hljs">rails g <span class="hljs-symbol"><span class="hljs-symbol">the_sortable_tree:</span></span>views pages</code> </pre><br><br>  To customize a custom tree, specify the <b>min</b> parameter <br><br><pre> <code class="ruby hljs">rails g <span class="hljs-symbol"><span class="hljs-symbol">the_sortable_tree:</span></span>views pages min</code> </pre><br><br>  Edit the views and tell the helper where they are: <br><br><pre> <code class="ruby hljs">= sortable_tree @pages, <span class="hljs-symbol"><span class="hljs-symbol">:new_url</span></span> =&gt; new_page_path, <span class="hljs-symbol"><span class="hljs-symbol">:path</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'pages/the_sortable_tree'</span></span></code> </pre><br><br>  I assume that different models can be rendered differently - so the views are copied to the view folder of the specified controller. <br><br>  I hope this is useful to someone. <br><br>  <a href="https://github.com/the-teacher/the_sortable_tree">https://github.com/the-teacher/the_sortable_tree</a> <br><br>  <b>PS:</b> If you notice a spelling or syntax error, an error in the code or any other error, please let me know in person, I will be very grateful to you.  Thank you in advance! </div><p>Source: <a href="https://habr.com/ru/post/137991/">https://habr.com/ru/post/137991/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../137978/index.html">HTML layout: think like a bug</a></li>
<li><a href="../137981/index.html">Github reported a ddos ‚Äã‚Äãattack</a></li>
<li><a href="../137986/index.html">Apple's claim to Samsung rejected in Germany</a></li>
<li><a href="../137987/index.html">The two sides of the ubiquitous use of microcontrollers</a></li>
<li><a href="../137988/index.html">Some news about Stanford University courses for 2012</a></li>
<li><a href="../137994/index.html">Tor has released an obfuscated proxy to disguise traffic in Iran</a></li>
<li><a href="../137995/index.html">New mono-brand HTC salons in Moscow and St. Petersburg</a></li>
<li><a href="../137998/index.html">US court decides whether it is possible to sell used MP3 files</a></li>
<li><a href="../137999/index.html">SDK for Asterisk and 1C: Enterprise 8 communication</a></li>
<li><a href="../138000/index.html">Trustwave recognizes issuing a third-party root certificate.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>