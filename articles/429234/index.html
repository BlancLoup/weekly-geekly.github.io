<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a game "Like coins" on Godot Engine. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=""Godot Engine" is developing very fast and winning the hearts of game developers from around the world. Perhaps this is the most friendly and easy-to-...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a game "Like coins" on Godot Engine. Part 1</h1><div class="post__text post__text-html js-mediator-article"><p>  "Godot Engine" is developing very fast and winning the hearts of game developers from around the world.  Perhaps this is the most friendly and easy-to-learn tool for creating games, and to make sure of this, we will try to make a small 2D game.  For a good understanding of the game development process, you should start with 2D games - this will reduce the threshold for entering a more serious game development.  Although the transition to 3D itself is not as difficult as it may seem, because most of the functions in Godot Engine can be successfully used in both 2D and 3D. </p><a name="habracut"></a><br><h3 id="vvedenie">  Introduction </h3><br><p> The simplest thing you can think of is a game in which our main character will collect coins.  To complicate it a bit, let's add an obstacle and time as a limiting factor.  The game will have 3 scenes: <code>Player</code> , <code>Coin</code> and <code>HUD</code> (not covered in this article), which will be combined into one <code>Main</code> scene. </p><br><p><img src="https://habrastorage.org/webt/vu/vv/ct/vuvvctv4zp9csexcarj4_zitxje.png"></p><br><h3 id="nastroyki-proekta">  Project Settings </h3><br><p>  Before you dive into writing scripts (scripts), which is about 80-90% of the total time spent on creating the game, the first thing to do is to set up our future project.  In large projects, it is useful to create separate folders for storing scenarios, scenes, images and sounds, and we should definitely take note of this, because who knows what end result we will come to. </p><br><blockquote>  I want to make a reservation right away that this article implies that you are a little familiar with the "Godot Engine" and that you have some knowledge and skills to use this tool, although I will be guided by the fact that you are encountering "Godot Engine" for the first time, I am still I advise you to start to get acquainted with the basic component of the engine, study the syntax of GDScript and come to an understanding of the terminology used (nodes, scenes, signals, etc.), and then return here and continue acquaintance. </blockquote><p>  In the program menu go to <code>Project -&gt; Project Settings</code> . </p><br><blockquote>  Another small digression.  I will always give examples based on the fact that the end user uses the English interface of the engine, despite the fact that in "Godot Engine" there is support for the Russian language.  This is done in order to get rid of possible misunderstandings or embarrassments associated with the incorrect / inaccurate translation of certain elements of the program interface. </blockquote><p>  We find the section <code>Display/Window</code> and set the width - <code>800</code> , and the height - <code>600</code> .  Also in this section you should set <code>Stretch/Mode</code> to <code>2D</code> , and <code>Aspect</code> to <code>Keep</code> .  This will prevent stretching and deformation of the contents of the window when it is resized, but in order to prohibit resizing the window, simply uncheck the <code>Resizable</code> box.  I advise you to play with these options. </p><br><p>  Now go to the <code>Rendering/Quality</code> section and turn on <code>Use Pixel Snap</code> in the right pane.  What is it for?  The coordinates of the vectors in Godot Engine are floating point numbers.  Since objects cannot be drawn only half a pixel, this discrepancy can cause visual defects for games where <code>pixelart</code> used.  And it is worth noting that in 3D this parameter is useless.  Keep this in mind. </p><br><h3 id="scena-igrok">  Scene "Player" </h3><br><p>  Let's start creating the first scene - <code>Player</code> . </p><br><blockquote>  The advantage of any scene is that initially they are independent of other parts of the game, and this makes it possible to freely test them and get the result that was originally incorporated into them.  In general, dividing game objects into scenes is a useful tool in creating complex games - it is easier to catch mistakes, make changes to the scene itself, without affecting other parts of the game, they can also serve as templates for other games and they will definitely work exactly , as worked before the transfer. </blockquote><p>  Creating a scene is a trivially simple action - on the <code>Scene</code> tab, click <code>+</code> (Add / Create) and select the <code>Area2D</code> node and immediately change its name not to be confused.  This is our parent node, and in order to extend the functionality, you need to add child nodes.  In our case, these are <code>AnimatedSprite</code> and <code>CollisionShape2D</code> , but let's not hurry, but start in order.  Then you should immediately "lock" the root node: </p><br><p><img src="https://habrastorage.org/webt/5m/wf/ac/5mwfacrfvyjm6wtkmkqlgd_pasu.png"></p><br><p>  If the shape of the body collision (CollisionShape2D) or the sprite (AnimatedSprite) is displaced, stretched relative to the parent node, this will definitely lead to unexpected errors and subsequently it will be difficult to correct them.  With this option enabled, the "parent" and all his "children" will always move together.  It sounds ridiculous, but using this feature is extremely useful. </p><br><h4 id="animatedsprite">  AnimatedSprite </h4><br><p>  <code>Area2D</code> very useful node if you need to know about the overlap event with other objects or about their collision, but by itself it is invisible to the eye and to make the <code>Player</code> object visible, add an <code>AnimatedSprite</code> .  The name of the node suggests that we will deal with animation and sprites.  In the <code>Inspector</code> window, go to the <code>Frames</code> parameter and create a new <code>SpriteFrames</code> .  Working with the <code>SpriteFrames</code> panel is to create the necessary animations and download the corresponding sprites to them.  We will not analyze in detail all the stages of creating animations, leaving it to independent study, I will just say that we should have three animations: <code>walk</code> ( <code>walk</code> animation), <code>idle</code> (rest) and <code>die</code> (death or failure animation).  Do not forget the value of <code>SPEED (FPS)</code> should be equal to <code>8</code> (although you can choose another value - the appropriate one). </p><br><p><img src="https://habrastorage.org/webt/0u/9w/tr/0u9wtrugdci7wueb5tihyoza2hq.png"></p><br><h4 id="collisionshape2d">  CollisionShape2D </h4><br><p>  In order for <code>Area2D</code> to detect collisions, it is necessary to provide it with an object shape.  Shapes are defined by the <code>Shape2D</code> parameter and include rectangles, circles, polygons and other more complex shape types, and the dimensions are already edited in the editor itself, but you can always use the <code>Inspector</code> for more precise settings. </p><br><h4 id="scenarii">  Scenarios </h4><br><p>  Now, in order to ‚Äúrevive‚Äù our game object, you need to set a script for it, according to which the actions specified in this scenario will be carried out.  In the <code>Scene</code> tab, create a script, leave the default settings, erase all comments (lines starting with the '#' sign) and proceed to declaring variables: </p><br><pre> <code class="python hljs">export (int) var speed var velocity = Vector2() var window_size = Vector2(<span class="hljs-number"><span class="hljs-number">800</span></span>, <span class="hljs-number"><span class="hljs-number">600</span></span>)</code> </pre> <br><p>  Using the <code>export</code> keyword allows you to set the <code>speed</code> variable in the <code>Inspector</code> panel window.  This is a very useful method if we want to get custom values ‚Äã‚Äãthat are convenient to edit in the <code>Inspector</code> window.  Set the <code>Speed</code> to <code>350</code> .  The <code>velocity</code> value will determine the direction of movement, and <code>window_size</code> will define the area that limits the player‚Äôs movement. </p><br><p>  The further order of our actions is as follows: use the <code>get_input()</code> function to check whether keyboard input is made.  Then we move the object according to the keys pressed and then play the animation.  The player will move in four directions.  By default, in Godot Engine there are events assigned to the arrow keys ( <code>Project -&gt; Project Settings -&gt; Input Map</code> ), so we can apply them to our project.  To find out if a key is pressed, use <code>Input.is_action_pressed()</code> by slipping to it the name of the event that we want to track. </p><br><pre> <code class="python hljs">func get_input(): velocity = Vector2() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Input.is_action_pressed(<span class="hljs-string"><span class="hljs-string">"ui_left"</span></span>): velocity.x -= <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Input.is_action_pressed(<span class="hljs-string"><span class="hljs-string">"ui_right"</span></span>): velocity.x += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Input.is_action_pressed(<span class="hljs-string"><span class="hljs-string">"ui_up"</span></span>): velocity.y -= <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Input.is_action_pressed(<span class="hljs-string"><span class="hljs-string">"ui_down"</span></span>): velocity.y += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> velocity.length() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>: velocity = velocity.normalized() * speed</code> </pre> <br><p>  At first glance, everything looks good, but there is one small nuance.  The combination of several keystrokes (for example, down and left) will cause the addition of vectors and in this case the player will move faster than if he just moved down.  To avoid this, we will use the method <code>normalized()</code> - it will return the length of the vector to <code>1</code> . </p><br><p>  So, the keystroke events were tracked, now we need to move the <code>Player</code> object.  The <code>_process()</code> function will help us in this, which is called every time a frame is changed, so it is advisable to use it for those objects that will change frequently. </p><br><pre> <code class="python hljs">func _process(delta): get_input() position += velocity * delta position.x = clamp(position.x, <span class="hljs-number"><span class="hljs-number">0</span></span>, window_size.x) position.y = clamp(position.y, <span class="hljs-number"><span class="hljs-number">0</span></span>, window_size.y)</code> </pre> <br><p>  I hope you notice the <code>delta</code> parameter, which in turn is multiplied by the speed.  It is necessary to give an explanation of what it is.  The game engine is initially configured to work at a speed of 60 frames per second.  However, there may be situations when the computer, or the "Godot Engine" itself, slows down.  If the frame rate is not coordinated (the time for which the frames are replaced), this will affect the ‚Äúsmoothness‚Äù of movement of game objects (as a result, the movement is ‚Äújerky‚Äù).  "Godot Engine" solves this problem (like most similar engines) by entering the variable <code>delta</code> - it gives the value for which the frames were replaced.  Thanks to these values, you can "align" the movement.  Pay attention to another noteworthy function - <code>clamp</code> (returns a value within two specified parameters), thanks to it we have the ability to limit the area in which the <code>Player</code> can move, simply by setting the minimum and maximum value of the area. </p><br><p>  Do not forget to animate our object.  Please note that when an object moves to the right, you need to flip the <code>AnimatedSprite</code> (using <code>flip_h</code> ) and our hero will look in that direction to where he is moving.  Make sure that the <code>Playing</code> parameter is enabled in <code>AnimatedSprite</code> so that the animation starts playing. </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> velocity.length() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>: $AnimatedSprite.animation = <span class="hljs-string"><span class="hljs-string">"walk"</span></span> $AnimatedSprite.flip_h = velocity.x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: $AnimatedSprite.animation = <span class="hljs-string"><span class="hljs-string">"idle"</span></span></code> </pre> <br><h4 id="rozhdenie-i-smert">  Birth and death </h4><br><p>  When starting the game, the main scene needs to inform the key scenes about the readiness to start a new game, in our case, inform the <code>Player</code> object about the start of the game and set initial parameters for it: appearance position, default animation, run <code>set_process</code> . </p><br><pre> <code class="python hljs">func start(pos): set_process(true) <span class="hljs-comment"><span class="hljs-comment">#     Vector2(x, y) position = pos $AnimatedSprite.animation = "idle"</span></span></code> </pre> <br><p>  We will also provide for the player‚Äôs death event when the time runs out or the player stumbles upon an obstacle, and setting <code>set_process (false)</code> will cause the <code>_process ()</code> function to no longer be executed for this scene. </p><br><pre> <code class="python hljs">func die(): $AnimatedSprite.animation = <span class="hljs-string"><span class="hljs-string">"die"</span></span> set_process(false)</code> </pre> <br><h4 id="dobavlenie-kolliziy">  Adding collisions </h4><br><p>  It was the turn to make the player detect collisions with coins and obstacles.  The easiest way to do this is with the help of signals.  Signals are a great way to send a message so that other nodes can detect and respond to them.  Most nodes already have built-in signals, but it is possible to define "custom" signals for your own purposes.  Signals are added if you declare them, at the beginning of the script: </p><br><pre> <code class="python hljs">signal pickup signal die</code> </pre> <br><p>  Review the list of signals in the <code>Inspector</code> window ( <code>Node</code> tab), and pay attention to our signals, and signals that already exist.  Now we are interested in <code>area_entered ()</code> , it assumes that the objects with which the collision will occur also have the type <code>Area2D</code> .  We connect the <code>area_entered ()</code> signal using the <code>Connect</code> button, and in the <code>Connect Signal</code> window, select the highlighted node (Player), and leave everything else as default. </p><br><pre> <code class="python hljs">func _on_Player_area_entered( area ): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> area.is_in_group(<span class="hljs-string"><span class="hljs-string">"coins"</span></span>): <span class="hljs-comment"><span class="hljs-comment">#  emit_signal("pickup") area.pickup()</span></span></code> </pre> <br><p>  In order for objects to be easily detected and interact with them, they need to be defined in appropriate groups.  The creation of the groups themselves is now omitted, but we will definitely return to them later.  The <code>pickup()</code> function determines the behavior of a coin (for example, it can play an animation or sound, delete an object, etc.). </p><br><h4 id="scena-monetka">  Scene "Coin" </h4><br><p>  When creating a scene with one coin, you need to do everything that we have done with the "Player" scene, except that in <code>AnimatedSprite</code> will be only one animation (highlight).  <code>Speed (FPS)</code> can be increased to <code>14</code> .  Another change the scale <code>AnimatedSprite</code> - <code>0,5, 0,5</code> .  And the dimensions of <code>CollisionShape2D</code> should correspond to the image of the coin, the main thing is not to scale it, namely, change the size using the appropriate markers on the form in the 2D editor, which <br>  adjusts the radius of the circle. </p><br><p><img src="https://habrastorage.org/webt/63/uc/jq/63ucjq07ny8i7pjjyakue47ojdg.png"></p><br><p>  Groups are a kind of labeling node that allows you to identify similar nodes.  In order for the <code>Player</code> object to react to touch with coins, the coins must belong to the group, let's call it <code>coins</code> .  Select the <code>Area2D</code> node (with the name "Coin") and in the <code>Node -&gt; Groups</code> tab <code>Node -&gt; Groups</code> assign a tag to it, creating the corresponding group. </p><br><p><img src="https://habrastorage.org/webt/a5/3q/sk/a53qskzr8be5yfagoubkbe2vbrs.png"></p><br><p>  For <code>Coin</code> nodes we create a script.  The <code>pickup()</code> function will be called by the <code>Player</code> object's script and will tell the coin what to do when it worked.  The <code>queue_free()</code> method will safely remove a node from the tree with all its child nodes and clear the memory, but the deletion will not work immediately, it will first be moved to the queue to be deleted at the end of the current frame.  It is much safer than deleting the node immediately, because other "participants" (nodes or scenes) in the game may still need the existence of this node. </p><br><pre> <code class="python hljs">func pickup (): queue_free ()</code> </pre> <br><h4 id="zaklyuchenie">  Conclusion </h4><br><p>  Now we can create the <code>Main</code> scene, drag and drop both scenes into the 2D editor: <code>Player</code> and <code>Coin</code> , and check how the player‚Äôs movement and contact with the coin work by running the scene (F5).  Well, I hurry to say that the first part of the creation of the game "Like Coins" is over, let me take my leave and thank everyone for their attention.  If you have something to say, add material or you see errors in the article - be sure to report this by writing a comment below.  Do not be afraid to be tough and critical.  Your "reverse response" will tell you whether I am moving in the right direction and what can be corrected so that the material is even more interesting and useful. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/429234/">https://habr.com/ru/post/429234/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../429224/index.html">Dark web form patterns or what the most conversion form would be</a></li>
<li><a href="../429226/index.html">Dynamic pricing, or How Yandex.Taxi predicts high demand</a></li>
<li><a href="../429228/index.html">PMP. Exam. What is worth considering and why it is needed</a></li>
<li><a href="../429230/index.html">Report: Epson projectors at Integrated Systems Russia 2018</a></li>
<li><a href="../429232/index.html">Career steroids. Dogs</a></li>
<li><a href="../429236/index.html">How many Data Scientists do you need to twist the light bulb (or which team will force the data to work on the business)</a></li>
<li><a href="../429238/index.html">Once again about Tier levels</a></li>
<li><a href="../429240/index.html">How I tried to fix the search on the cards for drivers</a></li>
<li><a href="../429242/index.html">‚ÄúDo not be shy. Try it! Interviews about life, compilers and compiler life with Alexandre Mutel from Unity</a></li>
<li><a href="../429244/index.html">Greedy Dwarf: As I wrote market analytics in Lineage 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>