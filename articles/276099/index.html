<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Add local search system to Android application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many programs need a search function. Today we look at an example of the implementation of such functionality in the application for a restaurant. Our...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Add local search system to Android application</h1><div class="post__text post__text-html js-mediator-article">  Many programs need a search function.  Today we look at an example of the implementation of such functionality in the application for a restaurant.  Our main goal is to give the user the ability to quickly and easily find in the menu of many dishes what he wants. <br><br>  We will talk about how we added a <a href="https://developer.android.com/training/search/index.html">local search</a> function to the content of an existing application while maintaining the uniformity of the user interface.  Here we will look at the changes made to the user interface and the reasons for these changes; we will also talk about adding a GestureOverlayView object to the element of the Activity class and creating our own gestures.  Naturally, special attention will be paid to the search. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1b8/c52/750/1b8c52750703f59ba9df071dc5162307.png"></div><br>  <i><font color="#999999">Search results screen in the restaurant application</font></i> <br><a name="habracut"></a><br><h2>  <font color="#0071c5">More about the search</font> </h2><br>  Before you add a search function to your application, you need to take into account some features, answer a number of questions. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>What exactly should you look for?</b>  We want to search for product titles and descriptions so that the user can get the most complete set of results, since the headers alone do not always allow us to understand exactly which dish we are talking about.  In addition, hidden metadata can be added to the items being searched. <br><br>  <b>How to display search results, which layout to use for this?</b>  We started with a list (the ListView object), made it in the same style as the shopping cart.  However, with this view, the dishes do not look particularly attractive - the small sizes of the photographs are to blame.  When we increased the size of the images in the list, it turned out that the page now has too little space to display the results.  As a result, it was decided to place the search results in the grid (the GridView element), to do the same as done in the main part of the restaurant menu, but instead of placing a large block with details about the selected dish on the side, we placed a set of products on the whole screen.  This, in particular, helps to quickly distinguish the page with the search results from the usual menu screen.  In order to see the details of the dish, the user must touch his photo on the search results page.  In response to this, a dialog box will appear above the page (the DialogFragment object), it can be seen in one of the figures below.  Thanks to this, the user can quickly return to the search page and continue browsing other dishes just by touching the space outside the dialog box.  The search should ideally be performed almost instantly, without delay, as users want to find what they need as quickly as possible.  Otherwise, they either will not be able to find what they want, or they will simply get tired of waiting for the results, they simply will not search for anything and leave the application. <br><br>  <b>How to handle confidential user data?</b>  You can create a search system that will give hints based on previously entered search queries or a search for which the user will need to enter more or less detailed information about themselves.  This raises questions about what other people can see exactly what the user is looking for, and about where exactly the entered personal data is being sent.  In our case, we are talking about the application of the restaurant, so if someone finds out that the user likes chocolate cakes, nothing terrible will happen.  However, there are projects in which confidentiality must be given the closest attention.  In our application, the user does not need to enter any information about himself, search queries are not logged, their history is not maintained. <br><br><h2>  <font color="#0071c5">Search in the application for the restaurant</font> </h2><br>  The first step in implementing a search in the restaurant application is to rework the database class and add a method to it to build a new table with search results.  The table will be used to display information on the screen.  Details about the database with which we work in this application can be found <a href="https://software.intel.com/en-us/android/articles/using-a-database-with-your-android-app">here</a> .  Database search is easy to implement using SQLite queries.  In fact, here you need a few lines of code.  Here we perform a search in the names and descriptions of products of all that contains a search query entered by the user.  As a search result, we return all the database columns, since this information will be needed later to display the details of the dish that the user has touched.  Note that if your database is very large, the search may take a considerable time, so you should think about displaying a progress bar or a rotating indicator so that the user can see that the application is running.  Here is a method to perform a database search. <br><br><pre><code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/** *   ,    (searchTerm)     */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Cursor</span></span> searchMenuItems(String searchTerm) { SQLiteDatabase db = getReadableDatabase(); SQLiteQueryBuilder qb = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> SQLiteQueryBuilder(); qb.setTables(<span class="hljs-keyword"><span class="hljs-keyword">TABLES</span></span>.MENU); <span class="hljs-keyword"><span class="hljs-keyword">Cursor</span></span> c = qb.query(db, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, "("+MenuColumns.NAME+" LIKE '%"+searchTerm+"%') " + "OR ("+MenuColumns.DESCRIPTION+" LIKE '%" + searchTerm+"%')", <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> c; }</code> </pre> <br>  Now we need to refine our main Activity, include a search string in the ActionBar.  To learn more about configuring ActionBar, refer to <a href="https://software.intel.com/en-us/android/articles/building-dynamic-ui-for-android-devices">this</a> material.  Search functionality will be fully implemented within the application.  We do not need to have other programs installed on the device participate in the search, we don‚Äôt even need to send a search request to some external application. <br><br>  Add this string variable to the MainActivity class.  We will use it to send the query string to the search intent.  This is a class variable for adding additional data to an Intent class object. <br><br><pre> <code class="hljs swift"><span class="hljs-comment"><span class="hljs-comment">/*    */</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-type"><span class="hljs-type">SEARCH_MESSAGE</span></span>= <span class="hljs-string"><span class="hljs-string">"com.example.restaurant.MESSAGE"</span></span>;</code> </pre> <br>  Now let's update the onCreateOptionsMenu method in the MainActivity class.  Add the code to initialize the ActionBar: <br><br><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/** *  action menu  ActionBar */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">boolean</span></span> onCreateOptionsMenu(Menu menu) {   getMenuInflater().inflate(R.menu.action_bar, menu);   //     MenuItem searchItem = menu.findItem(R.id.action_search);   SearchView mSearchView = (SearchView) searchItem.getActionView();   searchItem.setShowAsActionFlags(MenuItem.SHOW_AS_ACTION_IF_ROOM           | MenuItem.SHOW_AS_ACTION_COLLAPSE_ACTION_VIEW);   //      mSearchView.setOnQueryTextListener(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OnQueryTextListener() {       @Override       <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">boolean</span></span> onQueryTextSubmit(String query) {      //  intent      Intent searchIntent = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Intent(MainActivity.this, SearchResultsActivity.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>);      searchIntent.putExtra(SEARCH_MESSAGE, query);           startActivity(searchIntent);           <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>;       }       @Override       <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">boolean</span></span> onQueryTextChange(String query) {           //                <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>;       }   });     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> super.onCreateOptionsMenu(menu); }</code> </pre> <br>  Now add the class SearchResultActivity. <br><br><pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> SearchResultsActivity extends Activity{ TextView mQueryText; GridView searchListResults; SearchAdapter adapter; Vector&lt;com.example.restaurant.MenuFactory.MenuItem&gt; searchList; @Override <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); setContentView(R.layout.search_query_grid_results); mQueryText = (TextView) findViewById(R.id.txt_query); // GridView searchListResults = (GridView)findViewById(R.id.search_results); searchList= <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Vector&lt;com.example.restaurant.MenuFactory.MenuItem&gt;(); //      final Intent queryIntent = getIntent(); doSearchQuery(queryIntent); adapter= <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> SearchAdapter(this,searchList); searchListResults.setAdapter(adapter); //  GridView searchListResults.setOnItemClickListener(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> AdapterView.OnItemClickListener() { @Override <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> onItemClick(AdapterView&lt;?&gt; parent, <span class="hljs-keyword"><span class="hljs-keyword">View</span></span> v, <span class="hljs-type"><span class="hljs-type">int</span></span> position, long id){ FragmentTransaction ft = getFragmentManager().beginTransaction(); Fragment prev = getFragmentManager().findFragmentByTag("dialog"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prev != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { ft.remove(prev); } ft.addToBackStack(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); DialogFragment newFragment = SearchResultsDialogFragment.newInstance(searchList.elementAt(position)); newFragment.<span class="hljs-keyword"><span class="hljs-keyword">show</span></span>(ft, "dialog"); } }); }</code> </pre> <br>  Being engaged in the construction of the list, we process and the option when nothing was found as a result of the search.  Namely, if the search did not return any results, we will show the user a dialog box, let us know what happened and close the Activity in which it was planned to display the results.  As a result, the user will not see a blank page.  We do this in the same class SearchResultActivity, its continuation is given below. <br><br><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/** *    . */</span></span> private <span class="hljs-type"><span class="hljs-type">void</span></span> doSearchQuery(final Intent queryIntent) { //   String message= queryIntent.getStringExtra(MainActivity.SEARCH_MESSAGE); //       mQueryText.setText(message); RestaurantDatabase dB= <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> RestaurantDatabase(this); MenuFactory mMF= MenuFactory.getInstance(); <span class="hljs-keyword"><span class="hljs-keyword">Cursor</span></span> c= dB.searchMenuItems(message); <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>&lt;String&gt; categories = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> HashSet&lt;String&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (c.moveToNext()) { String category = c.getString(c.getColumnIndexOrThrow(RestaurantDatabase.MenuColumns.CATEGORY)); categories.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(category); //         MenuItem item= mMF.<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> MenuItem(); item.setCategory(category); item.setName(c.getString(c.getColumnIndexOrThrow(RestaurantDatabase.MenuColumns.NAME))); item.setDescription(c.getString(c.getColumnIndexOrThrow(RestaurantDatabase.MenuColumns.DESCRIPTION))); item.setNutrition(c.getString(c.getColumnIndexOrThrow(RestaurantDatabase.MenuColumns.NUTRITION))); item.setPrice(c.getString(c.getColumnIndexOrThrow(RestaurantDatabase.MenuColumns.PRICE))); item.setImageName(c.getString(c.getColumnIndexOrThrow(RestaurantDatabase.MenuColumns.IMAGENAME))); searchList.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(item); } c.<span class="hljs-keyword"><span class="hljs-keyword">close</span></span>(); //   ,     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(searchList.size()==<span class="hljs-number"><span class="hljs-number">0</span></span>){ Intent intent = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Intent(SearchResultsActivity.this, OrderViewDialogue.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>); intent.putExtra(OrderViewActivity.DIALOGUE_MESSAGE, "Sorry, no matching items found."); startActivity(intent); SearchResultsActivity.this.finish(); } }</code> </pre> <br>  The following is an adapter for the GridView element.  We built it on the basis of a similar code from the main menu, making minor changes to it.  In addition, we can modify the existing layout files.  Building consistently looking application screens is one of the benefits of code reuse, complementing the lack of the need to create each screen from scratch.  Above, you may have noticed that we reused the OrderViewDialogue class, originally written for the basket, but appropriate here.  So, here is the continuation of the code: <br><br><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/** *  SearchAdapter   GridView   .    view_grid_item,     ,    . */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> SearchAdapter extends BaseAdapter { private Vector&lt;com.example.restaurant.MenuFactory.MenuItem&gt; mFoundList; private LayoutInflater inflater; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> SearchAdapter(Context c, Vector&lt;com.example.restaurant.MenuFactory.MenuItem&gt; list) { mFoundList= list; inflater = LayoutInflater.<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>(c); } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> getCount() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mFoundList.size(); } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span> getItem(<span class="hljs-type"><span class="hljs-type">int</span></span> position) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mFoundList.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(position); } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> long getItemId(<span class="hljs-type"><span class="hljs-type">int</span></span> position) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } //    ItemView   ,    <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">View</span></span> getView(<span class="hljs-type"><span class="hljs-type">int</span></span> position, <span class="hljs-keyword"><span class="hljs-keyword">View</span></span> convertView, ViewGroup parent) { <span class="hljs-keyword"><span class="hljs-keyword">View</span></span> v = convertView; ImageView picture; TextView <span class="hljs-type"><span class="hljs-type">name</span></span>; TextView price; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(v == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { v = inflater.inflate(R.layout.view_grid_item, parent, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); v.setTag(R.id.picture, v.findViewById(R.id.picture)); v.setTag(R.id.grid_name, v.findViewById(R.id.grid_name)); v.setTag(R.id.grid_price, v.findViewById(R.id.grid_price)); } picture= (ImageView) v.getTag(R.id.picture); <span class="hljs-type"><span class="hljs-type">name</span></span>= (TextView) v.getTag(R.id.grid_name); price= (TextView) v.getTag(R.id.grid_price); final MenuItem foundItem = (MenuItem) mFoundList.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(position); InputStream inputStream = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; AssetManager assetManager = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; try { assetManager = getAssets(); inputStream = assetManager.<span class="hljs-keyword"><span class="hljs-keyword">open</span></span>(foundItem.imageName); picture.setImageBitmap(BitmapFactory.decodeStream(inputStream)); } catch (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> e) { <span class="hljs-keyword"><span class="hljs-keyword">Log</span></span>.d("ActionBarLog", e.getMessage()); } finally { } <span class="hljs-type"><span class="hljs-type">name</span></span>.setText(foundItem.name); price.setText(foundItem.price); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> v; } } }</code> </pre> <br>  Another detail to consider is the use of a portrait or landscape version of the interface.  Below is the code of the search_query_grid_results.xml file, which is located in the res / layout-land folder and sets the landscape variant of the interface.  The number of columns (numColumns) is set to 4. Almost the same file for the portrait orientation of the interface is located in the res / layout-port folder.  It differs from the landscape version only in that the elements in it are arranged in two columns. <br><br><pre> <code class="hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingLeft</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingRight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingBottom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:orientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:orientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"horizontal"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@style/FragmentTitle"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Results For: "</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/txt_query"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@style/OrderTitle"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">GridView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/search_results"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fill_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:numColumns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:verticalSpacing</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:horizontalSpacing</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_weight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:stretchMode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"columnWidth"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:gravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"center"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  This is what the search results screen looks like, over which a dialog box with details about the dish is opened, which the user has touched. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0ad/b87/f30/0adb87f30dd7f207b38008b4c7ae3429.png"></div><br>  <i><font color="#999999">Search screen and window with dish details</font></i> <br><br><h2>  <font color="#0071c5">Gesture processing</font> </h2><br>  In order to exit the search results window, we would like to move, brush it with an appropriate gesture to the left or to the right, just like when viewing other pages in the main menu.  The GestureDetector class works fine with lists (ListView), but not with tables (GridView).  Therefore, we need to switch to using GestureOverlayView. <br><br>  First you need to create a library of gestures using the GestureBuilder application, which can be found among the examples that come with the Android SDK.  In particular, what we need is located at android \ sdk \ samples \ android-23 \ legacy \ GestureBuilder. <br><br>  To use the application, you need to compile and run it on the device, and then specify the names and configurations of gestures with it.  After adding all the necessary gestures (in our case, this is sliding to the left, left swipe, and sliding to the right, right swipe), copy the ‚Äúgestures‚Äù file from the device and place it in the res / raw folder.  The application will tell you the exact location of this file, in our case it was enough to connect the device to the PC via USB and look in the root directory. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8c7/ba7/3d9/8c7ba73d97f3811968f54170e492d75e.png"></div><br>  <i><font color="#999999">Gesture Builder application</font></i> <br><br>  Having copied the gesture file to the right place, you need to update the SearhcResultActivity class, adding variable declarations to it to work with GestureOverlayView: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">GestureLibrary</span></span> gestureLibrary; <span class="hljs-attribute"><span class="hljs-attribute">GestureOverlayView</span></span> gestureOverlayView;</code> </pre> <br>  In the onCreate method, you need to initialize the interface element, load the library, and set up a listener that defines the program's actions in response to gestures performed by the user.  For the successful operation of the mechanism in question, you need to make sure that the code uses the same names that are recorded in the gestures library. <br><br>  As an animation, we decided to apply overridePendingTransition.  For inbound animation, the value 0 is used, which means no animation.  You can create an empty animation xml file and use it, but this will cause the system to spend a lot of time on ‚Äúthinking‚Äù and the outgoing animation will be performed too quickly. <br><br><pre> <code class="hljs pgsql">gestureOverlayView = (GestureOverlayView)findViewById(R.id.gestures); //      gestureLibrary = GestureLibraries.fromRawResource(this, R.raw.gestures); gestureLibrary.<span class="hljs-keyword"><span class="hljs-keyword">load</span></span>(); gestureOverlayView.addOnGesturePerformedListener(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OnGesturePerformedListener(){ @Override <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> onGesturePerformed(GestureOverlayView <span class="hljs-keyword"><span class="hljs-keyword">view</span></span>, Gesture gesture) { ArrayList&lt;Prediction&gt; prediction = gestureLibrary.recognize(gesture); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(prediction.size() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>){ String action= prediction.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>).name; //       "left swipe"  "right swipe" <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>("left swipe".equals(action)){ //  SearchResultsActivity.this.finish(); overridePendingTransition(<span class="hljs-number"><span class="hljs-number">0</span></span>, R.anim.move_left); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>("right swipe".equals(action)){ //  SearchResultsActivity.this.finish(); overridePendingTransition(<span class="hljs-number"><span class="hljs-number">0</span></span>, R.anim.move_right); } } }}); // ¬´ ¬ª  ,   ,       gestureOverlayView.setGestureVisible(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>);</code> </pre> <br>  Here is the code for the left shift animation file, move_left.xml.  The file responsible for the right shift animation, move_right.xml, looks exactly the same, except that the value of toXDelta is non-negative. <br><br><pre> <code class="hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">translate</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:duration</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"500"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:fromXDelta</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:toXDelta</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"-100%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:interpolator</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@android:anim/decelerate_interpolator"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br>  Note that GrivView cannot have a layout_height parameter equal to 0dp when it is inside a GestureOverlayView, as it will take the specified 0dp instead of expanding, like a LinearLayout.  In order to fulfill this requirement, in our case, the layout_height parameter was set to fill_parent.  In addition, we do not need gestures to be visible, nor do we need a delay, which is caused by the fact that the line of gestures smoothly disappears from the screen.  Our ‚Äúlines of gestures‚Äù are already transparent, and we don‚Äôt need any extra delays.  Therefore, we set fadeOffset and fadeDuration to 0. Below is the updated xml code that defines the relationship between GridView and GestureOverlayView. <br><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">android.gesture.GestureOverlayView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/gestures"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fill_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fill_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:fadeOffset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:fadeDuration</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:eventsInterceptionEnabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">GridView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/search_results"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fill_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fill_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:numColumns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:verticalSpacing</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:horizontalSpacing</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_weight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:stretchMode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"columnWidth"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:gravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"center"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">android.gesture.GestureOverlayView</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h2>  <font color="#0071c5">findings</font> </h2><br>  We reviewed the sequence of decisions that need to be made when designing a local search system for an Android application.  In addition, we talked about some potential problems, and how to avoid them, gave examples of code and xml markup.  Now you can easily integrate search functionality into your own application and at the same time your search will not only work, but also take user requirements into account.  And this means that they will find what they need. </div><p>Source: <a href="https://habr.com/ru/post/276099/">https://habr.com/ru/post/276099/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../276089/index.html">Compression of textures in Android: format comparison and code samples</a></li>
<li><a href="../276091/index.html">A game for those learning to program: Colobot</a></li>
<li><a href="../276093/index.html">TensorFlow and Logistic Regression</a></li>
<li><a href="../276095/index.html">Prediction, cloud computing in 2016</a></li>
<li><a href="../276097/index.html">Game design: on the other side of the game</a></li>
<li><a href="../276101/index.html">Well, this day has come: quick joint editing in ONLYOFFICE editors</a></li>
<li><a href="../276103/index.html">Data Center Experience and Problems: How to Verify Data Center Reliability</a></li>
<li><a href="../276105/index.html">SEO-tools - an extension for Opera (webmaster and optimizer tools)</a></li>
<li><a href="../276107/index.html">Who celebrated the New Year with the Russians?</a></li>
<li><a href="../276109/index.html">Domains: is there life after death?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>