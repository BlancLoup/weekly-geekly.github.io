<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How an error found in the IE9 Platform Preview caused a change in the Javascript standard</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When we first announced our plans for the pre-release versions of IE9, we said that "developers and people interested in standards and web development...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How an error found in the IE9 Platform Preview caused a change in the Javascript standard</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/f05/6a0/599/f056a0599cdfb274f229474edd648cd3.gif" alt="image" align="right"><br>  When we first announced our plans for the pre-release versions of IE9, we said that "developers and people interested in standards and web development will be able to try out the pre-release version of IE9 and make comments and suggestions regarding its work."  At the moment we <a href="https://connect.microsoft.com/ie">receive</a> daily <a href="https://connect.microsoft.com/ie">feedback</a> and use them to improve Internet Explorer 9. However, sometimes feedback is not only about IE9.  This story is about how a recent review on the Internet Explorer 9 Platform Preview caused a change in the new JavaScript standard - the <a href="http://www.ecma-international.org/publications/standards/Ecma-262.htm">5th edition of EcmaScript</a> . <a name="habracut"></a><br><br>  The EcmaScript 5 standard was officially adopted in December 2009, and the third preliminary version of Internet Explorer 9 is our first most complete implementation.  ES5 was designed to remain fully compatible with existing sites, and <a href="http://www.ecma-international.org/memento/TC39.htm">TC39's technical committee</a> worked to avoid any non-security changes that could render existing JavaScript code inoperable.  However, nothing is perfect in the software world, and when we released the third preview version of Internet Explorer 9, we wondered if there were any compatibility issues with existing sites related to ES5. <br><br><img src="http://upload.wikimedia.org/wikipedia/en/2/2f/Jquerylogo.png" alt="image" align="right"><br>  Shortly after the release of the preliminary version of our browser, we received several complaints that some web applications that use <a href="http://jquery.com/">jQuery do</a> not work correctly in IE9.  We found out that the problem was the <a href="http://api.jquery.com/jQuery.isFunction/">following</a> JQuery API <a href="http://api.jquery.com/jQuery.isFunction/">method</a> , which in some cases did not work, because the code of the method did not check the user-supplied value for <code><font color="black">null</font></code> or <code><font color="black">undefined</font></code> before calling <code><font color="black">Object.prototype.toString</font></code> .  In particular, some of the calls to this jQuery method <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">isFunction: <font color="#0000ff">function</font> ( obj ) { <br> <font color="#0000ff">return</font> toString.call(obj) === <font color="#A31515">"[object Function]"</font> ; <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  terminated by the exception: <code><font color="black">‚ÄúTypeError: Object expected‚Äù</font></code> .  Further analysis showed that <code><font color="black">toString</font></code> is a built-in <code><font color="black">Object.prototype.toString</font></code> method that caused a crash when <code><font color="black">isFunction</font></code> called it with an <code><font color="black">undefined</font></code> value as an argument.  Why this exception occurred only in IE9, and not in earlier versions of IE, as well as in browsers from other manufacturers?  It is precisely because the behavior of the third pre-release version of IE9 in the standard mode really complies with the ES5 <code><font color="black">Object.prototype.toString</font></code> specification. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      According to the previous <a href="http://www.ecma-international.org/publications/standards/Ecma-262-arch.htm">EcmaScript specification,</a> calling the built-in method with the <code><font color="black">null</font></code> or <code><font color="black">undefined</font></code> parameter results in the transfer of a ‚Äúglobal object‚Äù (for browsers, this is the DOM <code><font color="black">window</font></code> object).  This opens up a whole host of potential security holes for frameworks whose goal is to make web applications work in safe mode. <br><br>  The ES5 specification has changed this behavior so that passing <code><font color="black">null</font></code> or <code><font color="black">undefined</font></code> does not cause the <code><font color="black">window</font></code> object to be passed to the function.  The definition of each inline method has been updated specifically to solve the problem of getting these values ‚Äã‚Äãas the value of <code><font color="black">this</font></code> .  The technical committee attempted to do so in order to maintain backward compatibility for normal use and generate an exception when this is not possible.  This created the compatibility issue described above. <br><br>  This problem can be simply solved by changing the jQuery code: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">isFunction: <font color="#0000ff">function</font> ( obj ) { <br> <font color="#0000ff">return</font> obj &amp;&amp; toString.call(obj) === <font color="#A31515">"[object Function]"</font> ; <br> },</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  In fact, the jQuery team <a href="http://dev.jquery.com/ticket/6740">plans to make</a> this change.  However, this change does not affect the thousands of locally used jQuery libraries existing on the web.  Given the high prevalence of jQuery, it becomes obvious that the ES5 specification contains a serious compatibility issue.  It is also quite obvious how we can change our implementation of ES5 in IE9 to solve the problem.  We can simply return the string value <code><font color="black"><font color="#A31515">"[object Object]"</font></font></code> , the same value returns IE8 in this situation.  This fix does not add security problems that ES5 tries to solve.  However, we do not want to unilaterally introduce such a difference in our implementation of the new standard.  This solution will not help to solve compatibility and <a href="http://ru.wikipedia.org/wiki/%25D0%2598%25D0%25BD%25D1%2582%25D0%25B5%25D1%2580%25D0%25BE%25D0%25BF%25D0%25B5%25D1%2580%25D0%25B0%25D0%25B1%25D0%25B5%25D0%25BB%25D1%258C%25D0%25BD%25D0%25BE%25D1%2581%25D1%2582%25D1%258C">interoperability</a> problems if IE corrects this problem in one of the ways, while other browsers do not fix it at all or do it differently. <br><br>  As soon as we understood the problem and the possible solution, I raised this issue <a href="https://mail.mozilla.org/listinfo/es5-discuss">on the mailing list for discussions</a> of the TC39 committee.  My first post on this issue was posted at 5:51 pm on Friday June 25th.  By 10 pm, replies were received from TC39 members representing Apple, Mozilla, and Google.  We all agreed that this was a compatibility issue that needs to be addressed, and the generation of an exception in this case is not necessary and undesirable.  Initially, we agreed that the idea of ‚Äã‚Äãreturning a string value, as written in ES3, looks like a good idea for such cases.  However, in further discussion on the weekend, we realized that not all browsers currently return <code><font color="black"><font color="#A31515">"[object Object]"</font></font></code> , we also considered the following values <code><font color="black"><font color="#A31515">"[object Window]"</font></font></code> and <code><font color="black"><font color="#A31515">"[object Global]"</font></font></code> . <br><br>  It was suggested to return <code><font color="black"><font color="#A31515">"[object null]"</font></font></code> and <code><font color="black"><font color="#A31515">"[object undefined]"</font></font></code> .  This solution seems to be the best, since it not only eliminates such a problem, as in the case of jQuery, but also makes it possible to clearly distinguish between null and null objects.  This solution also increases browser interoperability because it requires browsers to produce the same result, not the ES3 situation, which led to different results in different browsers. <br><br>  On Tuesday, this decision was taken by consensus as final.  Once agreement was reached, I passed the revised <code><font color="black">Object.prototype.toString</font></code> specifications to the IE9 JavaScript development team so that they can make corrections to the current implementation before publicly testing the next preview version of IE9.  Mozilla also <a href="https://bugzilla.mozilla.org/show_bug.cgi%3Fid%3D575522">confirmed</a> that it will accept this fix in the next beta version of Firefox.  I also updated the <a href="http://wiki.ecmascript.org/lib/exe/fetch.php%3Fid%3Dstart%26cache%3Dcache%26media%3Dresources:es5_errata_7-1-10.pdf">TC39</a> official <a href="http://wiki.ecmascript.org/lib/exe/fetch.php%3Fid%3Dstart%26cache%3Dcache%26media%3Dresources:es5_errata_7-1-10.pdf">list of fixes for ES5</a> , this change is described in section 15.2.4.2 of the specification. <br><br>  Web standards are complex software artifacts, and like all software, they contain bugs.  Sometimes the best way to find and fix a compatibility error is to implement the standard in a widely accepted browser.  This method is usually used in the context of the release of earlier versions of the browser, as is the case with Internet Explorer 9 Platform Preview.  Thus, when you, as a web developer, send feedback to a specific browser, you also give feedback to the standards that it implements.  Of course, in this case, browser authors and standards writers should be able to quickly respond to the problem.  A quick response to the ES5 <code><font color="black">Object.prototype.toString</font></code> problem, as well as other inconsistencies, is a good example of how browser developers and other TC39 members can and work together to provide a compatible and interoperable web.  But it all starts with your feedback, which we always welcome. <br><br>  - <br>  Allen wirfs-brock <br>  Microsoft JavaScript Language Architect </div><p>Source: <a href="https://habr.com/ru/post/99652/">https://habr.com/ru/post/99652/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../99645/index.html">Autonomous transactions in PostgreSQL</a></li>
<li><a href="../99646/index.html">About carbon dioxide and renewable energy</a></li>
<li><a href="../99649/index.html">Lagoa Multiphysics 1.0 - a new version of the physics engine (video)</a></li>
<li><a href="../99650/index.html">Updating the interface of Google Images</a></li>
<li><a href="../99651/index.html">Kinect prices announced</a></li>
<li><a href="../99653/index.html">Linux basics from the founder of Gentoo. Part 1 (3/4): Links, and deleting files and directories</a></li>
<li><a href="../99654/index.html">Normal file downloads</a></li>
<li><a href="../99660/index.html">In Japan, they test billboards that know your gender and age.</a></li>
<li><a href="../99661/index.html">Microsoft has offered an alternative to complex passwords.</a></li>
<li><a href="../99662/index.html">League of Legends game review or logical continuation of DotA</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>