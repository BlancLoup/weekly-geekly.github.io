<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Indexing and searching with Xapian in .NET</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If the word Xapian is unfamiliar to you, I recommend reading a small article . 
 In short, Xapian is a set of tools written in C ++ for indexing textu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Indexing and searching with Xapian in .NET</h1><div class="post__text post__text-html js-mediator-article">  If the word Xapian is unfamiliar to you, I recommend reading a small <a href="http://www.developers.org.ua/lenta/articles/full-text-search-engines-overview-sphinx-apache-lucene-xapian/">article</a> . <br>  In short, Xapian is a set of tools written in C ++ for indexing textual information, with the ability to search through the database of indexed information.  To work does not require an installed server, it is enough to have its libraries.  It can process huge amounts of information (tested up to 1.5 TB), measured in millions of documents.  It is a competing product of Sphinx and Apache Lucene. <br>  I chose it from these three products for being able to use from .Net. <br><br><a name="habracut"></a><br><br>  First of all, you need to <a href="">download</a> dll 'ki Xapian under .Net. <br>  Then another dll <a href="">helper</a> , <a href="">Zlib1.dll</a> , without it, exceptions will be thrown when trying to access a wrapping dll compiled in C ++. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Actually for work is all that was required.  You can create a project.  XapianCSharp.dll is immediately added to the Reference.  _XapianSharp.dll and zlib1.dll are added to the project (just as content), and we mark the Copy to Output Directory as Copy always. <br><br>  We do two functions to test the work: <br><pre><code class="cs hljs">.... <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Xapian; .... <span class="hljs-comment"><span class="hljs-comment">//   ,       //    string xapianBase="H:\\XapianDB\\xap.db"; .... //    //  private void IndexFolder(string path) { try { if (Directory.Exists(path)) { string[] files=Directory.GetFiles(tbIndexFolder.Text); using (WritableDatabase database=new WritableDatabase(xapianBase, Xapian.Xapian.DB_CREATE_OR_OPEN)) { using (TermGenerator indexer=new TermGenerator()) { using (Stem stemmer=new Xapian.Stem("russian")) { indexer.SetStemmer(stemmer); foreach (string file in files) { using (Document doc=new Document()) { //    ,       doc.SetData(file); indexer.SetDocument(doc); //      indexer.IndexText(File.ReadAllText(file, Encoding.GetEncoding(1251))); //   database.AddDocument(doc); } } } } } } } catch (Exception ex) { Write("Exception: "+ex.ToString()); } } private void Search(string searchText) { try { //     using (Database database=new Database(xapianBase)) { using (Enquire enquire=new Enquire(database)) { using (QueryParser qp=new QueryParser()) { using (Stem stemmer=new Stem("russian")) { Write(stemmer.GetDescription()); qp.SetStemmer(stemmer); qp.SetDatabase(database); qp.SetStemmingStrategy(QueryParser.stem_strategy.STEM_SOME); using (Query query=qp.ParseQuery(searchText)) { Write("Parsed query is: "+query.GetDescription()); enquire.SetQuery(query); //         //     100  MSet matches=enquire.GetMSet(0, 100); Write(String.Format("{0} results found.", matches.GetMatchesEstimated())); Write(String.Format("Matches 1-{0}:", matches.Size())); //  MSetIterator m=matches.Begin(); //   while (m!=matches.End()) { Write(String.Format("{0}: {1}% docid={2} [{3}]\n", m.GetRank()+1, m.GetPercent(), m.GetDocId(), m.GetDocument().GetData())); ++m; } } } } } } } catch (Exception ex) { Write("Exception: "+ex.ToString()); } }</span></span></code> </pre> <br><br>  Write function write to your taste. <br><br>  Now we create a directory with text files, or use an existing one, call IndexFolder (directory_name), wait for the files to be indexed.  And we can call Search by passing a string with search keywords separated by a space. <br><br><h5>  Testing. </h5><br>  Iron configuration: <br>  Intel Pentium III 996Mhz <br>  Ram 256Mb <br><br>  Number of indexed files: 641489 <br>  The volume of indexed files: 2,38Gb <br><br>  File indexing time: more than a week (remember about hardware, at 4x Core the operation will most likely take several hours, the swap also reduces performance by times, respectively). <br>  Load during indexing <br><img src="https://habrastorage.org/storage/a3897aae/135de98f/b038dd7c/702685af.jpg" alt="image"><br><br>  Table of average search time <br><table><tbody><tr><td>  Number of words </td><td>  Search </td><td>  Time </td></tr><tr><td>  one </td><td>  one </td><td>  1883 ms </td></tr><tr><td>  one </td><td>  2 </td><td>  28 ms </td></tr><tr><td>  one </td><td>  3 </td><td>  31 ms </td></tr><tr><td>  2 </td><td>  one </td><td>  175 ms </td></tr><tr><td>  2 </td><td>  2 </td><td>  36 ms </td></tr><tr><td>  2 </td><td>  3 </td><td>  41 ms </td></tr><tr><td>  3 </td><td>  one </td><td>  1074 ms </td></tr><tr><td>  3 </td><td>  2 </td><td>  35 ms </td></tr><tr><td>  3 </td><td>  3 </td><td>  37 ms </td></tr></tbody></table><br><br>  The indicators are very optimistic, especially for such a weak car. <br><br>  Sources: <br>  <a href="http://www.codeproject.com/KB/library/XapianUnderWindows.aspx">Article on codeproject</a> <br>  <a href="http://xapian.org/">Official site</a> </div><p>Source: <a href="https://habr.com/ru/post/113381/">https://habr.com/ru/post/113381/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../113373/index.html">HTC has invested 40 million dollars in the company Onlive</a></li>
<li><a href="../113376/index.html">Goodbye, napkins, or how to get rid of laptop gloss</a></li>
<li><a href="../113378/index.html">Price comparison service for iPhone - Hotline application</a></li>
<li><a href="../113379/index.html">FAQ: SQL Azure</a></li>
<li><a href="../113380/index.html">Kindle and its covers</a></li>
<li><a href="../113382/index.html">Texas Instruments is preparing a system-on-chip OMAP 5 with 3d support</a></li>
<li><a href="../113383/index.html">Hello again</a></li>
<li><a href="../113387/index.html">Good news for those who need HPC, HA and just an SSI cluster, finally</a></li>
<li><a href="../113390/index.html">Plankton Windows</a></li>
<li><a href="../113392/index.html">Writing a rating module for Joomla, or AJAX in Russian</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>