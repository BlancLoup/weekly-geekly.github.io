<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>As we increased the responsiveness of the application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Almost any modern application can not do without downloading images from the network and we, Surfingbird , is no exception. However, you can not just ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>As we increased the responsiveness of the application</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/31d/e9d/d50/31de9dd5018e47f38bc1544d7e1df7dd.jpg"><br><br>  Almost any modern application can not do without downloading images from the network and we, <a href="http://surfingbird.ru/">Surfingbird</a> , is no exception.  However, you can not just upload pictures sequentially, because if the user rewinds a couple of screens, he will have to wait until the previous images are loaded, which are no longer needed. <br>  Therefore, to increase the responsiveness of the application and reduce the waiting time of the user, we have applied several techniques, which we want to tell about now. <br><a name="habracut"></a><br>  It should be noted that many people use lazy loading of pictures.  This is a great practice, we love and respect it.  This saves traffic and memory on the phone.  However, in order to take care of the memory, it is important not only to organize the proper storage of downloaded images, for example, the forcing cache, but also to optimize the loading itself. <br>  Despite the fact that in the modern world, users have long been unlimited Internet and traffic is not a problem, the waiting time for downloading images is still critical.  Users are very impatient, they do not want to wait for the download, they want to sniff-sniff-sniff and we give them this magic. <br><br>  Take the case when an application is a collection of pictures.  What will the developer who does not think about the responsiveness of the application?  He will take all the pictures, put them in the download queue and it turns out that they will be loaded, on average, one after the other. <br>  <a href="">See what it could look like.</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      What do we see?  The user has to wait until the previous pictures are loaded. <br>  In this case, the user does not see that something happens at all.  Now for the user, the application slows down, and all because there is no way to understand whether the picture is loaded or not. <br><br>  It is important that the user has an understanding that everything is fine, everything is loading, a little more and a picture will appear.  The first thing we did was add a progress bar to the loading of the picture.  Implementing this is easy: add a subview to our picture and change the progress of the callback: <br><br><pre><code class="objectivec hljs"><span class="hljs-comment"><span class="hljs-comment">//          //     / progressView      //    ,      -(void)layoutSubviews { CGRect rect = self.progressView.frame; rect.size.width = self.bounds.size.width * self.progress; self.progressView.frame = rect; } -(void)setProgress:(CGFloat)progress { _progress = progress; if (_progress &gt; 1) _progress = 1; if (_progress &lt; 0) _progress = 0; [self setNeedsLayout]; }</span></span></code> </pre> <br>  And we register downloadProgressBlock operations (for operations inherited from AFURLConnectionOperation): <br><br><pre> <code class="objectivec hljs"> [imageView.af_imageRequestOperation setDownloadProgressBlock:^(<span class="hljs-built_in"><span class="hljs-built_in">NSUInteger</span></span> bytesRead, <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> totalBytesRead, <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> totalBytesExpectedToRead) { weakSelf.progress = totalBytesRead/totalBytesExpectedToRead; }];</code> </pre><br>  <a href="">That's what comes out of it.</a> <br><br>  Despite the fact that waiting for the download of the picture is the same as in the first case, in the end, the user has the feeling that everything is fine. <br>  But this is not ideal at all.  As you can see from the example, if the user rewinds quite far away, then the wait for downloading a picture will be very long.  So why not show in the first place what is on the screen right now? <br><br>  To download each image we use NSOperation.  As soon as we receive the next portion of content, we create a download operation for each image and place it in a queue with a medium priority.  As soon as the picture is in sight - we set the operations for its loading to high priority, and it is this picture that loads before those that we do not need now. <br><br>  There is one more subtlety - most likely, that those pictures that the user has scrolled are less necessary for him than those that are below.  Therefore, as soon as the picture disappears from the screen, we set the operations for downloading it to a priority even lower than the priority of operations for preloading. <br><br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) willAppear { [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.af_imageRequestOperation setQueuePriority:<span class="hljs-built_in"><span class="hljs-built_in">NSOperationQueuePriorityVeryHigh</span></span>]; } - (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) willDisappear { [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.af_imageRequestOperation setQueuePriority:<span class="hljs-built_in"><span class="hljs-built_in">NSOperationQueuePriorityVeryLow</span></span>]; }</code> </pre><br><br><img src="//habrastorage.org/files/baa/52b/fd0/baa52bfd018f46078d8984d95012d64f.gif"><br><br>  As a result, we managed to increase the responsiveness of the application and reduce the user‚Äôs waiting time.  Visually, the application has become faster. <br>  If you think that such tricks do not work, we advise you to read this <a href="http://mercury.io/blog/the-psychology-of-waiting-loading-animations-and-facebook">Facebook</a> study. <br><br>  Do you use something like that?  It will be nice to discuss in the comments. </div><p>Source: <a href="https://habr.com/ru/post/246253/">https://habr.com/ru/post/246253/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../246241/index.html">BLE from Nordic Semiconductor. Getting started with a stack using the nRF51822 chip</a></li>
<li><a href="../246245/index.html">Smartphone owners, on average, spend 5‚Öì hours a year waiting for video to load.</a></li>
<li><a href="../246247/index.html">How to build your own framework for iOS</a></li>
<li><a href="../246249/index.html">Security Meetup at the Mail.Ru Group office - how it was</a></li>
<li><a href="../246251/index.html">Key qualities of business intelligence in IT</a></li>
<li><a href="../246257/index.html">How slow are iostreams?</a></li>
<li><a href="../246259/index.html">WebGL or Three.js vs Babylon.js game world</a></li>
<li><a href="../246263/index.html">5 improvements for the site, which can increase sales by 3 times</a></li>
<li><a href="../246265/index.html">C # for AS3 developers. Part 2: Extending Classes and Implementing Interfaces</a></li>
<li><a href="../246269/index.html">Promotional codes for the free Microsoft 70-695, 70-696 exams</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>