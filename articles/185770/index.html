<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>QLiveBittorrent - console bittorrent client for viewing files before downloading</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Exactly one month ago the article LiveDC - Fast access to p2p files was published. Its meaning is that Erty_Hackward wrote a DC-client with the abilit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>QLiveBittorrent - console bittorrent client for viewing files before downloading</h1><div class="post__text post__text-html js-mediator-article">  Exactly one month ago the article <a href="http://habrahabr.ru/post/181906/">LiveDC - Fast access to p2p files</a> was published.  Its meaning is that <a href="http://habrahabr.ru/users/erty_hackward/" class="user_link">Erty_Hackward</a> wrote a DC-client with the ability to view files before their final download.  With it you can, for example, watch movies a couple of minutes after the start of download, rewind them, watch from any moment.  And you can extract the desired file from a large archive without downloading the whole archive. <br><br>  I really liked the idea of ‚Äã‚Äãthis program.  But it is written in C #.  And I would like to use it in Linux.  Therefore, with the permission of the author, I with great pleasure took up the creation of a similar program for Linux.  The result is a console QLiveBittorrent client bittorrent. <br><img src="https://habrastorage.org/storage2/adc/e13/f76/adce13f760b0a4f6c759a0302f77fa51.png"><br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  How does it work </h1>  I'll tell you about the work of QLiveBittorrent on the example of downloading a movie.  Well, for example, my friend posted a video of the prom that had recently been held at our school online, and I want to download it, and once again enjoy this unforgettable spectacle. <br><br>  I'm starting to download a movie.  I specify the folder where it should be mounted.  And then I try to open it.  The film opens 1-2 minutes - depending on the speed.  I start to look - as a rule, there are no lags if there is enough speed.  Next, I rewind the movie to the middle.  I watch the brakes ~ 30 seconds, and continue to watch it from the middle. <br><br>  Something like this happens.  Initially, at the time of opening the movie in the player, the program downloads the first few blocks of the movie and the last block to get information about its duration.  Then she continues to download the movie from the beginning.  But at the time of rewinding the movie to the middle, the program starts to download the block that was requested by the player. <br><br>  In addition to downloading movies, the program can be used to work with archives, iso-images, to view folders with a huge number of pictures.  It is very convenient to start downloading the archive, and from the very beginning, without waiting for it to download, open it, immediately indicate which file you need, and download it. <br><br><h1>  How did it start </h1>  After I realized that it would be easier to write my own, than to try to port LiveDC to Linux, I immediately began to develop. <br><br>  At first I thought to build my own functionality into <a href="http://qbittorrent.sourceforge.net/">my favorite bittorrent client</a> .  But after viewing the source, this desire disappeared.  Millions of files, everywhere defin-s on different systems, all in the form of a sheet, and nothing is clear.  However, under the impression of qbittorrent, I chose the same toolkit. <br><ol><li>  <a href="http://qt.digia.com/">Qt5</a> </li><li>  <a href="http://www.rasterbar.com/products/libtorrent/">libtorrent-rasterbar</a> </li><li>  <a href="http://fuse.sourceforge.net/">FUSE</a> </li></ol><br>  The <b>qlive</b> file system driver was written the day <b>before</b> . <br>  Another day - graphics and torrent downloads. <br>  It looked like this: <br><img src="https://habrastorage.org/storage2/1bb/398/397/1bb398397435ae9d392dd4624e289d78.png"><br><br>  On this development fell into a stupor.  The program worked, pumped the necessary pieces, but regularly received SIGSEGV (error ‚Äúthe program did not address itself‚Äù).  At the same time, I was sadly looking at the <b>qbittorrent</b> and <b>utorrent functional</b> , and it slowly came to me that I wouldn't have enough enthusiasm for months of development ... <br><br><h1>  Second wind </h1>  The second breath opened when I decided to score on the GUI.  Who needs it?  There are too many nerves to support him!  This is how the console bittorrent client appeared.  And then there was an interesting idea to separate the seated torrents from the swinging ones. <br><br>  As a result, the program turned out to be divided into a swinging part, which can mount under-downloaded files, limit download speed and be an ordinary torrent client and a seed manager (seed-manager), which can distribute what has been downloaded, as well as limit the upload speed. <br><img src="https://habrastorage.org/storage2/10e/0e2/3a7/10e0e23a796fef4020aa2a5603fc3cf2.png"><br><br><h1>  Interesting moments of development </h1><ol><li>  Sometimes, testing the download of torrents, I was surprised to find that the download speed exceeds the maximum speed of my router - 802.11G ~ 2MB / s.  It reached 40-50 MB / s, which was basically impossible!  I tried to blame everything on cash.  However, it turned out that I had 2 clients running on my computer, which shared information with each other at the speed of reading the hard disk.  One reads, the other writes.  Subsequently, I used this for testing. <br><br></li><li>  Due to the fact that the client is a console, I had to deal with the completion signals.  I added SIGTERM signal processing (signal for requesting completion of the process).  During the debug, when I sent SIGTERM with my hands, it was successfully intercepted and processed.  However, in practice, when I pressed ctrl-c in the terminal, the signal was not processed.  It turned out that the terminal does not send SIGTERM, but SIGINT (a signal to stop the process by the user from the terminal).  It struck me.  It turns out that when you press ctrl-c, the signal is not ‚Äústop the process‚Äù, but ‚Äúthe user wants the process to stop‚Äù.  Probably, one can come up with a deep sense of the difference between these processes, but it was rather unexpected and strange. <br><br></li><li>  Despite the fact that the client is a console, I would like some kind of GUI to remain.  But after all, if the application is a console, then you want it to run in a bare console (TTY), but this is not possible with a GUI ... Or is it possible?  To do this, you need to understand how graphics work in Linux. <br><br>  And it works like this: there is an X-server, there are clients.  At some point, the client connects.  The question is when does this happen?  Experimentally (by gazing), I found out that the connection occurs at the time of creating <b>QApplication</b> .  Accordingly, if graphics are needed, then I create <b>QApplication</b> , if not - <b>QCoreApplication</b> .  Thus, the program can be launched both in the bare console and with a graphical mini-interface. <br><br></li><li>  Mixing Qt and libtorrent is pure hell.  In the end, my nerves broke down, and I started trying to translate everything into Qt.  Unfortunately, libtorrent uses std, so all my code is hung with QString :: fromStdString (string) and QString.toStdString (), as well as vector char conversions, QVector char, QByteArray, etc. <br><br></li><li>  During development, I encountered an unpleasant problem.  At one point, slow peers are connected to the program and slowly begin to give the right pieces.  At the same time, the average download speed is good, but the delays are unacceptable because of them.  I tried to fight it.  To some extent, the problem was solved due to the fact that the program searches for fast peers for the first 2 minutes and then limits their maximum number to five feasts.  This allows most slow peers to be removed. <br><br></li><li>  So that after midnight there are no problems with time subtraction, the program implements the midnight () function, which checks every second whether it is not midnight now?  Within 5 seconds after midnight, the program sausages - when updating the information on the screen, it clears all temporary counters, ignoring user requests.  Such is a rare crutch.  I wrote it 3 minutes before midnight. <br></li></ol><br><h1>  Feature list </h1><ol><li>  If the torrent has just been published, then the ratio of the number of siders to leechers is too small.  This entails almost complete inability to download such a torrent in a reasonable time.  Therefore, the ability to "transform" into a regular torrent client has been added to QLiveBittorrent.  To do this, press the 'a' key (English). <br><br></li><li>  When reading the mounted files, the programs fall into a stupor until the necessary pieces are downloaded.  But they always come out of it when it happens.  This is a feature of the program. <br><br></li><li>  Authoritative sources claim that on a 600KB / s channel a movie weighing 1.45G with an external audio track and subtitles is played without lags. <br><br></li><li>  If you press ctrl-c on the keyboard (or send SIGTERM), the program will start to finish - reset the data to the hard disk and send the information to the trackers.  After resetting the data, you can press ctrl-c - then the information will not be sent to the trackers.  This is done because I am very frustrated with programs that cannot be completed. <br><br></li></ol><h1>  Sources </h1><ol><li>  <a href="http://habrahabr.ru/users/erty_hackward/" class="user_link">Erty_Hackward</a> - original idea </li><li>  <a href="http://habrahabr.ru/users/ximaera/" class="user_link">ximaera</a> - talked about how to parse parameters from the command line. </li><li>  <a href="http://habrahabr.ru/post/174347/">article about boost :: program_options</a> </li><li>  <a href="http://www.rasterbar.com/products/libtorrent/manual.html">Libtorrent api</a> is a good library, but the emotions from one-page documentation are non-transferable. </li><li>  <a href="https://github.com/qbittorrent/qBittorrent">github.com/qbittorrent/qBittorrent</a> - read the source, but did not understand. </li></ol><br><h1>  Download </h1>  <a href="https://github.com/vtyulb/QLiveBittorrent">Sources</a> <br>  <a href="https://aur.archlinux.org/packages/qlivebittorrent-git/">ArchLinux (AUR)</a> <br>  <a href="https://sourceforge.net/projects/qlivebittorrent/files/QLiveBittorrent.tar.gz/download">linux-x86-64</a> <br><br>  Work requires libraries <b>boost, Qt, libtorrent-rasterbar</b> . <br>  Settings are stored at <b>~ / .qlivebittorrent</b> <br><br>  <b>UPD 00:30</b> <br>  I forgot to describe two more features: <br><ol><li>  After downloading the torrent, it is automatically added to the list of seeding.  If the seed-manager is already running, it will be added to the list within 10 minutes. </li><li>  If the torrent has been deleted, it will be removed from the list of seeding at the first request. </li></ol><br><br>  <b>UPD 18:00</b> <br>  <a href="https://github.com/DAP-DarkneSS">DAP-DarkneSS</a> posted a version for openSUSE.  Thank. <br>  <a href="http://software.opensuse.org/download.html%3Fproject%3Dhome%253ADarkSS%26package%3Dqlivebittorrent">OpenSUSE version</a> <br><br>  <b>UPD 23:15</b> <br>  In the laid out version, the GUI did not work.  What is the error I did not understand, but the required crutch was found. <br>  Files are reloaded. <br><br>  <b>UPD + month</b> <br>  <a href="https://github.com/DAP-DarkneSS">DAP-DarkneSS has</a> posted versions for Debian, Ubuntu and Fedora.  Thank. <br>  <a href="http://software.opensuse.org/download.html%3Fproject%3Dhome%253ADarkSS%253Adeb%26package%3Dqlivebittorrent">Debian and Ubuntu</a> <br>  <a href="http://software.opensuse.org/download.html%3Fproject%3Dhome:DarkSS:fedora%26package%3Dqlivebittorrent">Fedora</a> </div><p>Source: <a href="https://habr.com/ru/post/185770/">https://habr.com/ru/post/185770/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../185756/index.html">4K video of Saturn and its satellites</a></li>
<li><a href="../185760/index.html">Infinite non-repeating textures using Van's mosaic</a></li>
<li><a href="../185764/index.html">Device file UEFI BIOS, part and a half: UEFI Platform Initialization</a></li>
<li><a href="../185766/index.html">Vkontakte iOS SDK v2</a></li>
<li><a href="../185768/index.html">Oracle 12c Data Redaction. Hiding information from unprivileged users</a></li>
<li><a href="../185772/index.html">Technology companies recognize sarcasm</a></li>
<li><a href="../185774/index.html">UEFI BIOS File Device Part Two: UEFI Firmware Volume and its contents</a></li>
<li><a href="../185778/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ64 (June 30 - July 6, 2013)</a></li>
<li><a href="../185782/index.html">VDS in the Netherlands Intel Xeon X3440 / 2-3 GB RAM / 220 GB HDD RAID1 / 25Mbps Unmetered - $ 29 / month</a></li>
<li><a href="../185784/index.html">Yandex employees warn about the incorrect operation of the odnaknopka.ru service</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>