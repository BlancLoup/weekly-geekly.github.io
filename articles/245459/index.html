<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Analog video input for Virturilki and its use in the national economy</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="KDPV 


 Prehistory 
 Nowadays, the widespread domination of very compact, economical and multi-megapixel digital video sensors old good analog CCD vi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Analog video input for Virturilki and its use in the national economy</h1><div class="post__text post__text-html js-mediator-article">  KDPV <br><img src="https://habrastorage.org/files/75f/297/3eb/75f2973eb0d14bb4b7b07cd8b6fce5c7.jpg"><br><br><h4>  Prehistory </h4><br>  Nowadays, the widespread domination of very compact, economical and multi-megapixel digital video sensors old good analog CCD video cameras are slowly slipping into oblivion, remaining in demand only where the presence of the advantages of CCD matrices over CMOS is required.  This is the automotive industry (rear-view cameras), and video surveillance, and various professional equipment (such as thermal imagers).  In general, where high sensitivity is required in low light conditions and a decent dynamic range.  But even in these areas, cameras with CMOS sensors are slowly squeezing "tsetsedeshki." <br><br>  But there remains a large number of old analog cameras and I want to somehow use them in a new way.  And if you remember that analog (composite, with ‚ÄúRCA‚Äù connectors, also known as ‚Äútulip‚Äù), many interesting devices have a way out, I really wanted to capture a video stream from them for subsequent transmission via digital communication channels.  Of course, for these purposes you can use a USB TV tuner or more or less specialized USB devices with composite input, but this option is rather cumbersome, and not all ARM controllers can take advantage of hardware video encoding for USB sources. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><h4>  Our piece of iron </h4><br>  In general, to solve some problems, it was necessary to connect a device to our Virturilka that outputs an analog video signal.  We (or rather, our apparatchik Sasha) searched it on the Internet and found a suitable chip - <a href="http://www.ti.com/product/TVP5150AM1/technicaldocuments">Texas Instruments TVP5150AM1</a> .  It has two inputs for composite video, but they can work alternately, not simultaneously.  The chip generates 720x576 @ 50fps on a parallel bus, through which we usually connect our digital camera sensor to Virturile. <br><br>  The analog video stream after capture is interlaced, as opposed to the usual progressive one, so that the video stream formed by the chip is required to be subjected to the deinterlacing procedure.  It is engaged in DSP Virtuurki.  Moreover, there are several deinterlacing options that are set at the kernel driver level.  So far, we have tested only one option, he is satisfied with everything, so they didn‚Äôt pick any further.  Also, until we tried the NTSC mode, at which the video resolution is 640x480 pixels.  The chip supports this mode without problems, but the switch is not yet implemented in the driver, now it works only in PAL. <br><br>  In general, driver tinkering was the biggest problem when designing an analog input card.  Initially, PAL video worked only 640x480, the edges were cut off from the original frame.  The problem was solved by one of the early board testers, who found a bug and stuck fixing the problem patch.  It turned out that in the video subsystem the resolution was 640x480.  :-) <br><br>  In general, meet - a board for capturing an analog video signal: <br><br>  <a href="http://wiki.virt2real.ru/wiki/%25D0%2590%25D0%25BD%25D0%25B0%25D0%25BB%25D0%25BE%25D0%25B3%25D0%25BE%25D0%25B2%25D1%258B%25D0%25B9_%25D0%25BC%25D0%25BE%25D0%25B4%25D1%2583%25D0%25BB%25D1%258C_TVP5150">http://wiki.virt2real.ru/wiki/Analog_modul_TVP5050</a> <br><br>  Size 37x29 mm (excluding protruding connectors). <br><br><div class="spoiler">  <b class="spoiler_title">Compared to camera module</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/454/9e3/596/4549e3596fc24057bed8fb993fcadc58.jpg"></div></div><br><br><h4>  What does it eat </h4><br>  Connecting the board is similar to connecting the camera module - just plug in the cable and snap the latch.  :-) In a worn state, it looks like this: <br><br><img src="https://habrastorage.org/files/308/d02/1b2/308d021b25f745b6bf03927dfe01ed28.jpg"><br><br>  To work with this module, you need to use a special kernel, the sources of which are located on Github <a href="https://github.com/virt2real/linux-davinci/tree/TVP5150">in the TVP5150 brunch</a> . <br><br>  Of course, very few people will be assembling the core itself, so for the majority, ready fresh firmware for Virturilka is suitable, where there are already cores for our usual digital camera and there is a kernel for analog module.  True, there is also a core for HDMI input, but these boards are worth their weight in gold, so we don‚Äôt let the store go.  :-) <br><br>  Link to the firmware <a href="">http://files.virt2real.ru/firmware/virt2real-board/1.1/virt2real-1.02.002.zip</a> <br><br>  By default, the HD core for the digital camera is active in the firmware, so for use with an analog module you need to switch the core.  This is done by simply copying the uImage.tvp5150 file to the uImage file in the boot section, but it is much more convenient to do this in the admin panel.  Section "Settings -&gt; Kernels".  Select ‚ÄúuImage.tvp5150‚Äù, click the ‚ÄúSave‚Äù button, rebuild the piece of iron and get the active core for TVP5150. <br><br><img src="https://habrastorage.org/files/850/26e/4fd/85026e4fdb744ebe8b333d52fe4ebe16.png"><br><br>  By the way, there, in the admin panel, you can immediately check the video broadcast from the analog input.  To do this, in the "Video" section there are many options for transmitting video (you can broadcast to RTP, RTSP, RTMP and Ivideon). <br><br>  As I said, the video input is double, i.e.  You can connect two independent sources of composite video and switch them as needed.  Switching is to change the state of one register of the i2c device and comes down to commands <br><br>  Select first entry: <br><pre><code class="bash hljs">i2cset -f -y 1 0x5d 0x00 0x00</code> </pre> <br><br>  Select the second entrance: <br><pre> <code class="bash hljs">i2cset -f -y 1 0x5d 0x00 0x02</code> </pre> <br><br>  The same can be done with the mouse in the admin panel, in the section ‚ÄúCameras -&gt; TVP5150‚Äù there are two buttons, ‚ÄúInput 1‚Äù and ‚ÄúInput 2‚Äù, when clicked, the above commands are executed. <br><br>  Since most of the devices with analog output have a linear audio output (usually a white tulip next to the yellow one, or white + red for stereo), you can also get a sound on the Virtirlka.  It has a microphone input, which, in combination, is also a linear audio input. <br><br>  When using gstreamer for broadcasting, you must specify the correct video format parameters, since  there is one small nuance - the pitch parameter must be specified, without it the picture will be distorted. <br><br>  Here is an example of transferring video from an analog RTP input: <br><br><pre> <code class="bash hljs">gst-launch v4l2src always-copy=<span class="hljs-literal"><span class="hljs-literal">false</span></span> chain-ipipe=<span class="hljs-literal"><span class="hljs-literal">true</span></span> ! \ capsfilter caps=video/x-raw-yuv,format=<span class="hljs-string"><span class="hljs-string">'(fourcc)'</span></span>NV12,width=720,height=576,framerate=<span class="hljs-string"><span class="hljs-string">'(fraction)'</span></span>25,pitch=736 ! \ dmaiaccel ! dmaienc_h264 copyOutput=<span class="hljs-literal"><span class="hljs-literal">false</span></span> ddrbuf=<span class="hljs-literal"><span class="hljs-literal">false</span></span> encodingpreset=2 ratecontrol=2 intraframeinterval=30 idrinterval=120 t8x8intra=<span class="hljs-literal"><span class="hljs-literal">true</span></span> t8x8inter=<span class="hljs-literal"><span class="hljs-literal">true</span></span> targetbitrate=<span class="hljs-variable"><span class="hljs-variable">$BITRATE</span></span> bytestream=<span class="hljs-literal"><span class="hljs-literal">true</span></span> headers=<span class="hljs-literal"><span class="hljs-literal">false</span></span> ! \ rtph264pay mtu=1500 ! \ multiudpsink clients=<span class="hljs-string"><span class="hljs-string">"192.168.1.10:3000"</span></span> sync=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-last-buffer=<span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br><br>  For all video translation scripts used in the firmware, all the main video parameters are saved in the settings file when changing the current core.  This was done in order not to correct the chains every time.  Trifle, but very convenient. <br><br><h4>  Where it can be used in business </h4><br>  The most interesting part of my story, IMHO.  Abstractly, nobody needs a piece of hardware; you need to use it for specific purposes. <br><br><h5>  Trolley driven </h5><br>  The first thing I did when I got a test copy of an analog module was that I attached it to a six-wheeled cart.  The Canon 60D DSLR camera and a regular analog video camera with a CCD sensor from SONY were installed on the cart.  Sonya acted as a course camera, i.e.  from the picture of it, I remotely controlled the cart.  A DSLR acted as a photographer ‚Äî in the management application <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.virt2real.player">Virt2real Player</a> , when a special button was pressed, the video input was switched, and the second button was responsible for lowering the shutter on the SLR.  Thus, it was possible to ride with a view through a single camera, and before photographing, switch to the SLR, point and focus on the desired object and take a picture.  Unfortunately, the Canon 60D does not know how to simultaneously deliver video to the analog video output (and also to hdmi, already checked) and allow you to control yourself via PTP.  It is a pity, since the control of the SLR by PTP has long been mastered, even in our admin there is a corresponding module, you can change any shooting settings on the fly. <br><br>  In general, this cart was tested at the Open Innovations 2014 exhibition.  A squirrel from the Ice Age was mounted on the cart for greater mimicity and, accordingly, to attract the attention of the female sex.  The mirror was tilted up, and the trolley received the code name "Podboybochnik."  Guess why. <br><br><img src="https://habrastorage.org/files/b6d/61f/6c2/b6d61f6c27dd4d2280b7415a4bb983d8.jpg"><br><br>  The ride looked something like this <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/DGmu_d32KBg%3Ffeature%3Doembed&amp;xid=25657,15700021,15700186,15700190,15700253&amp;usg=ALkJrhgn4B2lFlHnnEz3oHEtqlA0bpLLIA" frameborder="0" allowfullscreen=""></iframe><br><br>  There were few short skirts, so the catch came out sparsely.  Only two frames were excellent, but I will not publish them in order to keep propriety.  I will show only one innocent shot from the "Undercaster": <br><br><img src="https://habrastorage.org/files/d9a/5ec/40a/d9a5ec40afab442f9a289b9438620665.jpg"><br><br><h5>  Video-eye </h5><br>  I‚Äôll not be able to install this application at a permanent place of deployment, so it rolls around for use as debugging.  The essence is simple: there is a video-peephole (CCD, of course) in the door to the landing, just a virtual virtual camera with a digital camera cannot be installed there, you just need a peephole in the form of an ordinary door glass peephole.  From the video eye comes standard cable, two wires and a screen.  12V power is supplied to one core, otherwise there is a video signal from the peephole, the screen, respectively, is a common ground.  Video from the peephole at the same time written on a Virtuurka flash drive, plus displayed on the monitor at the front door of my apartment.  Memo to myself: the record should be made cyclical, but it turns out nekosherno. <br><br>  And, of course, the video is duplicated over the network to any connected device (a normal computer, a device for iOS or a device for Android). <br><br>  Now I have it parsed disassembled, so that the illustration is not very visual.  On the monitor you can see the picture from goprohi: <br><br><img src="https://habrastorage.org/files/9f6/f88/35b/9f6f8835b44144129fe2f2a3e8bf056f.jpg"><br><br><div class="spoiler">  <b class="spoiler_title">And the script for different types of image duplication looks like this for now.</b> <div class="spoiler_text"><pre> <code class="bash hljs">CAPS=video/x-raw-yuv,format=\(fourcc\)NV12,width=720,height=576,pitch=736,framerate=\(fraction\)25/1 ENCODER=<span class="hljs-string"><span class="hljs-string">"dmaienc_h264 encodingpreset=2 ratecontrol=2 targetbitrate=2000000 maxbitrate=2000000 intraframeinterval=25 idrinterval=500 bytestream=false headers=false aud=false level=51 t8x8intra=true t8x8inter=true airrate=30"</span></span> VIDEOOUT=<span class="hljs-string"><span class="hljs-string">"TIDmaiVideoSink videoStd=D1_PAL videoOutput=composite accelFrameCopy=false noCopy=true sync=false max-lateness=300000000 render-delay=300000000"</span></span> REC=<span class="hljs-string"><span class="hljs-string">"matroskamux streamable=true min-index-interval=1000000000 ! filesink location=video.mkv enable-last-buffer=false sync=true"</span></span> <span class="hljs-comment"><span class="hljs-comment">#REC="flvmux ! filesink location=video.flv enable-last-buffer=false sync=false" #REC="mp4mux streamable=false dts-method=1 presentation-time=true ! filesink location=video.mp4 enable-last-buffer=false sync=false" # clear overlay window fbset -yres 0 -fb /dev/fb0 # show type0 () { gst-launch v4l2src always-copy=false chain-ipipe=true ! \ $CAPS !\ dmaiaccel !\ $VIDEOOUT } # show and send type1 () { gst-launch v4l2src always-copy=false chain-ipipe=true ! \ $CAPS !\ dmaiaccel !\ tee name=sendvideo !\ queue max-size-buffers=0 max-size-bytes=0 max-size-time=0 !\ $VIDEOOUT \ sendvideo. !\ $ENCODER !\ queue max-size-buffers=0 max-size-bytes=0 max-size-time=0 !\ rtph264pay !\ multiudpsink clients=192.168.1.10:3000 enable-last-buffer=false sync=false } # show, send and record type2 () { gst-launch v4l2src always-copy=false chain-ipipe=true ! \ $CAPS ! \ dmaiaccel ! \ tee name=sendvideo ! \ queue max-size-buffers=0 max-size-bytes=0 max-size-time=0 !\ $VIDEOOUT \ sendvideo. ! \ queue max-size-buffers=0 max-size-bytes=0 max-size-time=0 !\ $ENCODER ! \ tee name=recvideo ! \ queue max-size-buffers=0 max-size-bytes=0 max-size-time=0 !\ rtph264pay ! \ multiudpsink clients=192.168.1.10:3000 enable-last-buffer=false sync=false \ recvideo. ! \ queue max-size-buffers=0 max-size-bytes=0 max-size-time=0 !\ legacyh264parse config-interval=2 split-packetized=false output-format=2 access-unit=true ! \ $REC } # send and record type3 () { gst-launch v4l2src always-copy=false chain-ipipe=true ! \ $CAPS ! \ dmaiaccel ! \ dmaiperf print-arm-load=true ! \ queue max-size-buffers=0 max-size-bytes=0 max-size-time=0 !\ $ENCODER ! \ tee name=recvideo ! \ queue max-size-buffers=0 max-size-bytes=0 max-size-time=0 !\ rtph264pay ! \ multiudpsink clients=192.168.1.10:3000 enable-last-buffer=false sync=false \ recvideo. ! \ queue max-size-buffers=0 max-size-bytes=0 max-size-time=0 !\ legacyh264parse config-interval=2 split-packetized=false output-format=2 access-unit=true ! \ $REC } # show and record type4 () { gst-launch v4l2src always-copy=false chain-ipipe=true ! \ $CAPS ! \ dmaiaccel ! \ tee name=recvideo ! \ queue max-size-buffers=0 max-size-bytes=0 max-size-time=0 !\ $VIDEOOUT \ recvideo. ! \ queue max-size-buffers=0 max-size-bytes=0 max-size-time=0 !\ $ENCODER ! \ queue max-size-buffers=0 max-size-bytes=0 max-size-time=0 !\ legacyh264parse config-interval=2 split-packetized=false output-format=2 access-unit=true ! \ $REC } type0</span></span></code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Video with video eye tips</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/3KcR3rlgS9c%3Ffeature%3Doembed&amp;xid=25657,15700021,15700186,15700190,15700253&amp;usg=ALkJrhgz90w9POPd76CmDVrS78km2rjKnA" frameborder="0" allowfullscreen=""></iframe></div></div><br><br>  In general, the whole thing remains to be ennobled and yet to set it all up, finally, to a permanent place at the door. <br><br><h4>  Thermal imager </h4><br>  Somehow I was given a real thermal imager for hire, by Flir (the exact model could not be determined).  At first I planned to install it on a trolley as a second camera (instead of a DSLR), but I was fascinated by examining my plastic windows for frost penetration and forgot about the trolley. <br><br>  With a thermal imager, everything is simple - we connect its analog output to our input, turn on the broadcast and go around the apartment, we look where the windows are poorly insulated.  Well, do not forget to take a picture of yourself in the IR range. <br><br><img src="https://habrastorage.org/files/137/f72/a7a/137f72a7a5044e64bea0a3b298e4b03d.png"><br><br><div class="spoiler">  <b class="spoiler_title">Video with windows</b> <div class="spoiler_text"><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/8XGF30SIXvE%3Ffeature%3Doembed&amp;xid=25657,15700021,15700186,15700190,15700253&amp;usg=ALkJrhhJoYMEeZBWVdmnOPxexZs824_3vw" frameborder="0" allowfullscreen=""></iframe></div></div><br><br>  Of course, video can be transmitted from a thermal imager with an ordinary RC video transmitter, but this is a more cumbersome option.  From Virtuurki immediately into the net it is more convenient to stream the stream in order to look on a smartphone or tablet. <br><br><h4>  Live streaming from a DSLR </h4><br><br><img src="https://habrastorage.org/files/e16/f2a/3cb/e16f2a3cb111441590a803156245d17b.jpg"><br><br>  Actually, this is a special case of how the SLR was used on the cart.  Realtime video transmission from the viewfinder.  Video, compressed in H264 with the desired bit rate, for transmission over relatively narrow channels (3G / 4G).  If the model of the photo-unit supports simultaneous video output and control through PTP - then just beauty, also any parameters can be changed (shutter speed, aperture, focus points, etc.).  My Canon 60D does not support this, unfortunately.  Either management or video.  True, with PTP there is an opportunity to receive video from the viewfinder, but it is of low resolution and in the MJPEG format, and this is usually unsuitable for transmission somewhere. <br><br><div class="spoiler">  <b class="spoiler_title">Video from Canon 60D</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/gBvhco63M7U%3Ffeature%3Doembed&amp;xid=25657,15700021,15700186,15700190,15700253&amp;usg=ALkJrhjvqrBTt0aq545xblpMh4DlSnxTDg" frameborder="0" allowfullscreen=""></iframe></div></div><br><br><h4>  Video Surveillance with VideoNet </h4><br>  When I served in the army (communications platoon), I had to mess around with a pretty cool surveillance system called VideoNet.  So, by itself, I tried to make Virtualulka a friend with her.  They made friends easily - it is enough to run an RTSP server on Virtual Virtrka (from the admin panel), and add a ‚ÄúUniversal RTSP‚Äù type camera in Videogame.  Of course, it is not necessary to use an analog input here, but with him personally it is more interesting to me. <br><br><img src="https://habrastorage.org/files/b1e/ecb/992/b1eecb992e104d2caa0ddb9d37ca3146.png"><br><br>  The source of the video is GoPro, connected to our analog video input. <br><br><div class="spoiler">  <b class="spoiler_title">Virtualer, analog video input and VideoNet</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/6Z8k6wDdMy0%3Ffeature%3Doembed&amp;xid=25657,15700021,15700186,15700190,15700253&amp;usg=ALkJrhg093ACyymyMPotuTdLr-O60oCzvA" frameborder="0" allowfullscreen=""></iframe></div></div><br><br><h4>  CCTV via Ivideon </h4><br>  Probably, all Habr readers know about a cool company called <a href="http://habrahabr.ru/company/ivideon/">Ivideon</a> .  They often tinker with cameras based on the DM368 processor (and DM365, I think), so we went to meet us and gave us our client to connect to their cloud.  As a result, a module appeared in the admin panel for linking Virtuylka to the Ivideon service and the ability to broadcast video to it.  The admin module wrote hastily, I confess, it's a mess, but it works. <br><br><img src="https://habrastorage.org/files/d8e/e74/f18/d8ee74f1895c4b36a1641e7908bd1e4c.jpg"><br><br>  The same source appears in the video source: <br><div class="spoiler">  <b class="spoiler_title">Virtuillare, analog video input and Ivideon</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/IScVHllyzIA%3Ffeature%3Doembed&amp;xid=25657,15700021,15700186,15700190,15700253&amp;usg=ALkJrhgQgDHuw5Xr1YyogQcksOAKB2S5fQ" frameborder="0" allowfullscreen=""></iframe></div></div><br><br>  It would be necessary for the guys from Ivideon to ask the API for motion detection and the initial camera binding through the recognition of a QR code through the camera.  :-) <br><br><h4>  Streaming from old school consoles </h4><br>  Many have heard about the service <a href="http://twitch.tv/">Twitch</a> ?  I'm not a gamer at all, so I heard about him recently.  I had a test sample of analog input on my hands, so I thought - why not shake from the old console?  In modern (PS, XBOX), the broadcast on Twitch is already in the standard firmware (sort of), but for older consoles there is no such possibility. <br><br>  True, I don‚Äôt have a real Dendy (NES) or Sega for a long time, but there is a Playstation2, for which I made a CD with an NES emulator for a long time, and sometimes with daughters we chop into Chip-n-dail.  How would you run it on twitter? <br><br>  Garbage question.  We take ... Yes, all the same our Virturika, straight from the tin analog module.  We connect, open the section with RTMP broadcasts in the admin panel, enter the stream address (taken from the channel settings in your account on Twitch), something like this <br>  rtmp: //live-lhr.twitch.tv/app/live_73242159_p0OUfxtnBGoSwgdcaQVXZ7uRJO3hsM We start the broadcast and, voila, we see our game on tweet! <br><br>  Screenshot from my blog <br><img src="https://habrastorage.org/files/ff6/ea2/976/ff6ea2976351446b95022182fc6dee36.png"><br><br>  Video demonstration of the broadcast of the game Chip'n'Dale 2 on the service Twitch.tv: <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/ZF6t9wLoar8%3Ffeature%3Doembed&amp;xid=25657,15700021,15700186,15700190,15700253&amp;usg=ALkJrhhJUBF-mIF45zDQ7Yug4-qfEJZTdQ" frameborder="0" allowfullscreen=""></iframe><br><br><div class="spoiler">  <b class="spoiler_title">Script for broadcast on Twitch without sound</b> <div class="spoiler_text"><pre> <code class="bash hljs">gst-launch v4l2src always-copy=<span class="hljs-literal"><span class="hljs-literal">false</span></span> chain-ipipe=<span class="hljs-literal"><span class="hljs-literal">true</span></span> ! \ capsfilter caps=video/x-raw-yuv,format=<span class="hljs-string"><span class="hljs-string">'(fourcc)'</span></span>NV12,width=720,height=576,framerate=<span class="hljs-string"><span class="hljs-string">'(fraction)'</span></span>25,pitch=736 ! \ dmaiaccel ! \ dmaienc_h264 copyOutput=<span class="hljs-literal"><span class="hljs-literal">false</span></span> ddrbuf=<span class="hljs-literal"><span class="hljs-literal">false</span></span> encodingpreset=2 ratecontrol=2 single-nalu=<span class="hljs-literal"><span class="hljs-literal">true</span></span> targetbitrate=2000000 maxbitrate=4000000 level=51 intraframeinterval=150 idrinterval=250 t8x8intra=<span class="hljs-literal"><span class="hljs-literal">true</span></span> t8x8inter=<span class="hljs-literal"><span class="hljs-literal">true</span></span> bytestream=<span class="hljs-literal"><span class="hljs-literal">false</span></span> headers=<span class="hljs-literal"><span class="hljs-literal">false</span></span> ! \ flvmux name=mux streamable=<span class="hljs-literal"><span class="hljs-literal">true</span></span> ! \ queue ! \ rtmpsink location=<span class="hljs-string"><span class="hljs-string">"rtmp://live-lhr.twitch.tv/app/live_73242159_p0OUfxtnBGoSwgdcaQVXZ7uRJO3hsM"</span></span> sync=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-last-buffer=<span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre><br></div></div><br><br>  And if you connect the audio output to the Virtuurka microphone input, you can do this: <br><br><div class="spoiler">  <b class="spoiler_title">Script for broadcast on twitch with sound</b> <div class="spoiler_text"><pre> <code class="bash hljs">gst-launch v4l2src always-copy=<span class="hljs-literal"><span class="hljs-literal">false</span></span> chain-ipipe=<span class="hljs-literal"><span class="hljs-literal">true</span></span> ! \ capsfilter caps=video/x-raw-yuv,format=<span class="hljs-string"><span class="hljs-string">'(fourcc)'</span></span>NV12,width=<span class="hljs-variable"><span class="hljs-variable">$WIDTH</span></span>,height=<span class="hljs-variable"><span class="hljs-variable">$HEIGHT</span></span>,framerate=<span class="hljs-string"><span class="hljs-string">'(fraction)'</span></span><span class="hljs-variable"><span class="hljs-variable">$FPS</span></span><span class="hljs-variable"><span class="hljs-variable">$PITCH</span></span> ! \ dmaiaccel ! \ dmaienc_h264 copyOutput=<span class="hljs-literal"><span class="hljs-literal">false</span></span> ddrbuf=<span class="hljs-literal"><span class="hljs-literal">false</span></span> encodingpreset=2 ratecontrol=2 single-nalu=<span class="hljs-literal"><span class="hljs-literal">true</span></span> targetbitrate=<span class="hljs-variable"><span class="hljs-variable">$BITRATE</span></span> maxbitrate=4000000 level=51 intraframeinterval=150 idrinterval=250 t8x8intra=<span class="hljs-literal"><span class="hljs-literal">true</span></span> t8x8inter=<span class="hljs-literal"><span class="hljs-literal">true</span></span> bytestream=<span class="hljs-literal"><span class="hljs-literal">false</span></span> headers=<span class="hljs-literal"><span class="hljs-literal">false</span></span> ! \ queue ! \ flvmux streamable=<span class="hljs-literal"><span class="hljs-literal">true</span></span> name=mux \ alsasrc latency-time=200000 buffer-time=4000000 slave-method=3 <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>-timestamp=<span class="hljs-literal"><span class="hljs-literal">false</span></span> provide-clock=<span class="hljs-literal"><span class="hljs-literal">false</span></span> ! \ capsfilter caps=audio/x-raw-int,channels=1,rate=16000,endianness=1234,signed=<span class="hljs-literal"><span class="hljs-literal">true</span></span>,width=16,depth=16 ! \ queue ! \ dmaienc_aac bitrate=48000 maxbitrate=48000 tns=<span class="hljs-literal"><span class="hljs-literal">false</span></span> copyOutput=<span class="hljs-literal"><span class="hljs-literal">false</span></span> outputBufferSize=500000 fullbandwidth=<span class="hljs-literal"><span class="hljs-literal">true</span></span> fixTimestamp=<span class="hljs-literal"><span class="hljs-literal">true</span></span> ! \ mux. \ mux. ! \ queue ! \ rtmpsink location=<span class="hljs-string"><span class="hljs-string">"rtmp://live-lhr.twitch.tv/app/live_73242159_p0OUfxtnBGoSwgdcaQVXZ7uRJO3hsM"</span></span> sync=<span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-last-buffer=<span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre><br></div></div><br><br><h4>  Other uses </h4><br>  Of course, I managed to try out only a small part of what can be created with an analog video output.  Personally, I like it even more than the HDMI input and than ordinary digital cameras, because it is compatible with a bunch of all kinds of equipment. <br><br>  When we first tweeted about the analog input, several response tweets at once were about the fact that we needed to connect a regular car rear view camera to see the picture on the android device.  I don't have a parking camera in my car, so I can't check it.  And I don‚Äôt want to screw the usual one to the bumper :-) <br><br>  One more person was going to screw the video output of the telescope to the virtrilka to stream to internet.  Let's see what he will do in the end. <br><br>  You can throw your use cases (if they are not secret, of course) in the comments.  What I can - I will quickly test and accomplish the results.  Well, or you can check out the interesting options yourself, the analog module is already on sale.  If we see a very interesting application in the comments, we guarantee the author a bonus analog input.  Of course, only if he already has Virturilka, otherwise there is nothing to cling to the module.  Well, and if the application is very, very, very interesting, we will give Virtualulka in full ammunition. <br><br>  We ourselves have sold the devices to end-users for a long time already, so now all our hardware is sold in the online store <a href="http://chipster.ru/catalog/microcomputers/virt2real/">Chipster</a> .  And yes, you know what is happening now with the ruble exchange rate, so prices will have to be raised periodically, excuse me. <br><br><h4>  Offtopic </h4><br><br>  Not exactly about the analog module, but useful for him too.  Just the day before yesterday, as a result of the experiment, it turned out that Virtual Virtka, which is actually based on a DM365 processor, works fine at the frequencies of the older processor, DM368.  I will not copy-paste, I will give a link, if anyone is interested - <a href="http://www.g0l.ru/blog/n4018">http://www.g0l.ru/blog/n4018</a> <br><br>  In short - our DM365 feels great at frequencies of DM368 (CPU 432 Mhz, DDR 340 MHz).  The network works, Wi-Fi works, video from cameras, from an analog input, from an HDMI input - everything works as it should.  But I couldn‚Äôt check out Full HD video, for lack of a suitable source.  How do we reconfigure the HDMI input to 1080p or get a sensor with Full HD - check if it can pull a whole topic. <br><br>  Overclocked in this way, Virtuerilka has been operating continuously for more than 14 hours, the flight is stable.  The increased frequency is very useful for HD RTMP broadcasts, where before the usual frequency of 300 MHz, there was just enough with a modest bitrate. <br><br>  If anyone is interested to try - <a href="http://forum.virt2real.ru/viewtopic.php%3Ff%3D43%26t%3D13296%26p%3D20646">link to firmware</a> <br>  I just warn you right away - while I am in the testing phase, I cannot guarantee anything.  If the overclocked Virtuirlka explodes, swells up, collapses, annihilates - Virt2real is not responsible for this.  So, ‚ÄúYou have been warned!‚Äù, As they say. <br><br><h4>  Applications </h4><br>  To view RTP video streams on mobile devices, we released the first versions of applications: <br><br>  <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.virt2real.viewer">Android</a> <br>  <a href="https://itunes.apple.com/us/app/virt2real-player/id938612930%3Fl%3Dru%26ls%3D1%26mt%3D8">iOS</a> <br><br>  And for viewing on the desktop: <br>  <a href="http://files.virt2real.ru/soft/v2rplayer/">Under windows</a> <br><br><h4>  Where can one buy? </h4><br>  <a href="http://chipster.ru/catalog/microcomputers/virt2real/">Online store Chipster.ru</a> </div><p>Source: <a href="https://habr.com/ru/post/245459/">https://habr.com/ru/post/245459/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../245447/index.html">The simpler the better, or when ELB is not needed</a></li>
<li><a href="../245449/index.html">.NET / Mono in Java? Easy!</a></li>
<li><a href="../245451/index.html">20 million pesos and half a year in Chile: how SmartProgress won a grant at the other end of the world</a></li>
<li><a href="../245453/index.html">Roslyn to automatically translate C # code into 1C code</a></li>
<li><a href="../245455/index.html">Problem, solution and stability check in statics</a></li>
<li><a href="../245461/index.html">When running World of Tanks game replays, arbitrary code can be executed on your computer</a></li>
<li><a href="../245465/index.html">Why students need a CppCat code analyzer</a></li>
<li><a href="../245467/index.html">Protecting a Phalcon + AngularJS web application against CSRF attacks</a></li>
<li><a href="../245469/index.html">Rovio fires employees, tanks are out for Android, women with children shop more often - and other news of the week for a mobile developer</a></li>
<li><a href="../245471/index.html">How the Cowboy web server and the Kato messenger help each other: A little about Erlang and open source</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>