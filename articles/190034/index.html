<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>"Related News" with PHP, phpmorphy and MySQL</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to share the method of determining "similar" records I think it will be useful for blogs or news resources. 
 The purpose of this post is to sh...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>"Related News" with PHP, phpmorphy and MySQL</h1><div class="post__text post__text-html js-mediator-article">  I want to share the method of determining "similar" records  I think it will be useful for blogs or news resources. <br>  The purpose of this post is to show the principle, implementation may not be quite comme il faut, since the author is not a prof.  a programmer, but an amateur. <br><img src="https://habrastorage.org/storage2/ed1/657/68d/ed165768d135de50d6166c7be6cbb943.png"><br><a name="habracut"></a><br><h5>  So, the task </h5><br>  News is stored in MySQL table type: <br><img src="https://habrastorage.org/storage2/36a/1d9/3b2/36a1d93b23bce7c2205e74ad8ed53992.png"><br>  It is necessary for each news in the output on the page to determine the most similar from the same table. <br>  Here we are interested in the content of the fields title, lead, body.  For simplicity, we will assume that we are creating everything from scratch and will not consider the need to process already existing records. <br><br><h5>  Tags field </h5><br>  We add the tags field (in fact, these are pseudo-tags, but they will not be shown anywhere on the site - this field is needed only for comparing texts).  Specify the field type as VARCHAR (512) and add an index of type fulltext (FULLTEXT (tags)). <br><br><h5>  Pseudo-tag generation </h5><br>  Generate pseudo-tags from the title, lead, body fields before writing the news to the database (just before the INSERT statement).  To do this, download the phpmorphy and dictionaries <a href="http://sourceforge.net/projects/phpmorphy/files/phpmorphy/">from here</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To exclude unimportant words (stop words), create an array of $ stopwords, we will use a text file for stop words (for <a href="http://pastebin.com/raw.php%3Fi%3DZ17mfEQQ">example</a> , save as stopwords.txt). <br><br><pre><code class="php hljs">$stopwords=explode(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>, file_get_contents(<span class="hljs-string"><span class="hljs-string">"stopwords.txt"</span></span>));</code> </pre> <br><br>  Next, we connect the phpmorphy and its dictionaries, combine the title, lead and body and run all the words through phpmorphy. <br><div class="spoiler">  <b class="spoiler_title">Pseudo-tag generation</b> <div class="spoiler_text"><pre> <code class="php hljs">$lowercaseLetters = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>); $uppercaseLetters = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>, <span class="hljs-string"><span class="hljs-string">"''"</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cyrUpper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($str)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> $lowercaseLetters; <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> $uppercaseLetters; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str_replace(<span class="hljs-string"><span class="hljs-string">"'"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, preg_replace($lowercaseLetters, $uppercaseLetters, $str)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cyrLower</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($str)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> $lowercaseLetters; <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> $uppercaseLetters; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str_replace(<span class="hljs-string"><span class="hljs-string">"'"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, preg_replace( $uppercaseLetters,$lowercaseLetters, $str)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cleanUP</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($new_string)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//$new_string=nl2br($new_string); $new_string= str_replace("-"," ",$new_string); $new_string= str_replace("\r\n"," ",$new_string); $new_string= str_replace("\r"," ",$new_string); $new_string= str_replace("\n"," ",$new_string); $new_string= str_replace("."," ",$new_string); $new_string = ereg_replace("[^0-9 ]", "",$new_string ); return $new_string; } require_once( 'morphy/src/common.php'); $text=cleanUP($_REQUEST[title]." ".$_REQUEST[lead]." ".$_REQUEST[body]." "); $aText = explode(' ',$text); $aPort = array(); $aMorph = array(); foreach ($aText as $word) $aMorph[] = cyrUpper($word);//  1251    // set some options $opts = array( 'storage' =&gt; PHPMORPHY_STORAGE_FILE, // Extend graminfo for getAllFormsWithGramInfo method call 'with_gramtab' =&gt; false, // Enable prediction by suffix 'predict_by_suffix' =&gt; true, // Enable prediction by prefix 'predict_by_db' =&gt; true ); $dir = 'morphy/dicts'; $lang = 'ru_RU'; // Create descriptor for dictionary located in $dir directory with russian language $dict_bundle = new phpMorphy_FilesBundle($dir, 'rus'); // Create phpMorphy instance try { $morphy = new phpMorphy($dict_bundle, $opts); } catch(phpMorphy_Exception $e) { throw new Exception('Error occured while creating stemmer instance: ' . $e-&gt;getMessage()); } try { if($getroot==22) $pseudo_root = $morphy-&gt;getPseudoRoot($aMorph);//     else $pseudo_root = $morphy-&gt;getBaseForm($aMorph);//   //   $getroot=TRUE } catch(phpMorphy_Exception $e) { throw new Exception('Error occured while text processing: ' . $e-&gt;getMessage()); } foreach ($pseudo_root as $roots){ $slovo=cyrLower($roots[0]); if (strlen( $slovo)&gt;3 &amp;&amp; !in_array($slovo,$stopwords) &amp;&amp; count($roots)==1 ) { $tags.=$slovo." "; } } }</span></span></code> </pre><br></div></div><br>  The resulting list of tags in the $ tags variable is written in acc.  table field.  As a result, for each news in this field there will be a list of words which we will use for comparison. <br><br><h6>  Example </h6><br>  Source text <br><blockquote>  Samsung has begun manufacturing solid-state hard drives using V-NAND three-dimensional memory.  The technology allows you to increase the amount of storage, as well as provides a 2 times higher speed of information transfer and increases the reliability of devices up to 10 times.  At the moment, are creating SSD drives with 480 and 960 GB, only for corporate servers.  As for home computers, there was no specific release date. </blockquote><br>  Generated word list: <br><blockquote>  device increase only technology company solid state create speed reliability server production allow to increase ensure transfer memory volume start drive moment corporate specific computer touch use information hard disk high release three-dimensional </blockquote><br><br><h5>  SQL query </h5><br>  Now the most interesting thing is that this SQL query will be used to define similar records: <br><br><pre> <code class="sql hljs"> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> news <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MATCH</span></span> (tags) AGAINST (<span class="hljs-string"><span class="hljs-string">'[    ]'</span></span> ) &gt; [ ]</code> </pre><br><br>  Here, the meaning of relevance is the ‚Äúsimilarity‚Äù of texts - experiment (start with one) </div><p>Source: <a href="https://habr.com/ru/post/190034/">https://habr.com/ru/post/190034/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../190020/index.html">Distributed brute-force attack on the CMS from the point of view of the hoster</a></li>
<li><a href="../190022/index.html">Automotive technology. IT look</a></li>
<li><a href="../190024/index.html">Elsevier - my contribution to his fall [translation]</a></li>
<li><a href="../190028/index.html">Little Things to Remember When Using RavenDB</a></li>
<li><a href="../190032/index.html">ARMs for the little ones: what time is it?</a></li>
<li><a href="../190040/index.html">Application of GSM gateway Termit Sprut Universal</a></li>
<li><a href="../190042/index.html">The key to happiness or quality is included. The cry of the soul of the programmer</a></li>
<li><a href="../190044/index.html">Google released HTML5 parser on pure C</a></li>
<li><a href="../190046/index.html">Science under lock and key. The second part of</a></li>
<li><a href="../190050/index.html">Arithmetic numeral apparatus. Privilege, issued on April 6, 1862 for 10 years to collegiate adviser Alexander Namansky</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>