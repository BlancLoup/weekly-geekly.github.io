<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>When hackers are faster than antiviruses</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="FinCERT, a structural division of the Central Bank for Information Security, in its latest report called the Cobalt group the main threat to banks, an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>When hackers are faster than antiviruses</h1><div class="post__text post__text-html js-mediator-article">  FinCERT, a structural division of the Central Bank for Information Security, in its latest report called the Cobalt group the main threat to banks, and its attacks the main trend.  Cobalt, indeed, is now one of the most active and aggressive criminal groups.  Over the year, experts calculated, she made at least 50 successful attacks around the world, constantly testing new tools, changing attack vectors and targets.  In addition to contactless attacks on ATMs, Cobalt tries to gain access to interbank transfer systems (SWIFT), payment gateways and card processing.  In this article, we will show why traditional remedies cannot save such groups from hacker attacks.  And what to do to protect your business from financial and reputational losses. <br><a name="habracut"></a><br>  Text: Andrei Zosimov, virus analyst. <br><br>  On November 14, 2017, experts from Embedi published a technical report on the vulnerability CVE-2017-11882, and also demonstrated it in various versions of Microsoft Office products.  This vulnerability allows you to execute arbitrary code, as well as download executable files and run them for execution.  It has existed since 2000 - just then a vulnerable element of Microsoft Equation was created, or rather, ‚ÄúEQNEDT32.EXE‚Äù.  This element allows you to embed math formulas in Office documents using OLE technology.  With the release of Office 2007, this component has been updated, but support for the old version has remained for compatibility with old documents.  So vulnerability has existed for 17 years. <br><br>  CVE itself was registered on July 31, 2017, and a few days later, experts from Embedi reported it to Microsoft.  The final patch from Microsoft was released only on November 14, 2017. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Three days ago, on November 21, the Proof of Concept vulnerability was published in Embedi's public GitHub repository (https://github.com/embedi/CVE-2017-11882), as well as a python script that allows you to create your own vulnerable. " rtf "document. <br><br><h2>  First activity </h2><br>  A few hours later, the Cobalt hacker group began a massive mailing of phishing emails to financial institutions that contained an attachment of a vulnerable document that was not detected by antivirus solutions: <br><br><img src="https://habrastorage.org/webt/0k/3l/b0/0k3lb0ze79fh-3us-yf5mc8hld8.png" alt="image"><br><br>  A malicious document titled ‚ÄúChanges to the rules for making transfers. Rt‚Äù (MD5 F360D41A0B42B129F7F0C29F98381416, 31811 bytes) was distributed in the newsletter <br><br><img src="https://habrastorage.org/webt/ka/_b/vq/ka_bvqjackzzbn-gqr4txn1q1ec.png" alt="image"><br><br>  The domain ‚Äúcards-cbr.ru‚Äù from which this letter was sent was registered on the day of mailing - 2017-11-21.  It has the IP address "104.254.99.77". <br><br>  The following letter with empty content was also distributed. <br><br>  Technical letter headers: <br><br><img src="https://habrastorage.org/webt/2h/-n/tp/2h-ntpea42puph1flb2l_i1oah0.png" alt="image"><br><br>  As we see, the anti-virus solution missed the malicious letter.  As a result, the malicious attachment fell to a bank employee. <br>  Our TDS Polygon system successfully detected the attack, issuing a 92% verdict, and the CERT Group-IB employee notified the client about the situation: <br><br><img src="https://habrastorage.org/webt/za/-v/8b/za-v8bipcupqh6jpvrlpamvohbq.png" alt="image"><br><br>  The detected malicious document (MD5 F360D41A0B42B129F7F0C29F98381416) was downloaded to Virustotal 2017-11-21 13:27:59 (UTC) and at that time was detected only by the Rising antivirus as "Exploit.CVE-2017-11882.Gen! 1.AED3 ( CLASSIC) ".  It contained the following command, which it executed: <br><br><img src="https://habrastorage.org/webt/3y/lb/gq/3ylbgqvoogjbjvplmzhoqhn_dle.png" alt="image"><br><br>  Judging by the file structure, it was obviously built using a published Python script.  A few hours later, other anti-virus solutions began to detect the file as malicious, but the attackers immediately responded.  They immediately reworked the exploit so that it again stopped being detected by many popular antiviruses (MD5 8993F927BEAF8DAA02BB792C86C2B5E0): <br><br><img src="https://habrastorage.org/webt/rr/xi/_1/rrxi_1frvhbikccvosb1xzdmnfs.png" alt="image"><br><br><img src="https://habrastorage.org/webt/t1/_u/2t/t1_u2ttoibesxzh4s8o6mo3m_yu.png" alt="image"><br><br>  The domain name swift-alliance.com was created and registered by other persons 2016-08-24, but 2017-08-24 the registration term has expired, the Cobalt group criminals tracked this fact and registered this domain name on 21.11.2017.  Now the domain name "swift-alliance.com" has a connection to the IP-address with the domain "cards-cbr.ru", participating in the previous mailing list.  At the moment (11/22/2017) all of these domains have an IP address 139.59.89.20, and earlier on 21.11.2017 they had an IP address 104.254.99.67: <br><br><img src="https://habrastorage.org/webt/j2/jn/o4/j2jno4z2je1lkdg1kyp2tn6paxg.png" alt="image"><br><br>  In both the same group acted - the load was loaded from the IP address "138.68.234.128", which distributes Cobalt-Strike.  In the second case, the HTA executable file was loaded, which was executed through the mshta.exe program: <br><br><img src="https://habrastorage.org/webt/jg/x0/0r/jgx00r9kbtzuvw8slzpdthmy0r8.png" alt="image"><br><br>  The downloaded file contains obfuscated JS, which as a result executes the encoded Powershell script: <br><br><img src="https://habrastorage.org/webt/d2/rf/8d/d2rf8d89c9bg5y8egwrm9m4ytyk.png" alt="image"><br><br>  As a result of this code execution, the PS script is downloaded from the remote hosting ‚Äúhttp://104.254.99.77/out.ps1‚Äù, which is then executed.  Loaded Powershell contains two coded Cobalt Beacons, which are launched according to the OS width. <br><br><h2>  Changes </h2><br>  The revised document is not so different from the original one, but there are still differences.  First, the headers of the RTF document were changed: <br><br><img src="https://habrastorage.org/webt/_c/tk/40/_ctk40wbs8jsfdhd5gkh3po52y8.jpeg" alt="image"><br><br>  As you can see, the keyword ‚Äúobjclass‚Äù was cut from the title of the object, which is optional: <br><br><img src="https://habrastorage.org/webt/bf/kk/7i/bfkk7il9rnxu7w7rbpr0naybj9s.png" alt="image"><br><br>  The object name has been replaced with ‚ÄúEquation.3‚Äù by ‚Äú1NYMiqIGRD‚Äù.  Also, in the original version, the shellcode at the end was filled with the letters ‚ÄúA‚Äù, while in the converted exploit the remaining space is filled with spaces: <br><br><img src="https://habrastorage.org/webt/wb/bf/vl/wbbfvlewb1pw4kqup38-goodpwy.png" alt="image"><br><br>  Signatures (marked in red) are not changed before and after the shellcode.  In fact, the main changes were made to the headers of the RTF document and the embedded object, including at the end: <br><br><img src="https://habrastorage.org/webt/xq/cw/up/xqcwupvmdpt_fdfdoimwfq_mz-e.png" alt="image"><br><br>  Here, the attackers simply changed the parameters of the image and added some of their own, which in fact do not affect anything: <br><br>  "Picwgoal" and "pichgoal" - are responsible for the width and height of the pattern in twips <br><br>  ‚ÄúPicw‚Äù and ‚Äúpich‚Äù - are responsible for the width and height of the image in pixels <br><br>  "Picscale" - image scaling. <br><br><blockquote>  And here is the conclusion: it was enough to change the document slightly and the anti-virus solutions are powerless in front of such an attack. <br></blockquote><br>  What could be the way out of this situation?  Threat Intelligence gives you the opportunity to be aware of attacks conducted by hacker groups, as well as to have at your disposal traffic analysis systems and sandboxes that will render the verdict to malicious files not on the basis of signatures, but using behavioral analysis and the accumulated knowledge base on the characteristic behavior of another hacker group. <br><br>  <a href="https://www.group-ib.ru/blog/antivirus">Read the full version on the Group-IB blog.</a> </div><p>Source: <a href="https://habr.com/ru/post/343064/">https://habr.com/ru/post/343064/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../343050/index.html">Best VPN Solutions for Linux Users</a></li>
<li><a href="../343052/index.html">Intel has removed a vulnerability in the Management Engine subsystem found by Positive Technologies experts</a></li>
<li><a href="../343054/index.html">Explanation of SNARKs. Homomorphic hiding and blind computation of polynomials (translation)</a></li>
<li><a href="../343058/index.html">Release Rust 1.22 (and 1.22.1)</a></li>
<li><a href="../343062/index.html">SQL Server 2017 JSON</a></li>
<li><a href="../343068/index.html">Black Friday in the Infobox</a></li>
<li><a href="../343082/index.html">Data from Google Spreadsheets on your site</a></li>
<li><a href="../343084/index.html">WebGL: transfer game from mobile platform to desktop</a></li>
<li><a href="../343086/index.html">Example of reengineering a real business process or when there is no forest behind the trees</a></li>
<li><a href="../343088/index.html">Black Friday in a new light: non-standard strategies from global brands</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>