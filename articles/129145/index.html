<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The story of one "very Chinese" phone</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The path from “unholy from networks” and “pair Bluetooth” to a human phone 
 We all do stupid things. We often face situations where what we have in o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">🔎</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">📜</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">⬆️</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">⬇️</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The story of one "very Chinese" phone</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/04b/cd7/f16/04bcd7f166d444e49c603e8012e27282.gif"><br><br><h5>  The path from “unholy from networks” and “pair Bluetooth” to a human phone </h5><br>  We all do stupid things.  We often face situations where what we have in our hands is not at all what we hoped to get.  Sometimes, the desire to save allows us to acquire completely unthinkable things. <br><br><h6>  Miser pays twice... </h6><br>  So it was with me, when about two years ago I saw a smartphone with gps, usb-host, two cameras and other buns for ridiculous money on the next Chinese website.  At that moment, the very phrase “Chinese phone” should have stopped me, but I already entered the password from PayPal and soon this “charm” fell into my hands ... <br><a name="habracut"></a><br>  I felt that I had deceived the system, because I have in my hands “a phone with all the bells and whistles”, albeit a little Chinese, but for a penny. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The plastic had the smell of a “burnt monkey” and the overall build quality left something to be desired, but the main “bonuses” were hidden in another.  A card was inserted into the phone, and finally the phone was turned on. <br><br>  Could not please such menu items as “Bluetooth”, “Const.  T.f ”,“ Nepr.k.  With. ”And other abbreviations, the true values ​​of which could be found only by pictures.  In addition, already in the third-level menu area (and the developers did not disdain and nesting the menu up to the 9th level) the pictures disappeared (not counting the “valuable” menu item numbers in red) and the process understanding disappeared with them (which makes the menu “ incl. UI editsii ”can be guessed for a long time).  Immediately, I note that the phone had the opportunity to choose a language and that the English version is much better than the Russian version, that the entire translation is stored in a txt file that could be edited and get rid of even a part of this deformity.  If desired, one could even redraw some pictures (for example, those on which JPEG artifacts were particularly clearly visible), which were a bunch of files (about 200) in the “\ Windows \” folder.  It was not a specific menu item and not a specific part of the interface.  The thing was in the lasting feeling that I had done a great folly by paying money for <b>IT</b> .  I will cite a few more examples so that my delight at that moment is better understood: <br><br><img src="https://habrastorage.org/files/970/b12/a3d/970b12a3d00a46748268b9f758d3ccfd.gif"><br><br>  In defense of the phone, I can add that even when something didn’t work for him, he did it so ridiculously that it was difficult to be angry with him.  For example, when there was an error connecting to the WiFi network, it gave out “unsuccessfully sodininiyat”.  How can you be angry at an item that is trying very hard to “successfully approach”? <br><br>  When I finished inspecting all the charms of design and translation, the first call was made from the other phone to check the connection ... The telephone rang and the first dial tone rang out, but the engineering miracle from under heaven was treacherously silent.  A second followed the first beep, and a third followed it ... And only then did the Chinese phone realize that they were ringing it and displayed the next eerie window.  It should be noted that for all the time of my attempts to get adequate response time from the Chinese phone (namely, from the Chinese program), this was one of the best indicators.  There were situations when between the first reaction of Chinese products and the message of the second phone “the subscriber does not respond” took only 2-3 seconds. <br><br>  It was already a more serious cause for concern (than appearance), although at that moment I still indulged myself with the hope that it was just a communication problem, that this phone was “not warmed up,” and many more thoughts to justify that stupidity was the very fact of purchase. <br><br>  My salvation could be a “more recent” firmware for the phone, in which developers could already fix many problems.  To my surprise, the well-known search engine immediately issued the site and the manufacturer's forum.  In truth, I did not expect not only that they have their own website, but especially that there will be new firmware!  From there, the latest firmware version was successfully received, but this did not change anything.  It became clear one thing: if this problem is not fixed, it means either it is just me, or it is a hardware problem and you can’t do anything with it, or the curved hands of the developers do not allow them to react normally to a message from the modem.  In the absence of other options, all hope was for the last option, and I decided to try to write my own version of the user interface for a very Chinese phone ... <br><br>  At first, it was necessary to turn off the horror that I admired from the moment the phone was turned on.  For this, the phone was connected to a computer, and Windows CE Remote Process Viewer was launched. <br><br><img src="https://habrastorage.org/files/359/a0e/bd7/359a0ebd741a404ab1fa3cfdc61b9782.gif"><br><br>  The process had the proud name “PhoneUI.exe”, worked in 18 threads and loaded a small army of libraries.  At that moment I was only interested in one thing - what is the reason for such a difference between dialing and notification, and for this you had to try to “communicate” with the modem.  Later it turned out that in the phone the modem was “roaming” and even the native PhoneUI.exe tried to connect to the modem on the principle “can you modem?” In the following order: “GSM1:”, “VCP1:”, “VCP2:”, “VCP3 : ”,“ COM1: ”,“ COM3: ”. <br><br>  In a hurry, he sketched a small program that connected to the modem, sent a command, and waited for a response.  The program was launched on the phone, but the modem did not respond - the program got to the stage of reading the response from the modem.  I will not bore you with the description of how I searched for the same modem in the system, how I searched the registry using Windows CE Remote Registry Editor (which had at least a small efficiency factor, since I removed PhoneUI.exe from the startup).  When I got tired of searching, I took up the disassembler and started picking PhoneUI.exe in order to quickly make sure that the standard bundle of Windows API functions is used: CreateFile / WriteFile / ReadFile / CloseHandle.  The fact that the program contained debug information did not surprise me much and it turned out to be very useful: <br><br><img src="https://habrastorage.org/files/adb/8a2/fa8/adb8a2fa88ef4c3ab22e2d37b6501c49.gif"><br><br>  To make sure that the Chinese did not invent a special way of communicating with the modem, I launched a search for “AT +”.  The first coincidence was “% xAT + CGATT = 1 \ r”.  Data transfer to the modem was done by calling the Windows API WriteFile function, which was predictable, but I was a little surprised that my program did not work. <br><br><img src="https://habrastorage.org/files/dea/957/fa3/dea957fa3be64f26991f28c3ccdcf33c.gif"><br><br>  Later it turned out that it was a program branch that runs only in a “special case” and that this method of sending commands to the modem is too casual for the creative developers of this device.  Again, I miss a few days of “unsuccessful stopping” in different places of the phone and going through all the possible parameters and combinations of settings.  Having reached another frenzy from the fact that PhoneUI.exe successfully communicates with the modem, and my program cannot get an answer to one command, I decided to take up disassembling more seriously and not limit myself to searching for the first AT command I got. <br><br>  At that moment, considering that the phone was worth the money and I already spent a lot of time on it, I realized that it was cheaper to buy a new iPhone, but now it was a matter of principle. <br><br>  Repeated search showed that AT commands are sent in two ways - the first has already been described above, the second through a call to the DeviceIoControl function.  Those.  instead of WriteFile, DeviceIoControl is used to transfer data to the modem.  Breakpoint was put on her call, and the scheme of transfer of commands to the modem soon became clear. <br><br><img src="https://habrastorage.org/files/803/e17/f79/803e17f799754f929ba8a0cfaab6e0fe.gif"><br><br>  It also became known that an additional call to DeviceIoControl after CreateFile is needed to activate the modem.  After several hours of pulling out the necessary values ​​from PhoneUI.exe, the following became clear: <br><ol><li>  The modem is usually located on “GSM1:”.  I use the word “usually”, because if the phone is connected to the computer at the moment of switching on or it just became boring for him, the modem migrates to “VCP1:”, “VCP2:” and further along the chain. </li><li>  After CreateFile, you must call DeviceIoControl with the code 0xf00d226c and without additional parameters. </li><li> To send data to the modem, DeviceIoControl with the code 0xf00d2268 is used, the parameter is a fixed-length string (1032 bytes) from which the first 4 bytes are HANDLE received after calling CreateFile, 1024 bytes are the string containing AT command (s), and the last 4 bytes - the length of the string.  After item (2), you can use WriteFile, but it works once every other time, so I did not use it. </li><li>  For reading, as usual, use ReadFile. </li></ol><br>  To my joy, the modem understood the basic set of AT commands and had its own additional set of commands that were successfully “hooked” from PhoneUI.exe. <br><br>  Then came a whole epic with the control of speakers, vibration and other elements of the phone, writing your own simple graphical interface, where everything was not without adventures, but that was another story of a “very Chinese” phone.  For those who are interested, here are some screenshots of what was done as a result (nothing special, just a shell to view the status and control the phone and turn on / off the main devices): <br><br><img src="https://habrastorage.org/files/618/cc0/eb0/618cc0eb0d504113971b4f2d234a2873.gif"><br><br>  Returning to the thought from the beginning of the article - before making a purchase, it was necessary to think carefully.  The phone did not justify the necessary time (and therefore money) costs, although it is impossible to ignore the experience gained and a lot of positive emotions when we read the translation of the standard interface.  I can say for sure that buying this phone is nonsense, but now, knowing how cheap this circus cost, I can say that I don’t regret the purchase. <br><br>  The phone could even go away as “very Chinese phone”: <br><img src="https://habrastorage.org/files/366/690/150/36669015057148cab5062dc4c727c1e5.gif"><br><br><h6>  Thanks to those who made this miracle. </h6></div><p>Source: <a href="https://habr.com/ru/post/129145/">https://habr.com/ru/post/129145/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../129137/index.html">Startup from Hong Kong has created an interesting device to help lose weight</a></li>
<li><a href="../129138/index.html">Fraudulent Android applications. Poking the enemy</a></li>
<li><a href="../129141/index.html">Luxoft Personnel presents the results of a study of the labor market of IT specialists in Russia and Ukraine (June-September 2011)</a></li>
<li><a href="../129142/index.html">Droider Show # 8. Operation "Successor"</a></li>
<li><a href="../129144/index.html">Olympics 2014: how to help a foreigner to cope with the Russian language</a></li>
<li><a href="../129146/index.html">The hard way novice in the top 5 Russian App Store</a></li>
<li><a href="../129147/index.html">HTML5: old tags new destination</a></li>
<li><a href="../129148/index.html">Workshop on the design of applications for Windows Phone</a></li>
<li><a href="../129149/index.html">The history of the startup Cybergame.TV</a></li>
<li><a href="../129150/index.html">SMPP Protocol Issues</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>