<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The three most significant innovations with the arrival of watchOS2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="So, what is really worth mentioning in the transition to the development of watchOS2 - these are the following three points: 



- WKInterfacePicker 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The three most significant innovations with the arrival of watchOS2</h1><div class="post__text post__text-html js-mediator-article">  So, what is really worth mentioning in the transition to the development of watchOS2 - these are the following three points: <br><br><ul><li>  WKInterfacePicker </li><li>  Complications </li><li>  WCSession </li></ul><br>  In this article I will briefly talk about each of them. <br><a name="habracut"></a><br><h4>  WKInterfacePicker </h4><br>  WKInterfacePicker is an innovation from Apple, which extends the development capabilities at times.  What is it?  If to carry out analogs with development under iOS, then it is UIPickerView for hours, however with more flexible functionality.  Control is implemented using the Digital Crown (side wheel). <br><br>  I will not mention all the features, but I will only note what will be important at the initial stages of development.  So, the WKInterfacePicker has 2 important parameters: Style and Focus Style.  Changing the style (Style), we change the way information is displayed. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I'll start right away with an example.  Contrary to the hipster ideas, I will provide the code written in the good old classics - Objective-C. <br><br>  Add to our InterfaceController outlet for a picker: <br><pre><code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">unsafe_unretained</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">IBOutlet</span></span> <span class="hljs-built_in"><span class="hljs-built_in">WKInterfacePicker</span></span> *picker;</code> </pre> <br>  Set the picker style to List mode. <br><br><img src="https://habrastorage.org/files/7d8/f9d/c3d/7d8f9dc3dca44b2eba9b410ffd04a324.png"><br><br>  And copy-paste code: <br><br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)willActivate { <span class="hljs-comment"><span class="hljs-comment">// This method is called when watch view controller is about to be visible to user [super willActivate]; NSArray* arrayOfTexts = @[ @"", @"", @"", @"", @"", @"", @"", @"", @"", @"", @"", @"", @"", @"", @"", @"", @"", @"", @"", @""]; NSMutableArray* arrayOfItems = [NSMutableArray new]; for (int i = 0; i &lt; arrayOfTexts.count; i++) { WKPickerItem *item = [WKPickerItem new]; [item setTitle: arrayOfTexts[i]]; [arrayOfItems addObject: item]; } [self.picker setItems:arrayOfItems]; }</span></span></code> </pre><br>  In the first case (List) we can display the text in the form we are used to. <br><br><img src="https://habrastorage.org/files/184/13a/02c/18413a02ceff458dbb0750bc002a2f0e.gif"><br><br>  By setting the Stack item, we get a set of pictures with pre-installed animation. <br><br><img src="https://habrastorage.org/files/1e4/272/848/1e427284897b41b79b7c85efa045c1b9.png"><img src="https://habrastorage.org/files/da8/2c2/2c7/da82c22c7cef44f4810e00c479558344.gif"><br><br>  By selecting the Sequence item, we can also control the set image, but without animation, which allows using this method to control properties such as volume, sensitivity, alpha channel depth, etc. <br><br><img src="https://habrastorage.org/files/b67/2e8/0e3/b672e80e388f44e08e1263a082e254a5.png"><img src="https://habrastorage.org/files/edd/948/383/edd94838358a470698d4c2b14996845a.gif"><br><br>  However, it is worth mentioning something important: before you start drawing art, you should create about a hundred storyboards with a resolution of x2 (x3).  This will ensure smooth scrolling and expand the range of variable values. <br><br>  By the way, we can track the current index by creating an action (non-standard way, I personally expected the delegate method or something like the controller interface method for the <code>table didSelectRowAtIndex</code> ). <br><br>  We pull the picker into the header and prescribe the name of the method, like this: <br><br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">IBAction</span></span>)pickerDidSelectValue:(<span class="hljs-built_in"><span class="hljs-built_in">NSInteger</span></span>)value;</code> </pre><br>  Next, we control the resulting value as desired. <br><br>  By changing the Focus Style parameter, we can set or turn off the visibility of piker borders.  However, at the moment there is no possibility to change any focus properties (in the active state of the picker, the focus is green with default roundings). <br><br><img src="https://habrastorage.org/files/e17/504/c70/e17504c70581424d9945453be150ebde.png"><img src="https://habrastorage.org/files/5bf/54a/c6c/5bf54ac6c60f49c88f427228f20e3685.png"><br><br><img src="https://habrastorage.org/files/301/813/7dc/3018137dc5d24049812744e7a1f68aa5.png"><img src="https://habrastorage.org/files/67c/7c9/b37/67c7c9b3769f4d658b78cd6495163e91.png"><br><br><img src="https://habrastorage.org/files/e5b/593/a6b/e5b593a6bf4a4813b1bed678c6072aad.png"><img src="https://habrastorage.org/files/d81/fb0/a18/d81fb0a1858e43bfbac7f4a978360644.png"><br><br>  Overall, the WKinterfacePicker is a powerful tool that opens up tremendous opportunities for the developer. <br><br><h4>  Complications </h4><br>  In essence, Complications are the small elements that we see when opening a Modular watch face.  The literal translation of the word complications is a complication.  Accident?  I do not think.  After all, the shell for this seemingly simple functional is the whole ClockKit framework.  When you first view the content, you can be horrified, although everything is not so sad.  Let us analyze, as briefly as possible, since this topic is a separate article. <br><br>  When creating a new project, we are offered the possibility of connecting ‚Äúcomplications‚Äù.  When the check mark is set for our project, the ComplicationController class is added. <br><br><img src="https://habrastorage.org/files/174/c8b/8a5/174c8b8a549847f29d3fab717080a160.png"><img src="https://habrastorage.org/files/559/631/1cf/5596311cf4054d2aae7a2277b17149af.png"><br><br>  The CLKComplicationDataSource protocol is connected to the header of this class.  In the implementation of the pre-installed 9 methods.  The first 4 actually set the conditions for supporting Complications in Time Travel mode.  We are interested in a different method. <br><br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)getCurrentTimelineEntryForComplication:(<span class="hljs-built_in"><span class="hljs-built_in">CLKComplication</span></span> *)complication withHandler:(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>(^)(<span class="hljs-built_in"><span class="hljs-built_in">CLKComplicationTimelineEntry</span></span> * __<span class="hljs-keyword"><span class="hljs-keyword">nullable</span></span>))handler { }</code> </pre><br>  He is key here.  In it we set the "entry point" of our complication with the specified parameters and date.  It looks like this: first, we create an empty object of the CLKComplicationTimelineEntry class. <br><br><pre> <code class="objectivec hljs"><span class="hljs-built_in"><span class="hljs-built_in">CLKComplicationTimelineEntry</span></span>* entry = <span class="hljs-literal"><span class="hljs-literal">nil</span></span>;</code> </pre><br>  Then we dance on what type of complication we want to use.  For example, take Modular Small and put the picture there. <br><br><pre> <code class="objectivec hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (complication.family == <span class="hljs-built_in"><span class="hljs-built_in">CLKComplicationFamilyModularSmall</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">CLKComplicationTemplateModularSmallSimpleImage</span></span>* image = [[<span class="hljs-built_in"><span class="hljs-built_in">CLKComplicationTemplateModularSmallSimpleImage</span></span> alloc] init]; [image setImageProvider: [<span class="hljs-built_in"><span class="hljs-built_in">CLKImageProvider</span></span> imageProviderWithOnePieceImage:[<span class="hljs-built_in"><span class="hljs-built_in">UIImage</span></span> imageNamed:<span class="hljs-string"><span class="hljs-string">@"cat"</span></span>]]]; <span class="hljs-comment"><span class="hljs-comment">//    png   :) entry = [CLKComplicationTimelineEntry entryWithDate:[NSDate date] complicationTemplate:image]; } handler(entry);</span></span></code> </pre><br>  Then we customize the selected Modular watch face and get a funny cat from our test application.  Profit. <br><br><img src="https://habrastorage.org/files/06a/b55/4a7/06ab554a778d47b490b18cf7656b9172.png"><br><br><img src="https://habrastorage.org/files/c43/63a/04a/c4363a04a7b5497aa5bf2d760cdc9214.png"><br><br><img src="https://habrastorage.org/files/653/7f3/5b0/6537f35b0b784f04a9ccbb7e6c95cb16.png"><br><br>  In similar schemes, you can install pictures and texts of different formats (single, in blocks and columns).  In general, it is very convenient and makes life easier for the user, for whom it is important to quickly find out the latest information from your application. <br><br><h4>  WCSession </h4><br>  A new era of synchronization between the iPhone and Apple Watch has arrived.  If you caught the time of Apple's ‚Äúcrutch‚Äù, called openParentApplication, or used the AppGroup along with the <a href="https://github.com/mutualmobile/MMWormhole">wormhole</a> , then it's time to forget about them.  Now there are 3 ways to transfer information between devices using the "session": <br><br><ul><li>  Application context </li><li>  Transferring Files and Data </li><li>  Sending Messages </li></ul><br>  The first thing to do is connect the WatchConnectivity framework.  It provides the ability to communicate between devices. <br><br><pre> <code class="objectivec hljs"> <span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;WatchConnectivity/WatchConnectivity.h&gt;</span></span></span></span></code> </pre><br>  Pre-connect the WCSessionDelegate protocol in the classes between which we will make the transfer.  Next, we check session support.  If all is well, then turn it on.  In the future, all calls to the session are made via [WCSession defaultSession]. <br><br><pre> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([WCSession isSupported]) { WCSession *session = [WCSession defaultSession]; session.delegate = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>; [session activateSession]; } <span class="hljs-built_in"><span class="hljs-built_in">NSDictionary</span></span> *dict = @{<span class="hljs-string"><span class="hljs-string">@"key"</span></span>: <span class="hljs-string"><span class="hljs-string">@",     "</span></span>}; [[WCSession defaultSession] updateApplicationContext:dict error:<span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; <span class="hljs-comment"><span class="hljs-comment">//       -(void)session:(WCSession *)session didReceiveApplicationContext:(NSDictionary&lt;NSString *,id&gt; *)applicationContext { NSString* stringWeNeed = [applicationContext objectForKey:@"key"]; NSLog(@"%@", stringWeNeed); }</span></span></code> </pre><br>  If you need constant synchronization between the phone and the clock, then this is the best way.  The following option allows you to transfer information using 2 methods (sequentially, starting with the latest changes before the loss of synchronization between devices): <br><br>  transferUserInfo: (send to NSDictionary) <br>  transferFile: metadata: (sending file by URL + NSDictionary with metadata) <br><br>  Similarly: <br><br>  session didReceiveUserInfo: (get NSDictionary) <br>  session didReceiveFile: (we get WCSessionFile with a link to the file and a library with metadata) <br><br>  Well, the last option will look at a specific example.  As already mentioned, we import the WatchConnectivity framework in the standard ViewController and InterfaceController classes.  We connect the WatchConnectivity protocol: <br><br><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewController</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WCSessionDelegate</span></span></span><span class="hljs-class">&gt; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InterfaceController</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WKInterfaceController</span></span></span><span class="hljs-class"> &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WCSessionDelegate</span></span></span><span class="hljs-class">&gt;</span></span></code> </pre><br>  In the implementation of the prescribed: <br><br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)viewDidLoad { [<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> viewDidLoad]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([WCSession isSupported]) { WCSession *session = [WCSession defaultSession]; session.delegate = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>; [session activateSession]; } } - (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)awakeWithContext:(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>)context { [<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> awakeWithContext:context]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([WCSession isSupported]) { WCSession *session = [WCSession defaultSession]; session.delegate = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>; [session activateSession]; } }</code> </pre><br>  We will display information on the clock when clicking a button on the iPhone.  To do this, add a button to the Main.storyboard and drag IBAction: <code>- (IBAction)buttonClicked:(id)sender;</code>  . <br><br>  In the Interface.storyboard we add a label and drag Outlet: <br><br><pre> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">unsafe_unretained</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">IBOutlet</span></span> <span class="hljs-built_in"><span class="hljs-built_in">WKInterfaceLabel</span></span> *infoHere;</code> </pre><br>  By pressing the button, we create a random number and transfer it to the clock using the NSDictionary: <br><br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">IBAction</span></span>)buttonClicked:(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>)sender { <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span>* randomValue = [<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> stringWithFormat:<span class="hljs-string"><span class="hljs-string">@"%u"</span></span>, (arc4random() % <span class="hljs-number"><span class="hljs-number">10000</span></span>) ]; [[WCSession defaultSession] sendMessage:@{<span class="hljs-string"><span class="hljs-string">@"key"</span></span>: randomValue]} replyHandler:^(<span class="hljs-built_in"><span class="hljs-built_in">NSDictionary</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *,<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>&gt; * _Nonnull replyMessage) { } errorHandler:^(<span class="hljs-built_in"><span class="hljs-built_in">NSError</span></span> * _Nonnull error) { }];</code> </pre><br>  On the reverse side we write: <br><br><pre> <code class="objectivec hljs">-(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)session:(WCSession *)session didReceiveMessage:(<span class="hljs-built_in"><span class="hljs-built_in">NSDictionary</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *,<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>&gt; *)message replyHandler:(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> (^)(<span class="hljs-built_in"><span class="hljs-built_in">NSDictionary</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *,<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>&gt; * _Nonnull))replyHandler { <span class="hljs-built_in"><span class="hljs-built_in">dispatch_async</span></span>(dispatch_get_main_queue(), ^{ <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span>* string = [message objectForKey:<span class="hljs-string"><span class="hljs-string">@"key"</span></span>]; [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.label setText:string]; }); }</code> </pre><br>  There is one important point.  We update the UI in the main thread asynchronously, otherwise there will be display problems.  To understand the reasons, I advise you to read articles and documentation about multithreading. <br><br>  To summarize  I have listed a few innovations that I personally consider to be the most significant with the arrival of OS2.  Undoubtedly, it is possible to tell more about each of them, and it is quite voluminous, but each of us needs basic knowledge to master a particular area.  So let this article be the point of reference for programmers who decide to associate themselves with the development of watchOS. </div><p>Source: <a href="https://habr.com/ru/post/269401/">https://habr.com/ru/post/269401/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../269391/index.html">ShishNashKi</a></li>
<li><a href="../269393/index.html">Security Week 43: hard prime numbers, cryptography in HDD, Adobe and Oracle patches</a></li>
<li><a href="../269395/index.html">Golden Site distributed elephants to the best Internet projects.</a></li>
<li><a href="../269397/index.html">Instant download of desktop and mobile sites: part 1</a></li>
<li><a href="../269399/index.html">Application Lifecycle in Windows 8.1 and UWP</a></li>
<li><a href="../269407/index.html">This is not paranoia: sources of threats in the GSM system and protection from them.</a></li>
<li><a href="../269411/index.html">10 apps to learn Python on Android devices</a></li>
<li><a href="../269415/index.html">Unreal vs. Unity: what is the best way to develop mobile games?</a></li>
<li><a href="../269417/index.html">Introduction to RxJava: Why Rx?</a></li>
<li><a href="../269419/index.html">Why Mobile First?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>