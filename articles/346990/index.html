<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Disable DHT blocking in popular torrent clients</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On many so-called ‚Äúprivate‚Äù trackers, torrents are distributed with a flag set that prevents the use of the DHT network . The purpose of this is to pr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Disable DHT blocking in popular torrent clients</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/by/0z/3v/by0z3v_yzxhn4iwdvlvsrehjq84.jpeg"></div><br>  On many so-called ‚Äúprivate‚Äù trackers, torrents are distributed with a flag set that prevents the use of <a href="https://ru.wikibooks.org/wiki/BitTorrent/DHT">the DHT network</a> .  The purpose of this is to prevent the distribution of material to customers who are not registered on this tracker.  However, for the user, this means a decrease in the number of siders, sometimes significant. <br><br>  Below we will look at how to disable this restriction in popular torrent clients.  A general approach will be considered, as well as practical application to the current version of <a href="https://www.utorrent.com/intl/en/downloads/complete/track/stable/os/windows">uTorrent</a> and <a href="https://www.qbittorrent.org/download.php">qBitTorrent</a> . <br><a name="habracut"></a><br><h3>  1. Entry </h3><br>  In the network, in the past, a lot of information was laid out regarding the so-called ‚ÄúDHT patches‚Äù, as well as the patches themselves were laid out.  However, when analyzing these data, they often turn out to be contradictory and even in some cases completely inoperative.  This is due to the constant updating of clients, changing the structure of programs, and in some cases - the wrong approach of the authors of the patches. <br><br>  We will try not just to create a ready-made solution, but to analyze the main steps so that the reader can even in the event of a change in the future remove the restrictions of DHT in new versions of customers. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  2. Preparation. </h3><br>  We will need: <br><br><ol><li>  The current distribution of the torrent client. </li><li>  The archiver capable of unpacking installation files, for example, in the case of uTorrent and qBitTorrent is <a href="http://www.7-zip.org/">7-zip</a> . </li><li>  Unpacker executable client files, in the case of uTorrent - <a href="https://github.com/upx/upx/releases/latest">UPX</a> . </li><li>  <a href="https://www.hex-rays.com/index.shtml">IDA</a> or any other disassembler. </li></ol><br>  First, extract and extract the executable files.  To do this, open the downloaded installers and open them in 7-zip.  We will need: <br><br><ul><li>  in the case of uTorrent, the Carrier.exe file; </li><li>  In the case of qBitTorrent, the files are qbittorrent.exe and qbittorrent.pdb (or their 64-bit counterparts, if the 64-bit client is changed). </li></ul><br>  For uTorrent, you also need to unpack the UPX packaging, this can be done with the command <br> <code>upx.exe -d Carrier.exe</code> <br> <br><h3>  2. Search and change code. </h3><br>  In general, the implementation of DHT blocking in all clients at the Assembler level looks the same, it is a call to the flag check function, and if this function returns a zero value, go to the code area that allows using DHT: <br><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">call</span></span> TestPrivate <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> eax, eax jz NotPrivate</code> </pre> <br>  for this reason, the patch itself will be expressed in a simple change of one byte of code 74 =&gt; EB, which makes the conditional transition jz to unconditional and thus ignore the check for ‚Äúprivacy‚Äù. <br><br>  It remains to find this function. <br><br>  In fact, it is absolutely not difficult, given the specifics of this code and the presence of the keyword "private".  Open the unzipped uTorrent client file in IDA and search for this keyword: <br><br><img src="https://habrastorage.org/webt/di/yk/ti/diyktiijabm3g-3d3mo2jelkzzy.jpeg"><br><br>  It can be seen that with the specified key in uTorrent there are only three sections of the code.  Here's what they look like: <br><br><ol><li><img src="https://habrastorage.org/webt/s-/g4/oy/s-g4oyqrrj3fqlprhlrzb0cntkg.jpeg"></li><li><img src="https://habrastorage.org/webt/rq/bd/lu/rqbdlund1jj7bqpuquem_3f9a24.jpeg"></li><li><img src="https://habrastorage.org/webt/_z/t_/vy/_zt_vy-o-dgc3-pyd2qu7md3gyg.jpeg"></li></ol><br>  It is obvious that the code we need is the third one in the list, since only it represents a function call and a check of return to zero followed by a conditional transition. <br><br>  Our task is to simply replace the function, as we mentioned earlier: <br><img src="https://habrastorage.org/webt/19/mu/kj/19mukjcnfagku-q1jpuntjoek9c.jpeg"><br>  In essence, this is the replacement of the characteristic sequence <br> <code>68 00 FF 69 00 E8 19 F1 FA FF 85 C0 74 07</code> <br>  on <br> <code>68 00 FF 69 00 E8 19 F1 FA FF 85 C0 <b>EB</b> 07</code> <br> <br>  In the case of qBitTorrent, the task is simplified even more, since the developer has put the pdb file into the installer, so the function names will be more obvious, and the search by keyword is simplified: <br><br><img src="https://habrastorage.org/webt/80/et/qi/80etqidwsftap7np5e_txnkhjzy.jpeg"><br><br>  This is how the verification code itself looks like: <br><br><img src="https://habrastorage.org/webt/1b/ls/ps/1blspsgtdjv14l7rdjpxseuqwxo.jpeg"><br><br>  As you can see, in fact, it is indistinguishable from uTorrent.  The patch will be similar: <br><br><img src="https://habrastorage.org/webt/8c/zo/sz/8czoszmx5lnb510faryeslnydyu.jpeg"><br><br>  This is the replacement of the characteristic sequence. <br> <code>E8 20 CB FA FF 84 C0 74 59</code> <br>  on <br> <code>E8 20 CB FA FF 84 C0 <b>EB</b> 59</code> <br> <br>  qBitTorrent is also offered as a 64-bit client.  The actions regarding him will be completely analogous, except for the fact that we will need a 64-bit version of IDA.  The search result for the keyword is expected to be similar: <br><br><img src="https://habrastorage.org/webt/-w/83/ei/-w83ei9wh2jtzw5elupejxucqh8.jpeg"><br><br>  The form of the corresponding function is somewhat different, but the essence remains the same: <br><br><img src="https://habrastorage.org/webt/ic/hs/gc/ichsgcfb1tsczfju55shes7rgtc.jpeg"><br><br>  Well, the corresponding patch, here it will be three bytes: <br><br><img src="https://habrastorage.org/webt/wu/vy/7g/wuvy7g1lfhbm8fa2jrepcdhe4hk.jpeg"><br><br>  This is the replacement of the characteristic sequence. <br> <code>E8 8F 0E F8 FF 4C 8D 3D 54 E5 46 01 83 CB FF 84 C0 0F 84 DB 00 00 00</code> <br>  on <br> <code>E8 8F 0E F8 FF 4C 8D 3D 54 E5 46 01 83 CB FF 84 C0 <b>E9 DC 00</b> 00 00 00</code> <br> <br><h3>  3. Results </h3><br>  We have consistently studied the procedure for finding and disabling the function of restricting the use of DHT for private torrents in popular uTorrent and qBitTorrent clients. <br>  I think that the proposed mechanism will be similar for any other clients - in any case, I checked it on <a href="https://www.comboplayer.ru/">ComboPlayer</a> . <br><br>  To automate the process, I created two patchers for the current versions of uTorrent and qBitTorrent.  For uTorrent, the patcher also unpacks the original installer.  Files can be downloaded here: <br><br>  <a href="http://mir.cr/0XFLRND2">XBitTorrent version x32 patcher</a> <br>  <a href="http://mir.cr/1F6WIQBC">XBitTorrent version x64 patcher</a> <br>  <a href="http://mir.cr/1BFNFS8D">Unpacked File Patcher uTorrent</a> <br>  <a href="http://mir.cr/YBTF8OOV">Silent uTorrent all-in-one patcher</a> : unpacks, patches and back packs the installer, and also unpacks, patches and packs back the already installed uTorrent (provided that the installation folder is by default, that is, "% userprofile% \ AppData \ Roaming \ uTorrent \ " </div><p>Source: <a href="https://habr.com/ru/post/346990/">https://habr.com/ru/post/346990/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346976/index.html">JavaScript - fill a niche between microservices and objects - ‚Äúnano-services‚Äù</a></li>
<li><a href="../346978/index.html">Development for Android and iOS: Open Day in webinar format</a></li>
<li><a href="../346980/index.html">Micro-UART for Microcontroller (ATtiny13A)</a></li>
<li><a href="../346982/index.html">Report from the Moscow CocoaHeads Meetup meeting December 15</a></li>
<li><a href="../346984/index.html">Java conference with English roots. Continuing mega review</a></li>
<li><a href="../346992/index.html">Super-complete guide to publishing in Microsoft Store</a></li>
<li><a href="../346994/index.html">Conference C ++ Russia 2018</a></li>
<li><a href="../346998/index.html">Javascript and horror mutations</a></li>
<li><a href="../347000/index.html">McSema and decompiling into LLVM source code: is it real?</a></li>
<li><a href="../347002/index.html">Studying MBR and GPT structures</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>