<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A couple of goodies for CodeIgniter</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In 2012, I didn‚Äôt even guess about the word combination of OOP, but I clearly understood that writing websites and in the near future web applications...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A couple of goodies for CodeIgniter</h1><div class="post__text post__text-html js-mediator-article">  In 2012, I didn‚Äôt even guess about the word combination of OOP, but I clearly understood that writing websites and in the near future web applications would require already prepared solutions, as the number of tasks increased, and there was not enough time to implement them.  My choice fell on CodeIgniter because his documentation took pity on me, throwing away the words that were difficult for a weaker beginner.  Frankly, I still have not met the same convenient and understandable documentation.  Since then, relatively little time has passed.  But I decided to share not numerous accumulated knowledge with users of Habr. <br><br>  At the moment I am using CodeIgniter v2.2.0. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d94/986/a90/d94986a907960b7f874611483d8af7d8.png" alt="image"><br><a name="habracut"></a><br>  <b>Routing:</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      People who use this framework know exactly how routing in CI works.  However, I often wondered how all the same to redirect all requests to a single controller. <br><br>  Everything just needs to add the following line to the end of the <i>/aplication/config/routes.php</i> file: <br><br><pre><code class="php hljs">$route[<span class="hljs-string"><span class="hljs-string">'(:any)'</span></span>] = $route[<span class="hljs-string"><span class="hljs-string">'default_controller'</span></span>].<span class="hljs-string"><span class="hljs-string">"/$1"</span></span>;</code> </pre> <br>  After which we get: <br><br><pre> <code class="php hljs">$route[<span class="hljs-string"><span class="hljs-string">'default_controller'</span></span>] = <span class="hljs-string"><span class="hljs-string">"main"</span></span>; $route[<span class="hljs-string"><span class="hljs-string">'404_override'</span></span>] = <span class="hljs-string"><span class="hljs-string">''</span></span>; $route[<span class="hljs-string"><span class="hljs-string">'(:any)'</span></span>] = $route[<span class="hljs-string"><span class="hljs-string">'default_controller'</span></span>].<span class="hljs-string"><span class="hljs-string">"/$1"</span></span>;</code> </pre><br>  In this case, all requests, be it <i>http // mysite / user</i> or <i>http // mysite.loc / page</i> , will be completely redirected to <i>http // my_site / <b>main</b> / user</i> and <i>http // mysite.loc / <b>main</b> / page,</i> respectively. <br><br>  Fine!  But what if we need to leave redirects to other controllers, for example: <i>user, page, admin</i> .  In this case, I use the following scheme: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//    . $controllers = array( "user", "admin", "page" ); foreach($controllers as $controller){ $route[$controller] = $controller; $route[$controller.'/(:any)'] = $controller.'/$1'; } $route['default_controller'] = "main"; $route['404_override'] = ''; $route['(:any)'] = $route['default_controller']."/$1";</span></span></code> </pre><br>  Now we have a main controller and additional ones, to which we can just as easily contact.  But what if I have only one controller responsible for the output of <i>CSS, JavaScript and images</i> . <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//    $systems_redirect = array( 'css', 'js', 'image' ); $route['('.implode('|',$systems_redirect).')'] = 'systems/$1'; $route['('.implode('|',$systems_redirect).')/(:any)'] = 'systems/$1/$2'; //    . $controllers = array( "user", "admin", "page" ); foreach($controllers as $controller){ $route[$controller] = $controller; $route[$controller.'/(:any)'] = $controller.'/$1'; } $route['default_controller'] = "main"; $route['404_override'] = ''; $route['(:any)'] = $route['default_controller']."/$1";</span></span></code> </pre><br>  This is my final <i>routes.php</i> file. <br><br>  <b>Error 404 output:</b> <br><br>  Some time ago I wondered.  How to redirect 404 error to the controller in order to display some data there, because as we know, CodeIgniter displays only a small pre-prepared html page without the ability to load some information from the database into it.  Or work with libraries. <br><br>  It would seem that the solution is painfully simple.  In the previously mentioned routes.php file, change the value of the <i>$ route</i> variable <i>['404_override'] = '';</i>  on the name of a previously prepared controller, for example my404.php.  But using this implementation, I suddenly came across one very unpleasant thing. <br><br>  The fact is that if you need to call the <b>show_404 ()</b> function from an external controller, you will receive an old pre-prepared html page <i>/aplication/errors/error_404.php</i> which is unlikely to please you. <br><br>  The best solution to this problem, I decided to extend the standard class <i>CI_Exceptions</i> using the automatically loadable file <b>/aplication/core/MY_Exceptions.php</b> will replace the standard function <i>show_404 ()</i> : <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( ! defined(<span class="hljs-string"><span class="hljs-string">'BASEPATH'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>(<span class="hljs-string"><span class="hljs-string">'No direct script access allowed'</span></span>); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MY_Exceptions</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CI_Exceptions</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">show_404</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $CI =&amp; get_instance(); $CI-&gt;output-&gt;set_status_header(<span class="hljs-string"><span class="hljs-string">'404'</span></span>); $CI-&gt;output-&gt;set_output(<span class="hljs-string"><span class="hljs-string">"error_404"</span></span>); } }</code> </pre><br>  In this case, extending the standard class CI_Exceptions, we get access to the function <b>get_instance ();</b>  which in turn gives us the opportunity to fully use all the classes of the helper model, etc. <br><br>  <b>Getting errors from the CI_Form_validation library:</b> <br><br>  Imagine that we submit a form using <i>ajax</i> and wait for a return in <i>json</i> format.  At the same time checking the data using CI_Form_validation.  And the library seems to be working fine, but returning errors to an array for converting to <i>json is</i> not possible since the only function for returning errors <i>$ this-&gt; form_validation-&gt; error_string ()</i> returns a string with all the errors from which later you will not get errors for each transmitted value.  Of course, there is another function <i>$ this-&gt; form_validation-&gt; error (),</i> but to use it you will need a completely unnecessary cycle.  And here is the solution.  Create the <b>/aplication/libraries/MY_Form_validation.php</b> file with which I will extend the functionality of the library, as well as I can add new functions to check the input data. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( ! defined(<span class="hljs-string"><span class="hljs-string">'BASEPATH'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>(<span class="hljs-string"><span class="hljs-string">'No direct script access allowed'</span></span>); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MY_Form_validation</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CI_Form_validation</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($config = array</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::__construct($config); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error_array</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_error_array) === <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_error_array; } }</code> </pre><br>  Thus, we get the function $ this-&gt; form_validation-&gt; error_array () which will return us an array of errors.  For example: <br><br><pre> <code class="php hljs">$errors = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">"username"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"   "</span></span>, <span class="hljs-string"><span class="hljs-string">"email"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"   "</span></span> );</code> </pre><br>  <b>Thanks for attention!</b>  Hope was useful. </div><p>Source: <a href="https://habr.com/ru/post/268239/">https://habr.com/ru/post/268239/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../268229/index.html">Alternative to .NET MVC and WEB Forms</a></li>
<li><a href="../268231/index.html">Fantasy on WebDAV. ... make a fairy tale come true?</a></li>
<li><a href="../268233/index.html">Building Unity3D builds on Jenkins on Mac OS X. Part 1</a></li>
<li><a href="../268235/index.html">Candy Challenge (improving the result)</a></li>
<li><a href="../268237/index.html">Gartner's Magic Quadrant for Data Center Networking Technologies</a></li>
<li><a href="../268241/index.html">We invite to student hackathons of Imagine Cup</a></li>
<li><a href="../268243/index.html">Kaspersky Industrial CTF: time to protect substations, and time to break substations</a></li>
<li><a href="../268245/index.html">Module example for Magento 2</a></li>
<li><a href="../268247/index.html">Network overlay technologies for data centers. Part 2</a></li>
<li><a href="../268249/index.html">Flux in pictures</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>