<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Solaris Container (zone). Creation and administration. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Solaris Container (zone). Creation and administration. Part 2 

 Introduction 
 The Solaris Zone (Solaris Container) technology is a technology that a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Solaris Container (zone). Creation and administration. Part 1</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://habrahabr.ru/blogs/sysadm/123621/">Solaris Container (zone).</a>  <a href="http://habrahabr.ru/blogs/sysadm/123621/">Creation and administration.</a>  <a href="http://habrahabr.ru/blogs/sysadm/123621/">Part 2</a> <br><br><h4>  Introduction </h4><br>  The Solaris Zone (Solaris Container) technology is a technology that allows the Solaris 10 OS to be divided into software containers (zones), almost independent operating systems that can have separate independent resources (processors, memory, disk space) and their own users. <br><br>  Koneteynery is a good solution for building application servers in which each application will have its own honest guaranteed (or shared between all zones) piece of resources with which it can work.  Such a solution will allow to consolidate the infrastructure on more powerful servers, which will generally reduce the cost and complexity of information systems. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br>  When planning to consolidate servers, there appear quite a lot of heterogeneous solutions in front of us, from which we must choose the one that fully satisfies us.  Usually we choose between these three: <br><ul><li>  Domains - <a href="http://ru.wikipedia.org/wiki/Logical_Domains">Oracle VM Server for SPARC</a> (ex LDom from Sun) or <a href="http://ru.wikipedia.org/wiki/LPAR">IBM LPAR</a> s </li><li>  Virtual Machines - Vmware, Microsoft Hyper-V etc </li><li>  Isolated OS-level partitions - <b>Solaris Zones</b> , FreeBSD Jail, LVS (Linux Virtual Server) </li></ul><br><br>  Features of Solaris Zones: <br><br><ul><li>  Security - an application running in a zone is running in a sandbox, that is, a process, even running as root within a zone, cannot affect other zones or the global zone (control, root zone).  Reboot or shutdown is available only from the global zone. </li><li>  Insulation - zones have the exclusive right to the resources allocated to it;  zones can have my own users and my own root user.  Restarting a zone can in no way affect other zones running on the host. </li><li>  Flexibility ‚Äî zone resources can be assigned rigidly or a zone can use a shared pool of host resources. </li></ul><br><h4>  Create Solaris Zone </h4><br>  For the demonstration, install a zone called habrazone. <br><br>  I have Solaris OS 10 09/10 and it is installed on <a href="http://ru.wikipedia.org/wiki/Zettabyte_File_System">ZFS</a> .  In the next article I will describe the process of creating a separate pool on ZFS, installing zones in this pool, and also allocating guaranteed CPU and RAM for a zone, and in this only setting the zone to a separate directory without assigning it to resources.  The zone will be no frills (forwarding physical network interfaces, raw devices etc), but simply with a virtual network interface at the host level. <br><br>  So, first create a directory in which the zone will be installed, and assign rights to it. <br><br> <code><b># mkdir /export/habrazone <br> # chown root:root /export/habrazone <br> # chmod 700 /export/habrazone</b></code> <br> <br>  It's simple.  Only root can look into this zone and no one else. <br><br>  To create a zone, use the zonecfg command with the ‚Äìz key. <br><br> <code><b># zonecfg -z habrazone</b> <br> habrazone: No such zone configured <br> Use 'create' to begin configuring a new zone. <br> zonecfg:habrazone&gt; <b>create</b> <br> zonecfg:habrazone&gt; <b>set zonepath=/export/habrazone</b> <br> zonecfg:habrazone&gt; <b>set autoboot=true</b> <br> zonecfg:habrazone&gt; <b>add net</b> <br> zonecfg:habrazone:net&gt; <b>set physical=bge0</b> <br> zonecfg:habrazone:net&gt; <b>set address=10.44.3.92</b> <br> zonecfg:habrazone:net&gt; <b>end</b> <br> zonecfg:habrazone&gt; <b>add attr</b> <br> zonecfg:habrazone:attr&gt; <b>set name=comment</b> <br> zonecfg:habrazone:attr&gt; <b>set type=string</b> <br> zonecfg:habrazone:attr&gt; <b>set value="Habrahabr"</b> <br> zonecfg:habrazone:attr&gt; <b>end</b> <br> zonecfg:habrazone&gt; <b>verify</b> <br> zonecfg:habrazone&gt; <b>commit</b> <br> zonecfg:habrazone&gt; <b>exit</b></code> <br> <br>  Now I will comment a little on what happened here: <br><br>  zonecfg: habrazone&gt; <b>create</b> - create a zone.  In fact, there is no zone as such.  This is just her config in XML. <br>  zonecfg: habrazone&gt; <b>set zonepath = / export / habrazone</b> - the zone will be located along the path / export / habrazone <br>  zonecfg: habrazone&gt; <b>set autoboot = true</b> - the zone will start automatically with the host bootup, for example, after a reboot. <br>  zonecfg: habrazone&gt; <b>add net</b> - add the network interface to the zone configuration <br>  zonecfg: habrazone: net&gt; <b>set physical = bge0</b> - the virtual interface will be placed above bge0 <br>  zonecfg: habrazone: net&gt; <b>set address = 10.44.3.92</b> - the address of our zone <br>  zonecfg: habrazone: net&gt; <b>end</b> - end <br>  zonecfg: habrazone&gt; <b>add attr</b> - added ‚Äúname‚Äù for the zone <br>  zonecfg: habrazone: attr&gt; <b>set name = comment</b> <br>  zonecfg: habrazone: attr&gt; <b>set type = string</b> <br>  zonecfg: habrazone: attr&gt; <b>set value = "Habrahabr"</b> is our favorite resource <br>  zonecfg: habrazone: attr&gt; <b>end</b> - and again end <br>  zonecfg: habrazone&gt; <b>verify</b> - check the config.  If there are errors in the config, then in this place we will be informed about it. <br>  zonecfg: habrazone&gt; <b>commit</b> - commit <br>  zonecfg: habrazone&gt; <b>exit</b> - exit <br><br>  Let's see our config entirely.  Pay attention to <b>inherit-pkg-dir</b> .  They point to directories that are "inherited" from the global zone. <br><br> <code><b># zonecfg -z habrazone info</b> <br> zonename: habrazone <br> zonepath: /export/habrazone <br> brand: native <br> autoboot: true <br> bootargs: <br> pool: <br> limitpriv: <br> scheduling-class: <br> ip-type: shared <br> hostid: <br> inherit-pkg-dir: <br> dir: /lib <br> inherit-pkg-dir: <br> dir: /platform <br> inherit-pkg-dir: <br> dir: /sbin <br> inherit-pkg-dir: <br> dir: /usr <br> net: <br> address: 10.44.3.92 <br> physical: bge0 <br> defrouter not specified <br> attr: <br> name: comment <br> type: string <br> value: Habrahabr <br></code> <br><br>  Now we have only 1 zone - global.  The list of zones can be viewed with the zoneadm command with the list ‚Äìiv keys: <br><br> <code># <b>zoneadm list -iv</b> <br> ID NAME STATUS PATH BRAND IP <br> 0 global running / native shared</code> <br> <br>  Now we are all ready for the installation zone.  To install the zone, the already familiar zoneadm command is used, but as parameters it is passed the name of the still non-install zone with the install command: <br><br> <code><b># zoneadm -z habrazone install</b> <br> A ZFS file system has been created for this zone. <br> Preparing to install zone habrazone. <br> Creating list of files to copy from the global zone. <br> Copying 3137 files to the zone. <br> Initializing zone product registry. <br> Determining zone package initialization order. <br> Preparing to initialize 1207 packages on the zone. <br> Initialized 1207 packages on zone. <br> Zone habrazone is initialized. <br> The file /export/habrazone/root/var/sadm/system/logs/install_log contains a log of the zone installation. <br></code> <br>  I would like to note that the OS files are copied from the global zone to the zone, and part of the directories are inherited.  Inherited directories in the zone are in read only. <br><br>  In the list of zones, we have a new zone: <br><br> <code><b># zoneadm list -iv</b> <br> ID NAME STATUS PATH BRAND IP <br> 0 global running / native shared <br> - habrazone installed /export/habrazone native shared</code> <br> <br>  And its size is very small as for almost separate OS. <br><br> <code># <b>du -shk /export/habrazone/</b> <br> 79M /export/habrazone</code> <br> <br>  Start and stop is performed using the zoneadm ‚Äìz &lt;zone name&gt; boot and zoneadm ‚Äìz &lt;zone name&gt; halt, respectively: <br><br> <code><b># zoneadm -z habrazone boot</b> <br></code> <br><br>  After starting the zone, you can check what has changed, for example in the configuration of the network interfaces of the host. <br> <code><b># /sbin/ifconfig -a</b> <br> lo0: flags=2001000849&lt;UP,LOOPBACK,RUNNING,MULTICAST,IPv4,VIRTUAL&gt; mtu 8232 index 1 <br> inet 127.0.0.1 netmask ff000000 <br> lo0:1: flags=2001000849&lt;UP,LOOPBACK,RUNNING,MULTICAST,IPv4,VIRTUAL&gt; mtu 8232 index 1 <br> zone habrazone <br> inet 127.0.0.1 netmask ff000000 <br> bge0: flags=1000843&lt;UP,BROADCAST,RUNNING,MULTICAST,IPv4&gt; mtu 1500 index 2 <br> inet 10.44.3.93 netmask ffffff00 broadcast 10.44.3.255 <br> ether 0:14:4f:79:91:1a <br> bge0:1: flags=1000843&lt;UP,BROADCAST,RUNNING,MULTICAST,IPv4&gt; mtu 1500 index 2 <br> zone habrazone <br> inet 10.44.3.92 netmask ffffff00 broadcast 10.44.3.255</code> <br> <br>  As can be seen from the output of ifconfig, a virtual interface has appeared in the system, to which the zone address is assigned.  A zone can also be given a separate physical interface, for example, if an application is raised in a zone that actively exploits the network, and to enable other zones to function normally. <br><br>  After the zone has booted, you need to enter the console and enter the minimum configuration (hostname, time zone, name service, root password etc). <br><br>  You can log in using zlogin ‚ÄìC &lt;zone name&gt;: <br><br> <code><b># zlogin ‚ÄìC habrazone</b></code> <br> <br>  Next, we answer the OS questions about hostname, time zone, name service, enter the root password.  After all the configuration steps, the zone will reboot itself and we will be able to get to its console by the same zlogin &lt;zone name&gt; or ssh: <br><br> <code><b># hostname</b> <br> globalzone <br> <b># zlogin habrazone</b> <br> [Connected to zone 'habrazone' pts/1] <br> Last login: Fri Jul 1 18:43:32 on pts/3 <br> Oracle Corporation SunOS 5.10 Generic Patch January 2005 <br> <b># hostname</b> <br> habrazone</code> <br> <br>  The zone is ready. <br><br>  In the next article I will try to describe how you can allocate resources (raw, CPU, RAM) for a zone and how you can migrate zones between hosts. <br><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/123221/">https://habr.com/ru/post/123221/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../123215/index.html">Automation through integration. Promotional version. UPD</a></li>
<li><a href="../123216/index.html">More about Python descriptors</a></li>
<li><a href="../123217/index.html">Competition from iLab: prize - Playbook!</a></li>
<li><a href="../123219/index.html">One-two-three-four-five, I am going to present</a></li>
<li><a href="../123220/index.html">The play "Developing a multiplayer online game." Part 1: Architecture</a></li>
<li><a href="../123222/index.html">My experience with AOP and PostSharp</a></li>
<li><a href="../123223/index.html">My subjective experience with SSD</a></li>
<li><a href="../123225/index.html">Search office fermer.mobi</a></li>
<li><a href="../123226/index.html">Answers to Habra from Skolkovo</a></li>
<li><a href="../123227/index.html">GTD, MLO and BlackBerry</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>