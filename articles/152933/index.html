<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Qt widget for adding and deleting rows in a QTableView table</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, I would like to share my experience in developing a single widget (graphical user interface element), highlighting some Qt technologi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Qt widget for adding and deleting rows in a QTableView table</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/f60/775/2ef/f607752ef007449c3889261beeed645d.png"><br>  In this article, I would like to share my experience in developing a single widget (graphical user interface element), highlighting some Qt technologies and techniques. <br>  It is often necessary to give the user the ability to insert rows and columns into the table or remove them from it.  As a rule, this is implemented as follows: select the line by clicking on the header and select the item in the menu: select&gt; menu&gt; insert |  delete.  This is not entirely obvious and intuitive, as is the fact that the line is inserted <u>before the</u> current and not, for example, after it.  Therefore, I wrote a widget that removes this problem. <br>  The widget looks like four buttons that follow the cursor on the table border (haha, it's just like those bees that ran after the cursor on sites in the web 1.0 era!).  It would be possible to overload QTableView, but then you have to change all instances;  instead, I wrote a separate widget which is like a socket attached to an existing QTableView. <a name="habracut"></a><br>  The project consists of four classes, the main ones: the <i>InsertRemove :: Button button</i> , the <i>InsertRemove :: Panel panel</i> and two auxiliary ones to demonstrate the possibilities: a container for storing a data matrix based on the <i>InsertRemove :: Matrix</i> vector of vectors and a model - the interface of this <i>InsertRemove :: Model</i> container . <br>  The button calculates the position on the widget that is adequate to the current coordinate and current policy value ( <i>InsertRemove :: Policy</i> ), calculating it from the column width and row height.  One coordinate is the sum of these dimensions, the other is the nearest value of the border or the middle of the line. <br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> coord1; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> coord2 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sizes[m]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_orientation == Qt::Horizontal) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;m;i++) sizes[i] = table-&gt;columnWidth(i); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;n;i++) coord2 += table-&gt;rowHeight(i); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;m;i++) sizes[i] = table-&gt;rowHeight(i); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;n;i++) coord2 += table-&gt;columnWidth(i); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_type == InsertRemove::Insert) nearestBorder(_policy,point1+offset1,sizes,m,&amp;_modelIndex,&amp;coord1); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-comment"><span class="hljs-comment">// _type == InsertRemove::Remove nearestMiddle(_policy,point1+offset1,sizes,m,&amp;_modelIndex,&amp;coord1);</span></span></code> </pre> <br>  Policies are: insert, delete, insert only at the beginning, insert only at the end, because not all models can be allowed all these manipulations. <br>  For the button, I applied the parent concept widely used in Qt, for objects, this means that deleting the parent removes all child memory objects, and for widgets, moreover, that the child widgets are displayed within the parent (if are not dialog boxes) and in its coordinate system. <br>  There is nothing better to describe a style than css, and for data storage, it would be nice to use the Qt resource system, which allows embedding resources into a binary and accessing them as files, using ':' as the root directory. <br><pre> <code class="cpp hljs"> QString plus_css = <span class="hljs-string"><span class="hljs-string">"* {image: url(':/plus-icon.png'); border: 0;}"</span></span> <span class="hljs-string"><span class="hljs-string">"*:hover {image: url(':/plus-icon-hover.png');}"</span></span> <span class="hljs-string"><span class="hljs-string">"*:pressed {image: url(':/plus-icon-pressed.png');} "</span></span>; QString minus_css = <span class="hljs-string"><span class="hljs-string">"* {image: url(':/minus-icon.png'); border: 0;}"</span></span> <span class="hljs-string"><span class="hljs-string">"*:hover {image: url(':/minus-icon-hover.png');}"</span></span> <span class="hljs-string"><span class="hljs-string">"*:pressed {image: url(':/minus-icon-pressed.png');} "</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_type == Insert) setStyleSheet(plus_css); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> setStyleSheet(minus_css);</code> </pre><br>  When the button is pressed, the actual insertion or deletion in the model is called. <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Button::on_clicked() { QTableView* table = <span class="hljs-keyword"><span class="hljs-keyword">dynamic_cast</span></span>&lt;QTableView*&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;parent()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!table) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; QAbstractItemModel* model = table-&gt;model(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!model) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_type == InsertRemove::Insert) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_orientation == Qt::Horizontal) model-&gt;insertColumn(_modelIndex); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> model-&gt;insertRow(_modelIndex); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-comment"><span class="hljs-comment">// _type == InsertRemove::Remove { if (_orientation == Qt::Horizontal) model-&gt;removeColumn(_modelIndex); else model-&gt;removeRow(_modelIndex); } }</span></span></code> </pre><br>  Now that everything is clear with the button, go to the panel.  She is responsible for the creation and storage of these buttons and the transfer of coordinates and policies to them, as well as the adoption of buttons by a table. <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Panel::attach(QTableView* table) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;<span class="hljs-number"><span class="hljs-number">4</span></span>;i++) _buttons[i]-&gt;setParent(table); _table = table; table-&gt;setMouseTracking(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); table-&gt;viewport()-&gt;installEventFilter(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); connect(table-&gt;horizontalHeader(),SIGNAL(sectionResized(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)),<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>,SLOT(placeButtons())); connect(table-&gt;verticalHeader(),SIGNAL(sectionResized(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)),<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>,SLOT(placeButtons())); placeButtons(); }</code> </pre><br>  My favorite feature of Qt is the event filter (QEventFilter), it allows you to pray invading the inner life of the object, thereby violating the encapsulation.  When I think about it, I mentally go back to the days of bare WinApi, krippi macros, structures and curses like lpcwstr, when the desktop programmer was harder.  With this filter, the panel tracks the mouse movement in QTableView.  The filter in my case is the panel itself.  At first, I wanted to make the filter a separate class and put an event into a signal, but then I thought that there must be a good reason why events are events, and signals are signals and everything is not piled up (as done, if my memory serves me, in .Net).  Firstly, the events are the inner life of the widget, and the signals are its interface, and secondly, it is obvious that events are faster due to the smaller number of layers (layers of interaction), which can be critical in our case, when the event will be triggered hundreds of times per second.  Although I'm not sure at all 100 in these calculations.  So, all we need to track the event is the mouse movement and transfer the coordinates to the buttons. <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Panel::eventFilter(QObject* object, QEvent* event) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event-&gt;type() == QEvent::MouseMove &amp;&amp; object == _table-&gt;viewport()) { QMouseEvent* mouseEvent = <span class="hljs-keyword"><span class="hljs-keyword">dynamic_cast</span></span>&lt;QMouseEvent*&gt;(event); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!mouseEvent) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;<span class="hljs-number"><span class="hljs-number">4</span></span>;i++) _buttons[i]-&gt;setPoint(mouseEvent-&gt;pos()); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre><br>  The container and the demonstration model seem self-evident, so we go directly to the application: create a model, create a table, create a panel, attach a panel to the table. <br><pre> <code class="cpp hljs"> QTableView view; view.setModel(&amp;model); <span class="hljs-function"><span class="hljs-function">Panel </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">panel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(EverythingAllowed,EverythingAllowed)</span></span></span></span>; panel.setPolicy(Qt::Horizontal, (PolicyFlags) RemoveAllowed | AppendAllowed ); panel.attach(&amp;view);</code> </pre><br>  One of the disadvantages of this widget is that it is tied to QTableView (this is because it was for this purpose that I needed it), although it could be used for other types of views.  If there is time and desire, I will decide this question. <br>  Perhaps my work can be useful to you, it can be taken on a githaba or from my server.  Everything you need is in the insertremove folder in the InsertRemove namespace, it is connected via the profile profile.  For the library is not enough and damp for now.  Fell free to use and contribute. <br>  references: <br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> git://github.com/overloop/insertremovepanel.git git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> git://mugiseyebrows.ru/insertremovepanel.git</code> </pre><br>  look at: <a href="https://github.com/overloop/insertremovepanel">github.com</a> |  <a href="http://mugiseyebrows.ru/gitweb/%3Fp%3Dinsertremovepanel.git">mugiseyebrows.ru</a> <br>  download: <a href="https://github.com/overloop/insertremovepanel/zipball/master">github.com</a> |  <a href="http://mugiseyebrows.ru/gitweb/%3Fp%3Dinsertremovepanel.git%3Ba%3Dsnapshot%3Bh%3De7fd1ab7df769e703173582aea0dfd46122bb6da%3Bsf%3Dtgz">mugiseyebrows.ru</a> </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/152933/">https://habr.com/ru/post/152933/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../152917/index.html">We write and publish a plug-in to the Safari web browser</a></li>
<li><a href="../152921/index.html">Right decision tool: Six thinking hats</a></li>
<li><a href="../152927/index.html">Another jQuery plugin for pixel-to-pixel layout</a></li>
<li><a href="../152929/index.html">Why sometimes you have to beat your hands?</a></li>
<li><a href="../152931/index.html">Time setting on the switches via SNMP</a></li>
<li><a href="../152935/index.html">USSD and IVR - development and subtleties</a></li>
<li><a href="../152937/index.html">Wordpress blog with semantic markup</a></li>
<li><a href="../152941/index.html">Registering a site as a media is a panacea for blocking?</a></li>
<li><a href="../152943/index.html">In memory of David Barron</a></li>
<li><a href="../152945/index.html">Windows Azure at the conference Patterns & Practices Summit Russia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>