<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We explore the game with an arcade machine Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ugh, I was unbanned at HabrÃ©, and I have a great article for you, so hello everyone! 



 Introduction 
 Ever wonder what is in the arcade machines? W...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">ğŸ”</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">ğŸ“œ</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">â¬†ï¸</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">â¬‡ï¸</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We explore the game with an arcade machine Part 1</h1><div class="post__text post__text-html js-mediator-article">  Ugh, I was unbanned at HabrÃ©, and I have a great article for you, so hello everyone! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/420/097/c61/420097c617646da7bfb8435929439602.jpg"><br><br><h4>  Introduction </h4><br>  Ever wonder what is in the arcade machines?  What OS, what technologies are used for game development?  How are they protected from copying and modifying?  If yes, then welcome to this topic. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Insides </h4><br>  So, what's inside our machine? <br><br><ol><li>  Standard x86 computer with PIUIO and <a href="http://en.wikipedia.org/wiki/Japan_Amusement_Machinery_Manufacturers_Association">JAMMA</a> card <br><img src="https://habrastorage.org/getpro/habr/post_images/dbd/9b0/77e/dbd9b077e903691d1ed85f24c865fe3d.jpg"></li><li>  Amplifier, crossover and equalizer <br><img src="https://habrastorage.org/getpro/habr/post_images/b50/f08/559/b50f08559cc6710733877d3c37fd3dc4.jpg" alt="image"></li><li>  LED panel <br><img src="https://habrastorage.org/getpro/habr/post_images/cd3/18c/096/cd318c0964fcd4bc183e97aac3a77af7.jpg" alt="image"></li><li>  The control panel with the buttons "TEST", "SERVICE" and equalizer twists <br><img src="https://habrastorage.org/getpro/habr/post_images/e2d/3b5/f5f/e2d3b5f5f3616a03dc7ea02d3e105929.jpg" alt="image"></li><li>  LCD or CRT screen </li></ol><br>  We, of course, are primarily interested in the computer. <br><br>  There are several revisions of the internals of the latest version of the computer: <br>  <b>Motherboard</b> : Gigabyte GA-945GCM-S2L / Asrock G41M-S3 <br>  <b>Graphics adapter</b> : Geforce 8400GS / Geforce 9300GS <br>  <b>Memory</b> : DDR2 / DDR3 512 MB <br>  <b>Processor</b> : Intel Celeron <br><br>  The game itself is on the hard drive.  Includes <b>SafeNet MicroDog</b> USB <b>Dongle</b> . <br><img src="https://habrastorage.org/getpro/habr/post_images/786/afd/471/786afd4710d77f00762954f3a9bd5ab3.jpg" alt="image"><br><br><h4>  Study </h4><br>  Where to start?  Naturally, with the removal of the hard drive dump.  This is done in Linux with one command: <br> <code>dd if=/dev/sdX of=./dump.bin bs=1M</code> <br>  And we go to drink tea, because  it will take 10-15 minutes.  Winchesters are used at 160 and 250 gigabytes. <br>  <b>Never do anything on a running hard drive!</b>  <b>Always need to use an image!</b> <br><br>  The image is shot.  Let's run <b>cfdisk</b> on it. <br><img src="https://habrastorage.org/getpro/habr/post_images/62c/1be/b2d/62c1beb2d5c11718173ceb24a990702a.png" alt="image"><br><br>  What do we see?  Two partitions with the ext2 file system, and a suspiciously unallocated area at the beginning of the disk.  The file system can immediately suggest that there is something UNIX-like inside, with high probability, of course, Linux. <br><br>  Let's run it in the virtual.  I love <b>qemu</b> , so I use it. <br><img src="https://habrastorage.org/getpro/habr/post_images/9f7/a93/746/9f7a93746c32fed132fdb19cf41ab200.png"><br><br>  And nothing more.  Further, either qemu fails with an error like: <br> <code>qemu: fatal: Trying to execute code outside RAM or ROM at 0xa5ff00d8</code> <br>  either just hangs up.  Honestly, I knew that this game has a binding to the hard drive, and it became obvious that the algorithm is quite simple and does not use data integrity checks, but immediately transfers control of the decrypted data, and in the case of the virtual machine, just garbage. <br>  Then I, rather, more for the sake of interest, and not waiting for some discoveries, decided to see what lies on those two partitions with the ext2 file system.  Here's what: <br><br><pre> <code class="hljs haskell"> <span class="hljs-number"><span class="hljs-number">1</span></span> â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">4.0</span></span>K] game â”‚  â””â”€â”€ [ <span class="hljs-number"><span class="hljs-number">25</span></span>G] _00000.<span class="hljs-type"><span class="hljs-type">BIN</span></span> â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">4.3</span></span>M] i â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">16</span></span>K] lost+found â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">0</span></span>] n â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">8.5</span></span>M] p â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">7.8</span></span>M] u â””â”€â”€ [ <span class="hljs-number"><span class="hljs-number">22</span></span>M] x game/_00000.<span class="hljs-type"><span class="hljs-type">BIN</span></span>: <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> i: </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> n: empty p: </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> u: </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> x: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ELF</span></span></span><span class="hljs-class"> 32-bit </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LSB</span></span></span><span class="hljs-class"> shared object, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Intel</span></span></span><span class="hljs-class"> 80386, version 1 (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SYSV</span></span></span><span class="hljs-class">), dynamically linked, stripped  2: â”œâ”€â”€ [ 16K] lost+found â””â”€â”€ [144K] </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PIUFESTAEX</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">INI</span></span></span></span></code> </pre><br><br>  Well, all the data in section 1, except for the file "x", is ordinary data, or is encrypted.  Only â€œxâ€ somehow stands out from this mass - this is a shared library, which is probably loaded by the game (in fact, no). <br><br>  What next?  Well, got into the hard drive itself. <br><pre> <code class="hljs ruby"><span class="hljs-number"><span class="hljs-number">00000000</span></span> fa <span class="hljs-number"><span class="hljs-number">33</span></span> c<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>e d<span class="hljs-number"><span class="hljs-number">0</span></span> bc <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span>c <span class="hljs-number"><span class="hljs-number">8</span></span>b f4 <span class="hljs-number"><span class="hljs-number">50</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-number"><span class="hljs-number">50</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>f fb fc <span class="hljs-params"><span class="hljs-params">|.3.....|</span></span>..PP..<span class="hljs-params"><span class="hljs-params">| 00000010 bf 00 06 b9 00 01 f3 a5 ea 1d 06 00 00 b6 00 b9 |</span></span>................<span class="hljs-params"><span class="hljs-params">| 00000020 02 00 bf 05 00 bb 00 07 b8 01 02 57 cd 13 5f 73 |</span></span>...........W.._s<span class="hljs-params"><span class="hljs-params">| 00000030 0c 33 c0 cd 13 4f 75 ed be 8a 06 eb 3b b9 03 00 |</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>...Ou.....;...<span class="hljs-params"><span class="hljs-params">| 00000040 bf 05 00 bb 00 20 53 07 bb 00 00 b8 20 02 57 cd |</span></span>..... S..... .W.<span class="hljs-params"><span class="hljs-params">| 00000050 13 5f 73 0c 33 c0 cd 13 4f 75 e8 be 8a 06 eb 18 |</span></span>._s.<span class="hljs-number"><span class="hljs-number">3</span></span>...Ou......<span class="hljs-params"><span class="hljs-params">| 00000060 b9 ff 3f be 00 08 33 ff ad 83 e6 bf 26 33 05 ab |</span></span>..?...<span class="hljs-number"><span class="hljs-number">3</span></span>.....&amp;<span class="hljs-number"><span class="hljs-number">3</span></span>..<span class="hljs-params"><span class="hljs-params">| 00000070 49 75 f5 ea 00 00 00 20 ac 3c 00 74 0b 56 bb 07 |</span></span>Iu..... .&lt;.tV.<span class="hljs-params"><span class="hljs-params">| 00000080 00 b4 0e cd 10 5e eb f0 eb fe 44 69 73 6b 20 49 |</span></span>.....^....Disk I<span class="hljs-params"><span class="hljs-params">| 00000090 2f 4f 20 45 72 72 6f 72 00 00 00 00 00 00 00 00 |</span></span>/O Error........<span class="hljs-params"><span class="hljs-params">| 000000a0 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 |</span></span>................<span class="hljs-params"><span class="hljs-params">| * 00000180 28 43 29 32 30 30 34 20 41 4e 44 41 4d 49 52 4f |</span></span>(C)<span class="hljs-number"><span class="hljs-number">2004</span></span> XXXXXXXX<span class="hljs-params"><span class="hljs-params">| 00000190 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 |</span></span>................<span class="hljs-params"><span class="hljs-params">| * 000001b0 00 00 00 00 00 00 00 00 9b f6 31 c9 00 00 00 00 |</span></span>..........<span class="hljs-number"><span class="hljs-number">1</span></span>.....<span class="hljs-params"><span class="hljs-params">| 000001c0 41 8f 83 fe ff ff cf ce 61 00 b1 a1 a9 03 00 fe |</span></span>A.......a.......<span class="hljs-params"><span class="hljs-params">| 000001d0 ff ff 83 fe ff ff 6f 56 36 04 80 60 1f 00 00 00 |</span></span>......oV6..<span class="hljs-string"><span class="hljs-string">`....| 000001e0 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 |................| 000001f0 00 00 00 00 00 00 00 00 00 00 00 00 00 00 55 aa |..............U.| 00000200 50 75 6d 70 20 49 74 20 55 70 3a 20 46 69 65 73 |Xxxx Xx Xx: Xxxx| 00000210 74 61 45 78 00 00 00 00 00 00 00 00 00 00 00 00 |xxXx............| 00000220 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 |................| * 00000300 20 20 20 20 20 20 20 20 20 20 20 20 36 56 4d 51 | 6VMQ| 00000310 57 54 34 37 43 43 34 36 20 20 20 20 53 54 33 31 |WT47CC46 ST31| 00000320 36 30 33 31 38 41 53 20 20 20 20 20 20 20 20 20 |60318AS | 00000330 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 | | 00000340 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 |................| * 00000400 0e a8 36 bd 22 ac ea 0e a9 36 bb 22 82 66 80 70 |..6."....6.".fp| 00000410 dc 7a 36 37 c8 5d 18 36 ae fa 83 3a 74 d8 35 29 |.z67.].6...:t.5)| 00000420 11 b9 2d 25 1f c8 7d 10 07 c8 7d 21 81 34 07 ae |..-%..}...}!.4..| ...</span></span></code> </pre> <br>  <b>(Instead of â€œXâ€ there was the name of the manufacturer and the name of the game. I removed them so that this topic was not googled by this data. If you want, find out what was there, I did not change the HEX data.)</b> <br><br>  What is it?  I explain. <br>  The MBR-downloader is located at 0-1BE, the simplest one that loads the stage2-downloader from the first disk that starts from address 400. The most interesting line is located at 300-32F, very similar to the hard drive's serial number, firmware version and model.  What is there to guess, it is;) <br><table><tbody><tr><td>  <b>Description</b> </td><td>  <b>Data</b> </td></tr><tr><td>  Serial number (20 bytes) </td><td>  (12 spaces) 6VMQWT47 </td></tr><tr><td>  Firmware version (8 bytes) </td><td>  CC46 (4 spaces) </td></tr><tr><td>  Model name (40 bytes) </td><td>  ST3160318AS (29 spaces) </td></tr></tbody></table>  I went the easy way: I didnâ€™t analyze the work of the stage2-bootloader, but I just added a bit of qemu code so that it would take the hard drive data from the environment variables DRIVE_MODEL, DRIVE_SERIAL and DRIVE_VERSION.  Also, qemu allows you to dump the memory of the guest machine, which will be useful to us. <br><br><pre> <code class="hljs mel">valdikss@valaptop:~/ % DRIVE_SERIAL=<span class="hljs-string"><span class="hljs-string">" 6VMQWT47"</span></span> DRIVE_VERSION=<span class="hljs-string"><span class="hljs-string">"CC46 "</span></span> DRIVE_MODEL=<span class="hljs-string"><span class="hljs-string">"ST3160318AS"</span></span> qemu-<span class="hljs-keyword"><span class="hljs-keyword">system</span></span>-i386 disk.img -monitor stdio QEMU <span class="hljs-number"><span class="hljs-number">1.4</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> monitor - type <span class="hljs-string"><span class="hljs-string">'help'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> more information (qemu) dump-guest-<span class="hljs-keyword"><span class="hljs-keyword">memory</span></span> mem.bin (qemu) <span class="hljs-keyword"><span class="hljs-keyword">quit</span></span></code> </pre> <br>  It was possible to visually determine the correctness of data decryption: if the kernel was successfully unpacked and started, then at the moment the cursor appears on the screen, if the file system was unpacked correctly, the virtual machine screen will blink, it will try to start X. <br>  As a Linux user, I immediately tried to switch to another console using Alt + FN combinations, and I succeeded: on the second console, X was output. <br>  The image in qemu was successfully launched, it's already good, what's next?  We need to somehow get the file system.  Surely, along with the kernel, the initrd or initramfs is loaded, in which either the necessary files are located, or which the rootfs is decrypted and connected.  What to do?  Let's return to our memory dump and go through it with the wonderful <a href="http://code.google.com/p/binwalk/">BinWalk</a> utility: <br><pre> <code class="hljs mel">DECIMAL HEX DESCRIPTION ------------------------------------------------------------------------------------------------------------------- <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> ELF <span class="hljs-number"><span class="hljs-number">32</span></span>-bit LSB core <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> Intel <span class="hljs-number"><span class="hljs-number">80386</span></span>, version <span class="hljs-number"><span class="hljs-number">1</span></span> (SYSV) <span class="hljs-number"><span class="hljs-number">141888</span></span> <span class="hljs-number"><span class="hljs-number">0x22A40</span></span> Copyright <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>: <span class="hljs-string"><span class="hljs-string">" 1999-2003 XXXXXXXXxxx"</span></span> <span class="hljs-number"><span class="hljs-number">1649782</span></span> <span class="hljs-number"><span class="hljs-number">0x192C76</span></span> CramFS filesystem, little endian <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">279239</span></span> CRC <span class="hljs-number"><span class="hljs-number">0x42c70000</span></span>, edition <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">141723904</span></span> blocks, <span class="hljs-number"><span class="hljs-number">1589959</span></span> files <span class="hljs-number"><span class="hljs-number">3848752</span></span> <span class="hljs-number"><span class="hljs-number">0x3ABA30</span></span> CramFS filesystem, little endian <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">4947968</span></span> version #<span class="hljs-number"><span class="hljs-number">2</span></span> sorted_dirs CRC <span class="hljs-number"><span class="hljs-number">0x9c99ddde</span></span>, edition <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2433</span></span> blocks, <span class="hljs-number"><span class="hljs-number">235</span></span> files <span class="hljs-number"><span class="hljs-number">17648271</span></span> <span class="hljs-number"><span class="hljs-number">0x10D4A8F</span></span> mcrypt <span class="hljs-number"><span class="hljs-number">2.2</span></span> encrypted data, algorithm: blowfish<span class="hljs-number"><span class="hljs-number">-448</span></span>, mode: CBC, keymode: <span class="hljs-number"><span class="hljs-number">8</span></span>bit <span class="hljs-number"><span class="hljs-number">17752783</span></span> <span class="hljs-number"><span class="hljs-number">0x10EE2CF</span></span> mcrypt <span class="hljs-number"><span class="hljs-number">2.2</span></span> encrypted data, algorithm: blowfish<span class="hljs-number"><span class="hljs-number">-448</span></span>, mode: CBC, keymode: <span class="hljs-number"><span class="hljs-number">8</span></span>bit <span class="hljs-number"><span class="hljs-number">17773455</span></span> <span class="hljs-number"><span class="hljs-number">0x10F338F</span></span> mcrypt <span class="hljs-number"><span class="hljs-number">2.2</span></span> encrypted data, algorithm: blowfish<span class="hljs-number"><span class="hljs-number">-448</span></span>, mode: CBC, keymode: <span class="hljs-number"><span class="hljs-number">8</span></span>bit <span class="hljs-number"><span class="hljs-number">17966760</span></span> <span class="hljs-number"><span class="hljs-number">0x11226A8</span></span> Copyright <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>: <span class="hljs-string"><span class="hljs-string">" (C) 1996-2009 the UPX Team. All Rights Reserved. $l Rights Reserved. $"</span></span> <span class="hljs-number"><span class="hljs-number">18179243</span></span> <span class="hljs-number"><span class="hljs-number">0x11564AB</span></span> Copyright <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>: <span class="hljs-string"><span class="hljs-string">" (C) 2009 Free Software Foundation, Inc.ion, Inc."</span></span> <span class="hljs-number"><span class="hljs-number">18236316</span></span> <span class="hljs-number"><span class="hljs-number">0x116439C</span></span> ELF <span class="hljs-number"><span class="hljs-number">32</span></span>-bit LSB shared object, Intel <span class="hljs-number"><span class="hljs-number">80386</span></span>, version <span class="hljs-number"><span class="hljs-number">1</span></span> (SYSV) <span class="hljs-number"><span class="hljs-number">18261064</span></span> <span class="hljs-number"><span class="hljs-number">0x116A448</span></span> LZMA compressed data, properties: <span class="hljs-number"><span class="hljs-number">0xBD</span></span>, dictionary <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>: <span class="hljs-number"><span class="hljs-number">16777216</span></span> bytes, uncompressed <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>: <span class="hljs-number"><span class="hljs-number">33554432</span></span> bytes <span class="hljs-number"><span class="hljs-number">18261104</span></span> <span class="hljs-number"><span class="hljs-number">0x116A470</span></span> LZMA compressed data, properties: <span class="hljs-number"><span class="hljs-number">0xB8</span></span>, dictionary <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>: <span class="hljs-number"><span class="hljs-number">16777216</span></span> bytes, uncompressed <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>: <span class="hljs-number"><span class="hljs-number">33554432</span></span> bytes <span class="hljs-number"><span class="hljs-number">21033884</span></span> <span class="hljs-number"><span class="hljs-number">0x140F39C</span></span> ELF <span class="hljs-number"><span class="hljs-number">32</span></span>-bit LSB executable, Intel <span class="hljs-number"><span class="hljs-number">80386</span></span>, version <span class="hljs-number"><span class="hljs-number">1</span></span> (SYSV) <span class="hljs-number"><span class="hljs-number">21061669</span></span> <span class="hljs-number"><span class="hljs-number">0x1416025</span></span> ELF <span class="hljs-number"><span class="hljs-number">32</span></span>-bit LSB no <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> type, no machine, (GNU/Linux) <span class="hljs-number"><span class="hljs-number">21088103</span></span> <span class="hljs-number"><span class="hljs-number">0x141C767</span></span> ELF <span class="hljs-number"><span class="hljs-number">21152544</span></span> <span class="hljs-number"><span class="hljs-number">0x142C320</span></span> LZMA compressed data, properties: <span class="hljs-number"><span class="hljs-number">0x6C</span></span>, dictionary <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>: <span class="hljs-number"><span class="hljs-number">16777216</span></span> bytes, uncompressed <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>: <span class="hljs-number"><span class="hljs-number">838860800</span></span> bytes <span class="hljs-number"><span class="hljs-number">21435292</span></span> <span class="hljs-number"><span class="hljs-number">0x147139C</span></span> ELF <span class="hljs-number"><span class="hljs-number">32</span></span>-bit LSB shared object, Intel <span class="hljs-number"><span class="hljs-number">80386</span></span>, version <span class="hljs-number"><span class="hljs-number">1</span></span> (SYSV) <span class="hljs-number"><span class="hljs-number">21525404</span></span> <span class="hljs-number"><span class="hljs-number">0x148739C</span></span> ELF <span class="hljs-number"><span class="hljs-number">32</span></span>-bit LSB shared object, Intel <span class="hljs-number"><span class="hljs-number">80386</span></span>, version <span class="hljs-number"><span class="hljs-number">1</span></span> (SYSV) <span class="hljs-number"><span class="hljs-number">21537692</span></span> <span class="hljs-number"><span class="hljs-number">0x148A39C</span></span> ELF <span class="hljs-number"><span class="hljs-number">32</span></span>-bit LSB relocatable, Intel <span class="hljs-number"><span class="hljs-number">80386</span></span>, version <span class="hljs-number"><span class="hljs-number">1</span></span> (SYSV) <span class="hljs-number"><span class="hljs-number">21554076</span></span> <span class="hljs-number"><span class="hljs-number">0x148E39C</span></span> ELF <span class="hljs-number"><span class="hljs-number">32</span></span>-bit LSB shared object, Intel <span class="hljs-number"><span class="hljs-number">80386</span></span>, version <span class="hljs-number"><span class="hljs-number">1</span></span> (SYSV) <span class="hljs-number"><span class="hljs-number">21615281</span></span> <span class="hljs-number"><span class="hljs-number">0x149D2B1</span></span> Copyright <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>: <span class="hljs-string"><span class="hljs-string">" (C) 2006 Free Software Foundation, Inc.ion, Inc."</span></span> <span class="hljs-number"><span class="hljs-number">21672860</span></span> <span class="hljs-number"><span class="hljs-number">0x14AB39C</span></span> ELF <span class="hljs-number"><span class="hljs-number">32</span></span>-bit LSB shared object, Intel <span class="hljs-number"><span class="hljs-number">80386</span></span>, version <span class="hljs-number"><span class="hljs-number">1</span></span> (SYSV) <span class="hljs-number"><span class="hljs-number">21926836</span></span> <span class="hljs-number"><span class="hljs-number">0x14E93B4</span></span> ELF <span class="hljs-number"><span class="hljs-number">32</span></span>-bit LSB relocatable, Intel <span class="hljs-number"><span class="hljs-number">80386</span></span>, version <span class="hljs-number"><span class="hljs-number">1</span></span> (SYSV) <span class="hljs-number"><span class="hljs-number">110031566</span></span> <span class="hljs-number"><span class="hljs-number">0x68EF2CE</span></span> gzip compressed data, was <span class="hljs-string"><span class="hljs-string">"cursor.pcf"</span></span>, from Unix, last modified: Fri Feb <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span>:<span class="hljs-number"><span class="hljs-number">15</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-number"><span class="hljs-number">2004</span></span> <span class="hljs-number"><span class="hljs-number">116417852</span></span> <span class="hljs-number"><span class="hljs-number">0x6F0653C</span></span> CramFS filesystem, little endian <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">4947968</span></span> version #<span class="hljs-number"><span class="hljs-number">2</span></span> CRC <span class="hljs-number"><span class="hljs-number">0x86f06160</span></span>, edition <span class="hljs-number"><span class="hljs-number">16777216</span></span>, <span class="hljs-number"><span class="hljs-number">18</span></span> blocks, <span class="hljs-number"><span class="hljs-number">0</span></span> files <span class="hljs-number"><span class="hljs-number">121710143</span></span> <span class="hljs-number"><span class="hljs-number">0x741263F</span></span> LZMA compressed data, properties: <span class="hljs-number"><span class="hljs-number">0x87</span></span>, dictionary <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>: <span class="hljs-number"><span class="hljs-number">1048576</span></span> bytes, uncompressed <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>: <span class="hljs-number"><span class="hljs-number">256</span></span> bytes <span class="hljs-number"><span class="hljs-number">121721756</span></span> <span class="hljs-number"><span class="hljs-number">0x741539C</span></span> ELF <span class="hljs-number"><span class="hljs-number">32</span></span>-bit LSB shared object, Intel <span class="hljs-number"><span class="hljs-number">80386</span></span>, version <span class="hljs-number"><span class="hljs-number">1</span></span> (SYSV) <span class="hljs-number"><span class="hljs-number">122005647</span></span> <span class="hljs-number"><span class="hljs-number">0x745A88F</span></span> LZMA compressed data, properties: <span class="hljs-number"><span class="hljs-number">0x87</span></span>, dictionary <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>: <span class="hljs-number"><span class="hljs-number">1048576</span></span> bytes, uncompressed <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>: <span class="hljs-number"><span class="hljs-number">256</span></span> bytes <span class="hljs-number"><span class="hljs-number">122594740</span></span> <span class="hljs-number"><span class="hljs-number">0x74EA5B4</span></span> LZMA compressed data, properties: <span class="hljs-number"><span class="hljs-number">0x7E</span></span>, dictionary <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>: <span class="hljs-number"><span class="hljs-number">16777216</span></span> bytes, uncompressed <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>: <span class="hljs-number"><span class="hljs-number">33554432</span></span> bytes <span class="hljs-number"><span class="hljs-number">122614684</span></span> <span class="hljs-number"><span class="hljs-number">0x74EF39C</span></span> CramFS filesystem, little endian <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">4947968</span></span> version #<span class="hljs-number"><span class="hljs-number">2</span></span> sorted_dirs CRC <span class="hljs-number"><span class="hljs-number">0x9c99ddde</span></span>, edition <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2433</span></span> blocks, <span class="hljs-number"><span class="hljs-number">235</span></span> files <span class="hljs-number"><span class="hljs-number">129803164</span></span> <span class="hljs-number"><span class="hljs-number">0x7BCA39C</span></span> CramFS filesystem, little endian <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">4947968</span></span> version #<span class="hljs-number"><span class="hljs-number">2</span></span> sorted_dirs CRC <span class="hljs-number"><span class="hljs-number">0x9c99ddde</span></span>, edition <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2433</span></span> blocks, <span class="hljs-number"><span class="hljs-number">235</span></span> files</code> </pre> <br>  Oh, how many things! <br>  In fact, all LZMA triggers are false, since  He does not have a magic number, half of ELFs are also fake.  But CramFS with 235 files is very similar to the real one, and, most likely, it is used as an initrd. <br>  Getting the right CramFS out of memory is easy.  After CramFS resides on your hard drive as a file, try to unpack it.  I used cramfs-2.0 from the <a href="http://code.google.com/p/firmware-mod-kit/">firmware-mod-kit</a> package. <br><pre> <code class="hljs ruby">valdikss@valaptop<span class="hljs-symbol"><span class="hljs-symbol">:~/</span></span> % cramfsck -x root cram1.bin <span class="hljs-symbol"><span class="hljs-symbol">cramfsck:</span></span> crc error</code> </pre> <br>  Well, what did you expect?  Thought everything would be so simple? <br>  If we patch the checksum check in cramfsck, we can â€œsuccessfullyâ€ unpack the file system: <br><div class="spoiler">  <b class="spoiler_title">File system tree</b> <div class="spoiler_text"><pre> <code class="hljs rust">â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">4.0</span></span>K] bin â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">7</span></span>] ash -&gt; busybox â”‚  â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">130</span></span>K] busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">7</span></span>] cat -&gt; busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">7</span></span>] chmod -&gt; busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">7</span></span>] cp -&gt; busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">7</span></span>] df -&gt; busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">7</span></span>] dnsdomainname -&gt; busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">7</span></span>] echo -&gt; busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">7</span></span>] <span class="hljs-literal"><span class="hljs-literal">false</span></span> -&gt; busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">7</span></span>] hostname -&gt; busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">7</span></span>] kill -&gt; busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">7</span></span>] ln -&gt; busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">7</span></span>] ls -&gt; busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">7</span></span>] mkdir -&gt; busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">7</span></span>] mknod -&gt; busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">7</span></span>] mount -&gt; busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">7</span></span>] mv -&gt; busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">7</span></span>] netstat -&gt; busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">7</span></span>] ping -&gt; busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">7</span></span>] ps -&gt; busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">7</span></span>] pwd -&gt; busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">7</span></span>] rm -&gt; busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">7</span></span>] sh -&gt; busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">7</span></span>] sleep -&gt; busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">7</span></span>] sync -&gt; busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">7</span></span>] <span class="hljs-literal"><span class="hljs-literal">true</span></span> -&gt; busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">7</span></span>] umount -&gt; busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">7</span></span>] uname -&gt; busybox â”‚  â””â”€â”€ [ <span class="hljs-number"><span class="hljs-number">7</span></span>] vi -&gt; busybox â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">4.0</span></span>K] dev â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">0</span></span>] console â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">0</span></span>] null â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">0</span></span>] tty1 â”‚  â””â”€â”€ [ <span class="hljs-number"><span class="hljs-number">0</span></span>] tty2 â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">4.0</span></span>K] etc â”‚  â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">4.0</span></span>K] init.d â”‚  â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">90</span></span>] mnttab â”‚  â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">754</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">once</span></span> â”‚  â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">412</span></span>] rcS â”‚  â”‚  â””â”€â”€ [ <span class="hljs-number"><span class="hljs-number">244</span></span>] run â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">151</span></span>] inittab â”‚  â””â”€â”€ [<span class="hljs-number"><span class="hljs-number">4.0</span></span>K] X11 â”‚  â””â”€â”€ [ <span class="hljs-number"><span class="hljs-number">23</span></span>] xorg.conf -&gt; /usr/lib/xorg/xorg.conf â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">4.0</span></span>K] lib â”‚  â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">111</span></span>K] ld-<span class="hljs-number"><span class="hljs-number">2.10</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>.so â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">12</span></span>] ld-linux.so.<span class="hljs-number"><span class="hljs-number">2</span></span> -&gt; ld-<span class="hljs-number"><span class="hljs-number">2.10</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>.so ... â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">78</span></span>K] libz.so.<span class="hljs-number"><span class="hljs-number">1.2</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span> â”‚  â””â”€â”€ [<span class="hljs-number"><span class="hljs-number">4.0</span></span>K] modules â”‚  â””â”€â”€ [ <span class="hljs-number"><span class="hljs-number">25</span></span>K] atkbd.ko â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">4.0</span></span>K] mnt â”‚  â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">4.0</span></span>K] <span class="hljs-number"><span class="hljs-number">0</span></span> â”‚  â”‚  â””â”€â”€ [ <span class="hljs-number"><span class="hljs-number">0</span></span>] invalid â”‚  â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">4.0</span></span>K] <span class="hljs-number"><span class="hljs-number">1</span></span> â”‚  â”‚  â””â”€â”€ [ <span class="hljs-number"><span class="hljs-number">0</span></span>] invalid â”‚  â””â”€â”€ [<span class="hljs-number"><span class="hljs-number">4.0</span></span>K] hd â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">1.1</span></span>M] piu â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">4.0</span></span>K] <span class="hljs-keyword"><span class="hljs-keyword">proc</span></span> â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">4.0</span></span>K] sbin â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">14</span></span>] halt -&gt; ../bin/busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">14</span></span>] ifconfig -&gt; ../bin/busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">14</span></span>] init -&gt; ../bin/busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">14</span></span>] insmod -&gt; ../bin/busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">14</span></span>] lsmod -&gt; ../bin/busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">14</span></span>] mdev -&gt; ../bin/busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">14</span></span>] poweroff -&gt; ../bin/busybox â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">14</span></span>] reboot -&gt; ../bin/busybox â”‚  â””â”€â”€ [ <span class="hljs-number"><span class="hljs-number">14</span></span>] route -&gt; ../bin/busybox â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">4.0</span></span>K] SETTINGS â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">4.0</span></span>K] sys â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">4</span></span>] tmp -&gt; /var â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">4.0</span></span>K] usr â”‚  â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">4.0</span></span>K] bin â”‚  â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">18</span></span>K] amixer â”‚  â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">17</span></span>] du -&gt; ../../bin/busybox â”‚  â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">17</span></span>] env -&gt; ../../bin/busybox â”‚  â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">17</span></span>] free -&gt; ../../bin/busybox â”‚  â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">17</span></span>] less -&gt; ../../bin/busybox â”‚  â”‚  â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">4.4</span></span>K] mountrd â”‚  â”‚  â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">4.6</span></span>K] mount_tab â”‚  â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">17</span></span>] telnet -&gt; ../../bin/busybox â”‚  â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">25</span></span>K] usbdaemon â”‚  â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">4</span></span>] X -&gt; Xorg â”‚  â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">14</span></span>K] xinit â”‚  â”‚  â””â”€â”€ [<span class="hljs-number"><span class="hljs-number">1.7</span></span>M] Xorg â”‚  â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">4.0</span></span>K] lib â”‚  â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">4.0</span></span>K] sbin â”‚  â”‚  â””â”€â”€ [ <span class="hljs-number"><span class="hljs-number">17</span></span>] setlogcons -&gt; ../../bin/busybox â”‚  â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">4.0</span></span>K] share â”‚  â”‚  â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">4.0</span></span>K] alsa â”‚  â”‚  â”‚  â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">8.8</span></span>K] alsa.conf â”‚  â”‚  â”‚  â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">4.0</span></span>K] cards â”‚  â”‚  â”‚  â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">669</span></span>] AACI.conf â”‚  â”‚  â”‚  â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">687</span></span>] aliases.alisp â”‚... â”‚  â”‚  â”‚  â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">839</span></span>] VXPocket.conf â”‚  â”‚  â”‚  â”‚  â””â”€â”€ [<span class="hljs-number"><span class="hljs-number">1.3</span></span>K] YMF744.conf â”‚  â”‚  â”‚  â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">4.0</span></span>K] init â”‚  â”‚  â”‚  â”‚  â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">1.8</span></span>K] <span class="hljs-number"><span class="hljs-number">00</span></span>main â”‚  â”‚  â”‚  â”‚  â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">6.9</span></span>K] <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> â”‚  â”‚  â”‚  â”‚  â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">1.4</span></span>K] hda â”‚  â”‚  â”‚  â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">391</span></span>] help â”‚  â”‚  â”‚  â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">932</span></span>] info â”‚  â”‚  â”‚  â”‚  â””â”€â”€ [ <span class="hljs-number"><span class="hljs-number">11</span></span>K] test â”‚  â”‚  â”‚  â””â”€â”€ [<span class="hljs-number"><span class="hljs-number">4.0</span></span>K] pcm â”‚  â”‚  â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">805</span></span>] center_lfe.conf ... â”‚  â”‚  â”‚  â””â”€â”€ [ <span class="hljs-number"><span class="hljs-number">978</span></span>] surround71.conf â”‚  â”‚  â””â”€â”€ [<span class="hljs-number"><span class="hljs-number">4.0</span></span>K] X11 â”‚  â”‚  â””â”€â”€ [<span class="hljs-number"><span class="hljs-number">4.0</span></span>K] xkb â”‚  â”‚  â”œâ”€â”€ [<span class="hljs-number"><span class="hljs-number">4.0</span></span>K] compiled â”‚  â”‚  â”‚  â””â”€â”€ [ <span class="hljs-number"><span class="hljs-number">11</span></span>K] server.xkm â”‚  â”‚  â””â”€â”€ [<span class="hljs-number"><span class="hljs-number">4.0</span></span>K] rules â”‚  â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">34</span></span>K] base â”‚  â”‚  â”œâ”€â”€ [ <span class="hljs-number"><span class="hljs-number">31</span></span>K] evdev â”‚  â”‚  â””â”€â”€ [ <span class="hljs-number"><span class="hljs-number">4</span></span>] xorg -&gt; base â”‚  â””â”€â”€ [ <span class="hljs-number"><span class="hljs-number">4</span></span>] var -&gt; /var â””â”€â”€ [<span class="hljs-number"><span class="hljs-number">4.0</span></span>K] var</code> </pre></div></div><br><br>  So, everything seems to be, do you think?  Text files, like /etc/init.d/run, seem to be normal.  But none of the executable files and libraries are launched.  At first I thought that the game uses either a modified kernel or a modified libc.  Patchil executable files, looked about how they differ from hello world, because  they all either terminated with <b>segmentation fault</b> or, even worse, c <b>illegal hardware instruction</b> . <br>  I compiled myself a reference "hello world", because  already from the very beginning, from the __libc_start_main call, it flew somewhere not there.  Then he sinned on relocs, since  some seemed to be beaten, and I suggested that, perhaps, a modification to this, but no, after the relocs were edited, the game, although it began to try to run, was not that good.  Reflected on this for about 3 days.  I came to the conclusion that executable files somehow beat in CramFS, while text files remain in their original form.  And he was right! <br><br><div class="spoiler">  <b class="spoiler_title">/etc/init.d/run</b> <div class="spoiler_text"><pre> <code class="hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> run <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> __GL_SYNC_TO_VBLANK=1 <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> force_s3tc_enable=<span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> LD_LIBRARY_PATH=/lib:/usr/lib:/mnt/hd/lib <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /mnt/hd/game xinit /piu /mnt/hd/game/ -- -br -quiet -logverbose 0 -verbose 0 -depth 24 -audit 0 -bs -tst -xinerama <span class="hljs-comment"><span class="hljs-comment">#/bin/sh</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">/etc/init.d/once</b> <div class="spoiler_text"><pre> <code class="hljs sql">until /usr/bin/mount_tab /etc/init.d/mnttab; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sleep</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; done /usr/bin/mountrd insmod /usr/lib/modules/nvidia.ko insmod /usr/lib/modules/drm.ko insmod /usr/lib/modules/fb.ko insmod /usr/lib/modules/font.ko insmod /usr/lib/modules/softcursor.ko insmod /usr/lib/modules/bitblit.ko insmod /usr/lib/modules/fbcon.ko insmod /usr/lib/modules/drm_kms_helper.ko insmod /usr/lib/modules/cfbcopyarea.ko insmod /usr/lib/modules/cfbimgblt.ko insmod /usr/lib/modules/cfbfillrect.ko insmod /usr/lib/modules/i915.ko mkdir /dev/dri ln -s /dev/card0 /dev/dri/card0 /usr/bin/usbdaemon amixer <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Master</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span>% unmute amixer <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> PCM <span class="hljs-number"><span class="hljs-number">75</span></span>% unmute amixer <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> Front <span class="hljs-number"><span class="hljs-number">90</span></span>% unmute insmod /lib/modules/atkbd.ko</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">/etc/init.d/run</b> <div class="spoiler_text"><pre> <code class="hljs javascript">setlogcons <span class="hljs-number"><span class="hljs-number">2</span></span> mount -n -t tmpfs -o size=<span class="hljs-number"><span class="hljs-number">128</span></span>k <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mkdir /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/log mkdir /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/run mkdir /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/run/microdog mount -t sysfs sysfs /sys mount -t proc proc /proc mount -t usbfs none /proc/bus/usb mount -t tmpfs mdev /dev mkdir /dev/pts mount -t devpts devpts /dev/pts echo /sbin/mdev &gt; <span class="hljs-regexp"><span class="hljs-regexp">/proc/</span></span>sys/kernel/hotplug mdev -s mkdir /dev/snd cp -a /dev/controlC* <span class="hljs-regexp"><span class="hljs-regexp">/dev/</span></span>snd cp -a /dev/pcmC* <span class="hljs-regexp"><span class="hljs-regexp">/dev/</span></span>snd cp -a /dev/timer /dev/snd</code> </pre> </div></div><br><br>  Since  I had the original CramFS in my hands, and, remembering that I could get to the OS console in a virtual machine just by pressing Alt + F2, I decided to try replacing the original /etc/init.d/run, replacing the xinit call with / bin / sh .  But we need to somehow shove the modified CramFS back into the image.  Looking for the string "Compressed RamFS" in the image of the hard drive, I was somewhat surprised that it lies unencrypted!  Only, of course, not just like that, but with the â€œpaddingâ€, the entire file on the hard drive is divided into blocks of 32KB of data and 512 bytes of emptiness.  Well, it seems to be not a problem! <br><br>  It so happened that I changed not only /etc/init.d/run, but also /etc/init.d/once, commenting out the mount_tab, mountrd and usbdaemon calls, and somehow didnâ€™t really pay attention to the cycle in the call mount_tab. <br><br>  So, edited /etc/init.d/run, collected CramFS, wrote it into an image, and-and-and! ... nothing.  Okay, I collected the filesystem with the original /etc/init.d/run, and started looking for differences in the files.  As it turned out, there were a lot of them, for a long time I tried to understand what was the matter, it turns out that cramfs-2.0 from firmware-mod-kit collects a little differently.  Well, I downloaded the usual cramfs-tools from the repositories, compiled them, and suddenly I saw that, in addition to the checksum, the last byte of the files was different.  The original file has 0x80, and the one I collected has, of course, 0x00.  Surprised by this state of affairs, he replaced the last byte in his file, thrust it into the image of the hard drive and Hurray!  The image started with my modified FS, and I got a console.  The simple copying of files did not create any complexity, the launch files now really run on my linux system, and it was at this step that I realized that, indeed, CramFS specifically modified the executable files. <br><br>  Having a quick look at mount_tab, mountrd and usbdaemon in IDA PRO, at that time I was sure that mount_tab simply mounts the file system in the right places (the two partitions on the hard drive, the first in / mnt / game, and the second in / SETTINGS), mountrd scans AGP and PCI buses, decrypts, loads into memory and mounts into / usr / lib one of the files â€œpâ€, â€œiâ€ or â€œuâ€ lying on the first partition, which contain drivers for the video card, and usbdaemon provides work with USB -dongle through UNIX sockets. <br><br><h4>  False joy </h4><br>  I sit, investigating the launch file of the game, which I pulled out by copying, and my suspicions began to creep in.  Some kind of it is not like that, mentioning is a version of the game that I am investigating, no, and in general, somehow something is not right.  I realized that this file belongs to a different version of the game, and suggested that, apparently, after checking the USB dongle, it is from somewhere taking and decrypting another file.  Everything turned out to be much funnier. <br>  Remember that loop when calling mount_tab?  When you first start, it really just mounts file systems, but when you restart, it reads from the hard drive a certain amount of data from offset 0x1F80200 or 0x2080200, depending on the header on the first offset, decrypts this data, and right in memory replaces the game's CramFS file with right.  I really liked this move!  I was furious, but at the same time proud of the resourcefulness of the developers. <br><br><h4>  Conclusion </h4><br>  The article turned out somewhat crumpled and consists more of my thoughts, guesses and observations.  I hope it was interesting to read.  Part 2 will be purely technical, and, perhaps, will contain the analysis of the file system of the game and unlink the game from the USB dongle. <br>  Here's a video for you, finally. <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/pbvmFB4o8QQ%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700253&amp;usg=ALkJrhjHkPDxIIOinSqNtjDRYOANJFByhw" frameborder="0" allowfullscreen=""></iframe><br>  Greetings to <img src="http://habrastorage.org/storage2/400/f63/3a8/400f633a84a05c2c8c6567b362736161.png"><img src="http://habrastorage.org/storage2/fc2/aa5/b1d/fc2aa5b1d8963e7f3d94fc97bcea6697.jpg"><br><br>  <b>Please do not write in the comments the name of the game, so that it is not googled.</b>  <b>Thank!</b> </div><p>Source: <a href="https://habr.com/ru/post/179067/">https://habr.com/ru/post/179067/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../179053/index.html">Why Erlang?</a></li>
<li><a href="../179057/index.html">ISS goes to Linux</a></li>
<li><a href="../179059/index.html">BitTorrent announced a new format of torrent files: Bundle, with a request for action before the jump</a></li>
<li><a href="../179063/index.html">YouTube introduced Trends Map: visualizing user preferences on a map.</a></li>
<li><a href="../179065/index.html">Second beta released elementary OS Luna</a></li>
<li><a href="../179069/index.html">Multiple Branches and Rules Template</a></li>
<li><a href="../179071/index.html">Surprisingly, 3DS is now the best gaming platform.</a></li>
<li><a href="../179075/index.html">Processing pcntl signals in PHP</a></li>
<li><a href="../179077/index.html">Why the "Great Gatsby" is still not in the public domain</a></li>
<li><a href="../179081/index.html">Speed â€‹â€‹up your code and find a needle in a haystack</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>