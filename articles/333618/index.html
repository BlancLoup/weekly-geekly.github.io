<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Solid RealTime on React and Socket.io</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today we will talk about how to adjust the interaction of a React application with a server using Socket.io, while achieving a high speed of applicati...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Solid RealTime on React and Socket.io</h1><div class="post__text post__text-html js-mediator-article">  Today we will talk about how to adjust the interaction of a React application with a server using Socket.io, while achieving a high speed of application response to events generated by the server.  Code examples are designed for React or React Native.  At the same time, the concepts outlined here are universal, they can also be applied when developing using other frontend frameworks, such as Vue or Angular. <br><br> <a href="https://habrahabr.ru/company/ruvds/blog/333618/"><img src="https://habrastorage.org/getpro/habr/post_images/e81/cc7/a74/e81cc7a7477d050dba9b9b26f9ed8434.png" alt="image"></a> <br><br>  So, we need the client application to respond to events generated on the server.  Usually in such cases we are talking about real-time applications.  In such a scenario, the server transmits fresh data to the client as it becomes available.  After a connection is established between the client and the server, the server, without relying on client requests, initiates the transfer of data on its own. <br><a name="habracut"></a><br>  This model is suitable for many projects.  Among them are chats, games, trading systems, and so on.  Often, the approach proposed in this material is used in order to increase the speed of the response of the system, while the system itself can function without it.  The motives of the developer in this case are not important.  We believe it is acceptable to assume that you are reading this, since you would like to learn how to use sockets when creating React-applications and bring your development closer to real-time applications. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Here we will show a very simple example.  Namely, we will create a server on Node.js, which can receive connections from clients written in React, and send to the socket, at a specified frequency, information about the current time.  The client, receiving the latest data, will display them on the application page.  Both the client and server use the Socket.io library. <br><br><h2>  <font color="#3AC1EF">Setting up the working environment</font> </h2><br>  It is assumed that you have installed basic tools, such as Node.js and NPM.  In addition, you will need the <code>create-react-app</code> NPM package, so if you do not already have it, install it globally with this command: <br><br><pre> <code class="hljs matlab">npm --<span class="hljs-keyword"><span class="hljs-keyword">global</span></span> <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> create-react-app</code> </pre> <br>  Now you can create a <code>socket-timer</code> React application with which we will experiment by running the following command: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span>-react-app socket-timer</code> </pre> <br>  Now prepare your favorite text editor and find the folder where the <code>socket-timer</code> application files are located.  In order to start it, it is sufficient to execute the <code>npm start</code> command using the terminal. <br><br>  In our example, the server and client code will be located in the same folder, but this should not be done in work projects. <br><br><h2>  <font color="#3AC1EF">Socket.io on server</font> </h2><br>  Create a server that supports web sockets.  To do this, go to the terminal, switch to the application folder and install Socket.io: <br><br><pre> <code class="hljs pgsql">npm i <span class="hljs-comment"><span class="hljs-comment">--save socket.io</span></span></code> </pre> <br>  Now create the <code>server.js</code> file in the root of the folder.  In this file, first, import the library and create a socket: <br><br><pre> <code class="hljs lisp">const io = require('socket.io')()<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <br>  Now you can use the <code>io</code> variable for working with sockets.  Web sockets are long-lived two-way communication channels between the client and the server.  On the server, you must accept the connection request from the client and maintain the connection.  Using this connection, the server will be able to publish (generate) events that the client will receive. <br><br>  Do the following: <br><br><pre> <code class="hljs coffeescript">io.<span class="hljs-literal"><span class="hljs-literal">on</span></span>(<span class="hljs-string"><span class="hljs-string">'connection'</span></span>, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(client)</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>       });</code> </pre> <br>  Next, you need to tell Socket.io about which port you want to expect to connect to the client. <br><br><pre> <code class="hljs vhdl">const <span class="hljs-keyword"><span class="hljs-keyword">port</span></span> = <span class="hljs-number"><span class="hljs-number">8000</span></span>; io.listen(<span class="hljs-keyword"><span class="hljs-keyword">port</span></span>); console.log(<span class="hljs-symbol"><span class="hljs-symbol">'listening</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-keyword"><span class="hljs-keyword">port</span></span> ', <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>);</code> </pre> <br>  At this stage, you can go to the terminal and start the server by running the <code>node server</code> command.  If everything is done correctly, you will see a message about its successful launch: <code>listening on port 8000</code> . <br><br>  Now the server is idle.  Access to the channel of communication with the client is available, but the channel is still idle.  The communication channel is two-way; therefore, the server can not only transmit data to the client, but also respond to events that the client generates.  This mechanism can be viewed as a server event handler associated with a specific event of a specific client. <br><br>  In order to complete the work on the server part of the application, you need to start a timer.  It is necessary that the service starts a new timer for each client connected to it, and it is necessary for the client to send information to the server about the interval at which he wants to receive data.  This is an important point, demonstrating the possibilities of two-way communication between the client and the server. <br><br>  Edit the code in <code>server.js</code> as follows: <br><br><pre> <code class="hljs coffeescript">io.<span class="hljs-literal"><span class="hljs-literal">on</span></span>(<span class="hljs-string"><span class="hljs-string">'connection'</span></span>, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(client)</span></span></span><span class="hljs-function"> =&gt;</span></span> { client.<span class="hljs-literal"><span class="hljs-literal">on</span></span>(<span class="hljs-string"><span class="hljs-string">'subscribeToTimer'</span></span>, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(interval)</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'client is subscribing to timer with interval '</span></span>, interval); }); });</code> </pre> <br>  Now we have a basic design for organizing a client connection and for handling a timer start event coming from a client.  Now you can start the timer and start broadcasting events containing information about the current time to the client.  Edit the server code again, bringing it to this view: <br><br><pre> <code class="hljs coffeescript">io.<span class="hljs-literal"><span class="hljs-literal">on</span></span>(<span class="hljs-string"><span class="hljs-string">'connection'</span></span>, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(client)</span></span></span><span class="hljs-function"> =&gt;</span></span> { client.<span class="hljs-literal"><span class="hljs-literal">on</span></span>(<span class="hljs-string"><span class="hljs-string">'subscribeToTimer'</span></span>, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(interval)</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'client is subscribing to timer with interval '</span></span>, interval);   setInterval(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {     client.emit(<span class="hljs-string"><span class="hljs-string">'timer'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Date());   }, interval); }); });</code> </pre> <br>  Here we open the socket and start waiting for clients to connect.  When a client connects, we find ourselves in a closure where we can handle events from a particular client.  In particular, we are talking about the <code>subscribeToTimer</code> event, which was generated on the client.  The server, when received, starts a timer at the interval specified by the client.  When the timer is triggered, the timer event is passed to the client. <br><br>  At the moment, the code in the <code>server.js</code> file should look like this: <br><br><pre> <code class="hljs coffeescript">const io = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'socket.io'</span></span>)(); io.<span class="hljs-literal"><span class="hljs-literal">on</span></span>(<span class="hljs-string"><span class="hljs-string">'connection'</span></span>, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(client)</span></span></span><span class="hljs-function"> =&gt;</span></span> { client.<span class="hljs-literal"><span class="hljs-literal">on</span></span>(<span class="hljs-string"><span class="hljs-string">'subscribeToTimer'</span></span>, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(interval)</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'client is subscribing to timer with interval '</span></span>, interval);   setInterval(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {     client.emit(<span class="hljs-string"><span class="hljs-string">'timer'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Date());   }, interval); }); }); const port = <span class="hljs-number"><span class="hljs-number">8000</span></span>; io.listen(port); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'listening on port '</span></span>, port);</code> </pre> <br>  The server part of the project is ready.  Before proceeding to the client, we will check whether, after all revisions, the server code is launched by running the <code>node server</code> command in the terminal.  If, while you were editing <code>server.js</code> , the server was started, restart it to check the functionality of the latest changes. <br><br><h2>  <font color="#3AC1EF">Socket.io on the client</font> </h2><br>  We have already started the React application by executing the <code>npm start</code> command in the terminal.  If it is still running, open in the browser, then you can make changes to the code and the browser will immediately reload the modified application. <br><br>  First, you need to write client code for working with sockets, which will interact with the server socket and start the timer, generating the <code>subscribeToTimer</code> event and consuming the <code>timer</code> events that the server publishes. <br><br>  To do this, create an <code>api.js</code> file in the <code>src</code> folder.  In this file, we will create a function that can be called to send the server a <code>subscribeToTimer</code> event and send the <code>timer</code> event data generated by the server to the code that deals with the visualization. <br><br>  Let's start by creating a function and exporting it from the module: <br><br><pre> <code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">subscribeToTimer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">interval, cb</span></span></span><span class="hljs-function">) </span></span>{ } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> { subscribeToTimer }</code> </pre> <br>  Here we use functions in the Node.js style, where the one who calls the function can pass the timer interval in the first parameter, and the callback function in the second. <br><br>  Now you need to install the client version of the library Socket.io.  This can be done from the terminal: <br><br><pre> <code class="hljs pgsql">npm i <span class="hljs-comment"><span class="hljs-comment">--save socket.io-client</span></span></code> </pre> <br>  Next - import the library.  Here we can use the syntax of the ES6 modules, since the client code being executed is transpiled using Webpack and Babel.  You can create a socket by calling the main export function from the <code>socket.io-client</code> module and transferring server information to it: <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> openSocket <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'socket.io-client'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> socket = openSocket(<span class="hljs-string"><span class="hljs-string">'http://localhost:8000'</span></span>);</code> </pre> <br>  So, on the server we are waiting for the client to connect and for the <code>subscribeToTimer</code> event, after receiving which we will start the timer, and each time it is triggered, we will generate <code>timer</code> events sent to the client. <br><br>  Now it only remains to subscribe to the <code>timer</code> event coming from the server and generate the event <code>subscribeToTimer</code> .  Each time, receiving a <code>timer</code> event from the server, we will perform a callback function with the event data.  As a result, the full code of <code>api.js</code> will look like this: <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> openSocket <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'socket.io-client'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>  socket = openSocket(<span class="hljs-string"><span class="hljs-string">'http://localhost:8000'</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">subscribeToTimer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">cb</span></span></span><span class="hljs-function">) </span></span>{ socket.on(<span class="hljs-string"><span class="hljs-string">'timer'</span></span>, timestamp =&gt; cb(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, timestamp)); socket.emit(<span class="hljs-string"><span class="hljs-string">'subscribeToTimer'</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> { subscribeToTimer };</code> </pre> <br>  Note that we subscribe to the socket's <code>timer</code> event before we generate the <code>subscribeToTimer</code> event.  This is done in case we encounter a race condition when the server has already started issuing <code>timer</code> events and the client has not yet signed for them, which will lead to the loss of data transmitted in the events. <br><br><h2>  <font color="#3AC1EF">Using data received from the server in the React component</font> </h2><br>  So, the <code>api.js</code> file <code>api.js</code> ready, it exports a function that can be called to subscribe to events generated by the server.  Now let's talk about how to use this function in the React component to output, in real time, data received from the server through a socket. <br><br>  When creating a React application using the <code>create-react-app</code> file, the <code>App.js</code> file was generated (in the <code>src</code> folder).  At the top of the code for this file, add the import of the previously created API: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { subscribeToTimer } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./api'</span></span>;</code> </pre> <br>  Now you can add to the same file the component constructor, inside of which you can call the function <code>subscribeToTimer</code> from <code>api.js</code>  Every time, receiving an event from the server, simply write the value of the <code>timestamp</code> to the component state, using the data that came from the server. <br><br><pre> <code class="hljs delphi"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constructor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(props)</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">{ super(props); subscribeToTimer((err, timestamp) =&gt; this.setState({   timestamp }</span></span></span><span class="hljs-function">));</span></span> }</code> </pre> <br>  Since we are going to use the <code>timestamp</code> value in the component state, it makes sense to set its default value.  To do this, add the following code snippet below the constructor: <br><br><pre> <code class="hljs pgsql">state = { <span class="hljs-type"><span class="hljs-type">timestamp</span></span>: <span class="hljs-string"><span class="hljs-string">'no timestamp yet'</span></span> };</code> </pre> <br>  At this stage, you can edit the code of the <code>render</code> function so that it displays the <code>timestamp</code> value: <br><br><pre> <code class="hljs kotlin">render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (   &lt;div className=<span class="hljs-string"><span class="hljs-string">"App"</span></span>&gt;     &lt;p className=<span class="hljs-string"><span class="hljs-string">"App-intro"</span></span>&gt;     This <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> the timer value: {<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.timestamp}     &lt;/p&gt;   &lt;/div&gt; ); }</code> </pre> <br>  Now, if everything is done correctly, the current date and time received from the server will be displayed on the application page every second. <br><br><h2>  <font color="#3AC1EF">Results</font> </h2><br>  I often use the pattern of interaction between the server and client code described here.  You can easily extend it for use in your own scripts.  Hopefully, now everyone who wants to bring their React development closer to real-time applications will be able to do it. <br><br>  Dear readers!  Do you plan to apply the client-server interaction method described here in your projects? </div><p>Source: <a href="https://habr.com/ru/post/333618/">https://habr.com/ru/post/333618/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../333608/index.html">MBLTdev 2017 is coming. Registration is open</a></li>
<li><a href="../333610/index.html">TamTam: how we made a new messenger</a></li>
<li><a href="../333612/index.html">Deep Learning, now in OpenCV</a></li>
<li><a href="../333614/index.html">Why Python Networker</a></li>
<li><a href="../333616/index.html">Transition to embedded PostgreSQL in unit tests</a></li>
<li><a href="../333622/index.html">Dereferencing null pointers is no longer a problem.</a></li>
<li><a href="../333624/index.html">Apple will spend a billion on Chinese data center</a></li>
<li><a href="../333626/index.html">Creating servlets for dummies. Walkthrough</a></li>
<li><a href="../333628/index.html">Analyzing NHL players careers with Survival Regression and Python</a></li>
<li><a href="../333630/index.html">WebStorm 2017.2 - What's new in support for JavaScript, TypeScript, Angular and Sass and work with ESLint, Karma and Mocha</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>