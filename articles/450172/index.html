<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Timer in iOS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Imagine that you are working on an application in which you need to periodically perform certain actions. This is what Swift uses for the Timer class....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Timer in iOS</h1><div class="post__text post__text-html js-mediator-article">  Imagine that you are working on an application in which you need to periodically perform certain actions.  This is what Swift uses for the <b>Timer</b> class. <br><br>  Timer is used to plan actions in the application.  This can be a one-time action or a repetitive procedure. <br><br>  In this tutorial, you will understand how the timer works in iOS, how it can affect the responsiveness of the UI, how to optimize battery consumption when using a timer, and how to use <b>CADisplayLink</b> to animate. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As a test site, we will use the application - a primitive task scheduler. <br><a name="habracut"></a><br><h2>  Getting started </h2><br>  Download the <a href="">original project.</a>  Open it in Xcode, look at its structure, compile and run.  You will see the simplest task scheduler: <br><br><img src="https://habrastorage.org/webt/9v/iw/xg/9viwxg_qjy7oyvwfsss09ec813c.png"><br><br>  Add a new task to it.  Tap on the + icon, enter the name of the task, tap Ok. <br><br>  Added tasks have a time stamp.  The new task you just created is marked with zero seconds.  As you can see, this value does not increase. <br><br>  Each task can be marked as completed.  Tap on the task.  The name of the task will be crossed out and it will be marked as completed. <br><br><h2>  Create our first timer </h2><br>  Let's create the main timer of our application.  The <b>Timer</b> class, also known as <b>NSTimer,</b> is a convenient way to schedule an action for a specific point, both one-time and periodical. <br><br>  Open <b>TaskListViewController.swift</b> and add this variable to <b>TaskListViewController</b> : <br><br><pre><code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> timer: <span class="hljs-type"><span class="hljs-type">Timer?</span></span></code> </pre> <br>  Then add extension to the same place: <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">// MARK: - Timer extension TaskListViewController { }</span></span></code> </pre> <br>  And paste this code into the extension: <br><br><pre> <code class="swift hljs"><span class="hljs-meta"><span class="hljs-meta">@objc</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">// 1 guard let visibleRowsIndexPaths = tableView.indexPathsForVisibleRows else { return } for indexPath in visibleRowsIndexPaths { // 2 if let cell = tableView.cellForRow(at: indexPath) as? TaskTableViewCell { cell.updateTime() } } }</span></span></code> </pre> <br>  In this method we: <br><br><ol><li>  Check if there are visible rows in the task table. </li><li>  Call <b>updateTime</b> for each visible cell.  This method updates the timestamp in the cell (see <b>TaskTableViewCell.swift</b> ). </li></ol><br>  Then add this code to the extension: <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">// 1 if timer == nil { // 2 timer = Timer.scheduledTimer(timeInterval: 1.0, target: self, selector: #selector(updateTimer), userInfo: nil, repeats: true) } }</span></span></code> </pre> <br>  Here we: <br><br><ol><li>  Check if timer contains a <b>Timer</b> instance. </li><li>  If not, create a timer that calls <b>updateTimer ()</b> every second. </li></ol><br>  Then we need to create a timer as soon as the user adds the first task.  Add <b>createTimer ()</b> at the very beginning of the <b>presentAlertController (_ :)</b> method. <br><br>  Launch the app and create a couple of new tasks.  You will see that each task timestamp changes every second. <br><br><img src="https://habrastorage.org/webt/nw/ze/nn/nwzenn61635ppptgcdsule6ywsk.gif" width="281" height="500"><br><br><h2>  We add the admission to the timer </h2><br>  Increasing the number of timers leads to worse UI responsiveness and greater battery consumption.  Each timer tries to execute exactly at the allotted time, as by default its tolerance is zero. <br><br>  Adding timer tolerance is a simple way to reduce energy consumption.  This allows the system to perform a timer action between the assigned time and the assigned time <b>plus the tolerance time</b> - but never the previously assigned interval. <br><br>  For timers that run only once, the tolerance value is ignored. <br><br>  In the <b>createTimer ()</b> method, immediately after assigning the timer, add this line: <br><br><pre> <code class="swift hljs">timer?.tolerance = <span class="hljs-number"><span class="hljs-number">0.1</span></span></code> </pre> <br>  Run the application.  In this particular case, the effect will not be obvious (we have only one timer), but in the real situation of several timers your users will get a more responsive interface and the application will be more energy efficient. <br><br><img src="https://habrastorage.org/webt/nw/ze/nn/nwzenn61635ppptgcdsule6ywsk.gif" width="281" height="500"><br><br><h2>  Timers in the background </h2><br>  Interestingly, what happens to the timers when the application goes to the background?  To deal with this, add this code at the very beginning of the <b>updateTimer ()</b> method: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> fireDateDescription = timer?.fireDate.description { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(fireDateDescription) }</code> </pre> <br>  This will allow us to track the timer events in the console. <br><br>  Run the application, add the task.  Now press the Home button on your device, and then return to our application. <br><br>  In the console, you will see something like this: <br><br><img src="https://habrastorage.org/webt/qb/ry/dd/qbryddhdojzhiq5jp0eol00axf4.png"><br><br><h2>  Understanding <b>Run Loops</b> </h2><br>  The run loop is an event loop that schedules and processes inbound events.  The cycle keeps the thread busy while it is working and puts it into a ‚Äúsleeping‚Äù state when there is no work for it. <br><br>  Every time you start an application, the system creates the main application thread, each thread has an automatically created execution loop for it. <br><br>  But why is all this information important to you now?  Now each timer starts in the main thread and joins the execution loop.  You are probably aware that the main thread is engaged in user interface drawing, touch processing, and so on.  If the main thread is busy with something, the interface of your application can become ‚Äúnon-responsive‚Äù (hang). <br><br>  Did you notice that the timestamp in the cell is not updated when you drag the table view? <br><br><img src="https://habrastorage.org/webt/og/jg/l6/ogjgl6z6livbu-shmvtszh3movq.gif" width="281" height="500"><br><br>  You can solve this problem by specifying the run loop to start timers in a different mode. <br><br><h2>  Understanding the run loop modes </h2><br>  The run loop mode is a set of input sources, such as a touch of the screen or mouse clicks, which can be monitored and a set of ‚Äúobservers‚Äù receiving notifications. <br><br>  There are three run cycle modes in iOS: <br><br>  <b>default</b> : input sources that are not NSConnectionObjects are processed. <br>  <b>common</b> : a set of input cycles is processed, for which you can define a set of input sources, timers, "observers". <br>  <b>tracking</b> : handled by application UI. <br><br>  For our application, the <b>common</b> mode looks most appropriate.  To use it, replace the contents of the <b>createTimer ()</b> method <b>with the</b> following: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> timer == <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> timer = <span class="hljs-type"><span class="hljs-type">Timer</span></span>(timeInterval: <span class="hljs-number"><span class="hljs-number">1.0</span></span>, target: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, selector: #selector(updateTimer), userInfo: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, repeats: <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-type"><span class="hljs-type">RunLoop</span></span>.current.add(timer, forMode: .common) timer.tolerance = <span class="hljs-number"><span class="hljs-number">0.1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.timer = timer }</code> </pre> <br>  The main difference from the previous code is that we add this timer to the run loop in the <b>common</b> mode before assigning the TaskLeader to the TaskLeader. <br><br>  Compile and run the application. <br><br><img src="https://habrastorage.org/webt/ya/up/xy/yaupxyslxeqpej-7kwxadnlrtzk.gif" width="281" height="500"><br><br>  Now the time labels of the cells are updated even in the case of scrolling the table. <br><br><h2>  Add animation to complete all tasks. </h2><br>  Now we will add a congratulatory animation for the user to perform all the tasks - the ball will rise from the bottom of the screen to the very top. <br><br>  Add these variables at the beginning of TaskListViewController: <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">// 1 var animationTimer: Timer? // 2 var startTime: TimeInterval?, endTime: TimeInterval? // 3 let animationDuration = 3.0 // 4 var height: CGFloat = 0</span></span></code> </pre> <br>  The purpose of these variables: <br><br><ol><li>  storage timer animation. </li><li>  storage of start and end time of the animation. </li><li>  the duration of the animation. </li><li>  animation height </li></ol><br>  Now add the following TaskListViewController <b>text</b> to the end of the <b>TaskListViewController.swift</b> file: <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">// MARK: - Animation extension TaskListViewController { func showCongratulationAnimation() { // 1 height = UIScreen.main.bounds.height + balloon.frame.size.height // 2 balloon.center = CGPoint(x: UIScreen.main.bounds.width / 2, y: height + balloon.frame.size.height / 2) balloon.isHidden = false // 3 startTime = Date().timeIntervalSince1970 endTime = animationDuration + startTime! // 4 animationTimer = Timer.scheduledTimer(withTimeInterval: 1 / 60, repeats: true) { timer in // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Animation here } } }</span></span></code> </pre> <br>  Here we do the following: <br><br><ul><li>  calculate the height of the animation, getting the height of the device screen </li><li>  center the ball outside the screen and set its visibility </li><li>  assign the start and end time of the animation </li><li>  start the animation timer and update the animation 60 times per second </li></ul><br>  Now we need to create our own logic for updating the greeting animation.  Add this code after <b>showCongratulationAnimation ()</b> : <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateAnimation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">// 1 guard let endTime = endTime, let startTime = startTime else { return } // 2 let now = Date().timeIntervalSince1970 // 3 if now &gt;= endTime { animationTimer?.invalidate() balloon.isHidden = true } // 4 let percentage = (now - startTime) * 100 / animationDuration let y = height - ((height + balloon.frame.height / 2) / 100 * CGFloat(percentage)) // 5 balloon.center = CGPoint(x: balloon.center.x + CGFloat.random(in: -0.5...0.5), y: y) }</span></span></code> </pre> <br>  What are we doing: <br><br><ol><li>  check that endTime and startTime are assigned </li><li>  save current time in constant </li><li>  make sure that the end time has not yet come.  If it is already, update the timer and hide our ball </li><li>  calculate the new y-coordinate of the ball </li><li>  the horizontal position of the ball is calculated relative to the previous position </li></ol><br>  Now replace <b>// TODO: Animation here</b> in <b>showCongratulationAnimation () with</b> this code: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.updateAnimation()</code> </pre> <br>  Now <b>updateAnimation ()</b> is called whenever a timer event occurs. <br><br>  Hooray, we just created an animation.  However, when you start the application, nothing new happens ... <br><br><h2>  Show animation </h2><br>  As you probably guessed, there is nothing to "launch" our new animation.  To do this, we need another method.  Add this code to the TaskListViewController animation <b>extension</b> : <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showCongratulationsIfNeeded</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> taskList.<span class="hljs-built_in"><span class="hljs-built_in">filter</span></span>({ !$<span class="hljs-number"><span class="hljs-number">0</span></span>.completed }).<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span> { showCongratulationAnimation() } }</code> </pre> <br>  We will call this method whenever the user marks a task as completed, it checks whether all tasks have been completed.  If so, it will call <b>showCongratulationAnimation ()</b> . <br><br>  <b>Finally</b> , add a call to this method at the end of the <b>tableView (_: didSelectRowAt :)</b> : <br><br><pre> <code class="swift hljs">showCongratulationsIfNeeded()</code> </pre> <br>  Run the application, create a couple of tasks, mark them as completed - and you will see our animation! <br><br><img src="https://habrastorage.org/webt/zz/xs/2m/zzxs2mcciespvyjwaudma_rytyi.gif" width="281" height="500"><br><br><h2>  Stop the timer </h2><br>  If you look in the console, you will see that, although the user has noted all the tasks completed, the timer continues.  This is completely pointless, so it makes sense to stop the timer when it is not needed. <br><br>  First, create a new method to stop the timer: <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cancelTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { timer?.invalidate() timer = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> }</code> </pre> <br>  This will update the timer and reset it to nil so that we can correctly create it again later.  <b>invalidate ()</b> is the only way to remove a Timer from a run loop.  The run loop will remove a strong reference to the timer, either directly after calling <b>invalidate ()</b> or a little later. <br><br>  Now let's replace the showCongratulationsIfNeeded () method as follows: <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showCongratulationsIfNeeded</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> taskList.<span class="hljs-built_in"><span class="hljs-built_in">filter</span></span>({ !$<span class="hljs-number"><span class="hljs-number">0</span></span>.completed }).<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span> { cancelTimer() showCongratulationAnimation() } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { createTimer() } }</code> </pre> <br>  Now, if the user performs all the tasks, the application will first reset the timer, and then show the animation, otherwise it will try to create a new timer if it is not already there. <br><br>  Run the application. <br><br><img src="https://habrastorage.org/webt/62/l9/4-/62l94-n0gtjlg2sfpjoffjqvaom.gif" width="281" height="500"><br><br>  Now the timer stops and restarts as it should. <br><br><h2>  CADisplayLink for smooth animation </h2><br>  <b>Timer</b> is a non-ideal choice for controlling animations.  You may have noticed the omission of several frames of animation, especially if you run the application in the simulator. <br><br>  We set the timer to 60Hz.  Thus, the timer updates the animation every 16 ms.  Consider the situation more closely: <br><br><img src="https://habrastorage.org/webt/ar/df/ec/ardfecmgf7bizt8ggcqa01jdbju.png"><br><br>  When using <b>Timer,</b> we do not know the exact time of the launch of the action.  This can happen either at the beginning or at the end of the frame.  Let's say the timer runs in the middle of each frame (blue dots in the figure).  The only thing we know for sure is that there will be a call every 16 ms. <br><br>  Now we only have 8 ms to execute the animation, and this may not be enough for our animation.  Let's look at the second frame in the figure.  The second frame cannot be completed within the allotted time, so the application will reset the second frame of the animation. <br><br><h2>  CADisplayLink will help us. </h2><br>  <b>CADisplayLink</b> is called once per frame and tries to synchronize real animation frames as far as possible.  Now you will have all 16 ms and iOS will not drop a single frame. <br><br>  To use <b>CADisplayLink</b> , you need to replace <b>animationTimer</b> with a new type. <br><br>  Replace this code <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> animationTimer: <span class="hljs-type"><span class="hljs-type">Timer?</span></span></code> </pre> <br>  on that: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> displayLink: <span class="hljs-type"><span class="hljs-type">CADisplayLink?</span></span></code> </pre> <br>  You replaced <b>Timer</b> with <b>CADisplayLink</b> .  <b>CADisplayLink</b> is a representation of a timer that is tied to a vertical sweep of the display.  This means that the device's GPU will pause until the screen can process further GPU commands.  This way we get smooth animation. <br><br>  Replace this code <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> startTime: <span class="hljs-type"><span class="hljs-type">TimeInterval?</span></span>, endTime: <span class="hljs-type"><span class="hljs-type">TimeInterval?</span></span></code> </pre> <br>  on that: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> startTime: <span class="hljs-type"><span class="hljs-type">CFTimeInterval?</span></span>, endTime: <span class="hljs-type"><span class="hljs-type">CFTimeInterval?</span></span></code> </pre> <br><br>  You replaced <b>TimeInterval</b> with <b>CFTimeInterval</b> , which is necessary for working with CADisplayLink. <br><br>  Replace the text of the <b>showCongratulationAnimation ()</b> method with this: <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showCongratulationAnimation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">// 1 height = UIScreen.main.bounds.height + balloon.frame.size.height balloon.center = CGPoint(x: UIScreen.main.bounds.width / 2, y: height + balloon.frame.size.height / 2) balloon.isHidden = false // 2 startTime = CACurrentMediaTime() endTime = animationDuration + startTime! // 3 displayLink = CADisplayLink(target: self, selector: #selector(updateAnimation)) displayLink?.add(to: RunLoop.main, forMode: .common) }</span></span></code> </pre> <br>  What are we doing here: <br><br><ol><li>  Set the height of the animation, the coordinates of the ball and visibility - about the same as they did before. </li><li>  Initialize <b>startTime</b> with <b>CACurrentMediaTime ()</b> (instead of of Date ()). </li><li>  Create an instance of the <b>CADisplayLink</b> class and add it to the run loop in the <b>common</b> mode. </li></ol><br>  Now replace <b>updateAnimation () with the</b> following code: <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">// 1 @objc func updateAnimation() { guard let endTime = endTime, let startTime = startTime else { return } // 2 let now = CACurrentMediaTime() if now &gt;= endTime { // 3 displayLink?.isPaused = true displayLink?.invalidate() balloon.isHidden = true } let percentage = (now - startTime) * 100 / animationDuration let y = height - ((height + balloon.frame.height / 2) / 100 * CGFloat(percentage)) balloon.center = CGPoint(x: balloon.center.x + CGFloat.random(in: -0.5...0.5), y: y) }</span></span></code> </pre> <br><ol><li>  Add <a href="https://habr.com/ru/users/objc/" class="user_link">objc</a> to the method signature (for CADisplayLink, the selector parameter requires such a signature). </li><li>  Replace initialization with <b>Date ()</b> to initialize the date of <b>CoreAnimation</b> . </li><li>  Replace the <b>animationTimer.invalidate ()</b> call with a CADisplayLink and invalidate pause.  This will also remove CADisplayLink from the run loop. </li></ol><br>  Run the app! <br><br><img src="https://habrastorage.org/webt/01/ct/jf/01ctjfswyhfhc6dogl8wavqv8-a.gif" width="281" height="500"><br>  Perfectly!  We successfully replaced the <b>Timer</b> based animation with a more suitable <b>CADisplayLink</b> - and got the animation smoother, without jerks. <br><br><h2>  Conclusion </h2><br>  In this tutorial, you figured out how the <b>Timer</b> class works in iOS, what the run loop is and how it can make your application more responsive in terms of interface, and how to use <b>CADisplayLink</b> instead of Timer for smooth animation. </div><p>Source: <a href="https://habr.com/ru/post/450172/">https://habr.com/ru/post/450172/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../450164/index.html">How to help burnout team at work, if you yourself burned out?</a></li>
<li><a href="../450166/index.html">We invite developers to Think Developers Workshop</a></li>
<li><a href="../450168/index.html">Internet history: core network</a></li>
<li><a href="../45017/index.html">Netbeans 6.5</a></li>
<li><a href="../450170/index.html">AR, robotics and cataracts: how we went to the Russian-German programming school</a></li>
<li><a href="../450176/index.html">More to the question of sets</a></li>
<li><a href="../450180/index.html">6 useful tools to start a startup in the US</a></li>
<li><a href="../450182/index.html">Billing modeling in a cloud reporting provider</a></li>
<li><a href="../450188/index.html">How to accomplish 70 tasks in a day: life in task trackers is a good life</a></li>
<li><a href="../450192/index.html">Progressive scale of taxation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>