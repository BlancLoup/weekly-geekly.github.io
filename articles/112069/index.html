<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Bloom filter</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello again! Today I will tell about Bloom's filter - the data structure is ingenious in its simplicity. In essence, this filter implements a probabil...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Bloom filter</h1><div class="post__text post__text-html js-mediator-article">  Hello again!  Today I will tell about Bloom's filter - the data structure is ingenious in its simplicity.  In essence, this filter implements a probabilistic set with only two operations: adding an element to the set and checking whether the element is in a set.  The set is probabilistic because the last operation to the question ‚Äúdoes this element belong to the set?‚Äù Gives an answer not in the form of ‚Äúyes / no‚Äù, but in the form of ‚Äúpossible / no‚Äù. <br><br><a name="habracut"></a><br><h4>  How does the filter do this? </h4><br>  As I said, the idea to genius is simple.  An array of bits of fixed size <code>m</code> and a set of <code>k</code> different hash functions are produced, giving values ‚Äã‚Äãfrom <code>0</code> to <code>m - 1</code> .  If it is necessary to add an element to the set, the value of each hash function is considered for the element and bits with corresponding indices are set in the array. <br><br>  To verify the membership, you guessed it, it is enough to count the hash functions for the potential member and make sure that all the corresponding bits are set to one - this will be the answer ‚Äúpossible‚Äù.  If at least one bit is not equal to one, then the set of this element does not contain - the answer is ‚Äúno‚Äù, the element is filtered. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Implementation </h4><br>  JavaScript code, simply because on Habr√© it is understandable to many.  First of all, we need to somehow represent the bitmap: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Bits</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bits = []; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">index</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (bits[<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(index / <span class="hljs-number"><span class="hljs-number">32</span></span>)] &gt;&gt;&gt; (index % <span class="hljs-number"><span class="hljs-number">32</span></span>)) &amp; <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">index</span></span></span><span class="hljs-function">) </span></span>{ bits[<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(index / <span class="hljs-number"><span class="hljs-number">32</span></span>)] |= <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; (index % <span class="hljs-number"><span class="hljs-number">32</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-attr"><span class="hljs-attr">test</span></span>: test, <span class="hljs-attr"><span class="hljs-attr">set</span></span>: set}; }</code> </pre> <br>  Also, we need a parameterized family of hash functions to make it easier to create <code>k</code> different ones.  The implementation is simple, but it works surprisingly well: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Hash</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> seed = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random() * <span class="hljs-number"><span class="hljs-number">32</span></span>) + <span class="hljs-number"><span class="hljs-number">32</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">string</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; string.length; ++i) result = (seed * result + string.charCodeAt(i)) &amp; <span class="hljs-number"><span class="hljs-number">0xFFFFFFFF</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }; }</code> </pre> <br>  Well, actually, the Bloom filter itself: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Bloom</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">size, functions</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bits = Bits(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">string</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; functions.length; ++i) bits.set(functions[i](string) % size); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">string</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; functions.length; ++i) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!bits.test(functions[i](string) % size)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-attr"><span class="hljs-attr">add</span></span>: add, <span class="hljs-attr"><span class="hljs-attr">test</span></span>: test}; }</code> </pre> <br>  Example of use: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fruits = Bloom(<span class="hljs-number"><span class="hljs-number">64</span></span>, [Hash(), Hash()]); fruits.add(<span class="hljs-string"><span class="hljs-string">'apple'</span></span>); fruits.add(<span class="hljs-string"><span class="hljs-string">'orange'</span></span>); alert(fruits.test(<span class="hljs-string"><span class="hljs-string">'cabbage'</span></span>) ? <span class="hljs-string"><span class="hljs-string">' .'</span></span> : <span class="hljs-string"><span class="hljs-string">' ,  100%.'</span></span>);</code> </pre> <br>  After the games with the parameters, it becomes clear that there must be some optimal values ‚Äã‚Äãfor them. <br><br><h4>  Optimal values </h4><br>  Of course, I did not deduce the theoretical optimal values ‚Äã‚Äãmyself, I just went to Wikipedia, but even without it, by turning on the logic, one can estimate and catch some regularities.  For example, it makes no sense to use a large bitmap if you are going to store two values ‚Äã‚Äãthere, the opposite is also true, otherwise the array will be overcrowded, which will lead to an increase in erroneous answers ‚Äúpossible‚Äù.  The optimal array size in bits: <br><img src="http://habrastorage.org/storage/habraeffect/5d/62/5d628753fb2df1012bfddeb6695730be.png" alt="Formula optimal array size"><br>  where <code>n</code> is the estimated number of elements stored in the filter-set, <code>p</code> is the desired probability of false positives. <br><br>  The number of hash functions should not be large, but not small.  The optimal amount: <br><br><img src="http://habrastorage.org/storage/habraeffect/82/0e/820e8d9e040d5cf641ad710ab1326d70.png" alt="The formula for the optimal number of functions"><br>  Apply the knowledge gained: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OptimalBloom</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">max_members, error_probability</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> size = -(max_members * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.log(error_probability)) / (<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.LN2 * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.LN2); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> count = (size / max_members) * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.LN2; size = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.round(size); count = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.round(count); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> functions = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; count; ++i) functions[i] = Hash(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Bloom(size, functions); }</code> </pre> <br><br><h4>  Where to use? </h4><br>  For example, Googol uses Bloom filters in its BigTable to reduce disk accesses.  It is not surprising, because in fact, BigTable is a large, very sparse multidimensional table, so most of the keys point to emptiness.  In addition, the data is sawn into relatively small block files, each of which is queried for requests, although it may not contain the required data. <br><br>  In this case, it is advantageous to spend some RAM and greatly reduce disk usage.  For example, to reduce the load by 10 times, you need to store about 5 bits of information for each key.  To reduce 100 times, you need about 10 bits per key.  Draw your own conclusions. <br><br><h4>  Different thoughts </h4><br>  Judging by the tests, the optimal values ‚Äã‚Äãof the parameters for the practice are somewhat overestimated; we can safely lower the false response threshold by an order of two.  Just be sure to test it if you use it - maybe some kind of unique combination of data and hash functions came up in my tests, or I just made a mistake somewhere. <br><br>  Obviously, it is impossible to remove elements from the filter, but this is simply solved - it is enough to replace the bit array with an array of counters - increment when adding, decrement when deleting.  Memory consumption naturally increases. <br><br>  It is also obvious that it is impossible to dynamically change the filter parameters.  The problem is elegantly solved by the introduction of a hierarchy of filters, each subsequent more accurate, if necessary, the hierarchy grows deep into. <br><br>  Perhaps that's all.  Until. </div><p>Source: <a href="https://habr.com/ru/post/112069/">https://habr.com/ru/post/112069/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../112064/index.html">Results of CES-2011</a></li>
<li><a href="../112065/index.html">The use of patterns in the development of architecture flex-applications</a></li>
<li><a href="../112066/index.html">BigBlueButton: an open conferencing solution</a></li>
<li><a href="../112067/index.html">What do you live, Korea? A quick review of one North Korean site</a></li>
<li><a href="../112068/index.html">MATLAB and fast Fourier transform</a></li>
<li><a href="../112070/index.html">Malicious programs - 2010: annual report</a></li>
<li><a href="../112072/index.html">Chinas work MTS</a></li>
<li><a href="../112073/index.html">Nekto.me - anonymous comment service</a></li>
<li><a href="../112074/index.html">3D without glasses</a></li>
<li><a href="../112077/index.html">Cookies inside the iframe - a problem when creating the application VKontakte / Facebook</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>