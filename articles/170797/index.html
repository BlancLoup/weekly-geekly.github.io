<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Functional monitoring in Yandex</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Do you monitor your production in production? Whose responsibility do you have? 

 Often, when it comes to monitoring, server developers, system admin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Functional monitoring in Yandex</h1><div class="post__text post__text-html js-mediator-article">  Do you monitor your production in production?  Whose responsibility do you have? <br><br>  Often, when it comes to monitoring, server developers, system administrators, and DBAs come to mind, who need to keep track of data processing queues, free disk space, the viability of individual hosts, and the load. <br>  Such monitoring really gives a lot of information about the service, but it does not always show how the service works for a real user.  Therefore, as a supplement to system monitoring, we have created in Yandex a system of functional monitoring that monitors the status of the service through the target interfaces - through how the application looks and works in the browser, and how it works at the API level. <br>  What is functional monitoring in our understanding?  To better understand this, let's look at how things developed. <br><a name="habracut"></a><br>  It all began, of course, with autotests for regression testing.  These autotests were also launched after release in production to test the serviceability of the service under combat conditions.  The fact that the regression tests launched in production sometimes find bugs made us think. <br><br><h2>  What is it and why </h2><br>  <i>Why are functional tests written for regression testing and successfully tested, find problems in production?</i> <br>  We identified several reasons: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  Differences in the configuration of the test environment from the production. </li><li>  Problems with internal or external data providers. </li><li>  "Iron" problems affecting functionality. </li><li>  Problems manifested with time and / or under a specific load. </li></ul><br><br>  If such tests can find problems, we decided that we should try to run them regularly in production and monitor the status of services. <br>  Let's take a closer look at the problems and tasks that functional monitoring can help with. <br><br><h4>  Data providers </h4><br>  A good example of a page that depends on data providers is Yandex‚Äôs main page. <br>  Weather and News, Poster and TV program, even a photo of the day with the search helmets - this is data from external and internal suppliers. <br>  For example, in Arkhangelsk, the Billboard block once looked like this: <br><img src="http://img-fotki.yandex.ru/get/5637/3578775.5/0_f72e5_1e27af1d_XL" alt="image"><br>  Whereas in Murmansk everything was in order. <br><img src="https://habrastorage.org/getpro/habr/post_images/5ce/bd1/4dc/5cebd14dcfa6962fc72b6a52f6f8dd7e.png" alt="image"><br><br>  This happened because the supplier did not send data for Arkhangelsk (or the import was not updated on our side).  Sometimes this problem is one-time in nature, and in some cases KPIs can be formulated according to the percentage of data available and their freshness. <br><br><h4>  "Iron" problems </h4><br>  Resiliency and performance play an important role in our services.  Therefore, teams create services with a distributed architecture and load balancing mechanisms.  The failure of individual ‚Äúhardware‚Äù, as a rule, does not affect the users, however, large-scale problems with data centers or routing between them are noticeable in the end interfaces. <br>  Functional monitoring, which supplement the system monitoring in this work, allows to track the connection of "iron" problems and functionality. <br>  For example, in Yandex.Direct, there was a case when a slowly ‚Äúperishing‚Äù server caused a gradual degradation of the service and its inaccessibility from certain regions.  Functional monitoring in this case served as a trigger for urgent investigation and identification of the root of the problem. <br>  Another interesting example is the teachings that are held in our company.  During the exercise, one of the data centers is deliberately disconnected to make sure that this does not affect the performance of the services and to identify possible problems in time.  Shutting down one data center is not detrimental to services, and functional monitoring helps to monitor the situation during such outages. <br><br><h4>  Service degradation over time </h4><br>  Actual operating conditions of an application in production sometimes create unforeseen situations.  The cause of the problems may be an unexpected combination of volume, duration and type of load, or, for example, the accumulation of system errors that were not detected at the testing stage.  The reason may also be errors in setting up the infrastructure, leading to a slowdown of the system or its failure. <br>  If such problems cannot be identified at the testing stage, it is necessary to quickly recognize them if they occur in production.  Here, system and functional monitoring can, complementing each other, find problems and report them. <br><br>  So, functional monitoring is a functional autotest, ‚Äúsharpened‚Äù to search for certain problems and constantly run in production. <br><br><h2>  What's inside </h2><br>  There is a second component of functional monitoring - how the flow of results is processed. <br>  A large stream of results coming from constantly running tests in production should be streamlined and filtered.  It is necessary to promptly report problems and at the same time minimize false alarms.  Also, there is the task of integrating information from functional monitoring into the overall system for assessing the serviceability of the service. <br><br>  To prevent false positives, our system, implemented on the basis of the Apache Camel framework, allows us to aggregate several consecutive results from one test into one event.  For example, you can configure filtering 3 out of 5, which allows you to notify about a breakdown only if the test generated an error 3 times in 5 consecutive runs (similarly, you can set, for example, filtering 2 of 2 or remove filtering - 1 of 1).  It is also important how often the test is run, so that the delay with such filtering is acceptable. <br><br>  On different projects, the consumers of these monitoring are different: somewhere, the results of monitoring are locked in by testers, it is interesting for managers to know about individual monitoring, somewhere the results are integrated into the overall system. <br><br><h2>  Recipe </h2><br>  The idea of ‚Äã‚Äãfunctional monitoring is very simple, and such monitoring can be very effective in work. <br>  Recipe: <br>  1. Analyze which parts of your service may break in production and why. <br>  2. Write (or select from available) autotests for this functionality. <br>  3. Run these tests in production as often as you need and as the test run systems allow. <br>  4. Process the results and notify about breakdowns, compare with other sources of information about the life of the service. <br><br>  PS: For a long time, we have been wondering how widespread the idea of ‚Äã‚Äãfunctional monitoring is and how it is applied in other companies.  Someone speaks about such an approach as a matter of course, someone, having learned, decides to implement it, and someone considers such monitoring as superfluous in the presence of systemic monitoring. <br>  <i>And how do you track the status of your services in production, what tools and their combinations do you use?</i> </div><p>Source: <a href="https://habr.com/ru/post/170797/">https://habr.com/ru/post/170797/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../170773/index.html">Price free: Real Racing 3 needs to spend over $ 500</a></li>
<li><a href="../170777/index.html">How two weeks ?!</a></li>
<li><a href="../170785/index.html">We teach the phone to count gamma rays or the second life of the old Soviet household dosimeter DBG-0.5B ...</a></li>
<li><a href="../170787/index.html">Intel Acquires HTML5 Toolkit for Mobile Application Developers</a></li>
<li><a href="../170789/index.html">Refer A Friend: we pay for these friends</a></li>
<li><a href="../170799/index.html">New Brief: Samsung Announces HomeSync Home Media Center</a></li>
<li><a href="../170801/index.html">GSA: Preparing Google Search Appliance in a Virtual Machine</a></li>
<li><a href="../170803/index.html">PSD Compilation: Apple Device Design</a></li>
<li><a href="../170805/index.html">The subtleties of working with a competent customer</a></li>
<li><a href="../170807/index.html">Comparison of methods for creating mobile versions of sites</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>