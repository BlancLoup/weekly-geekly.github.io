<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>As we played the game ‚ÄúStone - scissors - paper‚Äù on the Ethereum blockchain. Part 2 Technical</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Taking into account the comments to my previous article, I decided to write the second part, where the technical component of the game will be conside...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>As we played the game ‚ÄúStone - scissors - paper‚Äù on the Ethereum blockchain. Part 2 Technical</h1><div class="post__text post__text-html js-mediator-article">  Taking into account the comments to my <a href="https://habr.com/post/358576/">previous article,</a> I decided to write the second part, where the technical component of the game will be considered in more detail. <br><a name="habracut"></a><br>  So, let's begin.  We made the client part in javascript using the Meteor framework nodejs.  The only server solution in the game is a chat on mongoDB.  See what algorithm of the game we planned before starting work: <br><br><img src="https://habrastorage.org/webt/or/aa/gj/oraagjfkwghrlkhcsgnecogfhwk.jpeg"><br><br>  <b>Description of the smart contract.</b>  There are no blanks or template options for creating the game ‚ÄúStone, Scissors, Paper‚Äù on the blockchain.  To do this, we conducted our own research and development.  Our smart contract allows you to create and close gaming tables.  Information on all tables is contained in the memory of the smart contract. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="javascript hljs">struct room { address player1; address player2; bytes32 bit1; bytes32 bit2; uint8 res1; uint8 res2; uint256 bet; uint8 counter; uint8 c1; uint8 c2; uint roomTime; uint startTime; bool open; bool close; } mapping (<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">uint</span></span></span><span class="hljs-function"> =&gt;</span></span> room) rooms;</code> </pre> <br>  As you can see, we create a mapping (associative array) of rooms, the keys of which are table numbers, and the values ‚Äã‚Äãare the table object.  In the table object, we declare the space for the players' addresses and their moves.  Also in the table is stored the total score of the match, the number of victories on each side, and the timestamps for creating the table and starting the game.  The table number is generated by the client part randomly.  This number is from 0 to 99999999. The same number can be used many times, provided that the created table is closed.  Pads with table numbers can occur extremely rarely, but even in this case, it does not disrupt the smart contract, the duplicate transaction simply cannot take place.  If the table is not closed normally, the number used for some time will fall out of the possible options for creating the next table.  According to the logic of the smart contract, an open table has a duration of relevance only knocks.  After that, any action on the table leads to its closure, including an attempt to connect to it anyone.  The table is closed due to the revertRoom function and then closeRoom, which removes information about the table from the associative array of rooms. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">revertRoom</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">uint id</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">internal</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( rooms[id].bet &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) { rooms[id].player1.transfer(rooms[id].bet); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( rooms[id].player2 != <span class="hljs-number"><span class="hljs-number">0x0</span></span> ) rooms[id].player2.transfer(rooms[id].bet); } RevertRoom(id); closeRoom(id); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">closeRoom</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">uint id</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">internal</span></span></span><span class="hljs-function"> </span></span>{ rooms[id].close = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; RoomClosed( id ); <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> rooms[id]; }</code> </pre> <br>  Smart contract functions that begin with a capital letter are events.  The gameplay in the client part is largely based on listening to certain events related to the current table.  We created 14 events: <br><br><pre> <code class="javascript hljs">event RoomOpened( uint indexed room, address indexed player1, uint256 bet, uint8 counter, uint openedTime, bool indexed privat ); event RoomClosed( uint indexed room ); event JoinPlayer1( uint indexed room, address indexed player1 ); event JoinPlayer2( uint indexed room, address indexed player2, uint countdownTime ); event BetsFinished(uint indexed room ); event BetsAdd(address indexed <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>, uint indexed room ); event OneMoreGame(uint indexed room ); event SeedOpened( uint indexed room ); event RoundFinished( uint indexed room, uint8 res1, uint8 res2 ); event Revard(address win, uint256 amount, uint indexed room ); event Winner(address win, uint indexed room ); event Result(address indexed player, uint8 r, uint indexed room ); event RevertRoom(uint indexed room); event ScoreChanged(uint indexed room, uint8 score1, uint8 score2);</code> </pre> <br>  Marking indexed after the declaration of the type of variable allows filtering events by the specified field.  Listening to events on the blockchain from the client side is done as follows (We use the coffee script, it can be converted in the javascript service <a href="https://js2.coffee/">https://js2.coffee</a> ): <br><br><pre> <code class="javascript hljs">#  <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.autorun =&gt; filter5 = contractInstance.Winner {<span class="hljs-attr"><span class="hljs-attr">room</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>(FlowRouter.getParam(<span class="hljs-string"><span class="hljs-string">'id'</span></span>)), }, {<span class="hljs-attr"><span class="hljs-attr">fromBlock</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">toBlock</span></span>: <span class="hljs-string"><span class="hljs-string">'latest'</span></span>, <span class="hljs-attr"><span class="hljs-attr">address</span></span>: contrAdress} filter5.watch (error, result) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log result <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> result instance.winner.set result.args.win <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log result.args.win UIkit.modal(<span class="hljs-string"><span class="hljs-string">"#modal-winner"</span></span>).show()</code> </pre> <br>  As you can see, we are addressing an event on the blockchain called Winner, having previously prepared the image of a smart contract constactInstance.  Setting up web3 and preparing the image is performed by the following script: <br><br><div class="spoiler">  <b class="spoiler_title">Longcode</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> web3 !== <span class="hljs-string"><span class="hljs-string">'undefined'</span></span>) { web3 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Web3(web3.currentProvider); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> contrAdress = <span class="hljs-string"><span class="hljs-string">'0x80dd7334a28579a9e96601573555db15b7fe523a'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> contrInterface = [ { <span class="hljs-string"><span class="hljs-string">"anonymous"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"room"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"score1"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint8"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"score2"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint8"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"ScoreChanged"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"event"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"constant"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"deleteContract"</span></span>, <span class="hljs-string"><span class="hljs-string">"outputs"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"payable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"stateMutability"</span></span>: <span class="hljs-string"><span class="hljs-string">"nonpayable"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"function"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"constant"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"exitRoom"</span></span>, <span class="hljs-string"><span class="hljs-string">"outputs"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"payable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"stateMutability"</span></span>: <span class="hljs-string"><span class="hljs-string">"nonpayable"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"function"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"constant"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"fixResults"</span></span>, <span class="hljs-string"><span class="hljs-string">"outputs"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"payable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"stateMutability"</span></span>: <span class="hljs-string"><span class="hljs-string">"nonpayable"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"function"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"constant"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"fixTimerResults"</span></span>, <span class="hljs-string"><span class="hljs-string">"outputs"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"payable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"stateMutability"</span></span>: <span class="hljs-string"><span class="hljs-string">"nonpayable"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"function"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"constant"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"joinRoom"</span></span>, <span class="hljs-string"><span class="hljs-string">"outputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"payable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"stateMutability"</span></span>: <span class="hljs-string"><span class="hljs-string">"payable"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"function"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"constant"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"count"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint8"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"privat"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"bool"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"newRoom"</span></span>, <span class="hljs-string"><span class="hljs-string">"outputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"payable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"stateMutability"</span></span>: <span class="hljs-string"><span class="hljs-string">"payable"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"function"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"constant"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"bet"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"bytes32"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"setBet"</span></span>, <span class="hljs-string"><span class="hljs-string">"outputs"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"payable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"stateMutability"</span></span>: <span class="hljs-string"><span class="hljs-string">"nonpayable"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"function"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"anonymous"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"room"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"OneMoreGame"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"event"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"anonymous"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"player"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"address"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"r"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint8"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"room"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Result"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"event"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"anonymous"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"room"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"SeedOpened"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"event"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"anonymous"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"win"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"address"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"room"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Winner"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"event"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"anonymous"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"room"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"res1"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint8"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"res2"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint8"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"RoundFinished"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"event"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"anonymous"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"win"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"address"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"amount"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"room"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Revard"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"event"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"constant"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"mreic"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"setMaxReic"</span></span>, <span class="hljs-string"><span class="hljs-string">"outputs"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"payable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"stateMutability"</span></span>: <span class="hljs-string"><span class="hljs-string">"nonpayable"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"function"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"anonymous"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"room"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"BetsFinished"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"event"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"anonymous"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"room"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"player2"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"address"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"countdownTime"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"JoinPlayer2"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"event"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"anonymous"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"room"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"RevertRoom"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"event"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"anonymous"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"room"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"player1"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"address"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"JoinPlayer1"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"event"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"anonymous"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"room"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"RoomClosed"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"event"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"anonymous"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"room"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"player1"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"address"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"bet"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"counter"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint8"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"openedTime"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"privat"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"bool"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"RoomOpened"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"event"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"anonymous"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"from"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"address"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"indexed"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"room"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"BetsAdd"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"event"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"constant"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"seed"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"setSeed"</span></span>, <span class="hljs-string"><span class="hljs-string">"outputs"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"payable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"stateMutability"</span></span>: <span class="hljs-string"><span class="hljs-string">"nonpayable"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"function"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"constant"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"transferOutAll"</span></span>, <span class="hljs-string"><span class="hljs-string">"outputs"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"payable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"stateMutability"</span></span>: <span class="hljs-string"><span class="hljs-string">"nonpayable"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"function"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"constant"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"newOwner"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"address"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"transferOwnership"</span></span>, <span class="hljs-string"><span class="hljs-string">"outputs"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"payable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"stateMutability"</span></span>: <span class="hljs-string"><span class="hljs-string">"nonpayable"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"function"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"payable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"stateMutability"</span></span>: <span class="hljs-string"><span class="hljs-string">"nonpayable"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"constructor"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"constant"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"checkRoomBet"</span></span>, <span class="hljs-string"><span class="hljs-string">"outputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"payable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"stateMutability"</span></span>: <span class="hljs-string"><span class="hljs-string">"view"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"function"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"constant"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"checkRoomBet1"</span></span>, <span class="hljs-string"><span class="hljs-string">"outputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"bytes32"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"payable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"stateMutability"</span></span>: <span class="hljs-string"><span class="hljs-string">"view"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"function"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"constant"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"checkRoomBet2"</span></span>, <span class="hljs-string"><span class="hljs-string">"outputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"bytes32"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"payable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"stateMutability"</span></span>: <span class="hljs-string"><span class="hljs-string">"view"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"function"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"constant"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"checkRoomCounter"</span></span>, <span class="hljs-string"><span class="hljs-string">"outputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint8"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"payable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"stateMutability"</span></span>: <span class="hljs-string"><span class="hljs-string">"view"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"function"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"constant"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"player"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"address"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"checkRoomIsBet"</span></span>, <span class="hljs-string"><span class="hljs-string">"outputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"bytes32"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"payable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"stateMutability"</span></span>: <span class="hljs-string"><span class="hljs-string">"view"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"function"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"constant"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"checkRoomNotClosed"</span></span>, <span class="hljs-string"><span class="hljs-string">"outputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"bool"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"payable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"stateMutability"</span></span>: <span class="hljs-string"><span class="hljs-string">"view"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"function"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"constant"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"checkRoomOpened"</span></span>, <span class="hljs-string"><span class="hljs-string">"outputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"bool"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"payable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"stateMutability"</span></span>: <span class="hljs-string"><span class="hljs-string">"view"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"function"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"constant"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"checkRoomPlayer1"</span></span>, <span class="hljs-string"><span class="hljs-string">"outputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"address"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"payable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"stateMutability"</span></span>: <span class="hljs-string"><span class="hljs-string">"view"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"function"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"constant"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"checkRoomPlayer2"</span></span>, <span class="hljs-string"><span class="hljs-string">"outputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"address"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"payable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"stateMutability"</span></span>: <span class="hljs-string"><span class="hljs-string">"view"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"function"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"constant"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"checkRoomRes1"</span></span>, <span class="hljs-string"><span class="hljs-string">"outputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint8"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"payable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"stateMutability"</span></span>: <span class="hljs-string"><span class="hljs-string">"view"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"function"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"constant"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"checkRoomRes2"</span></span>, <span class="hljs-string"><span class="hljs-string">"outputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint8"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"payable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"stateMutability"</span></span>: <span class="hljs-string"><span class="hljs-string">"view"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"function"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"constant"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"checkRoomScore1"</span></span>, <span class="hljs-string"><span class="hljs-string">"outputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint8"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"payable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"stateMutability"</span></span>: <span class="hljs-string"><span class="hljs-string">"view"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"function"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"constant"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"checkRoomScore2"</span></span>, <span class="hljs-string"><span class="hljs-string">"outputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint8"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"payable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"stateMutability"</span></span>: <span class="hljs-string"><span class="hljs-string">"view"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"function"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"constant"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"checkRoomStartTime"</span></span>, <span class="hljs-string"><span class="hljs-string">"outputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"payable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"stateMutability"</span></span>: <span class="hljs-string"><span class="hljs-string">"view"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"function"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"constant"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"uint256"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"checkSenderBet"</span></span>, <span class="hljs-string"><span class="hljs-string">"outputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"bytes32"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"payable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"stateMutability"</span></span>: <span class="hljs-string"><span class="hljs-string">"view"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"function"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"constant"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"owner"</span></span>, <span class="hljs-string"><span class="hljs-string">"outputs"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"address"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"payable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"stateMutability"</span></span>: <span class="hljs-string"><span class="hljs-string">"view"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"function"</span></span> } ]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> contr = web3.eth.contract(contrInterface); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> contractInstance = contr.at(contrAdress); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> address = web3.eth.defaultAccount; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> block = <span class="hljs-number"><span class="hljs-number">0</span></span>; web3.eth.getBlockNumber( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">er, res</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(res) block = res }); }</code> </pre> <br></div></div><br>  ContractInterface is abi smart contract - a set of function names, variables and arguments for handling and interacting with a smart contract.  If you use remix - ide for working with ethereum smart contracts in the browser, it is easy to find it in the Compite tab -&gt; Details -&gt; Abi. <br><br>  The big problem was, and still partially remains, the determination of the game state at a single point in time, when the page is reloaded or when switching between tables.  Do not forget that we are not working with a server on which such a problem is solved elementarily, but with a blockchain, where to get information from is rather exotic.  We constantly listen to all these 14 game events: the joining of an opponent, the beginning of moves, the completion of moves and others.  We also constantly send requests for some game information, for example, a current score, the start time of the round and others.  Moreover, the majority of game states are determined not by one event, and not by one variable, but by the superposition of several events with some variables at once ‚Äî the results of direct data acquisition from the blockchain.  For example, the situation when the game goes to two or more victories, and when the third round is the time to send private keys.  We have to track that the game has begun, the opponent has connected, three rounds have passed, and the encrypted moves have been sent from both sides.  Try to reload the page at this moment and you have to restore all interconnections with the blockchain.  Each request or receipt of information occurs asynchronously.  Delays overlap one another and as a result, the application runs significantly slower than the server version. <br><br>  But back to the smart contract of our game.  We have already talked about how we store game data, what events we use to interact with the client side, and how we create tables.  Now I would like to describe the encryption of the moves.  We have only three possible options for the move, 1 ‚Äî stone, 2 ‚Äî scissors, 3 ‚Äî paper.  It all starts on the client, when the player chooses his turn.  The script, which works out the choice of the card, generates a random number - we call it seed (hereinafter - Sid).  Sid is stored in cookies in relation to the table number, and is stored until further use in them and in the game session.  For the first time, a seed is used when a player determines his move: choose a stone, scissors, or paper.  The number 1, 2 or 3 is added to it - what the player has chosen.  The result is hashed by the sha3 method.  Important point: the web3.sha3 () method works only with strings.  On the client side, we easily convert the resulting number to a string and then hash it to send it to a smart contract into a bit1 or bit2 variable. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setBet</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">uint id, bytes32 bet</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">public</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(msg.sender == rooms[id].player1 || msg.sender == rooms[id].player2 ); <span class="hljs-comment"><span class="hljs-comment">//   if(rooms[id].startTime + 5 minutes &gt; now) { if(msg.sender == rooms[id].player1) { rooms[id].res2 = 5; rooms[id].bit1 = bet; } else if(msg.sender == rooms[id].player2) { rooms[id].res1 = 5; rooms[id].bit2 = bet; } if(rooms[id].bit1 != 0x0 &amp;&amp; rooms[id].bit2 != 0x0) { SeedOpened(id); BetsFinished(id); } BetsAdd(msg.sender , id); } else { Result(rooms[id].player1, rooms[id].res1, id); Result(rooms[id].player2, rooms[id].res2, id); } }</span></span></code> </pre> <br>  The setBet function provides mainly a guarantee of making moves on both sides.  Until both players make their moves and they are not recorded, the game process cannot continue.  At the same time, it also monitors the observance of timers and carries out the necessary initial checks on the very possibility of making a move.  When the moves are done, the function sends signals to the client: SeedOpened and BetsFinisfed.  Having received these signals, the client offers the players, as we say ‚Äúreveal the cards‚Äù, that is, send the very first part of the number to the smart contact before summing up, which it generated randomly, before hashing the turn.  Confirming his consent to the "disclosure of cards", the player sends this number to another function of the smart contract - setSeed <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setSeed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">uint256 id, uint256 seed</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">public</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>( rooms[id].bit2 != <span class="hljs-number"><span class="hljs-number">0x0</span></span> &amp;&amp; rooms[id].bit1 != <span class="hljs-number"><span class="hljs-number">0x0</span></span> ); <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(msg.sender == rooms[id].player1 || msg.sender == rooms[id].player2 ); <span class="hljs-comment"><span class="hljs-comment">//   if(rooms[id].startTime + 5 minutes &gt; now) { if(msg.sender == rooms[id].player1) decodeHash1(id, seed); else if(msg.sender == rooms[id].player2) decodeHash2(id, seed); } else { Result(rooms[id].player1, rooms[id].res1, id); Result(rooms[id].player2, rooms[id].res2, id); } }</span></span></code> </pre> <br>  Which in turn transfers the received seed to the internal functions of the smart contract decodeHash1 and decodeHash2 <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decodeHash1</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">uint id, uint seed</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">internal</span></span></span><span class="hljs-function"> </span></span>{ uint e1 = seed + <span class="hljs-number"><span class="hljs-number">1</span></span>; bytes32 bitHash1a = keccak256(uintToString(e1)); uint e2 = seed + <span class="hljs-number"><span class="hljs-number">2</span></span>; bytes32 bitHash1b = keccak256(uintToString(e2)); uint e3 = seed + <span class="hljs-number"><span class="hljs-number">3</span></span>; bytes32 bitHash1c = keccak256(uintToString(e3)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rooms[id].bit1 == bitHash1a) rooms[id].res1 = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rooms[id].bit1 == bitHash1b) rooms[id].res1 = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rooms[id].bit1 == bitHash1c) rooms[id].res1 = <span class="hljs-number"><span class="hljs-number">3</span></span>; Result(rooms[id].player1, rooms[id].res1, id); <span class="hljs-comment"><span class="hljs-comment">// return res1; }</span></span></code> </pre> <br>  This ends the encryption cycle.  The function reproduces the hashing procedure already described for the client only inside ethereum, and it does this three times for each player - in three possible moves.  Then, a normal comparison of the hash result in ethereum with the existing hash result from the client occurs.  Compliance makes it clear to us what move the player made.  We do not declare and do not store the keys that come from the players during the disclosure; instead, we immediately write the decoding result in the variables res for each player as a number from 0 to 4. <br><br>  At this stage, there is another interesting nuance.  The standard function solidity keccak256, which corresponds to the sha3 method in the web3 js library, as it turned out, gives an adequate result only when the input is a string, not a number.  Keccak256 allows you to work with numbers, but since on the client web3.sha3 () accepts only strings, keccak256 should also receive a string as an input.  And converting numbers to strings in solidity is not as easy as using javascript.  To do this, you need to write an additional internal function: uintToString ().  The mark ‚Äúpure‚Äù means that this function has no right to influence the state of the memory of a smart contract in any way: read and write.  Here is a nuance. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uintToString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">uint i</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">string</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">// bytes memory bstr = new bytes; if (i == 0) return "0"; uint j = i; uint length; while (j != 0){ length++; j /= 10; } bytes memory bstr = new bytes(length); uint k = length - 1; while (i != 0){ bstr[k--] = byte(48 + i % 10); i /= 10; } return string(bstr); }</span></span></code> </pre> <br>  And finally, the game loop completes the winRes () internal function for determining the winner.  It contains all the possible outcomes of the game, namely - when a draw begins replay of the current round.  Determining the winner of a round or match.  Accordingly, the concept of final and intermediate victory appears.  The function understands situations where one of the players did not have time to take action and counts him a defeat in the current round.  In a situation where both players have been inactive longer than they were set for, the table closes regardless of the current account.  In this case, the game stops and everything returns to its original state. <br><br><div class="spoiler">  <b class="spoiler_title">Summary code</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">winRes</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">uint id</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">internal</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(rooms[id].res1 &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> || rooms[id].res2 &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>); address win = <span class="hljs-number"><span class="hljs-number">0x0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rooms[id].res1 == <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; rooms[id].res2 == <span class="hljs-number"><span class="hljs-number">2</span></span>) win = rooms[id].player1; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rooms[id].res1 == <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; rooms[id].res2 == <span class="hljs-number"><span class="hljs-number">3</span></span>) win = rooms[id].player2; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rooms[id].res1 == <span class="hljs-number"><span class="hljs-number">2</span></span> &amp;&amp; rooms[id].res2 == <span class="hljs-number"><span class="hljs-number">1</span></span>) win = rooms[id].player2; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rooms[id].res1 == <span class="hljs-number"><span class="hljs-number">2</span></span> &amp;&amp; rooms[id].res2 == <span class="hljs-number"><span class="hljs-number">3</span></span>) win = rooms[id].player1; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rooms[id].res1 == <span class="hljs-number"><span class="hljs-number">3</span></span> &amp;&amp; rooms[id].res2 == <span class="hljs-number"><span class="hljs-number">1</span></span>) win = rooms[id].player1; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rooms[id].res1 == <span class="hljs-number"><span class="hljs-number">3</span></span> &amp;&amp; rooms[id].res2 == <span class="hljs-number"><span class="hljs-number">2</span></span>) win = rooms[id].player2; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rooms[id].res1 == <span class="hljs-number"><span class="hljs-number">4</span></span> &amp;&amp; rooms[id].res2 != <span class="hljs-number"><span class="hljs-number">4</span></span> ) win = rooms[id].player2; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rooms[id].res2 == <span class="hljs-number"><span class="hljs-number">4</span></span> &amp;&amp; rooms[id].res1 != <span class="hljs-number"><span class="hljs-number">4</span></span> ) win = rooms[id].player1; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rooms[id].res1 == <span class="hljs-number"><span class="hljs-number">5</span></span> &amp;&amp; rooms[id].res2 != <span class="hljs-number"><span class="hljs-number">5</span></span> ) win = rooms[id].player2; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rooms[id].res2 == <span class="hljs-number"><span class="hljs-number">5</span></span> &amp;&amp; rooms[id].res1 != <span class="hljs-number"><span class="hljs-number">5</span></span> ) win = rooms[id].player1; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>((rooms[id].res2 == <span class="hljs-number"><span class="hljs-number">4</span></span> &amp;&amp; rooms[id].res1 == <span class="hljs-number"><span class="hljs-number">4</span></span> ) || (rooms[id].res2 == <span class="hljs-number"><span class="hljs-number">5</span></span> &amp;&amp; rooms[id].res1 == <span class="hljs-number"><span class="hljs-number">5</span></span> )) revertRoom(id); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">// -    if(win == 0x0) { replay(id); OneMoreGame(id); } else { //   if( win == rooms[id].player1 ) rooms[id].c1 += 1; if( win == rooms[id].player2 ) rooms[id].c2 += 1; //    n-      if( rooms[id].counter &gt; 1 &amp;&amp; rooms[id].c1 &lt; rooms[id].counter &amp;&amp; rooms[id].c2 &lt; rooms[id].counter ) { ScoreChanged(id, rooms[id].c1, rooms[id].c2); replay(id); OneMoreGame(id); } else { //          ScoreChanged(id, rooms[id].c1, rooms[id].c2); if( rooms[id].bet &gt; 0 ) { rewardWin(win, id); } Winner(win, id); closeRoom(id); } } } }</span></span></code> </pre> <br></div></div><br>  The game's algorithm was created from scratch, so this option is a successful result of a series of experiments and adjustments.  It is difficult to say how effective and optimal it is, because we can only compare it with ourselves.  Regarding the previous 4 versions of our algorithm, this one is several times more efficient.  There are probably many more possible solutions for optimization, but this is already a matter of the future. </div><p>Source: <a href="https://habr.com/ru/post/358772/">https://habr.com/ru/post/358772/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../358762/index.html">Development of Clickhouse API for Rambler / Top-100</a></li>
<li><a href="../358764/index.html">Fintech-digest: blockchain-smartphone from HTC, determination of solvency by phone brand and regulation of ICO in Russia</a></li>
<li><a href="../358766/index.html">How I started to love Vue</a></li>
<li><a href="../358768/index.html">Month after blocking Telegram: what has changed?</a></li>
<li><a href="../358770/index.html">How to pack three large banks in one site</a></li>
<li><a href="../358774/index.html">Docker under Windows for development, analysis of reefs</a></li>
<li><a href="../358776/index.html">Move to the cloud: how LDAP helps implement virtual PBX</a></li>
<li><a href="../358778/index.html">GeekBrains opens a set of free programmer training courses.</a></li>
<li><a href="../358780/index.html">Overview of popular AR frameworks</a></li>
<li><a href="../358782/index.html">Chinese government introduces artificial intelligence into high school curriculum</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>