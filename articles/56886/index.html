<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Squid for the smallest. Part 3 Statistics</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Everyone who raises a proxy, then wants to see who uses it, who shakes so much. And sometimes it is very useful to view in real time who shakes what. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Squid for the smallest. Part 3 Statistics</h1><div class="post__text post__text-html js-mediator-article">  Everyone who raises a proxy, then wants to see who uses it, who shakes so much.  And sometimes it is very useful to view in real time who shakes what.  In this topic will be considered the following programs: <br>  <b><a href="http://samm.kiev.ua/sqstat/">SqStat</a></b> - Real Time statistics via web <br>  <b><a href="http://sarg.sourceforge.net/">Sarg</a></b> - Squid log analyzer with subsequent HTML generation <br>  <b><a href="http://www.rillion.net/squidview/">SquidView</a></b> - Interactive console log monitor Squid <br><a name="habracut"></a><br><br><h4>  0. Introduction </h4><br><br>  I will not tell here how to configure Apache.  In the internet there are so many manuals on this topic, so go ahead and with the song, I will talk about the features that I have implemented. <br>  Yes, I‚Äôll tell on the example of Debian Etch, your paths may differ, keep in mind ... <br>  Go‚Ä¶ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  1. <b>SquidView</b> </h4><br><br>  This program works in the console, and displays everything Squid does there. <br>  Installation: <br><br> <code>aptitude install squidview <br></code> <br>  Let's wait a couple of seconds if you have fast internet.  Everything, now we can look who that shakes.  If you did not change the location of the logs, and left most of the squid parameters defaulted, then you only need to run it to view, but with root rights, because the squid logs are written to them ... <br><br> <code>sudo squidview</code> <br> <br>  I think that this is quite enough for you, but I will also tell you very useful things, you need to press the buttons, and watch: <br><ul><li>  h - help, here we can learn even more;) </li><li>  l - enter - report generation, you can also configure advanced settings </li><li>  T - starts accounting statistics on the size of the downloaded </li><li>  O - viewing who shook by users, after T </li></ul><br><br>  By SquidView, everything seems to be, if something is not told, write, add! <br><br><h4>  2. <b>SqStat</b> </h4><br><br><img src="https://habrastorage.org/getpro/habr/post_images/8ca/237/4b2/8ca2374b24e04db0bae43a5a59a94071.png" width="92" height="87" alt="Screenshot"><br><br>  This is a script that allows you to watch active connections, channel load, and average channel load. <br>  I assume that you already have an apache. <br>  Download the latest version, <br><br> <code><a href=""></a> wget -c samm.kiev.ua/sqstat/sqstat-1.20.tar.gz <br> tar xvfz sqstat-1.20.tar.gz <br> cd ./sqstat-1.20 <br> mkdir /var/www/squid-stat <br> cp -R * /var/www/squid-stat* <br></code> <br>  Everything, now we need to configure Squid-cgi or cachemgr.cgi, We put: <br> <code>aptitude install squid-cgi</code> <br> <br>  Now you need to configure access ... <br><br> <code>nano /etc/squid/squid.conf <br></code> <br>  Add <br> <code>acl manager proto cache_object <br> http_access allow manager localhost <br> http_access deny manager <br> #    secret     <br> cachemgr_passwd secret all <br></code> <br><br>  Now you need to fix /etc/squid/cachemgr.conf <br> <code>echo "*" &gt;&gt; /etc/squid/cachemgr.conf</code> <br>  Instead of * you can put the network address that squid listens on <br><br>  Here vrodeby and all! <br><br>  <a href="http://localhost/cgi-bin/cachemgr.cgi">http: //localhost/cgi-bin/cachemgr.cgi</a> <br><br>  For some reason, I could not start at the address 127.0.0.1 and entered 192.168.0.1 and it all worked.  Now you need to enter the external network address in the Cache Host field.  What is your port, in the login field, if you did everything on the manual, you can not drive anything, and in the password field write the secret.  If everything went well, then you will see a list of available parameters ... You can see, and we are going to configure SqStat ... <br><br> <code>nano /var/www/squid-stat/config.inc.php <br> //       <br> $squidhost[0]="192.168.0.1"; <br> $squidport[0]=3128; <br> $cachemgr_passwd[0]="secret"; <br> //         <br> $resolveip[0]=false; <br> //       ,    :) <br> $hosts_file[0]="hosts"; <br> $group_by[0]="host";</code> <br> <br>  In principle, the config itself is well documented, study, since there is nothing to learn there)) <br><br>  Now we do a subdomain, so much more convenient) <br><br> <code>nano /etc/apache2/sites-enabled/sqstat <br> &lt;VirtualHost squid.server.local:80&gt; <br> ServerAdmin squid@gmail.com <br> DocumentRoot /var/www/squid-stat/ <br> ServerName proxy.server.local <br></code> <br><br><br>  For rezolving write in / etc / hosts <br><br> <code>nano /etc/hosts <br> 192.168.0.1 proxy.server.local</code> <br> <br>  That's all :) almost all <br><br> <code>squid -k reconfigure <br> /etc/init.d/apache2 reload</code> <br> <br><h4>  3. <b>Sarg</b> </h4><br><br>  This program generates html reports, draws graphics, and so on ... <br>  We put: <br><br> <code>aptitude install sarg</code> <br> <br> <code>nano /etc/squid/sarg.conf <br> language Russian_koi8 <br> graphs yes <br> title "Squid User Access Reports" <br> temporary_dir /tmp <br> output_dir /var/www/sarg <br> max_elapsed 28800000 <br> charset Koi8-r</code> <br> <br>  Of course, no one forbids you to indulge in the style of displaying the entire economy - the config is provided with very detailed comments. <br><br> <code>crontab -u root -e <br> * 08-18/1 * * * /usr/sbin/sarg-reports today <br> * 00 * * * /usr/sbin/sarg-reports daily <br> * 01 * * 1 /usr/sbin/sarg-reports weekly <br> * 02 1 * * /usr/sbin/sarg-reports monthly</code> <br> <br><h4>  <b>Epilogue</b> </h4><br><br>  Everything :)) If you want, you can create a subdomain for it!  This is already described ... <br>  I myself use all three programs and am satisfied. <br><br>  <b>UPD.</b>  To solve the problem with skivdom 3rd version, you need to make a soft link: <br><br> <code>ln -s /var/log/squid3/access.log /root/.squidview/log1</code> <br> <br>  <b>UPD.2.</b>  The next article will talk about <i>delay pools</i> <br>  <a href="http://bkmz.org/47/squid-dlya-samh-malenykih-tchasty-3-statistik">Crosspost</a> from my blog </div><p>Source: <a href="https://habr.com/ru/post/56886/">https://habr.com/ru/post/56886/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../56879/index.html">Neverending story</a></li>
<li><a href="../56881/index.html">Google Chrome and Linux</a></li>
<li><a href="../56882/index.html">Railways: Unpleasant surprises</a></li>
<li><a href="../56883/index.html">Mysql Documentor - A simple utility for documenting Mysql 5+ databases.</a></li>
<li><a href="../56885/index.html">And again about Juick: Q & A</a></li>
<li><a href="../56887/index.html">How Opera ‚Äúrepairs‚Äù websites</a></li>
<li><a href="../56888/index.html">aTunes cross-platform player</a></li>
<li><a href="../56889/index.html">Google added fullscreen view street view</a></li>
<li><a href="../56891/index.html">Visual deflation guide</a></li>
<li><a href="../56895/index.html">Apple Push Notification Service is available for testing ... today!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>