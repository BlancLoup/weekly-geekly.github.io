<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Django tips & tricks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings 

 In this post - small tips on working with Django, which can be useful for novice developers. How I would like to know this at the beginni...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Django tips & tricks</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/868/4b1/62f/8684b162fdd64cb645ea328236a80bb9.png" align="right">  Greetings <br><br>  In this post - small tips on working with Django, which can be useful for novice developers.  How I would like to know this at the beginning of my journey of mastering Django! .. <br>  These tips should be viewed with criticism.  I would be glad if you find inaccuracies / the best solution, or offer your "chips" for django, which are not in the documentation. <br><br>  So, let's start from afar, and then move on to the details. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br><img src="https://habrastorage.org/getpro/habr/post_images/998/b99/20d/998b9920d41aa31697dc2f7586058014.png" alt="venv" align="right"><br><h4>  Virtual environment </h4><br>  If you are not using <a href="http://virtualenv.readthedocs.org/">virtualenv</a> for your django application, be sure to try. <br><br>  If you're already using virtualenv, then answer if you need --no-site-packages.  This flag is enabled by default and is used when creating a virtual environment.  When the ‚Äúinside‚Äù program flag is turned on, the environment will not see the ‚Äúoutside‚Äù program.  If you put any package globally with your package manager, for example, python2-django, then you will have to do pip install django ‚Äúinside‚Äù the environment. <br><div class="spoiler">  <b class="spoiler_title">Why would you need globally installed packages?</b> <div class="spoiler_text">  I ran into this when I set up a search engine on xapian.  Xapian comes in the delivery of xapian-core (written in C ++) and xapian-bindings (binding for various PLs, including python).  It is logical to update them at the same time - if the engine has changed, then the binding must be updated.  Therefore, to install xapian-core globally as a package manager, and the pip binding does not fix it (besides, they are not in the pip).  Output 2: <br><ol><li>  Create a trash bin inside virtualenv: ./configure --prefix = / path / to / virtualenv &amp;&amp; <a href="http://habrahabr.ru/post/130868/">make &amp;&amp; make install</a> </li><li>  Make global packages visible from the outside and update them with the package distribution manager, which I chose </li></ol><br>  Generally, when the module is written on pure python, there are no problems - install via pip in virtualenv.  If a module is a mixture of, say, c ++ and python, magic begins. <br></div></div><br>  The visibility / invisibility of global programs from virtualenv is set to be absent / by the presence of the [virtualenv] / lib / python *. * / No-global-site-packages.txt file.  Just like that. <br><br>  By the way, I recommend everyone to the article about the ‚Äúisolation‚Äù of virtualenv: <a href="http://pythonrants.wordpress.com/2013/12/06/why-i-hate-virtualenv-and-pip/">Why I hate virtualenv and pip</a> (the site slows down, could only be opened via <a href="http://pythonrants.wordpress.com/2013/12/06/why-i-hate-virtualenv-and-pip/">web.archive.org</a> ).  It examines how virtualenv is truly isolated from the ‚Äúexternal‚Äù environment - in short, it is only partial isolation. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f8e/d89/574/f8ed89574482145ec2cea2b575753af2.png" align="right"><br><h4>  ipython </h4><br>  Pip install <a href="http://ipython.org/">ipython</a> will replace the standard Python shell with an advanced one, with coloring, autocompletion, introspection, convenient multi-line input, copy-tagging, etc.  Django automatically picks up ipython if it is installed. <br>  By the way, all the listed advantages can be used not only in the ./manage.py shell, but also in debugging, causing debugging with the help of import <b>i</b> pdb;  <b>i</b> pdb.set_trace (). <br><br><h4>  Project structure </h4><br>  Django, by default, creates the necessary directories when creating a project or application.  But you yourself need to think. <br><br><h5>  As the project you name, and you will import </h5><br>  Call your project project (django-admin.py startproject project) - well, or by a different, but the same name for all projects.  Previously, I called projects according to the domain, but when re-using applications in other projects, I had to change the import paths - then from supersite import utils, then from newsite import utils.  It confuses and distracts.  If you expand this advice - fix (unify) for yourself the directory structure of all your projects and strictly adhere to it. <br><br>  Living example: <br><pre><code class="python hljs">--site.ru |--static |--media |--project (  ) |--manage.py |--project (   ) | |--settings.py | |--urls.py | |-- ... |--app1 |--app2 |--...</code> </pre> <br><br><h5>  Where to save html-templates </h5><br>  Never, <b>never</b> throw templates (.html) into the templates folder of your application.  Always create an additional directory with the same name as the application. <br>  This is bad, because  creates a template collision, for example, with {% include 'main.html'%}: <br><pre> <code class="hljs">/gallery/templates/main.html /reviews/templates/main.html</code> </pre><br>  This is good, you can use {% include 'reviews / main.html'%}: <br><pre> <code class="hljs">/gallery/templates/gallery/main.html /reviews/templates/reviews/main.html</code> </pre><br><br><h5>  {% include%} </h5><br>  By the way, if you use {% include 'some_template.html'%}, then it is likely that something is wrong.  Why? <br>  Example: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">view</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> render( request, <span class="hljs-string"><span class="hljs-string">'master.html'</span></span>, {<span class="hljs-string"><span class="hljs-string">'var'</span></span>: <span class="hljs-string"><span class="hljs-string">'Some text'</span></span>} }</code> </pre><br><pre> <code class="html hljs xml"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- master.html --&gt;</span></span> Value of variable var: {{ var }}. {% include 'slave.html' %} <span class="hljs-comment"><span class="hljs-comment">&lt;!-- slave.html --&gt;</span></span> Again, value of variable var: {{ var }}.</code> </pre><br><br>  1) KISS rides a forest.  On the one hand, the page code is divided into several - master.html and the connected slave.html, and it is convenient for splitting large html-pages into parts.  But in this case, the var variable is passed to the slave.html template implicitly - var is transferred to master.html, and slave.html simply ‚Äúclings‚Äù to the master context.  Thus, we see that the pattern inside {% include%} depends on the context of the main pattern.  We have to keep track of the context of the parent template, otherwise something wrong could get into the child. <br>  2) According to my observations, {% include%} expensive in terms of rendering.  Better to avoid it. <br><br>  What to do?  If you really want to include some templates in others - use inclusion tags (read about them below).  But easier - just write everything in one file: <br><pre> <code class="html hljs xml"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- master.html --&gt;</span></span> Value of variable var: {{ var }}. Again, value of variable var: {{ var }}.</code> </pre><br><br><h5>  settings.py </h5><br>  You do not have two different settings.py on the test and deployment servers, right? <br>  Create additional local_settings.py and deployment_settings.py, where throw off everything that applies only to the corresponding server. <br><div class="spoiler">  <b class="spoiler_title">Here, for example, that it is logical to set in local_settings.py</b> <div class="spoiler_text"><pre> <code class="python hljs">DEBUG = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> DOMAIN = <span class="hljs-string"><span class="hljs-string">'127.0.0.1:8000'</span></span> ALLOWED_HOSTS = [<span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span>, DOMAIN] SERVER_EMAIL = <span class="hljs-string"><span class="hljs-string">'mail@test.ru'</span></span> EMAIL_HOST = <span class="hljs-string"><span class="hljs-string">'localhost'</span></span> EMAIL_PORT = <span class="hljs-number"><span class="hljs-number">1025</span></span> EMAIL_HOST_USER = <span class="hljs-string"><span class="hljs-string">''</span></span> EMAIL_HOST_PASSWORD = <span class="hljs-string"><span class="hljs-string">''</span></span> EMAIL_USE_TLS = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> EMAIL_SUBJECT_PREFIX = <span class="hljs-string"><span class="hljs-string">'['</span></span> + DOMAIN + <span class="hljs-string"><span class="hljs-string">'] '</span></span> DEFAULT_FROM_EMAIL = <span class="hljs-string"><span class="hljs-string">'mail@test.ru'</span></span> DATABASES = { <span class="hljs-string"><span class="hljs-string">'default'</span></span>: { <span class="hljs-string"><span class="hljs-string">'ENGINE'</span></span>: <span class="hljs-string"><span class="hljs-string">'django.db.backends.postgresql_psycopg2'</span></span>, <span class="hljs-string"><span class="hljs-string">'NAME'</span></span>: <span class="hljs-string"><span class="hljs-string">'test'</span></span>, <span class="hljs-string"><span class="hljs-string">'USER'</span></span>: <span class="hljs-string"><span class="hljs-string">'test'</span></span>, <span class="hljs-string"><span class="hljs-string">'PASSWORD'</span></span>: <span class="hljs-string"><span class="hljs-string">'test'</span></span>, <span class="hljs-string"><span class="hljs-string">'HOST'</span></span>: <span class="hljs-string"><span class="hljs-string">'localhost'</span></span>, <span class="hljs-string"><span class="hljs-string">'PORT'</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'ATOMIC_REQUESTS'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, } } CACHES = { <span class="hljs-string"><span class="hljs-string">'default'</span></span>: { <span class="hljs-string"><span class="hljs-string">'BACKEND'</span></span>: <span class="hljs-string"><span class="hljs-string">'django.core.cache.backends.dummy.DummyCache'</span></span>, } }</code> </pre><br></div></div><br><br>  In settings.py we write at the beginning: <br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># Load local settings if available try: from local_settings import * except ImportError: from deployment_settings import *</span></span></code> </pre><br>  Accordingly, delete the local_settings.py.  So that it does not interfere, you can add it to .gitignore. <br><br><h5>  Project root </h5><br>  Set the project root in settings.py - this will make life easier later: <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> path BASE = path.dirname(path.dirname(path.dirname(path.abspath(__file__)))) MEDIA_ROOT = BASE + <span class="hljs-string"><span class="hljs-string">'/media/'</span></span> STATIC_ROOT = BASE + <span class="hljs-string"><span class="hljs-string">'/static/'</span></span></code> </pre><br><br><h4>  Contextual processors (context_processors.py), {% include%} and inclusion tags </h4><br>  Use contextual processors only if you need to add variables to the context of <b>each page of the site</b> - because contextual processors will be invoked for any page, even if you do not use their results.  Personally, I use them to transfer the phone number to the template context - this number is actually displayed on every page, and not once.  Another example is the site menu.  I registered the headers and links in the context processor, and if I need to add a new section in the menu - I just add it to the context processor, and it will automatically be added everywhere on the site. <br><br>  There is one mistake - the use of contextual processors for widgets.  For example, you have a news column on your site that is always displayed, i.e.  on every page.  It would seem to create news / context_processors.py and add the news variable with news to the context, and in the {% include 'news / news_widget.html'%} template, or even {% load news_widget%} {% news_widget news}} ... <br><br>  It works, but it is littering the context and, besides, who knows if you will always have this column.  There is a way - use the <a href="https://docs.djangoproject.com/en/1.6/howto/custom-template-tags/">inclusion tag</a> .  You simply write in the template {% news%}, and already this templatetag searches for news and inserts a news column.  And it works only when you actually launch it - i.e.  write {% news%} in the template. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/871/644/51e/87164451efd98e7a5c0e7d183f28ef55.jpg" align="right"><br><h4>  Batteries </h4><br><h5>  django-debug-toolbar-template-timings </h5><br>  Everyone knows him and probably uses him.  But there is a <a href="">django-debug-toolbar-template-timings</a> plugin for debug toolbar that measures the rendering time of templates.  And given that the django templates are quite ‚Äúexpensive‚Äù (they are rendered for a long time), then to speed up the site this plugin is what the doctor ordered. <br><br><h5>  adv_cache_tag </h5><br>  <a href="https://github.com/twidi/django-adv-cache-tag">django-adv-cache-tag</a> allows you to manage caching in templates in a very flexible way - versioning, compression, partial caching.  Just rate: <br><pre> <code class="html hljs xml">{% load adv_cache %} {% cache 0 object_cache_name object.pk obj.date_last_updated %} <span class="hljs-comment"><span class="hljs-comment">&lt;!--   ,     obj.date_last_updated --&gt;</span></span> {{ obj }} {% nocache %} {{ now }} <span class="hljs-comment"><span class="hljs-comment">&lt;!--      --&gt;</span></span> {% endnocache %} {{ obj.date_last_updated }} {% endcache %}</code> </pre><br><br><h5>  django-mail-templated </h5><br>  Email templates are what django lacks.  <a href="https://github.com/artemrizhov/django-mail-templated">django-mail-templated</a> <br><br><h5>  django-ipware </h5><br>  <a href="https://github.com/un33k/django-ipware">django-ipware</a> will determine the user's ip for you, and make it better. <br><div class="spoiler">  <b class="spoiler_title">You know where to get the ip user?</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">'HTTP_X_FORWARDED_FOR'</span></span>, <span class="hljs-comment"><span class="hljs-comment"># client, proxy1, proxy2 'HTTP_CLIENT_IP', 'HTTP_X_REAL_IP', 'HTTP_X_FORWARDED', 'HTTP_X_CLUSTER_CLIENT_IP', 'HTTP_FORWARDED_FOR', 'HTTP_FORWARDED', 'HTTP_VIA', 'REMOTE_ADDR',</span></span></code> </pre><br></div></div><br><br><h5>  Beautiful soup </h5><br>  Do not write your html parser.  Do not parse html yourself.  <a href="http://www.crummy.com/software/BeautifulSoup/">Everything is already there.</a> <br><br><h4>  Templatetags that may come in handy </h4><br><h5>  add_class </h5><br>  If you create a form and want to set a style, class or placeholder for each input, then django will force you to violate the principles and write all styles directly in forms.py: <br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeForm</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(ModelForm)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> model = SomeModel fields = (<span class="hljs-string"><span class="hljs-string">'field1'</span></span>, <span class="hljs-string"><span class="hljs-string">'field2'</span></span>) widgets = { <span class="hljs-string"><span class="hljs-string">'field1'</span></span>: Textarea(attrs={<span class="hljs-string"><span class="hljs-string">'rows'</span></span>: <span class="hljs-string"><span class="hljs-string">'2'</span></span>, <span class="hljs-string"><span class="hljs-string">'class'</span></span>: <span class="hljs-string"><span class="hljs-string">'field1_class'</span></span>}), }</code> </pre><br>  Every time I get messed up when seeing html text not in .html files.  This violates the MVT architecture.  Therefore, I created a filter for myself: <br><pre> <code class="html hljs xml">{% load add_class %} {{ form.field1|add_class:'field1_class' }}</code> </pre><br>  This filter adds a class to the tags, but you can rewrite and add any property. <br><div class="spoiler">  <b class="spoiler_title">Code add_class.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> template <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.utils.safestring <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mark_safe <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> bs4 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BeautifulSoup register = template.Library() @register.filter <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add_class</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(html, css_class)</span></span></span><span class="hljs-function">:</span></span> soup = BeautifulSoup(unicode(html), <span class="hljs-string"><span class="hljs-string">'html.parser'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> tag <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> soup.children: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> tag.name != <span class="hljs-string"><span class="hljs-string">'script'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">'class'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> tag: tag[<span class="hljs-string"><span class="hljs-string">'class'</span></span>].append(css_class) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: tag[<span class="hljs-string"><span class="hljs-string">'class'</span></span>] = [css_class] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mark_safe(soup.renderContents())</code> </pre><br></div></div><br><br><h5>  is_current_page </h5><br>  Sometimes you need to display something in a template if a particular page is open.  For example, highlight the "store" button in the menu if the user is now in the store section.  I suggest the following option: <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> template <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.core.urlresolvers <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> resolve <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> project.utils <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> parse_args register = template.Library() @register.filter <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_current_page</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request, param)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> resolve(request.path).view_name == param</code> </pre><br>  This is a filter, not a tag, and the reason is the same: you can build absolutely wildest constructions with {% if%}.  For example, if the current page is a product card, and the user is authorized: <br><pre> <code class="html hljs xml">{% if request|is_current_page:'shop/product' and user.is_authenticated %}</code> </pre><br>  There is an alternative, more accurate, implementation in which arguments (args or kwargs) are used to determine the exact page (i.e., not just ‚Äúthe page of a product‚Äù, but ‚Äúthe page of the product with id = 36‚Äù): <br><pre> <code class="html hljs xml">{% if request|is_current_page:'shop/product,id=36' %}</code> </pre><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@register.filter def is_current_page(request, param): params = param.split(',') name = params[0] args, kwargs = parse_args(params[1:]) # Do not mix args and kwargs in reverse() - it is forbidden! if args: return request.path == reverse(name, args=args) elif kwargs: return request.path == reverse(name, kwargs=kwargs) else: return request.path == reverse(name)</span></span></code> </pre><br><br><img src="https://habrastorage.org/getpro/habr/post_images/bc6/a59/13d/bc6a5913dd401f48a545de54669c812e.jpg" align="right"><br><h4>  Models </h4><br><h5>  Empty </h5><br>  Models may be empty.  Like this: <br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Phrase</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(models.Model)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PhraseRu</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(models.Model)</span></span></span><span class="hljs-class">:</span></span> phrase = models.ForeignKey(Phrase, verbose_name=<span class="hljs-string"><span class="hljs-string">''</span></span>, related_name=<span class="hljs-string"><span class="hljs-string">'ru'</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PhraseEn</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(models.Model)</span></span></span><span class="hljs-class">:</span></span> phrase = models.ForeignKey(Phrase, verbose_name=<span class="hljs-string"><span class="hljs-string">''</span></span>, related_name=<span class="hljs-string"><span class="hljs-string">'en'</span></span>)</code> </pre><br>  In this case, Phrase is the link between PhraseEn and PhraseRu, although it contains nothing in itself.  It is useful when the two models are equivalent, and they need to be connected into a single whole. <br><br><h5>  Generic relation mixin </h5><br>  GenericRelation objects are always returned by the QuerySet, even if we have, we know for sure that there is only one object: <br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Token</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(models.Model)</span></span></span><span class="hljs-class">:</span></span> content_type = models.ForeignKey(ContentType) object_id = models.PositiveIntegerField() content_object = generic.GenericForeignKey() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Registration</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(models.Model)</span></span></span><span class="hljs-class">:</span></span> tokens = generic.GenericRelation(Token)</code> </pre><br>  If you need to access the token, we write registration.tokens.first ().  But we know that the token is one, and we want to write just registration.token and get the coveted token right away.  This is possible using mixin: <br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Token</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(models.Model)</span></span></span><span class="hljs-class">:</span></span> content_type = models.ForeignKey(ContentType) object_id = models.PositiveIntegerField() content_object = generic.GenericForeignKey() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TokenMixin</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> @property <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">token</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> content_type = ContentType.objects.get_for_model(self.__class__) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Token.objects.get(content_type__pk=content_type.pk, object_id=self.id) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Token.DoesNotExist: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Registration</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(models.Model, TokenMixin)</span></span></span><span class="hljs-class">:</span></span> tokens = generic.GenericRelation(Token)</code> </pre><br><br>  Now registration.token works! <br><br><h5>  get_absolute_url </h5><br><br>  Try not to write {% url 'shop / product' id = product.id%}. <br>  Better for each model, set the get_absolute_url () method, and use {{object.get_absolute_url}}.  At the same time, the ‚Äúwatch on site‚Äù link will appear in the admin panel. <br><br><h5>  pre_save </h5><br>  In pre_save, you can see if the model changes after saving or not.  Price - request to the database to get the old record from the database. <br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@receiver(pre_save, sender=SomeModel) def process_signal(sender, instance, **kwargs): old_model = get_object_or_None(SomeModel, pk=instance.pk) if not old_model: # Created old_value = None ... else: old_value = old_model.field new_value = instance.field if new_value != old_value: # field changed!</span></span></code> </pre><br><br><h4>  Forms </h4><br>  This pattern was already on Habr√©, but it is too good not to mention it. <br><pre> <code class="python hljs">form = SomeForm(request.POST <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> form.is_valid(): <span class="hljs-comment"><span class="hljs-comment"># ... actions ... return HttpResponseRedirect(...) return render( request, {'form': form} )</span></span></code> </pre><br><br>  That's all.  Thanks for attention. <br><br>  <b>UPD.</b>  As usual on Habr√©, in the comments, habrazhiteli expressed their opinions and offered a bunch of great ideas, additions and comments to the article.  I did not include them in the article, but instead I strongly recommend that you read the comments on the article. </div><p>Source: <a href="https://habr.com/ru/post/224011/">https://habr.com/ru/post/224011/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../2240/index.html">Russian books will go to the World Digital Library</a></li>
<li><a href="../224001/index.html">Installing Alfresco Community 4.2.f on the Jelasctic.com cloud service</a></li>
<li><a href="../224003/index.html">Order-Independent Transparency algorithm using link lists on Direct3D 11 and OpenGL 4</a></li>
<li><a href="../224005/index.html">Cube iWork10 - a tablet on a full Windows 8.1 Pro</a></li>
<li><a href="../22401/index.html">Mail Trends: Gmail's visual email analysis</a></li>
<li><a href="../224017/index.html">Introduced an updated collection of Metro 2033 and Metro: Last Light on Linux, Windows and new consoles</a></li>
<li><a href="../224023/index.html">IT guy on vacation: what about the telescope?</a></li>
<li><a href="../224025/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ110 (May 18 - 24, 2014)</a></li>
<li><a href="../224027/index.html">Steam Files. Part 1 - GCF / NCF</a></li>
<li><a href="../224029/index.html">The secret of the ancient game of go. Why has the computer still not beat the man?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>