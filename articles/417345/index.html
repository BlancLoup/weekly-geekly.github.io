<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Threat Hunting with the new Cisco Visibility solution</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Imagine that you have read an article in Kommersant that the Internet has found itself in the public domain a complete package for attacks on Pegasus ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Threat Hunting with the new Cisco Visibility solution</h1><div class="post__text post__text-html js-mediator-article">  Imagine that you have <a href="https://www.kommersant.ru/doc/3687343">read</a> an article in Kommersant that the Internet has found itself in the public domain a complete package for attacks on Pegasus banks.  You will probably want to find out if you are hit and whether there is a malicious code in your network.  On the one hand, you have a lot of logs and security events from various protection tools, and on the other hand, you may receive information about threats as part of a subscription to any paid or free Threat Intelligence service (for example, from BI.ZONE, GosSOPKI or FinCERT).  On the one hand, you have a lot of data to analyze, but you don‚Äôt know if they contain traces of what you are looking for.  On the other hand, you have information about traces (that is, indicators of compromise), but you do not know how they apply to you.  You need to combine these two data sets by implementing what is commonly called Threat Hunting or the search for traces of attacks in your infrastructure.  Let's take a look at how you can automate this task with the help of the recently released free Cisco Visibility solution. <br><br><img src="https://habrastorage.org/webt/ri/tn/jd/ritnjduwd50csjcb8tqkx-gxzqk.png" alt="image"><a name="habracut"></a><br><br>  You do not know where to start?  Where to look for traces of the threat that interests you?  Here is a clean slate and in Cisco Visibility it looks like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/hz/ql/ie/hzqlieayft079i9gry1wg5jmjzw.png" alt="image"><br><br>  In this window you load everything that you will search.  Let's take TeslaCrypt as an example coder (in real life, instead of TeslaCrypt, you‚Äôll expose any other threat whose traces you will need to find or prove its absence for the duration of Threat Hunting).  First you need to put together all the indicators of compromise for what you use the existing services of Threat Intelligence.  For example, you take TeslaCrypt data from <a href="https://blogs.cisco.com/security/talos/teslacrypt">the Cisco Talos blog</a> .  There are 9 indicators in front of you - IP addresses, hashes of files of malicious programs and domains with which the deployed cryptographer contacts to receive additional commands and pay for ransom in cryptocurrency.  You download all these indicators to Cisco Visibility: <br><br><img src="https://habrastorage.org/webt/sq/vr/v1/sqvrv1qyfiqbw6jiwvlamctaxlg.png" alt="image"><br><br>  Here it is necessary to make a small digression.  Cisco Visibility now works with data from Cisco AMP for Endpoints, that is, with an EDR (Endpoint Detection and Response) class solution, which is installed on personal and mobile computers running Windows, Linux, MacOS, Android, iOS.  Therefore, Threat Hunting with the help of Cisco Visibility is carried out now on end devices, which in 70% are targeted by intruders. <br><br><img src="https://habrastorage.org/webt/km/fw/iu/kmfwiu5ky9hdr11hrqxiuwrpsao.png" alt="image"><br><br>  What do we see after loading indicators in Cisco Visibility?  The main screen area is occupied by the relationship graph, which reflects interactions between indicators of compromise, security events that are collected from the customer's infrastructure, and the external environment.  You can scale the picture to get a general idea of ‚Äã‚Äãthe picture of what is happening. <br><br><img src="https://habrastorage.org/webt/ad/kz/kk/adkzkkzagihootdjg2_kalsyabe.png" alt="image"><br><br>  Above the interaction graph is a panel that displays a summary of all points of interest to us: <br><br><ul><li>  Goals or sacrifices.  Clicking on this field, you will immediately receive a list of all the nodes on your network, which found the tracks you are looking for.  This is exactly what you need in order to understand the scale of the disaster and how much you have suffered.  If no nodes are shown here, then you have no nodes participating in the attack. </li><li>  Traces.  Clicking on this field, you will receive a list of traces that you are looking for, with color highlighting, reflecting the fact that these traces are found in Cisco Threat Intelligence databases. </li><li>  Indicators.  Clicking on this field, you will see the behavioral patterns that were found in your infrastructure, corresponding to the desired tracks. </li><li>  Domains, hashes, IP addresses and URLs.  These fields show the corresponding traces. </li><li>  Modules.  This menu item reflects the list of modules with the help of which data enrichment and detection of attack traces took place.  There are several such modules and they include both Cisco solutions (for example, Cisco ThreatGrid, Cisco Umbrella, Cisco AMP Global Intelligence, Talos Intelligence) and third-party solutions (for example, VirusTotal).  The list of these modules will be expanded. </li></ul><br><br><img src="https://habrastorage.org/webt/2c/gc/d_/2cgcd_-ebsbncdvvjipkwvorxny.png" alt="image"><br><br>  Considering that AMP4E agents can be installed on hundreds or thousands of computers, we are not interested in all of them, but only those who ‚Äúgot under the distribution‚Äù (if they did, of course).  Clicking on the field "Target" (Target), we get a list of those nodes where traces of the threat were found.  In our case, this is just one node. <br><br><img src="https://habrastorage.org/webt/xb/dy/ir/xbdyirqf-1ga43virsmb8i9rbmk.png" alt="image"><br><br>  By clicking on the name of this node, we immediately get the area of ‚Äã‚Äãthe interaction graph, which reflects all the connections between the traces of interest and the compromised node. <br><br><img src="https://habrastorage.org/webt/4g/kh/yb/4gkhybixr3knbccch9sy-3eq7ro.png" alt="image"><br><br>  It is immediately obvious that only a small part of the infrastructure was damaged, on which one can concentrate. <br><br><img src="https://habrastorage.org/webt/ri/tn/jd/ritnjduwd50csjcb8tqkx-gxzqk.png" alt="image"><br><br>  The traces found were enriched using various modules, including third-party solutions (in this case, VirusTotal).  This allows us to be more confident in the results of the analysis, as confirmation of the traces found was obtained from various sources of Threat Intelligence.  In this case, the investigation was enriched with TI data from 5 sources: <br><br><img src="https://habrastorage.org/webt/al/y5/rm/aly5rmv0lqhgzsn6wajemvfymvu.png" alt="image"><br><br>  There are quite a few indicators of compromise, that is, behavioral patterns, applied to the sought tracks (19): <br><br><img src="https://habrastorage.org/webt/md/px/07/mdpx07llwqdd8bbajl2djtijqom.png" alt="image"><br><br>  The Sightings Timeline screen area shows us a timeline reflecting two important questions ‚Äî when found traces were found in our local infrastructure and when they were found outside the company, in the world (the last 30 days are displayed so as not to divert analysts too much from the current moment ).  Such a comparison of the two timelines allows us to conclude whether the malicious activity is global (and we just came under the distribution, like many others) or it was a focal, designed specifically for us. <br><br><img src="https://habrastorage.org/webt/bg/7t/el/bg7telzembuqnsjn2tsb_ok-pk8.png" alt="image"><br><br>  At the very bottom of the screen we will see a section where you can get the details of each trail found, the artifact, the indicator of compromise and go for a more detailed analysis.  Please note that of all the traces we are looking for, we only met one on the network - the hash of the malicious file. <br><br><img src="https://habrastorage.org/webt/iq/k1/7b/iqk17bn0jjq1phhsycrhsjwum9e.png" alt="image"><br><br>  For example, this is how the information on malicious files found in our infrastructure with the corresponding hash looks like.  However, it is worth paying attention to such an important point.  For each track we see several tabs.  The first of these is Judgments.  In it, we see references to various modules that "saw" these traces sometime.  For example, we see that in the VirusTotal database there is a corresponding hash and it is recognized by various antivirus engines.  Does this mean that this threat is in our network?  Not yet.  Perhaps this is an old malware that no longer works.  For example, in the Expiration field there may be a note that this trace was last recorded ‚Äúin the wild‚Äù two months ago. <br><br><img src="https://habrastorage.org/webt/ia/yw/ds/iaywdsihkz8zhjjwb17hav3qpfc.png" alt="image"><br><br>  Much more important is the Verdict tab (final sentence), which allows us to make a final conclusion (due to the evaluation of various data, the weighted result of which is displayed on the Verdict tab) about the presence or absence of a threat in our infrastructure. <br><br><img src="https://habrastorage.org/webt/li/kb/n4/likbn4bx17o9cq1uyozhayjyxjk.png" alt="image"><br><br>  The Sightings tab shows us the artifacts of the threat and where they were discovered: <br><br><img src="https://habrastorage.org/webt/ti/gv/de/tigvdeoqymwnpirye-snmwama9s.png" alt="image"><br><br>  The Indicators tab shows a detailed description of each indicator inherent in detected traces: <br><br><img src="https://habrastorage.org/webt/qw/8t/f_/qw8tf_j1jbaqvtqasvf_qyeayfw.png" alt="image"><br><br>  Please note that we have here interaction with Tor, and deleting backups, and recognizing with antiviruses, and creating a large number of artifacts, etc.  We analyze about 1000 different indicators in our Threat Intelligence databases. <br><br><img src="https://habrastorage.org/webt/x6/qm/og/x6qmogkcwjcc-tiotzjnzgvajxc.png" alt="image"><br><br>  After receiving information about the traces of the attack found in our infrastructure, we can conduct a more detailed investigation using the tools that gave the original data to Cisco Visibility.  For example, we can run AMP for Endpoints in order to get a detailed analysis of a specific event, which led to the possibility of detecting a threat. <br><br><img src="https://habrastorage.org/webt/ap/zd/s8/apzds89cfirq4mbtiqopzjzim-k.png" alt="image"><br><br>  We see the whole picture of what is happening.  Malicious file created by the explorer.exe process at 20:00:00 Moscow time on July 15th.  We see where this file is located and the values ‚Äã‚Äãof its hashes for various algorithms (SHA1 and MD5). <br><br><img src="https://habrastorage.org/webt/dk/a8/6g/dka86gxg9965skwqvay02uehgyw.png" alt="image"><br><br>  With the help of retrospective security technology and the Device Trajectory visualization mechanism, we can visualize all actions performed or carried out by the file of interest to us.  In this case, we see that the file object t.exe, created by the explorer.exe process, has launched a completely legal Windows utility, vssadmin.exe, which manages shadow copies and, among other things, is often used by encryption tools to remove them encrypted data).  If you look at the description of TeslaCrypt, then we will see that this cryptographer really uses vssadmin in its activities. <br><br><img src="https://habrastorage.org/webt/dr/se/pu/drsepug7_ofjtv-4usydyseb4dq.png" alt="image"><br><br>  By the way, we recently updated the Device Trajectory mechanism and now it looks a bit different: <br><br><img src="https://habrastorage.org/webt/eg/bi/zt/egbiztnnll_m0roakbxmb44iztq.png" alt="image"><br><br>  In the example above, the t.exe file was not blocked and was not quarantined, although in real life AMP for Endpoints does just that.  But for the purposes of this article, AMP4E works in audit mode, which allows you to monitor events, but not block them.  By the way, if, instead of vssadmin, PowerShell was launched (also a completely legal system administration tool), then we would see both this and the command line parameters used in PowerShell. <br><br>  So, in brief, it looks like working with Cisco Visibility when searching for traces of threats in the local infrastructure and enriching existing security events with data from various Threat Intelligence sources. <br><br>  PS: Cisco Visibility is based on the Cisco Threat Intelligence Model (CTIM) developed by us, which, in turn, is based on the Threat Intelligence communication standard - STIX.  But unlike STIX, the CTIM model is not focused on formalizing the format of the threat data, but on the process of collecting, storing and analyzing this data.  Based on the Cisco Threat Intelligence API (this is an <a href="https://github.com/threatgrid/ctia">open source project</a> and it can be used in our solutions), we plan to expand the list of sources with which we will work, both in terms of receiving security events, and in receiving Threat Intelligence data.  In addition, we plan to add to Cisco Visibility the ability to work not only with atomic indicators of compromise (IP, hash, domain, URL), but also with data on vulnerabilities (CVE), programs in configuration (CWE), attack pattern database (CAPEC) and a knowledge base about the methods, tactics and procedures of intruders (ATT &amp; CK).  This work is underway. <br><br>  PPS: At the beginning of the note, I was a little devious.  Cisco Visibility is really a free solution, but to use it, you must at least have Cisco AMP for Endpoints installed in your organization (and where can you get data for threat hunting from?).  It is also desirable (but not necessary) to have access to Cisco Threat Grid (sandbox) and Cisco Umbrella (DNS analysis) services.  In these cases, it will be possible to conduct a deeper analysis of threats (traces and indicators) already within the specified services launched from Cisco Visibility.  And of course, you must have access to external Threat Intelligence services that integrate with Cisco Visibility.  So far this is only VirusTotal (but we are not standing still and we will expand their number), access to which anyone can receive. </div><p>Source: <a href="https://habr.com/ru/post/417345/">https://habr.com/ru/post/417345/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../417329/index.html">You and Brad Pitt look like 99%</a></li>
<li><a href="../417331/index.html">Security Week 26: Specter updated, now tastefully written</a></li>
<li><a href="../417333/index.html">Social rating</a></li>
<li><a href="../417337/index.html">Principles of operation and application features of atomic swap</a></li>
<li><a href="../417339/index.html">3DTouch - Scales on the iPhone: Completion</a></li>
<li><a href="../417353/index.html">Germany approved the use of hydrogen fuel cell trains</a></li>
<li><a href="../417355/index.html">Baldness: Theory and practice of treatment, part 2 "Even the prostate has tonsils, prostaglandins"</a></li>
<li><a href="../417357/index.html">"About IT" nastolki. The history of games with a computer setting</a></li>
<li><a href="../417359/index.html">Information Security? No have not heard</a></li>
<li><a href="../417367/index.html">How far away are dreams of the perfect ‚Äúfile search‚Äù</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>