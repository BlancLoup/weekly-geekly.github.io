<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>[iOS 10] We build Siri support into your iOS application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Apple showed new iOS 10 and macOS Sierra at WWDC 2016 , and I did not miss the opportunity to immediately upgrade my devices. 

 One of the key update...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>[iOS 10] We build Siri support into your iOS application</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/460/8f7/3ca/4608f73ca4afbb7604f33a0379dbcbaa.png" alt="image"><br><br>  Apple showed new <b>iOS 10</b> and <b>macOS Sierra</b> at <b>WWDC 2016</b> , and I did not miss the opportunity to immediately upgrade my devices. <br><br>  One of the key updates is the emergence of SiriKit for developers, now you and I have the opportunity to use Siri in our own applications.  And today we will make our first application with support for Siri (project sources at the end of the article) <br><a name="habracut"></a><br><blockquote>  (!) Dear Habrahabra readers, please send all errors and edits to this article to private messages. </blockquote>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  My impressions of iOS 10 and macOS </h2><br>  In the new macOS Siri appeared - it is immediately evident, with new features.  Finally, the exchange of links between iOS and macOS has started - as soon as you open the page on the iPhone / iPad - the Safari icon on the mac immediately opens this page (Previously, this function worked through time).  And of course it is very cool - that copying text on iOS - it can be pasted on macOS.  With pictures and photos is the same - one click on the iPhone, and the photo is already on the laptop, you no longer need to mail the photo to yourself.  By default, telemetry is enabled on macOS, which I immediately turned off (screenshot).  Of the minuses, iOS 10 is really slow, sometimes (not always) on the iPhone 5S and iPad Air slows down the scroll, but overall, the interface looks more stylish, more contrast, the UI changes are minor, but overall ‚Äúmore stylish and minimalist‚Äù :) In terms of Design UI is also worth noting the updated form for IN-APP notifications. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/23d/b2e/b7b/23db2eb7bc1f9f29f2ba62fc985afba6.png" alt="image"><br><br><blockquote>  (!) If someone installed iOS 10, then in order to work with the device in the old xcode (7.3), you just need to copy the folder ‚ÄúDeviceSupport / 10.0‚Äù from the same xcode 8.0 to the same place. <br><br>  From the catalog: <br>  Xcode-beta.app/Contents/Developer/Platforms/iPhoneOS.platform/DeviceSupport/10.0 (14A5261u) / <br>  To folder: <br>  Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/DeviceSupport/10.0 (14A5261u) / </blockquote><br><br>  Apple offers several scenarios for third-party Siri use: <br><br><ul><li>  Audio and video calls </li><li>  Work with messages and contacts </li><li>  Making payments using Siri </li><li>  Search for photos </li><li>  Trainings </li><li>  Work with cards (taxi call) </li></ul><br><br>  In this article, I will show you how to create a StoryBoard interface for Siri and call our functions using a voice assistant. <br><br>  First, download and install Xcode 8 and create a new application with a single ViewController and call it, for example ‚ÄúDemoApp‚Äù. <br><br>  To add voice support, we will have to add a new extension, to do this, select the top line (project file) in the left pane of the file manager and select Editor -&gt; Add target ... <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d7e/a57/d56/d7ea57d5631226ad9115a341f6cb98ab.png" alt="image"><br><br>  Let's call our extension ‚ÄúDemoAppSiriIntent‚Äù, just do not forget to check the presence of a tick in front of ‚ÄúInclude UI Extension‚Äù <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fa4/47e/306/fa447e30695f17d526bfe08105433cec.png" alt="image"><br><br>  Also for Siri to work, we need to add the CoreLocation.framework library to the project. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/838/b46/229/838b4622932826e20bfec9db81970001.png" alt="image"><br><br>  We have new files in the project. <br><br><ul><li>  IntentHandler.m - file with CallBack functions returned by Siri </li><li>  IntentViewController.m - file for working with StoryBoard interface, which is located next to, in the MainInterface.storyboard file </li></ul><br><br>  To begin with, we will teach our application to run ‚ÄúFitness Activity‚Äù (Workout), for this, the following Delegates must be declared in the IntentHandler.m file: <br><br><pre><code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IntentHandler</span></span></span><span class="hljs-class"> () &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">INStartWorkoutIntentHandling</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">INPauseWorkoutIntentHandling</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">INResumeWorkoutIntentHandling</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">INCancelWorkoutIntentHandling</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">INEndWorkoutIntentHandling</span></span></span><span class="hljs-class">&gt; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><br>  To designate methods of interaction with Siri, Apple uses the word ‚ÄúIntent‚Äù, now while holding down the CMD key, click on ‚ÄúINStartWorkoutIntentHandling‚Äù and see what functions this deligate uses. <br><br>  Required for inclusion in the project method: <br><br><ul><li>  handleStartWorkout </li></ul><br><br>  Additional methods that may not be included in the project: <br><br><ul><li>  confirmStartWorkout </li><li>  resolveWorkoutNameForStartWorkout </li><li>  resolveGoalValueForStartWorkout </li><li>  resolveWorkoutGoalUnitTypeForStartWorkout </li><li>  resolveWorkoutLocationTypeForStartWorkout </li><li>  resolveIsOpenEndedForStartWorkout </li></ul><br><br>  The confirmStartWorkout method calls the following Callback functions in order, which are already automatically created in our IntentHandler.m file: <br><br><ul><li>  resolveWorkoutNameForStartWorkout </li><li>  resolveGoalValueForStartWorkout </li><li>  DemoAppSiriIntent </li><li>  resolveWorkoutLocationTypeForStartWorkout </li><li>  resolveIsOpenEndedForStartWorkout </li><li>  confirmStartWorkout </li><li>  handleStartWorkout </li></ul><br><br>  Next to the file ‚ÄúIntentHandler.m‚Äù we see a plist with the settings of our ‚ÄúIntent‚Äù extension, ‚ÄúInfo.plist‚Äù. <br><br>  We check that the ‚Äú <i>NSExtension -&gt; NSExtensionAttributes -&gt; IntentsSupported</i> ‚Äù <i>branch</i> lists all our Intents for working with Siri Workout: <br><br><ol><li>  Item 0: INStartWorkoutIntent </li><li>  Item 1: INPauseWorkoutIntent </li><li>  Item 2: INResumeWorkoutIntent </li><li>  Item 3: INCancelWorkoutIntent </li><li>  Item 4: INEndWorkoutIntent </li></ol><br><br><img src="https://habrastorage.org/getpro/habr/post_images/447/0cf/bca/4470cfbca36b395a6e4f8979daa33891.png" alt="image"><br><br>  If we duplicate the ‚ÄúIntents‚Äù data into the " <i>NSExtension -&gt; NSExtensionAttributes -&gt; IntentsRestrictedWhileLocked</i> " <i>branch</i> , then Siri can call functions from our application even from a locked device. <br><br>  Now, go to the ‚ÄúMainInterface.storyboard‚Äù file and add two UILabels to the demo application, one of them will be a counter to demonstrate that our UI interface inside Siri can be updated in real time. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b66/da1/dff/b66da1dff4322847b966f9f34f7f77ea.png" alt="image"><br><br>  It is important to note that this interface cannot contain ‚Äúgesture recognizers‚Äù and interceptors of finger pressure events and, when this window is closed, Siri will release all objects in memory. <br><br>  In the following diagram we can get acquainted with the life cycle of our ‚ÄúSiri view interface‚Äù. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ceb/b82/f8b/cebb82f8bb4c380cd5fff82225dda540.png" alt="image"><br><br>  So, it's time to compile our application and check if the voice commands work.  Testing this example will only work on a real device, first we build the application as usual: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d56/d34/0e9/d56d340e963f7334facc98fcc1614604.png" alt="image"><br><br>  Then click on Stop and separately compile our extension by selecting the ‚ÄúDemoAppSiriIntent‚Äù scheme.  At compile time, Xcode will ask us for which application we are building this extension, and we specify ‚ÄúDemoApp‚Äù in the list. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/59a/916/f6b/59a916f6b38e863f17a2d29de65363b3.png" alt="image"><br><br>  At this stage, we will see that our application appears for a second and disappears right away, this is not a ‚Äúcrash‚Äù, all the NSLog output functions from the ‚ÄúIntentHandler.m‚Äù file show us that everything works. <br><br>  Oh yeah, I almost forgot, in the settings of our iOS device, go to the Siri section and check the box next to our ‚ÄúDemoApp‚Äù program: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1c9/90a/121/1c990a1215a6e538a561345e5f43b7a7.png" alt="image"><br><br><h5>  So, it's time to say out loud "Hey, Siri, start workout in DemoApp" </h5><br><br>  You can see the result in this video: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/t45ExArQzXI%3Ffeature%3Doembed&amp;xid=17259,15700021,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhifgzEizoM9HXiEVG3HIdjiG5oBtg" frameborder="0" allowfullscreen=""></iframe><br><br>  Now we are convinced that everything works, let's add support for messages in our application. <br><br>  By clicking on this link, you can familiarize yourself with all the ‚ÄúIntent‚Äù methods that are currently supported by Siri: <br>  <a href="https://developer.apple.com/library/prerelease/content/documentation/Intents/Conceptual/SiriIntegrationGuide/SiriDomains.html">https: //developer.apple.com / ...</a> <br><br>  Now we are interested in the ‚ÄúMessaging‚Äù section, open our ‚ÄúIntentHandler.m‚Äù file, set the delegate for the messages: <br><br><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IntentHandler</span></span></span><span class="hljs-class"> () &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">INSendMessageIntentHandling</span></span></span><span class="hljs-class">&gt;</span></span></code> </pre><br><br>  Keeping the CMD clamped - click on ‚ÄúINSendMessageIntentHandling‚Äù and see that the necessary function at this time is ‚ÄúhandleSendMessage‚Äù.  To begin with, assign ‚ÄúIntent‚Äù for messages in the ‚ÄúhandlerForIntent‚Äù function: <br><br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>)handlerForIntent:(INIntent *)intent { <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> handler = <span class="hljs-literal"><span class="hljs-literal">nil</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([intent isKindOfClass:[INSendMessageIntent <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>]]) { handler = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>; } handler = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> handler; }</code> </pre><br><br>  And then we write the callback function for our ‚ÄúIntent‚Äù: <br><br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)handleSendMessage:(INSendMessageIntent *)intent completion:(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> (^)(INSendMessageIntentResponse * _Nonnull))completion { <span class="hljs-built_in"><span class="hljs-built_in">NSUserActivity</span></span> *userActivity = [[<span class="hljs-built_in"><span class="hljs-built_in">NSUserActivity</span></span> alloc] initWithActivityType:<span class="hljs-built_in"><span class="hljs-built_in">NSStringFromClass</span></span>([INSendMessageIntent <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>])]; INSendMessageIntentResponse *response = [[INSendMessageIntentResponse alloc] initWithCode: INSendMessageIntentResponseCodeSuccess userActivity:userActivity]; <span class="hljs-built_in"><span class="hljs-built_in">NSLog</span></span>(<span class="hljs-string"><span class="hljs-string">@"handleSendMessage"</span></span>); completion(response); }</code> </pre><br><br>  Do not forget to register our new "Intent" in plist.info, in the " <i>NSExtension -&gt; NSExtensionAttributes -&gt; IntentsSupported</i> " <i>branch</i> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c14/971/8b0/c149718b0dd0ea35118fa548b7b13308.png" alt="image"><br><br>  That's all, I wrote this article in very succinct lines, but if you are interested in this topic, let me know in the comments, I can write a more extended publication that includes such nuances as the localization of Siri commands in our application, working with maps, making synonyms for voice phrases and training phrases for Siri, and of course the problems of the beta version of Xcode 8. <br><br>  The project source files from this article can be downloaded here: <br><br>  <a href="">http://big-lab.com/images/articles/sirikit/DemoApp.zip</a> </div><p>Source: <a href="https://habr.com/ru/post/303316/">https://habr.com/ru/post/303316/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../303306/index.html">Once again about fast JPEG on CUDA</a></li>
<li><a href="../303308/index.html">Az.js: JavaScript-library for word processing in Russian</a></li>
<li><a href="../303310/index.html">Accounting errors in documents of contractors-physicists and freelancers</a></li>
<li><a href="../303312/index.html">Functional programming is unpopular because it is strange.</a></li>
<li><a href="../303314/index.html">E-commerce: Russia vs China. Part II. Segmentation</a></li>
<li><a href="../303322/index.html">DotNext 2016: Between Present and Future</a></li>
<li><a href="../303324/index.html">We connect Arduino to Mikrotik. Cheap and angry remote load management</a></li>
<li><a href="../303328/index.html">Create a JavaScript application with React Native</a></li>
<li><a href="../303330/index.html">What is PCI DSS and how does the standard compliance check occur?</a></li>
<li><a href="../303332/index.html">6 ways to keep VM Tools up to date</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>