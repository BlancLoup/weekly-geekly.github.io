<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Best practices for hosting Drupal in a cloudy environment</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The main purpose of this article is to talk about the features and best practices of placing Drupal in the cloud environment of the Microsoft Azure pl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Best practices for hosting Drupal in a cloudy environment</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/52f/cdd/e00/52fcdde003ebf4e5b4cf3016473bfdee.jpg" alt="image"><br>  The main purpose of this article is to talk about the features and best practices of placing Drupal in the cloud environment of the Microsoft Azure platform [about the benefits of the Azure platform for hosting websites on PHP, Java, Python, .NET and Node.js you can read in <a href="http://habrahabr.ru/company/microsoft/blog/221045/">this article</a> - note .  trans.].  From this guide, you will learn: <br><br><ul><li>  How to migrate an existing Drupal site to Azure websites </li><li>  How to set up an Azure Storage Module for media content </li><li>  How to set up Memcached Cloud to support caching </li><li>  Best practices for hosting Drupal CMS in the cloud </li><li>  How to scale a Drupal site in several regions around the world </li></ul><br><h3>  How to migrate an existing site to Drupal to the cloud </h3><br>  Migrating your Drupal site to your Azure cloud is a daunting task.  Just use the best practices listed below and you can move your site to Drupal in a cloud environment in just one hour. <br><a name="habracut"></a><br>  <strong>Creating an Azure Web Site and MySQL database</strong> <br><br>  To get started, create a new website in Azure with MySQL and with Git support (you can use <a href="http://www.windowsazure.com/en-us/develop/php/tutorials/website-w-mysql-and-git/">step-by-step instructions</a> ).  Please note that the article describes how to use the <strong>FREE version of MySQL</strong> in the cloud.  This database version is great for the development phase, but for industrial use you may need to purchase a cloud copy of the ClearDB database from the Azure Store.  You can choose from a <a href="https://www.cleardb.com/store/azure">set of plans for acquiring a</a> common database cluster.  For more information, see the <a href="http://blog.syntaxc4.net/post/2012/12/03/provisioning-a-mysql-database-from-the-windows-azure-store.aspx">ClearDB</a> article <a href="http://blog.syntaxc4.net/post/2012/12/03/provisioning-a-mysql-database-from-the-windows-azure-store.aspx">from the Azure Store</a> .  If a plan with a common database cluster does not suit you, then you can choose a dedicated MySQL cluster.  Details can be found at the following link <a href="">ClearDB mission critical database plans</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If you are going to use Git for your Drupal site, then go through the steps guide that describes how to configure the Git repository.  Make sure that you have done the necessary steps described in the section on getting information about connecting to a remote MySQL server, as you will need this information later.  You may well ignore the final part of the tutorial, which is dedicated to deploying your site to Drupal, however, if you are just learning about the Azure cloud (or Git), then this part of the guide may be useful to you. <br><br>  After starting a new Azure website with a database in MySQL, you will have information about connecting to a remote database and (optionally) the Git repository.  The next step is to copy your MySQL database to the Azure website. <br><br>  <strong>Copy database to MySQL to Azure website</strong> <br><br>  There are many ways to migrate a database to Azure.  One proven way to migrate MySQL is to use the [MySqlDump] tool.  The following command shows an example of copying from a local machine to the cloud Azure Web Sites: <br><br><blockquote>  mysqldump -u local_username --password = local_password drupal |  mysql -h remote_host -u remote_username --password = remote_password remote_db_name <br></blockquote><br>  Of course, you need to provide your name and password for an existing Drupal database.  In addition, you need to transfer the host name, username, password and database name to the MySQL database created in the first step.  This information is available in the connection string you received earlier.  The connection string has a format similar to the following: <br><br><blockquote>  Database = remote_db_name; Data Source = remote_host; User Id = remote_username; Password = remote_password <br></blockquote><br>  Depending on the size of your database, the copy process may take several minutes. <br><br>  Now your database lives in the Azure Web Sites cloud.  Before placing your Drupal code you need to change it so that it can connect to the new database. <br><br>  <strong>Change database connection in settings.php</strong> <br><br>  At this step, you will again need information about connecting to a new database.  Open the <strong>&lt;drupalsite&gt; /sites/default/setting.php file</strong> in the editor and replace the 'database', 'username', 'password' and 'host' values ‚Äã‚Äãin the <strong>$ databases</strong> array with the values ‚Äã‚Äãset for your new database.  You should end up with something like this: <br><br><pre><code class="php hljs">$databases = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> (<span class="hljs-string"><span class="hljs-string">'default'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span> (<span class="hljs-string"><span class="hljs-string">'default'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span> (<span class="hljs-string"><span class="hljs-string">'database'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'remote_db_name'</span></span>,<span class="hljs-string"><span class="hljs-string">'username'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'remote_username'</span></span>, <span class="hljs-string"><span class="hljs-string">'password'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'remote_password'</span></span>,<span class="hljs-string"><span class="hljs-string">'host'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'remote_host'</span></span>,<span class="hljs-string"><span class="hljs-string">'port'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'driver'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'mysql'</span></span>,<span class="hljs-string"><span class="hljs-string">'prefix'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">''</span></span>,),),);</code> </pre> <br>  <strong>Note:</strong> if you have a configuration parameter <strong>$ base_url</strong> in <strong>settings.php</strong> , then comment it out, since Drupal CMS will create URL addresses from the set $ base_url.  You can use the <strong>$ base_url</strong> parameter again right after your cloud site has been configured to use a custom domain.  Save the <strong>settings.php</strong> file <strong>.</strong> <br><br>  Now you are ready to place your code. <br><br>  <strong>Posting Drupal code using Git or FTP</strong> <br><br>  The final step is to place your code in the Azure website‚Äôs cloud using Git or FTP. <br><br><ul><li>  If you use FTP, get the hostname and username from the control panel of your Azure website.  Then, using any FTP client, upload Drupal files to the <strong>/ site / wwwroot folder of the</strong> remote site; </li><li>  If you are using Git, you need to install the Git repository in the previous steps.  You must install Git on your local machine.  Then, follow the instructions suggested after you created the repository.  See the <a href="http://azure.microsoft.com/en-us/documentation/articles/web-sites-php-mysql-deploy-use-git/">article</a> on Git configuration. </li></ul><br><h3>  How to set up an Azure Storage Module </h3><br>  Immediately after installing Drupal, you need to enable and configure the blob storage module, which uses Azure Storage cloud storage to save media files.  Use the following instructions to configure this module.  Log in to your site as an administrator and enable the Azure Storage module in the modules tab.  If this module is not in the list of modules, install it <a href="https://drupal.org/project/azure">from here</a> . <br><br> <a href=""><img title="image_thumb [15]" alt="image_thumb [15]" src="https://habrastorage.org/getpro/habr/post_images/535/f36/6d8/535f366d8b621d83913152c6bb13baa1.png"></a> <br><br>  Click the <strong>Configuration</strong> tab, then select <strong>Azure Storage</strong> in the <strong>Media</strong> section <strong>.</strong> <br><br> <a href=""><img title="image_thumb [13]" alt="image_thumb [13]" src="https://habrastorage.org/getpro/habr/post_images/538/a91/771/538a9177111d38b4dd5893cfaebadc0a.png"></a> <br><br>  Click the <strong>Add</strong> button to add the storage account data that will be used by your Drupal sites.  Specify all the details: the name of the storage account, the name of the existing container (the container must be public), the URL of the blob storage repository, the primary access key.  Use the <strong>custom URL</strong> parameter if your repository is associated with a CDN and specify the CDN address here.  If you are not using a CDN, leave this field blank. <br><br> <a href=""><img title="image_thumb [11]" alt="image_thumb [11]" src="https://habrastorage.org/getpro/habr/post_images/7ac/38c/2eb/7ac38c2ebd450c48bc40edf86db0afd7.png"></a> <br><br>  Go back to the <strong>Configuration</strong> tab and select <strong>File System</strong> in the <strong>Media</strong> section.  Select an item and save the setting by clicking <strong>Save Configuration.</strong> <br><br> <a href=""><img title="image_thumb [9]" alt="image_thumb [9]" src="https://habrastorage.org/getpro/habr/post_images/a0f/5d2/b0c/a0f5d2b0cfba4f18291b8b4a44f2c5c4.png"></a> <br><br>  Now select <strong>Structure-&gt; Content Type.</strong>  Then click on <strong>manager fields of</strong> type <strong>Article.</strong>  In the dialog box, check if you have an <strong>Image label</strong> that will display the <strong>Image Upload</strong> option when creating new materials.  If you plan to support uploading files (of various formats), then also include the checkmark for File Upload. <br><br> <a href=""><img title="image_thumb [7]" alt="image_thumb [7]" src="https://habrastorage.org/getpro/habr/post_images/e25/563/e73/e25563e73727ba7e2459feed899aaeba.png"></a> <br><br>  Now click on edit for the Image label and select the Azure Storage option for the <strong>Upload destination</strong> parameter.  Do the same for all other tags you have for uploading files (with FILE field types). <br><br> <a href=""><img title="image_thumb [6]" alt="image_thumb [6]" src="https://habrastorage.org/getpro/habr/post_images/070/fc2/941/070fc29413940301f38665e105a475e0.png"></a> <br><br>  Repeat the steps to update the configuration for any type of content that supports uploading images or other files. <br><br><h3>  How to set up Memcached Cloud to support caching </h3><br>  Subscribe to the Memcached Cloud service, which offers memcached as a managed service.  This service is currently available in the East US and West US regions of the Azure platform.  If you want to manage your own memcached servers, then you have the easy option to configure them using your Linux-based Azure virtual machine.  This article discusses the use of cloud Memcached. <br><br>  Log in to the <a href="https://redislabs.com/">Redis labs portal</a> and select <strong>New Memcached Subscription.</strong> <br><br> <a href=""><img title="image_thumb [17]" alt="image_thumb [17]" src="https://habrastorage.org/getpro/habr/post_images/f30/1ab/0ed/f301ab0edbceba7fbf4a25518405c0a8.png"></a> <br><br>  Select the cloud platform / region for the service and the plan you will use.  The free plan (25 MB) is great for development and testing purposes, but will not provide a sufficient level of performance required for a site in commercial operation.  Click on <strong>Select</strong> and create your own memcached endpoint. <br><br> <a href=""><img title="image_thumb [20]" alt="image_thumb [20]" src="https://habrastorage.org/getpro/habr/post_images/13d/927/765/13d927765f33e1efb0b6a70305f0be2d.png"></a> <br><br>  Enter all required information.  The module that I use for Drupal does not support the SASL (Simple Authentication and Security Layer), which can be added to your memcached server, in connection with which I deselected this option in the current step.  Enter the resource name and click <strong>Activate</strong> .  If you already have a module that supports the security level for memcached, you can enable it during the creation of the memcached endpoint. <br><br> <a href=""><img title="image_thumb [24]" alt="image_thumb[24]" src="https://habrastorage.org/getpro/habr/post_images/e93/03b/d2f/e9303bd2f7e30aff55e41cd2cc43f78f.png"></a> <br><br>  Now you can manage your memcached service from <a href="https://app.redislabs.com/main/bdbconfiguration">the Redis Labs portal</a> . <br><br> <a href=""><img title="image_thumb [25]" alt="image_thumb[25]" src="https://habrastorage.org/getpro/habr/post_images/e9b/dc5/359/e9bdc53597c5a1b66a5d33960134f7e4.png"></a> <br><br>  To get the server endpoint, click on the <strong>Resource Name</strong> you created.  Remember the <strong>Endpoint</strong> value that you will need later to configure Drupal. <br><br> <a href=""><img title="image_thumb [27]" alt="image_thumb[27]" src="https://habrastorage.org/getpro/habr/post_images/466/692/927/4666929272b038ddb53ba74164a930fe.png"></a> <br><br>  Download and copy the memcached PECL extension <a href="">from here</a> .  Please note that this extension is intended for PHP5.4 (32 bit).  If your site uses a friend configuration, then select the appropriate library <a href="http://pecl.php.net/package/memcache/3.0.8/windows">from here</a> .  Install the memcached module for Drupal.  In the Azure website control panel, update your site configuration.  In the application settings section (app settings) of the Configure tab, add the <strong>PHP_EXTENSIONS</strong> parameter with the value <strong>‚Äúbin \ php_memcache.dll‚Äù.</strong> <br><br>  In the <strong>settings.php</strong> file in the <strong>$ conf</strong> variable add the memcached server.  If you do not specify any of the servers, then memcache.inc will decide that an instance of your memcached server is running on the local machine on port 11211 (127.0.0.1:11211 or localhost: 11211), and since it is not there, your application does not will work. <br><br>  The following array example shows the pattern: <br><br><pre> <code class="php hljs">$conf[<span class="hljs-string"><span class="hljs-string">'memcache_servers'</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'pub-memcache-10939.us-east-1.1.azure.garantiadata.com: 10939'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'default'</span></span> );</code> </pre> <br>  For details, see the <a href="https://drupal.org/node/1131468">Memcache API for Drupal</a> Handbook.  You can use only one server for all Drupal operations with the above configuration, but if you prefer to split your dataset into multiple Memcached servers, you can easily create new Memcached server endpoints in the Azure Store.  Below you will find a simple setup with two Memcached servers and in this example all data will be cached in Bucket 1, excluding ‚Äúpages‚Äù (pages) that will be cached in Bucket 2. <br><br><pre> <code class="php hljs"> $conf[<span class="hljs-string"><span class="hljs-string">'memcache_servers'</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'server1_hostname:server1_port'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'default'</span></span>, <span class="hljs-string"><span class="hljs-string">'server2_hostname:server2_port'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'pages'</span></span> ); $conf[<span class="hljs-string"><span class="hljs-string">'memcache_bins'</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'cache_page'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'pages'</span></span>, );</code> </pre> <br>  The most common approach for organizing caching is to mix the use of the content delivery network (CDN) and the Memcached service.  Drupal uses a database to store the cache.  If any content is changed, then by defining the change, Drupal will mark the cache as outdated to preserve the consistency of the content.  Memcached replaces the internal Drupal caching system. <br><br><h3>  Best Practices for Drupal CMS in Azure </h3><br>  General recommendations for any site in the cloud: <br><br><ol><li>  <strong>Plan for the future</strong> : you must track the performance and requirements of your site and user traffic patterns to plan up and down infrastructure scaling; </li><li>  <strong>Back up your site</strong> : back up your site [Azure Web Sites offers a built-in automatic backup and restore feature - approx.  trans.].  Test backup and restore procedures. </li></ol><br>  Now let's focus on the Drupal CMS and learn some best practices for building and managing Drupal CMS in the Azure Web Sites cloud environment. <br><br>  <strong>Security configuration</strong> <br><br><ol><li>  Delete all temporary files before placing.  While editing files, you may have temporary backup copies, for example, .bak files, files with names ending with ‚Äú~‚Äù, <strong>settings.php.orig.</strong>  These files can be viewed through the browser, unless you deny access to them through the setting in the <strong>web.config file</strong> using URL Rewrite rules.  Such files can become a vulnerability of your site and open access to it for intruders.  Delete all similar files.  You can deny access to similar files by adding rules to the configuration file, denying access to any type of file.  In addition, you can easily automate the task of deleting temporary files using the WebJobs background tasks feature offered by the Azure Web Sites service. </li><li>  Enable SSL for login.  Drupal does not require the use of Secure sockets layer (SSL) when a user logs on.  This makes it easier for attackers to gain administrative access to your site.  Install and enable the <a href="http://drupal.org/project/securepages">Secure Pages</a> module from drupal.org.  This module ensures that each user is served via SSL. </li><li>  Disable unsafe download fields.  Prevent unnecessary File and image fields that allow users to upload files to the site.  An attacker could use these features to gain control on your website by downloading a file that could cause havoc on your system.  Enter restrictions on the types of files that are allowed to download, remove the ability to download files such as .exe, .swf, .flv, .htm, .php, .vb, .vbs. </li><li>  Turn on the Security Kit module.  The Security Kit module offers improvements to the security of your site, such as protection against attacks such as Clickjacking, Cross-Site Request Forgery (CSRF), Cross-Site Scripting (XSS) and others.  It is recommended to use the default configuration for this module, however, if your site has any special requirements that the module may not meet, then you can configure the module‚Äôs own settings.  For more information, see <a href="https://drupal.org/project/seckit">the module page</a> . </li><li>  Do not use common user names for administrator accounts.  The name of your administrator account should not be <strong>admin, administrator,</strong> or <strong>root</strong> , which are widespread and may represent a security vulnerability in your site.  Use complex or unique usernames to avoid hacking. </li><li>  Hide the display of information about errors of the site from your users.  These error messages can contain important sensitive information about your site or server and give it to visitors.  To configure your website not to display error information to users, open the Logging and errors page at / admin / config / development / logging and select None from the Error messages to display and click Save configuration. </li><li>  Enable the Password Policy module.  Your website's content editors may decide to use passwords that are easy to crack, which will open the doors of your website to intruders.  In order to reduce the possibility of a vulnerability, enable the <a href="https://drupal.org/project/password_policy">Password Policy module</a> , which will include mandatory complex password policies. </li></ol><br>  <strong>Performance configuration</strong> <br><br><ol><li>  The minimum cache lifetime is less than 5 minutes.  To increase site responsiveness and performance, the minimum cache lifetime prevents the cache of pages and blocks from clearing after a change for a specified period of time.  If you set the minimum cache lifetime to less than 5 minutes, the server will work more to deliver fresh content to site visitors.  To set the minimum cache lifetime to 5 minutes or more on your site, open the Performance page at / admin / config / development / performance and select a new value for the Minimum cache lifetime parameter.  Set this parameter as large as possible given the desire to have cached pages and the need for visitors to get fresh content as quickly as possible. </li><li>  The maximum page cache age is less than 5 minutes.  When the maximum page cache age is set to less than 5 minutes, the server has to regenerate pages more frequently.  This reduces the performance of the site.  To set the parameter value to 5 minutes or more, open the Performance page at / admin / config / development / performance and select a new value for <strong>Page cache max age.</strong> </li><li>  Optimize CSS and JS scripts.  With CSS / JS optimization turned off, your users will get a decrease in page speed and an increase in server load.  To enable CSS optimization, open the Performance page at / admin / config / development / performance and set the Aggregate and compress CSS files option.  To enable JavaScript optimization, open the Performance page at / admin / config / development / performance and set the Aggregate JavaScript files option. </li><li>  Turn on page compression.  When page compression is turned off, site visitors face longer downloads of these pages.  Squeeze the pages before storing them in the cache, so as to reduce network sharing with the backend.  To enable page compression, open the Performance page at / admin / config / development / performance and make sure that the Cache pages for anonymous users option is set and set the Compress cached pages option. </li></ol><br>  <strong>Configuring an Azure website</strong> <br><br><ol><li>  Through the Azure website management portal, enable server logs and use Azure Storage to store them.  You can use the same repository that you have configured for storing media content.  For more information, see the <a href="http://azure.microsoft.com/en-us/documentation/articles/web-sites-enable-diagnostic-log/">Azure website diagnostics</a> manual. </li><li>  Set up automatic scaling, which will automatically increase or decrease the number of instances of your site.  For details, refer to the <a href="http://blogs.msdn.com/b/wats/archive/2013/10/31/exploring-the-autoscale-feature-in-windows-azure-websites.aspx">Auto-scale Configuration</a> manual. </li><li>  Use the Basic or Standard modes of the Azure Web Site, which provide you with dedicated VM instances, high performance, support within the SLA.  For more information, see <a href="http://azure.microsoft.com/en-us/pricing/details/web-sites/">Features by tiers</a> . </li><li>  Configure the site to operate in at least two Medium or Large instances (instances correspond to specific VMs for your website).  If you use one instance, then in case of problems with its VM, your site may become unavailable.  When using two copies, you will be able to avoid failure due to the failure of one point. </li><li>  Perform load testing of your site using Visual Studio tools or others to make sure that the scaling configuration of the site really allows you to maintain the calculated traffic. </li><li>  Set up an automatic disinfection of your site, which restarts your VMs based on certain indicators of the site status.  For more information, see the article <a href="http://azure.microsoft.com/blog/2014/02/06/auto-healing-windows-azure-web-sites/">How to Auto-heal your website</a> . </li></ol><br>  <strong>Best practice code</strong> <br><br><ol><li>  Avoid making changes to the core Drupal.  Making these changes makes it harder to manage Drupal versions and update your website, as well as make it more difficult for your website to grow as it grows. </li><li>  Avoid using a large number of modules.  Drupal offers you the flexibility of allowing you to add modules that extend the functionality of the CMS.  But at the same time, too many modules can affect the performance of your site and slow it down. </li><li>  Use web.config to launch the Azure website.  Azure Web Sites websites use IIS, which allows you to use a web.config file to manage unauthorized file access protection and manage Rewrite URLs.  Use the example web.config specified <a href="https://groups.drupal.org/node/25421">here</a> for your Drupal site.  You need to disable Application Request Routing cookies that pin certain users to specific VM instances.  Turning off this feature will allow your website to use the usual load balancing behavior that is provided by the Azure platform out of the box.  For more information, see the <a href="http://ppe.blogs.msdn.com/b/windowsazure/archive/2013/11/18/disabling-arr-s-instance-affinity-in-windows-azure-web-sites.aspx">Disable ARR Cookie</a> article.  To configure this, add the following section to your web.config file immediately after <strong>&lt;system.webserver&gt;:</strong> </li></ol><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">httpProtocol</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">customHeaders</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Arr-Disable-Session-Affinity"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"True"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">customHeaders</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">httpProtocol</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3>  Scaling Drupal into several regions around the world </h3><br>  By placing copies of a website in different regions around the world, you reduce the risk of a single point of failure when you rely on only one copy of the site in one data center.  The key thing to keep in mind when working with cloud solutions is the understanding that each component (website, database, cache, etc.) may fail, and therefore your decision should be able to fail. handle and be trouble free.  This will reduce the operating costs that may be due to service failure. <br><br>  For this scenario, you need to place your Drupal site in at least two regions, for example, in East US and West US.  Consider the Active-Active (Master-Master) configuration for the Drupal website in Azure: <br><br><ol><li>  Two Azure websites linked to their respective MySQL databases </li><li>  Both MySQL databases are synchronized using database replication </li><li>  Using the Azure Traffice Manager service, user traffic is balanced for the regions by one of the three methods Performance, Failover or Round Robin </li><li>  Memcached managed service configured with failover function </li><li>  Azure Storage uses geo-redundancy with Azure CDN </li></ol><br>  This architecture is very easy to create, but if your application has special requirements, then you can customize this configuration for yourself.  You can make the following changes: <br><br><ul><li>  create a master-slave website configuration </li><li>  create a configuration with one Master and many Slave </li><li>  use your own Web Jobs-based replication process </li><li>  automate management processes with Web Jobs </li></ul><br>  <strong>Website scaling</strong> <br><br>  Scaling up Azure Web Sites requires two actions: changing your Web Hosting Plan mode to a higher level and configuring certain settings after moving to a new plan.  Both actions are covered in this article.  Higher levels, such as the Standard mode, offer high performance and flexibility in how your resources will be used.  For details, refer to the documentation for the <a href="http://azure.microsoft.com/en-us/documentation/articles/web-sites-scale/">How to scale Azure website</a> . <br><br>  <strong>Database Scaling</strong> <br><br>  Your application depends on two components ‚Äî the Azure website and the database.  Depending on how you created your database, you are offered several ways to scale your database for high availability and fault tolerance.  For example, there are two scenarios: <br><br><ol><li>  If you are using the CrearDB service, then you just need to configure <a href="http://www.cleardb.com/developers/cdbr/introduction">ClearDB high availability routing</a> (CDBR).  The ClearDB service offers database replication between pairs of regions (for example, East US and West US), but you can create and use your own database replication tools using Azure Web Jobs. </li><li>    <a href="http://www.mysql.com/products/cluster/">MySQL Cluster CGE</a> ,         MySQL    Microsoft Azure.  ,           MySQL,     . </li></ol><br> <strong>  Memcached</strong> <br><br>   Memcached Cloud  Redis Labs        .     memcached  ,      memcached     .       <a href="http://redislabs.com/memcached-cloud">Memcached Cloud Features</a> . <br><br> <strong> Traffic Manager    </strong> <br><br>  Azure Traffic Manager          ,       -. Traffic Manager ,        DNS   -.     -                . Traffic Manager    : <br><br><ul><li> <strong>Failover</strong> :   ,            Azure ()          ,     ,       .       <a href="http://msdn.microsoft.com/en-us/library/azure/dn339010.aspx">Failover load balancing method</a> . </li><li> <strong>Round Robin</strong> :   ,       [         ‚Äî . .]           .       <a href="http://msdn.microsoft.com/en-us/library/azure/dn339010.aspx">Round Robin load balancing method</a> . </li><li> <strong>Performance</strong> :   ,             ,      ‚Äú‚Äù        .       <a href="http://msdn.microsoft.com/en-us/library/azure/dn339010.aspx">Performance load balancing method</a> . </li></ul><br>     Azure Traffic Manager    Azure. <br><br> <a href=""><img title="image_thumb[31]" alt="image_thumb[31]" src="https://habrastorage.org/getpro/habr/post_images/42f/7a4/8b6/42f7a48b652dab35d400ad1d7c736b7e.png"></a> <br><br>      ,   ADD   -,       . <br><br> <a href=""><img title="image_thumb[33]" alt="image_thumb[33]" src="https://habrastorage.org/getpro/habr/post_images/a60/2b3/325/a602b3325cf79193e49be137927af877.png"></a> <br><br>      Web Site   -,     <br><br><img alt="Add Website Endpoints" src="https://habrastorage.org/getpro/habr/post_images/d4d/2ef/f89/d4d2eff89b73274ba7b621e95466b8a4.png"><br><br>       traffic manager.      URL  traffic manager     ,       . <br><br><h3>  Conclusion </h3><br>          Drupal    Azure Web Sites. ,    ,     Drupal  Azure    .          Drupal   Microsoft Azure. <br><br><h3>  Additional links </h3><br><ul><li><h5>  <a href="http://aka.ms/azure_trial_free_rus%3Fid%3D1">Try Azure</a> for free for 30 days! </h5><br></li><li><h5>  Take a training course at the <a href="http://aka.ms/gomvarus%3Fid%3D1">Microsoft Virtual Academy</a> (MVA) </h5><br><ul><li>  <a href="http://www.microsoftvirtualacademy.com/training-courses/app-development-on-microsoft-platform-rus">Application Development on the Microsoft Platform</a> </li><li>  <a href="http://www.microsoftvirtualacademy.com/training-courses/microsoft-azure-security-overview-and-sql-azure-databases-rus">Microsoft Azure and SQL Azure Databases security overview</a> </li><li>  <a href="http://www.microsoftvirtualacademy.com/training-courses/service-management-windows-azure-rus">Azure Software Service Management</a> </li><li>  <a href="http://www.microsoftvirtualacademy.com/training-courses/windows-azure-for-app-development-and-infrastructure-services">Azure immersion for application development and infrastructure services</a> </li><li>  <a href="http://www.microsoftvirtualacademy.com/training-courses/introducing-to-app-development-for-windows-azure-rus">Introduction to the development of modern applications with Azure for beginners</a> </li><li>  or <a href="http://www.microsoftvirtualacademy.com/product-training/product-windows-azure-ru">Azure cloud development courses</a> </li><li>  or many other <a href="http://aka.ms/gomvarus">free MVA courses</a> ! </li></ul><br></li></ul></div><p>Source: <a href="https://habr.com/ru/post/228841/">https://habr.com/ru/post/228841/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../228823/index.html">Space maps loaded into tablets: live report from Baikonur</a></li>
<li><a href="../228831/index.html">Secret Notes in Code</a></li>
<li><a href="../228833/index.html">Adi Shamir's birthday. Visual, geometric and neuro-cryptography</a></li>
<li><a href="../228835/index.html">Google has published a preview version of the source code Android L for the Nexus line</a></li>
<li><a href="../228839/index.html">Integration of Asterisk with minicom DX-500 with ELF2-AE</a></li>
<li><a href="../228843/index.html">Useful materials for mobile developer # 60 (June 30-July 6)</a></li>
<li><a href="../228847/index.html">As part of a course at MIT, I developed an automatic dispenser for patches or in brief about design-thinking</a></li>
<li><a href="../228849/index.html">[Translation] Why Go is not so good</a></li>
<li><a href="../228851/index.html">Dell prepares for the arrival of ARM processors in servers (part 3)</a></li>
<li><a href="../228859/index.html">ThinkServer RD640 - Lenovo server, charged for work</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>