<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Interfaces as abstract data types in Go</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not so long ago, a colleague retweeted an excellent post How to Use Go Interfaces . It discusses some of the errors when using interfaces in Go, and a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Interfaces as abstract data types in Go</h1><div class="post__text post__text-html js-mediator-article">  Not so long ago, a colleague retweeted an excellent post <a href="https://blog.chewxy.com/2018/03/18/golang-interfaces/">How to Use Go Interfaces</a> .  It discusses some of the errors when using interfaces in Go, and also provides some recommendations on how to use them anyway. <br><br>  In the article mentioned above, the author lists the interface from the standard library's <b>sort</b> package as an example of an abstract data type.  However, it seems to me that such an example does not reveal the idea very well when it comes to real-world applications.  Especially about applications that implement the logic of some business area or solve real-world problems. <br><br>  Also, when using interfaces in Go, over-engineering disputes often arise.  And it also happens that, after reading such recommendations, people not only stop abusing interfaces, they are trying to almost completely abandon them, thereby depriving themselves of using one of the strongest programming concepts in principle (and one of Go‚Äôs particular).  On the subject of typical errors in Go, by the way, there is a <a href="https://www.youtube.com/watch%3Fv%3D29LLRKIL_TI">good report</a> from Stive Francia from Docker.  There, in particular, interfaces are mentioned several times. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In general, I agree with the author of the article.  However, it seemed to me that the topic of using interfaces as abstract data types in it is quite superficially disclosed, so I would like to develop it a bit and think about this topic with you. <br><a name="habracut"></a><br><h3>  Turn to the original </h3><br>  At the beginning of the article, the author cites a small example of code with which he points out errors when using interfaces that developers often make.  Here is the code. <br><br><pre><code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> animal <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Animal <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { Speaks() <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-comment"><span class="hljs-comment">// implementation of Animal type Dog struct{} func (a Dog) Speaks() string { return "woof" }</span></span></code> </pre> <br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> circus <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"animal"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Perform</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a animal.Animal)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a.Speaks() }</code> </pre><br>  The author calls this approach <i>‚ÄúJava-style interface usage‚Äù</i> .  When we declare an interface, then we will implement a single type and methods that will satisfy this interface.  I agree with the author, the approach is so-so. A more idiomatic code in the original article is as follows: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> animal <span class="hljs-comment"><span class="hljs-comment">// implementation of Animal type Dog struct{} func (a Dog) Speaks() string { return "woof" }</span></span></code> </pre><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> circus <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Speaker <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { Speaks() <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Perform</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a Speaker)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a.Speaks() }</code> </pre><br>  Here, in general, everything is clear and understandable.  The basic idea: <i>‚ÄúFirst declare types, and only then declare interfaces at the point of use‚Äù</i> .  It is right.  But now let's develop a little idea in terms of how interfaces can be used as abstract data types.  The author to the word points out that in such a situation there is nothing wrong with declaring the interface <i>‚Äúin advance‚Äù</i> .  We will work with the same code. <br><br><h3>  Let's play with abstractions </h3><br>  So, we have a circus and there are animals.  Inside the circus there is a fairly abstract method <i>`Perform`</i> (perform an action), which accepts the interface` <i>Speaker`</i> and forces the pet to make sounds.  For example, the dog from the example above, he will force the bark.  Create a pet tamer.  Since he is not dumb here, we, in general, can also force him to make sounds.  The interface is rather abstract.  :) <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> circus <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Tamer <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t *Tamer)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Speaks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"WAT?"</span></span> }</code> </pre><br>  So far, so good.  We go further.  Let's teach our tamer to give commands to pets?  For now, we will have one <i>voice</i> command.  :) <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> circus <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ( ActVoice = <span class="hljs-literal"><span class="hljs-literal">iota</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t *Tamer)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Command</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, a Speaker)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> action { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ActVoice: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a.Speaks() } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> }</code> </pre><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"animal"</span></span> <span class="hljs-string"><span class="hljs-string">"circus"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { d := &amp;animal.Dog{} t := &amp;circus.Tamer{} t2 := &amp;circus.Tamer{} t.Command(circus.ActVoice, d) <span class="hljs-comment"><span class="hljs-comment">// woof t.Command(circus.ActVoice, t2) // WAT? }</span></span></code> </pre><br>  Mmmm, I wonder is not it?  It seems our colleague is not thrilled that he became a pet in this context?  : D What to do?  Looks like <i>Speaker</i> is not a very appropriate abstraction here.  We will create a more suitable one (or rather, we will in some way return the first version from the <i>‚Äúwrong example‚Äù</i> ), after which we will change the method notation. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> circus <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Animal <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { Speaker } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t *Tamer)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Command</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, a Animal)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre><br>  It does not change anything, you say, the code will still be executed, since  Both interfaces implement one method, and you‚Äôll be right in general. <br><br>  However, this example allows you to catch an important idea.  When we talk about abstract data types, context is crucial.  The introduction of the new interface, at least, made the code an order of magnitude more obvious and readable. <br><br>  By the way, one of the ways to force the handler not to execute the <i>voice</i> command is simply to add a method that he should not have.  Let's add this method, it will give information about whether the pet is trainable. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> circus <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Animal <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { Speaker IsTrained() <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> }</code> </pre><br>  Now the tamer can not slip into the pet. <br><br><h3>  Expand behavior </h3><br>  Let's make our pets, for a change, execute other commands, besides, let's add a cat. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> animal <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Dog <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(d Dog)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsTrained</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(d Dog)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Speaks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"woof"</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(d Dog)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Jump</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"jumps"</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(d Dog)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Sit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"sit"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Cat <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c Cat)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsTrained</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c Cat)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Speaks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"meow!"</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c Cat)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Jump</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"meow!!"</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c Cat)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Sit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"meow!!!"</span></span> }</code> </pre><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> circus <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ( ActVoice = <span class="hljs-literal"><span class="hljs-literal">iota</span></span> ActSit ActJump ) <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Animal <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { Speaker IsTrained() <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Jump() <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Sit() <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t *Tamer)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Command</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, a Animal)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> action { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ActVoice: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a.Speaks() <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ActSit: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a.Sit() <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ActJump: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a.Jump() } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> }</code> </pre><br>  Great, now we can give different commands to our animals, and they will carry them out.  To one degree or another ...: D <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"animal"</span></span> <span class="hljs-string"><span class="hljs-string">"circus"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { t := &amp;circus.Tamer{} d := &amp;animal.Dog{} t.Command(circus.ActVoice, d) <span class="hljs-comment"><span class="hljs-comment">// "woof" t.Command(circus.ActJump, d) // "jumps" t.Command(circus.ActSit, d) // "sit" t2 := &amp;circus.Tamer{} c := &amp;animal.Cat{} t2.Command(circus.ActVoice, c) // "meow" t2.Command(circus.ActJump, c) // "meow!!" t2.Command(circus.ActSit, c) // "meow!!!" }</span></span></code> </pre><br>  Domestic cats, we are not particularly amenable to training.  Therefore, we will help the tamer and make sure that he does not suffer with them. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> circus <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t *Tamer)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Command</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, a Animal)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !a.IsTrained() { <span class="hljs-built_in"><span class="hljs-built_in">panic</span></span>(<span class="hljs-string"><span class="hljs-string">"Sorry but this animal doesn't understand your commands"</span></span>) } <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre><br>  That's better.  Unlike the initial <i>Animal</i> interface, which duplicates <i>Speaker</i> , we now have an <i>`Animal`</i> interface (which is essentially an abstract data type) that implements quite meaningful behavior. <br><br><h3>  Let's discuss the sizes of interfaces </h3><br>  Now let's think about the problem of how to use broad interfaces. <br><br>  This is a situation where we use interfaces with a large number of methods.  In this case, the recommendation goes something like this: <i>‚ÄúFunctions should accept interfaces that contain the methods they need‚Äù</i> . <br><br>  In general, I agree that the interfaces should be small, but in this case, the context again matters.  Let's return to our code and teach our tamer to <i>‚Äúpraise‚Äù</i> your pet. <br><br>  In response to praise, the pet will give a vote. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> circus <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t *Tamer)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Praise</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a Speaker)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a.Speaks() }</code> </pre><br>  It would seem that everything is fine, we use the minimum necessary interface.  There is nothing superfluous.  But here's the problem again.  Damn it, now we can <i>‚Äúpraise‚Äù</i> another coach and he <i>will give a voice</i> .  : D Do you catch it? .. Context always matters a lot. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"animal"</span></span> <span class="hljs-string"><span class="hljs-string">"circus"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { t := &amp;circus.Tamer{} t2 := &amp;circus.Tamer{} d := &amp;animal.Dog{} c := &amp;animal.Cat{} t.Praise(d) <span class="hljs-comment"><span class="hljs-comment">// woof t.Praise(c) // meow! t.Praise(t2) // WAT? }</span></span></code> </pre><br>  Why am I doing this?  In this case, the best solution would still be to use a wider interface (representing the abstract data type <i>‚Äúpet‚Äù</i> ).  Since we want to learn how to praise a pet, and not any creature that can make sounds. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> circus <span class="hljs-comment"><span class="hljs-comment">// Now we are using Animal interface here. func (t *Tamer) Praise(a Animal) string { return a.Speaks() }</span></span></code> </pre><br>  So much better.  We can praise the pet, but we can not praise the tamer.  The code again became simpler and more obvious. <br><br><h3>  Now a little about the Law of Bed </h3><br>  The last point I would like to touch is the recommendation that we should take an abstract type and return a specific structure.  In the original article, this reference is given in the section describing the so-called <a href="https://en.wikipedia.org/wiki/Robustness_principle">Postel's Law</a> . <br><br>  The author himself cites the law :. <br><blockquote>  ‚ÄúBe accept with you accept‚Äù </blockquote><br>  And interprets it in relation to the Go language <br><blockquote>  ‚ÄúGo‚Äù: ‚ÄúAccept interfaces, return structs‚Äù </blockquote> <code>func funcName(a INTERFACETYPE) CONCRETETYPE</code> <br> <br>  You know, in general, I agree, this is a good practice.  However, I once again want to emphasize.  Do not take it literally.  The devil is in the details.  As always, context is important. <br>  Not always the function should return a specific type.  Those.  if you need an abstract type, return it.  No need to try to rewrite code avoiding abstraction. <br><br>  Here is a small example.  An elephant appeared in the neighboring <i>‚ÄúAfrican‚Äù</i> circus, and you asked the owners of the circus to lend the elephant to a new show.  For you in this case it is important, only that the elephant is able to carry out all the same commands as other pets.  The size of the elephant or the presence of the trunk in this context does not matter. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> african <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"circus"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Elephant <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e Elephant)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Speaks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"pawoo!"</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e Elephant)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Jump</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"o_O"</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e Elephant)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Sit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"sit"</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e Elephant)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsTrained</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetElephant</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">circus</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Animal</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> &amp;Elephant{} }</code> </pre><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"african"</span></span> <span class="hljs-string"><span class="hljs-string">"circus"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { t := &amp;circus.Tamer{} e := african.GetElephant() t.Command(circus.ActVoice, e) <span class="hljs-comment"><span class="hljs-comment">// "pawoo!" t.Command(circus.ActJump, e) // "o_O" t.Command(circus.ActSit, e) // "sit" }</span></span></code> </pre><br>  As you can see, since we do not care about the specific parameters of the elephant that distinguish it from other pets, we can easily use abstraction, and returning the interface in this case would be quite appropriate. <br><br><h3>  Summarize </h3><br>  Context is extremely important when it comes to abstractions.  Do not neglect abstractions and are afraid of them, exactly the same way as they should not be abused.  Do not just take the recommendations as the rules.  There are approaches tried by time, there are approaches that have yet to be tested.  I hope I managed to expand a little deeper into the topic of using interfaces as abstract data types, and get away from the usual examples from the standard library. <br><br>  Of course, for some people this post may seem too obvious, and examples sucked from the finger.  For others, my thoughts may be controversial, and the arguments are inconclusive.  Nevertheless, someone may be inspired and start thinking a little deeper not only about the code, but also about the essence of things, as well as abstractions in general. <br><br>  The main thing, friends, is that you continuously develop and receive true pleasure from work.  All good! <br><br>  Ps.  Code samples and the final version can be found <a href="https://github.com/DexterHD/interfaces-example">on GitHub</a> . </div><p>Source: <a href="https://habr.com/ru/post/450386/">https://habr.com/ru/post/450386/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../450368/index.html">We get the absolute exchange rates from the paired cross-exchange rates</a></li>
<li><a href="../450372/index.html">How Amazon's algorithms determine who should fire</a></li>
<li><a href="../450374/index.html">RAM Expansion Board for Apple IIgs</a></li>
<li><a href="../45038/index.html">Test regular expressions in OnLine</a></li>
<li><a href="../450384/index.html">History of a little study of legacy code</a></li>
<li><a href="../450394/index.html">Investigation into one unknown archive</a></li>
<li><a href="../450398/index.html">The most fearless poisons</a></li>
<li><a href="../4504/index.html">Pensioners are being introduced into social networks</a></li>
<li><a href="../45040/index.html">Wonders of automation or how real geeks send SMS</a></li>
<li><a href="../45041/index.html">Work with ANSI console</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>