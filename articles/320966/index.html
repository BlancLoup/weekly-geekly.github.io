<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>CryptoAPI of the Linux kernel: development and application of Russian cryptography</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="CryptoAPI is an implementation of cryptographic algorithms that provide access to them from both the kernel itself and application software. The most ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>CryptoAPI of the Linux kernel: development and application of Russian cryptography</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/b5b/75f/bd1/b5b75fbd11004bd894befd43707fad63.png" align="left" alt="image">  CryptoAPI is an implementation of cryptographic algorithms that provide access to them from both the kernel itself and application software.  The most prominent representatives of this software are IPSEC (VPN) and dm-crypt (encrypted file system). <br><a name="habracut"></a><br>  The ultimate goal of this material will be to create an encrypted file system using Russian cryptographic algorithms: <br><br><ul><li>  Generating a hash value in accordance with the requirements of GOST R 34.11-94 / GOST R 34.11-2012 ‚ÄúInformation technology.  Cryptographic protection of information.  Hash function "; </li><li>  Encryption / decryption of data and calculation of simulator according to the requirements of GOST 28147-89 ‚ÄúInformation processing systems.  Cryptographic protection "; </li><li>  Encryption / decryption of data with Grasshopper encryption algorithms (Kuzmin, Nechaev and Company) and Magma in accordance with the requirements of GOST R 34.12-2015 Information technology.  Cryptographic protection of information.  Block ciphers "and" GOST R 34.13-2015 Information technology.  Cryptographic protection of information.  Modes of block ciphers. " </li></ul><br>  You can see which cryptographic algorithms can be used to create an encrypted file system by the following commands: <br><br><pre><code class="bash hljs">bash-4.3$ /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin64/cryptsetup benchmark <span class="hljs-comment"><span class="hljs-comment"># Tests are approximate using memory only (no storage IO). PBKDF2-sha1 620459 iterations per second PBKDF2-sha256 541619 iterations per second PBKDF2-sha512 357144 iterations per second # Algorithm | Key | Encryption | Decryption aes-cbc 128b 467,6 MiB/s 1686,1 MiB/s serpent-cbc 128b 74,5 MiB/s 264,4 MiB/s aes-cbc 256b 350,1 MiB/s 1333,8 MiB/s serpent-cbc 256b 74,2 MiB/s 265,3 MiB/s bash-4.3$ /usr/local/bin64/cryptsetup benchmark -caes-ecb # Tests are approximate using memory only (no storage IO). # Algorithm | Key | Encryption | Decryption aes-ecb 256b 1422,6 MiB/s 1437,6 MiB/s bash-4.3$</span></span></code> </pre> <br>  As you can see from this example, the AES encryption algorithm in CBC and ECB modes, as well as the hash functions sha1, sha256 and sha512 can be used to create an encrypted file system. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To switch to Russian cryptography, we need to add modules to the Linux kernel that implement hash according to GOST R 34.11-94, GOST R 34.11-2012 with a hash length of 256 bits (STRIBOG-256) and a hash length of 512 bits (STRIBOG-512). <br><br>  As encryption algorithms, GOST 28147-89 should be implemented, it is actually the Magma algorithm (GOST R 34.12-2015), as well as the Grasshopper algorithm (GOST R 34.12-2015).  For verification, CBC and ECB encryption modes will be used. <br><br>  As prototypes of these modules are considered modules aes-generic and shaxxx-generic.  Accordingly, for Russian cryptography the following modules should be implemented: <br><br><ul><li>  gosthash-generic (GOST K 34.11-94); </li><li>  stribog256-generic (GOST R 34.11-2012 with a hash length of 256 bits); </li><li>  stribog512-generic (GOST R 34.11-2012 with a hash length of 512 bits); </li><li>  gost-generic (GOST 28147-89, "Magma"); </li><li>  Kuznyechik-generic ("Grasshopper"). </li></ul><br>  The main question is where to get the implementation of Russian cryptographic algorithms?  One option is OpenSSL and support for GOST-s algorithms in engine gost.  However, until now, the implementation of GOST 28147-89 and GOST R 34.11-94 is supported only.  It is more acceptable to support Russian cryptographic algorithms in the <a href="https://habrahabr.ru/post/316736/">GCrypt-1.7.0</a> project <a href="https://habrahabr.ru/post/316736/">,</a> where there is already support for the Magma algorithm (GOST R 34.12-2015) and GOST R 34.11-2012 with a hash length of 256 bits (STRIBOG-256) and length 512-bit hash (STRIBOG-512). <br><br>  As for the "Grasshopper", the article on Habrahabr <a href="https://habrahabr.ru/post/312224">"GOST R 34.12-15 on SSE2, or the Grasshopper is Not So Bad"</a> will help here. <br><br>  Modules were built for the following Linux kernel: <br><br><pre> <code class="bash hljs">bash-4.3$ uname -sr Linux 4.4.39-desktop-1.mga5 bash-4.3$</code> </pre> <br>  Other kernels may require some changes.  We will show the assembly of CryptoAPI modules implementing Russian crypto-algorithms using the example of the stribog256-generic module (GOST R 34.11-2012 with a hash length of 256 bits). <br><br>  So, the Makefile: <br><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">obj</span></span>-m := stribog256_generic.o my-objs := stribog.o <span class="hljs-type"><span class="hljs-type">KDIR</span></span> := /lib/modules/$(shell uname -r)/build <span class="hljs-type"><span class="hljs-type">PWD</span></span> := $(shell pwd) <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: $(<span class="hljs-type"><span class="hljs-type">MAKE</span></span>) -<span class="hljs-type"><span class="hljs-type">C</span></span> $(<span class="hljs-type"><span class="hljs-type">KDIR</span></span>) <span class="hljs-type"><span class="hljs-type">M</span></span>=$(<span class="hljs-type"><span class="hljs-type">PWD</span></span>) modules clean: $(<span class="hljs-type"><span class="hljs-type">MAKE</span></span>) -<span class="hljs-type"><span class="hljs-type">C</span></span> $(<span class="hljs-type"><span class="hljs-type">KDIR</span></span>) <span class="hljs-type"><span class="hljs-type">M</span></span>=$(<span class="hljs-type"><span class="hljs-type">PWD</span></span>) clean install: $(<span class="hljs-type"><span class="hljs-type">MAKE</span></span>) -<span class="hljs-type"><span class="hljs-type">C</span></span> $(<span class="hljs-type"><span class="hljs-type">KDIR</span></span>) <span class="hljs-type"><span class="hljs-type">M</span></span>=$(<span class="hljs-type"><span class="hljs-type">PWD</span></span>) modules_install</code> </pre><br>  We also indicate the contents of the stribog256_generic catalog: <br><br><pre> <code class="bash hljs">bash-4.3$ ls rypto_mult_table.h hash_bit.h Makefile stribog256_generic.c stribog256.h stribog.c stribog.h bash-4.3$</code> </pre> <br>  To build a module, it is enough to enter the stribog256 directory and issue the make command: <br><br><pre> <code class="bash hljs">bash-4.3$ make make -C /lib/modules/4.4.39-desktop-1.mga5/build M=/home/a513/DM_CRYPT/dm-crypt/stribog256 modules make[1]:    ¬´/usr/src/kernel-4.4.39-desktop-1.mga5¬ª CC [M] /home/a513/DM_CRYPT/dm-crypt/stribog256/stribog256_generic.o ‚Ä¶ Building modules, stage 2. MODPOST 1 modules CC /home/a513/DM_CRYPT/dm-crypt/stribog256/stribog256_generic.mod.o LD [M] /home/a513/DM_CRYPT/dm-crypt/stribog256/stribog256_generic.ko make[1]:    ¬´/usr/src/kernel-4.4.39-desktop-1.mga5¬ª bash-4.3$</code> </pre><br>  The code for the stribog256_generic.c module looks like this: <br><br><div class="spoiler">  <b class="spoiler_title">The code for the stribog256_generic.c module looks like this:</b> <div class="spoiler_text"><pre> <code class="bash hljs">bash-4.3$ cat stribog256_generic.c</code> </pre> <br>  / <pre> <code class="cpp hljs">* * Cryptographic API. * * Stribog256 Secure Hash Algorithm. * * This program is <span class="hljs-built_in"><span class="hljs-built_in">free</span></span> software; you can redistribute it <span class="hljs-keyword"><span class="hljs-keyword">and</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">or</span></span> modify it * under the terms of the GNU General Public License as published by the Free * Software Foundation; either version <span class="hljs-number"><span class="hljs-number">2</span></span> of the License, <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (at your option) * any later version. * */ <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;linux/init.h&gt; #include &lt;linux/module.h&gt; #include &lt;linux/mm.h&gt; #include &lt;linux/types.h&gt; #include &lt;crypto/internal/hash.h&gt; #include "stribog256.h" #include "stribog.c" static int stribog256_init(struct shash_desc *desc) { struct stribog_ctx *sctx = shash_desc_ctx(desc); GOSTR3411_2012_256_Init(sctx); return 0; } int crypto_stribog256_update(struct shash_desc *desc, const u8 *data, u32 len) { struct stribog_ctx *sctx = shash_desc_ctx(desc); GOSTR3411_2012_Update(sctx, data, len); return 0; } EXPORT_SYMBOL(crypto_stribog256_update); /* Add padding and return the message digest. */ static int stribog256_final(struct shash_desc *desc, u8 *out) { struct stribog_ctx *sctx = shash_desc_ctx(desc); GOSTR3411_2012_256_Final(sctx, out); // Wipe context memset(sctx, 0, sizeof(*sctx)); return 0; } static int stribog256_export(struct shash_desc *desc, void *out) { struct stribog_ctx *sctx = shash_desc_ctx(desc); memcpy(out, sctx, sizeof(*sctx)); return 0; } static int stribog256_import(struct shash_desc *desc, const void *in) { struct stribog_ctx *sctx = shash_desc_ctx(desc); memcpy(sctx, in, sizeof(*sctx)); return 0; } static struct shash_alg alg = { .digestsize = STRIBOG256_DIGEST_SIZE, .init = stribog256_init, .update = crypto_stribog256_update, .final = stribog256_final, .export = stribog256_export, .import = stribog256_import, .descsize = sizeof(struct stribog_ctx), .statesize = sizeof(struct stribog_ctx), .base = { .cra_name = "stribog256", .cra_driver_name= "stribog256-generic", .cra_flags = CRYPTO_ALG_TYPE_SHASH, .cra_blocksize = STRIBOG_BLOCK_SIZE, .cra_module = THIS_MODULE, } }; static int __init stribog256_generic_mod_init(void) { return crypto_register_shash(&amp;alg); } static void __exit stribog256_generic_mod_fini(void) { crypto_unregister_shash(&amp;alg); } module_init(stribog256_generic_mod_init); module_exit(stribog256_generic_mod_fini); MODULE_LICENSE("GPL"); MODULE_DESCRIPTION("Stribog256 Secure Hash Algorithm"); MODULE_ALIAS_CRYPTO("stribog256"); MODULE_ALIAS_CRYPTO("stribog256-generic");</span></span></span></span></code> </pre> <br><pre> <code class="bash hljs">bash-4.3$</code> </pre> <br></div></div><br>  In a similar way, other modules are prepared and assembled: <br><br><pre> <code class="bash hljs">bash-4.3$ ls -C1 gost_generic.ko gosthash_generic.ko kuznyechik_generic.ko stribog256_generic.ko stribog512_generic.ko bash-4.3$</code> </pre><br>  Now they can be loaded into the system: <br><br><pre> <code class="bash hljs">bash-4.3<span class="hljs-comment"><span class="hljs-comment">#insmod ./ stribog256_generic.ko bash-4.3#</span></span></code> </pre> <br>  Now let's see what algorithms CryptoAPI supports: <br><br><pre> <code class="bash hljs">bash-4.3$ /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin64/cryptsetup benchmark <span class="hljs-comment"><span class="hljs-comment"># Tests are approximate using memory only (no storage IO). PBKDF2-sha1 679129 iterations per second PBKDF2-sha256 544431 iterations per second PBKDF2-sha512 355208 iterations per second PBKDF2-gosthash 138994 iterations per second PBKDF2-stribog256 123187 iterations per second PBKDF2-stribog512 91275 iterations per second # Algorithm | Key | Encryption | Decryption aes-cbc 128b 468,0 MiB/s 1700,7 MiB/s serpent-cbc 128b 74,0 MiB/s 266,9 MiB/s aes-cbc 256b 349,2 MiB/s 1349,4 MiB/s serpent-cbc 256b 72,8 MiB/s 259,1 MiB/s gost-cbc 256b 38,3 MiB/s 46,8 MiB/s kuznyechik-cbc 256b 3,6 MiB/s 3,2 MiB/s bash-4.3$</span></span></code> </pre> <br>  In order for GOST algorithms to appear during testing (benchmark parameter), it is enough to make changes to the following files in the cryptsetup utility: <br><br>  <b>1.</b> ./cryptsetup/src/cryptsetup.c (lines added for testing team only) <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *cipher; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *mode; <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> key_size; <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> iv_size; } bciphers[] = { { <span class="hljs-string"><span class="hljs-string">"aes"</span></span>, <span class="hljs-string"><span class="hljs-string">"cbc"</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span> }, { <span class="hljs-string"><span class="hljs-string">"serpent"</span></span>, <span class="hljs-string"><span class="hljs-string">"cbc"</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span> }, { <span class="hljs-string"><span class="hljs-string">"aes"</span></span>, <span class="hljs-string"><span class="hljs-string">"cbc"</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span> }, { <span class="hljs-string"><span class="hljs-string">"serpent"</span></span>, <span class="hljs-string"><span class="hljs-string">"cbc"</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/**/</span></span> { <span class="hljs-string"><span class="hljs-string">"gost"</span></span>, <span class="hljs-string"><span class="hljs-string">"cbc"</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span> }, { <span class="hljs-string"><span class="hljs-string">"gost"</span></span>, <span class="hljs-string"><span class="hljs-string">"ecb"</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span> }, { <span class="hljs-string"><span class="hljs-string">"gost"</span></span>, <span class="hljs-string"><span class="hljs-string">"crt"</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span> }, { <span class="hljs-string"><span class="hljs-string">"kuznyechik"</span></span>, <span class="hljs-string"><span class="hljs-string">"cbc"</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span> }, { <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> } };</code> </pre> <br>  <b>2.</b> ./cryptsetup/lib/crypto_backend/crypto_cipher_kernel.c <br><br><pre> <code class="bash hljs">static struct cipher_alg cipher_algs[] = { { <span class="hljs-string"><span class="hljs-string">"cipher_null"</span></span>, 16 }, { <span class="hljs-string"><span class="hljs-string">"aes"</span></span>, 16 }, { <span class="hljs-string"><span class="hljs-string">"serpent"</span></span>, 16 }, { <span class="hljs-string"><span class="hljs-string">"twofish"</span></span>, 16 }, { <span class="hljs-string"><span class="hljs-string">"anubis"</span></span>, 16 }, { <span class="hljs-string"><span class="hljs-string">"blowfish"</span></span>, 8 }, { <span class="hljs-string"><span class="hljs-string">"camellia"</span></span>, 16 }, { <span class="hljs-string"><span class="hljs-string">"cast5"</span></span>, 8 }, { <span class="hljs-string"><span class="hljs-string">"cast6"</span></span>, 16 }, { <span class="hljs-string"><span class="hljs-string">"des"</span></span>, 8 }, { <span class="hljs-string"><span class="hljs-string">"des3_ede"</span></span>, 8 }, { <span class="hljs-string"><span class="hljs-string">"khazad"</span></span>, 8 }, { <span class="hljs-string"><span class="hljs-string">"seed"</span></span>, 16 }, { <span class="hljs-string"><span class="hljs-string">"tea"</span></span>, 8 }, { <span class="hljs-string"><span class="hljs-string">"xtea"</span></span>, 8 }, /**/ { <span class="hljs-string"><span class="hljs-string">"gost"</span></span>, 8 }, { <span class="hljs-string"><span class="hljs-string">"kuznyechik"</span></span>, 8 }, { NULL, 0 } };</code> </pre> <br>  <b>3.</b> ./cryptsetup/lib/crypto_backend/crypto_kernel.c <br><br><pre> <code class="bash hljs">static struct hash_alg hash_algs[] = { { <span class="hljs-string"><span class="hljs-string">"sha1"</span></span>, <span class="hljs-string"><span class="hljs-string">"sha1"</span></span>, 20, 64 }, /**/ { <span class="hljs-string"><span class="hljs-string">"gosthash"</span></span>, <span class="hljs-string"><span class="hljs-string">"gosthash"</span></span>, 32, 64 }, { <span class="hljs-string"><span class="hljs-string">"stribog256"</span></span>, <span class="hljs-string"><span class="hljs-string">"stribog256"</span></span>, 32, 128 }, { <span class="hljs-string"><span class="hljs-string">"stribog512"</span></span>, <span class="hljs-string"><span class="hljs-string">"stribog512"</span></span>, 64, 128 }, { <span class="hljs-string"><span class="hljs-string">"sha256"</span></span>, <span class="hljs-string"><span class="hljs-string">"sha256"</span></span>, 32, 64 }, { <span class="hljs-string"><span class="hljs-string">"sha512"</span></span>, <span class="hljs-string"><span class="hljs-string">"sha512"</span></span>, 64, 128 }, { <span class="hljs-string"><span class="hljs-string">"ripemd160"</span></span>, <span class="hljs-string"><span class="hljs-string">"rmd160"</span></span>, 20, 64 }, { <span class="hljs-string"><span class="hljs-string">"whirlpool"</span></span>, <span class="hljs-string"><span class="hljs-string">"wp512"</span></span>, 64, 64 }, { NULL, NULL, 0, 0 } };</code> </pre><br>  You can not make these changes, but then you need to test the algorithms with an explicit indication of the cipher and mode (mode).  Moreover, this is the only way that we can check the GOST ciphers in ECB mode: <br><br><pre> <code class="bash hljs">bash-4.3$ /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin64/cryptsetup benchmark -cgost-ecb <span class="hljs-comment"><span class="hljs-comment"># Tests are approximate using memory only (no storage IO). # Algorithm | Key | Encryption | Decryption gost-ecb 256b 50,4 MiB/s 49,2 MiB/s bash-4.3$ /usr/local/bin64/cryptsetup benchmark -ckuznyechik-ecb # Tests are approximate using memory only (no storage IO). # Algorithm | Key | Encryption | Decryption kuznyechik-ecb 256b 3,4 MiB/s 3,2 MiB/s bash-4.3$# Tests are approximate using memory only (no storage IO). bash-4.3$ # Algorithm | Key | Encryption | Decryption aes-ecb 256b 1361,8 MiB/s 1381,5 MiB/s bash-4.3$</span></span></code> </pre> <br>  And so we dealt with the modules.  Now you can create a secure file system with encryption on GOST.  First, let's create a test.bin file: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># dd if=/dev/zero of=/tmp/test.bin bs=10M count=50 50+0   50+0    524288000  (524 MB), 0,44706 c, 1,2 GB/c [root@VOrlov_64 tmp]#</span></span></code> </pre> <br>  We will create the encrypted file system in this file: <br><br><pre> <code class="bash hljs">[root@VOrlov_64 tmp]<span class="hljs-comment"><span class="hljs-comment"># /usr/local/bin64/cryptsetup - kuznyechik-ecb -h stribog256 -y luksFormat /tmp/test.bin WARNING! ======== This will overwrite data on /tmp/test.bin irrevocably. Are you sure? (Type uppercase yes): YES Enter passphrase: 01234567 Verify passphrase: 01234567 [root@VOrlov_64 tmp]#</span></span></code> </pre> <br>  File system connection: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#cryptsetup luksOpen &lt;/&gt; volume1</span></span></code> </pre> <br>  And so we connect our secure FS to volume1: <br><br><pre> <code class="bash hljs">[root@VOrlov_64 tmp]<span class="hljs-comment"><span class="hljs-comment"># /usr/local/bin64/cryptsetup luksOpen /tmp/test.bin volume1 Enter passphrase for /tmp/test.bin: [root@VOrlov_64 tmp]#</span></span></code> </pre><br>  Next, we work with the device / dev / mapper / volume1 as with a regular hard disk partition. <br><br>  View file system settings: <br><br><pre> <code class="bash hljs">root@VOrlov_64 tmp]<span class="hljs-comment"><span class="hljs-comment"># /usr/local/bin64/cryptsetup status /dev/mapper/volume1 /dev/mapper/volume1 is active. type: LUKS1 cipher: kuznyechik-ecb keysize: 256 bits device: /dev/loop0 loop: /tmp/test.bin offset: 4096 sectors size: 1019904 sectors mode: read/write [root@VOrlov_64 tmp]#</span></span></code> </pre> <br>  After that, it is enough to create a file system (FS) on the device / dev / mapper / volume1: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#mkfs.ext4 /dev/mapper/volume1 #</span></span></code> </pre><br>  Mount the FS and work with it: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#mount /dev/mapper/volume1 /mount/TEST_DM_CRYPT_GOST #</span></span></code> </pre><br>  Everything, now we can create encrypted FSs in the GOST 28147-89 (aka GOST R 34.12-2015 Magma) and GOST R 34.12-2015 Grasshopper) in the CBC, ECB modes.  As a hashing algorithm, GOST R 34.11-94, stribog256 (GOST R 34.11-2012 256 bits) and stribog512 (GOST R 34.11-2012 512bit) can be used. </div><p>Source: <a href="https://habr.com/ru/post/320966/">https://habr.com/ru/post/320966/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../320956/index.html">Google publishes Chrome source code for iOS</a></li>
<li><a href="../320958/index.html">Game theory and poker. Counting the number of possible strategies</a></li>
<li><a href="../320960/index.html">CEF, ES6, Angular 2, TypeScript using .Net Core classes. Creating a cross-platform GUI for .Net using CEF</a></li>
<li><a href="../320962/index.html">Microservice architecture</a></li>
<li><a href="../320964/index.html">Matrix with ideas for startups</a></li>
<li><a href="../320968/index.html">Over the past year, users of ad blockers have become 30% more</a></li>
<li><a href="../320970/index.html">Powershell and stack depth</a></li>
<li><a href="../320972/index.html">A little Intel Xeon Phi can now get everyone</a></li>
<li><a href="../320974/index.html">On the state of affairs in the field of children's technical creativity. Immediate prospects</a></li>
<li><a href="../320976/index.html">Unconventional orientation of the PLO</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>