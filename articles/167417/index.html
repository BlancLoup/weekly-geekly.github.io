<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>GCC x86 how to reduce code size</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The times when programmers tried to squeeze the maximum out of the size of their application were irretrievably gone. The main reason is a significant...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>GCC x86 how to reduce code size</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/storage2/894/128/a59/894128a594ed9975b92943a42bda0324.jpg">  The times when programmers tried to squeeze the maximum out of the size of their application were irretrievably gone.  The main reason is a significant increase in the amount of RAM and disk space on modern computers.  Few people remember how when you downloaded an application from a cassette you could go to eat.  Or how it was possible to count the blinking of the drive, indirectly determining the size of the application.  Perhaps, only developers of software for embedded systems still care about the size of the code and the memory consumed.  Can tablets and smartphones bring developers back to the future? <br>  This article is designed to help software developers using the GCC compiler reduce the code size of their applications.  All data in the article was obtained using the x86 GCC compiler version 4.7.2 on the Fedora 17 operating system for the Intel Atom architecture. <br><a name="habracut"></a><br>  Quite a significant gain in terms of GCC size comes from dynamic linking (enabled by default).  How much dynamic linking gains from static depends heavily on the libraries used. <br>  Most often, when it comes to size optimization, the ‚Äú-Os‚Äù option is used.  Below is a table with the average geometric size code for a set of applications for smartphones and tablets. <br>  The results in the plate are shown relative to ‚Äú-Os‚Äù.  A smaller result indicates a smaller code size.  ‚Äú-M32, -mfpmath = sse, -march = atom‚Äù are included by default in all cases. <br><table border="1"><tbody><tr><td>  -O2 </td><td width="60">  <em><font color="#000000">6%</font></em> </td></tr><tr><td>  <strong>-O2 -flto</strong> </td><td width="60">  <strong><font color="#00aa00">-five%</font></strong> </td></tr><tr><td>  -Ofast </td><td width="60">  <em><font color="#000000">11.5%</font></em> </td></tr><tr><td>  -Ofast -flto </td><td width="60">  <em><font color="#000000">3%</font></em> </td></tr><tr><td>  -Ofast -funroll-loops </td><td width="60">  <em><font color="#000000">nineteen%</font></em> </td></tr><tr><td>  -Ofast -funroll-loops -flto </td><td width="60">  <em><font color="#000000">10.5%</font></em> </td></tr></tbody></table><br>  ‚Äú-Ofast‚Äù (or ‚Äú-O3‚Äù) and ‚Äú-funroll-loops‚Äù obviously increase the size of the code.  The ‚Äú-flto‚Äù option, due to a more aggressive function substitution (inline), should also increase the size of the code.  However, the result is the opposite.  Why? <br>  ‚Äú-Flto‚Äù makes it possible to remove unused functions.  A function can become such if it is not called in a specific application configuration or was completely and in all places of the call is substituted into the code.  In order to remove unused functions without ‚Äú-flto‚Äù you can use ‚Äú-ffunction-sections -Wl, - gc-sections‚Äù.  This technique gives a good result if the application uses internal static libraries. <br>  Is the application still too large?  There are some more techniques for reducing the size.  By default, GCC uses the ‚Äú-fasynchronous-unwind-tables‚Äù option, which increases the size of the EH (exception handling) section, even when compiling applications in the ‚ÄúC‚Äù language.  This makes debugging easier, but can significantly increase the size of the code.  To disable it, add ‚Äú-fno-asynchronous-unwind-tables‚Äù to the compilation options. <br>  ‚Äú-Wl, - strip-all‚Äù will tell the linker to remove all symbolic information.  This will make the debugging process even more difficult.  And yet, if the code size is critical, the option is acceptable. <br>  Below is a label reflecting the effect of adding: <br><ul><li>  ‚Äú-Ffunction-sections -Wl, - gc-sections‚Äù (+ garbage collector) </li><li>  ‚Äú-Ffunction-sections -Wl, -gc-sections -fno-asynchronous-unwind-tables‚Äù (+ without promotion tables) </li><li>  ‚Äú-Ffunction-sections -Wl, - gc-sections -fno-asynchronous-unwind-tables -Wl, - strip-all‚Äù (+ delete characters) </li></ul><br>  to various optimization options. <br><br>  The results in the plate are shown relative to ‚Äú-Os‚Äù.  A smaller result indicates a smaller code size.  ‚Äú-M32, -mfpmath = sse, -march = atom‚Äù are included by default in all cases. <br><br><table border="1"><tbody><tr><td></td><td>  default </td><td>  + garbage collector </td><td>  + without spin tables </td><td>  + delete characters </td></tr><tr><td>  <strong>-Os</strong> </td><td>  <font color="#000000">-</font> </td><td>  <strong><font color="#00aa00">-five%</font></strong> </td><td>  <strong><font color="#00aa00">-10.5%</font></strong> </td><td>  <strong><font color="#00aa00">-22,5%</font></strong> </td></tr><tr><td>  -O2 </td><td>  <em><font color="#000000">6%</font></em> </td><td>  <em><font color="#000000">0.5%</font></em> </td><td>  <strong><font color="#00aa00">-3.5%</font></strong> </td><td>  <strong><font color="#00aa00">-13.5%</font></strong> </td></tr><tr><td>  <strong>-O2 -flto</strong> </td><td>  <strong><font color="#00aa00">-five%</font></strong> </td><td>  <strong><font color="#00aa00">-five%</font></strong> </td><td>  <strong><font color="#00aa00">-eight%</font></strong> </td><td>  <strong><font color="#00aa00">-17%</font></strong> </td></tr><tr><td>  -Ofast </td><td>  <em><font color="#000000">11.5%</font></em> </td><td>  <em><font color="#000000">6%</font></em> </td><td>  <em><font color="#000000">2%</font></em> </td><td>  <strong><font color="#00aa00">-</font> <font color="#00aa00">6.5%</font></strong> </td></tr><tr><td>  -Ofast -flto </td><td>  <em><font color="#000000">3%</font></em> </td><td>  <em><font color="#000000">2.5%</font></em> </td><td>  <em><font color="#000000">0.5%</font></em> </td><td>  <strong><font color="#00aa00">-6.5%</font></strong> </td></tr><tr><td>  <em>-Ofast -funroll-loops</em> </td><td>  <em><font color="#000000">nineteen%</font></em> </td><td>  <em><font color="#000000">12.5%</font></em> </td><td>  <em><font color="#000000">9.5%</font></em> </td><td>  <em><font color="#000000">3%</font></em> </td></tr><tr><td>  <em>-Ofast -funroll-loops -flto</em> </td><td>  <em><font color="#000000">10.5%</font></em> </td><td>  <em><font color="#000000">ten%</font></em> </td><td>  <em><font color="#000000">8.5%</font></em> </td><td>  <em><font color="#000000">2.5%</font></em> </td></tr></tbody></table><br>  Below is a description of the compiler options used in the article.  Full description (in English): <a href="http://gcc.gnu.org/onlinedocs/gcc-4.7.2/gcc/Optimize-Options.html">gcc.gnu.org/onlinedocs/gcc-4.7.2/gcc/Optimize-Options.html</a> <br><ul><li>  "-Ofast" is similar to "-O3 -ffast-math" includes a higher level of optimizations and more aggressive optimizations for arithmetic calculations (for example, real reassociation) </li><li>  "-flto" intermodule optimizations </li><li>  "-m32" 32bit mode </li><li>  "-mfpmath = sse" includes using XMM registers in real arithmetic (instead of real stack in x87 mode) </li><li>  "-funroll-loops" includes looping </li><li>  "-ffunction-sections" places each function in a separate section </li><li>  "-Os" optimizes performance and size </li><li>  "-fno-asynchronous-unwind-tables" guarantees the accuracy of spin tables only within the limits of the function </li></ul><br>  Below is a description of the linker options used in the article.  Full Description (in English): <a href="http://sourceware.org/binutils/docs/ld/Options.html">sourceware.org/binutils/docs/ld/Options.html</a> <br><ul><li>  ‚Äú--Gc-sections‚Äù includes removing unused sections </li><li>  ‚Äú--Strip-all‚Äù removes symbolic information </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/167417/">https://habr.com/ru/post/167417/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../167403/index.html">How to transfer data to 54 kilometers, if there is no 220V in the closet?</a></li>
<li><a href="../167407/index.html">11 important things you need to know about DevOps - part two</a></li>
<li><a href="../167411/index.html">The $ 1M grants line has been awarded to Russian startups by the Microsoft Seed Fund</a></li>
<li><a href="../167413/index.html">Briefly about the new: Samsung Music Hub service will be available on all Android devices</a></li>
<li><a href="../167415/index.html">Blah blah blah - book and guide to action</a></li>
<li><a href="../167419/index.html">Semantic Web technologies for integrating information systems</a></li>
<li><a href="../167423/index.html">DeltaMaker - another 3D printer</a></li>
<li><a href="../167427/index.html">300 screens, one admin - how Digital Signage works</a></li>
<li><a href="../167431/index.html">New PHP extension allows you to add arbitrary methods to scalars</a></li>
<li><a href="../167437/index.html">Creating a sprite engine</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>