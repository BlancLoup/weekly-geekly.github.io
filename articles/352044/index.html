<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We found a large company that has not been engaged in information security for 5 years and is still alive</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="About 5-6 years ago, there was a really cool admin who set up the network like a clock and equipped him with modern at that time equipment of the econ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We found a large company that has not been engaged in information security for 5 years and is still alive</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/7f/zq/cg/7fzqcg-ccsvools5qpqocd5ks1g.jpeg"></div><br>  About 5-6 years ago, there was a really cool admin who set up the network like a clock and equipped him with modern at that time equipment of the economy segment.  The administrator compensated for the lack of budget with good configs and proper architecture.  In general, it is clear that a lot of work has been done. <br><br>  Then the company split into two, expanded, it all changed a couple of times - and during all this time the network was supported with crutches.  Since IT is not our client‚Äôs core business, the situation is generally clear.  It is such a lot where, <b>but so that a large network (geographically distributed company, dozens of branches) lasted 5 years in this form - I have never seen anything like it.</b> <br><br>  Actually, it did not last.  We were called to conduct an audit of the network infrastructure after a recorded hacking case, when their databases with all the information representing commercial secrets were simply downloaded.  More precisely, the wrong people have surfaced. <br><a name="habracut"></a><br>  Circumstances, parts of topology and other details are slightly modified, so that you can not know the customer.  Nevertheless, the post is based on real events and is as close to reality as our security guards allowed. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The company represents the main production (server node in the same place) and dozens of branches throughout the country.  The branches have thin clients installed that go through VPN + RDP to the server node, where users work.  The branches also have equipment that uses the services and databases of the central site.  If the connection disappears in the branch, then it simply dies before connecting the network again. <br><br>  Network - several dozen prehistoric switches, dust-covered ‚Äúblunt‚Äù routers and MPLS L3 VPN-interface from the provider for transferring data between sites. <br><br><h3>  Root switch in another company </h3><br>  As I said, the company was divided into two independent and slightly competing a few years ago.  So, the network parts remained common, because then they decided not to break.  Strange, but logical result: the root switch belongs to competitors.  Users of competitors can send jobs to network printers, admin competitors - with some effort to watch their network balls and so on.  Servers with archive of video surveillance in general are still common.  Lab mini cluster - too.  Iiii ... <br><br><h3>  No firewall! </h3><br>  Networks are not demarcated.  More precisely, like: at the junction there is an old piece of hardware, which until the advent of firewalls of the new generation was used also for protection.  In fact, it works as a simple statefull firewall.  Traces of a normal config were found on it, which were commented out, because, apparently, at some point they prevented the development of the network. <br><br><h3>  Common problems </h3><br>  Here are excerpts from the report: <br><br><ul><li>  With the current settings of the switches, the network infrastructure is vulnerable both to attacks on the active network equipment itself: DoS / DDoS, unauthorized access, and to attacks on user traffic and server equipment: DoS / DDoS attacks, traffic interception attacks by spoofing MAC and IP addresses, attacks on the DHCP service. </li><li>  To prevent unauthorized access to active network equipment, you need to configure centralized authentication and authorization, and also restrict the IP addresses of devices from which administrators can establish management connections to devices. </li><li>  To prevent unauthorized access to the network and attacks on active network equipment and devices on the network, you must turn off unused interfaces and put them into an unused VLAN. </li><li>  To prevent attacks on the DHCP service and subsequent traffic compromise, you must use the DHCP snooping functionality. </li><li>  To prevent attacks on the substitution of MAC-addresses and attacks on the switching tables of switches with the subsequent traffic compromise, it is necessary to use the port-security functionality. </li><li>  To prevent attacks aimed at redirecting traffic by sending malicious ARP responses, you must use Dynamic ARP Inspection functionality. </li><li>  To prevent attacks on switches and user traffic, you must use the spanning-tree BPDUguard functionality. </li><li>  To prevent DoS and DDoS attacks on the network infrastructure, as well as in connection with the probability of occurrence of switching loops, it is necessary to use the storm control functionality (unicast, broadcast, multicast). </li><li>  The site uses outdated switch models with outdated OS versions.  It is recommended to upgrade the OS versions on the switches, but even after that these switches will not be able to provide the necessary data network security at the second level of the OSI model. </li><li>  Communication with other sites and Internet access on this site depend on the network infrastructure of another company.  It is recommended to connect to service providers on the local root switch. </li><li>  The network has a number of foreign devices that are in the guest VLAN.  With end-device support, the dot1x supplicant functionality needs to configure for all these devices dot1x authentication with assigning VLANs and dynamic access control lists that restrict traffic from these devices.  If this functionality is not supported by end devices, it is recommended to configure access control and port-security lists as well as QoS policing on the switch interfaces to limit the amount of allowed traffic. </li><li>  As access points, devices are used that do not support centralized authentication by administrators that allow connections using the HTTP protocol as well as via HTTPS based on the SSL v1 protocol. </li><li>  SSIDs are advertised in broadcast mode, it is recommended to declare them hidden. </li><li>  WPA2 keys used for authentication coincide both for the internal SSID and for the guest, and are 10 letters of the Latin alphabet (the name of the founder). </li><li>  The current IPsec VPN settings on the IKE router on Phase 1 and 2 use 3DES as the encryption algorithm, MD5 as the authentication algorithm, and DH 2. We recommend using AES-256, SHA-512 and higher, and DH 19 and higher.  You must also enable PFS functionality with a group of DH 19 or higher. </li></ul><br>  OpenVPN remote access (Debian Linux 8).  Depending on the connection port, different routes are returned to different clients as split-tunneling, thus implicitly allowing access only to certain networks for remote connection.  But the client can manually register additional routes to the logical tunnel created when connecting to the OpenVPN server, thus having the opportunity to route traffic to any company networks. <br><br>  Traffic from users and servers at all sites is transmitted to the Internet and from the Internet via routers, without being tested and inspected by modern firewalls and intrusion prevention systems.  Also, this traffic in most cases is either unlimited or almost unlimited.  In this regard, devices, applications and company data are practically not protected from a number of attacks that can be used against the company.  These are attacks that exploit application and operating system vulnerabilities, DoS and DDoS attacks on servers, applications and active network equipment of a company, attacks on company users' data using viruses and network worms, etc.  All company traffic transmitted from or to public networks, as well as traffic between different sites of the company and traffic between the company and its partners, should be limited and tested by the latest generation of firewalls and intrusion prevention systems.  Due to the high cost of such solutions, it is advisable to use a centralized device pair (for fault tolerance) in the central office and route traffic from all sites to the Internet and to other company sites through these devices. <br><br><h3>  How was the audit going? </h3><br>  Stage one.  I sent the customer questionnaires and asked them to fill out before I work.  The questionnaires were in the format of doc-files and Excel plates, the amount of information depended on the objects.  On some equipment there was a lot of information, on some - on zeros.  In general, filling out such questionnaires is a standard procedure, there are indicated IP-addresses, the number of servers, where, what and how, and so on. <br><br>  Not all IT people involved in the network configuration process were full-time employees of the customer, there was also outsourcing support.  OpenVPN to me was configured just by the external engineer.  I asked him to give me remote access and configuration files.  There are no special problems.  The information I received during the week, after connected to the equipment.  If there were questions, solved them with the local administrator.  Several sections of Linux configurations met several times, and in order to understand them, I had to connect my colleagues.  These were traces of the very mythical admin who launched everything like a clock many years ago. <br><br>  In the second stage, I requested the configuration of the proxy server and the OpenSSL VPN server, which I subsequently analyzed.  It took about another week. <br><br>  Stage Three.  Climbed on all the "glands" and looked.  This is an optional procedure in such an audit.  In principle, everything should be in the configuration file.  However, there are some things that you can‚Äôt see so easily.  Part of the "iron" was turned off, part of the documents sent showed the default settings, rather than the actual.  The list of these settings, no one led, they are not indicated anywhere.  Therefore, it was better to check everything manually.  He did.  Each interface equipment of any vendor keeps statistics of received and sent traffic.  If the statistics are zero, it is clear that the equipment is not used and it can be turned off.  There were also interfaces that had counters that were not zero, but nothing was connected to the equipment.  I reset the traffic counters and checked whether the number of bytes increased through the interface or not.  If after two weeks nothing was transmitted through this interface, then a preliminary conclusion can be made that it was not used. <br><br>  I also watched what protocols are, how authentication is configured.  Conducted a full audit for each piece of hardware: remote access protocols, setting up protocols, authentication, authorization, whether the interfaces are turned on / off, NAT, Wi-Fi - everything.  Access lists on routers are very important.  Either there were none, or they were very basic.  It took three weeks along with the design of the reports.  And, yes, I also checked the OS, firmware versions, can I upgrade and get more modern functionality, is there a suitable version. <br><br>  The fourth stage - aggregated information and made recommendations for each piece of hardware. <br><br><h3>  How did they survive? </h3><br>  Most likely - according to the principle of the Elusive Joe.  5 years of luck ended with a burglary, about which it became known.  Much more interesting - how in the past five years have they not picked up another epidemic of blockers or have not caught the miners or the occasional DDoS that would have ‚Äúlaid‚Äù them? <br><br>  In general, I can say that small companies (especially different industries in distant regions) live this way.  Even private banks are small, sometimes they work that way, colleagues told such stories.  But to a company of this size and with such a turnover is very strange.  Elementary, all competitors must be gentlemen, so as not to put their infrastructure one left. <br><br><h3>  What ended the story </h3><br>  They are buying modern corporate equipment again.  There will be a pair of firewalls, there will be new, more functional routers, there will be correct settings and rules for allowed traffic.  Routing access to the Internet will go through the main server node for the entire country, because a couple of firewalls are only there.  Already, they have closed all unused ports and generally updated the settings.  Update firmware where possible. <br><br>  The new switches will have centralized authentication, logging, and delineation of user management rights.  Support will finally have different accounts - now they are working one at a time.  If you now remove the config and reboot the device, then no one will know who it was. <br><br>  After that, they will slowly save for DLP and other features. <br><br><h3>  Links </h3><br><ul><li>  <a href="https://habrahabr.ru/company/croc/blog/328958/">IB through microsegmentation</a> </li><li>  <a href="https://habrahabr.ru/company/croc/blog/306674/">How we built a new Aeroexpress network</a> </li><li>  <a href="https://habrahabr.ru/company/croc/blog/236411/">Targeted attacks and defense</a> </li><li>  My mail is ASigachev@croc.ru </li></ul></div><p>Source: <a href="https://habr.com/ru/post/352044/">https://habr.com/ru/post/352044/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../352034/index.html">How we model the subject area in second-order predicates and do not notice this</a></li>
<li><a href="../352036/index.html">Presented by Jenkins X for CI / CD cloud applications at Kubernetes</a></li>
<li><a href="../352038/index.html">How we won the mess with iron and became bureaucrats from scratch</a></li>
<li><a href="../352040/index.html">Seminar ‚ÄúHow does ERP live in the cloud? Experience, scripts, rakes ", March 29, St. Petersburg</a></li>
<li><a href="../352042/index.html">As in 2009, we began to build a cloud, and where we made a mistake</a></li>
<li><a href="../352048/index.html">Hackathon Design</a></li>
<li><a href="../352050/index.html">Reverse "Neuromant". Part 1: Sprites</a></li>
<li><a href="../352052/index.html">Linux containers: isolation as a technological breakthrough</a></li>
<li><a href="../352054/index.html">How do we predict the end date and project evaluation using a neural network?</a></li>
<li><a href="../352056/index.html">Why does the Heap32Next () function work so slowly on Windows 7?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>