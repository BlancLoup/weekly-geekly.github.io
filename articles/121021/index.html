<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SRP-6: authentication without sending a password</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As promised in the next topic , where the bike was told, I post the description of the SRP RFC2945 algorithm - the method of registering and authentic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SRP-6: authentication without sending a password</h1><div class="post__text post__text-html js-mediator-article">  As promised in the <a href="http://habrahabr.ru/blogs/web_security/120876/">next topic</a> , where the bike was told, I post the description of the SRP <a href="http://www.ietf.org/rfc/rfc2945.txt">RFC2945</a> algorithm - the method of registering and authenticating users in a secure way over an insecure channel.  That's just in the process of preparing the article, I discovered a more recent version of the protocol, <a href="http://srp.stanford.edu/design.html">SRP-6</a> , along with the implementation, and therefore decided to throw away my archaic developments on SRP-3, and just give references to the implementation of the new version. <br><a name="habracut"></a><br>  The Secure Remote Password (SRP) protocol describes the establishment of a secure connection using a login and password pair for authentication, in which the password is used only during the registration and authentication phase and only on the client side.  Due to the use of a scheme close to Diffie-Hellman, SRP provides secure user password authentication without the need to transfer this password, and even having a complete exchange record over the channel, we do not receive sufficient information to authenticate this user.  Also, if the server is compromised and the entire database of logins from the server side flows ‚Äúto the people‚Äù, the attacker will not be able to authenticate any of the users.x <br><br>  So, the general scheme of user authentication using abbreviated SRP exchanges is as follows: <br><ul><li> Selected for work "security field": <br> <code><a href="http://en.wikipedia.org/wiki/Safe_prime">H =   ,     . <br> N = " </a> " = 2*q+1 ,  q   . <br> g =    N =&gt;   0 &lt; X &lt; N    x ,  g^x % N = X. <br> k = -.  SRP-6a  H(N, g);  SRP-6  3</code> </li> <li>  Upon registration, the client calculates the following: <br> <code>s = random_string() <br> x = H(s, p) <br> v = g^x % N</code> <br>  And it sends three fields to the server: <br> <code>I = username <br> s = salt <br> v = password verifier</code> <br>  With the right choice of <code>g</code> and <code>N</code> , the transfer of this data is quite safe - from them it is computationally difficult to obtain p. <br>  Security is provided by the complexity of the <a href="http://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B8%25D1%2581%25D0%25BA%25D1%2580%25D0%25B5%25D1%2582%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BB%25D0%25BE%25D0%25B3%25D0%25B0%25D1%2580%25D0%25B8%25D1%2584%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">discrete logarithm</a> operation ‚Äî obtaining <code>x</code> from <code>v=g^x%N</code> knowing <code>v, g, N</code> <br>  Due to this, even if the user base (hi, Sony!) Is merged from the server, it will be impossible to get passwords, or to introduce yourself as a user. <br>  However, it should be noted that if the user base is merged, then the protocol ceases to be protected from the attacker's representation by the _server_.  That is, this method does not guarantee the client that the server is who he claims to be.  However, the Man-In-The-Middle attack remains impossible - the attacker cannot (computationally difficult) get the K session key shared with the server. </li><li>  User: <br> <code>I = username <br> a = random() <br> A = g^a % N</code> <br>  A pair of login <code>I</code> and computed <code>A</code> sent to the server. <br>  The server should check and make sure that A! = 0. </li><li>  The server gets two numbers from its zagashnikov that correspond to the login: <br> <code>s = ,   </code> <br> <code>v =  ,   </code> <br>  It then generates a random number <code>b</code> , and calculates <br> <code>B=(k*v + g^b % N) % N</code> <br>  A pair of salt <code>s</code> and calculated <code>B</code> sent to the client. <br>  The client must check at this point that <code>B != 0</code> . </li><li>  Both sides compute the scrambler: <br>  <code>u = H(A, B)</code> . <br>  If u == 0, the connection is interrupted. </li><li>  The client enters his password <code>p</code> , on the basis of which the common session key is calculated: <br> <code>x = H(s, p) <br> S = ((B - k*(g^x % N)) ^ (a + u*x)) % N <br> K = H(S)</code> </li> <li>  For its part, the server also calculates the common session key: <br> <code>S = ((A*(v^u % N)) ^ b) % N <br> K = H(S)</code> </li> <li>  From this point on, if the client and the server both ___ know each other, there is an identical K number in both. <br>  To prove to each other that they themselves are evil Pinocchio, a second round of exchange takes place. <br>  The client generates a confirmation: <br> <code>M = H( H(N) XOR H(g), H(I), s, A, B, K)</code> <br>  and sends to the server. <br>  The server itself calculates M using its copy of K, and checks the equality.  If they are equal, then the client has exactly the same K, and, therefore, the client is who he claims to be.  If not equal - the connection is interrupted, WITHOUT sending to client R. <br>  If they are equal, then to prove to the client now that he is not a camel, he sends back his confirmation to him: <br> <code>R = H( A, M, K )</code> <br>  The client similarly calculates R in itself using the K calculated in itself, and compares it with that received from the server. </li></ul><br>  As a result, the authentication process requires 2 requests to the server and the presence of any software client on the user side.  Once again I pay attention, on first of all protection from server side.  The server gives as little information as possible, producing first checks at home.  Therefore, an attacker who has s and v <u>may</u> present himself as a server, but cannot be an <u>intermediary</u> . <br><br>  To implement the login, you can use the classic login form + password, onSubmit which is authenticated. <br>  If there is no javascript on the client side, the form will be sent ‚Äúas is‚Äù, which will transmit the password via an insecure channel, but will allow you to authenticate even from ‚Äústupid‚Äù clients (by simulating all the actions of the ‚Äúuser‚Äù on the server). <br>  In the case of the presence of JS, authentication is implemented by sending two special forms using AJAX techniques, performing calculations between them. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      However, if the site is not required to work without JS (for example, a fallback is not possible at all, too complicated, we don‚Äôt drag on the time and effort of developers), it seems to me more reasonable to implement such a scheme: the fields are not in shape at all, after from the login field, the password field is blocked for a while, and the ajax spinner is drawn next to it.  After receiving the salt for the user from the server, the password field is unlocked and you can enter the password there. <br>  The sense in separation is necessary to give JS time for calculations.  Still, there is quite a lot of mathematics with large numbers.  When I investigated this question on SRP-3 using SHA1 (about five years ago), using 512bit keys turned out to be too slow - up to 30 seconds to calculate to confirm the password.  At the same time, the entire browser UI [especially IE6;)] is blocked for the duration of the calculation.  The solution could be calculations using a continuation (starting the calculation in slices via setTimeout (), keeping the context between calls) or taking calculations in flash / java.  And java is preferable in terms of computation speed, and flash in terms of the likelihood of accessibility by the user. <br><br>  The important point is that the server can respond with salt to any username given to it, in order not to give information about the existence of the specified user in its database, but then the salt for non-existent users should be calculated using an algorithm based on username, and this algorithm should be saved in secret, or to be unrepeatable without any secret information on the server side.  Simply put, it is necessary that the salt based on the username cannot be distinguished from the completely random salt of real users. <br><br>  Another very important to understand that the algorithm does not protect against phishing.  A fake website can easily produce an identical-looking page, which will also have login and password fields, up to simulation simulation, calculating, for example, the sum of a series of numbers from 1 to 1e12 through a <a href="http://habrahabr.ru/blogs/programming/120665/">one-liner</a> , actually sending the password ‚Äúas is‚Äù to the attacker's server .  That is why it seems to me that using a signed Java authenticator is more attractive - when faking, it will be necessary to simulate the signature on the authorizer's Java applet ... That, in general, using human laziness and inattention is still possible. <br><br>  Ready-made implementations of SRP on JS can be found at the links: <br><ul><li>  <a href="http://srp.stanford.edu/demo/">SRP JavaScript Demo</a> implementation of both sides on JS, for research "what's going on."  Uses SHA1, which, of course, cannot <a href="http://www.schneier.com/blog/archives/2005/02/sha1_broken.html">be used</a> in living systems. </li><li>  <a href="http://code.google.com/p/srp-js/">SRP-JS on GoogleCode</a> with Django backend </li><li>  <a href="http://sourceforge.net/projects/clipperz">Javascript Crypto Library</a> </li></ul><br>  Read more on the topic can and should: <br><ul><li>  <a href="http://srp.stanford.edu/">The Stanford SRP Homepage</a> </li><li>  <a href="http://en.wikipedia.org/wiki/Secure_Remote_Password_protocol">SRP in Wikipedia</a> </li><li>  <a href="http://tools.ietf.org/html/rfc2945">RFC2945</a> describing SRP-3 (obsolete) </li><li>  <a href="http://grouper.ieee.org/groups/1363/passwdPK/index.html">IEEE P1363.2: Password-Based Public-Key Cryptography</a> , which includes SRP </li><li>  <a href="http://www.intuit.ru/department/security/networksec/7/3.html">Diffie-Hellman algorithm</a> </li><li>  <a href="http://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B8%25D1%2581%25D0%25BA%25D1%2580%25D0%25B5%25D1%2582%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BB%25D0%25BE%25D0%25B3%25D0%25B0%25D1%2580%25D0%25B8%25D1%2584%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">Discrete logarithm</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/121021/">https://habr.com/ru/post/121021/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../121013/index.html">Ukrnames joined the ICANN New Cyrillic TLD Working Group</a></li>
<li><a href="../121014/index.html">Diablo III Mouse and Headphones</a></li>
<li><a href="../121015/index.html">Apache Help - on the website of the President of Ukraine</a></li>
<li><a href="../121016/index.html">Sexual issue</a></li>
<li><a href="../121018/index.html">PS3 and PlayStation Vita let you play non-stop</a></li>
<li><a href="../121022/index.html">Determining the area of ‚Äã‚Äãa complex figure using probability theory</a></li>
<li><a href="../121024/index.html">Skyrim presentation at E3</a></li>
<li><a href="../121025/index.html">Dev Derby - monthly demos contest</a></li>
<li><a href="../121028/index.html">Presentation of World of Tanks at E3</a></li>
<li><a href="../121029/index.html">Kana-captcha for PHP - it's easy!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>