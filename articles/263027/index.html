<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The principle of separation of responsibility and ORM</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I would like to discuss the principle of separation of responsibility (Separation of Concerns, SoC) in the context of ORM, and also to see why this pr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The principle of separation of responsibility and ORM</h1><div class="post__text post__text-html js-mediator-article">  I would like to discuss the principle of <a href="https://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B0%25D0%25B7%25D0%25B4%25D0%25B5%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%25BE%25D1%2582%25D0%25B2%25D0%25B5%25D1%2582%25D1%2581%25D1%2582%25D0%25B2%25D0%25B5%25D0%25BD%25D0%25BD%25D0%25BE%25D1%2581%25D1%2582%25D0%25B8">separation of responsibility</a> (Separation of Concerns, SoC) in the context of ORM, and also to see why this principle is so important.  We will also consider examples of violations of the boundaries of responsibility between the domain logic and the logic of data preservation. <br><a name="habracut"></a><br><h2>  Principle of sharing responsibility </h2><br>  In each application we deal with several concepts (concerns).  At least three of them are usually well defined: UI, business logic and database.  The principle of separation of responsibility is closely related to the Single Responsibility Principle (SRP).  You can think of SoC as SRP applied not to a single class, but to the entire application.  In most cases, these two principles can be used interchangeably. <br><br>  In the case of ORM, the principle of SoC refers to the separation of the logic of the subject (domain) domain and the logic of storing data in the database.  We can argue that the application code has a good degree of separation of responsibilities if the domain classes in it do not know how they are stored in the database.  Of course, it is not always possible to achieve a complete separation of these two areas of the application.  Sometimes the performance requirements are such that you have to violate these boundaries.  But in any case, it is always worth striving for as complete a division of responsibility as possible. <br><br>  And of course, we cannot just separate the domain logic of the application from the logic of storing data in the database, we need something that connects them together.  This is where ORM helps us.  The ORM mediates between the domain model code and the database.  In most cases, the ORM is able to do this in such a way that neither the domain code, nor the database is aware of the existence of each other. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f08/e1d/de5/f08e1dde5c9c3e3a8879dc23482940ad.png" alt="image"></div><br><br><h2>  Why is SoC important? </h2><br>  There is a lot of information on how to maintain a good degree of separation of responsibilities.  But why is this important? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aa2/5fa/782/aa25fa78282546deff8669f3a33d7cb5.png" alt="image"></div><br><br>  While maintaining different responsibilities in a single class, we have to code-hold their consistency simultaneously with each operation within this class.  This very quickly leads to a combinatorial explosion.  Moreover, the complexity of the application is growing much faster than most developers think.  Each additional responsibility increases the class complexity by an order of magnitude. <br><br>  To cope with all this complexity, we need to share these responsibilities: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/649/a61/26b/649a6126b0a5891326168f5ea6caf762.png" alt="image"></div><br><br>  SoC is not just a matter of good or beautiful code.  The principle of SoC is vital to maintaining an acceptable development speed.  Moreover, it is important for the success of your project. <br><br>  A person can hold <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B0%25D0%25B3%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25BE%25D0%25B5_%25D1%2587%25D0%25B8%25D1%2581%25D0%25BB%25D0%25BE_%25D1%2581%25D0%25B5%25D0%25BC%25D1%258C_%25D0%25BF%25D0%25BB%25D1%258E%25D1%2581-%25D0%25BC%25D0%25B8%25D0%25BD%25D1%2583%25D1%2581_%25D0%25B4%25D0%25B2%25D0%25B0">no more than nine objects at a time</a> in short-term memory.  An application without a clear division of responsibilities very quickly overwhelms the developer‚Äôs short-term memory due to the sheer number of combinations in which different undivided concepts can interact with each other. <br><br>  Splitting these concepts into highly related parts allows you to ‚Äúdivide and conquer‚Äù over the application you are developing.  It is much easier to manage the complexity of a small, isolated component that is loosely coupled with other components of the application. <br><br><h2>  When the logic of saving data in the database penetrates the domain logic </h2><br>  Let's look at examples in which the logic of data preservation penetrates into the lock domain. <br><br>  <b>Example 1: Working with the persistent status of an object in a domain model class.</b> <br><br><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoWork</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Customer customer, MyContext context</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (context.Entry(customer).State == EntityState.Modified) { <span class="hljs-comment"><span class="hljs-comment">// Do something } }</span></span></code> </pre> <br>  The current persistent state of the object (that is, whether it already exists in the database or not) has nothing to do with the logic of the domain model.  Ideally, domain objects should operate only with data that directly relates to the business logic of the application. <br><br>  <b>Example 2: Working with IDs</b> <br><br><pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> DoWork(Customer customer1, Customer customer2) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (customer1.Id &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { // <span class="hljs-keyword"><span class="hljs-keyword">Do</span></span> something } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (customer1.Id == customer2.Id) { // <span class="hljs-keyword"><span class="hljs-keyword">Do</span></span> something } }</code> </pre><br>  Working with identifiers in domain classes is perhaps the most common type of mixing different types of application responsibilities.  Identifiers are <a href="http://enterprisecraftsmanship.com/2014/12/27/dont-use-ids-domain-entities/">part of the implementation</a> of how your objects are stored in the database.  As a rule, they are used to compare objects with each other.  If you also use them for this purpose, a much better solution would be to override the comparison operators (equality members) in the <a href="http://enterprisecraftsmanship.com/2014/11/08/domain-object-base-class/">base class of the domain object</a> and write 'customer1 == customer2' instead of 'customer1.Id == customer2.Id'. <br><br>  <b>Example 3: The separation of properties of a domain class by persistent attribute</b> <br><br><pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Customer { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> Number { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string <span class="hljs-type"><span class="hljs-type">Name</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } //    ,       <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string Message { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br>  If you tend to write such code, then you should stop and think about the domain model.  Such an approach may indicate that you have included elements in the domain model that are not related to it. <br><br><h2>  When domain logic enters the database </h2><br>  <b>Example 1: Cascade Delete</b> <br><br>  Configuring the database for cascade deletion is one of the examples of the infiltration of domain logic into the data storage logic.  Ideally, the database itself should not contain information on when the deletion of data should work.  Such knowledge is a domain concern.  Your C # / Java / etc code should be the only place to store this logic. <br><br>  <b>Example 2: Stored Procedures</b> <br><br>  Using stored procedures that modify data in a database is another example.  Do not allow domain logic to penetrate into the database, store code that changes the state of the data in your domain model. <br><br>  Here it is necessary to make two comments.  First, in most cases, there is nothing wrong with having stored procedures that do not change the data in the database (read-only stored procedures).  Placing the code that leads to side effects (side effects) in the domain model and the code without side effects in the stored procedure is perfectly correlated with the principle of <a href="http://enterprisecraftsmanship.com/2015/04/20/types-of-cqrs/">CQRS</a> . <br><br>  Secondly, there are cases when it is impossible to avoid using SQL.  For example, if you need to delete a group of objects on some basis, the SQL DELETE statement will do this work much faster.  In such cases, the use of SQL, which modifies the data in the database, is justified, but it is necessary to keep all such exceptions under strict control and not let them grow. <br><br>  <b>Example 3: Default Values</b> <br><br>  The default values ‚Äã‚Äãin database tables are another example of domain logic that has penetrated the database.  The values ‚Äã‚Äãof the properties that the domain entity has by default should be defined in the code, and not relegated to the database. <br><br>  Think how difficult it is to collect such knowledge piece by piece from different places of the application.  It is much easier to store them in a single place. <br><br><h2>  Conclusion </h2><br>  Most of these "leaks" arise because people think about their application not in terms of the subject area, but in terms of data.  Many developers view the system they are developing in this way.  For them, classes are only a repository for data that they transfer from the database to the UI, and ORM is just a utility that helps not to manually copy data from the results of executing SQL queries into these objects.  It is often difficult to make a shift in the paradigm of thinking.  But after it is done, people usually open up a whole world of expressive domain models that allow you to develop applications much faster, especially on large projects. <br><br>  Of course, it is not always possible to achieve the desired level of separation of responsibilities in the application code.  But in most cases, nothing prevents to do this.  Most projects fail not because they are not able to fulfill any of the technical requirements.  Most fail because they are buried under a mass of erratic code that prevents developers from changing anything in it.  Every change in this code leads to a cascade of bugs and unexpected side effects throughout the application. <br><br>  SoC is a principle that allows you to avoid such an outcome. <br><br>  Link to original article: <a href="http://enterprisecraftsmanship.com/2014/12/06/separation-of-concerns-in-orm/">Separation of Concerns in ORM</a> </div><p>Source: <a href="https://habr.com/ru/post/263027/">https://habr.com/ru/post/263027/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../263015/index.html">Wolfram Language (Mathematica) is just a toy</a></li>
<li><a href="../263017/index.html">Conference C ++ Siberia in Novosibirsk</a></li>
<li><a href="../263019/index.html">Web application for generating photo mosaic with lightweight threads on Go</a></li>
<li><a href="../263021/index.html">Reflection in Cach√©</a></li>
<li><a href="../263025/index.html">Pro model, logic, OOP, development and the rest</a></li>
<li><a href="../263031/index.html">How to make the browser cache not as useless as usual</a></li>
<li><a href="../263033/index.html">Forget about DAO, use the Repository</a></li>
<li><a href="../263035/index.html">How to design and write a full program</a></li>
<li><a href="../263041/index.html">$ mol_time - working with dates and time correctly</a></li>
<li><a href="../263043/index.html">Open Source Virtualization: Report on Innovations and Approaches to Virtualization of Corporate Infrastructure</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>