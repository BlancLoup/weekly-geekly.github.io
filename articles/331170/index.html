<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to do static code analysis in Swift</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The subject of static code analyzers has been renamed. The last six months there has been almost no conference without a speech on this issue. But the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to do static code analysis in Swift</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/68d/468/544/68d468544c744d04bcf4758a1910770a.png"><br><br><p>  The subject of static code analyzers has been renamed.  The last six months there has been almost no conference without a speech on this issue.  But they all talk about analyzers from the inside, show the mechanisms of their work.  At the same time, they forget to correctly explain what they were originally intended for.  Most often the theoretical part of the work of static analyzers is considered, without practical implementation.  Therefore, I will tell you about the goals that are pursued by static analyzers in real teams on commercial projects.  And also I will consider an example of the organization of work with various kinds of analyzers in our company. </p><a name="habracut"></a><br><h2 id="chto-takoe-staticheskiy-analiz">  What is static analysis </h2><br><p>  This is an analysis of software code, conducted without running it.  Therefore, run-time errors of the program cannot be caught with it.  Static analysis works only with the text code of the program, which takes a few seconds to run, but saves hours when finding bugs. </p><br><p>  There are several methods by which analyzers work. </p><br><ul><li>  <strong>Regular expression based search</strong> .  Everything is very simple here.  Find in the code the text that falls under the regular schedule, and you are offered the best option. </li><li>  <strong>Analysis of the grammar of the language</strong> .  More complex code parsing.  A grammar is represented as a tree, the vertices of which are language operators, and the leaves are operands.  Allows you to find much more complex constructions compared to regular expressions.  It is more difficult to implement, so most analyzers present the possibility of writing custom rules precisely on the basis of regulars, although inside they can work as a synergy of the first and second.  For Swift, at the time of writing, I did not find the possibility of creating a custom rule based on a syntax tree. </li></ul><br><h2 id="zachem-vnedryat-staticheskiy-analiz">  Why implement static analysis </h2><br><p>  Analyzers are needed to find bugs as early as possible.  In our case, this is a compilation of the project.  The later the bugs are found, the more expensive they will cost the developer and the business as a whole. </p><br><p>  However, this goal is too general and does not carry much semantic meaning.  Let's try to decompose it into several small ones: </p><br><ul><li>  <strong>Finding critical bugs in the code</strong> .  For example, different force unwrap, where they are not needed.  At the same time there are various utilities that allow you to find more complex things, such as circular links. </li><li>  <strong>Automation of work styleguide</strong> .  In the commands for the "depersonalization of the code" one of the methods is the introduction of the styleguide, in which the basic practice of writing code is prescribed.  Often it turns out a huge document on dozens of pages.  Keeping them in my head becomes problematic, especially when a new developer comes to the team who previously wrote in a different style.  And it is here that the static analyzer is great.  It allows you to automate most of the rules that are written in your styleguide.  In languages ‚Äã‚Äãthat appeared before Swift, the styleguide for each rule usually indicates whether it is added to linter.  And if added, then under what name.  Here is <a href="https://github.com/airbnb/javascript">an example for js</a> how to implement it. </li></ul><br><h2 id="kak-realizovat-kastomnye-pravila">  How to implement custom rules </h2><br><p>  The most popular code analyzer for Swift at the moment is <a href="https://github.com/realm/SwiftLint">swiftlint</a> .  We also use <a href="https://tailor.sh/">tailor</a> .  The first allows you to create your own rules based on regular expressions, which makes it possible to implement most of the rules from your styleguide. </p><br><p>  Swiftlint allows <strong>you</strong> to <strong>create custom rules</strong> that you need to put in the configuration file. Swiftlint.yml, located in your project.  The custom language description language has a number of parameters. </p><br><ul><li>  included \ Includes certain files.  Works like a regular expression.  Example: ". *. Swift".  It is optional. </li><li>  excluded \ Excludes specific files.  Works like a regular expression.  Example: ". * Test.swift".  It is optional. </li><li>  name \ The name of the rule.  It is optional. </li><li>  regex \ Regular expression to search. </li><li>  rule identifier \ Rule identifier.  It is optional. </li><li>  match_kinds \ The type of code in which the search will take place.  There are a lot of them, for example, you can search only in comments or keywords.  It is optional. </li><li>  message \ Message that is displayed when the regular expression finds this rule. </li><li>  severity \ There are two types: warning / error.  Depending on the selected value, it will be displayed in Xcode as an error or warning </li></ul><br><p>  For example, in your company you use only weak and do not use unowned.  The performance of the latter is higher than the first.  But the fact that the weak will not lead to the fall of the application is more important for you.  This can be easily done using a regular expression and create a custom rule. </p><br><pre><code class="hljs vhdl">unowned: name: <span class="hljs-string"><span class="hljs-string">"Unowned"</span></span> regex: <span class="hljs-symbol"><span class="hljs-symbol">'unowned</span></span>' message: <span class="hljs-string"><span class="hljs-string">"Please use `weak` instead. "</span></span> <span class="hljs-keyword"><span class="hljs-keyword">severity</span></span>: <span class="hljs-literal"><span class="hljs-literal">error</span></span></code> </pre> <br><p>  Another example about comments.  Suppose you do not write headers in your project.  Regular expression is also perfect for this. </p><br><pre> <code class="hljs pgsql">no_header_comments: <span class="hljs-type"><span class="hljs-type">name</span></span>: "Header Comments" regex: <span class="hljs-string"><span class="hljs-string">'//\s*Created by.*\s*//\s*Copyright'</span></span> match_kinds: - <span class="hljs-keyword"><span class="hljs-keyword">comment</span></span> message: "Template header comments should be removed."</code> </pre> <br><h2 id="kak-realizovat-sistemu-analizatorov-koda">  How to implement a code analyzer system </h2><br><p>  The most interesting part is <strong>scaling and automating the process of static analysis</strong> .  This is especially important if there are several projects and you want all the custom rules to be the same for them.  All analyzers have a configuration file in which the settings are stored.  There are three such files in our projects: .swiftlint.yml, .tailor.yml, cpd_script.php. <br>  The last file is a script written in php.  It starts the analysis of the file produced by the copy-paste detector in the swift project.  I will tell about its setup in the following article. </p><br><p>  The simplest support option would be to create a separate repository for these files.  We do <a href="https://github.com/TouchInstinct/code-quality-ios">like this</a> .  You can connect to the project through <a href="https://git-scm.com/book/en/v2/Git-Tools-Submodules">submodule</a> .  If the settings in the configuration files are updated, it is enough to update the submodule.  Then your project will be relevant rules. <br>  In addition, you can use some additional github functions.  We use the issues system to create new custom rules or discuss current ones.  This makes it possible to understand why a particular rule was rejected.  It is convenient to track the status to make changes to the configuration files. <br>  This system works great on CI.  It can be configured in such a way that all pull requests in your project could not be smoldered if the analyzers found at least one defect in the code. </p><br><h2 id="ne-zabudte-podderzhivat-sistemu-analiza">  Remember to maintain an analysis system. </h2><br><p>  Static analysis is one of the earliest ways of finding errors in an application.  As a result, the cheapest.  I hope that the simplest system for storing configuration files of static analyzers will help you to make projects "the same."  And still allow you to find more than one bug before the testing phase. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/331170/">https://habr.com/ru/post/331170/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../331160/index.html">PHP user types</a></li>
<li><a href="../331162/index.html">‚ÄúMy most important test is not to break the driver‚Äù - Dave Cramer about developing a JDBC driver for PostgreSQL</a></li>
<li><a href="../331164/index.html">Draw thick lines in WebGL</a></li>
<li><a href="../331166/index.html">About Qt licenses (and a little about the company)</a></li>
<li><a href="../331168/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ267 (June 12 - 18, 2017)</a></li>
<li><a href="../331174/index.html">Fuzzy search by name</a></li>
<li><a href="../331176/index.html">Interactive credit card for payment input</a></li>
<li><a href="../331178/index.html">How to keep 20 thousand VPN clients on servers for $ 5</a></li>
<li><a href="../331180/index.html">Cloud security: reality or myth?</a></li>
<li><a href="../331182/index.html">The first selection of materials on the digitalization of insurance</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>