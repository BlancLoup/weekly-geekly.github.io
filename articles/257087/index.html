<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Search, find and do not blow off</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Friends, we want to tell you about our service Shdmka.rf and some details of its manufacture. Under the cut article about balloons, CouchDB, Lisp and ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Search, find and do not blow off</h1><div class="post__text post__text-html js-mediator-article">  Friends, we want to tell you about our service <a href="http://xn--80ahsh2d.xn--p1ai/">Shdmka.rf</a> and some details of its manufacture.  Under the cut article about balloons, CouchDB, Lisp and a couple of pictures. <br><img alt="KDPV" src="https://habrastorage.org/files/ba2/ab7/ca2/ba2ab7ca26ae46d7b5e7ec6c8c4f1ab5.png"><br>  Holidays are coming, and perhaps one of you will find an idea for a gift. <br><a name="habracut"></a><br>  Many have seen clowns making dogs out of balloons.  Very cute and very funny.  Someone, perhaps, even tried to turn the balls on their own. <br><br>  Today, an incredible amount of beautiful pieces is made of balloons.  <a href="http://sharik.ru/company/about/photo/1035/42136/">Festivals</a> and simply interesting events are held. <br><br>  We made a website-catalog of aerodesigners (and gradually designers began to be called that way), and the main thing on the site is photos of the works of aerodesigners.  We differ from other directory sites by having a notebook, which a simple user fills and sends to the designer in his city / region.  The designer, however, can also send a letter to the client with a filled pad. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/1a0/84a/705/1a084a705a1f40758f89f9bf669b9138.png"><br><br>  I'll tell you about the technical component of the site, because during the development process several interesting things were found, or poorly described in the documentation, or this description had to be collected bit by bit in the forums. <br><br><h4>  Lisp </h4><br>  The site is written in Common Lisp (in the SBCL implementation).  The choice of language is due to the convenience of coding and a large <a href="http://www.quicklisp.org/">number of libraries</a> .  Only two libraries were adjusted for their needs, and very slightly, the rest was working out of the box. <br><br>  The site code is compiled directly into the machine code, respectively, the site performance is high.  I want to believe that this statement will stand the test of habrae :) <br><br><h4>  Couchdb </h4><br>  CouchDB is used as data storage.  It contains photos and miniatures for them, as well as information about users. <br><br>  CouchDB includes a rather convenient <a href="http://docs.couchdb.org/en/1.6.1/intro/futon.html">Futon</a> data management environment, which has one drawback - all the JS code that is used to manage the database (views, list functions, etc.) is serialized to a string and is almost impossible to edit in the environment itself. . <br><br>  The <a href="https://github.com/couchapp/couchapp">couchapp</a> utility is used to solve this problem. <br><br><h5>  Couchapp </h5><br>  This is a small python utility that allows you to create stand-alone (standalone) applications on CouchDB.  The template utility generates application code and, most importantly, allows one command to load the application into CouchDB.  At the same time, the application itself has a tree structure in the file system, where in different folders there is a code of different elements, for example, views or auxiliary code.  In a normal human form. <br><br>  In addition, the utility allows you to add different elements of couchapp applications as they are developed - views, lists, etc. <br><br>  For example: <br><br><pre><code class="bash hljs">couchapp generate view check-user</code> </pre> <br>  Here, check-user is the name of the generated view.  The utility creates the views / check-user directory, which will contain templates for map and reduce functions. <br><br><h5>  Update-functions </h5><br>  Since the data is never overwritten in CouchDB, but only added to the database, a very important element of the work is the availability of a document revision.  Almost any reference to a recorded document requires knowledge of the revision of the document.  This is not always convenient. <br><br>  CouchDB has update functions (update functions) that allow you to manipulate documents on the server side (without downloading them to the client), without knowing their revision.  The documentation describes this point in a rather modest way; at the same time, the update functions allow you to do interesting things: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">doc, req</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!doc) { doc = { <span class="hljs-attr"><span class="hljs-attr">_id</span></span>: req.id, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'idGenerator'</span></span>, <span class="hljs-attr"><span class="hljs-attr">count</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }; } doc.count++; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [doc, <span class="hljs-string"><span class="hljs-string">'"'</span></span> + doc.count + <span class="hljs-string"><span class="hljs-string">'"'</span></span>]; }</code> </pre><br>  The given code fragment for each function call increases the document count field.  Thus, a sequential number generator on CouchDB is implemented. <br>  The function call, by the way, is as follows: <br><br><pre> <code class="bash hljs">curl -X POST http://localhost:5984/database/_design/view-doc/_update/generateOrderNo/counterDoc</code> </pre><br>  Here the view-doc is the design document in the database database, generateOrderNo - update function, counterDoc - the document in the database database. <br><br>  Calling the above function, we each time increment the field in the document and immediately get the value of this number.  Analog field with auto increment for SQL. <br><br>  CouchApp, however, does not know how to generate update functions, however, if you manually create the updates directory and put into it the function of the above content, the application is quietly loaded into CouchDB. <br><br><h5>  Code substitution </h5><br>  In CouchDB, there is no possibility in the functions of the representations to use any kind of library code.  This problem CouchApp solves very, in my opinion, elegantly. <br><br>  You can specify in the code map-function (or reduce-function) construction <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">doc</span></span></span><span class="hljs-function">) </span></span>{ ... <span class="hljs-comment"><span class="hljs-comment">// !code vendor/myapp/common.js ... }</span></span></code> </pre><br>  and in the place in the code where this line occurs, the contents of the common.js file located in the corresponding application folder will be inserted.  It may not be the most beautiful solution, but it allows you to write common code once. <br><br><h4>  Framework </h4><br>  The <a href="http://ink.sapo.pt/">Ink</a> framework was chosen as the basis for the interface.  It has an interesting internal structure and advanced functionality.  In addition, the framework is developing quite quickly. <br><br><h4>  Conclusion </h4><br>  In general, when you want a holiday, think about the balloons.  Especially, on <s>Friday</s> Thursday evening before the holiday. <br><br>  Well, aerodesigners who can arrange this holiday can be found on our website.  On the main page there is a link to a page with designers from your region.  If it turns out that there is no one there, you can click the ‚ÄúI want it to be!‚Äù Button and we will invite aerodesigners from your cities referring to your interest. <br><br>  In the picture to attract the attention of FreeBSD mascot, made of balloons, the CouchDB logo and one of the Lisp logos, made on coffee. <br><br><img src="https://habrastorage.org/files/9a0/f12/47e/9a0f1247e753437097faaa09fe6f7b7e.jpg"><br><br>  Finally, a few pre-holiday links: <br><br>  <a href="http://xn--80ahsh2d.xn--p1ai/0/88743d618e7deddb54eb87b69d01e757/%3Fi%3D88743d618e7deddb54eb87b69d026133">FreeBSD ball mascot</a> <br>  <a href="http://geeklatte.com/">Geeklatte.com, IT pictures on coffee</a> <br><br>  Thanks for attention! <br><br>  Criticism and suggestions are welcome. </div><p>Source: <a href="https://habr.com/ru/post/257087/">https://habr.com/ru/post/257087/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../257071/index.html">Mini-review of libraries for Reflection in C ++</a></li>
<li><a href="../257073/index.html">Mini API on Lumen</a></li>
<li><a href="../257077/index.html">Contests HackQuest and Hash Runner: warm up the brains before PHDays</a></li>
<li><a href="../257079/index.html">Checking FreeCAD source code and its ‚Äúbad‚Äù dependencies</a></li>
<li><a href="../257083/index.html">BUILD 2015 news: Visual Studio Code, Visual Studio 2015 RC, Team Foundation Server 2015 RC, Visual Studio 2013 Update 5</a></li>
<li><a href="../257089/index.html">How to build a scalable infrastructure on Storage Spaces</a></li>
<li><a href="../257091/index.html">Store 300 million objects in the CLR process</a></li>
<li><a href="../257093/index.html">SourceTalk (source code discussion service): release</a></li>
<li><a href="../257095/index.html">Happy birthday google</a></li>
<li><a href="../257097/index.html">7 things that every designer should know about the design of accessible sites</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>