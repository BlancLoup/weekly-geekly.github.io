<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Download Linux in 5 seconds</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Full translation of the article, announced in http://habrahabr.ru/blogs/linux/41701/ 

 At the Plumbers Linux Conference (Linux Plumbers Conference), ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Download Linux in 5 seconds</h1><div class="post__text post__text-html js-mediator-article"> Full translation of the article, announced in <a href="http://habrahabr.ru/blogs/linux/41701/">http://habrahabr.ru/blogs/linux/41701/</a> <br><br>  At the Plumbers Linux Conference (Linux Plumbers Conference), Arjan van de Ven, developer of Linux solutions from Intel, the author of PowerTOP, and Auke Kok, developer of the Intel Open Source Technology Center, demonstrated a Linux-based system that boots only 5 seconds  The hardware basis for this system was the Asus EEE PC, with an SSD drive.  The developers overcame the ‚Äúload in 5 seconds‚Äù line in two versions: a modified Fedora and a modified Moblin.  EEE PC loaded faster than the projector had time to recognize the signal from the video output of the device, so they had to do without it and simply bring the laptop closer to the audience. <br><a name="habracut"></a><br>  How did they do it?  Arjan said that it all started with the correct formulation of the problem: ‚ÄúMaking the system not 'load faster', but make it 'load in five seconds.'‚Äù Instead of saving a second here, a second there, a time limit was set for the entire boot process Each download step must be done within this time frame.  And no fraud: ‚ÄúCompleting the load means stopping disk access and CPU load,‚Äù said Arjan.  The time is not measured until the desktop is loaded, while services continue to load in the background (although some companies measure the load time of their OS exactly up to this point).  Boot time does not include turning on the network, but includes starting NetworkManager.  A system with a traditional hard drive loads longer, but Arjan said that he ran the system on a ThinkPad - and it booted in less than 10 seconds <br><br>  On this hardware, Fedora boots in 45 seconds ‚Äî from powering on to the password entry screen.  Bootchart, a tool created by Ziga Mahkovec, reveals the details of the download.  On the Fedora boot graph (Figure 1), it can be seen that during the boot process there are some time devouring moments.  It uses a full second to start loopback interfaces ‚Äî to check whether all network interfaces are loopback interfaces.  2 seconds are required to start sendmail.  ‚ÄúEveryone pays for everything, despite the fact that not everyone needs sendmail,‚Äù said Arjan, and suggested that for home use -SMTP only for outgoing mail ‚Äî ssmtp can be used. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/cc3/8ca/e8e/cc38cae8ed49ef2962cdc7e1156f93bc.png" alt="Fig. one"><br></a>  <a href="">Fig.</a>  <a href="">one</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Another costly process in Fedora is ‚Äúsetroubleshootd‚Äù, a useful tool for troubleshooting Security Enhanced Linux (SELinux) settings, it takes a full five seconds.  There is no reason to blame Fedora - some independent projects use an incomprehensible amount of time / resources to work.  The X Window System runs its own C preprocessor and compiler when it is loaded, just to compose its own keyboard charts (keyboard mappings). <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/f84/a4e/35d/f84a4e35d7d80fb1e84463ad3e55b92c.png" alt="Fig. 2"><br></a>  <a href="">Fig.</a>  <a href="">2</a> <br><br>  Ubuntu boot is almost the same - 2 seconds faster (Figure 2).  It spends 12 seconds on modprobe, just to load a single module.  The proprietary driver download tool uses 2.5 seconds - on a system that does not need proprietary drivers.  ‚ÄúEveryone pays for the ability to use closed drivers,‚Äù said Arjan.  And finally, GDM Ubuntu takes 2.5 seconds of pure CPU time, just to display a background image. <br><br>  Both distros use splash screens.  Both Arjan and Auke agreed: ‚ÄúWe hate splashing screens.  In the time it takes to see them, we want everything to be done. ‚Äù  The time that the developers of the distribution kit spend on splashing screens is much more than the Intel team spent in order to load in such a time that splashing the screen is simply not needed. <br><br>  <b>How they did it: Core</b> <br><br>  The first step is the plan.  One second to load the kernel with all modules.  ‚ÄúEarly boot‚Äù, including boot scripts and background jobs ‚Äî another one second.  X Server - another one second, and 2 seconds for the workbench programs. <br><br>  The kernel was rebuilt without an initrd, which requires half a second ‚Äúfor nothing‚Äù.  All modules that are needed are embedded in the kernel.  Arjan said: ‚ÄúThere is a set of modules that will cover the needs of 95% of laptops.‚Äù He suggested that you just need to make a separate distribution with the kernel using the initrd for the remaining 5%. <br>  Some work on the kernel allows parallel loading of some subsystems.  For example, the modified kernel launches the Advanced Host Controller Interface (AHCI) initialization to manage storage at the same time as the Universal Host Controller Interface (UHCI) to control USB (Fig. 3).  ‚ÄúProbably, we could reduce the time to half a second, but, bringing the time to a second, we stopped,‚Äù said Arjan.  The kernel load time should be reduced to half a second to release 2.6.28, thanks to a new patch of the AHCI support module written by him. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/18a/8a4/5f7/18a8a45f7e53e23698e1a9d4b2951b0d.png" alt="Fig. 3"><br></a>  <a href="">Fig.</a>  <a href="">3</a> <br><br>  Another change to the kernel was a small patch to support readahead.  Kernel Terere keeps track of what information needs to be read at boot time, to make it immediately accessible in user space (userspace) at the end of its boot.  All this together makes it possible to use readahead, which is part of the early boot. <br><br>  How they did it: readahead and init <br><br>  Fedora uses Upstart as a replacement for ‚Äúinit‚Äù, the first program launched in user space.  But the Intel team returned to the original init.  The order of tasks that init performs has been changed so that you can do 3 things at the same time: first, the ‚ÄúsReadAhead‚Äù process for reading data from the disk and caching it in RAM, then the critical moment - checking the file system, then D-Bus system interprocess communication, then X-graphics subsystem, then desktop.  Well, and the third set of programs to run the Hardware Abstraction Layer (HAL), then udev - the device manager of the "hot plug", then the network.  Udev is only used to support devices that can be connected later - the system uses the traditional / dev folder, so the boot does not depend on udev. <br><br>  Organizing tasks helps to more efficiently use the processor.  For example, X pauses for half a second waiting for information about supported video modes.  This time uses the HAL for its download (Figure 4) <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/61d/ed2/7dd/61ded27ddcba6a11bc5e1a906e5e42f3.png" alt="Fig. four"><br></a>  <a href="">Fig.</a>  <a href="">four</a> <br><br>  In the graph of disk use and processor, both are used to the maximum almost all the boot time: thanks sReadAhead.  When X starts, it does not need time to read from the disk, since all data is already in the RAM cache.  sReadAhead is based on Fedora's Readahead, but it is modified to take advantage of the list of data to be read from the kernel.  sReadAhead should already be published on moblin.org, and the kernel patch will be posted as soon as Arjan makes it together with Ted Ts'o (an ext3 file system developer) - during the meeting Ted made some suggestions on how to reorganize the blocks on the disk so that increase the speed even more. <br><br>  In this project, there is one hard limitation: 75 megabytes for reading from disk - 3 seconds of information transfer at a speed of 25 MB / s - the limitation of SSD drives.  ‚ÄúThus, we were forced not to read the files entirely.  We only read pieces of files that we actually use, ‚Äùsaid Arjan.  sReadAhead uses only idle time of the disk subsystem, so if something else requires disk access, it gets it.  Without using readahead, the system boots in 7 seconds, with its use - we get our goal - download in five seconds! <br><br>  X is still a problem.  ‚ÄúWe needed to do a lot of X damage,‚Äù said Arjan.  Part of the work was aimed at preventing the C compiler from running by reusing character tables, but the rest of the work was more temporary.  The current development direction of X is aimed at moving most of the hardware definition and configuration into the kernel, which should reduce the overall boot time.  As long as some of the core time is already being used to determine the hardware, this time can be used to initialize more devices at the same time - this is a more efficient use of time, initializing the video card at the same time as USB and ATA.  Developer X Keith Packard (also an Intel employee) offered his help.  As a result, the video mode is installed by the kernel during the initialization of the rest of the equipment (Fig. 3).  The presented fast-booting system does not use GDM (password entry screen), it is loaded directly into the user session, with the XFCE environment.  Arjan suggested, instead of GDM, to load the session of the last user, but to load along with a screensaver that blocks the use of the system without entering a password.  If another user wants to log in, he must use the ‚ÄúSwitch User‚Äù screensaver button. <br><br>  In conclusion, Arjan said: ‚ÄúDo not stop at 'make the download faster'.‚Äù  This is an incorrect formulation of the problem.  The correct task is to make the download fast.  And do not make all users wait because someone needs some kind of module or sendmail on their laptop.  Make sure that users only pay for what they actually use.  Distribution developers should not do separate initrd and non-initrd distributions, "he said later:" The kernel should try to boot without an initrd, and use it only if it cannot see / sbin / init (as might happen if there is no module to mount root file system.) <br>  PowerTOP caused a flurry of changes to save energy in all areas of Linux software. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/e93/4aa/7b2/e934aa7b2531d8118b72a367616c5264.png" alt="Fig. five"><br></a>  <a href="">Fig.</a>  <a href="">five</a> <br><br>  The conference ended on Friday (the report was on Tuesday), and conference chairman Kyle McMartin reported that Fedora and Ubuntu had corrected some unreasonable delays in their download process, which caused a storm of applause and approvals. </div><p>Source: <a href="https://habr.com/ru/post/42638/">https://habr.com/ru/post/42638/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../426371/index.html">Audio Digest: 17 materials and practical guides on professional acoustics</a></li>
<li><a href="../426373/index.html">Build functions in the console. Part 1</a></li>
<li><a href="../426375/index.html">Technology analysis: where to start work on the patent landscape</a></li>
<li><a href="../426377/index.html">Play using math graphs instead of graphs</a></li>
<li><a href="../426379/index.html">Deliverance from illusions</a></li>
<li><a href="../426381/index.html">How to make Python functions even better</a></li>
<li><a href="../426385/index.html">Why you should not learn academic English</a></li>
<li><a href="../426387/index.html">Graphics in Julia. Strange patterns, the reflection of a triangle from a straight line and the construction of the normals of a spherical cat in a vacuum</a></li>
<li><a href="../426389/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ334 (October 7 - 14, 2018)</a></li>
<li><a href="../42639/index.html">MDC: a beta release of multiprotocol messenger for Linux!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>