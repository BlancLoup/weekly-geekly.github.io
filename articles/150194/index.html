<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Quality takeoff after the "fall". Or why "lay" many bytes</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On August 23, 2012, from 02:00 a.m. to 4:30 p.m., a part of the MultiByte network did not function correctly, which resulted in partial or complete lo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Quality takeoff after the "fall". Or why "lay" many bytes</h1><div class="post__text post__text-html js-mediator-article">  On August 23, 2012, from 02:00 a.m. to 4:30 p.m., a part of the MultiByte network did not function correctly, which resulted in partial or complete loss of communication from about a third of the company's customers.  In order to dispel rumors immediately in hot pursuit, we decided to talk about what was and what had been done so that this would not happen again. <br><a name="habracut"></a><br><br>  I'll start from afar.  About a year ago, the rapid growth of traffic across the entire PolyByte network began.  This was facilitated by adequate tariffs for bandwidth and traffic, and good connectivity in Russia, and the overall growth in the number of client equipment hosted in our data centers.  As a result of increased traffic, the Cisco Catalyst 6500 and 7600 series switches and routers installed by us in 2007 and 2008 have become insufficient for further growth.  Everything is very simple: 2x20 Gbit / s per slot and only 4 full-speed ports per slot is the limit.  Therefore, at the beginning of 2012, we planned to transfer the network core to Juniper routers and a general network upgrade in order to adjust our ‚Äúring‚Äù connecting nodes on MMTS-9, MMTS-10 and data centers, in order to provide customers with connectivity at 10Gbit / seconds and, accordingly, passing traffic at the same speed to the outside world. <br><br><img src="https://habrastorage.org/storage2/7c5/b60/567/7c5b60567ac574935a0e74f1813d0488.jpg"><br>  <i>Juniper MX960 3D</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      By receiving the necessary equipment (DWDM multiplexers, DWDM-SFP +, 10 Gbit / s switches, Juniper routers), we transferred the ‚Äúring‚Äù to new equipment.  Since July 5, 2012, we had a successful replacement of the router on our site at MMTS-9, and almost none of the clients of the data centers noticed this.  Although the work was hard - the central router, though! <br><br>  On August 23, 2012 we planned the next replacement of the router.  Now the task was much more difficult: it was necessary to switch over a dozen access switches and about 130 client connections connected directly to the router.  We prepared for work quite thoroughly: a separate switch was turned on in our ring, where clients switched in several stages.  These clients were also routed by another router.  On the night of August 23, we planned to switch access switches to the same ‚Äúpiece of ring‚Äù and take clients to other routers.  The total downtime for customers would be less than an hour.  A 130 direct connections are not going anywhere - they would have had to wait for the inclusion of a new Juniper.  For the reader, I also note that 130 connections are not only 1 Gbit / s, but also 10 Gbit / s ports, too. <br><br><img src="https://habrastorage.org/storage2/f7e/41f/61b/f7e41f61b6a70f5bc540268093d3bd31.jpg"><br>  <i>Juniper EX8216</i> <br><br>  At 02:00 according to the plan, we started working with moving client routing to another router and switching access switches.  However, after transferring the connections and starting dismantling the Cisco Catalyst router, strange problems began with the backup switch: it was out of memory and the CPU was periodically heavily loaded.  We tried to solve the problem, but she succumbed only partially.  As a result, part of the access switches remained without access to the network.  We could not return everything back.  We continue to study the problem, because the same switch in the same configuration without any problems passed through about 15 Gbit / sec of traffic and did not even tense up. <br><br>  Because of problems with access switches, our site, as well as telephony, were temporarily taken out of service.  This is what caused customer complaints that they could not reach us.  But pretty soon the problem was solved and it all worked. <br><br>  The new Juniper was launched at the scheduled time.  Switching of access-switches and user connections began.  Along with connections, new problems have emerged, which are also being studied by us.  For example, a ‚Äúloop‚Äù was formed, which was not immediately caught.  Catching the loop took extra time.  The loop caught some customers in our other data centers. <br><br>  While connecting access switches, it also turned out that Cisco Catalyst did not really want to be friends with Juniper equipment and had to jump with a <s>tambourine</s> console near each switch.  And reconfigure it.  By 11:00, with a delay of 5 hours from the scheduled time, most of the data center clients were working and had no problems. <br><br>  But this was not the end of the problems of that day.  Different worldviews of manufacturers Juniper Networks, Extreme Networks and Cisco Systems on the seemingly fully standardized STP and MPLS protocols left without communication some of the customers.  The glitch with the passage of large packets was caught by us until 16:30.  At 16:30, only slightly less than 100 connections to the access switches of the data center remained affected.  Some switches of clients connected to our access switches were also incorrectly configured and affected our network.  After explanatory conversations with customers, reconfiguring their equipment and installing a variety of different filters on these ports, the problem was finally resolved and around 18:30 the last affected customers got access to the network without problems. <br><br><h4>  What's next </h4><br>  All affected customers will receive compensation and pleasant bonuses - no doubt about it.  As I said, the traffic on the PolyByte network is growing.  The resulting upgrade will allow us to continue to meet the needs of our existing and new customers.  By the way, we are one of the few Moscow data centers that provide connectivity for client servers at a speed of 10 Gbit / s.  It is worth waiting for new tasty tariffs and a more flexible tariff policy.  A blessing in disguise, as they say! <br><br>  Thanks to all our customers who have stayed with us for years and showed patience on this difficult day for us and for them! </div><p>Source: <a href="https://habr.com/ru/post/150194/">https://habr.com/ru/post/150194/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../150189/index.html">Cooking pizza with SVG</a></li>
<li><a href="../150190/index.html">The digest of interesting news and materials from the world of ayti for the last week ‚Ññ19 (August 18 - 24, 2012)</a></li>
<li><a href="../150191/index.html">We meet Veracity - a new distributed version control system</a></li>
<li><a href="../150192/index.html">Windows 8 tells Microsoft about any installable programs.</a></li>
<li><a href="../150193/index.html">Cheat Sheet by SCJP. Part two</a></li>
<li><a href="../150197/index.html">A jury found Samsung guilty of infringing Apple patents</a></li>
<li><a href="../150198/index.html">Implementing Common Lisp Condition System on C #</a></li>
<li><a href="../150199/index.html">Implementing RESTful Web Service on Scala</a></li>
<li><a href="../150200/index.html">Be optimistic - depression leads to Alzheimer's disease</a></li>
<li><a href="../150201/index.html">Vulnerability in Kohana?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>