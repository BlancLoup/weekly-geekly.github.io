<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ekspozzer - creating a panorama from a video, averaging a video stream</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habrahabr! 


 I must say: there is nothing phenomenal in the article. This article is devoted to the program developed on the knee to create pano...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ekspozzer - creating a panorama from a video, averaging a video stream</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habrahabr! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/063/94d/7a7/06394d7a7d438830a3707893012f1ac9.jpg"></div><br>  I must say: there is nothing phenomenal in the article.  This article is devoted to the program developed on the knee to create panoramas from video and temporal averaging of the video stream (frames).  The program can also be used as a virtual slit-camera.  The article will be interesting to all those who are interested in video and image processing, as well as geek art.  A very simple program - a very interesting result.  At the end of the article link to download.  <b>Caution traffic!</b> <br><a name="habracut"></a><br>  I noticed that a good and, most importantly, <i>demanded</i> software is born not just like that, but from the arising needs to solve this or that problem.  I do not know about others, but this is what happens all the time.  And this story is no exception. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/544/817/880/544817880a41f393af84a4c84e6a9a7a.jpg" align="right">  Once, on one graphic forum, I accidentally got into a dispute with one guy, who argued something like the following: ‚ÄúIt‚Äôs impossible to get an image of an empty Red Square in the afternoon.‚Äù  Of course, the statement is wildly controversial: yes, the people there dofig day, but you can also ask everyone to leave.  Theoretically this is possible.  A mere mortal, of course, will fail, however, if you are some Utin, then, having really tried and calling someone you need, you will be able to organize something like that.  And what does ‚Äúimage‚Äù of empty Red Square mean?  The image is not a photograph, the image of the empty Red Square I can draw on a piece of paper by hand.  In general, I don‚Äôt remember all the details of the dispute over the years, but it was wildly hot and we, damn it, came to this clarified statement (approximately): ‚ÄúBecause of the huge number of people in Red Square, it‚Äôs impossible to resort to only photo and video technology, to get a photorealistic image (photo) of Red Square without a single person on it from the angle of a full-length person, being a simple person who has no leverage on the government, in the daytime during the warm tourist season (for example, summer). ‚Äù  Well, clarification!  Literally legal.  Now everything fell into place. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The opponent argued that such a photo can be made only by resorting to Photoshop (or another image editing program) in order to remove all people from the photo of Red Square.  This procedure is long and laborious, and in order to get a decent shot, it will be necessary for an experienced editor to work for at least three or four hours.  Yes, of course, he is right, it can be done.  But if this person (by profession an artist and photographer) knew even a little bit mathematics or imagined the possibilities of elementary programming, then he would never undertake to assert this.  Especially on the dispute.  And I proved to him the opposite. <br><br>  If at least once in your life you had a camera in your hands, and, moreover, took pictures, then you probably know what <a href="http://ru.wikipedia.org/wiki/%25D0%25AD%25D0%25BA%25D1%2581%25D0%25BF%25D0%25BE%25D0%25B7%25D0%25B8%25D1%2586%25D0%25B8%25D1%258F_(%25D1%2584%25D0%25BE%25D1%2582%25D0%25BE)">exposure is</a> .  If it is very simple (for people who shoot in the "auto" mode) - this is the length of time the frame is taken.  Surely you do not get "blurry" photos in motion.  Here!  This is just the wrong exposure: it was too big.  And if the photo suddenly turned out too dark, then, most likely, the exposure was too small.  I‚Äôm telling you in a very childish language so that everyone can understand: I don‚Äôt touch on the settings of the aperture and other subtleties of shooting.  So, it was thinking about the exposure that came up with the idea of ‚Äã‚Äãsolving this problem-dispute. <br><br>  I thought: what if you take a very, very, very sooooo long (huge exposure) photograph of Red Square, but with a very, very, very-very-wide and tightly closed diaphragm (so that there is no overexposure).  After all, then the people walking in the frame will simply be lubricated, and the permanent details (buildings, the Kremlin, the square) will remain in place.  Yes!  This is the key to the solution.  We should somehow try to do it.  But how?  After all, I have no opportunity to get to Red Square.  Not only for the sake of experiment, but in general, not to mention "for the sake of experiment."  Okay, any other area is suitable for testing, this is not a problem.  The problem is that my Canon 550D camera, which I bought a million years ago, can take pictures with a maximum exposure of 30 seconds, which is very little for the experiment.  I can't buy a new camera for the sake of experiment either.  The exposure is really long, about 30 minutes. Why?  To increase the chance that people in the square will change their position and leave the places where they were at the beginning of the frame.  Roughly speaking, in 30 minutes more area than people should get to each point of the frame.  I began to think how to solve the problem of photographing with a little blood? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fd5/571/142/fd5571142e59a7f30557ca2235c6ccf0.jpg" align="left">  But we are not bored!  After all, we have in our hands the most powerful tool available to the few - programming!  I decided: you can create a ‚Äúvirtual‚Äù camera that would just take a picture of the screen with any arbitrary exposure.  You know all these screen capture programs: SnagIt, BandiCam, FRAPS ... only it would record more than one frame (photo) or a sequence of frames (video), and accumulate information (as in a long exposure, which, in fact, is the exposure , only electronic), and at the end of the record would have averaged the information received.  Then, if on the screen you just play back the recording from the camera from the square, then this will be the required snapshot!  Hooray!  The problem is solved ... theoretically.  It remains only to create the necessary software and find a video from a fixed camera that would take an area for half an hour. <br><br>  It is good that the requests to the program are trivial, and I easily realized what was required in the evening. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eae/3c7/a0c/eae3c7a0ccd3f91b639415fd03075f45.jpg" align="right">  There were no questions with the video either, as there are a billion.  Any more or less good recordings from webcams or surveillance cameras are suitable, since they are predominantly fixed and do not move throughout the video. <br><br>  <b>Experiment 1.</b> So, the experiments began.  Here is a time-lapse video from Red Square.  But do not rush to be surprised if you do not see familiar places on the video.  Red Square in the world is not one (like <a href="http://article.spbmy.ru/%3Fp%3D826">St. Petersburg</a> and the other painfully familiar names), there are about twenty of them.  Presented on the video <a href="http://osm.org/go/WIdQPQqJ4--%3Fm%3D">Red Square</a> is located near the University of Washington.  This is a very crowded place, which is a landmark of the University and even the city.  On the square there are always a large number of students, tourists, travelers, applicants, teachers and just passersby.  By the way, an interesting fact: our Red Square is ‚Äúred‚Äù because the word ‚Äúred‚Äù in ancient times meant ‚Äúbeautiful‚Äù (and the square itself was originally built <a href="http://www.artlebedev.ru/kovodstvo/sections/174/">white</a> , made of white brick), and Red Square near the University of Washington is ‚Äúred‚Äù precisely because made of reddish stone. <br><br>  By the way, here is the irony: in a dispute with this tipchik, we did not specify exactly which Red Square is meant.  Just meant our own.  Since there are several Red Squares in the world, maybe among them there would be such an uncrowded one, in which at certain moments of the day there would be no people.  Then the photo can be taken, then I win the argument automatically. <br><br>  Well, down with lyrical digressions and irony.  Here is what happened after averaging the Red Square: <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/DrHGuqoSER4%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253&amp;usg=ALkJrhh5KAggR9BJV2MiEzVhiPaLDT7Q7Q" frameborder="0" allowfullscreen=""></iframe><br>  <i>The video lasts only 17 seconds, but since this is a time lapse, the actual video of the past time is much longer than 17 seconds.</i>  <i>Maybe 5 minutes, maybe 15.</i> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a11/7da/aa6/a117daaa609055ee10ebea20805e51ff.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bb3/79f/8da/bb379f8daa0200b52822d46e1df8df69.jpg"></div><br>  <i>As can be seen from the result, only very long people sitting in the same place throughout the video remained in the photo.</i>  <i>Some of them get up and go, and so-called "ghosts" are obtained.</i>  <i>In general, the result is almost what we need.</i> <br><br>  Compare now how many people are on video and how many are on photo.  And how much I would suffer in Photoshop, cutting people out and looking for frames, in which there are no people in the cut fragments, to insert these fragments into empty parts, and, besides, the insert would have turned out to be torn, since even background lighting changes due to cloud shadows, write errors, and so on.  And my ekspozzer did it in just 17 seconds;  It turned out smoothly and without much difficulty.  Cool?  Cool!  And this is just the beginning!  <b>Experiment 2.</b> Let us return to <i>our</i> Red Square.  I never found a good enough and long video shot from the square itself with a fixed camera.  Even time lapse: in general there the guys all the time will smoothly move the camera.  I found only this video: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/fnpEAEaWN84%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253&amp;usg=ALkJrhgPGVpworvkiSQFyopGzHV06uWoMw" frameborder="0" allowfullscreen=""></iframe><br>  <i>Pay attention to the huge number of cars on the Big Stone Bridge.</i> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a11/7da/aa6/a117daaa609055ee10ebea20805e51ff.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/869/3fe/acf/8693feacf79f9932774455018681f353.jpg"></div><br>  <i>It turned out very nice and smooth, despite the dancing shadows from the clouds.</i> <br><br>  And what happened to the car after averaging?  That's right: disappeared.  Check out what a neat picture turned out.  Well, is it possible to catch such a frame during the day?  Of course, any method has errors.  So is mine: no, no, yes, and some ghosts of cars or people will remain here and there.  In fact, the math is pretty simple here.  If in a video from 100 frames a person is found in 5 frames, then it will be ghostly at 100 - 5 = 95 percent.  That is, 95 percent of the information will be received from the area, and 5 - from the person.  With such a proportion it is almost invisible.  And since people and cars in general are constantly moving, the percentage is even less!  Just chocolate!  <b>Experiment 3.</b> Go ahead, take the most densely filled area in the world - New York Times Square: <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/BMl8A8jnF50%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253&amp;usg=ALkJrhi3wbdV8nY7k4TfzEbRRJwPNYbmxQ" frameborder="0" allowfullscreen=""></iframe><br>  <i>Here, everything is literally teeming with people and cars.</i> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a11/7da/aa6/a117daaa609055ee10ebea20805e51ff.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/818/634/c52/818634c52e5b33c518a51db118241d58.jpg"></div><br>  <i>And at the exit they got only a police car standing alone</i> <br><br>  <b>Experiment 4.</b> ... and a bunch of ghostly divorces in the street on the left.  Well, this is the imperfection of the method.  Still: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/I-VFmQ0C_M4%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253&amp;usg=ALkJrhjw69ddFvwC_8FKioTkFiLz1VK64w" frameborder="0" allowfullscreen=""></iframe><br>  <i>The video lasts only 16 seconds.</i> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a11/7da/aa6/a117daaa609055ee10ebea20805e51ff.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ca2/792/5de/ca27925de9932a17003cdb028aa8efb7.jpg"></div><br>  <i>Consequently, the result will be worse!</i> <br><br>  <b>Experiment 5.</b> <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/AK6WNFNBGvk%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253&amp;usg=ALkJrhidct-el4ljg5cqSfkL3YhVCNRvbQ" frameborder="0" allowfullscreen=""></iframe><br>  <i>Busy Wall Street.</i> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a11/7da/aa6/a117daaa609055ee10ebea20805e51ff.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4c6/59c/ee7/4c659cee7bac8340aa39a6b39a873849.jpg"></div><br>  <i>The result is impressive.</i>  <i>Purely!</i>  <i>It means that almost everyone moves and does not stand on the spot.</i> <br><br>  Everything is clear: the shorter the exposure and the slower the objects move, the more ghosts will be expressed.  And vice versa: the longer the exposure and faster objects move, the better the background will be visible.  In this case, the <i>perfect long time lapse video taken with a still camera</i> .  Well, such rollers are great. <br><br>  <b>Experiment 6.</b> We start to look at other results.  Here is a video from the outdoor surveillance camera at the intersection where the accident occurs: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/kmucKlpU_Z8%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253&amp;usg=ALkJrhj2uF4f5HuHTresWPMaLbPhxCA2_A" frameborder="0" allowfullscreen=""></iframe><br>  <i>Averaged from 20 to 40 seconds, just 20 seconds.</i> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a11/7da/aa6/a117daaa609055ee10ebea20805e51ff.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/743/8cd/7c9/7438cd7c913ee6ae242bd6c51e78516a.jpg"></div><br>  <i>Nice clean intersection with the ghost of a white car.</i> <br><br>  <b>Experiment 7.</b> And here is just the perfect copy: a long time lapse video, recording from a crowded street in Arnsberg, Germany: <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/oHE04vIin_0%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253&amp;usg=ALkJrhhFOIG12KeFKc9NWKEeYmSwUwOFHw" frameborder="0" allowfullscreen=""></iframe><br>  <i>Notice how flags flap in the wind.</i> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a11/7da/aa6/a117daaa609055ee10ebea20805e51ff.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/782/3e2/4a2/7823e24a2d7f6cd5bfef142a5e756e8c.jpg"></div><br>  <i>As a result, they are also moving in the averaged photo.</i>  <i>I watch people barely.</i> <br><br>  <b>Experiment 8.</b> So where do without the Eiffel Tower! <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/miCealqx_iE%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253&amp;usg=ALkJrhhTne_w4xQQ-ePUzyEwo_7PEeKllw" frameborder="0" allowfullscreen=""></iframe><br>  <i>This time lapse lasts almost a day!</i>  <i>Ideal, but how will the averaging behave when going from day to night and vice versa?</i> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a11/7da/aa6/a117daaa609055ee10ebea20805e51ff.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dfa/aa4/c1a/dfaaa4c1a36045d4d383bcf31e7f5c8a.jpg"></div><br>  <i>It turned out very even tolerably and mysteriously.</i>  <i>Some indefinite time of day.</i> <br><br>  <b>Experiment 9.</b> Well, then you can just play around and ply the average.  For example, there is a video where the type, traveling, fotka himself every day.  Let's see what comes of it. <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/5ky6vgQfU24%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253&amp;usg=ALkJrhjrrBrJgGREyGIzfQGSLpvOVdrLbQ" frameborder="0" allowfullscreen=""></iframe><br>  <i>Interesting video.</i>  <i>I want it too!</i> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a11/7da/aa6/a117daaa609055ee10ebea20805e51ff.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1af/ceb/c77/1afcebc774b593e099116c7eceed5b53.jpg"></div><br>  <i>It turned out very psychedelic.</i>  <i>It seems to me, or he looks like Jesus.</i>  <i>Or is Jesus himself a kind of averaged image?</i> <br><br>  <b>Experiment 10.</b> Why, with this thing you can look under the water !!!  This is what I mean: when the sea is swaying, the waves refract the bottom pattern.  If, of course, it is visible.  Then, taking the averaged distorted picture with a large exposure, we obtain an image of the bottom without the influence of water.  Cool!  Choose a cool long video in which you can see the bottom through the undulating water and watch: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/PCuzgXdm3R8%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253&amp;usg=ALkJrhjP83z1Ci47rhaF6OnJSPpvH1f8rQ" frameborder="0" allowfullscreen=""></iframe><br>  <i>Try to catch the flat surface of the water.</i>  <i>Will not work!</i> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a11/7da/aa6/a117daaa609055ee10ebea20805e51ff.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eee/a2a/473/eeea2a4735061bc3d949214d77696f62.jpg"></div><br>  <i>The averager averages the fluctuations of the surface of the water, averaging thereby the refraction.</i>  <i>See the bottom pattern and mirror-like smooth water surface!</i> <br><br>  <b>Experiment 11.</b> And if you average the motion, taken from the window of a vehicle, you can get the effect of rapid forward movement.  We take the video from the train and average literally 1 second! <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/632rDJGrH1M%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253&amp;usg=ALkJrhhikBAM71ymMgd5S4X1nuHnk9G4mA" frameborder="0" allowfullscreen=""></iframe><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a11/7da/aa6/a117daaa609055ee10ebea20805e51ff.png"></div><br><div style="text-align:center;"> <a href=""><img src="http://habrastorage.org/getpro/habr/post_images/e3c/aaf/4ba/e3caaf4ba332ac609a5a1d9e398c38f9.jpg"></a> </div><br>  <b>Experiment 12.</b> <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/4_GEx9iKI9o%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253&amp;usg=ALkJrhiE1m1wcvdf5hI-s9BjqJbFSsJ1Zg" frameborder="0" allowfullscreen=""></iframe><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a11/7da/aa6/a117daaa609055ee10ebea20805e51ff.png"></div><br><div style="text-align:center;"> <a href=""><img src="http://habrastorage.org/getpro/habr/post_images/574/df4/7cd/574df47cd7a7636a5f7a2522551fc70d.jpg"></a> </div><br><br>  Get good effects!  Fine.  I began to experiment with different videos and get interesting results.  But when I pampered, it seemed to me somehow not enough.  Cool, but not enough.  And here another interesting idea came to me.  When I watched and averaged a video shot from the windows of moving trains (for the effect of rapid movement), I realized what functionality my little program lacks!  And let her start shooting panoramas too! <br><br>  Yes, with panoramas everything is quite simple.  The train moves, the picture in the window changes, you only need to take a sequence of images from the window with a certain offset and glue one to the other from left to right or from right to left.  Then get a huge pano with the image of all that passed through the window.  I immediately began to experiment.  Wrote an intelligent glue detector with borders, but it turned out very bad!  All the time, the effect of the barrel and the illumination jumping from one fragment to another interfered.  I realized that before such giants as, for example, <a href="http://www.kolor.com/image-stitching-software-autopano-giga.html">Autopano Giga</a> , my program almost never reached out, and began to cheat.  Dream up.  How to make the panorama gluing smooth and continuous.  The first idea that came to my mind became decisive: it was necessary to glue together each frame, not fragments, with each frame adding one column to the resulting picture.  We take the first frame, cut out a thin vertical strip of the image, take the next frame, cut out the same thin strip and glue it to the first cut strip.  Left or right - depending on the direction of movement of the camera, which can be specified explicitly.  Since the second frame differs from the first one by a certain offset, the image in the two glued stripes will be something like a sweep of the panorama.  A kind of cheap analog <a href="http://en.wikipedia.org/wiki/Slit-scan_photography">slit-camera</a> ( <a href="http://www.google.ru/search%3Fq%3Dslit%2Bcamera%26tbm%3Disch">one</a> , <a href="https://play.google.com/store/apps/details%3Fid%3Djp.kuru2.slitcamera">two</a> , <a href="http://www.youtube.com/watch%3Fv%3DMxJIhlr0d-I">three</a> ).  Happened?  Go! <br><br>  <b>Experiment 13.</b> First, I need a video in which a fixed camera would shoot a moving object on a fixed background.  Then, if the object is quite long, you can scan it all!  Moving cars and trains are perfect for playing such videos.  Here I have collected such a handsome man, see: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/ulMBxkrxrF0%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253&amp;usg=ALkJrhg41nTc5XTrfwojBO1Y_yqYoQH35A" frameborder="0" allowfullscreen=""></iframe><br>  <i>The train runs from 01:57 to 03:17.</i> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a11/7da/aa6/a117daaa609055ee10ebea20805e51ff.png"></div><br><div style="text-align:center;"> <a href=""><img src="http://habrastorage.org/getpro/habr/post_images/d25/46d/e82/d2546de82d76fd8288d620e1b03ffe5e.jpg"></a> </div><br>  <i>Different lengths of cars turned out due to the changing speed of the train.</i>  <i>The picture is clickable.</i> <br><br>  It turned out unexpectedly great!  True, the program removes the panorama terribly flattened horizontally, and in order to return the correct proportions, you have to compress the resulting image severely vertically, which makes it small.  This is probably a drawback of both the program and the video fed to the input: if the train moved very slowly on it, then the proportions would be normal.  <b>Experiment 14.</b> Let's collect another picture, but this time from the window of a moving train. <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/RKta4QBFLaw%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253&amp;usg=ALkJrhh0n2sHUJnP_pr55QvAugjAHJZV4Q" frameborder="0" allowfullscreen=""></iframe><br>  <i>The camera is fixed pretty good c 3:25.</i> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a11/7da/aa6/a117daaa609055ee10ebea20805e51ff.png"></div><br><div style="text-align:center;"> <a href=""><img src="http://habrastorage.org/getpro/habr/post_images/bcc/ae3/f52/bccae3f52254d112fe04021c74fc8be6.jpg"></a> </div><br>  <i>It turned out a mini-panorama of the city.</i>  <i>The picture is clickable.</i> <br><br>  And here with the flaws everything is clear: strong distortion of objects.  Moving objects closer to the train fly the frame faster, moving farther from the train - slower.  The law of parallax.  This means that the foreground objects will be strongly flattened horizontally, and the background objects will be strongly elongated.  Here it is necessary to tune in to some specific one plane (range of objects from the camera) of perception.  In this case, at home in the distance.  They turned out quite "collected".  Everything that is closer (trees, wires, pillars) will be strongly flattened; everything that is further is stretched.  A perfect image in all planes cannot be obtained with the help of a slit scan.  <b>Experiment 15.</b> Take the following example and collect the platform of the station in Kislovodsk: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/BiEyo0_c7ZE%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253&amp;usg=ALkJrhhjjnH9fAoypYIuRkKtSihtui1Qsg" frameborder="0" allowfullscreen=""></iframe><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a11/7da/aa6/a117daaa609055ee10ebea20805e51ff.png"></div><br><div style="text-align:center;"> <a href=""><img src="http://habrastorage.org/getpro/habr/post_images/9bb/b68/cbf/9bbb68cbf0a75b5211d509cfa19a3834.jpg"></a> </div><br><br>  Here we see disproportionately flattened lights.  I confess, my mistake: since we were assembling the platform, and the lamps were right in the center of the platform, they were supposed to be completely flat.  We take now and collect panorama from another video: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/Vx0Ho2s8r3w%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253&amp;usg=ALkJrhicS6ynkzOApYZF9fpCAO7g0eRmbw" frameborder="0" allowfullscreen=""></iframe><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a11/7da/aa6/a117daaa609055ee10ebea20805e51ff.png"></div><br><div style="text-align:center;"> <a href=""><img src="http://habrastorage.org/getpro/habr/post_images/76b/002/e2b/76b002e2bdd4d90348235c66e07e0713.jpg"></a> </div><br>  <i>It can be seen as unevenly suspended wires.</i>  <i>The picture is clickable.</i> <br><br>  Then I flipped trees and tuned in to the remotely standing huts.  <b>Experiment 16.</b> Let's now another, with the suburb of Peter: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/DycvNb3Ul0k%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253&amp;usg=ALkJrhidKSytHymplc-3ed7bgqTQQ21DoA" frameborder="0" allowfullscreen=""></iframe><br>  <i>Panorama was going to 02:43.</i> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a11/7da/aa6/a117daaa609055ee10ebea20805e51ff.png"></div><br><div style="text-align:center;"> <a href=""><img src="http://habrastorage.org/getpro/habr/post_images/bdb/fa1/e1f/bdbfa1e1f06cf6540f2f90fb9e6772ff.jpg"></a> </div><br>  <i>Far houses are slightly stretched, neighbors are slightly flattened.</i>  <i>The system will not break.</i>  <i>The picture is clickable.</i> <br><br>  <b>Experiment 17.</b> Why not try cars, not trains?  I found an interesting video from the parade on the square, where the motionless camera was shooting cars passing by on the parade: <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/2gDKkn8XhM4%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253&amp;usg=ALkJrhjoew8ZAIn60kwWGfuLxKZjajUNQQ" frameborder="0" allowfullscreen=""></iframe><br>  <i>The video quality is terrible, the camera is shooting with very low FPS.</i> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a11/7da/aa6/a117daaa609055ee10ebea20805e51ff.png"></div><br><div style="text-align:center;"> <a href=""><img src="http://habrastorage.org/getpro/habr/post_images/996/675/9f6/9966759f6e33326a04c7053bb61aaada.jpg"></a> </div><br>  <i>Hence the quality of the final panorama.</i>  <i>However, the structure of the front column is read quite naturally.</i>  <i>The picture is clickable.</i> <br><br>  Having played enough, I began to mess around stupidly. <br><br>  <b>Experiment 18.</b> <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/9E7h3u675f4%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253&amp;usg=ALkJrhiDZVbLty0fD_BJO-nzucbElvkvPA" frameborder="0" allowfullscreen=""></iframe><br>  <i>Mad</i> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a11/7da/aa6/a117daaa609055ee10ebea20805e51ff.png"></div><br><div style="text-align:center;"> <a href=""><img src="http://habrastorage.org/getpro/habr/post_images/3f8/fd8/589/3f8fd85899315bc14a7fae3233535f1c.jpg"></a> </div><br>  <i>Slit-Mad Picture is clickable.</i> <br><br>  <b>Experiment 19.</b> <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/nb0YoRMXIY0%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253&amp;usg=ALkJrhhiVmDifoU9q52YweX3v1RpBZDprg" frameborder="0" allowfullscreen=""></iframe><br>  <i>Michael</i> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a11/7da/aa6/a117daaa609055ee10ebea20805e51ff.png"></div><br><div style="text-align:center;"> <a href=""><img src="http://habrastorage.org/getpro/habr/post_images/9f0/5f8/504/9f05f850446500eaf2e461566feb31e2.jpg"></a> </div><br>  <i>Slit-Michael Picture clickable.</i> <br><br>  <b>Experiment 20.</b> <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/C6tAnd33ndg%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253&amp;usg=ALkJrhgJKPqF5BtfvDljNxzRQ-pL3oZx6w" frameborder="0" allowfullscreen=""></iframe><br>  <i>Volodya</i> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a11/7da/aa6/a117daaa609055ee10ebea20805e51ff.png"></div><br><div style="text-align:center;"> <a href=""><img src="http://habrastorage.org/getpro/habr/post_images/3ae/dcf/2cb/3aedcf2cbbac5239b9b6ba26234a4923.jpg"></a> </div><br>  <i>Slit-Volodya Picture clickable.</i> <br><br>  Charming!  =) <b>Experiment 21.</b> And lastly even more charming: the panorama shows a smooth change in the color of the sky in the evening.  Here, too, everything is quite simple: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/Tp6HQCb70yM%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253&amp;usg=ALkJrhgwLSqrmbx2EZ42Watjz-Hey7bLMg" frameborder="0" allowfullscreen=""></iframe><br>  <i>Panorama was created from 1 to 38 seconds.</i> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a11/7da/aa6/a117daaa609055ee10ebea20805e51ff.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0ca/f34/9c0/0caf349c0516f5d80e598390c66ed453.jpg"></div><br>  <i>We observe the sunrise from left to right.</i> <br><br>  Now you can play around by downloading this small and cool program. <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/90a/b36/af1/90ab36af11e3d783ea47abd0332ccfd2.png"></a> </div><br>  Management in averaging mode: select the "averaging" mode.  Move the mouse to the upper left corner of the video and hold down "[" - the program remembers the upper left corner.  It is not necessary that the application showing the video be active at this moment;  Any application can be active.  Move the mouse to the bottom right corner of the video and click "]" - the program remembers the bottom right corner and, thus, all the coordinates of the frame from the video completely.  Launch the video.  We begin to average, at any time by holding down the "/" on the numeric keypad on the right.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">During averaging, the program reports the number of averaged frames. Identical neighboring frames are not averaged, but are ignored (thus, when a video is frozen, the program will not spoil the result). We average the sample amount of time. To complete the averaging, hold down the "*" on the numeric keypad on the right. The result is written in the same folder as Ekspozzer.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Control in panning mode: select the "panorama" mode. We select the arrow to the left if the camera in the video ‚Äúflies‚Äù to the left (tobish the picture moves to the right); or to the right, if the camera in the video ‚Äúflies‚Äù to the right (tobish the picture moves to the left). Select the width of the panorama in pixels. Move the mouse to the upper edge of the video (approximately in the center) and hold down "[" - the program remembers the upper left corner. We move the mouse to the bottom edge of the video, slightly retreating to the right, and click "]" - the program remembers the lower right corner and, thus, the coordinates of the "slot" through which a panorama will be collected from the video. Launch the video. We start to collect a panorama, at any moment of time holding the "/" on the numeric keypad on the right. The result is written in the same folder as Ekspozzer.</font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I ask you not to beat: the program was originally created ‚Äúon the knee‚Äù and for yourself, there is no usability in the program. </font><font style="vertical-align: inherit;">All the above is a purely entertaining popular science experiment.</font></font></i> <br><br>  Thank you for attention! </div><p>Source: <a href="https://habr.com/ru/post/251297/">https://habr.com/ru/post/251297/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../251285/index.html">Overview of Microsoft Azure platform updates for February</a></li>
<li><a href="../251289/index.html">Corporate and unincorporated IaaS: how not to get lost in the cloud market</a></li>
<li><a href="../251291/index.html">Data Owners - Thoughts on, Pros and Cons</a></li>
<li><a href="../251293/index.html">What bugs did LibreOffce find in PVS-Studio?</a></li>
<li><a href="../251295/index.html">Data compression methods</a></li>
<li><a href="../251299/index.html">Lamp showing the weather forecast</a></li>
<li><a href="../251301/index.html">Administration of computers on the local network before loading the operating system</a></li>
<li><a href="../251303/index.html">16 months of functional programming</a></li>
<li><a href="../251307/index.html">node-seq in a new way (again about asynchrony)</a></li>
<li><a href="../251309/index.html">IBM invites to the ‚ÄúSoftlayer Introduction‚Äù webinar</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>