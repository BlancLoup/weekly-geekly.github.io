<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Speed ‚Äã‚ÄãDevelopment Unity3D games for the competition</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I will tell you about interesting and slightly unobvious moments of video game development in a short time: according to the competiti...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Speed ‚Äã‚ÄãDevelopment Unity3D games for the competition</h1><div class="post__text post__text-html js-mediator-article">  In this article I will tell you about interesting and slightly unobvious moments of video game development in a short time: according to the competition regulations, a workable demo must be submitted within a week, and a release within two weeks.  The article is intended for those who have already played with Unity3D, but have not yet done any projects on this game engine more complicated than HelloWorld. <br><br>  Picture to attract attention - a screenshot of the game. <br><br><img src="https://habrastorage.org/files/d60/420/fb3/d60420fb32a34eacb87c10f936bae8e6.png" alt="image"><br><a name="habracut"></a><br><h4>  The idea of ‚Äã‚Äãthe game, the concept </h4><br>  I love games.  As a phenomenon.  And the development of video games is a very interesting spike of the art of programming, mathematics and art.  Unfortunately, I still can not afford enough time and resources to engage in game development in full, commercially-successful measure: despite the substantial simplification of the process of creating games, experience has shown that a more or less holistic game on mobile phones receives less attention than the two-day hello -Port three-four years ago. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      However, with a two-week competition of games and the demand is small, then you can try. <br><br>  At the very first stage of development, you need to choose the concept of the game.  Genre, gameplay, similar games, than your game will be better than existing ones.  And the most important thing at this moment is not to overestimate your strength, because the rules are very tough in terms of time, and apart from the competition it is very important to adequately assess your capabilities and capabilities of your team - otherwise the development may be delayed, and the enthusiasm will be lost. <br><br>  In this case, I chose a rather simple genre - an arcade from the top, with elements of hack &amp; slash.  I was inspired by the following games (I think many of them played, saw, are somehow familiar): <br><br>  <b>Sword of the stars: The pit</b> <br><br><img src="https://habrastorage.org/files/390/fac/2b2/390fac2b21674f64a1d44366765e19f7.png" alt="image"><br><br>  A turn-based game in the Rogue-like genre, one of my favorite bagels: extraordinarily simple, but at the same time exciting.  From this game, I borrowed the idea of ‚Äã‚Äãgenerated mazes and random spawning of enemies. <br><br>  <b>Crimsonland</b> <br><br><img src="https://habrastorage.org/files/b64/d99/64a/b64d9964a779410e810827494c056b0d.png" alt="image"><br><br>  Arcade with top view.  From this game I borrowed the number of opponents and the dynamics. <br><br>  As a result, I came to the following gameplay: the player, controlling the character, runs through the maze, shoots enemies, collects power-ups, interacts with the environment of the level, searches for keys and goes to the next level, where the adversaries are more evil, and the mazes are more intricate.  Choosing a development environment, tools, platform. <br><br>  What can we choose from?  There is a huge number of gaming and graphics engines, but the most popular at the moment are Unity3D, UnrealEngine4, cocos2d, libGDX.  The first two are used mainly for desktop "complex" games, the last two - for simple two-dimensional games for mobile phones.  Also for simple games there are mouse-oriented designers. <br><br><img src="https://habrastorage.org/files/121/13a/fa4/12113afa4bd240068addd4fa2e422f70.png" alt="image"><br><br>  Despite the fact that I am a C ++ zealot and endlessly in love with this language, I am aware that this language is not what a game should be written in two weeks.  Unity3D provides the ability to write scripts in C #, JS and in its own Python-like Boo-script language.  Most programmers use C # for obvious reasons.  Yes, and I liked Unity, at the level of sensations. <br><br><h4>  Development, architecture, interesting moments </h4><br><h5>  Levels </h5><br>  The game involves running through the maze, and the maze must be generated.  At first, I decided to come up with an algorithm myself, at first glance, the business seemed simple: I split the field into two unequal parts horizontally or vertically, creating a passage from one part to another.  Then I recursively pass through the left and right "island" and also process them: if the dimensions allow, I divide them into two parts, if they do not, then I leave the room as it is. <br><br>  It turns out such an unbalanced binary tree with all the consequences - from any room to any other you can go through a single path.  This is not very correct from the point of view of interest in the study of this labyrinth, and the labyrinths themselves had an obvious square-nested appearance with a tendency to elongated, narrow rooms, resembling something like the construction of residential areas in Russia, no matter how I am adjusted to the constants.  Unfortunately, the original version of the algorithm has not been preserved, and I cannot show its results. <br><br><img src="https://habrastorage.org/files/3ae/d62/73e/3aed6273e50742fa8cbe2d28df42bf48.png" alt="image"><br>  <i>Illustration of the original maze generation algorithm</i> <br><br>  Then, I decided to look for an generation algorithm on the Internet, found it on gamedev.ru, written in C ++. <br><br>  The essence of the algorithm is as follows: the desired number of n rooms is placed on an empty field.  For each new room, its size is specified randomly within the specified limits, then the room is placed on random coordinates of the playing field.  If the created room crosses the previously created rooms, then it should be recreated in a random place with random sizes.  If the room cannot find a place through the main m = 100 iterations, then the field is considered filled, and proceed to the next room. <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Generate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> roomsCount</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; roomsCount; i++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>; j++) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> w = Random.Range(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> h = Random.Range(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>); Room room = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Room(); room.x = Random.Range(<span class="hljs-number"><span class="hljs-number">3</span></span>, m_width - w - <span class="hljs-number"><span class="hljs-number">3</span></span>); room.y = Random.Range(<span class="hljs-number"><span class="hljs-number">3</span></span>, m_height - h - <span class="hljs-number"><span class="hljs-number">3</span></span>); room.w = w; room.h = h; List&lt;Room&gt; inter = rooms.FindAll(room.Intersect); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inter.Count == <span class="hljs-number"><span class="hljs-number">0</span></span>) { rooms.Add(room); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } }</code> </pre> <br><img src="https://habrastorage.org/files/716/e11/52b/716e1152b3bd41498eecf97f671f80b3.png" alt="image"><br><br>  Then, when the required number of rooms is created, it is necessary to connect them with aisles: We go around all the created rooms and calculate the path according to the algorithm for finding the path A * from the center of the processed room to the center of each other room.  For the algorithm A *, we set the weight for the cell of the room unit to 1, and for the empty cell to k.  The algorithm will give us a set of cells - the path from room to room, in this lies the magic: increasing k, we get a more confusing maze with a smaller number of corridors, increasing - we get a labyrinth ‚Äústitched‚Äù by the corridors.  This effect is achieved due to the fact that with a larger weight of an empty cage, the path finding algorithm tries to pave the way around, rather than ‚Äúpunch‚Äù the road. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateAllPassages</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (Room r <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> rooms) { APoint center1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> APoint(); center1.x = rx + (rw/<span class="hljs-number"><span class="hljs-number">2</span></span>); center1.y = ry + (rh/<span class="hljs-number"><span class="hljs-number">2</span></span>); center1.cost = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (Room r2 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> rooms) { APoint center2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> APoint(); center2.x = r2.x + (r2.w/<span class="hljs-number"><span class="hljs-number">2</span></span>); center2.y = r2.y + (r2.h/<span class="hljs-number"><span class="hljs-number">2</span></span>); center2.cost = <span class="hljs-number"><span class="hljs-number">1</span></span>; GeneratePassage(center1, center2); <span class="hljs-comment"><span class="hljs-comment">//    } } for (int x = 0; x &lt; m_width; x++) for (int y = 0; y &lt; m_height; y++) if (m_data[x,y] == Tile.Path) m_data[x,y] = Tile.Floor; }</span></span></code> </pre><br>  Green tiles indicate the result of finding a path from each room to each. <br><br><img src="https://habrastorage.org/files/f68/62f/e5f/f6862fe5fecf4e5cb74f2e23bc77887b.png" alt="image"><br><br>  Then comes the ‚Äúdecoration‚Äù of the labyrinth, the search for walls. <br><br><img src="https://habrastorage.org/files/815/007/38a/81500738a8f0400b938da5aac6eb4892.png" alt="image"><br><br>  The algorithm is extremely non-optimized; on the i7 notebook, the generation of the maze 50 * 50 (but with the creation of game objects representing the level) takes about 10 seconds.  Unfortunately, I can‚Äôt even approximately estimate the complexity of the level generation algorithm, because the complexity of the wave path finding algorithm depends on the coefficient k - the more confusing the labyrinth, the more A * is prone to exponential complexity.  However, he creates exactly such mazes as I would like to see in my game. <br><br>  Now, we have a labyrinth, in the form of a two-dimensional array.  But the game we have is three-dimensional, and it is necessary to somehow create this maze in three-dimensional space.  The most obvious and wrong option is to create a game object - a cube or a plane - for each element of the array.  The disadvantage of this approach will be the fact that each of these objects will be integrated into the event processing system, which already works in one CPU flow, significantly slowing it down.  The scene from the screenshot with a large number of rooms on my computer seriously lags.  It may seem that this approach will load the video card with draw-calls ‚Äî but no, Unity perfectly batches various objects with one material.  And yet, this is not worth doing. <br><br>  The correct approach is to create a single object, with a mesh based on a two-dimensional array of level tiles.  The algorithm is simple: for each tile, we draw two geometry triangles for the render, two geometry triangles for the collider, and set texture coordinates to the points.  There is one subtlety. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateMesh</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Map.Tile [,] m_data, Map.Tile type, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> height = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.0f</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> scale = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.0f</span></span></span></span></span><span class="hljs-function">)</span></span> { mesh = GetComponent&lt;MeshFilter&gt; ().mesh; collider = GetComponent&lt;MeshCollider&gt;(); squareCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> m_width = m_data.GetLength(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> m_height = m_data.GetLength(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; m_width; x++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span>; y &lt; m_height; y++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m_data[x,y] == type) { newVertices.Add( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3 (x*scale - <span class="hljs-number"><span class="hljs-number">0.5f</span></span>*scale , height , y*scale - <span class="hljs-number"><span class="hljs-number">0.5f</span></span>*scale )); newVertices.Add( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3 (x*scale + <span class="hljs-number"><span class="hljs-number">0.5f</span></span>*scale , height , y*scale - <span class="hljs-number"><span class="hljs-number">0.5f</span></span>*scale)); newVertices.Add( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3 (x*scale + <span class="hljs-number"><span class="hljs-number">0.5f</span></span>*scale , height, y*scale + <span class="hljs-number"><span class="hljs-number">0.5f</span></span>*scale)); newVertices.Add( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3 (x*scale - <span class="hljs-number"><span class="hljs-number">0.5f</span></span>*scale , height, y*scale + <span class="hljs-number"><span class="hljs-number">0.5f</span></span>*scale)); newTriangles.Add(squareCount*<span class="hljs-number"><span class="hljs-number">4</span></span>); newTriangles.Add((squareCount*<span class="hljs-number"><span class="hljs-number">4</span></span>)+<span class="hljs-number"><span class="hljs-number">3</span></span>); newTriangles.Add((squareCount*<span class="hljs-number"><span class="hljs-number">4</span></span>)+<span class="hljs-number"><span class="hljs-number">1</span></span>); newTriangles.Add((squareCount*<span class="hljs-number"><span class="hljs-number">4</span></span>)+<span class="hljs-number"><span class="hljs-number">1</span></span>); newTriangles.Add((squareCount*<span class="hljs-number"><span class="hljs-number">4</span></span>)+<span class="hljs-number"><span class="hljs-number">3</span></span>); newTriangles.Add((squareCount*<span class="hljs-number"><span class="hljs-number">4</span></span>)+<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tileIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> numTiles = <span class="hljs-number"><span class="hljs-number">4</span></span>; tileIndex = Mathf.RoundToInt(Mathf.Sqrt(Random.Range(<span class="hljs-number"><span class="hljs-number">0</span></span>, numTiles * numTiles)*<span class="hljs-number"><span class="hljs-number">1.0f</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> squareSize = Mathf.FloorToInt(Mathf.Sqrt(numTiles)); newUV.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2((tileIndex % squareSize)/squareSize, (tileIndex/squareSize)/squareSize)); newUV.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(((tileIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>) % squareSize)/squareSize, (tileIndex/squareSize)/squareSize)); newUV.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(((tileIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>) % squareSize)/ squareSize, (tileIndex / squareSize + <span class="hljs-number"><span class="hljs-number">1</span></span>)/squareSize)); newUV.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2((tileIndex % squareSize)/squareSize, (tileIndex/squareSize + <span class="hljs-number"><span class="hljs-number">1</span></span>)/squareSize)); squareCount++; } } mesh.Clear (); mesh.vertices = newVertices.ToArray(); mesh.triangles = newTriangles.ToArray(); mesh.uv = newUV.ToArray(); mesh.Optimize (); mesh.RecalculateNormals (); Mesh phMesh = mesh; phMesh.RecalculateBounds(); collider.sharedMesh = phMesh; squareCount=<span class="hljs-number"><span class="hljs-number">0</span></span>; newVertices.Clear(); newTriangles.Clear(); newUV.Clear(); }</code> </pre><br>  For the texture of the floor, I use altas of four different tiles: <br><br><img src="https://habrastorage.org/files/688/d56/e89/688d56e89b824fa9979f61989404045b.png" alt="image"><br><br>  And I noticed that a distribution looks more natural when there are more tiles and less of them.  In fact, there is no such subgame, where, on average, on every second square meter of the floor there is scattered exactly one skeleton of fish. <br>  To create such an uneven distribution, I use the following line: <br><br><pre> <code class="cs hljs">tileIndex = Mathf.RoundToInt(Mathf.Sqrt(Random.Range(<span class="hljs-number"><span class="hljs-number">0</span></span>, numTiles * numTiles)*<span class="hljs-number"><span class="hljs-number">1.0f</span></span>));</code> </pre><br>  It provides a fundamental dependence of the number of tiles. <br><br>  Then, the texture coordinates of the selected tile are set in the list of texture coordinates.  This block of code works on tile sets with the number of tiles equal to the power of two. <br><br>  The result is visible on the KDPV - quite naturally and unaffected, despite the fact that the tiles still have joints, and there are only four of them. <br><br>  At this stage, we have the geometry of the level, but we need to ‚Äúrevive‚Äù it by adding enemies, power-ups, cutscenes, and some other game logic, if necessary. <br><br>  To do this, create a Singleton Manager responsible for levels.  You can make the ‚Äúright‚Äù singleton, but I just added an object manager object to the scene where the gameplay directly takes place and made the manager fields global.  Such a decision may be academically incorrect (and has the name Hindu Singleton), but with his help I achieved that Unity serializes the manager's fields and allows you to edit them in the real-time object inspector.  It is much easier and faster than changing the settings of the ka; logo level in the code, allows you to debug the balance without turning off the player.  A very useful feature, I used it more than once, for example, to create objects of a class responsible for dialogs: <br><br><img src="https://habrastorage.org/files/547/15e/bb5/54715ebb59834090a9e2ec40239ae328.png" alt="image"><br><br>  A set of game levels is an array of objects that describe each level.  The class that describes the level is: <br><br><img src="https://habrastorage.org/files/4f7/a3d/612/4f7a3d612e374b0db8340e0aff9556ea.png" alt="image"><br><br>  The level is created as follows: the level manager receives an Awake () message, reads the value of a global variable ‚Äî the level number to be loaded (initially it is zero, increases as the protagonist moves deeper into the maze), selects the desired level from an array of Level objects.  Then, if the level is procedurally generated (generated == true), then the construction and decoration of the maze is launched.  The construction of the maze is discussed earlier, and the decoration is due to the performance of delegates decorations and decorationsSize.  In the first delegate, I add procedures that take no arguments, for example, adding to the level of a ladder, and in the second, with an argument, for example, adding powerings to the level (to maintain power density equal to the density of power per square meter of the maze, the amount of bonuses should be proportional to square maze-sized maze or enemies. <br><br>  The following function places the enemies using an array of structures from two fields - the enemy's prabab, which should be created, and the weight of this opponent.  For example, if the array is: <br><br> <code>{{Mob1, 5.0f}, {Mob2, 1.0f}} <br></code> <br>  That mob like Mob1 will spawn with a probability five times more than Mob2.  The number of types of mobs can be arbitrary. <br>  With this feature, you can randomly with a certain probability to place the same artifacts in the chests, the effects of unknown potions and anything! <br><br><img src="https://habrastorage.org/files/e56/0fd/9ac/e560fd9ac5d54075849326d28af2f547.png" alt="image"><br><br>  Then, as for the generated one, as well as for the hard-coded one, we instantiate the prefab level, if any.  For a hard-coded level, this is the level itself, with its geometry, characters.  And for generated it can be a dialogue or a cut-scene. <br><br><h5>  Characters  Scripts  Interactions </h5><br>  Despite the fact that Unity3D uses C #, it is supposed to work not with the usual OOP, but with its own pattern based on objects, components and events. <br><br>  If you have ever launched Unity, then you need to understand these entities - game objects have several components, components are responsible for certain functions of the object, which may include user scripts.  Messages (user or service, such as Awake (), Start (), Update ()) are sent to the game object and reach each component, each component processes them at its own discretion.  The pattern familiar to Unity comes out of this: instead of inheritance, you should use a composition of components, for example, as shown in the picture. <br><br><img src="https://habrastorage.org/files/45b/6d0/465/45b6d0465c0e4d49810a970ffa990681.png" alt="image"><br><br>  There is an object of the type ‚ÄúMob‚Äù, with components that perform special tasks, called characteristic names.  The EnemyScript component is responsible for the AI, sends Shoot (Vector3 target) messages to its game objec- tion to fire, and MoveTo messages (Vector3 target) to send the mob to this point. <br><br>  The ShooterScript component accepts ‚ÄúShoot‚Äù messages and fires, MoveScript accepts MoveTo messages.  Now, let's say we want to make a mob that is similar to this one, but with a modified behavior logic, AI.  To do this, you can simply replace the component with the AI ‚Äã‚Äãscript with some other one, for example, like this: <br><br><img src="https://habrastorage.org/files/298/8a8/02c/2988a802cce64e2dbac0b717396bef59.png" alt="image"><br><br>  In the usual C ++ C ++ OOP, this could look like this (in Unity, this is not the case): <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">FooEnemy</span></span> : <span class="hljs-title"><span class="hljs-title">public</span></span> <span class="hljs-title"><span class="hljs-title">ShooterScript</span></span>, <span class="hljs-title"><span class="hljs-title">public</span></span> <span class="hljs-title"><span class="hljs-title">MoveScript</span></span>, <span class="hljs-title"><span class="hljs-title">public</span></span> <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { MoveScript::Update(); ShooterScript::Update(); Shoot({ <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>}); MoveTo({ <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>}); } }; <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">BarEnemy</span></span> : <span class="hljs-title"><span class="hljs-title">public</span></span> <span class="hljs-title"><span class="hljs-title">ShooterScript</span></span>, <span class="hljs-title"><span class="hljs-title">public</span></span> <span class="hljs-title"><span class="hljs-title">MoveScript</span></span>, <span class="hljs-title"><span class="hljs-title">public</span></span> <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { MoveScript::Update(); ShooterScript::Update(); Shoot{ <span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>}); MoveTo({ <span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>}); } };</code> </pre><br>  In Unity, a very user friendly has been done and is muscularly oriented, in my opinion, this is good, since the variety of enemies is more content of the game than the ‚Äúprogrammer‚Äù part. <br><br>  The communication between different objects occurs in a similar way: when the bullet object processes the collision overhead message, it sends a ‚ÄúDamage (float)‚Äù message to the object it collides with.  Then, the ‚ÄúDamage Receiver‚Äù component accepts this message, reduces the number of hit points, and if the hit points are below zero, it sends itself the ‚ÄúOnDeath ()‚Äù message. <br><br>  Thus, we can get several prefabs of opponents with diverse behavior. <br><br><h5>  Lifebar </h5><br>  The project uses a lot of interesting and non-obvious for the novice developer techniques, everything in the framework of the article will not work out, so in this article I will consider a simple implementation of the life bar. <br><br><img src="https://habrastorage.org/files/a09/619/6e7/a096196e7d5d43a9a9caafb7da7e5b3b.png" alt="image"><img src="https://habrastorage.org/files/50d/c29/2e0/50dc292e0d1f4010a4ddae0f15447ab9.png" alt="image"><br><br>  In all games, there are opponents who have to be full of HP, and in almost all games there is a hero who spends his energy or mana to get rid of HP.  For my solution, you will need a child game object (say, you can call it Healthbar) with a quad, which will display the desired strip.  This object should have a MeshRenderer component with material that can be seen on the thumbnail (a square with the left side green and the right red side). <br>  Also, for the correct display of the conceived it is necessary that the texture of the life bar has a point (POINT) filtering. <br><br><img src="https://habrastorage.org/files/5f4/98a/3a8/5f498a3a8dd041e195efda3c4ea908cd.png" alt="image"><br><br>  The idea is this: we set the tiling on the horizontal axis to 0.5, and the quad will display half of the image.  When the offset on the same axis is set to 0, the left half of the square (green) is displayed, when in 1 it is the right, in intermediate values ‚Äã‚Äãthe life bar behaves the way the life bar should behave.  In my case, the texture of the lifebar consists of two pixels, but this menthod allows you to display beautiful, hand-made lifebars. <br><br>  The component responsible for processing and displaying damage, in the case when it needs to update the state of the lifebar, executes the following code: <br><br><img src="https://habrastorage.org/files/668/75f/d64/66875fd64a104750ab8e49a81c2361e1.png" alt="image"><br><br>  The method for displaying mana is ‚Äúsmarter‚Äù, because it also operates with an offset along the vertical axis - in this case, a four-pixel texture is used in which the upper part corresponds to the active strip and the lower part to the passive one (for example, during reloading, overheating of the weapon or overworked sorcerer) . <br><br><img src="https://habrastorage.org/files/a8d/bc6/54a/a8dbc654abff4871aa9affaf301b8a6b.png" alt="image"><br><br><img src="https://habrastorage.org/files/2f8/ddc/a8c/2f8ddca8c3c94dd3a34bf5d39399c108.png" alt="image"><br><br><h4>  Results </h4><br><img src="https://habrastorage.org/files/16f/be5/134/16fbe51344944a6d83f2f1e533a5c49b.png" alt="image"><br><br>  Unfortunately, I lost the contest, taking a shameful place in the middle of the list of participants. <br><br>  The error, in my opinion, is this: very little content.  Having spent a lot of time designing spherical scalability in vacuum, on the penultimate day of the competition I realized that there is no content in the game at all.  Levels, plot, sprites, enemies, bonuses and all that.  As a protagonist in the game runs a placeholder, inserted for the sake of laughter.  As a result, the game turned out to be ten minutes of interesting, vigorous gameplay, with various enemies, with the possibility of game development, but without history and without graphics.  A zero level with a square platform suspended in a vacuum immediately informs the player that the game is raw and unfinished.  It was not what was required in the competition.  The jury wanted to read the story, look at pixel art and listen to music, not play games. <br><br>  Also, UnityD is about assets.  Of course, it was more interesting for me to develop bicycles, which I did - I didn't use any assets, all the scripts and resources were my own.  But you don‚Äôt have to do that if the work goes to the result, not to the interest. <br><br>  In general, the defeat somewhat affected my drive impulse.  We need to get some rest, and then look at the project with a new look: if I find the enthusiasm and prospects for the project, then maybe I‚Äôll finish it and put it in the greenlight.  Otherwise, I will lay out the source code in open access, and I will draw up interesting moments, like the same creation of mazes, in the form of a paid asset in Unity. <br><br>  I hope the article was interesting and informative. <br><br>  PS: You can familiarize yourself with the game by downloading it <a href="https://yadi.sk/d/zNgEKlTOozByL">from this link</a> . <br>  Or, in the Yandex browser <a href="http://hotkeym.github.io/caveWebPlayer/">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/278947/">https://habr.com/ru/post/278947/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../278937/index.html">Testing Bash Applications</a></li>
<li><a href="../278939/index.html">Our experience with Docker</a></li>
<li><a href="../278941/index.html">How our testing is arranged and why QA participates in the formulation of problems to our developers</a></li>
<li><a href="../278943/index.html">OpenConfig - a standardized approach to configuring network equipment</a></li>
<li><a href="../278945/index.html">Android runtime permissions. Why, why, and how</a></li>
<li><a href="../278949/index.html">Spiceworks research: insider threats will be the biggest information security challenge in 2016</a></li>
<li><a href="../278951/index.html">We collect Electron.js rake or desktop JS-applications in practice</a></li>
<li><a href="../278953/index.html">Web merge sync on MS SQL</a></li>
<li><a href="../278955/index.html">An error in the AMD processor microcode allows virtual machine users to access the hypervisor host system</a></li>
<li><a href="../278957/index.html">ScribeJava - even your grandma can work with OAuth</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>