<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Lync and Avaya IPO integration</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings reader! I want to highlight today the issue of sharing MS Lync Server 2010 and external telephony. As the name implies, the example of Avaya...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Lync and Avaya IPO integration</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/f4e/5c5/08c/f4e5c508c97a0d73cf7c897ce75f4000.png"><br>  Greetings reader!  I want to highlight today the issue of sharing MS Lync Server 2010 and external telephony.  As the name implies, the example of Avaya IPO.  In fact, the specific model of PBX does not matter.  It works with everything, including Asterisk, about the integration of which on the Internet is written a lot.  With some equipment, Lync can work using the Direct SIP protocol (for example, with CUCM). <br><br>  For a long time I will not describe the front of the needs that such integration can solve.  There are many of them and they do not affect the essence of the process much.  In my case, this was done so that users could use the internal telephony and participate in newsgroups from outside the office.  That is, in this particular application, it is Lync that complements Avaya, and not vice versa.  IPO provides telephony and communication. <br><br>  So the disposition: <br>  The office is Avaya IPO406v2 (numbers 5xx).  Phones are used analog (Panasonic-and mostly cheap), digital (branded devices Avaya) and all sorts of hardware SIP-phones (the zoo in general).  The network has Lync 2010 Standart (numbers 4xxx), which was used mainly by remote employees to communicate with the office.  The EDGE server is viewed from the Lync on the Internet, and remote employees go outside through it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The challenge in general is to ensure that Lync and Avaya can transmit voice to each other. <br><a name="habracut"></a><br><h4>  Well ... Let's proceed directly to the setting. </h4><br><h5>  Let's start with Lync Server. </h5><br>  First you need to turn on the Mediation server.  If the server is standard, then simply enable the Collocated Mediation Server directly on the Front-End server.  If the version of Lync is Enterprise, you will have to install a separate server with the role of Mediation.  We have a standard, therefore, consider it. <br><br><img src="https://habrastorage.org/storage2/73a/527/6b2/73a5276b2d0dc97fa99a7681cacf259d.png"><br><img src="https://habrastorage.org/storage2/664/3a9/cc7/6643a9cc7a4c190dd23a195dabbda267.png"><br><br>  At this stage, the list of gateways will be empty (if not added in advance). <br>  You need to add a PSTN gateway. <br>  When adding a gateway, the system will ask us for the IP address of the gateway, in our case of PBXs.  Interaction port and protocol.  Protocol select TCP, and port 5060. <br>  By the way, Lync server can work with several gateways at the same time through one Mediation server, unlike OCS. <br><br>  Then in the place where we enabled Mediation to add a gateway. <br><br>  After that, publish the topology and start the server Mediation service.  In idel, it is better to restart Lync, but this is not necessary. <br><br><h5>  The next step is to configure the PBX. </h5><br>  Create a SIP Line. <br><img src="https://habrastorage.org/storage2/279/53e/8ec/27953e8ecd9c825563e81018cfe243fe.png"><br>  For this line, configure the SIP URI <br><img src="https://habrastorage.org/storage2/a6f/3cb/161/a6f3cb1618843901785a37f284b6e525.png"><br>  Well, the codec too.  Lync understands only G.711.  And although the auto-negotiation of codecs by the PBX selects the correct codec, some kind of subtle glitches still occurred.  Therefore it was necessary to specify it forcibly. <br><img src="https://habrastorage.org/storage2/adb/93b/1a5/adb93b1a546163f4735883d5e54428f0.png"><br><br><h4>  Call Routing </h4><br><h6>  From the PBX </h6><br>  It is better to route calls using ARS, but for my specific needs it is redundant, therefore I made a simple Short Code. <br><img src="https://habrastorage.org/storage2/2a6/366/2bf/2a63662bf7519db26d67bbe1bed594ea.png"><br>  This is where Avaya IPO setup ends. <br><br><h6>  On the Lync side </h6><br>  In this place it is worth making a small lyrical digression: <br>  All users will be able to receive calls from PBX to Lync, however, only those who have Enterprise Voice enabled (for this you need an Enterprise CAL) can call outside. <br>  Plus, in order for the PBX to call the Lync user, all users need to distribute phone numbers.  In my cases, I made them 4-digit to visually separate from internal numbers. <br>  Something like this: <br><img src="https://habrastorage.org/storage2/8ac/5ee/f24/8ac5eef240059bec5eb201e7ab7a3ad8.png"><br><br>  Next Dial Plan.  Go to Voice Routing on the Lync control panel. <br>  By default, there is a global dial plan.  If there is no need to distribute different plans to different users, then you can get by just editing this.  Plans themselves (as well as politicians) come in three levels.  Global, site level and user level.  Priority is inversely proportional to the coverage area. <br><img src="https://habrastorage.org/storage2/caa/100/f7b/caa100f7b994eaee69275e7185295315.png"><br>  Create normalization rules. <br><img src="https://habrastorage.org/storage2/1c9/7ce/ffa/1c97ceffacdfde803d8f036513bb5706.png"><br>  If someone is friends with regular expressions, you can not use the wizard. <br><br>  Specifically, I need three rules: <br><ul><li>  For calls to PBX.  ^ (5 \ d {2}) $ </li><li>  For calls outside.  ^ (\ d {11}) $ </li><li>  For internal calls.  ^ (4 \ d {3}) $ </li></ul><br><br>  Next, the Voice Policy: <br>  There is also a global default policy here.  You can edit it. <br><img src="https://habrastorage.org/storage2/1e5/d45/d4c/1e5d45d4cf43a74eecb8753a7b7c9bec.png"><br>  Create PSTN Usage: <br><img src="https://habrastorage.org/storage2/60d/eee/298/60deee29871b35d110c354c5d6e91056.png"><br>  As part of the PSTN Usage create a route.  That is, the link of the type of pattern numbers &lt;-&gt; gateway.  As I already upiminal above, you can use multiple gateways for routing. <br><img src="https://habrastorage.org/storage2/0b2/37a/efc/0b237aefc5233811ca3666865a8e4d3e.png"><br><br>  We repeat this procedure for all three directions. <br><br>  At each stage, it is possible to test the correctness of the rules entered.  You can also create permanent tests, and at each stage of the setup see what stage the call will take at the moment. <br><img src="https://habrastorage.org/storage2/429/f55/5a4/429f555a425747e518fdc2879cb2955e.png"><br><br><img src="https://habrastorage.org/storage2/527/8d5/f5d/5278d5f5d0495b489cf9431f26133ea4.png"><br><br>  Actually after this, you can restart the Survey Mediation service and it will work. <br>  Users with Enterprise Voice enabled in Lync will receive a new dialing mode and redirection settings.  If the user settings include internal or mobile numbers, you can call them directly from the contact list. <br><br>  From the phone is still easier.  Just dial the Lync user number and that's it.  The names and numbers of the callers are transmitted normally, the Cyrillic is also well understood (if the phone itself understands of course). <br><img src="https://habrastorage.org/storage2/d05/f77/8ff/d05f778ff8541cac2fbb36f592e38f16.jpg"><br><br>  PS The configuration process itself is not complicated and clear.  However, when you come across this for the first time, it‚Äôs not quite clear where to start and where to harness horses at all.  In this ‚Äúinstruction‚Äù, on a simplest example, I wanted to show the principle of the organization of interaction between Lync and the outside world.  I hope the principles are clear and based on them you can understand how to set up a more complex interaction. </div><p>Source: <a href="https://habr.com/ru/post/139268/">https://habr.com/ru/post/139268/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../139259/index.html">Run projects created in Visual Studio 2011 at Visual Studio 2010</a></li>
<li><a href="../139263/index.html">Approach to designing an internet distribution platform using templates</a></li>
<li><a href="../139264/index.html">Kanobuvosti, 133rd edition</a></li>
<li><a href="../139265/index.html">Synchronous and asynchronous download images from the network with subsequent processing</a></li>
<li><a href="../139267/index.html">Public services are transparent, but not quality</a></li>
<li><a href="../139270/index.html">Virtual hosting Django, model N</a></li>
<li><a href="../139271/index.html">Rent an IP PBX by model VPBX, or how to organize a modern telephone in the office</a></li>
<li><a href="../139272/index.html">My integration with 1C</a></li>
<li><a href="../139275/index.html">Boot to Gecko - a look at Mozilla's mobile OS [Video]</a></li>
<li><a href="../139276/index.html">We are not afraid of chaos, or notify relatives of the troubles (iOS)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>