<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to search for people among Pi and what's the point about Python</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Colleagues, hello! Recently, I faced the challenge of playing free places on our course on Python development. Generally speaking, playing a few free ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to search for people among Pi and what's the point about Python</h1><div class="post__text post__text-html js-mediator-article">  Colleagues, hello!  Recently, I faced the challenge of playing free places on our course on Python development.  Generally speaking, playing a few free places is easy.  You can do it in literally two lines if you already have a list of participants: <br><br><pre><code class="python hljs">emails = pandas.read_csv(<span class="hljs-string"><span class="hljs-string">"emails.csv"</span></span>) emails.sample(NUM_WINNERS, random_state=SEED)</code> </pre> <br>  And it is good, it works.  Yes, and Occam's razor says that you should not produce an entity without the need.  But there is a problem - it is not fun.  Plus, this is how we selected the winners in the <a href="https://habrahabr.ru/company/otus/blog/331478/">Java course</a> .  There, of course, you can't do it in two lines, you need a factory of factories of abstract classes and that‚Äôs all.  I don't want to repeat anyway. <br><a name="habracut"></a><br>  I would like to make a robot that chooses real balls from the basket, recognizes numbers and sends them to the chat via API (it's fun!), But this is not very fast.  The solution should be meaningless, merciless and not particularly time-consuming.  So the number pi came to mind.  In general, my colleagues and I have inside joke about the perfect Pi-archiver.  The essence is simple: to compress any data you just need to find the place in Pi number where they start and remember the position (+ length, of course). <br><br>  Unsurpassed compression!  It turns out that you can also look for Ustanik, in particular their emai'y among Pi, and consider the winner of those who will be the first.  If you want to immediately to the point, then you can immediately go to <a href="https://github.com/s-stupnikov/otus-python-0717/blob/master/bingo/bingo.ipynb">notebook</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A short search on the Internet gave a lot of solutions for generating numbers of Pi, including Python (this wonderful resource is also in the process: <a href="http://www.angio.net/pi/">www.angio.net/pi</a> , I can not share).  I honestly did not know that humanity is so concerned about this problem.  Most popular solutions: <a href="https://en.wikipedia.org/wiki/Gauss%25E2%2580%2593Legendre_algorithm">Gauss ‚Äì Legendre algorithm</a> , <a href="https://en.wikipedia.org/wiki/Chudnovsky_algorithm">Chudnovsky algorithm</a> , <a href="https://en.wikipedia.org/wiki/Bailey%25E2%2580%2593Borwein%25E2%2580%2593Plouffe_formula">BBP formula</a> . <br><br>  I chose the option that allows you to generate digits of the number infinitely, but does not give a predetermined number of digits: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pi_digits</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""generator for digits of pi"""</span></span> q, r, t, k, n, l = <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> * q + r - t &lt; n * t: <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> n q, r, t, k, n, l = (<span class="hljs-number"><span class="hljs-number">10</span></span>*q, <span class="hljs-number"><span class="hljs-number">10</span></span>*(rn*t), t, k, (<span class="hljs-number"><span class="hljs-number">10</span></span>*(<span class="hljs-number"><span class="hljs-number">3</span></span>*q+r))/t<span class="hljs-number"><span class="hljs-number">-10</span></span>*n, l) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: q, r, t, k, n, l = (q*k, (<span class="hljs-number"><span class="hljs-number">2</span></span>*q+r)*l, t*l, k+<span class="hljs-number"><span class="hljs-number">1</span></span>, (q*(<span class="hljs-number"><span class="hljs-number">7</span></span>*k+<span class="hljs-number"><span class="hljs-number">2</span></span>)+r*l)/(t*l), l+<span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre><br>  This is Comrade Gibbon's Spigot algorithm, which calculates the digits of Pi in streaming mode.  All the details are in the <a href="http://www.cs.ox.ac.uk/people/jeremy.gibbons/publications/spigot.pdf">research paper</a> , which Haskell lovers will especially like. <br><br>  It remains only to associate the emails of the participants with some numbers.  At first I wanted to take md5 from the mail and then divide by module to get the number not more than the specified length.  But this is somehow not very random, especially since you can pick up and register mail, which will be close enough to the beginning of Pi.  Therefore, uncover the good old PSPP: <br><br><pre> <code class="python hljs">np.random.seed(SEED) emails[<span class="hljs-string"><span class="hljs-string">"num"</span></span>] = np.random.randint(<span class="hljs-number"><span class="hljs-number">10</span></span> ** (NUM_DIGITS - <span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-number"><span class="hljs-number">10</span></span> ** NUM_DIGITS - <span class="hljs-number"><span class="hljs-number">1</span></span>, size=len(emails))</code> </pre><br>  The length of the numbers is set in advance; the longer the number, the more difficult it is to find it in Pi, respectively.  It remains only to write a search function. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">_Num</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, n)</span></span></span><span class="hljs-function">:</span></span> self.n = n self.s = str(n) self.p = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment"># pointer in number string representation self.l = len(self.s) def move_p(self, d): if self.p &gt;= self.l: return if d == self.s[self.p]: self.p += 1 else: # find largerst prefix in num that is suffix in current part of Pi (dumb algorithm) pi_part = self.s[:self.p] + d self.p = 0 for i in xrange(1, len(pi_part)): if self.s[:i] == pi_part[-i:]: self.p = i def find_nums_in_pi(nums, first_n=None): MAX_POS = 10 ** 6 pi_gen = pi_digits() first_n = first_n if first_n is not None else len(nums) _nums = [_Num(n) for n in nums] nums_pos = {} for pos in itertools.count(): if pos % 1000 == 0: print "Current Pi position: %s. Nums found: %s" % (pos, len(nums_pos)) if pos == MAX_POS: raise RuntimeError("Circuit breaker!") d = str(pi_gen.next()) found_num = None for cur_num in _nums: cur_num.move_p(d) # whole number found if cur_num.p == cur_num.l: nums_pos[cur_num.n] = pos - cur_num.l + 1 # found enough numbers if len(nums_pos) == first_n: return nums_pos found_num = cur_num.n # create new search array without found number if found_num: _nums = [num for num in _nums if num.n != found_num]</span></span></code> </pre><br>  Kastuyu numbers in the line, I set pointers in their beginning, I generate digits Pi, if this digit is in this number, then I move the pointer forward, if not, I am looking for the greatest suffix of the current part of Pi, which is also a prefix of the desired number.  When the number is found, I memorize it and the position, delete it from the search array.  Just in case, I add a limiter in order not to go beyond the millionth figure and do some kind of logging of progress.  ( <i>Search in some marginal cases may not work correctly, but, fortunately, this is not very important for our purposes</i> ) <br><br>  Finding two winners whose emails are mapped to six-digit numbers took about a minute on my machine.  Profit! <br><br>  As usual, ‚Äúin battle‚Äù everything went not quite so smoothly.  The drawing was launched in the live mode, the video was simultaneously broadcast from the computer, it was a little podnapryaglsya and the search took already 5 minutes, instead of one.  But in order to further aggravate the situation, I inadvertently (honestly!) Restarted in the notebook the execution of the cell with the search for numbers after its successful execution for the first time.  And notebook does not forgive errors, does not remember old values, performs cells synchronously.  Nerves stretched like ropes.  Fortunately, everything ended well, the winners were revealed, awarded, justice prevailed.  Glory to the robots, glory to the Pi number! <br><br>  By the way, there is another draw of places on the course on July 5 at 20-00.  Want to touch the beautiful?  Pass the test and <a href="http://otus.ru/dod%3Futm_source%3Dhabr%26utm_medium%3Daffilate%26utm_campaign%3Dpythondod%26utm_term%3Dbingopost03.07">register</a> for the Open Day, there is time! </div><p>Source: <a href="https://habr.com/ru/post/332180/">https://habr.com/ru/post/332180/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../332168/index.html">Three years of successful provision of public rental services of virtual machines with Apache CloudStack</a></li>
<li><a href="../332172/index.html">5 free assets for Unity3D, which will facilitate the development process</a></li>
<li><a href="../332174/index.html">Updating document.title in the background tab</a></li>
<li><a href="../332176/index.html">Programming Contest: JSDash</a></li>
<li><a href="../332178/index.html">How computer pros crack hackers</a></li>
<li><a href="../332182/index.html">How to quickly remove multiple rows from a large database in MySQL</a></li>
<li><a href="../332184/index.html">Six Myths about Big Data</a></li>
<li><a href="../332186/index.html">4 popular mistakes in business card design</a></li>
<li><a href="../332188/index.html">Three days like all ticket offices in the country should become online (in fact, not)</a></li>
<li><a href="../332190/index.html">The tale of how an Android developer spammers, and that came out of it</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>