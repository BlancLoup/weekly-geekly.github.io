<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Chat assistant to the site using Telegram in 15 minutes</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="About chat assistants 
 Many people sell goods and services over the Internet. More people buy something online. 
 During the selection of purchases, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Chat assistant to the site using Telegram in 15 minutes</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/17d/640/f41/17d640f4192640cfa7daf47f4f163ea6.png"><br><br><h4>  About chat assistants </h4><br>  Many people sell goods and services over the Internet.  More people buy something online. <br>  During the selection of purchases, there are often questions that can be solved by calling and talking to the manager. <br>  Most likely I am not the only person in Habr√© who prefers to communicate with telephone managers. <br>  And here come to the aid pop-up chat helpers, which seem to increase conversion, but many unnerving. <br>  (For those who do not know: in the corner of the site a window pops up in which you can correspond online with a consultant). <br><br>  There are a dozen of such services and they all work on the principle of " <b>trial version for free, and then for the money</b> ." <br>  On the habr there are several articles, here is one of them ( <a href="http://habrahabr.ru/company/tuthost/blog/165365/">http://habrahabr.ru/company/tuthost/blog/165365/</a> ), but, I am sure, the audience Habrahabra knows what it is about. <br>  Most people will use the free version of any such service: you just need to register and insert a piece of JS code on the site.  For those who have a lot of managers, they will have to pay: for example, a Redhelper for 10 operators will cost you: <br><div class="spoiler">  <b class="spoiler_title">115200 rub.</b>  <b class="spoiler_title">for 1 year</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/f25/766/638/f25766638fd642969cafff3b300094ec.png"><br></div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Most likely - the price is adequate for those who pay salaries to ten managers. <br><br>  But I decided to invent a free ‚Äúbicycle‚Äù from scrap materials. <br>  Running on your server takes 15 minutes.  Anyone who is interested in the idea - please under the cat. <br><a name="habracut"></a><br><br><h4>  Telegram BOT </h4><br>  Gaining popularity abroad, <b>Telegram Messenger</b> recently introduced a new API for <a href="https://core.telegram.org/bots">bot development</a> .  A thing is an interesting one, one can find many uses for it.  Now you can create a bot (write a program) that will answer your questions, execute certain commands, and all this in the chat window of the Telegram messenger. <br><br>  It is on the basis of the Telegram messenger and its API for bots that our <b>free</b> , <b>unlimited</b> chat assistant-to-site will work. <br><br>  <b>The general scheme of the idea is in the picture:</b> <br><br><img src="https://habrastorage.org/files/5fa/cc9/048/5facc9048483406ab0eba3820cce44fa.png"><br><br>  <b>This is how it happens:</b> <br><ol><li>  Users on the site write to chat </li><li>  This message flies to your server </li><li>  From there Telegram-bot sends it to the right manager. </li><li>  Manager answers via Telegram </li><li>  The bot sends a message back to chat </li></ol><br><br><h4>  Implementation </h4><br>  So, to run "at home" you will need: <br><ol><li>  Server, VPS or hosting, which has up-to-date PHP, SQLite support and the ability to set_time_limit (0) (i.e. make the php script not time limited) </li><li>  Telegram application (on a smartphone or computer) </li><li>  Basic PHP knowledge </li></ol><br><blockquote>  <b>Attention!</b>  <b>You run this code at your own risk!</b>  <b>I spent a few hours on it and maybe it‚Äôs full of mistakes!</b> </blockquote><br><br>  <b>The action plan is:</b> <br><br>  0) <b>Download source code from GitHub:</b> <br>  <a href="https://github.com/Surzhikov/TelegramSiteHelper">https://github.com/Surzhikov/TelegramSiteHelper</a> <br><br>  1) <b>Register a new bot in Telegram.</b> <br>  All you need is a smartphone and 2 minutes. <br>  Go to the Telegram, add the user @BotFather and send him the command "/ newbot" <br>  Further, according to the instructions: we come up with the name, username, write about and load the photo. <br>  The result of all should be the API Key with which we will work with BotAPI. <br>  I did it like this: <br><br><img src="https://habrastorage.org/files/6de/a35/0f7/6dea350f710b4afe9c03f94702aecf49.png"><br><br>  <i>(The message in which my API Key appears I have deleted)</i> <br><br>  2) <b>The resulting key is inserted into TelegramBotConfig.php.</b> <br>  In the same place, we indicate any password you have invented for registering new managers. <br><br>  3) <b>Fill everything on your server</b> <br><br>  4) <b>Run our bot - the background process getUpdates.php</b> <br>  It should work endlessly, so I recommend putting it in the server startup. <br>  For reliability, you can put the launch of the script in the crontab every minute. <br>  The script will run in a single instance, all repeated starts will be completed immediately. <br><br>  5) <b>Register a new manager</b> <br>  From the manager's smartphone, go to telegrams and add our new bot (the one you just created) <br>  We write him a command: "/ newmanager password_for_managers."  In response, we receive a greeting. <br><br><img src="https://habrastorage.org/files/e27/882/3f2/e278823f206a4c39aeb886902500c0e1.png"><br><br>  We repeat the operation as many times as necessary for each manager. <br>  If at this stage you have not received a response from Bot, then something does not work! <br><br>  6) <b>Check</b> <br>  Go to the page index.html (that is, go to the address <a href="http://mysite.ru/index.php">mysite.ru/index.php</a> , and do not open locally). <br>  There is a small, quick fix chat. <br>  If you send a message to this chat, the bot will select a random manager and send it to him. <br><br><img src="https://habrastorage.org/files/cbf/50e/458/cbf50e45825a48ce92b8eac34ba7d875.png"><br><br>  <b>Here is an interesting point:</b> <br>  There can be a lot of clients (buyers), and one manager. <br>  The manager communicates with customers through Telegram-bot. <br>  If at the same time two (or more) clients have written a message, and the manager answers them in turn, the Telegram bot needs to somehow indicate to which client to send a response. <br>  For this, I made the command "/ answer_HOME."  After sending this command, all the letters of the manager go to the desired web chat. <br><br><img src="https://habrastorage.org/files/09e/cbd/d2e/09ecbdd2e843492db55365ea5064bb46.png"><br><br><h4>  Cons, pros that you can finish </h4><br>  <b>Minuses</b> <br><ol><li>  Now the chat is made "in haste" in order to quickly launch it in your project.  There are many loopholes with the help of which, for example, you can write in someone else's chat and peep someone else's correspondence. </li><li>  Now these problems do not bother me, because in the chat assistant on our site, it is not customary to transmit important and secret information. </li><li>  When a manager is alone and there are many clients, you can get confused about whom you answer. </li><li>  ... I will supplement from the comments </li></ol><br><br>  <b>Pros:</b> <br><ol><li>  It works! </li><li>  Free forever and for any number of managers </li><li>  You do not need extra applications, only telegrams, which is for all popular platforms </li><li>  You can rewrite and style chat as you want. </li><li>  Telegram works very fast </li><li>  ... I will supplement from the comments </li></ol><br><br>  <b>What can be done:</b> <br><ol><li>  Fool protection and security work </li><li>  A clever system of distributing messages between managers (the bot now sends a message to a random manager) </li><li>  Automatic answers from the bot when the manager is silent for a long time </li><li>  Add the name and photo of the manager who is in the chat </li><li>  ... I will supplement from the comments </li></ol><br><br>  <b>Thanks for attention.</b> <br><br>  <b>UPDATE 08/23/2015 ‚Äî</b> Fully rewrote the bot, now works more stable, now you can choose between sqlite and mysql <br><br>  In the plans: <br>  - admin panel with statistics <br>  - work through webhook <br><br>  <a href="https://github.com/Surzhikov/TelegramSiteHelper">https://github.com/Surzhikov/TelegramSiteHelper</a> </div><p>Source: <a href="https://habr.com/ru/post/264035/">https://habr.com/ru/post/264035/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../264023/index.html">Increased battery life in Android M</a></li>
<li><a href="../264025/index.html">We are flashing the Upvel UR-313N4G router on OpenWRT</a></li>
<li><a href="../264029/index.html">A game for the little ones is a simple idea that is not a shame to include in the resume</a></li>
<li><a href="../264031/index.html">AccelEpi, or How EPAM Helped in Testing Drugs for Epilepsy</a></li>
<li><a href="../264033/index.html">As a regular Wordpress site, dial 99/100 in PageSpeed ‚Äã‚ÄãInsights</a></li>
<li><a href="../264037/index.html">Advanced CSS filters</a></li>
<li><a href="../264039/index.html">Free grid control for Xamarin from DevExpress</a></li>
<li><a href="../264041/index.html">Will GCC C ++ be better for AVR and Arduino?</a></li>
<li><a href="../264043/index.html">FP9: The ability to dig and dig</a></li>
<li><a href="../264045/index.html">My system is testing and improving the quality of the GSM gateway. Part two</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>