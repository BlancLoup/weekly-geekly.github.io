<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Measuring the speed of Java code correctly (using JMH)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! 


 This is an introductory article on how to do performance tests in JVM languages ‚Äã‚Äã(java, kotlin, scala, etc.). It is useful for the case...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Measuring the speed of Java code correctly (using JMH)</h1><div class="post__text post__text-html js-mediator-article"><p>  Hi, Habr! </p><br><p>  This is an introductory article on how to do performance tests in JVM languages ‚Äã‚Äã(java, kotlin, scala, etc.).  It is useful for the case when it is required to show in figures the change in performance from the use of a specific algorithm. </p><br><p>  All examples are given in the kotlin language and for the gradle assembly system.  The source code of the project <a href="https://github.com/imanushin/use-performance-test">is available on github</a> . </p><br><p><img src="https://habrastorage.org/webt/cz/-l/gv/cz-lgvn4c5op4rzd5__j1nekpps.jpeg" alt="CDWP"></p><a name="habracut"></a><br><h2 id="podgotovka">  Training </h2><br><h3 id="jmh">  Jmh </h3><br><p>  First of all we will focus on the main part of our measurements - using <a href="http://openjdk.java.net/projects/code-tools/jmh/">JMH</a> .  Java Microbenchmark Harness is a set of libraries for testing the performance of small functions (that is, those where the GC pause increases the running time at times). </p><br><p>  Before running the test, JMH recompiles the code, because: </p><br><ol><li>  To reduce the error in calculating the operation time of a function, you must run it N times, calculate the total operation time, and then divide it by N. </li><li>  To do this, you need to wrap the launch in the form of a loop and call the required method.  However, in this case, the cycle itself, as well as the call of the function being measured, will affect the time of the function.  Therefore, instead of a loop, the code of the function call will be inserted directly, without reflection or method generation at runtime. </li></ol><br><p> After reworking the bytecode, testing can be started with a command like <code>java -jar benchmarks.jar</code> , since all the necessary components will already be packed into one jar file. </p><br><h3 id="jmh-gradle-plugin">  JMH Gradle Plugin </h3><br><p>  As is clear from the description above, to test the performance of the code, it is not enough just to add the necessary libraries to the classpath and run tests in the JUnit style.  Therefore, if we want to do business, and not to understand the specifics of writing scripts, we cannot do without a plug-in to maven / gradle.  For new projects, the advantage remains behind the gradle, therefore we choose it. </p><br><p>  For JMH there is a semi-official plugin for gradle - <a href="https://github.com/melix/jmh-gradle-plugin">jmh-gradle-plugin</a> .  Add it to the project: </p><br><pre> <code class="hljs perl">buildscript { repositories { mavenCentral() maven { url <span class="hljs-string"><span class="hljs-string">"https://plugins.gradle.org/m2/"</span></span> } } dependencies { classpath <span class="hljs-string"><span class="hljs-string">"me.champeau.gradle:jmh-gradle-plugin:$jmh_gradle_plugin_version"</span></span> } } apply plugin: <span class="hljs-string"><span class="hljs-string">"me.champeau.gradle.jmh"</span></span></code> </pre> <br><p>  The plug-in will automatically create a new source set (this is "a set of files and resources that should be compiled and run together," you can read either the <a href="https://habrahabr.ru/post/107085/">article on</a> <a href="https://habrahabr.ru/users/svartalfar/" class="user_link">Habr√© by svartalfar</a> , or <a href="https://docs.gradle.org/current/userguide/artifact_dependencies_tutorial.html">in the official gradle documentation</a> ).  jmh source set automatically refers to main, that is, we get a short work algorithm: </p><br><ol><li>  We write the code that we will change in the standard main source set, in the same place where it is always. </li><li>  We write the code with setup and warming up of tests in separate source set.  It is his byte code that will be overwritten, here the plugin will add the necessary dependencies, in which there are definitions of abstract and so on. </li></ol><br><p>  We get the following directory hierarchy: </p><br><ul><li>  src <br><ul><li>  jmh / kotlin / &lt;java package name&gt; / &lt;code that runs tests (and annotated with JMH attributes)&gt; </li><li>  main / kotlin / &lt;java package name&gt; / &lt;code for testing&gt; </li></ul></li></ul><br><p>  Or what it looks like in IntelliJ Idea: </p><br><p><img src="https://habrastorage.org/webt/c_/bm/d_/c_bmd_ma_axiqo7yttvevriayea.png" alt="JMH Source Set at IntelliJ Idea"></p><br><p>  As a result, after setting up the project, you can run tests with a simple call <code>.\gradlew.bat jmh</code> (or <code>.\gradlew jmh</code> for Linux, Mac, BSD) </p><br><p>  With the plugin there are a couple of interesting features on Windows: </p><br><ul><li>  JMH uses the fork java process.  In the case of Windows, this is not so easy to do, and then a new process is simply started with the same classpath.  And the entire list of jar files is transmitted via the command line, the size of which is limited.  As a result, if GRADLE_USER_HOME (the folder that contains the gradle cache) is in the depth of the file structure, the list of jar files for fork becomes so large that Windows refuses to start the process with such an enormous number of command line arguments.  Therefore, <strong>if JMH refuses to fork, simply move the Gradle caches to a folder with a short name, i.e.</strong>  <strong>write <em>GRADLE_USER_HOME</em> to environment variable <em>with</em> something like c: \ gradle</strong> </li><li>  Sometimes the previous JMH process makes a lock on a file (perhaps byte code rewrite does this).  As a result, re-compilation may not work, since the file with our benchmark is opened by someone to write.  To fix this problem, you just need to stop the dedle gradle processes (which are already running to speed up the compiler):. <code>.\gradlew.bat --stop</code> </li><li>  For the purity of experiments, it is better to abandon the incremental build for our tests.  From here, we always call before testing <code>.\gradlew.bat clean</code> </li></ul><br><h2 id="testirovanie">  Testing </h2><br><p>  As an example, I will take the question (previously asked at the <a href="https://discuss.kotlinlang.org/t/why-autocloseable-use-method-is-inlined/5407">kotlin discussions</a> ) that tormented me earlier - why does the inline construction use the inline method? </p><br><div class="spoiler">  <b class="spoiler_title">About design use</b> <div class="spoiler_text"><p>  In Java, there is a pattern - <a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html">try with resources</a> , which allows you to automatically call the close method inside a block, moreover, it is safe to handle exceptions without blocking the already flying ones.  Analog from the .Net world - <a href="https://msdn.microsoft.com/en-us/library/system.idisposable.aspx">using</a> construct for <code>IDisposable</code> interfaces. </p><br><p>  Sample java code: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> (BufferedReader reader = Files.newBufferedReader(file, charset)) { <span class="hljs-comment"><span class="hljs-comment">//  try     /*  reader'*/ }</span></span></code> </pre> <br><p>  Kotlin <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.io/use.html">has a complete equivalent</a> , which has a slightly different syntax: </p><br><pre> <code class="hljs rust">Files.newBufferedReader(file, charset)).<span class="hljs-keyword"><span class="hljs-keyword">use</span></span> { reader -&gt; <span class="hljs-comment"><span class="hljs-comment">/*  reader'*/</span></span> }</code> </pre> <br><p>  That is, as can be seen: </p><br><ol><li>  Use is just <a href="https://kotlinlang.org/docs/reference/extensions.html">an extension method</a> , not a separate language construct. </li><li>  Use is an inline method, that is, the same constructs are embedded in each method, which increases the size of the bytecode, which means that in JIT theory, it will be more difficult to optimize the code, etc.  And <strong>we will check this theory</strong> . </li></ol></div></div><br><p>  So, you need to do two methods: </p><br><ol><li>  The first will simply use use, which comes in the kotlin library. </li><li>  The second will use the same methods, however without inline.  As a result, an object with parameters for the lambda will be created for each call on the heap. </li></ol><br><p>  Code with JMH attributes that will run different functions: </p><br><pre> <code class="hljs perl">@BenchmarkMode(Mode.All) //     @Warmup(iterations = <span class="hljs-number"><span class="hljs-number">10</span></span>) //       @Measurement(iterations = <span class="hljs-number"><span class="hljs-number">100</span></span>, batchSize = <span class="hljs-number"><span class="hljs-number">10</span></span>) //   ,           <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> class CompareInlineUseVsLambdaUse { @Benchmark fun inlineUse(blackhole: Blackhole) { NoopAutoCloseable(blackhole).use { blackhole.consume(<span class="hljs-number"><span class="hljs-number">1</span></span>) } } @Benchmark fun lambdaUse(blackhole: Blackhole) { NoopAutoCloseable(blackhole).useNoInline { blackhole.consume(<span class="hljs-number"><span class="hljs-number">1</span></span>) } } }</code> </pre> <br><h3 id="dead-code-elimination">  Dead code elimination </h3><br><p>  Java Compiler &amp; JIT is pretty smart and has a number of optimizations, both in compile time and in runtime.  The method below, for example, may well fold into one line (for both kotlin and java): </p><br><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> : <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> a = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> b = <span class="hljs-number"><span class="hljs-number">2</span></span> a + b; }</code> </pre> <br><p>  And in the end we will test the method: </p><br><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> : <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> { <span class="hljs-number"><span class="hljs-number">3</span></span>; }</code> </pre> <br><p>  However, the result is not used in any way, because compilers (byte code + JIT) will eventually throw out the method altogether, since it is not needed in principle. </p><br><p>  To avoid this, in JMH there is a special class "black hole" - Blackhole.  There are methods in it that, on the one hand, do nothing, and on the other hand, they do not allow JIT to throw out the branch with the result. </p><br><p>  And in order for javac not to try to add a and b during the compilation process, we need to define a state object in which our values ‚Äã‚Äãwill be stored.  As a result, in the test itself, we will use the already prepared object (that is, do not waste time on its creation and do not allow the compiler to apply optimization). </p><br><p>  As a result, for competent testing of our function, it is required to write it in this form: </p><br><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(blackhole: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Blackhole</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> : <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> a = state.a <span class="hljs-comment"><span class="hljs-comment">//      a val b = state.b val result = a + b; blackhole.consume(result) // JIT    ,    - -  }</span></span></code> </pre> <br><p>  Here we took a and b from some state, which will prevent the compiler from immediately counting the expression.  And we sent the result to a black hole, which would prevent JIT from throwing out the last part of the function. </p><br><p>  Returning to my function: </p><br><ol><li>  I will create an object for calling the close method in the test itself, since almost always when we called the close method, we have created an object before. </li><li>  Inside our method, we will have to call the function from the blackhole in order to provoke the creation of lambda on the heap (and not to let the JIT throw out potentially unnecessary code). </li></ol><br><h2 id="rezultat-testa">  Test result </h2><br><p>  Having <code>./gradle jmh</code> , and then having waited two hours, I received the following results of work on my mac mini: </p><br><pre> <code class="hljs vhdl"># Run complete. Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">51</span></span>:<span class="hljs-number"><span class="hljs-number">54</span></span> Benchmark Mode Cnt Score <span class="hljs-literal"><span class="hljs-literal">Error</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Units</span></span> CompareInlineUseVsLambdaUse.inlineUse thrpt <span class="hljs-number"><span class="hljs-number">1000</span></span> <span class="hljs-number"><span class="hljs-number">11689940</span></span>,<span class="hljs-number"><span class="hljs-number">039</span></span> ¬± <span class="hljs-number"><span class="hljs-number">21367</span></span>,<span class="hljs-number"><span class="hljs-number">847</span></span> ops/s CompareInlineUseVsLambdaUse.lambdaUse thrpt <span class="hljs-number"><span class="hljs-number">1000</span></span> <span class="hljs-number"><span class="hljs-number">11561748</span></span>,<span class="hljs-number"><span class="hljs-number">220</span></span> ¬± <span class="hljs-number"><span class="hljs-number">44580</span></span>,<span class="hljs-number"><span class="hljs-number">699</span></span> ops/s CompareInlineUseVsLambdaUse.inlineUse avgt <span class="hljs-number"><span class="hljs-number">1000</span></span> ‚âà <span class="hljs-number"><span class="hljs-number">10</span></span>‚Åª‚Å∑ s/op CompareInlineUseVsLambdaUse.lambdaUse avgt <span class="hljs-number"><span class="hljs-number">1000</span></span> ‚âà <span class="hljs-number"><span class="hljs-number">10</span></span>‚Åª‚Å∑ s/op CompareInlineUseVsLambdaUse.inlineUse sample <span class="hljs-number"><span class="hljs-number">21976631</span></span> ‚âà <span class="hljs-number"><span class="hljs-number">10</span></span>‚Åª‚Å∑ s/op CompareInlineUseVsLambdaUse.inlineUse:inlineUse¬∑p0.<span class="hljs-number"><span class="hljs-number">00</span></span> sample ‚âà <span class="hljs-number"><span class="hljs-number">10</span></span>‚Åª‚Å∑ s/op CompareInlineUseVsLambdaUse.inlineUse:inlineUse¬∑p0.<span class="hljs-number"><span class="hljs-number">50</span></span> sample ‚âà <span class="hljs-number"><span class="hljs-number">10</span></span>‚Åª‚Å∑ s/op CompareInlineUseVsLambdaUse.inlineUse:inlineUse¬∑p0.<span class="hljs-number"><span class="hljs-number">90</span></span> sample ‚âà <span class="hljs-number"><span class="hljs-number">10</span></span>‚Åª‚Å∑ s/op CompareInlineUseVsLambdaUse.inlineUse:inlineUse¬∑p0.<span class="hljs-number"><span class="hljs-number">95</span></span> sample ‚âà <span class="hljs-number"><span class="hljs-number">10</span></span>‚Åª‚Å∑ s/op CompareInlineUseVsLambdaUse.inlineUse:inlineUse¬∑p0.<span class="hljs-number"><span class="hljs-number">99</span></span> sample ‚âà <span class="hljs-number"><span class="hljs-number">10</span></span>‚Åª‚Å∑ s/op CompareInlineUseVsLambdaUse.inlineUse:inlineUse¬∑p0.<span class="hljs-number"><span class="hljs-number">999</span></span> sample ‚âà <span class="hljs-number"><span class="hljs-number">10</span></span>‚Åª‚Åµ s/op CompareInlineUseVsLambdaUse.inlineUse:inlineUse¬∑p0.<span class="hljs-number"><span class="hljs-number">9999</span></span> sample ‚âà <span class="hljs-number"><span class="hljs-number">10</span></span>‚Åª‚Åµ s/op CompareInlineUseVsLambdaUse.inlineUse:inlineUse¬∑p1.<span class="hljs-number"><span class="hljs-number">00</span></span> sample <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">005</span></span> s/op CompareInlineUseVsLambdaUse.lambdaUse sample <span class="hljs-number"><span class="hljs-number">21772966</span></span> ‚âà <span class="hljs-number"><span class="hljs-number">10</span></span>‚Åª‚Å∑ s/op CompareInlineUseVsLambdaUse.lambdaUse:lambdaUse¬∑p0.<span class="hljs-number"><span class="hljs-number">00</span></span> sample ‚âà <span class="hljs-number"><span class="hljs-number">10</span></span>‚Åª‚Å∏ s/op CompareInlineUseVsLambdaUse.lambdaUse:lambdaUse¬∑p0.<span class="hljs-number"><span class="hljs-number">50</span></span> sample ‚âà <span class="hljs-number"><span class="hljs-number">10</span></span>‚Åª‚Å∑ s/op CompareInlineUseVsLambdaUse.lambdaUse:lambdaUse¬∑p0.<span class="hljs-number"><span class="hljs-number">90</span></span> sample ‚âà <span class="hljs-number"><span class="hljs-number">10</span></span>‚Åª‚Å∑ s/op CompareInlineUseVsLambdaUse.lambdaUse:lambdaUse¬∑p0.<span class="hljs-number"><span class="hljs-number">95</span></span> sample ‚âà <span class="hljs-number"><span class="hljs-number">10</span></span>‚Åª‚Å∑ s/op CompareInlineUseVsLambdaUse.lambdaUse:lambdaUse¬∑p0.<span class="hljs-number"><span class="hljs-number">99</span></span> sample ‚âà <span class="hljs-number"><span class="hljs-number">10</span></span>‚Åª‚Å∑ s/op CompareInlineUseVsLambdaUse.lambdaUse:lambdaUse¬∑p0.<span class="hljs-number"><span class="hljs-number">999</span></span> sample ‚âà <span class="hljs-number"><span class="hljs-number">10</span></span>‚Åª‚Åµ s/op CompareInlineUseVsLambdaUse.lambdaUse:lambdaUse¬∑p0.<span class="hljs-number"><span class="hljs-number">9999</span></span> sample ‚âà <span class="hljs-number"><span class="hljs-number">10</span></span>‚Åª‚Åµ s/op CompareInlineUseVsLambdaUse.lambdaUse:lambdaUse¬∑p1.<span class="hljs-number"><span class="hljs-number">00</span></span> sample <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">010</span></span> s/op CompareInlineUseVsLambdaUse.inlineUse ss <span class="hljs-number"><span class="hljs-number">1000</span></span> ‚âà <span class="hljs-number"><span class="hljs-number">10</span></span>‚Åª‚Åµ s/op CompareInlineUseVsLambdaUse.lambdaUse ss <span class="hljs-number"><span class="hljs-number">1000</span></span> ‚âà <span class="hljs-number"><span class="hljs-number">10</span></span>‚Åª‚Åµ s/op Benchmark result <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> saved <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> /Users/imanushin/git/<span class="hljs-keyword"><span class="hljs-keyword">use</span></span>-performance-test/src/build/reports/jmh/results.txt</code> </pre> <br><p>  Or, if you reduce the table: </p><br><pre> <code class="hljs vhdl">Benchmark Mode Cnt Score <span class="hljs-literal"><span class="hljs-literal">Error</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Units</span></span> inlineUse thrpt <span class="hljs-number"><span class="hljs-number">1000</span></span> <span class="hljs-number"><span class="hljs-number">11689940</span></span>,<span class="hljs-number"><span class="hljs-number">039</span></span> ¬± <span class="hljs-number"><span class="hljs-number">21367</span></span>,<span class="hljs-number"><span class="hljs-number">847</span></span> ops/s lambdaUse thrpt <span class="hljs-number"><span class="hljs-number">1000</span></span> <span class="hljs-number"><span class="hljs-number">11561748</span></span>,<span class="hljs-number"><span class="hljs-number">220</span></span> ¬± <span class="hljs-number"><span class="hljs-number">44580</span></span>,<span class="hljs-number"><span class="hljs-number">699</span></span> ops/s inlineUse avgt <span class="hljs-number"><span class="hljs-number">1000</span></span> ‚âà <span class="hljs-number"><span class="hljs-number">10</span></span>‚Åª‚Å∑ s/op lambdaUse avgt <span class="hljs-number"><span class="hljs-number">1000</span></span> ‚âà <span class="hljs-number"><span class="hljs-number">10</span></span>‚Åª‚Å∑ s/op inlineUse sample <span class="hljs-number"><span class="hljs-number">21976631</span></span> ‚âà <span class="hljs-number"><span class="hljs-number">10</span></span>‚Åª‚Å∑ s/op lambdaUse sample <span class="hljs-number"><span class="hljs-number">21772966</span></span> ‚âà <span class="hljs-number"><span class="hljs-number">10</span></span>‚Åª‚Å∑ s/op inlineUse ss <span class="hljs-number"><span class="hljs-number">1000</span></span> ‚âà <span class="hljs-number"><span class="hljs-number">10</span></span>‚Åª‚Åµ s/op lambdaUse ss <span class="hljs-number"><span class="hljs-number">1000</span></span> ‚âà <span class="hljs-number"><span class="hljs-number">10</span></span>‚Åª‚Åµ s/op</code> </pre> <br><p>  As a result, there are two most important metrics: </p><br><ol><li>  The inline method showed a performance of <code>11,6 * 10^6 ¬± 0,02 * 10^6</code> operations per second. </li><li>  The Lambda-based method showed a performance of <code>11,5 * 10^6 ¬± 0,04 * 10^6</code> operations per second. </li><li>  The inline method works faster and more stable in speed.  Probably, the increased error for <em>lambdaUse</em> is connected with more active work with memory. </li><li>  I was wrong on <a href="https://discuss.kotlinlang.org/t/why-autocloseable-use-method-is-inlined/5407">that forum</a> - it is better to leave the current implementation of the method in the standard kotlin library. </li></ol><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  When developing software, there are two fairly frequent ways to compare performance: </p><br><ol><li>  Measurement of the speed of the cycle with N iterations of the experimental function. </li><li>  Philosophical reasoning of the form "I am sure that the shift is faster than the multiplication by 2", "how much I program, always XML serialization was the fastest" and so on. </li></ol><br><p>  However, as any technically savvy professional knows, both of these options often lead to erroneous judgments, brakes in applications, etc. I hope this article will help you make good and fast software. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/349914/">https://habr.com/ru/post/349914/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../349904/index.html">GLPI in a small organization, part 2. Basic functionality and features of its use</a></li>
<li><a href="../349906/index.html">Setting up VoIP FXO gateway Yeastar Neogate TAXXX to work with 3CX</a></li>
<li><a href="../349908/index.html">How to learn to learn. Part 3 - we train memory "on a science"</a></li>
<li><a href="../349910/index.html">Three aspects of optimization (DB and software)</a></li>
<li><a href="../349912/index.html">Ruby on Rails ActionCable + Vue.js v2 for example chat</a></li>
<li><a href="../349916/index.html">The Dream Machine: The history of the computer revolution. Prologue</a></li>
<li><a href="../349918/index.html">Sound in ReactJS</a></li>
<li><a href="../349920/index.html">Again about empty transfers in C #</a></li>
<li><a href="../349922/index.html">You are only 25 and you already have four companies behind you - what's wrong with you?</a></li>
<li><a href="../349924/index.html">Zombies that eat up your memory</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>