<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dynamic analysis of iOS applications without Jailbreak</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, we want to share our experience solving some problems related to the security analysis of iOS applications. The review will be subjec...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dynamic analysis of iOS applications without Jailbreak</h1><div class="post__text post__text-html js-mediator-article">  In this article, we want to share our experience solving some problems related to the security analysis of iOS applications.  The review will be subject to the condition that we do not have an iOS device with JailBreak on board. <br><br><img src="https://habrastorage.org/webt/59/df/4c/59df4c099666e585275113.jpeg"><br><a name="habracut"></a><br><h2>  Static analysis vs.  dynamic analysis </h2><br>  We begin our dive with the types of analysis and their small comparison.  Static analysis allows you to identify a large number of problems: from the left account data to various kinds of ‚Äúbookmarks‚Äù and vulnerabilities.  Speaking about iOS applications, we note that IDA Pro, Hopper Disassembler, MobSF or Radare2 will be useful in this business.  The advantage of this approach is the ability to autoscan files, code, including, unused with a relatively full coverage. <br><br>  Dynamic analysis helps to find out how an application behaves directly during operation / execution, for example, to examine the state of a program at one or another point of execution (memory contents, registers, value of variables), study the operation logic, etc. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Using these two approaches allows you to carry out the work on analyzing the application in the most qualitative way, cover the entire attack-surface and find the maximum possible number of errors and vulnerabilities. <br><table><tbody><tr><th>  Criteria </th><th>  Static analysis </th><th>  Dynamic analysis </th></tr><tr><td>  Code vs.  Data </td><td>  Problems </td><td>  No problems </td></tr><tr><td>  Code coverage </td><td>  Large (but not all) </td><td>  One way </td></tr><tr><td>  Value data </td><td>  No information </td><td>  All information </td></tr><tr><td>  Self-modifying code </td><td>  Problems </td><td>  No problems </td></tr><tr><td>  Runtime vulnerabilities </td><td>  Not </td><td>  Yes </td></tr><tr><td>  Unused code </td><td>  Analyzed </td><td>  Not analyzed </td></tr></tbody></table><br><h2>  Dynamic analysis </h2><br>  Dynamic analysis of mobile applications is impossible without a device or, in the worst case, an emulator.  Real devices are almost always preferable (unless there is a great need for any parallelization of the task).  But the availability of a real device is more expensive for the researcher himself ... A simple possibility of installing your own applications on the device and tools for analyzing applications is also needed. <br><br><h3>  Android situation </h3><br>  While exploring Android applications, you can often even get away with the old and cheap version of the device or an emulator in the development environment.  On Android, there is a simple opportunity to increase the user's privileges, in other words, ‚Äúget root access‚Äù, to install your own tools and applications on it.  On the old devices of Chinese brothers in the settings there was even one time switch for obtaining superuser privileges in one click / tap.  On a personal device used every day, root can, in inept hands, noticeably weaken system security and cause malware infection, so we do not advise doing this.  But as part of laboratory research, this is a necessary thing that allows us to speed up and improve the course of research. <br><br><h3>  IOS situation </h3><br>  When conducting a security audit of iOS applications, there are some additional points: <br><br><ul><li>  The cost of the device is not the lowest.  But a separate device is definitely needed - do not use the same personal device </li><li>  Device version - old phones are not suitable.  Often you need the latest features, including Force Touch / Touch ID / .. </li><li>  The type of device - phone, tablet, clock - all this plays an important role in the analysis (we have seen cases when a vulnerability in the same application was present only in the version for a certain type of device) </li><li>  Relevance of the iOS version - The iOS API is constantly evolving, and for qualitative analysis, the analysis itself should take place on the latest iOS version </li><li>  Having JailBreak on the device - to install your applications and tools with all the above </li></ul><br><h2>  Jailbreak </h2><br>  Earlier, when the first iPhone was just released, it was hacked a few days after the release.  A rather low level of security was maintained up to the fourth version of the operating system: the researchers created extensions (tweak), built their iOS builds and added applications.  Over time, Apple changed its attitude towards security and significantly enhanced system security, also adding some of the most requested features created for Jailbreak devices in its updates.  For example, the Control Center was initially tweak, and later became an embedded component of iOS.  Each new release of the system increased the time for finding and exploiting vulnerabilities, changing the API and accessibility of the function (moving some to Private, and some to the Public zone).  These and many other changes made life difficult for developers of tweaks (add-ons for the system) and applications, forcing them to update their offspring under new APIs and functions, as well as security researchers.  The increased protection of devices was also influenced by close attention to the ‚Äúbad guys‚Äù platform, special services, and all those who would like to access your data on the device.  So, today the price of a remote JailBreak for iOS reaches $ 1.5 million. <br><br><img src="https://habrastorage.org/webt/59/df/6a/59df6ad2c4a5c825076918.png"><br><br>  Time passed, and many who stood at the origins of the JailBreak creation, were hired by information security companies, <a href="https://yalujailbreak.net/jonathan-zdziarski-apple/">Apple</a> itself <a href="https://yalujailbreak.net/jonathan-zdziarski-apple/">,</a> or began selling vulnerabilities to certain individuals, without publishing and creating public JailBreak.  All this (an increase in the platform security level and an outflow of vulnerabilities to the market) led to the fact that public JailBreaks began to appear less and less. <br><br>  At the moment, the latest actual version of iOS, suitable for using Jailbreak, is <a href="http://pangu8.com/luca-todesco.html">iOS 10.2</a> .  All other versions of iOS10.2.1‚Äì11 are not yet confirmed, and numerous tweets do not contain anything other than video or photos / screenshots.  It turns out that in order to conduct a security audit on a device, it is necessary to perform many factors, and the stumbling block is the presence of a current JailBreak. <br><blockquote>  <b>Small retreat</b> <br>  At the Tencent Security Summit 2017 conference, researcher Chris Wade presented a project on full virtualization of the iPhone 6. It is not public and it is not yet known how and when it will appear to a wide audience.  But definitely, this is a very big step forward for many areas related to iOS. <br>  <a href="https://twitter.com/cmwdotme/status/907040266594521088">one</a> <a href="https://twitter.com/SparkZheng/status/903175352897245184">two</a> <a href="https://twitter.com/esizkur/status/903174492654055424">three</a> </blockquote><br><h2>  Security Analysis for iOS Applications </h2><br>  Now gradually gradually move on to the main topic of the article.  So, there are, by and large, three types of application / system analysis: <br><br><ul><li>  WhiteBox - as part of this type of work, the customer provides all the information about the application: source code, documentation, etc.  And here we are free to do ourselves with the application, whatever - to modify, build, run, analyze, etc.  on any available device even without JailBreak. </li><li>  GrayBox - in such a situation, the customer does not provide the source code of his application for one reason or another, but he can make a special assembly of his application for analysis.  For example, with all the debugging messages and features turned off by SSL pinning and with our own libraries inside, which simplify the analysis of the application (more about them later).  This build runs without problems on the device without JailBreak. </li><li>  BlackBox is a model that fully reflects the situation with a real attacker who does not have any additional information about the application and the ability to influence its assembly.  Here we just go to the application distribution store, download one of them and then try to do something with it.  It is also possible that the customer‚Äôs desire to work in such a model of the offender, and participation in the developer‚Äôs BugBounty program.  This is where the problem arises with the dynamic exploration of applications, since, in theory, one cannot do without JailBreak ... </li></ul><br><h3>  Dynamic study of the security of iOS applications without Jailbreak </h3><br>  Conducting this kind of research requires some training of the researcher and setting the environment, so the steps in the form of a manual necessary for the implementation of the plan will be described below.  It is important to note that some steps can be skipped, for example, if you use an Xcode project (signing, delivery to a device, etc.). <br><br>  <b><u>Step 0. Preparation</u></b> <br><br>  In order to begin research, it is necessary to observe some simple conditions regarding the environment: <br><br><ul><li>  macOS with Xcode </li><li>  Apple Developer Account </li><li>  iOS device without JailBreak </li><li>  The decrypted .ipa file of the application being investigated </li><li>  The framework you need to add to the application </li></ul><br>  <b><u>Step 1. Extract the .ipa file</u></b> <br><br>  In order to get the IPA file needed for analysis, there are several ways: <br><br><ul><li>  From iTunes (iTunes &lt;12.7.X +) </li></ul><br>  Buying an application in the AppStore from iTunes.app allows you to get the associated .ipa file to the AppleID of the buyer, this limits the possibility of modification, but allows you to conduct a static analysis of the binary file.  The limitation of the version of iTunes.app is related to the latest application updates: <a href="https://support.apple.com/en-us/HT208075">Apple has deleted the AppStore section</a> . <br><br><ul><li>  iFunBox, even TestFlight (iOS‚â§8.3) </li></ul><br>  An application for managing the file system of iOS devices.  Full functionality is available only on devices with iOS version not higher than iOS 8.3. <br><br><ul><li>  Download the old version of the .ipa file from iTunes (iTunes &lt;12.7.X +) </li></ul><br>  This is possible through the use of any application that allows you to redirect traffic through yourself (Charles Proxy, Burp, ..).  After that, you need to run iTunes and download the selected application.  Then, intercepting the request, change the build number for downloading in the package XML file and continue execution.  More details about this can be found <a href="https://dsec.ru/upload/medialibrary/29f/29f57cef406125e9169da733e1aaf83f.pdf">here</a> and see <a href="https://lifehacker.com/download-old-versions-of-ios-apps-with-a-clever-workaro-1749950092">here</a> . <br><br><ul><li>  Online, for example, with ipastore.me or w3bsit3-dns.com (already immediately decoded here) </li></ul><br>  Sites and forums with applications available for download without binding to AppleID and allowing the necessary manipulations to join frameworks - <br>  the best solution, but you need to be careful with banking applications :) <br><br>  <b><u>Step 2-3.</u></b>  <b><u>Data Extraction and .ipa Decryption</u></b> <br><br>  There will be a slight deviation from the rules, when JailBreak may be required, - for the step of getting the decrypted .ipa file.  This concerns, first of all, those applications that are not available through the AppStore (for example, ‚Äúspecial assemblies‚Äù or TestFlight).  Getting the decrypted file is necessary to build the modified binary without being tied to the owner's AppleID.  To do this, you can use the applications for JailBreak devices (for example, ask to unload a friend :) <br><br><ul><li>  <a href="http://github.com/stefanesser/dumpdecrypted">GitHub: / stefanesser / dumpdecrypted</a> </li><li>  <a href="http://github.com/KJCracks/Clutch">GitHub: / KJCracks / Clutch</a> </li><li>  <a href="http://github.com/easonoutlook/Rasticrac">GitHub: / easonoutlook / Rasticrac</a> </li></ul><br>  Or, if it is a publicly available application, download from resources such as: <br><br><ul><li>  <a href="http://iphonecake.com/">iphonecake.com</a> </li><li>  <a href="http://4pda.ru/">W3bsit3-dns.com</a> </li></ul><br>  <b><u>Step 4. Adding the framework</u></b> <br><br>  One of the most convenient ways to add a framework to the .ipa file is to use the Xcode project.  There are many projects on GitHub, but I wanted to highlight a couple, in our opinion, of the most successful, efficient and intuitive. <br><br><ul><li>  <a href="http://github.com/jamie72/IPAPatch">GitHub: / jamie72 / IPAPatch</a> (ideal for reveal / cycript) </li><li>  <a href="http://github.com/vtky/resign">GitHub: / vtky / resign</a> (ideal for frida / etc ..) </li></ul><br>  In the first case, there is a demo in which you only need to replace the .ipa file of interest and build the application, in the second case, drag the .ipa file and the Framework that you need to attach.  The convenience of the first project lies in the fact that in addition to the introduction of the library, the researcher can add his own code, which will work after launch. <br><br><h3>  What can be put inside the .ipa file? </h3><br>  Answer: What your heart desires!  But from the point of view of security analysis of the application, we can recommend using the following ready-made frameworks: <br><br>  <b>Frida</b> ( <a href="http://github.com/frida/frida">GitHub: / frida / frida</a> ) <br><br>  One of the few frameworks that is actively developing today and allowing you to implement the JS code inside the process, track the launch of the application and patch it even before the process is finished downloading.  Its advantages are easy extensibility for tasks, the possibility of scripting actions and a convenient client.  By adding only Frida gadget to the project, even without performing anything, it is already possible to find out which calls occur within the program and later apply this in static analysis (r2 + frida). <br><br>  Useful links for this project: <br><br><ul><li>  <a href="https://www.frida.re/docs/presentations/zeronights-2015-cross-platform-reversing-with-frida.pdf">ZeroNights'15 workshop</a> </li><li>  <a href="https://github.com/sensepost/objection">Frida objection</a> </li><li>  <a href="https://github.com/dweinstein/awesome-frida">Awesome Frida (examples)</a> </li><li>  <a href="https://www.frida.re/docs/ios/">and one more</a> and <a href="https://www.nccgroup.trust/uk/about-us/newsroom-and-events/blogs/2016/october/ios-instrumentation-without-jailbreak/">second</a> </li></ul><br>  <b>Cycript</b> ( <a href="http://www.cycript.org/">www.cycript.org</a> / <a href="http://github.com/nowsecure/frida-cycript">GitHub: / nowsecure / frida-cycript</a> ) <br><br>  Similar in functionality to the Frida framework, it allows embedding into processes and manipulating environment variables and memory through an interactive console.  It supports not only Javascript, but also Objective-C. <br><br>  Useful links for this project: <br><br><ul><li>  <a href="http://www.cycript.org/manual/">Manual</a> </li><li>  <a href="https://www.youtube.com/watch%3Fv%3D5d1cK0nq4GY">Cycript @ 360 iDev 2013</a> </li></ul><br>  <b>CydiaSubstrate</b> ( <a href="">cydiasubstrate.com/mobilesubstrate_iphoneos-arm.deb</a> ) <br><br>  The legendary framework from Saurik itself, which allows to modify the application without the source code, manipulate the API and in every possible way twist and twist the application without having the source code.  But at the moment it has not been updated for a long time, and it should be used solely at your own peril and risk.  In addition, the development of iOS makes changes to the API, so in some versions of iOS it may not be useful at all. <br><br>  <b>Reveal</b> ( <a href="http://revealapp.com/">revealapp.com</a> ) <br><br>  The most non-standard of this set of frameworks.  It is more suitable for UI / UX-sphere and studying the device interfaces for the presence of hidden fields, associated objects, and so on.  Plus is the support for TV and Watch. <br><br>  <b><u>Step 5. Sign application</u></b> <br><br>  The application can not be installed on a smartphone without a corresponding developer signature (do not forget that we have a device without JailBreak).  If we do not use Xcode, which itself, automatically, picks up certificates, then we can do it manually using one of the tools: <br><br><ul><li>  <a href="http://github.com/nowsecure/node-applesign">GitHub: / nowsecure / node-applesign</a> </li><li>  <a href="http://github.com/DanTheMan827/ios-app-signer">GitHub: / DanTheMan827 / ios-app-signer</a> </li></ul><br>  They both do an excellent job with their tasks and at the output we get the application correctly re-signed by our certificate. <br><br>  <b><u>Step 6. Delivery to the device</u></b> <br><br>  Using Xcode projects and a device after selecting a target, the application will automatically be delivered and launched on the smartphone.  If the output is only .ipa file, then install it will help the following utilities: <br><br><ul><li>  <a href="http://www.cydiaimpactor.com/">Impactor (any AppleID)</a> </li><li>  <a href="http://www.i-funbox.com/">iFunBox (iOS‚â§8.3)</a> </li><li>  <a href="http://github.com/autopear/ipainstaller">JB GitHub: / autopear / ipainstaller</a> </li></ul><br>  In short, the diagram with a description of each step and utilities that help to make each step looks like this: <br><img src="https://habrastorage.org/webt/59/df/81/59df81b152a44873957127.png"><br>  And finally, a couple of demos of how it all looks in a bundle: <br><br>  <a href="https://vimeo.com/237924702">Demo 1</a> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://player.vimeo.com/video/237924702" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <b>Description</b> : <br><br>  A project from the ‚Äúdisfigured‚Äù .ipa FaceTune is going together with FridaGadget.  Launch it and Frida, call tracking. <br><br>  <a href="https://vimeo.com/237924719">Demo 2</a> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://player.vimeo.com/video/237924719" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <b>Description</b> : <br>  Building a project from Demo 1, launching Objection with Frida and viewing the contents of the application folder, calling Alerts, reading the contents of Keychain. <br><br>  This work was a little earlier presented at VolgaCTF'17, and slides from the report can be viewed <a href="https://dsec.ru/upload/volgactf_dyn_ios_analysis_wo_jb.pdf">here</a> . <br><br>  For assistance in the preparation of thanks <a href="https://habrahabr.ru/users/d1g1/" class="user_link">d1g1</a> <br><br>  UPD: <br><blockquote>  appdb.store - allows you to sign applications online and for free, if you attach your developer account.  Also from there you can download decrypted binaries. </blockquote><br>  Thank you <a href="https://habrahabr.ru/users/zond80/" class="user_link">ZonD80</a> </div><p>Source: <a href="https://habr.com/ru/post/339952/">https://habr.com/ru/post/339952/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../339936/index.html">We are looking for treasures in the source code Aladdin</a></li>
<li><a href="../339938/index.html">We play APK golf. Reduce the size of Android APK files by 99.9%</a></li>
<li><a href="../339940/index.html">A minute of Black Magic</a></li>
<li><a href="../339942/index.html">SuperJob Meetup. System business analysis. Live broadcast</a></li>
<li><a href="../339950/index.html">Dow Jones Financial Information Agency mistakenly reported merging Apple and Google</a></li>
<li><a href="../339954/index.html">How to teach your neural network to analyze morphology</a></li>
<li><a href="../339956/index.html">Data Science Week 2017. Review of the second and third day</a></li>
<li><a href="../339958/index.html">Total exhaustion, or is there life after IPv4</a></li>
<li><a href="../339960/index.html">ServiceNow-conference "Knowledge17"</a></li>
<li><a href="../339962/index.html">[CppCon 2017] Matt Godbolt: What did my compiler do for me?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>