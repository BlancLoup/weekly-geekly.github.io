<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What kind of library to work with HTTP in Android choose?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I present to you the translation of the article ‚Äú Which Android HTTP library to use? ". 

 What is it for? 
 Today, almost all applications use HTTP /...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What kind of library to work with HTTP in Android choose?</h1><div class="post__text post__text-html js-mediator-article">  <i>I present to you the translation of the article ‚Äú <a href="http-library-to-use.html">Which Android HTTP library to use?</a></i>  <i>".</i> <br><br><h2>  What is it for? </h2><br><img src="https://habrastorage.org/files/04c/7e5/237/04c7e52372884d4b9a9bfb3b9968ef2d.jpg" align="left" width="45%">  Today, almost all applications use HTTP / HTTPS requests as a transport for their data.  Even if you do not directly use these protocols, many SDKs that you most likely have already included in your applications (for example, metrics, crash statistics, ads) use HTTP / HTTPS to work with the network.  To date, very few libraries exist that a developer could freely use in his project.  And I will try to tell about the main ones in this post. <br>  Android developers have many reasons to opt for third-party libraries, instead of already built-in APIs, such as HttpURLConnection or Apache Client.  For example: <br><a name="habracut"></a><br><ol><li>  Ability to cancel a network call </li><li>  Parallel query execution </li><li>  Connection pooling and reusing existing socket connections </li><li>  Local server response caching </li><li>  Simple asynchronous operation interface to avoid blocking the main or UI threads </li><li>  Convenient REST API wrapper </li><li>  Retry and Delay Policy </li><li>  Efficient loading and transformation of images </li><li>  JSON serialization </li><li>  Support SPDY, http / 2 </li></ol><br><h2>  A bit of history </h2><br>  At the very beginning, there were only 2 HTTP clients on Android: the HttpURLConnection and the Apache HTTP Client.  According to an official Google blog post, HttpURLConnection had several bugs in earlier versions of Android: <br><blockquote>  Before Froyo, HttpURLConnection had some not very nice bugs.  In particular, the close () call to the readable InputStream could spoil the connection pool. </blockquote><br>  At the same time, Google did not want to develop and switch to the Apache HTTP Client: <br><blockquote>  ... the large size of their API prevents us from improving this library without losing backward compatibility.  The Android team is not actively working on the Apache HTTP Client. </blockquote><br>  Before Froyo, most developers preferred to use different clients based on the OS version: <br><blockquote>  The Apache HTTP client has few bugs on Eclair and Froyo, so it is the best choice for these versions.  And for Gingerbread and younger HttpURLConnection is better suited.  The simplicity of the API and low weight are well suited for Android.  Transparent compression and response caching help increase speed and save battery.  New applications should use HttpURLConnection. </blockquote><br>  Even today, if you take a look at the Volley source from Google (I'll talk about it a little later), you can find this legacy: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (stack == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Build.VERSION.SDK_INT &gt;= <span class="hljs-number"><span class="hljs-number">9</span></span>) { stack = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HurlStack(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Prior to Gingerbread, HttpUrlConnection was unreliable. // See: http://android-developers.blogspot.com/2011/09/androids-http-clients.html stack = new HttpClientStack(AndroidHttpClient.newInstance(userAgent)); } }</span></span></code> </pre> <br>  This is a classic example of the fragmentation of Android, which makes developers suffer.  In 2013, Square drew attention to this problem when it released OkHttp.  OkHttp was created to work directly with the top level of Java sockets, without using any additional dependencies.  It comes in the form of a JAR file, so developers can use it on any JVM device (where we include, of course, Android).  To simplify the transition to their library, Square implemented OkHttp using the interfaces HttpUrlConnection and the Apache client. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/dc7/e0a/d48/dc7e0ad48e304eab8ab2f8fd029f7110.png"><br><br>  OkHttp has received a lot of distribution and community support, and in the end, Google decided to use version 1.5 on Android 4.4 (KitKat).  In July 2015, Google officially recognized the Apache-based AndroidHttpClient as obsolete, along with the release of Android 5.1 (Lolipop). <br><br>  Today, OkHttp comes with the following huge feature set: <br><br><ol><li>  HTTP / 2 and SPDY support allows all requests going to the same host to share a socket </li><li>  Merging requests reduces latency (if SPDY is not available) </li><li>  Transparent GZIP allows you to reduce the weight of downloadable information </li><li>  Caching responses allows you to avoid working with the network with repeated requests. </li><li>  Support for both synchronized blocking calls and asynchronous calls with a callback </li></ol><br>  My favorite part of OkHttp is how beautiful and neat you can work with asynchronous requests: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> OkHttpClient client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OkHttpClient(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ Request request = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Request.Builder() .url(<span class="hljs-string"><span class="hljs-string">"http://publicobject.com/helloworld.txt"</span></span>) .build(); client.newCall(request).enqueue(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Callback() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onFailure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Request request, Throwable throwable)</span></span></span><span class="hljs-function"> </span></span>{ throwable.printStackTrace(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onResponse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Response response)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!response.isSuccessful()) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IOException(<span class="hljs-string"><span class="hljs-string">"Unexpected code "</span></span> + response); System.out.println(response.body().string()); } }); }</code> </pre><br>  This is very convenient, since working with the network should not be in the UI stream.  In fact, starting with Android 3.0 (Honeycomb, API 11), working with the network in a separate thread has become mandatory.  In order to implement something similar with HtttpUrlConnection, you will need to build a large (and maybe even monstrous) construct using AsyncTask or a separate stream.  This will be even more difficult if you want to add cancellation of the load, merge of connections, etc. <br><br>  By the way, Google‚Äôs Google‚Äôs Volley‚Äôs HTTP library, which provides us with the following bonuses: <br><br><ol><li>  Automatic scheduling network requests </li><li>  Many parallel network connections </li><li>  Transparent caching in memory and on disk, in accordance with standard cache consistency. </li><li>  Support prioritization queries. </li><li>  Cancel API requests.  You can cancel both one request and the whole block. </li><li>  Easy to set up, for example, for repetitions and delays. </li><li>  Strict ordering that makes it easy to populate the user interface data asynchronously from the network. </li><li>  Debugging and tracing tools </li></ol><br><img src="https://habrastorage.org/files/6ce/fae/2d4/6cefae2d41fc45eea0067610c35e8906.png"><br><br>  Everything Volley has is at the top of the HttpUrlConnection.  If you want to get JSON or an image, then Volley has a special abstraction for it, such as ImageRequest and JsonObjectRequest, which help you automatically convert the HTTP payload.  It is also noteworthy that Volley uses a hard-coded network pool size: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> DEFAULT_NETWORK_THREAD_POOL_SIZE = <span class="hljs-number"><span class="hljs-number">4</span></span>;</code> </pre><br>  When OkHttp uses a thread for each call with a ThreadPoolExecutor with a maximum value of Integer.MAX_VALUE: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> maxRequests = <span class="hljs-number"><span class="hljs-number">64</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> maxRequestsPerHost = <span class="hljs-number"><span class="hljs-number">5</span></span>; executorService = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ThreadPoolExecutor(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE, <span class="hljs-number"><span class="hljs-number">60</span></span>, TimeUnit.SECONDS, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LinkedBlockingQueue&lt;Runnable&gt;(), Util.threadFactory(<span class="hljs-string"><span class="hljs-string">"OkHttp Dispatcher"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>));</code> </pre><br>  As a result, in most cases OkHttp will act faster due to the use of a large number of threads.  If for some reason you want to use OkHttp together with Volley, that is, the <a href="https://gist.github.com/bryanstern/4e8f1cb5a8e14c202750">implementation of HttpStack</a> , which uses the API of requests / responses from OkHttp instead of HttpURLConnection. <br><br>  HTTP clients continued to evolve to support applications with a large number of images, especially those who support endless scrolling and image transformation.  At the same time, the REST API became the standard in the industry, and each developer dealt with such typical tasks as serialization to / from JSON and conversion of REST calls to Java interfaces.  Not a lot of time passed, as libraries appeared that solve these problems: <br><br><ol><li>  Retrofit is a type-safe HTTP Android client for interacting with REST interfaces. </li><li>  Picasso - a powerful library for downloading and caching images for Android </li></ol><br>  Retrofit provides a bridge between Java code and the REST interface.  It allows you to quickly include APIs in your HTTP project, and generates a self-documenting implementation. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GitHubService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@GET</span></span>(<span class="hljs-string"><span class="hljs-string">"/users/{user}/repos"</span></span>) Call&lt;List&lt;Repo&gt;&gt; listRepos(<span class="hljs-meta"><span class="hljs-meta">@Path</span></span>(<span class="hljs-string"><span class="hljs-string">"user"</span></span>) String user); } Retrofit retrofit = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Retrofit.Builder() .baseUrl(<span class="hljs-string"><span class="hljs-string">"https://api.github.com"</span></span>) .build(); GitHubService service = retrofit.create(GitHubService.class);</code> </pre><br>  In addition to all, Retrofit supports converting to JSON, XML, protocol buffers (protocol buffers). <br><br>  Picasso, on the other hand, provides an HTTP image-oriented library.  For example, you can load an image into your View with one line: <br><br><pre> <code class="java hljs">Picasso.with(context).load(<span class="hljs-string"><span class="hljs-string">"http://i.imgur.com/DvpvklR.png"</span></span>).into(imageView);</code> </pre><br>  Picasso and Retrofi are configured to use OkHttpClient as a standard HTTP client.  However, if you prefer, you can specify an HttpURLConnection client. <br><br>  Glide is something like Picasso.  It provides some additional features, such as GIF animation, generating thumbnail image thumbnails and still videos.  Full comparison can be found <a href="http://inthecheesefactory.com/blog/get-to-know-glide-recommended-by-google/en">here</a> . <br><br>  Facebook recently opened to the public the source code of the Fresco library, which they use in their mobile app.  One of the key functions that allocates it is the custom memory allocation strategy for bitmap to avoid the work of a long GC (garbage collector).  Fresco allocates memory in a region called ashmem.  Some tricks are used to have access to this region of memory access from both the part written in C ++ and the part in Java.  To reduce the consumption of CPU and data from the network, this library uses 3 cache levels: 2 in RAM, the third in internal storage. <br><br><img src="https://habrastorage.org/files/f4a/566/82b/f4a56682b43d48f99bb934a3bb52f405.png"><br><br>  I found it necessary to show the relationship between libraries on the same scheme.  As you can see, HTTP always stays down in high-level libraries.  You can choose between a simple HttpUrlConnection or the latest OkHttpClient.  We use this compatibility when developing the PacketZoom Android SDK, which we will discuss in the next post. <br><br><img src="https://habrastorage.org/files/eea/a92/b38/eeaa92b3868d460b89381e96af6483b1.png"><br><br>  We recently <a href="http://instructure.github.io/blog/2013/12/09/volley-vs-retrofit/">compared HTTP performance libraries to each other</a> , but this topic deserved separate consideration.  We hope that this review has given you basic ideas about the pros and cons of each library, and we helped you make the right choice.  Follow the release of more interesting posts about networking in Android from us. </div><p>Source: <a href="https://habr.com/ru/post/281965/">https://habr.com/ru/post/281965/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../281945/index.html">Experience in ensuring the reliability of computing equipment during long-term operation</a></li>
<li><a href="../281949/index.html">Results of the Young Digital Makers Programming Contest</a></li>
<li><a href="../281955/index.html">We solve the problem of caching dynamic JavaScript code on the front-end WordPress</a></li>
<li><a href="../281961/index.html">Top 20 Free Disk Monitoring Tools</a></li>
<li><a href="../281963/index.html">April 20 all day, first time online - IT Director Briefing 2016</a></li>
<li><a href="../281967/index.html">JavaScript API Development: 5 Principles for Writing Embedded Scripts</a></li>
<li><a href="../281969/index.html">The great Russian firewall is around the corner.</a></li>
<li><a href="../281971/index.html">JetCat: microQt for those who are easier</a></li>
<li><a href="../281973/index.html">Text Recognition from a Video Stream: The Future of Mobile OCR</a></li>
<li><a href="../281975/index.html">Two international conferences in St. Petersburg in June: Experimental Algorithms and Computer Science in Russia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>