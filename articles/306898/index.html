<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SMAS: ‚ÄúSorted Multi Array Struct‚Äù ‚Äîan alternative to a binary search tree</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Hello, habravchane. This is my first post in which I want to share the data structure of SMAS. At the end of the article, a C ++ class ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SMAS: ‚ÄúSorted Multi Array Struct‚Äù ‚Äîan alternative to a binary search tree</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  Hello, habravchane.  This is my first post in which I want to share the data structure of SMAS.  At the end of the article, a C ++ class of the proposed data structure will be provided.  The implementation is recursive, but my goal is to get the message across.  Implementing a non-recursive version is the second thing.  It is important to ‚Äúhear‚Äù opinions. <br><br><h4>  What is wrong with the tree? </h4><br>  Yes, everything and you can <s>complete the article, thank you all.</s>  It would spit on a significant memory overhead on auxiliary data in the form of references to left-right subtrees and a flag for balancing (different depending on the technique used - red-black, AVL, etc. trees).  Another, not so much a minus, is a constant modification of the tree when it is inserted for balancing (the complexity and complexity of the methods for beginners is especially important here).  At this, the minuses end and it's hard to imagine something better and more versatile (hash tables, IMHO, even cooler, but OX TORGES OF THESE COLLISIONS). <br><a name="habracut"></a><br><h4>  And why not sorted arrays? </h4><br>  Binary search in a sorted array is implemented with the same logarithmic complexity as in a binary search tree, but there is no need to link to smaller or larger subtrees, like in a binary search tree. <br><br>  But what is wrong with sorted arrays? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Yes, everything is so, you can <s>finish the article and use sorted arrays instead of binary search trees to</s> enjoy the saved resources, if only we do not need to add-delete elements from such an array, because if we add new elements (delete old ones), the array will say: " <s>Sort</s> me completely ".  But the trouble with sorting is that it is slow if you need to insert a new element somewhere between the others, especially at the beginning. <br><br>  But there is an ideal case - when a new element is more than the others and it is enough to simply add it to the end.  This is ideal - just one operation, but the probabilistic assessment of such an ideal case forces us to use binary trees or hash tables, or a huge number of other really beautiful and clever mechanisms.  Based on probability theory, such a situation is rare - only if all elements are added to the array in ascending order (irony-analogy with a binary search tree, when sorted input data is the worst case of a tree degenerating into a linked list with linear complexity). <br><br><h4>  A special case, as the pattern? </h4><br>  But let's consider an array of just one element.  It doesn't matter what value is entered - it always fits into the beginning of the empty to this array and the one-element array, naturally, is always sorted.  And if we want to enter the 2nd element in our data structure?  Let's just create another one-element array and get two sorted one-element arrays.  Getting a new sorted array of two sorted ones is a simple task, although not very fast ... But in this case, we already need to sort the array not with every insertion, but with every second insertion.  We use ‚Äúdeferred sorting‚Äù. <br><br>  And if we want to make more than 2 elements?  <s>Want-not harmful</s> - we will write a new 2-element array somewhere and continue to add elements to one-element arrays and also on the 4th element we will have 2 2 element sorted arrays, which we will be able to combine in the same way in one 4-element and so on, until the <s>blue screen of death pops up and the processor explodes with a black hole that pulls in all of the surrounding space-time</s> (something has blown me ...) until memory allows it. <br><br><h4>  Load distribution </h4><br>  It is clear that this algorithm already significantly reduces the number of sorts, relative to the sorting of a regular array, because the first level of arrays must be sorted once, the 2nd level - every 4th insert, the 3rd level - every 8th insert - actually logarithmic complexity. <br><br>  We could calm down on this, but <s>for weaklings</s> we will try to distribute the load with each insert evenly, adding our ‚Äúpending sorting‚Äù step by step and performing each step when inserting the next element for all levels - this will evenly distribute the load on all inserts - which is required . <br><br><h4>  Search </h4><br>  The search is a classic binary search on a sorted array with the only difference that there is a lot of arrays here and you need to search in turn for all.  Therefore, the logarithmic complexity of the search is disputed (if I am not mistaken, this is double the logarithmic complexity).  But in the task, this is quite acceptable, given the memory saved. <br><br><h4>  Implementation </h4><br>  While the kettle was boiling, I remembered that I wanted to write more, but then the kettle began to boil and his whistle made me forget that I wanted to write more ... <br><br>  The implementation was quite confusing, because in my head there was only a superficial idea of ‚Äã‚Äãhow this whole car would go - the code was written almost at random, <s>so I‚Äôll go to sleep with grief</s> , while the program structure of the class algorithm contains only 3 methods ( considering the constructor and destructor).  The code does not contain anything other than working with arrays, cycles, and OOP ideologies ‚Äî everything is simple and, I hope, understandable, to the <s>genius of</s> madness. <br><br><h4>  Actually code </h4><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _CRT_SECURE_NO_WARNINGS #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;windows.h&gt; #define undefined 2147483648 class ARRAY { private: ARRAY*nextLevel; unsigned int *keyResult, //          - keyLeft, keyRight *keyLeft, //     *keyRight, //     *keyTemp, //     *valResult, //   , *valLeft, //   *valRight, //  *valTemp, //  countResult,countLeft,countRight, //        1  2   0 . len;//  ( 0-  2  ) void upd() //       { if(keyResult) { if(countLeft&lt;len) { if(countRight&lt;len) { if(keyLeft[countLeft]&lt;keyRight[countRight])//   1-   2- -   { keyResult[countResult]=keyLeft[countLeft]; valResult[countResult]=valLeft[countLeft]; countResult++; countLeft++; } else//   2-   1- -      { keyResult[countResult]=keyRight[countRight]; valResult[countResult]=valRight[countRight]; countResult++; countRight++; } } else // 2-        .     { keyResult[countResult]=keyLeft[countLeft]; valResult[countResult]=valLeft[countLeft]; countResult++; countLeft++; } } else { if(countRight&lt;len) // 1-     -  .     { keyResult[countResult]=keyRight[countRight]; valResult[countResult]=valRight[countRight]; countResult++; countRight++; } //           -    } if(countResult==len*2) //      { if(!nextLevel)nextLevel=new ARRAY; // . ,      nextLevel-&gt;set(keyResult,valResult,len*2); keyResult=NULL; keyLeft=NULL; keyRight=NULL; keyTemp=NULL; valResult=NULL; valLeft=NULL; valRight=NULL; valTemp=NULL; } } if(nextLevel)nextLevel-&gt;upd(); } void set(unsigned int*Key,unsigned int*Val,unsigned int Len) { len=Len; if(!keyTemp){keyTemp=Key;valTemp=Val;} else { keyLeft=Key; valLeft=Val; keyRight=keyTemp; valRight=valTemp; keyTemp=NULL; valTemp=NULL; countResult=0; countLeft=0; countRight=0; keyResult=new unsigned int[len*2]; valResult=new unsigned int[len*2]; } upd(); } public: ~ARRAY() { if(keyResult)delete[]keyResult; if(keyLeft)delete[]keyLeft; if(keyRight)delete[]keyRight; if(keyTemp)delete[]keyTemp; if(valResult)delete[]valResult; if(valLeft)delete[]valLeft; if(valRight)delete[]valRight; if(valTemp)delete[]valTemp; if(nextLevel)delete nextLevel; } ARRAY() { keyResult=NULL; keyLeft=NULL; keyRight=NULL; keyTemp=NULL; valResult=NULL; valLeft=NULL; valRight=NULL; valTemp=NULL; countResult=0; countLeft=0; countRight=0; len=0; nextLevel=NULL; } void set(unsigned int Key,unsigned int Val) { unsigned int*k=new unsigned int[1];k[0]=Key; unsigned int*v=new unsigned int[1];v[0]=Val; set(k,v,1); } unsigned int get(unsigned int Key) { unsigned int l,r,i; if(keyTemp) { l=0;r=len; while(l!=r-1) { i=(l+r)/2; if(keyTemp[i]&lt;Key)l=i; else if(keyTemp[i]&gt;Key)r=i; else return valTemp[i]; } if(keyTemp[l]==Key)return valTemp[l]; } if(keyLeft) { l=0;r=len; while(l!=r-1) { i=(l+r)/2; if(keyLeft[i]&lt;Key)l=i; else if(keyLeft[i]&gt;Key)r=i; else return valLeft[i]; } if(keyLeft[l]==Key)return valLeft[l]; } if(keyRight) { l=0;r=len; while(l!=r-1) { i=(l+r)/2; if(keyRight[i]&lt;Key)l=i; else if(keyRight[i]&gt;Key)r=i; else return valRight[i]; } if(keyRight[l]==Key)return valRight[l]; } if(nextLevel)return nextLevel-&gt;get(Key); else return undefined; } }; void main() { ARRAY*arr=new ARRAY; char inp[256]; unsigned int Key,Val; while(gets(inp)&amp;&amp;inp[0]) { if(inp[0]=='+'){Key=atoi(&amp;inp[1]);gets(inp);Val=atoi(inp);arr-&gt;set(Key,Val);} else if(inp[0]=='='){Key=atoi(&amp;inp[1]);Val=arr-&gt;get(Key);if(Val!=undefined)printf("%d\n",Val);else printf("undefined\n");} else system("cls"); } delete arr; }</span></span></span></span></code> </pre> <cut><br><br>  PS: <br>  The algorithm does not implement the removal, although there are some <s>erotic</s> fantasies.  But this is a separate article.  Here I tried <s>to be clever in</s> communicating the very idea, and if someone has their own thoughts on the implementation of the deletion, we should say.  Although in fact this structure was developed for a specific task that does not require removal or nothing at all except quick insertion and quick search, there was a desire to modify the class by implementing other methods that are often necessary in everyday work, which I will do when the <s>cancer hangs on the mountain</s> - someday </cut></div><p>Source: <a href="https://habr.com/ru/post/306898/">https://habr.com/ru/post/306898/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../306888/index.html">BILLmanager has become more open</a></li>
<li><a href="../306890/index.html">Rack KVM for the budget</a></li>
<li><a href="../306892/index.html">Choosing backup equipment in a small office</a></li>
<li><a href="../306894/index.html">A small script to track prices avito from Google Spreadsheet</a></li>
<li><a href="../306896/index.html">Optical fiber in industrial communication systems</a></li>
<li><a href="../306900/index.html">Monitoring applications in IT. Easier than a burger</a></li>
<li><a href="../306902/index.html">Hamlet's smuggling with a cat</a></li>
<li><a href="../306904/index.html">We work with a hybrid cloud: VMware vCloud Connector, part 1</a></li>
<li><a href="../306906/index.html">Shake dust from the globe: check the project NASA World Wind</a></li>
<li><a href="../306908/index.html">It doesn't matter if you are big or small. The main thing is not small. Stuffing Material Design</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>