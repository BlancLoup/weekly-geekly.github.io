<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A few notes about MySQL</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="During the work with MySQL, a certain amount of nuances and tricks were gathered, of which I composed this article in the form of a set of notes. All ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A few notes about MySQL</h1><div class="post__text post__text-html js-mediator-article">  During the work with MySQL, a certain amount of nuances and tricks were gathered, of which I composed this article in the form of a set of notes.  All this is not a secret and, of course, can be found in the documentation. <br><br>  I will use the default MySQL settings.  Some notes are related to PHP, so for the examples I will use the <a href="http://php.net/manual/en/class.mysqli.php">mysqli</a> extension. <br><br>  To run sql queries from an article, you can initialize the tables as follows: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> <span class="hljs-string"><span class="hljs-string">`user_myisam`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`login`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">8</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`money`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`login`</span></span> (<span class="hljs-string"><span class="hljs-string">`login`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=MyISAM <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8 AUTO_INCREMENT=<span class="hljs-number"><span class="hljs-number">1</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`user_myisam`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`login`</span></span>, <span class="hljs-string"><span class="hljs-string">`money`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'ivanov'</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>), (<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'petrov'</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>), (<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'sidorov'</span></span>, <span class="hljs-number"><span class="hljs-number">300</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> <span class="hljs-string"><span class="hljs-string">`user_innodb`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`login`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">8</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`money`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`login`</span></span> (<span class="hljs-string"><span class="hljs-string">`login`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8 AUTO_INCREMENT=<span class="hljs-number"><span class="hljs-number">1</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`user_innodb`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`login`</span></span>, <span class="hljs-string"><span class="hljs-string">`money`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'ivanov'</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>), (<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'petrov'</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>), (<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'sidorov'</span></span>, <span class="hljs-number"><span class="hljs-number">300</span></span>);</code> </pre> <br>  You can check current auto increments like this: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SHOW</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATUS</span></span>;</code> </pre> <br>  In both tables they are equal to 4. At the same time, there is such a connection to the database: <br><br><pre> <code class="php hljs">$mysqli = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> mysqli($host, $user, $password, $database);</code> </pre><a name="habracut"></a><br><h3>  Insert by unique key and auto-increment </h3><br>  If the table has a unique key, then for insertion and updating there are three ways to pass the uniqueness check on MySQL: INSERT IGNORE, INSERT ... ON DUPLICATE KEY UPDATE, REPLACE.  Each type of query behaves differently with auto-increment on different types of tables: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IGNORE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`user_innodb`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-string"><span class="hljs-string">`login`</span></span> = <span class="hljs-string"><span class="hljs-string">"ivanov"</span></span>, <span class="hljs-string"><span class="hljs-string">`money`</span></span> = <span class="hljs-number"><span class="hljs-number">1000</span></span>;</code> </pre><br>  Autoincrement became 5, although there was no insert.  And what will happen to MyISAM: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IGNORE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`user_myisam`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-string"><span class="hljs-string">`login`</span></span> = <span class="hljs-string"><span class="hljs-string">"ivanov"</span></span>, <span class="hljs-string"><span class="hljs-string">`money`</span></span> = <span class="hljs-number"><span class="hljs-number">1000</span></span>;</code> </pre><br>  There the auto increment remained 4. A similar situation will be with ON DUPLICATE KEY UPDATE: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`user_innodb`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-string"><span class="hljs-string">`login`</span></span> = <span class="hljs-string"><span class="hljs-string">"ivanov"</span></span>, <span class="hljs-string"><span class="hljs-string">`money`</span></span> = <span class="hljs-number"><span class="hljs-number">1000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DUPLICATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-string"><span class="hljs-string">`money`</span></span> = <span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`user_myisam`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-string"><span class="hljs-string">`login`</span></span> = <span class="hljs-string"><span class="hljs-string">"ivanov"</span></span>, <span class="hljs-string"><span class="hljs-string">`money`</span></span> = <span class="hljs-number"><span class="hljs-number">1000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DUPLICATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-string"><span class="hljs-string">`money`</span></span> = <span class="hljs-number"><span class="hljs-number">1000</span></span>;</code> </pre><br>  In user_innodb, autoincrement became 6, and user_myisam remained 4. <br><br>  REPLACE works differently: in case of finding matches in a unique key, it will delete the old record and add a new one. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-string"><span class="hljs-string">`user_innodb`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-string"><span class="hljs-string">`login`</span></span> = <span class="hljs-string"><span class="hljs-string">"petrov"</span></span>, <span class="hljs-string"><span class="hljs-string">`money`</span></span> = <span class="hljs-number"><span class="hljs-number">2000</span></span>;</code> </pre> <br>  Increments the auto increment to 7, now Petrov has id = 6. <br><br>  MyISAM is similar: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-string"><span class="hljs-string">`user_myisam`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-string"><span class="hljs-string">`login`</span></span> = <span class="hljs-string"><span class="hljs-string">"petrov"</span></span>, <span class="hljs-string"><span class="hljs-string">`money`</span></span> = <span class="hljs-number"><span class="hljs-number">2000</span></span>;</code> </pre> <br>  Autoincrement became 5, and Petrov got id = 4. <br><br>  So, REPLACE works on both table engines in the same way, and INSERT IGNORE and ON DUPLICATE KEY UPDATE change the autoincrement to InnoDB. <br><br>  <a href="https://dev.mysql.com/doc/refman/5.7/en/example-auto-increment.html">About autoincrement</a> and <a href="https://dev.mysql.com/doc/refman/5.6/en/innodb-auto-increment-handling.html">about nuances with InnoDB</a> . <br><br><h3>  Getting the id of the record being modified after the update </h3><br>  After inserting / updating, using INSERT ... ON DUPLICATE KEY UPDATE, $ mysqli-&gt; insert_id contains the id only if an entry was added.  If you need to pull out the id of the record being modified, regardless of whether it was inserted or edited, you can do this: <br><br><pre> <code class="php hljs">$mysqli-&gt;query(<span class="hljs-string"><span class="hljs-string">'INSERT INTO `user_innodb` SET `login` = "walker" ON DUPLICATE KEY UPDATE `id` = LAST_INSERT_ID(`id`), `money` = 10;'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $mysqli-&gt;insert_id; $mysqli-&gt;query(<span class="hljs-string"><span class="hljs-string">'INSERT INTO `user_innodb` SET `login` = "walker" ON DUPLICATE KEY UPDATE `id` = LAST_INSERT_ID(`id`), `money` = 20;'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $mysqli-&gt;insert_id;</code> </pre><br>  Displays 7 and 7, the first time the entry was added under id = 7, the second time changed. <br><br>  With INSERT IGNORE such a trick will not work.  The code below will display 9 and 0 <br><br><pre> <code class="php hljs">$mysqli-&gt;query(<span class="hljs-string"><span class="hljs-string">'INSERT IGNORE `user_innodb` SET `id` = LAST_INSERT_ID(`id`), `login` = "smith", `money` = 3000'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $mysqli-&gt;insert_id; $mysqli-&gt;query(<span class="hljs-string"><span class="hljs-string">'INSERT IGNORE `user_innodb` SET `id` = LAST_INSERT_ID(`id`),`login` = "smith", `money` = 5000'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $mysqli-&gt;insert_id;</code> </pre><br><h3>  SEQUENCE implementation </h3><br>  MySQL, unlike other RDBMS, does not have such a thing as SEQUENCE.  There is an auto-increment, but it does not allow to solve all the tasks that SEQUENCE can help with.  For example, sharding. <br><br>  In general, if you need to arrange records on different tables or even databases, you will need a master table with an auto-increment field in which the ID of a new record would be centrally generated. <br><br>  You can solve this problem like this: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> <span class="hljs-string"><span class="hljs-string">`sequence`</span></span> ( <span class="hljs-string"><span class="hljs-string">`user_id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'0'</span></span>, <span class="hljs-string"><span class="hljs-string">`post_id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'0'</span></span>, <span class="hljs-string"><span class="hljs-string">`some_other_id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'0'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8; <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`sequence`</span></span> (<span class="hljs-string"><span class="hljs-string">`user_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`post_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`some_other_id`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><br>  In one table, several sequences are obtained at once, in this example, three. <br><br>  Then you can get the following ID from the desired sequence using the function <br>  <a href="http://dev.mysql.com/doc/refman/5.7/en/information-functions.html">last_insert_id ()</a> : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-string"><span class="hljs-string">`sequence`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-string"><span class="hljs-string">`some_other_id`</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">last_insert_id</span></span>(<span class="hljs-string"><span class="hljs-string">`some_other_id`</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">last_insert_id</span></span>();</code> </pre><br>  For auto increment, it is possible to specify the increment step with the auto_increment_increment configuration option.  In this example, such a function can be implemented like this: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-string"><span class="hljs-string">`sequence`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-string"><span class="hljs-string">`some_other_id`</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">last_insert_id</span></span>(<span class="hljs-string"><span class="hljs-string">`some_other_id`</span></span> + N); <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">last_insert_id</span></span>();</code> </pre><br><h3>  Little about unsigned integers </h3><br>  With care, use unsigned <a href="http://php.net/manual/en/language.types.integer.php">integers</a> as MySQL field types if you access the database from PHP. <br><br>  The story of my "insight" about this.  For the id field, I always used an unsigned integer type, still the classic id is not negative.  Once, when generating a model using Gii (Yii scaffolding), I noticed that the validation rules in the model for my id and other unsigned integer fields are generated as for strings.  ‚ÄúWTF?‚Äù - I thought and got into the framework code, where I found that when parsing field types there is such a ‚Äúhardcode‚Äù of checking for unsigned: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stripos($dbType,<span class="hljs-string"><span class="hljs-string">'int'</span></span>)!==<span class="hljs-keyword"><span class="hljs-keyword">false</span></span> &amp;&amp; stripos($dbType,<span class="hljs-string"><span class="hljs-string">'unsigned int'</span></span>)===<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)</code> </pre><br>  I considered this a mistake, I was glad that now I have a chance to contribute to the correction of the Yii bugs.  But the joy was quickly replaced by the thought ‚Äúit‚Äôs not for nothing‚Äù. <br><br>  Indeed, in PHP there are no unsigned integers, but in general there are 32-bit integers in PHP (under 32-bit Linux and under Windows).  If the integer value exceeds PHP_INT_MAX, then it is cast to float, and then the place for the emergence of magic with strange bugs.  So Mr. <a href="https://github.com/qiangxue">Qiang Xue</a> did the right thing. </div><p>Source: <a href="https://habr.com/ru/post/310954/">https://habr.com/ru/post/310954/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../310942/index.html">Ultralight BDD: Little Mechanization of Stand-Alone Tests</a></li>
<li><a href="../310944/index.html">After the biggest data theft in history on Yahoo! still ‚Äú33 misfortunes‚Äù</a></li>
<li><a href="../310946/index.html">Canvas Gauges 2.0</a></li>
<li><a href="../310950/index.html">The driver of the computer game Street Fighter V disables the built-in protection mechanism of Windows</a></li>
<li><a href="../310952/index.html">React.js: build an isomorphic / universal application from scratch. Part 3: we add authorization and data exchange with API</a></li>
<li><a href="../310956/index.html">Development of user interaction with mobile devices - key principles</a></li>
<li><a href="../310958/index.html">How to answer a maximum of questions with one report?</a></li>
<li><a href="../310960/index.html">The logic of consciousness. Part 7. Self-organization of the context space</a></li>
<li><a href="../310964/index.html">The history of one feature or why hakaton programmer</a></li>
<li><a href="../310966/index.html">The digest of interesting materials for the mobile developer # 172 (September 19-25)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>