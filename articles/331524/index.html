<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Security Week 25: In * NIX reanimated the ancient vulnerability, WannaCry was not completed, the CIA listens on our routers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Earth, 2005 Mysterious events are happening all over the planet: Nokia is launching a tablet on Linux , the development of the game with the members o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Security Week 25: In * NIX reanimated the ancient vulnerability, WannaCry was not completed, the CIA listens on our routers</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/ddb/6dc/88b/ddb6dc88b1d24f76aa672588633d9b52.jpg" width="300" align="right">  <b>Earth, 2005</b>  Mysterious events are happening all over the planet: Nokia is launching a <a href="https://www.mobilegazette.com/nokia-770-internet-tablet.htm">tablet on Linux</a> , the development of the <a href="http://uproxx.com/gaming/metallica-videogame-car-shooter/">game</a> with the members of the Metallica group in the lead roles is being done in great secrecy, Jobs <a href="https://en.wikipedia.org/wiki/Apple%2527s_transition_to_Intel_processors">announced the transfer of</a> Macs to the Intel platform. <br><br>  Meanwhile, at the CancSecWest conference, Gael Delallo from Beijaflore presented a fundamental <a href="http://cansecwest.com/core05/memory_vulns_delalleau.pdf">report</a> on the vulnerabilities of the memory management system in a variety of NIXs, and illustrated his findings with exploits for Apache.  All patched up.  Several years have passed. <br><br>  <b>2010</b>  Rafal Voytchuk <a href="http://www.invisiblethingslab.com/resources/misc-2010/xorg-large-memory-attacks.pdf">demonstrated</a> exploiting vulnerabilities of the same class in the Xorg server.  In the same year, Jon Oberaide published a couple of <a href="https://jon.oberheide.org/blog/2010/11/29/exploiting-stack-overflows-in-the-linux-kernel/">funny</a> <a href="https://jon.oberheide.org/files/infiltrate12-thestackisback.pdf">posts</a> about his innocent games with the nix kernel stack.  All patched up again. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>2016 year.</b>  The Google Project Zero was born <a href="https://googleprojectzero.blogspot.ru/2016/06/exploiting-recursion-in-linux-kernel_20.html">out of the</a> exploitation of exploiting kernel stack vulnerabilities under Ubuntu.  Oberaide says hello in the comments.  Ubuntu patched up. <br><br>  <b>2017 year.</b>  Never was this, <a href="https://threatpost.com/stack-clash-vulnerability-in-linux-bsd-systems-enables-root-access/126355/">and here again</a> .  Qualys has learned how to cheat with the username stack in any Nix, according to Delallo's ideas. <br><a name="habracut"></a><br>  The exploits of the user-mode stack are based on a simple question - if the dynamic area (heap) and the stack grow towards each other, what will happen when they meet?  However, one should not think that the Nix cores are developed by fools!  They, of course, thought about such a development of events (well, by our time they had precisely thought of it).  And in all modern Unix-like operating systems, the user-mode stack is fenced with a special memory page, an attempt to access which causes an exception or the completion of the process. <br><br>  But here's what's strange.  Suddenly it turned out that this guard page can be successfully bypassed, for which there are many ways.  And Delallo talked about this in 2005.  Everybody is patching again, fun and with a song. <br><br>  The principle of operation of this bearded bug is based on increasing the stack size without writing to it.  This is done differently in different operating systems, for example, using a recursive procedure call, or multi-megabyte command line arguments.  The stack pointer moves to its beginning (lower address), the stack grows sharply, and - hop, - the stack pointer is already behind the guard page.  Access to the watch page itself does not occur, there is no error.  It turns out that the stack area overlaps with the dynamic area. <br><br><img src="https://habrastorage.org/web/b08/c9d/8e0/b08c9d8e03d64bd7b375ffe4369c4fb5.png"><br><br>  This allows you to replace the return address from the function in the stack and thus run arbitrary code with elevated permissions. <br><br>  Qualys experienced this technique only locally, but theoretically a similar trick can be cranked remotely, or, at least, it would be useful for Trojans to increase their own privileges.  Researchers see two ways to fix this vulnerability: fantastic and realistic.  Fantastic is to inflate the guard page to at least 1 MB, and preferably more.  A realistic one is just to recompile the whole user-space code with the -fstack-check option in GCC, after which the stack pointer will not be able to jump over the guard page without writing to it.  And in FreeBSD, it is still worth at least including this very guard page - by default it is not involved there. <br><br>  <b>Researcher suggested premature birth WannaCry</b> <br><br>  The fatal for many, the WannaCry Trojan is either made with crooked hands, or broke free before it is completed.  Such an interesting theory was <a href="https://threatpost.com/someone-failed-to-contain-wannacry/126335/">expressed by</a> Jake Williams from Rendition InfoSec, after an in-depth analysis <s>of</s> the EternalBlue and WannaCry code <s>news</s> .  In his opinion, the creators of Ranswary made several "overwhelming mistakes." <br><br>  For a start, bitcoin hardcoding addresses for ransom payments look very strange.  Not only did it allow an adventurous person to snatch a small bit of himself, interrupting the address in the hex editor, it also becomes impossible to control the payment - as Williams rightly remarked, try to figure out who the victims of the transactions that fall into the purse belong to.  And yet, it‚Äôs not so difficult to trace the further fate of money from one address (mixers do not always save), that is, problems with the withdrawal of the amount are provided. <br><br>  It is much more practical to generate your own address for each infection, or at least for several infections, this would immediately remove most of the problems.  Actually, seasoned welders do that.  But not the authors of WannaCry.  In total, there are three versions of the address in the captured samples, and it is likely that only one of them belongs to the original attackers. <br><br>  There, in the piggy bank of blunders, is the famous ‚Äúswitch‚Äù of WannaCry, the domain, upon detection of which the Trojan stops working on the Web.  In itself, this is quite a common practice, but, have mercy, what prevented you from making a slightly more complex check than the status code 200?  In the case of many other bots, the exchange with the management server is encrypted and the Trojan is turned off only on command. <br><br>  With the hypothesis that vonakray is the brainchild of Krivorukov script-kiddies, a number of signs pointing to the North Korean origin of this epidemic do not fit.  The Lazarus group, which is suspected in connection with WannaCry, did not give a reason to accuse it of non-professionalism.  Therefore, Williams offered a different explanation.  In his opinion, the unfinished WannaCry simply accidentally escaped from the test environment and went on to spread uncontrollably. <br><br><img src="https://habrastorage.org/web/c50/2fd/0ca/c502fd0ca26e443085625477a8d822f8.jpg" align="right" width="300">  This is damn similar to the truth, although it is not very clear what prevented the creators in time from pulling the switch, registering the stop domain, while the spread of the Trojan did not have time to assume the nature of the epidemic.  And yet - it will be funny if it turns out that the hardcoded bitcoin address is only a placeholder, and does not correspond to any real wallet.  At least, there have not been any write-offs from famous WannaCry wallets. <br><br>  <b>CIA has been monitoring our routers for years.</b> <br><br>  Wikileaks has <a href="https://threatpost.com/wikileaks-alleges-years-of-cia-d-link-and-linksys-router-hacking-via-cherry-blossom-program/126339/">published</a> details of the CIA's program for monitoring traffic passing through D-Link, Linksys, 3Com and Panet Tec routers.  Poetically named Cherry Blossom, the program includes the creation of special firmware, which are flashed to the routers remotely.  The firmware looks like a real one, but only tears it out of the traffic and sends to its server email addresses, chat names, MAC addresses, VoIP numbers.  And if necessary, it can even redirect traffic ‚Äúwhere necessary‚Äù. <br><br><img src="https://habrastorage.org/web/b5f/4b3/339/b5f4b33396ac47a4aeafc881d375024a.png"><br><br>  The only more or less difficult stage of the operation is the implementation of the firmware on an unsuspecting router.  However, what happens with Mirai is exactly on the shoulder of the brainchild of the CIA - the agency has developed Tomato and Surfside exploits for routers.  They do not work everywhere, and for other cases, the documentation recommends that the firmware be implemented promptly.  That is, infiltrate the supplier company and quietly flash all routers in stock.  Romance spy work as it is.  Still alive in the CIA spirit of the old school! <br><br><img src="https://habrastorage.org/files/1a3/d84/77c/1a3d8477c94641beaa19694292d10b54.png" align="right"><h3>  Antiquities </h3><br>  "Justice" <br><br>  Very dangerous, it infects COM files when it is accessed by DOS 43h, 4Bh, 3Dh, 56h functions.  It is written to the end of files and changes 5 bytes of their beginning (NOP; NOP; JMP Loc_Virus).  COMMAND.COM is infected by the "Lehigh" virus algorithm.  Periodically sends information recorded on the disk to a sector with a different number.  Contains the text "AND JUSTICE FOR ALL".  Intercepts int 13h and int 21h. <br><br>  <i>Quote from the book "Computer viruses in MS-DOS" Eugene Kaspersky.</i>  <i>1992</i>  <i>Page 72.</i> <br><br>  <i><strong>Disclaimer:</strong> This column reflects only the personal opinion of its author.</i>  <i>It may coincide with the position of Kaspersky Lab, or it may not coincide.</i>  <i>Then how lucky.</i> </div><p>Source: <a href="https://habr.com/ru/post/331524/">https://habr.com/ru/post/331524/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../331512/index.html">Administrator's sin or data recovery from knocking HDD Western Digital WD5000AAKX</a></li>
<li><a href="../331514/index.html">How we gathered 1,500 stars on Github, combining time-tested technology and a new interface</a></li>
<li><a href="../331516/index.html">Symfony 4: application structure</a></li>
<li><a href="../331520/index.html">CocoaHeads Russia. Live broadcast</a></li>
<li><a href="../331522/index.html">Zextras implementation results for SaaS provider</a></li>
<li><a href="../331526/index.html">Symfony 4: Testing the symfony Flex plugin</a></li>
<li><a href="../331528/index.html">Making data science portfolio: history through data</a></li>
<li><a href="../331530/index.html">30+ online resources for learning programming in 2017</a></li>
<li><a href="../331532/index.html">Integration of scenario testing in the development of solutions based on the 1C platform</a></li>
<li><a href="../331534/index.html">The source code of the Windows 10 operating system has leaked to the network [small part]</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>