<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>High performance javascript parallax</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 I am Fedor furikuretsu Ananyev, web developer at Hot Dot, and today I will give some simple tips for those who want to make their JS-paralla...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>High performance javascript parallax</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br><br>  I am Fedor furikuretsu Ananyev, web developer at Hot Dot, and today I will give some simple tips for those who want to make their JS-parallax application very, very fast. <br><a name="habracut"></a><br>  <i>The story will be based on the experience gained from creating the main page of our new site <a href="http://hotdot.pro/">hotdot.pro</a> .</i>  <i>This page is divided into several slides, with each slide taking the size of the browser window.</i>  <i>Each slide may or may not have floating parallax layers.</i>  <i>The background of the page also moves according to the laws of the parallax layer.</i> <br><br><h4>  It all starts with JS </h4><br>  The first, obvious problem that I want to solve is scripts. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      - Why do we want to solve it? <br><br>  Scripts are responsible for changing the position of the layer in our parallax model and making changes to the DOM.  There are many layers in a more or less impressive application.  And the logically closer the code in front of your eyes is to the drawing code of one layer, the more times per second it will be called by the browser and the more you will want to increase its speed. <br><br><blockquote>  <i>Example:</i> <i><br></i>  <i>If there are five slides in our parallax, there are on average three layers in each of the slides, and we update the parallax with the minimum acceptable movie frequency of 25 FPS, then your code responsible for rendering one layer will be called</i> <i><br><br></i>  <i><b>5 √ó 3 √ó 25 = 375 times per second.</b></i> </blockquote><br><br>  Such mathematics motivates to keep on account every operation in frequently used code points. <br><br>  The 2D model of the floating layer in the container has been tested for a long time, it is not difficult for a high school student and will be omitted in this article.  What is worth noting, however, is that the rule of thumb applies to the layer: <br><br>  <i>To update the position of the layer, two operations are enough:</i> <i><br></i> <ul><li>  multiplying some constant coefficient inherent in this layer by its displacement within the parent </li><li>  adding the result of the first operation to some constant initial position inherent to this layer. </li></ul><br><br>  - Why is this rule important to us? <br><br>  Because thanks to him, we do not need to construct the position of layer X with each change of the position of the viewer from the width of layer X, the position of layer X in the parent, the position of the viewer and the width of the parent.  Instead of five or more operations, we only need to do the two mentioned above.  It is only necessary to select the coefficient specific to the layer X and the initial displacement at the layer initialization. <br><br>  For your mental state, another rule of thumb applies: <br><br><blockquote>  <i>When you perform two operations instead of five + 375 times per second,</i> <i><br></i>  <i>you feel much better.</i> </blockquote><br><br><h4>  The browser draws faster than your familiar freelancer, but still not fast enough </h4><br>  If we are optimizers who came to the world of development for browsers not so long ago, then the discovery for us will be that the drawing of elements that are even outside the screen still happens. <br><br>  We are accustomed to the classic techniques in 3D engines, we can think that everything outside the screen will somehow be optimized removed from the draw queue.  But it will not be removed. <br><br>  Corollary: <br>  <i>If you have the ability to hide (that is, impose display: none css-rules) at the moment X those elements that do not appear on the screen at the moment X - please, do it in all possible ways.</i> <br><br>  In the case of parallax, the elements are slides, and for our luck, the definition of the property <i>‚Äúis outside the screen‚Äù is</i> rather trivial. <br><br><h4>  Video card </h4><br><ul><li> In <i>webkit</i> and <i>gecko</i> browsers, you get an instant performance boost if you organize the movement of absolutely spaced layers using <code>translate3d</code> instead of left. </li><li>  In Opera, only the two-dimensional version is available - <code>translate</code> .  In my case, the performance gain from its use was questionable. </li><li>  Internet Explorer perfectly does all other browsers when using the classic left to offset layers.  Quite interestingly, in my case, using <code>translate3d</code> reduced its performance. </li></ul><br><br>  We are also well aware that when we switch to the <code>translate</code> we will lose the ability to set the coordinates or offset in percent.  Let us keep in mind that in some cases this restriction is rather painful. <br><br><h4>  Disability </h4><br>  It is very valuable to know that a very small change in the DOM ‚Äî including nodes closer to the leaves than to the root ‚Äî causes a very expensive redrawing of everything and everything on the screen. <br><br>  - What does this mean for me in practice? <br><br>  If, in the process of sliding the user through our page, we leave some harmless little animation to be played in a slide that is far <i>from us</i> and <i>hidden from us</i> , the browser will start the process of rebuilding our page and the subsequent redrawing.  Runs every time the animation takes a step.  And this is when the user scrolls the page, and the processor tries its best to move layers in large quantities quickly.  The frequency of the step, for example, in jQuery is 13 milliseconds.  <a href="http%253A%252F%252Fknowyourmeme.com%252Fmemes%252Fimminent-ned-brace-yourselves-x-is-coming%26sa%3DD%26sntz%3D1%26usg%3DAFQjCNGQej4o1ekwHK04qdb6aQbwADdqiA">Brace yourselves</a> : it will hurt. <br><br>  - Is it possible to change at least something while the user slides on the page? <br><br>  Yes.  You can change the <i>position of</i> elements without large expenses, because such changes will not cause redrawing, but only <i>re-composition of</i> elements.  Recomposition occurs very quickly, does not require redrawing of the layers and can be done entirely on a video card, which definitely represents a benefit for us. <br><br>  Moving the layers, however, our ability to modify the DOM ends up if we monitor performance. <br><br>  <i>Beautiful solution:</i> <br>  Disable all animations while the user moves around the page.  So very expensive for the animation processor will be played only when the user does not move anywhere, and the parallax stays in statics.  When the user moves, the processor will focus only on moving the parallax layers. <br><br><h4>  Statistics </h4><br>  Let's look at Chrome statistics for two versions of our studio page: with optimizations disabled and <i>enabled</i> .  Let's be generous and we will not turn off the optimized JS in the first version, and let us leave to it absolutely small drawing optimizations. <br><br><img src="https://habrastorage.org/storage2/bf1/545/d73/bf1545d73bc9281c7b67ee5da39fb470.png"><br><br><img src="https://habrastorage.org/storage2/8ae/a02/6b3/8aea026b3929b19d5fceea86199904aa.png"><br><br>  The test was brief.  I drove the site from left to right, not in a hurry.  But therefore the test was also very cruel with the <i>second version</i> , because it must constantly hide and show, hide and show slides! <br><br>  What do we see first?  The entire first chart is filled with green.  Very, very much drawing and redrawing every frame.  The huge work for the browser, done on the central processor, and very unpleasant feelings for the user. <br><br>  On the <i>second graph of</i> green at times less.  Much more empty gray rectangles.  Which is on the first chart, but not at all that high.  What do they mean?  The fact that <i>in the second case,</i> on very, very many frames, the browser does its job so quickly that it can do something else most of the time allotted to the frame.  In the first case, the browser barely has time to take a breath. <br><br>  Rare cases of high color columns <i>in the second graph</i> , when the browser spends a lot of time to work, are due to the need to switch the visibility of the slides and are the price we pay for amazing performance when sliding back and forth between two slides. <br><br>  Let's look at the colossal difference in framerate: if the browser rarely gives out more than thirty frames per second <i>on the first chart</i> , then it rarely gives less than thirty frames per second <i>on the second chart</i> . <br><br><hr><br><br>  This is a great result. <br>  Techniques that we considered, demanded a lot of work and thought. <br>  But they literally pulled us out of the swamp of brakes into the realm of productive web applications. <br><br>  I hope that my work will be useful for you in your projects, and thank you for your attention to the development of our studio. <br>  Good luck! </div><p>Source: <a href="https://habr.com/ru/post/175341/">https://habr.com/ru/post/175341/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../175327/index.html">How to quickly find bugs that interfere with the release</a></li>
<li><a href="../175329/index.html">How to find or check e-mail address</a></li>
<li><a href="../175333/index.html">Premium Developer Program for Asha - Nokia Limited Bounty Ride</a></li>
<li><a href="../175335/index.html">IntelliJ IDEA 12.1 with JavaFX 2 support</a></li>
<li><a href="../175339/index.html">box-, cocos- and pizza- 2d</a></li>
<li><a href="../175345/index.html">Synesis and RTI start cooperation in the framework of the project "Safe City"</a></li>
<li><a href="../175347/index.html">PHP web console</a></li>
<li><a href="../175349/index.html">The Future of Search: Interviews with Participants of the European Information Retrieval Conference</a></li>
<li><a href="../175351/index.html">Available for download dotPeek 1.1 EAP</a></li>
<li><a href="../175353/index.html">Mozilla and Samsung create a new generation Servo browser engine</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>