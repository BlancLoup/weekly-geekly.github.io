<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Raspberry Pi. Video transmission for remote control</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Video transmission for remote control can be used in many projects related to the management of various devices. That is, it can be screwed to the whe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Raspberry Pi. Video transmission for remote control</h1><div class="post__text post__text-html js-mediator-article">  Video transmission for remote control can be used in many projects related to the management of various devices.  That is, it can be screwed to the wheelbase, to the quadcopter, to the body of a humanoid robot, and so on.  Raspberry Pi (hereinafter raspberry) in this sense is convenient because it allows you to use for this not some kind of specialized devices like FPV, but the usual devices that many already have, and also simplifies the schemes of their inclusion and the complexity of writing programs for them, not to mention the cost of projects. <br><br><img src="https://habrastorage.org/storage2/497/a45/3dc/497a453dc9484f999869487912d5ac80.jpg"><br><br><a name="habracut"></a><br><h5>  Remote control </h5><br>  I recently got raspberries, in St. Petersburg they are already selling them in stores, so neither wait nor order is necessary, although it turns out a bit more expensive.  Since I don‚Äôt have a monitor with HDMI, but I do have a router, remote controle via ssh port was chosen as the control option.  This allows you to control raspberries from any computer included in the local network (as an option, but more complex - global). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Note.  On a computer from which I run raspberries, it is worth Ubuntu.  Although for Windows all this also remains valid. <br><br>  Making the connection is easy.  In a Debian image downloaded from an offsite, this feature is enabled by default.  And the only thing that remains is to find out the ip address and enter the connection command.  In order to find out the address, you can either enter the settings of the router (usually ip 192.168.0.1), or enter the command in the console <br> <code>$ nmap -p 22 --open -sV 192.168.0.1/24</code> <br>  which will give a bunch of text, among which are the addresses of devices connected to the network and the status of their SSH port. <br>  Next to open remote access <br> <code>$ ssh -p 22 pi@192.168.0.17</code> <br>  where pi is the name of the account, and after @ is the address of the raspberry. <br><br>  Then they will ask you to enter a password, and if it is correct, the console will begin to communicate with you on behalf of raspberries. <br> <a href="http://www.radikal.ru/"><img src="https://habrastorage.org/getpro/habr/post_images/38e/8cc/97b/38e8cc97b309182b5b2faed45c88bc64.jpg"></a> <br><br>  More information about setting up remote access can be found at <br>  <a href="http://www.penguintutor.com/linux/raspberrypi-headless">http://www.penguintutor.com/linux/raspberrypi-headless</a> <br>  <a href="http://www.penguintutor.com/linux/tightvnc">http://www.penguintutor.com/linux/tightvnc</a> <br><br>  The second link describes how to access the GUI remotely.  It looks interesting - on the screen of your monitor you see the raspberry desktop.  But due to the fact that the signal is on the grid, there is a delay and the mouse and other control comes with a delay.  So do not play the pre-installed "snake" there. <br><br>  How imho, raspberries as a desktop to use and there is no sense, all its advantages are lost.  It is unlikely that someone has such a small room that there is no place to put a system unit next to the monitor, there is enough voltage in the outlet just to charge a cell phone, or not enough money even for a used personal computer.  On the contrary, the minuses become obvious - low productivity relative to desktop computers and an unfriendly operating system. <br><br><h5>  Webcam connection and image transfer </h5><br>  Used camera Logitech c270 got no problems.  However, further disappointment awaited as the hardware accelerated video encoding stated on raspberry was missing.  That is, it is, but codecs are missing for it.  And without it, programmatically, compression comes with a speed of 2-5 fps and gives 100% load on the machine.  As a result, only the raw stream goes without hanging the system.  That is, for recording (according to estimates) with a resolution of 640x480 100-200 mb will go away for one minute.  But the bandwidth of the local network and wi-fi is enough so that for the time being it is possible and so to drive it, hoping that in the near future the codecs will still appear.  So go ahead. <br><br>  Long experiments and search for the desired spells will not describe.  In the end, it all came down to using gstreamer.  In short, this is a multimedia framework with a command line interface.  There is also a library that allows you to programmatically use its components, which can be used later for integration into your own programs. <br><br>  To install it on raspberries, you must enter <br> <code>$sudo apt-get install gstreamer0.10-plugins-base gstreamer0.10-plugins-good gstreamer0.10-plugins-ugly gstreamer0.10-tools</code> <br> <br>  (if they are not there, maybe the version number has changed or something else, then it is convenient to use the ‚Äú <code>$apt-cache search gstreamer</code> ‚Äù command and install something with similar names) <br><br>  Next on raspberry is introduced <br> <code>$sudo gst-launch-0.10 v4l2src device=/dev/video0 ! 'video/x-raw-yuv,width=640,height=480, framerate=20/1'! ffmpegcolorspace ! rtpvrawpay ! udpsink host=192.168.0.50 port=4000 sync=false</code> <br> <br>  Where <br>  device = / dev / video0 - image source <br>  'video / x-raw-yuv, width = 640, height = 480, framerate = 20/1' - format <br>  udpsink host = 192.168.0.50 port = 4000 sync = false - the address where we send <br><br>  The video is transmitted via the rtp protocol.  This protocol works at the transport level and is used when transmitting real-time traffic.  It can use both TCP and UDP, but since TCP repeats not reaching messages that are no longer needed, UDP is used in this case. <br>  On the receiver side, enter <br> <code>$ gst-launch udpsrc caps="application/x-rtp, media=(string)video, clock-rate=(int)90000, encoding-name=(string)RAW, sampling=(string)YCbCr-4:2:0, depth=(string)8, width=(string)640, height=(string)480, ssrc=(uint)1825678493, payload=(int)96, clock-base=(uint)4068866987, seqnum-base=(uint)24582" port=4000 ! queue ! rtpvrawdepay ! queue ! ffmpegcolorspace ! autovideosink</code> <br> <br>  As a result, a picture will appear on the receiver side. <br><img src="https://habrastorage.org/storage2/497/a45/3dc/497a453dc9484f999869487912d5ac80.jpg"><br>  For lovers of recursion: this screenshot of the desktop netbook, which takes a picture of the raspberry, which takes it from the webcam, which is aimed at the raspberry lying on the netbook on the screen that ... <br><br>  The image obtained in this way is identical in quality to that obtained directly without a network from a web camera, since no compression or transformation was applied. <br>  The following screenshot shows the channel loading, on the left when transferring a 640x480 image, then a pause and 320x240. <br><img src="https://habrastorage.org/storage2/482/bd2/8ff/482bd28ff5d91de63b54eac784d62919.png"><br>  However, since the picture does not go directly, but through the network, a signal delay appears.  Then a series of simple experiments was carried out, which can be used to estimate the signal delay. <br><img src="https://habrastorage.org/storage2/202/efd/081/202efd0815d942dec9be4d321644f231.jpg"><br><img src="https://habrastorage.org/storage2/33b/866/351/33b866351f2b9f2ae981c8615d19695a.jpg"><br><br>  For the configuration of raspberry-&gt; LAN cable-&gt; router Dlink-300-&gt; wi-fi-&gt; netbook delay amounted to <br>  for 640x480 resolution 0.5 seconds <br>  for 320x240 resolution 0.2 seconds <br><br>  Much or little depends on the purpose of use.  For direct control of a quadcopter (without additional stabilization) or other systems that experience some kind of disturbance that takes them out of balance, this is a lot.  Nevertheless, many things with such a delay can be controlled, as an example - moon rovers, which were controlled at all with a 2-minute delay. <br><br>  <strong>UPD 09.10.2012</strong> <br>  In the comments to this post, it was suggested to use the hardware compression built into the camera itself and transfer the picture in the mjpeg format. <br>  After some searching for the desired spells, the command on the raspberry looks <br> <code>gst-launch-0.10 v4l2src device=/dev/video0 ! 'image/jpeg,width=320,height=240, framerate=10/1' ! rtpjpegpay ! udpsink host=192.168.0.50 port=4000 sync=false</code> <br> <br>  But on the computer that accepts the picture <br> <code>gst-launch udpsrc caps="application/x-rtp, media=(string)video, clock-rate=(int)90000, encoding-name=(string)JPEG, ssrc=(guint)469657143, payload=(int)96, clock-base=(guint)2841649723, seqnum-base=(guint)39869" port=4000 ! rtpjpegdepay ! jpegdec ! autovideosink</code> <br> <br>  As a result, at a resolution of 640x480, the traffic was about 300-800 kbytes / sec, and the delay was 0.2-0.3 seconds. <br><br><h5>  Connecting wi-fi adapter </h5><br>  TP-Link Adapter WN722N.  In general, the installation of the adapter is not difficult, the process is well described here <br>  <a href="http://elinux.org/RPi_Peripherals">http://elinux.org/RPi_Peripherals</a> <br>  with a few exceptions an exception that would find which took some time.  The password must be entered in an already encrypted form.  Thank ubuntu <br>  <a href="http://help.ubuntu.ru/wiki/%25D0%25BD%25D0%25B0%25D1%2581%25D1%2582%25D1%2580%25D0%25BE%25D0%25B9%25D0%25BA%25D0%25B0_%25D1%2581%25D0%25B5%25D1%2582%25D0%25B8_%25D0%25B2%25D1%2580%25D1%2583%25D1%2587%25D0%25BD%25D1%2583%25D1%258E">http://help.ubuntu.ru/wiki/setting_network_manually</a> <br>  To do this, enter <br> <code>$ wpa_passphrase &lt;__&gt; &lt;ascii_&gt;</code> <br> <br>  As a result, after all the clarifications, the / etc / network / interfaces file for me now looks like this.  These settings are correct wpa-psk, if you use wpa2 then the settings will be different, the description of which can be found in the link to Ubuntu. <br>  auto lo <br><br>  iface lo inet loopback <br>  iface eth0 inet dhcp <br><br>  # The wireless interface <br>  iface wlan0 inet static <br><br>  address 192.168.0.40 <br>  gateway 192.168.0.1 <br>  netmask 255.255.255.0 <br>  wpa-ap-scan 1 <br>  wpa-proto WPA <br>  wpa-pairwise TKIP <br>  wpa-group TKIP <br>  wpa-key-mgmt WPA-PSK <br>  wpa-ssid name <br>  wpa-psk 7d7cf754caCensuref04b1b0ef6f15e21ed1292168950d20 <br>  wpa-driver wext <br><br>  auto wlan0 <br><br>  After setting up the wireless connection on the side of the computer, you need to change the ip address and the communication will be the same as with a wired connection. <br><br>  Further tests were performed on the delay time for the configuration: <br>  raspberry-&gt; adapter-&gt; wi-fi-&gt; router Dlink-300-&gt; wi-fi-&gt; netbook <br>  (as well as for raspberry-&gt; adapter-&gt; wi-fi-&gt; router Dlink-300-&gt; LAN cable-&gt; netbook) <br>  for 640x480 resolution 0.8 seconds <br>  for resolution 320x240 0.2-0.3 seconds <br><br>  By the fact that the delay time has increased, you can make the assumption that either the adapter, or your connection, or the driver introduce delays, which are not present when connecting via LAN.  So where the dimensions allow, instead of the adapter, connect the raspberry via the LAN to the router. <br><br><h4>  Lipo </h4><br>  As an appendage, that would untie the system from the mains assembled converter for connecting to a LiPo battery.  The fact is that raspberries are powered from 5V plus or minus 25%, so that batteries with different voltages cannot be directly connected, but this can be corrected with a small device. <br>  His scheme is very simple and I found it here. <br>  <a href="http://spydamonky.hackhut.com/2012/07/05/lipo-raspberry-pi-power-adapter/">http://spydamonky.hackhut.com/2012/07/05/lipo-raspberry-pi-power-adapter/</a> <br>  I found the details of the circuit in the nearest specialty store, and the microUSB plug in the computer store bought the cheapest cable and cut it out. <br><img src="https://habrastorage.org/storage2/ad4/6a8/9c0/ad46a89c0cc362080b16b98bf898164f.jpg"><br>  In the first embodiment, as in the diagram, there was one voltage regulator, but it was very hot, because the maximum current was 1A there, and a minimum of 700mA passed through it, I decided to put a second one in parallel, which should double the maximum current.  However, it is still very hot.  Apparently it will be necessary to fasten some kind of radiator. <br>  In general, it is better not to use LIPo batteries for such purposes as in the case of discharge below an acceptable level they irreversibly fail, and this point is not caught here either.  That is, the device works, works, and when the battery ceases has died.  If there is another type of battery on hand, then it is better to use them. <br><br><img src="https://habrastorage.org/storage2/40a/702/b0f/40a702b0f37369a72e391b0c2d72de7a.jpg"><br>  P.S. <br>  Further, as a goal, put it all on some kind of platform and use it further. </div><p>Source: <a href="https://habr.com/ru/post/153611/">https://habr.com/ru/post/153611/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../153599/index.html">Art & Fear, or how to survive a creative person in the modern world</a></li>
<li><a href="../153601/index.html">Cliff Bleszinski leaves Epic Games</a></li>
<li><a href="../153603/index.html">Blender new release released</a></li>
<li><a href="../153605/index.html">"And it all went!" Or again about Coursera and others like him</a></li>
<li><a href="../153609/index.html">The development of the right hemisphere of the brain or how I learned to draw</a></li>
<li><a href="../153613/index.html">Seven more HTML5 features you might not know about</a></li>
<li><a href="../153615/index.html">Nokia Plan B (take 2)?</a></li>
<li><a href="../153617/index.html">Optical character recognition in Linux</a></li>
<li><a href="../153619/index.html">MiniSCADA do it yourself</a></li>
<li><a href="../153625/index.html">Configuring Cisco ACS 5.3 in conjunction with Active Directory</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>