<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Unity3d: Experiments with the Social Interface</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A modern mobile game is difficult to imagine without social integration, common leaderboards and achievements (achievements). In order to keep up with...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Unity3d: Experiments with the Social Interface</h1><div class="post__text post__text-html js-mediator-article">  A modern mobile game is difficult to imagine without social integration, common leaderboards and achievements (achievements).  In order to keep up with the trends, I decided to integrate Game Center and Play Services for iOS and Android versions of my game. <br><br>  Since I am developing a game in my spare time as a hobby, then thoughts about buying plug-ins, for example, prime31, were dropped immediately.  The choice fell on the interface Social, which is part of Unity.  The intrigue is felt around this package: the practical lack of reference information leads to two thoughts: either the interface is very simple, or not suitable for use.  So, it's time to figure it out. <br><a name="habracut"></a><br>  First of all, it turned out that this interface has an implementation only for iOS, and for Android it is, in fact, a pure interface. <br><br>  The reluctance to buy plugins and the desire to add a table of records led me here: <a href="https://github.com/playgameservices/play-games-plugin-for-unity">https://github.com/playgameservices/play-games-plugin-for-unity</a> .  This is a free Android plugin from Google that fills the Social interface with a vibrant implementation and keeps the wallet's thickness at the same level.  The plugin has a frightening version of 0.9, but this does not affect its performance, but there is no part of the functional, which will be discussed further. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Determined and faith in success, I began to prepare projects in iTunes Connect and Google Developer Console - at this stage there are no problems, both platforms have almost identical settings of the tables of records and achievements, and an abundance of background information does not go astray. <br><br>  There are a couple of points worth paying attention to: <br><br>  Google Developer Console generates IDs of achievements and leaderboards itself, and in iTunes Connect they need to be set independently, therefore for greater compatibility of the future code it is convenient to start from Google, and then customize the project under iOS in the same way, copying the same identifiers. <br><br>  When working with Play Services in the Google Developer Console, as well as adding alpha / beta versions of the game, Google strongly suggests making ‚Äúpublishing‚Äù achievements and leaderboards - you shouldn‚Äôt agree to this until the release itself, because  after ‚Äúpublishing‚Äù you lose the ability to delete achievements and high score tables, as well as edit such important parameters as the number of steps necessary to perform iterative achievements. <br><br>  I created High Scores leaderboards and a minimal set of achievements (for Google, these are five positions), so even if you are not going to use them, you have to squeeze something out of yourself.  Apple has no such limit, but once the achievements have been created - there is nothing difficult to copy them. <br><br>  Next, install the plugin for Android.  In the Unity menu, select the Assets / Import Package / Custom Package and deploy the plugin to your project.  After the successful import, the Google Play Games item appears in the menu, select the Android Setup sub-item ..., enter the application ID, which can be found in the Game Services section of the Google Developer Console and we get a plug-in ready for use. <br><br>  Now everything is ready to write a couple of lines of code (C #) in Unity.  First of all, you need to make preliminary settings for iOS and Android, as well as log in: <br><br><pre><code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> UNITY_ANDROID //   Google Play Games,     Android, //    Social    GooglePlayGames.PlayGamesPlatform.Activate(); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> UNITY_IPHONE //       iOS   ,             UnityEngine.SocialPlatforms.GameCenter.GameCenterPlatform.ShowDefaultAchievementCompletionBanner(true); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> Social.localUser.Authenticate(onProcessAuthentication); //  ,    //    , Social.localUser     private void onProcessAuthentication(bool success) { Debug.Log("onProcessAuthentication: " + success); }</span></span></code> </pre> <br>  After successful authorization, we can work with leaderboards and achievements. <br><br>  When working with leaderboards, I decided that I first need to get the current player record - this is necessary so that you can compare the old record with the new one and if the player reaches the new top, display the message ‚ÄúCongratulations!  New Top: XXX.  To do this, I wrote the following code, which creates a table, sets a filter for players for which we need data (only our player), and gets the current player record in case of success: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] userIds = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] { Social.localUser.id }; highScoresBoard = Social.CreateLeaderboard(); highScoresBoard.id = <span class="hljs-string"><span class="hljs-string">"LEADERBOARD_ID"</span></span>; highScoresBoard.SetUserFilter(userIds); highScoresBoard.LoadScores(onLeaderboardLoadComplete); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onLeaderboardLoadComplete</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> success</span></span></span><span class="hljs-function">)</span></span> { Debug.Log(<span class="hljs-string"><span class="hljs-string">"onLeaderboardLoadComplete: "</span></span> + success); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (success) { <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> score = highScoresBoard.localUserScore.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre><br>  Sending the current progress is as follows (and we don‚Äôt necessarily care that the new result may be less than the old one - in this case, the data will be discarded by the server): <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reportScore</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> score</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Social.localUser.authenticated) { Social.ReportScore(score, <span class="hljs-string"><span class="hljs-string">"LEADERBOARD_ID"</span></span>, onReportScore); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReportScore</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> result</span></span></span><span class="hljs-function">)</span></span> { Debug.Log(<span class="hljs-string"><span class="hljs-string">"onReportScore: "</span></span> + success); }</code> </pre><br>  After testing this code, there was a problem - it does not work under Android, because  In the plugin there is no implementation of this function - here it is, the beauty of version 0.9. <br><br>  But this is not a reason for frustration, having thought it over, I came to the conclusion that there is no need to get the current player record, it is enough to store it locally.  The fact is that if a player changes the device, or simply deletes your game and returns to it after some time, it will be more pleasant for him to beat his own local record again and again.  The record in the leaderboards will always contain the maximum progress of the player, and to beat him the player can take a long time, which ultimately can reduce the player's motivation.  So I decided to abandon the global record, and added the following code to authorization: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> highScore = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onProcessAuthentication</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> success</span></span></span><span class="hljs-function">)</span></span> { Debug.Log(<span class="hljs-string"><span class="hljs-string">"onProcessAuthentication: "</span></span> + success); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (success) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (PlayerPrefs.HasKey(<span class="hljs-string"><span class="hljs-string">"high_score"</span></span>)) highScore = (<span class="hljs-keyword"><span class="hljs-keyword">long</span></span>)PlayerPrefs.GetInt(<span class="hljs-string"><span class="hljs-string">"high_score"</span></span>); } }</code> </pre><br>  Sending progress to the server took the form: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reportScore</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> score</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Social.localUser.authenticated) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (score &gt; highScore) { highScore = score; PlayerPrefs.SetInt(<span class="hljs-string"><span class="hljs-string">"high_score"</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)score); Social.ReportScore(score, <span class="hljs-string"><span class="hljs-string">"LEADERBOARD_ID"</span></span>, onReportScore); } } }</code> </pre><br>  Thus, we memorize the local record of the player, which can then be used to test the achievement of a new record. <br><br>  It remains to display the standard leaderboard dialog, which can be done using the Social.ShowLeaderboardUI () function.  By default, Android displays a list of all leaderboards, even if you have one (the ‚ÄúHigh Scores‚Äù table), this is not very nice and requires too much choice from the player, so I had to add this code: <br><br><pre> <code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> UNITY_ANDROID (Social.Active as GooglePlayGames.PlayGamesPlatform).SetDefaultLeaderboardForUI("LEADERBOARD_ID"); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> Social.ShowLeaderboardUI();</span></span></code> </pre><br>  Having dealt with the record tables and satisfied with the result, I started to implement the achievements, and then a big and unpleasant surprise awaited me, but let's take it in order. <br><br>  Achievements are of two types: ‚Äúone-way‚Äù (achievement) and incremental (incremental achievement).  The first ones imply achievement from one time, for example, ‚Äúlaunch a rocket‚Äù - as soon as a player finds and launches one rocket, we consider that the achievement is 100% complete and open to the player.  Incremental achievements mean step-by-step execution in several stages, for example, the achievement ‚ÄúCherry Hunter‚Äù implies collecting 15 cherries, in the process of which the player will gradually open the achievement, and after collecting all 15 cherries he will receive it completely.  Such achievements seemed to me more relevant in my game;  For starters, I added 5 achievements: <br><br><img src="https://habrastorage.org/files/098/37e/b21/09837eb21f32471680da4981abc361aa.jpg"><br><br>  Starting the implementation of incremental achievements, I encountered two problems: <br>  - Difference in interaction with Android and iOS servers; <br>  - It is necessary to keep the current progress to achieve in order to send an increased value each time, otherwise the achievement will not grow. <br><br>  The difference in the interaction is that Google Play calculates the percentage increment of achievement itself, specifying the number of steps in the Google Developer Console 15, we can send the value 1 to the server each time, and the server logic will add units until it is typed 15 and the achievement will not be open. <br><br>  Apple Game Center shifts the concern for incrementing progress to customer logic, and expects us to gradually increase progress from 0 to 100 units (percent).  Therefore, if we send him 1 constantly, progress will always be 1%. <br><br>  So, in the case of iOS, we need to get the current progress of achievements and save it so that we can send an increased value in the future.  And also we need to store on the client the number of steps (iterations) in order to send the correct increment of progress.  For these purposes, I created a helper class: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AchievementData</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> id; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> steps; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AchievementData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> steps</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.id = id; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.steps = steps; } }</code> </pre><br>  And I prepared the data on my achievements (in fact, this is a copy of the data that I entered in the Google Developer Console for Android): <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//     -    -    public static readonly AchievementData cherryHunter = new AchievementData("ACHIEVEMENT_ID", 15); public static readonly AchievementData bananaHunter = new AchievementData("ACHIEVEMENT_ID", 25); public static readonly AchievementData strawberryHunter = new AchievementData("ACHIEVEMENT_ID", 50); public static readonly AchievementData rocketRider = new AchievementData("ACHIEVEMENT_ID", 15); public static readonly AchievementData climberHero = new AchievementData("ACHIEVEMENT_ID", 250); //     private readonly AchievementData[] _achievements = { cherryHunter, bananaHunter, strawberryHunter, rocketRider, climberHero }; //   ,       private Dictionary&lt;string, IAchievement&gt; _achievementDict = new Dictionary&lt;string, IAchievement&gt;();      iOS: if (Application.platform == RuntimePlatform.IPhonePlayer) { Social.LoadAchievements(onAchievementsLoadComplete); } private void onAchievementsLoadComplete(IAchievement[] achievements) { //    ,        foreach (IAchievement achievement in achievements) { _achievementDict.Add(achievement.id, achievement); } //   ,        for (int i = 0; i &lt; _achievements.Length; i++) { AchievementData achievementData = _achievements[i]; if (_achievementDict.ContainsKey(achievementData.id) == false) { IAchievement achievement = Social.CreateAchievement(); achievement.id = achievementData.id; _achievementDict.Add(achievement.id, achievement); } } }</span></span></code> </pre><br>  It is important to note that while there is no progress on achievements, an empty list will arrive - this is not a bug, in this array only achievements on which the player already has progress greater than 0 come, therefore after receiving the list of available achievements, we fill in the gaps on the remaining achievements (with progress 0), to continue to work with all the achievements on the same principle. <br><br>  Dispatching progress to achieve different for both platforms: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reportProgress</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Social.localUser.authenticated) { <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> UNITY_ANDROID (Social.Active as GooglePlayGames.PlayGamesPlatform).IncrementAchievement(id, 1, onReportProgressComplete); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">elif</span></span></span><span class="hljs-meta"> UNITY_IPHONE IAchievement achievement = getAchievement(id); //     0 - 100 achievement.percentCompleted += 100.0 / getAchievementData(id).steps; achievement.ReportProgress(onReportProgressComplete); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> } }</span></span></code> </pre><br>  It uses two auxiliary functions: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//         public IAchievement getAchievement(string id) { return _achievementDict[id]; } //      ,        iOS        (   ) public AchievementData getAchievementData(string id) { for (int i = 0; i &lt; _achievements.Length; i++) { AchievementData achievementData = _achievements[i]; if (achievementData.id == id) return achievementData; } return null; }</span></span></code> </pre><br>  To display the standard achievement dialog, use the function: <br><br><pre> <code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> UNITY_ANDROID || UNITY_IPHONE Social.ShowAchievementsUI(); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span></code> </pre> <br>  An auxiliary function that may come in handy when testing achievements for iOS returns the entire list of achievements (received from the server + created on the client): <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> result = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (KeyValuePair&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, IAchievement&gt; pair <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _achievementDict) { IAchievement achievement = pair.Value; result += achievement.id + <span class="hljs-string"><span class="hljs-string">" "</span></span> + achievement.percentCompleted + <span class="hljs-string"><span class="hljs-string">" "</span></span> + achievement.completed + <span class="hljs-string"><span class="hljs-string">" "</span></span> + achievement.lastReportedDate + <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre><br>  To summarize, work with achievements for Android is easier.  In the case of iOS, you need the most control on the client side.  This is only one plus - more flexibility for iOS, for which you have to pay time costs. <br><br>  Since I had to use a third-party plugin for Android, I began to check the written logic from it.  After making sure that everything works, I decided to quickly check the logic on the iPad and prepare releases for the game.  And here I was waiting for the very unpleasant surprise that came up when you least expected it: the function of sending progress for iOS constantly returned false and the mysterious string: <br><br>  <i>Looking for "ACHIEVEMENT_ID", cache count is 1.</i> <br><br>  After reading the forums and having a lot of experimentation, I realized that the achievements under iOS do not shine for me, and that this is some kind of Unity or Game Center bug.  The next morning, being in a very nasty mood, I launched the game on an iPad and was surprised to find that achievements are being correctly processed.  In the evening, the situation repeated again.  Upon reflection, I came to the conclusion that the problem may be related to this: sandbox transactions have a much lower priority than games in the store, so during the "rush hour", when it is day in America, almost no progress on achievement is performed, but if try to update the progress of achievement, when it is deep night in America, and the Apple servers ‚Äúrest‚Äù in the cool night of California night, almost all the achievements are processed.  And the message ‚ÄúLooking for‚Äû ACHIEVEMENT_ID ‚Äú, cache count is 1.‚Äù means that it is not possible to send progress at this time, and Unity caches progress towards reaching it locally.  This progress will not be lost, and will go to the server when it is possible to communicate with it. <br><br>  This theory is opposed by the fact that developers using the prime31 plugin for these purposes do not experience such "delays", and that the most likely problem is in Unity.  I decided to take a chance and give out the game with achievements in such a ‚Äúhanging‚Äù consisted to test my theory. <br><br>  After a week and a half of waiting, the game appeared in the store.  Having tested leaderboards and achievements, I found that in production they work as mysteriously as in the sandbox.  It seems that Unity caches progress on achievements to some kind of ‚Äúcritical mass‚Äù, and then synchronizes them at one moment.  This result is not satisfactory. <br><br>  To sum up: to integrate achievements and leaderboards in Unity, you can't do without your own or third-party plug-in, but integration takes some time, the lion's part of which goes to ‚Äúfighting windmills‚Äù and is not as simple as we would like. </div><p>Source: <a href="https://habr.com/ru/post/256951/">https://habr.com/ru/post/256951/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../256939/index.html">IBM introduced the hybrid chip: silicon photonics in action</a></li>
<li><a href="../256941/index.html">Pattern matching, changes and movements in Rust</a></li>
<li><a href="../256943/index.html">Rake on building a hybrid cloud with Azure</a></li>
<li><a href="../256945/index.html">FlyElephant is a creative laboratory for scientists and engineers. Part 1. The history of creation</a></li>
<li><a href="../256947/index.html">SwipeRefreshLayout: not spherical and not in vacuum</a></li>
<li><a href="../256955/index.html">Microsoft Research for young scientists - communication and the opportunity to discuss their work with leading scientists from Microsoft</a></li>
<li><a href="../256959/index.html">So why implement ERP systems?</a></li>
<li><a href="../256961/index.html">How Virtuozzo Improves Docker Security for Service Providers</a></li>
<li><a href="../256963/index.html">Frameworks spoil development</a></li>
<li><a href="../256965/index.html">What is Virtual DOM?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>