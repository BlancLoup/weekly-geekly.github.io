<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Zend_Db_Table ease of use</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Few people use this amazing class at full capacity. About some of its hidden features as few people guessed, as I did until that moment. 

 As you kno...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Zend_Db_Table ease of use</h1><div class="post__text post__text-html js-mediator-article">  Few people use this amazing class at full capacity.  About some of its hidden features as few people guessed, as I did until that moment. <br><a name="habracut"></a><br>  As you know, tables in relational databases are linked by one-to-many and many-to-many relationships.  Maybe someone will offer another couple of links, but this article is not to discuss this, but to prompt and direct the thought in the direction we need.  I will look at the one-to-many relationship in the implementation, you guessed it, of Zend Framework. <br><br>  As you know, the Zend_Db_Table class is an object-oriented interface to database tables.  The first useful discovery was that Zend_Db_Table is capable of cascading deletion and cascading update of link records, for which it is necessary, and so that when deleting / updating a reference value, records in dependent tables are deleted / updated.  For example, we will use the MySQL database with the MyISAM storage engine, which does not support declarative referential integrity. <br><br>  Now a small digression.  For example, we need a small database consisting of the following tables: Products, Units and Groups.  It will be about food products (Products), units of measure (Units) and product groups (Groups). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Below are SQL queries for creating and populating tables: <br><pre> # table of units of products
 DROP TABLE IF EXISTS `units`;
 CREATE TABLE `units` (
   `unit_id` INT (10) UNSIGNED NOT NULL AUTO_INCREMENT,
   `unit_name` VARCHAR (256) NOT NULL DEFAULT '',
   PRIMARY KEY (`unit_id`)
 ) ENGINE = MYISAM AUTO_INCREMENT = 1 DEFAULT CHARSET = utf8;

 INSERT INTO `units` SET` unit_name` = 'gram';
 INSERT INTO `units` SET` unit_name` = 'milliliter';

 # product groups table
 DROP TABLE IF EXISTS `groups`;
 CREATE TABLE `groups` (
   `group_id` INT (10) UNSIGNED NOT NULL AUTO_INCREMENT,
   `group_name` VARCHAR (256) NOT NULL DEFAULT '',
   PRIMARY KEY (`group_id`)
 ) ENGINE = MYISAM AUTO_INCREMENT = 1 DEFAULT CHARSET = utf8;

 INSERT INTO `groups` SET` group_name` = 'Vegetables';
 INSERT INTO `groups` SET` group_name` = 'Fruits';
 INSERT INTO `groups` SET` group_name` = 'Dairy';
 INSERT INTO `groups` SET` group_name` = 'Meat';

 # product table
 DROP TABLE IF EXISTS `products`;
 CREATE TABLE `products` (
   `product_id` INT (10) UNSIGNED NOT NULL AUTO_INCREMENT,
   `group_id` INT (10) DEFAULT NULL,
   `unit_id` INT (10) DEFAULT NULL,
   `product_name` VARCHAR (256) NOT NULL DEFAULT ',
   PRIMARY KEY (`product_id`)
 ) ENGINE = MYISAM DEFAULT CHARSET = utf8;

 # Vegetables
 INSERT INTO `products` (` group_id`, `unit_id`,` product_name`) VALUES (1, 1, 'Potatoes');
 INSERT INTO `products` (` group_id`, `unit_id`,` product_name`) VALUES (1, 1, 'Tomato');
 # Fruits
 INSERT INTO `products` (` group_id`, `unit_id`,` product_name`) VALUES (2, 1, 'Apricot');
 INSERT INTO `products` (` group_id`, `unit_id`,` product_name`) VALUES (2, 1, 'Apple');
 # Dairy
 INSERT INTO `products` (` group_id`, `unit_id`,` product_name`) VALUES (3, 1, 'Cheese');
 INSERT INTO `products` (` group_id`, `unit_id`,` product_name`) VALUES (3, 2, 'Milk');
 # Meat
 INSERT INTO `products` (` group_id`, `unit_id`,` product_name`) VALUES (4, 1, 'Veal');
 INSERT INTO `products` (` group_id`, `unit_id`,` product_name`) VALUES (4, 1, 'Pork');
</pre><br>  Now that the tables have been created and filled with test data, we proceed to the creation of classes for our tables: <br><br><pre> class Products extends Zend_Db_Table_Abstract
 {
     protected $ _name = 'products';
     protected $ _primary = array ('product_id');
 }
        
 class Units extends Zend_Db_Table_Abstract
 {
     protected $ _name = 'units';
     protected $ _primary = array ('unit_id');
 }
 
 class Groups extends Zend_Db_Table_Abstract
 {
     protected $ _name = 'groups';
     protected $ _primary = array ('group_id');
 }
</pre><br>  For simplicity, I put these classes in the controller, for real projects I don‚Äôt recommend this.  Get data in the product table as follows: <br><br><pre> $ productsTable = new Products;
 $ productsRowset = $ productsTable-&gt; fetchAll ();
 foreach ($ productsRowset as $ row) {
     echo '&lt;pre&gt;'.  print_r ($ row-&gt; toArray (), true).  '&lt;/ pre&gt;'.  PHP_EOL;
 }
</pre><br>  As you can see, the fetchAll method returns us a rowset (rowset), where each $ row corresponds to a row from our table.  If you add the following code in foreach, then it can change a specific entry: <br><br><pre> if ($ row-&gt; product_name == 'Pork') {
     $ row-&gt; product_name = 'Pork Kebab';
     $ row-&gt; save ();
 }
</pre><br>  The save method from the abstract class Zend_Db_Table_Row_Abstract is applicable to our row row row, since foreach parses our rowset, which is an instance of the Zend_Db_Table_Rowset class inherited from Zend_Db_Table_Row_Abstract into separate $ row.  $ Row themselves are nothing but instances of the Zend_Db_Table_Row class.  Manipulations with instances of the Zend_Db_Table_Row class do not require deep knowledge, so we will not dwell on them, but talk about the following. <br><br>  Suppose you do not like the order of the primary keys in the groups table and you want them to start, for example, with 100, not a problem, but how many actions do you need to take to implement it?  Head starts to spin.  Look at the products table, in it we have provided an external link to the groups table, key group_id.  And after our changes, products must fit their groups.  Perhaps this is not the example that you would like to see and he does not pretend to be standing ovations, but he is able to show how the mechanism of interaction between the Zend Framework‚Äôs Zend_Db_Table classes is implemented. <br>  So let's get started.  In the object model for parent tables, you must specify dependent tables.  In the Groups class, you must specify the dependent class Products by adding the following property <br><br><pre> protected $ _dependentTables = array ('Products');
</pre><br>  this also needs to be done in the Units class.  These tell us that the records in the dependent tables will be taken into account when the parent changes.  But for this we need in the Products class to add links to the Units and Groups tables.  You can implement this in several ways, for example, to add the $ _referenceMap property to the Products class: <br><br><pre> protected $ _referenceMap = array (
     'refUnits' =&gt; array (
         self :: COLUMNS =&gt; 'unit_id',
         self :: REF_TABLE_CLASS =&gt; 'Units',
         self :: REF_COLUMNS =&gt; 'unit_id',
         self :: ON_DELETE =&gt; self :: CASCADE,
         self :: ON_UPDATE =&gt; self :: CASCADE
     ),
     'refGroups' =&gt; array (
         self :: COLUMNS =&gt; 'group_id',
         self :: REF_TABLE_CLASS =&gt; 'Groups',
         self :: REF_COLUMNS =&gt; 'group_id',
         self :: ON_DELETE =&gt; self :: CASCADE,
         self :: ON_UPDATE =&gt; self :: CASCADE
     )
 );
</pre><br>  The $ _referenceMap property allows you to add a link to an external table, so we get a many link to one.  It is necessary to define the following parameters <br><br>  1. associative key <br>  2. the name of the foreign key field in the referring table <br>  3. class name of the table to which we refer <br>  4. name of the field in the table referenced <br>  5. the action that will occur when you delete <br>  6. what happens during the update <br><br>  Complete code: <br><pre> class Products extends Zend_Db_Table_Abstract
 {
     protected $ _name = 'products';
     protected $ _primary = array ('product_id');

     protected $ _referenceMap = array (
         'refUnits' =&gt; array (
             self :: COLUMNS =&gt; 'unit_id',
             self :: REF_TABLE_CLASS =&gt; 'Units',
             self :: REF_COLUMNS =&gt; 'unit_id',
             self :: ON_DELETE =&gt; self :: CASCADE,
             self :: ON_UPDATE =&gt; self :: CASCADE
         ),
         'refGroups' =&gt; array (
             self :: COLUMNS =&gt; 'group_id',
             self :: REF_TABLE_CLASS =&gt; 'Groups',
             self :: REF_COLUMNS =&gt; 'group_id',
             self :: ON_DELETE =&gt; self :: CASCADE,
             self :: ON_UPDATE =&gt; self :: CASCADE
         )
     );
 }

 class Units extends Zend_Db_Table_Abstract
 {
     protected $ _name = 'units';
     protected $ _primary = array ('unit_id');

     protected $ _dependentTables = array ('Products');
 }

 class Groups extends Zend_Db_Table_Abstract
 {
     protected $ _name = 'groups';
     protected $ _primary = array ('group_id');

     protected $ _dependentTables = array ('Products');
 }
</pre><br>  Now we have linked tables and we can not worry and calmly update our id keys. <br>  By the way, I forgot to mention that when you delete any group of products, the products that correspond to these groups are also deleted.  You can experiment and remove any of them.  If you are interested, the _cascadeUpdate and _cascadeDelete methods of the abstract class Zend_Db_Table_Abstract are responsible for updating and deleting and they are called when you call $ row-&gt; save () and $ row-&gt; delete (), respectively.  You can also get the parent entry (row) by calling the findParentRow method. <br><br><pre> $ productsTable = new Products;
 $ productsRowset = $ productsTable-&gt; fetchAll ();
 foreach ($ productsRowset as $ row) {
     echo '-----------------------'.  PHP_EOL;
     echo '&lt;pre&gt;'.  print_r ($ row-&gt; toArray (), true).  '&lt;/ pre&gt;'.  PHP_EOL;
     echo '&lt;pre&gt;'.  print_r ($ row-&gt; findParentRow ('Units') -&gt; toArray (), true).  '&lt;/ pre&gt;'.  PHP_EOL;
     echo '&lt;pre&gt;'.  print_r ($ row-&gt; findParentRow ('Groups') -&gt; toArray (), true).  '&lt;/ pre&gt;'.  PHP_EOL;
     echo '-----------------------'.  PHP_EOL;
 }
</pre><br>  Or get all the dependent rows (rows) by calling the findDependentRowset method <br><br><pre> $ groupsRowset = $ groupsTable-&gt; fetchAll ();
 foreach ($ groupsRowset as $ row) {
     echo '-----------------------'.  PHP_EOL;
     echo '&lt;pre&gt;'.  print_r ($ row-&gt; toArray (), true).  '&lt;/ pre&gt;'.  PHP_EOL;
     echo '&lt;pre&gt;'.  print_r ($ row-&gt; findDependentRowset ('Products') -&gt; toArray (), true).  '&lt;/ pre&gt;'.  PHP_EOL;
     echo '-----------------------'.  PHP_EOL;
 }
</pre><br>  With the rows obtained (rows), you can also work freely with instances of the Zend_Db_Table_Row class.  Good luck! <br><br>  ps Hi Jos, all your wishes are taken into account. </div><p>Source: <a href="https://habr.com/ru/post/127271/">https://habr.com/ru/post/127271/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../127265/index.html">Using Safe Browsing Yandex API in Firefox</a></li>
<li><a href="../127266/index.html">Mailing: Down with crutches!</a></li>
<li><a href="../127267/index.html">How to install fonts in e-books Alphabet n516 and Alphabet n618</a></li>
<li><a href="../127268/index.html">Creation and promotion of Symbian-hit. Part 2 Money</a></li>
<li><a href="../127270/index.html">Doctrine pagination - count the number of records using SQL_CALC_FOUND_ROWS (MySQL)</a></li>
<li><a href="../127273/index.html">Obtaining zero statistical information in the absence of source data</a></li>
<li><a href="../127274/index.html">Emulate network problems with WANem</a></li>
<li><a href="../127275/index.html">SCLOG: a bike with all the features of a programming language</a></li>
<li><a href="../127276/index.html">Language for working with ActionScript events</a></li>
<li><a href="../127281/index.html">Bypassing the integrated protection of PIC microcontrollers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>