<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>findNclean: find and clean</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No, no, this post is not about pain and suffering! Even a little bit the other way around. Just a picture reminds of the significance of the first lin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>findNclean: find and clean</h1><div class="post__text post__text-html js-mediator-article"><a href="https://habrahabr.ru/post/323828/"><img src="https://habrastorage.org/files/f83/b42/91d/f83b4291d39b406ca2a482f5732765a1.jpg"></a> <br><br>  No, no, this post is not about pain and suffering!  Even a little bit the other way around.  Just a picture reminds of the significance of the first line of the future code. <br>  At first, I just wanted to describe a fresh <a href="https://github.com/vmspike/findNclean">utility</a> , piping hot from under the keyboard.  By itself, it is completely nothing (even to the brilliance of the badge of the newly-made demob, to polish and polish it), but to describe it only turned out to be somehow boring.  Then I decided that using her example I could share bashism, which I had not used before.  Then I thought that you can kill two birds with one stone and describe it together with life examples.  But in the end I realized that it was not worthwhile to torture the already pretty shabby little animals, and decided to simply comb them a little.  The third hare (which is not a hare at all, but a boa constrictor) wisely chose to refrain from participating in this mess. <br><br>  So if all of a sudden, you regularly have to look for files and can even then move them somewhere;  or don't you care what layer of dust lies on the file system of your server with uptime of several <s>hundred</s> years and you are just interested in bash;  or if you just <abbr title="Brace Expansion: passed, passed, passed">passed by {, a, o}</abbr> , then do not pass by! <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="https://github.com/vmspike/findNclean">findNclean is</a> created on the basis of a great and mighty <code>find</code> , no less a great <code>mv</code> , and all this is in the soup from <code>bash</code> . <br><br>  Of course, you could write everything in <code>python</code> and not bother with the ‚Äúsubtleties‚Äù of <code>bash</code> , but I didn‚Äôt have such a choice, plus bash has better portability between different environments ‚Äî just an executable file and no libraries, virtual environments, and related problems with launching on vinaigrette from platforms.  Who does not agree - throw in me ... something, just to get it :).  So I had to tinker, including adaptation for old CentOS 5 environments. But the dependencies turned out to be at least for new axes (such as Ubuntu 16.04): <code>find mv wc</code> , for old ones plus <code>date touch</code> .  The rest is all <s>clean</s> bash. <br><br><h3>  Main usage scenario </h3><ul><li>  You create a configuration file where you describe the rules for searching for a specific category of files / directories / symlinks.  Each rule is usually a separate <code>find</code> process that writes the found files to its own log. </li><li>  If you need not only a list of files in itself, but for further movement, you also describe the options for moving there. </li><li>  Run the search process.  He will create a csv-log with the list of items found. </li><li>  You check this list, if suddenly something is wrong there - delete these lines. </li><li>  If the global parameter <code>APPROVED_SUFFIX</code> is specified in the config (in order to avoid moving files from an <code>APPROVED_SUFFIX</code> list), add this suffix to the log names.  By default, <code>APPROVED_SUFFIX</code> empty, i.e.  no renaming is required. </li><li>  You start the process of moving.  It will move all the files for which the logged parameters match the real, and for which it does not match - will not move with the message to the movement error log.  Of course, it will create a log when, what, where it moved. </li></ul><br>  All documentation can be reached through a call with no parameters at all: <code>./findNclean</code> <br><br>  The utility consists of <a href="https://github.com/vmspike/findNclean/raw/master/findNclean">executable</a> and <a href="https://github.com/vmspike/findNclean/raw/master/findNclean.conf.example">configuration</a> files.  All <code>./findNclean help -c</code> options available can be found in the output <code>./findNclean help -c</code> <div class="spoiler">  <b class="spoiler_title">An example of the simplest config</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"># <span class="hljs-number"><span class="hljs-number">100501</span></span>      &lt;<span class="hljs-keyword"><span class="hljs-keyword">Rule</span></span> -     &gt; result_list = /tmp/.csv search_path = / <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> = file move_path = /.Trash move_log = /var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/findNclean - Highway <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> hell (remix).csv &lt;/<span class="hljs-keyword"><span class="hljs-keyword">Rule</span></span>&gt;</code> </pre></div></div><div class="spoiler">  <b class="spoiler_title">What to expect in the terminal</b> <div class="spoiler_text"><div class="spoiler">  <b class="spoiler_title">./findNclean find -c ./findNclean.conf.example 2&gt; &amp; 1 |</b>  <b class="spoiler_title">grep -v 'Permission denied'</b> <div class="spoiler_text"><pre> <code class="hljs dos"><span class="hljs-number"><span class="hljs-number">2017</span></span>-<span class="hljs-number"><span class="hljs-number">03</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span>T02:<span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">02</span></span> <span class="hljs-number"><span class="hljs-number">10853</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Start</span></span> action: <span class="hljs-built_in"><span class="hljs-built_in">find</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span>-<span class="hljs-number"><span class="hljs-number">03</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span>T02:<span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">02</span></span> <span class="hljs-number"><span class="hljs-number">10853</span></span> Config: ./findNclean.conf.example <span class="hljs-number"><span class="hljs-number">2017</span></span>-<span class="hljs-number"><span class="hljs-number">03</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span>T02:<span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">02</span></span> <span class="hljs-number"><span class="hljs-number">10853</span></span> Debug <span class="hljs-built_in"><span class="hljs-built_in">mode</span></span> enabled <span class="hljs-number"><span class="hljs-number">2017</span></span>-<span class="hljs-number"><span class="hljs-number">03</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span>T02:<span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">02</span></span> <span class="hljs-number"><span class="hljs-number">10853</span></span> Config rules count: <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span>-<span class="hljs-number"><span class="hljs-number">03</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span>T02:<span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">02</span></span> <span class="hljs-number"><span class="hljs-number">10853</span></span> Relative paths allowed. Current <span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>: /home/user/<span class="hljs-built_in"><span class="hljs-built_in">path</span></span>/to/findNclean <span class="hljs-number"><span class="hljs-number">2017</span></span>-<span class="hljs-number"><span class="hljs-number">03</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span>T02:<span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">02</span></span> <span class="hljs-number"><span class="hljs-number">10853</span></span> Effective config content: &lt;Global&gt; DEBUG = true REL_PATH_ALLOW = true APPROVED_SUFFIX = .approved &lt;/Global&gt; &lt;Rule1 <span class="hljs-built_in"><span class="hljs-built_in">find</span></span>/<span class="hljs-built_in"><span class="hljs-built_in">move</span></span> old unused *.tmp files <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> /tmp, /var and current user home <span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>&gt; result_list = ./ancient-tmp.<span class="hljs-built_in"><span class="hljs-built_in">find</span></span>-example.csv search_path = /var/ search_path = /tmp/ search_path = ~/ <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> = f name = .*\.tmp accessed &lt; <span class="hljs-number"><span class="hljs-number">2017</span></span> move_path = ./ move_log = ./ancient-tmp.<span class="hljs-built_in"><span class="hljs-built_in">move</span></span>-example.csv move_log_err = ./ancient-tmp.<span class="hljs-built_in"><span class="hljs-built_in">move</span></span>-example.err.csv &lt;/Rule1&gt; &lt;Rule2 The same as above but <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> small non-zero logs&gt; result_list = ./ancient-logs.<span class="hljs-built_in"><span class="hljs-built_in">find</span></span>-example.csv search_path = ~/ search_path = /var/ search_path = /tmp/ <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> = f name = .*\.log(\.gz)? size &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> size &lt;= <span class="hljs-number"><span class="hljs-number">2</span></span>M accessed &lt; <span class="hljs-number"><span class="hljs-number">2017</span></span> move_path = ./ move_log = ./ancient-logs.<span class="hljs-built_in"><span class="hljs-built_in">move</span></span>-example.csv move_log_err = ./ancient-logs.<span class="hljs-built_in"><span class="hljs-built_in">move</span></span>-example.err.csv &lt;/Rule2&gt; <span class="hljs-number"><span class="hljs-number">2017</span></span>-<span class="hljs-number"><span class="hljs-number">03</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span>T02:<span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">02</span></span> <span class="hljs-number"><span class="hljs-number">10853</span></span> All non-zero size existing result_list files will be preliminary backuped: <span class="hljs-number"><span class="hljs-number">2017</span></span>-<span class="hljs-number"><span class="hljs-number">03</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span>T02:<span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">02</span></span> <span class="hljs-number"><span class="hljs-number">10853</span></span> The following commands will be evaluated (you can <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span>-paste them to bash terminal as is): <span class="hljs-built_in"><span class="hljs-built_in">find</span></span> -P -O3 -- /var/ /tmp/ /home/user/ -regextype posix-extended \( \! -name \*$'\n'\* -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -regex .\*/.\*\\.tmp \! -newerat <span class="hljs-number"><span class="hljs-number">2017</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>T00:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> -fprintf ./ancient-tmp.<span class="hljs-built_in"><span class="hljs-built_in">find</span></span>-example.csv <span class="hljs-variable"><span class="hljs-variable">%y\;%</span></span>s\;<span class="hljs-variable"><span class="hljs-variable">%TY-%</span></span>Tm-<span class="hljs-variable"><span class="hljs-variable">%TdT%</span></span>TH:<span class="hljs-variable"><span class="hljs-variable">%TM:%</span></span>TS\;<span class="hljs-variable"><span class="hljs-variable">%AY-%</span></span>Am-<span class="hljs-variable"><span class="hljs-variable">%AdT%</span></span>AH:<span class="hljs-variable"><span class="hljs-variable">%AM:%</span></span>AS\;<span class="hljs-variable"><span class="hljs-variable">%u\;%</span></span>g\;%p\\n \) , \( \! -name \*$'\n'\* -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -regex .\*/.\*\\.log\(\\.gz\)\? -size +<span class="hljs-number"><span class="hljs-number">0</span></span>c \( -size -<span class="hljs-number"><span class="hljs-number">2097152</span></span>c -o -size <span class="hljs-number"><span class="hljs-number">2097152</span></span>c \) \! -newerat <span class="hljs-number"><span class="hljs-number">2017</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>T00:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> -fprintf ./ancient-logs.<span class="hljs-built_in"><span class="hljs-built_in">find</span></span>-example.csv <span class="hljs-variable"><span class="hljs-variable">%y\;%</span></span>s\;<span class="hljs-variable"><span class="hljs-variable">%TY-%</span></span>Tm-<span class="hljs-variable"><span class="hljs-variable">%TdT%</span></span>TH:<span class="hljs-variable"><span class="hljs-variable">%TM:%</span></span>TS\;<span class="hljs-variable"><span class="hljs-variable">%AY-%</span></span>Am-<span class="hljs-variable"><span class="hljs-variable">%AdT%</span></span>AH:<span class="hljs-variable"><span class="hljs-variable">%AM:%</span></span>AS\;<span class="hljs-variable"><span class="hljs-variable">%u\;%</span></span>g\;%p\\n \) <span class="hljs-number"><span class="hljs-number">2017</span></span>-<span class="hljs-number"><span class="hljs-number">03</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span>T02:<span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">02</span></span> <span class="hljs-number"><span class="hljs-number">10853</span></span> Wait <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> all background processes completion... <span class="hljs-number"><span class="hljs-number">2017</span></span>-<span class="hljs-number"><span class="hljs-number">03</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span>T02:<span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">06</span></span> <span class="hljs-number"><span class="hljs-number">10853</span></span> Completed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> sec <span class="hljs-number"><span class="hljs-number">2017</span></span>-<span class="hljs-number"><span class="hljs-number">03</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span>T02:<span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">06</span></span> <span class="hljs-number"><span class="hljs-number">10853</span></span> Found items count (filenames with newline was excluded from the search): <span class="hljs-number"><span class="hljs-number">0</span></span> ./ancient-tmp.<span class="hljs-built_in"><span class="hljs-built_in">find</span></span>-example.csv <span class="hljs-number"><span class="hljs-number">7</span></span> ./ancient-logs.<span class="hljs-built_in"><span class="hljs-built_in">find</span></span>-example.csv <span class="hljs-number"><span class="hljs-number">7</span></span> total <span class="hljs-number"><span class="hljs-number">2017</span></span>-<span class="hljs-number"><span class="hljs-number">03</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span>T02:<span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">06</span></span> <span class="hljs-number"><span class="hljs-number">10853</span></span> WARNING: Some '<span class="hljs-built_in"><span class="hljs-built_in">find</span></span>' commands returned non-zero <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> code, results could be incomplete or incorrect! <span class="hljs-number"><span class="hljs-number">2017</span></span>-<span class="hljs-number"><span class="hljs-number">03</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span>T02:<span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">06</span></span> <span class="hljs-number"><span class="hljs-number">10853</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exit</span></span> codes list: <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span>-<span class="hljs-number"><span class="hljs-number">03</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span>T02:<span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">06</span></span> <span class="hljs-number"><span class="hljs-number">10853</span></span> Finished action: <span class="hljs-built_in"><span class="hljs-built_in">find</span></span></code> </pre></div></div>  <code>grep</code> , by the way, in this context is not entirely correct, because  several child processes are written to the same terminal, and sometimes one of the processes starts / continues to write even before the other has completed the line, so some of the useful information may disappear, and some useless to become visible. <br><br><div class="spoiler">  <b class="spoiler_title">manual list editing and move approval</b> <div class="spoiler_text"><pre> <code class="hljs swift">vim ./ancient-logs.<span class="hljs-built_in"><span class="hljs-built_in">find</span></span>-example.csv mv ./ancient-logs.<span class="hljs-built_in"><span class="hljs-built_in">find</span></span>-example.csv{,.approved} mv ./ancient-tmp.<span class="hljs-built_in"><span class="hljs-built_in">find</span></span>-example.csv{,.approved}</code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">./findNclean mv -c ./findNclean.conf.example # fail</b> <div class="spoiler_text"><pre> <code class="hljs sql">2017-03-13T02:05:32 11141 <span class="hljs-keyword"><span class="hljs-keyword">Start</span></span> <span class="hljs-keyword"><span class="hljs-keyword">action</span></span>: mv <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-13</span></span>T02:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">11141</span></span> Config: ./findNclean.conf.example <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-13</span></span>T02:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">11141</span></span> Debug <span class="hljs-keyword"><span class="hljs-keyword">mode</span></span> enabled <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-13</span></span>T02:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">11141</span></span> Config <span class="hljs-keyword"><span class="hljs-keyword">rules</span></span> <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-13</span></span>T02:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">11141</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Relative</span></span> paths allowed. <span class="hljs-keyword"><span class="hljs-keyword">Current</span></span> dir: /home/<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">path</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">to</span></span>/findNclean <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-13</span></span>T02:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">11141</span></span> Effective config <span class="hljs-keyword"><span class="hljs-keyword">content</span></span>: &lt;<span class="hljs-keyword"><span class="hljs-keyword">Global</span></span>&gt; DEBUG = <span class="hljs-literal"><span class="hljs-literal">true</span></span> REL_PATH_ALLOW = <span class="hljs-literal"><span class="hljs-literal">true</span></span> APPROVED_SUFFIX = .approved &lt;/<span class="hljs-keyword"><span class="hljs-keyword">Global</span></span>&gt; &lt;Rule1 find/<span class="hljs-keyword"><span class="hljs-keyword">move</span></span> <span class="hljs-keyword"><span class="hljs-keyword">old</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unused</span></span> *.tmp files <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> /tmp, /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">current</span></span> <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> home dir&gt; result_list = ./ancient-tmp.find-example.csv search_path = /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/ search_path = /tmp/ search_path = ~/ <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> = f <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> = .*\.tmp <span class="hljs-keyword"><span class="hljs-keyword">accessed</span></span> &lt; <span class="hljs-number"><span class="hljs-number">2017</span></span> move_path = ./ move_log = ./ancient-tmp.move-example.csv move_log_err = ./ancient-tmp.move-example.err.csv &lt;/Rule1&gt; &lt;Rule2 The same <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> above but <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> small non-zero <span class="hljs-keyword"><span class="hljs-keyword">logs</span></span>&gt; result_list = ./ancient-logs.find-example.csv search_path = ~/ search_path = /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/ search_path = /tmp/ <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> = f <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> = .*\.log(\.gz)? <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> &lt;= <span class="hljs-number"><span class="hljs-number">2</span></span>M <span class="hljs-keyword"><span class="hljs-keyword">accessed</span></span> &lt; <span class="hljs-number"><span class="hljs-number">2017</span></span> move_path = ./ move_log = ./ancient-logs.move-example.csv move_log_err = ./ancient-logs.move-example.err.csv &lt;/Rule2&gt; <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-13</span></span>T02:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">11141</span></span> All non-zero <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> existing move_log <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> move_log_err files will be preliminary backuped: <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-13</span></span>T02:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">11141</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Start</span></span> processing the <span class="hljs-keyword"><span class="hljs-keyword">following</span></span> <span class="hljs-keyword"><span class="hljs-keyword">move</span></span> lists <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> background: <span class="hljs-number"><span class="hljs-number">0</span></span> ./ancient-tmp.find-example.csv.approved <span class="hljs-number"><span class="hljs-number">2</span></span> ./ancient-logs.find-example.csv.approved <span class="hljs-number"><span class="hljs-number">2</span></span> total <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-13</span></span>T02:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">11141</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Wait</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> all background processes completion... mv: cannot <span class="hljs-keyword"><span class="hljs-keyword">move</span></span> <span class="hljs-string"><span class="hljs-string">'/var/log/openvpn/00004-test.log'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-string"><span class="hljs-string">'./00004-test.log'</span></span>: Permission denied mv: cannot <span class="hljs-keyword"><span class="hljs-keyword">move</span></span> <span class="hljs-string"><span class="hljs-string">'/var/log/openvpn/00009-tmp.log'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-string"><span class="hljs-string">'./00009-tmp.log'</span></span>: Permission denied <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-13</span></span>T02:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">11141</span></span> Completed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> sec <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-13</span></span>T02:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">11141</span></span> Moved items <span class="hljs-keyword"><span class="hljs-keyword">count</span></span> (successful canceled <span class="hljs-keyword"><span class="hljs-keyword">failed</span></span> move_log [move_log_err]): <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ./ancient-tmp.move-example.csv ./ancient-tmp.move-example.err.csv <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> ./ancient-logs.move-example.csv ./ancient-logs.move-example.err.csv <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> total <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-13</span></span>T02:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">11141</span></span> Finished <span class="hljs-keyword"><span class="hljs-keyword">action</span></span>: mv removed <span class="hljs-string"><span class="hljs-string">'/dev/shm/findNclean.exch26957.tmp'</span></span> removed <span class="hljs-string"><span class="hljs-string">'/dev/shm/findNclean.exch24396.tmp'</span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">sudo ./findNclean mv -c ./findNclean.conf.example # success</b> <div class="spoiler_text"><pre> <code class="hljs sql">2017-03-13T02:06:48 11394 <span class="hljs-keyword"><span class="hljs-keyword">Start</span></span> <span class="hljs-keyword"><span class="hljs-keyword">action</span></span>: mv <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-13</span></span>T02:<span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">11394</span></span> Config: ./findNclean.conf.example <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-13</span></span>T02:<span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">11394</span></span> Debug <span class="hljs-keyword"><span class="hljs-keyword">mode</span></span> enabled <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-13</span></span>T02:<span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">11394</span></span> Config <span class="hljs-keyword"><span class="hljs-keyword">rules</span></span> <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-13</span></span>T02:<span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">11394</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Relative</span></span> paths allowed. <span class="hljs-keyword"><span class="hljs-keyword">Current</span></span> dir: /home/<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">path</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">to</span></span>/findNclean <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-13</span></span>T02:<span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">11394</span></span> Effective config <span class="hljs-keyword"><span class="hljs-keyword">content</span></span>: &lt;<span class="hljs-keyword"><span class="hljs-keyword">Global</span></span>&gt; DEBUG = <span class="hljs-literal"><span class="hljs-literal">true</span></span> REL_PATH_ALLOW = <span class="hljs-literal"><span class="hljs-literal">true</span></span> APPROVED_SUFFIX = .approved &lt;/<span class="hljs-keyword"><span class="hljs-keyword">Global</span></span>&gt; &lt;Rule1 find/<span class="hljs-keyword"><span class="hljs-keyword">move</span></span> <span class="hljs-keyword"><span class="hljs-keyword">old</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unused</span></span> *.tmp files <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> /tmp, /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">current</span></span> <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> home dir&gt; result_list = ./ancient-tmp.find-example.csv search_path = /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/ search_path = /tmp/ search_path = ~/ <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> = f <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> = .*\.tmp <span class="hljs-keyword"><span class="hljs-keyword">accessed</span></span> &lt; <span class="hljs-number"><span class="hljs-number">2017</span></span> move_path = ./ move_log = ./ancient-tmp.move-example.csv move_log_err = ./ancient-tmp.move-example.err.csv &lt;/Rule1&gt; &lt;Rule2 The same <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> above but <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> small non-zero <span class="hljs-keyword"><span class="hljs-keyword">logs</span></span>&gt; result_list = ./ancient-logs.find-example.csv search_path = ~/ search_path = /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/ search_path = /tmp/ <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> = f <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> = .*\.log(\.gz)? <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> &lt;= <span class="hljs-number"><span class="hljs-number">2</span></span>M <span class="hljs-keyword"><span class="hljs-keyword">accessed</span></span> &lt; <span class="hljs-number"><span class="hljs-number">2017</span></span> move_path = ./ move_log = ./ancient-logs.move-example.csv move_log_err = ./ancient-logs.move-example.err.csv &lt;/Rule2&gt; <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-13</span></span>T02:<span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">11394</span></span> All non-zero <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> existing move_log <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> move_log_err files will be preliminary backuped: <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-13</span></span>T02:<span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">11394</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Start</span></span> processing the <span class="hljs-keyword"><span class="hljs-keyword">following</span></span> <span class="hljs-keyword"><span class="hljs-keyword">move</span></span> lists <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> background: <span class="hljs-number"><span class="hljs-number">0</span></span> ./ancient-tmp.find-example.csv.approved <span class="hljs-number"><span class="hljs-number">2</span></span> ./ancient-logs.find-example.csv.approved <span class="hljs-number"><span class="hljs-number">2</span></span> total <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-13</span></span>T02:<span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">11394</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Wait</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> all background processes completion... <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-13</span></span>T02:<span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">11394</span></span> Completed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> sec <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-13</span></span>T02:<span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">11394</span></span> Moved items <span class="hljs-keyword"><span class="hljs-keyword">count</span></span> (successful canceled <span class="hljs-keyword"><span class="hljs-keyword">failed</span></span> move_log [move_log_err]): <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ./ancient-tmp.move-example.csv ./ancient-tmp.move-example.err.csv <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ./ancient-logs.move-example.csv ./ancient-logs.move-example.err.csv <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> total <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-13</span></span>T02:<span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">11394</span></span> Finished <span class="hljs-keyword"><span class="hljs-keyword">action</span></span>: mv removed <span class="hljs-string"><span class="hljs-string">'/dev/shm/findNclean.exch24681.tmp'</span></span> removed <span class="hljs-string"><span class="hljs-string">'/dev/shm/findNclean.exch11002.tmp'</span></span></code> </pre></div></div></div></div><br>  You can run multiple instances of findNclean at the same time with different configs. <br><br>  If suddenly something is going to go wrong, you can set the <code>NOTIFICATION_SCRIPT</code> variable with the path to the script, then parameters will be passed to it with which it can do something, for example, send alerts. <br><br>  All characters are supported in file names except for line breaks, therefore files with hyphenations are ignored by default, although if you only need to compile a list of files (without further movement), you can also turn them on with the option <code>IGNORE_FILES_WITH_NEWLINES = false</code> . <br><br>  In the code, all documentation is crammed into variables (which are then displayed on the screen if necessary): <pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">read</span></span> -r -d <span class="hljs-string"><span class="hljs-string">''</span></span> VARIABLE &lt;&lt;<span class="hljs-string"><span class="hljs-string">'EOF'</span></span> bla-bla line EOF</code> </pre>  this is better than a periodically occurring construct: <pre> <code class="bash hljs">VARIABLE=$(cat &lt;&lt;<span class="hljs-string"><span class="hljs-string">'EOF'</span></span> The bla-bla line EOF )</code> </pre>  for it uses the built-in function without creating a subshell and calling an external program. <br><br>  Creating a process is a rather slow operation compared to running a built-in command, so if you don‚Äôt pull system binaries without a special need, the speed of execution of a <s>slowpoke</s> bash script can increase by an order of magnitude. <br><br>  When documentation variables are no longer needed, they are reset, empty, but nice: <pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">unset</span></span> DESCRIPTION USAGE CONFIG_USAGE TRICKS <span class="hljs-comment"><span class="hljs-comment"># No need help variables yet</span></span></code> </pre><br>  Closer to the header, the versions of the programs used are checked to see in which environment the utility is now located.  For the <code>bash</code> version, it looks something like this: <pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">printf</span></span> -v BV <span class="hljs-string"><span class="hljs-string">'%d%03d%03d'</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${BASH_VERSINFO[0]}</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${BASH_VERSINFO[1]}</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${BASH_VERSINFO[2]}</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-comment"><span class="hljs-comment"># Bash version in numbers like 4003046, where 4 is major version, 003 is minor, 046 is subminor. ((BV &lt; 3002025)) &amp;&amp; echo "WARNING: bash version ${BASH_VERSION} is too old (below 3.2.25)! This app was not tested with too ancient versions!" &gt;&amp;2</span></span></code> </pre>  <code>printf</code> in this case is better than <code>BV=$(bla-bla)</code> , because again the built-in utility will be executed without launching the subshell.  In addition, it allows you to format the source data. <br><br>  Perhaps there is a more elegant way of checking the version than stuffing it into an <code>int</code> with further comparison as with a decimal number, if you have such a thing lying around in your bins, lay it out! <br>  In the second line of the example <code>((BV &lt; 3002025))</code> also better than <code>[[ "${BV}" -lt 3002025 ]]</code> , since  faster, shorter and more human readable. <br><br><div class="spoiler">  <b class="spoiler_title">Who writes like that ?!</b>  <b class="spoiler_title">BEP-8 is not on you!</b> <div class="spoiler_text">  The code can be scolded for too long lines (as in the example above), but since  I am the only developer, I can afford it, it is more convenient for me to use the automatic transfer of lines in the IDE.  Well, there is still some craving for inline comments, so I like to ignore this fad.  Although for the text of the documentation I made up my mind;). <br>  You can also notice the excessive use of <code>printf %q</code> and, accordingly, <code>eval</code> , but this is a kind of price for the support of almost all symbols, although not all places require these constructions, some of which were used by inertia. </div></div><br>  For boolean variables, it is also convenient to use double parentheses: <pre> <code class="bash hljs">RULES_JOIN_ALLOW=1 <span class="hljs-comment"><span class="hljs-comment"># Allow optimize performance by join Rules with identical search_paths collection if ((RULES_JOIN_ALLOW)); then : # Do something here fi</span></span></code> </pre><br>  Many people know about the notation of the type <code>$'\r'$'\n'</code> , it is better to use them with the <code>echo</code> built-in command instead of the often recommended escape sequences for the external utility <code>/bin/echo</code> , called with <code>echo -e</code> (the built-in does not support them) .  But in quoted expressions, this is somewhat inconvenient, you often have to close and open quotes.  Fortunately, the same line break can be assigned to a variable and then no openings-closures <pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">readonly</span></span> EOL=$<span class="hljs-string"><span class="hljs-string">'\n'</span></span> <span class="hljs-comment"><span class="hljs-comment"># Newline ... approve|confirm) quit 255 "This action is not implemented yet.${EOL}You have to manually overview and approve list of files by appending${EOL}corresponding APPROVED_SUFFIX to the result_list value.${EOL}By default APPROVED_SUFFIX is none, so all result_list will be treated as approved."</span></span></code> </pre><br>  The same example appeals to the eternal holivar "tabs vs spaces".  So as not to spoil the formatting when using tabs, you could implement it via a here-doc with indents: <pre> <code class="bash hljs"> <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> -r -d <span class="hljs-string"><span class="hljs-string">''</span></span> tmp &lt;&lt;-<span class="hljs-string"><span class="hljs-string">'EOF'</span></span> This action is not implemented yet. You have to manually overview and approve list of files by appending corresponding APPROVED_SUFFIX to the result_list value. By default APPROVED_SUFFIX is none, so all result_list will be treated as approved. EOF quit 255 <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${tmp}</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">unset</span></span> tmp</code> </pre>  When using spaces, you can also get out: <pre> <code class="bash hljs"> tmp=<span class="hljs-string"><span class="hljs-string">'This action is not implemented yet.'</span></span>$<span class="hljs-string"><span class="hljs-string">'\n'</span></span> tmp+=<span class="hljs-string"><span class="hljs-string">'You have to manually overview and approve list of files by appending'</span></span>$<span class="hljs-string"><span class="hljs-string">'\n'</span></span> tmp+=<span class="hljs-string"><span class="hljs-string">'corresponding APPROVED_SUFFIX to the result_list value.'</span></span>$<span class="hljs-string"><span class="hljs-string">'\n'</span></span> tmp+=<span class="hljs-string"><span class="hljs-string">'By default APPROVED_SUFFIX is none, so all result_list will be treated as approved.'</span></span> quit 255 <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${tmp}</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">unset</span></span> tmp</code> </pre>  But I like my solution more, and it doesn‚Äôt matter whether there are tabs or spaces, although the string becomes indecently long. <br><br>  By the way, at one time, tabs were preferable for me precisely because of the possibility to use here-doc with the destruction of indents when parsing.  But the code with tabs is very problematic to insert into an interactive terminal for tests - all sorts of autocompletions spoil everything.  So now I do not even know how to live in this imperfect world.  <a href="">Google Inc. is on the side of the gaps</a> and I am gradually leaning in the same <a href="">direction</a> . <br><br>  The insertion of a timestamp from time immemorial has been done using <code>date</code> , although in new versions of <code>bash</code> you can use <code>printf %(datefmt)T</code> , but without the support of fractions of a second: <pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">readonly</span></span> TIMESTAMP_FORMAT=<span class="hljs-string"><span class="hljs-string">'%Y-%m-%dT%H:%M:%S'</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((BV &gt; 4002000)); <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-comment"><span class="hljs-comment"># Modern bash versions log() { ## Fast (builtin) but sec is min sample for most implementations printf "%(${TIMESTAMP_FORMAT})T %5d %s\n" '-1' $$ "$*" # %b convert escapes, %s print as is } else # Legacy bash versions log() { ## Slow (subshell, date) but support nanoseconds echo "$(exec -c date +"${TIMESTAMP_FORMAT}") $$ $*" } fi</span></span></code> </pre><br>  Here you can see the use of <code>$(exec -c some command)</code> to run an external utility in a subshell.  This allows you to get rid of the additional layer process between the current shell and the utility, well, just faster (by 0-2% depending on the situation, but with the world on a thread on the cap will be typed).  This is what the <code>$(some command)</code> tree clipping will look like: <pre> <code class="hljs objectivec">‚îú‚îÄ‚îÄ /bin/bash <span class="hljs-meta"><span class="hljs-meta">#   ‚îî‚îÄ‚îÄ /bin/bash #   ‚îî‚îÄ‚îÄ some command</span></span></code> </pre>  Together with <code>exec</code> there will be no extra layer, and with the <code>-c</code> option the command will be run with an empty environment, which will also speed up the work slightly. <br><br>  The following construction is used to calculate the execution time of a part of the code (up to a second): <pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((BV &gt; 4002000)); <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-comment"><span class="hljs-comment"># Modern bash versions ## Set global variable with the name $1 and time format $2 set_timestamp() { printf -v "$1" "%($2)T" '-1' } else # Legacy bash versions set_timestamp() { printf -v "$1" '%s' "$(exec -c date +"$2")" } fi ... set_timestamp ts '%s' #      set_timestamp TS '%s' log "Completed in $((TS-ts)) sec"</span></span></code> </pre><br>  As an alternative, the special variable <code>SECONDS</code> could be used.  It is equal to 0 at the start of the shell and is increased by one every second.  If you nullify it, and then refer to it, you will get the execution time of the code segment between these events in seconds.  In order not to lose the current value of the script execution time from the very beginning, you can also use intermediate variables: <pre> <code class="bash hljs">ts=<span class="hljs-variable"><span class="hljs-variable">${SECONDS}</span></span> <span class="hljs-comment"><span class="hljs-comment">#      TS=${SECONDS} log "Completed in $((TS-ts)) sec"</span></span></code> </pre>  This, I think, is even more preferable than using the <code>set_timestamp</code> function. <br><br>  Reading a file line by line is also not entirely trivial: <pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> IFS= <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> -r line || [[ -n <span class="hljs-variable"><span class="hljs-variable">${line}</span></span> ]]; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> &lt;/path/to/some/text/file</code> </pre>  Cleaning <code>IFS</code> for <code>read</code> necessary so that the initial and final tabs or spaces are not removed; <br>  <code>-r</code> - so that the string is read as is, without interpreting escape sequences of the <code>\t\r</code> ; <br> <code>|| [[ -n ${line} ]]</code>  <code>|| [[ -n ${line} ]]</code> - so that the code inside the loop is executed even if the last line of the file does not contain a line break, without it <code>read</code> returns a non-zero code and the cycle ends immediately. <br><br>  Interesting things happen with the time of creating a file in Linux (see the <code>born</code> option): even if the file system (for example ext4) supports it and diligently writes it down every time a new file is created, <code>stat</code> and, accordingly, <code>find</code> cannot read it: <pre> <code class="hljs ruby">user@host<span class="hljs-symbol"><span class="hljs-symbol">:~</span></span>$stat / : <span class="hljs-string"><span class="hljs-string">'/'</span></span> : <span class="hljs-number"><span class="hljs-number">4096</span></span> : <span class="hljs-number"><span class="hljs-number">8</span></span>  /: <span class="hljs-number"><span class="hljs-number">4096</span></span>  : fc00h/<span class="hljs-number"><span class="hljs-number">64512</span></span>d <span class="hljs-symbol"><span class="hljs-symbol">Inode:</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> : <span class="hljs-number"><span class="hljs-number">25</span></span> : (<span class="hljs-number"><span class="hljs-number">0755</span></span>/drwxr-xr-x) <span class="hljs-symbol"><span class="hljs-symbol">Uid:</span></span> ( <span class="hljs-number"><span class="hljs-number">0</span></span>/ root) <span class="hljs-symbol"><span class="hljs-symbol">Gid:</span></span> ( <span class="hljs-number"><span class="hljs-number">0</span></span>/ root) : <span class="hljs-number"><span class="hljs-number">2017</span></span>-<span class="hljs-number"><span class="hljs-number">03</span></span>-<span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">28</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">06</span></span>.<span class="hljs-number"><span class="hljs-number">121675004</span></span> +<span class="hljs-number"><span class="hljs-number">0700</span></span> : <span class="hljs-number"><span class="hljs-number">2017</span></span>-<span class="hljs-number"><span class="hljs-number">02</span></span>-<span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>09<span class="hljs-symbol"><span class="hljs-symbol">:</span></span>09.<span class="hljs-number"><span class="hljs-number">937545795</span></span> +<span class="hljs-number"><span class="hljs-number">0700</span></span> : <span class="hljs-number"><span class="hljs-number">2017</span></span>-<span class="hljs-number"><span class="hljs-number">02</span></span>-<span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>09<span class="hljs-symbol"><span class="hljs-symbol">:</span></span>09.<span class="hljs-number"><span class="hljs-number">937545795</span></span> +<span class="hljs-number"><span class="hljs-number">0700</span></span> : -</code> </pre>  but it is! <pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">user</span></span>@host:~$sudo debugfs -R "stat &lt;$(stat -c %i /)&gt;" /dev/ROOTFSDRIVE Inode: <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>: directory Mode: <span class="hljs-number"><span class="hljs-number">0755</span></span> Flags: <span class="hljs-number"><span class="hljs-number">0x80000</span></span> Generation: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Version</span></span>: <span class="hljs-number"><span class="hljs-number">0x00000000</span></span>:<span class="hljs-number"><span class="hljs-number">00000086</span></span> <span class="hljs-keyword"><span class="hljs-keyword">User</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Group</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> Size: <span class="hljs-number"><span class="hljs-number">4096</span></span> File ACL: <span class="hljs-number"><span class="hljs-number">0</span></span> Directory ACL: <span class="hljs-number"><span class="hljs-number">0</span></span> Links: <span class="hljs-number"><span class="hljs-number">25</span></span> Blockcount: <span class="hljs-number"><span class="hljs-number">8</span></span> Fragment: Address: <span class="hljs-number"><span class="hljs-number">0</span></span> Number: <span class="hljs-number"><span class="hljs-number">0</span></span> Size: <span class="hljs-number"><span class="hljs-number">0</span></span> ctime: <span class="hljs-number"><span class="hljs-number">0x58b3fac5</span></span>:df87410c <span class="hljs-comment"><span class="hljs-comment">-- Mon Feb 27 17:09:09 2017 atime: 0x58ca4c96:1d0273f0 -- Thu Mar 16 15:28:06 2017 mtime: 0x58b3fac5:df87410c -- Mon Feb 27 17:09:09 2017 crtime: 0x5801149b:00000000 -- Sat Oct 15 00:23:39 2016 Size of extra inode fields: 32 EXTENTS: (0):9249</span></span></code> </pre>  Such is the <a href="http://lists.gnu.org/archive/html/bug-findutils/2011-11/msg00015.html">flaw</a> . <br><br>  To move, <code>mv</code> used in a slightly unusual way (for an interactive terminal): <pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  ,  dest_name -  mv --backup=t -vT -- "${name}" "${dest_name}" #  ,  dest - ,  ,   '--', -     mv --backup=t -vt "${dest}" -- "${name}" #      , #       ,     ! mv --backup=off -vft "${dest}" -- "${name}"</span></span></code> </pre>  <code>--backup[=CONTROL]</code> is a useful thing, in case of some kind of malfunction or unforeseen situation the probability of turning everything backwards greatly increases. <br>  <code>--</code> also useful in scripts (this applies not only to <code>mv</code> , but also to others), because  to some extent decouple from the use of a limited set of characters in the values ‚Äã‚Äãof variables (for example, if the value starts with a hyphen).  In this case, it is not so necessary, because all variables for <code>mv</code> will first have either <code>/</code> or <code>./</code> to avoid, but it is better to use this feature anyway. <br><br>  To check the existence of a binary in the system instead of the frequently used <code>which</code> , it is better to use the built-in <code>hash</code> : <pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> util <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-variable"><span class="hljs-variable">${DEPENDENCIES}</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-built_in"><span class="hljs-built_in">hash</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${util}</span></span></span><span class="hljs-string">"</span></span> &amp;&gt;/dev/null || quit 1 <span class="hljs-string"><span class="hljs-string">"ERROR: '</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${util}</span></span></span><span class="hljs-string">' not found on this system"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">done</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">unset</span></span> util</code> </pre><br>  To parse the command line options (who don't know yet), it is convenient to use the <code>getopts</code> builtin command: <pre> <code class="bash hljs">OPTIND=2 <span class="hljs-comment"><span class="hljs-comment"># Ignore first argument ACTION even if it has leading hyphen while getopts ':dvc:' OPT; do [[ "${OPTARG:0:1}" = '-' ]] &amp;&amp; quit 1 "ERROR: Option argument cannot start with hyphen, got: ${OPTARG}" case "${OPT}" in d|v) DEBUG=1; v=v; ;; c) CONFIG=${OPTARG} ;; :) quit 1 "ERROR: Option -${OPTARG} requires an argument"; ;; *) quit 1 "ERROR: Unrecognized option: -${OPTARG}" esac done</span></span></code> </pre>  True, the scope of its application is somewhat limited by the fact that it does not support long options (starting with <code>--</code> ). <br><br>  To convert the values ‚Äã‚Äãof variables (not themselves, but only output) or arrays, there is a whole set of functions following the variable name in curly brackets: <pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">${var#word}</span></span> <span class="hljs-comment"><span class="hljs-comment">#     ${var##word} #     ${var%word} #     ${var%%word} #     ${var/pattern/string} #    ${var^pattern} #       ${var^^pattern} #       ${var,pattern} #       ${var,,pattern} #      </span></span></code> </pre>  There is even an undocumented possibility: <pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">${var~}</span></span> <span class="hljs-comment"><span class="hljs-comment">#      ${var~~} #     </span></span></code> </pre>  In the code there are many where you can meet.  Here is one of the most entertaining for an array of commands for parallel execution: <pre> <code class="bash hljs">parallel_run <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${Commands[@]/#/exec -c }</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-comment"><span class="hljs-comment"># Prepending of 'exec -c ' need to avoid additional subshell creation</span></span></code> </pre>  It inserts ' <code>exec -c</code> ' at the beginning of each cell in the array. <br><br>  In the same way, all the values ‚Äã‚Äãinside the array can be summed (only integers of course): <code>$((${MOVE_OK_COUNT[@]/#/+}))</code> <br><br><br>  In the <abbr title="Pathname Expansion: World Sea">m [io] re</abbr> <code>bash</code> still a lot of pitfalls and you can dive after them until you drown even if you have mastered <code>man bash</code> and we sew random passersby regularly take off their hat in front of you. <br><br>  I will end with a quote from the above epic: <pre> <code class="hljs erlang">BUGS It's too big <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> too slow.</code> </pre>  Therefore, if possible, choose the <s><code>#!/bin/bash</code></s> shebang <s><code>#!/bin/bash</code></s> ! <br><br><br>  <b>PS</b> For a snack, since we are talking about search and bash <pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">## Find files by shebang shebang='#!/bin/bash'$'\n' search_path=./ while IFS= read -rd $'\0' filename; do IFS= read -rd '' -N ${#shebang} firstbytes &lt;"${filename}" [[ "${firstbytes}" == "${shebang}" ]] &amp;&amp; echo "${filename}" done &lt; &lt;(exec -c find "${search_path}" -type f -size +${#shebang}c -readable -print0)</span></span></code> </pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> You already understand the functionality of some of the ‚Äúexcesses‚Äù in this set of beeches;)? </font></font></div><p>Source: <a href="https://habr.com/ru/post/323828/">https://habr.com/ru/post/323828/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../323818/index.html">Project Centennial: a bridge from Win32 and .NET to the Windows Store and UWP</a></li>
<li><a href="../323820/index.html">NeoQuest 2017: Getting out of the dodecahedron without launching anything in qemu</a></li>
<li><a href="../323822/index.html">Maternity leave in IT, or how not to lose yourself in the profession</a></li>
<li><a href="../323824/index.html">Accelerate Home ESXi 6.5 with SSD Caching</a></li>
<li><a href="../323826/index.html">Data centers as art: data centers at the bottom of the ocean</a></li>
<li><a href="../323830/index.html">[NeoQuest2017] "MULTIPSPORT!" And pink spacesuit</a></li>
<li><a href="../323832/index.html">From monoids to de Morgan algebras. We build abstractions on Haskell</a></li>
<li><a href="../323834/index.html">eMule on Android</a></li>
<li><a href="../323836/index.html">Banal AB-test</a></li>
<li><a href="../323838/index.html">Pink spacesuit, cryptocurrency and genetically modified iOS: tasks of the online-stage NeoQUEST-2017 and some statistics</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>