<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Qt Graphics Framework - the dark side. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the first article I told how I could about the merits of the framework. Today I will try to tell about his dark side, poorly lit in the documentati...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Qt Graphics Framework - the dark side. Part 1</h1><div class="post__text post__text-html js-mediator-article">  In the <a href="http://habrahabr.ru/post/182142/">first</a> article I told how I could about the merits of the framework.  Today I will try to tell about his dark side, poorly lit in the documentation. <br><br><h4>  Case number 1 </h4><br>  We want to resize the scene and the objects in it according to the size of the displayed window.  The dock says, ‚ÄúQGraphicsView takes ownership of the viewport widget.‚Äù  Well, let's create a simplest project and write the following: <a name="habracut"></a><br><br>  MainWindow.h: <br><pre><code class="hljs smalltalk"><span class="hljs-symbol"><span class="hljs-symbol">#ifndef</span></span> <span class="hljs-type"><span class="hljs-type">MAINWINDOW_H</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#define</span></span> <span class="hljs-type"><span class="hljs-type">MAINWINDOW_H</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> &lt;<span class="hljs-type"><span class="hljs-type">QMainWindow</span></span>&gt; <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> &lt;<span class="hljs-type"><span class="hljs-type">QGraphicsScene</span></span>&gt; <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> &lt;<span class="hljs-type"><span class="hljs-type">QGraphicsEllipseItem</span></span>&gt; <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> &lt;<span class="hljs-type"><span class="hljs-type">QGraphicsView</span></span>&gt; class <span class="hljs-type"><span class="hljs-type">MainWindow</span></span> : public <span class="hljs-type"><span class="hljs-type">QWidget</span></span> { <span class="hljs-type"><span class="hljs-type">Q_OBJECT</span></span> public: explicit <span class="hljs-type"><span class="hljs-type">MainWindow</span></span>(<span class="hljs-type"><span class="hljs-type">QWidget</span></span> *parent = <span class="hljs-number"><span class="hljs-number">0</span></span>); ~<span class="hljs-type"><span class="hljs-type">MainWindow</span></span>(); private: bool eventFilter(<span class="hljs-type"><span class="hljs-type">QObject</span></span> *, <span class="hljs-type"><span class="hljs-type">QEvent</span></span> *); private: <span class="hljs-type"><span class="hljs-type">QGraphicsScene</span></span> *m_scene; <span class="hljs-type"><span class="hljs-type">QGraphicsEllipseItem</span></span> *m_elipse; <span class="hljs-type"><span class="hljs-type">QGraphicsView</span></span> * graphicsView; }; <span class="hljs-symbol"><span class="hljs-symbol">#endif</span></span> // <span class="hljs-type"><span class="hljs-type">MAINWINDOW_H</span></span></code> </pre> <br>  MainWindow.cpp: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"MainWindow.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;QGridLayout&gt; #include &lt;QEvent&gt; #include &lt;QResizeEvent&gt; MainWindow::MainWindow(QWidget *parent) : QWidget(parent) { setLayout(new QGridLayout()); graphicsView = new QGraphicsView(); layout()-&gt;addWidget(graphicsView); graphicsView-&gt;setVerticalScrollBarPolicy(Qt::ScrollBarAlwaysOff); graphicsView-&gt;setHorizontalScrollBarPolicy(Qt::ScrollBarAlwaysOff); m_scene = new QGraphicsScene(); m_elipse = new QGraphicsEllipseItem(); m_scene-&gt;addItem(m_elipse); m_scene-&gt;setSceneRect(m_elipse-&gt;boundingRect()); graphicsView-&gt;setScene(m_scene); graphicsView-&gt;installEventFilter(this); } MainWindow::~MainWindow() { } bool MainWindow::eventFilter(QObject *, QEvent *event) { if(event-&gt;type() == QEvent::Resize ) { QResizeEvent *res = reinterpret_cast&lt;QResizeEvent*&gt;(event); m_elipse-&gt;setRect(0, 0, res-&gt;size().width(), res-&gt;size().height()); return true; } return false; }</span></span></span></span></code> </pre><br>  It is expected that by changing the size of the widget, we will change the size of the ellipse, but it will still be completely visible, since  The size and display area will change.  Compile, run and make sure that it doesn't work as it should: you can reduce the initial size, but when it is exceeded, the ellipse is clipped. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Then we change <br><br><pre> <code class="cpp hljs"> graphicsView-&gt;installEventFilter(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);</code> </pre><br>  on <br><pre> <code class="cpp hljs"> graphicsView-&gt;viewport()-&gt;installEventFilter(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);</code> </pre><br><br>  Compile, run - everything works.  Now we will try to install a filter in the scene.  Compile, run and see nothing at all. <br><br><h4>  Case number 2 </h4><br>  We want to track the position of the mouse as it moves around the scene.  To do this, we modify our test and class as follows: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> MainWindow::eventFilter(QObject *, QEvent *event) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(event-&gt;type() ==QEvent::MouseMove) { qDebug()&lt;&lt;event; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre><br><br>  In the constructor we add: <br><pre> <code class="cpp hljs">graphicsView-&gt;setMouseTracking(<span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> </pre><br><br>  Well, install the filter in graphicsView. <br>  We compile, run, make sure that does not work.  Install the filter in the viewport and everything works again. <br>  Now we modify a little: <br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(event-&gt;type() ==QEvent::MouseMove)</code> </pre><br>  replace on <br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(event-&gt;type() ==QEvent::GraphicsSceneMouseMove)</code> </pre><br><br>  And install the filter in the scene.  And unlike last time, we find that the movement of the mouse is tracked. <br><br><h4>  Conclusions of the investigation </h4><br>  As it would be not strange from the point of view of a beginner, but the Graphics Framework really follows the logic: the display is separate, and the composition is separate.  And because the resizing event is not transmitted to the scene.  And graphicsView really takes care of the viewport.  This can be verified if in case number 1 replace the filter with: <br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(event-&gt;type() == QEvent::Resize ) { QResizeEvent *res = <span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;QResizeEvent*&gt;(event); m_elipse-&gt;setRect(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, res-&gt;size().width(), res-&gt;size().height()); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> </pre><br>  Those.  remove the event filtering, we will see the expected behavior.  Those.  the event was filtered and was not further transferred to the viewport.  But adequate behavior when decreasing is caused by Qt's internal logic or spontaneous events, as they are called in the code. <br><br>  Let's return to the transfer of events to the scene.  This process is not described at all, but there is an important point: before going to the scene, graphicsView transforms the event into the corresponding QGRaphisSceneEvent, but this happens in specialized methods, which is why it is in the dock and recommends redefining them, rather than the entry point ( <i>event</i> or <i>viewportEvent</i> ). <br><br>  Once again I will pay attention to the last moment: the logic of the framework is such that all external events are prepared to work with the scene.  Those.  if you have your QEvent, which must be passed to the scene, then the best way, not violating Qt's logic, is to create an analogue of a custom event, inherited from QGRaphicsSceneEvent, write a transformation method and send the transformed to the scene, which will be called in the class inherited from QGraphicsView , well, send a QEvent to this most modified QGraphicsView. <br><br>  It remains to consider the last stage: delivery of the event to the Item.  Here, the picture is similar with delivery to the scene, namely: after the event has come, it is determined which specialized function should be activated;  in this specialized function, the coordinates of the event are determined, using itemAt () methods to determine which Item to deliver the event, then the event is prepared for delivery to the Item and only after that is sent to it. <br><br>  By the way, here too the rake lies.  The dock says that you need to call geometryChange before changing the geometric dimensions, otherwise we stumble upon a problem with drawing.  But not only problems will arise with the delivery of events. </div><p>Source: <a href="https://habr.com/ru/post/182614/">https://habr.com/ru/post/182614/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../182604/index.html">PocketBook Touch 2 - reader with E-Ink Pearl and sensor</a></li>
<li><a href="../182606/index.html">Photos of workplaces habrazhiteli</a></li>
<li><a href="../182608/index.html">Real-Time UIKit Inspector (Reveal App)</a></li>
<li><a href="../182610/index.html">Threads, locks, and condition variables in C ++ 11 [Part 1]</a></li>
<li><a href="../182612/index.html">Silicone Skeleton - Silex tuned</a></li>
<li><a href="../182620/index.html">Exploring JavaScript Generators</a></li>
<li><a href="../182622/index.html">Video: New software development and testing offers for MSDN subscribers and other Windows Azure news</a></li>
<li><a href="../182626/index.html">Threads, locks, and condition variables in C ++ 11 [Part 2]</a></li>
<li><a href="../182628/index.html">Node.js: JavaScript Are you it?</a></li>
<li><a href="../182630/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ60 (June 1 - 8, 2013)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>