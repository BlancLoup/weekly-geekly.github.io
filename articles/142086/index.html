<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write a simple Opera-extension</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is devoted to writing a simple extension for the Opera browser. Our extension will be primitive, since all its functionality will be in u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write a simple Opera-extension</h1><div class="post__text post__text-html js-mediator-article"><img src="http://www.habrastorage.com/images/64x64.png" align="right">  This article is devoted to writing a simple extension for the Opera browser.  Our extension will be primitive, since  all its functionality will be in user-JS for habrahabr.ru.  The comments feed is equipped with a block that displays the number of new comments in the topic and a button allowing it to be updated.  Let's add arrows to navigate through new comments. <br><br><img src="http://www.habrastorage.com/images/1trt.png"><a name="habracut"></a><br><br><h4>  Where do we start? </h4><br><ul><li>  Create a new directory for the extension files. </li><li>  We will create a config.xml file in it. </li></ul><br>  XML Content: <br><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">widget</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/ns/widgets"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://faiwer.ru"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.9a"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">defaultlocale</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xml:lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span>HabrCommentSwitcher<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xml:lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span>Habrahabr. New comment switcher<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xml:lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ru"</span></span></span><span class="hljs-tag">&gt;</span></span>Habrahabr.   <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">author</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"faiwer.ru"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">email</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"faiwer@gmail.com"</span></span></span><span class="hljs-tag">&gt;</span></span>Faiwer<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">author</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">icon</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"icons/64x64.png"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">icon</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"icons/48x48.png"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">icon</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"icons/32x32.png"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">widget</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Since this article is a tutorial, I will not describe each item in detail, the <a href="http://www.opera.com/docs/apis/extensions/">documentation</a> will cope better with it.  Let's stop on the most important thing: <br><ul><li>  &lt;name&gt; The name of our extension &lt;/ name&gt;.  Don't make it too long </li><li>  &lt;description&gt; Short description &lt;/ description&gt;.  Enough and a pair of lines </li><li>  &lt;icon /&gt;.  Icons are used on the extensions page, on <a href="https://addons.opera.com/addons/extensions/">the repository site</a> (if your extension is accepted there), and in the button, which will not be in this extension.  It is desirable to make a separate directory in order not to create a mess </li></ul><br>  Available options are much more.  But for starters, that's enough.  I think you noticed that in config.xml you can specify several language versions at once for the name and description. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As a final touch, you need to create index.html.  It is needed for the operation of the off-screen script, which will be launched with the start of the browser, and will not be tied to any of the tabs.  We do not need it, but without it, Opera will not allow us to "podobezhit".  The file can be left blank.  Now with the help of drag-n-drop we drag our config.xml into the browser.  If everything went well, a page will open with a list of installed extensions, and ours will be there from above, in the ‚ÄúDeveloper Mode‚Äù section. <br><br><h4>  Userjs </h4><br>  In the beginning, you should decide what the future expansion should do: <br><ul><li>  wait until the end of the page loading and the appearance of the desired block (hereinafter I will call it slider). </li><li>  place our arrow buttons in it. </li><li>  place the necessary CSS for arrows and highlight the current comment. </li><li>  animate the arrows - they have to move the scrolling page on the new comments. </li></ul><br>  For all this, the 1st file is enough to be executed for each habrahabr page.  Those.  <a href="http://ru.wikipedia.org/wiki/Userjs">UserJS</a> is perfect for us.  But if Chrome can convert UserJS to extensions itself, and Firefox needs <a href="https://addons.mozilla.org/ru/firefox/addon/greasemonkey/">Greasemonkey</a> for this, then in the case of Opera we can arrange it as an extension or install it manually (F12 - Settings for the site - Scripts). <br><br>  Create an includes directory, Opera will search for ‚Äúembedded‚Äù scripts there.  In it, we will create the file habr_comment_switcher.js (here you can choose any name).  In the beginning of the file we place: <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ==UserScript== // @include http://habrahabr.ru/* // ==/UserScript==</span></span></code> </pre><br>  This is not just js-comments, this is a special markup for UserJS, which in our case explains to the opera that this embedded file should be launched only on habrahabr.ru. <br><br><h4>  Javascript </h4><br>  In addition to this file, we could embed another library like jQuery or Prototype.  But I strictly do not recommend doing so.  This kind of library is very weighty, and since  they will be loaded not only for each tab, but also for each iframe, of which there are many on the page, 5-10 such extensions can cause brakes.  Considering that our tasks are very modest, we are not losing much. <br><br>  <b>UPD 2.</b> Thanks, <a href="http://habrahabr.ru/users/kns/" class="user_link">kns</a> .  If the page already uses 1 of the popular libraries, then we can use it.  Read more about this <a href="http://habrahabr.ru/post/140825/">here</a> .  In the case of Opera, it will look something like this: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> $ = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.jQuery;</code> </pre> <br><br>  Let's start writing code.  For a start, for convenience, we will put everything in the anonymous function.  Because  our javascript environment is isolated from the javascript environment of the site, it is not necessary to do this, but in my opinion, this has long been a good tone rule: <br><pre> <code class="javascript hljs">+<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> w </span></span></span><span class="hljs-function">) </span></span>{ }( <span class="hljs-built_in"><span class="hljs-built_in">window</span></span> );</code> </pre><br>  I do not know about you, but I used to work within a specific object, and therefore we define it: <br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Engine = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._init(); } Engine.prototype = { <span class="hljs-attr"><span class="hljs-attr">_init</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ } }</code> </pre><br>  Now you need to issue the conditions for its creation: <br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( w.location.href.indexOf( <span class="hljs-string"><span class="hljs-string">'habrahabr.ru'</span></span> ) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> engine = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; d.addEventListener( <span class="hljs-string"><span class="hljs-string">'DOMContentLoaded'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ setTimeout( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ engine = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Engine(); }, <span class="hljs-number"><span class="hljs-number">1500</span></span> ); }, <span class="hljs-literal"><span class="hljs-literal">false</span></span> ); }</code> </pre><br>  The check for the page address is not caused by logical arguments, but by paranoia.  The fact is that I came across a couple of times on the network that Opera sometimes does not cope with the rules for UserJS.  Our object will be launched after all the DOM-tree of the page is built + 1.5 sec.  Why 1.5 seconds?  The fact is that the slider does not appear immediately, so we will wait for it.  This can be realized more gracefully, but so far it will come down. <br><br><h4>  Job extension </h4><br>  Now Opera is not the most high-tech browser, but still its capabilities are far ahead of IE6,7,8.  Therefore, we can take advantage of such things that we would not use in ordinary web programming.  Simplify yourself a job: <br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> d = w.document, $ = d.querySelector.bind( d ), $$ = d.querySelectorAll.bind( d )</code> </pre><br>  The querySelector and querySelectorAll methods allow you to find DOM objects by CSS selectors.  This approach is probably familiar to you from the experience of using jQuery.  In our case, the $ function will search for one element that satisfies the query, and $$ list. <br><br>  What are we on the list?  It doesn‚Äôt matter, let's introduce the CSS we need to the page: <br><pre> <code class="javascript hljs">_cssInject: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> style = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._createElem( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.elem.style_inject ), text = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>, n = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.css.length; i &lt; n; ++ i ) { text += <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.css[ i ]; } style.innerHTML = text; d.head.appendChild( style ); }</code> </pre><br>  Here we create a new DOM object &lt;style /&gt; and set the necessary CSS code as content.  Because  The page is already ready. Document.head is available to us, where we will place our tag.  Now about the _createElem function: <br><pre> <code class="javascript hljs"> _createElem: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> data </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item = d.createElement( data.tagName ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( data.attr ) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rule <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> data.attr ) { item.setAttribute( rule, data.attr[ rule ] ); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> item; },</code> </pre><br>  You can organize work with settings as you like, like this: <br><pre> <code class="javascript hljs">_initConst: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._extend( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, { <span class="hljs-attr"><span class="hljs-attr">css</span></span>: [ <span class="hljs-string"><span class="hljs-string">'.__hcsc_button { border-top: 1px solid white; line-height: 22px; height: 22px; '</span></span> + <span class="hljs-string"><span class="hljs-string">'cursor: pointer; }'</span></span>, <span class="hljs-string"><span class="hljs-string">'.__hcsc_button:hover { color: white; }'</span></span>, <span class="hljs-string"><span class="hljs-string">'.info.__hcsc_active { outline: 2px solid #222; }'</span></span>, ], <span class="hljs-attr"><span class="hljs-attr">elem</span></span>: { <span class="hljs-attr"><span class="hljs-attr">style_inject</span></span>: { <span class="hljs-attr"><span class="hljs-attr">tagName</span></span>: <span class="hljs-string"><span class="hljs-string">'style'</span></span>, <span class="hljs-attr"><span class="hljs-attr">attr</span></span>: { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-string"><span class="hljs-string">'__habr_comment_switcher_css'</span></span> } } } } ); }, <span class="hljs-attr"><span class="hljs-attr">_extend</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> object, extend </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> extend ) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( extend.hasOwnProperty( name ) ) { object[ name ] = extend[ name ]; } },</code> </pre><br>  Let us turn to the main logic.  We need to find the slider and add two buttons to it: <br><pre> <code class="javascript hljs">_prepareSlider: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> slider = $( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.s.slider ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( !slider ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.up_button = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._createElem( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.elem.button ); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.up_button.innerHTML = <span class="hljs-string"><span class="hljs-string">'‚ñ≤'</span></span>; slider.appendChild( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.up_button ); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.down_button = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._createElem( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.elem.button ); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.down_button.innerHTML = <span class="hljs-string"><span class="hljs-string">'‚ñº'</span></span>; slider.appendChild( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.down_button ); },</code> </pre><br>  Arrows can be set by text.  Now we need to revive these buttons: <br><pre> <code class="javascript hljs">_observe: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.up_button.addEventListener( <span class="hljs-string"><span class="hljs-string">'click'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._slideClick.bind( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span> ), <span class="hljs-literal"><span class="hljs-literal">false</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.down_button.addEventListener( <span class="hljs-string"><span class="hljs-string">'click'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._slideClick.bind( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, +<span class="hljs-number"><span class="hljs-number">1</span></span> ), <span class="hljs-literal"><span class="hljs-literal">false</span></span> ); },</code> </pre><br>  And finally, the long-awaited listalka: <br><pre> <code class="javascript hljs">_checkItems: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> items = $$( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.s.info_panel ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( !<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.items || !<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.items.length || !items.length || ( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.items[ <span class="hljs-number"><span class="hljs-number">0</span></span> ] !== items[ <span class="hljs-number"><span class="hljs-number">0</span></span> ] ) ) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.position = <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.items = items; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.items; }, <span class="hljs-attr"><span class="hljs-attr">_slideClick</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> diff </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.current ) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.current.classList.remove( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.c.active ); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( !<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._checkItems().length ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.position += diff; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.position &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.position = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.items.length - <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.position &gt;= <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.items.length ) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.position = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.current = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.items[ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.position ]; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.current.scrollIntoView( <span class="hljs-literal"><span class="hljs-literal">true</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.current.classList.add( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.c.active ); }</code> </pre><br>  Its logic is simple.  We are looking for all new comments on the CSS selector specified in this.s.info_panel (".comment_item&gt; .info.is_new").  He finds us all the block headings for new comments.  Then, depending on which button we clicked, move the page scroll to the desired comment using scrollIntoView.  To make this event more visual, we add a class to it, for which we have defined a dark frame CSS (outline) above. <br><br>  Given that the update button is available, and our list of new comments may become outdated, the extension checks the old list with the current one each time, and if they are different, the position counter resets. <br><br>  Separately, I would like to focus on the functions of working with the DOM object class.  No need to manually parse the item.className line, since  The following methods are available: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.current.classList.add( <span class="hljs-string"><span class="hljs-string">'my_class'</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.current.classList.remove( <span class="hljs-string"><span class="hljs-string">'my_class'</span></span> );</code> </pre><br><br><h4>  A bit about ‚Äúdebag‚Äù </h4><br>  Let's start with the fact that we have a tool like <a href="http://ru.opera.com/dragonfly/">Dragonfly</a> (dragonfly), which is called via ctrl + shift + i (or the right mouse button - ‚Äúinspect the object‚Äù).  In it on the ‚ÄúScripts‚Äù tab, we can find our habr_comment_switcher.js in the drop-down list.  Now we have breakpoints and ‚Äútracing‚Äù (F8, F10, F11).  The console is also available to us, but in order for it to work in the same js environment as our script, we need to first look at its number in the list of scripts. <br><br>  You can view errors by clicking the "open error console" button on the installed extensions page.  The console object for extensions does not work.  To update an extension, we need to close the dragonfly, on the extensions page, click ‚Äúrefresh‚Äù, open the dragonfly on the required tab and click ‚Äúrefresh‚Äù in the browser.  In general, the experience of working with a dragonfly extension is the worst.  Especially after the experience of developing an extension for Chrome. <br><br><h4>  Final touch </h4><br>  It seems everything works, so it's time to pack the extension.  To do this, compress the <b>contents of the</b> extension folder in a zip-archive, and change the file extension to oex.  All expansion is ready.  You can use.  If Opera swears at the fact that the extension is damaged, check - maybe you have compressed not the contents of the folder, but her own.  Also check for config.xml and index.html files. <br><img src="http://www.habrastorage.com/images/1owo.png" alt="image"><br><br><h4>  Epilogue </h4><br>  HOORAY!  Our extension is ready, in alpha version.  It can be improved, add support for Chrome and Greasemonkey (although I'm not sure that it will not take off like that), add a settings page (for example, to set colors or change CSS selectors). <br><br>  You can see the finished extension <a href="https://github.com/faiwer/habr_comment_switcher">here</a> .  <i>The first time I use git, excuse me if something goes wrong.</i> </div><p>Source: <a href="https://habr.com/ru/post/142086/">https://habr.com/ru/post/142086/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../142081/index.html">about design concepts</a></li>
<li><a href="../142082/index.html">Microsoft Open Technologies Inc</a></li>
<li><a href="../142083/index.html">10 robots that most influenced history</a></li>
<li><a href="../142084/index.html">The influence of the gaming environment on the effectiveness of achieving goals</a></li>
<li><a href="../142085/index.html">We connect headphones to the TV</a></li>
<li><a href="../142087/index.html">Good morning or experience using a smart alarm clock.</a></li>
<li><a href="../142088/index.html">How I went to work in Denmark</a></li>
<li><a href="../142089/index.html">Rendering world</a></li>
<li><a href="../142090/index.html">QML Live Preview - UI Designers' Dream</a></li>
<li><a href="../142092/index.html">"Debriefing" - Episode 15 - We answer questions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>