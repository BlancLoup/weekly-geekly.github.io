<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>DEFCON 21. Passwords alone are not enough, or why disk encryption ‚Äúbreaks down‚Äù and how it can be fixed. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Thank you all for coming, today we will talk about full disk encryption (FDE), which is not as secure as you think. Raise your hands, who encrypts the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>DEFCON 21. Passwords alone are not enough, or why disk encryption ‚Äúbreaks down‚Äù and how it can be fixed. Part 1</h1><div class="post__text post__text-html js-mediator-article"> Thank you all for coming, today we will talk about full disk encryption (FDE), which is not as secure as you think.  Raise your hands, who encrypts the HDD of your computer this way.  Amazing  Well, welcome to DefCon! <br><br><img src="https://habrastorage.org/webt/ir/ay/fe/irayfe0jis_9tjsuegxclty8638.png"><br><br>  It appears that 90% of you use open source software to encrypt a disk in order to be able to audit them.  Now let those who completely turn off the computer raise their hands if they leave it unattended.  I think about 20% of those present.  Tell me, and who generally leaves your computer unattended for a few hours, doesn‚Äôt it turn on or off?  Consider that I ask these questions, just to make sure that you are not a zombie and do not sleep.  I think that almost everyone had to leave their computer for at least a few minutes. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So why do we encrypt our computers?  It is difficult to find someone who would ask this question, so I think it is really important to formulate the motivation of specific actions in the field of security.  If we do not do this, we will not be able to understand how to organize this work. <a name="habracut"></a><br><br>  There is a lot of documentation on software that encrypts a disk, which describes what the software does, what algorithms it uses, which passwords, and so on, but almost never says why. <br><br>  So, we encrypt our computer because we want to control our data, we want to guarantee their confidentiality and that no one can steal or change it without our knowledge.  We want to decide for ourselves how to deal with our data and control what happens to it. <br><br>  There are situations where you simply must ensure the secrecy of data, for example, if you are a lawyer or a doctor who has confidential client information.  The same applies to financial and accounting documentation.  Companies are obliged to inform customers about the leakage of such information, for example, if someone left an unprotected laptop in a car that was hijacked, and now this confidential information may be freely available on the Internet. <br><br>  In addition, you need to control the physical access to the computer and ensure that it is protected from physical impact, because FDE will not help if someone physically takes over your computer. <br><br>  If we want to secure the network, we need to control access to the end user's computer.  We will not be able to build a secure Internet without ensuring the security of each end user. <br><br><img src="https://habrastorage.org/webt/v2/id/jx/v2idjxxr4vditmp-vhvef9d6koy.png"><br><br>  So, we have dealt with the theoretical aspects of the need for disk encryption.  We know how to generate random numbers to secure keys, how to control block encryption modes used for full disk encryption, how to securely inherit a key for passwords, so we can assume that ‚Äúmission accomplished‚Äù, as President Bush said, speaking on board aircraft carrier.  But you know that this is not the case, and we still have a lot to do to complete it. <br><br>  Even if you have flawless cryptography and you know that it is almost impossible to crack it, in any case it should be implemented on a real computer, where you have no analogs of reliable black boxes.  An attacker does not need to attack cryptography if he tries to crack the full disk encryption.  To do this, he just needs to attack the computer itself or somehow deceive the user, convincing him to provide the password, or use a keylogger, etc. <br><br>  The actual use of encryption does not match the FDE security model.  If we consider software designed for full disk encryption, it can be seen that its creators paid a lot of attention to the theoretical aspects of encryption.  I will quote an excerpt from the technical documentation from the TrueCrypt website: ‚ÄúOur program will not protect any data on the computer if the attacker has physical access to the computer before starting or during TrueCrypt operation.‚Äù <br><br><img src="https://habrastorage.org/webt/qb/wo/l-/qbwol-kke9celsjbam5cafhwz1c.png"><br><br>  In principle, their entire security model looks like this: ‚Äúif our program correctly encrypts a disk and correctly decrypts it, we did our job.‚Äù  I apologize for the text shown on the next slide, if you find it difficult to read it, I will do it myself.  These are excerpts from the correspondence between the developers of TrueCrypt and security researcher Joanna Rutkowska about the attacks of the janitor. <br><br>  <b>TrueCrypt:</b> ‚ÄúWe never consider the possibility of hardware attacks, we just assume the worst.  Once the attacker has ‚Äúworked‚Äù on your computer, you just have to stop using it to store confidential information.  The TPM crypto processor is not able to prevent hardware attacks, for example, using keyloggers. <br><br>  Joanna Rutkovskaya asked them: ‚ÄúHow can you determine whether the attacker‚Äú worked ‚Äùon your computer or not, because you don‚Äôt carry a laptop with you all the time?‚Äù, To which the developers replied: ‚ÄúWe don‚Äôt care how the user ensures safety and security your computer.  For example, a user could use a lock or place a laptop while in his absence in a lockable cabinet or safe. ‚Äù  Joanna answered them very correctly: ‚ÄúIf I am going to use a lock or safe, why do I need your encryption at all‚Äù? <br><br><img src="https://habrastorage.org/webt/q4/zf/kw/q4zfkwnax1ibxqfixp9bcyq4fkm.png"><br><br>  Thus, ignoring the possibility of such an attack is a hoax, we cannot do that!  We live in the real world, where these systems exist, with which we interact and which we use.  There is no way to compare 10 minutes of attack, performed only with the help of software, for example, from a "flash drive", with something that you can perform by manipulating the system solely with the help of hardware. <br>  Thus, regardless of what they say, physical security and resistance to physical attacks depends on FDE.  It does not matter what you give up on your security model, and, at least, if they don‚Äôt want to take responsibility, they should be very clear and honest about how you can easily break the protection they offer. <br><br>  The next slide shows the scheme for downloading abstract FDE, which is used in most modern computers. <br><br><img src="https://habrastorage.org/webt/zj/nm/x4/zjnmx4fwgrllvtcoq17gh27txjo.jpeg"><br><br>  As we know, the bootloader is loaded from the SSD / HDD using the BIOS and copied to main memory on the data transfer path. Storage Controller - PCI Bus - Platform Controller Hub.  The bootloader then prompts the user for authentication data, such as a password or a smart card key.  Next, the password goes from the keyboard to the processor, after which the loader takes control, with both components ‚Äî the OS and the key ‚Äî remaining in memory in order to ensure the transparency of the disk encryption and decryption process.  This is an idealized view of the process, suggesting that no one will try to interfere in it in any way.  I think you know perfectly well how to hack it, so let's list the things that can go wrong if someone tries to attack you.  I divide the attacks into 3 levels. <br><br>  The first is non-invasive, not requiring the capture of your computer, as it is done with a flash drive with malware.  You do not need to ‚Äúdisassemble‚Äù the system if you can easily connect to it any hardware component such as a PCI card, Express Card or Thunderbolt ‚Äî the newest Apple adapter that provides open access to the PCI bus. <br><br>  A second-level attack will require a screwdriver, because you may need to temporarily remove some component of the system to deal with it in your own little environment.  The third level, or ‚Äúsoldering iron attack,‚Äù is the most difficult, here you physically either add or modify system components, such as chips, to try to crack them. <br><br>  One type of first-level attack is a compromised bootloader, also known as the evil maid attack, where you need to execute some unencrypted code as part of the system boot process, something you can download yourself using the user's personal information in order to get access to the rest of the data encrypted on your hard drive.  There are several different ways to do this.  You can physically change the boot loader in the storage system.  You can compromise the BIOS or download a malicious BIOS that will take control of the keyboard adapter or disk reading procedures and modify them so that they are resistant to removing the hard disk.  But in any case, you can modify the system so that when the user enters his password, he will be recorded on the disk in an unencrypted form, or do something similar, it will not be difficult for the hacker. <br><br>  You can do something similar at the operating system level.  This is especially true if you are not using full disk encryption, but container encryption. <br><br><img src="https://habrastorage.org/webt/mt/ni/ya/mtniyavlssz-8vevtjz8srgm30e.png"><br><br>  This can also occur when an exploit is attacked by a system, thanks to which the attacker gets root rights and can read the key from the main memory, this is a very common attack method.  This key can be stored on the hard disk as plain text for later use by the attacker or sent over the network to Command &amp; Control. <br>  Another possibility is keyboard interception using a keylogger, be it software, hardware, or something exotic, such as a needle-eye camera or, for example, a microphone that records sounds accompanying keystrokes by the user and tries to figure out what keys.  It is difficult to prevent such an attack, because it potentially includes components that are outside the system. <br><br><img src="https://habrastorage.org/webt/hc/ui/wa/hcuiwabn5w-fkbatkfpqkreqsmo.png"><br><br>  I would also like to mention data recovery attacks, better known as Cold Boot Attack ‚Äúcold boot attacks‚Äù.  If 5 years ago you asked even people who were very computer-savvy about the security characteristics of the main memory, they would say that when the power is turned off, the data disappears very quickly. <br><br>  But in 2008, excellent research was published by Princeton, who found that in fact, even at room temperature, there was very little data loss in RAM memory for a few seconds.  And if you cool the module to cryogenic temperatures, you can get a few minutes, during which only a slight degradation of data occurs in the main memory. <br><br><img src="https://habrastorage.org/webt/b1/a2/tg/b1a2tg-_mwqwirvlttmrv2o6hqk.png"><br><br>  Thus, if your key is in the main memory and someone has removed the modules from your computer, they can attack your key by finding out where it is in the main memory in the clear.  There are certain methods to counter this at the hardware level, for example, forcing the memory contents to be cleared when the power is turned off or when the computer is restarted, but this does not help if someone simply pulls out the module and places it in another computer or in a dedicated piece of equipment to extract the contents of its memory. <br>  Finally, there is the possibility of direct memory access.  Any PCI device in your computer can, in normal mode, read and write the contents of any sector to the main memory.  They can do anything. <br><br><img src="https://habrastorage.org/webt/-r/rh/3r/-rrh3rcsj6euky-iet7bhuvlufq.png"><br><br>  This was developed even when the computers were much slower and we didn‚Äôt want the CPU to ‚Äúnurse‚Äù with each data transfer to the device from the main memory.  Thus, devices get direct memory access, the processor can issue commands to them that they can simply complete, but the data will remain in memory whenever you need it. <br><br>  This is a problem because PCI devices can be reprogrammed.  Many of these things have a writeable firmware, which you can just reflash to something hostile.  And this may jeopardize the security of the entire operating system, as it will allow to carry out any form of attack, even modify the OS itself, or remove the key directly.  In computer forensics, there is equipment designed for such things in the process of investigating crimes: they connect something to your computer and pull out the contents of the memory.  You can do this with FireWire, ExpressCard, or Thunderbolt ... In fact, all these are external ports that provide access to the internal system bus. <br><br>  So, it would be nice if you could not store the key in RAM, because we sort of showed that the RAM is not very reliable from a security point of view.  Is there any dedicated keystore or special cryptographic equipment?  Yes there is.  You can use cryptographic accelerators for a web server to process more SSL transactions per second.  They are resistant to unauthorized interference.  CA certificate authorities have things that keep them completely secret keys, but in fact they are not intended for such high-performance operations as using disk encryption.  So are there any other options? <br><br>  Can we use the processor as a kind of pseudo-hardware crypto module?  Can we calculate something like a symmetric AES block cipher algorithm in the CPU, using instead of RAM only something like CPU registers? <br><br><img src="https://habrastorage.org/webt/bj/pd/kw/bjpdkwuxeizuqjtm9mocbdc2jz4.png"><br><br>  Intel and AMD have added great new instructions to their processors that have taken on the job of performing AES, so now you can perform primitive block encryption operations with just one simple assembly instruction.  The question is, can we keep our key in memory, or can we perform this process without relying on the main memory?  In modern x86 processors there is a rather large set of registers, and if one of you really tried to add all the bits that are in these, it turns out about 4 kilobytes.  Thus, we can actually use some CPUs to store keys and create space to perform encryption operations. <br><br>  One possibility is the use of hardware debug point registers.  In a typical Intel processor, there are 4 such registers, and in the x64 system, each of them will contain a 64-bit pointer.  This is 256 bits of potential disk space that most people will never use.  Of course, the advantage of using debug registers is their privilege, because only the operating system can access them.  There are other nice benefits here, for example, if you turn off the power of the processor when you turn off the system or go into sleep mode, you really lose all the contents of the register, so you can not be afraid of a ‚Äúcold reset‚Äù. <br><br>  The guy from Germany, Tilo Muller, implemented this similar thing called TRESOR for Linux in 2011.  He tested the performance of such a system and concluded that it works no slower than with regular calculation of AES software. <br>  How about storing two 128-bit keys instead of one key?  This will lead us to a larger crypto module space.  We can store one master key that never leaves the processor when it is loaded, and then load and unload the key versions we need to perform additional operations and solve additional tasks. <br><br>  The problem is that we can keep our code or our keys out of the main memory, but the CPU will still handle the contents of the memory anyway.  Thus, the use of DMA, direct memory access technology, bypassing the central processor, or other manipulations, allows you to change the operating system and keep its dump outside the main memory registers, or, if more exotic methods are used, outside the debug registers. <br><br>  Can we do something with a DMA angle of attack?  As it turned out, yes, we can.  Recently, as part of new technologies to increase server virtualization, for performance reasons, people like to be able to connect, say, a network adapter to a virtual server, so it must be connected through a hypervisor. <br><br><img src="https://habrastorage.org/webt/-3/ap/r_/-3apr_2afzefd8jwb2mhioywzl0.png"><br><br>  The IOMMU technology has been designed in such a way that you can isolate a PCI device in your own small memory section, from where it cannot read and write arbitrarily anywhere in the system.  This is ideal: we can configure the IOMMU permissions to protect our operating system or what we use to process keys, and protect them from random access. <br><br>  Again, our friend from Germany, Tilo Muller, implemented the TRESOR version on a microbit bit called BitVisor, which does this.  This allows you to run a separate operating system and transparently accesses disk encryption, and it's great that you do not need to take care of it or know something about it.       ,         ,  IOMMU   ,      - . <br><br><img src="https://habrastorage.org/webt/i-/8a/cb/i-8acb3e0p7hjlxna6jkhufintc.png"><br><br> ,  ,  ,    ,    ,    .  ,     ‚Äì     ,       . <br>     ,       ,                  . ,    RAM  ,     ,       .     ,   ,   , ,  SSH-,    PGP-,        ¬´ ¬ª,    . <br><br><img src="https://habrastorage.org/webt/gk/hs/s8/gkhss805ta69ipaclm8ez8apcvg.png"><br><br>      :     RAM? ,   ,    ,     ,     . <br><br><img src="https://habrastorage.org/webt/px/t9/0g/pxt90gqmfkbnaiwenzfetmxko8m.png"><br><br> , ,    ,   ‚Äì , !      2010             RAM.       ‚Äî       :        ‚Äúclear‚Äù,     ,      ,     .          10-50 .    ,   , ,  -,        ‚Äì    10% .  ,    .         ,         ,        ?      ,  TPM    ,      ,    ,      . <br><br>             -,            ,    .  , ,    -      CPU. <br><br> ,      .       ,   ,    ,           .   ,       ,   -     .     ,    ?       ,     .       ?   , -       ,    ,    ,    ‚Äú ‚Äù ,       . <br><br><img src="https://habrastorage.org/webt/xl/td/gg/xltdggql0pq_ttnsa-ushjg7hly.png"><br><br>  ,          .      ,     ,     .       ‚Äî    Trusted Platform Module ‚Äì  ,  .     ,      ,           ,    ,   TPM      .  ,   ¬´¬ª      ,     .       ,    ,    .  , ,   . <br><br><img src="https://habrastorage.org/webt/uu/as/qr/uuasqr7j_4jpdr24lfimbveabwg.png"><br><br>    ?            -. -   ,      - ¬´¬ª ,              .       ,           . <br><br>  ,       ‚Äì  -,      .      , RSA/SHA1,    ,        ,    -        .       -   ,                    .  ,        . <br><br> 23:10  <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/pKeiKYA03eE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br> <a href="https://habr.com/company/ua-hosting/blog/435178/">DEFCON 21.   ,   ¬´¬ª       .</a>  <a href="https://habr.com/company/ua-hosting/blog/435178/">Part 2</a> <br><br>  Thank you for staying with us.  Do you like our articles?  Want to see more interesting materials?  Support us by placing an order or recommending to friends, <b>30% discount for Habr users on a unique analogue of the entry-level servers that we invented for you:</b> <a href="https://habr.com/company/ua-hosting/blog/347386/">The whole truth about VPS (KVM) E5-2650 v4 (6 Cores) 10GB DDR4 240GB SSD 1Gbps from $ 20 or how to share the server?</a>  (Options are available with RAID1 and RAID10, up to 24 cores and up to 40GB DDR4). <br><br>  <b>VPS (KVM) E5-2650 v4 (6 Cores) 10GB DDR4 240GB SSD 1Gbps until spring for free</b> if you pay for a period of six months, you can order <a href="https://ua-hosting.company/vpsnl">here</a> . <br><br>  <b>Dell R730xd 2 times cheaper?</b>  Only we have <b><a href="https://ua-hosting.company/serversnl">2 x Intel Dodeca-Core Xeon E5-2650v4 128GB DDR4 6x480GB SSD 1Gbps 100 TV from $ 249</a> in the Netherlands and the USA!</b>  Read about <a href="https://habr.com/company/ua-hosting/blog/329618/">How to build an infrastructure building.</a>  <a href="https://habr.com/company/ua-hosting/blog/329618/">class c using servers Dell R730xd E5-2650 v4 worth 9000 euros for a penny?</a> </div><p>Source: <a href="https://habr.com/ru/post/435176/">https://habr.com/ru/post/435176/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../435166/index.html">Azure exams</a></li>
<li><a href="../435168/index.html">Bloodsuckers Programmer classification</a></li>
<li><a href="../435170/index.html">A look at the Apple Watch ECG of a person to whom it is vital</a></li>
<li><a href="../435172/index.html">Oculus GoBlack - How to Improve Oculus Go</a></li>
<li><a href="../435174/index.html">Unreal Engine 4 - burning shader</a></li>
<li><a href="../435178/index.html">DEFCON 21. Passwords alone are not enough, or why disk encryption ‚Äúbreaks down‚Äù and how it can be fixed. Part 2</a></li>
<li><a href="../435180/index.html">Serverless REST API "on the knee in 5 minutes"</a></li>
<li><a href="../435182/index.html">Study: HDD market will shrink by a third by 2021</a></li>
<li><a href="../435184/index.html">Artificial intelligence has learned to find Alzheimer's disease in the brain for 6 years before being diagnosed</a></li>
<li><a href="../435186/index.html">Rolls-Royce develops the fastest electric aircraft in the world</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>