<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Umbraco CMS MVC - own controller and beautiful url</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="CMS Umbraco I have been studying for several months. It so happened that the main application of my research efforts was directed to the latest 7th ve...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Umbraco CMS MVC - own controller and beautiful url</h1><div class="post__text post__text-html js-mediator-article">  CMS Umbraco I have been studying for several months.  It so happened that the main application of my research efforts was directed to the latest 7th version of this system to date, moreover in the context of its work on the MVC engine, as an alternative to the web forms of previous versions. <br><br>  At some point, while developing the site of one company, I wanted to put the news repository of this company into a separate top-level element in the content tree.  In the examples and video instructions posted on the Umbraco website, the simplest version of such an organization is offered - news is stored as children of some menu item (Fig. 1).  As an example, in the section ‚ÄúFrom which side to approach Umbraco‚Äù, this approach is justified, but on a live site, where there are tens and hundreds of news, it looks rather clumsy.  To work with the news, the site editor will need to go deep into the content tree - <i>Home-News-SeparateNews</i> .  And the very concept of such an approach does not suit me very much - a list of news suddenly appears in the section of items on the multilevel menu ... <br><a name="habracut"></a><br><br><img src="https://habrastorage.org/getpro/habr/post_images/ae5/51d/948/ae551d948a0cfc8e67537b014982281c.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Another option looks more preferable, as in Figure 2 - the node containing news is a separate top-level element of the content tree. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/03e/ed7/275/03eed7275cc3f38e3689abd4afcfb230.png" alt="image"><br><br>  Moreover, when organizing access to news by reference, I wanted them to have a beautiful canonical appearance: <br><br><ul><li>  / News - list of all news; </li><li>  / News / 1234 - conclusion of a separate news; </li><li>  / News / Page12 - go to the news list page. </li></ul><br>  The MVC paradigm for solving this problem assumes the presence of a controller and a view (in this case, the model is not used).  Since everything is done ‚Äúunder the wing‚Äù of Umbraco, we cannot take and implement the news controller, inheriting it from the <b>Controller</b> class - nothing will happen.  Documentation on Umbraco suggests to inherit from the <b>SurfaceController</b> class that specifically exists in the infrastructure of this CMS.  Everything would be fine, but in this case, the links for which the controller's actions are called take the form " <i>/ umbraco / surface / _controllername _ / _ actionname_</i> ".  Such a url structure looks rather cumbersome, and from the point of view of search indexing, a page with a similar url is perceived as deeply hidden in the structure of the site, which probably reduces its search significance. <br><br>  The study of this issue led to the following solution - you need to inherit not from the <b>SurfaceController</b> class, but from <b>PluginController</b> .  In this case, links are generated by MVC canons, as required.  However, it is necessary to take into account some additional circumstances.  Below is a complete solution to this problem.  So: <br><br><h4>  Routs </h4><br>  Routes are not registered in the <i>App_Start / RouteConfig.cs</i> file, which is <i>normally</i> called <i>RouteConfig.RegisterRoutes (RouteTable.Routes)</i> in <i>Global.asax</i> .  In Umbraco MVC for <b>PluginController</b> classes, <b>routes are</b> written in the file <i>App_Code / Startup.cs</i> .  In this file, we declare a class implementing the <b>IApplicationEventHandler</b> interface.  It looks like this: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyStartupHandler</span></span> : <span class="hljs-title"><span class="hljs-title">IApplicationEventHandler</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnApplicationStarted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">UmbracoApplicationBase umbracoApplication, ApplicationContext applicationContext</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//Create a custom routes // News controller RouteTable.Routes.MapRoute( "", "News", new { controller = "News", action = "Index", page = 1 }); RouteTable.Routes.MapRoute( "", "News/Index", new { controller = "News", action = "Index", page = 1 }); RouteTable.Routes.MapRoute( "", "News/Page{page}", new { controller = "News", action = "Index", page = UrlParameter.Optional }); RouteTable.Routes.MapRoute( "", "News/{id}", new { controller = "News", action = "News", id = UrlParameter.Optional }); } public void OnApplicationInitialized( UmbracoApplicationBase umbracoApplication, ApplicationContext applicationContext) { } public void OnApplicationStarting( UmbracoApplicationBase umbracoApplication, ApplicationContext applicationContext) { } }</span></span></code> </pre> <br><br><h4>  Controller </h4><br>  The controller is created in the usual way in a file located in the <i>Controllers</i> folder.  As mentioned, the controller class inherits the <b>PluginController</b> class.  It looks like this: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">NewsController</span></span> : <span class="hljs-title"><span class="hljs-title">PluginController</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NewsController</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">UmbracoContext.Current</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NewsController</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">UmbracoContext umbracoContext</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">umbracoContext</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Index</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">/*   ,            -   ,     .. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> View(<span class="hljs-string"><span class="hljs-string">"News"</span></span>, CreateRenderModel(renderModel)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> RenderModel </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateRenderModel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IPublishedContent content</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> model = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RenderModel(content, CultureInfo.CurrentUICulture); <span class="hljs-comment"><span class="hljs-comment">//add an umbraco data token so the umbraco view engine executes RouteData.DataTokens["umbraco"] = model; return model; } }</span></span></code> </pre><br>  This requires one clarification.  The news node search code returns an <b>IPublishedContent</b> or <b>IEnumerable &lt;IPublishedContent&gt;</b> interface type object.  However, Umbraco requires that views called from <b>PluginController</b> 'a be strongly typed and accept a <b>RenderModel</b> type model.  To do this, the controller declares the private method <i>CreateRenderModel</i> , which from <b>IPublishedContent</b> creates an object of the required type. <br><br><h4>  Representation </h4><br>  The representation is created according to the standard scheme, there are no nuances in terms of solving this problem. <br><br><h4>  Side effect </h4><br>  The use of this approach revealed one side effect, namely, the impossibility of using macros in content on pages that are invoked in this way.  An error occurs with the definition of ‚Äú <i>PublishedContentRequest missing</i> ‚Äù.  As I understand it, it is connected with the fact that the document displayed through such a controller does not go through all the stages of parsing Umbraco, in the process of which this most <b>PublishedContentRequest</b> is created, from which the macro generation code is repelled.  It is comforting that working with macros when using MVC partial views becomes less popular.  In addition, the creators of Umbraco themselves say that the code that implements the macro call from Rich-text-content is rather confused and bears the serious imprint of a heavy pre-emotic past ... <br><br><h4>  Links </h4><br>  <a href="http://our.umbraco.org/documentation/reference/mvc/surface-controllers">Surface Controllers</a> <br>  <a href="http://shazwazza.com/post/Custom-MVC-routing-in-Umbraco">Custom MVC routing in Umbraco</a> </div><p>Source: <a href="https://habr.com/ru/post/227683/">https://habr.com/ru/post/227683/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../227667/index.html">Developing (soccer) games using MonoGame</a></li>
<li><a href="../227669/index.html">Mars rover Curiosity completed the main scientific mission</a></li>
<li><a href="../227671/index.html">We Are the Dwarves! - domestic tactical action on Kickstarter</a></li>
<li><a href="../227675/index.html">IPega PG-9025 Gamepad Review: Turning an Android-Smartphone into a Portable Console</a></li>
<li><a href="../227679/index.html">The fall of the last intellectual bastion: is a computer chess player really stronger than a man?</a></li>
<li><a href="../227685/index.html">Development of code-based UE4 projects for iOS in Windows</a></li>
<li><a href="../227687/index.html">How to take over the world, proving that P = NP</a></li>
<li><a href="../227689/index.html">The password from the Wifi-network security center World Cup 2014 was broadcast on the screen and hit the photo of the local newspaper</a></li>
<li><a href="../227691/index.html">Snap is a new reporting platform. Part 1</a></li>
<li><a href="../227697/index.html">FreeWavz: advanced Bluetooth stereo headset with fitness tracker</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>