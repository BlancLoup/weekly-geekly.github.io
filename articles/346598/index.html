<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We connect devices of the Internet of things and Azure by means of NodeJS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="To work with the Internet of things, various more serious devices are often used that can support NodeJS. An example of such a device could be one of ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We connect devices of the Internet of things and Azure by means of NodeJS</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/qd/us/ji/qdusjimwzaahm7tqmz6yrr_ozis.jpeg"></div><br>  To work with the Internet of things, various more serious devices are often used that can support NodeJS.  An example of such a device could be one of the most popular maker cards Raspberry PI.  Therefore, I could not ignore this topic and decided to deal with how supporting NodeJS devices can work with Azure IoT hub. <br><br>  In addition, under the cat is considered the possibility of protecting the connection with an SSL certificate and the process of creating a self-signed certificate. <br><a name="habracut"></a><br>  Download and install NodeJS.  English manual how to do it is available here: <br>  <a href="https://nodejs.org/en/download/package-manager/">Installing Node.js via package manager</a> <br><br>  Create a new directory.  Open CMD or Bash, and go to the created directory <br>  We execute the command 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="bash hljs">npm init</code> </pre> <br>  As a result of answering questions, a package.json file will be created. <br><br>  Install a couple of packages with the command: <br><br><pre> <code class="bash hljs">npm install azure-iot-device azure-iot-device-mqtt ‚Äìsave</code> </pre> <br>  In this example, we use the MQTT protocol, which does not contain unnecessary information, has not so many possibilities, but is specifically designed for IoT devices. <br><br>  Create some js file.  Suppose a file named index.js.  Now, let's add the following code to the file and look at it: <br><br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   require('package-name')       var clientFromConnectionString = require('azure-iot-device-mqtt').clientFromConnectionString; var Message = require('azure-iot-device').Message; var connectionString = 'HostName=ArduinoDemoHub.azure-devices.net;DeviceId=ArduinoAzureTwin;SharedAccessKey=Fqve19DXyMOx3vQI63eHxW0bK6VmT+R6iqPK23vhdiQ='; var client = clientFromConnectionString(connectionString); function printResultFor(op) { return function printResult(err, res) { if (err) console.log(op + ' error: ' + err.toString()); if (res) console.log(op + ' status: ' + res.constructor.name); }; } var connectCallback = function (err) { if (err) { console.log('Could not connect: ' + err); } else { console.log('Client connected'); // ¬´¬ª   writeLine      client.onDeviceMethod('writeLine', onWriteLine); //       IoT Hub   setInterval(function(){ var iotdata = Math.round((Math.random() * 25)); var data = JSON.stringify({ deviceId: 'ArduinoAzureTwin', iotdata: iotdata }); var message = new Message(data); console.log("Sending message: " + message.getData()); client.sendEvent(message, printResultFor('send')); }, 1000); } }; function onWriteLine(request, response) { response.send(200, 'Input was written to log.', function(err) { if(err) { console.error('An error ocurred when sending a method response:\n' + err.toString()); } else { console.log('Response to method \'' + request.methodName + '\' sent successfully.' ); } }); } client.open(connectCallback);</span></span></code> </pre> <br>  Of course, you should have created an IoT hub and you should replace the connection string from the code with your own.  In my example, the data is sent with the names deviceId and iotdata.  You can send some of your data. <br><br>  You can run the code with the command <br><br><pre> <code class="bash hljs">node index.js</code> </pre> <br>  If done correctly, the result should be something like this: <br><br><img src="https://habrastorage.org/webt/lv/hh/jv/lvhhjvk0qyuu4hyq9d0f6qphuge.png"><br><br>  Links to official manuals: <br><br>  <a href="https://docs.microsoft.com/ru-ru/azure/iot-hub/iot-hub-node-node-getstarted">Connecting a virtual device to the IoT Center using Node</a> <br>  <a href="https://docs.microsoft.com/ru-ru/azure/iot-hub/iot-hub-node-node-direct-methods">Using direct methods on the Internet of Things device (Node.js)</a> <br><br>  It all works, but not very well done in terms of security. <br>  In order to secure the connection, you can use TLS X.509 certificates.  In production, of course, it is better to use certificates issued by any certifying center.  But you can use self-signed certificates for testing.  Let's create one and protect the connection. <br><br>  To create a certificate, I initially thought of using the makecert application, but it turned out that it was already considered obsolete.  So I decided to use PowerShell scripts. <br><br>  Open Powershell with admin rights.  We execute the following command, specifying after CN = the name you want to name the certificate: <br><br><pre> <code class="hljs php">$cert = <span class="hljs-keyword"><span class="hljs-keyword">New</span></span>-SelfSignedCertificate -Type Custom -KeySpec Signature ` -Subject <span class="hljs-string"><span class="hljs-string">"CN=AlexRootCert"</span></span> -KeyExportPolicy Exportable ` -HashAlgorithm sha256 -KeyLength <span class="hljs-number"><span class="hljs-number">2048</span></span> ` -CertStoreLocation <span class="hljs-string"><span class="hljs-string">"Cert:\CurrentUser\My"</span></span> -KeyUsageProperty Sign -KeyUsage CertSign</code> </pre> <br>  Now you can open the <i><b>certmgr.msc</b></i> utility and find your certificate in the <i>Certificates - Current User / Certificates</i> folder. <br><br>  The certificate must be exported as follows (without a private key): <br><br><img src="https://habrastorage.org/webt/n6/yr/yu/n6yryunuht66kaurhdfmze6wixw.png"><br><br><img src="https://habrastorage.org/webt/1i/09/6x/1i096xqu7-8195faou-hwicsuua.png"><br><br><img src="https://habrastorage.org/webt/vb/xo/u7/vbxou7wwa1_mhlotgwewqhpgsq8.png"><br><br>  We will later upload this certificate to IoT Hub. <br><br>  After generating the root certificate, it is advisable not to close the Powershell window.  If you have not closed it, then generating the client certificate will be quite easy for you.  After all, you can use the $ cert variable. <br><br>  If closed, then read the <a href="https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-certificates-point-to-site">official documentation</a> (look for Example 2 there).  Or open the spoiler and read my description of how to declare the variable cert. <br><br><div class="spoiler">  <b class="spoiler_title">how can I declare a variable cert</b> <div class="spoiler_text">  We execute the command <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-ChildItem -<span class="hljs-type"><span class="hljs-type">Path</span></span> "Cert:\CurrentUser\My"</code> </pre> <br>  We get something like this: <br><br>  PSParentPath: Microsoft.PowerShell.Security \ Certificate :: CurrentUser \ My <br>  Thumbprint Subject <br>  - - FDF386B2AE761CBDD5A111CEF047CC5419F9425A CN = AlexRootCert <br><br>  From this answer, copy the Thumbprint certificate and paste it into the command: <br><pre> <code class="hljs tex"><span class="hljs-formula"><span class="hljs-formula">$cert = Get-ChildItem -Path "Cert:</span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">CurrentUser</span></span></span></span></span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">My</span></span></span></span></span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">FDF</span></span></span></span></span><span class="hljs-formula">386B2AE761CBDD5A111CEF047CC5419F9425A"</span></span></code> </pre> <br></div></div><br>  Create a client certificate.  There is no need to change anything other than the name of the certificate being created in the command. <br><br><pre> <code class="hljs mel">New-SelfSignedCertificate -Type Custom -KeySpec Signature <span class="hljs-string"><span class="hljs-string">` -Subject "CN=AlexClientCert" -KeyExportPolicy Exportable `</span></span> -HashAlgorithm sha256 -KeyLength <span class="hljs-number"><span class="hljs-number">2048</span></span> <span class="hljs-string"><span class="hljs-string">` -CertStoreLocation "Cert:\CurrentUser\My" `</span></span> -Signer $cert -TextExtension @(<span class="hljs-string"><span class="hljs-string">"2.5.29.37={text}1.3.6.1.5.5.7.3.2"</span></span>)</code> </pre> <br>  Now let's load the first generated certificate into the IoT hub.  To download the root certificate, go to the IoT hub in the certificates section. <br><br><img src="https://habrastorage.org/webt/ji/lk/ph/jilkph96vevq-ccvaoqzol_ygaq.png"><br><br><img src="https://habrastorage.org/webt/wq/y9/m8/wqy9m8k6vj0sfnrhnvfwdgbbwvo.png"><br><br>  Since it is self-signed with us, it will be displayed as ‚ÄúUnverified‚Äù.  Certificate confirmation is called Proof of possession.  Open the certificate properties window and scroll down to the last two fields. <br><br><img src="https://habrastorage.org/webt/hl/t4/wa/hlt4wabdsqdmj1jn2fr550ejvb0.png"><br><br>  Click the button ‚ÄúGenerate Verification Code‚Äù and copy the generated code.  Again, open PowerShell and run the following code: <br><br><pre> <code class="hljs mel">function New-CASelfsignedCertificate([<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]$subjectName, [object]$signingCert, [bool]$isASigner=$true) { # Build up argument list $selfSignedArgs =@{<span class="hljs-string"><span class="hljs-string">"-DnsName"</span></span>=$subjectName; <span class="hljs-string"><span class="hljs-string">"-CertStoreLocation"</span></span>=<span class="hljs-string"><span class="hljs-string">"cert:\LocalMachine\My"</span></span>; <span class="hljs-string"><span class="hljs-string">"-NotAfter"</span></span>=(get-<span class="hljs-keyword"><span class="hljs-keyword">date</span></span>).AddDays(<span class="hljs-number"><span class="hljs-number">30</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($isASigner -eq $true) { $selfSignedArgs += @{<span class="hljs-string"><span class="hljs-string">"-KeyUsage"</span></span>=<span class="hljs-string"><span class="hljs-string">"CertSign"</span></span>; } $selfSignedArgs += @{<span class="hljs-string"><span class="hljs-string">"-TextExtension"</span></span>= @((<span class="hljs-string"><span class="hljs-string">"2.5.29.19={text}ca=TRUE&amp;pathlength=12"</span></span>)); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $selfSignedArgs += @{<span class="hljs-string"><span class="hljs-string">"-TextExtension"</span></span>= @(<span class="hljs-string"><span class="hljs-string">"2.5.29.37={text}1.3.6.1.5.5.7.3.2,1.3.6.1.5.5.7.3.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"2.5.29.19={text}ca=FALSE&amp;pathlength=0"</span></span>) } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($signingCert -ne $null) { $selfSignedArgs += @{<span class="hljs-string"><span class="hljs-string">"-Signer"</span></span>=$signingCert } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($useEcc -eq $true) { $selfSignedArgs += @{<span class="hljs-string"><span class="hljs-string">"-KeyAlgorithm"</span></span>=<span class="hljs-string"><span class="hljs-string">"ECDSA_nistP256"</span></span>; <span class="hljs-string"><span class="hljs-string">"-CurveExport"</span></span>=<span class="hljs-string"><span class="hljs-string">"CurveName"</span></span> } } # Now use splatting to process this Write-Host (<span class="hljs-string"><span class="hljs-string">"Generating certificate {0} which is for prototyping, NOT PRODUCTION. It will expire in 30 days."</span></span> -f $subjectName) write (New-SelfSignedCertificate @selfSignedArgs) } function New-CAVerificationCert([<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]$requestedSubjectName) { $cnRequestedSubjectName = (<span class="hljs-string"><span class="hljs-string">"CN={0}"</span></span> -f $requestedSubjectName) $verifyRequestedFileName = <span class="hljs-string"><span class="hljs-string">"D:\verifyCert4.cer"</span></span> $ert = Get-ChildItem -Path <span class="hljs-string"><span class="hljs-string">"Cert:\CurrentUser\My\FDF386B2AE761CBDD5A111CEF047CC5419F9425A"</span></span> Write-Host <span class="hljs-string"><span class="hljs-string">"Using Signing Cert:::"</span></span> Write-Host $ert $verifyCert = New-CASelfsignedCertificate $cnRequestedSubjectName $ert $false Export-Certificate -cert $verifyCert -filePath $verifyRequestedFileName -Type Cert <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (-not (Test-Path $verifyRequestedFileName)) { throw (<span class="hljs-string"><span class="hljs-string">"Error: CERT file {0} doesn't exist"</span></span> -f $verifyRequestedFileName) } Write-Host (<span class="hljs-string"><span class="hljs-string">"Certificate with subject {0} has been output to {1}"</span></span> -f $cnRequestedSubjectName, (Join-Path (get-location).path $verifyRequestedFileName)) } New-CAVerificationCert <span class="hljs-string"><span class="hljs-string">"8957B1DCD5D19DDFD06BFCC90A9B740C9EF7B4DBEC84C5AB"</span></span></code> </pre> <br>  In this code, we insert the verification code from Azure into the last line.  And in the line: <br><br><pre> <code class="hljs pgsql">$ert = <span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-ChildItem -<span class="hljs-type"><span class="hljs-type">Path</span></span> "Cert:\CurrentUser\My\FDF386B2AE761CBDD5A111CEF047CC5419F9425A"</code> </pre> <br>  Insert the thumbprint, which we received earlier from the Root certificate.  Or, if you didn‚Äôt close Powershell right from the start, you can delete this line. <br><br>  If you wish, you can change the directory and the name of the certificate to be created.  After the file is created, upload it to the IoT Hub. <br><br>  Now you need to create a device twin.  In IoT Hub, open the menu item ‚ÄúIoT Devices‚Äù.  We choose the type of authentication X.509 Self-Signed and understand that we are asked to imprint a certificate.  And even 2 prints. <br><br><img src="https://habrastorage.org/webt/aa/sa/rx/aasarxsgpd3xpjz0nddhp-ehins.png"><br><br>  We go to the certificate manager certmgr.msc and click on the client certificate twice.  A property window will open where you can find what you need: <br><br><img src="https://habrastorage.org/webt/zo/ox/ew/zooxewsx93rxviccongxaxqcz1y.png"><br><br>  The Thumbprint value is copied and pasted into the device's twin creation window.  The second imprint is requested for special scenarios in which the certificate can be replaced on the fly with a spare one. <br><br>  That's not all.  We need to export a client certificate without a private key (as a cer) and with a private key (in pxf format).  From the exported client certificate in the pxf format, you must create a key file in the pem format. <br><br>  A client certificate without a private key is exported in the same way as we have already exported the root certificate.  But in pfx format the certificate is exported in the same way as the root certificate is exported in order to install it on another computer: <br><br><img src="https://habrastorage.org/webt/lz/mr/4e/lzmr4eotrjyja26c5tccmvpev7w.png"><br><br><img src="https://habrastorage.org/webt/j7/w5/k7/j7w5k7tjcp_yjmrnef_wr-8eeia.png"><br><br>  If you do not enable the Enable certificate privacy option, then the contents of the certificate will remain unencrypted.  Protection will be applied only to the private key.  The contents of the certificate can be viewed with certutil. <br><br>  Export extended extended properties applies only to the Microsoft platform and exports some additional information. <br><br><img src="https://habrastorage.org/webt/2d/oe/aa/2doeaawuinacoczxi41uzxspnie.png"><br><br>  To create a pem file we need OpenSSL.  You can use WSL to install OpenSSL on Windows.  Install Ubuntu from Microsoft Store and then install OpenSSL <br><br><pre> <code class="bash hljs">sudo apt-get update sudo apt-get install openssl</code> </pre> <br>  Now you need to use the cd command to go to the directory with the certificate and execute the following command: <br><br><pre> <code class="bash hljs">openssl pkcs12 -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> alex-client-cert.pfx -out key.pem -nodes</code> </pre> <br>  The command specifies the name of the existing certificate and the name of the pem file to be created. <br><br>  Alternatively, you can use the following utility: <a href="https://slproweb.com/products/Win32OpenSSL.html">Win64 OpenSSL v1.0.2n</a> <br>  Go to the directory of the installed utility (I have C: \ OpenSSL-Win64 \ bin) and run the following command: <br><br><pre> <code class="bash hljs">.\openssl pkcs12 -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> D:\iotapp\alex-client-cert.pfx -out D:\iotapp\key.pem -nodes</code> </pre> <br>  It remains to change our code to code protected by a certificate.  As an example, I used the following: <a href="">simple_sample_device_x509.js</a> <br><br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> clientFromConnectionString = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'azure-iot-device-mqtt'</span></span>).clientFromConnectionString; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Message = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'azure-iot-device'</span></span>).Message; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> connectionString = <span class="hljs-string"><span class="hljs-string">'HostName=ArduinoDemoHub.azure-devices.net;DeviceId=NodeTwin;x509=true'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> certFile = <span class="hljs-string"><span class="hljs-string">'alex-client-cert.cer'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyFile = <span class="hljs-string"><span class="hljs-string">'key.pem'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> passphrase = <span class="hljs-string"><span class="hljs-string">'KJu86Hfjw3jG'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> client = clientFromConnectionString(connectionString); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printResultFor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">op</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printResult</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, res</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(op + <span class="hljs-string"><span class="hljs-string">' error: '</span></span> + err.toString()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (res) <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(op + <span class="hljs-string"><span class="hljs-string">' status: '</span></span> + res.constructor.name); }; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> connectCallback = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Could not connect: '</span></span> + err); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Client connected'</span></span>); client.onDeviceMethod(<span class="hljs-string"><span class="hljs-string">'writeLine'</span></span>, onWriteLine); <span class="hljs-comment"><span class="hljs-comment">// Create a message and send it to the IoT Hub every second setInterval(function(){ var iotdata = Math.round((Math.random() * 25)); var data = JSON.stringify({ deviceId: 'ArduinoAzureTwin', iotdata: iotdata }); var message = new Message(data); console.log("Sending message: " + message.getData()); client.sendEvent(message, printResultFor('send')); }, 1000); } }; function onWriteLine(request, response) { console.log('sdfdsf'); response.send(200, 'Input was written to log.', function(err) { if(err) { console.error('An error ocurred when sending a method response:\n' + err.toString()); } else { console.log('Response to method \'' + request.methodName + '\' sent successfully.' ); } }); } var options = { cert : fs.readFileSync(certFile, 'utf-8').toString(), key : fs.readFileSync(keyFile, 'utf-8').toString(), passphrase: passphrase }; client.setOptions(options); client.open(connectCallback);</span></span></code> </pre> <br>  Link to the official manual: <br><br>  <a href="https://docs.microsoft.com/ru-ru/azure/iot-hub/iot-hub-security-x509-get-started">Configuring an X.509 Security Certificate in Azure Internet of Things</a> </div><p>Source: <a href="https://habr.com/ru/post/346598/">https://habr.com/ru/post/346598/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346584/index.html">How to do typical tasks in a web application on React JS</a></li>
<li><a href="../346586/index.html">How to build a community. Translation of the book "Social Architecture": The Myth of Individual Intelligence</a></li>
<li><a href="../346588/index.html">Remote work, is it good or bad?</a></li>
<li><a href="../346590/index.html">How I determined the provider by IP</a></li>
<li><a href="../346594/index.html">How I reinvent the media center</a></li>
<li><a href="../346600/index.html">Unusual multiplication system</a></li>
<li><a href="../346604/index.html">The digest of interesting materials for the mobile developer # 236 (January 8 - January 14)</a></li>
<li><a href="../346606/index.html">Learned Telegram chat bot with AI in 30 lines of Python code</a></li>
<li><a href="../346608/index.html">We test user scripts with Hermione. Yandex lecture</a></li>
<li><a href="../346610/index.html">Reasoning around systems engineering and comments on "Richard Hamming: Chapter 28. Systems Engineering"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>