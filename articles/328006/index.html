<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÄúThe incident with Gitlab is a very good and revealing story‚Äù, - Alexey Lesovsky about PostgreSQL administration</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Friends, today's publication opens a new section in the blog of the PG Day Russia conference: interviews with experts in the field of database mainten...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>‚ÄúThe incident with Gitlab is a very good and revealing story‚Äù, - Alexey Lesovsky about PostgreSQL administration</h1><div class="post__text post__text-html js-mediator-article"> <i>Friends, today's publication opens a new section in the blog of the <a href="http://pgday.ru/ru/2017%3Futm_source%3D_habr%26utm_medium%3Dpost%26utm_campaign%3Dlesovsky"><b>PG Day Russia</b></a> conference: interviews with experts in the field of database maintenance.</i>  <i>A conversation with a professional is a great opportunity to lift the veil of secrecy, learn the secrets of the profession, find out what and how the colleagues who have dedicated their lives to work with the DBMS earn.</i>  <i>We hope that the upcoming issues will help you to look at the workflow from a new perspective, give you the opportunity to ask your question, get advice, or navigate further steps along your own career path.</i> <i><br><br></i>  <i>In our pilot interview, we spoke with <b><a href="http://pgday.ru/ru/2017/speakers/80%3Futm_source%3D_habr%26utm_medium%3Dpost%26utm_campaign%3Dlesovsky">Alexey Lesovsky</a></b> , DBA from Data Egret (formerly PostgreSQL-Consulting).</i>  <i>Alexey is a specialist with many years of experience in the administration of PostgreSQL.</i>  <i>Regular visitors to technical conferences know, not by hearsay, that his reports and master classes are renowned for the depth of work and attention to detail.</i> <br><br>  <b>PG Day</b> : <i>Lesha, let's start with introductory information.</i>  <i>Tell me briefly about yourself, how did you decide to become a DBA and how did you even get to such a life?</i> <i><br></i> <br>  <b>AL</b> : In general, I didn‚Äôt have an idea to become a DBA.  I did not seek this.  I worked as a system administrator in a company that was involved in web projects, administered Linux servers, was engaged in virtualization.  Their whole stack was built on modern technology.  There were rails, there were memekashi, radishes and there was Postgres. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/86b/7a3/d09/86b7a3d09c1d4ed18173eb4a47c49479.jpg"><br><a name="habracut"></a><br>  The team got tired of fussing around MySQL at some point, and they decided to transfer existing projects to Postgres. So I administered Postgres there as well.  At first it was tasks from the series to see something, add, change rights, roll out staging for developers.  Gradually, the range of tasks expanded.  My colleagues and I carried out upgrades from the major versions and did it quite extraordinarily, not according to official documentation.  Resorted to all sorts of interesting tools.  As a result, I got carried away with databases, got carried away with Postgres. <br><br>  Then I got a job at another company, where I met my future colleagues from the consulting field (Data Egret - Ed.), They worked as separate DBAs.  We became friends and I went to work for them and became fully engaged in the administration of Postgres, database administration.  And here practically I am not engaged more in Linux.  I haven't been busy with administration for a long time.  But with Linux and with PostgreSQL I still work. <br><br>  <b>PG Day</b> : <i>Despite the fact that you do not administer Linux, you still have very extensive experience, and you talk a lot about it.</i>  <i>I think everyone will be interested in how you will learn some new things about Linux, what do you use for this?</i>  <i>How do you maintain your skill level?</i> <br><br>  <b>AL</b> : First of all, this is <b><a href="https://lwn.net/">LWN mailing</a></b> .  There are a lot of announcements there, what is happening in Linux itself, in its core, what changes and innovations are a very cool resource.  In addition, I read <a href="https://planet.postgresql.org/"><b>PostgreSQL Planet</b></a> - this is such a blog aggregator dedicated to PostgreSQL, contains many blogs and new articles are published very often.  There is still a very good resource http://highscalability.com, it is dedicated to productivity: how big companies solve their IT problems.  Very informative blog. <br><br>  And, of course, I read a <b>lot of official documentation</b> .  Postgres is a very complicated thing, there are so many things that I still don‚Äôt know.  And all this can be found in the official documentation.  But, if something is not in the documentation, you can always read the source code for PostgreSQL.  The code is very well and thoroughly documented.  You can always open the source code, start from some place and slowly get to the moment you need, see, search and find what interests you. <br><br>  <b>PG Day</b> : <i>Since we're talking about Linux, what tools do you use for your daily work with Linux?</i>  <i>What do you think is most important in the first place?</i> <br><br>  <b>AL</b> : At home, I have <b>Gentoo Linux</b> on my computer, I have been using this distribution for a long time, I consider it fairly reliable and stable.  The <b>desktop</b> environment is <b>KDE</b> , the terminal is yakuake, a very convenient Quake-like console that appears on hotkeys.  Then everything is more or less standard - Chrome, Skype, Slack, Telegram, Libre Fffice, vim.  There is also an offline program for taking notes - Keepnote, in it I keep notes, the knowledge base, todo lists.  There used to be an even more cool <b>Mytetra</b> , but notes began to disappear in it, there were problems with the launch, and I left it.  And if a business trip happens, I take a laptop with Windows, on which almost everything is the same.  In general, no exotic. <br><br>  The most important thing, I, of course, consider the availability of the Internet, given that I work from home and have the opportunity to work from anywhere in the world, it is important for me that there is Internet.  It is also important to have an <b>SSH client</b> , SSH is such a protocol for working with remote Linux servers and in general, wherever there is an SSH daemon.  In general, the most important is the Internet and SSH-client.  And if I work on a Windows workstation, Putty is enough for me.  I connect to the servers, I just have a plain text console, which is provided by SSH, and a command shell.  There I already work with the servers themselves and use the utilities. <br><br>  What <b>utilities</b> do I use on the servers?  This is a standard admin set, quite simple.  The <b>top</b> command, commands from the <b>sysstat package</b> .  If you need to look at something more specific, related to hardware or drivers, then utilities that are designed for specific hardware are used. <br><br>  But the main utility is, of course, <b>top</b> .  Everything always begins with it.  If you need to look at something, determine where to dig further, I open the top, I look, I plan to move further. <br><br>  <b>PG Day</b> : <i>Basically, in your work, the tools are usually quite household and standard.</i>  <i>But have there ever been occasions when you had to dig deep, use some non-trivial solutions?</i>  <i>Maybe even write some patches?</i>  <i>Has he encountered such situations in his practice?</i> <br><br>  <b>AL</b> : I‚Äôll say right away that I didn‚Äôt have to write patches, and I don‚Äôt plan much in the future, because this is a very long workflow.  There are a lot of instructions on this topic, how to become a developer of the Linux kernel or Postgres, how to execute, send, receive patches, how to interact with the community. <br><br>  But, nevertheless, complex and initially incomprehensible problems are periodically encountered, and there are tools with which to dig.  Tools, as a rule, are also quite specific.  They have kilometer pages of documentation and at first it is very difficult to use them, especially for beginners.  But, nevertheless, when you use them often, you gradually understand what keys are and when to use them.  Basically, these are the <b>strace</b> and <b>ltrace</b> utilities, if our program crashes with some kind of error or segfault occurs, or some kind of abnormal behavior that terminates the program.  What do these utilities do?  They allow you to keep track of which system and library calls the program performs during its operation.  Very often they have to be combined with command line tools, for example, run in cycles or only when certain conditions occur. <br><br>  Another utility from the same series is <b>perf</b> .  This is such a powerful hammer that allows you to dig deep into what the program does.  I launch perf, I specify parameters for the analysis and tracing.  The program collects information.  She gets the output file, which is then either analyzed using the same perf or other auxiliary scripts.  But these programs have a rather high threshold of entry and you can use common examples that are given in the documentation.  But gradually you need to understand what you can explore with these programs and somehow check, test, watch on combat loads.  This requires experience and practice. <br><br>  <b>PG Day</b> : <i>Recently, you started a lot of lectures, master classes, trainings.</i>  <i>Tell us about your impressions of this experience.</i>  <i>What are people who come to your shows interested in?</i>  <i>What do you like when working with the audience?</i> <br><br>  <b>AL</b> : Yes, that's right, I have been giving lectures, reports, speaking with master classes, I have been doing this for two years now.  I started in 2014. I like to talk about what <b>experience</b> I have, what <b>practical scenarios</b> I have, <b>cases</b> have been in work, and this is the main thing.  You can not tell the reports and master classes, if you have to deal with it. <br><br>  In my reports I try to always pay attention to the <b>practical side of exploitation</b> , that is, less theory and more practice.  What I encountered in my work, what problems, how we solved them with colleagues or independently.  I try to cover all this in my reports.  I hope that people go to my reports precisely because of this, because of the practical aspects of the activity. <br><br>  <b>PG Day</b> : <i>In the summer of 2017, you plan to give another big master class for the upcoming PG Day.</i>  <i>I think the audience will be interested to know what awaits them at this master class, what you will tell, what problems you will tell, who might be interested in this?</i> <br><br>  <b>AL</b> : Yes, I am preparing a workshop on Postgres tuning, Linux tuning and <b>troubleshooting</b> for the summer post-season conference in St. Petersburg.  I want to talk about how to <b>configure</b> Linux so that Postgres works well on it.  How can I look for problems in Linux when Postgres runs on it?  How to configure Postgres on the same Linux and how <b>to search</b> and fix problems in Postgres, which works on this very Linux. <br><br>  I will talk about <b>practical tools</b> , with a minimum of theory.  How to run utilities and tools, what settings affect the operation of the operating system and Postgres.  Why do you need to customize them? <br><br>  The main <b>feature</b> that is planned for the master class is a <b>server</b> on which all these techniques can be demonstrated.  On this server, I will model scenarios for the behavior of Postgres, the operating system, and we will be able to ‚Äútroubleshoot‚Äù them with the participants, look at the metrics, take some action, try to solve these problems.  In the course of this master class, I will show all my main methods of troubleshooting and try to tell people how to do this with Postgres.  I hope that participants can learn from some of my experience. <br><br>  <b>PG Day</b> : <i>I noticed that you were going to pay attention to the issue of equipment selection.</i>  <i>Where did the need arise to carefully select equipment for working with the base, in particular Postgres?</i> <br><br>  <b>AL</b> : I decided to capture this moment, because we choose the operating system on which Postgres will work, and the operating system will work on some hardware.  Accordingly, the question of the choice of iron also often arises.  In the master class, I will spend some of the time selecting the hardware, which servers to choose and how to configure them.  Workflow on the server can be very different: web servers, virtualization, databases.  Some settings, such as virtualization for databases, are simply not needed.  You can turn them off and save a little bit on performance.  In the master class I will tell about it. <br><br><img align="left" width="400" src="https://habrastorage.org/files/760/27c/43b/76027c43b7a14806a35332dffd9dc577.png">  <b>PG Day</b> : Do not hold out and ask one question about file systems.  What conference will not come, fierce battles, how to choose a file system for the database, and how they are better.  How will your story differ from these traditional battles ‚Äúfile system No. 1 against file system No. 2‚Äù? <br><br>  <b>AL</b> : In fact, we live in 2017, the issue of choosing file systems was already decided five years ago, and even earlier.  Now for databases there are two file systems.  These are <b>ext4</b> and <b>xfs</b> .  Both file systems give approximately the same results in any tests and are fairly stable in operation.  They practically do not find any bugs.  They work stably and well.  Therefore, in my master class there will be no comparisons, the thesis is quite simple: use xfs, or use ext4, that's all. <br><br>  No need to rush between exotic file systems like btrfs, zfs on Linux or, God forbid, ReiserFS.  Personally, I prefer <b>ext4</b> because there is such a joke as a reserved space for root files, 5% is allocated.  This thing is very useful and very often rescued when disk space quickly runs out.  This reserve can be reduced and a lot of free space appears in the file system.  In <b>xfs,</b> too, there is such a thing, but it is somehow cleverly buried and does not obviously work.  And by default there is a very small reserve.  So at the moment I like <b>ext4</b> more. <br><br>  <b>PG Day</b> : <i>In conclusion, we will ask a couple of questions that were wishes from the audience.</i>  <i>The first question about the sensational story with Gitlab.</i>  <i>There was a lot of controversy about whether or not they were messy.</i>  <i>What can you essentially say on this issue?</i>  <i>How to avoid such problems and what did they do wrong?</i> <br><br>  <b>AL</b> : Actually, this is a very good and revealing story.  Their database was handled by a jack of all trades.  From this whole story, it seemed to me that he didn‚Äôt have enough knowledge how to work with PostgreSQL, despite the fact that Posgres has very large and extensive documentation.  He found that there is a lag between the master and the replica, the so-called lag.  And he decided to <b>perezalit cue</b> .  It is not right.  In fact, it was necessary to act quite differently.  And the second point is inattention, the lack of established procedures.  In serious companies there are always instructions on how and what to do in emergency situations.  All switchovers are spelled out with a level of detail that does not imply any ambiguity.  All commands are spelled out, all decisions, branches yes / no. <br><br>  In the event of such a situation, a person, an engineer on duty or an on-duty administrator on duty, gets this instruction and does everything according to the instructions.  The absence of these instructions played a cruel joke.  So I had to restore, improvise on the go, do something there, write to Twitter.  Everyone was interested in watching it.  People had fun.  However, for the fact that the person made a mistake, it seemed to me, no extremely harsh measures were taken there.  On the one hand, this is good, because unfortunately everyone makes mistakes.  And I also make mistakes.  On the other hand, the main thing is to learn from your mistakes and not to repeat them. <br><br>  <b>PG Day</b> : <i>If I correctly made a generalizing conclusion from what you said, in your practice, problems are usually due to the fact that people do not have any instructions and a clear understanding of what to do or there are some other common rakes on which people jump?</i>  <i>Maybe some kind of farewell that you want to give to people?</i> <br><br>  <b>AL</b> : In fact, I don‚Äôt remember any well-established or frequent rake.  Situations are always different, it is impossible to write instructions for all situations.  We must build on the risks that exist in the infrastructure or in the same database.  There is a risk of data loss, there is a risk of losing access to the database.  These risks and they can be calculated.  You can write basic instructions on them and use them. <br><br>  It is also very often that something is overlooked somewhere.  The place ended on the disk, the backups stopped being removed, the replica fell off, the caching broke and that's it.  Everything is simple here, you need to use monitoring and configure to monitor everything. <br><br>  What can advise people?  Be <b>attentive to the details</b> , look at which console you are in, try to document all the unpleasant and new stories that have happened to you - you will have a good knowledge base.  From these stories you can always draw some conclusions so that these stories do not repeat in the future.  The most important thing is to be attentive and, of course, to study what you work with.  If you work with Postgres, learn Postgres, work with Ruby - learn ruby.  Take time to self-education. <br><br>  Subscribe to newsletters that are associated with Postgres, and in general with databases.  Such mailings allow you to monitor trends, what is happening now in the field of DBMS.  From the same newsletters, you can take links to useful blogs, and read them between newsletters.  Still necessarily need fundamental knowledge related to the device DBMS.  There are interesting books about the theory of device transaction engines, transaction logs and much more (Stonebraker, Weikum &amp; Vossen, etc.) <br><br>  <i>We hope that the interview with Alexey was interesting for you.</i>  <i>We are pleased to invite everyone to St. Petersburg to our <a href="http://pgday.ru/ru/2017%3Futm_source%3D_habr%26utm_medium%3Dpost%26utm_campaign%3Dlesovsky">PG Day'17 Russia</a> conference, during which Alexei will conduct an intensive training <b><a href="http://pgday.ru/ru/2017/request/registration%3Futm_source%3Dhabr%26utm_medium%3Dpost%26utm_campaign%3Dlesovsky%26talkId%3D118">Call of Postgres: Advanced Operations</a></b> , which contains a wealth of information on how to configure PostgreSQL and hardware with the Linux operating system for optimal performance.</i>  <i>Will consider the numerous components and their configuration.</i>  <i>Separately, the methods of diagnosing and troubleshooting the operating system and Postgres itself will be studied.</i> <i><br><br></i>  <i>See you at <a href="http://pgday.ru/ru/2017/request/registration%3Futm_source%3D_habr%26utm_medium%3Dpost%26utm_campaign%3Dlesovsky"><b>PG Day'17 Russia</b></a> !</i> </div><p>Source: <a href="https://habr.com/ru/post/328006/">https://habr.com/ru/post/328006/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../327996/index.html">BK-0010 emulator on FPGA</a></li>
<li><a href="../327998/index.html">Conference Outsource-People 2017, Krakow (day two)</a></li>
<li><a href="../328000/index.html">Segmentation of text lines of documents into characters using convolutional and recurrent neural networks</a></li>
<li><a href="../328002/index.html">SimplePage: a simple, declarative framework for rapid prototyping</a></li>
<li><a href="../328004/index.html">Part 3. Where to store data for decentralized applications on the blockchain?</a></li>
<li><a href="../328008/index.html">UAC Bypass or the story of three escalations</a></li>
<li><a href="../328010/index.html">Bildim under stm32duino using CMake (and scavenging from the linker)</a></li>
<li><a href="../328012/index.html">Redux as the heart of the front-end architecture of the Unified Frontal System</a></li>
<li><a href="../328014/index.html">Build 2017: text translation. Day 1</a></li>
<li><a href="../328018/index.html">Work with real-time logging with Heka. Experience Yandex. Money</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>