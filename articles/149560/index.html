<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Experiment platform for Three.JS and WebGL</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you do not play and do not consider the photos of familiar girls in contact, then programming is my favorite pastime at the computer. I especially ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Experiment platform for Three.JS and WebGL</h1><div class="post__text post__text-html js-mediator-article">  If you do not play and do not consider the photos of familiar girls in contact, then programming is my favorite pastime at the computer.  I especially like ‚Äúfast‚Äù programming.  It is such programming when the project is small and when we are not engaged in fundamental research, and planning does not need documentation.  By the way, at work all the projects are not the same, but also focused on a closed audience.  This is basically why you are reading my article now, and I also want to get on Habr. <br><br>  I want to share with you the results of my weekend project.  This is a pure client javascript / html application, which consists of a source editor in Javascript and <acronym>GLSL</acronym> shaders, a mini-linker, a window with Three.JS / WebGL and a small runtime interface.  All this is glued to jquery, and the gallery with the video is screwed over it.  The gallery features several demonstrations.  You can select your favorite demonstration and play with its code, as well as export and import entire projects from several files via JSON. <br><a name="habracut"></a><br>  The code for each demonstration can be located in several files.  These files are loaded with ajax and are immediately stored in local storage where they can be edited, new ones added and deleted.  Again, the application is purely client.  File api is used to add files to local storage.  You can add only text files, because with the volume of local storage you will not clear up when storing base64-representations of binary files. <br><br>  I will not give a link to a working application, because I do not have my own normal hosting.  It remains only to download the source and host them on your web server.  The web server is still needed, because recently for WebGL loading textures from the local file system has been banned. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      All sources are available on Bitbucket in the Mercurial system: <a href="https://bitbucket.org/Bangybug/treejsplayground">https://bitbucket.org/Bangybug/treejsplayground</a> , you can also download the Zip-archive there. <br><br>  There is still a short video to interest you: <iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/lFPll7OMPac%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700191,15700253,15700255,15700259&amp;usg=ALkJrhh4WOqKPtelSWpzIPVF2BWaQMUCXw" frameborder="0" allowfullscreen=""></iframe><br><br>  If you are interested and decided to download the source code, then I consider it a duty to warn you that it normally works only on Chrome (I have 21.0.1180.60).  In Firefox (I have 14.0.1), WebGL is now disabled, and to enable it, you need to type in about: config in the address bar, then install a filter on the webgl, set <i>force-enabled = true</i> and <i>disabled = false</i> .  But this is not the end of the Firefox sorrow - read below about the Gallery. <br><br><h2>  How it all began and what it turned into </h2><br>  First there was the need to write a shader.  I do not have much experience in this matter, so the plans were to ask my virtual friends for advice.  I also wanted to make their work a bit easier by showing my prototype right away, without having to install anything, but with the ability to make changes on the fly and observe the result. <br><br>  Conceived - done, the choice immediately fell on WebGL.  I didn‚Äôt want to build my bike out of the function calls of WebGL itself, since the library Three.JS turned out well.  Then the thought flashed that it would be nice to choose an editor with backlight instead of textarea.  The choice fell on <a href="http://ace.ajax.org/">ACE</a> .  It seemed to me to be quite high quality, it works with large files, supports <i>code folding</i> , analyzes the code and can tell where the error is, or how to do it better. <br><br>  Then I wanted to make a similarity to the project manager, which would include a list of files and could delete and add files at the discretion of the client.  I really didn‚Äôt want to communicate with the server code, there was a way out - Html5 innovations: <i>File API</i> and <i>Local Storage</i> , at the same time to see what and how. <br><br>  After the project manager with the list of files was ready, the need for a linker for the source files was automatically generated.  An elementary linker was written, which, using the <i>eval</i> function, traverses all files.  If in some of the source code the functionality of another is required, to which the linker has not yet reached, then it is enough to call the special function of the linker <i>APP.require</i> .  In this case, the linker will not go through the previously connected files. <br><br>  Without meeting any problems, I decided to continue the lesson.  Interest has shifted to other Html5 innovations in the field of <acronym>CSS</acronym> and visual effects.  I wanted to make a video gallery, where each video would be shown with some <acronym>CSS</acronym> effect.  There are already difficulties.  It is written about them further. <br><br>  The final step was to separate the shader code into a separate type of source.  When editing shaders, the editor switched to the grammar of the <i>C</i> language.  This turned out to be convenient, because otherwise you would have to store the shader code either inside Javascript or inside Html. <br><br><h2>  Compilation of project files and minimal runtime interface </h2><br>  As already noted, there is an elemental linker.  It is in the <i>app / linker.js file</i> .  It has a require function, which is available from source as <i>APP.require</i> .  This function should be called in order to ensure that the compiled source code is connected in the correct order.  An example of use is a demonstration of <i>‚ÄúBrothers in arms‚Äù</i> (see gallery). <br><br>  There is also a minimal runtime interface, which consists of such objects: <br><br><ul><li>  <b>APP.page.webgl.renderer</b> - <i>Renderer</i> object ready for work from Three.JS; </li><li>  <b>APP.page.webgl.viewport</b> - an object with the <i>width</i> and <i>height</i> properties, set automatically when the WebGL window is initialized, values ‚Äã‚Äãare taken from <i>webgl.css</i> ; </li><li>  <b>APP.page.webgl.viewportMouse</b> - an object with the <i>getX ()</i> and <i>getY ()</i> functions that return the last seen coordinates of the pointer when it was over the WebGL window; </li><li>  <b>APP.shader (vertexShaderFileName, fragmentShaderFileName, uniforms)</b> - returns a new <i>THREE.ShaderMaterial</i> object, assembled from the specified subroutines and <i>uniforms</i> constants.  In the future, you can change the values ‚Äã‚Äãof the properties of the <i>uniforms</i> object, and the shader will automatically pick them up before rendering. </li></ul><br>  This is the minimum runtime that is provided for client sources.  In turn, the client‚Äôs source code must define the <b>main</b> and <b>exit</b> functions.  These functions are responsible for starting and stopping the demonstration.  It is recommended to clear resources inside exit. <br><br><h2>  Experiments with video gallery </h2><br>  Here I have comprehended difficulties.  Firstly, <i>border-radius</i> in Chrome does not apply to the <i>video</i> element.  More precisely, it applies only to the image that is used as poster.  As soon as the video starts playing, the rounds disappear.  <i>Box-reflection</i> style works only in webkit. <br><br>  Firefox has problems with the layout, and that is very sad, with the very idea of ‚Äã‚Äãa video gallery.  You can't just take and stick even 4-5 video elements, even if only one of them will play when you hover the cursor.  Firefox sends a lot of requests, it curls the page and even my local Apache httpd.  It is necessary to close the browser. <br><br>  In Chrome, there are no problems with hanging, although there is still something to meditate on looking at memory consumption. <br><br>  As a result, simply added a parameter to the file <i>app / gallery.js / initialize - useImages</i> .  When you set it to true, instead of the video will be pictures. <br><br><h2>  Shader Compilation </h2><br>  To compile shaders, I added the <i>APP.shader</i> function, it is described above.  Just to clarify that the code from Three.JS is used here.  This code will automatically set an attribute with the name <i>‚Äúposition‚Äù</i> in your vertex shader.  Keep this in mind, do not try to write a shader with a different name for this attribute.  There is an alternative - to rewrite the <i>app / webgl.js / shader</i> function, but at the same time you will lose the ability to use the Three.JS drawing tool. <br><br><h2>  Comparison with sample code on ‚Äúclean‚Äù WebGL </h2><br>  It goes without saying that the code will be much less on Three.JS.  And if you use my playground, the code will still decrease.  The only obstacle is the need to understand how WebGL functions are wrapped in the Three.JS library.  For example, the mode of sending vertex data <i>TRIANGLE_STRIP</i> in Three.JS corresponds to the <i>THREE.Ribbon</i> object. <br><br>  For comparison, open directories with an identical project: <i>/ defaults / sources / water</i> and <i>/ defaults / sources / water_webgl</i> .  So you can get an idea of ‚Äã‚Äãthe differences when using pure WebGL and Three.JS. <br><br><h2>  Preparing a new demonstration and inserting it into the project </h2><br>  All demonstrations are described in <i>app / gallery.js / projects</i> .  A typical description looks like this: <br><pre><code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'spheres'</span></span> : { <span class="hljs-attr"><span class="hljs-attr">files</span></span> : [{<span class="hljs-attr"><span class="hljs-attr">type</span></span>:<span class="hljs-string"><span class="hljs-string">'source'</span></span>, <span class="hljs-attr"><span class="hljs-attr">path</span></span>:<span class="hljs-string"><span class="hljs-string">'defaults/sources/spheres/main.js'</span></span>, <span class="hljs-attr"><span class="hljs-attr">content</span></span>:<span class="hljs-literal"><span class="hljs-literal">null</span></span>}], <span class="hljs-attr"><span class="hljs-attr">category</span></span> : <span class="hljs-string"><span class="hljs-string">'Basic'</span></span>, <span class="hljs-attr"><span class="hljs-attr">title</span></span> : <span class="hljs-string"><span class="hljs-string">'Many ballz'</span></span>, <span class="hljs-attr"><span class="hljs-attr">image</span></span> : <span class="hljs-string"><span class="hljs-string">'defaults/sources/spheres/img.png'</span></span>, <span class="hljs-attr"><span class="hljs-attr">video</span></span> : <span class="hljs-string"><span class="hljs-string">'defaults/sources/spheres/video.ogv'</span></span>, <span class="hljs-attr"><span class="hljs-attr">description</span></span>: <span class="hljs-string"><span class="hljs-string">'Basic demo from Three.JS package, creates 50k spheres with different materials. Demonstrates on-the-fly texture generation.'</span></span> }</code> </pre> <br>  I used the free <a href="http://camstudio.org/">Camstudio</a> program to record videos.  From it you need to get a video in the size of 320x200.  To do this, you can pre-set the size of the window 320x200 in <i>webgl.css</i> , and in Camstudio itself set up video removal from this area.  Also help hotkeys, they eliminate the need to edit the video.  I recommend to immediately select the directory where the video files will be added.  Preferably not root. <br><br>  In order for the video to be embedded in the video element, you will have to convert it to OGG Theora.  I used <a href="http://www.v2v.cc/~j/ffmpeg2theora/">FFMpeg2Theora</a> . <br><br><h2>  Using parameters in url </h2><br>  For convenience, it is possible to use the parameters in the url.  For example, to show a gallery, it‚Äôs enough to add the following to the address <i>:? Gallery = category</i> , where category is the category of the demonstrations (see the description of the demonstration). <br><br>  You can immediately redirect to the desired project by adding <i>? Project = project_id</i> , where project_id is the key in <i>app / gallery.js / projects</i> , for example <i>spheres</i> . <br></div><p>Source: <a href="https://habr.com/ru/post/149560/">https://habr.com/ru/post/149560/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../149551/index.html">Scaling and development features for SQL Database</a></li>
<li><a href="../149552/index.html">Run Java programs on the GPU</a></li>
<li><a href="../149555/index.html">Android: SMS Processing</a></li>
<li><a href="../149558/index.html">PHP Information Widgets in Ubuntu</a></li>
<li><a href="../149559/index.html">The use of subversion and trac in the educational process of students of IT specialties</a></li>
<li><a href="../149561/index.html">Kiosk Mode apps on Android</a></li>
<li><a href="../149562/index.html">Google changed the search favicon</a></li>
<li><a href="../149563/index.html">In-memory key-value cache for MS SQL</a></li>
<li><a href="../149564/index.html">How to separate the topic from the application</a></li>
<li><a href="../149565/index.html">The rover "Curiosity": an explanation of the choice of 2 megapixel cameras</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>