<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Computer control with variable resistor</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What and why? 
 Recently I read Mikhail Sannikov's article ‚Äú Connecting Encoder to Computer ‚Äù. And it so happened that the other day they sent me an A...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Computer control with variable resistor</h1><div class="post__text post__text-html js-mediator-article"><h5>  What and why? </h5><br>  Recently I read Mikhail Sannikov's article ‚Äú <a href="http://pixelkit.ru/post/2431032255">Connecting Encoder to Computer</a> ‚Äù.  And it so happened that the other day they sent me an Arduino board, so I wanted to repeat this simple design or do something similar, <br><br>  First, a little about what an encoder is and why it is needed at all.  An encoder is an angle-to-code converter, the output of which is the gray code.  There are input devices built on encoders and outwardly looking like a massive puck, rotating which, for example, you can rotate the model in a 3D editor. <br><a name="habracut"></a><br><img src="https://habrastorage.org/storage/habraeffect/a3/87/a387485bc57cc086be967d3f8f89c764.png" alt="image"><br><br>  <font>(picture <a href="http://www.griffintechnology.com/products/powermate">from here</a> )</font> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      However, I did not have an encoder, I did not want to go to the store, so instead of it, it was decided to adapt the old 150 KŒ© variable resistor, which was lying idle in a box with different trash. <br><br>  So, it was necessary to do the following: <br><ol><li>  Connect a variable resistor to the Arduino; </li><li>  Make a program for the controller that reads a byte from the analog port and sends it to the computer; </li><li>  Write a computer program that emulates pressing certain keys depending on the direction of rotation of the variable resistor shaft. </li></ol><br><h5>  Hard and soft </h5><br>  An example of Analog In, Out Serial, completely solving the first and second problems, was found in the programming manual on the Arduino website. <br>  The resistor is connected according to the following scheme: <br><img src="https://habrastorage.org/storage/habraeffect/d2/4f/d24fe0e847a16b4ee3fadbaee228eeb7.png" alt="image"><br><br>  However, the code had to be slightly modified: remove all lines from Serial.print and replace it with one Serial.write (outputValue): <br><br> <code>const int analogInPin = A0; //      A0 <br> int sensorValue = 0; // ,    <br> <br> void setup() { <br> Serial.begin(9600); //  COM- <br> } <br> <br> //    A0      COM- <br> void loop() { <br> sensorValue = analogRead(analogInPin); <br> outputValue = map(sensorValue, 0, 1023, 0, 255); <br> Serial.write(outputValue); <br> delay(10); <br> } <br></code> <br><br>  The computer control program was written in C # in Visual Studio 2010 Express. <br><br>  Main program window: <br><br><img src="https://habrastorage.org/storage/habraeffect/ff/dd/ffdd2852d0707a40cbdf458b532893a4.png" alt="image"><br><br>  Dialog box with settings: <br><br><img src="https://habrastorage.org/storage/habraeffect/a2/14/a2147fb8c87d49c341f9218b0e52321e.png" alt="image"><br><br>  Note: pressing the ‚ÄúButton‚Äù button is not processed yet. <br><br>  Here it is worth considering the parameters from the ‚ÄúMisc‚Äù group in more detail.  The first is needed to emulate a keystroke, the rest - to eliminate bounce. <br><br>  <i>Latency</i> - the delay in milliseconds between pressing a key and releasing. <br>  <i>Buffer</i> - the number of consecutively read values ‚Äã‚Äãfrom the COM port. <br>  <i>Jitter</i> - shows the permissible deviation from the value of the last sample. <br><br>  Chatter suppression and determining the direction of rotation of the variable resistor shaft works as follows: <br><ul><li>  The buffer reads a certain number of bytes (parameter Buffer) from the serial port; </li><li>  if the last byte in the buffer is greater than the sum of the first byte and the Jitter value, this means that the shaft rotates to the right; </li><li>  if the last byte in the buffer is less than the difference of the first byte and the Jitter value, this means that the shaft rotates to the left. </li></ul><br>  The disadvantages of this method: <br>  - the delay between the start of the shaft rotation and the program response to it; <br>  - the key is pressed once, regardless of the angle of rotation.  That is, you can quickly turn the resistor shaft (the first byte in the buffer will be, say, 10, and the last - 30), and the program will work it out as one press. <br><br>  Algorithm code: <br><br> <code>int[] buffer = new int[(int)conf.buffer]; // Buffer <br> int bufferTop = (int)conf.buffer - 1; <br> <br> for (int i = 0; i &lt; conf.buffer; i++) <br> { <br> buffer[i] = sp.ReadByte(); <br> } <br> <br> if (buffer[bufferTop] &gt; (buffer[0] + conf.jitter)) <br> { <br> // ‚Äú‚Äù  <br> } <br> else if (buffer[bufferTop] &lt; (buffer[0] - conf.jitter)) <br> { <br> // ‚Äú‚Äù  <br> }</code> <br> <br>  The project for Visual Studio, the sketch for Arduino and the scheme can be downloaded here: <a href="http://sourceforge.net/projects/keyemu/files/KeyEmu-0.1b-source.zip/download">http://sourceforge.net/projects/keyemu/files/KeyEmu-0.1b-source.zip/download</a> <br>  The archive contains the bin directory containing the compiled program.  To run it, you will need the .NET Framework 4 installed. <br><br>  That's all for now.  A curious person can modify the program - implement the processing of a series of clicks instead of one, or ‚Äúpress‚Äù different keys depending on which application is active at a given time, or simply ‚Äúpolish this bug‚Äù indefinitely. </div><p>Source: <a href="https://habr.com/ru/post/113029/">https://habr.com/ru/post/113029/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../113019/index.html">Amazon will launch its own video service soon.</a></li>
<li><a href="../113020/index.html">Mamdani algorithm in fuzzy inference systems</a></li>
<li><a href="../113022/index.html">Programming and entrepreneurial fees Imagine Cup</a></li>
<li><a href="../113025/index.html">IBM celebrates 100 years of participation in technical progress.</a></li>
<li><a href="../113026/index.html">Data generation using C ++ templates</a></li>
<li><a href="../113030/index.html">Satellite lost after launch</a></li>
<li><a href="../113035/index.html">How do you feel about HTML letters?</a></li>
<li><a href="../113039/index.html">Some subtleties of Update & Insert in Handler Socket</a></li>
<li><a href="../113040/index.html">First experience with Handler Socket & php_handlersocket</a></li>
<li><a href="../113042/index.html">We are looking for speakers at Mobility 2011</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>