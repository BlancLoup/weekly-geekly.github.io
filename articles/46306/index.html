<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Strength and beauty of decorators</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One of the most difficult to understand and comprehend elements of the language is the decorator , although in fact it is a very simple thing that can...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Strength and beauty of decorators</h1><div class="post__text post__text-html js-mediator-article">  One of the most difficult to understand and comprehend elements of the language is the <i>decorator</i> , although in fact it is a very simple thing that can be understood even by a novice programmer.  New Everest I do not open, but only offer a brief overview of the possibilities and a few typical examples of use.  A sort of a short excursion into python metaprogramming. <br><br>  <b>Upd 1</b> : changed a somewhat categorical statement about the dissimilarity of the Decorator pattern and the linguistic construction of the same name to a softer one. <br><br><a name="habracut"></a><br><blockquote>  At the very beginning, it should be noted that the decorator considered here as an element of the Python language is not an implementation of the <a href="http://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B5%25D0%25BA%25D0%25BE%25D1%2580%25D0%25B0%25D1%2582%25D0%25BE%25D1%2580_(%25D1%2588%25D0%25B0%25D0%25B1%25D0%25BB%25D0%25BE%25D0%25BD_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B5%25D0%25BA%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F)">design pattern of the</a> same name, its possibilities are much broader, although the pattern itself can be implemented through the Python decorator. </blockquote>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  What is a decorator and the simplest ways to use it </h5><br>  So, the decorator is a convenient way to change the behavior of a certain function (and since Python 2.6 and 3.0 and the whole class).  In terms of syntax, it looks quite simple.  For example, the following code snippet using the decorator: <br><br><pre> @ f1
 def func (x): pass </pre><br><br>  equivalent to this: <br><br><pre>  def func (x): pass
 func = f1 (func) </pre><br><br>  The word ‚Äúequivalent‚Äù must be understood literally: the operation is performed at the time of the function definition once and if f1 returns, say, None, then the variable func will contain None.  A simple example (decorating function returns None, in the end func also turns out to be None): <br><br><pre>  def empty (f):
     return none

 @empty
 def func (x, y):
     return x + y

 print func # prints: None
</pre><br><br>  Let's look at a more practical example.  Suppose you need to check how quickly some function works, you need to know how long each call takes.  The task is simply solved with the help of a decorator. <br><br><pre> import time
 def timer (f):
     def tmp (* args, ** kwargs):
         t = time.time ()
         res = f (* args, ** kwargs)
         print "Function execution time:% f"% (time.time () - t)
         return res

     return tmp

 @timer
 def func (x, y):
     return x + y

 func (1, 2) # prints something like: Function execution time: 0.0004 </pre><br><br>  As you can see from the example, in order to force the function func to print the operation time with each execution, it is enough to ‚Äúwrap‚Äù it into the timer decorator.  Let's comment out the line ‚Äú@timer‚Äù and func continues to work as usual. <br><br>  The timer function () is the most typical decorator.  As its only parameter, it accepts a function, internally creates a new function (in our example with the name tmp), in which it adds some logic and returns this newest function.  Pay attention to the signature of the tmp () function - <i>tmp (* args, ** kwargs)</i> , this is the standard way to ‚Äúcapture‚Äù all possible arguments, so our decorator is suitable for functions with a completely arbitrary signature. <br><br>  The function can be wrapped in several decorators.  In this case, they are ‚Äúexecuted‚Äù from top to bottom.  For example, create a pause () decorator that will pause for one second before executing the function. <br><br><pre>  import time

 def pause (f):
     def tmp (* args, ** kwargs):
         time.sleep (1)
         return f (* args, ** kwargs)

     return tmp
</pre><br><br>  And we define the func function as follows (using two decorators at once - pause and timer): <br><br><pre>  @timer
 @pause
 def func (x, y):
     return x + y </pre><br><br>  Now the <i>func (1, 2)</i> call will show the total execution time in about one second. <br><br><h5>  More complex use of decorators </h5><br><br>  You might think that only a function can be used as a decorator.  This is not true.  Any object that can be ‚Äúcalled‚Äù can act as a decorator.  For example, a class may act as a decorator.  Here is a much more complicated example showing how you can construct threads with the help of decorators: <br><br><pre>  import threading

 class thread (threading.Thread):
     def __init __ (self, f):
         threading.Thread .__ init __ (self)
         self.run = f

 @Thread
 def ttt ():
     print "This is a thread function"

 ttt.start () </pre><br><br>  Let's take a look at this example in detail.  The ‚Äúclassic‚Äù way to create a thread class is the following: a new class is created, a successor to the threading.Thread class (threading is a standard Python module for working with threads);  in the class, the run () method is set, in which the code itself is placed, which needs to be executed in a separate thread, then an instance of this class is created and the start () method is called for it.  Here is how it would look in the "classic" version: <br><br><pre>  class ThreadClassic (threading.Thread):
     def run (self):
         print "This is a thread function"

 ttt = ThreadClassic ()
 ttt.start () </pre><br><br>  In our case, the decorated function is passed as an argument to the constructor of the stream class, where it is assigned to the run class component. <br><br>  To create several different threads, you need to duplicate the ‚Äúclassic‚Äù code twice.  And when using stream decorators, just add a decorator call to the stream function. <br><br><blockquote>  The flow example is provided for informational purposes only.  In reality, it should be used very carefully, since not all the streaming code can be wrapped in the decorator described here. </blockquote><br><br>  In the decorator you can pass the parameters, record type: <br><br><pre>  @ f1 (123)
 def func (): pass </pre><br>  is equivalent to <br><br><pre>  def func (): pass
 func = f1 (123) (func)
</pre><br><br>  In essence, this means that the decorator is the result of the execution of the function f1 (123).  Let's write an updated pause () decorator, which allows you to specify the amount of pause before executing the wrapped function: <br><br><pre>  import time

 def pause (t):
     def wrapper (f):
         def tmp (* args, ** kwargs):
             time.sleep (t)
             return f (* args, ** kwargs)
         return tmp

     return wrapper

 @pause (4)
 def func (x, y):
     return x + y

 print func (1, 2) </pre><br>  Notice how the decorator is actually created dynamically inside the pause () function. <br><br><h5>  Using decorators in classrooms </h5><br><br>  The use of decorators on class methods is no different from the use of decorators on ordinary functions.  However, for classes there are predefined decorators named <i>staticmethod</i> and <i>classmethod</i> .  They are designed to set static methods and class methods, respectively.  Here is an example of their use: <br><br><pre>  class TestClass (object):
     @classmethod
     def f1 (cls):
         print cls .__ name__

     @staticmethod
     def f2 ():
         pass

 class TestClass2 (TestClass):
     pass

 TestClass.f1 () # types TestClass
 TestClass2.f1 () # prints TestClass2

 a = TestClass2 ()
 a.f1 () # types TestClass2
</pre><br><br>  The static method (wrapped by the staticmethod decorator) basically corresponds to static methods in C ++ or Java.  But the class method is something more interesting.  The first argument for such a method is a class (not an instance!), This happens in much the same way as with conventional methods, which receive a reference to an instance of a class with the first argument.  In the case when a class method is called on an instance, the actual parameter of the instance is passed as the first parameter, as shown in the example above: for the generated class, the generated class is passed. <br><br><h5>  Where else can decorators be used </h5><br>  The list of potential applications for decorators is very large: <br><ul><li>  function call tracing </li><li>  setting / checking pre- and post-conditions </li><li>  <a href="http://code.activestate.com/recipes/465057/">synchronization</a> </li><li>  lazy calculations and caching of functions in general </li><li>  <a href="http://code.activestate.com/recipes/496691/">retracting tail recursion</a> </li><li>  <a href="http://code.activestate.com/recipes/426123/">function argument type checking</a> </li><li>  etc. </li></ul><br><h5>  Real difficulties </h5><br><br>  It is necessary to use decorators very carefully, well aware of what exactly you want to achieve.  Excessive use of them leads to code that is too difficult to understand.  You can write in a fit of insight, so that later you will not understand how it works. <br><br>  Using the decorator breaks the documentation strings for the method / function.  The problem can be solved by manually ‚Äúforwarding‚Äù the value of __doc__ to the function created inside the decorator.  And you can use a wonderful module with an unexpected name <a href="http://www.phyast.pitt.edu/~micheles/python/documentation.html">decorator</a> , which, in addition to supporting doc strings, can do many other useful things. <br><br><h5>  Recommended literature </h5><br><ol><li>  <a href="http://www.phyast.pitt.edu/~micheles/python/documentation.html">http://www.phyast.pitt.edu/~micheles/python/documentation.html</a> - decorator module documentation page </li><li>  <a href="http://www.ibm.com/developerworks/linux/library/l-cpdecor.html">www.ibm.com/developerworks/linux/library/l-cpdecor.html</a> - an article about decorators on IBM developerWorks (and <a href="http://www.ibm.com/developerworks/ru/library/l-cpdecor/index.html">translation</a> into Russian) </li><li>  Mark Lutz: Learning Python, 3rd Edition, Chapter ‚ÄúFunction Decorators‚Äù </li><li>  <a href="http://www.python.org/dev/peps/pep-0318/">PEP 318: Function Decorators</a> </li><li>  <a href="http://docs.python.org/3.0/whatsnew/2.6.html">PEP 3129: Class Decorators</a> (since Python 2.6 and Python 3.0) <br>  <a href="http://wiki.python.org/moin/PythonDecorators">wiki.python.org/moin/PythonDecorators</a> - an article from the official Python wiki about decorators <br></li></ol></div><p>Source: <a href="https://habr.com/ru/post/46306/">https://habr.com/ru/post/46306/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../46301/index.html">To points and karma. In general, to the ratings.</a></li>
<li><a href="../46302/index.html">What programmers are ready for in a crisis</a></li>
<li><a href="../46303/index.html">Version 0.1.6</a></li>
<li><a href="../46304/index.html">IE: document.getElementById () bug to keep in mind</a></li>
<li><a href="../46305/index.html">PESRUKOT (simple and effective way to radically reduce the number of errors in the text)</a></li>
<li><a href="../46309/index.html">‚ÄúPhoto Motion ¬≤‚Äù - a social network for novice photographers</a></li>
<li><a href="../46310/index.html">The 5th international meeting of StartApers in Moscow. Announcement</a></li>
<li><a href="../46314/index.html">Debian stuff - apt-mirror</a></li>
<li><a href="../46316/index.html">Continuation of the experiment with the chains of dating</a></li>
<li><a href="../46317/index.html">Striped pencils</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>