<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Financial Transmission Ways # 4: ASTS Bridge Protocol</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In addition to international standards and financial information transfer protocols such as FIX and FAST , which we described earlier, the so-called ‚Äú...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Financial Transmission Ways # 4: ASTS Bridge Protocol</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://habrahabr.ru/company/itinvest/blog/270961/"><img src="https://habrastorage.org/files/2a0/0f8/6c3/2a00f86c358347e5a47da619cdc4174f.png"></a> <br><br>  In addition to international standards and financial information transfer protocols such as <a href="http://habrahabr.ru/company/itinvest/blog/242789/">FIX</a> and <a href="http://habrahabr.ru/company/itinvest/blog/243657/">FAST</a> , which we <a href="http://habrahabr.ru/company/itinvest/blog/261709/">described</a> earlier, the so-called ‚Äúnative‚Äù financial data transfer protocols operate on the stock market.  They are used to obtain the necessary information by both private traders and brokerage companies - such native protocols are more functional than generally accepted standards (like the same FIX) that attract brokers. <br><br>  Earlier in Russia there were two large stock exchanges - MICEX and RTS.  Subsequently, they merged into a single Moscow Exchange, but each of the two trading platforms during the years of independence managed to develop their own native protocol.  We talked about the Plaza II protocol, which was created by RTS specialists, in one of the past materials, and today we will speak about the ASTS Bridge project, which their colleagues from the MICEX began to develop. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  A bit of history </h4><br>  The first version of the electronic trading system of the Moscow Interbank Currency Exchange (MICEX) was <a href="http://www.micex.ru/file/bursereview/article/69971/article_929.pdf">developed and implemented</a> in 1993-1994 of the last century.  The system was named ASTS (Automated Securities Trading System) and its software was developed by the Australian company FMSC (Financial Market Software Consultants) and adapted for the Russian market through the joint efforts of foreign and domestic IT specialists. <br><br>  Later, the FMSC was named Compu ShareLtd with which the MICEX signed a partnership agreement, including further independent development of the trading system, during mergers and acquisitions. <br><br><img src="https://habrastorage.org/files/957/ac5/a58/957ac5a589fa43609945b0d962b27c92.png"><br><br>  <i>Stages of development of the MICEX trading system until the mid-2000s;</i>  <i>source: <a href="http://www.micex.ru/">micex.ru</a></i> <br><br>  Further, the system was developed by the specialists of the MICEX exchange, and later the Moscow Exchange.  As a result, a three-tier client-server system architecture was implemented. <br><br>  At the head of the hierarchy was the central server of the trading system (it is responsible for processing transactions) with which the access servers interacted (all the trading system transactions were replicated to them), which in turn were connected to client applications (trading terminals of traders and administrators, brokerage trading systems, complexes of distribution of exchange information, etc.): <br><br><img src="https://habrastorage.org/files/c51/fd0/d17/c51fd0d17d95464a9d231521b57c5928.png"><br><br>  <i>Source: MICEX documentation</i> <br><br>  In this configuration, the system exists since 1998. <br><br><h4>  Data Transfer: Protocols Used </h4><br>  To connect external systems to the trading system, a universal bidirectional software gateway (UDPSH) mechanism was developed - that is, software, through which data was exchanged between the exchange trading system and applications connected to it. <br><br><h5>  ASTS Bridge </h5><br>  The program provided bidirectional communication with the trading system and had an API for receiving data (transactions, quotes, tools, etc.) and executing transactions (placing / withdrawing orders, etc.). <br><br>  There were two versions of UDPSH - the TCP / IP version of the system was called TEAP, and the option to connect using a serial interface (RS-232) was called TEServer (Trade Engine Server).  Since the summer of 2015, support for this version has been discontinued. <br><br>  Subsequently UDPSH received a new name - ASTS Bridge.  In Exchange terminology, the gateway (bridge) is the native protocol of the trading and clearing system, <br><br>  A feature of the gateway protocol is support for so-called "interfaces".  As stated in the <a href="http://habrahabr.ru/company/moex/blog/261369/">material</a> "Moscow Exchange" on Habrahabr: <br><br><blockquote>  An interface is a versioned set of user-accessible tables and transactions, with the appropriate structure and data types. </blockquote><br>  Versioning allows system users to remain on older versions of interfaces after upgrades of the exchange system, which entail the need to modify the structure of the data tables or change transaction formats.  Currently, there is a possibility of connecting with all versions of interfaces created during all the years of the system, but it is planned to tighten the requirements for them. <br><br>  Detailed <a href="">ASTS Bridge documentation is available</a> on the Moscow Exchange FTP.  Among other things, there are descriptions of <a href="">existing interfaces</a> . <br><br><h4>  How it works </h4><br>  At the moment, the ASTS Moscow Exchange trading and clearing system ensures the functioning of the main markets of the trading floor and supports several trading methods, such as the Order-Driven Market and the Quote-Driven Market.  More information about the functionality of the system can be found on the <a href="http://moex.com/a419">website of the Exchange</a> . <br><br>  The server part of the client application is installed on the server connected to the closed trading network of the exchange, and the client part runs on a computer connected to the client‚Äôs network.  There is also the possibility of placing the client‚Äôs trading application on collocations in the data center of the M1 exchange.  In this case, the use of the so-called built-in version of the gateway is allowed, which allows you to connect directly to exchange access servers. <br><br>  The client‚Äôs trading application must use the provided API functions to retrieve data from the ASTS system and perform transactions.  The data is obtained using the client pull technology - the application must ‚Äúpull‚Äù the data itself, that is, interrogate the tables to obtain the actual market information. <br><br>  Thus, to start work, the developer of the trading application needs to download the ASTS Bridge gateway on <a href="">the Exchange website</a> , and then connect it to the test version of ASTS.  Upon completion of development and debugging, each application connected to the system is certified by the Exchange. <br><br>  After passing through all these stages, the scheme of the application operation with the ASTS system is as follows. <br><br><ul><li>  First, the connection is established and the bidder is authorized, and then the structure of information objects and the data necessary for working with tables are requested from the trading and clearing system - the answer comes in the form of a data buffer. </li><li>  This buffer is then unpacked to separate the tabular data on the line and then to the fields. </li><li>  If the tables are updatable (this is indicated by a special flag), the interval and the sequence of the request for updated data from the system are specified. </li><li>  When an external client application performs transactions, the composition of the fields of such transactions is also formed on the basis of the structure of information objects. </li></ul><br>  The application should provide mechanisms for restoring the state of open tables after failures and loss of communication - without this, a certificate for the subsequent operation of the application will not succeed. <br><br>  Below is an example of implementing a Java demo application that connects and requests data from the ASTS system: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.micex.client.API.ServerInfo; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.micex.client.Binder; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.micex.client.Client; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.micex.client.ClientException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.micex.client.Filler; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.micex.client.Meta; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.micex.client.Parser; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.ArrayList; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.HashMap; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.HashSet; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.LinkedHashMap; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.List; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Map; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Set; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Demo</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Binder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> ClientException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Map&lt;String,String&gt; m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;String, String&gt;(); m.put(<span class="hljs-string"><span class="hljs-string">"PacketSize"</span></span>,<span class="hljs-string"><span class="hljs-string">"60000"</span></span>); m.put(<span class="hljs-string"><span class="hljs-string">"Interface"</span></span>,<span class="hljs-string"><span class="hljs-string">"IFCBroker_20"</span></span>); m.put(<span class="hljs-string"><span class="hljs-string">"Server"</span></span>,<span class="hljs-string"><span class="hljs-string">"INET_GATEWAY"</span></span>); m.put(<span class="hljs-string"><span class="hljs-string">"Service"</span></span>,<span class="hljs-string"><span class="hljs-string">"inet_gateway"</span></span>); m.put(<span class="hljs-string"><span class="hljs-string">"Broadcast"</span></span>,<span class="hljs-string"><span class="hljs-string">"91.208.232.101"</span></span>); m.put(<span class="hljs-string"><span class="hljs-string">"PrefBroadcast"</span></span>,<span class="hljs-string"><span class="hljs-string">"91.208.232.101"</span></span>); m.put(<span class="hljs-string"><span class="hljs-string">"UserID"</span></span>, <span class="hljs-string"><span class="hljs-string">"MU0000800001"</span></span>); m.put(<span class="hljs-string"><span class="hljs-string">"Password"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>); m.put(<span class="hljs-string"><span class="hljs-string">"Language"</span></span>, <span class="hljs-string"><span class="hljs-string">"English"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Demo().run(m); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Map&lt;String,String&gt; parameters)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> ClientException </span></span>{ Client client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Client(); client.start(parameters); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Some useful info about connection System.out.println(String.format("Connected to MICEX, handle=%d", client.handle())); final ServerInfo info = client.getServerInfo(); System.out.println(String.format("SystemID=%s; SessionID=%d; UserID=%s", info.systemID, info.sessionID, info.userID)); // Parsed market interface, contains meta-information // about available requests (tables) / transactions // and their structure definition. final Meta.Market market = client.getMarket(); System.out.println(String.format("Market: %s", market.name)); // Optional MTESelectBoards final Set&lt;String&gt; b = new HashSet&lt;String&gt;(); b.add("TQBR"); // Use only one - limit number of SECURITIES in demo client.selectBoards(b); Parser parser; // load() table - mimics a sequence of MTEOpenTable/MTECloseTable. // Use it for non-updateable info-requests parser = client.load("MARKETS", null); parser.execute(this); // open() table - it will also be added to the list // of requests to be updated at refresh() call parser = client.open("TESYSTIME", null, true); parser.execute(this); // open() SECURITIES (params==null - all securities) parser = client.open("SECURITIES", null, false); parser.execute(this); // another (better) way to specify table name Meta.Message orderbooks = market.tables().find(Meta.TableType.Orderbooks); if (orderbooks != null) { parser = client.open(orderbooks.name, null, false); parser.execute(this); } // make 10 refresh() iterations with some delay between them for (int i = 0; i &lt; 10; i++) { try { Thread.sleep(1000); } catch (InterruptedException e) { return; } parser = client.refresh(); if (parser.empty()) continue; // nothing to parse, skip the rest int bytes = parser.length(); int count = parser.execute(this); System.out.println("===================="); System.out.println("Parsed " + bytes + " bytes, " + count + " rows"); } } finally { client.close(); System.out.println("===================="); System.out.println("Done."); } } /** * Very simplistic table storage. */ final Map&lt;String, Table&gt; database = new HashMap&lt;String, Table&gt;(); /** * @param source - a TE request which is gonna be parsed * @return - a Filler instance which will be used to * store parsed values in some kind of storage or {@code null} * if not interested in storing parsed data. */ public Filler getFiller(Meta.Message source) { // Of course, IRL you shouldn`t return a new instance // of Filler instance, but search some kind of // internal database and return the same "table" // instance for every source message. Table table = database.get(source.name); if (table == null) { table = new Table(); database.put(source.name, table); } return table; } /** * Very simplistic record. */ static class Record { int decimals; final Map&lt;String,Object&gt; values = new LinkedHashMap&lt;String, Object&gt;(); } /** * Very simplistic table. */ static class Table implements Filler { /** * ,      ( ) *        . */ final Map&lt;String, Record&gt; records = new HashMap&lt;String, Record&gt;(); /** *     "" -  , *     (SECBOARD + SECCODE). */ final Map&lt;String, List&lt;Record&gt;&gt; orderbooks = new HashMap&lt;String, List&lt;Record&gt;&gt;(); public boolean initTableUpdate(Meta.Message table) { //     . //       //      // table.isClearOnUpdate() table.isOrderbook(); if (table.isClearOnUpdate()) records.clear(); return true; //   1.1.0   . } public void doneTableUpdate(Meta.Message table) { //    , - commit. //    . orderbook = null; } final Map&lt;String, Object&gt; keys = new LinkedHashMap&lt;String, Object&gt;(); public void setKeyValue(Meta.Field field, Object value) { //    . //  - -    map. //        //  (. doneRecordUpdate()) keys.put(field.name, value); } Record current; List&lt;Record&gt; orderbook; public boolean initRecordUpdate(Meta.Message table) { //   . //       //   true,     (.. ) if (table.isOrderbook()) { //    "orderbook" -   //    ,    "" current = new Record(); orderbook.add(current); return true; } else { System.out.println("Table:" + table.name +"; keys: " + keys.toString()); if (keys.isEmpty()) { // setKeyValue()      - //      . //     ,  //     . current = new Record(); records.put(Integer.toString(records.size()), current); return true; } else { //      - //       . final String key = keys.toString(); current = records.get(key); if (current == null) { //      -   current = new Record(); records.put(key, current); return true; } //    return false; } } } public void setRecordDecimals(int decimals) { //      // -   -  ( ). current.decimals = decimals; } public int getRecordDecimals() { //      //  -     //   -  . return current.decimals; } public void setFieldValue(Meta.Field field, Object value) { //       current.values.put(field.name, value); } public void doneRecordUpdate(Meta.Message table) { //   . //       -. //  - -    . System.out.println("Table:" + table.name +"; data: " + current.values.toString()); //        , //        . keys.clear(); current = null; } public void switchOrderbook(Meta.Message table, Meta.Ticker ticker) { //      "" (table.isOrderbook()) //       setKeyField()    //  ,    " " -  . //      ,     //    ticker. orderbook = orderbooks.get(ticker.toString()); if (orderbook == null) { //   , //    "" orderbook = new ArrayList&lt;Record&gt;(); orderbooks.put(ticker.toString(), orderbook); } else { // ""   -   , // ..     . orderbook.clear(); } } } }</span></span></code> </pre> <br>  Important point: despite the fact that the example above is in Java, in fact, you can use any languages ‚Äã‚Äãto work with the ASTS Bridge protocol.  There are no restrictions for developers of trading systems in this regard. <br><br><h4>  Conclusion </h4><br>  According <a href="http://habrahabr.ru/company/moex/blog/261369/">to</a> representatives of the Moscow Exchange in June 2015, its own native protocol is still inferior in popularity among traders to the FIX protocol.  In the stock market, FIX accounts for up to 60% of applications. <br><br>  Nevertheless, ASTS Bridge has its own advantages, for example, the unity of information objects (for example, tables and transactions), which are the same for all markets, which makes it easier to adapt trading applications at work on each of them.  One more advantage of ASTS Bridge is the low system requirements - to use this protocol, a dedicated server is not required, the client application can be run even on a personal computer. <br><br>  To work on this and other protocols described in our previous articles for direct access to the exchange, it is necessary to conclude an agreement with a broker (for example, ITinvest), which helps to <a href="http://www.itinvest.ru/services/access/">organize access</a> to trading on the selected technology. <br><br>  Today, thank you for your attention, we will be happy to answer questions in the comments. <br><br>  In our next articles we will continue to talk about existing exchange technologies, in particular, we will discuss the protocol Simple Binary Encoding, which, to a certain extent, is the successor of the FIX case. </div><p>Source: <a href="https://habr.com/ru/post/270961/">https://habr.com/ru/post/270961/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../270943/index.html">Concurrent programming in Java8. Creating multi-threaded programs using the Fork / Join Framework</a></li>
<li><a href="../270949/index.html">Factorization of numbers (option 2)</a></li>
<li><a href="../270951/index.html">Underground carders market. Translation of the book "KingPIN". Chapter 17. Pizza and Plastic</a></li>
<li><a href="../270955/index.html">What's New in Veeam Backup & Replication 9.0: New Products of the Veeam Explorers Line to Recover Application Objects</a></li>
<li><a href="../270957/index.html">Telegram Bots: Experience, Revelations, Design Tips</a></li>
<li><a href="../270965/index.html">Those village from zero to one. Now and with reviews of companies</a></li>
<li><a href="../270967/index.html">NUnit 3.0 released</a></li>
<li><a href="../270969/index.html">Restoring access rights for Mac OS X - EL Capitan</a></li>
<li><a href="../270971/index.html">Travel startups. How programmers on a trillionth market are lured: kofounders, vacancies, hackathons</a></li>
<li><a href="../270973/index.html">Titanic on Kaggle: you do not finish reading this post until the end</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>