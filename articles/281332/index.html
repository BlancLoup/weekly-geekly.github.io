<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Plugins in your pocket or penknife in the program</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article focuses on plugins - software modules that can be easily installed in the main application to extend its functionality. More precisely, n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Plugins in your pocket or penknife in the program</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/8d3/8dc/018/8d38dc01847e4cfe9f1b803c7056d679.jpg"></div><br><p>  This article focuses on plugins - software modules that can be easily installed in the main application to extend its functionality.  More precisely, not about the plugins themselves, but about how to implement the "Application - Plugin" interaction system in their program. </p><br><p>  On the network, you can easily find quite complex and, at times, confusing algorithms for integrating a similar system into your program code, but since we will use the Python programming language, everything will be simple and very clear for us. </p><a name="habracut"></a><br><p>  However, before you show the reader all the tools of your plug-in system - a kind of penknife, which in my opinion should be in every self-respecting pocket, sorry, program - a bit of background ... </p><br><p>  Once for my project I needed one single, well, very important function, which, unfortunately, I did not provide for at the development stage.  The project was big and rather old, so I had to tinker around for a week looking for the necessary classes and procedures in its code in order to hang the cherished button in the program menu that implements the missing functionality.  And, I confess, there is little joy in rewriting, if not everything, but some part of the application. </p><br><p>  After that, I firmly decided to review the architecture of my projects and, in order not to step on the same rake, I set myself the task: the expansion of the capabilities of my programs should be done in one click!  Said - done. </p><br><p>  So, we get a brand new skeleton of the future application out of the closet, which looks like this: </p><br><p><img src="https://habrastorage.org/files/4fd/949/571/4fd94957123346569a0f00950073e838.png" alt="image"></p><br><p>  And count his bones: </p><br><p>  The <strong>Libs</strong> folder is intended for libraries and modules of the future project.  At the moment, there are modules for initializing and connecting plugins: </p><br><p>  <strong>loadplugin.py</strong> - loads program plugins from the <strong>Plugins</strong> folder (will be created automatically) of the project root directory; <br>  <strong>manifest.py</strong> - a class that describes the manifest of the plugin being loaded; </p><br><p>  In the root directory of the project: </p><br><p>  <strong>program.py</strong> is the main application code located in the <strong>Program</strong> class; <br>  <strong>main.py</strong> - runs the program.py program code and connects the plug-ins, if any; </p><br><p>  Further, I will describe only the key points of the implementation of the plug-in system, omitting the creation of the simplest interface of the application to demonstrate the operation of the plug-in.  You can download a small archive with an example from the link at the end of the article. </p><br><p>  <strong>main.py:</strong> </p><br><pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#! /usr/bin/python2.7 # -*- coding: utf-8 -*- import traceback __version__ = "0.0.1" def main(): try: from Libs.loadplugin import loadplugin #    from program import Program #     app = Program() loadplugin(app) #   app.run() #   except Exception as exc: print traceback.format_exc() traceback.print_exc(file=open("error.log", "w")) #     . if __name__ "__main__": main()</span></span></code> </pre> <br><p>  The algorithm of the <strong>main.py</strong> module <strong>:</strong> </p><br><ol><li>  Create an instance of the <strong>app</strong> class <strong>Program</strong> and pass it to the function of loading plugins (this instance will be available to all plug-ins, giving them access to variables and functions implemented in the main program code of the <strong>Program</strong> class). </li><li>  Load the plugins. </li><li>  Run the application. </li><li>  Display a window with the text of the error, if any, occurred when the program was started. </li></ol><br><p>  <strong>loadplugin.py:</strong> </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># -*- coding: utf-8 -*- import os import traceback def loadplugin(app): """ . :type app: &lt;class 'program.Program'&gt;; :param app:   Program; """ #  . plugins_path = \ "{}/Plugins".format(os.path.split(os.path.abspath(sys.argv[0]))[0]) #     . plugin_list = \ eval(open("{}/plugins_list.list".format(plugins_path)).read()) for name in os.listdir(plugins_path): if name.startswith("__init__."): continue path = os.path.join(plugins_path, name) if not os.path.isdir(path): continue try: if name in plugin_list: execfile(os.path.join(path, '__init__.py'), {"app": app, "path": path}) except Exception: raise Exception(traceback.format_exc())</span></span></code> </pre><br><p>  Algorithm of the <strong>loadplugin.py</strong> module <strong>:</strong> </p><br><ol><li>  We scan the <strong>Plugins</strong> directory (package) for the presence of plug-in packages (any python package in the <strong>Plugins</strong> folder will be considered a plug-in). </li><li>  We initialize the list of plugins from the file <strong>plugins_list.list</strong> , which is located in the <strong>Plugins</strong> directory. </li><li>  If the found plugin is mentioned in this list, connect it, otherwise look for the next plugin. </li></ol><br><p>  For greater clarity, I removed from the <strong>loadplugin.py</strong> module the <strong>reconfiguration of the</strong> plug-ins and various checks for the absence of the <strong>Plugins</strong> directory, the <strong>plugins_list.list</strong> file, etc. </p><br><p>  As you noticed, the plugin is executed by the execfile function: </p><br><pre> <code class="python hljs"> execfile(os.path.join(path, <span class="hljs-string"><span class="hljs-string">'__init__.py'</span></span>), {<span class="hljs-string"><span class="hljs-string">"app"</span></span>: app, <span class="hljs-string"><span class="hljs-string">"path"</span></span>: path})</code> </pre> <br><p>  which executes the code of the <strong><strong>init</strong></strong> file of the plugin's package and sends to the global namespace of <strong><strong>init</strong> .py an</strong> instance of the <strong>app's</strong> main class. </p><br><p>  Further, through the <strong>app</strong> , the plugin gets access to all functions and variables of the application code.  Pretty simple. </p><br><p>  Now let's move from words to deeds and run a test case ( <strong>main.py</strong> ) from the <strong>TestPlugin</strong> folder. </p><br><p>  Here it is worth saying that I am writing, using mainly the <strong>Kivy</strong> framework, so to run the test cases it is assumed that all the necessary libraries are installed on your workstation. </p><br><p>  So, running the example, we see a simple interface with the <strong>actionbar</strong> at the bottom of the screen.  Select the button in the lower right corner, open a drop-down list of two items, click on the <strong>"Plugins"</strong> item and read the message "There are no plugins installed." </p><br><p><img src="https://habrastorage.org/files/e60/431/7de/e604317dee5242af845a8d0e8f6e0ae4.png" alt="image"></p><br><p>  Indeed, looking into the project folder, we find the new <strong>Plugins</strong> directory. </p><br><p><img src="https://habrastorage.org/files/f83/231/e6c/f83231e6cfb3436d9a8c5cc813280fb1.png" alt="image"></p><br><p>  In addition to the files already known to us, the directory for plug-ins is empty.  Well!  It's time to install them.  Let's expand the toolkit of our penknife with the help of the plugin and add a new button with the Habr logo to the actionbar. </p><br><p>  In the archive with a test example, in addition to the project <strong>TestPlugins</strong> , there is a folder <strong>Plugins</strong> .  Open it and copy the <strong>HabraButton</strong> plugin into the project in the <strong>Plugins</strong> directory. </p><br><p><img src="https://habrastorage.org/files/dd0/b8a/bf8/dd0b8abf8be04b979f46f5b7e872f094.png" alt="image"></p><br><p>  Now we run our test application again and select the <strong>"Plugins"</strong> item. </p><br><p><img src="https://habrastorage.org/files/9b4/8fa/310/9b48fa3100554092bee9f75a51d73434.png" alt="image"></p><br><p>  Hooray!  Our penknife just got a new tool, as promised, in one click. </p><br><p>  The item with the name of a fresh plug-in is lit in yellow, which means that the application has recognized it, but has not connected it to use.  We fix this by clicking on the button with the found plugin. </p><br><p><img src="https://habrastorage.org/files/46c/53d/d85/46c53dd850804d0e85ab4aabd0fc2733.png" alt="image"></p><br><p>  We connect the plugin, read the message that "The plugin is connected and will be imported into the project after the next launch." </p><br><p>  If you again select the "Plugins" item in the drop-down list, you will see that, indeed, the plug-in has been successfully disabled, as indicated by the button, which is already lit in blue. </p><br><p><img src="https://habrastorage.org/files/586/44e/bd1/58644ebd1d2544f9855eb2e2fb7283b4.png" alt="image"></p><br><p>  Actually, what happened when we chose the item "Connect"?  The name of the plug-in has been added to the list of allowed for use in the <strong>plugins_list.list</strong> file in the <strong>Plugins</strong> directory.  Now <strong>loadplugin.py</strong> plugin loading module will be able to import this plugin. </p><br><p>  Let's check it out and run the test case again. </p><br><p><img src="https://habrastorage.org/files/40c/7b8/a8f/40c7b8a8f943485993d24d33e4bbfd4d.png" alt="image"></p><br><p>  There was a new button with the Habr logo in the <strong>actionbar</strong> .  Click it and enjoy the message "Hello, plugin"! </p><br><p>  That's all. </p><br><p>  I do not consider in this article the code of the plugin itself (it is quite simple).  You can open the <strong><strong>init</strong> .py</strong> file of the <strong>HabraButton</strong> package and see how the plugin accesses the objects of the Program class code in the <strong>app</strong> instance.  Also overboard, I left the plug-in verification.  I need it to track compatibility and visualize information about plugins.  All this is in the test example. </p><br><p>  Hope could be useful! </p><br><p>  <a href="">Test example</a> - 40.65 Kb. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/281332/">https://habr.com/ru/post/281332/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../281318/index.html">Use an Intel RealSense camera with TouchDesigner. Part 2</a></li>
<li><a href="../281320/index.html">Perspectives of the go language for the programmer</a></li>
<li><a href="../281322/index.html">Gaming simulators for the development of BrainApps cognitive brain functions with a cloud backend</a></li>
<li><a href="../281324/index.html">"Looming Clouds" will make you rebuild your IT platform</a></li>
<li><a href="../281330/index.html">PHP and Temporal Coupling</a></li>
<li><a href="../281334/index.html">Character regression and another approach</a></li>
<li><a href="../281338/index.html">Deploy ASP.NET applications with symbolic links</a></li>
<li><a href="../281340/index.html">6 reasons for the failure of the mobile game in the international market</a></li>
<li><a href="../281342/index.html">JavaScript goes beyond the Web in 2015</a></li>
<li><a href="../281344/index.html">What criteria are important for a large client when choosing an agency for web development?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>