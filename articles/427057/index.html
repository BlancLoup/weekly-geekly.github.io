<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we taught the neural network to define documents</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This summer, we taught the neural network to determine if there is a document in the image, and if so, which one. 

 What did it take 
 To unload empl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we taught the neural network to define documents</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/76/zw/es/76zwesytlb-0l1vqn4ahunxamo0.png"><br><br>  This summer, we taught the neural network to determine if there is a document in the image, and if so, which one. <br><br><h1>  What did it take </h1><br>  To unload employees and protect people from scammers.  We use the new neural network in two areas: when the user recovers access to the page and to hide personal documents from the general search. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>  <strong>Restore access to pages.</strong>  Photos of documents help to return accounts to their original owners.  For example, a user could lose access to his phone number, or two-step authentication is connected on the page, and there is no longer a possibility to get a one-time code to confirm entry.  New development speeds up consideration of appeals: moderators no longer have to return incorrectly filed applications every time.  The system simply does not allow the visitor to send the form without the necessary images and asks to replace the random image with the document.  Of course, we can still return access to the page itself only if there are real photos of the owner on it.  We are talking about the security of accounts and the safety of personal data - it means there can be no blunders and accidents. <br><br>  <strong>Filtering search results in the " <a href="https://vk.com/docs">Documents</a> " section.</strong>  All documents that users upload to this section or send via private messages are, by default, hidden from prying eyes and do not fall into the search results.  But the level of privacy can be configured manually by yourself - for each individual file.  Before the advent of the neural network, a decent amount of documents with sensitive data could be found by keywords.  The owners of these files themselves have changed the privacy settings.  We secured users and started <strong>removing</strong> photos <strong>from the public search</strong> in which we can determine the availability of the document. <br><br><h1>  How we solved the problem </h1><br>  It seems that the easiest way to identify documents in an image is to set up a neural network or train it from scratch on a large sample.  But not everything is so simple. <br><br>  The sample should be representative.  It is difficult to find a sufficient number of real samples for each option: there are no public databases with these documents in the public domain. <br><br>  There are many systems that recognize and parsit documents.  Usually they are aimed at obtaining specific information from a photograph and suggest the perfect quality of the original image.  For example, the user may be required to align the passport along the edges of the template, as it works on the portal of state services. <br><br>  For our tasks, such systems are not suitable.  We separately clarify that when contacting us for restoration of access, the user <strong>can close</strong> all data on the document, except for the photo, name, surname and print.  At the same time, we still need to identify the document - even if the series and number are hidden on it, if the passport is removed along with the surrounding situation or, on the contrary, only a part of the document with a photo appeared on the image.  Still need to take into account different lighting and angles.  All such materials neural network must accept.  The question is how to teach her this. <br><img src="https://habrastorage.org/webt/6t/se/44/6tse44f59b1lyg9fbq_qdb53uqc.png"><br>  There are other difficulties.  For example, a passport is difficult to separate from other types of documents, as well as from various handwritten and printed papers. <br><br>  Attempting to go on a simple path was not very successful.  The resulting classifier was weak, with a small error of the first kind and a large error of the second.  For example, there were interesting cases when a person wrote the name and surname by hand, added a photograph, the cover of a passport - and the system blithely accepted such a document. <br><br><h1>  What we came to </h1><br>  In our situation, the best solution to the problem turned out to be the use of an ensemble of grids and face detectors to recognize the document and determine its type.  We also added a differential classifier, which includes an encoder to highlight the characteristic features, and a form classifier, which allows us to distinguish document images from irrelevant files.  In addition to this, pre-clustering of the training set takes place in order to normalize the dataset.  Of the architectures, <a href="http://www.robots.ox.ac.uk/~vgg/research/very_deep/">VGG</a> and <a href="https://arxiv.org/abs/1512.03385">ResNet have</a> proven <a href="http://www.robots.ox.ac.uk/~vgg/research/very_deep/">their</a> <a href="https://arxiv.org/abs/1512.03385">best</a> . <br><br><img alt="Neural network pattern" src="https://habrastorage.org/webt/rt/mj/f9/rtmjf9qbeumijkurfb0bmqim8wc.png"><br><br>  The basic document / non-document classifier works on the basis of a customized 19-layer VGG with a regionalized sample.  Over it, a combined ensemble of classifiers is used, which reduce the error of the second kind and differentiate the result.  First, there is a <a href="https://en.wikipedia.org/wiki/Stratified_sampling">stratified sampling</a> , then an encoder to extract the near-circuit information, then a modified VGG and, finally, a single grid.  This approach allowed us to minimize the errors of the first kind to a level of approximately 0.002.  The probability of false negative depends on the chosen dataset and specific application. <br><br>  Now we have learned how to automatically detect the presence of passports and driver's licenses in the picture.  Recognition successfully occurs at any angle, with any background, even in poor light - the main thing is that the image has a part of a document with a photo and a name.  However, to identify other types of documents, only relevant datasets will be required.  We train the network on our own data, the sample size of documents from five to ten thousand (but it is not representative).  For other images, the sample is arbitrary, but there and there, there is a priori clustering. <br><br>  From a technical point of view, the system is written in python / <a href="https://keras.io/">keras</a> / <a href="https://www.tensorflow.org/">tensorflow</a> / <a href="https://developer.gnome.org/glib/">glib</a> / <a href="https://opencv.org/">opencv</a> .  For practical application of the new system, it is enough to integrate it into the python-handlers of the machine learning infrastructure.  At the same stage, a photo change detector in graphic editors is added, but this topic deserves a separate article. <br><br><h1>  What is the result </h1><br>  Now, 6% of applications for access restoration are automatically returned to the author with a request to add or replace a photo of the document, and 2.5% of applications are rejected.  If you look at image analysis as a whole, including heuristics and the search for a person in the image, it <strong>automates up to 20% of the department‚Äôs work</strong> . <br><br>  After the launch of the neural network, we were also able to count the number of passports that are loaded into the "Documents" section.  It turned out that in the general search results every day there were about two thousand identity cards.  Now the likelihood that they will fall into extraneous hands, is minimal. <br><br>  Neural networks are already helping us fight spam and various types of fraud.  We do not stop the experiments and continue to talk about them in our blog. </div><p>Source: <a href="https://habr.com/ru/post/427057/">https://habr.com/ru/post/427057/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../427039/index.html">Voltmeter for batteries: a pocket gadget for a smartphone with crocodiles</a></li>
<li><a href="../427041/index.html">Friday. Nonsense programmer 3.0</a></li>
<li><a href="../427047/index.html">Honey, we kill free text content.</a></li>
<li><a href="../427053/index.html">Friday Help: 5 tools for the novice PHP developer</a></li>
<li><a href="../427055/index.html">How Apple went contrary to the five generally accepted PR-norms, but kept its good name</a></li>
<li><a href="../427059/index.html">"Human, too human." Will we not become hostages of our mind, realizing a universal AI?</a></li>
<li><a href="../427061/index.html">Voice assistants driving a car: for whom the future</a></li>
<li><a href="../427065/index.html">Class attribute metamorphosis</a></li>
<li><a href="../427069/index.html">Local NPM repository in 5 minutes with its packages and caching</a></li>
<li><a href="../427075/index.html">History of one development</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>