<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to disassemble monkey guts into its component parts. We study color deconvolution</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As many people remember, I work in a laboratory where we work with living and not so much organisms. Science is moving, in short. Usually forward. Som...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to disassemble monkey guts into its component parts. We study color deconvolution</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/de5/e79/26b/de5e7926b63e431ebca69d83705f9106.jpg"><br>  As many people remember, I work in a laboratory where we work with living and not so much organisms.  Science is moving, in short.  Usually forward.  Sometimes we take dead monkeys as samples, the tissues of which then go to experimental tasks.  It usually looks extremely cheerful.  The bell rang at 11 o'clock in the evening, and you are told that the monkey was killed in the nursery.  Almost undamaged, the neighbors only ate the heart.  We sigh, climb into the flight schedule and go to the airport.  On the spot, they give you the necessary spare parts of the slain and put them in a transparent container with a preservation solution.  At the airport with this can no longer be dragged, as the transportation of liquids is limited.  We go to the railway station by express to Krasnodar.  Pretty girls on the control usually get a delightful lime shade when they see organs slowly circling in a soft pink solution. <br>  In general, they brought, cut everything that was needed into slices, dyed it ... But it turns out that the received sources need to be processed and calculated automatically ... I just want to clarify that I am a research doctor, not a professional programmer or a mathematician.  Therefore, if something seems erroneous, I will be glad to be edited. <a name="habracut"></a><br><br><h4>  Formulate the task </h4><br><img src="https://habrastorage.org/files/f42/962/1c5/f429621c55cd46a1beb4d4eb5aefed53.jpg"><br><br>  So, there is a series of sections stained with two dyes.  Bluer is Mayer's hematoxylin, brown is DAB chromagen.  In this illustration, the monkey esophagus, and brown painted markers for pankeratin.  In principle, it does not matter.  The main thing is that we have two dyes that can simultaneously paint the same structures.  It is necessary to paint both at the same time, otherwise the structure of the slice is unclear.  The trouble is that often in order to count objects or determine the area of ‚Äã‚Äãstructures with a positive reaction to an antibody, we need to have an image where only one of the pigments is present.  That is, the task can be formulated roughly as " <b>split back the mixture of ketchup with mayonnaise</b> ."  And here the <b>color deconvolution</b> algorithm comes into play. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Color Deconvolution </h4><br>  I will try not to get into the deep jungle of mathematics, since I myself hardly understand it.  The color of the pixel in the image of the microdrug is determined by the absorption spectrum of light at this point.  The absorption spectrum accordingly depends on which pigment absorbs light.  However, we have an unpleasant situation when a conditional blue and brown dye are present at one point <b>at the same time</b> .  That is, their spectra are superimposed on each other. <br><img src="https://habrastorage.org/files/461/107/ac0/461107ac064443c981352c2d47b05807.png"><br>  I - intensity value for a given wavelength.  c is the concentration of the dye, beta is the proportionality coefficient, which depends on the physical properties of the substance.  That is, in fact, we need to evaluate the contribution that each of the dyes makes to the red, green and blue channels of the pixel.  For our task, we used the AC Ruifrok algorithm in G. Landini modification, which wrote a plugin for the open source software ImageJ.  ImageJ - software for batch image processing, written in Java.  Extremely flexible, allows you to coat it with a variety of plug-ins and write scripts for it.  We are lazy, let the machine grind tons of images for us.  But first you need to give her samples for which you want to make the separation. <br><br>  Samples are obtained using mono-staining sections.  Thus we obtain the RGB color of the reference standard.  Naturally, all manipulations are performed with the same exposure and white balance.  Feed the plugin and get the values ‚Äã‚Äãwe need: <br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myStain.equals(<span class="hljs-string"><span class="hljs-string">"Custom DAB"</span></span>)){ <span class="hljs-comment"><span class="hljs-comment">// This is the Custom DAB MODx[0]=0.66504073; MODy[0]=0.61772484; MODz[0]=0.41968665; MODx[1]=0.4100872; MODy[1]=0.5751321; MODz[1]=0.70785; MODx[2]=0.6241389; MODy[2]=0.53632; MODz[2]=0.56816506;</span></span></code> </pre> <br>  Theoretically, you can take ready-made pre-laboratory samples.  In practice, it turns out that in each laboratory the dyes differ slightly in hue, which makes calibration on each lot extremely desirable.  In order for this profile to appear in the list of options, you have to shove it into the source java-file.  Instructions <a href="http://www.mecourse.com/landinig/software/cdeconv/cdeconv.html">on the developer page</a> .  The better defined the dye vectors, the closer the complementary image to the white - what remains after picking out our pigments.  So, drum roll and the result of dark magic: <br><img src="https://habrastorage.org/files/f42/962/1c5/f429621c55cd46a1beb4d4eb5aefed53.jpg"><br><br><img src="https://habrastorage.org/files/eab/a8a/b6d/eaba8ab6ddf4476583d84b47a8b3086e.jpg"><br><br><img src="https://habrastorage.org/files/2cd/247/4c1/2cd2474c18824a6996196796acfd1263.jpg"><br><br><div class="spoiler">  <b class="spoiler_title">More pictures</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/369/496/8f9/3694968f9ddf4133b4ed06cf5de9ddf2.jpg"><br><br><img src="https://habrastorage.org/files/cc2/782/65c/cc278265c8be48e2b9b773f787a61025.jpg"><br><br><img src="https://habrastorage.org/files/058/611/314/058611314ba34bb299b5ee9ebfdbc08b.jpg"><br></div></div><br><br><h4>  Batch processing </h4><br>  Now we need all this disgrace to work in a batch version.  We do not want to poke manually in each file?  ImageJ allows you to write custom scripts, which is convenient for such tasks.  Actually, it creates a regular file in txt format, which describes the manipulations with your source code.  I did something like this: <br><br><pre> <code class="java hljs">dir1 = getDirectory(<span class="hljs-string"><span class="hljs-string">"Choose Source Directory "</span></span>); dir2 = getDirectory(<span class="hljs-string"><span class="hljs-string">"Choose Destination Directory "</span></span>); list = getFileList(dir1); setBatchMode(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;list.length; i++) { showProgress(i+<span class="hljs-number"><span class="hljs-number">1</span></span>, list.length); open(dir1+list[i]); imgName=getTitle(); run(<span class="hljs-string"><span class="hljs-string">"Colour Deconvolution"</span></span>, <span class="hljs-string"><span class="hljs-string">"vectors=[Custom DAB]"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//close windows we don't need selectWindow(imgName + "-(Colour_3)"); close(); selectWindow(imgName +"-(Colour_1)"); title = getTitle(); saveAs("JPG", dir2 + title); close(); selectWindow(imgName + "-(Colour_2)"); title = getTitle(); saveAs("JPG", dir2 + title); close(); }</span></span></code> </pre><br><br>  Now you can feed the resulting images of software, sharpened for recognition of objects in biological preparations.  But this is already in the next article) <br><br>  UPD.  The author of the algorithm gives quite interesting applications - the identification of inscriptions filled with ink of a different color (Beinecke Rare Book and Manuscript Library, Yale University) <br><br><img src="http://www.mecourse.com/landinig/software/cdeconv/f002r.png" alt="image"><br><br><img src="http://www.mecourse.com/landinig/software/cdeconv/green.png" alt="image"><br><br><img src="http://www.mecourse.com/landinig/software/cdeconv/ink.png" alt="image"><br><br>  UPD2.  These cute baboons love to kill each other fucking in hierarchical clashes. <br><br><img src="https://habrastorage.org/files/ba3/00e/e44/ba300ee44755412d8edb8bd8f4bd1dae.jpg"><br><img src="http://ic.pics.livejournal.com/crisdraper/44457233/22304/22304_original.jpg" alt="image"></div><p>Source: <a href="https://habr.com/ru/post/265961/">https://habr.com/ru/post/265961/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../265945/index.html">Google Chrome 45 web browser released</a></li>
<li><a href="../265947/index.html">Yota delivers</a></li>
<li><a href="../265949/index.html">Conference C ++ Siberia'2015</a></li>
<li><a href="../265953/index.html">Conference Program PYCON RUSSIA 2015</a></li>
<li><a href="../265957/index.html">Optimization of the git-server</a></li>
<li><a href="../265963/index.html">Context Sensors in Windows 10</a></li>
<li><a href="../265965/index.html">API for validator from Yandex. And why do the micro-mark validators give different answers?</a></li>
<li><a href="../265967/index.html">And these people forbid me to pick one's nose ... (in continuation of the theme of the sled for the HDD)</a></li>
<li><a href="../265969/index.html">Safe dynamic update of records on MS DNS from Linux</a></li>
<li><a href="../265971/index.html">Small usefulness for a GLPI + FusionInventory bundle</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>