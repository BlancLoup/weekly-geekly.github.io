<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Localization of the application and support for RTL. Report Yandex.Taxi</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When localizing the service, it is important to carefully consider the coordination of transfers between each other. The leader of the Android client ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Localization of the application and support for RTL. Report Yandex.Taxi</h1><div class="post__text post__text-html js-mediator-article">  When localizing the service, it is important to carefully consider the coordination of transfers between each other.  The leader of the Android client development team at Yandex.Taxi, Alexander Bonell, explained what practices and tools simplify localization.  In the second part of the report, Sasha shared his experience of supporting the RTL language in the application: what is good and what does not quite work for Android out of the box, what problems arise because of support for RTL and how to minimize them in the future. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/GWY-TC-rBqA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  - In my report, I want to tell you what basic ideas and practices we use in mobile application development teams Taxi to solve issues related to the localization and translation actualization in our applications.  Then I will tell you how we implemented support for working in the drawing mode from right to left in the application. <br><br><a name="habracut"></a><img src="https://habrastorage.org/webt/eq/rz/nc/eqrzncvf8d0spwi7ekgceao4jnq.jpeg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I'll start with localization.  First of all, I would like to clarify the terminology.  According to my observations, a large number of people believe that localization is limited to only translations, although in fact it also solves problems related to the formatting of numbers, dates, times, working with text and symbols, legal aspects, serving content to the consumer in such a way that he had a semantic value for him and was not perceived ambiguously.  And much more.  <i>(Communication with the audience about who has how many languages ‚Äã‚Äãare supported in applications - approx. Ed.)</i> <br><br>  I want to tell you a story that happened in 2014.  We then made a major redesign of the Taxi application.  In one of the regular releases, we gave users the opportunity to indicate the access number, as well as look at this information on the trip information screen and, most importantly, on the order evaluation screen, which we showed to all users, because we definitely wanted to get an estimate for the trip . <br><br><img src="https://habrastorage.org/webt/a2/zv/nr/a2zvnrpbk6lt0mzepb0zgflx4hs.jpeg"><br><br>  At that time, we were rather frivolous about the localization process and translations.  For the most part, the whole process was manual.  Updating texts in the necessary XML files, adding new translations was done manually.  And the human factor played its role.  The developer did not define the next translation in the default locale.  This led to the fact that for users with a system locale other than Russian, if they asked for an entrance, the application crashed after the trip.  And people could not make another order. <br><br>  At that time, we had two languages ‚Äã‚Äãsupported in the application: Russian and English.  And we worked only in Russia in three cities: Moscow, Yekaterinburg, St. Petersburg. <br><br><img src="https://habrastorage.org/webt/1l/uz/fr/1luzfrwtjpoahxudetzo1m-o5su.jpeg"><br><br>  We are currently working in 16 countries and translated into 18 languages.  I think you understand all the delicacy of the problem, if we were in such a state at that time.  We already realized that we need to change something. <br><br><img src="https://habrastorage.org/webt/rh/01/t9/rh01t9e0avfjcq68wrno7wgd7cs.jpeg"><br><br>  In Yandex, most mobile application developers use the service developed internally to solve localization problems.  It has a very convenient UI-interface, it is possible to define your project, set a set of keys, a set of languages ‚Äã‚Äãinto which the project should be translated.  And after the translations appear, they can be unloaded in any convenient format.  It also has very good integration with our internal services.  There is a versioned version.  But personally for me as a developer, the most important thing is that he has an API, because it already suggests that all manual work related to translations can be automated.  What we did.  We developed a plugin for Gradle.  In fact, translation actualization in the application now comes down to the fact that the developer performs a single task: updateTranslations. <br><br><img src="https://habrastorage.org/webt/nn/ty/vl/nntyvlcqehgpjqs7o2j596ajclu.jpeg"><br><br>  In the first approximation, he goes to the localization service.  Checks the availability of current translations, uploads them to the project, decomposes them into the necessary files.  But besides this, he also verifies the status of transfers in the localization service in relation to what is now in the project. <br><br><img src="https://habrastorage.org/webt/3v/l4/lw/3vl4lw_hjl1unisfzohquap6pdg.jpeg"><br><br>  When you next run git status, the developer sees in his working directory which files have changed. <br><br><img src="https://habrastorage.org/webt/tz/ze/ax/tzzeaxdlmarko1iadjt93fqw62s.jpeg"><br><br>  He can also look at the generated HTML report about which key has changed to which value in which language. <br><br><img src="https://habrastorage.org/webt/kj/s_/dq/kjs_dqxcplzqkbkbbmrvku1t3we.jpeg"><br><br>  And also he can see what problems are currently present in the translations of his project. <br><br><img src="https://habrastorage.org/webt/-r/ra/bu/-rrabu4tqheiglsxphowucm4jwo.jpeg"><br><br>  Plugin configurable.  We can determine the number of languages ‚Äã‚Äãthat our application supports.  It is very important if localizers get a new language, and it inadvertently seeps into the project, being not passed through proofreading and reading. <br><br><img src="https://habrastorage.org/webt/f8/d3/rz/f8d3rz6arfem3oubg357ueyovp4.jpeg"><br><br>  There is also a specific ability to remap.  I will talk about it a little later in more detail when I talk about RTL. <br><br>  What problems is this plugin analyzing now?  The problem that we faced in 2014 is banal, the lack of translation.  Now, in order to add a new line, a new translation to the project, it is not enough for the developer to simply define it in the XML file. <br><br><img src="https://habrastorage.org/webt/wo/bh/oj/wobhojdihwoskpf0pdbywbtyqxk.jpeg"><br><br>  First, if he does it in a default locale, then his newly entered key will simply be lost during the next synchronization, and he will know about it at the compilation stage. <br><br><img src="https://habrastorage.org/webt/fq/qc/bi/fqqcbimobnxyozdh0-nppnlmmem.jpeg"><br><br>  If he determines the key in the default file, but forgets to do it in the localization service, then the next time the updatetranslations task is executed, he will receive an error from the plugin that will tell him: ‚ÄúThis key is in your project, but it is not in the localization service, it‚Äôs there need to start. " <br><br><img src="https://habrastorage.org/webt/j5/nh/7a/j5nh7adfyozxrjqkjhuenukk9dg.jpeg"><br><br>  The second typical problem is the lack of translation.  We get a list of links to those keys for which there is no translation, and, as a rule, we assign them to our manager so that they can later set up communication with translators.  The third point is often found when they decided to revise the use of format arguments in some key, and, for example, they began to use a string format instead of an integer format. <br><br>  But at the same time, in one of the translations, they forgot to change the number to a string. <br><br><img src="https://habrastorage.org/webt/ki/6t/er/ki6terstg0cwbbidor71bw1fvnk.jpeg"><br><br>  And the fourth problem is also due to the human factor, mainly during translation.  If Unicode characters are used in the translation, it is very easy to get confused in the positioning of characters and, instead of an inseparable space, get a break to another line ‚Äî something that we are trying to get rid of. <br><br>  It's all about localization. <br><br>  Now I want to tell you about the experience of introducing support for rendering from right to left in the application using the example of Israel.  We launched in 2018 under the Yango brand in Israel.  As it turned out, people in Israel do not read in the way we do.  They read from right to left. <br><br><img src="https://habrastorage.org/webt/vs/mc/aw/vsmcawgpfojh3fuu35gjubgayvc.jpeg"><br><br>  Where do you want to start?  That in Android, in principle, right-to-left rendering support is implemented quite well from the box. <br><br>  It begins with the fact that in the application manifest, in the Application element, you need to declare the supportRtl = ‚Äùtrue‚Äù attribute.  But I want to please you: if you integrate the Facebook SDK for social authorization in your applications, the caring Facebook developers have already done it for you.  And if you do not validate the manifest during merging, you will have this attribute with a value of true in your application, and it will already be able to be in Rtl.  This is something to think about. <br><br>  I think that most of those sitting in the audience probably minimally support the version of Android 4.4.  Someone more lucky - this is 5.0 and higher.  Someone might have less luck, and they support 4.0, or, God forbid, 2.3.  In this case, you will have big problems, because the full support for Rtl in Android appeared since version 4.2.  Therefore, with minSdk 17th, you will simplify your life by an order of magnitude. <br><br>  Transferring a project to work with Rtl begins with the refactoring tool in Android Studio - Add RTL Support Where Possible.  We must pay tribute, works quite well.  It traverses your markup XML files, looks for attributes with left and right values ‚Äã‚Äãfor gravity, paddings, margins, and replaces them with start and end.  If you want to see how your application works by default when drawing in right-to-left mode, you do not need to have content with so-called RTL strong characters in your hand ‚Äî in Hebrew or Arabic.  You just need to enable the Force RTL Layout Direction option in the developer settings. <br><br>  What possibilities for customizing UI and text rendering Android provides for RTL? <br><br><img src="https://habrastorage.org/webt/cm/sb/tv/cmsbtvixwje70yhp48qyqzdhr7q.jpeg"><br><br>  The first point is the layoutDirection attribute, which uses the Force RTL Layout Direction option described.  She has only four possible values.  That is, it is inherited from the parent by default.  It can be said that the layout is rendered based on the selected locale.  You can clearly say that it is drawn from right to left or left to right. <br><br>  The second element, which many probably out of habit, bypass when they align text is textAlignment.  Many still continue to use gravity.  For text alignment, do not use gravity, but use textAlignment. <br><br>  The third attribute is the text rendering direction, textDirection.  He has a fairly flexible setting.  It allows you to determine how the text is rendered, depending on which first strong character was caught in the text, whether it is from the Latin character set strong LTR or from Hebrew strong RTL.  But if you fully support RTL in the application, you do not need to get round it, because when you ignore, there is such a funny artifact. <br><br><img src="https://habrastorage.org/webt/9d/be/rs/9dbersx2uji8brgn6kgxwzu1o7w.jpeg"><br><br>  Whether it is a Easter egg, or whether it is such a side effect in the editText implementation: your hint and editText starts to split.  Therefore, no value should be given to him in any case. <br><br><img src="https://habrastorage.org/webt/mc/v9/0g/mcv90gysejpzyj-rqpvn8vwf2hc.jpeg"><br><h5>  <sup><sub><a href="https://www.w3.org/International/questions/qa-bidi-unicode-controls">Link from the slide</a></sub></sup> </h5><br>  If you need to observe a certain rendering of some graphic resources or markup in RTL mode, then Android provides the opportunity to set qualifier ldrtl in your daddy, in which you can put any resource, and it will be drawn in RTL drawing mode as you specified. <br><br>  Sometimes there is a need for a runtime that the text coming from the backend is drawn as it is, how it came, ignoring the mode in which your application is currently running.  In fact, in the text renderer, this is due to the fact that the text is framed by the so-called Bidi Unicode control characters.  The logic for working with these characters in itself contains the BidiFormatter class, providing only one single unicodeWrap method.  It takes the SharSequence at the input, and returns you a string framed by these characters.  There are an exhaustive number of them, and, in principle, it should solve most of your problems. <br><br>  But if there is something so specific, w3.org has a <a href="https://www.w3.org/International/questions/qa-bidi-unicode-controls">good article</a> on how to use these symbols. <br><br>  What problems did we acquire when we started RTL support in our application?  First of all, it is a conflict of localization standards. <br><br>  BCP47 is a newer standard for localization, which in particular has changed the codes of some locales.  And the fact is that there is a problem with the Java locale class.  It defaults to backward-compatibility mode, and the locale that comes with it from BCP converts to ISO.  That is, we saw this when the iw code went to our backend in the Accept-Language header instead of the he code. <br><br><img src="https://habrastorage.org/webt/j-/mo/ct/j-moctus3m7dd2g4l9lidazv2-c.jpeg"><br><h5>  <sup><sub><a href="">Link from the slide</a></sub></sup> </h5><br>  If you remember the slide with the configuration of our plugin, remapping was needed just for this - in order to transfer content from he to iw. <br><br>  If you need to use the BCP format, this is fully implemented in the Apache Cordova project.  They have a Globalization class and an implementation of the localeToBcp47Language. <br><br><img src="https://habrastorage.org/webt/kk/gi/cc/kkgicc_cunw19hbpqqxhujoattq.jpeg"><br><br>  Another point that "delivers" with the support of RTL in the application is animation.  Here, the benefit, in fact, affects only animations on the X axis, and perhaps the only solution or approach that will help you avoid more problems is the ability to revise absolute animations in the direction of relative animations. <br><br>  One problem that can be solved, perhaps, is only reflection, because it is rigidly implemented in the component itself - this is the hint alignment of TextInputLayout.  The fact is that if hint is specified in RTL strong Hebrew characters, it will be clearly aligned to the right, even though the content you enter in edit text may be from Latin characters.  And vice versa.  If you hint in Latin, it will be clearly aligned to the left.  This can be solved only with the help of reflection. <br><br><img src="https://habrastorage.org/webt/3j/t3/7l/3jt37lzetmufyxkksu32u-wet-a.jpeg"><br><br>  In the end, after you have implemented RTL in your application, it makes sense to review the severities for the RTL issues that Lint analyzes.  There are only four of them.  If you do not support RTL in your application, but obviously use RTL specific attributes somewhere, then this is RtlEnabled (Lint will tell you about it). <br><br><img src="https://habrastorage.org/webt/ox/ea/92/oxea92pkwyozfe49d2xkfwc8pkq.jpeg"><br><h5>  <sup><sub><a href="">Link from the slide</a></sub></sup> </h5><br>  If you support RTL in the application, but your application‚Äôs minSdkVersion is below 17, then you must also continue to use the left and right attributes, you cannot use only the start and end attributes in your markup.  This is what RtlCompat analyzes.  RtlSymmetry swears when it sees asymmetric paddings.  In general, my opinion is that aapt when processing resources should crash if it stumbles upon symmetrical paddings.  If you need any asymmetric access, use margins as a full layout parameter. <br><br>  Finally, the fourth problem is hardcoded RTL.  This is precisely the fact that only the left and right values ‚Äã‚Äãare specified in the attributes.  In effect, this negates the refactoring tool Add RTL Support Where Possible.  This is all out of Lint over the RTL entry.  Also, the implementation of the analysis is available in the AOSP in the RtlDetector class.  That is, if fantasy allows you, you can come up with something of your own by looking at how the analysis is taking place now. <br><br>  My report is coming to an end.  I want to cite several theses on building the correct localization in our application, which we eventually came to. <br><br><img src="https://habrastorage.org/webt/fb/pe/su/fbpesuzh58zlmnzg1tkqcpyphqw.jpeg"><br><br>  First of all, at the start of the project, think about internationalization.  I did not really mention it.  This is not the same as localization.  In fact, internationalization makes localization possible in an application, in a product.  It works out of the box for Java due to the fact that there is full Unicode support, and for Android - due to a rich system of resources.  Perhaps the only thing that can happen here is our fixation as developers on the subject of ‚ÄúI write the application only for Russian, which means I will check it only with the Russian language‚Äù.  And when you start using Armenian, Georgian, Hebrew or Arabic in the application, the picture looks very different and breaks about your usual paradigm. <br><br>  Second moment.  Think about embedding localization in your CI.  It is a pity to learn about the problems associated with translations at the stage of testing a release candidate for whom you could prepare for several weeks.  That is, we now run this task to every pool-request, so that we are sure that everything is good with the translations and we can freeze the new code into the main branch of the project. <br><br>  Third moment.  Respect the work of translators and your budget.  First, remove unused resources, because people can continue to spend time and money on translating strings that you don‚Äôt use in your project.  Secondly, follow the translations that are in your repository in the localization service, but which are not in your code. <br><br>  Ideally, if the API of your localization service provides information about when a particular key was entered, and you can use heuristics like ‚ÄúIf the key is entered more than a month ago,‚Äù check its presence in the latest revision of the master branch.  If he is not there, most likely, this is an obvious candidate for removing it and for localizers not to waste time on it. <br><br>  A more or less universal candidate for a silver bullet is to store lines on the backend, not on the client.  At the very least, this will give you the opportunity to always keep them relevant to the application. <br><br>  We have a very diverse audience of users, each perceives the world and the content of the application in their own way.  Our job as developers is to help keep that perception.  My report is over.  Thank you very much! </div><p>Source: <a href="https://habr.com/ru/post/456250/">https://habr.com/ru/post/456250/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../456236/index.html">Peter - Insider Dev Tour: Insider Conference for Microsoft Developers</a></li>
<li><a href="../456240/index.html">Chat bot development (laravel + botman)</a></li>
<li><a href="../456242/index.html">A little more about multitasking in microcontrollers</a></li>
<li><a href="../456246/index.html">Item size zero</a></li>
<li><a href="../456248/index.html">How I caught the styles: before for the focus element</a></li>
<li><a href="../456256/index.html">Android Application Architecture Guide</a></li>
<li><a href="../456258/index.html">Free as wind and free as beer translation of "Free as in Freedom" into Russian under the license GNU FDL 1.3</a></li>
<li><a href="../45626/index.html">jQuery and ContextMenu plugin - right click in Opera</a></li>
<li><a href="../456260/index.html">Talk about a fair economy</a></li>
<li><a href="../456262/index.html">Software Defined Radio - how does it work? Part 9</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>