<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automatic connection of network MFPs with the ability to scan [Part 1]</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="HP LaserJet 1522, 1536, 3052/3055, 300/400 Color ... 
 I think many system administrators are familiar with the ones described in the header of the MF...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automatic connection of network MFPs with the ability to scan [Part 1]</h1><div class="post__text post__text-html js-mediator-article"><h1>  HP LaserJet 1522, 1536, 3052/3055, 300/400 Color ... </h1><br>  I think many system administrators are familiar with the ones described in the header of the MFP, they differ, first of all, by not very convenient installation and have notoriety from this.  Once, copying the fullsolution package for an MFP weighing about 300 megabytes to another computer through a narrow channel, the idea of ‚Äã‚Äãdisassembling this installer and automating the installation got out of sight ‚Äî the work had to be suspended. <br><br><img src="https://habrastorage.org/files/3e4/567/2b3/3e45672b387c495babe863a199abb41e.png"><br><br>  <i>I was engaged in the analysis of the driver about a year and a half ago, while the Internet on this topic was completely empty.</i>  <i>Now I quickly googled for the utilities keywords I now know and found some scattered information.</i>  <i>Despite this, I decided.</i>  <i>that the information collected in one place still does not hurt, despite the fact that in this post it is more complete.</i> <br><a name="habracut"></a><br><h2>  Customize print </h2><br>  The first to request for snmp seemed to the HP LaserJet 1536 mfp, and decided to start with it.  First you need to understand.  how to connect it as a printer for Windows 7;  old XP dropped immediately, fresh Windows 8 in the domain, there is an opinion I never see.  That's the reason to get acquainted with the new PowerShell, I thought, which in the end was almost the main motivation in the driver's analysis.  Connecting an ip-printer in Windows 7 consists of three stages (in Windows 8, everything is greatly simplified by the built-in cmdlets, but I have already said about it - no luck), first create an ip-port, then add the driver and connect the printer itself.  For all these steps, there are already ready VBS scripts in Windows, and I think many people know the path to them in Windows 7: : \ Windows \ System32 \ Printing_Admin_Scripts \ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I'll start by creating a port, this stage is the easiest, we will give the name the same as ip: <br> <code>cscript C:\Windows\System32\Printing_Admin_Scripts\ru-RU\prnport.vbs -a -r "192.168.0.30" -h "192.168.0.30" -o RAW -n 9100 <br></code> <br><br>  Add driver: <br> <code>cscript C:\Windows\System32\Printing_Admin_Scripts\ru-RU\prndrvr.vbs -a -m "HP LaserJet M1530 MFP Series PCL 6" -e "Windows NT x86" -h "C:\drivers\1536\"-i "C:\drivers\1536\hpc1530c.inf"</code> <br> <br><img src="https://habrastorage.org/files/cd9/641/1ff/cd96411ffd134a42834d530bbab4ad0e.png"><br><br>  Here it is worth noting one important feature: the printer name should be specified in the same way as it is written in the driver‚Äôs inf file, remove part of the name for the sake of example, the script will generate the error: ‚ÄúCould not add the HP LaserJet printer driver Win32 87 error code‚Äù. <br><br>  Extract from the driver file with the full printer name: <br><br><img src="https://habrastorage.org/files/5bf/b48/e03/5bfb48e03b4045539631b66ec4fb2a69.png"><br><br>  Now it remains to connect the printer, for this I stopped at the wonderful program printui, I advise you to take a closer look at it, it has interesting keys. <br> <code>&amp;rundll32 printui.dll,PrintUIEntry /if /b "HP LaserJet M1530 MFP Series PCL 6" /r "192.168.0.30" /m "HP LaserJet M1530 MFP Series PCL 6" /u /K /q /Gw</code> <br> <br>  It's time to put all this into something like the following PowerShell script: <br><br><pre> <code class="hljs php"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrinterPort</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($printersource)</span></span></span><span class="hljs-function"> </span></span>{ cscript C:\Windows\System32\Printing_Admin_Scripts\ru-RU\prnport.vbs ` -a -r $printersource -h $printersource -o RAW -n <span class="hljs-number"><span class="hljs-number">9100</span></span> | Out-<span class="hljs-keyword"><span class="hljs-keyword">Null</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrinterDriver</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($printername, $driverpath)</span></span></span><span class="hljs-function"> </span></span>{ $folder = Split-Path $driverPath cscript C:\Windows\System32\Printing_Admin_Scripts\ru-RU\prndrvr.vbs ` -a -m $printername -e Get-Platform -h $folder -i $driverpath } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Platform</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([System.Environment]::Is64BitOperatingSystem) { <span class="hljs-string"><span class="hljs-string">"Windows x64"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-string"><span class="hljs-string">"Windows NT x86"</span></span> } } Add-Type -<span class="hljs-keyword"><span class="hljs-keyword">As</span></span> Microsoft.VisualBasic $printerSource = [Microsoft.VisualBasic.Interaction]::InputBox(<span class="hljs-string"><span class="hljs-string">" IP  ."</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($printerSource -match <span class="hljs-string"><span class="hljs-string">"^192\.168\.0\.[0-9]{1,3}$"</span></span>) { $printername = <span class="hljs-string"><span class="hljs-string">"HP LaserJet M1530 MFP Series PCL 6"</span></span> $driverpath = <span class="hljs-string"><span class="hljs-string">"C:\drivers\1536\hpc1530c.inf"</span></span> Add-PrinterPort $printersource Add-PrinterDriver $printername $driverpath <span class="hljs-comment"><span class="hljs-comment">#  &amp;         &amp;rundll32 printui.dll,PrintUIEntry /if /b $printername /r $printersource /m $printername /u /K /q /Gw Start-Sleep -Seconds 10 }</span></span></code> </pre><br><br><img src="https://habrastorage.org/files/e3e/732/521/e3e7325210a34a4b855f91d8a53e3b00.png"><br><br><h2>  Scanning </h2><br>  Delving into the inf files of the driver, in order to find the correct name of the printer and incidentally generally understanding the HP driver structure, the eye caught on the following lines (highlighted in bold): <br><br><blockquote>  ; Windows Vista <br>  [HP.NT.6.0] <br>  "HP LJ M1530 MFP Series Scan" = WIA_1530_Inst.NT.6.0, USB \ vid_03f0 &amp; pid_012a &amp; mi_00 <br>  "HP LJ M1530 MFP Series Scan" = WIA_1530_NW.NT.6.0, <b>vid_03f0 &amp; pid_012a &amp; IP_SCAN</b> <br><br>  ; Windows Vista 64 <br>  [HP.NTAMD64.6.0] <br>  "HP LJ M1530 MFP Series Scan" = WIA_1530_Inst_Vista64, USB \ vid_03f0 &amp; pid_012a &amp; mi_00 <br>  "HP LJ M1530 MFP Series Scan" = WIA_1530_NW_Vista64, <b>vid_03f0 &amp; pid_012a &amp; IP_SCAN</b> <br></blockquote><br><br>  I would like lyrics here (it would seem, what does 1C have to do with it? If you understand what I mean), but I‚Äôll go down to a dry statement: try devcon.exe. <br><br><blockquote>  DevCon is a command-line program that is used as an alternative to the device manager. With its help, you can turn on, turn off, restart, update, delete, and poll individual devices or groups of devices.  DevCon also provides information needed by the driver developer that is not available through Device Manager. <br><br>  <a href="http://support.microsoft.com/kb/311272/ru">support.microsoft.com/kb/311272/en</a> </blockquote><br>  Add a device by ID indicating the driver: <br><br> <code>.\devcon.exe /r install C:\drivers\1536scan\hppasc16.inf "vid_03f0&amp;pid_012a&amp;IP_SCAN"</code> <br> <br>  Add the necessary parameters to the registry, run the scan and ... Bingo! <br>  The scanner works fine, it remains to arrange it all. <br><br>  Scanner settings in the registry are stored in the following ways: <br>  HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Control \ Class \ {6BDD1FC6-810F-11D0-BEC7-08002BE2092F} <br>  HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Enum \ Root \ IMAGE <br><br>  We empirically determine the registry keys we need: <br><br><img src="https://habrastorage.org/files/f63/99d/9f1/f6399d9f132a48ba9bd2e6b9f76408d7.png"><br><br><img src="https://habrastorage.org/files/590/121/fb6/590121fb63b047ff8a83405624524623.png"><br><br>  In order to conveniently add registry settings, create the file quoted below, which will serve as a template for modification within the script. <br><br><blockquote>  Windows Registry Editor Version 5.00 <br><br>  [HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Control \ Class \ {6BDD1FC6-810F-11D0-BEC7-08002BE2092F} \ _ ITEM_ \ DeviceData] <br>  "NetworkDeviceID" = "\\ hostname: _NETWORK_NAME_.domain.local \\ ipaddr: _IP_ADDRESS _ \\ guid: \\ macaddr: _MAC_ADDRESS _ \\ port: 1" <br>  "PortID" = "_ IP_ADDRESS_" <br>  "NetworkHostName" = "_ NETWORK_NAME_.domain.local" <br>  "TulipIOType" = dword: 00000005 <br><br>  [HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Enum \ Root \ IMAGE \ _ITEM_ \ Device Parameters] <br>  "NetworkDeviceID" = "\\ hostname: _NETWORK_NAME_.domain.local \\ ipaddr: _IP_ADDRESS _ \\ guid: \\ macaddr: _MAC_ADDRESS _ \\ port: 1" <br>  "PortID" = "_ IP_ADDRESS_" <br>  "NetworkHostName" = "_ NETWORK_NAME_.domain.local" <br>  "MAC" = "_ MAC_ADDRESS_" <br>  "PortNumber" = "1" <br>  "Index" = "_ ITEM_" </blockquote><br><br>  The finished scanner installation script will look as follows: <br><br><pre> <code class="hljs smalltalk"><span class="hljs-string"><span class="hljs-string">$I</span></span>P_ADDRESS = <span class="hljs-comment"><span class="hljs-comment">"192.168.0.30"</span></span> <span class="hljs-string"><span class="hljs-string">$M</span></span>AC_ADDRESS = <span class="hljs-comment"><span class="hljs-comment">"001b00b2cc00"</span></span> <span class="hljs-string"><span class="hljs-string">$N</span></span>ETWORK_NAME = <span class="hljs-comment"><span class="hljs-comment">"NPI3CPOF7"</span></span> <span class="hljs-string"><span class="hljs-string">$s</span></span>ource = <span class="hljs-comment"><span class="hljs-comment">"C:\drivers\1536scan"</span></span> <span class="hljs-string"><span class="hljs-string">$d</span></span>est = <span class="hljs-type"><span class="hljs-type">Join</span></span>-<span class="hljs-type"><span class="hljs-type">Path</span></span> (<span class="hljs-type"><span class="hljs-type">Get</span></span>-<span class="hljs-type"><span class="hljs-type">Location</span></span>).path <span class="hljs-comment"><span class="hljs-comment">"\temporary"</span></span> <span class="hljs-type"><span class="hljs-type">Copy</span></span>-<span class="hljs-type"><span class="hljs-type">Item</span></span> <span class="hljs-string"><span class="hljs-string">$s</span></span>ource <span class="hljs-string"><span class="hljs-string">$d</span></span>est -<span class="hljs-type"><span class="hljs-type">Recurse</span></span> -<span class="hljs-type"><span class="hljs-type">Force</span></span> <span class="hljs-string"><span class="hljs-string">$d</span></span>est = <span class="hljs-type"><span class="hljs-type">Join</span></span>-<span class="hljs-type"><span class="hljs-type">Path</span></span> <span class="hljs-string"><span class="hljs-string">$d</span></span>est <span class="hljs-comment"><span class="hljs-comment">"\hppasc16.inf"</span></span> # devcon       &amp; .\devcon.exe /r install <span class="hljs-string"><span class="hljs-string">$d</span></span>est <span class="hljs-comment"><span class="hljs-comment">"vid_03f0&amp;pid_012a&amp;IP_SCAN"</span></span> <span class="hljs-string"><span class="hljs-string">$i</span></span>tem = <span class="hljs-type"><span class="hljs-type">Get</span></span>-<span class="hljs-type"><span class="hljs-type">ChildItem</span></span> <span class="hljs-type"><span class="hljs-type">HKLM</span></span>:\<span class="hljs-type"><span class="hljs-type">SYSTEM</span></span>\<span class="hljs-type"><span class="hljs-type">CurrentControlSet</span></span>\<span class="hljs-type"><span class="hljs-type">Control</span></span>\<span class="hljs-type"><span class="hljs-type">Class</span></span>\<span class="hljs-comment"><span class="hljs-comment">"{6BDD1FC6-810F-11D0-BEC7-08002BE2092F}"</span></span> | <span class="hljs-type"><span class="hljs-type">Select</span></span>-<span class="hljs-type"><span class="hljs-type">Object</span></span> -<span class="hljs-type"><span class="hljs-type">Last</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-string"><span class="hljs-string">$i</span></span>tem = <span class="hljs-string"><span class="hljs-string">$i</span></span>tem.<span class="hljs-type"><span class="hljs-type">Substring</span></span>(<span class="hljs-string"><span class="hljs-string">$i</span></span>tem.<span class="hljs-type"><span class="hljs-type">Length</span></span><span class="hljs-number"><span class="hljs-number">-4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-string"><span class="hljs-string">$p</span></span>attern = <span class="hljs-comment"><span class="hljs-comment">".\temporary\1536.reg"</span></span> <span class="hljs-string"><span class="hljs-string">$r</span></span>esult = <span class="hljs-comment"><span class="hljs-comment">".\temporary\res.reg"</span></span> <span class="hljs-type"><span class="hljs-type">Get</span></span>-<span class="hljs-type"><span class="hljs-type">Content</span></span> <span class="hljs-string"><span class="hljs-string">$p</span></span>attern | <span class="hljs-type"><span class="hljs-type">ForEach</span></span>-<span class="hljs-type"><span class="hljs-type">Object</span></span> { <span class="hljs-string"><span class="hljs-string">$_</span></span> -replace <span class="hljs-comment"><span class="hljs-comment">"_IP_ADDRESS_"</span></span>, <span class="hljs-string"><span class="hljs-string">$I</span></span>P_ADDRESS ` -replace <span class="hljs-comment"><span class="hljs-comment">"_MAC_ADDRESS_"</span></span>, <span class="hljs-string"><span class="hljs-string">$M</span></span>AC_ADDRESS ` -replace <span class="hljs-comment"><span class="hljs-comment">"_NETWORK_NAME_"</span></span>, <span class="hljs-string"><span class="hljs-string">$N</span></span>ETWORK_NAME ` -replace <span class="hljs-comment"><span class="hljs-comment">"_ITEM_"</span></span>, <span class="hljs-string"><span class="hljs-string">$i</span></span>tem } | <span class="hljs-type"><span class="hljs-type">Set</span></span>-<span class="hljs-type"><span class="hljs-type">Content</span></span> <span class="hljs-string"><span class="hljs-string">$r</span></span>esult &amp; regedit /s .\temporary\res.reg</code> </pre><br><br>  We rub hands, we check - it works, we modify under 1522 - it works, we rule victoriously under 3055 - a bummer ... <br>  The scanner does not allow you to select a tablet, only the feeder is available in the scan menu, and even he refuses to scan. <br><br><img src="https://habrastorage.org/files/6bb/2c3/1a0/6bb2c31a0bb54ae89d99081a65ab0c93.png"><br><br><h2>  Serious conversation with 3055 or, Dude, you picked up the wrong stone </h2><br><br><img src="https://habrastorage.org/files/888/670/980/88867098055644368fb06d54bf72f931.png"><br><br>  Here it is, the LaserJet 3055/3052 - the most harmful guy, surprisingly I see him more often than anyone.  Actually - I will tell you in secret - I started working on them first - I went through the wilds of the procmon output filtering when installing the driver to search for something interesting and drowned somewhere in the middle.  When the procmon fell again due to lack of memory, I decided to postpone this venture to a more friendly and calm state. <br><br>  The second foray into the installer analysis of the multifunction printer gave the result: after an hour and a half of the log analysis, a pearl was found in the depths of the installer output - hppniscan01.exe <br>  Running with the necessary parameters instantly installed the scanner in the device and registered the necessary registry branches: <br> <code>hppniscan01.exe -f "hppasc16.inf" -m "vid_03f0&amp;pid_012a&amp;IP_SCAN" -a "192.168.0.30" -n 1 <br></code> <br><br><img src="https://habrastorage.org/files/722/20e/06f/72220e06f34e4ff5ac4b5a5d765f51aa.png"><br><br>  The distributions of drivers for other HP printers have its sixty-four-bit version, while the 3055 driver only supports x86 operating systems. <br><br>  I decided to pull out the scanner drivers from the common folder of the drivers and fold them separately, the necessary files are easily read from the driver inf-file.  The tree is the following: <br><br><blockquote>  C: \ Drivers \ Scanners \ ip \ 3055scan \ hpgtpusd.dll <br>  C: \ Drivers \ Scanners \ ip \ 3055scan \ hppasc01.cat <br>  C: \ Drivers \ Scanners \ ip \ 3055scan \ hppasc01.dll <br>  C: \ Drivers \ Scanners \ ip \ 3055scan \ hppasc01.inf <br>  C: \ Drivers \ Scanners \ ip \ 3055scan \ hppniscan01.exe <br>  C: \ Drivers \ Scanners \ ip \ 3055scan \ hpptpml3.dll <br>  C: \ Drivers \ Scanners \ ip \ 3055scan \ hpxp3390.dll <br>  C: \ Drivers \ Scanners \ ip \ 3055scan \ Drivers \ dot4 <br>  C: \ Drivers \ Scanners \ ip \ 3055scan \ Drivers \ dot4 \ Win2000 \ hpzidr12.dll <br>  C: \ Drivers \ Scanners \ ip \ 3055scan \ Drivers \ dot4 \ Win2000 \ hpzipm12.dll <br>  C: \ Drivers \ Scanners \ ip \ 3055scan \ Drivers \ dot4 \ Win2000 \ hpzipr12.dll <br>  C: \ Drivers \ Scanners \ ip \ 3055scan \ Drivers \ dot4 \ Win2000 \ hpzipr12.sys </blockquote><br><br>  The scanner installation function has now become quite simple, albeit with a dependency on the external component. <br>  The final form of the script, with some hard-won simplifications, will take the following form: <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> Add-PrinterPort (<span class="hljs-variable"><span class="hljs-variable">$printerSource</span></span>) { &amp;cscript C:\Windows\System32\Printing_Admin_Scripts\ru-RU\prnport.vbs ` -a -r <span class="hljs-variable"><span class="hljs-variable">$printerSource</span></span> -h <span class="hljs-variable"><span class="hljs-variable">$printerSource</span></span> -o RAW -n 9100 | Out-Null } <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> Add-PrinterDriver (<span class="hljs-variable"><span class="hljs-variable">$printerName</span></span>, <span class="hljs-variable"><span class="hljs-variable">$driverPath</span></span>) { <span class="hljs-variable"><span class="hljs-variable">$folder</span></span> = Split-Path <span class="hljs-variable"><span class="hljs-variable">$driverPath</span></span> &amp;cscript C:\Windows\System32\Printing_Admin_Scripts\ru-RU\prndrvr.vbs ` -a -m <span class="hljs-variable"><span class="hljs-variable">$printerName</span></span> -e Get-Platform -h <span class="hljs-variable"><span class="hljs-variable">$folder</span></span> -i <span class="hljs-variable"><span class="hljs-variable">$driverPath</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> Get-Platform { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([System.Environment]::Is64BitOperatingSystem) { <span class="hljs-string"><span class="hljs-string">"Windows x64"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-string"><span class="hljs-string">"Windows NT x86"</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> Add-Scanner (<span class="hljs-variable"><span class="hljs-variable">$ipaddress</span></span>, <span class="hljs-variable"><span class="hljs-variable">$printername</span></span>) { switch -regex (<span class="hljs-variable"><span class="hljs-variable">$printername</span></span>) { <span class="hljs-comment"><span class="hljs-comment">#      "1530" { Push-Location 'C:\Drivers\Scanners\ip\1536scan\' if ($(Get-Platform) -eq "Windows x64") { .\hppniscan64.exe -f "hppasc16.inf" -m "vid_03f0&amp;pid_012a&amp;IP_SCAN" -a $ipaddress -n 1 } else { .\hppniscan01.exe -f "hppasc16.inf" -m "vid_03f0&amp;pid_012a&amp;IP_SCAN" -a $ipaddress -n 1 } Pop-Location } "(305\d)|(3390)" { Push-Location 'C:\Drivers\Scanners\ip\3055scan\' switch -regex ($printername) { "3050" { .\hppniscan01.exe -f "hppasc01.inf" -m "vid_03f0&amp;pid_3217&amp;IP_SCAN" -a $ipaddress -n 1 } "3052" { .\hppniscan01.exe -f "hppasc01.inf" -m "vid_03f0&amp;pid_3317&amp;IP_SCAN" -a $ipaddress -n 1 } "3055" { .\hppniscan01.exe -f "hppasc01.inf" -m "vid_03f0&amp;pid_3417&amp;IP_SCAN" -a $ipaddress -n 1 } "3390" { .\hppniscan01.exe -f "hppasc01.inf" -m "vid_03f0&amp;pid_3517&amp;IP_SCAN" -a $ipaddress -n 1 } } Pop-Location } } } Add-Type -As Microsoft.VisualBasic $printerSource = [Microsoft.VisualBasic.Interaction]::InputBox(" IP  .") if ($printersource -match "^192\.168\.0\.[0-9]{1,3}$") { $printername = "HP LaserJet M1530 MFP Series PCL 6" $driverpath = "C:\drivers\1536\hpc1530c.inf" Add-PrinterPort $printersource Add-PrinterDriver $printername $driverPath #  &amp;         &amp;rundll32 printui.dll,PrintUIEntry /if /b $printername /r $printersource /m $printername /u /K /q /Gw Start-Sleep -Seconds 10 Add-Scanner $printersource $printername }</span></span></code> </pre><br><br>  The same method is great for all HP MFPs around me, for whom I created separate driver folders and options for the switch of the scanner installation function. <br><br>  The list of driver files can be viewed in the inf-file sections with the names [SourceDisksFiles], [RegisterDlls], [WIA_CopyFiles] and further on.  Screenshot on drivers 3055 and 1536, for clarity: <br><br><img src="https://habrastorage.org/files/f49/515/a69/f49515a697be4a21a996a7f34aa0d8d0.png"><br><br>  From the code snippets described in this note, you can build a full-featured automatic installation of the MFP, and if you add a little gooey and snmp to it, then you can completely close the topic of installing the MFP on new machines. <br><br>  That's all for today, thank you for your attention.  If the comments prompt what the MFP 3055 lacks to work with the installation using the first method via devcon, I will be very grateful.  Maybe someone has done the same work as I, but has achieved great success. <br><br>  In the next part, <s>if someone throws an invite into the sandbox</s> , I‚Äôll show you how to expand our scenario for working with the Xerox and Kyocera multifunctional devices. </div><p>Source: <a href="https://habr.com/ru/post/242513/">https://habr.com/ru/post/242513/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../242493/index.html">How to protect your Windows server from POODLE SSLv3 vulnerability</a></li>
<li><a href="../242497/index.html">Step-by-step overview: a single MultiCAD.NET application in nanoCAD, AutoCAD, ZWCAD</a></li>
<li><a href="../242501/index.html">Snoop Dogg - Venture Investor</a></li>
<li><a href="../242503/index.html">How incremental updates affect download speed. Experience Yandex. Mail</a></li>
<li><a href="../242505/index.html">Girls and technical sciences</a></li>
<li><a href="../242517/index.html">Tales from the Crypt platform developers for ERP. Introduction</a></li>
<li><a href="../242519/index.html">Epson Projection Calculators - what's what</a></li>
<li><a href="../242521/index.html">Arduino in the service of health</a></li>
<li><a href="../242529/index.html">9 signs of a strong leader in IT</a></li>
<li><a href="../242531/index.html">Scheme> board> FPGA</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>