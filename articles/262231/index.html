<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We test Jet9 - fault-tolerant hosting sites with geographic optimization</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We have created a platform for running Jet9 web applications and are now conducting a public beta test of a web host built on this platform. Here we w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We test Jet9 - fault-tolerant hosting sites with geographic optimization</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://jet9.ru/"><img src="https://habrastorage.org/files/d63/7f2/fa6/d637f2fa69d8483086caa613d802ac20.jpg" align="left"></a>  We have created a platform for running <a href="http://jet9.ru/">Jet9</a> web applications and are now conducting a public beta test of a web host built on this platform.  Here we will talk about what it is, what tasks it solves, and how everything is organized. <br><br>  In subsequent articles, we will tell you more about the Jet9 device, about the used technical solutions for various components, about the pitfalls that we encountered, and how to eliminate or circumvent them. <br><br>  The purpose of these publications is to involve specialists in testing and get bug reports, inform potential clients about the project and share experience with colleagues.  As materials appear here, we will add materials on our site. <br><a name="habracut"></a><br><h4>  What is Jet9 </h4><br>  We called the service "Failover Hosting with Geo-Optimized Sites".  Despite the verbosity, this reflects a smaller part of the possibilities, but the most noticeable. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The main functions of Jet9: increased fault tolerance, integrated CDN / ADN, guaranteed allocation of resources in a wide range.  All this in one ready-made solution, without the need for the customer to independently organize the interaction of a large stack of components and change the architecture of the site.  As a result, this ensures a stable fast operation of the site with a minimum of downtime or degradation of work.  The solution is focused on web projects that already have such requirements, but it is too difficult or too expensive to implement and maintain them yourself. <br><br>  The private installation of the platform (Private Jet9) is designed for small and medium-sized projects that require from several servers to several hundred to work.  Web hosting (PaaS Jet9) provides minimum rates for small sites with low attendance, as well as large tariffs, which make up almost all the resources of a powerful server, for resource-intensive sites with high load - up to several hundred requests per second and hundreds of thousands of users per day. <br><br>  As hardware for Jet9 web hosting, standard <a href="http://www.truevirtual.ru/price%3Fpricelist%3D1">TrueVirtual V8</a> and <a href="http://www.truevirtual.ru/price%3Fpricelist%3D1">TrueVirtual T4</a> servers with network storage and local SSD cache are used. <br><br>  When developing, several know-how and patent pending inventions were used, but the main work consists in a large amount of research, painstaking engineering work on connecting many components and their refinement, programming the missing nodes, as well as in long testing behavior in various combinations of conditions, documenting everything on all stages and drawing up regulations for routine and emergency procedures. <br><br><h4>  How does Jet9 work </h4><br><h5>  Web environment </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/8a7/e80/edc/8a7e80edc7e380d4957852623845b405.png" align="right" alt="image"><h6>  Control Panels and Web Stacks </h6><br>  As a user interface, you can use control panels designed for shared web hosting.  The ISPManager 5 control panel is currently used. SSH, SFTP, FTPS are available for automated deployment. <br><br>  The web environment currently corresponds to the generally accepted LAMP set: Linux, Apache, Mysql, PHP.  In addition to the usual CGI, you can run FastCGI applications (perl, python).  That is all that is available on a regular web hosting.  Private Jet9 has the ability to use Unicorn, Thin and Puma application servers for Ruby on Rails, Tomcat and Jetty for Java / JavaEE, WSGI applications in Python, PostgreSQL, MongoDB, CouchDB.  But in web hosting at the current testing stage, these stacks are not available, only LAMP. <br><br><h6>  Resource Accounting and Load Isolation </h6><br>  Once upon a time we did accounting for and isolation of hosting clients on FreeBSD 4.1.  I had to add a lot of patches in the kernel, in apache, and in some system utilities.  About this one could write a lot.  And now it turns out short: cgroup for different classes of memory, for the processor, for disk operations;  rlimit on processes and open files.  Each user has its own apache instance, which simplifies the organization of user privileges for the operation of a web server and scripts, and simplifies the control of resource consumption. <br><br>  Kernel updates are required only for more flexible access control and additional user isolation, and are used only for Jet9 web hosting. <br><br>  Some errors from the ideal load sharing through cgroups are compensated by the mandatory transfer of at least 10% of all resources to the general reserve, due to which each user is provided with 10% overload above the tariff limits. <br><br><h6>  Backups </h6><br>  Backups are stored in an independent long-term archival storage system, located in the third geographically remote data center.  Incremental copying is done every day.  Used copies of the file system via rsync.  Block device snapshots are not used due to the fact that if file system meta-data is damaged, both the replica in the cluster and the backup copy will be damaged. <br><br>  The rotation of archives is done according to a multicycle scheme, which ensures the thinning of old copies in such a way that fewer old copies are preserved, and newer copies are preserved.  That is, when storing seven archives, it will contain copies of approximately the following ages: 1 year, 6 months, 3 months, 1 month, 6 days, 2 days, 1 day. <br><br><h5>  Failover Cluster </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/414/b4b/d29/414b4bd29a8e5bd17c3eb09173a56b9e.png" align="left" alt="image">  Each web backend runs on top of a HA cluster with replicable storage.  In two independent data centers there are two sides of the cluster - the master and backup.  At one time only one of the parties can work - either a master or a backup.  A split brain ban has been adopted as a policy for the work of the parties to the cluster for web hosting - a situation where both the master and backup work simultaneously.  This policy is a consequence of the accepted requirement to ensure consistent consistency.  For private installations, other policies that allow the split brain can be used to ensure maximum service availability even at the cost of data inconsistency. <br><br>  On each side of the cluster there is its own storage, with which all the work is being done, and the changes of which are replicated in real time to another data center, and in another availability zone from master to backup.  For us, this is a more convenient option than the alternative - shared storage, distributed in both data centers.  Cluster organization on replicated storage is, in general, much more complicated than on shared storage, but it provides a significant advantage - lower requirements for latency of communication between data centers, significantly lower bandwidth requirements, and as a result, the possibility of building more productive systems.  Now we have three data centers, two of which have a direct connection, and both are connected to the third via the Internet.  HA clusters are used both on pairs of master backups connected via a direct connection and on pairs connected via the Internet. <br><br>  When we started using pacemaker for internal services, heartbeat was used for it and we independently introduced additional arbitration mechanisms to protect against splitbrain.  In Jet9, we switched to pacemaker and corosync with a quorum.  Pacemaker is a good, powerful product, but it has a lot of inconveniences and features that complicate its use with a large number of clusters and on unreliable or complex networks.  Therefore, we had developed our own cluster controller, better prepared for solving our problems.  Now it is still too little run-in and for production we continue to use pacemaker. <br><br>  The master and backup use different IP addresses from different routing networks so that routing failure does not lead to unavailability of both master and backup.  This is a more reliable alternative than a migrating IP address, since in the latter case a sequential structure of two points of failure is obtained - external routing (BGP) and internal (OSPF). <br><br>  In Jet9 web hosting, local storage uses fast SSD + bcache with writeback for caching. <br><br><h5>  Geographic optimization </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/4c5/00d/c55/4c500dc55782ddf820208f3dc9fec6e8.png" align="right" alt="image">  All sites are served through a network of web accelerators - a geographically distributed network of caching web servers that deliver content from websites at maximum speed and cache it for re-distribution.  Requests to the site are served through the web accelerator, which is closest to the visitor, and thus all pages open much faster. <br><br>  Unlike the CDN for static files, which require the completion of site scripts in order to upload files to themselves, CDN Jet9 works transparently and without alterations with web sites and itself receives and distributes all the content.  Connecting CDN and web accelerators to the HA cluster is done automatically when the site is created and does not require any DNS settings or site settings. <br><br>  An additional advantage over foreign services is normal coverage in Russia.  That is the closest mirror to Tyumen is not in Holland, but in Yekaterinburg.  For the test installation Jet9 uses a small network - the UK, Moscow, St. Petersburg and Novosibirsk.  In production, Rostov-on-Don, Samara, Yekaterinburg, Holland are added to them.  For the time being, the issue with the Far East is poorly questionable - a large imbalance in the cost of communication and population is not economically justified, but we will continue. <br><br>  For geographic balancing, a hybrid scheme is used - DNS anycast plus calculation of speed and distances on DNS servers.  Squid is used as a reverse proxy and, in addition, for SSL, Nginx. <br><br><h4>  Testing </h4><br>  The main goal of this test for us is to find problems in the work of the API for managing domains on frontends and backends, in integrating ISPManager with our web environment on backends, and in integrating ISPManager with web accelerators and geo-balancing on frontends.  Planned testing period: 1 - 2 months. <br><br>  In the work of HA clusters and web accelerators separately, we do not expect any shortcomings, since we have been using them in production for a long time.  But we only did support web site control panels, domain management APIs on frontends and backends, and a bunch of frontend backends this spring.  Therefore, with considerable probability there may be problems that we have not identified on our own. <br><br>  In the process of testing, we will regularly, with prior notice, arrange failures at various sites in order to check the correctness of the automatic response to these failures, and how this may affect the functioning of the sites. <br><br>  Testing participants will receive an additional 10% discount for 2 years on all Jet9 products - both on web hosting and on licenses for private installations. <br><br>  To join testing, it is enough to register an order for <a href="http://jet9.ru/">jet9.ru</a> with the required amount of resources and your own details.  Separately, writing about testing is not necessary, now all applications are automatically processed as test ones. <br><br>  In addition to direct testing, it is very interesting to get tricky technical questions.  As if there is a question to which we do not know the answer, then a bug may be hidden under this question.  And then, in the following articles, where we will talk more about each component, we will also add the questions asked here with the answers. </div><p>Source: <a href="https://habr.com/ru/post/262231/">https://habr.com/ru/post/262231/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../262211/index.html">Deploying Qt Applications on Windows</a></li>
<li><a href="../262213/index.html">Analysis of tonality in social media in Russian using the RussianSentimentAnalyzer API</a></li>
<li><a href="../262221/index.html">Customize the build of a Flex 4.14 project using flexmojos 7. *</a></li>
<li><a href="../262225/index.html">Using Lisp in Production</a></li>
<li><a href="../262229/index.html">Geolocation plus mobile communications and the updated AltegroCloud API</a></li>
<li><a href="../262233/index.html">VirtualBox 5.0 release</a></li>
<li><a href="../262235/index.html">We write our simplified OpenGL on Rust - part 3 (rasterizer)</a></li>
<li><a href="../262239/index.html">Critical way of rendering web pages</a></li>
<li><a href="../262241/index.html">Raspberry Pi as Steam Idle Machine</a></li>
<li><a href="../262243/index.html">Data Access Object (DAO). Class level</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>