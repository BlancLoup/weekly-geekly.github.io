<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Easy insertion of multiline pattern literals into JavaScript code</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Description of the problem 
 The template literals that appeared in ES6 (or template strings - template literals, template strings) in addition to the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Easy insertion of multiline pattern literals into JavaScript code</h1><div class="post__text post__text-html js-mediator-article"><h3>  Description of the problem </h3><br>  The <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals">template literals that</a> appeared in ES6 (or template strings - template literals, template strings) in addition to the long-awaited interpolation of variables and expressions brought the ability to insert multi-line text without additional tweaks complicating the code. <br><br>  However, what looks beautiful in a variety of examples on this topic, in real code, sometimes wraps itself in a new kind of disgrace. <br><br>  However, the problems are visible, even if you look at examples.  Take a <a href="https://ponyfoo.com/articles/es6-template-strings-in-depth">wonderful article</a> about this innovation from the famous series ‚Äú <a href="https://ponyfoo.com/articles/tagged/es6-in-depth">ES6 In Depth</a> ‚Äù. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      See the annoying "pockmarks"?  Light imbalances in symmetry and harmony? <br><br><div class="spoiler">  <b class="spoiler_title">Small example</b> <div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> text = ( <span class="hljs-string"><span class="hljs-string">`foo bar baz`</span></span>)</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Great example</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> html = <span class="hljs-string"><span class="hljs-string">`&lt;article&gt; &lt;header&gt; &lt;h1&gt;</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${title}</span></span></span><span class="hljs-string">&lt;/h1&gt; &lt;/header&gt; &lt;section&gt; &lt;div&gt;</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${teaser}</span></span></span><span class="hljs-string">&lt;/div&gt; &lt;div&gt;</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${body}</span></span></span><span class="hljs-string">&lt;/div&gt; &lt;/section&gt; &lt;footer&gt; &lt;ul&gt; </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${tags.map(tag =&gt; </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">`&lt;li&gt;</span></span></span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${tag}</span></span></span></span></span><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">&lt;/li&gt;`</span></span></span></span><span class="hljs-string"><span class="hljs-subst">).join(</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'\n '</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string"> &lt;/ul&gt; &lt;/footer&gt; &lt;/article&gt;`</span></span></code> </pre></div></div><br>  Take some simple case and take a closer look at the problems. <a name="habracut"></a><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> a = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> b = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log( <span class="hljs-string"><span class="hljs-string">`a = </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${a}</span></span></span><span class="hljs-string">. b = </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${b}</span></span></span><span class="hljs-string">.`</span></span> );</code> </pre><br>  1. The first quote distorts the harmony of the text, spoils the alignment of the lines. <br>  2. Because of the mixture of literal elements and code, it automatically seems as if the quotes will fall into the output.  We have to abstract away from them in order to imagine what the final result will look like. <br>  3. The lines of the literal are flush with the function call, the usual structure of indents is broken. <br><br>  You can do this: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> a = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> b = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">` a = </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${a}</span></span></span><span class="hljs-string">. b = </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${b}</span></span></span><span class="hljs-string">. `</span></span>);</code> </pre><br>  This solves the problems mentioned: the alignment of lines is preserved, the elements of the code and the literal are spaced apart, the usual structure of indents improves readability, separates function and arguments more clearly. <br><br>  But now we have extra line breaks and spaces.  Sometimes you can put up with it, but do not pull on a universal solution. <br><br>  Let's aggravate our example by introducing additional blocks and indents. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> verbose = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (verbose) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log( <span class="hljs-string"><span class="hljs-string">`const a is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${a}</span></span></span><span class="hljs-string">. const b is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${b}</span></span></span><span class="hljs-string">.`</span></span> ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log( <span class="hljs-string"><span class="hljs-string">`a = </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${a}</span></span></span><span class="hljs-string">. b = </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${b}</span></span></span><span class="hljs-string">.`</span></span> ); }</code> </pre><br>  Awful.  Now the literal generally sticks out to the left, destroying the block structure. <br><br>  You can fix it as described above: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (verbose) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">` const a is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${a}</span></span></span><span class="hljs-string">. const b is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${b}</span></span></span><span class="hljs-string">. `</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">` a = </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${a}</span></span></span><span class="hljs-string">. b = </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${b}</span></span></span><span class="hljs-string">. `</span></span>); }</code> </pre><br>  It has become even more "service" gaps.  And if you have to insert a literal at an even deeper level of nesting?  All this will quickly get out of control. <br><br>  Assigning variables or <code>console.log</code> calls can be replaced with functions for writing to files, the dilemma will remain the same - either an unreadable mess, or extra spaces and new lines: <br><br><pre> <code class="javascript hljs">fs.writeFileSync(<span class="hljs-string"><span class="hljs-string">'log.txt'</span></span>, <span class="hljs-string"><span class="hljs-string">`a = </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${a}</span></span></span><span class="hljs-string">. b = </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${b}</span></span></span><span class="hljs-string">.`</span></span>, <span class="hljs-string"><span class="hljs-string">'ascii'</span></span>);</code> </pre><br>  or <br><br><pre> <code class="javascript hljs">fs.writeFileSync(<span class="hljs-string"><span class="hljs-string">'log.txt'</span></span>, <span class="hljs-string"><span class="hljs-string">` a = </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${a}</span></span></span><span class="hljs-string">. b = </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${b}</span></span></span><span class="hljs-string">. `</span></span>, <span class="hljs-string"><span class="hljs-string">'ascii'</span></span>);</code> </pre><br>  I found a way out for myself that I decided to share.  Not so much because I took the risk of counting it as generally useful, but rather in order to start a discussion: it is likely that other ways have already been found, and everyone will be able to distribute them. <br><br><h3>  Possible Solution </h3><br>  It lies in the area of ‚Äã‚Äãthe same innovation, namely in the functional called "tagged templates".  In the already mentioned article there is a section dedicated to this mechanism and ‚Äúchewing‚Äù the algorithm of its work to a considerable clarity: ‚Äú <a href="https://ponyfoo.com/articles/es6-template-strings-in-depth">Demystifying Tagged Templates</a> ‚Äù. <br><br>  The ‚Äúskeletons‚Äù of the functions that process template literals cited by the author prompted me to use something similar to remove all service spaces and line breaks from multiline literals.  It turned out this function: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//remove auxiliary code spaces in template strings function xs(strings, ...expressions) { const indent = new RegExp(`\n {${strings[0].match(/\n+( *)/)[1].length}}`, 'g'); return expressions.reduce( (acc, expr, i) =&gt; `${acc}${expr}${strings[i + 1].replace(indent, '\n')}`, strings[0].replace(indent, '\n') ).replace(/^\n|\n$/g, ''); }</span></span></code> </pre><br><br>  As you can see, the function removes one initial and final newline from the final result, and also removes all leading spaces in the lines (without affecting the interpolated variables and expressions).  At the same time, she tries to preserve the internal indentation of deeper investments: the first line defines the service indent in the code and removes only an equal number of spaces - this way it becomes possible to save structures like the large example given above with the HTML code. <br><br>  Now you can safely use our more readable options, with a small, barely noticeable addition, which does not spoil the type of code (however, the function can be called somehow - longer, shorter, using different versions of visibility, intuitive clarity, etc.): <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> a = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> b = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(xs<span class="hljs-string"><span class="hljs-string">` a = </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${a}</span></span></span><span class="hljs-string">. b = </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${b}</span></span></span><span class="hljs-string">. `</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> verbose = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (verbose) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(xs<span class="hljs-string"><span class="hljs-string">` const a is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${a}</span></span></span><span class="hljs-string">. const b is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${b}</span></span></span><span class="hljs-string">. `</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(xs<span class="hljs-string"><span class="hljs-string">` a = </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${a}</span></span></span><span class="hljs-string">. b = </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${b}</span></span></span><span class="hljs-string">. `</span></span>); }</code> </pre><br><br>  Now the code has become clearer, and nothing extra falls into the output. <br><br>  I hope this is only the first test case, and other ideas will emerge that differ more or less radically.  It is possible that unobvious obstacles to the use of such solutions will also be found, unnoticed errors will be corrected, and unaccounted use cases that violate the function will be indicated. <br><br>  <b>PS</b> <a href="http://www.2ality.com/2016/05/template-literal-whitespace.html">About a simple library that solves similar problems.</a> <br><br>  <b>PPS</b> Updated function to save indents. </div><p>Source: <a href="https://habr.com/ru/post/280928/">https://habr.com/ru/post/280928/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../280908/index.html">Guiding Eyes transfers data to the IBM Cloud to improve the quality of care for blind people.</a></li>
<li><a href="../280910/index.html">Vulnerabilities in MyChat by NetworkSoftwareSolutions (fixed and none)</a></li>
<li><a href="../280912/index.html">PostgreSQL useful tricks</a></li>
<li><a href="../280914/index.html">Sandbox for programmers</a></li>
<li><a href="../280922/index.html">Konami code or read between the lines</a></li>
<li><a href="../280930/index.html">Palantir: how to detect a botnet</a></li>
<li><a href="../280932/index.html">QtWebApp is a step-by-step chewed example with detailed comments.</a></li>
<li><a href="../280938/index.html">Features and differences of the MSH programming language from MUMPS</a></li>
<li><a href="../280940/index.html">Disabled Cache Zone Module</a></li>
<li><a href="../280942/index.html">Announcement of the fourth meeting of the Java User Group Sevastopol</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>