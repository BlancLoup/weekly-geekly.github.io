<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using Zend_Form_Element_File in CRUD</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When designing applications on the Zend Framework, the use of the Zend_Form component makes it much easier to work with entities - a once-created form...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using Zend_Form_Element_File in CRUD</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/50b/836/ef1/50b836ef1d612af73df3a7affd27cc49.png" alt="image"><br><br>  When designing applications on the Zend Framework, the use of the Zend_Form component makes it much easier to work with entities - a once-created form with configured validators, filters, etc. is used both when creating and editing data in the database. <br>  Entities very often contain elements of the File type - whether it is a picture preview, a file name for downloading or a photo in the gallery.  That's only if you want to change the entity in the form of which there is a File element, it becomes clear that the <u>standard decorator Zend_Form_Element_File is not suitable for the form of changing the entity - because</u>  <u>it does not allow to display the presence of the downloaded file, does not allow to delete this file, etc.</u> <br><br>  In other words, when you open an entity for change, all other elements of the form are populated with values ‚Äã‚Äãfrom the database - while Zend_Form_Element_File does not have this to do. <br>  In this article I want to share my implementation of working with Zend_Form_Element_File as part of creating a CRUD (create-read-update-delete) on ZendFramework 1.11 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Under Habrakat you will find a detailed description of how to create a decorator, how to attach it to the form and instructions for working with the controller. <br><br><a name="habracut"></a><br><br><h5>  Zend_Form_Element_File - general information, features </h5><br><br>  When adding a new entity to the database, Zend_Form_Element_File looks like this (standard): <br><img src="http://h1964807.stratoserver.net/files/share/25_12_2011/7DERQh42R0K9xEKXUBexRQ.png" alt="image"><br><br>  When changing an entity, Zend_Form_Element_File by default looks similar.  Our task is to bring the look of this element to this: <br><img src="http://h1964807.stratoserver.net/files/share/15_1_2012/fHO2p0SMWUKL08na9hSJOw.png" alt="image"><br>  Accordingly, the current uploaded file name is displayed, the element itself to indicate the new file (the old one will be replaced by it) and the checkbox to delete the already uploaded file and reset the photo column for the entity being edited. <br><br><h5>  Create your own decorator for Zend_Form_Element_File </h5><br>  To do this, in the application / forms / Decorators folder create a File.php file with the following class <br><br><blockquote><ol><li>  <font color="#000000">&lt;? php</font> </li><li>  <font color="#000000">class</font> Application_Form_Decorators_File <font color="#000000">extends</font> Zend_Form_Decorator_Abstract </li><li>  <font color="#009900">{</font> </li><li>  <font color="#000000">public</font> <font color="#000000">function</font> buildLabel <font color="#009900">(</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#000088">$ element</font> <font color="#339933">=</font> <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">getElement</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#000088">$ label</font> <font color="#339933">=</font> <font color="#000088">$ element</font> <font color="#339933">-&gt;</font> <font color="#004000">getLabel</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$ translator</font> <font color="#339933">=</font> <font color="#000088">$ element</font> <font color="#339933">-&gt;</font> <font color="#004000">getTranslator</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#000088">$ label</font> <font color="#339933">=</font> <font color="#000088">$ translator</font> <font color="#339933">-&gt;</font> <font color="#004000">translate</font> <font color="#009900">(</font> <font color="#000088">$ label</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$ element</font> <font color="#339933">-&gt;</font> <font color="#004000">isRequired</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#000088">$ label</font> <font color="#339933">. =</font> <font color="#0000ff">'*'</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#000088">$ label</font> <font color="#339933">. =</font> <font color="#0000ff">':'</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">return</font> <font color="#000088">$ element</font> <font color="#339933">-&gt;</font> <font color="#004000">getView</font> <font color="#009900">(</font> <font color="#009900">)</font> </li><li>  <font color="#339933">-&gt;</font> <font color="#004000">formLabel</font> <font color="#009900">(</font> <font color="#000088">$ element</font> <font color="#339933">-&gt;</font> <font color="#004000">getName</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#000088">$ label</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#000000">public</font> <font color="#000000">function</font> buildInput <font color="#009900">(</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#000088">$ element</font> <font color="#339933">=</font> <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">getElement</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#000088">$ helper</font> <font color="#339933">=</font> <font color="#000088">$ element</font> <font color="#339933">-&gt;</font> <font color="#004000">helper</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">return</font> <font color="#000088">$ element</font> <font color="#339933">-&gt;</font> <font color="#004000">getView</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">-&gt;</font> <font color="#000088">$ helper</font> <font color="#009900">(</font> </li><li>  <font color="#000088">$ element</font> <font color="#339933">-&gt;</font> <font color="#004000">getName</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> </li><li>  <font color="#000088">$ element</font> <font color="#339933">-&gt;</font> <font color="#004000">getValue</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> </li><li>  <font color="#000088">$ element</font> <font color="#339933">-&gt;</font> <font color="#004000">getAttribs</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> </li><li>  <font color="#000088">$ element</font> <font color="#339933">-&gt;</font> <font color="#004000">options</font> </li><li>  <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#000000">public</font> <font color="#000000">function</font> buildErrors <font color="#009900">(</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#000088">$ element</font> <font color="#339933">=</font> <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">getElement</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#000088">$ messages</font> <font color="#339933">=</font> <font color="#000088">$ element</font> <font color="#339933">-&gt;</font> <font color="#004000">getMessages</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#990000">empty</font> <font color="#009900">(</font> <font color="#000088">$ messages</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#b1b100">return</font> <font color="#0000ff">''</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#b1b100">return</font> <font color="#0000ff">'&lt;div class = "errors"&gt;'</font> <font color="#339933">.</font> </li><li>  <font color="#000088">$ element</font> <font color="#339933">-&gt;</font> <font color="#004000">getView</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">-&gt;</font> <font color="#004000">formErrors</font> <font color="#009900">(</font> <font color="#000088">$ messages</font> <font color="#009900">)</font> <font color="#339933">.</font>  <font color="#0000ff">'&lt;/ div&gt;'</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#000000">public</font> <font color="#000000">function</font> buildDescription <font color="#009900">(</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#000088">$ element</font> <font color="#339933">=</font> <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">getElement</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#000088">$ desc</font> <font color="#339933">=</font> <font color="#000088">$ element</font> <font color="#339933">-&gt;</font> <font color="#004000">getDescription</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#990000">empty</font> <font color="#009900">(</font> <font color="#000088">$ desc</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#b1b100">return</font> <font color="#0000ff">''</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#b1b100">return</font> <font color="#0000ff">'&lt;div class = "description"&gt;'</font> <font color="#339933">.</font>  <font color="#000088">$ desc</font> <font color="#339933">.</font>  <font color="#0000ff">'&lt;/ div&gt;'</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#000000">public</font> <font color="#000000">function</font> render <font color="#009900">(</font> <font color="#000088">$ content</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#000088">$ element</font> <font color="#339933">=</font> <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">getElement</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$ element</font> instanceof Zend_Form_Element <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#b1b100">return</font> <font color="#000088">$ content</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#009900">null</font> <font color="#339933">===</font> <font color="#000088">$ element</font> <font color="#339933">-&gt;</font> <font color="#004000">getView</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#b1b100">return</font> <font color="#000088">$ content</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#000088">$ separator</font> <font color="#339933">=</font> <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">getSeparator</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#000088">$ placement</font> <font color="#339933">=</font> <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">getPlacement</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#000088">$ label</font> <font color="#339933">=</font> <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">buildLabel</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#000088">$ input</font> <font color="#339933">=</font> <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">buildInput</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#000088">$ errors</font> <font color="#339933">=</font> <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">buildErrors</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#000088">$ desc</font> <font color="#339933">=</font> <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">buildDescription</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#000088">$ renderedContent</font> <font color="#339933">=</font> <font color="#000088">$ element</font> <font color="#339933">-&gt;</font> <font color="#004000">getView</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">-&gt;</font> <font color="#004000">partial</font> <font color="#009900">(</font> </li><li>  <font color="#0000ff">'decorators / file.phtml'</font> <font color="#339933">,</font> </li><li>  <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'element'</font> <font color="#339933">=&gt;</font> <font color="#000088">$ element</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li></li><li>  <font color="#000088">$ output</font> <font color="#339933">=</font> <font color="#0000ff">'&lt;tr&gt; &lt;td&gt;'</font> </li><li>  <font color="#339933">.</font>  <font color="#000088">$ label</font> <font color="#339933">.</font>  <font color="#0000ff">'&lt;/ td&gt; &lt;td&gt;'</font> <font color="#339933">.</font>  <font color="#000088">$ renderedContent</font> </li><li>  <font color="#339933">.</font>  <font color="#000088">$ input</font> </li><li>  <font color="#339933">.</font>  <font color="#000088">$ errors</font> </li><li>  <font color="#339933">.</font>  <font color="#000088">$ desc</font> </li><li>  <font color="#339933">.</font>  <font color="#0000ff">'&lt;/ td&gt; &lt;/ tr&gt;'</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#b1b100">switch</font> <font color="#009900">(</font> <font color="#000088">$ placement</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#b1b100">case</font> <font color="#009900">(</font> <font color="#000000">self</font> <font color="#339933">::</font> <font color="#004000">PREPEND</font> <font color="#009900">)</font> <font color="#339933">:</font> </li><li>  <font color="#b1b100">return</font> <font color="#000088">$ output</font> <font color="#339933">.</font>  <font color="#000088">$ separator</font> <font color="#339933">.</font>  <font color="#000088">$ content</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">case</font> <font color="#009900">(</font> <font color="#000000">self</font> <font color="#339933">::</font> <font color="#004000">APPEND</font> <font color="#009900">)</font> <font color="#339933">:</font> </li><li>  <font color="#b1b100">default</font> <font color="#339933">:</font> </li><li>  <font color="#b1b100">return</font> <font color="#000088">$ content</font> <font color="#339933">.</font>  <font color="#000088">$ separator</font> <font color="#339933">.</font>  <font color="#000088">$ output</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#009900">}</font> </li></ol></blockquote><br><br>  Thus, we can assemble the appearance of the element ‚Äúin parts‚Äù by adding the necessary information for the output.  Using the instructions <br><br><blockquote><ol><li>  <font color="#000088">$ renderedContent</font> <font color="#339933">=</font> <font color="#000088">$ element</font> <font color="#339933">-&gt;</font> <font color="#004000">getView</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">-&gt;</font> <font color="#004000">partial</font> <font color="#009900">(</font> </li><li>  <font color="#0000ff">'decorators / file.phtml'</font> <font color="#339933">,</font> </li><li>  <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'element'</font> <font color="#339933">=&gt;</font> <font color="#000088">$ element</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> </li></ol></blockquote><br><br>  Along the way, we pass information about the current element (Zend_Form_Element_File) as $ element (needed for <br>  Render the application / views / scripts / decorators / file.phtml file with the following contents: <br><br><blockquote><ol><li>  You uploaded a photo ' <font color="#000000">&lt;? Php</font> <font color="#b1b100">echo</font> <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">element</font> <font color="#339933">-&gt;</font> <font color="#004000">getDescription</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font>  <font color="#000000">?&gt;</font> '. &lt;br&gt; </li><li>  You can change the photo by specifying a new file.  If a photo change is not required, leave this field blank.  &lt;br&gt; </li><li>  To remove a photo, check the box: </li><li>  &lt;input name = " <font color="#000000">&lt;? php</font> <font color="#b1b100">echo</font> <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">element</font> <font color="#339933">-&gt;</font> <font color="#004000">getName</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000000">?&gt;</font> _checkbox" type = "checkbox" value = "on" /&gt; &lt;br /&gt; </li></ol></blockquote><br><br><h5>  The use of decorators in the form </h5><br><br>  Since a custom decorator is needed only when the entity is changed, when adding an entity, we leave the standard decorator: <br><blockquote><ol><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> _options <font color="#009900">[</font> <font color="#0000ff">'type'</font> <font color="#009900">]</font> <font color="#339933">==</font> <font color="#0000ff">'edit'</font> <font color="#339933">&amp;&amp;</font> <font color="#339933">!</font> <font color="#990000">is_null</font> <font color="#009900">(</font> <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> _options <font color="#009900">[</font> <font color="#0000ff">'photo_file'</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#000088">$ photo</font> <font color="#339933">-&gt;</font> <font color="#004000">setDescription</font> <font color="#009900">(</font> <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> _options <font color="#009900">[</font> <font color="#0000ff">'photo_file'</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#000088">$ photo</font> <font color="#339933">-&gt;</font> <font color="#004000">setDecorators</font> <font color="#009900">(</font> <font color="#990000">array</font> <font color="#009900">(</font> </li><li>  <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'ViewScript'</font> <font color="#339933">,</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'viewScript'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'decorators / file.phtml'</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">,</font> </li><li>  <font color="#0000ff">'File'</font> <font color="#339933">,</font> </li><li>  <font color="#0000ff">'Errors'</font> <font color="#339933">,</font> </li><li>  <font color="#990000">array</font> <font color="#009900">(</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'data'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'HtmlTag'</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'tag'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'td'</font> <font color="#339933">,</font> <font color="#0000ff">'class'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'element'</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">,</font> </li><li>  <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'Label'</font> <font color="#339933">,</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'tag'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'td'</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">,</font> </li><li>  <font color="#990000">array</font> <font color="#009900">(</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'row'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'HtmlTag'</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'tag'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'tr'</font> <font color="#009900">)</font> <font color="#009900">)</font> </li><li>  <font color="#009900">)</font> <font color="#009900">)</font> </li><li>  <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#009900">{</font> </li><li>  <font color="#000088">$ photo</font> <font color="#339933">-&gt;</font> <font color="#004000">setDecorators</font> <font color="#009900">(</font> <font color="#990000">array</font> <font color="#009900">(</font> </li><li>  <font color="#0000ff">'File'</font> <font color="#339933">,</font> </li><li>  <font color="#0000ff">'Errors'</font> <font color="#339933">,</font> </li><li>  <font color="#990000">array</font> <font color="#009900">(</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'data'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'HtmlTag'</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'tag'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'td'</font> <font color="#339933">,</font> <font color="#0000ff">'class'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'element'</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">,</font> </li><li>  <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'Label'</font> <font color="#339933">,</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'tag'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'td'</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">,</font> </li><li>  <font color="#990000">array</font> <font color="#009900">(</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'row'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'HtmlTag'</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'tag'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'tr'</font> <font color="#009900">)</font> <font color="#009900">)</font> </li><li>  <font color="#009900">)</font> <font color="#009900">)</font> </li><li>  <font color="#009900">}</font> </li></ol></blockquote><br><br><h5>  Using decorator in controller: </h5><br><br>  For each loaded picture, a preview is created using a filter ‚Äî accordingly, when deleting a picture, you also need to delete the preview. <br><br><blockquote><ol><li>  <font color="#666666">// if a check mark for deletion is set, then delete the file and food in the database null</font> </li><li></li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">is_null</font> <font color="#009900">(</font> <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">getRequest</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">-&gt;</font> <font color="#004000">getParam</font> <font color="#009900">(</font> <font color="#0000ff">'photo_checkbox'</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">&amp;&amp;</font> <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">getRequest</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">-&gt;</font> <font color="#004000">getParam</font> <font color="#009900">(</font> <font color="#0000ff">'photo_checkbox'</font> <font color="#009900">)</font> <font color="#339933">==</font> <font color="#0000ff">'on'</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#990000">file_exists</font> <font color="#009900">(</font> PUBLIC_PATH <font color="#339933">.</font> <font color="#0000ff">'/ userfiles / images / full /'</font> <font color="#339933">.</font> <font color="#000088">$ item</font> <font color="#339933">-&gt;</font> <font color="#004000">photo</font> <font color="#009900">)</font> <font color="#009900">)</font> </li><li>  <font color="#990000">unlink</font> <font color="#009900">(</font> PUBLIC_PATH <font color="#339933">.</font> <font color="#0000ff">'/ userfiles / images / full /'</font> <font color="#339933">.</font> <font color="#000088">$ item</font> <font color="#339933">-&gt;</font> <font color="#004000">photo</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#990000">file_exists</font> <font color="#009900">(</font> PUBLIC_PATH <font color="#339933">.</font> <font color="#0000ff">'/ userfiles / images / thumb /'</font> <font color="#339933">.</font> <font color="#000088">$ item</font> <font color="#339933">-&gt;</font> <font color="#004000">photo</font> <font color="#009900">)</font> <font color="#009900">)</font> </li><li>  <font color="#990000">unlink</font> <font color="#009900">(</font> PUBLIC_PATH <font color="#339933">.</font> <font color="#0000ff">'/ userfiles / images / thumb /'</font> <font color="#339933">.</font> <font color="#000088">$ item</font> <font color="#339933">-&gt;</font> <font color="#004000">photo</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#000088">$ item</font> <font color="#339933">-&gt;</font> <font color="#004000">photo</font> <font color="#339933">=</font> <font color="#009900">null</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#666666">// if a new file is specified and it is loaded, then delete the old file and write a new one to the database.</font> </li><li>  <font color="#666666">// if the File element is empty, $ form-&gt; photo-&gt; getFileName () == array (null);</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">is_null</font> <font color="#009900">(</font> <font color="#000088">$ form</font> <font color="#339933">-&gt;</font> <font color="#004000">photo</font> <font color="#339933">-&gt;</font> <font color="#004000">getFileName</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">&amp;&amp;</font> <font color="#990000">count</font> <font color="#009900">(</font> <font color="#000088">$ form</font> <font color="#339933">-&gt;</font> <font color="#004000">photo</font> <font color="#339933">-&gt;</font> <font color="#004000">getFileName</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">! =</font> <font color="#cc66cc">0</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li></li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#990000">file_exists</font> <font color="#009900">(</font> PUBLIC_PATH <font color="#339933">.</font> <font color="#0000ff">'/ userfiles / images / full /'</font> <font color="#339933">.</font> <font color="#000088">$ item</font> <font color="#339933">-&gt;</font> <font color="#004000">photo</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#990000">unlink</font> <font color="#009900">(</font> PUBLIC_PATH <font color="#339933">.</font> <font color="#0000ff">'/ userfiles / images / full /'</font> <font color="#339933">.</font> <font color="#000088">$ item</font> <font color="#339933">-&gt;</font> <font color="#004000">photo</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#990000">file_exists</font> <font color="#009900">(</font> PUBLIC_PATH <font color="#339933">.</font> <font color="#0000ff">'/ userfiles / images / thumb /'</font> <font color="#339933">.</font> <font color="#000088">$ item</font> <font color="#339933">-&gt;</font> <font color="#004000">photo</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#990000">unlink</font> <font color="#009900">(</font> PUBLIC_PATH <font color="#339933">.</font> <font color="#0000ff">'/ userfiles / images / thumb /'</font> <font color="#339933">.</font> <font color="#000088">$ item</font> <font color="#339933">-&gt;</font> <font color="#004000">photo</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#000088">$ item</font> <font color="#339933">-&gt;</font> <font color="#004000">photo</font> <font color="#339933">=</font> <font color="#000088">$ form</font> <font color="#339933">-&gt;</font> <font color="#004000">getValue</font> <font color="#009900">(</font> <font color="#0000ff">'photo'</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li></ol></blockquote><br><br><h5>  Source codes: </h5><br><br><ol><li>  <a href="http://pastebin.com/wf36F3T5">Application_Form_Decorators_File</a> </li><li>  <a href="http://pastebin.com/0KNzdEzK">Application_Form_Photogallery</a> </li><li>  <a href="http://pastebin.com/xDr65tBD">PhotogalleryController</a> </li></ol><br><br>  If the topic is relevant, then there is more material about writing filters for image processing loaded via Zend_Form_Element_File (gdlib and imagic). <br><br>  Thank you for your attention, comments and suggestions are accepted.  Not so long ago, I began to study the Zend Framework, I did not find a solution to this problem - I had to figure it out myself.  If something is done is not entirely correct and (or) not in the style of ZF - please unsubscribe in the comments, I will correct. <br><br>  The current implementation is working successfully. </div><p>Source: <a href="https://habr.com/ru/post/136438/">https://habr.com/ru/post/136438/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../136431/index.html">Hosting mercurial repositories using nginx, gunicorn and supervisor</a></li>
<li><a href="../136432/index.html">So.cl - an overview of the interface</a></li>
<li><a href="../136433/index.html">Google instructions to properly disable sites January 18</a></li>
<li><a href="../136434/index.html">Russian, English and Chinese enter the program ...</a></li>
<li><a href="../136437/index.html">Vandalism of Google‚Äôs OpenStreetMap Project Maps</a></li>
<li><a href="../136439/index.html">The world's first ‚Äúself-healing‚Äù Nissan IPhone case</a></li>
<li><a href="../136441/index.html">Search using filters on Yandex.Maps and data about your organization</a></li>
<li><a href="../136443/index.html">Wanted: author in the prime of life</a></li>
<li><a href="../136444/index.html">Hits App Store and the harsh reality</a></li>
<li><a href="../136445/index.html">Droider Chart. Issue 85, from Vegas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>