<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Asynchronous functions 101</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One of the main advantages of JavaScript is that everything is asynchronous. For the most part, different parts of your code do not affect the executi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Asynchronous functions 101</h1><div class="post__text post__text-html js-mediator-article"><p>  One of the main advantages of JavaScript is that everything is asynchronous.  For the most part, different parts of your code do not affect the execution of others. </p><br><pre><code class="hljs coffeescript">doALongThing(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"I will be logged second!"</span></span>)); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"I will be logged first!"</span></span>);</code> </pre> <br><p>  Unfortunately, this is also one of the major drawbacks of javascript.  The task of executing synchronous code becomes more complicated, since by default everything is asynchronous. <a name="habracut"></a><br>  The first solution was kolbeki.  If part of our code depends on some result, we should have inserted our code - </p><br><pre> <code class="hljs lisp">doSomething((<span class="hljs-name"><span class="hljs-name">response</span></span>) =&gt; { doSomethingElse(<span class="hljs-name"><span class="hljs-name">response</span></span>,(<span class="hljs-name"><span class="hljs-name">secondResponse</span></span>) =&gt; { doAThirdThing(<span class="hljs-name"><span class="hljs-name">secondResponse</span></span>)<span class="hljs-comment"><span class="hljs-comment">; }); })</span></span></code> </pre> <br><p>  Nested callbacks in callbacks, as we know, become unsuitable.  Thus, Promises were created.  They allowed us to work with synchronous code in a cleaner and flatter way. </p><br><pre> <code class="hljs coffeescript">doSomething() .<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(response)</span></span></span><span class="hljs-function"> =&gt;</span></span> doSomethingElse(response)); .<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(secondResponse)</span></span></span><span class="hljs-function"> =&gt;</span></span> doAThirdThing(secondResponse)); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> Even cleaner doSomething().<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>(doSomethingElse).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>(doAThirdThing);</code> </pre> <br><p>  Like everyone else, promises are not perfect either.  Thus, within the framework of the ES2017 specification, another method has been defined for working with synchronous code: Asynchronous functions.  This allows us to write asynchronous code as if it were synchronous. </p><br><h2 id="sozdanie-asinhronnoy-funkcii">  Creating an asynchronous function </h2><br><p>  An asynchronous function is defined by an asynchronous function expression.  The basic function is as follows: </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> somePromise(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; }</code> </pre> <br><p>  We define a function as asynchronous using <code>async</code> .  This keyword can be used with any function declaration syntax - </p><br><pre> <code class="hljs lua">// Basic <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">async</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { ‚Ä¶ } // Arrow <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">const</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">async</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> =&gt; { ‚Ä¶ } // Class methods class Bar { async foo() { ‚Ä¶ } }</code> </pre> <br><p>  Once we have defined the function as asynchronous, we can use the <code>await</code> keyword. <br>  This keyword is placed before the promise call, it pauses the execution of the function until the promise is executed or rejected. </p><br><h2 id="obrabotka-oshibok">  Error processing </h2><br><p>  Error handling in asynchronous functions is performed using <code>try</code> and <code>catch</code> blocks. <br>  The first block (try) allows us to try the action.  The second block (catch), is called if the action is not performed.  It takes one parameter containing any error. </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> value = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> somePromise(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (err) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"Oops, there was an error :("</span></span>); } }</code> </pre> <br><h2 id="ispolzovanie-asinhronnyh-funkciy">  Using Asynchronous Functions </h2><br><p>  Asynchronous functions are not a replacement for promises.  They are identical in nature.  Thus, the asynchronous function waits for the fulfillment of a promise and always returns a promise. </p><br><p>  The promis returned by the asynchronous function will be resolved with any value returned by the function. </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> somePromise(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'success!'</span></span> } foo().then(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(res)) <span class="hljs-comment"><span class="hljs-comment">// 'success!'</span></span></code> </pre> <br><p>  If an error is thrown, the promise will be rejected with this error. </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> somePromise(); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">'oops!'</span></span>) } foo() .then(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(res)) .catch(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(err)) <span class="hljs-comment"><span class="hljs-comment">// 'oops!'</span></span></code> </pre> <br><h2 id="vypolnenie-asinhronnyh-funkciy-v-parallelno">  Performing Asynchronous Functions in Parallel </h2><br><p>  With promises, we can fulfill several promises in parallel using the <code>Promise.all ().</code> method <code>Promise.all ().</code> </p><br><pre> <code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pause500ms</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res</span></span></span><span class="hljs-function">) =&gt;</span></span> setTimeout(res, <span class="hljs-number"><span class="hljs-number">500</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> promise1 = pause500ms(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> promise2 = pause500ms(); <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>.all([promise1, promise2]).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"I will be logged after 500ms"</span></span>); });</code> </pre> <br><p>  With asynchronous functions, we need to work a little to get the same effect.  If we simply enumerate every function that is waiting in the queue, they will be executed sequentially, since <code>await</code> suspends the execution of the rest of the function. </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inSequence</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> pause500ms(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> pause500ms(); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"I will be logged after 1000ms"</span></span>); }</code> </pre> <br><p>  It will take 1000 ms, since the second wait will not start until the first one is completed.  To get around this, we need to reference functions like this: </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inParallel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> await1 = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> pause500ms(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> await2 = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> pause500ms(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> await1; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> await2; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"I will be logged after 500ms"</span></span>); }</code> </pre> <br><p>  Now it takes only 500 ms, because both functions of <code>pause500ms ()</code> are executed simultaneously. </p><br><h3 id="promisy-ili-asinhronnye-funkcii">  Promises or Asynchronous Functions? </h3><br><p>  As I already mentioned, asynchronous functions do not replace promises.  They are identical in nature.  Asynchronous functions provide an alternative, and in some cases, a better way to work with promise-based functions.  But they still use and produce promises. </p><br><p>  As the promise is returned, the asynchronous function may be called by another asynchronous function or by promis.  We can mix and match, depending on which syntax is best suited for each case. </p><br><pre> <code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">baz</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res</span></span></span><span class="hljs-function">) =&gt;</span></span> setTimeout(res, <span class="hljs-number"><span class="hljs-number">1000</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> baz(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'foo complete!'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bar</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> value = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> foo(); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(value); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'bar complete!'</span></span>; } bar().then(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(value));</code> </pre> <br><p>  The following happens: </p><br><ul><li>  waiting for 1000ms </li><li>  log "foo complete!" </li><li>  ‚Äúbar complete!‚Äù log </li></ul><br><h2 id="podderzhka">  Support </h2><br><p>  As of this writing, asynchronous functions and promises are available in current versions of all major browsers, with the exception of Internet Explorer and Opera Mini. </p><br><img src="https://habrastorage.org/files/0a0/6ba/b40/0a06bab40e4f434199d7267b2fff2f9d.png"><br><img src="https://habrastorage.org/files/5ff/c15/5e0/5ffc155e00b143c3800f8e73f9c33020.png"></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/326442/">https://habr.com/ru/post/326442/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../326432/index.html">Windows 10 Creators Update: What's new in Bash / WSL and Windows Console</a></li>
<li><a href="../326434/index.html">PHDays Online Contests: Yes CTF</a></li>
<li><a href="../326436/index.html">Why large databases do not work as you want, or about the unfulfilled dreams of SQL queries</a></li>
<li><a href="../326438/index.html">Moscow Workshops ACM ICPC: how Fiztech created an international camp</a></li>
<li><a href="../326440/index.html">Failover Evolution in PostgreSQL: Replication Phase</a></li>
<li><a href="../326444/index.html">Customer service: people are better than robots</a></li>
<li><a href="../326446/index.html">Recruitment marketing guide for dummies (and not only)</a></li>
<li><a href="../326448/index.html">UX strategy. Part 5 - Exhaust Design</a></li>
<li><a href="../326450/index.html">Icinga2 simple option</a></li>
<li><a href="../326454/index.html">Super Strengths WinDbg for .NET Developers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>