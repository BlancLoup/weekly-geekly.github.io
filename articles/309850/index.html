<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>1C, .Net Core. Dynamic compilation of a wrapper class for receiving events of a .Net object in 1C</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is a practical application from the previous article .Net Core, 1C, dynamic compilation, Scripting API. 

 In essence, this is a continuation of ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>1C, .Net Core. Dynamic compilation of a wrapper class for receiving events of a .Net object in 1C</h1><div class="post__text post__text-html js-mediator-article">  This is a practical application from the previous article <a href="https://habrahabr.ru/post/309340/">.Net Core, 1C, dynamic compilation, Scripting API.</a> <br><br>  In essence, this is a continuation of <a href="http://infostart.ru/public/417830/">.NET (C #) for 1C.</a>  <a href="http://infostart.ru/public/417830/">Dynamic compilation of a wrapper class for using .Net events in 1C via the Add Processor or Processing an External Event</a> , but for cross-platform .Net Core.  But in that development I used CodeDom.  In .Net Core it is more convenient to use Roslyn Scripting API. <br><br>  At one time I did a hand wrapper for WhatsApp, and there are more than 30 events.  At the same time, the whole process can be automated using code generation and, ultimately, this code can be dynamically compiled. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In <a href="https://its.1c.ru/db/metod8dev">‚ÄúCreating Components Using the Native API Technology‚Äù</a> there is a method for invoking an external event in 1C ExternalEvent.  Syntax: <br><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExternalEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(WCHAR_T* wsSource, WCHAR_T* wsMessage, WCHAR_T* wsData)</span></span></span></span></code> </pre> <br>  Options: <br><br>  ‚Ä¢ Type: WCHAR_T *.  A string with the name of the event source. <br>  ‚Ä¢ Type: WCHAR_T *.  String with the name of the event. <br>  ‚Ä¢ Type: WCHAR_T *.  String with event parameters. <br><br>  But as wsData we will pass a link to the object created from the event parameters. <br><br>  So, let's begin. <a name="habracut"></a><br>  First, create a class description using the example of my favorite System.IO.FileSystemWatcher, which in .Net Core is located in System.IO.FileSystem.Watcher <br><br>  Pure 1C nicknames can miss the enemy code. <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">System_IO_FileSystemWatcher</span></span> { Action&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>; System.IO.FileSystemWatcher ; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> System_IO_FileSystemWatcher(Action&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, System.IO.FileSystemWatcher ) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>. = ; .Changed += (sender,e) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Changed = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { sender=sender,e=e}; <span class="hljs-number"><span class="hljs-number">1</span></span>?.DynamicInvoke(<span class="hljs-string"><span class="hljs-string">"System_IO_FileSystemWatcher"</span></span>,<span class="hljs-string"><span class="hljs-string">"Changed"</span></span>,Changed); }; .Created += (sender,e) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Created = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { sender=sender,e=e}; <span class="hljs-number"><span class="hljs-number">1</span></span>?.DynamicInvoke(<span class="hljs-string"><span class="hljs-string">"System_IO_FileSystemWatcher"</span></span>,<span class="hljs-string"><span class="hljs-string">"Created"</span></span>,Created); }; .Deleted += (sender,e) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Deleted = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { sender=sender,e=e}; <span class="hljs-number"><span class="hljs-number">1</span></span>?.DynamicInvoke(<span class="hljs-string"><span class="hljs-string">"System_IO_FileSystemWatcher"</span></span>,<span class="hljs-string"><span class="hljs-string">"Deleted"</span></span>,Deleted); }; .Error += (sender,e) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Error = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { sender=sender,e=e}; <span class="hljs-number"><span class="hljs-number">1</span></span>?.DynamicInvoke(<span class="hljs-string"><span class="hljs-string">"System_IO_FileSystemWatcher"</span></span>,<span class="hljs-string"><span class="hljs-string">"Error"</span></span>,Error); }; .Renamed += (sender,e) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Renamed = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { sender=sender,e=e}; <span class="hljs-number"><span class="hljs-number">1</span></span>?.DynamicInvoke(<span class="hljs-string"><span class="hljs-string">"System_IO_FileSystemWatcher"</span></span>,<span class="hljs-string"><span class="hljs-string">"Renamed"</span></span>,Renamed); }; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> (Action&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, System.IO.FileSystemWatcher ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> System_IO_FileSystemWatcher(<span class="hljs-number"><span class="hljs-number">1</span></span>, ); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Func&lt;Action&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;,System.IO.FileSystemWatcher,<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;(System_IO_FileSystemWatcher.);</code> </pre> <br><br>  Create a class, subscribe to events.  In the event, we create an anonymous class from the parameters and call the method that ultimately calls the above function in 1C. <br><br>  In order to cache the result of the compilation, create a class. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> &lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Func&lt;Action&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;, T, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Func&lt;Action&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;, T, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; () { Type  = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(T); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>  = .FullName; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span>  = <span class="hljs-string"><span class="hljs-string">""</span></span> + .Replace(<span class="hljs-string"><span class="hljs-string">"."</span></span>, <span class="hljs-string"><span class="hljs-string">"_"</span></span>).Replace(<span class="hljs-string"><span class="hljs-string">"+"</span></span>, <span class="hljs-string"><span class="hljs-string">"_"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span>  = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> (); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>  = .(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scr = Microsoft.CodeAnalysis.Scripting.ScriptOptions.Default; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span>  = ..Keys.ToArray(); scr = scr.WithReferences() .WithImports(<span class="hljs-string"><span class="hljs-string">"System"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> res = (Func&lt;Action&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;, T, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;)Microsoft.CodeAnalysis.CSharp.Scripting.CSharpScript.EvaluateAsync(, scr).Result; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res; } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> () { = (); } }</code> </pre><br><br>  Create a field: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Func&lt;Action&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;, T, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; ;</code> </pre> <br><br>  Which is initialized when creating a class in a static constructor.  Compilation uses parameter type assemblies and the type of object to be wrapped.  This approach is often used in the universal creation of serializers. <br><br>  Now we can call the delegate to create a wrapper object for events like this. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> ,<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> , <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> ) { <span class="hljs-comment"><span class="hljs-comment">//       //      1 //         . var 1 = AutoWrap.(); string res=""; if ( == null) res = ""; else if (1 is AutoWrap) res = ((AutoWrap)1).(); else res = 1.ToString(); AutoWrap.1(, , res); } public static object (Object ) { Type  = .GetType(); Type genType = typeof(&lt;&gt;); Type constructed = genType.MakeGenericType(new Type[] {  }); var  = ""; var fi = constructed.GetField(); Delegate  = (Delegate)fi.GetValue(null); //   //            1      object  = .DynamicInvoke(new Action&lt;string,string,object&gt;(), ); return ; }</span></span></code> </pre><br><br>  We now turn to the code in 1C.  To obtain the code in C # and 1C, we use external processing of Test Change Events in the Directory .epf. <br><br><pre> <code class="1c hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword"></span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span></span></span>) e=.e; <span class="hljs-keyword"><span class="hljs-keyword"></span></span> e&lt;&gt;<span class="hljs-literal"><span class="hljs-literal"></span></span> <span class="hljs-keyword"><span class="hljs-keyword"></span></span> e=(e); ChangeType=(e.ChangeType); <span class="hljs-built_in"><span class="hljs-built_in"></span></span>( e.FullPath + <span class="hljs-string"><span class="hljs-string">" "</span></span> + .(ChangeType.())); <span class="hljs-keyword"><span class="hljs-keyword"></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"></span></span></span></span> <span class="hljs-comment"><span class="hljs-comment">//  //  :  //   // sender:System.Object // e:System.IO.FileSystemEventArgs  Changed() ("Changed "+.(.())); ()  //  :  //   // sender:System.Object // e:System.IO.FileSystemEventArgs  Created() ("Created "+.(.())); ()  //  :  //   // sender:System.Object // e:System.IO.FileSystemEventArgs  Deleted() ("Deleted "+.(.())); ()  //  :  //   // sender:System.Object // e:System.IO.ErrorEventArgs  Error() ("Error "+.(.())); ()  //  :  //   // sender:System.Object // e:System.IO.RenamedEventArgs  Renamed() ("Renamed "+.(.())); ()   ( )  =null  =    ;  ()=("")   (,"&lt;&gt;‚Ññ_%)?&amp;")= 1   () ; ;    // ()  (, , ) ();   = "System_IO_FileSystemWatcher"  = (); ( + "()"); ;  // </span></span></code> </pre> <br>  Handler methods are formed by the name of the event that is called via <br><br><pre> <code class="1c hljs">= (); <span class="hljs-keyword"><span class="hljs-keyword"></span></span>( + <span class="hljs-string"><span class="hljs-string">"()"</span></span>);</code> </pre> <br>  This approach reduces manual code writing.  Well and creating tracking changes in the directory <br><br><pre> <code class="1c hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function">()</span></span> <span class="hljs-keyword"><span class="hljs-keyword"></span></span> watcher&lt;&gt;<span class="hljs-literal"><span class="hljs-literal"></span></span> <span class="hljs-keyword"><span class="hljs-keyword"></span></span> watcher.EnableRaisingEvents = false; <span class="hljs-keyword"><span class="hljs-keyword"></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"></span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"></span></span></span></span>) (); Watcher=(.(<span class="hljs-string"><span class="hljs-string">"System.IO.FileSystem.Watcher"</span></span>)); Watcher=(Watcher.GetType(<span class="hljs-string"><span class="hljs-string">"System.IO.FileSystemWatcher"</span></span>)); NotifyFilters=(Watcher.GetType(<span class="hljs-string"><span class="hljs-string">"System.IO.NotifyFilters"</span></span>)); =;<span class="hljs-comment"><span class="hljs-comment">//"c:\tmp\"; watcher=(.(Watcher.(),)); //watcher.NotifyFilter = NotifyFilters.LastAccess | NotifyFilters.LastWrite // | NotifyFilters.FileName | NotifyFilters.DirectoryName; // Only watch text files. LastAccess=(NotifyFilters.LastAccess); LastWrite=(NotifyFilters.LastWrite); FileName=(NotifyFilters.FileName); DirectoryName=(NotifyFilters.DirectoryName); =(.OR(LastAccess.(),LastWrite.(),FileName.(),DirectoryName.())); watcher.NotifyFilter=.(); watcher.Filter = "*.*"; watcher.IncludeSubdirectories = true; watcher.EnableRaisingEvents = true; (Watcher); </span></span></code> </pre> <br>  At the end you need to take care of the release of resources. <br><br><pre> <code class="1c hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function">()</span></span> <span class="hljs-keyword"><span class="hljs-keyword"></span></span> watcher&lt;&gt;<span class="hljs-literal"><span class="hljs-literal"></span></span> <span class="hljs-keyword"><span class="hljs-keyword"></span></span> (); .(watcher.()); watcher=<span class="hljs-literal"><span class="hljs-literal"></span></span>; =<span class="hljs-literal"><span class="hljs-literal"></span></span>; GC=(<span class="hljs-string"><span class="hljs-string">"System.GC"</span></span>); GC.Collect(); GC.WaitForPendingFinalizers(); = <span class="hljs-literal"><span class="hljs-literal"></span></span>; <span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"></span></span></span></span></code> </pre> <br><br>  Now you can use not only the methods and properties of .Net objects, but also events.  At the same time using only native for 1C ka programming language.  And not a single line in the enemy language. <br><br>  In conclusion, I want to share my bewilderment about the discussion of articles.  All discussion comes down to Russlish and b. <br><br>  I will raise problems when using the Native API in the <a href="https://habrahabr.ru/post/304542/">Cross-platform use of the .Net classes in 1C via Native VK.</a>  <a href="https://habrahabr.ru/post/304542/">Or replacing COM with Linux</a> <br><br>  So when you create a Native API, you can see the legs from IDispatch.  But they used dispinterfaces to call only Invoke. <br><br>  <strong>1.</strong> Absolutely no need for methods FindMethod, FindProp, GetNParams, HasRetVal, GetParamDefValue <br>  (IsPropReadable, IsPropWritable for the debugger only).  Since the bool CallAsProc, bool CallAsFunc, bool SetPropVal and bool GetPropVal methods have a return value on success.  Error information is returned via AddError.  And the call by index is an anachronism from IDiapatch where there was a description of the interfaces for increasing the speed of the call. <br>  <strong>2.</strong> When returning with the SetPropVal and GetPropVal methods, an exception is not raised. <br>  <strong>3.</strong> Why does the installation of properties occur, where it is not required in the code? <br>  <strong>4. A</strong> method is called as a function, where the method is called as a procedure. <br>  <strong>5.</strong> One of the main ones is that it is impossible to return and transfer a copy of the VK from the VK methods. <br><br>  I personally do not see any problems.  Determine the value for this type and set the link in the pInterfaceVal field. <br>  The Native API has a structure <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tVariant</span></span></span><span class="hljs-class"> {</span></span> ..... _ANONYMOUS_STRUCT <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>* pInterfaceVal; IID InterfaceID; } ...... TYPEVAR vt; };</code> </pre><br>  In which you can use void * pInterfaceVal;  IID InterfaceID.  And in vt;  indicate that it is VC.  Recently, you can pass byte [].  So you can go on. <br><br>  Reference counting takes place on the 1C side.  It is possible to transfer including 1C objects only for the duration of the method call.  So when using IDispatch in 1C, there is no problem when passing IDispatch in the method parameters.  Now the call rate of the VK method is almost 15 times slower than the call from C ++ only <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CallAsFunc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Target, IntPtr Ptr, IntPtr ReturnValue, IntPtr , </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span></span><span class="hljs-function">)</span></span></code> </pre> <br>  And 5 times slower than the similar 1C method.  In this case, instead of one method, FindMethod, GetNParams, CallAsFunc is called.  And if you call directly without VK, then the speed will be similar using internal methods. <br><br>  Now when transferring to the VK method via the property of the method (Object.Property) or to the method by reference without any values.  1C tries to assign a value, even if this value has not changed.  You can see the transfer of changed parameters in the VC. <br><br>  Now on Windows there are many components on COM.  Same ADO, Excel, and so on.  You can easily create your COM library in any language. <br><br>  Therefore, when polling why they do not use <a href="http://infostart.ru/public/238584/">Using .NET assemblies in 1C 7.xb 8.x.</a>  <a href="http://infostart.ru/public/238584/">Creating External Component</a> <br><br>  Most replies that they do not intend to use the product is unknown from whom.  This situation is similar to that of the Nemerle.  A language that is more powerful than C #, but behind which there are enthusiasts nobody needs.  But at the same time, everyone agrees that if this component were integrated into 1C in the likeness of a ComObject, then everyone would use it. <br><br>  As for cross-platform, .Net Core gives this opportunity.  At the same time, this technology is now actively developing. <a href="https://blogs.msdn.microsoft.com/dotnet/2016/07/15/net-core-roadmap/">NET Core Roadmap</a> <br><br>  As I showed, you can use any .Net Core classes only in 1C language.  You can use dynamic compilation of scripts or write your own assembly in C #, which is much easier than writing VK. <br><br>  I know that there are many 1C developers on this site.  And I have a big request for them to give advice on the development of this development.  If 1C does not intend to change the Native API, then I will force the force to something else.  Although this development took years and I really feel sorry for her.  She is like a child. <br><br>  I am ready to participate for free in a research project on the application of .Net Core in 1C.  The main thing is that the forces were spent not in vain. <br><br>  And the possibilities of cross-platform use of .Net Core in 1C are colossal.  But I wonder why 1C is not needed?  Here is the answer to this question I would like to hear.  As for Linux, my questions are: what is missing compared to Windows, the main thing was <br><br><blockquote>  The main problem is to transfer clients to Linux.  And here the main brake is the work with trading equipment.  Bad deal with ready and reliable firewood under the Native API under any different.  A high-level canoe somehow does not hold too much.  Technically, anyway. </blockquote><br><br>  At one time, working with the Trade Equipment, there were necessarily a SDK on C #.  Even under WiCE.  Many were interop wrappers over native libraries.  With the advent of .Net Core will do under NetStandart.  And on Linux will be more fun. <br><br>  Sources and examples can be downloaded <a href="https://yadi.sk/d/jRSHEA19svgrn">here.</a> </div><p>Source: <a href="https://habr.com/ru/post/309850/">https://habr.com/ru/post/309850/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../309840/index.html">Android Dev: continued podcasts about professional development for Android</a></li>
<li><a href="../309842/index.html">Exit "in the field": How we made a mobile application to increase the efficiency of field workers</a></li>
<li><a href="../309844/index.html">How to render the frame of the new Doom</a></li>
<li><a href="../309846/index.html">Using blocks in iOS. Part 2</a></li>
<li><a href="../309848/index.html">Three JavaScript performance principles that make Bluebird fast</a></li>
<li><a href="../309852/index.html">DevFest season 2016 in 10 cities of Russia</a></li>
<li><a href="../309854/index.html">Five kinds of game crafting systems</a></li>
<li><a href="../309856/index.html">We are recruiting a technical support team: instructions for use</a></li>
<li><a href="../309858/index.html">PHP 7.1: Overview of New Features</a></li>
<li><a href="../309860/index.html">MaterialViewPager - an example of creating a unique application</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>