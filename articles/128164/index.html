<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Lazy webapp loading</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the standard webapp framework there is a lot of useful and a little extra. But there is one feature in this nice creation of Google - all the modul...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Lazy webapp loading</h1><div class="post__text post__text-html js-mediator-article">  In the standard webapp framework there is a lot of useful and a little extra.  But there is one feature in this nice creation of Google - all the modules used are loaded when the application starts.  This is convenient for development and debugging, but it poses one problem: the instance has a rather long start for a rather large application.  As a result, the user has to wait for the entire application to load, even if only a small part of the code is needed to display the page he needs. <br><br>  Today we will ‚Äúteach‚Äù the webapp not to download too much. <br><a name="habracut"></a>  The solution to the problem is quite simple, so first there will be a code, and only then a description and explanation.  The lazy-loading code for the main application module looks like this: <br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> google.appengine.ext.webapp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> RequestHandler, WSGIApplication, util <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os, sys dev_server = os.environ.get(<span class="hljs-string"><span class="hljs-string">'SERVER_SOFTWARE'</span></span>).lower().startswith(<span class="hljs-string"><span class="hljs-string">'dev'</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lazy_loader</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, fullname)</span></span></span><span class="hljs-function">:</span></span> self.modulename, sep, self.objname = fullname.rpartition(<span class="hljs-string"><span class="hljs-string">'.'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> dev_server: self() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__call__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.obj() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> AttributeError: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> sys.modules.has_key(self.modulename): __import__(self.modulename, globals(), locals(), [], <span class="hljs-number"><span class="hljs-number">0</span></span>) self.obj = sys.modules.get(self.modulename).__dict__.get(self.objname) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.obj() application = WSGIApplication([(route[<span class="hljs-number"><span class="hljs-number">0</span></span>], lazy_loader(route[<span class="hljs-number"><span class="hljs-number">1</span></span>])) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> route <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [ (<span class="hljs-string"><span class="hljs-string">r'/'</span></span>, <span class="hljs-string"><span class="hljs-string">'handlers.MainPage'</span></span>), (<span class="hljs-string"><span class="hljs-string">r'/search/'</span></span>, <span class="hljs-string"><span class="hljs-string">'handlers.Search'</span></span>), (<span class="hljs-string"><span class="hljs-string">r'/_ah/queue/sendmail'</span></span>, <span class="hljs-string"><span class="hljs-string">'mail.SendMail'</span></span>), (<span class="hljs-string"><span class="hljs-string">r'/_ah/queue/HeavyTask'</span></span>, <span class="hljs-string"><span class="hljs-string">'tasks.HeavyTask'</span></span>), ]], debug=os.environ.get(<span class="hljs-string"><span class="hljs-string">'CURRENT_VERSION_ID'</span></span>).lower().startswith(<span class="hljs-string"><span class="hljs-string">'dev'</span></span>)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> util.run_wsgi_app(application) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: main()</code> </pre> <br><br><h2>  Lazy loader. </h2><br>  lazy_loader is the main thing in this example.  This is a small interlayer object whose main task is to initialize as quickly as possible.  An example was taken <a href="http://blog.notdot.net/2010/02/Webapps-on-App-Engine-part-6-Lazy-loading">from here</a> , after which the code was slightly modified. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Actually, during initialization, this object only saves the name of the query processor class.  The <code>if dev_server: self.__call__()</code> only makes it easier to debug on the development server and you can do without it.  The definition of the development server is outside the scope of the function to increase performance. <br><br>  When you call the handler <code>lazy_loader</code> immediately passes the call.  The construction with catching <code>AttributeError</code> chosen because the <code>self.obj</code> object should be present in most cases (if the name of the object is correct, then it will be absent only on the first call).  If you instead check <code>self.obj</code> on every call, the application will perform unnecessary operations;  a bit, but still ... For the "lost" <code>AttributeError</code> (if such suddenly appear in the handler's code) you can not worry - they will still pop up on the second call of the handler. <br><br><h2>  Loading handler. </h2><br>  Perhaps the most interesting thing happens when the handler is first called: a call to the missing <code>self.obj</code> calls <code>AttributeError</code> , during the processing of which the module is imported and the handler is received.  Standard python expressions <code>from package import module</code> can only import modules whose names are known at the design stage, so you can‚Äôt do without the powerful built-in function <a href="http://docs.python.org/library/functions.html">__import__</a> .  We will use it in the simplest way - first import the module, and then get it from the <a href="http://docs.python.org/library/sys.html">sys.modules</a> dictionary. <br><br>  Since each imported module is added to <code>sys.modules</code> , it is possible to check whether the necessary module has already been imported.  In this example, the <code>handlers</code> module will be imported only once during the lifetime of the instance. <br><br><h2>  Webapp configuration </h2><br>  In order for the configuration of routes to be more visual and less cumbersome, <a href="http://ru.diveintopython.org/apihelper_filter.html">filtering lists is used</a> , which adds <code>lazy_loader</code> to all list items (for example, <code>(r'/', 'handlers.MainPage')</code> replaced by <code>(r'/', lazy_loader('handlers.MainPage'))</code> . <br><br>  And another handy little thing that I decided not to remove from this example is the debug configuration of the <code>webapp</code> , depending on the version of the application specified in <code>app.yaml</code> .  Debug information will be issued only if the application version starts with ‚Äúdev‚Äù (for example, <code>develop</code> , <code>dev-0-1-123</code> , <code>dev-B1-37-2</code> , etc.) </div><p>Source: <a href="https://habr.com/ru/post/128164/">https://habr.com/ru/post/128164/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../128157/index.html">Creation of another casual game on a Flash platform with physics. Part II</a></li>
<li><a href="../128158/index.html">The principle of operation of the digital compass</a></li>
<li><a href="../128159/index.html">Symfony2 \ SecurityBundle</a></li>
<li><a href="../128161/index.html">HowTo cook custom Firefox msi for enterprise deployment</a></li>
<li><a href="../128162/index.html">Does the network challenge you?</a></li>
<li><a href="../128165/index.html">A small review of the laptop Asus K43Sv</a></li>
<li><a href="../128167/index.html">"Typesquatters" collected 20 GB of someone else's correspondence</a></li>
<li><a href="../128169/index.html">Simile TimeLine - a library for displaying events on a timeline</a></li>
<li><a href="../128170/index.html">Free classes on InfoSec in Tomsk</a></li>
<li><a href="../128171/index.html">The threat on behalf of the FBI can be placed on any site.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>