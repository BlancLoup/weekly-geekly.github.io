<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ASP.NET MVC integration with Sharepoint 2013. Part 2: Interact with SharePoint</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In a previous article, ASP.NET MVC integration with Sharepoint 2013. Part 1: High-Trusted provider-hosted APP discussed how to configure SharePoint 20...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ASP.NET MVC integration with Sharepoint 2013. Part 2: Interact with SharePoint</h1><div class="post__text post__text-html js-mediator-article">  In a previous article, <a href="http://habrahabr.ru/company/docsvision/blog/242325//">ASP.NET MVC integration with Sharepoint 2013. Part 1: High-Trusted provider-hosted APP discussed</a> how to configure SharePoint 2013 for SharePoint Apps (now Microsoft calls this <a href="https://msdn.microsoft.com/en-us/library/office/fp161507.aspx">SharePoint Add-in</a> ) and make basic integration of an ASP.NET application MVC with provider-hosted APP.  In this article, I will show how we implemented: search for SharePoint Site elements in the MVC application, transfer of elements from SharePoint Site, App-parts and localization of SharePoint elements. <br><a name="habracut"></a><br>  <b>Search SharePoint items through an ASP.NET MVC application</b> <br><br>  Suppose that somewhere in the interface of your application there is a normal search field, which as a result calls the action SharepointSearch: <br><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> JsonResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SharepointSearch</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> search</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sharepointItems = GetSharePointSearchResult(search); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> json = JsonHelper.ConvertToJsonResponse(sharepointItems); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Json(json); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ResponseModel&lt;List&lt;SharePointDocumentModel&gt;&gt; GetSharePointSearchResult(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> query) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> responseModel = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ResponseModel&lt;List&lt;SharePointDocumentModel&gt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> searchResult = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;SharePointDocumentModel&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> spContext = SharePointContextProvider.Current.GetSharePointContext(HttpContext); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (spContext == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { responseModel.Initialize(searchResult, Resources.SharepointContextNull, ResponseStatusEnum.Fail); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> responseModel; } <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> clientContext = spContext.CreateUserClientContextForSpHost()) { clientContext.ExecuteQuery(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keywordQuery = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> KeywordQuery(clientContext); keywordQuery.QueryText = query; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> searchExecutor = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SearchExecutor(clientContext); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> results = searchExecutor.ExecuteQuery(keywordQuery); clientContext.ExecuteQuery(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> resultRow <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> results.Value[<span class="hljs-number"><span class="hljs-number">0</span></span>].ResultRows) { clientContext.ExecuteQuery(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> spDocument = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SharePointDocumentModel(); DateTime createdDateTime; DateTime.TryParse(GetDictonaryStringValueByKey(resultRow, <span class="hljs-string"><span class="hljs-string">"Write"</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> createdDateTime); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> contentTypeId = spDocument.DocumentName = GetDictonaryStringValueByKey(resultRow, <span class="hljs-string"><span class="hljs-string">"ContentTypeId"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (contentTypeId.StartsWith(<span class="hljs-string"><span class="hljs-string">"0x01"</span></span>)) { spDocument.DocumentName = GetDictonaryStringValueByKey(resultRow, <span class="hljs-string"><span class="hljs-string">"Title"</span></span>); spDocument.DocumentUrl = GetDictonaryStringValueByKey(resultRow, <span class="hljs-string"><span class="hljs-string">"Path"</span></span>); spDocument.Id = GetDictonaryStringValueByKey(resultRow, <span class="hljs-string"><span class="hljs-string">"WorkId"</span></span>); spDocument.Author = GetDictonaryStringValueByKey(resultRow, <span class="hljs-string"><span class="hljs-string">"Author"</span></span>); spDocument.CreateDate = createdDateTime.ToShortDateString(); searchResult.Add(spDocument); } } } responseModel.Initialize(searchResult); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> responseModel; }</code> </pre> <br>  In our case, it was necessary to obtain all possible references to any SP-objects (by the identifier " <b>0x01</b> ").  However, you can drill down the item selection using <a href="https://msdn.microsoft.com/en-US/library/office/aa543822(v%3Doffice.14).aspx">other SharePoint Content IDs.</a> <br><br>  <b>Attaching SharePoint Items through CustomActions</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Via SharePoint APP you can ‚Äúembed‚Äù your CustomActions elements in SharePoint (buttons in the ribbon, elements in the context menu).  More information on how to do this can be found <a href="https://msdn.microsoft.com/en-us/library/office/jj163954.aspx">on MSDN</a> . <br><br>  Let's try to add two elements: a button in the ribbon and a context menu item. <br><br>  Let's start with the context menu.  To do this, we need to add a new <b>Menu Item Custom Action</b> to our SharePoint APP application.  In the wizard of adding Visual Studio elements, you will be asked to choose where and in which lists the context menu item should appear.  If you look at the created element, it will become clear that this is a regular xml file with the following content: <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Elements</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/sharepoint/"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CustomAction</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"6d471c89-41cc-4b81-b794-ea7664dc4c38.AttachToNewDocument"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">RegistrationType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ContentType"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">RegistrationId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0x0101"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Location</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"EditControlBlock"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Sequence</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10001"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$Resources:ContextMenu_AttachToNewDocument"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UrlAction</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Url</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"~remoteAppUrl/Navigator/SharepointAction/?SPHostUrl={HostUrl}&amp;SPListId={ListId}&amp;SPListItemsId={ItemId}"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CustomAction</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Elements</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Let us analyze the main elements in order: <br>  <b>RegistrationType &amp; RegistrationId</b> - indicate the combination at which the menu item will be invoked (what was specified in the wizard; can be redefined for a wide range of actions) <br>  <b>Location</b> - where the element is contained (context menu) <br>  <b>Sequence</b> - menu order <br>  <b>Title</b> - Visible title.  Here you can see that localization has already been applied.  This is how you can localize items from <b>Resources (Host web)</b> <br>  <b>UrlAction</b> - the foundation of CustomActions.  This is the url where the user will be redirected after the click.  In this case, a special system designation for provider hosted app ~ remoteAppUrl is specified. <br>  It is also important to note the parameters SPListId, SPListItemsId are identifiers of the current sheet and the elements selected in it, respectively.  How values ‚Äã‚Äãare substituted by markers.  Full information on the formation of such links can be found <a href="https://msdn.microsoft.com/ru-ru/library/office/jj163816.aspx">here.</a> <br><br>  Now let's move on to the host action of our MVC application: <br><pre> <code class="hljs cs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SharepointAction</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SharepointActionModel actionModel</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> spContext = SharePointContextProvider.Current.GetSharePointContext(HttpContext); GetSharepointListItemsAndPerformAction(spContext, actionModel.SpListId.Value, actionModel.SpListItemsId, (listItems, ids, context, spList) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (spList.BaseType == BaseType.DocumentLibrary) { richCardId = AttachSharepointDocumentsToDocumentCard(listItems, ids, context); } }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Redirect(model.UrlToNavigate); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SharepointActionModel</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Guid? SpListId { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> SpListItemsId { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> SpHostUrl { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> DocumentCamlQuery = <span class="hljs-string"><span class="hljs-string">@"&lt;QueryOptions&gt;&lt;ViewAttributes Scope='All'/&gt;&lt;/QueryOptions&gt; &lt;Where&gt; &lt;In&gt; &lt;FieldRef Name='ID' /&gt; &lt;Values&gt; {0} &lt;/Values&gt; &lt;/In&gt; &lt;/Where&gt;"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetSharepointListItemsAndPerformAction</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SharePointContext spContext, Guid listId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> listItemIds, Action&lt;ListItemCollection, List&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;, ClientContext, List&gt; fileAction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (spContext == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> Error.SharepointIntergration(); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> clientContext = spContext.CreateUserClientContextForSPHost()) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> spList = clientContext.Web.Lists.GetById(listId); clientContext.Load(spList); clientContext.ExecuteQuery(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (spList != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; spList.ItemCount &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> camlQuery = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CamlQuery(); camlQuery.ViewXml = String.Format(DocumentCamlQuery, GetFilterValues(listItemIds)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> listItems = spList.GetItems(camlQuery); clientContext.Load(listItems); clientContext.ExecuteQuery(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stringIds = listItemIds.Split(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span>[] { <span class="hljs-string"><span class="hljs-string">","</span></span> }, StringSplitOptions.RemoveEmptyEntries); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ids = ConvertToIntFromStringIds(stringIds); fileAction(listItems, ids, clientContext, spList); } } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception ex) { Trace.TraceError(ex); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span>; } }</code> </pre><br>  Next, with the buttons in the ribbon you need to do everything the same, adding the <b>Ribbon Custom Action</b> element to the project.  Moreover, you can send the url to the same place, having foreseen that in <b>SPListItemsId there</b> can be several elements separated by a comma.  In the code above it is already provided. <br><br>  <b>SharePoint AppParts</b> <br><br>  AppPart is another element that can be installed in SharePoint through the App.  But in this case, the SharePoint user himself decides where and where to add this element on the page.  The main idea of ‚Äã‚ÄãAppPart is to show a part of your high-trusted application using iframe technology.  In previous versions of SharePoint, this was also implemented through WebParts. <br><br>  So, how to add the App-part is also described in detail on <a href="https://msdn.microsoft.com/en-us/library/office/fp179921.aspx">MSDN</a> . <br><br>  You can add his project again using the Visual Studio wizard and is also an xml file of the following format: <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Elements</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/sharepoint/"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ClientWebPart</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Approvals"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$Resources:AppPart_Approvals_Title"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Description</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$Resources:AppPart_Approvals_Description"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">DefaultWidth</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"850"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">DefaultHeight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"150"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Content</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"html"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"~remoteAppUrl/Navigator/ApprovalAppPart?{StandardTokens}"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ClientWebPart</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Elements</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Surely you will need to resize the app part when you change the size of the content.  I will leave below the javascript code that must be called manually when the content is resized on the side of an ASP.NET MVC application: <br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ResizeIFrame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!IsSharepointAppPart()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> oBody = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> innerHeight = $(<span class="hljs-string"><span class="hljs-string">".app-part-content"</span></span>, oBody).height(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dheight = innerHeight + (oBody.offsetHeight - oBody.clientHeight); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dwidth = oBody.scrollWidth + (oBody.offsetWidth - oBody.clientWidth); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> message = <span class="hljs-string"><span class="hljs-string">"&lt;Message senderId="</span></span> + senderId + <span class="hljs-string"><span class="hljs-string">" &gt;"</span></span> + <span class="hljs-string"><span class="hljs-string">"resize("</span></span> + dwidth + <span class="hljs-string"><span class="hljs-string">","</span></span> + dheight + <span class="hljs-string"><span class="hljs-string">")&lt;/Message&gt;"</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.parent.postMessage(message, <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.referrer); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsSharepointAppPart</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> IsInsideIframe(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsInsideIframe</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.self !== <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.top; }</code> </pre><br>  Perhaps this can be finished.  Next time I will write how we created our Ribbon Tab, SharePoint Solution and linked it with the SharePoint App. </div><p>Source: <a href="https://habr.com/ru/post/269499/">https://habr.com/ru/post/269499/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../269489/index.html">How to make friends AWS Lambda and PostgreSQL</a></li>
<li><a href="../269491/index.html">Android 6.0: Doze Mode, App Standby, Runtime Permissions. Everything every developer needs to know</a></li>
<li><a href="../269493/index.html">Taming of the Shrew. We connect a single number to several mobile</a></li>
<li><a href="../269495/index.html">Extreme economy fonts</a></li>
<li><a href="../269497/index.html">Recursive queries in PostgreSQL (WITH RECURSIVE)</a></li>
<li><a href="../269501/index.html">SparkleFormation - CloudFormation template generator with rainbows and unicorns.</a></li>
<li><a href="../269503/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ182 (October 19 - 25, 2015)</a></li>
<li><a href="../269505/index.html">Rapid Java Reporting Development: Downshifting from 1C: Enterprise</a></li>
<li><a href="../269507/index.html">Yandex and ZeroNights: a month of searching for vulnerabilities in Yandex Browser</a></li>
<li><a href="../269509/index.html">Tibero. First pancake</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>