<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Download field we deserve</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Everything flows, everything changes, but only input[type=file] as it spoiled the nerves of all novice web developers, and continues to do so until no...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Download field we deserve</h1><div class="post__text post__text-html js-mediator-article"> Everything flows, everything changes, but only <code>input[type=file]</code> as it spoiled the nerves of all novice web developers, and continues to do so until now.  Remember yourself N years ago, when you were just beginning to comprehend the basics of creating websites.  Young and inexperienced, you were genuinely surprised when the file selection button completely refused to change the color of its background to your favorite peach.  It was at that moment that you first encountered this invincible iceberg called ‚ÄúUploading Files‚Äù, which to this day continues to ‚Äúdrown‚Äù novice web developers. <br><br>  Using the example of creating a field for uploading files, I will show you how to hide <code>input[type=file]</code> correctly, adjust the focus on an object that cannot focus, process Drag-and-Drop events and send files via AJAX.  And also I will introduce you to a couple of browser bugs and ways to work around them.  The article is written for beginners, but in some moments it can be useful and entertaining even for experienced developers. <br><a name="habracut"></a><br><h2>  Layout and Primary Styles </h2><br>  Let's start with the HTML markup: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>  ,   <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"style.css"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"jquery-3.3.1.min.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"script.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"upload-container"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"POST"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"send.php"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"upload-image"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"upload.svg"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"file-input"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"file"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"file"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">multiple</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"file-input"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Perhaps the main element that is worth paying attention to is 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"file-input"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  The HTML specification does not allow us to overlay visual properties directly on <code>input[type=file]</code> , but we have a <code>label</code> tag, clicking on which causes a click on the form element to which it is attached.  To our joy, this tag has no limitations in styling: we can do whatever we want with it. <br><br>  A plan of action emerges: we stylize the label as we like, and we hide the <code>input[type=file]</code> out of sight.  First, let's set up the general page styles: <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">body</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">padding</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">display</span></span>: flex; <span class="hljs-attribute"><span class="hljs-attribute">justify-content</span></span>: center; <span class="hljs-attribute"><span class="hljs-attribute">align-items</span></span>: center; <span class="hljs-attribute"><span class="hljs-attribute">min-height</span></span>: <span class="hljs-number"><span class="hljs-number">100vh</span></span>; } <span class="hljs-selector-id"><span class="hljs-selector-id">#upload-container</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">display</span></span>: flex; <span class="hljs-attribute"><span class="hljs-attribute">justify-content</span></span>: center; <span class="hljs-attribute"><span class="hljs-attribute">align-items</span></span>: center; <span class="hljs-attribute"><span class="hljs-attribute">flex-direction</span></span>: column; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">400px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-number"><span class="hljs-number">400px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">outline</span></span>: <span class="hljs-number"><span class="hljs-number">2px</span></span> dashed <span class="hljs-number"><span class="hljs-number">#5d5d5d</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">outline-offset</span></span>: -<span class="hljs-number"><span class="hljs-number">12px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">background-color</span></span>: <span class="hljs-number"><span class="hljs-number">#e0f2f7</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">font-family</span></span>: <span class="hljs-string"><span class="hljs-string">'Segoe UI'</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: <span class="hljs-number"><span class="hljs-number">#1f3c44</span></span>; } <span class="hljs-selector-id"><span class="hljs-selector-id">#upload-container</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">img</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">40%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin-bottom</span></span>: <span class="hljs-number"><span class="hljs-number">20px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">user-select</span></span>: none; }</code> </pre><br>  Now let's stylize our tag: <br><br><pre> <code class="css hljs"><span class="hljs-selector-id"><span class="hljs-selector-id">#upload-container</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">label</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-weight</span></span>: bold; } <span class="hljs-selector-id"><span class="hljs-selector-id">#upload-container</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">label</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:hover</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">cursor</span></span>: pointer; <span class="hljs-attribute"><span class="hljs-attribute">text-decoration</span></span>: underline; }</code> </pre><br>  What we are striving for ( <code>input[type=file]</code> removed from markup): <br><img src="https://habrastorage.org/webt/uq/oy/nn/uqoynnkiqozkclwaalgqsxakrys.png"><br>  Of course, it was possible to center the label, add a background and border, having received a full button, but our priority is Drag-and-Drop. <br><br><h2>  Hide input </h2><br>  Now we need to hide the <code>input[type=file]</code> .  The first thing that catches your head is the <code>display: none</code> and <code>visibility: hidden</code> properties.  But it is not so simple.  On some older browsers, clicking on the tag will stop producing any effect.  But that's not all.  As you know, invisible elements can not get the focus, and no matter what they say, the focus is important, because for some people this is the only way to interact with the site.  So this method does not suit us.  Let's take a detour: <br><br><pre> <code class="css hljs"><span class="hljs-selector-id"><span class="hljs-selector-id">#upload-container</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">position</span></span>: relative; <span class="hljs-attribute"><span class="hljs-attribute">z-index</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span>; } <span class="hljs-selector-id"><span class="hljs-selector-id">#upload-container</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">input</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[type=file]</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">0.1px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-number"><span class="hljs-number">0.1px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">opacity</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">position</span></span>: absolute; <span class="hljs-attribute"><span class="hljs-attribute">z-index</span></span>: -<span class="hljs-number"><span class="hljs-number">10</span></span>; }</code> </pre><br>  Let us position our <code>input[type=file]</code> relative to its parent unit, reduce it to <code>0.1px</code> , make it transparent and set its <code>z-index</code> less than that of the parent, so that, so to speak, for sure. <br><br>  Congratulations, we achieved what we wanted: our field looks exactly like in the previous picture. <br><br><h2>  Adjust the focus </h2><br>  Since our <code>input[type=file]</code> physically present on the page, it has the ability to receive focus.  That is, if we press the <code>Tab</code> key on the page, then at some point the focus will shift to <code>input[type=file]</code> .  But the problem is that we will not see it: there will be a field that we have hidden.  Yes, if at this moment we press <code>Enter</code> , then the dialog box will open and everything will work as it should, but how do we understand that it is time to press? <br><br>  Our task is to select the label in a certain way at the moment when the focus is located on the file upload field.  But how can we do this if the label cannot receive the focus?  CSS3 connoisseurs will immediately think about the pseudo-class <code>:focus</code> , which defines styles for elements in focus, and selectors <code>+</code> or <code>~</code> , which choose right neighbors: elements located at the same level of nesting after the selected element.  If we consider that in our markup, <code>input[type=file]</code> is located right in front of the <code>label</code> tag, the following entry takes place: <br><br><pre> <code class="css hljs"><span class="hljs-selector-id"><span class="hljs-selector-id">#upload-container</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">input</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[type=file]</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:focus</span></span> + <span class="hljs-selector-tag"><span class="hljs-selector-tag">label</span></span> { <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> }</code> </pre><br>  But again, not so simple.  First, let's discuss how we should highlight the label.  As you know, all modern and not very browsers have unique default properties for elements in focus.  Basically, this is the <code>outline</code> property, which creates a stroke around the element that differs from the <code>border</code> in that it does not change the size of the element and can be moved away from it.  As a rule, people use only one browser, so they get used to its standards.  To make it easier for people to navigate on our site, we must try to adjust the focus so that it looks as natural as possible for most popular modern browsers.  In theory, using JavaScript, you can get information about the browser through which the user opened the site, and adjust the styles accordingly, but this article is too complex and cumbersome as part of an article intended primarily for beginners.  We will try to do a little blood. <br><br>  In browsers based on the WebKet engine (Google Chrome, Opera, Safari), the default property for the elements in focus is: <br><br><pre> <code class="css hljs"><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:focus</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">outline</span></span>: -webkit-focus-ring-color auto <span class="hljs-number"><span class="hljs-number">5px</span></span>; }</code> </pre><br>  Here, <code>-webkit-focus-ring-color</code> is a focal stroke <code>-webkit-focus-ring-color</code> specific only for this engine.  That is, this line will work exclusively in WebKit-browsers, and this is exactly what we need.  We indicate this property for our label: <br><br><pre> <code class="css hljs"><span class="hljs-selector-id"><span class="hljs-selector-id">#upload-container</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">input</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[type=file]</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:focus</span></span> + <span class="hljs-selector-tag"><span class="hljs-selector-tag">label</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">outline</span></span>: -webkit-focus-ring-color auto <span class="hljs-number"><span class="hljs-number">5px</span></span>; }</code> </pre><br>  We open Google Chrome or Opera, we look.  Everything works as it should: <br><img src="https://habrastorage.org/webt/se/ay/mq/seaymqj0icne6yzqwcpnn8x1ock.png"><br>  Let's see how things are with the focus in Mozilla Firefox and Microsoft Edge.  For these browsers, the default property is: <br><br><pre> <code class="css hljs"><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:focus</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">outline</span></span>: <span class="hljs-number"><span class="hljs-number">1px</span></span> solid <span class="hljs-number"><span class="hljs-number">#0078d7</span></span>; }</code> </pre><br>  and <br><br><pre> <code class="css hljs"><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:focus</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">outline</span></span>: <span class="hljs-number"><span class="hljs-number">1px</span></span> solid <span class="hljs-number"><span class="hljs-number">#212121</span></span>; }</code> </pre><br>  respectively. <br><br>  Unfortunately, the <code>-moz-</code> prefix with the <code>outline</code> property will not work.  Therefore, we have to choose which of these two properties we choose.  Since the number of Firefox users is much higher, it is more rational to give preference to this particular browser.  This does not mean that we are depriving Edge users and other browsers of the opportunity to see where the focus is now, it‚Äôs just that they will look like ‚Äúnon-native‚Äù.  Well, you have to make sacrifices. <br><br>  Add a style from Mozilla Firefox before the style for WebKit: first, all browsers use the first property, and then those that can (Google Chrome, Opera, Safari, etc.), apply the second. <br><br><pre> <code class="css hljs"><span class="hljs-selector-id"><span class="hljs-selector-id">#upload-container</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">input</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[type=file]</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:focus</span></span> + <span class="hljs-selector-tag"><span class="hljs-selector-tag">label</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">outline</span></span>: <span class="hljs-number"><span class="hljs-number">1px</span></span> solid <span class="hljs-number"><span class="hljs-number">#0078d7</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">outline</span></span>: -webkit-focus-ring-color auto <span class="hljs-number"><span class="hljs-number">5px</span></span>; }</code> </pre><br>  And here the strange begins: in Edge everything works fine, but Firefox, for some unknown reason, refuses to apply properties to the label while focusing on <code>input[type=file]</code> .  And the <code>focus</code> event itself happens - checked through JavaScript.  Moreover, if we forcefully set the focus on the file selection field through the developer tools, the property will be applied and our stroke will appear!  Apparently, this is a bug of the browser itself, but if someone has an idea why this happens, write in the comments. <br><br>  Well, nothing, normal characters always go around.  As I said earlier, the <code>focus</code> event happens, which means we can adjust the properties directly from JavaScript.  But for this we will have to change the logic of our selector: <br><br><pre> <code class="css hljs"><span class="hljs-selector-id"><span class="hljs-selector-id">#upload-container</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">label</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.focus</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">outline</span></span>: <span class="hljs-number"><span class="hljs-number">1px</span></span> solid <span class="hljs-number"><span class="hljs-number">#0078d7</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">outline</span></span>: -webkit-focus-ring-color auto <span class="hljs-number"><span class="hljs-number">5px</span></span>; }</code> </pre><br>  We will describe the class <code>.focus</code> for our label and we will add it every time when <code>input[type=file]</code> gets the focus and remove when it loses. <br><br><pre> <code class="javascript hljs">$(<span class="hljs-string"><span class="hljs-string">'#file-input'</span></span>).focus(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'label'</span></span>).addClass(<span class="hljs-string"><span class="hljs-string">'focus'</span></span>); }) .focusout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'label'</span></span>).removeClass(<span class="hljs-string"><span class="hljs-string">'focus'</span></span>); });</code> </pre><br>  Now everything works as it should.  Congratulations, with the focus, we figured out. <br><br><h2>  Drag-and-drop </h2><br>  Work with Drag-and-Drop is carried out by tracking special browser events: <code>drag, dragstart, dragend, dragover, dragenter, dragleave, drop</code> .  A detailed description of each of them you can easily find on the Internet.  We will track only some of them. <br><br>  First, let's define the Drag-and-Drop-element: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dropZone = $(<span class="hljs-string"><span class="hljs-string">'#upload-container'</span></span>);</code> </pre><br>  Then we will describe in CSS a special class that we will assign to the <code>dropZone</code> when the cursor that pulls the file is directly above it.  This is necessary to visually inform the user that the file can already be released. <br><br><pre> <code class="css hljs"><span class="hljs-selector-id"><span class="hljs-selector-id">#upload-container</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.dragover</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">background-color</span></span>: <span class="hljs-number"><span class="hljs-number">#fafafa</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">outline-offset</span></span>: -<span class="hljs-number"><span class="hljs-number">17px</span></span>; }</code> </pre><br>  Now let's go to the js file.  First, we need to undo all default actions on drag-and-drop events.  For example, one of these events is the opening of a thrown file by the browser.  We do not need this at all, so we will write the following lines: <br><br><pre> <code class="javascript hljs">dropZone.on(<span class="hljs-string"><span class="hljs-string">'drag dragstart dragend dragover dragenter dragleave drop'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; });</code> </pre><br>  In jQuery, calling the <code>return false</code> equivalent to calling two functions at once: <code>e.preventDefault()</code> and <code>e.stopPropagation()</code> . <br><br>  Let's start describing our own event handler.  Let's do the same thing as we did with the focus, but this time we‚Äôll track the <code>dragenter</code> and <code>dragover</code> to add a class and the <code>dragleave</code> event to remove it: <br><br><pre> <code class="javascript hljs">dropZone.on(<span class="hljs-string"><span class="hljs-string">'dragover dragenter'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ dropZone.addClass(<span class="hljs-string"><span class="hljs-string">'dragover'</span></span>); }); dropZone.on(<span class="hljs-string"><span class="hljs-string">'dragleave'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ dropZone.removeClass(<span class="hljs-string"><span class="hljs-string">'dragover'</span></span>); });</code> </pre><br>  And again an unpleasant surprise awaits us: when moving along the <code>dropZone</code> with the mouse with the file, the field starts to flicker.  It happens in Microsoft Edge and WebKit-browsers.  By the way, most of these WebKit browsers currently run on the Blink engine (appreciated the irony, huh?).  But in Mozilla nothing flickers.  Apparently, I decided to correct after the bugs with the focus. <br><br>  And this flicker occurs due to the fact that when you hover over a <code>dropZone</code> child element, be it a picture or a <code>div</code> with a file selection field and a label, for some reason, the <code>dragleave</code> event is <code>dragleave</code> .  It is obvious to us that we are not leaving the field, but for some reason, there is no browsers, and because of this, they <code>.focus</code> the <code>dropZone</code> class from <code>dropZone</code> . <br><br>  And again we have to somehow get out.  If the browser itself does not understand that we are not leaving the field, we will have to help him.  And we will do this through additional conditions: we will calculate the coordinates of the mouse relative to the <code>dropZone</code> , and then we will check if the cursor is outside the block.  If left, then remove the style: <br><br><pre> <code class="javascript hljs">dropZone.on(<span class="hljs-string"><span class="hljs-string">'dragleave'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> dx = e.pageX - dropZone.offset().left; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> dy = e.pageY - dropZone.offset().top; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((dx &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) || (dx &gt; dropZone.width()) || (dy &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) || (dy &gt; dropZone.height())) { dropZone.removeClass(<span class="hljs-string"><span class="hljs-string">'dragover'</span></span>); }; });</code> </pre><br>  And everything, the problem is solved!  This is how our field with the file inside looks like: <br><img src="https://habrastorage.org/webt/sz/6t/8j/sz6t8jyctde70wiimiz9zwijmi0.png"><br><br>  We proceed to the processing of the <code>drop</code> event itself.  But first, remember that, in addition to Drag-and-Drop, we have <code>input[type=file]</code> , and each of these methods is independent in its essence, but must perform the same actions: upload files.  Therefore, I propose to create a separate function, universal for both methods, to which we will transfer files, and it will already decide what to do with them.  Let's call it <code>sendFiles()</code> , but we <code>sendFiles()</code> describe it a bit later.  First, let's handle the <code>drop</code> event: <br><br><pre> <code class="javascript hljs">dropZone.on(<span class="hljs-string"><span class="hljs-string">'drop'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ dropZone.removeClass(<span class="hljs-string"><span class="hljs-string">'dragover'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> files = e.originalEvent.dataTransfer.files; sendFiles(files); });</code> </pre><br>  First, remove the <code>.dragover</code> class from the <code>dropZone</code> .  Then we get an array containing the files.  If you use jQuery, then the path will be <code>e.originalEvent.dataTransfer.files</code> , if you write in pure JS, then <code>e.dataTransfer.files</code> .  Well, then we pass the array to our as yet unimplemented function. <br><br>  Now let's work through the loading method via <code>input[type=file]</code> : <br><br><pre> <code class="javascript hljs">$(<span class="hljs-string"><span class="hljs-string">'#file-input'</span></span>).change(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> files = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.files; sendFiles(files); });</code> </pre><br>  We follow the <code>change</code> event on the file selection button, get an array through <code>this.files</code> and send it to the function. <br><br><h2>  Sending files via AJAX </h2><br>  The last stage - the description of the file processing function - is unique for everyone.  It will directly depend on the goal you are pursuing.  For example, I'll show you how to send files to the server via AJAX. <br><br>  Suppose we create a field for uploading photos.  We don‚Äôt want something else to come to our server, so we‚Äôll define the file types: let it be PNG and JPEG.  It is also worth regulating the maximum size of a single photo that a user can send.  We restrict ourselves to five megabytes.  We begin to describe our function: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendFiles</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">files</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> maxFileSize = <span class="hljs-number"><span class="hljs-number">5242880</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Data = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FormData(); $(files).each(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">index, file</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((file.size &lt;= maxFileSize) &amp;&amp; ((file.type == <span class="hljs-string"><span class="hljs-string">'image/png'</span></span>) || (file.type == <span class="hljs-string"><span class="hljs-string">'image/jpeg'</span></span>))) { Data.append(<span class="hljs-string"><span class="hljs-string">'images[]'</span></span>, file); } }); };</code> </pre><br>  In the <code>maxFileSize</code> variable, we <code>maxFileSize</code> maximum file size that we will send to the server.  <code>FormData()</code> function, we will create a new object of the <code>FormData</code> class, allowing us to form sets of key-value pairs.  Such an object can be easily sent via AJAX.  Next, we use the jQuery <code>.each</code> construction for the <code>files</code> array, which will apply the function we set for each of its elements.  As arguments, the function will be the sequence number of the element and the element itself, which we will process as <code>index</code> and <code>file</code> respectively.  In the function itself, we check the file for compliance with our criteria: the size is less than five megabytes, and the type is PNG or JPEG.  If the file passes the check, then add it to our <code>FormData</code> object by calling the <code>append()</code> function.  The key is the string <code>'photos[]'</code> , the square brackets at the end of which denote that it is an array in which there can be several objects.  The object itself will be <code>file</code> . <br><br>  Now everything is ready to send files via AJAX.  Add the following lines to our function: <br><br><pre> <code class="javascript hljs">$.ajax({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: dropZone.attr(<span class="hljs-string"><span class="hljs-string">'action'</span></span>), <span class="hljs-attr"><span class="hljs-attr">type</span></span>: dropZone.attr(<span class="hljs-string"><span class="hljs-string">'method'</span></span>), <span class="hljs-attr"><span class="hljs-attr">data</span></span>: Data, <span class="hljs-attr"><span class="hljs-attr">contentType</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">processData</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ alert(<span class="hljs-string"><span class="hljs-string">'   '</span></span>); } });</code> </pre><br>  As the <code>url</code> and <code>type</code> parameters, we specify the values ‚Äã‚Äãof the <code>action</code> and <code>method</code> attributes for <code>input[type=file]</code> respectively.  We will transmit the <code>Data</code> object via AJAX.  Parameters <code>contentType: false</code> and <code>processData: false</code> are needed so that the browser does not accidentally transfer our files to some other format.  In the <code>success</code> parameter we indicate the function that will be executed if the files are successfully transferred to the server.  Its content depends on your imagination, but I will confine myself to the modest output of a message about a successful download. <br><br>  Congratulations, now you can create your own file upload field!  Of course, I do not position my method as the only correct and correct one.  I set my task to show the general course of solving this problem, suitable primarily for beginners.  If you think that somewhere something could have been done better - write in the comments, discuss! <br><br>  That's all.  Thanks for attention! <br><br>  Download: <br><br><ol><li>  <a href="https://yadi.sk/d/A3oE3GWjVLYmww">Final version</a> </li><li>  <a href="https://yadi.sk/d/nc8KSvotrnsX5w">Problem with focus</a> </li><li>  <a href="https://yadi.sk/d/9Aa7EZKYbXL6Jg">Flicker problem</a> </li></ol><br>  Feel for: <br><br><ol><li>  <a href="https://jsfiddle.net/RadicalChild/aomjq7Ls/">Final version</a> </li><li>  <a href="https://jsfiddle.net/RadicalChild/s5vjk8qL/">Problem with focus</a> </li><li>  <a href="https://jsfiddle.net/RadicalChild/6svgne2f/">Flicker problem</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/423035/">https://habr.com/ru/post/423035/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../423025/index.html">How cash register program will help to save on analytics?</a></li>
<li><a href="../423027/index.html">FTDI-POF optical transceiver</a></li>
<li><a href="../423029/index.html">Rome Club Report 2018, Chapter 3.2: Development Alternatives</a></li>
<li><a href="../423031/index.html">The right holders of the Russian Federation want to tighten anti-piracy laws after claims against Yandex</a></li>
<li><a href="../423033/index.html">On CRM slander too much: we deal with gossip</a></li>
<li><a href="../423039/index.html">We do web-authentication via blockchain</a></li>
<li><a href="../423041/index.html">The fancy story of the Super NES CD-ROM</a></li>
<li><a href="../423043/index.html">Due to the vulnerability in the Tesla electric vehicle protection system, you can hijack a car in a few seconds</a></li>
<li><a href="../423045/index.html">Which 3D printer to choose? Video Review from 3Dtool</a></li>
<li><a href="../423047/index.html">We reserve IT systems for reasonable money</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>