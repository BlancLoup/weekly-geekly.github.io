<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Zero Downtime Upgrade for an application in Microsoft Azure. Part 1: PaaS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The life cycle of any application implies its support. These can be any patches, hot fixes, new versions, etc. In the case of the desktop application,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Zero Downtime Upgrade for an application in Microsoft Azure. Part 1: PaaS</h1><div class="post__text post__text-html js-mediator-article">  The life cycle of any application implies its support.  These can be any patches, hot fixes, new versions, etc.  In the case of the desktop application, everything is quite clear and familiar.  However, let's see how the update mechanism of your application happens if it is hosted in the cloud.  In our case, we will be talking about the Microsoft Azure cloud. <br><br>  So, Microsoft Azure provides enough broad tools to automatically update your application, and usually the application is currently used by other people, so the most important issue is the update "on the fly", that is, invisible to the user.  Let's look at all the possible ways that it is possible to apply for a Microsoft Azure application. <br><br><a name="habracut"></a><br><h5>  Web deploy </h5><br>  This update mechanism is more applicable only in the testing and development process.  As we know, Microsoft Azure supports two application deployment mechanisms: PaaS and IaaS.  The Web Deploy option runs within PaaS.  In general terms, the mechanism for publishing an application from Visual Studio is as follows: <br><ul><li>  Build the application with all dependencies </li><li>  Archiving </li><li>  Download to Azure Storage </li><li>  Deploy a virtual machine from an image </li><li>  Copy archive from Azure Storage to virtual machine disk </li><li>  Archive unpacking </li><li>  IIS Setup </li></ul><br>  Suppose the guys from the development team are now actively introducing new features, some of which can already be tested by testers.  The full deployment process takes a lot of time, so due to some minor changes it is expensive to start it every time.  In this case, you can use the mechanism WebDeploy.  The scheme is presented below: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/480/bb6/fb4/480bb6fb4baf6a6ece1473518207bd11.png"><br><br>  The mechanism works as follows.  Suppose that we already have a virtual machine that is running version 1.0 of our application.  We need to update it to 1.0.1, in which fairly small changes have been made, so the delta changes (archive size) is small.  Web Deploy in this case collects the project (of course), archives only the changed files, uploads the archive with the changes to Azure Storage.  After that, using the RDP protocol (a mandatory requirement for the virtual machine), the archive with the changes is copied to the <b>running</b> virtual machine.  The archive is unpacked and the changed files are replaced in the IIS directory.  Then IIS restarts. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/343/634/d61/343634d61ea6aa8a48fe4bbb747979ba.png"><br><br>  Let's now look at the pros and cons of this approach. <br>  Pros: <br><ul><li>  Reduces the time to deploy a new version of the application </li><li>  Small size changes </li><li>  Publish directly from Visual Studio </li></ul><br>  Minuses: <br><ul><li>  If the machine is recreated (recycling), then the changes made during the Web Deploy process will not get into the original archive (package, .cspkg) </li><li>  Only web roles (Web Roles) are supported.  Worker Roles are not supported. </li><li>  RDP connection with the virtual machine - a prerequisite </li><li>  Only one virtual machine is supported within one cloud service (Cloud Service) </li><li>  The method is applicable only within PaaS deployment </li></ul><br>  As we can see, this method can hardly be regarded as production, but it also has its advantages, therefore it has the right to life. <br><br><h5>  VIP Swap </h5><br>  We continue to consider options for updating the application as part of a PaaS deployment.  Unlike the previous version, the following approach is quite applicable and is used in the production environment. <br><br>  Suppose that our customer uses our application version 1.0 at (contoso.cloudapp.net).  Our task is to update the application version to 1.1 imperceptibly for the user. <br><br>  Microsoft Azure offers a convenient concept of slots in cloud services.  When we publish our application to the cloud through Visual Studio, we are always asked in which slot we want to publish our application: Staging or Production. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/96f/13d/503/96f13d5037e267a6660e0a69f502e2df.png"><br><br>  Accordingly, the only difference between these slots is that the production slot has a DNS associated with a specific name (in our test, test-app-1.cloudapp.net), and Staging has a name like GUID.cloudapp.net.  Thus, you can simultaneously hold multiple versions of the same application in the same cloud service.  As I mentioned above, the customer uses the production slot, and we can use Staging, for example, to conduct tests or prepare the environment for release. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/01b/a87/4dc/01ba874dcc3a25b6aeb5a4cc6cad6df2.png"><br><br>  When creating a cloud service, Azure Internal Load Balancer creates a table of IP addresses associated with a specific DNS name.  The idea of ‚Äã‚ÄãVIP Swap is very simple - it is the replacement of the IP addresses of the machines associated with the Staging slot with the IP addresses of the machines attached to the Production slot.  The update operation of the internal table of IP addresses of the load balancer Azure takes a matter of seconds.  Thus, from the user's point of view, updating the application to the new version happens instantly. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4ec/1ad/e1e/4ec1ade1ea2183654a2d9a59ba392298.png"><br><br>  Let's now look at the pros and cons of this approach. <br>  Pros: <br><ul><li>  Changing IP addresses in the load balancer table takes seconds </li><li>  Test and production environments are isolated from each other. </li><li>  If necessary, there is an opportunity to "return everything back" (Swap in the opposite direction) </li><li>  Support for both Web roles and Worker </li><li>  Deploy directly from Visual Studio </li></ul><br>  Minuses: <br><ul><li>  The configuration of virtual machines in the Staging and Production slots must be the same. </li><li>  No support for virtual machines deployed within IaaS </li><li>  Additional costs for virtual machines deployed in a parallel slot </li></ul><br><br>  Analysis of this update method shows that it is quite suitable for use in the production environment.  When using PaaS approach to deploying an application, it is one of the most optimal. <br><br>  Today, this is all that I wanted to tell you.  <a href="http://habrahabr.ru/company/epam_systems/blog/226763/">Next time</a> we will see what tools Microsoft Azure can use to update the application deployed as part of IaaS.  Do not switch! </div><p>Source: <a href="https://habr.com/ru/post/226093/">https://habr.com/ru/post/226093/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../226073/index.html">The Machine. New HP Computer Architecture</a></li>
<li><a href="../226079/index.html">What is it - advertising startup budget?</a></li>
<li><a href="../226081/index.html">Custom Windows Live Mail Begins</a></li>
<li><a href="../226089/index.html">un1c0rn, "Google for vulnerabilities"</a></li>
<li><a href="../226091/index.html">The four-color theorem is associated with the magnetic properties of crystals.</a></li>
<li><a href="../226099/index.html">Switch to Sketch. Part 2</a></li>
<li><a href="../226101/index.html">Samsung HackDay # 31 Report and Samsung DevConf14 Announcement</a></li>
<li><a href="../226105/index.html">25-dollar smartphones with Firefox OS will appear already this year</a></li>
<li><a href="../226107/index.html">HTML5 mobile application: error or success. Attempt # 1</a></li>
<li><a href="../226109/index.html">Firefox 30 release</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>