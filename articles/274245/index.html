<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>GlassRAT: Trojan analysis from China using RSA Security Analytics and RSA ECAT</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="RSA Research specialists discovered a GlassRAT Trojan program for Remote Administration (RAT) with a ‚Äúzero detection level‚Äù, signed with a certificate...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>GlassRAT: Trojan analysis from China using RSA Security Analytics and RSA ECAT</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/d6d/f6d/b89/d6df6db8931a47d187f271d120539fe9.jpg"><br><br>  RSA Research specialists discovered a GlassRAT Trojan program for Remote Administration (RAT) with a ‚Äúzero detection level‚Äù, signed with a certificate that was stolen or received from a popular Chinese software developer.  This malware could have avoided detection for several years.  Telemetry and limited reports that do not withstand any criticism indicate that the purpose of GlassRAT were Chinese citizens associated with transnational corporations.  Being completely ‚Äútransparent‚Äù to most anti-virus products, the GlassRAT Trojan can be detected using detailed examination, as well as using the final threat detection tools, such as RSA Security Analytics and / or RSA ECAT.  It also presents evidence that the method of organizing the team infrastructure of the GlassRAT network has much in common with other malicious campaigns that were previously aimed at Asian organizations of geopolitical and strategic importance.  More information about this information can be found here: <a href="http://blogs.rsa.com/peering-into-glassrat/">http://blogs.rsa.com/peering-into-glassrat/</a> . <br><a name="habracut"></a><br><h3>  What is actually GlassRAT? </h3><br>  GlassRAT is a remote access trojan (RAT).  Apparently, he remained unnoticed for almost 3 years.  GlassRAT uses many features and boasts in its own way a very effective, malicious design.  His dropper was signed with the help of a compromised certificate from a trusted and well-known publisher (the Certification Center, which issued this certificate, after an independent examination confirming the malicious intent of the code signed by it, subsequently revoked it).  Dropper removes himself after successfully completing his tasks.  Once installed, the malicious .dll file, so to say, ‚Äúflies below the radar detection level‚Äù of the antivirus, provides an attacker with access to the shell-code of the infected victim. <br><br>  GlassRat first caught the attention of RSA Research in February 2015, when the RSA Incident Respons team, specializing in proactively preventing threats of intrusion into large corporate networks, detected malicious traffic while investigating an incident in a multinational corporation based in the United States.  The sample DLL was detected using RSA ECAT on a Chinese citizen's PC residing in mainland China. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Usually, the organizers of the attack simply replace such low-level tools as the RAT, immediately after detection, without changing tactics, procedures, infrastructure, or even the attack targets themselves.  However, in this case, the facts suggest otherwise.  The objectives of the attack differed both in quantity (there were much more) and in characteristics (geopolitical, instead of traditional commercial ones). <br><br>  RSA Research looked for possible similarities with other malicious programs and methods described earlier.  Some similarity of the code with other malicious programs, such as Taidoor, was found ( <a href="http://www.trendmicro.com/cloud-content/us/pdfs/security-intelligence/white-papers/wp_the_taidoor_campaign.pdf">http://www.trendmicro.com/cloud-content/us/pdfs/security-intelligence/white-papers/papers/wp_the_taidoor_campaign.pdf</a> ) <br>  and Taleret ( <a href="https://www.fireeye.com/blog/threat-research/2013/09/evasive-tactics-taidoor-3.html">https://www.fireeye.com/blog/threat-research/2013/09/evasive-tactics-taidoor-3.html</a> ), but the most interesting coincidence was found in the infrastructure management system used in attacks on the organization of geopolitical values ‚Äã‚Äã(about this below), which were recorded several years ago. <br><br><h3>  GlassRAT Analysis with RSA Security Analytics and RSA ECAT </h3><br><br><h4>  GlassRAT Infection Scheme </h4><br><img src="https://habrastorage.org/files/49c/ebe/46c/49cebe46c1504838bca8427f19489a12.png"><br><br>  By starting an investigation of the attack after dropping and infecting, ECAT automatically increases the danger level for the machine and the corresponding module from zero to one of the maximum values ‚Äã‚Äãin the analysis queue. <br><br><img src="https://habrastorage.org/files/1f2/6df/e5c/1f26dfe5c9e1464b88b24b39e6d0429f.png"><br><br>  Let's analyze the rest of the ECAT information.  We have access to statistics about current memory contents, data stored on the disk, anomalies, and network traffic.  All this allows the analyst to instantly turn his attention to any of the suspicious entities during the investigation of the incident. <br><br><img src="https://habrastorage.org/files/f6f/692/5db/f6f6925db31744178c3d853783b7a7c8.png"><br><br><h4>  Dropper GlassRAT </h4><br>  There were two samples of the GlassRAT malware installer, known as ‚Äúdroppers‚Äù.  According to the results of the analysis presented on the VirusTotal website, 57 different antiviruses were not able to detect both of these droppers during normal testing. <br><br><img src="https://habrastorage.org/files/d77/afb/83a/d77afb83ab7a45559712b6f930bc0880.png"><br><br>  Both samples of the GlassRAT dropper were almost <b>identical in their functions and code</b> .  The first sample was uploaded to VirusTotal about four hours before the second. <br><br>  GlassR droppers used the proprietary Adobe Flash Player icon and were called ‚Äúflash.exe‚Äù when they were first downloaded to VirusTotal on September 17, 2015. <br><br><img src="https://habrastorage.org/files/85c/ff2/186/85cff2186afa464eb4921c18f43b9573.png"><br><br>  Double clicking on the Trojan causes the launch of the dropper.  Once ECAT found it to be a potentially malicious file, it was automatically uploaded to ECAT ConsoleServer for further investigation.  Through ECAT Modules view, we see the following: <br><br>  ECAT detects a dropper and increases the danger level of InstantIOC (Indicator of Compromise Score), given the code signature with a revoked certificate. <br><br><img src="https://habrastorage.org/files/702/193/e67/702193e676364ad2a4d6ecabe5281f44.png"><br><br>  In addition, ECAT uses the session tracking module to identify and establish links to other potentially suspicious files or machines in your environment that have established connections and performed other suspicious actions: <br><br><ul><li> <code>SVCHOST.exe</code> launches <code>flash.exe</code> </li><li>  <code>flash.exe</code> launches the ‚ÄúWrite to Exectuable‚Äù event for updatef.dll </li></ul><br><img src="https://habrastorage.org/files/f68/c1b/b26/f68c1bb26c9a421c8555f4f73102da9b.png"><br><br>  During the installation of the Trojan, the dropper self-destructs using the built-in command: <br><br> <code>‚Äúcmd.exe /c erase /F "%s",‚Äù</code> <br> <br>  After detecting a new malicious <code>updatef.dll</code> file, we began to analyze it.  As can be seen from the list of files sorted by ECAT Risk Score, the dropper has two different processes used when installing in user and privileged modes: <br><br><img src="https://habrastorage.org/files/7d6/6d3/0df/7d66d30df1424a7d9724390a6774558c.png"><br><br>  These two different DLL files were immediately marked as suspicious and uploaded to the server after being detected by the ECAT agent, and received a risk rating of 1024 points each. <br><br><h4>  The mechanism of unprivileged persistence GlassRAT </h4><br> <code>HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run <br> Image path: c:\programdata\updatef.dll</code> <br> <br>  Note: the DLL file is actually written to the root of <code>C:\ProgramData</code> , but due to the <code>C:\ProgramData</code> to Windows Vista and later versions of Windows, the path <code>C:\ProgramData\Application Data\</code> will be displayed in the Autoruns registry key. <br><br>  This is how the GlassRAT unprivileged persistence looks when viewed through the Autoruns tool: <br><br><img src="https://habrastorage.org/files/60d/983/8da/60d9838da87a4475879de37dfc483cab.png"><br><br>  When you manually start UAC, by clicking the right mouse button, the metadata associated with the dropper is displayed: <br><br><img src="https://habrastorage.org/files/031/b6a/16d/031b6a16d47e4f89a62339ebb157c641.png"><br><br>  Note: The program name specified in the User Account Control (UAC) dialog box is the same as the name of this application ‚Äú500 million-user‚Äù developed by the certificate holder. <br><br><h4>  GlassRAT Preferred Persistence Mechanism </h4><br>  The persistence of the GlassRAT Trojan is ensured by the installation of ‚ÄúRemote Access Manager‚Äù as a service, which is usually disabled by default in Windows. <br><br> <code>HKLM\System\CurrentControlSet\Services <br> RasAuto image path: c:\programdata\application data\updatef.dll</code> <br> <br>  The GlassRAT persistence mechanism when installed with administrator privileges: <br><br><img src="https://habrastorage.org/files/953/3e1/2ce/9533e12ce01c484487ff9638fe731c40.png"><br><br>  Using ECAT module investigation, you can instantly determine <code>updatef.dll</code> as an autoloader, assign the appropriate level of risk, and detect the file and registry entry: <br><br><img src="https://habrastorage.org/files/1bb/8d5/c8f/1bb8d5c8fd44403dbd19b1d1a03c8e58.png"><br><br>  <code>updatef.dll</code> malicious file in <code>updatef.dll</code> , we decided to study its characteristics better: what it is, what it does, what its distinctive features, etc.  To do this, use the module InstantIOC (IIOCs). <br><br><img src="https://habrastorage.org/files/a89/4cc/500/a894cc500e7046019d629f54b1ee22a7.png"><br><br>  YARA is a tool to help researchers identify and classify malicious samples.  The YARA IIOC infection message was initiated by a separate YARA rule created for GlassRAT, which is indicated under the module properties. <br><br><img src="https://habrastorage.org/files/5fe/08b/f02/5fe08bf02ac94066ad0671d88555c861.png"><br><br>  After the dropper and the associated DLL files were identified and executed, we assumed that the Trojan was loaded using <code>svchost.exe</code> as a RasAuto service, and when installed in the unprivileged mode, <code>rundll32.exe</code> runs <code>updatef.dll</code> . <br><br>  Through monitoring ECAT network traffic, we identified suspicious connections to qx.rausers.com through ports 53, 80, and 443. In this case, ECAT was able to determine that it was a <code>rundll32.exe</code> module that was alerting (and not just establishing communication with <code>svchost.exe</code> ). <br><br><img src="https://habrastorage.org/files/f49/49b/307/f4949b30761b4918af809887c4176a3d.png"><br><br>  In addition, ECAT IIOC flagged <code>rundll32.exe</code> , reporting potential signaling, suspicious network access, and actual DNS traffic from this process. <br><br><img src="https://habrastorage.org/files/05f/aad/c7d/05faadc7d2ba4ba68d8f8ba7204ea0d1.png"><br><br><h3>  Network Analysis of the GlassRAT Command Center with ECAT Security Analytics </h3><br>  The management structures of GlassRAT were somewhat similar to the command centers that were discovered in 2012 in other malicious campaigns aimed at governments and military organizations in the Pacific.  In addition, a static analysis of several GlassRAT DLL files revealed that the command center host configuration was confusing in all detected patterns. <br><br> <code>003/064/50/60 : 112.175.xx</code> <br> <code>chur/gnsxntrdd/odu : bits.foryousee.net</code> <br> <code>012/31/084/353 : 103.20.xx</code> <br> <code>py/s`trdsr/bnl : qx.rausers.com</code> <br> <code>ly/s`trdsr/bnl : mx.rausers.com</code> <br> <code>yy/s`trdsr/bnl : xx.rausers.com</code> <br> <br>  A handshake between the attacker and the victim was discovered using Security Analytics and the new separate Glass RAT Trojan parser parser, available out of the box via RSA Live.  When network traffic was <code>glass_rat_c2_handshale_beacon</code> , a new meta-value ‚ÄúRisk: Suspicious‚Äù was assigned to the <code>glass_rat_c2_handshale_beacon</code> parameter. <br><br>  Connections to the direct access socket, marked as ‚Äú <code>unknown service over http port</code> ‚Äù and ‚Äú <code>unknown service over ssl port</code> ‚Äù with the meta value ‚ÄúRisk: Informational‚Äù with meta value, also testify to the handshake. <br><br><img src="https://habrastorage.org/files/94a/817/164/94a817164853468aa3e2efb53538a83a.png"><br><br><img src="https://habrastorage.org/files/14f/e79/9bb/14fe799bb2bf4350954657101e8184da.png"><br><br>  RSA Security Analytics sent a hard-coded value of <code>0x cb ff 5d c9 ad 3f 5b a1 54 13 fe fb 05 c6 22</code> during the execution of the handshake between the infected node and the command server.  Definition of traffic and destination IP addresses (dst.ip): <br><br><img src="https://habrastorage.org/files/d38/627/674/d386276747104651aeeb00b52f355393.png"><br><br>  When interacting with the Windows command shell (but not in signaling), you can also use the following application rule: <br><br> <code>service = 0 &amp;&amp; tcp.dstport = 80 &amp;&amp; risk.warning = 'windows command shell'</code> <br> <br>  You can detect malicious activity thanks to console messages (risk.warning: 'windows command shell' using an unknown protocol (service = 0) and a popular port (tcp.dstport = 80)).  But here false positives are possible. </div><p>Source: <a href="https://habr.com/ru/post/274245/">https://habr.com/ru/post/274245/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../274233/index.html">Hackathon and the winter scientific school on deep learning and question-answer systems</a></li>
<li><a href="../274237/index.html">The work of an ‚ÄúIT astronaut‚Äù: how we engineers go on a visit to bears and seals</a></li>
<li><a href="../274239/index.html">Working with the database in Google App Engine / Google Cloud Endpoints in Java: Objectify framework</a></li>
<li><a href="../274241/index.html">Security Scanners: Automatic Vulnerability Classification</a></li>
<li><a href="../274247/index.html">Sociology of algorithms: How financial markets and high-frequency trading are connected (Part 1)</a></li>
<li><a href="../274249/index.html">Authorization in Ubuntu through Microsoft Azure AD / Office 365</a></li>
<li><a href="../274251/index.html">Build and configure FreeRADIUS 3 with SQLITE support</a></li>
<li><a href="../274253/index.html">Problems using Math.random ()</a></li>
<li><a href="../274255/index.html">Authorization in CentOS through Microsoft Azure AD / Office 365</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>