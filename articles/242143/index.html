<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing scripts for Mikrotik RouterOS is just</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="RouterOS is a Linux based network operating system. This operating system is designed for installation on hardware routers Mikrotik RouterBoard. Also,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing scripts for Mikrotik RouterOS is just</h1><div class="post__text post__text-html js-mediator-article">  RouterOS is a Linux based network operating system.  This operating system is designed for installation on hardware routers Mikrotik RouterBoard.  Also, this system can be installed on a PC (or virtual machine), turning it into a router.  Initially, quite rich in OS functionality, no, no, and it will surprise you with the absence of some necessary chip from the box.  Unfortunately, access to the Linux environment is very limited, therefore, ‚Äúthis is on Linux‚Äù is absolutely not equivalent to ‚Äúthis is in RouterOS‚Äù.  But do not despair!  This system provides several options for expanding its functionality.  The first - the most simple and native - is the ability to write scripts in the embedded language. <br>  In this article, as an example, we will consider a script that converts DNS names to lists of IP addresses (address lists). <br>  Why might he be needed?  Many sites use Round Robin DNS for load sharing (and some not only for this).  To control access to such a site (to create a routing rule or firewall), we will need all the IP addresses corresponding to this domain name.  Moreover, the list of IP addresses after the lifetime of this DNS record (in this case, this is an A-record) can be issued completely new, so the information will have to be periodically updated.  Unfortunately you cannot create a rule in RouterOS <blockquote>  block all TCP connections on port 80 at <b><u>example.com</u></b> </blockquote>  in place of <i>example.com there</i> should be an IP address, but as we already understood, <i>example.com</i> corresponds not to one, but several IP addresses.  To save us from the torment of creating and maintaining a heap of similar rules, the developers of RouterOS made it possible to create a rule like this: <blockquote>  block all TCP connections on port 80 to any address from the list with the name DenyThis </blockquote>  The case remains for the small - automatically generate this very list.  Who else did not get tired of my scribbling invite under Habrakat. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Immediately give the text of the script, followed by a step by step analysis</b> <div class="spoiler_text"><pre><code class="bash hljs">:<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> DNSList {<span class="hljs-string"><span class="hljs-string">"example.com"</span></span>;<span class="hljs-string"><span class="hljs-string">"non-exist.domain.net"</span></span>;<span class="hljs-string"><span class="hljs-string">"server.local"</span></span>;<span class="hljs-string"><span class="hljs-string">"hostname"</span></span>} :<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> ListName <span class="hljs-string"><span class="hljs-string">"MyList"</span></span> :<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> DNSServers ( [ip dns get dynamic-servers], [ip dns get servers ], 8.8.8.8 ) :foreach addr <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-variable"><span class="hljs-variable">$DNSList</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :foreach DNSServer <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-variable"><span class="hljs-variable">$DNSServers</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-keyword"><span class="hljs-keyword">do</span></span> {:resolve server=<span class="hljs-variable"><span class="hljs-variable">$DNSServer</span></span> <span class="hljs-variable"><span class="hljs-variable">$addr</span></span>} on-error={:<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> debug (<span class="hljs-string"><span class="hljs-string">"failed to resolve </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$addr</span></span></span><span class="hljs-string"> on </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$DNSServer</span></span></span><span class="hljs-string">"</span></span>)} } } /ip firewall address-list remove [find <span class="hljs-built_in"><span class="hljs-built_in">where</span></span> list~<span class="hljs-variable"><span class="hljs-variable">$ListName</span></span>] /ip dns cache all :foreach i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>=[find <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=<span class="hljs-string"><span class="hljs-string">"A"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> bNew <span class="hljs-literal"><span class="hljs-literal">true</span></span> :<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> cacheName [get <span class="hljs-variable"><span class="hljs-variable">$i</span></span> name] :<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> match <span class="hljs-literal"><span class="hljs-literal">false</span></span> :foreach addr <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>=<span class="hljs-variable"><span class="hljs-variable">$DNSList</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (:typeof [:find <span class="hljs-variable"><span class="hljs-variable">$cacheName</span></span> <span class="hljs-variable"><span class="hljs-variable">$addr</span></span>] &gt;= 0) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-variable"><span class="hljs-variable">$match</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> } } :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-variable"><span class="hljs-variable">$match</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> tmpAddress [/ip dns cache get <span class="hljs-variable"><span class="hljs-variable">$i</span></span> address] :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( [/ip firewall address-list find ] = <span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> debug (<span class="hljs-string"><span class="hljs-string">"added entry: $[/ip dns cache get </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$i</span></span></span><span class="hljs-string"> name] IP </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$tmpAddress</span></span></span><span class="hljs-string">"</span></span>) /ip firewall address-list add address=<span class="hljs-variable"><span class="hljs-variable">$tmpAddress</span></span> list=<span class="hljs-variable"><span class="hljs-variable">$ListName</span></span> comment=<span class="hljs-variable"><span class="hljs-variable">$cacheName</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>={ :foreach j <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>=[/ip firewall address-list find ] <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( [/ip firewall address-list get <span class="hljs-variable"><span class="hljs-variable">$j</span></span> address] = <span class="hljs-variable"><span class="hljs-variable">$tmpAddress</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> bNew <span class="hljs-literal"><span class="hljs-literal">false</span></span> } } :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-variable"><span class="hljs-variable">$bNew</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> debug (<span class="hljs-string"><span class="hljs-string">"added entry: $[/ip dns cache get </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$i</span></span></span><span class="hljs-string"> name] IP </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$tmpAddress</span></span></span><span class="hljs-string">"</span></span>) /ip firewall address-list add address=<span class="hljs-variable"><span class="hljs-variable">$tmpAddress</span></span> list=<span class="hljs-variable"><span class="hljs-variable">$ListName</span></span> comment=<span class="hljs-variable"><span class="hljs-variable">$cacheName</span></span> } } } }</code> </pre> <br></div></div><br><br>  The script text must be added to the script repository located in the / system scripts section. <br>  The script is executed line by line.  Each line has the following syntax: <br><pre> <code class="bash hljs">[prefix] [path] <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> [uparam] [param=[value]] .. [param=[value]]</code> </pre>  [prefix] - ":" - for global commands, the command line starts with the "/" symbol, which will be executed relative to the configuration root, the prefix may be missing, then the command line is executed relative to the current configuration section; <br>  [path] - path to the required configuration section, which is used to navigate before executing the command; <br>  command - directly the action performed by the command line; <br>  [uparam] - the nameless parameter of the command; <br>  [param = [value]] - named parameters and their values. <br><br>  So, first of all, we define the parameters of the script in the form of variables.  The variable is declared by the commands: local and: global, respectively, we obtain a local variable that is available only within its visibility zone, or global, which is added to the list of OS environment variables and will be accessible from anywhere.  Local variables live as long as their zone of visibility is fulfilled, global ones until we remove them. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="bash hljs">:<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> DNSList {<span class="hljs-string"><span class="hljs-string">"example.com"</span></span>;<span class="hljs-string"><span class="hljs-string">"non-exist.domain.net"</span></span>;<span class="hljs-string"><span class="hljs-string">"server.local"</span></span>;<span class="hljs-string"><span class="hljs-string">"hostname"</span></span>} :<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> ListName <span class="hljs-string"><span class="hljs-string">"MyList"</span></span> :<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> DNSServers ( [ip dns get dynamic-servers], [ip dns get servers ], 8.8.8.8 )</code> </pre>  The variable DNSList contains an array of domains that we want to work with.  The variable ListName contains a string, which will be the resulting address-list.  Variable DNSServers - contains an array of DNS server addresses assigned on the router or received from the provider when connecting, plus the ‚Äúeights‚Äù in case the router does not use DNS, which will be used to obtain information about domain records. <br><br><pre> <code class="bash hljs">:foreach addr <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-variable"><span class="hljs-variable">$DNSList</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :foreach DNSServer <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-variable"><span class="hljs-variable">$DNSServers</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-keyword"><span class="hljs-keyword">do</span></span> {:resolve server=<span class="hljs-variable"><span class="hljs-variable">$DNSServer</span></span> <span class="hljs-variable"><span class="hljs-variable">$addr</span></span>} on-error={:<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> debug (<span class="hljs-string"><span class="hljs-string">"failed to resolve </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$addr</span></span></span><span class="hljs-string"> on </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$DNSServer</span></span></span><span class="hljs-string">"</span></span>)} } }</code> </pre>  In the cycle ‚Äúfor everyone‚Äù we will go around the array of domains and cut off their IP addresses on each DNS server in case different DNS give different IPs.  Design <pre> <code class="bash hljs">:<span class="hljs-keyword"><span class="hljs-keyword">do</span></span> {<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>} on-error={<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>}</code> </pre>  serves to catch runtime errors.  If you do not use it, the script may be interrupted by an error resolving a nonexistent or erroneous address. <br><br><pre> <code class="bash hljs">/ip firewall address-list remove [find <span class="hljs-built_in"><span class="hljs-built_in">where</span></span> list~<span class="hljs-variable"><span class="hljs-variable">$ListName</span></span>]</code> </pre><br>  Go to the configuration section / ip firewall address-list and delete all entries in which the list name contains the value of the $ ListName variable.  The construction of square brackets allows to execute another within the current command, and transfer the result of the execution as current parameter. <br><br><pre> <code class="bash hljs">/ip dns cache all :foreach i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>=[find <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=<span class="hljs-string"><span class="hljs-string">"A"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={</code> </pre>  go to the configuration section / ip dns cahe all.  It contains the router's DNS cache in the form of a table Name - Type - Data - TTL.  Perform a selection by type - we only need A-records.  And we will bypass the result of the selection in the cycle ‚Äúfor everyone‚Äù.  This will be the main loop of our script. <br><br><pre> <code class="bash hljs">:<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> bNew <span class="hljs-literal"><span class="hljs-literal">true</span></span> :<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> cacheName [get <span class="hljs-variable"><span class="hljs-variable">$i</span></span> name] :<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> match <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre><br>  Create variables that are updated in each cycle: two flags - bNew, eliminating duplication, match, indicating whether the current cache entry is in our domain list;  The cacheName variable contains the Name field of the current cache entry, that is, the domain. <br><br><pre> <code class="bash hljs">:foreach addr <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>=<span class="hljs-variable"><span class="hljs-variable">$DNSList</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (:typeof [:find <span class="hljs-variable"><span class="hljs-variable">$cacheName</span></span> <span class="hljs-variable"><span class="hljs-variable">$addr</span></span>] &gt;= 0) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-variable"><span class="hljs-variable">$match</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }</code> </pre><br>  We will go around the list of domains and for each we will check whether the cacheName contains a substring in the form of a domain from this list. <div class="spoiler">  <b class="spoiler_title">Why not use comparison for equality?</b> <div class="spoiler_text">  Very simple - the script logic assumes that sub-domains should be processed in the same way as domains.  If we want to block social networks, then it makes sense to block not only the main domain, but also, for example, servers giving statics, pictures, scripts, and located on the sub-domains of this site.  Also, this will allow you to avoid listing domains separately with ‚Äúwww‚Äù and without.  The fact that these domains did not fall into the cache when resolving - is not terrible, because  they can get there when resolved by the user's browser (although this requires that the user's DNS requests are processed in RouterOS). </div></div>  If contained, set the value of the match flag to true. <br><br><pre> <code class="bash hljs">:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-variable"><span class="hljs-variable">$match</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> tmpAddress [/ip dns cache get <span class="hljs-variable"><span class="hljs-variable">$i</span></span> address] :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( [/ip firewall address-list find ] = <span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> debug (<span class="hljs-string"><span class="hljs-string">"added entry: $[/ip dns cache get </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$i</span></span></span><span class="hljs-string"> name] IP </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$tmpAddress</span></span></span><span class="hljs-string">"</span></span>) /ip firewall address-list add address=<span class="hljs-variable"><span class="hljs-variable">$tmpAddress</span></span> list=<span class="hljs-variable"><span class="hljs-variable">$ListName</span></span> comment=<span class="hljs-variable"><span class="hljs-variable">$cacheName</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>={ :foreach j <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>=[/ip firewall address-list find ] <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( [/ip firewall address-list get <span class="hljs-variable"><span class="hljs-variable">$j</span></span> address] = <span class="hljs-variable"><span class="hljs-variable">$tmpAddress</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> bNew <span class="hljs-literal"><span class="hljs-literal">false</span></span> } } :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-variable"><span class="hljs-variable">$bNew</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> debug (<span class="hljs-string"><span class="hljs-string">"added entry: $[/ip dns cache get </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$i</span></span></span><span class="hljs-string"> name] IP </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$tmpAddress</span></span></span><span class="hljs-string">"</span></span>) /ip firewall address-list add address=<span class="hljs-variable"><span class="hljs-variable">$tmpAddress</span></span> list=<span class="hljs-variable"><span class="hljs-variable">$ListName</span></span> comment=<span class="hljs-variable"><span class="hljs-variable">$cacheName</span></span> } } }</code> </pre><br>  In the final stage, if the current address requires adding (match is set to true), then we add it to the address list.  The comment to the added record will contain the domain to which it belongs.  At the same time we carry out several checks.  If the address-list is empty, then we add immediately, if something is there, check if there are already entries with the same IP address, and if not, add it. <br><br>  The address list needs to be updated periodically.  For this, RouterOS has a task manager.  The task can be added from the console or from the winbox GUI <br><pre> <code class="bash hljs">/system scheduler add interval=5m name=MyScript on-event=<span class="hljs-string"><span class="hljs-string">"/system script run MyScript"</span></span> policy=\ ftp,reboot,<span class="hljs-built_in"><span class="hljs-built_in">read</span></span>,write,policy,<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,password,sniff,sensitive start-date=may/08/2014 \ start-time=10:10:00</code> </pre><br><br>  Scenarios for working with the address list are not limited to creating rules in the firewall.  Therefore, I will give a few examples.  You can perform in the console, you can add the mouse in winbox'e. <br>  Black list: <br><pre> <code class="bash hljs">/ip firewall filter add chain=forward protocol=tcp dst-port=80 address-list=DenyThis \ action=drop</code> </pre><br>  Static route to these nodes <br><pre> <code class="bash hljs">/ip firewall mangle add action=mark-routing chain=prerouting dst-address-list=AntiZapret \ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>-interface=bridge_lan new-routing-mark=RouteMe /ip route add distance=1 gateway=172.16.10.2 routing-mark=RouteMe</code> </pre><br>  Collect customer information <br><pre> <code class="bash hljs">/ip firewall mangle add action=add-src-to-address-list address-list=FUPer chain=prerouting \ dst-address-list=Pron <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>=yes <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>-prefix=critical</code> </pre><br><br>  List of sources: <br>  <a href="http://wiki.mikrotik.com/wiki/Manual:Scripting">Scripting Documentation</a> <br>  <a href="http://wiki.mikrotik.com/wiki/Manual:Scripting-examples">Simple examples from the developers of RouterOS</a> <br>  <a href="http://wiki.mikrotik.com/wiki/Scripts">User-added scripts</a> <br><br>  <b>UPD:</b> specifically at the request of <a href="https://habrahabr.ru/users/turone/" class="user_link">turone</a> made changes to the script so that the DNS server addresses were taken from the system. <br>  <b>UPD 08/24/2016: I</b> noticed that in new versions of RouterOS (starting from 6.36), it was possible to specify DNS names in the address lists.  So now the value of this script is only educational. </div><p>Source: <a href="https://habr.com/ru/post/242143/">https://habr.com/ru/post/242143/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../242121/index.html">SSD VPS from REG.RU: combine the merits</a></li>
<li><a href="../242123/index.html">Puppet Virtual Resources</a></li>
<li><a href="../242127/index.html">Development of new media platform. Stage of delivering video content to users</a></li>
<li><a href="../242139/index.html">5 killer dull landings</a></li>
<li><a href="../242141/index.html">"Hide behind a high fence ... privacy"</a></li>
<li><a href="../242145/index.html">Facebook is officially available in Tor.</a></li>
<li><a href="../242147/index.html">Split text into sentences by a linguistic-independent method using the example of the AIF library</a></li>
<li><a href="../242149/index.html">Moderation Theory</a></li>
<li><a href="../242151/index.html">Alternative programming environment for Arduino - FLProg</a></li>
<li><a href="../242155/index.html">IBM launches humanitarian initiatives to combat Ebola</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>