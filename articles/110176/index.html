<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to arrange a DoS attack on the database server in one line</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="40 Mbps is good traffic for a DoS attack. It was so much that the incoming traffic suddenly increased to one of our servers. The site courageously kep...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to arrange a DoS attack on the database server in one line</h1><div class="post__text post__text-html js-mediator-article"> 40 Mbps is good traffic for a DoS attack.  It was so much that the incoming traffic suddenly increased to one of our servers.  The site courageously kept.  The time of the start of the burst of abnormally high traffic suspiciously exactly coincided with the time of laying out one major release, which suggested that we doSAM ourselves. <br><a name="habracut"></a><br>  The situation was complicated by the fact that changes in the order of hundreds of different php files got into the release and it was very difficult to view the entire list of changes.  tcpdump helped find out that traffic had grown to a PostgreSQL database server.  The circle narrowed. <br><br>  The first assumption was that limit was forgotten in one of the SQL queries and he chooses the entire data set instead of a single line.  But how do you know what the request is?  <a href="http://pgfouine.projects.postgresql.org/">PgFouine</a> came to the <a href="http://pgfouine.projects.postgresql.org/">rescue</a> .  Analysis of the database server log for two minutes and here it is - the source of evil! <br><br> <code>select oid,typname from pg_type</code> <br> <br>  Here it is - a request without limit `and that has been executed thousands of times.  But our source did not have this request!  Nowhere, in a single file, he did not meet. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="http://google.com/codesearch/p%3Fhl%3Dru">The source of the problem</a> was hidden in the php-function <b>pg_field_type</b> , which just simply returned the symbolic name of the type column of the sample result. <br><br>  The problem has its roots in at least <a href="http://bugs.php.net/bug.php%3Fid%3D31393">2005,</a> but so far the official documentation has not added a remark that the php-pgsql library for accessing PostgreSQL makes an additional query to the DBMS choosing a complete list of more than 1000 data types. <br><br>  Perhaps on a rarely visited website this does not affect the speed at all, but on a loaded project this can create a serious problem.  We bypassed the problem by using its analog pg_field_type_oid instead of the function pg_field_type, which returns the internal oid of the data type instead of its symbolic name.  Yes, it slightly worsened the readability of the code, but it unloaded the channel to the database server by 40 Mbps. <br><br>  Perhaps if we used True FastCGI, we would not have this problem, but <a href="http://habrahabr.ru/blogs/php/103875/">php was ready for this just a few months ago</a> , and the problem has been around for about 6 years. <br><br>  Check your source code for the pg_field_type keyword - perhaps you can greatly ease the hard life of your PostgreSQL server. </div><p>Source: <a href="https://habr.com/ru/post/110176/">https://habr.com/ru/post/110176/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../110171/index.html">UserEcho - Growing with our customers, a catalyst for ideas!</a></li>
<li><a href="../110172/index.html">RPM repository do it yourself</a></li>
<li><a href="../110173/index.html">A revolution on the horizon navigation: Google Maps 5</a></li>
<li><a href="../110174/index.html">My journey to the future</a></li>
<li><a href="../110175/index.html">Obtained root on the newly released Google Nexus S</a></li>
<li><a href="../110177/index.html">Sort array by O (N) on CUDA</a></li>
<li><a href="../110178/index.html">PHP 5.2.16 released and end of support for 5.2.x</a></li>
<li><a href="../110179/index.html">Runtime Magic: Changing the Objective-C Method on the Fly</a></li>
<li><a href="../110180/index.html">Posterous.com: new service - Posterous Groups</a></li>
<li><a href="../110182/index.html">Rambler-News for iPhone</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>