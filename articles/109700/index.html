<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>OpenID, OAuth and other buns</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Why do I need OpenID 

 It happens like that, you go to your favorite site, and there is a link to another site, and there the article is very interes...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">🔎</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">📜</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">⬆️</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">⬇️</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>OpenID, OAuth and other buns</h1><div class="post__text post__text-html js-mediator-article"><h4>  Why do I need OpenID </h4><br><br>  It happens like that, you go to your favorite site, and there is a link to another site, and there the article is very interesting and, most importantly, useful — and you want to add a comment like “Well done!” And you need to register to add a comment, and to register you need to enter “First Name”, “Last Name”, “Login”, “Email”, “Email Again”, “Password”, “Again Password”, “I read the rules and agree with everything that will happen here” and “Captcha”.  And click “Register”, and then bang - “Login” - is busy, and the fields “Password”, “Password Again”, “Captcha” are erased.  So like this.  Enter your other login (which is the second, and not the main and not favorite) and again the password, again the password (post) and the captcha again, and the bang - everything is OK, I just forgot to put the checkbox “Read the rules ...” again.  Well, okay, the circles of hell passed once again, a letter came out on the soap, activated the account, so where was the article there, and well, they are not great, they are  Well done and hell with this, they know so. <br>  Conduct an experiment, in your favorite mail do a search for the word "activate" - that's about how much you registered on the sites. <br>  On the other hand, you think, and let's simplify, and make a simple addition of a comment: “Name”, “Email”, “Message” - and “Email” can be omitted.  After 3 months you enter, and there - SPAM!  Okay, I clean it - and the effect is zero, the spam continues, I added a captcha - well, sort of ok, but then somehow they bypass it again.  And attention (!) - enter the registration ... Oh! <br>  But there is (Hurray!) - OpenID. <br><a name="habracut"></a><br>  Began to understand.  Here's <a href="http://www.handcode.ru/2010/04/openid-aspnet-mvc.html">an article</a> about how OpenID works.  It was a bummer here, in that the OpenID provider sends only ClaimedIdentifier to our site, which in this case looks at me <a href="http://andriy-chernikov.myopenid.com/">andriy-chernikov.myopenid.com</a> , okay, you can cut off a part and select andriy-chernikov - quite readable.  We continue, we argue - normal boys use gmail, and google also has OpenID, only my ClaimedIdentifier (I don’t roll up at all, I’m not at all, I’m not happy with the milestones, I’m not at all; . <br>  <i>"Hello, AItOawl7JUIQLXJf1Z_x1MoYu21XbfBuzvoriso, glad to see you again on our site"</i> <br>  - something somehow does not sound.  We find out that in addition to the OpenId identifier, you can retrieve other data, even Email!  Well, you understand, i.e.  if a potential user leaves a message “Well done!  Only here it doesn’t work for you, it is also under IE, and here you invented a bicycle, you just had to look at such a library, but it’s very well written here on such a link ”I can write him“ Dude, I am very grateful. ”  The site (knowing his email) will send a notification to him, and this Man will understand that the comment left 3 months ago was useful, and he will be pleased.  In addition, as you understand this email is not necessary to check, since it has already been verified. <br>  In general, the task: <br>  <b>To make the user not registering, but just clicking a button gave us information about himself, and was registered, and was able to leave a comment, well, or put a rating (for ZOYCH vote, for example), and spammers go sideways.</b> <b><br></b> <br><h4>  Openid </h4><br><br>  First, we choose a provider.  These will be: Google, Yandex, MailRu, Rambler, Livejournal, MyOpenID.  In my opinion - these are the most popular services with us.  (about vkontakte, twitter and facebook - later). <br>  Links for OpenID authorization: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  Google - <a href="https://www.google.com/accounts/o8/id">www.google.com/accounts/o8/id</a> <br></li><li>  Yandex - <a href="http://openid.yandex.ru/">openid.yandex.ru</a> <br></li><li>  MailRu - [username] .id.mail.ru <br></li><li>  Livejournal - [username] .livejournal.com <br></li><li>  Rambler - <a href="http://rambler.ru/">rambler.ru</a> <br></li><li>  MyOpenID - <a href="http://myopenid.com/">myopenid.com</a> <br></li></ul><br><br>  Lists of authorized sites (when you test, you will need it): <br><ul><li>  Google - <a href="https://www.google.com/accounts/IssuedAuthSubTokens%3Fhl%3Dru">https://www.google.com/accounts/IssuedAuthSubTokens?hl=en</a> <br></li><li>  Yandex - <a href="http://openid.yandex.ru/settings/trust_roots/">http://openid.yandex.ru/settings/trust_roots/</a> <br></li><li>  MailRu - <a href="http://openid.mail.ru/sitelist">http://openid.mail.ru/sitelist</a> <br></li><li>  Livejournal - I can not find <br></li><li>  Rambler - no <br></li><li>  MyOpenID - <a href="https://www.myopenid.com/sites">https://www.myopenid.com/sites</a> <br></li></ul><br><br>  Create a new ASP.NET MVC3 project.  Download and add DotNetOpenAuth to it.  OpenID you most likely have. <br>  We create the controller for authorization on OpenID (as at handcode [thanks]): <br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">OpenIdController</span></span> : <span class="hljs-title"><span class="hljs-title">Controller</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> OpenIdRelyingParty openIdProvider = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OpenIdRelyingParty(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Index</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> userOpenId</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//    . IAuthenticationResponse response = openIdProvider.GetResponse(); // response  null,    OpenID    . if (response == null) { Identifier id; //   OpenID . if (Identifier.TryParse(userOpenId, out id)) { try { //      OpenID IAuthenticationRequest request = openIdProvider.CreateRequest(userOpenId); return request.RedirectingResponse.AsActionResult(); } catch (ProtocolException ex) { TempData["error"] = ex.Message; } } return RedirectToAction("Index", "Login"); } else { //     OpenID switch (response.Status) { //   case AuthenticationStatus.Authenticated: { TempData["id"] = response.ClaimedIdentifier; return RedirectToAction("Index", "Main"); } case AuthenticationStatus.Canceled: { TempData["message"] = "   "; return RedirectToAction("Index", "Main"); } case AuthenticationStatus.Failed: { TempData["message"] = "     ."; TempData["error"] = response.Exception.Message; return RedirectToAction("Index", "Main"); } default: { return RedirectToAction("Index", "Main"); } } } }}</span></span></code> </pre> <br><br>  Now the most important thing is how to request additional data?  There are 2 ways: FetchRequest and ClaimRequest.  By practical consideration we find out that: <br><ol><li>  For google - you need to use FetchRequest </li><li>  For yandex, mailru, rambler, myopenId - you need to use ClaimRequest </li><li>  Livejourns live in Live Journal and don’t give any details at all. </li></ol><br>  For FetchRequest, do this.  After creating a request to the provider, we indicate that we would still be interested to find out: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">//      OpenID IAuthenticationRequest request = openIdProvider.CreateRequest(userOpenId); FetchRequest fetch = new FetchRequest(); fetch.Attributes.Add(new AttributeRequest(WellKnownAttributes.Contact.Email, true)); fetch.Attributes.Add(new AttributeRequest(WellKnownAttributes.Name.First, true)); fetch.Attributes.Add(new AttributeRequest(WellKnownAttributes.Name.Last, true)); fetch.Attributes.Add(new AttributeRequest(WellKnownAttributes.Preferences.Language, true)); request.AddExtension(fetch); return request.RedirectingResponse.AsActionResult(); }</span></span></code> </pre><br><br>  And after successful authentication, we take this data: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> AuthenticationStatus.Authenticated: { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fetches = response.GetExtension&lt;FetchResponse&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fetches != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> str = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; str += <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"Email : {0} &lt;br/&gt;"</span></span>, fetches.Attributes[WellKnownAttributes.Contact.Email].Values[<span class="hljs-number"><span class="hljs-number">0</span></span>]); str += <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">" : {0} &lt;br/&gt;"</span></span>, fetches.Attributes[WellKnownAttributes.Name.First].Values[<span class="hljs-number"><span class="hljs-number">0</span></span>]); str += <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">" : {0} &lt;br/&gt;"</span></span>, fetches.Attributes[WellKnownAttributes.Name.Last].Values[<span class="hljs-number"><span class="hljs-number">0</span></span>]); str += <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">" : {0} &lt;br/&gt;"</span></span>, fetches.Attributes[WellKnownAttributes.Preferences.Language].Values[<span class="hljs-number"><span class="hljs-number">0</span></span>]); TempData[<span class="hljs-string"><span class="hljs-string">"info"</span></span>] = str; } TempData[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] = response.ClaimedIdentifier; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RedirectToAction(<span class="hljs-string"><span class="hljs-string">"Index"</span></span>, <span class="hljs-string"><span class="hljs-string">"Main"</span></span>); }</code> </pre><br><br>  For ClaimsRequest similarly: &lt;br/&gt; <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">//      OpenID IAuthenticationRequest request = openIdProvider.CreateRequest(userOpenId); ClaimsRequest claim = new ClaimsRequest(); claim.BirthDate = DemandLevel.Require; claim.Country = DemandLevel.Require; claim.Email = DemandLevel.Require; claim.FullName = DemandLevel.Require; claim.Gender = DemandLevel.Require; claim.Language = DemandLevel.Require; claim.Nickname = DemandLevel.Require; claim.PostalCode = DemandLevel.Require; claim.TimeZone = DemandLevel.Require; request.AddExtension(claim); return request.RedirectingResponse.AsActionResult(); }</span></span></code> </pre><br><br>  AND <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//   case AuthenticationStatus.Authenticated: { var claims = response.GetExtension&lt;ClaimsResponse&gt;(); if (claims != null) { string str = string.Empty; str += string.Format(" : {0} &lt;br/&gt;", claims.BirthDate); str += string.Format(": {0}&lt;br/&gt;", claims.Country); str += string.Format("Email: {0}&lt;br/&gt;", claims.Email); str += string.Format(" : {0}&lt;br/&gt;", claims.FullName); str += string.Format(": {0}&lt;br/&gt;", claims.Gender); str += string.Format(": {0}&lt;br/&gt;", claims.Language); str += string.Format(": {0}&lt;br/&gt;", claims.Nickname); str += string.Format(": {0}&lt;br/&gt;", claims.PostalCode); str += string.Format(" : {0}&lt;br/&gt;", claims.TimeZone); TempData["info"] = str; } TempData["id"] = response.ClaimedIdentifier; return RedirectToAction("Index", "Main"); }</span></span></code> </pre><br><br>  Well, everything seems to be super, but (!) There are problems, the first problem is the response from Rambler, dotNetOpenAuth treats its response as erroneous.  In general, the Rambler in openid.claimed_id and openid.identity returns a link to the specification, well, in general, we do the processing in the section when there seems to be an error: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> AuthenticationStatus.Failed: { <span class="hljs-comment"><span class="hljs-comment">//     DoTNetOpenAuth var email = Request.Params["openid.sreg.email"]; var fullname = Request.Params["openid.sreg.fullname"]; var nickname = Request.Params["openid.sreg.nickname"]; if (string.IsNullOrEmpty(email) || string.IsNullOrEmpty(fullname) || string.IsNullOrEmpty(nickname)) { TempData["message"] = "     ."; TempData["error"] = response.Exception.Message; } else { AuthOpenID("http://id.rambler.ru/users/" + nickname, fullname); } return RedirectToAction("Index", "Main"); }</span></span></code> </pre><br><br>  Problems with MailRu.  By the way, it does not work with the site, which is located locally.  Those.  localhost is not a site and an error “Bad Realm” is issued - that is solved by actually loading the site somewhere. <br>  I am from Ukraine, I have an hour an hour earlier than Moscow time, so the response record comes an hour more, i.e.  it turns out that the answer was received not in a couple of seconds, but in 1 hour and a couple of seconds.  And is treated as an error.  Add a few settings to the Web.Config: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configSections</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">section</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dotNetOpenAuth"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DotNetOpenAuth.Configuration.DotNetOpenAuthSection"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">requirePermission</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">allowLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configSections</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dotNetOpenAuth</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">messaging</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">clockSkew</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"60:00:00"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lifetime</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10:00:00"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">strict</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">untrustedWebRequest</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">timeout</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"00:10:00"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">readWriteTimeout</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"00:01:00"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">maximumBytesToRead</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1048576"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">maximumRedirections</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">untrustedWebRequest</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">messaging</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dotNetOpenAuth</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  The second error is that ClaimResponse does not parse the parameters.  Just pick up from Request.Params: <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//   case AuthenticationStatus.Authenticated: { string str = string.Empty; str += string.Format("Email: {0}&lt;br/&gt;", Request.Params["openid.sreg.email"]); str += string.Format(" : {0}&lt;br/&gt;", Request.Params["openid.sreg.fullname"]); str += string.Format(": {0}&lt;br/&gt;", Request.Params["openid.sreg.gender"]); str += string.Format(": {0}&lt;br/&gt;", Request.Params["openid.sreg.nickname"]); TempData["info"] = str; TempData["id"] = response.ClaimedIdentifier; return RedirectToAction("Index", "Main"); } &lt;/code&gt;</span></span></code> </pre><br><br><h5>  OpenID Summary </h5><br>  We have a quick authentication using OpenID, of which only livejournal does not provide email there. <br><br><h4>  Oauth </h4><br>  In general, OAuth is not intended to be authenticated instantly, very well written about OAuth <a href="http://dklab.ru/chicken/nablas/57.html">here</a> .  But (!) Authentication is there, we will use it.  First, choose the heroes: <br>  Facebook, Twitter, VKontakte. <br>  In each of them you need to create an application, it is simple, I will simply indicate where it is done: <br><ul><li>  Facebook - <a href="http://www.facebook.com/developers/apps.php">http://www.facebook.com/developers/apps.php</a> <br></li><li>  Twitter - <a href="http://twitter.com/apps">http://twitter.com/apps</a> <br></li><li>  VKontakte - <a href="http://vkontakte.ru/apps.php">http://vkontakte.ru/apps.php#act=admin</a> <br></li></ul><br><br>  Then we still need to remove permissions for applications, so here are the links: <br><br><ul><li>  Facebook - <a href="http://www.facebook.com/settings/%3Ftab%3Dapplications">http://www.facebook.com/settings/?tab=applications</a> <br></li><li>  Twitter - <a href="http://twitter.com/settings/connections">http://twitter.com/settings/connections</a> <br></li><li>  VKontakte - do not need <br></li></ul><br><br><h5>  Let's start with Twitter </h5><br><img src="https://habrastorage.org/storage/68342093/55d0c2c5/e125f04b/5945033c.png"><br>  Twitter has Consumer key and Consumer secret - important values ​​that need to be hidden somewhere and not shown to anyone. <br>  Also in the settings it would be necessary to set the Callback URL, Website and Application Website - but it works without it. <br>  Then everything is simple, we just see that in the examples of dotNetOpenAuth there is an example of authentication through twitter - so we just copy to ourselves and everything. <br><h5>  Facebook </h5><br><img src="https://habrastorage.org/storage/756a4b6f/7475a7d8/80e30a97/42f9e5bb.png"><br>  Oh, here I killed 4 hours to screw OAuth which in dotNetOpenAuth for authorization in facebook.  But it did not.  Then I found an excellent library: <a href="http://facebooknet.codeplex.com/">http://facebooknet.codeplex.com/</a> - there is a working example (it did not work for me on localhost, but on the site everything is ok).  By the way, very convenient for directional integration with Facebook, a lot of everything.  There are in NuGet. <br>  So, having created a Facebook application, we have 3 keys: <br><ul><li>  ApplicationID <br></li><li>  Applicationkey <br></li><li>  Applicationsecret <br></li></ul><br><br>  We will need them all.  Also customizable in the tab Web Site Site URL and Site Domain. <br>  Go to <a href="http://developers.facebook.com/docs/authentication/">http://developers.facebook.com/docs/authentication</a> and learn how it happens there: <br>  <b>Step 1.</b> I give my ApplicationID and ask me to give me information about myself, by the way, add scope = email to the request so that they give us another email: <br> <code><a href="https://graph.facebook.com/oauth/authorize%3Fclient_id%3D"></a> graph.facebook.com/oauth/authorize?client_id={0}&amp;redirect_uri={1}&amp;scope=email <br></code> <br>  User sees: <br><img src="https://habrastorage.org/storage/7167b4d3/baa3063e/4f4cb2b4/4bfe385c.png"><br><br>  If the user allows - we get the code (code).  If not, then we get an error_description that the user does not want to give you anything. <br>  <b>Step 2.</b> Further we go with this code and request access_token: <br> <code><a href="https://graph.facebook.com/oauth/access_token%3Fclient_id%3D"></a> graph.facebook.com/oauth/access_token?client_id={0}&amp;redirect_uri={1}&amp;client_secret={2}&amp;code={3} <br></code> <br><br>  Here we get a string like: <br> <code>access_token=114782445239544|2.izExIa_6jpjjhUy3s7EDZw__.3600.1291809600-708770020|VbEE8KVlLTMygGmYwm-V08aVKgY&amp;expired=12010 <br></code> <br><br>  Or an error in JSON, which seems to be illogical as it is to play with formats, but oh well. <br>  <b>Step 3.</b> Having access_token, we request user data: <br> <code><a href="https://graph.facebook.com/me%3Faccess_token%3D"></a> graph.facebook.com/me?access_token={0} <br></code> <br>  What in JSON format we get a lot of information about the user.  Hooray! <br><h5>  In contact with </h5><br><img src="https://habrastorage.org/storage/32eb2792/8e5c05eb/0fab5d0d/fb903d01.png"><br>  Vkontakte, as always, stood out to write step by step how to do what was like on Facebook - they just gave their widget and wrote “tell me where to send the data.”  Widget must pass ApplicationID and that's it.  Vkontakte does not transmit any email at all - but it throws off a link to the avatar and photo of the user.  Javacript: <br> <code>VK.init({ apiId: vkontakteAppId }); <br> VK.Widgets.Auth("vk_auth", { width: "210px", authUrl: '/vkontakte' }); <br></code> <br><br>  And in the desired controller we get: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">VkontakteController</span></span> : <span class="hljs-title"><span class="hljs-title">Controller</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Index</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> first_name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> last_name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> uid</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> str = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; str += <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">" : {0}&lt;br/&gt;"</span></span>, first_name); str += <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">": {0}&lt;br/&gt;"</span></span>, last_name); TempData[<span class="hljs-string"><span class="hljs-string">"info"</span></span>] = str; TempData[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] = <span class="hljs-string"><span class="hljs-string">"http://vkontakte.ru/id"</span></span> + uid; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RedirectToAction(<span class="hljs-string"><span class="hljs-string">"Index"</span></span>, <span class="hljs-string"><span class="hljs-string">"Main"</span></span>); } }</code> </pre><br><br><h4>  Results </h4><br>  We partially solved the task.  MyOpenID, Yandex, Google, Facebook, MailRu - generally well done and cool.  Twitter, Livejournal, VKontakte - squeezed email (I don’t particularly vouch for Twitter).  Rambler - in general, well done would be if they had not messed with the implementation of the protocol. <br>  An example can be found here: <a href="http://cocosanka.ru/">http://cocosanka.ru</a> <br>  Sources download here: <a href="http://bitbucket.org/chernikov/smartauth">http://bitbucket.org/chernikov/smartauth</a> <br>  PS: I know about Loginza.  When trying to authenticate to google, he also requests contacts from Google Mail.  I'm certainly not paranoid, but why should they?  BUT? <br>  PPS: I learned here that Yandex did OAuth too ... </div><p>Source: <a href="https://habr.com/ru/post/109700/">https://habr.com/ru/post/109700/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../109685/index.html">Small ProLiant (Just Right Home Server)</a></li>
<li><a href="../109689/index.html">Reverse engineering obfuscated assembly .NET</a></li>
<li><a href="../109690/index.html">1st Startup Point in Krasnodar and Omsk</a></li>
<li><a href="../109691/index.html">Perl Workshop "Saint Perl - 2" in St. Petersburg, December 18</a></li>
<li><a href="../109692/index.html">Human Jukebox - a man like an audio system</a></li>
<li><a href="../109703/index.html">Java Mobile Agent - now with Jabber</a></li>
<li><a href="../109706/index.html">Njuskalo: a success story from Croatia</a></li>
<li><a href="../109707/index.html">Humble Bundle is now available via Steam.</a></li>
<li><a href="../109709/index.html">IntelliJ IDEA 10</a></li>
<li><a href="../109710/index.html">Making a Kinect power adapter from available tools</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>