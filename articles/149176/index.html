<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Optimization of long lists of logical values ‚Äã‚Äãin JavaScript</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Very often in web development (and in programming in general) you need to save a long list of Boolean values ‚Äã‚Äã(yes / no, true / false, checked / unch...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Optimization of long lists of logical values ‚Äã‚Äãin JavaScript</h1><div class="post__text post__text-html js-mediator-article">  Very often in web development (and in programming in general) you need to save a long list of Boolean values ‚Äã‚Äã(yes / no, true / false, checked / unchecked, and the like) as strings.  For example, you want to write such data using localStorage, in a cookie, or send them in the body of an HTTP request.  I had such a need hundreds of times. <br><a name="habracut"></a><br><h4>  Use array </h4><br>  We have two reasonable ways to organize logical data in an array. <br>  The first is to store true / false values: <br><pre><code class="javascript hljs">[<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>]</code> </pre> <br>  The second is to store an array of zeros and ones: <br><pre> <code class="javascript hljs">[<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]</code> </pre> <br>  Whatever method we choose, in any case, we will have to convert such an array into a string, and then convert this string back to an array when reading data.  To do this, we can use the old <code>Array#join()</code> (or <code>Array#toString()</code> ) and <code>String#split()</code> <code>JSON.stringify()</code> , or the more elegant <code>JSON.stringify()</code> and <code>JSON.parse()</code> . <br><br>  If we go along the JSON path, the code will be a bit shorter, although using JSON in this case is the same as cutting the bread with a chainsaw.  In some browsers, <a href="http://jsperf.com/json-vs-split-join-for-simple-arrays">this approach</a> will have a noticeable <a href="http://jsperf.com/json-vs-split-join-for-simple-arrays">effect on performance</a> , and this will also worsen the support of older browsers. <br><br>  The main disadvantage of using array-based strings is their size in bytes.  If you choose the option of storing an array of zeros and ones, you will have to use 2 characters per value (or, to be precise, 2n-1, one separator after each value except the last): <br><pre> <code class="javascript hljs">[<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>].toString().length <span class="hljs-comment"><span class="hljs-comment">// 13   7 </span></span></code> </pre> <br>  Thus, 523 values ‚Äã‚Äãrequire 1023 characters or 2 KB, because <a href="http://es5.github.com/">JavaScript uses UTF-16</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If we keep an array of true / false values, then everything gets worse: <br><pre> <code class="javascript hljs">[<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>].toString().length <span class="hljs-comment"><span class="hljs-comment">// 37   7 </span></span></code> </pre> <br>  This is 5 or 6 characters per value, from 2560 to 3072 characters at 512 values ‚Äã‚Äã(from 5 to 6 KB). <br>  <code>JSON.stringify()</code> spends another 2 characters in each case on opening and closing parentheses, but its advantage is that as a result of <code>JSON.parse()</code> we get the original value types instead of strings. <br><br><h4>  Use string </h4><br>  The string allows you to save characters, since there is no need to use delimiters.  For example, if we chose the digital approach and store the string '01001101010111', then we use one character per value, which is much better than the approach using arrays.  You can put our values ‚Äã‚Äãinto an array using <code>String#split</code> : <br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'01001101010111'</span></span>.split(<span class="hljs-string"><span class="hljs-string">''</span></span>); <span class="hljs-comment"><span class="hljs-comment">// ['0','1','0','0','1','1','0','1','0','1','0','1','1','1']</span></span></code> </pre> <br>  Also, you can simply <code>string.charAt(i)</code> over characters in a string using a loop, using <code>string.charAt(i)</code> or even string indices <code>(string[i])</code> , if you do not need to worry about the support of older browsers. <br><br><h4>  Using Bit Fields </h4><br>  Did you also think about binary code, considering the previous example?  The concept of <a href="http://ru.wikipedia.org/wiki/%25D0%2591%25D0%25B8%25D1%2582%25D0%25BE%25D0%25B2%25D0%25BE%25D0%25B5_%25D0%25BF%25D0%25BE%25D0%25BB%25D0%25B5">bit fields is</a> quite popular in other programming languages, but not in JavaScript.  In a nutshell, bitfields are used to package a set of logical values ‚Äã‚Äãinto <b>bits of a</b> logical representation of a number.  For example, we have 8 values ‚Äã‚Äã(true, false, false, true, false, true, true, false).  In binary code, this will be 10010110, 150 in decimal and 96 in hex.  Thus, 2 symbols are used instead of 8, <b>saving 75%</b> .  One number in hexadecimal representation exactly corresponds to 4 bits.  (Because 16 = 2 <sup>4.</sup> In the number system with a base of 2 <sup>n</sup> , you can pack n bits in each number.) <br>  Thus, instead of storing an entire string and using a single character per value, we can go a smarter way and convert such a string into a hexadecimal number.  How to do it?  Like this: <br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(<span class="hljs-string"><span class="hljs-string">'10010110'</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>).toString(<span class="hljs-number"><span class="hljs-number">16</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  '96'</span></span></code> </pre> <br>  How to return data to a readable view?  Easier nowhere: <br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(<span class="hljs-string"><span class="hljs-string">'96'</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>).toString(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  '10010110'</span></span></code> </pre> <br>  Now, like last time, we can loop through the values ‚Äã‚Äãusing the loop and do something useful with them. <br><br><h4>  Is it possible to do even better? </h4><br>  Actually you can!  Why convert to hexadecimal notation, which uses only 6 Latin letters out of 26?  The <code>Number#toString()</code> method allows you to use <a href="http://en.wikipedia.org/wiki/Base_36">base 36 - a number system with a base of 36</a> (for <code>&gt;= 37</code> we get a <code>RangeError</code> ), which effectively uses <em>all</em> letters from the Latin alphabet.  Thus, we can compress 32 values ‚Äã‚Äãinto 6 characters, which means a saving of 81.25% compared with the method of using a simple string.  The code is still simple: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>( <span class="hljs-string"><span class="hljs-string">'1001011000'</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>).toString(<span class="hljs-number"><span class="hljs-number">36</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  'go' ( '258'   ) parseInt('go', 36).toString(2); //  '1001011000'</span></span></code> </pre><br>  Many will stop at this.  But the more inquisitive will say: ‚ÄúWe also have capital letters and other symbols, we still do not use the full potential!‚Äù And they will be right.  Not for nothing when opening a binary file in a text editor, you see strange characters on the screen, mixed with numbers and letters - uppercase and lowercase.  Each character in the UTF-16 encoding takes 2 bytes (16 bits), which means that when using the correct compression algorithm, we will be able to save 93.75%. <br>  The problem is that JavaScript has no built-in functionality for using such an algorithm, so the code becomes somewhat more complicated. <br><br><h4>  Packing 16 values ‚Äã‚Äãin one character </h4><br>  We need the <code>String.fromCharCode</code> method.  It takes a numeric value up to 65535 and returns a character (and for values ‚Äã‚Äãgreater than 65535, it returns an empty string). <br>  We divide our string into fragments of 16 characters each. <br>  You can <a href="http://stackoverflow.com/questions/7033639/javascript-split-large-string-in-n-size-chunks">do this with <code>.match(/.{1,16}/g)</code></a> .  All code will look like this: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pack</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/* string */</span></span></span></span><span class="hljs-function"><span class="hljs-params"> values</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> chunks = values.match(<span class="hljs-regexp"><span class="hljs-regexp">/.{1,16}/g</span></span>), packed = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; chunks.length; i++) { packed += <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>.fromCharCode(<span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(chunks[i], <span class="hljs-number"><span class="hljs-number">2</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> packed; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unpack</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/* string */</span></span></span></span><span class="hljs-function"><span class="hljs-params"> packed</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> values = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; packed.length; i++) { values += packed.charCodeAt(i).toString(<span class="hljs-number"><span class="hljs-number">2</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> values; }</code> </pre><br>  Not so difficult, right? <br>  These few lines of code allow you to pack the above 512 values ‚Äã‚Äãin (drum roll) <b>32 characters (64 bytes)</b> !  Much better than the original 2 KB (with storage in a simple array), isn't it? <br><br><h4>  Restrictions </h4><br>  Numbers in JavaScript have their limits.  For the methods described here, which include intermediate conversions to numbers, the limit is set to <b>1023</b> logical values, because <code>parseInt('1111‚Ä¶1111', 2)</code> will return <code>Infinity</code> for more.  This restriction does not apply to the latter method, because we convert blocks of bits instead of the entire string.  And, of course, this restriction is not imposed on the first two methods (array and string) because they do not include the packing of values ‚Äã‚Äãat all. <br><br><h4>  "I think we went too far" </h4><br>  Yes, in some cases this optimization may be unnecessary.  But if you need to save a bunch of logical values ‚Äã‚Äãin a limited place that only strings support, these methods will be very useful.  And the optimization of something that is transmitted through the wires with great frequency is never superfluous.  For example, cookies are sent in almost every request, so they should be as small as possible.  Another example is multiplayer online games, for which the server‚Äôs response should be lightning-fast, otherwise playing such a game would be no fun at all. <br><br>  And even if such a profound optimization is not for you, I hope that this article has given you food for thought and, perhaps, taught you something. <br><br>  <i>Transfer.</i>  <i>Original (en): <a href="http://coding.smashingmagazine.com/2011/10/19/optimizing-long-lists-of-yesno-values-with-javascript/">Optimizing Long Lists Of Yes / No Values ‚Äã‚ÄãWith JavaScript</a></i> <i><br></i>  <i>Original author: Lea Verou</i> </div><p>Source: <a href="https://habr.com/ru/post/149176/">https://habr.com/ru/post/149176/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../149170/index.html">YouTube app removed from iOS 6</a></li>
<li><a href="../149171/index.html">LiveStreet Release 1.0.1</a></li>
<li><a href="../149172/index.html">We generate color QR-code with Java logo</a></li>
<li><a href="../149173/index.html">Artifacts in 2D games - on the border of texture</a></li>
<li><a href="../149174/index.html">Monad ContT in Pictures (Haskell)</a></li>
<li><a href="../149177/index.html">XAML: Nested Converters</a></li>
<li><a href="../149178/index.html">The court forced Apple to reveal the secrets of the company</a></li>
<li><a href="../149179/index.html">How, knowing only the name and email of the person, the attackers gained access to all his accounts and remotely destroyed the information on all his devices</a></li>
<li><a href="../149181/index.html">Anti-spam module for Kohana</a></li>
<li><a href="../149182/index.html">Subaru and Arduino: SSM1 protocol. Handshake</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>