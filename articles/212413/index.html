<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Prevent the launch of a copy of a third-party application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many software programmers have been faced with the task of preventing the launch of copies of an application. This is done with different goals and de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Prevent the launch of a copy of a third-party application</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/5ea/1ee/df4/5ea1eedf4cf3ce8421ab3c4a70a38968.png" alt="Robot Burning Copy Notebook" align="left">  Many software programmers have been faced with the task of preventing the launch of copies of an application.  This is done with different goals and depends on the situation.  There is even a separate term for solving this problem - <a href="http://ru.wikipedia.org/wiki/Mutex">Mutex</a> . <br><br>  Also, this task sometimes arises before system administrators with the difference that the application is third-party (developed by another organization).  This article describes a relatively simple way to solve the problem of preventing launching copies of a third-party application. <br><a name="habracut"></a><br><br><h4>  Task </h4><br>  One day I had a problem at work - some employees managed to run multiple copies of applications.  Running multiple copies, of course, did not lead to catastrophic results, but sometimes generated various "glitches", unstable program operation.  This, naturally, gave me a headache from numerous complaints about these ‚Äúglitches‚Äù. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      First of all, I had an explanatory conversation with employees about the problem of running copies of the application and how to avoid it.  This measure helped for the next couple of days, and then everything returned to normal.  To complain to the authorities about such connivance of some workers was fraught with my dismissal, since  the authorities insanely valued these workers, and the attitude towards me was radically opposite. <br><br>  As the saying goes, "Since the mountain does not go to Mohammed, then Mohammed goes to the mountain."  I decided to programmatically prohibit the launch of copies of the application.  The task was not trivial. <br><br>  A simple analysis revealed 2 features of my situation: <br>  First, I have a third-party application, i.e.  its developer is not our organization and there is no access to the source code (I will explain that the application is one of Microsoft products).  The application does not have any regulatory settings or parameters. <br>  Secondly, the application is launched not directly, but as a default program for opening files of a certain extension.  That is, the application starts with the parameter (the path of the data file that you want to open). <br><br><h4>  Solution - Theory </h4><br>  Searching the internet did not give me an explicit solution.  Prohibiting the launch of the second copy of the application in the form of system settings, as I understand it does not exist (although there is an API).  I also found dozens of examples of implementing mutexs in various programming languages, but all of them, naturally, required changes to the code and did not suit me.  We had to look for our original solution, and preferably easier. <br><br>  The only solution I saw was the creation of a kind of "layer" between the user and the application.  The following should occur: <br><ul><li>  The user initiates the launch of the application by opening the data file associated with the application. </li><li>  By default, an interlayer application is launched instead of the required application. </li><li>  This application takes as a parameter the path to the data file, creates a mutex and starts the required application with the received parameters.  Application-layer, respectively, should be hidden. </li><li>  Next, the desired application is launched and the user is working in it.  The interlayer application continues to work all this time.  His mutex blocks attempts to launch a copy. </li><li>  At the end of the work, the user closes the main program.  The interlayer program closes automatically. </li></ul><br>  As you understand, this approach is quite versatile.  This application-layer can perform not only the task of prohibiting the launch of a copy of the program, but many others (logging, launching related programs, notifications, etc.).  For the user, the operation of the interlayer application will be invisible. <br><br><h4>  Solution - Practice </h4><br>  A practical solution is given for the Notepad application (of course, any application can be in its place). <br><br>  The choice of a programming language for writing an interlayer application did not cause me any difficulties.  I needed to do this quickly and without problems, so I chose the <a href="http://ru.wikipedia.org/wiki/AutoIt">AutoIt</a> automation language.  Lightweight AutoIt was originally "sharpened" for work with third-party applications.  You can download it from the <a href="http://www.autoitscript.com/site/">official site</a> .  In addition to the bundle of the language pack itself, the SciTE Script Editor is a fairly convenient code editor, in which it is convenient to write scripts for AutoIt. <br>  Naturally, you can use any other language with the necessary capabilities. <br><br>  The program code of the script (text file with the extension .au3) is nothing complicated: <br><br><pre><code class="python hljs">; **     ** ;  Singleton     WinAPI.     ,    Func Singleton($semaphore) Local $ERROR_ALREADY_EXISTS = <span class="hljs-number"><span class="hljs-number">183</span></span> DllCall(<span class="hljs-string"><span class="hljs-string">"kernel32.dll"</span></span>, <span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-string"><span class="hljs-string">"CreateSemaphore"</span></span>, <span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"long"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"long"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"str"</span></span>, $semaphore) Local $lastError = DllCall(<span class="hljs-string"><span class="hljs-string">"kernel32.dll"</span></span>, <span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-string"><span class="hljs-string">"GetLastError"</span></span>) If $lastError[<span class="hljs-number"><span class="hljs-number">0</span></span>] = $ERROR_ALREADY_EXISTS Then Exit <span class="hljs-number"><span class="hljs-number">-1</span></span> EndFunc Singleton(<span class="hljs-string"><span class="hljs-string">"Mutex"</span></span>) ;   ShellExecuteWait         ;    ,    Mutex ; $CmdLineRaw -     ShellExecuteWait(<span class="hljs-string"><span class="hljs-string">"C:\WINDOWS\notepad.exe"</span></span>, $CmdLineRaw, @ScriptDir, <span class="hljs-string"><span class="hljs-string">"open"</span></span>, @SW_MAXIMIZE)</code> </pre> <br>  Habrawar <a href="http://habrahabr.ru/users/mayorovp/" class="user_link">mayorovp</a> correctly noted that the name of the ‚ÄúMutex‚Äù semaphore is better to replace with something more unique. <br><br>  As you can see, the whole code can be divided into two parts: mutex and the launch of the required application.  I will not explain in more detail, because  The article is devoted not to studying the capabilities of AutoIt. <br><br>  After writing the script, you can compile it either in the SciTE Script Editor, or through the context menu of the file (right click on the script file).  After which it can already be used.  You can also compile with additional settings (system bit and application icon) using the Aut2Exe utility, which also comes with AutoIt. <br><br>  Then everything is elementary - we put the resulting interlayer application in some directory and configure the default opening for data files (in the example for files with the .txt extension) using this interlayer application. <br><br>  That's all.  We check and rejoice at the solved problem - now no one can run two copies of Notepad. <br><br><h4>  Afterword </h4><br>  This method allowed me to solve the problem of double-launch applications.  True, the next day after installing the interlayer application, careless employees came running to me with the words "It does not start."  I had to hold an explanatory conversation with employees on the topic "The application does not start because it is already running."  This conversation was much more effective, because  employees had no particular choice.  For almost a month these problems have not arisen. <br><br>  If any reader knows a way to write mutex as a .bat file for this task, then share your experience.  I have a suspicion that there is such a way. </div><p>Source: <a href="https://habr.com/ru/post/212413/">https://habr.com/ru/post/212413/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../212403/index.html">‚ÄúYandex‚Äù has learned to look for music on the basis of the ‚Äúpu-pidu‚Äù type</a></li>
<li><a href="../212405/index.html">We find common friends of people using VK API</a></li>
<li><a href="../212407/index.html">Yacy - Distributed Uncensored Search Engine: Three Years Later</a></li>
<li><a href="../212409/index.html">A world without accidents</a></li>
<li><a href="../212411/index.html">China announced the loss of the moonwalker "Yuytu", and he suddenly woke up</a></li>
<li><a href="../212423/index.html">UAE launched a project to use unmanned vehicles for the delivery of important goods</a></li>
<li><a href="../212425/index.html">Pleasant testing with Espresso</a></li>
<li><a href="../212431/index.html">Artificial cognitive systems of the present and the future</a></li>
<li><a href="../212435/index.html">How we ran 1C-Bitrix in Windows Azure</a></li>
<li><a href="../212437/index.html">StubDb - database on stubs for rapid prototyping and not only</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>