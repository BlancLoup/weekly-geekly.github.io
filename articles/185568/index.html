<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automating Microsoft Outlook with VBA using the example of creating a mass mailing list</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, I would like to share the experience of automating office, routine tasks of sending messages to a group of clients. 
 So, actually, w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automating Microsoft Outlook with VBA using the example of creating a mass mailing list</h1><div class="post__text post__text-html js-mediator-article">  In this article, I would like to share the experience of automating office, routine tasks of sending messages to a group of clients. <br>  So, actually, what is the question: it is necessary to send emails with an attachment to several dozen clients.  In this case, there should be only one address in the recipient field, i.e.  customers should not know about each other.  In addition, <b>it is not allowed to install additional software</b> , such as MaxBulk Mailer and the like.  We have only Microsoft Office at our disposal, and in this particular case, Microsoft Office 2013. <br><a name="habracut"></a><br>  I describe, in my opinion, the most option - without the use of templates, drafts and formatting.  For our purposes, we need Outlook (go to the VBA editor and add the module, also include ‚ÄúMicrosoft Excel 15.0 Object Library‚Äù in Tools&gt; References), a text file with a mailing list on the principle ‚Äúone line-one address‚Äù, a text file with the letter body and files that will be sent as an attachment. <br>  The general algorithm is as follows: we specify the data for the fields and generate letters, going through the recipients in a cycle. <br>  Immediately, I note that this example is not some kind of perfected code that works with maximum efficiency with minimum sizes.  But it works and copes with the declared functionality.  Actually, I was just too lazy to send manually a few dozen letters, and I wrote this program, and then decided to share it.  If anyone is interested, he can improve the code as much as you like. <br>  VBA, by default, does not require a clear declaration of variables and their types.  In principle, you can do without it.  Therefore, some variables in the "episodic roles" are not described in the construction with Dim. <br>  So, first we request the subject of the letter with the implementation of the check for cancellation. <br><pre><code class="vbscript hljs">TxtSubj = <span class="hljs-built_in"><span class="hljs-built_in">InputBox</span></span>(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Len</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">Trim</span></span>(TxtSubj)) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Sub</span></span> <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">If</span></span></code> </pre> <br>  Now the queue for the files with addresses and text letters.  Here came the nuance.  How to call the file selection dialog?  I don‚Äôt even want to think about hard prescription.  So you have to invent something.  Many people use the option with Application.GetOpenFilename will not work, because in Outlook there is no such method.  Tried to use API.  The variant with ‚ÄúPrivate Declare PtrSafe Function GetOpenFileName Lib‚Äû comdlg32.dll ‚Äú...‚Äù did not work (PtrSafe due to the fact that Win7 system, x64).  I did not give any errors, but nothing appeared on the call.  Solutions on the Internet did not find.  If someone tells you the solution, I will be grateful.  Thus, I had to go around with the use of an Excel object. Application. <br><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> xlApp As <span class="hljs-keyword"><span class="hljs-keyword">New</span></span> Excel.Application <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> fd = xlApp.FileDialog(msoFileDialogFilePicker) <span class="hljs-keyword"><span class="hljs-keyword">With</span></span> fd .AllowMultiSelect = <span class="hljs-literal"><span class="hljs-literal">False</span></span> .Title = <span class="hljs-string"><span class="hljs-string">"   "</span></span> .Filters.Add <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"*.txt"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> .Show = <span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Each</span></span> vrtSelectedItem <span class="hljs-keyword"><span class="hljs-keyword">In</span></span> .SelectedItems Path2Body = vrtSelectedItem <span class="hljs-keyword"><span class="hljs-keyword">Next</span></span> vrtSelectedItem <span class="hljs-keyword"><span class="hljs-keyword">Else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Sub</span></span> <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">With</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> fd = <span class="hljs-literal"><span class="hljs-literal">Nothing</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">And for another file</b> <div class="spoiler_text"><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> fd = xlApp.FileDialog(msoFileDialogFilePicker) <span class="hljs-keyword"><span class="hljs-keyword">With</span></span> fd .AllowMultiSelect = <span class="hljs-literal"><span class="hljs-literal">False</span></span> .Title = <span class="hljs-string"><span class="hljs-string">"   "</span></span> .Filters.Add <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"*.txt"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> .Show = <span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Each</span></span> vrtSelectedItem <span class="hljs-keyword"><span class="hljs-keyword">In</span></span> .SelectedItems Path2To = vrtSelectedItem <span class="hljs-keyword"><span class="hljs-keyword">Next</span></span> vrtSelectedItem <span class="hljs-keyword"><span class="hljs-keyword">Else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Sub</span></span> <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">With</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> fd = <span class="hljs-literal"><span class="hljs-literal">Nothing</span></span></code> </pre><br></div></div><br>  And now attachments.  Here I used a dynamic array and the ability to select multiple dialogs. <br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> fd = xlApp.FileDialog(msoFileDialogFilePicker) <span class="hljs-keyword"><span class="hljs-keyword">With</span></span> fd .AllowMultiSelect = <span class="hljs-literal"><span class="hljs-literal">True</span></span> .Title = <span class="hljs-string"><span class="hljs-string">",   "</span></span> .Filters.Add <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"*.*"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> .Show = <span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ReDim</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Preserve</span></span> Path2Att(i) <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Each</span></span> vrtSelectedItem <span class="hljs-keyword"><span class="hljs-keyword">In</span></span> .SelectedItems Path2Att(i) = vrtSelectedItem i = i + <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ReDim</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Preserve</span></span> Path2Att(i) <span class="hljs-keyword"><span class="hljs-keyword">Next</span></span> vrtSelectedItem <span class="hljs-keyword"><span class="hljs-keyword">Else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Sub</span></span> <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">With</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> fd = <span class="hljs-literal"><span class="hljs-literal">Nothing</span></span></code> </pre><br></div></div><br>  Every time I created and deleted the fd object because it is easier to do than to clean it before the next call. <br>  To get data from text files, I had to use a couple of additional functions.  They are called this way: <br><pre> <code class="vbscript hljs">txtBody = ReadTXTfile(Path2Body) Item2To = ReadTXTfile2Arr(Path2To)</code> </pre><br><div class="spoiler">  <b class="spoiler_title">And then their source code</b> <div class="spoiler_text"><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">Function</span></span> ReadTXTfile(<span class="hljs-keyword"><span class="hljs-keyword">ByVal</span></span> filename As <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>) As <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> FSO = <span class="hljs-built_in"><span class="hljs-built_in">CreateObject</span></span>(<span class="hljs-string"><span class="hljs-string">"scripting.filesystemobject"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> ts = FSO.OpenTextFile(filename, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-literal"><span class="hljs-literal">True</span></span>): ReadTXTfile = ts.ReadAll: ts.Close <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> ts = <span class="hljs-literal"><span class="hljs-literal">Nothing</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> FSO = <span class="hljs-literal"><span class="hljs-literal">Nothing</span></span> <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span> ReadTXTfile2Arr(<span class="hljs-keyword"><span class="hljs-keyword">ByVal</span></span> filename As <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>) As Variant <span class="hljs-keyword"><span class="hljs-keyword">Const</span></span> OpenFileForReading = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Const</span></span> OpenFileForWriting = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Const</span></span> OpenFileForAppending = <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Const</span></span> vbSplitAll = <span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> S As Variant <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> FSO = <span class="hljs-built_in"><span class="hljs-built_in">CreateObject</span></span>(<span class="hljs-string"><span class="hljs-string">"Scripting.FileSystemObject"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> FSOFile = FSO.GetFile(filename) <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> TextStream = FSOFile.OpenAsTextStream(OpenFileForReading) <span class="hljs-keyword"><span class="hljs-keyword">Do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">While</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Not</span></span> TextStream.AtEndOfStream S = S &amp; TextStream.ReadLine &amp; vbNewLine <span class="hljs-keyword"><span class="hljs-keyword">Loop</span></span> TextStream.Close ReadTXTfile2Arr = <span class="hljs-built_in"><span class="hljs-built_in">Split</span></span>(S, vbNewLine, vbSplitAll, vbTextCompare) <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> TextStream = <span class="hljs-literal"><span class="hljs-literal">Nothing</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> FSOFile = <span class="hljs-literal"><span class="hljs-literal">Nothing</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> FSO = <span class="hljs-literal"><span class="hljs-literal">Nothing</span></span> <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span></code> </pre><br></div></div><br>  In order to debug, I inserted such code <br>  'Data control <br><pre> <code class="vbscript hljs"><span class="hljs-comment"><span class="hljs-comment">'Debug.Print " " 'Debug.Print "-----------------" 'For i = 0 To UBound(Item2To) - 1 ' Debug.Print Item2To(i) 'Next i 'Debug.Print " " 'Debug.Print "-----------------" 'For i = 0 To UBound(Path2Att) - 1 ' Debug.Print Path2Att(i) 'Next i 'Debug.Print " " 'Debug.Print "-----------" 'Debug.Print TxtSubj 'Debug.Print " " 'Debug.Print "-----------" 'Debug.Print txtBody</span></span></code> </pre><br>  As you can see, he is now commented out, but allows you to understand where what lies. <br>  Now a small one, but the most important part is the generation of letters. <br><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> olMailMessage As Outlook.MailItem <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">To</span></span> <span class="hljs-built_in"><span class="hljs-built_in">UBound</span></span>(Item2To) - <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> olMailMessage = Application.CreateItem(olMailItem) <span class="hljs-keyword"><span class="hljs-keyword">With</span></span> olMailMessage DoEvents .<span class="hljs-keyword"><span class="hljs-keyword">To</span></span> = Item2To(i) .Subject = TxtSubj .Body = txtBody <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> k = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">To</span></span> <span class="hljs-built_in"><span class="hljs-built_in">UBound</span></span>(Path2Att) - <span class="hljs-number"><span class="hljs-number">1</span></span> .Attachments.Add Path2Att(k), olByValue DoEvents <span class="hljs-keyword"><span class="hljs-keyword">Next</span></span> k .Send <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">With</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> olMailMessage = <span class="hljs-literal"><span class="hljs-literal">Nothing</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Next</span></span> i</code> </pre><br>  If desired, the .Send method can be replaced by .Save.  Then the created letters will be in the Drafts folder. <br><br>  Here is the complete code of the module "as is". <br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="vbscript hljs">Attribute VB_Name = <span class="hljs-string"><span class="hljs-string">"Module"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span> ReadTXTfile(<span class="hljs-keyword"><span class="hljs-keyword">ByVal</span></span> filename As <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>) As <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> FSO = <span class="hljs-built_in"><span class="hljs-built_in">CreateObject</span></span>(<span class="hljs-string"><span class="hljs-string">"scripting.filesystemobject"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> ts = FSO.OpenTextFile(filename, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-literal"><span class="hljs-literal">True</span></span>): ReadTXTfile = ts.ReadAll: ts.Close <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> ts = <span class="hljs-literal"><span class="hljs-literal">Nothing</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> FSO = <span class="hljs-literal"><span class="hljs-literal">Nothing</span></span> <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span> ReadTXTfile2Arr(<span class="hljs-keyword"><span class="hljs-keyword">ByVal</span></span> filename As <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>) As Variant <span class="hljs-keyword"><span class="hljs-keyword">Const</span></span> OpenFileForReading = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Const</span></span> OpenFileForWriting = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Const</span></span> OpenFileForAppending = <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Const</span></span> vbSplitAll = <span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> S As Variant <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> FSO = <span class="hljs-built_in"><span class="hljs-built_in">CreateObject</span></span>(<span class="hljs-string"><span class="hljs-string">"Scripting.FileSystemObject"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> FSOFile = FSO.GetFile(filename) <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> TextStream = FSOFile.OpenAsTextStream(OpenFileForReading) <span class="hljs-keyword"><span class="hljs-keyword">Do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">While</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Not</span></span> TextStream.AtEndOfStream S = S &amp; TextStream.ReadLine &amp; vbNewLine <span class="hljs-keyword"><span class="hljs-keyword">Loop</span></span> TextStream.Close ReadTXTfile2Arr = <span class="hljs-built_in"><span class="hljs-built_in">Split</span></span>(S, vbNewLine, vbSplitAll, vbTextCompare) <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> TextStream = <span class="hljs-literal"><span class="hljs-literal">Nothing</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> FSOFile = <span class="hljs-literal"><span class="hljs-literal">Nothing</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> FSO = <span class="hljs-literal"><span class="hljs-literal">Nothing</span></span> <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Sub</span></span> Autosender() <span class="hljs-comment"><span class="hljs-comment">'      (   ), '     '    ( ) Dim Path2Body As String Dim Path2To As String Dim Path2Att() As String Dim Item2To() As String Dim TxtSubj As String Dim txtBody As Variant Dim i Dim k Dim vrtSelectedItem As Variant Dim fd As FileDialog Dim olMailMessage As Outlook.MailItem Dim xlApp As New Excel.Application GenerateThis = False TxtSubj = InputBox(" ", "") If Len(Trim(TxtSubj)) = 0 Then Exit Sub End If Set fd = xlApp.FileDialog(msoFileDialogFilePicker) With fd .AllowMultiSelect = False .Title = "   " .Filters.Add " ", "*.txt", 1 If .Show = -1 Then For Each vrtSelectedItem In .SelectedItems Path2Body = vrtSelectedItem Next vrtSelectedItem Else Exit Sub End If End With Set fd = Nothing Set fd = xlApp.FileDialog(msoFileDialogFilePicker) With fd .AllowMultiSelect = False .Title = "   " .Filters.Add " ", "*.txt", 1 If .Show = -1 Then For Each vrtSelectedItem In .SelectedItems Path2To = vrtSelectedItem Next vrtSelectedItem Else Exit Sub End If End With Set fd = Nothing Set fd = xlApp.FileDialog(msoFileDialogFilePicker) With fd .AllowMultiSelect = True .Title = ",   " .Filters.Add " ", "*.*", 1 If .Show = -1 Then i = 0 ReDim Preserve Path2Att(i) For Each vrtSelectedItem In .SelectedItems Path2Att(i) = vrtSelectedItem i = i + 1 ReDim Preserve Path2Att(i) Next vrtSelectedItem Else Exit Sub End If End With Set fd = Nothing Set xlApp = Nothing txtBody = ReadTXTfile(Path2Body) Item2To = ReadTXTfile2Arr(Path2To) DoEvents '   'Debug.Print " " 'Debug.Print "-----------------" 'For i = 0 To UBound(Item2To) - 1 ' Debug.Print Item2To(i) 'Next i 'Debug.Print " " 'Debug.Print "-----------------" 'For i = 0 To UBound(Path2Att) - 1 ' Debug.Print Path2Att(i) 'Next i 'Debug.Print " " 'Debug.Print "-----------" 'Debug.Print TxtSubj 'Debug.Print " " 'Debug.Print "-----------" 'Debug.Print txtBody For i = 0 To UBound(Item2To) - 1 Set olMailMessage = Application.CreateItem(olMailItem) With olMailMessage DoEvents .To = Item2To(i) .Subject = TxtSubj .Body = txtBody For k = 0 To UBound(Path2Att) - 1 .Attachments.Add Path2Att(k), olByValue DoEvents Next k .Send End With Set olMailMessage = Nothing Next i MsgBox ".", vbInformation + vbOKOnly, "" End Sub</span></span></code> </pre><br></div></div><br><br>  In this example, the ability to send simple letters is implemented.  If you need to expand the possibilities, for example, make the text formatted, then you should move in the direction of Outlook.MailItem&gt; GetInspector&gt; WordEditor.  This, to put it mildly, complicates the code, but allows using the formatted Word document as the source of the letter text. <br>  You can also add processing for the ‚Äúintentional‚Äù absence of any component letter.  For example, implement sending without a topic, text or attachments.  Now the refusal from one of these elements will lead to interruption of the procedure. <br>  This code should, theoretically, also work in earlier versions of Microsoft Office.  Only the link to the Excel library will be changed. </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/185568/">https://habr.com/ru/post/185568/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../185550/index.html">Earned "Video Parliament"</a></li>
<li><a href="../185556/index.html">Open program for developers from Thalmic Labs (MYO)</a></li>
<li><a href="../185558/index.html">Arranging text selection in textarea</a></li>
<li><a href="../185562/index.html">Gypsum on 3d printer</a></li>
<li><a href="../185564/index.html">Oracle 12c Multitenant Architecture. New features for development and testing</a></li>
<li><a href="../185574/index.html">Petition against the "anti-piracy" law became available on the website "Russian Public Initiative"</a></li>
<li><a href="../185580/index.html">0+ / 18+ to bet or not?</a></li>
<li><a href="../185582/index.html">Statistics of space launches in the USSR and Russia according to Roscosmos</a></li>
<li><a href="../185584/index.html">Fedora 19 Schr√∂dinger's cat</a></li>
<li><a href="../185586/index.html">Spectralink KIRK KWS400. Budget, professional DECT solution</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>