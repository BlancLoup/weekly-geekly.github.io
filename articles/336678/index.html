<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we created the ATOL Online cash desk service</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="From July 1, 2017, in accordance with Law 54-FZ, all online payments using bank cards must pass through the cashier issuing electronic checks. This me...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we created the ATOL Online cash desk service</h1><div class="post__text post__text-html js-mediator-article">  From July 1, 2017, in accordance with Law 54-FZ, all online payments using bank cards must pass through the cashier issuing electronic checks.  This means that all online retail is borne by online trading - registration of cash registers, maintenance, replacement of fiscal drives, storage of old FNs.  The simplified option is not to purchase all the equipment, but to use the service on the rental of CCV and software.  We want to talk about how we invented and implemented our ATOL Online service, why we needed to break and re-build business processes, as well as about the project team itself and the principle of service operation.  For details - under the cat. <br><br><img src="https://habrastorage.org/web/5f0/9f3/952/5f09f3952fd94d0bae3f00b296dd60d3.jpg"><br><a name="habracut"></a><br>  The first beginnings of the service idea appeared in the middle of 2016, when, after analyzing the requirements of 54-, we began to look for a solution for the market, which had not previously used (although obliged) cash registers, online trading.  Companies that accept payment for content or goods via the Internet, as a rule, do not have their own infrastructure, but actively use cloud services.  For them, the appearance of a physical device that needs to be registered, connected, serviced is an extra headache. <br><br>  With experience in the development of cash registers, we made a prototype of the ATOL 42FS cash register, which can only be used for online payments.  It does not have a printing module, it is such a small box with a LED and two connectors. <br>  Cashier is.  But what next?  It needs to be somehow integrated, exploited, so that it works 24/7, 365 days a year, because online trading goes on around the clock. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/web/8aa/74a/432/8aa74a432fa647bc91ba71c15e7eb8a4.jpg"><br><br>  Both in online and offline commerce queues are possible.  They are always formed by buyers, but if in a stationary outlet people are distributed between different cash registers themselves, then in an online store a queue forms transactions and (in non-operating mode) it will have to be managed at the software level.  Like offline, if the queue is big and long, buyers turn around and leave without making a purchase, and online - long waiting for a response from the cash desk under heavy load will make it impossible to register a transaction.  All this affects the economy of business. <br><br>  The solution is the same - you need more cash registers.  Even a small company makes optimal use of at least 2 cash desks.  With a large number of purchases in the online store, smooth and comfortable work can be organized with the help of dozens of online cash registers.  We will tell about it in detail, but for now let us return to the ideas. <br><br>  Taking into account the recommendations of the major players in this market and payment services, we approached the idea of ‚Äã‚Äãsome kind of universal service, saving Internet entrepreneurs from most of the problems when switching to CCT.  In its finished form, it appeared by October; Yuri Yarkov and Eduard Bolmosov became its ideologues. <br><br>  For the company it was a completely new experience: the content of the data center, building a model of monthly payments, working with a large number of users. <br><br><h2>  Screaming in the wilderness </h2><br>  We faced a problem: the market was poorly informed about the innovations threatening it in the legislation.  Most did not know anything, and those who heard that 54-FZ concerns payments on the Internet, hoped that the law would not work, the deadlines would be postponed, ways would be found to work around it.  Even those events that were conducted by the Federal Tax Service and other structures, were primarily focused on the segment of offline trade, the Internet stood aside. <br><br>  At the beginning of the year, we realized that the market was not aware at all, and began active marketing communication, held several events.  We began to acquaint the market with the basics of the technical implementation of legislation, the so-called formats of fiscal documents, according to which this whole ecosystem works.  ATOL held a huge event on the RIF, a full-day seminar in four slots.  It seemed that we covered the entire market, but in fact we reached far from everyone. <br><br>  Awareness of the market that ‚Äúthe box office is needed, what to do?‚Äù Happened in June, and the peak came in the last two weeks before July 1.  In September, when the first penalties under the new law begin, the second wave will surely rise. <br><br><h2>  Service anatomy </h2><br><br>  ATOL Online can be divided into three components.  The first is the ATOL 42FS cash register as a device for fiscalization of payments. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/554/7e0/19c/5547e019c8b041e1bc335ac6afcfd815.jpg"></div><br>  The second is the infrastructure in which the cash offices are located.  We rent a data center with a Tier 3 fault tolerance level. Cash registers are mounted in assemblies; 48 cash desks are installed on a dual-unit basis.  They have 2 interfaces: USB is powered, Ethernet - control and data exchange. <br><br><img src="https://habrastorage.org/web/f9a/a77/22e/f9aa7722eea04e6d8af2fc413a4391bd.jpg"><br><br>  The third component is software, frontend and backend.  A frontend is a personal account through which the management of the service takes place: connecting to the service, authorizing, exchanging information necessary for fiscalization of the cash register.  The backend monitors the state of technology and controls load balancing.  After all, one legal entity can have both a cash desk, and 1000 or 10 thousand. <br><br><h2>  It is not enough one cash desk </h2><br>  Even for a small online store, one online ticket office is not enough.  It should work 24 hours a day, 7 days a week, and a cash register is a device that can sometimes break down, stop servicing, and require the replacement of a fiscal drive (FN). <br><br>  As soon as the company has a need for 100% availability of the operation of issuing electronic checks, since the risks of downtime for business are very high - it needs at least two cash registers.  The probability of failure of two cash desks is very low at the same time: we place them in a special way, we do not store them in one rack, in one assembly, they are spaced inside the data center. <br><br>  For companies with a large number of transactions become relevant restrictions associated with the work of the fiscal drive, which is located inside the cash registers.  This is a third-party design certified by the FSB with a crypto processor inside.  With FN associated bottlenecks in the work of the box office.  Below - a couple of major. <br><br>  <b>1. Work speed.</b>  FN is slow.  The total processing time per check is approximately 0.9 s.  But in practice, there are network delays from time to time, since the check has to be sent to the CRF and get an answer from it.  As a result, with the best possible scenario, you should not count on the speed of more than one check per second.  If the store has a higher load and only one cashier, a queue will be formed.  A request to form a check can be stored for up to five minutes, after which it ‚Äúfalls off‚Äù with a timeout.  If the store has 50 transactions per second, in the ideal case you need to install 50 cash registers.  We have a special <a href="http://online.atol.ru/">calculator</a> that can be used to calculate how many cash desks are necessary (and cost-effective) in order to provide the required throughput.  It is also necessary to lay a reserve for the exit of cash registers or maintenance.  Each defines the exact values ‚Äã‚Äãitself, but usually with a large number of cash desks, the ‚Äústock‚Äù is 10-15%. <br><br><img src="https://habrastorage.org/web/b19/984/2a0/b199842a08dc49609f4db252bbb21215.png"><br><br>  <b>2. Capacity FN.</b>  Fiscal drive can sign a limited number of documents.  Typical capacity - 250 thousand documents.  If such an FN is sent one document per second, it will be filled in 3 days.  At the same time, the length of the check and the quantity of goods in it do not matter, since the FN stores only the total amount, which occupies approximately 40 bytes.  Replacing the FN is a tax-related procedure, it requires re-registration and takes 1-2 days.  If you change these drives every two days, it will be impossible to work.  In order for the service not to stand idle, it makes sense to calculate the number of cash desks so that the FN replacement takes place once every few months, and it is better not more often than once every six months, and the cash desks stop for replacement by certain lots.  That is, so that the system was not overloaded and protected from failures. <br><br>  All major Internet companies put these risks into account when calculating and rent from us from 50 cash desks. <br><br><h2>  Internal startup </h2><br>  Everything was new for us: the project, the market, and the service.  The project required the processing of all internal business processes in the company and the organization of customer service.  Everything needed to be adapted and rebuilt for profit, as time was short. <br>  The creation of the ATOL Online service has become for the company an essentially internal start-up.  At the start of the project, the number of the team did not exceed 10 people.  Their forces in the first month was created a prototype.  When they saw the prospects, the team began to grow, now about 40 people are actively involved in the development of the service. <br><br>  Practically all divisions of the company are involved.  These are development, maintenance service, which was created specifically for this project, technical support, presale service, sales department, customer service, product line.  Even the production, which creates a box office. <br><br>  Everything was like in a startup: an uncharted market, the search and implementation of ideas, their testing for potential customers.  Used the Agile approach, the Kanban methodology.  At first, we talked to online shopping tops, defined their needs and expectations, collected feedback, realized that people really needed such a service. <br><br>  The moment when business owners believed in a startup happened in December, after the business plan was formed, the first iteration of the business model.  The main difficulty was related to the lack of reliable information on the volume of the e-commerce market.  Estimates vary greatly, from 20 to 100 thousand companies.  We took as a basis that companies that conduct business with cards on the Internet, about 40 thousand, and each of them need at least one box office.  Initially, a strongly pessimistic model was laid, but it also made it clear that this should be done. <br><br>  Developers are actively involved in the development of the service, people are still gushing ideas, they are pleased to participate in the creation of something historical, something that nobody has done before. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/qj7iVgbKPv0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br><h2>  Bloodless integration </h2><br>  Most concerns of the owners of Internet business raised issues of integration.  It required the most simple solution.  We have implemented several integration options directly from the CMS system and through payment services.  We have a single API for all, JSON REST, fairly simple to implement.  It is made according to all requirements of the standard of fiscal documents. <br><br>  With payment systems, everything is quite simple.  The site owner connects to our service, puts the cash register on the account, we fiscalize it, and at the final stage he receives the configuration file, there are 3 lines: group code, login, password.  The user sets this data to the payment service in his personal account, there are relevant parameters for input.  Everything, you can work. <br>  Now integration with the main players of the market: 14 CMS (1C-Bitrix, AdvantShop, NetCat, RetailCRM and others) and 19 payment services (for example, Yandex.Cassa, Robokassa, Internet acquiring from Sberbank and Tinkoff, etc.) <br><br><h2>  Perspectives </h2><br>  In the nearest plans for the development of the service - API modernization, support for the format of fiscal documents version 1.05, this will allow the user to correctly reflect information on advances, prepayments, gift cards.  In addition, we plan to expand the set of user functions available from the personal account: add the ability to perform manual operations on returns and corrections, such a mini-CMS, as well as information on service monitoring and detailed statistics on cash registers. <br><br>  There are many long-term plans, they can be divided into two blocks.  The first is the work to improve the efficiency and stability of the system.  The service should work like a clock.  The second block is related to the optimization of the client's work, the issues of automatic registration of cash registers in tax, automation of interaction with the CRF. <br><br>  There are ideas, a lot, you have to do.  After all, ATOL Online for a company is an opportunity to diversify its solutions, to bring them to the emerging market of Digital-technologies, to enter a different consumer class.  We have been developing cash registers for a long time and professionally, but we always wanted to do something more than just a piece of hardware, to give more service.  This is not only our path of development, but also of many other companies that want to grow and develop in the future, as the market requires: the consumer is changing, and the business too. </div><p>Source: <a href="https://habr.com/ru/post/336678/">https://habr.com/ru/post/336678/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../336668/index.html">Create Telegram bot on API.AI</a></li>
<li><a href="../336670/index.html">Corporate information: reality and fantasy</a></li>
<li><a href="../336672/index.html">How to read scientific articles: advice from scientists</a></li>
<li><a href="../336674/index.html">Why blockchain is not such a bad technology</a></li>
<li><a href="../336676/index.html">Where did the need for Threat Intelligence come from?</a></li>
<li><a href="../336680/index.html">Work with complex software: how to migrate the cash program and not "break" the store</a></li>
<li><a href="../336682/index.html">How to evaluate a job offer</a></li>
<li><a href="../336684/index.html">Quick Python performance test for computing tasks</a></li>
<li><a href="../336686/index.html">Boot from GPT disk from BIOS</a></li>
<li><a href="../336688/index.html">Ad render v.2.0. Book One. Overview</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>