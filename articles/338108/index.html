<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>5 rules for working with amounts</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In modern software it is often necessary to perform various operations with all sorts of money. However, until now I have not come across documentatio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">🔎</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">📜</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">⬆️</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">⬇️</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>5 rules for working with amounts</h1><div class="post__text post__text-html js-mediator-article">  In modern software it is often necessary to perform various operations with all sorts of money.  However, until now I have not come across documentation anywhere that summarizes the basic rules for presenting amounts and implementing financial calculations.  In this article I will try to formulate the rules that I made myself on the basis of personal experience. <br><br><img src="https://habrastorage.org/web/bba/8ed/1ec/bba8ed1ec7da43f9ab2df2cdde6dbaf3.jpg"><br><a name="habracut"></a><br><h3>  Do not use double </h3><br>  The fact that the storage of amounts can not use binary type floating point single precision float, everyone knows.  However, it is widely believed that double can be used instead of float.  Meanwhile, double is not much better. <br><br>  The fact is that in these types the number is represented as sums of degrees with a base of 2. While monetary amounts in all prices and documents are presented in decimal number system.  Most of the fractional numbers in the decimal number system do not have an exact representation in the form of a finite sum of powers of two. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Suppose the online store sells gloves for 599 rubles 99 kopecks.  This is what this number will look like in programs that use binary floating point types. <br><br><div class="spoiler">  <b class="spoiler_title">599.99</b> <div class="spoiler_text">  Java code <br><pre><code class="java">float f = 599.99f;
System.out.printf("float %s%n", new BigDecimal(f).setScale(6, BigDecimal.ROUND_DOWN));
double d = 599.99d;
System.out.printf("double %s%n", new BigDecimal(d).setScale(15, BigDecimal.ROUND_DOWN));
</code></pre><br>
  C#<br>
<pre><code class="cs">float f = 599.99f;
float fi = (long) f;
float fp = f - fi;
long fil = (long) fi;
long fpl = (long) (fp * 1000000);
Console.WriteLine("float {0}.{1}", fil, fpl);
double d = 599.99d;
double di = Math.Truncate(d);
double dp = d - di;
long dil = (long) di;
long dpl = (long) (dp * 1000000000000000);
Console.WriteLine("double {0}.{1}", dil, dpl);
</code></pre></div></div><br>
<code>float 599.989990<br>
double 599.990000000000009<br>
</code><br>
       ,         ,      .    float —  6- ,    double —  15-.<br>
<br>
                  .     ,            .         ,     .<br>
<br>
,              .  double    ,        .<br>
<br>
      ,        ,     .     :<br>
<br>
<div class="spoiler"><b class="spoiler_title">z = 599.99 . - 0.98 . - 599.00 . - 0.01 .</b><div class="spoiler_text">  Java<br>
<pre><code class="java">double z = ((599.99d - 0.98d) - 599.00d) - 0.01d;
if (z == 0d) {
    System.out.println("z == 0");
} else if (z &gt; 0d){
    System.out.println("z &gt; 0");
} else {
    System.out.println("z &lt; 0");
}
</code></pre><br>
<br>
  C#<br>
<pre><code class="cs">double z = ((599.99d - 0.98d) - 599.00d) - 0.01d;
if (z == 0d)
{
    Console.WriteLine("z == 0");
}
else if (z &gt; 0d)
{
    Console.WriteLine("z &gt; 0");
}
else
{
    Console.WriteLine("z &lt; 0");
}
</code></pre><br>
</div></div><br>
<br>
<code>z &lt; 0<br>
</code><br>
 double          10.  Java     BigDecimal,  C# — decimal.<br>
<br>
       ,      .    ,   ±,    (       )    ,        .<br>
<br>
<h3>    </h3><br>
      0.        ,    ,        ,       .           : «      », — : «    ».<br>
<br>
  ,         .      .<br>
<br>
,   ,  -,         .          .         .        -,   ,        -1500 .         ,       .   ,    ,          ,       .     3000 .         .         ,      ,       .<br>
<br>
          « »,           .  ,   .       ,       ,          ,         . , ,       ,     ,              ,      .        ,             .       ,         .   ,      ,     .        ,        .       ,       .<br>
<br>
  ,          .  , ,     ,    ,         .             .<br>
<br>
 ,    .      :   , , , , ,   . .     -     ,       .  ,       —   .<br>
<br>
  ,   ,    ,  .       ?      ?     ,      -    - .       ,     2 ,   ,   ,   : «   3500 ...», «… 20000» «  -,  -».<br>
<br>
<h3> —    ,   </h3><br>
      ,          .         .      ,  ,     /c,    .         .  —   ,    .      ,     .<br>
<br>
        ,    ,     .           . ,       BYR,    — BYN.    ,    10  ,     ,   1 BYN = 10 000 BYR.     BYB,   1 BYR = 1000 BYB.        ,      .<br>
<br>
          .       ,  .            .        3-  ISO-4217.<br>
<br>
<h3>   «»  «»</h3><br>
 «»  «» —   ,       .     ,        .         ,  .<br>
<br>
   « »,           ,   —    .    ,     « », «», «»  . .<br>
<br>
       .           .  ,      56.61 .?           ?    ,  , ,  1      - ,       ,   , ,      ,       ,        —  .  ,  , ,    «»  «»  ,    .      ,     ,   — .     «    15.75 .»,   ,    .<br>
<br>
   ,       ,  ,       ,        .     buySum, sellSum, buyPrice, sellPrice  . .,     .       ,       .<br>
<br>
 ,   ,          56   ?      ,      ,    .  ,  ,          ,  .<br>
<br>
, -     ? ,  ,   2 :         .<br>
<br>
      «»  «»      « »  « ».     ,     ,   —  .       «», «», «», «», «», «»  . .<br>
<br>
<h3>  —     </h3><br>
        :<br>
<img src="https://habrastorage.org/web/264/b11/613/264b11613b6042d0a790c54f9eedd358.png"><br>
<br>
      ?    ,        .<br>
<br>
  — OK.<br>
  — OK.<br>
 —?<br>
<br>
  ,     ,       .    ,    ,        ?       55.61 .     1500.00 .? ,         ./ ,  , -1/-2.<br>
<br>
   ,   «»     . ,      100  .     1-      2- .<br>
<br>
,  — -1/(-2 * )?<br>
<br>
      ,   ,      ,     .<br>
<br>
   « »    1$   56.61₽.<br>
   « »    58.79₽   1$.<br>
<br>
      ₽/$,    — $/₽.<br>
<br>
<img src="https://habrastorage.org/web/f0b/84b/282/f0b84b282c984eb7aa031df731e976f1.png"><br>
<br>
          .     .<br>
<br>
    100   52.79 ,      ,   .<br>
<br>
 ,    ,     - :<br>
<br>
<pre><code class="java">public final class ExchangeRate {
    public static final int PRECISION = 4;
    private final Sum clientGives;
    private final Sum clientTakes;

    public ExchangeRate(Sum clientGives, Sum clientTakes) {
        this.clientGives = clientGives;
        this.clientTakes = clientTakes;
    }
 
    public Sum exchange(Sum sum) {
        if (!sum.getCurrency().equals(clientGives.getCurrency())) {
            throw new IllegalArgumentException();
        }
        BigDecimal amount = sum.getAmount().mulitply(clientTakes.getAmount())
                .divide(clientGives.getAmount(), PRECISION, BigDecimal.ROUND_HALF_UP);
        return new Sum(amount, clientTakes.getCurrency());
    }
}
</code></pre></div><p>Source: <a href="https://habr.com/ru/post/338108/">https://habr.com/ru/post/338108/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../338098/index.html">We pull video from YouTube and distribute via WebRTC in real-time</a></li>
<li><a href="../338100/index.html">Remote desktop + distributed commands =?</a></li>
<li><a href="../338102/index.html">As I was interviewing for the position of Junior .Net Developer</a></li>
<li><a href="../338104/index.html">My experience in conducting Java courses for new employees</a></li>
<li><a href="../338106/index.html">Nuklear + - mini cross-platform GUI</a></li>
<li><a href="../338110/index.html">Do WAFs dream about statistical analyzers?</a></li>
<li><a href="../338114/index.html">The digest of interesting materials for the mobile developer # 221 (September 11-17)</a></li>
<li><a href="../338116/index.html">Reverse engineering of the first smart watch Seiko UC-2000</a></li>
<li><a href="../338118/index.html">How to write your first Linux device driver. Part 2</a></li>
<li><a href="../338120/index.html">Metrics in the software development process: GQM model</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>