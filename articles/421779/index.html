<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>OceanLotus: New Backdoor, Old Schemes</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The OceanLotus Group (aka APT32 and APT-C-00) is known for its attacks in East Asia. A number of studies on the group‚Äôs work were published last year,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>OceanLotus: New Backdoor, Old Schemes</h1><div class="post__text post__text-html js-mediator-article">  The OceanLotus Group (aka APT32 and APT-C-00) is known for its attacks in East Asia.  A number of studies on the group‚Äôs work were published last year, including <a href="https://www.cybereason.com/labs-operation-cobalt-kitty-a-large-scale-apt-in-asia-carried-out-by-the-oceanlotus-group/">CyberReason</a> documents, a <a href="https://www.fireeye.com/blog/threat-research/2017/05/cyber-espionage-apt32.html">FireEye</a> review, and a description of the watering-hole of the <a href="https://www.volexity.com/blog/2017/11/06/oceanlotus-blossoms-mass-digital-surveillance-and-exploitation-of-asean-nations-the-media-human-rights-and-civil-society/">Volexity</a> attack.  As we can see, the group updates the backdoors, infrastructure and infection vectors. <br><br>  OceanLotus continues to target companies and government agencies in East Asian countries.  According to ESET telemetry, OceanLotus‚Äôs priorities are in Vietnam, Laos, Cambodia and the Philippines. <br><br>  A few months ago, we discovered and analyzed one of their newest backdoors.  It implements several tools that make it difficult to analyze and avoid detection - they will be discussed in a post. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/4f/mf/dz/4fmfdzgqiqskqku5rz7eeprycti.jpeg"><br><br><a name="habracut"></a><h2>  Spread </h2><br>  To convince the victim to launch a malicious dropper, the attackers use different methods. <br><br><h3>  Dual extensions and fake application icons (Word, PDF, etc.) </h3><br>  There is a chance that droppers are distributed via email attachments.  We observed the following file names: <br>  - <code>Mi17 Technical issues - Phonesack Grp.exe</code> (Mi-17 - Russian helicopter model) <br>  - <code>Chi tiet don khieu nai gui saigontel.exe</code> (translated from Vietnamese - ‚Äúdetails of the claim sent to Saigontel‚Äù, Saigontel is a Vietnamese telecommunications company) <br>  - <code>Updated AF MOD contract - Jan 2018.exe</code> <br>  - <code>remove_pw_Reschedule of CISD Regular Meeting.exe</code> <br>  - <code>Sorchornor_with_PM_-_Sep_2017.exe</code> <br>  - <code>20170905-Evaluation Table.xls.exe</code> <br>  - <code>CV_LeHoangThing.doc.exe</code> (fake resumes were also found in Canada) <br><br>  All of these files have something in common - launching a password-protected bait document.  It is unclear whether somewhere in the data of the transmitted letter is a password, or the document should not open. <br><br><h3>  Fake installers </h3><br>  Several fake installers pretending to be installers or software updates were seen in watering hole campaigns.  One example is the repackaged Firefox installer described by 360 Labs on <a href="http://www.freebuf.com/articles/others-articles/153666.html">Freebuf</a> (in Chinese). <br><br>  Another sample we saw was called <code>RobototFontUpdate.exe</code> .  It probably spread through compromised sites, but we do not have sufficient evidence of this. <br><br>  All described files, whether they were distributed via mail or downloaded when visiting a compromised site, delivered the same backdoor component.  In the post, we will analyze the sample of <code>RobototFontUpdate.exe</code> and show how it manages to execute the malicious payload in the system. <br><br><h2>  Technical analysis </h2><br>  The installation and execution process depends on multi-layer obfuscation, namely, component encryption, PE file reconstruction, shell-code loading and side-loading technology (fill).  The latter was described in a previous ESET study on the <a href="https://www.welivesecurity.com/2014/11/12/korplug-military-targeted-attacks-afghanistan-tajikistan/">Korplug</a> . <br><br><h3>  Review progress </h3><br>  The attack consists of two parts: the dropper and the launcher.  Each step of each part of the process will be explained in detail in the appropriate section.  The two schemes below provide a brief overview of the overall progress of malware. <br><br><img src="https://habrastorage.org/webt/yn/wa/jd/ynwajd8empdclmahz0mzaarmpxk.png"><br>  <i>Figure 1. Dropper progress</i> <br><br><img src="https://habrastorage.org/webt/gv/ba/jb/gvbajbzaqzd6tmrjpj95nkov-j8.png"><br>  <i>Figure 2. Backdoor progress</i> <br><br>  Almost all of these components are obfuscated.  Obfuscation is based on teams of a pair of complementary conditional transition.  For each of the forms: JZ / JNZ, JP / JNP, JO / JNO, and so on, each pair makes the transition to the same goal.  The sequence is interspersed with garbage code that uses the stack pointer, but does not change the value of the conditional flag.  It turns out that the transition takes place within one branch.  This leads to problems in the decompilation process due to the use of positive values ‚Äã‚Äãof the stack pointer. <br><br><img src="https://habrastorage.org/webt/lh/y6/an/lhy6anvm_1feplhj7depx1udiiu.png"><br>  <i>Figure 3. Complementary conditional transition</i> <br><br>  In addition, some basic program elements add one address to the stack, and then end on a JMP / CALL, while other basic elements add two addresses and end with the RET command.  The second addition of the element is the called function, and the first is the address of the next basic program element where the transition will be made.  Thus, the basic elements of the program are created without parent objects. <br><br><img src="https://habrastorage.org/webt/jc/5j/dw/jc5jdw3rbtwezkp4ylemfursggw.png"><br>  <i>Figure 4. PUSH / JMP Technique</i> <br><br>  As a result of a combination of two obfuscation techniques, ‚Äúbeautiful‚Äù graphics are obtained: <br><br><img src="https://habrastorage.org/webt/3l/pe/3x/3lpe3x_ccjdkh9rm0rpxyykztf0.png"><br>  <i>Figure 5. Obfuscating the run sequence</i> <br><br>  It's easy to notice the trash code.  It can be ignored when analyzing samples, if you know the scheme of application. <br><br><h2>  Dropper </h2><br><h3>  Stage 1. Bait Document </h3><br>  In recent months, OceanLotus used several baits.  One of them is the fake font update software <code>Roboto Slab regular</code> TrueType.  Font selection seems a bit strange, as it does not support many East Asian languages. <br><br><img src="https://habrastorage.org/webt/2p/p8/sm/2pp8sm8gjt15kzqakmyooah1pk8.jpeg"><br>  <i>Figure 6. RobototFontUpdate font update icon</i> <br><br>  When executing, a binary file decrypts its resources (XOR, 128 bytes, hard-coded key) and recovers decrypted data (LZMA).  Legitimate RobotoSlab-Regular.ttf file <br><br>  (SHA1: <code>912895e6bb9e05af3a1e58a1da417e992a71a324</code> ) is written to the <code>%temp%</code> folder and is launched using the Win32 API function <code>ShellExecute</code> . <br><br>  The shellcode is executed, decoded from resources.  After performing the fake font update, it injects another application, whose sole purpose is to remove the dropper.  This "erase" application is implemented as <code>%temp%\[0-9].tmp.exe</code> . <br><br><h3>  Stage 2. Shell Code </h3><br>  The same shellcode is applied at each stage. <br><br>  Shell code - custom PE loader.  It restores the executable file in memory - decrypts all sections and calculates the necessary movements and other indents.  Shell code uses three Windows API functions: <code>VirtualAlloc</code> , <code>RtlMoveMemory</code> and <code>RtlZeroMemory</code> . <br><br>  The <code>RtlZeroMemory</code> function <code>RtlZeroMemory</code> used to reset fields in the PE header.  It is impossible to rely on automatic memory dump, because the MZ / PE headers are damaged. <br>  The shell code calls the input function in the decrypted PE, and then the export function <code>DLLEntry</code> . <br><br><h3>  Stage 3. Real Dropper </h3><br> <code>{103004A5-829C-418E-ACE9-A7615D30E125}.dll</code> <br>  This executable file decrypts resources using the AES algorithm in CBC mode through the Windows API.  Hard-coded key has a size of 256 bits.  After decryption, the compressed data is unpacked (LZMA algorithm). <br><br>  If the process is run as an administrator, the malware ensures persistence by creating a service.  Otherwise, the classic Run registry key is used ( <code>HKCU\SOFTWARE\Microsoft\ Windows\CurrentVersion\Run;DeviceAssociationService;rastlsc.exe</code> ). <br><br>  If the dropper code is executed with administrator rights, it tries to write the files listed below into the folder <code>C:\Program Files\Symantec\Symantec Endpoint Protection\12.1.671.4971.104a\DeviceAssociationService\</code> , if not, it writes them to the <code>%APPDATA%\Symantec\Symantec Endpoint Protection\12.1.671.4971.104a\DeviceAssociationService\</code> folder <code>%APPDATA%\Symantec\Symantec Endpoint Protection\12.1.671.4971.104a\DeviceAssociationService\</code> : <br><br>  - <code>rastlsc.exe</code> (SHA1: <code>2616da1697f7c764ee7fb558887a6a3279861fac</code> , copy of the legitimate Symantec Network Access Control application, <code>dot1xtra.exe</code> ) <br>  - <code>SyLog.bin</code> (SHA1: <code>5689448b4b6260ec9c35f129df8b8f2622c66a45</code> , encrypted backdoor) <br>  - <code>rastls.dll</code> (SHA1: <code>82e579bd49d69845133c9aa8585f8bd26736437b</code> , malicious DLL that is being <code>rastlsc.exe</code> by <code>rastlsc.exe</code> ) <br><br>  The path varies from sample to sample, but the pattern is similar.  Depending on the rights, the malware resets files to <code>%ProgramFiles%</code> or <code>%appdata%</code> .  We also observed: <br><br>  - <code>\Symantec\CNG Key Isolation\</code> <br>  - <code>\Symantec\Connected User Experiences and Telemetry\</code> <br>  - <code>\Symantec\DevQuery Background Discovery Broker Tasks\</code> <br><br>  These paths are used by various Symantec products. <br><br>  After reaching persistence and implementing an executable file, a legitimate file, <br>  <code>rastlsc.exe</code> , executed using <code>CreateProcessW</code> . <br><br>  We also observed the version ( <code>{BB7BDEC9-B59D-492E-A4AF-4C7B1C9E646B}.dll</code> ), which executes <code>rastlsc.exe</code> with the <code>krv</code> parameter.  We will discuss in detail below. <br><br><h2>  Backdoor component: rastlsc.exe fill </h2><br>  The OceanLotus team uses an old and well-known technique in one of the Symantec executables.  The bottom line is to use the process of loading a legitimate and signed .exe library file by writing a malicious library into the same folder.  This will make the malicious behavior look legitimate, since these actions are performed during the operation of the trusted executable file. <br><br>  As mentioned above, the legitimate <code>rastlsc.exe</code> file is reset and executed. <br>  It imports the <code>rastls.dll</code> file, which in this case has malicious content. <br><br><img src="https://habrastorage.org/webt/jy/ga/ax/jygaaxccovxfilcmjrol9rmoklu.jpeg"><br>  <i>Figure 7. Digital signature rastlsc.exe from Symantec</i> <br><br>  We also saw a fill using other legitimate and signed executable files, including <code>mcoemcpy.exe</code> from McAfee, which loads <code>McUtil.dll</code> .  This technique was previously used by PlugX, which attracted the attention of <a href="http://ttcntt.com/Appcation/NotifyViewHome/bf811ad7-8232-4cb1-9e26-891e894bcfa1">Vietnam CERT</a> (in Vietnamese). <br><br><h3>  Stage 1. Filling the library, rastls.dll </h3><br>  The internal name of the dll file is <code>{7032F494-0562-4422-9C39-14230E095C52}.dll</code> , but we have seen other versions, for example, <code>{5248F13C-85F0-42DF-860D-1723EEAA4F90}.dll</code> .  All exported functions lead to the execution of the same function. <br><br><img src="https://habrastorage.org/webt/hg/1h/qm/hg1hqmssbsek8-kl8e7dkbzsotq.jpeg"><br>  <i>Figure 8. All rasltls.dll exports lead to the execution of a single function</i> <br><br>  The export tries to read the <code>SyLog.bin</code> file located in the same folder.  Other versions tried to open the <code>OUTLFLTR.DAT</code> file.  If the file exists, it will be decrypted using the AES algorithm in CBC mode with a hard-coded 256-bit key, and then the compressed data will be decompressed (LZMA compression). <br><br>  Option <code>McUtil.dll</code> uses a different technique.  At first glance, the main function does not perform anything malicious, but in fact it replaces the <code>.text</code> section of the legitimate <code>mcoemcpy.exe</code> file, a binary file.  It generates a shellcode whose task is to call a function to read the encrypted shellcode of the second stage from the <code>mcscentr.adf</code> file. <br><br>  To create a shellcode, use the following pseudocode: <br><br> <code>x = False i = 0 <br> buff = genRandom() <br> opc1 = [0x58,0x59,0x5a,0x5b] <br> opc2 = [0x50,0x51,0x52,0x53,0x54,0x55,0x56,0x57] <br> opc3 = [0x90,0x40,0x41,0x42,0x43,0x44,0x45,0x46,0x47,0x48, <br> 0x49,0x4a,0x4b] <br> while i &lt; len(buff): <br> currentChar = buff[i] if currentChar &lt; 0xc8: <br> buff[i] = opc1[currentChar % len(opc1)] <br> else: <br> if x: <br> buff[i] = opc2[currentChar % len(opc2)] <br> else: <br> buff[i] = opc3[currentChar % len(opc3)] x = x == False <br> i+=1</code> <br> <br>  Below in the picture you can see the listing of the result of the assembly: <br><br><img src="https://habrastorage.org/webt/i8/4y/gg/i84yggcraq46pahxx_g5gzha4_y.png"><br>  <i>Figure 9. Generated shellcode</i> <br><br><h3>  Stages 2‚Äì4.  Shell Code Launcher and Shell Code Again </h3><br>  Shell code decrypts and loads the library <code>{E1E4CBED-5690-4749-819D-24FB660DF55F}.dll</code> .  The library loads resources and tries to start the DeviceAssociationService service.  The decrypted information also contains the shellcode.  The latter decodes the final stage: the backdoor. <br><br>  Option <code>{92BA1818-0119-4F79-874E-E3BF79C355B8}.dll</code> checks if <code>rastlsc.exe</code> executed with <code>krv</code> as the first parameter.  If yes, the task is created, and <code>rastlsc.exe</code> is executed again, but without this parameter. <br><br><h3>  Stage 5. Backdoor </h3><br> <code>{A96B020F-0000-466F-A96D-A91BBF8EAC96}.dll</code> <br> <br>  First, the malware tries to download its resources and decrypt them using the RC4 algorithm.  The resulting resources contain the data used to configure the backdoor.  The configuration format is easy to learn.  Using the Kaitai struct and its dumper structure, we get the following: <br><br><img src="https://habrastorage.org/webt/wv/sq/7r/wvsq7r5rn67px5msvrjogbnoelk.jpeg"><br>  <i>Figure 10. Configuration structure</i> <br><br>  <b>Note</b> : with the exception of the domain_encoding_str string and the httpprov library, data changes from sample to sample.  The registry keys are almost the same, but they have a similar scheme: <code>\HKCU\SOFTWARE\Classes\AppX[a-f0-9]{32}</code> , nothing remarkable. <br><br>  The malicious program receives the first 10 bytes of the username (UTF-16), korit them with a three-letter string <code>mutex_encoding_str</code> in UTF-16 and encodes in hexadecimal.  The result is used as the name of the mutex.  For example, for a user whose name begins with <code>abc</code> and a key in the form of <code>vwx</code> , the mutex will be <code>\Sessions\1\BaseNamedObjects\170015001b</code> . <br><br>  The backdoor includes a PE loader that loads the <code>HTTPProv.dll</code> library into memory, calls an entry point, and then calls the <code>CreateInstance</code> export function. <br><br><h3>  Communication </h3><br>  The backdoor uses the standard TCP communication protocol on port <code>25123</code> .  To obtain the IP address of the server, the backdoor first creates a specific DNS query. <br><br>  The malware selects one of the three domains from the configuration and adds a special subdomain, which is generated using two values.  The first value is the computer name within the length of 16 bytes.  The second is a four-byte version ID.  The code in Python 2 below is a coding algorithm: <br><br> <code>letters=domain_encoding_str # ‚Äúghijklmnop‚Äù hex_pc_name=pc_name.encode(‚ÄúUTF-16LE‚Äù).encode(‚Äúhex‚Äù) s='' <br> for c in hex_pc_name: <br> if 0x2f &lt; ord(c) &lt; 0x3a: <br> s+=letters[ord(c) - 0x30] <br> else: <br> s+=c</code> <br> <br>  For example, if the computer name is <code>random-pc</code> , and the version ID is 0x0a841523, then the following domain is generated: <br> <code>niggmhggmeggmkggmfggmdggidggngggmjgg.ijhlokga.dwarduong[.]com</code> <br> <br>  For the C &amp; C server label of this backdoor, you can use the following regular expression: <br> <code>[ghijklmnopabcdef]{4-60}\.[ghijklmnopabcdef]{8}\.[az]+\.[az]+</code> <br> <br>  If the IP address belongs to a specific domain, malware tries to establish a TCP connection through port <code>25123</code> .  Each sample has three different domain names that are used to search for a C &amp; C server. <br><br>  The communication process is RC4 encrypted and compressed using LZMA.  It is possible to decrypt traffic, as the key is added to the beginning of the packets.  The format is as follows: <br> <code>[ RC4 (4 )][ ]</code> <br> <br>  Each key byte is generated by the <code>rand</code> function.  After decrypting and unpacking a packet, the data has the following format: <br> <code>[dw:][dw:][dw: ][dw: ][dw:] [dw:]</code> <br> <br>  The first time the client connects to the server, a UUID is sent, which is used as the session ID.  The latter is stored in the registry key as binary data: <code>HKCU\SOFTWARE\Classes\ AppXc52346ec40fb4061ad96be0e6cb7d16a\DefaultIcon</code> <br><br>  As we said earlier, the backdoor also contains a library called <code>HTTPprov</code> .  It is used as an alternative way to communicate with the server.  The DLL file sends a POST request via HTTP.  It also supports HTTPS and proxy usage of SOCKS5, SOCKS4a and SOCKS4.  The library is statically linked with <code>libcurl</code> . <br><br>  After initialization, an entry will be created in the registry - a command for the backdoor to further use HTTP to communicate with the command server: <code>HKCU\SOFTWARE\Classes\ CLSID{E3517E26-8E93-458D-A6DF-8030BC80528B}</code> . <br><br>  A standard client application is used: <code>Mozilla/4.0 ( ; MSIE 8.0; Windows NT 6.0; Trident/4.0)</code> . <br><br>  The main characteristic of this library is a special algorithm for encrypting the universal resource identifier.  The resource part of the URI is created using the following pseudocode: <br><br> <code>buffEnd = ((DWORD)genRand(4) % 20) + 10 + buff; while (buff &lt; buffEnd){ <br> b=genRand(16); <br> if (b[0] - 0x50 &gt; 0x50) <br> t=0; <br> else <br> *buf++= UPPER(vowels[b[1] % 5]); <br> v=consonants[b[1]%21]); if (!t) <br> v=UPPER(v); <br> *buff++= v; <br> if (v!='h' &amp;&amp; b[2] - 0x50 &lt; 0x50) <br> *buff++= 'h'; <br> *buff++= vowels[b[4] % 5]; <br> if (b[5] &lt; 0x60) <br> *buff++= vowels[b[6] % 5]; <br> *buff++= consonants[b[7] % 21]; <br> if (b[8] &lt; 0x50) <br> *buff++= vowels[b[9] % 5]; <br> *buff++= '-'; <br> }; <br> *buff='\0';</code> <br> <br>  <b>Note</b> : for clarity, the part responsible for checking the string length has been removed from the code. <br><br>  To obtain an identifier from the generated string, add two numbers using a special sum check algorithm: <br><br> <code>checksum=crc32(buff) <br> num2=(checksum &gt;&gt; 16) + (checksum &amp; 0xffff) * 2 <br> num1=(num2 ^ 1) &amp; 0xf <br> URL=GENERATED_DOMAIN+ ‚Äú/‚Äù + num1 + ‚Äú/‚Äù + num2 + ‚Äú-‚Äù + buff</code> <br> <br>  By adding the <code>HTTPprov</code> library URI generator, we get the following URL: <br> <code>hXXp://niggmhggmeggmkggmfggmdggidggngggmjgg.ijhlokga.aisicoin[.]com/ 13/139756-Ses-Ufali-L</code> <br> <br><h3>  Teams </h3><br>  After obtaining the SESSIONID session ID, the backdoor makes a digital fingerprint of the system.  The package is built as follows (indent in the package - description): <br><br>  <i>0x000</i> - byte: the value changes in each version <br>  <i>0x001</i> - 0x01: hardcoded byte <br>  <i>0x002</i> - bool: the presence of elevated privileges <br>  <i>0x003</i> - dword: version ID <br>  <i>0x007</i> - string (UTF-16), computer name (max. 0x20) <br>  <i>0x027</i> - string (UTF-16), username <br>  <i>0x079</i> - the result of the query on the registry in <code>HKLM\SOFTWARE\Microsoft\Windows NT\ CurrentVersion</code> values: <code>ProductName</code> , <code>CSDVersion</code> , <code>CurrentVersion</code> , <code>ReleaseId</code> , <code>CurrentBuildNumber</code> and the result of the call <code>IsWow64Process (x86|x64)</code> <br>  <i>0x179</i> - the subsequent format of the string% s (% s);  is replaced by ( <code>GetVolumeInformationW:VolumeNameBuffer</code> ), <code>VolumePathNames</code> <br>  <i>0x279</i> - Physical disk, control I / O device PhysicalDrive deviceIOControl 0x2D1400 (IOCTL_STORAGE_QUERY_ PROPERTY) (VolSerialNumber) <br>  <i>0x379</i> - wmi <code>SELECT SerialNumber FROM Win32_BaseBoard</code> <br>  <i>0x3f9</i> - Get the current date and time GetSystemTimeAsFileTime <br>  <i>0x400</i> - bool: unknown <br>  <i>0x401</i> - dword: received after decrypting a resource <br><br>  Here is an example of a digital fingerprint system: <br><br><img src="https://habrastorage.org/webt/s5/kg/rj/s5kgrj1nop52oeuj-xgop8c7zsa.jpeg"><br>  <i>Figure 11. Digital Fingerprint System</i> <br><br>  This is a full-fledged backdoor, which provides its operators with a number of possibilities: manipulating the file, registry and processes, loading additional components, obtaining a digital fingerprint of the system.  Below are the numbers and descriptions of supported commands: <br><br>  0 - digital print <br>  1 - sets the session ID <br>  2 - creating a process and getting a result (using software channels) <br>  3 - sets the count of connection attempts <br>  4 - postpones polling time <br>  5 - reads a file or registry key and counts MD5 <br>  6 - process creation <br>  7 - creates a file, registry entry or stream in memory <br>  8 - writes to the registry <br>  9 - polls the registry <br>  10 - looks for files in the system <br>  11 - transfers files to another directory <br>  12 - deletes files from disk <br>  13 - getting a list of disks marked up in the system using the function <br> <code>GetLogicalDriveStringW</code> <br>  14 - creates a directory <br>  15 - deletes the directory <br>  16 - reads file from offset <br>  17 - calls PE loader (transition to communication via <code>HTTPprov</code> ) <br>  18 - [Unknown] <br>  19 - 0: polling values ‚Äã‚Äãin the registry;  1: implementation and execution of the program <br>  20 - sets the environment variable <br>  21 - launches shellcode in new thread <br>  22 - returns the environment variable <br>  +23 in the new version - restarts itself if the APPL environment variable does not exist <br><br><h2>  Conclusion </h2><br>  OceanLotus remains highly active and continues to update the toolkit. <br>  The group seeks to hide its activities; to do this, attackers carefully select victims, limit the spread of malicious programs, use several servers in order not to draw attention to a single domain or IP address.  Deciphering the component being injected and the fill technique (side-loading), despite being widely known, avoids detection, since the work of intruders in this case is disguised as a legitimate application. <br><br><h2>  Compromise Indicators (IoCs) </h2><br><h3>  Samples </h3><br><h4>  Table 1: dropper </h4><br><img src="https://habrastorage.org/webt/4z/vz/kh/4zvzkhbbyci_fp6w6jyedbpn42i.png"><br><br><h4>  Table 2: Libraries </h4><br><img src="https://habrastorage.org/webt/0g/9i/2r/0g9i2rys-bufj_lmi9xqb7orl3g.png"><br><br><h3>  Network </h3><br><h4>  IP addresses </h4><br> <code>46.183.220.81 <br> 46.183.220.82 <br> 46.183.222.82 <br> 46.183.222.83 <br> 46.183.222.84 <br> 46.183.223.106 <br> 46.183.223.107 <br> 74.121.190.130 <br> 74.121.190.150 <br> 79.143.87.230</code> </div><p>Source: <a href="https://habr.com/ru/post/421779/">https://habr.com/ru/post/421779/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../421765/index.html">What is a web application in production?</a></li>
<li><a href="../421767/index.html">Miner offer to give the status of self-employed</a></li>
<li><a href="../421769/index.html">The book "Deep learning on R"</a></li>
<li><a href="../421773/index.html">As a team of techies created their company, season 3 (finally flew!)</a></li>
<li><a href="../421775/index.html">The neural network was trained to recognize depression from a person‚Äôs random speech without context.</a></li>
<li><a href="../421781/index.html">Yandex has deleted both pirated links and links to the sites of the copyright holder</a></li>
<li><a href="../421783/index.html">Fun State Management Huex Framework</a></li>
<li><a href="../421785/index.html">California is on the verge of a complete abandonment of carbon in energy production</a></li>
<li><a href="../421787/index.html">Design project architecture, ships and javascript</a></li>
<li><a href="../421789/index.html">Make frontend ‚Äúbackend‚Äù again</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>