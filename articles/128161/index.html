<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>HowTo cook custom Firefox msi for enterprise deployment</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The official position of mozilla on the msi distribution is expressed in the article . It is recommended to make FirefoxSetup.exe wrappers in msi, and...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>HowTo cook custom Firefox msi for enterprise deployment</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/b2ed499f/d4f34d60/fb9e7551/d2c99d2f.png" align="left">  The official position of mozilla on the msi distribution is expressed in the <a href="https://wiki.mozilla.org/Deployment:Deploying_Firefox">article</a> .  It is recommended to make <a href="https://wiki.mozilla.org/Installer:Command_Line_Arguments">FirefoxSetup.exe</a> wrappers in msi, and any distribution of non-original distributions is also prohibited.  But when using wrappers, all the advantages of msi are lost - autogeneration of rollback of changes being made, self-repair, it is more difficult to manage updates, deletions and patches.  The Mozilla bug tracker bug <a href="https://bugzilla.mozilla.org/show_bug.cgi%3Fid%3D231062"># 231062 Provide Firefox MSI package is</a> already 7 years old!  At the same time, Chrome has support for <a href="http://www.google.de/chrome/eula.html%3Fplatform%3Dwin%26msi%3Dtrue">msi</a> and <a href="http://www.chromium.org/administrators/policy-templates">GPO</a> built-in.  It is not surprising that a third-party build from FrontMotion <a href="http://www.frontmotion.com/FMFirefoxCE/download_fmfirefoxce.htm">Firefox Community Edition also</a> appeared for FF, which has its own features: <br>  [+] Applies policies set via <a href="http://sourceforge.net/projects/firefoxadm/">FirefoxAdm</a> , without the help of add.  extensions <br>  [+] Has its adm / admx extensions for the GPP console. <br>  [+] Flash plugins, IETab preinstalled <br>  [-] Browser recompiled, and it‚Äôs not a fact that, at the same time, no new features were added to it except for GPO) <br>  [-] The non-standard name of the shortcuts (Frontmotion Firefox) is used on the table and in the Start menu.  (what else can be circumvented through transforms for msi) <br>  [-] Another icon is used (from nightly branches) - black, which is critical for users who are looking for a red fox. <br>  [-] Automatic updates are not applied, since  its own assembly.  The update channel is set to default (special channel where there are no updates) <br><br>  If you are not satisfied with the minuses - it is proposed to use a paid <a href="http://store.frontmotion.com/FirefoxPackager/index.htm">service to build</a> packages.  I will describe how to build the package myself and get rid of the above-mentioned disadvantages. <br><a name="habracut"></a><br><ol><li>  We take the reference virtualka from the client OS, on which we will carry out the assembly.  Run <a href="">RegShot</a> and take a snapshot of the # 1 registry. <br></li><li>  We put the last Firefox.  And we take a snapshot of the # 2 registry, close the reports, we will return to them later. <br></li><li>  Put the plugins in FF: <br>  <a href="">Adblock Plus</a> - ad blocking <br>  <a href="">IETab</a> - allows you to open sites in the FF tabs using the IE engine.  Sometimes necessary for legacy intranet sites. <br>  <a href="">GPO for Firefox</a> - reads policy settings from the registry of the local machine, and applies them to FF ( <a href="http://ge.tt/8IUf6d7%3Fc">here is the</a> new version 0.9.3, added the application of the new settings) <br>  I also added another en-US.dic spellcheck files. <br></li><li>  Restart FF, set up Adblock on the update channel.  I also moved the adblock button up, removed the statusbar and the text menu.  Close FF. <br><img src="https://habrastorage.org/storage1/276b9d94/4f6cf9bb/df4809bb/30504416.png"><br></li><li>  These settings FF saved to the user profile - <br>  <i>% appdata% \ Mozilla \ Firefox \ Profiles \% rnd% .default \</i> <br>  Now we need to make these settings become the default settings for all new profiles.  To do this, create a default profile folder <br>  <i>C: \ Program Files \ Mozilla Firefox \ defaults \ profile</i> <br>  and copy there from the user profile: <br>  - folder adblockplus, if you put an adblock <br>  - file localstore.rdf, if the text menu was removed or the buttons were moved <br></li><li>  Create a <i>prefs.js</i> file in the default profile, and paste the following into it: <br><pre><code class="javascript hljs">user_pref(<span class="hljs-string"><span class="hljs-string">"browser.shell.checkDefaultBrowser"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); user_pref(<span class="hljs-string"><span class="hljs-string">"browser.startup.homepage"</span></span>, <span class="hljs-string"><span class="hljs-string">"ya.ru"</span></span>); user_pref(<span class="hljs-string"><span class="hljs-string">"browser.startup.homepage_override.mstone"</span></span>, <span class="hljs-string"><span class="hljs-string">"ignore"</span></span>); user_pref(<span class="hljs-string"><span class="hljs-string">"browser.startup.page"</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>); user_pref(<span class="hljs-string"><span class="hljs-string">"extensions.adblockplus.currentVersion"</span></span>, <span class="hljs-string"><span class="hljs-string">"1.3.9"</span></span>); user_pref(<span class="hljs-string"><span class="hljs-string">"extensions.ietab2.hasRun"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); user_pref(<span class="hljs-string"><span class="hljs-string">"extensions.ietab2.ietab2PrefsMigrated"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); user_pref(<span class="hljs-string"><span class="hljs-string">"extensions.ietab2.version"</span></span>, <span class="hljs-string"><span class="hljs-string">"3.5.9.1"</span></span>);</code> </pre> <br>  Here we are trying to ensure that the first opening does not open any other tabs and greetings other than the start page and do not have a question about the default browser.  Full description of all options FF <a href="http://kb.mozillazine.org/About:config_entries">here</a> . <br></li><li>  Now copy the plugins from the user profile, the <i>extensions</i> folder, to the folder <br>  <i>C: \ Program Files \ Mozilla Firefox \ extensions</i> <br>  A little bit about xpi plugins.  Starting with version 4, they, for execution, are not necessarily unpacked into a separate folder with a unique identifier.  And they can remain in their original form.  Therefore, in the plugins folder you see a mixture of folders and xpi files.  When copying to the <i>Mozilla Firefox \ extensions</i> folder, the plugin is installed globally.  Previously, this had to be done <br>  <i>firefox.exe -install-global-extension "% path-to-extension% \ extname.xpi"</i> <br>  You can read more - <a href="http://kb.mozillazine.org/Installing_extensions">here</a> . <br></li><li>  After copying plug-ins, you need to check their compatibility with the FF version.  To do this, you must open the <i>install.rdf</i> file in each and see the <i>&lt;em: maxVersion&gt;</i> parameter <i>.</i> I corrected the incompatible ones to 99. You need to open xpi plugins as a zip archive and also check and fix the <i>install.rdf</i> file inside as necessary. <br></li><li>  Now we erase the user profile, the entire folder. <br>  <i>% appdata% \ Mozilla \ Firefox \</i> <br>  and run FF.  We need to ensure that it opens without unnecessary tabs and questions.  The panels and menus were in the order we set, and all the added plugins were connected.  If the welcome tab of any plug-in opens, find the line in the <i>prefs.js</i> file, which determines that this plug-in has not yet started, and copy it to the default profile. <br></li><li>  But after each erasing the <i>% appdata% \ Mozilla \ Firefox \</i> folder and launching the browser, you are prompted to import the bookmarks.  To disable this, create a file. <br>  <i>C: \ Program Files \ Mozilla Firefox \ override.ini</i> <br>  with content: <br> <code>[XRE] <br> EnableProfileMigrator=false</code> <br> </li><li>  After you have started the first launch of the browser with an empty profile, you can proceed to the package in msi.  Run the <a href="http://www.witemsoft.com/togo/downloads/">wItem Installer</a> and create a new project.  We fill in the information on the <b>General Info</b> tab and select the installation of shortcuts for all users, not the current one. <br><img src="https://habrastorage.org/storage1/8cba36ea/016e9cc7/dd8025b1/451b3fa3.png"><br></li><li>  On the <b>Files</b> tab, drag-n-drop all the content from our folder <i>C: \ Program Files \ Mozilla Firefox \</i> <br></li><li>  On the <b>Shortcuts</b> tab, create <i>New shortcut for a file from the installation</i> for the <i>Desktop</i> and <i>Start Menu \ Programs</i> folders leading to <i>firefox.exe</i> <br></li><li>  On the <b>Registry</b> tab, we do <i>Import from a .reg file</i> .  But for this you need to prepare it.  We return to the reports from RegShot, take <i>* Redo.reg</i> , open it with a notepad and clean off unnecessary entries. <br>  If it is necessary to make FF the default browser for all users of the computer, then replace all occurrences of <i>HKEY_CURRENT_USER</i> with <i>HKEY_LOCAL_MACHINE</i> . <br>  We also replace all occurrences of <i>C: \\ Program Files \\ Mozilla Firefox</i> with <i>% AppDir%</i> so that the final folder name is <i>entered</i> after installation <br>  Another wItem takes a bit differently .reg files, so we also replace all <i>\ "</i> with <i>"</i> <br>  I got this file - <a href="http://pastebin.com/fGjsH8n4">pastebin.com/fGjsH8n4</a> <br></li><li>  On the <b>Custom Actions</b> tab, add such a task to register AccessibleMarshal.dll <br><img src="https://habrastorage.org/storage1/b11f0a9f/5bf6a8e6/4bd50361/546132cf.png"><br></li><li>  Build on the <b>Create Setup</b> tab.  There should be no Error, even the software version indicated in the wrong format will uninstall msi. <br></li><li>  We take <a href="http://www.frontmotion.com/FMFirefoxCE/download_fmfirefoxce.htm">adm \ admx files</a> , add GPP / PolicyDefinitions folder to the console, and configure the necessary browser settings.  For example, single sign-on ntlm (entry through the current domain account for the intranet) - <i>network.automatic-ntlm-auth.trusted-uris</i> <br></li><li>  In order for the browser auto-update to work under the user, you must give the rights to the folder <br>  <i>% ProgramFiles% \ Mozilla Firefox</i> <br>  This can be done both through GPO (Windows Configuration \ Security Settings \ File System), and with the help of Custom Actions, after the installation is completed.  For example: <br><pre> <code class="bash hljs">cacls <span class="hljs-string"><span class="hljs-string">"%AppDir%"</span></span> /t /e /p <span class="hljs-string"><span class="hljs-string">"builtin\"</span></span>:C cacls <span class="hljs-string"><span class="hljs-string">"%AppDir%"</span></span> /t /e /p <span class="hljs-string"><span class="hljs-string">"builtin\users"</span></span>:C</code> </pre> <br></li></ol><br>  PS <br>  * I changed <a href="http://ge.tt/8IUf6d7%3Fc">firefox.adm a</a> bit, added parameters for setting folder opening using links like <i>file: /// o: \ folder \ file</i> for network drives and intranet, as described <a href="http://kb.mozillazine.org/Links_to_local_pages_do_not_work">here</a> , but to apply the settings in FF, you need a <a href="http://ge.tt/8IUf6d7%3Fc">GPO v0.9.3 plugin</a> <br>  ** Ready firefox.msi can be downloaded <a href="http://ge.tt/8IUf6d7%3Fc">here</a> (for personal educational purposes only) <br><br>  <u>upd1: Updated</u> GPO for Firefox plugin.  Did not apply settings that are not yet in prefs and he cannot recognize their type.  Now applies as char to the default. </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/128161/">https://habr.com/ru/post/128161/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../128150/index.html">How long have you been in the project (taking part in the project)?</a></li>
<li><a href="../128156/index.html">Addition to ASP.NET MVC localization - We use routing</a></li>
<li><a href="../128157/index.html">Creation of another casual game on a Flash platform with physics. Part II</a></li>
<li><a href="../128158/index.html">The principle of operation of the digital compass</a></li>
<li><a href="../128159/index.html">Symfony2 \ SecurityBundle</a></li>
<li><a href="../128162/index.html">Does the network challenge you?</a></li>
<li><a href="../128164/index.html">Lazy webapp loading</a></li>
<li><a href="../128165/index.html">A small review of the laptop Asus K43Sv</a></li>
<li><a href="../128167/index.html">"Typesquatters" collected 20 GB of someone else's correspondence</a></li>
<li><a href="../128169/index.html">Simile TimeLine - a library for displaying events on a timeline</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>