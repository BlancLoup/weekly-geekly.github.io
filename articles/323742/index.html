<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>CrateDB: outside as PostgreSQL, and inside Elasticsearch</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="About one year has passed since my last publication about distributed database CrateDB. The project is based on Elasticsearch and PrestoDB written in ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>CrateDB: outside as PostgreSQL, and inside Elasticsearch</h1><div class="post__text post__text-html js-mediator-article">  About one year has passed since my last publication about distributed database CrateDB.  The project is based on Elasticsearch and PrestoDB written in Java.  During this time, it has been actively developing and acquiring new functionality in the <a href="https://github.com/crate/crate">github</a> repository: <br><br><ul><li>  support outer join; </li><li>  case when ... then ... end in requests; </li><li>  functions for working with spatial (Geospatial) data; </li><li>  it is possible to display time series data (Time Series) in Grafana; </li><li>  limited support for subqueries; </li><li>  cluster nodes operating in read-only mode; </li><li>  emulation of a PostgreSQL 9.5 protocol subset; </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/files/f30/188/6d8/f301886d88234ba391698f56e1422a22.png"></div><br>  A pleasant surprise was to find in the github project that the CrateDB team has a Russian-speaking developer <a href="https://github.com/kovrus">Ruslan</a> .  I quickly received a response from him to questions about the internal structure and dependencies of the project. <br><a name="habracut"></a><br>  When last time on Habr√© I talked about the peculiarities of working with queries in the article <a href="https://habrahabr.ru/post/274315/">"JOIN the dark side of the SQL"</a> , I mentioned the shortcomings of the native jdbc driver for crate and incomplete support for join operations.  These defects have been eliminated in recent versions (&gt; 1.0)! <br><br>  Now you can use the PostgreSQL jdbc driver, the pg command line utilities, and you do not need to pack a separate crate driver with the application.  This was made possible by partially <a href="https://crate.io/docs/reference/protocols/postgres.html">emulating wire</a> PostgreSQL 9.5 <a href="https://crate.io/docs/reference/protocols/postgres.html">protocol</a> on the server.  With an eye to the fact that transactions are not supported (therefore autocommit is set), authentication with any login / password is successful, SSL is not supported for connections and only UTF-8 character encoding is supported.  The COPY subprotocol pg and stored functions call subprotocol is not yet supported.  It should be remembered that the syntax of SQL queries and a subset of supported functions are specific to CrateDB. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Finally, the server has support for <a href="https://crate.io/docs/reference/sql/joins.html">Left, Right and Full Outer Join</a> .  Although the special scheduler optimizations are not applied and the join is implemented as a nested loop, but the filters are applied distributed - on each shard of the tables from the query. <br><br>  There was a <a href="https://crate.io/docs/reference/sql/scalar.html">strange syntax</a> in SELECT, resembling PL / SQL CASE: <br><br><pre><code class="sql hljs">CASE WHEN condition THEN result [WHEN ...] [ELSE result] <span class="hljs-keyword"><span class="hljs-keyword">END</span></span></code> </pre> <br>  With subqueries in FROM until the miracle happened.  Either sub-requests with aggregates are <a href="https://crate.io/docs/reference/sql/subselects.html">supported</a> , or requests that the parser can easily rewrite.  I hope that in a year the project will be surprised by the fact that complex subqueries will be available. <br><br>  The <a href="https://crate.io/docs/reference/sql/scalar.html">functions</a> distance, within, intersects, latitude / longitude are available for working with <a href="https://crate.io/docs/reference/sql/data_types.html">spatial data</a> in queries.  Work with geodata has long been in <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/geo-queries.html">Elasticsearch</a> , on the basis of which this distributed database was created. <br><br>  There is a data access plugin for <a href="https://grafana.net/plugins/crate-datasource">Grafana</a> .  You can draw graphs for monitoring data and telemetry stored in CrateDB. <br><br><img src="https://habrastorage.org/files/203/6fa/85d/2036fa85dc794f83b341d36d288d326a.png"><br><br>  You need to configure the connection parameters and specify the requests for data selection. <br><br><img src="https://habrastorage.org/files/83e/82f/f49/83e82ff499ea490198f367de412b4935.png"><br><br>  Downloading and starting CrateDB for experiments can be done like this: <br><blockquote>  java -jar <a href="">groovy-grape-aether-2.4.5.1.jar</a> <a href="https://raw.githubusercontent.com/igor-suhorukov/crate-io-installer/master/crate-io.groovy">https://raw.githubusercontent.com/igor-suhorukov/crate-io-installer/master/crate-io.groovy</a> <br></blockquote><br>  To run CrateDB 1.0.4, I used my <a href="https://github.com/igor-suhorukov/crate-io-installer/blob/master/crate-io.groovy">Groovy script</a> , which automatically installs the database in the user's home directory: <br><br><pre> <code class="hljs scala"><span class="hljs-meta"><span class="hljs-meta">@Grab</span></span>(group=<span class="hljs-symbol"><span class="hljs-symbol">'org</span></span>.codehaus.plexus', module=<span class="hljs-symbol"><span class="hljs-symbol">'plexus</span></span>-archiver', version=<span class="hljs-symbol"><span class="hljs-symbol">'2</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>') <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.codehaus.plexus.archiver.tar.<span class="hljs-type"><span class="hljs-type">TarGZipUnArchiver</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.github.igorsuhorukov.smreed.dropship.<span class="hljs-type"><span class="hljs-type">MavenClassLoader</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Grab</span></span>(group=<span class="hljs-symbol"><span class="hljs-symbol">'org</span></span>.codehaus.plexus', module=<span class="hljs-symbol"><span class="hljs-symbol">'plexus</span></span>-container-<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>', version=<span class="hljs-symbol"><span class="hljs-symbol">'1</span></span><span class="hljs-number"><span class="hljs-number">.6</span></span>') <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.codehaus.plexus.logging.console.<span class="hljs-type"><span class="hljs-type">ConsoleLogger</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">artifact</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-symbol"><span class="hljs-symbol">'crat</span></span>e' <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">version</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-symbol"><span class="hljs-symbol">'1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span>' <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">userHome=</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">System</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getProperty</span></span></span></span>(<span class="hljs-symbol"><span class="hljs-symbol">'user</span></span>.home') <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">destDir</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">File</span></span>(<span class="hljs-string"><span class="hljs-string">"$userHome/.crate-io"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crateIoDir=</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">File</span></span></span></span>(destDir, <span class="hljs-string"><span class="hljs-string">"$artifact-$version"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!crateIoDir.exists()){ destDir.mkdirs() <span class="hljs-type"><span class="hljs-type">String</span></span> sourceFile = <span class="hljs-type"><span class="hljs-type">MavenClassLoader</span></span>.using(<span class="hljs-string"><span class="hljs-string">"https://dl.bintray.com/crate/crate/"</span></span>).getArtifactUrlsCollection(<span class="hljs-string"><span class="hljs-string">"io.crate:$artifact:tar.gz:$version"</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>).get(<span class="hljs-number"><span class="hljs-number">0</span></span>).getFile() <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-type"><span class="hljs-type">TarGZipUnArchiver</span></span> unArchiver = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">TarGZipUnArchiver</span></span>() unArchiver.setSourceFile(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">File</span></span>(sourceFile)) unArchiver.enableLogging(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">ConsoleLogger</span></span>(<span class="hljs-type"><span class="hljs-type">ConsoleLogger</span></span>.<span class="hljs-type"><span class="hljs-type">LEVEL_DEBUG</span></span>,<span class="hljs-string"><span class="hljs-string">"Logger"</span></span>)) unArchiver.setDestDirectory(destDir) unArchiver.extract() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">proc</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-string"><span class="hljs-string">"$crateIoDir.absolutePath/bin/crate"</span></span>.execute() proc.consumeProcessOutput(<span class="hljs-type"><span class="hljs-type">System</span></span>.out, <span class="hljs-type"><span class="hljs-type">System</span></span>.err) proc.waitFor()</code> </pre><br>  Either run the database in the <a href="https://crate.io/docs/install/containers/docker/">Docker container</a> or a dozen <a href="https://crate.io/download/">other ways</a> . <br><br><h2>  Conclusion </h2><br>  When using <a href="https://crate.io/">CrateDB</a> in your project, you need to remember that first of all it is a distributed database based on Elasticsearch, so there will be no full-fledged <a href="https://ru.wikipedia.org/wiki/ACID">ACID</a> .  But if horizontal scalability is important, full-text search and the ability to execute SQL queries is an excellent candidate for storing project data.  The good news is that the project is developing in leaps and bounds and is available for use under the Apache 2.0 license. </div><p>Source: <a href="https://habr.com/ru/post/323742/">https://habr.com/ru/post/323742/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../323722/index.html">US Air Force uses IBM's neuromorphic chip to detect tanks and ground air defense systems</a></li>
<li><a href="../323724/index.html">Chronic Fatigue Syndrome. How hormones we get tired</a></li>
<li><a href="../323730/index.html">Predicting the future with the Facebook Prophet library</a></li>
<li><a href="../323734/index.html">Choosing the right imaging method according to the IBCS standard</a></li>
<li><a href="../323740/index.html">Asterisk and not only. Virtual file systems. Step back or two forward?</a></li>
<li><a href="../323744/index.html">Four main threats that allow you to turn IoT gadgets into an army of botnets</a></li>
<li><a href="../323746/index.html">Cach√© Containerization</a></li>
<li><a href="../323748/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ253 (March 6 - 12, 2017)</a></li>
<li><a href="../323750/index.html">PHP Digest number 104 - interesting news, materials and tools (March 1 - 12, 2017)</a></li>
<li><a href="../323752/index.html">Holographic displays: then and now</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>