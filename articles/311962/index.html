<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Developing a game in Unity3D under a gamepad</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="To work on the competition, the task was set: to design a small game about space, which the children will take about 8 minutes. And there was one thin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Developing a game in Unity3D under a gamepad</h1><div class="post__text post__text-html js-mediator-article"><p>  To work on the competition, the task was set: to design a small game about space, which the children will take about 8 minutes.  And there was one thing.  Children should be interesting! </p><br><p>  Since it was too pity to donate the keyboard to the control (and it is not so interesting), all management was planned to be done through the gamepad.  About how to fasten the gamepad in Unity3d and will be discussed. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/f6f/65b/d9e/f6f65bd9ebcf4de7b0d5455fca0c3702.png"></div><a name="habracut"></a><br><h2>  Little about the project </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/files/794/cf9/598/794cf95988c64d6aa57e907f2f1f875b.png"></div><br><p>  The first thing that came to mind about space was a controlled robot.  Developing this idea further, the game became about a robot that must find a battery on the Moon in order to charge the laser station and escape from the approaching comet.  Of course, everything had to be done on time (up to 8 minutes). </p><br><p>  (Surprisingly, the children liked the game, including management, but more on that below). </p><br><h2>  Cartography </h2><br><p>  To create a map with small back streets and a great match to the Moon, the map is the Terrain element, with mountains that are needed as obstacles and level limits. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/ef0/b5c/1aa/ef0b5c1aa19148b48ccce85c5e32b762.png"></div><br><p>  To keep the level long enough, the robot is in the opposite corner from the battery, which is extremely small to see from afar.  The size was not chosen randomly, because it does not allow to see the battery in advance from a distance. </p><br><h2>  Control </h2><br><h4>  Hand control </h4><br><p>  Since the robot has two hands, as well as the number of "fungi" in the gamepad, it is wise to use it. </p><br><p>  And here begins the complexity.  The fact is that the first "fungus" works (albeit with a creak) in the same way as "Mouse X" and "Mouse Y", but the second one didn‚Äôt respond by pressing.  Then, having sat down for Google, read about how Unity receives the input control data.  There lies the answer to the question of how to make the second (right) fungus work. </p><br><p>  Go to Edit ‚Üí Project Settings ‚Üí Input </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/3e2/615/675/3e26156752a34e868e2153f288172407.png"></div><br><p>  Clicked?  Then the InputManager should appear in the Inspector window. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/ced/fae/20d/cedfae20d3e441f7b6071678064348c9.png"></div><br><p>  At the beginning there will be 18 input parameters, but we need more.  Therefore, I have 22 (on the X axis and the Y axis for the second ‚Äúfungus‚Äù of the gamepad, and two more to isolate the name of the reference to the first ‚Äúfungus‚Äù). </p><br><p>  Further, by analogy with the mouse movement (Mouse X), we fill in and rename the new input values ‚Äã‚Äã(the name is extremely important, since you refer to it in the program). </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a8b/1d3/961/a8b1d3961e674a2f85dab693b3e03361.png"></div><br><div class="spoiler">  <b class="spoiler_title">Hand control code</b> <div class="spoiler_text"><p>  lp_right.transform.Rotate (0, Input.GetAxis ("Hor2_j"), 0); <br>  yr + = Input.GetAxis ("Hor2_j"); </p><br><p>  lp_right.transform.Rotate (Input.GetAxis ("Vert2_j"), 0, 0); <br>  xr + = Input.GetAxis ("Vert2_j"); </p><br><p>  lp_left.transform.Rotate (0, Input.GetAxis ("Hor_j"), 0); <br>  yl + = Input.GetAxis ("Hor_j"); </p><br><p>  lp_left.transform.Rotate (Input.GetAxis ("Vert_j"), 0, 0); <br>  xl + = Input.GetAxis ("Vert_j"); </p></div></div><br><h4>  Movement </h4><br><p>  It is worth remembering that moving along the coordinates will have a bad effect on the game, since the map is built on Terrain.  Therefore, it was decided to use physics.  This increases the interest of passage on the one hand, and on the other hand solves several problems at once (uneven movement, jumps, departure over fences). </p><br><p>  So, you need a Rigidbody, which you need to put on the robot, and then to your taste (the project has a weight of 100, the rest remains untouched). </p><br><p>  There will be only two foci in the code.  The first is GetComponent () to work with Rigidbody and Addforce.  The second is mathematical.  It is necessary not only to know where the robot wants, but also to know where it is looking.  To do this, we turn to transform.eulerAngles.y, translate into radians and take the cosine and sine for the x and z coordinates, respectively. <br><br><br></p><div class="spoiler">  <b class="spoiler_title">Move the robot</b> <div class="spoiler_text"><pre><code class="hljs pgsql">y=bot.<span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.eulerAngles.y*(Mathf.PI/<span class="hljs-number"><span class="hljs-number">180</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>.GetKey(KeyCode.JoystickButton4)||<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>.GetKey(KeyCode.JoystickButton0)) { s="Go_to"; bot.GetComponent&lt;Rigidbody&gt;().AddForce(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Vector3(Mathf.Cos(y),<span class="hljs-number"><span class="hljs-number">0</span></span>,-Mathf.Sin(y))*<span class="hljs-number"><span class="hljs-number">15</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>.GetKey(KeyCode.JoystickButton5)||<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>.GetKey(KeyCode.JoystickButton2)) { s="Go_back"; bot.GetComponent&lt;Rigidbody&gt;().AddForce(-<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Vector3(Mathf.Cos(y),<span class="hljs-number"><span class="hljs-number">0</span></span>,-Mathf.Sin(y))*<span class="hljs-number"><span class="hljs-number">15</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>.GetKey(KeyCode.JoystickButton6)||<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>.GetKey(KeyCode.JoystickButton3)) { s="Turn_left"; bot.<span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.Rotate(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">-0.5</span></span>f,<span class="hljs-number"><span class="hljs-number">0</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>.GetKey(KeyCode.JoystickButton7)||<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>.GetKey(KeyCode.JoystickButton1)) { s="Turn_right"; bot.<span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.Rotate(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0.5</span></span>f,<span class="hljs-number"><span class="hljs-number">0</span></span>); }</code> </pre> </div></div><br><p>  As you can see, there are two buttons in each action.  This is done in case the bumper (L1, L2, R1, R2) breaks / sticks during repeated use. </p><br><h2>  Time </h2><br><p>  To clarify the current time in Unity, you can use System.DateTime.Now to calculate in seconds how much time has passed since the beginning of the day.  This method of time limitation has a drawback - the clock transitions from 23:59 to 00:00, but since the game is played once and the competition will take place during the day, it can be neglected </p><br><div class="spoiler">  <b class="spoiler_title">And if you can not</b> <div class="spoiler_text"><p>  Two councils </p><br><ul><li>  Count along with the day, month and year.  When I saw this function in TurboC ++, which gives the number of seconds since January 1, 1970 </li><li>  Read about timers and caller functions in C #. </li></ul></div></div><br><p>  The time limit can then be considered as the time difference after the script is run (void Start ()) and what is now (Update) </p><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="hljs vbscript">void Start () { <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> = System.DateTime.<span class="hljs-built_in"><span class="hljs-built_in">Now</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">Hour</span></span> * <span class="hljs-number"><span class="hljs-number">3600</span></span> + System.DateTime.<span class="hljs-built_in"><span class="hljs-built_in">Now</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">Minute</span></span> * <span class="hljs-number"><span class="hljs-number">60</span></span> + System.DateTime.<span class="hljs-built_in"><span class="hljs-built_in">Now</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">Second</span></span>; } void Update () { win = PlayerPrefs.GetInt (<span class="hljs-string"><span class="hljs-string">"win"</span></span>); lose = PlayerPrefs.GetInt (<span class="hljs-string"><span class="hljs-string">"lose"</span></span>); t = System.DateTime.<span class="hljs-built_in"><span class="hljs-built_in">Now</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">Hour</span></span> * <span class="hljs-number"><span class="hljs-number">3600</span></span> + System.DateTime.<span class="hljs-built_in"><span class="hljs-built_in">Now</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">Minute</span></span> * <span class="hljs-number"><span class="hljs-number">60</span></span> + System.DateTime.<span class="hljs-built_in"><span class="hljs-built_in">Now</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">Second</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>((win+lose)==<span class="hljs-number"><span class="hljs-number">0</span></span>) PlayerPrefs.SetInt(<span class="hljs-string"><span class="hljs-string">"time"</span></span>,<span class="hljs-number"><span class="hljs-number">480</span></span>-(t-<span class="hljs-built_in"><span class="hljs-built_in">time</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>((<span class="hljs-number"><span class="hljs-number">480</span></span>-(t-<span class="hljs-built_in"><span class="hljs-built_in">time</span></span>))==<span class="hljs-number"><span class="hljs-number">0</span></span>) PlayerPrefs.SetInt (<span class="hljs-string"><span class="hljs-string">"lose"</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre> </div></div><br><h2>  Afterword </h2><br><p>  The children liked the game, as the robot moved with acceleration, which everyone enjoyed using. </p><br><p>  It was especially interesting to catch the battery before you bump into it, since it, too, Rigidbody and get the direction of movement.  In combination with the slow movement of hands, it turned out very well. </p><br><p>  I hope that this article will help you not to sit until late at night, screwing the gamepad to your project! </p><br><p>  <b>PS</b> Assembled, made and tested for Unity3d 5.0.  You can download the <a href="https://github.com/rlggut/Starbot">link</a> </p><p></p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/311962/">https://habr.com/ru/post/311962/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../311948/index.html">Chaos inside sudoku</a></li>
<li><a href="../311954/index.html">Hacker file: Phiber Optik</a></li>
<li><a href="../311956/index.html">Friendly design and a million new users: a year of experiments in Yandex.Money</a></li>
<li><a href="../311958/index.html">Security Week 40: systemd bug, 20 vulnerabilities in the D-Link router, breaking insulin pumps</a></li>
<li><a href="../311960/index.html">We are going to the southern city: how do developers live in Rostov-on-Don</a></li>
<li><a href="../311964/index.html">Universal (isomorphic) ‚Äúhelmet‚Äù for React js or How convenient to work with head on React js</a></li>
<li><a href="../311968/index.html">Chrome redesign on the desktop</a></li>
<li><a href="../311970/index.html">Women and murder: is there a relationship here? [part 1 of 2]</a></li>
<li><a href="../311976/index.html">Experience using AWS ECS in our infrastructure</a></li>
<li><a href="../311978/index.html">Summary table of taxiway FSTEC (to protection profiles) in order and in the context of the vultures</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>