<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hot reboot of components in React</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I have two favorite queries in google: 

 - What will happen if you throw scrap at the train toilet at full speed? 
 - What will happen if the compone...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Hot reboot of components in React</h1><div class="post__text post__text-html js-mediator-article">  I have two favorite queries in google: <br><br>  - What will happen if you throw scrap at the train toilet at full speed? <br>  - What will happen if the component is replaced at full speed in the reactor? <br><br>  And if with the first question everything is more or less clear, then with the second question everything is not so simple - Webpack-dev-server, Hot Module Replacement, and React-Hot-Loader immediately come out. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And everything would be fine, but this explosive mixture simply does not work, stumbling on the very first complex code, HOC, composition, decorator and native arrow functions. <br><br>  In general, the third version of the Reac-hot-loader did not start at all. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ho/9o/xq/ho9oxqgnpzq04iqs45bilajyfpq.png"></div><br><a name="habracut"></a><br><h2>  Preamble </h2><br>  In fact, version 3 had 3 problems: <br><br>  - react-proxy, which was used to "replace" the old version of the new component, and which was not at all friendly with the arrow functions, to which the context is nailed tightly. <br>  - to ensure the work of bound and transpiled arrow functions, the babel plugin wrapped them in intermediate functions.  Given the fact that he did this for ALL classes - this often led to breakdowns.  Those in general, everything did not work. <br>  - the principle of the search and substitution of components.  For this, the babel plugin was used, which ‚Äúregistered‚Äù all the top-level variables, so that later it could be understood that ‚Äúthis is the variable‚Äù, in fact, ‚ÄúBig Key‚Äù and the proxy should be updated. <br><br>  Everything is good, but the HOC can create a class within itself, and the decorator simply "decorates" the real variable.  As a result, the render reactor will meet the ‚Äúcompletely new‚Äù class at the place of the old one and spread out all the old wood. <br><br>  Popular <a href="https://github.com/parcel-bundler/parcel/issues/214">wisdom says</a> : <br><blockquote>  One of the most annoying things to set up with the Webpack is the Hotly working Module Module.  This means that the components will keep their local state.  Everything else makes HRM uselss (in my opinion). </blockquote><br>  In other words - without a normal preserve state, this RHL is not needed. <br><br>  My journey to RHL began six months ago, when I tried for about a week (a lot) trying to understand how all these years people used React-hot-loader, because using it was unbearably painful.  He brings nothing but pain.  And then he opened PR, which silently began to suggest why and where the RHL will unmount the component, so that people can finally understand why it is not working.  In order to somehow smooth the mental suffering. <br><br>  And then I decided to fix everything on the vine. <br><br><h2>  Meet version 4! </h2><br>  I'll be brief - version 4 works almost always.  She still has limitations that stem from the very nature of the phenomenon, but these ‚Äúmistakes‚Äù are a guarantee of the correctness of the work.  You can try now, just upgrade to version 4 of RHL. <br><br><h2>  What is HMR, RHL and all that? </h2><br>  <b>HMR</b> - hot swap modules.  Built-in webpack and parcel mechanism that allows you to update individual modules on the client, when they change on the server.  Just do not forget - this is only about the development.  Without additional gestures silently refreshes the page. <br><br>  <b>RHL</b> - react-hot-loader, a set of measures aimed at ensuring that React simply re-rendered the updated element and did nothing more. <br><br>  RHL is something that provides the ‚Äúright‚Äù HMR as it is needed. <br><blockquote>  There is <a href="https://twitter.com/giltayar/status/942667594951208960">an alternative theory</a> that says HMR leads to monkey-patch, better TDD, BDD and all that.  And there is such a big drop of truth in it. </blockquote><br><h2>  Differences from version 4 to version 3 </h2><br>  1. Instead of react-proxy, the <a href="https://github.com/gaearon/react-hot-loader/tree/next/packages/react-stand-in">react-stand-in</a> is used - a slightly more ‚Äújavascript‚Äù solution.  The main difference - standin is not a "wrapper", and not a proxy - this is a class that is <b>inherited</b> from the real one. <br><blockquote>  This is a very tricky moment - when the time comes to replace one component with another - standin will simply change the prototype for itself (more precisely, the prototype of its prototype). <br>  The result is that this never changes. <br></blockquote><br>  The second tricky moment is the transfer of changes made in the constructor (including those added to the constructor by the babel).  Standin instantiates the old and new class, after which it looks for changes and tries to repeat them. <br><br>  As a result, after updating the components, all changes are applied, <u>except for those</u> made in componentWill / DidMount.  Because mount / unmount did not occur, and it was precisely this that was required to be avoided. <br><br>  2. Instead of ‚Äúregistrations‚Äù that are not friendly with HOC and decorators, a mechanism called ‚ÄúhotReplacementRender‚Äù is used. <br><br>  When the time comes to ‚Äúupdate‚Äù, the React-Hot-Loader component saves the old tree, and starts <u>to</u> render the new one. <br><br>  After the rendering of each element comes the time of "comparison" of old and new data, in fact, reconsiler. <br><blockquote>  If the new component is ‚Äúvery similar‚Äù to the old one - perhaps this is it, and a replacement can be made. </blockquote><br>  This approach easily breaks through any compositions, decorators, and any render-props in general.  The only thing that does not survive is the change in the number or order of the children (if the key is not set), but this follows from the very nature of React. <br><br>  3. Previously, many people stumbled over the moment HRM and RHL settings were configured.  In the new version, the entire setting is limited to the _one_ command. <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {hot} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-hot-loader'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MySuperApplication = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> ...... export <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> hot(<span class="hljs-built_in"><span class="hljs-built_in">module</span></span>)(MySuperApplication); <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">-----</span></span></span></span></span></span></code> </pre> <br>  The <b>hot (module) magic (MySuperApplication)</b> will automatically configure the HMR for the current module, and the HOC portion of this function will wrap the MySuperApplication into the AppContainer. <br><br>  EVERYTHING!  (Plus babel-plugin don't forget) <br><br>  Where does it work?  Everywhere - Webpack, parcel, typescript (babel-plugin do not forget).  <a href="https://github.com/gaearon/react-hot-loader/tree/next/examples">There are examples</a> for everything. <br><br><h2>  Features of work, about which it is better to know </h2><br>  1. RHL v3 wrapped only ‚Äúregistered" components in a proxy.  v4 wraps up everything.  Theoretically, this should not affect the performance, but anything can happen. <br><br>  2. Hot configures the current module as self accepted.  Here we must understand that nothing but ‚Äúreactant components‚Äù that RHL can survive to export from a module cannot be. <br><br>  Standard errors now: <br><br>  - use hot for local variables or even in the render (detectable and swear) <br>  - use hot for HOC and functions - silently everything breaks down. <br><br>  Hot - only for components. <br><br>  3. If you start a timer in componentDidMount, and then change the function that this timer calls, it will not be updated.  Because setTimeout has already received a reference to a function, and you cannot change it. <br><br>  4. Code splitting - it is required either to wrap each component in hot which you are going to dynamically load, then it will update itself, or use a bootloader that is familiar with HMR / RHL. <br><br>  - The popular <a href="https://github.com/thejameskyle/react-loadable">react-lodable</a> is not suitable in principle.  If you have it - no other options, cut how to wrap the components in hot - no.  (do not forget that this does not affect the production) <br><br>  - <a href="https://github.com/smooth-code/loadable-components">loadable-components is a</a> little better - they will try to update the file, but there may be problems, since ‚ÄúhotReplacementRender‚Äù will already be turned off when the import is triggered. <br><br>  - 100% <a href="https://github.com/theKashey/react-imported-component">react-imported-component</a> works well, as it wraps the rendered component in AppContainer, and this ‚Äúsaves‚Äù the situation, but its SSR is a bit <i>specific</i> , and not suitable for everyone. <br><br>  5. I think this is not the end. <br><br>  React-hot-loader is not a silver bullet - but rather a highly specialized tool that can be very useful.  It may not be. <br><br><h2>  Time to try? </h2><br>  Right now we are close to the release of the RC version.  Trite there are no more bugs to fix and add features.  Only a little code coverage increase. <br><br>  Now is the time to install RHL yourself, and try it out.  And report all the problems that arise (of course!) Should not: D <br><br>  In general - the fire! <br><blockquote>  <a href="https://github.com/gaearon/react-hot-loader/tree/next">github.com/gaearon/react-hot-loader/tree/next</a> <br>  npm install react-hot-loader @ next </blockquote></div><p>Source: <a href="https://habr.com/ru/post/346142/">https://habr.com/ru/post/346142/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346132/index.html">Stimulus 1.0: a modest JavaScript HTML framework that you already have</a></li>
<li><a href="../346134/index.html">Genetic algorithm for constructing algorithms</a></li>
<li><a href="../346136/index.html">L√ñVE Development</a></li>
<li><a href="../346138/index.html">Game Design Techniques: Mixing</a></li>
<li><a href="../346140/index.html">Results of the development of computer vision in one year</a></li>
<li><a href="../346144/index.html">Mobile devices from the inside. Memory markup, file structure description and markup memory</a></li>
<li><a href="../346146/index.html">Python, under the pirate flag</a></li>
<li><a href="../346148/index.html">Configure Azure Application Insights for diagnosing software with microservice architecture</a></li>
<li><a href="../346152/index.html">The head of Intel suspected of selling the company's shares at $ 24 million due to the vulnerability of processors</a></li>
<li><a href="../346154/index.html">Simplify ReactJS Components with RxJs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>