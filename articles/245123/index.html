<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Oracle, SQL * Net or ORDER BY saves network resources ...</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Everyone rightly believes that the ORDER BY construction spends resources on sorting the result and as a result we should get the result a little late...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Oracle, SQL * Net or ORDER BY saves network resources ...</h1><div class="post__text post__text-html js-mediator-article">  Everyone rightly believes that the ORDER BY construction spends resources on sorting the result and as a result we should get the result a little later.  Is it always like this? .. <br><a name="habracut"></a><br>  Let's present a simple trivial query: <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> echo <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> linesize <span class="hljs-number"><span class="hljs-number">192</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> pagesize <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRIM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> trims <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> feedback <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">heading</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> term <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> timing <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> autot <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> stat spool s.txt <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> clnt_clnt_id, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>, start_date, end_date <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> client_histories; spool OFF exit</code> </pre> <br><br>  Everything seems simple: <br><ol><li>  the selection is made from the table </li><li>  the result is expelled to the file </li><li>  the result is not displayed on the terminal </li><li>  At the end of the request, the time and statistics are displayed. </li></ol>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Now take a look at the statistics: <br><br><pre> <code class="bash hljs">.: 00:00:17.97  ---------------------------------------------------------- 0 recursive calls 0 db block gets 6515 consistent gets 0 physical reads 0 redo size 14182576 bytes sent via SQL*Net to client 242558 bytes received via SQL*Net from client 22012 SQL*Net roundtrips to/from client 0 sorts (memory) 0 sorts (disk) 330154 rows processed</code> </pre><br><br>  Now imagine that we need to organize the data.  The question is - what will happen with time?  The first opinion - sorting will take some time and the result will come later.  What do we do: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> echo <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> linesize <span class="hljs-number"><span class="hljs-number">192</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> pagesize <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRIM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> trims <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> feedback <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">heading</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> term <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> timing <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> autot <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> stat spool s1.txt <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> clnt_clnt_id , <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> , start_date , end_date <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> client_histories <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>; spool OFF exit</code> </pre><br><br>  Now take a look at the statistics: <br><br><pre> <code class="bash hljs">.: 00:00:16.92  ---------------------------------------------------------- 0 recursive calls 0 db block gets 6115 consistent gets 0 physical reads 0 redo size 13166047 bytes sent via SQL*Net to client 242558 bytes received via SQL*Net from client 22012 SQL*Net roundtrips to/from client 1 sorts (memory) 0 sorts (disk) 330154 rows processed</code> </pre><br><br>  It turns out that when using order by, we get the result faster.  In statistics, we have only two differences - the time spent on the operation, and the amount of information transmitted via SQL * Net. <br><br>  One conclusion suggests itself - the sorting operation is faster by 33,000 lines than sending 992 kb data through the existing channel. <br><br>  But where did the difference come from? .. <br>  And the thing is that the data sent by sql * net is compressed and compressed by buffers.  This is affected by the size of the SDU in TNS SQL * Net description, as well as the size of the buffer configured in SQL * Plus using the ARRAYSIZE parameter, which defaults to 15. If the data is sorted, then the buffer contains more identical data and the compression percentage is higher.  So  less data is passed over SQL * Net. <br><br>  Let's experiment, namely make a small change to the second script: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> autot <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> stat <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> arraysize <span class="hljs-number"><span class="hljs-number">5000</span></span> spool s1.txt</code> </pre><br><br>  Now we have increased the buffer size to 5000 (this is the maximum) and executed the query with sorting.  Let's look at the result: <br><br><pre> <code class="bash hljs">.: 00:00:06.47  ---------------------------------------------------------- 0 recursive calls 0 db block gets 6115 consistent gets 0 physical reads 0 redo size 11278863 bytes sent via SQL*Net to client 1174 bytes received via SQL*Net from client 68 SQL*Net roundtrips to/from client 1 sorts (memory) 0 sorts (disk) 330154 rows processed</code> </pre><br><br><ul><li>  We have reduced the number of information transmitted to the client by another 1.8Mb </li><li>  We have reduced the number of information transmitted from the client 200 times (by 235kb) </li><li>  We reduced the number of roundtrip (queries between the client and the SQL * Net server) by 300 times (from 22012 to 68). </li></ul><br><br>  Total: thanks to the increase in the buffer, we reduce the number of roundtrips during data transfer, and this will almost always have a positive effect on large queries.  But, interestingly, on slower communication channels (for example, 1 m / bit and slower), even regular data sorting can have a positive effect on the result of the request delivery. <br><br>  Yes, and the level of compression.  Let your data be prepared as follows: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> tbl0 <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> object_name, object_id, <span class="hljs-keyword"><span class="hljs-keyword">min</span></span>(object_id) <span class="hljs-keyword"><span class="hljs-keyword">over</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> object_name) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> min_object_id <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> dba_objects; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> tbl1 <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> object_name, object_id <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> tbl0 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> object_id = min_object_id; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> tbl2 <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> object_name <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> tbl1 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">rownum</span></span> &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> <span class="hljs-number"><span class="hljs-number">1.</span></span><span class="hljs-number"><span class="hljs-number">.20</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOOP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> tbl2 <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> object_name <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> tbl1 <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">reverse</span></span>(object_id||object_name); <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOOP</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMIT</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>;</code> </pre><br><br>  Now compare the statistics for ARRAYSIZE 5000 by queries: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> object_name <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> tbl2; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> object_name <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> tbl2 <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre><br><br>  we get the following statistics: <br><br><pre> <code class="bash hljs"> ---------------------------------------------------------- 0 recursive calls 0 db block gets 4992 consistent gets 0 physical reads 0 redo size 34152895 bytes sent via SQL*Net to client 3088 bytes received via SQL*Net from client 250 SQL*Net roundtrips to/from client 0 sorts (memory) 0 sorts (disk) 1242280 rows processed  ---------------------------------------------------------- 167 recursive calls 16 db block gets 5211 consistent gets 16377 physical reads 0 redo size 7629058 bytes sent via SQL*Net to client 3088 bytes received via SQL*Net from client 250 SQL*Net roundtrips to/from client 21 sorts (memory) 4 sorts (disk) 1242280 rows processed</code> </pre><br><br>  As we see, with ARRAYSIZE 5000, all 1.2 million rows are pumped for the same number of roundtrip, i.e.  The effect of SQL * Net delays on the request / response will be approximately the same, but the amount of information on the sorted data is 7.3 mb versus 32.5 mb for non-sorted data.  So  when pre-sorting duplicate data, we reduced the amount of traffic over the network by 4.5 times, which is very significant on slow communication channels. <br></div><p>Source: <a href="https://habr.com/ru/post/245123/">https://habr.com/ru/post/245123/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../245109/index.html">Announcement of new features Typescript 1.4</a></li>
<li><a href="../245113/index.html">Mobile phones and total NSA surveillance: how it works</a></li>
<li><a href="../245117/index.html">Bylina about how I connected Drupal and Yandex.</a></li>
<li><a href="../245119/index.html">Do not worry, we will look after them. Integration of Zabbix into the client‚Äôs personal account</a></li>
<li><a href="../245121/index.html">The way of the developer: stories about my fabulous failures, part 2</a></li>
<li><a href="../245125/index.html">The Germans have created a library of drunken audio recordings.</a></li>
<li><a href="../245127/index.html">Fujitsu Optimized Server Solution for VMware EVO: RAIL</a></li>
<li><a href="../245129/index.html">The ninth issue of TsODY.RF magazine</a></li>
<li><a href="../245133/index.html">Millennium Challenge. Just about the complicated</a></li>
<li><a href="../245135/index.html">Comparison of data processing speed (ETS, DETS, Memcached, MongoDb) in Erlang (spherical in vacuum)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>