<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Installing, configuring and using chkrootkit vulnerability scanner</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In my previous post about the vulnerability scanner rkhunter , the chrootkit scanner was mentioned in the comments by the Indexator user. With a simil...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Installing, configuring and using chkrootkit vulnerability scanner</h1><div class="post__text post__text-html js-mediator-article">  In my previous post about the <a href="http://habrahabr.ru/company/first/blog/242865/">vulnerability scanner rkhunter</a> , the chrootkit <a href="http://habrahabr.ru/users/indexator/" class="user_link">scanner</a> was mentioned in the comments by the Indexator user.  With a similar functionality with rkhunter, there are a number of differences that it will be interesting to consider in this article.  It is also interesting that a new version of the scanner was recently released, the development of which seemed frozen since 2009. <br><br><img src="https://habrastorage.org/files/6d6/0d8/c07/6d60d8c0740c4155a4fad87cbff32078.jpg"><br><a name="habracut"></a><br>  Chkrootkit is an abbreviation for the phrase "check rootkit" (rootkit scan).  In turn, rootkits are called malicious applications designed to hide server penetration and disguise as normal processes or programs in order to gain full access to the server. <br><br>  The chkrootkit shell script is designed to help system administrators to check the system for known rootkits.  The first question that may arise with this information is: Why the shell?  Why not perl or bash, like the same rkunter?  The developers sought to unify the script as much as possible so that it runs on all systems with a shell.  And at the time of the beginning of script development, the same perl was far from everywhere. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The essence of the search is simple.  Using system tools such as strings and grep (to be more precise, the FAQ on the developer‚Äôs website contains a list of used programs - awk, cut, echo, egrep, find, head, id, ls, netstat, ps, strings, sed, uname ) chkrootkit looks for suspicious parts of the code in programs, compares the running processes with the information from / proc, identifying discrepancies. <br><br>  The tool consists of a number of modules responsible for different verification methods. <br><ul><li>  chkrootkit: shell script checking system binary files for modification by rootkits. </li><li>  ifpromisc.c: interface for searching for packets interception. </li><li>  chklastlog.c: module that checks for the fact of deletion of records from the lastlog log file. </li><li>  chkwtmp.c: similar to the previous module, checks the wtmp log file. </li><li>  chkutmp.c: checks the utmp log file for signs of deletion of records. </li><li>  check_wtmpx.c: relevant to the Solaris OS.  verifies that records have been deleted from the wtmpx log. </li><li>  chkproc.c: search for traces of known LKM trojans (Linux Kernel Module). </li><li>  chkdirs.c: find traces of known LKM Trojans (Linux Kernel Module). </li><li>  strings.c: analog strings utility. </li></ul><br>  Alas, the search for the fact of deleting lines from log files is not 100% guaranteed. <br><br>  Currently, the latest version is 0.50 dated June 4, 2014. The developers promise scanner operation under FreeBSD starting from 2.0 and others from the * BSD family, various Linux distributions with kernels from 2.2 and higher, MacOS X, Solaris and other more exotic operating systems. <br><br>  At CentOS, version 0.49 is present in the EPEL repositories, and there is no FreeBSD ports / packages.  To build the latest version you will need to install gcc.  Using the example of CentOS 6.x, it will look like this: <br><br>  Install gcc: <br><br><pre><code class="bash hljs">yum install gcc</code> </pre> <br>  Download the latest current version from the official ftp: <br><br><pre> <code class="bash hljs">wget ftp://ftp.pangeia.com.br/pub/seg/pac/chkrootkit.tar.gz</code> </pre> <br>  Unpack: <br><br><pre> <code class="bash hljs">tar -xzf chkrootkit.tar.gz</code> </pre> <br>  Go to the directory: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> chkrootkit-0.50</code> </pre> <br>  We assemble modules: <br><br><pre> <code class="bash hljs">make sense</code> </pre> <br>  Run the shell script: <br><br><pre> <code class="bash hljs">./chkrootkit</code> </pre><br><br>  I checked it the same way on FreeBSD 10.1 - the assembly of the modules and the verification passed without problems. <br><br>  In principle, it is possible not to assemble modules, and then on checks where additional modules are required, there will be errors like: <br><br><pre> <code class="bash hljs">Checking `ldsopreload<span class="hljs-string"><span class="hljs-string">'... can'</span></span>t <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> ./strings-static, not tested Checking `lkm<span class="hljs-string"><span class="hljs-string">'... not tested: can'</span></span>t <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> Checking `sniffer<span class="hljs-string"><span class="hljs-string">'... not tested: can'</span></span>t <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> ./ifpromisc Checking `wted<span class="hljs-string"><span class="hljs-string">'... not tested: can'</span></span>t <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> ./chkwtmp Checking `z2<span class="hljs-string"><span class="hljs-string">'... not tested: can'</span></span>t <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> ./chklastlog Checking `chkutmp<span class="hljs-string"><span class="hljs-string">'... not tested: can'</span></span>t <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> ./chkutmp</code> </pre><br>  By default, there is a complete system check for all available tests, a list of which can be obtained by running the script with the key '-l'.  Unfortunately, I was not able to find in the documentation a description of all the tests that can be run, but this can be discussed in the comments. <br>  Please note that chrootkit does not take a snapshot of the current files and does not save it in its database as the same rkunter. <br>  As startup keys, you can specify which of the tests to run. <br>  For example, <br><pre> <code class="bash hljs">./chkrootkit aliens sniffer</code> </pre> <br>  will search for malicious code and running traffic interceptors <br><br>  Messages that can be issued during scanning <br><ul><li>  not infected - the scan did not detect anything suspicious </li><li>  INFECTED - the program most likely refers to the rootkit </li><li>  not tested - the check was not performed (for this OS, there is no possibility of checking, the absence of a test module, command line parameters were set to disable this check) </li><li>  not found - the program was not found and therefore was not checked. </li><li>  Vulnerable but disabled - the probability that the application is malicious is great, but at the time of testing it was inactive. </li></ul><br>  For regular system checks, you can add the chkrootkit scan run to the scheduler as root. <br><br><pre> <code class="bash hljs">crontab -e</code> </pre> <br><pre> <code class="bash hljs">@daily ///chkrootkit | mail -s <span class="hljs-string"><span class="hljs-string">'CHROOTKIT Daily Run'</span></span> @</code> </pre> <br>  For daily full system scan with all available modules and tests, followed by sending a report to the mailbox. <br><br>  In ISPmanager5, this can be configured from the convenient scheduler interface, which is located in the ‚ÄúSystem‚Äù section <br><br><img src="https://habrastorage.org/files/e78/106/900/e781069007c74c2386f8a26a4b1f7937.png"><br><br>  But due to the high probability that an infected OS may replace values ‚Äã‚Äãduring scanning, it is recommended to run chkrootkit to check the system when the server is booted in recovery mode or from a bootable live image. <br>  In this case, the procedure is as follows: <br><ul><li>  boot from live image </li><li>  Download the latest version of chkrootkit </li><li>  compile modules </li><li>  mount disk partitions with (potentially) infected system </li><li>  scan chkrootkit -r / mnt / </li></ul><br><br>  Official site of the project: <a href="http://www.chkrootkit.org/">http://www.chkrootkit.org/</a> <br><br>  PS: I wish that on your systems always chkrootkit showed the message ‚Äúnothing found‚Äù or ‚Äúnot infected‚Äù. </div><p>Source: <a href="https://habr.com/ru/post/243487/">https://habr.com/ru/post/243487/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../243477/index.html">Service Ahoba.co has become a nominee in the competition "Startup of the Year 2014"!</a></li>
<li><a href="../243479/index.html">Introduction to the component-oriented approach to programming</a></li>
<li><a href="../243481/index.html">Reverse engineering GPS WatchLock lock for personal use</a></li>
<li><a href="../243483/index.html">We write and run ASP.NET vNext applications on Mac</a></li>
<li><a href="../243485/index.html">We are migrating file servers from Windows Server 2003 to Windows Server 2012 R2</a></li>
<li><a href="../243489/index.html">How important commercial information flows away. Infographics</a></li>
<li><a href="../243493/index.html">Adora Cheung (part 1): product and honesty curve</a></li>
<li><a href="../243495/index.html">Universe npm</a></li>
<li><a href="../243497/index.html">Computer Science Classic</a></li>
<li><a href="../243499/index.html">Electronic Cake in your pocket: development diary</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>