<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Controlling the volume of a multi-zone amplifier with an Android and Arduino application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="First of all, I would like to thank 470 readers who voted for the continuation in the article about a multi-zone amplifier. 

 Operation of the amplif...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Controlling the volume of a multi-zone amplifier with an Android and Arduino application</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/ed9/58b/4b5/ed958b4b518a4710a0cdf4bffce3d505.png"><br>  First of all, I would like to thank 470 readers who voted for the continuation in the <a href="http://habrahabr.ru/post/257003/">article about a multi-zone amplifier.</a> <br><br>  Operation of the amplifier showed that it is not very convenient to adjust the volume while being in a room that can be far enough away from the storage room where the amplifier is located with volume controls.  We have to run a few times to the pantry and back to achieve the desired volume level. <br><br>  Thus was born the idea of ‚Äã‚Äãa regulator, which is always with you in your pocket, i.e.  phone applications that can control the amplifier via a Wi-Fi network. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To implement digital control of the amplifier volume level, the mechanical potentiometer will be replaced by an electronic one (DPOT - Digital Potentiometer).  Among the not very wide variety of available DPOT, the MCP41050 was chosen with a nominal value of 50 kŒ©, which corresponds to the nominal value of the replaced mechanical analogue. <br><br>  This is a single-channel potentiometer, therefore, for 1 stereo amplifier you will need 2 pieces.  There are also dual versions of the same series (MCP42XXX), but it was technologically more convenient for me to use 2 separate ones.  Consider briefly how it works. <br><br><img src="https://habrastorage.org/files/516/5fd/340/5165fd340f244f6f867b52fda89a710b.png"><br><br>  The analog part is represented by pins 5-7, pin 6 (PW0) is the engine (Wiper) of the potentiometer.  Control is done through the SPI (Serial Peripheral Interface) (pins 1-3).  5V power is supplied to the Vss and Vdd terminals.  Chip programming involves sequentially sending the Command Byte and Data Byte setting the position of the potentiometer slider to the 0-255 position. <br><br>  Finalization of the amplifier. <br>  As I told in the previous article, I chose the cheapest of the ready-made amps for $ 2.7 and I did not feel sorry for killing it for the sake of the experiment.  To begin, remove (carefully dispense) the mechanical potentiometer as shown in the picture: <br><br><img src="https://habrastorage.org/files/393/487/e84/393487e84ce647c4894f2a53b3ad54ed.png"><br><br>  In the vacant space will be installed our dual electronic controller. <br>  Regulator assembly. <br>  Cut the breadboard along and then across 3 parts as shown in the picture: <br><br><img src="https://habrastorage.org/files/d45/dc3/ccc/d45dc3ccc67d47d6969b8568f9cb3f26.png"><br><br>  If you hold a sharp knife along the holes a couple of times, the board is easily broken by hand like a cookie.  After that, you need a file to slightly trim the edges.  From the resulting pieces we will need 2 small ones, they are approximately 1.5 x 2 cm in size. <br>  Conclusions 2-4, 8 chips are connected in parallel, so it is convenient to assemble both boards in the form of a sandwich: <br><br><img src="https://habrastorage.org/files/39f/4b9/747/39f4b9747e5a462ba056e2549a30e595.png"><br><br>  To connect the control circuit and power supply with the Arduino board, we use a piece of cable-loop.  At the same time, digital control lines are located away from analog circuits in order to avoid interference. <br><br>  After pre-testing, the assembled regulator is soldered to the amplifier: <br><br><img src="https://habrastorage.org/files/3f2/06e/914/3f206e91485b45e394c8b75b5dc092ab.png"><br><br>  As shown by testing, adding DPOT with digital control circuits to the input circuits of the amplifier did not lead to noticeable noises or interferences. <br><br>  Circuit diagram <br><br><img src="https://habrastorage.org/files/5f2/6ad/b28/5f26adb284dc4fb6b080378fd3ab015f.png"><br><br>  Program for Arduino. <br>  The management method ‚ÄúSPI by hand‚Äù (‚ÄúSPI by Hand‚Äù) described here is <a href="http://little-scale.blogspot.it/2007/07/spi-by-hand.html">based on the little-scale.blogspot.it/2007/07/spi-by-hand.html</a> .  It features 2 functions. <br>  The spi_transfer function sends a byte to the chip bit by bit. <br><br><pre><code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> spi_transfer(byte working) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt;= <span class="hljs-number"><span class="hljs-number">8</span></span>; i++) // <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> up a <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> iterations (<span class="hljs-number"><span class="hljs-number">8</span></span> bits <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a byte) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (working &gt; <span class="hljs-number"><span class="hljs-number">127</span></span>) { digitalWrite (POT_MOSI,HIGH) ; } // <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> the MSB <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> a <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> MOSI high <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { digitalWrite (POT_MOSI, LOW) ; } // <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> the MSB <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> a <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> MOSI low digitalWrite (CLKdpot,HIGH) ; // Pulse the CLKdpot high working = working &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span> ; // <span class="hljs-type"><span class="hljs-type">Bit</span></span>-shift the working byte digitalWrite(CLKdpot,LOW) ; // Pulse the CLKdpot low } }</code> </pre> <br><br>  The function spi_out sends the command and data bytes to the chip which is selected by setting the logical line CS to 0. <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">spi_out</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> CS, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cmd_byte, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> data_byte</span></span></span><span class="hljs-function">)</span></span> { digitalWrite (CS, LOW); <span class="hljs-comment"><span class="hljs-comment">// Set the passed ChipSelect pin to low to start programming spi_transfer(cmd_byte); // Send the passed COMMAND BYTE delay(2); spi_transfer(data_byte); // Send the passed DATA BYTE delay(2); digitalWrite(CS, HIGH); // Set the passed ChipSelect pin to high to end programming }</span></span></code> </pre><br><br>  Since it was decided to implement the control over the local network, and not via Bluetooth, the Ethernet shield, Web server was included in the standard connection in the circuit.  Running a little ahead, it should be noted that the program for the phone was created in the MIT App Inventor for which there is no TCP client implementation.  Therefore, the management had to be done by sending commands in the GET request parameters. <br><br>  After selecting the commands (param) and values ‚Äã‚Äã(value) from the query string, they are sent to control our DPOTs: <br><br><pre> <code class="hljs pgsql">param = readString.substring(<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">9</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = readString.substring(<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">13</span></span>).toInt(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (param=="V1L") {V1L=<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; spi_out(CS1, cmd_byte, V1L);} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (param=="V1R") {V1R=<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; spi_out(CS2, cmd_byte, V1R);} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (param=="MU1") {spi_out(CS1, cmd_byte, V1L/<span class="hljs-number"><span class="hljs-number">5</span></span>); spi_out(CS2, cmd_byte, V1R/<span class="hljs-number"><span class="hljs-number">5</span></span>);} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (param=="UM1") {spi_out(CS1, cmd_byte, V1L); spi_out(CS2, cmd_byte, V1R);}</code> </pre><br><br>  Commands V1L, V1R - set the volume of the first left / right channel corresponding to the value value which can be equal to 0 - 255. <br>  Commands MU1, UM1 - Mute, Unmute.  Temporary mute (source level / 5) and return the volume to the original value. <br><br><div class="spoiler">  <b class="spoiler_title">Sketch the whole</b> <div class="spoiler_text"><br><pre> <code class="hljs dos">#include &lt;UIPEthernet.h&gt; #include &lt;String.h&gt; int CS1 = <span class="hljs-number"><span class="hljs-number">19</span></span>; // Chip Select int CS2 = <span class="hljs-number"><span class="hljs-number">18</span></span>; int CS3 = <span class="hljs-number"><span class="hljs-number">17</span></span>; int CS4 = <span class="hljs-number"><span class="hljs-number">16</span></span>; int CS5 = <span class="hljs-number"><span class="hljs-number">15</span></span>; int CS6 = <span class="hljs-number"><span class="hljs-number">14</span></span>; int CS7 = <span class="hljs-number"><span class="hljs-number">8</span></span>; int CS8 = <span class="hljs-number"><span class="hljs-number">7</span></span>; int CLKdpot = <span class="hljs-number"><span class="hljs-number">4</span></span>; // Clock pin <span class="hljs-number"><span class="hljs-number">4</span></span> arduino int POT_MOSI = <span class="hljs-number"><span class="hljs-number">5</span></span>; // MOSI pin <span class="hljs-number"><span class="hljs-number">5</span></span> arduino byte cmd_byte = B00010011 ; // Command byte 'write' data to POT uint8_t POTposition1 = <span class="hljs-number"><span class="hljs-number">10</span></span>; //initialize DPOT <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> initial position uint8_t POTposition2 = <span class="hljs-number"><span class="hljs-number">10</span></span>; uint8_t POTposition3 = <span class="hljs-number"><span class="hljs-number">10</span></span>; uint8_t POTposition4 = <span class="hljs-number"><span class="hljs-number">10</span></span>; uint8_t POTposition5 = <span class="hljs-number"><span class="hljs-number">10</span></span>; uint8_t POTposition6 = <span class="hljs-number"><span class="hljs-number">10</span></span>; uint8_t POTposition7 = <span class="hljs-number"><span class="hljs-number">10</span></span>; uint8_t POTposition8 = <span class="hljs-number"><span class="hljs-number">10</span></span>; uint8_t mac[<span class="hljs-number"><span class="hljs-number">6</span></span>] = {<span class="hljs-number"><span class="hljs-number">0</span></span>x00,<span class="hljs-number"><span class="hljs-number">0</span></span>x01,<span class="hljs-number"><span class="hljs-number">0</span></span>x02,<span class="hljs-number"><span class="hljs-number">0</span></span>x03,<span class="hljs-number"><span class="hljs-number">0</span></span>x04,<span class="hljs-number"><span class="hljs-number">0</span></span>x05}; uint8_t ip[<span class="hljs-number"><span class="hljs-number">4</span></span>] = {<span class="hljs-number"><span class="hljs-number">192</span></span>, <span class="hljs-number"><span class="hljs-number">168</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">25</span></span>}; // IP address <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the webserver uint16_t port = <span class="hljs-number"><span class="hljs-number">80</span></span>; // Use port <span class="hljs-number"><span class="hljs-number">80</span></span> - the standard <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> HTTP EthernetServer server(<span class="hljs-number"><span class="hljs-number">80</span></span>); String readString = String(<span class="hljs-number"><span class="hljs-number">100</span></span>); String param = String(<span class="hljs-number"><span class="hljs-number">3</span></span>); int value = <span class="hljs-number"><span class="hljs-number">0</span></span>; int V1L = <span class="hljs-number"><span class="hljs-number">0</span></span>; int V1R = <span class="hljs-number"><span class="hljs-number">0</span></span>; int V2L = <span class="hljs-number"><span class="hljs-number">0</span></span>; int V2R = <span class="hljs-number"><span class="hljs-number">0</span></span>; int V3L = <span class="hljs-number"><span class="hljs-number">0</span></span>; int V3R = <span class="hljs-number"><span class="hljs-number">0</span></span>; int V4L = <span class="hljs-number"><span class="hljs-number">0</span></span>; int V4R = <span class="hljs-number"><span class="hljs-number">0</span></span>; void spi_transfer(byte working) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(int i = <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt;= <span class="hljs-number"><span class="hljs-number">8</span></span>; i++) // <span class="hljs-built_in"><span class="hljs-built_in">Set</span></span> up a loop of <span class="hljs-number"><span class="hljs-number">8</span></span> iterations (<span class="hljs-number"><span class="hljs-number">8</span></span> bits <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a byte) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (working &gt; <span class="hljs-number"><span class="hljs-number">127</span></span>) { digitalWrite (POT_MOSI,HIGH) ; } // <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> the MSB is a <span class="hljs-number"><span class="hljs-number">1</span></span> then <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> MOSI high <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { digitalWrite (POT_MOSI, LOW) ; } // <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> the MSB is a <span class="hljs-number"><span class="hljs-number">0</span></span> then <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> MOSI low digitalWrite (CLKdpot,HIGH) ; // Pulse the CLKdpot high working = working &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span> ; // Bit-<span class="hljs-built_in"><span class="hljs-built_in">shift</span></span> the working byte digitalWrite(CLKdpot,LOW) ; // Pulse the CLKdpot low } } void spi_out(int CS, byte cmd_byte, byte data_byte) { digitalWrite (CS, LOW); // <span class="hljs-built_in"><span class="hljs-built_in">Set</span></span> the passed ChipSelect pin to low to <span class="hljs-built_in"><span class="hljs-built_in">start</span></span> programming spi_transfer(cmd_byte); // Send the passed COMMAND BYTE delay(<span class="hljs-number"><span class="hljs-number">2</span></span>); spi_transfer(data_byte); // Send the passed DATA BYTE delay(<span class="hljs-number"><span class="hljs-number">2</span></span>); digitalWrite(CS, HIGH); // <span class="hljs-built_in"><span class="hljs-built_in">Set</span></span> the passed ChipSelect pin to high to end programming } void setup() { Serial.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>); pinMode (CS1, OUTPUT); pinMode (CS2, OUTPUT); pinMode (CS3, OUTPUT); pinMode (CS4, OUTPUT); pinMode (CS5, OUTPUT); pinMode (CS6, OUTPUT); pinMode (CS7, OUTPUT); pinMode (CS8, OUTPUT); pinMode (CLKdpot, OUTPUT); pinMode (POT_MOSI, OUTPUT); spi_out(CS1, cmd_byte, POTposition1); spi_out(CS2, cmd_byte, POTposition2); spi_out(CS3, cmd_byte, POTposition3); spi_out(CS4, cmd_byte, POTposition4); spi_out(CS5, cmd_byte, POTposition5); spi_out(CS6, cmd_byte, POTposition6); spi_out(CS7, cmd_byte, POTposition7); spi_out(CS8, cmd_byte, POTposition8); // <span class="hljs-built_in"><span class="hljs-built_in">start</span></span> the Ethernet connection and the server: Ethernet.begin(mac, ip); server.begin(); Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>("server is <span class="hljs-built_in"><span class="hljs-built_in">at</span></span> "); Serial.println(Ethernet.localIP()); } void loop() { // listen <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> incoming clients readString=""; EthernetClient client = server.available(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (client) { Serial.println("new client"); // an http request ends with a blank line boolean currentLineIsBlank = true; while (client.connected()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (client.available()) { char c = client.read(); size_t pos = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (readString.length() &lt; <span class="hljs-number"><span class="hljs-number">16</span></span>) { //store characters to string readString +=c; } // <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> you've gotten to the end of the line (received a newline // character) and the line is blank, the http request has ended, // so you can send a reply <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c == '\n' &amp;&amp; currentLineIsBlank) { // send a standard http response header client.println("HTTP/<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">200</span></span> OK"); client.println("Content-<span class="hljs-built_in"><span class="hljs-built_in">Type</span></span>: text/html"); client.println("Connection: close"); client.println(); client.println("&lt;!DOCTYPE HTML&gt;"); client.println("&lt;html&gt;"); client.println("&lt;/html&gt;"); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c == '\n') { // you're starting a new line currentLineIsBlank = true; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c != '\r') { // you've gotten a character on the current line currentLineIsBlank = false; } } } // give the web browser <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> to receive the data delay(<span class="hljs-number"><span class="hljs-number">1</span></span>); // close the connection: client.stop(); Serial.println("client disconnected"); Serial.println(readString); param = readString.substring(<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">9</span></span>); value = readString.substring(<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">13</span></span>).toInt(); Serial.println(param); Serial.println(value); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (param=="V1L") {V1L=value; spi_out(CS1, cmd_byte, V1L);} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (param=="V1R") {V1R=value; spi_out(CS2, cmd_byte, V1R);} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (param=="V2L") {V2L=value; spi_out(CS3, cmd_byte, V2L);} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (param=="V2R") {V2R=value; spi_out(CS4, cmd_byte, V2R);} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (param=="V3L") {V3L=value; spi_out(CS5, cmd_byte, V3L);} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (param=="V3R") {V3R=value; spi_out(CS6, cmd_byte, V3R);} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (param=="V4L") {V4L=value; spi_out(CS7, cmd_byte, V4L);} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (param=="V4R") {V4R=value; spi_out(CS8, cmd_byte, V4R);} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (param=="MU1") { spi_out(CS1, cmd_byte, V1L/<span class="hljs-number"><span class="hljs-number">5</span></span>); spi_out(CS2, cmd_byte, V1R/<span class="hljs-number"><span class="hljs-number">5</span></span>); spi_out(CS3, cmd_byte, V2L/<span class="hljs-number"><span class="hljs-number">5</span></span>); spi_out(CS4, cmd_byte, V2R/<span class="hljs-number"><span class="hljs-number">5</span></span>); spi_out(CS5, cmd_byte, V3L/<span class="hljs-number"><span class="hljs-number">5</span></span>); spi_out(CS6, cmd_byte, V3R/<span class="hljs-number"><span class="hljs-number">5</span></span>); spi_out(CS7, cmd_byte, V4L/<span class="hljs-number"><span class="hljs-number">5</span></span>); spi_out(CS8, cmd_byte, V4R/<span class="hljs-number"><span class="hljs-number">5</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (param=="UM1") { spi_out(CS1, cmd_byte, V1L); spi_out(CS2, cmd_byte, V1R); spi_out(CS3, cmd_byte, V2L); spi_out(CS4, cmd_byte, V2R); spi_out(CS5, cmd_byte, V3L); spi_out(CS6, cmd_byte, V3R); spi_out(CS7, cmd_byte, V4L); spi_out(CS8, cmd_byte, V4R); } } }</code> </pre><br></div></div><br><br>  ‚ÄúVolume Control‚Äù app for Android. <br>  The application is created using the MIT App Inventor tool.  The application has 2 screens: the main screen and the settings screen.  The main screen includes 4 identical sections, one per zone.  The settings screen contains controls for setting the URL to the corresponding IP address of the Arduino, as well as the names of the zones. <br><br><img src="https://habrastorage.org/files/de3/dd8/b14/de3dd8b144ea4dc1bf61a7f81f819918.png"><br><br>  A few details explaining the program. <br>  The values ‚Äã‚Äãof the settings and the position of the volume controls are stored in TinyDB and are used when the application is initialized when it is opened.  An example of saving the value of the level of the left channel of the first zone when closing an application: <br><br><img src="https://habrastorage.org/files/c7e/051/1b6/c7e0511b6e224ed79a857bad570d7362.png"><br><br>  As mentioned above, the WebViewer component is used to send commands using the Get method as part of a request to a web server running on the Arduino. <br>  Sending commands as a frequently repeated operation is highlighted in the SendCommand procedure. <br><br><img src="https://habrastorage.org/files/d5a/455/cf9/d5a455cf919f4d5ea9cbbf8ec14f38f4.png"><br><br>  For example, when changing the position of the left channel regulator of the first zone, it will be called as <br><br><img src="https://habrastorage.org/files/e79/b63/ce0/e79b63ce07ad4923b6f919f279a7a375.png"><br><br>  A request of the form <a href="http://192.168.6.25/%3FV1L%3D156">http://192.168.6.25/?V1L=156</a> will be sent. <br>  If the application is running on a smartphone, then the sound can be automatically muted when answering a call and restored when it ends: <br><br><img src="https://habrastorage.org/files/6c6/a6b/921/6c6a6b921e064715a55471d0630dca1e.png"><br><br>  When you click on the ‚ÄúMute‚Äù button, the Mute procedure is called which in turn calls SendCommand and changes the color and name of the button: <br><br><img src="https://habrastorage.org/files/edf/287/4f3/edf2874f3b2b43e4b53a41afc3343b95.png"><br><br>  The project file for App Inventor 2 will send to those who wish on request. <br><br>  In conclusion, I provide a video demonstrating the operation of the application.  The delay in switching the screen is due to the fact that the application is running in MIT AI2 Companion. <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/OJ1MpToru-U%3Ffeature%3Doembed&amp;xid=17259,15700002,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgM3B2nq9F2zcE9hA1Jl-cljjNz-g" frameborder="0" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/259579/">https://habr.com/ru/post/259579/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../259567/index.html">Setting an object property using lambda expressions</a></li>
<li><a href="../259569/index.html">BSON injection in MongoDB adapter for Ruby</a></li>
<li><a href="../259573/index.html">Whether it is necessary to move to a hosting in Russia, or Fault tolerance on 242-FZ</a></li>
<li><a href="../259575/index.html">Watch networks of the past</a></li>
<li><a href="../259577/index.html">Integration of symfony 2 and google calendar</a></li>
<li><a href="../259583/index.html">OpenCV 3.0 release with Python 3 support</a></li>
<li><a href="../259589/index.html">Loading models, traits</a></li>
<li><a href="../259591/index.html">Usability - one Redmine plugin, providing a lot of useful things. Part two</a></li>
<li><a href="../259593/index.html">DevConf 2015 - the final vote for the reports. Make the program better and more useful</a></li>
<li><a href="../259595/index.html">Startup Village-2015 in Skolkovo - how it was</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>