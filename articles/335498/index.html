<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cursed Earths - We improve running and experience with teammates</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many have played this wonderful game. An interesting plot, good music, good gameplay. Only there are a couple of things that I don‚Äôt like. The run of ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cursed Earths - We improve running and experience with teammates</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/web/7b6/b56/0ea/7b6b560eae75424a9b3c160fbf6309ad.jpg"></div><br>  Many have played this wonderful game.  An interesting plot, good music, good gameplay.  Only there are a couple of things that I don‚Äôt like.  The run of characters is very limited, just a few seconds, and the reserve of forces is restored for a long time.  The experience accrual system does not encourage taking partners, because the experience is distributed equally to everyone, and it is better to run alone to take the whole experience for yourself.  Take the debugger and try to fix it. <br><a name="habracut"></a><br>  We need ArtMoney, IDA, Hiew. <br><br>  There is nothing complicated in the actions, the main result here.  Offsets are given for version 1.07. <br><br>  Run IDA, load the game.exe file, wait for the analysis to complete.  Start the starter, remove the setting "Fullscreen mode".  We start the game in the debugger, load the save where it is already possible to take a partner.  We take the partner, we leave on the map. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <a href=""><img src="https://habrastorage.org/web/ec2/732/fb0/ec2732fb06c044a2bc8257e8399bf220.jpg"><br></a> <br><br><h3>  Run </h3><br>  We look, how much is the reserve of strength of the character.  Here it is 54. Launch ArtMoney.  We are looking for this value.  Type "With a point of 4 bytes."  Run a little and weed out the new value.  We repeat as necessary, I immediately have one value left. <br><br><img src="https://habrastorage.org/web/001/b72/72c/001b7272c1a04f29b94665bd0f0e5617.png"><br><br>  We try to freeze, if the reserve of forces is restored when running, it means that you have found it correctly.  Only need to be removed later.  Turn on the run mode.  Put the game on pause (space). <br><br>  We put a breakpoint on this address to write to IDA.  Before this, you must do the 'Pause process', otherwise crashes occur.  Switch to the game, send the character to some point, remove from pause. <br><br>  Breakpoint works. <br><br><pre><code class="hljs css"><span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00548315</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">loc_548315</span></span>: <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00548315</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dword</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ptr</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[edi+14h]</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00548318</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dword</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ptr</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[edi+18h]</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0054831B</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fmul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ds</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:dbl_73F088</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00548321</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fsubp</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">st</span></span>(1), <span class="hljs-selector-tag"><span class="hljs-selector-tag">st</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00548323</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fst</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dword</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ptr</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[edi+14h]</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00548326</span></span> &gt; <span class="hljs-selector-tag"><span class="hljs-selector-tag">fcomp</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ds</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:flt_73B858</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0054832C</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fnstsw</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ax</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0054832E</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">test</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ah</span></span>, 1 <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00548331</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">jz</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">short</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">loc_548388</span></span></code> </pre> <br>  The recording takes place in the <code>fst dword ptr [edi+14h]</code> .  You can put Operand type - Floating point to this address and to the next <code>[edi+18h]</code> . <br><br><img src="https://habrastorage.org/web/2fd/f13/22e/2fdf1322e1734f789f32a782a79e20c5.png"><br><br>  Judging by the values, it is stored there: <br><br>  <code>[edi+14h]</code> - current value <br>  <code>[edi+18h]</code> - maximum value <br><br>  It can be seen that the maximum power of the character is multiplied by the constant <code>dbl_73F088</code> , and the result is subtracted from the current value.  Therefore, all the characters run the same way. <br><br><pre> <code class="hljs">.rdata:0073F088 dbl_73F088 dq 6.666666666666666e-3 ; 6.666666666666666e-3 = 0.006666666666666666 = 1/150</code> </pre><br>  That is, a character can run about 150 "steps", but these are not exactly steps that can be seen in the animation, because the subtraction occurs more often.  A full supply of forces is spent in 9-10 seconds, so subtraction is called 15 - 16.66 times per second. <br><br>  Most likely these are green dots indicating the path. <br><br> <a href=""><img src="https://habrastorage.org/web/fce/8d8/9de/fce8d89de90f49ef9a3017de50ed2bfe.jpg"><br></a> <br><br>  In bytes, this constant is written as: <br><br><pre> <code class="html hljs xml">4E 1B E8 B4 81 4E 7B 3F</code> </pre><br>  Open game.exe in Hiew and go to the address ".73F088". <br><br><img src="https://habrastorage.org/web/de9/782/01a/de978201a0854f6ab7eba403b8cd5461.png"><br><br>  There are no other constants with such a value, the link to it is only in the considered code.  You can change it to any value that you need.  I made myself 3 times less. <br>  (1/150) / 3 = 1/450 = 0.0022222222222222222 <br><br>  To convert float / double to hex representation, you can use an online converter, for example <a href="https://gregstoll.dyndns.org/~gregstoll/floattohex/">this</a> . <br><br><div class="spoiler">  <b class="spoiler_title">for reference</b> <div class="spoiler_text"><pre> <code class="html hljs xml">0.0066666666666666667 - 0x3F7B4E81B4E81B4F 0.006666666666666666 - 0x3F7B4E81B4E81B4E 0.0022222222222222222 - 0x3F623456789ABCDF 0.002222222222222222 - 0x3F623456789ABCDE</code> </pre><br></div></div><br>  It turns out a beautiful number <code>0x3F623456789ABCDF</code> <br><br><pre> <code class="html hljs xml">DF BC 9A 78 56 34 62 3F</code> </pre><br>  Replace, save, run.  Now, so much better. <br><br><h3>  Experience </h3><br>  It's a little more complicated here.  It is not stored explicitly.  It is necessary to search through the associated values.  We start, however, the same way. <br><br>  We look at how much experience a character has.  This can be done in the mode between the cards.  I have this 116. <br><br> <a href=""><img src="https://habrastorage.org/web/8f8/66e/39c/8f866e39c03c4c8b8fa3c19d28f180e9.jpg"><br></a> <br><br>  We are looking for this value.  Here you need the type "Integer 4 bytes". <br><br>  This is not a source variable, but a calculated value cast to an int.  The experience itself is stored in the float, but there is a different meaning, more on that below. <br><br>  Now you can fight with someone.  You cannot leave the map to view the experience, you can not reboot either, because the memory is re-allocated, and when you re-enter the map there will be other addresses.  It is necessary to add in the mind.  At the same time it is necessary to consider rounding.  That is, if 5 points of experience are given for the enemy, and 2 characters are in the team, then experience 2 will be displayed on the screen, but you need to add 2.5 and take the whole part. <br><br> <a href=""><img src="https://habrastorage.org/web/17d/55e/385/17d55e38502f4d2dbe22da0fb1b61580.jpg"><br></a> <br><br>  After a couple of repetitions, I have 6 values ‚Äã‚Äãleft, which change synchronously. <br><br><img src="https://habrastorage.org/web/3c4/690/783/3c4690783d9d45f3be49cff4294a5655.png"><br><br>  Let's try to put a breakpoint on the record at each address.  Do not forget about the "Pause process". <br><br>  The first address is appropriate.  The rest are triggered by <code>rep movsd</code> . <br><br><pre> <code class="hljs css"><span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00522D00</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dword</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ptr</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ebx+700h]</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00522D06</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fadd</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dword</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ptr</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ebx+4]</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00522D09</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fsub</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dword</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ptr</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ebx+8]</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00522D0C</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fstp</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ebp+var_10]</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00522D0F</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fld</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ebp+var_10]</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00522D12</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fistp</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ebp+var_C]</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00522D15</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">edx</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ebp+var_C]</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00522D18</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[edi+8]</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">edx</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00522D1B</span></span> &gt; <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">eax</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ebx+10h]</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00522D1E</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ebp+var_10]</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">eax</span></span></code> </pre><br>  It is triggered when running or when fighting any of the characters.  Therefore, it is better to manage only one thing here and not a group so as not to be confused.  In <code>ebx</code> is the address of the object character.  In <code>[ebx+700h]</code> is 0. <br><br>  Let's look at the values. <br><br><img src="https://habrastorage.org/web/608/e5f/3aa/608e5f3aaa764f73a52a18c5ba9d13c9.png"><br><br>  387 - 271 = 116 <br><br>  It can be assumed that this is a received and spent experience, and the current one is calculated as their difference. <br><br>  My game dropped several times, so I put a breakpoint on the code and loaded it from save.  Therefore, there are 116, not 120. But this only confirms the guess. <br><br>  Put a new breakpoint on <code>[ebx+4]</code> . <br><br>  We select the whole group and attack the enemy. <br><br> <a href=""><img src="https://habrastorage.org/web/369/b1d/0fd/369b1d0fdc7a4cd3938e678502fadd72.jpg"><br></a> <br><br>  Breakpoint works before it is visible on the screen. <br><br><pre> <code class="hljs css"><span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:005239D7</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ds</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:dbl_73E128</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:005239DD</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dword</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ptr</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[esi+20h]</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:005239E0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fsub</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ds</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:flt_73E124</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:005239E6</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">call</span></span> __<span class="hljs-selector-tag"><span class="hljs-selector-tag">CIpow</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:005239EB</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fmul</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ebp+arg_4]</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:005239EE</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fadd</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dword</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ptr</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[esi+700h]</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:005239F4</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fcom</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ds</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:flt_73B858</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:005239FA</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fst</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dword</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ptr</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[esi+700h]</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00523A00</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fnstsw</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ax</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00523A02</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">test</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ah</span></span>, 41<span class="hljs-selector-tag"><span class="hljs-selector-tag">h</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00523A05</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">jnz</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">short</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">loc_523A19</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00523A07</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fadd</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dword</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ptr</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[esi+4]</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00523A0A</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dword</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ptr</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[esi+700h]</span></span>, 0 <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00523A14</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fstp</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dword</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ptr</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[esi+4]</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00523A17</span></span> &gt; <span class="hljs-selector-tag"><span class="hljs-selector-tag">jmp</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">short</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">loc_523A1B</span></span></code> </pre><br>  In <code>[esi+4]</code> new meaning of experience.  In <code>[ebp+arg_4]</code> number is 2.0.  For a young wild boar, 4.0 is given, so the division is before the function is called. <br><br>  Exit the function with Ctrl + F7.  This is a wrapper, exit again. <br><br>  We look a little higher, there is such a code. <br><br><pre> <code class="hljs css"><span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00591521</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">loc_591521</span></span>: <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00591521</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fild</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ebp+var_18]</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00591524</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">xor</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">esi</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">esi</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00591526</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cmp</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">eax</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">edi</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00591528</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ebp+var_14]</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">esi</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0059152B</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fdivr</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ebp+arg_4]</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0059152E</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fstp</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ebp+arg_4]</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00591531</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">jle</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">short</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">loc_5915A5</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00591533</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">jmp</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">short</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">loc_591537</span></span></code> </pre><br>  We set a breakpoint at <code>00591521</code> and take part in the battle again. <br><br>  <code>fdivr</code> divides the argument by <code>st(0)</code> and writes the result to <code>st(0)</code> : <code>st(0) = arg / st(0)</code> .  In <code>st(0)</code> is the value of <code>[ebp+var_18]</code> , in which there are 2 - the number of characters.  In <code>[ebp+arg_4]</code> is 4.0 - experience for the enemy.  When performing a mission, accrual also occurs here. <br><br>  Also, the division by the number of participants is higher: <br><br><pre> <code class="hljs css"><span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00591324</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fdiv</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ebp+var_18]</span></span></code> </pre><br>  But I did not find when this code is executed.  There will not touch. <br><br>  Now through Hiew, you can remove the code for division.  Due to the <code>fdivr</code> replace all 3 commands with <code>nop</code> (9 bytes). <br><br><pre> <code class="hljs markdown">;  .00591521: DB45E8 fild d,[<span class="hljs-string"><span class="hljs-string">ebp</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">-018</span></span>] .00591524: 33F6 xor esi,esi .00591526: 3BC7 cmp eax,edi .00591528: 8975EC mov [<span class="hljs-string"><span class="hljs-string">ebp</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">-014</span></span>],esi .0059152B: D87D0C fdivr d,[<span class="hljs-string"><span class="hljs-string">ebp</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">00C</span></span>] .0059152E: D95D0C fstp d,[<span class="hljs-string"><span class="hljs-string">ebp</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">00C</span></span>] .00591531: 7E72 jle .0005915A5 .00591533: EB02 jmps .000591537 ;  .00591521: 909090 nop .00591524: 33F6 xor esi,esi .00591526: 3BC7 cmp eax,edi .00591528: 8975EC mov [<span class="hljs-string"><span class="hljs-string">ebp</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">-014</span></span>],esi .0059152B: 909090 nop .0059152E: 909090 nop .00591531: 7E72 jle .0005915A5 .00591533: EB02 jmps .000591537</code> </pre><br>  Now the characters and run normally, and the supply of forces is not infinite, the spells are spent as usual, the mechanics of the game saved.  And partners get their independent experience that can be spent on their development. <br><br>  Go! </div><p>Source: <a href="https://habr.com/ru/post/335498/">https://habr.com/ru/post/335498/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../335484/index.html">Create a checklist for helpdesk implementation</a></li>
<li><a href="../335488/index.html">Rethinking PID 1. Part 2</a></li>
<li><a href="../335490/index.html">Developing a telegram bot using Spring</a></li>
<li><a href="../335492/index.html">Information economy: why the cost of technology companies is so high</a></li>
<li><a href="../335494/index.html">Accuracy through inaccuracy: Improving Time-objects</a></li>
<li><a href="../335504/index.html">Getting root access to LG smart TVs on webOS</a></li>
<li><a href="../335506/index.html">‚ÄúOne of the daily processes accelerates from 3 hours to 15 minutes‚Äù: Andrei Bogoslovsky about in-memory computing at SberTech</a></li>
<li><a href="../335508/index.html">Emulator in the emulator for playing chip-tunes on YM2149F</a></li>
<li><a href="../335512/index.html">Using ImGui with SFML to create game development tools</a></li>
<li><a href="../335516/index.html">Secure OpenVPN on VPS in a few minutes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>