<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple Image Viewer for iPhone</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Unfortunately, the iPhone SDK does not provide functionality similar to the one available in Photos. I do not mean the Image Picker, but the Viewer it...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple Image Viewer for iPhone</h1><div class="post__text post__text-html js-mediator-article">  Unfortunately, the iPhone SDK does not provide functionality similar to the one available in Photos.  I do not mean the Image Picker, but the Viewer itself, where you can move the image with your finger and zoom.  Here, I will try to explain how this functionality can be achieved and where to dig for its expansion ... <br><br><a name="habracut"></a><br>  The first thing that <em>catches your</em> eye is the <em>UIImageView</em> class, which allows you to draw an image from a file.  However, it lacks the functionality associated with processing user input, and most importantly, it has a limit on the number of pixels it can display.  According to the documentation, this is only 1024x1024 pixels: <br><br><blockquote>  ‚ÄúIt is greater than 1024 x 1024 pixels in size.  In addition, there is no support for images of the size. ‚Äù </blockquote>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Sadly ... However, we can create a <em>UIImage</em> from a <em>CGImage</em> , on which there is no such restriction.  In turn, a <em>CGImage</em> can be created from part of an image.  So, create a simple Cocoa Touch application that will include the <em>AppDelegate</em> class.  The wizard must generate the necessary code to create the application window.  We need to modify it to display a <em>UIImageView</em> .  The <em>UIImageView</em> itself is created by the method: <br><br><blockquote>  + (UIImage *) imageWithContentsOfFile: (NSString *) path </blockquote><br><br>  <em>path</em> contains the path to the file that we need to draw.  I will not go into the details of the file structure of applications on the iPhone, it is easier to refer to the Application Sandbox section in the iPhone Programming Guide.  To simplify the narration, assume that the desired file is in the Documents folder.  Below is a way to get the path to the file we add to the <em>AppDidFinishLaunching</em> method of the <em>AppDelegate</em> class: <br><br><blockquote>  // constructing path to the image <br>  NSArray * paths = NSSearchPathForDirectoriesInDomains (NSDocumentDirectory, NSUserDomainMask, YES); <br>  NSString * documentsDirectory = [paths objectAtIndex: 0]; <br>  NSString * fileName = @ "photo.jpg"; <br>  NSString * path = [documentsDirectory stringByAppendingPathComponent: fileName]; </blockquote><br><br>  Next, we create a <em>UIImageView</em> , using the created path and add it as a subview to our window, remembering to delete the object link: <br><br><blockquote>  UIImageView * anImageView = [[windowImageView alloc] initWithImage: path]; <br>  [window addSubview: anImageView]; <br>  [anImageView release]; </blockquote><br><br>  We start.  We look.  The image on the screen, however, it does not respond to user input.  In addition, as we know from the documentation, we cannot display an image in which there are more than 1024x1024 pixels. <br><br>  Exit, create your own class, based on <em>UIImageView</em> , which will process user input and allow you to create an image from a <em>CGImage</em> .  Add a new class to the project.  These are two files <em>MyImageView.h</em> and <em>MyImageView.m</em> .  The first one is as follows: <br><br>  #import &lt;UIKit / UIKit.h&gt; <br><br><blockquote>  <a href="https://habrahabr.ru/users/interface/" class="user_link">interface</a> windowImageView: UIImageView { <br><br>  } <br><br>  <a href="https://habrahabr.ru/users/end/" class="user_link">end</a> </blockquote><br><br>  Second: <br><br><blockquote>  #import "windowImageView.h" <br><br>  @implementation windowImageView <br><br>  - (void) dealloc { <br>  [super dealloc]; <br>  } <br><br>  <a href="https://habrahabr.ru/users/end/" class="user_link">end</a> <br></blockquote><br><br>  From the name of the <em>CGImage</em> class that we are going to use, it is clear that we will need a framework called <em>CoreGraphics</em> .  In Xcode, in the file list, select the Add Framework ... and find <em>CoreGraphics.framework</em> . <br><br>  Let's go ... First of all, you need to create a new method that will initialize <em>MyImageView</em> using the <em>CGimage</em> object.  In the <a href="https://habrahabr.ru/users/interface/" class="user_link">interface</a> block of the file MyImageView.h before the <a href="https://habrahabr.ru/users/end/" class="user_link">end</a> we write: <br><br><blockquote>  - (id) initWithCGImage: (CGImageRef) cg_image </blockquote><br><br>  Let me remind you that in curly brackets we declare instance variables, and after curly brackets - methods.  Having declared this function, we have to implement it.  This is done in the <em>@implementation</em> block of the file <em>MyImageView.m</em> : <br><br><blockquote>  - (id) initWithCGImage: (CGImageRef) cg_image { <br>  cg_raw_image = CGImageCreateCopy (cg_image); <br><br>  // position view in the center of an image <br>  current_x_position = CGImageGetWidth (cg_image) / 2 - 320/2; <br>  current_y_position = CGImageGetHeight (cg_image) / 2 - 480/2; <br>  // getting image data for the area being displayed <br>  CGRect subImageRect = CGRectMake (current_x_position, current_y_position, 320, 480); <br>  CGImageRef cg_subimage = CGImageCreateWithImageInRect (cg_image, subImageRect); <br>  UIImage * imageToDisplay = [UIImage imageWithCGImage: cg_subimage]; <br>  CGImageRelease (cg_subimage); <br>  if (imageToDisplay! = NULL) <br>  { <br>  if (self = [super initWithImage: imageToDisplay]) <br>  { <br>  // initialization code here <br>  } <br>  } <br>  return self; <br>  } </blockquote><br><br>  <em>cg_raw_image, current_x_position, current_y_position</em> are instance variables that we will use later to process user input.  The essence of this function is that we create a <em>UIImage</em> from a <em>CGImage</em> , which in turn is created as part of the original image and matches the size of the phone screen or the size of your view.  Of course, the use of numbers in this code should be replaced by a call to functions that allow you to get the dimensions of the view in which the image will be displayed.  It is worth noting the obligatory call of the <em>CGImageRelease</em> function, which reduces the object reference count, which leads to the release of the memory occupied by this object.  This function must be called again for <em>cg_raw_image</em> .  This should be done in the <em>dealloc</em> method of the <em>MyImageView</em> class. <br><br>  We need to modify <em>AppDelegate</em> to call the new method.  <em>ApplicationDidFinishLaunching</em> will now look like this: <br><br><blockquote>  - (void) applicationDidFinishLaunching: (UIApplication *) application { <br>  // no status bar in main window <br>  application.statusBarHidden = YES; <br>  // creating window <br>  self.window = [[[UIWindow alloc] initWithFrame: [[UIScreen mainScreen] bounds]] autorelease]; <br>  // constructing path to the image <br>  NSArray * paths = NSSearchPathForDirectoriesInDomains (NSDocumentDirectory, NSUserDomainMask, YES); <br>  NSString * documentsDirectory = [paths objectAtIndex: 0]; <br>  NSString * fileName = @ "photo.jpg"; <br>  NSString * path = [documentsDirectory stringByAppendingPathComponent: fileName]; <br>  NSURL * url = [NSURL fileURLWithPath: path]; <br>  // creating CG image <br>  CGDataProviderRef provider = CGDataProviderCreateWithURL ((CFURLRef) url); <br>  CGImageRef cg_image = CGImageCreateWithJPEGDataProvider (provider, NULL, true, kCGRenderingIntentDefault); <br>  if (cg_image! = NULL) <br>  { <br>  MyImageView * anImageView = [[MyImageView alloc] initWithCGImage: cg_image]; <br>  anImageView.userInteractionEnabled = TRUE; <br>  [window addSubview: anImageView]; <br>  [anImageView release]; <br>  } <br>  CGDataProviderRelease (provider); <br>  CGImageRelease (cg_image); <br>  // Override point for customization after app launch <br>  [window makeKeyAndVisible]; <br>  } </blockquote><br><br>  Here, instead of a <em>UIImage</em> , using a <em>JPEGDataProvider</em> , we create a <em>CGImage</em> , which we use to initialize <em>MyImageView</em> .  Now, after launching the program, we should have a result similar to what we had using a <em>UIImage</em> .  However, we got rid of the limit on the number of pixels in the file.  It is worth paying attention to the line: <br><br><blockquote>  anImageView.userInteractionEnabled = TRUE; </blockquote><br><br>  This allows our new class to respond to touch.  Let's go back to our class and add functions to handle user input.  The iPhone SDK does this using three functions: <br><br><blockquote>  - (void) touchesBegan: (NSSet *) touches withEvent: (UIEvent *) event; <br>  - (void) touchesMoved: (NSSet *) touches withEvent: (UIEvent *) event; <br>  - (void) touchesEnded: (NSSet *) touches withEvent: (UIEvent *) event; <br></blockquote><br><br>  At the moment we are only interested in <em>touchesMoved</em> , because  we want to move our image with our finger.  Add the <em>touchesMoved</em> function to <em>MyImageView</em> : <br><br>  - (void) touchesMoved: (NSSet *) touches withEvent: (UIEvent *) event { <br><br>  UITouch * touch = [[event allTouches] anyObject]; <br>  int x_dist = [touch previousLocationInView: self] .x - [touch locationInView: self] .x; <br>  int y_dist = [touch previousLocationInView: self] .y - [touch locationInView: self] .y; <br>  current_x_position = current_x_position + x_dist; <br>  current_y_position = current_y_position + y_dist; <br>  CGRect subImageRect = CGRectMake (current_x_position, current_y_position, 320, 480); <br><br>  CGImageRef cg_subimage = CGImageCreateWithImageInRect (cg_raw_image, subImageRect); <br>  UIImage * imageToDisplay = [UIImage imageWithCGImage: cg_subimage]; <br>  CGImageRelease (cg_subimage); <br>  self.image = imageToDisplay; <br>  } <br><br>  Here, we get a <em>touch</em> object that contains touch information made by the user.  This allows us to track the user's movement and calculate the distance in pixels by which we should move the image.  As the event occurs, we create a new image as part of the main image and display it by changing the image value of the <em>MyImageView</em> class.  The drawing of the new image takes place automatically. <br><br>  Everything described above demonstrates the principles that will allow to achieve functionality similar to the one that exists in the Photo application.  Here you need to add a lot of things, including checking out of the image, and zooming using two fingers, and much more ... <br><br>  In addition, similar functionality can be implemented using <em>UIView</em> , from which the <em>UIImageView</em> class is <em>inherited</em> .  This will increase the flexibility of the application, but you will have to implement image drawing in the <em>DrawRect</em> method. <br></div><p>Source: <a href="https://habr.com/ru/post/26771/">https://habr.com/ru/post/26771/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../267701/index.html">Playing on bare HTML / CSS</a></li>
<li><a href="../267703/index.html">Putting gnome-screenshot from source to change the format of the screenshot file name</a></li>
<li><a href="../267705/index.html">Violet M-125</a></li>
<li><a href="../267707/index.html">Game client download tracking system</a></li>
<li><a href="../267709/index.html">Oracle hardware and software systems - open topic</a></li>
<li><a href="../267711/index.html">The benefits of iron, or familiarity with GPS / GLONASS trackers</a></li>
<li><a href="../267713/index.html">Centralized configuration management: Puppet + Foreman. Part II</a></li>
<li><a href="../267715/index.html">Why Vue?</a></li>
<li><a href="../267717/index.html">Unicorns ... Unicorns everywhere</a></li>
<li><a href="../267719/index.html">Algorithms in the real world</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>