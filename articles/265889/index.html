<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>.NET Native - what does this mean for developers under a universal Windows platform (UWP)?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In Windows 10, universal Windows applications in managed languages ‚Äã‚Äã(C #, VB) undergo in the store a compilation procedure into native code using .NE...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>.NET Native - what does this mean for developers under a universal Windows platform (UWP)?</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  <i>In Windows 10, universal Windows applications in managed languages ‚Äã‚Äã(C #, VB) undergo in the store a compilation procedure into native code using .NET Native.</i>  <i>In this article, we invite you to learn more about how it works and how it affects the application development process.</i>  <i>Below you will find a video interview with a representative of the .NET Native development team and a translation of the relevant article.</i> <i><br></i> <br><iframe src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://channel9.msdn.com/Blogs/DevRadio/NET-Native-Performance-Optimizing-Your-Windows-Apps-with-NET-Native/player&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhizWX4fYzAhGCyq-GHQckYCeaKmCg" width="640" height="360"></iframe><br></blockquote><br><br><h2>  What is .NET Native? </h2><br>  <a href="https://msdn.microsoft.com/en-us/library/dn584397(v%3Dvs.110).aspx">.NET Native</a> is a precompile technology used to create generic Windows applications in Visual Studio 2015. The .NET Native tools compile your IL libraries with managed code into native libraries.  Each managed (C # or VB) universal Windows application uses this technology.  Applications are automatically compiled into the native code before they reach the end device.  If you want to dive deeper into how it works, we recommend the article ‚Äú <a href="https://msdn.microsoft.com/ru-ru/library/dn584397(v%3Dvs.110).aspx">Compiling applications using native .NET code</a> ‚Äù. <br><a name="habracut"></a><br><h2>  How will .NET Native affect me and my application? </h2><br>  Specific indicators may vary, but in most cases your application will run faster, run faster, and consume less system resources. <br><ul><li>  Up to 60% increase in cold start speed </li><li>  Up to 40% increase in hot start speed </li><li>  Reduced memory consumption when compiled into native code </li><li>  No dependency on the .NET Runtime during installation </li></ul><br><br>  Since your application is compiled into native code, you will get a performance boost related to the speed of native code execution (close to C ++ performance).  In this case, you can still enjoy the benefits of industrial programming languages ‚Äã‚ÄãC # or VB and related tools. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      You can also continue to use the full power of the software model available in .NET with a wide range of APIs for describing business logic and with built-in memory management and exception handling mechanisms. <br>  In other words, you get the best of both worlds: managed development with performance close to C ++.  Isn't that great? <br><br><h2>  Differences compilation settings in debug and release </h2><br>  Compiling in .NET Native is a complex process, usually slower compared to classic compiling in .NET.  The advantages mentioned above have a price in the form of a compile time.  You can choose to compile natively each time you launch the application, but you will spend more time waiting for the build to complete.  Visual Studio tools can help you better manage this by smoothing out development experience as much as possible. <br><br>  When you build a project and run in debug mode, you use the IL code on top of CoreCLR, which is packaged in your application.  System .NET assemblies are added to the code of your application, and your application considers dependency on the Microsoft .NET.CoreRuntime (CoreCLR) package. <br>  This means that you get the best possible development experience: fast compilation and deployment, extensive debugging and diagnostic capabilities, and the performance of all the other tools you are used to when developing in .NET. <br><br>  When you switch to release mode, by default, your application starts using the .NET Native build chain.  Since the package is compiled into native code, it is no longer required that the package contain the libraries of the .NET framework.  In addition, the package now depends on the latest version of the .NET Native environment - unlike the CoreCLR package.  The .NET Native runtime on the device will always be compatible with your application package. <br><br>  Local native compilation with release configuration allows you to test the application in an environment close to what the end user will have.  <b>It is important to regularly test in this mode as you develop.</b> <br><br>  A good rule that you can make a habit of is testing your application this way during the development process to make sure you find and fix problems that can occur as a result of compiling with .NET Native.  In most cases, there should be no problems, however, we know a few things that do not work very well with .NET Native.  For example, arrays with dimensions greater than four.  In the end, your users will get the version of your application compiled via .NET Native, so it‚Äôs good to check that everything works in advance and before the application is delivered. <br><br>  In addition to the fact that it would be nice to test in native compilation mode, you may also notice that the configuration of the AnyCPU assembly has disappeared.  With the advent of .NET Native, the AnyCPU configuration no longer makes sense, since native compilation depends on the architecture.  An additional consequence of this is that when you package your application, you need to select all three architecture configurations (x86, x64 and ARM) to be sure that your application will run on the maximum number of devices.  Still, this is a universal Windows platform!  By default, Visual Studio is configured to build in exactly the same way as shown in the screenshot below. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cc0/8d6/beb/cc08d6bebe4157ce133656482c44b869.png"><br>  <i>All three architectures are selected by default.</i> <br><br>  It is important to note that you can still build AnyCPU libraries and use the appropriate DLLs in your UWP application.  These components will be compiled into binary libraries under the corresponding architectures specified in the project settings. <br><br>  Finally, the last significant change in the usual approach as a result of switching to .NET Native is how you create packages for the store.  One of the key features of .NET Native is that the compiler can work in the cloud.  When you create a package for a store in Visual Studio, two packages are created: .appxupload for the store and a ‚Äútest‚Äù .appx for local installation.  The .appxupload package contains MSIL assemblies, as well as explicit references to the .NET Native version used by your application (specified in AppxManifest.xml).  This package is then sent to the store and compiled using the same version of the .NET Native compilation chain.  Since the compiler is in the cloud, it can be reused to fix bugs without having to recompile applications locally. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b11/98d/306/b1198d3066f4cbd8d4a378a3d6379412.png"><br>  <i>Package .appxupload goes to the store;</i>  <i>the Test folder contains the appx package for local installation</i> <br>  Two implications of this: first, as a developer, you no longer have access to the revision number of your application (the fourth number).  The store reserves this number as a way of versioning the application package if, for any reason, it will be necessary to recompile in the cloud.  Don't worry, you can still control <a href="https://msdn.microsoft.com/en-us/library/windows/apps/mt188602.aspx">three other numbers</a> . <br><br>  The second thing you need to keep in mind is that you need to be careful about which package you download to the store.  Since the store compiles the machine code for you, you cannot load native assemblies created by the local .NET Native compiler.  Visual Studio helps you figure this out so that you can choose the right package. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/580/80f/92a/58080f92a8a875e860f13808eaa7ff68.png"><br>  <i>Select ‚ÄúYes‚Äù to upload to the store.</i> <br><br>  When you use the helper to create application packages, you need to select ‚ÄúYes‚Äù when asked by Visual Studio if you want to create a package to upload to the store.  I also recommend choosing ‚ÄúAlways‚Äù for the ‚ÄúGenerate app bundle‚Äù option, which will create a single .appxupload file ready for download.  Complete instructions for creating packages for the store are available in the article ‚Äú <a href="https://msdn.microsoft.com/ru-ru/library/hh454036.aspx">Packaging of Universal Windows Applications for Windows 10</a> ‚Äù. <br><br>  As a summary, the main changes in the way you work, from using .NET Native: <br><ul><li>  Test your app regularly in release mode. </li><li>  Make sure that you leave the revision number of the package as 0. Visual Studio will not allow you to change it, but you also should not do this in other editors. </li><li>  Download only the .appxupload collected during the creation of the package for the store, if you download the .appx for the UWP application, you will receive an error in the store. </li></ul><br><br><h2>  More tips on using .NET Native </h2><br>  If you encounter a problem, the reason for which you suspect. NET Native, there is a technique that will help you debug such a problem.  The default release configuration optimizes the code so that it loses some of the artifacts used in debugging.  As a result, an attempt to debug release configuration will be complicated.  Instead, you can create your own configuration by allowing it to use .NET Native compilation.  Make sure you are not optimizing the code.  Read more about this in the article ‚Äú <a href="http://blogs.msdn.com/b/visualstudioalm/archive/2015/07/29/debugging-net-native-windows-universal-apps.aspx">Debugging .NET Native Windows Universal Apps</a> ‚Äù. <br><br>  Now that you know how to debug problems, wouldn't it be even better to learn how to avoid them?  To do this, you can put <a href="https://www.nuget.org/packages/Microsoft.NETNative.Analyzer/">Microsoft.NETNative.Analyzer</a> into your application via NuGet (from the package management console, you can use the ‚ÄúInstall-Package Microsoft.NETNative.Analyzer‚Äù command).  During development, the analyzer will warn you if your code is not compatible with the .NET Native compiler.  There is a small subset of the .NET space that is not compatible, but most applications will never encounter such a problem. <br><br>  If you want to self-assess improvements in download time from switching to .NET Native, you can <a href="https://msdn.microsoft.com/ru-ru/library/dn643729">measure</a> them yourself. <br><br><h2>  Known problems and solutions </h2><br>  There are a few things to keep in mind when using the Windows Application Certification Kit (WACK) to test your applications: <br><ol><li>  When you run WACK on a UWP application that does not go through the compilation procedure, you will encounter a nontrivial problem.  It looks like this: <br><ul><li>  API ExecuteAssembly in uwphost.dll is not supported for this application type.  App.exe calls this API. </li><li>  DllGetActivationFactory API in uwphost.dll is not supported for this application type.  App.exe has an export that forwards to this API. </li><li>  API OpenSemaphore in ap-ms-win-core-synch-11-1-0.dll is not support for this application type.  System.Threading.dll calls this API. </li><li>  API CreateSemaphore in api-ms-win-core-kernel32-legacy-11-1-0.dll is not supported for this application type.  System.Threading.dll calls this API. </li></ul><br>  The solution is to make sure that you package correctly and run WACK on the appropriate package.  Follow the <a href="https://msdn.microsoft.com/library/windows/apps/hh454036.aspx">build recommendations</a> to avoid such a problem. <br></li><li>  .NET Native applications that use reflection may fail in the Windows App Cert Kit (WACK) with a reference to Windows.Networking.Vpn for correction.  To solve the problem in the rd.xml file, add the following line and rebuild the package: <br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt; </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Namespace</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">‚ÄùWindows.Networking.Vpn‚Äù</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Dynamic</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">‚ÄùExcluded‚Äù</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Serialize</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">‚ÄùExcluded‚Äù</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Browse</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">‚ÄùExcluded‚Äù</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Activate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">‚ÄùExcluded‚Äù</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> </li></ol><br><br><h2>  Summing up </h2><br>  All Windows users should benefit from using .NET Native.  Managed apps from the store will start and run faster.  Developers will be able to combine development experiences in .NET in <a href="https://www.visualstudio.com/features/windows-apps-games-vs">Visual Studio</a> , and users will get a performance boost from machine code.  If you want to tell us about your experiences or wishes, use <a href="http://visualstudio.uservoice.com/">UserVoice</a> .  If you want to report an error, please fill in the information on <a href="https://connect.microsoft.com/visualstudio">Connect</a> . </div><p>Source: <a href="https://habr.com/ru/post/265889/">https://habr.com/ru/post/265889/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../265873/index.html">How we held a hardware hack contest at Chaos Constructions 2015</a></li>
<li><a href="../265875/index.html">The evolution of the cloud log collection and the log collector in open source</a></li>
<li><a href="../265883/index.html">Mobile integration with the new cloud PBX 3CX v14</a></li>
<li><a href="../265885/index.html">Video about effective altruism</a></li>
<li><a href="../265887/index.html">‚ÄúBigdata Conference‚Äù - the largest conference on big data very soon</a></li>
<li><a href="../265893/index.html">QA in our time. The ‚ÄúSwitcher Principle‚Äù or why the industry critically lacks competence</a></li>
<li><a href="../265895/index.html">I am not a camel or overly vigilant google</a></li>
<li><a href="../265903/index.html">Contest "Confess your love or write a poem on Ruby on Rails"</a></li>
<li><a href="../265905/index.html">Meet Moto CMS 3</a></li>
<li><a href="../265909/index.html">KolibriOS Digest # 9</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>