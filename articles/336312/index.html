<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Good bad monkey patching</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We are often asked questions about technology in letters and messages - we are happy to answer. But in this case, the answer is one person, and he cou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Good bad monkey patching</h1><div class="post__text post__text-html js-mediator-article"><p>  We are often asked questions about technology in letters and messages - we are happy to answer.  But in this case, the answer is one person, and he could be useful to many. </p><br><p>  Therefore, we decided to analyze weekly on one issue, literally in five minutes. </p><br><p> <a href="https://habrahabr.ru/company/htmlacademy/blog/336312/"><img src="https://habrastorage.org/web/077/37d/46b/07737d46b0d94212ad63a16935d001e0.jpg"></a> </p><br><p>  Today, the question about the development of Sergey, our teacher Igor Alekseenko answers: </p><br><blockquote>  Mankipatching - why is it so bad or not so bad? </blockquote><a name="habracut"></a><br><p>  It is difficult to answer this question without starting a holivar.  Mankipatching works, so you can‚Äôt say that it‚Äôs bad, but it‚Äôs important to remember that it‚Äôs very easy to shoot yourself in the foot. </p><br><p>  Mankipatching is when we change the code in runtime, that is, as the program runs.  For example, add non-existent methods to an array or override some global function. </p><br><pre><code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.prototype.shuffle = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> i = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.length; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (i--) { fisherYatesShuffle(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, i); } }; [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>].shuffle();</code> </pre> <br><p>  Mankipatching is ideal for one-time tasks when reverse engineering is needed.  For example, if you need to debug a solution to the problem or once to collect some analytics, this will do, but these are obviously one-time approaches. </p><br><p>  If we talk about industrial code, then carelessly handling monkey patches, you can break the work of the built-in objects that will be used throughout the program.  Imagine that for some reason you have changed the behavior of the setTimeout function.  Externally, it works the same way, but additionally this function solves some other tasks, for example, it stores the context. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> initNewTimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> initialTimeout = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setTimeout; <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setTimeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">fn, timeout, ctx</span></span></span><span class="hljs-function">) </span></span>{ initialTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ fn.call(ctx); }, timeout); } }; initNewTimeout(); setTimeout(tickInContext, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);</code> </pre> <br><p>  Of course, in your code, setTimeout will work as you need, but you cannot guarantee that everything else will work just as smoothly in other places where it is used.  There are more extreme examples, for example, earlier in JavaScript it was possible to override even undefined and window. </p><br><p>  It turns out that with monkey patching you need to be very careful and adhere to certain rules: </p><br><ul><li><p>  Adding a new one is better than changing the old one. </p><br><p>  Changing the behavior of methods that are already built into the language is bad, because they can be used elsewhere besides your code.  But to add something new than someone else would hardly think of to use is relatively safe.  For example, add a method of mixing them into arrays.  However, after some time, such a method may appear in the array - standards are developed, and browsers quickly pick them up. </p><br></li><li><p>  Need to carefully test the patches. </p><br><p>  This is a general advice for developers, but when it comes to monkey patches, you need to be doubly careful, because in one place they can help, and in another they can only be harmful.  When writing monkipatches, you need to test not only the patch itself, but it would also be good to check if something broke at the level of the entire application. </p><br></li><li><p>  It is better to use patches as temporary solutions. </p><br><p>  Since monkeypatch can harm, they must be abandoned as soon as it becomes possible. </p><br></li></ul><br><p>  According to these rules, polyfiles are created - patches that add support for new features to old browsers.  Agree how much the name changes its attitude to the approach.  There were monkey corrections, and it became a universal filler.  There were incomprehensible changes to the built-in objects, and there was a fix for problems supporting the new standards. </p><br><p>  It seems that polyfiles are a good idea: you connect a polyfile and regardless of what browser the user has, you can use new things in the code, for example, Fetch for HTTP requests, Promise or Object.entries for iterating over objects. </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"./promise-polyfill.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"./whatwg-fetch.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> fetch(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'/api/request'</span></span></span><span class="javascript">) .then(</span><span class="hljs-function"><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">resp</span></span></span></span><span class="javascript"><span class="hljs-function"> =&gt;</span></span></span><span class="javascript"> resp.json()) .then(</span><span class="hljs-function"><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">json</span></span></span></span><span class="javascript"><span class="hljs-function"> =&gt;</span></span></span><span class="javascript"> render); </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  But there are problems with this approach: </p><br><ul><li><p>  Something needs to be done with those browsers that already support what you are patching. </p><br><p>  It would be ideal to disable patches for those browsers in which the feature is already supported.  Usually, the developers of polyphiles take it upon themselves, but this point needs to be checked. </p><br></li><li><p>  Compliance. </p><br><p>  If we are talking about an already accepted standard that works in at least one browser and its support in the rest is just a matter of time, then there is no problem.  But if we talk about the standard still under discussion, it is better not to create a polyfil, because programmers can start using it and get used to it, and standard developers will not be able to make any improvements to the standard, because the standard will be fixed de facto. </p><br></li></ul><br><p>  In such situations, it is better to use wrapper functions, which are sometimes called <a href="http://ponyfill.com/">Ponifil</a> .  In principle, they allow you to do the same as polyfiles, but clearly.  They also have no problems with standards: for example, the popular Lodash library grew out of a wrapper over non-working iterators in arrays.  The guys added to the library forEach, map and other some, every, but they were not tied to the standard and therefore they had their hands untied from the beginning.  Over time, they added other convenient methods for arrays and collections, such as shuffle, unique, flatten, and others.  Despite the fact that iterators in arrays have been supported for a long time, Lodash is successfully developing. </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  [1, 2, 3].map(it =&gt; it / 2); //  arrayMap([1, 2, 3], it =&gt; it / 2);</span></span></code> </pre> <br><p>  Still, functions are easier to test.  It is very difficult to test a polyfil completely.  If you connect it in the same place where the tests are performed, your patch may change the code of the framework itself, which may affect the testing.  And if you test the logic of polyfiles separately, it will be unclear whether they are connected correctly. </p><br><p>  Even in different environments, your tests will work differently, because in some environments the patch will work, in others it will not.  Ponifil has no such problems: you always know what you are testing, they connect and work clearly. </p><br><h2 id="podytozhim">  Summarize </h2><br><p>  Is miscatching bad?  Judging by the fact that it works, it is not so bad, but when using it you need to remember that it‚Äôs easier to break someone else‚Äôs code, it‚Äôs harder to test and you can forget that it is used. </p><br><h1 id="materialy-po-teme">  Materials on the topic </h1><br><ul><li>  <a href="https://github.com/jonathantneal/document-promises/issues/4">Please rename ASAP</a> </li><li>  <a href="https://davidwalsh.name/monkey-patching">Monkey patching</a> </li><li>  <a href="https://habrahabr.ru/company/wrike/blog/310422/">Zone.js or how Dart saved Angular</a> </li></ul><br><h2 id="videoversiya">  Video version </h2><br><iframe width="560" height="315" src="https://www.youtube.com/embed/_1zIZhtZYek" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  Questions can be asked <a href="https://htmlacademy.ru/shorts">here</a> . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/336312/">https://habr.com/ru/post/336312/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../336302/index.html">Analysis of MS SQL Server, for those who see it for the first time</a></li>
<li><a href="../336304/index.html">How to overcome common graphics artifacts</a></li>
<li><a href="../336306/index.html">Explore and optimize Object # toString performance in ES2015</a></li>
<li><a href="../336308/index.html">Overview of one Russian RTOS</a></li>
<li><a href="../336310/index.html">Install and configure the main scene in MajorDoMo</a></li>
<li><a href="../336314/index.html">We consider the tasks of the hackathon from Promsvyazbank. Why can a hackathon?</a></li>
<li><a href="../336316/index.html">Basics of contractual work in IT: contractors and employees</a></li>
<li><a href="../336318/index.html">Automatic sales funnels: technical implementation</a></li>
<li><a href="../336320/index.html">Linux redirection</a></li>
<li><a href="../336326/index.html">How complex automation can help if you have a small business</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>