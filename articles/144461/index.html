<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Pulls - pulls, can not pull ...</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As a person owing to the development of a new system, I am often asked the same question: ‚ÄúHow many users are the system pulling?‚Äù. A very awkward que...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Pulls - pulls, can not pull ...</h1><div class="post__text post__text-html js-mediator-article">  As a person owing to the development of a new system, I am often asked the same question: ‚ÄúHow many users are the system pulling?‚Äù.  A very awkward question, isn't it?  I always first want to exercise in wit, and to include a model of the ‚Äúharmful admin‚Äù behavior: to ask a few counter questions that will save me from having to think about this difficult but interesting topic for a while: <br>  ‚Ä¢ What is the hardware configuration? <br>  ‚Ä¢ How much time should ‚Äúpull‚Äù? <br>  ‚Ä¢ What is the initial volume of data? <br>  Well, the control shot: what does ‚Äúpulling‚Äù mean? <br>  But, you want you do not want, and it is necessary to answer.  On one difficult search for an answer to this question is my next post. <a name="habracut"></a><br><br><h4>  <b>What do we pull?</b> </h4><br>  Our test subject is the EUFRAT E1 document management system.  A completely new system, written almost from scratch in the last 2-3 years in the depths of Cognitive Technologies LLC. <br>  The system has a three-tier architecture: a database (MS SQL), an application server based on IIS plus thick and mobile clients.  The main development platform is .NET 3.5, the main language is C #.  As is often the case, during the release process some attention was paid to load tests, but not enough to understand the capabilities of the created architecture.  And at the moment when life forced to answer the main question of the post, some infrastructure for stress tests still existed.  It was created on the built-in toolkit MS Visual Studio. <br>  We have prepared a stand that includes an average power server (virtual Windows Server 2008 R2, 6 CPUs, 10 GB of RAM), on which a database, an application server, and a computer with tests simulating client applications were deployed.  A common test scenario simulates a typical large organization's work day.  Each test script performed a specific user role in record management: the registrar, the document and route controller, the assignee, approvals, and the user who simply read the mail and viewed the available documents. <br>  The percentage of user roles in the overall scenario is presented in Figure 1.  This distribution was made after a small marketing research of customers on the previous version of the system. <br><br><img src="https://habrastorage.org/storage2/6c2/e77/5b8/6c2e775b8d19b1ab10afb0fc41d72eab.png"><br>  Fig. 1. Distribution of scenarios. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      After long discussions, we determined for ourselves what ‚Äúpulls‚Äù?  This is uninterrupted operation of the server according to the scenario model described above, for 8 working hours and without server errors.  At the same time, the percentage of failed client tests should not exceed 0.5% (errors in the business logic of tests, unexpected timeouts, etc., are possible).  The measurement will be subject to the maximum possible number of simultaneously connected users (tests) when all the above conditions are met. <br><br><h4>  <b>How do we pull?</b> </h4><br>  The next problem that had to be solved: how exactly to choose the most optimal number of users?  To do a lot of starts at 8 o'clock is a long and not rewarding lesson.  Therefore, it was proposed to change the number of simultaneous tests dynamically in order to get the optimal rate for one 8-hour run.  But depending on what?  There are a lot of options than to determine server load: requests processing queue on the server, speed of execution of requests on the client, number of error tests, etc ... <br>  Here it is worth making a small digression for a better understanding of the further description.  The application server of the system processes client requests in the following way: all requests come in one queue and wait for their processing.  there is <br>  customizable workflow pool  In our case, there were 12: 2 per core <br>  processor.  The last request in the queue goes to the first processing <br>  the released workflow. <br>  As a result, after a series of experiments, it was concluded that the optimal <br>  to determine the number of users in our case is to measure the load <br>  these workflows.  It was calculated as the ratio of the load time of threads to their idle time, expressed as a percentage.  Thus, 50% means that the workflow is idle for half the time, 90% - the workflow is almost all the time loaded.  The control function is quite simple: a workload in the range of 70-90% is considered normal.  If the threads load is less than 70%, then a new test was added, and if it is more than 90%, one of the tests no longer started. <br>  What is the result?  Ideally, we wanted to get a straight line showing the optimal number of users at the end of the test for this configuration.  Unfortunately, it never ‚Äúsettled down‚Äù.  (see graph in fig.2) <br><br><img src="https://habrastorage.org/storage2/fc7/6b7/4e8/fc76b74e8be89bc8c045958f8cdf0540.png"><br>  Fig.2.  The result of the automatic determination of the optimal number of users. <br><br>  As a result, 8 hours of test: <br>  ‚Ä¢ The size of the database - 9719.50 MB; <br>  ‚Ä¢ Documents in the database - 4885; <br>  ‚Ä¢ Orders in the database - 14478. <br><br>  It is clearly seen that the deviation from the average value, equal to 270 users, is small.  It is clear that this is how the optimal number of users was determined in the "intensive" mode of server load for this hardware configuration.  Naturally, in real life, users do not work with the system like this, i.e.  indicators of 1000 and more simultaneous users on more powerful configurations are quite good. <br>  I would like to make a reservation right away that the process was quite long, because  In the course of testing, server load control parameters were selected for a long time, errors on the server and client were corrected, etc. <br><br><h4>  <b>What pulled?</b> </h4><br>  If you need to answer how much the system ‚Äúpulls‚Äù or a similar tricky question, then you need to follow a few simple rules: <br>  1. Clearly set the task - what do we want to learn about our architecture in a certain environment? <br>  2. Formally determine what exactly we want to measure, and what value should this indicator correspond to? <br>  3. Record all other possible test parameters that we can fix: hardware configuration, test scripts, their distribution, etc. <br>  4. In the process of approaching the answer to the question, do not be distracted by other interesting and unpredictable research tasks. <br>  You can consider this set of rules as a starting point for those who plan to tackle the tasks of measuring and improving performance, but where to begin is not clear. <br>  And to the eyeballs, a small hit parade of other "uncomfortable" issues related to load testing: <br>  1. ‚ÄúWhat server is needed for XXX users?‚Äù <br>  2. ‚ÄúHow many objects can I enter into the system?  The place will not end? " <br>  3. "What is the speed of the network should be so that everything runs fast?" <br>  4. And my favorite: ‚ÄúIf we buy a powerful server, stop falling?‚Äù <br>  As you can see, the space for future work is provided to us.  I hope that the Visual Studio toolkit is enough for this ... </div><p>Source: <a href="https://habr.com/ru/post/144461/">https://habr.com/ru/post/144461/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../144455/index.html">Database Hacking due to LFI</a></li>
<li><a href="../144456/index.html">Software Development Methodology</a></li>
<li><a href="../144457/index.html">YOTA has included LTE network in Samara</a></li>
<li><a href="../144459/index.html">St. Petersburg: you can already put the phone to the turnstile</a></li>
<li><a href="../144460/index.html">Support for touchscreen devices will be improved in CSS4 media queries</a></li>
<li><a href="../144462/index.html">CircleCI - a review of the new service Continuous Integration</a></li>
<li><a href="../144463/index.html">DigiTimes: Google will launch its tablet in June</a></li>
<li><a href="../144464/index.html">Grounding What it is and how to do it (part 1)</a></li>
<li><a href="../144465/index.html">Allow customers to make free Skype calls to their office</a></li>
<li><a href="../144466/index.html">Greensock: JavaScript Animation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>