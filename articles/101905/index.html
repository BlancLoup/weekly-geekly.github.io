<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ideal corporate email client</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When it becomes necessary to set up a mail system for a company, first of all it comes to mind to use solutions from Microsoft - Exchange and Outlook....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ideal corporate email client</h1><div class="post__text post__text-html js-mediator-article"><img align="right" src="https://habrastorage.org/storage/habraeffect/e4/04/e40404dca8a07beb47a482ff0d336ca3.jpg">  When it becomes necessary to set up a mail system for a company, first of all it comes to mind to use solutions from Microsoft - Exchange and Outlook.  Unfortunately, these solutions do not provide sufficient flexibility and many do not fit in different parameters. <br><br>  Well, but what to use instead of them, because you want the same beautiful and transparent for the user to work with mail, which provides the MAPI protocol?  A small shuffle and the light gives rise to a completely obvious and in fact no alternative solution - <b>IMAP</b> .  IMAP, thank God, in the modern world almost all email clients support one or another degree, so our choice is huge.  But if you take a closer look, it narrows to a very modest set of one or two titles. <br><br>  So, we would like to: <br><ul><li>  To begin with - cross-platform.  It is foolish to use standardized technologies, but initially being tied to one OS, then it‚Äôs easier to buy Exchange right away and forget about any flexibility of the deployed infrastructure. </li><li>  Full support for <b>IMAP</b> and <b>IMAP ACL</b> .  The second point is important because  without it, it will be impossible to organize neither shared folders, nor the transfer of rights to various operations with the box to other users, and without this in the corporate mail system in any way. </li><li>  <b><i>The ability to centrally configure the client through the server.</i></b> </li><li>  Client configuration flexibility and ease of use. </li></ul>  A brief search on the Internet can tell that the only option that could be considered closer is <b>Mozilla Thunderbird</b> .  But the question is: can Thunderbird provide all the necessary functionality so that you can easily replace Exchange and Outlook with it?  It turns out not only can, but also allows you to achieve much more than just a banal imitation of Microsoft products. <br> <a href=""><img src="https://habrastorage.org/storage/15d99bea/74da9b7e/c6a0ca3b/ad80903c.png" align="right"></a> <br><a name="habracut"></a>  To begin with, of course, you need to decide on the server, but something I was too smartly going to replace the entire infrastructure with the mail client.  I use <b><a href="http://dovecot.org/">Dovecot</a></b> because it is one of the most reliable and flexible products in its field, but most importantly, <b>Dovecot is the</b> <i>only</i> widely used server that fully <a href="http://imapwiki.org/ImapTest/ServerStatus">implements IMAP support</a> .  You can use any other server, but for maximum efficiency, your server should at least support IMAP ACL. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  In the wilds of configs </h4><br>  Now let's go directly to Thunderbird.  All settings Thunderbird stores in the form of many favorite text-based configuration files, but in a somewhat unusual manner.  Thunderbird configs are <b>JavaScript</b> scripts.  And Thunderbird does not just read them, but executes them.  A very funny conclusion follows from this: one can use many possibilities of JS to dynamically generate the necessary parameters.  Of course, JS support in Thunderbird is far from complete, but we will have enough of it with interest. <br><br>  The main Thunderbird configuration file is stored in the user profile and is called <i>prefs.js</i> .  Just in case: the Thunderbird profile is located either in the home folder (for Linux), or in AppData (for Windows), or in the program folder (for Thunderbird Portable). <br><br>  The format of the specified file is quite simple, it consists entirely of lines of the form <br><br><pre><code class="javascript">user_pref("app.update.auto", false);</code></pre><br>
  ,            .<br>
<br>
  <i>prefs.js</i>  ,       Thunderbird.         ,         <i>prefs.js</i>.        <i>-&gt;...</i>,       <i></i>,    <i></i>      <i> ...</i><br>
<br>
<i><b>     ,     .   -       ,         .</b></i><br>
<br>
<h4>Mozilla AutoConfig (aka Mission Control)</h4><br>
      .    ,   <i>prefs.js</i> ,     ,   Thunderbird     ,           <i>prefs.js</i>.<br>
<br>
       JavaScript ,             ,          JavaScript   .<br>
<br>
            Thunderbird.          <b>greprefs/all.js</b>,     <i>/usr/lib/thunderbird-xxx/</i>  Ubuntu Linux    Thunderbird.exe  Windows.   :<br>
<br>
<pre><code class="javascript">pref("general.config.obscure_value", 0);
pref("general.config.filename", "thunderbird.cfg");</code></pre><br>
     ,    Thunderbird,      .     ,        0.<br>
<br>
     <i>thunderbird.cfg</i>.       ,      Thunderbird. ,   Thunderbird  Linux  <br>
<br>
<pre><code class="bash">which thunderbird</code></pre><br>
   Windows   , ,   .<br>
<br>
    <i>thunderbird.cfg</i>?  JavaScript ,    Thunderbird.  -     ,      :<br>
<br>
<pre><code class="javascript">function pref(prefName, value) 
function defaultPref(prefName, value)
function lockPref(prefName, value) 
function unlockPref(prefName) 
function getPref(prefName)
function clearPref(prefName)
function getenv(envName)</code></pre><br>
    ,      .   ,      ,  <a href="http://www.it-sudparis.eu/s2ia/user/procacci/netscape/en/mozilla-autoconfig-en.html"></a>.<br>
<br>
,      ?<br>
<ol>
<li><b>pref</b> ‚Äî     .          Thunderbird,      <i>thunderbird.cfg</i>,             .</li>
<li><b>defaultPref</b> ‚Äî       .       .</li>
<li><b>lockPref</b> ‚Äî  , , .        ,       .</li>
<li><b>unlockPref</b> ‚Äî    ,    .</li>
<li><b>getPref</b> ‚Äî     .</li>
<li><b>clearPref</b> ‚Äî    .</li>
<li><b>getenv</b> ‚Äî      .</li>
</ol>     LDAP,      ,       .     ,    .<br>
<br>
    <i>thunderbird.cfg</i>,   ¬´¬ª Thunderbird:<br>
<br>
<pre><code class="javascript">//   Thunderbird   Mozilla AutoConfig
try {
        //   , Thunderbird  (  ,      )
        if(getenv("USER") != "") {
                // *NIX 
                var env_user    = getenv("USER");
                var env_home    = getenv("HOME");
        } else {
                // Windows 
                var env_user    = getenv("USERNAME");
                var env_home    = getenv("HOMEPATH");
        }
        
        //     account1
        defaultPref("mail.accountmanager.defaultaccount", "account1");
        //        account1
        defaultPref("mail.accountmanager.accounts", "account1");
        //    account1  server1 (IMAP)
        lockPref("mail.account.account1.server", "server1");
        //        IMAP  ,
        //        
        lockPref("mail.accountmanager.localfoldersserver", "server1");
        
        //   "   "   
        lockPref("mail.rights.version", 1);
        //   .   ,      
        // all.js     Mozilla AutoConfig .
        lockPref("app.update.enabled", false);
        lockPref("extensions.update.enabled", false);

        //  IMAP 
        lockPref("mail.server.server1.type", "imap");
        lockPref("mail.server.server1.hostname", "mail.domain.com");      // ,   ,   ,
        lockPref("mail.server.server1.realhostname", "mail.domain.com");  //       
        lockPref("mail.server.server1.port", 143);                        //  
        lockPref("mail.server.server1.socketType", 2);                    //  STARTLS
        lockPref("mail.server.server1.name", env_user);
        lockPref("mail.server.server1.userName", env_user);               //  ,
        lockPref("mail.server.server1.realuserName", env_user);           //     hostname
        lockPref("mail.server.server1.login_at_startup", true);           //   !      ;)
        lockPref("mail.server.server1.isSecure", true);                   //  

        //  SMTP 
        lockPref("mail.smtpserver.smtp1.hostname", "mail.domain.com");
        lockPref("mail.smtpserver.smtp1.port", 25);
        lockPref("mail.smtpserver.smtp1.description", "SMTP   ¬´  ¬ª");
        lockPref("mail.smtpserver.smtp1.try_ssl", 2);
        lockPref("mail.smtpserver.smtp1.auth_method", 1);
        lockPref("mail.smtpserver.smtp1.username", env_user);

        //   -    ..
        defaultPref("mail.identity.id1.fullName", env_user);            //     ,       
        lockPref("mail.identity.id1.useremail", env_user + "@domain.com");
        lockPref("mail.identity.id1.reply_to", env_user + "@domain.com");
        lockPref("mail.identity.id1.valid", true);
        lockPref("mail.identity.id1.smtpServer", "smtp1");
        lockPref("mail.identity.id1.organization", " ¬´  ¬ª");
        
        //  ID  
        lockPref("mail.account.account1.identities", "id1");

        //   LDAP
        lockPref("ldap_2.servers.domain.uri", "ldap://dc.domain.com/OU=,OU=domain,DC=DOMAIN,DC=COM??sub?(mail=*)");
        lockPref("ldap_2.servers.domain.auth.dn", "DOMAIN\\" + env_user);
        lockPref("ldap_2.servers.domain.auth.saslmech", "");
        lockPref("ldap_2.servers.domain.description", " '  '");
        lockPref("ldap_2.servers.domain.filename", "empl.mab");
        lockPref("ldap_2.servers.domain.maxHits", 300);
        
        //     
        lockPref("ldap_2.autoComplete.directoryServer", "ldap_2.servers.domain");
        lockPref("ldap_2.autoComplete.useDirectory", true);
        
} catch(e) {
    displayError("lockedPref", e);
}</code></pre><br>
  ,     ,   .  <i>try</i>    ,     (    Thunderbird   ).  ,                 ,      .      ,         , ,   <i>mail.server.server.socketType</i>   . <br>
<br>
<i><b>             :   -   Thunderbird ,           Thunderbird   .</b><br>
</i><br>
    Thunderbird         (       <i>all.js</i>!),    ,    Thunderbird   ,      ,      LDAP    .<br>
<br>
            Thunderbird.    ,      <i>lockPref()</i>,   ¬´¬ª.     ‚Äî   -      .<br>
<br>
,  ,       <i>localfoldersserver</i>  IMAP      .        IMAP   ,   ,       ,        ,    .<br>
<br>
   ,        JavaScript   ,      .    ,            <i>thunderbird.cfg</i>   .  ,     .<br>
<br>
<h4>  </h4><br>
   Thunderbird          URL.     ‚Äî   ,     <i>general.config.filename</i>  <i>all.js</i> (     <i>thunderbird.cfg</i>)    :<br>
<br>
<pre><code class="javascript">lockPref("autoadmin.global_config_url", "http://mail.domain.com/thunderbird.cfg");
lockPref("autoadmin.append_emailaddr", false);</code></pre><br>
             ,     .     ‚Äî   ,        .<br>
<br>
:        Thunderbird.      ,  JavaScript, ,   .  ‚Äî     ,   SQL   LDAP .             .<br>
<br>
  ,    .       HTTP ,         PHP  Perl    ,       ,    .<br>
<br>
    ‚Äî        ,    Thunderbird, ,   -       . Thunderbird          <i>getent</i>,        URL   GET-.     : Thunderbird -   URL  GET-   <i>autoadmin.global_config_url</i>.      ,    <i>mod_rewrite</i>        URL    URL c GET-     URL .<br>
<br>
   ,   .     <i>thunderbird.cfg</i>,      Thunderbird,    :<br>
<br>
<pre><code class="javascript">//    Thunderbird   
if(getenv("USER") != "") {
// *NIX settings
        var env_user = getenv("USER");
        var env_home = getenv("HOME");
} else {
// Windows settings
        var env_user = getenv("USERNAME");
        var env_home = getenv("HOMEPATH");
}

lockPref("autoadmin.global_config_url", "http://mail.domain.com/tb/user/"+env_user);
lockPref("autoadmin.append_emailaddr", false);</code></pre><br>
        <b>malamut</b> Thunderbird     <br>
<br>
<b><pre>http://mail.domain.com/tb/user/malamut</pre></b><br>
  mail.domain.com    <b>Apache</b>  <b>mod_rewrite</b>  <b>mod_perl</b>,         .   <i>tb/</i>    mail.domain.com  Perl- <i>conf.pl</i>,       Thunderbird,   <i>.htaccess</i>   :<br>
<br>
<pre><code class="bash">Options -Indexes +ExecCGI
AddHandler cgi-script .pl

RewriteEngine on
RewriteBase /tb
RewriteRule ^user/(.*)                conf.pl?user=$1   [L]</code></pre><br>
    URL <br>
<br>
<b><pre>http://mail.domain.com/tb/user/malamut</pre></b><br>
    URL <br>
<br>
<b><pre>http://mail.domain.com/tb/conf.pl?user=malamut</pre></b><br>
   Perl ,     GET-         Thunderbird.<br>
<br>
   :<br>
<br>
<pre><code class="perl">#!/usr/bin/perl

use 5.010;
use CGI qw/:standard/;

# 
$smtp_server = "mail.domain.com";
$imap_server = "mail.domain.com";
$organization = " ¬´  ¬ª";

#  
print header(
	-type=&gt;'application/javascript'
);

# Username -  GET 
$user = param('user');
unless ($user) { die "We need a user, please!\n" }

#   user  lovercase,       IMAP .  username 
#    ,          .
$user = lc $user;

#########################################################################
#      

#     .   
# FIXME:       
@mails = getEmails($user);

#    
# FIXME:       
$name = getName($user);

#########################################################################
#    

print &lt;&lt;HEAD;
//  Thunderbird   $user ($name)
try {
HEAD

#  
#   SMTP         SMTP  
#       JavaScript.
#    ,          . 
#  mail.accountmanager.accounts  mail.smtpservers,     .
print &lt;&lt;SERVERS;
	//    
	
	//       ,     
	var accounts = getPref("mail.accountmanager.accounts");
	var accounts_s = accounts + ",";
	if (! (accounts_s.indexOf("account1,")+1) ) {
		accounts = accounts + ",account1";
	}
	pref("mail.accountmanager.accounts",accounts);

	//  IMAP 
	lockPref("mail.server.server1.type", "imap");
        lockPref("mail.server.server1.hostname", "$imap_server");     // ,   ,   ,
        lockPref("mail.server.server1.realhostname", "$imap_server"); //       
        lockPref("mail.server.server1.port", 143);                    //  
        lockPref("mail.server.server1.socketType", 2);                //  STARTLS
        lockPref("mail.server.server1.name", "$name");
        lockPref("mail.server.server1.userName", "$user");            //  ,
        lockPref("mail.server.server1.realuserName", "$user");        //     hostname
        lockPref("mail.server.server1.login_at_startup", true);       //   !      ;)
        lockPref("mail.server.server1.isSecure", true);               //  

        //   IMAP   
        lockPref("mail.account.account1.server", "server1");

        //  SMTP 
        lockPref("mail.smtpserver.smtp1.hostname", "$smtp_server");
        lockPref("mail.smtpserver.smtp1.port", 25);
        lockPref("mail.smtpserver.smtp1.description", "SMTP  $organization");
        lockPref("mail.smtpserver.smtp1.try_ssl", 2);
        lockPref("mail.smtpserver.smtp1.auth_method", 1);
        lockPref("mail.smtpserver.smtp1.username", "$user");

        //  SMTP  
	var smtp = getPref("mail.smtpservers");
	var smtp_s = smtp + ",";
	if (! (smtp_s.indexOf("smtp1,")+1) ) {
		smtp = smtp + ",smtp1";
	}
	pref("mail.smtpservers", smtp);	

SERVERS

#   
print &lt;&lt;MISC;
        //   "   "   
	lockPref("mail.rights.version", 1);
	//  
	lockPref("app.update.enabled", false);
	lockPref("extensions.update.enabled", false);
        //        IMAP  ,
        //        
        lockPref("mail.accountmanager.localfoldersserver", "server1");
	//         TB
	lockPref("mail.accountmanager.defaultaccount", "account1");
        //        IMAP  ,
        //        
        lockPref("mail.accountmanager.localfoldersserver", "server1");

MISC

#     
#    ,     .
$i=0;
@ids = ();
foreach $mail (@mails) {	
	$i++;
	$id = &lt;&lt;ID;
	//  $mail   $user ($name)
	defaultPref("mail.identity.id$i.fullName", "$name");
	lockPref("mail.identity.id$i.useremail", "$mail");
	lockPref("mail.identity.id$i.reply_to", "$mail");
	lockPref("mail.identity.id$i.valid", true);
	lockPref("mail.identity.id$i.smtpServer", "smtp1");
	lockPref("mail.identity.id$i.organization", "$organization");
	lockPref("mail.identity.id$i.archive_folder", "imap://$user\@$imap_server/Archives");
	lockPref("mail.identity.id$i.draft_folder", "imap://$user\@$imap_server/Drafts");
	lockPref("mail.identity.id$i.drafts_folder_picker_mode", 0);
	lockPref("mail.identity.id$i.fcc_folder", "imap://$user\@$imap_server/Sent");
	lockPref("mail.identity.id$i.fcc_folder_picker_mode", 0);
	lockPref("mail.identity.id$i.stationery_folder", "imap://$user\@$imap_server/Templates");

ID
	print $id;
	push @ids, "id$i";		
}
#    TB,       
$ids = join ',', @ids;
print &lt;&lt;IDS;
	//      
	lockPref("mail.account.account1.identities", "$ids");

IDS

#   LDAP
print &lt;&lt;BOOKS;
        //   
	lockPref("ldap_2.servers.domain.uri", "ldap://dc.domain.com/OU=,OU=domain,DC=DOMAIN,DC=COM??sub?(mail=*)");
        lockPref("ldap_2.servers.domain.auth.dn", "DOMAIN\\\\$user");
        lockPref("ldap_2.servers.domain.auth.saslmech", "");
        lockPref("ldap_2.servers.domain.description", " '  '");
        lockPref("ldap_2.servers.domain.filename", "empl.mab");
        lockPref("ldap_2.servers.domain.maxHits", 300);
	
	//     
	lockPref("ldap_2.autoComplete.directoryServer", "ldap_2.servers.domain");
	lockPref("ldap_2.autoComplete.useDirectory", true);

BOOKS

#################################################
#      #

if ($user eq 'malamut') {
	yandex('yandex',50);
}

#################################################

print &lt;&lt;TAIL;
} catch(e) {
    displayError("lockedPref", e);
}
TAIL

#     . id     , ya_name   -   
sub yandex {
	my ($ya_name, $id) = @_;
	
	print &lt;&lt;YANDEX;
	// SMTP   $ya_name\@yandex.ru
	lockPref("mail.smtpserver.smtp$id.hostname", "smtp.yandex.ru");
	lockPref("mail.smtpserver.smtp$id.port", 465);
	lockPref("mail.smtpserver.smtp$id.description", "SMTP  $ya_name\@yandex.ru");
	lockPref("mail.smtpserver.smtp$id.try_ssl", 3);
	lockPref("mail.smtpserver.smtp$id.auth_method", 1);
	lockPref("mail.smtpserver.smtp$id.username", "$ya_name\@yandex.ru");
	
	//  SMTP   
	var smtp = getPref("mail.smtpservers");
	var smtp_s = smtp + ",";
	if (! (smtp_s.indexOf("smtp$id,")+1) ) {
		smtp = smtp + ",smtp$id";
	}
	pref("mail.smtpservers", smtp);
	
	// IMAP   $ya_name\@yandex.ru
	lockPref("mail.server.server$id.type", "imap");
	lockPref("mail.server.server$id.hostname", "imap.yandex.ru");
	lockPref("mail.server.server$id.realhostname", "imap.yandex.ru");
	lockPref("mail.server.server$id.port", 993);
	lockPref("mail.server.server$id.socketType", 3);
	lockPref("mail.server.server$id.name", "$ya_name\@yandex.ru");
	lockPref("mail.server.server$id.userName", "$ya_name\@yandex.ru");
	lockPref("mail.server.server$id.realuserName", "$ya_name\@yandex.ru");
	lockPref("mail.server.server$id.check_new_mail", true);
	lockPref("mail.server.server$id.login_at_startup", true);
	lockPref("mail.server.server$id.isSecure", true);
	lockPref("mail.server.server$id.max_cached_connections", 5);
	
	//   $ya_name\@yandex.ru
	defaultPref("mail.identity.id$id.fullName", "$ya_name");
	lockPref("mail.identity.id$id.useremail", "$ya_name\@yandex.ru");
	lockPref("mail.identity.id$id.reply_to", "$ya_name\@yandex.ru");
	lockPref("mail.identity.id$id.valid", true);
	lockPref("mail.identity.id$id.smtpServer", "smtp$id");
	defaultPref("mail.identity.id$id.organization", "");
	
	lockPref("mail.account.account$id.identities", "id$id");
	lockPref("mail.account.account$id.server", "server$id");
	
	//   $ya_name\@yandex.ru  
	accounts = getPref("mail.accountmanager.accounts");
	accounts_s = accounts + ",";
	if (! (accounts_s.indexOf("account$id,")+1) ) {
		accounts = accounts + ",account$id";
	}
	pref("mail.accountmanager.accounts",accounts);
	
YANDEX
}</code></pre><br>
   .      <br>
<br>
<b><pre>http://mail.domain.com/tb/user/malamut</pre></b><br>
   ,   :<br>
<br>
<pre><code class="javascript">//  Thunderbird   malamut (Malamut)
try {
	//    
	
	//       ,     
	var accounts = getPref("mail.accountmanager.accounts");
	var accounts_s = accounts + ",";
	if (! (accounts_s.indexOf("account1,")+1) ) {
		accounts = accounts + ",account1";
	}
	pref("mail.accountmanager.accounts",accounts);

	//  IMAP 
	lockPref("mail.server.server1.type", "imap");
        lockPref("mail.server.server1.hostname", "mail.domain.com");     // ,   ,   ,
        lockPref("mail.server.server1.realhostname", "mail.domain.com"); //       
        lockPref("mail.server.server1.port", 143);                    //  
        lockPref("mail.server.server1.socketType", 2);                //  STARTLS
        lockPref("mail.server.server1.name", "Malamut");
        lockPref("mail.server.server1.userName", "malamut");            //  ,
        lockPref("mail.server.server1.realuserName", "malamut");        //     hostname
        lockPref("mail.server.server1.login_at_startup", true);       //   !      ;)
        lockPref("mail.server.server1.isSecure", true);               //  

        //   IMAP   
        lockPref("mail.account.account1.server", "server1");

        //  SMTP 
        lockPref("mail.smtpserver.smtp1.hostname", "mail.domain.com");
        lockPref("mail.smtpserver.smtp1.port", 25);
        lockPref("mail.smtpserver.smtp1.description", "SMTP   ¬´  ¬ª");
        lockPref("mail.smtpserver.smtp1.try_ssl", 2);
        lockPref("mail.smtpserver.smtp1.auth_method", 1);
        lockPref("mail.smtpserver.smtp1.username", "malamut");

        //  SMTP  
	var smtp = getPref("mail.smtpservers");
	var smtp_s = smtp + ",";
	if (! (smtp_s.indexOf("smtp1,")+1) ) {
		smtp = smtp + ",smtp1";
	}
	pref("mail.smtpservers", smtp);	

        //   "   "   
	lockPref("mail.rights.version", 1);
	//  
	lockPref("app.update.enabled", false);
	lockPref("extensions.update.enabled", false);
        //        IMAP  ,
        //        
        lockPref("mail.accountmanager.localfoldersserver", "server1");
	//         TB
	lockPref("mail.accountmanager.defaultaccount", "account1");
        //        IMAP  ,
        //        
        lockPref("mail.accountmanager.localfoldersserver", "server1");

	//  malamut@domain.com   malamut (Malamut)
	defaultPref("mail.identity.id1.fullName", "Malamut");
	lockPref("mail.identity.id1.useremail", "malamut@domain.com");
	lockPref("mail.identity.id1.reply_to", "malamut@domain.com");
	lockPref("mail.identity.id1.valid", true);
	lockPref("mail.identity.id1.smtpServer", "smtp1");
	lockPref("mail.identity.id1.organization", " ¬´  ¬ª");
	lockPref("mail.identity.id1.archive_folder", "imap://malamut@mail.domain.com/Archives");
	lockPref("mail.identity.id1.draft_folder", "imap://malamut@mail.domain.com/Drafts");
	lockPref("mail.identity.id1.drafts_folder_picker_mode", 0);
	lockPref("mail.identity.id1.fcc_folder", "imap://malamut@mail.domain.com/Sent");
	lockPref("mail.identity.id1.fcc_folder_picker_mode", 0);
	lockPref("mail.identity.id1.stationery_folder", "imap://malamut@mail.domain.com/Templates");

	//  admin@domain.com   malamut (Malamut)
	defaultPref("mail.identity.id2.fullName", "Malamut");
	lockPref("mail.identity.id2.useremail", "admin@domain.com");
	lockPref("mail.identity.id2.reply_to", "admin@domain.com");
	lockPref("mail.identity.id2.valid", true);
	lockPref("mail.identity.id2.smtpServer", "smtp1");
	lockPref("mail.identity.id2.organization", " ¬´  ¬ª");
	lockPref("mail.identity.id2.archive_folder", "imap://malamut@mail.domain.com/Archives");
	lockPref("mail.identity.id2.draft_folder", "imap://malamut@mail.domain.com/Drafts");
	lockPref("mail.identity.id2.drafts_folder_picker_mode", 0);
	lockPref("mail.identity.id2.fcc_folder", "imap://malamut@mail.domain.com/Sent");
	lockPref("mail.identity.id2.fcc_folder_picker_mode", 0);
	lockPref("mail.identity.id2.stationery_folder", "imap://malamut@mail.domain.com/Templates");

	//      
	lockPref("mail.account.account1.identities", "id1,id2");

        //   
	lockPref("ldap_2.servers.domain.uri", "ldap://dc.domain.com/OU=,OU=domain,DC=DOMAIN,DC=COM??sub?(mail=*)");
        lockPref("ldap_2.servers.domain.auth.dn", "DOMAIN\\malamut");
        lockPref("ldap_2.servers.domain.auth.saslmech", "");
        lockPref("ldap_2.servers.domain.description", " '  '");
        lockPref("ldap_2.servers.domain.filename", "empl.mab");
        lockPref("ldap_2.servers.domain.maxHits", 300);
	
	//     
	lockPref("ldap_2.autoComplete.directoryServer", "ldap_2.servers.domain");
	lockPref("ldap_2.autoComplete.useDirectory", true);

	// SMTP   yandex@yandex.ru
	lockPref("mail.smtpserver.smtp50.hostname", "smtp.yandex.ru");
	lockPref("mail.smtpserver.smtp50.port", 465);
	lockPref("mail.smtpserver.smtp50.description", "SMTP  yandex@yandex.ru");
	lockPref("mail.smtpserver.smtp50.try_ssl", 3);
	lockPref("mail.smtpserver.smtp50.auth_method", 1);
	lockPref("mail.smtpserver.smtp50.username", "yandex@yandex.ru");
	
	//  SMTP   
	var smtp = getPref("mail.smtpservers");
	var smtp_s = smtp + ",";
	if (! (smtp_s.indexOf("smtp50,")+1) ) {
		smtp = smtp + ",smtp50";
	}
	pref("mail.smtpservers", smtp);
	
	// IMAP   yandex@yandex.ru
	lockPref("mail.server.server50.type", "imap");
	lockPref("mail.server.server50.hostname", "imap.yandex.ru");
	lockPref("mail.server.server50.realhostname", "imap.yandex.ru");
	lockPref("mail.server.server50.port", 993);
	lockPref("mail.server.server50.socketType", 3);
	lockPref("mail.server.server50.name", "yandex@yandex.ru");
	lockPref("mail.server.server50.userName", "yandex@yandex.ru");
	lockPref("mail.server.server50.realuserName", "yandex@yandex.ru");
	lockPref("mail.server.server50.check_new_mail", true);
	lockPref("mail.server.server50.login_at_startup", true);
	lockPref("mail.server.server50.isSecure", true);
	lockPref("mail.server.server50.max_cached_connections", 5);
	
	//   yandex@yandex.ru
	defaultPref("mail.identity.id50.fullName", "yandex");
	lockPref("mail.identity.id50.useremail", "yandex@yandex.ru");
	lockPref("mail.identity.id50.reply_to", "yandex@yandex.ru");
	lockPref("mail.identity.id50.valid", true);
	lockPref("mail.identity.id50.smtpServer", "smtp50");
	defaultPref("mail.identity.id50.organization", "");
	
	lockPref("mail.account.account50.identities", "id50");
	lockPref("mail.account.account50.server", "server50");
	
	//   yandex@yandex.ru  
	accounts = getPref("mail.accountmanager.accounts");
	accounts_s = accounts + ",";
	if (! (accounts_s.indexOf("account50,")+1) ) {
		accounts = accounts + ",account50";
	}
	pref("mail.accountmanager.accounts",accounts);
	
} catch(e) {
    displayError("lockedPref", e);
}</code></pre><br>
  ,      Thunderbird,  Perl   . <br>
<br>
    ,            Thunderbird,   ,     . ,       ‚Äî   ,       .<br>
<br>
<h4>    </h4><br>
,   ,       Thunderbird,     .<br>
<br>
     Thunderbird     .     ,  , SMTP    ,  Thunderbird         .     -    ,   ,  ,      .       -   ,     .  ‚Äî   ,    1.<br>
<br>
 ,      - , ,      , Thunderbird   ,  . :<br>
<br>
<pre><code class="javascript">lockPref("mail.account.account1.identities", "id1,id2");</code></pre><br>
Thunderbird    (<b>account</b>),  ,         (<b>identity</b>).   ,    ,   <b>mail.account.accountN</b>,  N ‚Äî   .   ,    ,    <b>mail.identity.idN</b>,  N ‚Äî   .<br>
<br>
   Thunderbird    <b>mail.accountmanager.accounts</b>. ,                 Thunderbird.      ,     Thunderbird,     ,        .<br>
<br>
     N    <b>mail.account.accountN.identities</b>. IMAP        <b>mail.account.accountN.server</b>, SMTP          <b>mail.identity.idN.smtpServer</b>.<br>
<br>
 ,  ,  - ,     ,         .<br>
<br>
<h4>    </h4><br>
-,    JavaScript ,       . ,        :<br>
<br>
<pre><code class="javascript">//       ,     
	var accounts = getPref("mail.accountmanager.accounts");
	var accounts_s = accounts + ",";
	if (! (accounts_s.indexOf("account1,")+1) ) {
		accounts = accounts + ",account1";
	}
	pref("mail.accountmanager.accounts",accounts);</code></pre><br>
    ,        ,   .          ,      .<br>
<br>
 ,   Perl            .     ,     Yandex   ,       .       Thunderbird    ,      ,  Yandex   !            .<br>
<br>
,    -      yandex  . ,  ,     ,   ,  ,       ,                .     ,       ,    .<br>
<br>
      ,         .      Thunderbird   ,          ,      - ,        .     ,         ,      .<br>
<br>
<h4>  Thunderbird</h4><br>
 Thunderbird   .     ,  Thunderbird        ,   .          .<br>
<br>
,          IMAP ACL    <a href="https://addons.mozilla.org/ru/thunderbird/addon/imap-acl-extension/"></a>.     Thunderbird   <a href="http://www.mozilla.org/projects/calendar/lightning/">Lightning</a>, , ,         .<br>
<br>
 ,       ,      ,           <i>extensions/</i>,        Thunderbird.<br>
<br>
 ,        .     <i>default/profile</i>.    , ,        .<br>
<br>
<i><b>       !</b></i></div><p>Source: <a href="https://habr.com/ru/post/101905/">https://habr.com/ru/post/101905/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../101889/index.html">Geeky in the office</a></li>
<li><a href="../101892/index.html">Multi-finger gestures in Ubuntu 10.10</a></li>
<li><a href="../101893/index.html">Habrafutbol in the northern capital</a></li>
<li><a href="../101898/index.html">Scientists have created an "emotional" robot</a></li>
<li><a href="../101903/index.html">Personal identification on gosuslugi.ru</a></li>
<li><a href="../101906/index.html">Ways to evaluate employee performance</a></li>
<li><a href="../101909/index.html">Calendar period - we improve the interface</a></li>
<li><a href="../101910/index.html">Purgatory for computers</a></li>
<li><a href="../101911/index.html">Solving the password problem</a></li>
<li><a href="../101914/index.html">Inventory in the company: Installing GLPI</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>